{"mappings":"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","sources":["src/app/script/main-embed.ts","src/app/script/polyfills.ts","node_modules/mdn-polyfills/Node.prototype.append.js","node_modules/mdn-polyfills/Node.prototype.prepend.js","node_modules/mdn-polyfills/String.prototype.padStart.js","src/app/script/app/kl-app.ts","src/app/script/klecks/kl.ts","src/app/script/klecks/history/kl-history.ts","src/app/script/klecks/ui/modals/popup.ts","src/app/script/klecks/ui/modals/modal-count.ts","src/app/script/bb/bb.ts","src/app/script/bb/input/event-listener.ts","src/app/script/bb/base/browser.ts","src/app/script/bb/base/create-canvas.ts","src/app/script/bb/base/base.ts","src/app/script/bb/input/key-listener.ts","src/app/script/bb/input/pointer-listener.ts","src/app/script/bb/math/math.ts","src/app/script/bb/input/event-chain.ts","src/app/script/bb/base/canvas.ts","src/app/script/bb/math/matrix.ts","src/app/script/bb/math/vec2.ts","src/app/script/bb/math/line.ts","src/app/script/bb/color/color.ts","src/app/script/bb/base/ui.ts","src/app/script/bb/base/bb-log.ts","<<jsx-config-pragma.js>>","src/app/script/bb/base/local-storage.ts","node_modules/@parcel/runtime-js/lib/runtime-34832b43d0ebd3bf.js","node_modules/@parcel/runtime-js/lib/runtime-a96f6567e6dac4f3.js","src/app/script/klecks/ui/base-components/checkbox.ts","src/app/script/klecks/ui/base-components/input.ts","src/app/script/klecks/ui/base-components/select.ts","src/app/script/klecks/ui/base-components/image-toggle.ts","src/app/script/klecks/ui/base-components/image-radio-list.ts","src/app/script/klecks/ui/base-components/pen-pressure-toggle.ts","node_modules/@parcel/runtime-js/lib/runtime-065238818b5d6d26.js","src/app/script/klecks/ui/base-components/kl-slider.ts","src/app/script/klecks/ui/base-components/slider-falloff.ts","src/app/script/klecks/ui/base-components/kl-slider-manual-input.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-ce95b2abc71314b0.js","src/app/script/klecks/ui/base-components/kl-color-slider.ts","node_modules/@parcel/runtime-js/lib/runtime-e7bece06ac3b91da.js","src/app/script/klecks/ui/base-components/kl-color-slider-small.ts","src/app/script/klecks/ui/base-components/point-slider.ts","src/app/script/klecks/ui/base-components/color-options.ts","src/app/script/klecks/ui/base-components/options.ts","src/app/script/klecks/ui/components/status-overlay.ts","node_modules/@parcel/runtime-js/lib/runtime-76fc4a9796871f89.js","src/app/script/klecks/ui/modals/export-dialog-deprecated.ts","src/app/script/klecks/ui/components/crop-copy.ts","src/app/script/klecks/ui/modals/clipboard-dialog.ts","src/app/script/klecks/ui/tool-tabs/kl-layer-manager.ts","node_modules/@parcel/runtime-js/lib/runtime-9e9c6514323b50ff.js","node_modules/@parcel/runtime-js/lib/runtime-f141aefb87a862aa.js","node_modules/@parcel/runtime-js/lib/runtime-e93ed5f4a72fe388.js","node_modules/@parcel/runtime-js/lib/runtime-e1e96fa0dcd63695.js","node_modules/@parcel/runtime-js/lib/runtime-2d2417fe7f53ff5b.js","src/app/script/klecks/canvas/kl-canvas.ts","src/app/script/klecks/image-operations/flood-fill.ts","src/app/script/klecks/image-operations/shape-tool.ts","src/app/script/klecks/image-operations/render-text.ts","src/app/script/klecks/canvas/draw-project.ts","src/app/script/klecks/canvas/translate-blending.ts","src/app/script/klecks/canvas-ui/workspace-svg-overlay.ts","src/app/script/klecks/canvas-ui/kl-canvas-workspace.ts","node_modules/@parcel/runtime-js/lib/runtime-ce6158b179cda36d.js","node_modules/@parcel/runtime-js/lib/runtime-9180b336d2c14eb8.js","node_modules/@parcel/runtime-js/lib/runtime-e98ceba16f4f3e8c.js","node_modules/@parcel/runtime-js/lib/runtime-1c4e2d66dbd3cd26.js","src/app/script/klecks/canvas-ui/canvas-preview.ts","src/app/script/klecks/ui/components/free-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-7b1b46c773a5d5de.js","src/app/script/klecks/ui/components/free-transform-canvas.ts","src/app/script/klecks/ui/components/cropper.ts","src/app/script/klecks/ui/components/layer-preview.ts","src/app/script/klecks/ui/components/fitted-image.ts","src/app/script/klecks/ui/modals/show-import-as-layer-dialog.ts","src/app/script/klecks/ui/components/kl-image-dropper.ts","src/app/script/klecks/ui/components/overlay-toolspace.ts","src/app/script/klecks/ui/components/toolspace-top-row.ts","node_modules/@parcel/runtime-js/lib/runtime-c595ccae60beff87.js","node_modules/@parcel/runtime-js/lib/runtime-e5d7180bbee5b536.js","node_modules/@parcel/runtime-js/lib/runtime-6c52a4e8d76ec49b.js","node_modules/@parcel/runtime-js/lib/runtime-fa73233744fc505c.js","node_modules/@parcel/runtime-js/lib/runtime-b34e92e9fb9b8c68.js","node_modules/@parcel/runtime-js/lib/runtime-8a2022a1c05c8770.js","src/app/script/klecks/ui/components/tool-dropdown.ts","node_modules/@parcel/runtime-js/lib/runtime-760df77bff0950f0.js","node_modules/@parcel/runtime-js/lib/runtime-ff3da4d7dabee86d.js","node_modules/@parcel/runtime-js/lib/runtime-297f8366ec2375c9.js","node_modules/@parcel/runtime-js/lib/runtime-d831990ac91a582d.js","node_modules/@parcel/runtime-js/lib/runtime-621488e8bcab6d4d.js","src/app/script/klecks/ui/components/toolspace-tool-row.ts","node_modules/@parcel/runtime-js/lib/runtime-7355152122a84936.js","node_modules/@parcel/runtime-js/lib/runtime-81519c452bdfbaa9.js","node_modules/@parcel/runtime-js/lib/runtime-3fc59c96423b70ad.js","node_modules/@parcel/runtime-js/lib/runtime-1eef10cb07c9c851.js","src/app/script/klecks/ui/components/toolspace-stabilizer-row.ts","src/app/script/klecks/ui/components/tab-row.ts","node_modules/@parcel/runtime-js/lib/runtime-b9f67aff2ffaa235.js","src/app/script/klecks/ui/tool-tabs/hand-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-4486cf75fca81822.js","src/app/script/klecks/ui/tool-tabs/fill-ui.ts","src/app/script/klecks/ui/tool-tabs/text-ui.ts","src/app/script/klecks/ui/tool-tabs/shape-ui.ts","src/app/script/klecks/ui/modals/new-image-dialog.ts","src/app/script/klecks/ui/components/toolspace-collapser.ts","node_modules/@parcel/runtime-js/lib/runtime-3ca3a85d3436a84f.js","src/app/script/klecks/ui/modals/text-tool-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-47401ec572d2cfcf.js","node_modules/@parcel/runtime-js/lib/runtime-6476cf999a0e75d3.js","node_modules/@parcel/runtime-js/lib/runtime-4ee49cef2a1bfd51.js","node_modules/@parcel/runtime-js/lib/runtime-01d9fe07522d7373.js","node_modules/@parcel/runtime-js/lib/runtime-8450ca7f4e68dde7.js","src/app/script/klecks/ui/modals/show-import-image-dialog.ts","src/app/script/klecks/storage/psd.ts","src/app/script/klecks/storage/indexed-db.ts","src/app/script/klecks/filters/filters.ts","node_modules/@parcel/runtime-js/lib/runtime-08ec85fc3ea564e8.js","node_modules/@parcel/runtime-js/lib/runtime-c105dce751d9b16c.js","node_modules/@parcel/runtime-js/lib/runtime-272cd0cc0051d99c.js","node_modules/@parcel/runtime-js/lib/runtime-d623cec3e031c802.js","node_modules/@parcel/runtime-js/lib/runtime-4aa563d1de55ad17.js","node_modules/@parcel/runtime-js/lib/runtime-acf5209c71eb3497.js","node_modules/@parcel/runtime-js/lib/runtime-726a62492af9f94e.js","node_modules/@parcel/runtime-js/lib/runtime-f1cff4f2714da535.js","node_modules/@parcel/runtime-js/lib/runtime-06b47f2ffca8a188.js","node_modules/@parcel/runtime-js/lib/runtime-866a2902b0cdf580.js","node_modules/@parcel/runtime-js/lib/runtime-3b4878106cdf1b9c.js","node_modules/@parcel/runtime-js/lib/runtime-02847deebefdd0a7.js","node_modules/@parcel/runtime-js/lib/runtime-3dce3f08da564a07.js","node_modules/@parcel/runtime-js/lib/runtime-0e43c74fde652ea0.js","node_modules/@parcel/runtime-js/lib/runtime-2d3b073eae8e5f9b.js","src/app/script/klecks/brushes/brushes.ts","src/app/script/klecks/brushes/pen-brush.ts","src/app/script/klecks/brushes/brushes-common.ts","src/app/script/klecks/brushes/alphas/brush-alphas.ts","src/app/script/bb/math/perlin.ts","src/app/script/klecks/brushes/blend-brush.ts","src/app/script/klecks/brushes/sketchy-brush.ts","src/app/script/klecks/brushes/pixel-brush.ts","src/app/script/klecks/brushes/eraser-brush.ts","src/app/script/klecks/brushes/smudge-brush.ts","src/app/script/klecks/brushes/chemy-brush.ts","src/app/script/klecks/brushes-ui/brushes-ui.ts","src/app/script/klecks/brushes-ui/pen-brush-ui.ts","src/app/script/klecks/brushes-ui/brushes-consts.ts","node_modules/@parcel/runtime-js/lib/runtime-f5fee83b55dfe524.js","src/app/script/klecks/brushes-ui/blend-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-c1ff462122383f3a.js","src/app/script/klecks/brushes-ui/sketchy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-c362cafb743e4bf7.js","src/app/script/klecks/brushes-ui/pixel-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-9083363aed84d015.js","src/app/script/klecks/brushes-ui/eraser-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-72d61ca9dbc6379a.js","src/app/script/klecks/brushes-ui/smudge-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-2e54934a27c8b910.js","src/app/script/klecks/brushes-ui/chemy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-a3466c6b7be08d45.js","src/app/script/klecks/ui/base-components/box-toggle.ts","src/app/script/klecks/ui/modals/show-iframe-popup.ts","src/app/script/klecks/ui/base-components/radio-list.ts","src/app/script/klecks/ui/components/browser-storage-ui.ts","src/app/script/klecks/storage/project-store.ts","src/app/script/klecks/storage/project-converter.ts","src/app/script/klecks/storage/base-64-to-blob.ts","src/app/script/klecks/ui/tool-tabs/file-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-174f5efa9e6f0131.js","src/app/script/klecks/ui/tool-tabs/filter-tab.ts","src/app/script/klecks/ui/modals/imgur-upload.ts","node_modules/@parcel/runtime-js/lib/runtime-257b8f01a8ca9ad6.js","src/app/script/klecks/storage/ag-psd-wrapper.ts","node_modules/@parcel/runtime-js/lib/runtime-5ea32053680ef652.js","src/app/script/klecks/ui/components/save-reminder.ts","src/app/script/klecks/storage/save-to-computer.ts","node_modules/file-saver/src/FileSaver.js","src/app/script/klecks/history/undo-redo-catchup.ts","src/app/script/klecks/brushes-ui/brush-setting-service.ts","src/app/script/klecks/ui/tool-tabs/settings-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-3e3712af4386deba.js","node_modules/@parcel/runtime-js/lib/runtime-050615743b2088cc.js","node_modules/@parcel/runtime-js/lib/runtime-4135c6b241ed0f39.js","src/app/script/klecks/ui/components/toolspace-scroller.ts","src/app/script/embed/toolspace-top-row.ts","src/app/script/klecks/filters/filters-lazy.ts","src/app/script/klecks/filters/filter-brightness-contrast.ts","src/app/script/klecks/filters/filters-consts.ts","src/app/script/klecks/filters/shared-gl-fx.ts","src/app/script-vendor/glfx.ts","src/app/script-vendor/shader-noise.glsl","src/app/script/klecks/filters/filter-crop-extend.ts","src/app/script/klecks/filters/filter-curves.ts","src/app/script/klecks/filters/filter-flip.ts","node_modules/@parcel/runtime-js/lib/runtime-0b614230dd5a2fbc.js","src/app/script/klecks/filters/filter-hue-saturation.ts","src/app/script/klecks/filters/filter-invert.ts","src/app/script/klecks/filters/filter-perspective.ts","src/app/script/klecks/filters/filter-resize.ts","node_modules/@parcel/runtime-js/lib/runtime-c388461235ee692d.js","src/app/script/klecks/filters/filter-rotate.ts","src/app/script/klecks/filters/filter-tilt-shift.ts","src/app/script/klecks/filters/filter-transform.ts","src/app/script/klecks/filters/filter-blur.ts","src/app/script/klecks/filters/filter-unsharp-mask.ts","src/app/script/klecks/filters/filter-to-alpha.ts","src/app/script/klecks/filters/filter-grid.ts","src/app/script/klecks/image-operations/draw-grid.ts","src/app/script/klecks/filters/filter-noise.ts","src/app/script/klecks/storage/kl-canvas-to-psd-blob.ts","node_modules/@parcel/runtime-js/lib/runtime-fe04d655c2a3180f.js","node_modules/@parcel/runtime-js/lib/runtime-f15ea15a7900b9a3.js"],"sourcesContent":["import './polyfills';\r\nimport {KlApp} from './app/kl-app';\r\nimport {IKlProject} from './klecks/kl.types';\r\nimport {SaveReminder} from './klecks/ui/components/save-reminder';\r\nimport {klHistory} from './klecks/history/kl-history';\r\nimport {klPsdToKlProject, readPsd} from './klecks/storage/psd';\r\nimport {LANG} from './language/language';\r\n\r\nexport interface IEmbedParams {\r\n    project?: IKlProject,\r\n    psdBlob?: Blob,\r\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    embedUrl: string;\r\n    logoImg?: any;\r\n    bottomBar?: HTMLElement;\r\n    aboutEl?: HTMLElement;\r\n}\r\n\r\nexport interface IReadPSD {\r\n    blob: Blob;\r\n    callback: (k: IKlProject) => void;\r\n}\r\n\r\nexport function Embed(p: IEmbedParams) {\r\n\r\n    let isInitialized: boolean = false;\r\n    let klApp;\r\n    const psdQueue: IReadPSD[] = []; // queue of psds waiting while ag-psd is loading\r\n    let agPsd: any | 'error';\r\n\r\n    let loadingScreenEl = document.getElementById(\"loading-screen\");\r\n    let loadingScreenTextEl = document.getElementById(\"loading-screen-text\");\r\n    if (loadingScreenTextEl) {\r\n        loadingScreenTextEl.textContent = LANG('embed-init-waiting');\r\n    }\r\n\r\n    function onProjectReady(project: IKlProject) {\r\n        try {\r\n            if (isInitialized) {\r\n                throw new Error('Already called openProject');\r\n            }\r\n            isInitialized = true;\r\n\r\n            const saveReminder = new SaveReminder(\r\n                klHistory,\r\n                false,\r\n                false,\r\n                () => {},\r\n                () => klApp ? klApp.isDrawing() : false,\r\n                null,\r\n                null,\r\n            );\r\n            klApp = new KlApp(\r\n                project,\r\n                {\r\n                    saveReminder,\r\n                    bottomBar: p.bottomBar,\r\n                    aboutEl: p.aboutEl,\r\n                    embed: {\r\n                        url: p.embedUrl,\r\n                        onSubmit: p.onSubmit,\r\n                    }\r\n                }\r\n            );\r\n            saveReminder.init();\r\n\r\n            if (loadingScreenEl && loadingScreenEl.parentNode) {\r\n                loadingScreenEl.parentNode.removeChild(loadingScreenEl);\r\n            }\r\n            loadingScreenEl = null;\r\n            loadingScreenTextEl = null;\r\n\r\n            document.body.appendChild(klApp.getEl());\r\n        } catch (e) {\r\n            if (loadingScreenTextEl) {\r\n                loadingScreenTextEl.textContent = ' ' + e;\r\n            }\r\n            if (loadingScreenEl) {\r\n                loadingScreenEl.className += 'loading-screen-error';\r\n            }\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    if (p.project) {\r\n        onProjectReady(p.project);\r\n    }\r\n    this.openProject = onProjectReady;\r\n    this.initError = (error: string) => {\r\n        if (loadingScreenTextEl) {\r\n            loadingScreenTextEl.textContent = ' ' + error;\r\n        }\r\n        if (loadingScreenEl) {\r\n            loadingScreenEl.className += 'loading-screen-error';\r\n        }\r\n    };\r\n    this.getPNG = (): Blob => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return klApp.getPNG();\r\n    };\r\n    this.getPSD = async (): Promise<Blob> => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return await klApp.getPSD();\r\n    };\r\n    this.readPSDs = (psds: IReadPSD[]) => {\r\n        if (psds.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const readItem = (item: IReadPSD) => {\r\n            try {\r\n                const psd = agPsd.readPsd(item.blob);\r\n                const project = klPsdToKlProject(readPsd(psd));\r\n                item.callback(project);\r\n            } catch (e) {\r\n                console.error('failed to read psd', e);\r\n                item.callback(null);\r\n            }\r\n        };\r\n\r\n        if (!agPsd) {\r\n            if (psdQueue.length === 0) {\r\n                // load ag-psd\r\n                (async () => {\r\n                    try {\r\n                        agPsd = await import('ag-psd');\r\n                    } catch (e) {\r\n                        agPsd = 'error';\r\n                    }\r\n                    while (psdQueue.length) {\r\n                        readItem(psdQueue.shift());\r\n                    }\r\n                })();\r\n            }\r\n            psds.forEach(item => {\r\n                psdQueue.push(item);\r\n            });\r\n        } else {\r\n            psds.forEach(readItem);\r\n        }\r\n    };\r\n}","// import 'core-js';\r\nimport 'mdn-polyfills/Node.prototype.append';\r\nimport 'mdn-polyfills/Node.prototype.prepend';\r\nimport 'mdn-polyfills/String.prototype.padStart';\r\n\r\nif (!('scrollTo' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollTo', {\r\n        value: function (x, y) {\r\n            this.scrollLeft = x;\r\n            this.scrollTop = y;\r\n        }\r\n    });\r\n}\r\n\r\nif (!('scrollBy' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollBy', {\r\n        value: function (x, y) {\r\n            this.scrollLeft += x;\r\n            this.scrollTop += y;\r\n        }\r\n    });\r\n}\r\n\r\n// sometimes Android WebView has no localStorage\r\nif (!('localStorage' in window)) {\r\n    try {\r\n        window['localStorage'] = {\r\n            getItem: () => null,\r\n            setItem: () => {},\r\n            removeItem: () => {},\r\n        } as any;\r\n    } catch (e) {\r\n        // maybe it doesn't let me set this\r\n    }\r\n}","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"append\")||Object.defineProperty(e,\"append\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(n,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"prepend\")||Object.defineProperty(e,\"prepend\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","String.prototype.padStart||(String.prototype.padStart=function(t,n){return t>>=0,n=String(n||\" \"),this.length>t?String(this):((t-=this.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(this))});\n","import {KL} from '../klecks/kl';\r\nimport {klHistory} from '../klecks/history/kl-history';\r\nimport {BB} from '../bb/bb';\r\nimport {showIframePopup} from '../klecks/ui/modals/show-iframe-popup';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\nimport {exportType} from '../klecks/ui/tool-tabs/file-tab';\r\nimport {ToolspaceTopRow} from \"../embed/toolspace-top-row\";\r\nimport {IInitState, IKlProject, IKlPsd} from '../klecks/kl.types';\r\nimport {importFilters} from '../klecks/filters/filters-lazy';\r\nimport {base64ToBlob} from '../klecks/storage/base-64-to-blob';\r\nimport {klCanvasToPsdBlob} from '../klecks/storage/kl-canvas-to-psd-blob';\r\nimport {ProjectStore} from '../klecks/storage/project-store';\r\nimport {SaveReminder} from \"../klecks/ui/components/save-reminder\";\r\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\r\nimport {LANG} from '../language/language';\r\n// @ts-ignore\r\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\r\n// @ts-ignore\r\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\r\n// @ts-ignore\r\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\r\n// @ts-ignore\r\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\r\n// @ts-ignore\r\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\r\n// @ts-ignore\r\nimport tabSettingsImg from 'url:~/src/app/img/ui/tab-settings.svg';\r\n// @ts-ignore\r\nimport tabLayersImg from 'url:~/src/app/img/ui/tab-layers.svg';\r\nimport {LocalStorage} from '../bb/base/local-storage';\r\n\r\n\r\ninterface IKlAppOptions {\r\n    saveReminder?: SaveReminder;\r\n    projectStore?: ProjectStore;\r\n    logoImg?: any; // app logo\r\n    bottomBar?: HTMLElement; // row at bottom of toolspace\r\n    embed?: {\r\n        url: string;\r\n        onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    };\r\n    app?: {\r\n        filenameBase?: string; // part of filename when downloading drawing\r\n        imgurKey?: string; // for imgur uploads\r\n    };\r\n    aboutEl?: HTMLElement; // replaces info about Klecks in settings tab\r\n}\r\n\r\nimportFilters();\r\n\r\nexport function KlApp(pProject: IKlProject | null, pOptions: IKlAppOptions) {\r\n    // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\r\n    // but not larger than 4096 - a fairly arbitrary decision\r\n    let klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\r\n    let collapseThreshold = 820;\r\n    let uiState: 'left' | 'right' = (pOptions.embed ? 'left' : (LocalStorage.getItem('uiState') ? LocalStorage.getItem('uiState') : 'right')) as any;\r\n    const filenameBase = pOptions.app?.filenameBase ? pOptions.app.filenameBase : 'Klecks';\r\n    const projectStore = pOptions.projectStore;\r\n    let klRootEl = document.createElement(\"div\");\r\n    klRootEl.className = 'g-root';\r\n    let uiWidth: number = Math.max(0, window.innerWidth);\r\n    let uiHeight: number = Math.max(0, window.innerHeight);\r\n    const toolWidth = 271;\r\n    let exportType: exportType = 'png';\r\n    let klCanvas: KlCanvas = new KL.KlCanvas(\r\n        pProject ? {\r\n            projectObj: pProject\r\n        } : {\r\n            width: Math.max(10, Math.min(klMaxCanvasSize, window.innerWidth < collapseThreshold ? uiWidth : uiWidth - toolWidth)),\r\n            height: Math.max(10, Math.min(klMaxCanvasSize, uiHeight)),\r\n        }, pOptions.embed ? -1 : 0);\r\n    klCanvas.setHistory(klHistory);\r\n    let initState: IInitState = null;\r\n    let mainTabRow;\r\n\r\n    if (!pOptions.saveReminder) {\r\n        pOptions.saveReminder = {init: () => {}, reset: () => {}} as SaveReminder;\r\n    }\r\n\r\n    function translateSmoothing(s: number): number {\r\n        if (s == 1) {\r\n            return 1 - 0.5;\r\n        }\r\n        if (s == 2) {\r\n            return 1 - 0.16;\r\n        }\r\n        if (s == 3) {\r\n            return 1 - 0.035;\r\n        }\r\n        if (s == 4) {\r\n            return 1 - 0.0175;\r\n        }\r\n        if (s == 5) {\r\n            return 1 - 0.00875;\r\n        }\r\n        return s;\r\n    }\r\n\r\n    let isFirstImage = true;\r\n\r\n    if (pProject) {\r\n        pProject.layers.forEach(layer => {\r\n            layer.image = null;\r\n        });\r\n        pProject = null;\r\n    } else {\r\n        klHistory.pause(true);\r\n        klCanvas.addLayer();\r\n        klCanvas.layerFill(0, { r: 255, g: 255, b: 255});\r\n        klHistory.pause(false);\r\n    }\r\n    try {\r\n        initState = {\r\n            canvas: new KL.KlCanvas({copy: klCanvas}, pOptions.embed ? -1 : 0),\r\n            focus: klCanvas.getLayerCount() - 1,\r\n            brushes: {},\r\n        };\r\n    } catch (e) {\r\n        if (e.message === 'kl-create-canvas-error') {\r\n            klCanvas.destroy();\r\n        }\r\n        throw e;\r\n    }\r\n    for (let b in KL.brushes) {\r\n        if (KL.brushes.hasOwnProperty(b)) {\r\n            initState.brushes[b] = new KL.brushes[b]();\r\n            if (initState.canvas) {\r\n                initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    let currentColor = new BB.RGB(0, 0, 0);\r\n    let currentBrush, currentBrushId;\r\n    let lastNonEraserBrushId = 0;\r\n    let currentLayerCtx = klCanvas.getLayerContext(klCanvas.getLayerCount() - 1);\r\n\r\n    function sizeWatcher(val) {\r\n        brushSettingService.emitSize(val);\r\n        if (klCanvasWorkspace) {\r\n            klCanvasWorkspace.setCursorSize(val * 2);\r\n        }\r\n    }\r\n\r\n    const brushSettingService = new KL.BrushSettingService(\r\n        (color) => {\r\n            klColorSlider.setColor(color);\r\n            currentBrush.setColor(color);\r\n            currentColor = BB.copyObj(color);\r\n        },\r\n        (size) => {\r\n            currentBrush.setSize(size);\r\n            klCanvasWorkspace.setCursorSize(size * 2);\r\n        },\r\n        (opacity) => {\r\n            currentBrush.setOpacity(opacity);\r\n        },\r\n        () => klColorSlider.getColor(),\r\n        () => brushUiObj[currentBrushId].getSize(),\r\n        () => brushUiObj[currentBrushId].getOpacity(),\r\n        () => {\r\n            return {\r\n                sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\r\n            };\r\n        }\r\n    );\r\n\r\n    let lineSmoothing = new BB.EventChain.LineSmoothing({\r\n        smoothing: translateSmoothing(1),\r\n    });\r\n    let lineSanitizer = new BB.EventChain.LineSanitizer();\r\n\r\n    let drawEventChain = new BB.EventChain.EventChain({\r\n        chainArr: [\r\n            lineSanitizer,\r\n            lineSmoothing\r\n        ],\r\n    });\r\n\r\n    drawEventChain.setChainOut(function(event) {\r\n        if (event.type === 'down') {\r\n            toolspace.style.pointerEvents = 'none';\r\n            currentBrush.startLine(event.x, event.y, event.pressure);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'move') {\r\n            currentBrush.goLine(event.x, event.y, event.pressure, false, event.isCoalesced)\r\n            klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'up') {\r\n            toolspace.style.pointerEvents = '';\r\n            currentBrush.endLine();\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'line') {\r\n            currentBrush.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n    });\r\n\r\n    let textToolSettings = {\r\n        size: 20,\r\n        align: 'left' as ('left' | 'center' | 'right'),\r\n        isBold: false,\r\n        isItalic: false,\r\n        font: 'sans-serif' as ('serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'),\r\n        opacity: 1\r\n    };\r\n\r\n    const klCanvasWorkspace: KlCanvasWorkspace = new KL.KlCanvasWorkspace({\r\n        klCanvas: klCanvas,\r\n        width: Math.max(0, uiWidth - toolWidth),\r\n        height: uiHeight,\r\n        onDraw: drawEventChain.chainIn,\r\n        onPick: function(rgbObj, isDragDone) {\r\n            brushSettingService.setColor(rgbObj);\r\n            if (isDragDone) {\r\n                klColorSlider.pickingDone();\r\n                klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\r\n            }\r\n        },\r\n        onFill: function(canvasX, canvasY) {\r\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n            klCanvas.floodFill(layerIndex, canvasX, canvasY, klColorSlider.getColor(), fillUi.getOpacity(), fillUi.getTolerance(), fillUi.getSample(), fillUi.getGrow(), fillUi.getContiguous());\r\n            klCanvasWorkspace.requestFrame();\r\n        },\r\n        onText: function(canvasX, canvasY, angleRad) {\r\n            if (KL.dialogCounter.get() > 0) {\r\n                return;\r\n            }\r\n\r\n            KL.textToolDialog({\r\n                klCanvas: klCanvas,\r\n                layerIndex: klCanvas.getLayerIndex(currentLayerCtx.canvas),\r\n                x: canvasX,\r\n                y: canvasY,\r\n                angleRad: angleRad,\r\n                color: klColorSlider.getColor(),\r\n                secondaryColor: klColorSlider.getSecondaryRGB(),\r\n                size: textToolSettings.size,\r\n                align: textToolSettings.align,\r\n                isBold: textToolSettings.isBold,\r\n                isItalic: textToolSettings.isItalic,\r\n                font: textToolSettings.font,\r\n                opacity: textToolSettings.opacity,\r\n                onConfirm: function(val) {\r\n\r\n                    let colorRGBA = val.color;\r\n                    colorRGBA.a = val.opacity;\r\n\r\n                    textToolSettings.size = val.size;\r\n                    textToolSettings.align = val.align;\r\n                    textToolSettings.isBold = val.isBold;\r\n                    textToolSettings.isItalic = val.isItalic;\r\n                    textToolSettings.font = val.font;\r\n                    textToolSettings.opacity = val.opacity;\r\n\r\n                    let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                    klCanvas.text(layerIndex, {\r\n                        textStr: val.textStr,\r\n                        x: val.x,\r\n                        y: val.y,\r\n                        size: val.size,\r\n                        font: val.font,\r\n                        align: val.align,\r\n                        isBold: val.isBold,\r\n                        isItalic: val.isItalic,\r\n                        angleRad: angleRad,\r\n                        color: BB.ColorConverter.toRgbaStr(colorRGBA)\r\n                    });\r\n                    klCanvasWorkspace.requestFrame();\r\n                }\r\n            });\r\n\r\n        },\r\n        onShape: function(typeStr, canvasX, canvasY, angleRad) {\r\n            if (typeStr === 'down') {\r\n                shapeTool.onDown(canvasX, canvasY, angleRad);\r\n            }\r\n            if (typeStr === 'move') {\r\n                shapeTool.onMove(canvasX, canvasY);\r\n            }\r\n            if (typeStr === 'up') {\r\n                shapeTool.onUp(canvasX, canvasY);\r\n            }\r\n        },\r\n\r\n        onViewChange: function(viewChangeObj) {\r\n\r\n            if (viewChangeObj.changed.includes('scale')) {\r\n                statusOverlay.out({\r\n                    type: 'transform',\r\n                    scale: viewChangeObj.scale,\r\n                    angleDeg: viewChangeObj.angle * 180 / Math.PI\r\n                });\r\n            }\r\n\r\n            toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== klCanvasWorkspace.getMaxScale());\r\n            toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== klCanvasWorkspace.getMinScale());\r\n\r\n            handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\r\n        },\r\n        onUndo: function() {\r\n            if (klHistory.canUndo()) {\r\n                if (undoRedoCatchup.undo()) {\r\n                    statusOverlay.out(LANG('undo'), true);\r\n                }\r\n            }\r\n        },\r\n        onRedo: function() {\r\n            if (klHistory.canRedo()) {\r\n                if (undoRedoCatchup.redo()) {\r\n                    statusOverlay.out(LANG('redo'), true);\r\n                }\r\n            }\r\n        },\r\n    });\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, event, comboStr) {\r\n            if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n\r\n            let isDrawing = lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\r\n            if (isDrawing) {\r\n                return;\r\n            }\r\n\r\n            if (comboStr === 'plus') {\r\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n            }\r\n            if (comboStr === 'minus') {\r\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n            }\r\n            if (comboStr === 'home') {\r\n                klCanvasWorkspace.fitView();\r\n            }\r\n            if (comboStr === 'end') {\r\n                klCanvasWorkspace.resetView(true);\r\n            }\r\n            if (['ctrl+z', 'cmd+z'].includes(comboStr)) {\r\n                event.preventDefault();\r\n                undoRedoCatchup.undo();\r\n            }\r\n            if (\r\n                ['ctrl+y', 'cmd+y'].includes(comboStr) ||\r\n                (\r\n                    (\r\n                        BB.sameKeys('ctrl+shift+z', comboStr) ||\r\n                        BB.sameKeys('cmd+shift+z', comboStr)\r\n                    ) && keyStr === 'z'\r\n                )\r\n            ) {\r\n                event.preventDefault();\r\n                undoRedoCatchup.redo();\r\n            }\r\n            if (!pOptions.embed) {\r\n                if (['ctrl+s', 'cmd+s'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    saveToComputer.save();\r\n                }\r\n                if (['ctrl+shift+s', 'cmd+shift+s'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n\r\n                    (async () => {\r\n                        let success = true;\r\n                        try {\r\n                            await projectStore.store(klCanvas.getProject());\r\n                        } catch (e) {\r\n                            success = false;\r\n                            setTimeout(() => {\r\n                                throw new Error('keyboard-shortcut: failed to store browser storage, ' + e);\r\n                            }, 0);\r\n                            statusOverlay.out(' ' + LANG('file-storage-failed'), true);\r\n                        }\r\n                        if (success) {\r\n                            pOptions.saveReminder.reset();\r\n                            statusOverlay.out(LANG('file-storage-stored'), true);\r\n                        }\r\n                    })();\r\n                }\r\n                if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    copyToClipboard(true);\r\n                }\r\n            }\r\n            if (['ctrl+a', 'cmd+a'].includes(comboStr)) {\r\n                event.preventDefault();\r\n            }\r\n\r\n\r\n            if (keyListener.comboOnlyContains(['left', 'right', 'up', 'down'])) {\r\n                if (keyStr === 'left') {\r\n                    klCanvasWorkspace.translateView(1, 0);\r\n                }\r\n                if (keyStr === 'right') {\r\n                    klCanvasWorkspace.translateView(-1, 0);\r\n                }\r\n                if (keyStr === 'up') {\r\n                    klCanvasWorkspace.translateView(0, 1);\r\n                }\r\n                if (keyStr === 'down') {\r\n                    klCanvasWorkspace.translateView(0, -1);\r\n                }\r\n            }\r\n\r\n\r\n            if (['r+left','r+right'].includes(comboStr)) {\r\n                if (keyStr === 'left') {\r\n                    klCanvasWorkspace.setAngle(-15, true);\r\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n                }\r\n                if (keyStr === 'right') {\r\n                    klCanvasWorkspace.setAngle(15, true);\r\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n                }\r\n            }\r\n            if (['r+up'].includes(comboStr)) {\r\n                klCanvasWorkspace.setAngle(0);\r\n                handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n            }\r\n\r\n\r\n            if (comboStr === 'sqbr_open') {\r\n                currentBrush.decreaseSize(0.03 / klCanvasWorkspace.getScale());\r\n            }\r\n            if (comboStr === 'sqbr_close') {\r\n                currentBrush.increaseSize(0.03 / klCanvasWorkspace.getScale());\r\n            }\r\n            if (comboStr === 'enter') {\r\n                klCanvas.layerFill(klCanvas.getLayerIndex(currentLayerCtx.canvas), klColorSlider.getColor());\r\n                statusOverlay.out(LANG('filled'), true);\r\n            }\r\n            if (['delete', 'backspace'].includes(comboStr)) {\r\n                let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                if (layerIndex === 0 && !brushUiObj.eraserBrush.getIsTransparentBg()) {\r\n                    klCanvas.layerFill(layerIndex, {r: 255, g: 255, b: 255}, 'source-in');\r\n                } else {\r\n                    klCanvas.clearLayer(layerIndex);\r\n                }\r\n                statusOverlay.out(LANG('cleared-layer'), true);\r\n            }\r\n            if (comboStr === 'e') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('draw');\r\n                toolspaceToolRow.setActive('draw');\r\n                mainTabRow.open('draw');\r\n                updateMainTabVisibility();\r\n                brushTabRow.open('eraserBrush');\r\n            }\r\n            if (comboStr === 'b') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('draw');\r\n                toolspaceToolRow.setActive('draw');\r\n                mainTabRow.open('draw');\r\n                updateMainTabVisibility();\r\n                brushTabRow.open(lastNonEraserBrushId);\r\n            }\r\n            if (comboStr === 'g') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('fill');\r\n                toolspaceToolRow.setActive('fill');\r\n                mainTabRow.open('fill');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 't') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('text');\r\n                toolspaceToolRow.setActive('text');\r\n                mainTabRow.open('text');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 'u') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('shape');\r\n                toolspaceToolRow.setActive('shape');\r\n                mainTabRow.open('shape');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 'x') {\r\n                event.preventDefault();\r\n                klColorSlider.swapColors();\r\n            }\r\n\r\n\r\n        },\r\n        onUp: function(keyStr, event) {\r\n        }\r\n    });\r\n\r\n    /**\r\n     *\r\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\r\n     * @param filename - string e.g. 'drawing.psd'\r\n     * @param optionStr? - 'default' | 'layer' | 'image'\r\n     */\r\n    function importFinishedLoading(\r\n        importedImage: IKlPsd | {\r\n            type: 'image';\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLCanvasElement | HTMLImageElement;\r\n        },\r\n        filename: string,\r\n        optionStr: 'default' | 'layer' | 'image',\r\n    ) {\r\n        if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                type: \"error\",\r\n                message: LANG('import-broken-file'),\r\n                buttons: [\"Ok\"],\r\n            });\r\n            return;\r\n        }\r\n\r\n        function getResizedDimensions(width, height) {\r\n            let w = parseInt(width);\r\n            let h = parseInt(height);\r\n            if (w > klMaxCanvasSize) {\r\n                h = klMaxCanvasSize / w * h;\r\n                w = klMaxCanvasSize;\r\n            }\r\n            if (h > klMaxCanvasSize) {\r\n                w = klMaxCanvasSize / h * w;\r\n                h = klMaxCanvasSize;\r\n            }\r\n            w = parseInt('' + w);\r\n            h = parseInt('' + h);\r\n            return {\r\n                width: w,\r\n                height: h\r\n            }\r\n        }\r\n\r\n        function importAsImage(canvas) {\r\n            let resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\r\n\r\n            //resize first\r\n            let tempCanvas = BB.canvas(canvas.width, canvas.height);\r\n            let tempCanvasCtx = tempCanvas.getContext('2d');\r\n            tempCanvasCtx.drawImage(canvas, 0, 0);\r\n\r\n            BB.resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\r\n\r\n            klCanvas.reset({\r\n                width: resizedDimensions.width,\r\n                height: resizedDimensions.height,\r\n                image: tempCanvas,\r\n                layerName: filename\r\n            });\r\n\r\n            layerManager.update(0);\r\n            setCurrentLayer(klCanvas.getLayer(0));\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n            isFirstImage = false;\r\n        }\r\n\r\n        /**\r\n         *\r\n         * @param convertedPsdObj - if flattened then without layers\r\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\r\n         */\r\n        function importAsImagePsd(convertedPsdObj: IKlPsd, cropObj?) {\r\n\r\n            // crop\r\n            function crop(targetCanvas, cropCanvas, cropObj) {\r\n                cropCanvas.width = cropCanvas.width;\r\n                cropCanvas.getContext('2d').drawImage(targetCanvas, -cropObj.x, -cropObj.y);\r\n                targetCanvas.width = cropObj.width;\r\n                targetCanvas.height = cropObj.height;\r\n                targetCanvas.getContext('2d').drawImage(cropCanvas, 0, 0);\r\n            }\r\n            if (cropObj && (cropObj.width !== convertedPsdObj.width ||cropObj.height !== convertedPsdObj.height)) {\r\n                let cropCanvas = BB.canvas(cropObj.width, cropObj.height);\r\n                convertedPsdObj.width = cropObj.width;\r\n                convertedPsdObj.height = cropObj.height;\r\n\r\n                if (!convertedPsdObj.layers) {\r\n                    crop(convertedPsdObj.canvas, cropCanvas, cropObj);\r\n                }\r\n                if (convertedPsdObj.layers) {\r\n                    for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                        let item = convertedPsdObj.layers[i];\r\n                        crop(item.image, cropCanvas, cropObj);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // resize\r\n            let resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\r\n            convertedPsdObj.width = resizedDimensions.width;\r\n            convertedPsdObj.height = resizedDimensions.height;\r\n            if (!convertedPsdObj.layers) {\r\n                BB.resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\r\n            }\r\n            if (convertedPsdObj.layers) {\r\n                for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                    let item = convertedPsdObj.layers[i];\r\n                    BB.resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\r\n                }\r\n            }\r\n\r\n            let layerIndex;\r\n            if (convertedPsdObj.layers) {\r\n                layerIndex = klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    layers: convertedPsdObj.layers\r\n                });\r\n            } else {\r\n                layerIndex = klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    image: convertedPsdObj.canvas\r\n                });\r\n            }\r\n            layerManager.update(layerIndex);\r\n            setCurrentLayer(klCanvas.getLayer(layerIndex));\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n            isFirstImage = false;\r\n        }\r\n\r\n        function importAsLayer(canvas) {\r\n            KL.showImportAsLayerDialog({\r\n                target: klRootEl,\r\n                klCanvas: klCanvas,\r\n                importImage: canvas,\r\n                callback: function(transformObj, isPixelated: boolean) {\r\n                    if (!transformObj) {\r\n                        return;\r\n                    }\r\n\r\n                    klHistory.pause(true);\r\n                    klCanvas.addLayer();\r\n                    let layers = klCanvas.getLayers();\r\n                    let activeLayerIndex = layers.length - 1;\r\n                    if (filename) {\r\n                        klCanvas.renameLayer(activeLayerIndex, filename);\r\n                    }\r\n                    let activeLayerContext = klCanvas.getLayerContext(activeLayerIndex);\r\n                    BB.drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, null, isPixelated);\r\n                    setCurrentLayer(klCanvas.getLayer(activeLayerIndex));\r\n                    layerManager.update(activeLayerIndex);\r\n\r\n                    klHistory.pause(false);\r\n\r\n                    klHistory.push({\r\n                        tool: [\"misc\"],\r\n                        action: \"importImage\",\r\n                        params: [BB.copyCanvas(activeLayerContext.canvas), filename]\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n\r\n        if (optionStr === 'default' || !optionStr) {\r\n            KL.showImportImageDialog({\r\n                image: importedImage,\r\n                target: klRootEl,\r\n                maxSize: klMaxCanvasSize,\r\n                callback: function(res) {\r\n                    if (res.type === 'as-image') {\r\n                        importAsImage(res.image);\r\n                    } else if (res.type === 'as-image-psd') {\r\n                        importAsImagePsd(res.image, res.cropObj);\r\n                    } else if (res.type === 'as-layer') {\r\n                        importAsLayer(res.image);\r\n                    } else if (res.type === 'cancel') {\r\n                        // nothing to do\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        if (optionStr === 'layer') {\r\n            importAsLayer(importedImage.canvas);\r\n        }\r\n        if (optionStr === 'image') {\r\n            if (importedImage.type === 'psd') {\r\n                importAsImagePsd(importedImage);\r\n            } else {\r\n                importAsImage(importedImage.canvas);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    function onPaste(e) {\r\n        if (KL.dialogCounter.get() > 0) {\r\n            return;\r\n        }\r\n\r\n        function retrieveImageFromClipboardAsBlob(pasteEvent, callback) {\r\n            if (pasteEvent.clipboardData == false) {\r\n                if (typeof (callback) == \"function\") {\r\n                    callback(undefined);\r\n                }\r\n            }\r\n\r\n            let items = pasteEvent.clipboardData.items;\r\n\r\n            if (items == undefined) {\r\n                if (typeof (callback) == \"function\") {\r\n                    callback(undefined);\r\n                }\r\n            } else {\r\n                for (let i = 0; i < items.length; i++) {\r\n                    if (items[i].type.indexOf(\"image\") == -1) {\r\n                        continue;\r\n                    }\r\n                    let blob = items[i].getAsFile();\r\n\r\n                    if (typeof (callback) == \"function\") {\r\n                        callback(blob);\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (e.clipboardData.files[0]) {\r\n            retrieveImageFromClipboardAsBlob(e, function (imageBlob) {\r\n                // If there's an image, display it in the canvas\r\n                if (imageBlob) {\r\n                    let img = new Image();\r\n                    img.onload = function () {\r\n                        URL.revokeObjectURL(img.src);\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img\r\n                        }, null, 'default');\r\n                    };\r\n                    let URLObj = window.URL || window.webkitURL;\r\n                    img.src = URLObj.createObjectURL(imageBlob);\r\n                }\r\n            });\r\n        } else if (e.clipboardData.items[0]) {\r\n            e.clipboardData.items[0].getAsString(function(pasteStr) {\r\n                pasteStr = pasteStr.trim();\r\n                if (pasteStr.match(/^https?/)) {\r\n                    // url\r\n                    let img = new Image();\r\n                    img.onload = function () {\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img\r\n                        }, null, 'default');\r\n                    };\r\n                    img.onerror = function (e) {\r\n                        console.log('error loading', e);\r\n                    };\r\n                    img.crossOrigin = 'Anonymous';\r\n                    img.src = pasteStr;\r\n\r\n                } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\r\n                    // url\r\n                    let rgbObj = BB.ColorConverter.hexToRGB(pasteStr.replace('#', ''));\r\n                    brushSettingService.setColor(rgbObj);\r\n                }\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    function handleFileSelect(files, optionStr) {\r\n\r\n        function showWarningPsdFlattened() {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                type: \"warning\",\r\n                message: LANG('import-psd-unsupported') + \"<br /><br />\",\r\n                buttons: [\"Ok\"],\r\n            });\r\n        }\r\n\r\n        let hasUnsupportedFile = false;\r\n        for (let i = 0, file; file = files[i]; i++) {\r\n            let extension = file.name.split(\".\");\r\n            extension = extension[extension.length - 1].toLowerCase();\r\n            if (extension === \"psd\") {\r\n\r\n                (function(f) {\r\n                    let loaderSizeBytes = 1024 * 1024 * 25; // 25mb\r\n                    let maxSizeBytes = 1024 * 1024 * 1024; // 1gb\r\n                    let maxResolution = 4096;\r\n\r\n                    if (f.size >= maxSizeBytes) { // pretty likely to break stuff\r\n                        KL.popup({\r\n                            target: klRootEl,\r\n                            type: \"error\",\r\n                            message: \"File too big. Unable to import.<br /><br />\",\r\n                            buttons: [\"Ok\"],\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    let doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\r\n                    let loaderIsOpen = true;\r\n                    let closeLoader;\r\n\r\n                    if (doShowLoader) {\r\n                        KL.popup({\r\n                            target: klRootEl,\r\n                            message: LANG('import-opening'),\r\n                            callback: function (result) {\r\n                                loaderIsOpen = false;\r\n                                closeLoader = null;\r\n                            },\r\n                            closefunc: function (f) {\r\n                                closeLoader = f;\r\n                            }\r\n                        });\r\n                    }\r\n\r\n\r\n                    let reader = new FileReader();\r\n                    reader.onload = function (readerResult) {\r\n\r\n                        KL.loadAgPsd().then(function(agPsdLazy) {\r\n\r\n                            if (doShowLoader && !loaderIsOpen) {\r\n                                return;\r\n                            }\r\n\r\n                            try {\r\n                                let psd;\r\n\r\n                                // first pass, only read metadata\r\n                                psd = agPsdLazy.readPsd(\r\n                                    (readerResult.target.result as any),\r\n                                    {\r\n                                        skipLayerImageData: true,\r\n                                        skipThumbnail: true,\r\n                                        skipCompositeImageData: true\r\n                                    });\r\n                                if (psd.width > maxResolution || psd.height > maxResolution) {\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    KL.popup({\r\n                                        target: klRootEl,\r\n                                        type: \"error\",\r\n                                        //message: \"Image exceeds maximum dimensions of \" + maxResolution + \" x \" + maxResolution + \" pixels. Unable to import.\"\r\n                                        message: LANG('import-psd-too-large').replace(/{x}/g, '' + maxResolution)\r\n                                            + \"<br /><br />\"\r\n                                            + LANG('import-psd-size') + \": \" + psd.width + \" x \" + psd.height + ' pixels'\r\n                                            + \"<br /><br />\"\r\n                                        ,\r\n                                        buttons: [\"Ok\"],\r\n                                    });\r\n                                    return;\r\n                                }\r\n\r\n\r\n                                // second pass, now load actual data.\r\n                                psd = null;\r\n\r\n                                try {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any));\r\n                                } catch (e) {\r\n                                    //console.log('failed regular psd import', e);\r\n                                }\r\n                                if (psd) {\r\n                                    //console.log('psd', psd);\r\n                                    let convertedPsd = KL.PSD.readPsd(psd);\r\n                                    //console.log('converted', convertedPsd);\r\n                                    if (optionStr === 'image' && convertedPsd.error) {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    importFinishedLoading(convertedPsd, f.name, optionStr);\r\n                                } else {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any), { skipLayerImageData: true, skipThumbnail: true });\r\n                                    if (optionStr === 'image') {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    importFinishedLoading({\r\n                                        type: 'psd',\r\n                                        width: psd.width,\r\n                                        height: psd.height,\r\n                                        canvas: psd.canvas,\r\n                                        error: true\r\n                                    }, f.name, optionStr);\r\n                                }\r\n\r\n\r\n                            } catch (e) {\r\n                                if (closeLoader) {\r\n                                    closeLoader();\r\n                                }\r\n                                KL.popup({\r\n                                    target: klRootEl,\r\n                                    type: \"error\",\r\n                                    message: \"Failed to load PSD.<br /><br />\",\r\n                                    buttons: [\"Ok\"],\r\n                                });\r\n                            }\r\n                        }).catch(() => {\r\n                            closeLoader();\r\n                            alert('Error: failed to load PSD library');\r\n                        });\r\n\r\n                    };\r\n                    reader.readAsArrayBuffer(f);\r\n                })(file);\r\n\r\n            } else if (file.type.match('image.*')) {\r\n                (function (f) {\r\n                    window.URL = window.URL || window.webkitURL;\r\n                    let url = window.URL.createObjectURL(f);\r\n                    let im = new Image();\r\n                    im.src = url;\r\n                    BB.loadImage(im, function () {\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: im.width,\r\n                            height: im.height,\r\n                            canvas: im\r\n                        }, f.name, optionStr);\r\n                    });\r\n                })(file);\r\n            } else {\r\n                hasUnsupportedFile = true;\r\n            }\r\n        }\r\n        if (hasUnsupportedFile) {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                message: LANG('import-unsupported-file'),\r\n                type: 'error',\r\n                buttons: ['OK'],\r\n            });\r\n        }\r\n    }\r\n\r\n    if (!pOptions.embed) {\r\n        new KL.KlImageDropper({\r\n            target: document.body,\r\n            onDrop: function(files, optionStr) {\r\n                if (KL.dialogCounter.get() > 0) {\r\n                    return;\r\n                }\r\n                handleFileSelect(files, optionStr);\r\n            },\r\n            enabledTest: function() {\r\n                return KL.dialogCounter.get() === 0;\r\n            }\r\n        });\r\n\r\n        BB.addEventListener(window, 'paste', onPaste, false);\r\n    }\r\n\r\n    const brushUiObj: any = {};\r\n\r\n    // create brush UIs\r\n    for (let b in KL.brushesUI) {\r\n        if (KL.brushesUI.hasOwnProperty(b)) {\r\n            let ui = new KL.brushesUI[b].Ui({\r\n                onSizeChange: sizeWatcher,\r\n                onOpacityChange: function(opacity) {\r\n                    brushSettingService.emitOpacity(opacity);\r\n                },\r\n                onConfigChange: () => {\r\n                    brushSettingService.emitSliderConfig({\r\n                        sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                        opacitySlider: KL.brushesUI[currentBrushId].opacitySlider\r\n                    });\r\n                }\r\n            });\r\n            brushUiObj[b] = ui;\r\n            ui.getElement().style.padding = 10 + 'px';\r\n        }\r\n    }\r\n\r\n\r\n    BB.css(klRootEl, {\r\n        position: 'absolute',\r\n        left: '0',\r\n        top: '0',\r\n        right: '0',\r\n        bottom: '0'\r\n    });\r\n\r\n    let statusOverlay = new KL.StatusOverlay();\r\n\r\n    const toolspace = BB.el({});\r\n    const toolspaceInner = BB.el({\r\n        parent: toolspace,\r\n    });\r\n    toolspace.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n    toolspace.onclick = BB.handleClick;\r\n\r\n\r\n    let toolspaceCollapser = new KL.ToolspaceCollapser({\r\n        onChange: function() {\r\n            updateCollapse();\r\n        }\r\n    });\r\n    function updateCollapse() {\r\n\r\n        //collapser\r\n        if (uiWidth < collapseThreshold) {\r\n            toolspaceCollapser.getElement().style.display = 'block';\r\n\r\n            toolspaceCollapser.setDirection(uiState);\r\n            if (toolspaceCollapser.isOpen()) {\r\n                if (uiState === 'left') {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '271px',\r\n                        right: '',\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '271px'\r\n                    });\r\n                } else {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '271px'\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                }\r\n                toolspace.style.display = 'block';\r\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\r\n                statusOverlay.setWide(false);\r\n\r\n            } else {\r\n                if (uiState === 'left') {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '0',\r\n                        right: '',\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                } else {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '0'\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                }\r\n                toolspace.style.display = 'none';\r\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth), uiHeight);\r\n                statusOverlay.setWide(true);\r\n\r\n            }\r\n\r\n        } else {\r\n            toolspaceCollapser.getElement().style.display = 'none';\r\n            if (uiState === 'left') {\r\n                BB.css(klCanvasWorkspace.getElement(), {\r\n                    left: '271px'\r\n                });\r\n            } else {\r\n                BB.css(klCanvasWorkspace.getElement(), {\r\n                    left: '0'\r\n                });\r\n            }\r\n            toolspace.style.display = 'block';\r\n            klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\r\n            statusOverlay.setWide(false);\r\n\r\n        }\r\n    }\r\n    updateCollapse();\r\n\r\n    function updateUi() {\r\n        if (uiState === 'left') {\r\n            BB.css(toolspace, {\r\n                left: '0',\r\n                right: '',\r\n                borderLeft: 'none',\r\n                borderRight: '1px solid rgb(135, 135, 135)'\r\n            });\r\n            BB.css(klCanvasWorkspace.getElement(), {\r\n                left: '271px'\r\n            });\r\n        } else {\r\n            BB.css(toolspace, {\r\n                left: '',\r\n                right: '0',\r\n                borderLeft: '1px solid rgb(135, 135, 135)',\r\n                borderRight: 'none'\r\n            });\r\n            BB.css(klCanvasWorkspace.getElement(), {\r\n                left: '0'\r\n            });\r\n        }\r\n        statusOverlay.setUiState(uiState);\r\n        layerPreview.setUiState('' + uiState);\r\n        layerManager.setUiState('' + uiState);\r\n        updateCollapse();\r\n        toolspaceScroller.updateUiState(uiState);\r\n    }\r\n\r\n\r\n\r\n    let overlayToolspace;\r\n    setTimeout(function() {\r\n        overlayToolspace = new KL.OverlayToolspace({\r\n            enabledTest: function() {\r\n                return KL.dialogCounter.get() === 0 && !lineSanitizer.getIsDrawing();\r\n            },\r\n            brushSettingService,\r\n        });\r\n        klRootEl.appendChild(overlayToolspace.getElement());\r\n    }, 0);\r\n\r\n    BB.append(klRootEl, [klCanvasWorkspace.getElement(), toolspace, toolspaceCollapser.getElement()]);\r\n\r\n    BB.css(toolspace, {\r\n        position: \"absolute\",\r\n        right: '0',\r\n        top: '0',\r\n        bottom: '0',\r\n        width: (toolWidth - 1) + \"px\",\r\n\r\n        overflow: \"hidden\",\r\n        backgroundColor: \"#ddd\",\r\n        borderLeft: \"1px solid rgb(135, 135, 135)\",\r\n        userSelect: 'none',\r\n        touchAction: 'none'\r\n    });\r\n\r\n    let toolspaceTopRow;\r\n    if (pOptions.embed) {\r\n        toolspaceTopRow = new ToolspaceTopRow({\r\n            onHelp: () => {\r\n                showIframePopup(pOptions.embed.url + '/help.html', !!pOptions.embed);\r\n            },\r\n            onSubmit: () => {\r\n                KL.popup({\r\n                    target: klRootEl,\r\n                    message: LANG('submit-prompt'),\r\n                    buttons: [LANG('submit'), 'Cancel'],\r\n                    callback: async (result) => {\r\n                        if (result !== LANG('submit')) {\r\n                            return;\r\n                        }\r\n\r\n                        let overlay = BB.el({\r\n                            parent: klRootEl,\r\n                            className: 'upload-overlay',\r\n                            content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\r\n                        });\r\n\r\n                        pOptions.embed.onSubmit(\r\n                            () => {\r\n                                pOptions.saveReminder.reset();\r\n                                klRootEl.removeChild(overlay);\r\n                            },\r\n                            () => {\r\n                                klRootEl.removeChild(overlay);\r\n                            });\r\n                    }\r\n                });\r\n            },\r\n            onLeftRight: () => {\r\n                uiState = uiState === 'left' ? 'right' : 'left';\r\n                updateUi();\r\n            },\r\n        });\r\n    } else {\r\n        toolspaceTopRow = new KL.ToolspaceTopRow({\r\n            logoImg: pOptions.logoImg,\r\n            onLogo: function() {\r\n                showIframePopup('./home/', !!pOptions.embed);\r\n            },\r\n            onNew: function() {\r\n                showNewImageDialog();\r\n            },\r\n            onImport: function() {\r\n                fileTab.triggerImport();\r\n            },\r\n            onSave: function() {\r\n                saveToComputer.save();\r\n            },\r\n            onShare: function() {\r\n                shareImage();\r\n            },\r\n            onHelp: function() {\r\n                showIframePopup('./help/', !!pOptions.embed);\r\n            },\r\n        });\r\n    }\r\n    toolspaceTopRow.getElement().classList.add('toolspace-row-shadow');\r\n    toolspaceTopRow.getElement().style.marginBottom = '10px';\r\n    toolspaceInner.appendChild(toolspaceTopRow.getElement());\r\n\r\n    let toolspaceToolRow = new KL.ToolspaceToolRow({\r\n        onActivate: function(activeStr) {\r\n            if (activeStr === 'draw') {\r\n                klCanvasWorkspace.setMode('draw');\r\n            } else if (activeStr === 'hand') {\r\n                klCanvasWorkspace.setMode('hand');\r\n            } else if (activeStr === 'fill') {\r\n                klCanvasWorkspace.setMode('fill');\r\n            } else if (activeStr === 'text') {\r\n                klCanvasWorkspace.setMode('text');\r\n            } else if (activeStr === 'shape') {\r\n                klCanvasWorkspace.setMode('shape');\r\n            } else {\r\n                throw new Error('unknown activeStr');\r\n            }\r\n            mainTabRow.open(activeStr);\r\n            updateMainTabVisibility();\r\n            klColorSlider.pickingDone();\r\n        },\r\n        onZoomIn: function() {\r\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n        },\r\n        onZoomOut: function() {\r\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n        },\r\n        onUndo: function() {\r\n            undoRedoCatchup.undo();\r\n        },\r\n        onRedo: function() {\r\n            undoRedoCatchup.redo();\r\n        }\r\n    });\r\n    toolspaceToolRow.setIsSmall(uiHeight < 540);\r\n    klHistory.addListener(function() {\r\n        toolspaceToolRow.setEnableUndo(klHistory.canUndo());\r\n        toolspaceToolRow.setEnableRedo(klHistory.canRedo());\r\n    });\r\n    toolspaceToolRow.getElement().classList.add('toolspace-row-shadow');\r\n    toolspaceInner.appendChild(toolspaceToolRow.getElement());\r\n\r\n    let klColorSlider;\r\n\r\n    function setCurrentBrush(brushId) {\r\n        if (brushId !== 'eraserBrush') {\r\n            lastNonEraserBrushId = brushId;\r\n        }\r\n\r\n        if (klColorSlider) {\r\n            if (brushId === 'eraserBrush') {\r\n                klColorSlider.enable(false);\r\n            } else {\r\n                klColorSlider.enable(true);\r\n            }\r\n        }\r\n\r\n        currentBrushId = brushId;\r\n        currentBrush = brushUiObj[brushId];\r\n        currentBrush.setColor(currentColor);\r\n        currentBrush.setContext(currentLayerCtx);\r\n        klCanvasWorkspace.setMode('draw');\r\n        toolspaceToolRow.setActive('draw');\r\n        updateMainTabVisibility();\r\n    }\r\n\r\n    function setCurrentLayer(layer) { //BrushContext(p_context) {\r\n        currentLayerCtx = layer.context;\r\n        currentBrush.setContext(layer.context);\r\n        layerPreview.setLayer(layer);\r\n    }\r\n\r\n    function setBrushColor(p_color) {\r\n        currentColor = p_color;\r\n        currentBrush.setColor(p_color);\r\n        brushSettingService.emitColor(p_color);\r\n        klColorSlider.pickingDone();\r\n    }\r\n\r\n    klColorSlider = new KL.KlColorSlider({\r\n        width: 250,\r\n        height: 30,\r\n        svHeight: 100,\r\n        startValue: new BB.RGB(0, 0, 0),\r\n        onPick: setBrushColor\r\n    });\r\n    klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\r\n    klColorSlider.setPickCallback(function (doPick) {\r\n\r\n        if (doPick) {\r\n            klCanvasWorkspace.setMode('pick');\r\n        } else {\r\n            klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\r\n            updateMainTabVisibility();\r\n        }\r\n\r\n    });\r\n    let brushDiv = document.createElement(\"div\");\r\n    let colorDiv = document.createElement(\"div\");\r\n    BB.css(colorDiv, {\r\n        margin: '10px',\r\n        display: 'flex',\r\n        flexWrap: 'wrap',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'flex-end'\r\n    });\r\n    let toolspaceStabilizerRow = new KL.ToolspaceStabilizerRow({\r\n        smoothing: 1,\r\n        onSelect: function(v) {\r\n            lineSmoothing.setSmoothing(translateSmoothing(v));\r\n        }\r\n    });\r\n\r\n\r\n    brushDiv.appendChild(colorDiv);\r\n    BB.append(\r\n        colorDiv,\r\n        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n    );\r\n\r\n    let brushTabRow = new KL.TabRow({\r\n        initialId: 'penBrush',\r\n        useAccent: true,\r\n        tabArr: (function () {\r\n            let result = [];\r\n\r\n            function createTab(keyStr) {\r\n                return {\r\n                    id: keyStr,\r\n                    image: KL.brushesUI[keyStr].image,\r\n                    title: KL.brushesUI[keyStr].tooltip,\r\n                    onOpen: function() {\r\n                        brushUiObj[keyStr].getElement().style.display = 'block';\r\n                        setCurrentBrush(keyStr);\r\n                        klColorSlider.pickingDone();\r\n                        brushSettingService.emitSliderConfig({\r\n                            sizeSlider: KL.brushesUI[keyStr].sizeSlider,\r\n                            opacitySlider: KL.brushesUI[keyStr].opacitySlider\r\n                        });\r\n                        sizeWatcher(brushUiObj[keyStr].getSize());\r\n                        brushSettingService.emitOpacity(brushUiObj[keyStr].getOpacity());\r\n                    },\r\n                    onClose: function() {\r\n                        brushUiObj[keyStr].getElement().style.display = 'none';\r\n                    }\r\n                };\r\n            }\r\n\r\n            let keyArr = Object.keys(brushUiObj);\r\n            for (let i = 0; i < keyArr.length; i++) {\r\n                result.push(createTab(keyArr[i]));\r\n            }\r\n            return result;\r\n        })()\r\n    });\r\n    brushDiv.appendChild(brushTabRow.getElement());\r\n    for (let b in KL.brushesUI) {\r\n        if (KL.brushesUI.hasOwnProperty(b)) {\r\n            brushDiv.appendChild(brushUiObj[b].getElement());\r\n        }\r\n    }\r\n\r\n    const handUi = new KL.HandUi({\r\n        scale: 1,\r\n        angleDeg: 0,\r\n        onReset: function() {\r\n            klCanvasWorkspace.resetView(true);\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n        onFit: function() {\r\n            klCanvasWorkspace.fitView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n        onAngleChange: function(angleDeg, isRelative) {\r\n            klCanvasWorkspace.setAngle(angleDeg, isRelative);\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n    });\r\n\r\n    let fillUi = new KL.FillUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let textUi = new KL.TextUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let shapeUi = new KL.ShapeUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let shapeTool = new KL.ShapeTool({\r\n        onShape: function(isDone, x1, y1, x2, y2, angleRad) {\r\n\r\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n\r\n            let shapeObj: any = {\r\n                type: shapeUi.getShape(),\r\n                x1: x1,\r\n                y1: y1,\r\n                x2: x2,\r\n                y2: y2,\r\n                angleRad: angleRad,\r\n                isOutwards: shapeUi.getIsOutwards(),\r\n                opacity: shapeUi.getOpacity(),\r\n                isEraser: shapeUi.getIsEraser()\r\n            };\r\n            if (shapeUi.getShape() === 'line') {\r\n                shapeObj.strokeRgb = klColorSlider.getColor();\r\n                shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed('shift');\r\n            } else {\r\n                shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed('shift');\r\n                if (shapeUi.getMode() === 'stroke') {\r\n                    shapeObj.strokeRgb = klColorSlider.getColor();\r\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                } else {\r\n                    shapeObj.fillRgb = klColorSlider.getColor();\r\n                }\r\n            }\r\n\r\n            if (isDone) {\r\n                klCanvas.setComposite(layerIndex, null);\r\n                klCanvas.drawShape(layerIndex, shapeObj);\r\n            } else {\r\n                klCanvas.setComposite(layerIndex, {\r\n                    draw: function(ctx) {\r\n                        KL.drawShape(ctx, shapeObj);\r\n                    }\r\n                });\r\n            }\r\n            klCanvasWorkspace.requestFrame();\r\n\r\n        }\r\n    });\r\n\r\n    const layerManager = KL.klLayerManager(klCanvas, function (val) {\r\n        setCurrentLayer(klCanvas.getLayer(val));\r\n        klHistory.push({\r\n            tool: [\"misc\"],\r\n            action: \"focusLayer\",\r\n            params: [val]\r\n        });\r\n    }, klRootEl) as any;\r\n    const layerPreview = new KL.LayerPreview({\r\n        klRootEl: klRootEl,\r\n        onClick: function () {\r\n            mainTabRow.open('layers');\r\n        }\r\n    });\r\n    layerPreview.setIsVisible(uiHeight >= 579);\r\n    layerPreview.setLayer(klCanvas.getLayer(klCanvas.getLayerIndex(currentLayerCtx.canvas)));\r\n\r\n    const filterTab = new KL.FilterTab(\r\n        klRootEl,\r\n        klColorSlider,\r\n        layerManager,\r\n        // setCurrentLayer,\r\n        klCanvasWorkspace,\r\n        handUi,\r\n        () => { //get current color\r\n            return currentColor;\r\n        },\r\n        () => { // get max canvas size\r\n            return klMaxCanvasSize;\r\n        },\r\n        () => { // get kl canvas\r\n            return klCanvas;\r\n        },\r\n        () => { // get current layer ctx\r\n            return currentLayerCtx;\r\n        },\r\n        !!pOptions.embed,\r\n        statusOverlay,\r\n    );\r\n\r\n    const undoRedoCatchup = new KL.UndoRedoCatchup(\r\n        brushUiObj,\r\n        layerPreview,\r\n        layerManager,\r\n        handUi,\r\n        klCanvasWorkspace,\r\n        () => {\r\n            if (!initState) {\r\n                throw new Error('initState not initialized');\r\n            }\r\n            return initState;\r\n        },\r\n        () => klCanvas,\r\n        () => currentLayerCtx,\r\n        (clctx) => {\r\n            currentLayerCtx = clctx;\r\n        },\r\n        () => currentBrush,\r\n    );\r\n    klHistory.addListener((p) => {\r\n        undoRedoCatchup.catchup(p);\r\n    });\r\n\r\n    function showNewImageDialog() {\r\n        KL.newImageDialog({\r\n            currentColor: currentColor,\r\n            secondaryColor: klColorSlider.getSecondaryRGB(),\r\n            maxCanvasSize: klMaxCanvasSize,\r\n            canvasWidth: klCanvas.getWidth(),\r\n            canvasHeight: klCanvas.getHeight(),\r\n            workspaceWidth: window.innerWidth < collapseThreshold ? uiWidth : uiWidth - toolWidth,\r\n            workspaceHeight: uiHeight,\r\n            onConfirm: function(width, height, color) {\r\n                klCanvas.reset({\r\n                    width: width,\r\n                    height: height,\r\n                    color: color.a === 1 ? color : null\r\n                });\r\n\r\n                layerManager.update(0);\r\n                setCurrentLayer(klCanvas.getLayer(0));\r\n                klCanvasWorkspace.resetView();\r\n                handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n                isFirstImage = false;\r\n            },\r\n            onCancel: function() {}\r\n        });\r\n    }\r\n\r\n    function shareImage(callback?) {\r\n        BB.shareCanvas({\r\n            canvas: klCanvas.getCompleteCanvas(1),\r\n            fileName: BB.getDate() + filenameBase + '.png',\r\n            title: BB.getDate() + filenameBase + '.png',\r\n            callback: callback ? callback : function() {}\r\n        });\r\n    }\r\n\r\n    const saveToComputer = new KL.SaveToComputer(\r\n        pOptions.saveReminder,\r\n        klRootEl,\r\n        () => exportType,\r\n        () => klCanvas,\r\n        filenameBase,\r\n    );\r\n\r\n    const fileTab = pOptions.embed ? null : new KL.FileTab(\r\n        klRootEl,\r\n        projectStore,\r\n        () => klCanvas.getProject(),\r\n        exportType,\r\n        (type) => {\r\n            exportType = type;\r\n        },\r\n        handleFileSelect,\r\n        () => {\r\n            saveToComputer.save();\r\n        },\r\n        showNewImageDialog,\r\n        shareImage,\r\n        () => { // on upload\r\n            KL.imgurUpload(klCanvas, klRootEl, pOptions.saveReminder, pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : null, );\r\n        },\r\n        copyToClipboard,\r\n        pOptions.saveReminder,\r\n    );\r\n\r\n    const settingsTab = new KL.SettingsTab(\r\n        () => {\r\n            uiState = uiState === 'left' ? 'right' : 'left';\r\n            updateUi();\r\n            if (!pOptions.embed) {\r\n                LocalStorage.setItem('uiState', uiState);\r\n            }\r\n        },\r\n        pOptions.aboutEl\r\n    );\r\n\r\n    mainTabRow = new KL.TabRow({\r\n        initialId: 'draw',\r\n        tabArr: [\r\n            {\r\n                id: 'draw',\r\n                title: LANG('tool-brush'),\r\n                image: toolPaintImg,\r\n                onOpen: function() {\r\n                    if (currentBrushId === 'eraserBrush') {\r\n                        klColorSlider.enable(false);\r\n                    }\r\n                    BB.append(\r\n                        colorDiv,\r\n                        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n                    );\r\n                    brushDiv.style.display = 'block';\r\n                },\r\n                onClose: function() {\r\n                    brushDiv.style.display = 'none';\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'hand',\r\n                title: LANG('tool-hand'),\r\n                image: toolHandImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    handUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    handUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'fill',\r\n                title: LANG('tool-paint-bucket'),\r\n                image: toolFillImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    fillUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    fillUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'text',\r\n                title: LANG('tool-text'),\r\n                image: toolTextImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    textUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    textUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'shape',\r\n                title: LANG('tool-shape'),\r\n                image: toolShapeImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    shapeUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    shapeUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'layers',\r\n                title: LANG('tab-layers'),\r\n                image: tabLayersImg,\r\n                onOpen: function() {\r\n                    layerManager.update();\r\n                    layerManager.style.display = 'block';\r\n                },\r\n                onClose: function() {\r\n                    layerManager.style.display = 'none';\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'edit',\r\n                label: LANG('tab-edit'),\r\n                onOpen: function() {\r\n                    filterTab.show();\r\n                },\r\n                onClose: function() {\r\n                    filterTab.hide();\r\n                },\r\n                css: {\r\n                    padding: '0 7px',\r\n                },\r\n            },\r\n            {\r\n                id: 'file',\r\n                label: LANG('tab-file'),\r\n                isVisible: !!fileTab,\r\n                onOpen: function() {\r\n                    if (!fileTab) {\r\n                        return;\r\n                    }\r\n                    fileTab.getElement().style.display = 'block';\r\n                    fileTab.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    if (!fileTab) {\r\n                        return;\r\n                    }\r\n                    fileTab.getElement().style.display = 'none';\r\n                    fileTab.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    padding: '0 7px',\r\n                },\r\n            },\r\n            {\r\n                id: 'settings',\r\n                title: LANG('tab-settings'),\r\n                image: tabSettingsImg,\r\n                onOpen: function() {\r\n                    settingsTab.getElement().style.display = 'block';\r\n                    // settingsTab.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    settingsTab.getElement().style.display = 'none';\r\n                    // settingsTab.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            }\r\n        ]\r\n    });\r\n    function updateMainTabVisibility() {\r\n        if (!mainTabRow) {\r\n            return;\r\n        }\r\n\r\n        let toolObj = {\r\n            'draw': {},\r\n            'hand': {},\r\n            'fill': {},\r\n            'text': {},\r\n            'shape': {}\r\n        };\r\n\r\n        let activeStr = toolspaceToolRow.getActive();\r\n        let oldTabId = mainTabRow.getOpenedTabId();\r\n\r\n        let keysArr = Object.keys(toolObj);\r\n        for (let i = 0; i < keysArr.length; i++) {\r\n            if (activeStr === keysArr[i]) {\r\n                mainTabRow.setIsVisible(keysArr[i], true);\r\n            } else {\r\n                mainTabRow.setIsVisible(keysArr[i], false);\r\n                if (oldTabId === keysArr[i]) {\r\n                    mainTabRow.open(activeStr);\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    function copyToClipboard(showCrop?) {\r\n        KL.clipboardDialog(klRootEl, klCanvas.getCompleteCanvas(1), function (inputObj) {\r\n            if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) {\r\n                return;\r\n            }\r\n            //do a crop\r\n            KL.filterLib.cropExtend.apply({\r\n                context: currentLayerCtx,\r\n                klCanvas: klCanvas,\r\n                input: inputObj, //{left,right,top,bottom}\r\n                history: klHistory\r\n            });\r\n            layerManager.update();\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        }, statusOverlay, showCrop);\r\n    }\r\n\r\n    const bottomBarWrapper = BB.el({\r\n        css: {\r\n            width: \"270px\",\r\n            position: \"absolute\",\r\n            bottom: '0',\r\n            left: '0'\r\n        },\r\n    });\r\n    if (pOptions.bottomBar) {\r\n        bottomBarWrapper.append(pOptions.bottomBar);\r\n        const observer = new MutationObserver(() => updateBottomBar());\r\n        observer.observe(\r\n            toolspaceInner,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n    }\r\n    function updateBottomBar() {\r\n        if (!pOptions.bottomBar) {\r\n            return;\r\n        }\r\n        const threshold = 617; //590\r\n        const isVisible = (\r\n            threshold < window.innerHeight &&\r\n            toolspaceInner.scrollHeight + 50 < window.innerHeight\r\n        );\r\n        bottomBarWrapper.style.display = isVisible ? '' : 'none';\r\n    }\r\n\r\n\r\n\r\n    BB.append(toolspaceInner, [\r\n        layerPreview.getElement(),\r\n        mainTabRow.getElement(),\r\n        brushDiv,\r\n        handUi.getElement(),\r\n        fillUi.getElement(),\r\n        textUi.getElement(),\r\n        shapeUi.getElement(),\r\n        layerManager,\r\n        filterTab.getElement(),\r\n        fileTab ? fileTab.getElement() : null,\r\n        settingsTab.getElement(),\r\n        BB.el({\r\n            css: {\r\n                height: '10px', // a bit of spacing at the bottom\r\n            }\r\n        }),\r\n        bottomBarWrapper ? bottomBarWrapper : null\r\n    ]);\r\n\r\n    const toolspaceScroller = new KL.ToolspaceScroller({\r\n        toolspace,\r\n        uiState,\r\n    });\r\n\r\n    // --- interface ---\r\n\r\n    this.getEl = () => {\r\n        return klRootEl;\r\n    };\r\n\r\n    this.resize = (w, h) => {\r\n\r\n        // iPad scrolls down when increasing text zoom\r\n        if (window.scrollY > 0) {\r\n            window.scrollTo(0, 0);\r\n        }\r\n\r\n        if (uiWidth === Math.max(0, w) && uiHeight === Math.max(0, h)) {\r\n            return;\r\n        }\r\n\r\n        uiWidth = Math.max(0, w);\r\n        uiHeight = Math.max(0, h);\r\n\r\n        updateCollapse();\r\n        updateBottomBar();\r\n\r\n        layerPreview.setIsVisible(uiHeight >= 579);\r\n        klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\r\n        toolspaceToolRow.setIsSmall(uiHeight < 540);\r\n    };\r\n\r\n    this.out = (msg) => {\r\n        statusOverlay.out(msg);\r\n    };\r\n\r\n    this.getPNG = function(): Blob {\r\n        return base64ToBlob(klCanvas.getCompleteCanvas(1).toDataURL('image/png'));\r\n    };\r\n\r\n    this.getPSD = async function() {\r\n        return await klCanvasToPsdBlob(klCanvas);\r\n    };\r\n\r\n    this.getProject = () => klCanvas.getProject();\r\n\r\n    this.swapUiLeftRight = () => {\r\n        uiState = uiState === 'left' ? 'right' : 'left';\r\n        if (!pOptions.embed) {\r\n            LocalStorage.setItem('uiState', uiState);\r\n        }\r\n        updateUi();\r\n    };\r\n\r\n    this.saveAsPsd = () => {\r\n        saveToComputer.save('psd');\r\n    };\r\n\r\n    this.isDrawing = () => {\r\n        return lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\r\n    };\r\n\r\n    // --- end interface ---\r\n\r\n    this.resize(uiWidth, uiHeight);\r\n    updateUi();\r\n\r\n    {\r\n        BB.addEventListener(window, 'resize', () => {\r\n            this.resize(window.innerWidth, window.innerHeight);\r\n        });\r\n        BB.addEventListener(window, 'orientationchange', () => {\r\n            this.resize(window.innerWidth, window.innerHeight);\r\n        });\r\n\r\n        // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\r\n        // Workaround: place a div in the body that fills the window, and use a ResizeObserver\r\n        const windowResizeWatcher = BB.el({\r\n            parent: document.body,\r\n            css: {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n                pointerEvents: 'none',\r\n                zIndex: '-1',\r\n                userSelect: 'none',\r\n            }\r\n        });\r\n        try {\r\n            // Not all browsers support ResizeObserver. Not critical though.\r\n            const observer = new ResizeObserver(() => this.resize(window.innerWidth, window.innerHeight));\r\n            observer.observe(windowResizeWatcher);\r\n        } catch (e) {\r\n            windowResizeWatcher.parentNode.removeChild(windowResizeWatcher);\r\n        }\r\n\r\n        // prevent ctrl scroll -> zooming page\r\n        BB.addEventListener(klRootEl, 'wheel', (event) => {\r\n            if (keyListener.isPressed('ctrl')) {\r\n                event.preventDefault();\r\n            }\r\n        });\r\n        //maybe prevent zooming on safari mac os - todo still needed?\r\n        const prevent = (e) => {\r\n            e.preventDefault();\r\n        }\r\n        window.addEventListener('gesturestart', prevent);\r\n        window.addEventListener('gesturechange', prevent);\r\n        window.addEventListener('gestureend', prevent);\r\n    }\r\n}","import {DecoyKlHistory, klHistory} from './history/kl-history';\r\nimport {Popup, popup} from './ui/modals/popup';\r\nimport {dialogCounter} from './ui/modals/modal-count';\r\nimport {Checkbox} from './ui/base-components/checkbox';\r\nimport {input} from './ui/base-components/input';\r\nimport {Select} from './ui/base-components/select';\r\nimport {ImageToggle} from './ui/base-components/image-toggle';\r\nimport {ImageRadioList} from './ui/base-components/image-radio-list';\r\nimport {penPressureToggle} from './ui/base-components/pen-pressure-toggle';\r\nimport {KlSlider} from './ui/base-components/kl-slider';\r\nimport {calcSliderFalloffFactor} from './ui/base-components/slider-falloff';\r\nimport {HexColorDialog} from './ui/modals/color-slider-hex-dialog';\r\nimport {KlColorSlider} from './ui/base-components/kl-color-slider';\r\nimport {KlSmallColorSlider} from './ui/base-components/kl-color-slider-small';\r\nimport {PointSlider} from './ui/base-components/point-slider';\r\nimport {ColorOptions} from './ui/base-components/color-options';\r\nimport {Options} from './ui/base-components/options';\r\nimport {StatusOverlay} from './ui/components/status-overlay';\r\nimport {exportDialog} from './ui/modals/export-dialog-deprecated';\r\nimport {CropCopy} from './ui/components/crop-copy';\r\nimport {clipboardDialog} from './ui/modals/clipboard-dialog';\r\nimport {klLayerManager} from './ui/tool-tabs/kl-layer-manager';\r\nimport {WorkspaceSvgOverlay} from './canvas-ui/workspace-svg-overlay';\r\nimport {KlCanvasWorkspace} from './canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvasPreview} from './canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './ui/components/free-transform';\r\nimport {FreeTransformCanvas} from './ui/components/free-transform-canvas';\r\nimport {Cropper} from './ui/components/cropper';\r\nimport {LayerPreview} from './ui/components/layer-preview';\r\nimport {FittedImage} from './ui/components/fitted-image';\r\nimport {showImportAsLayerDialog} from './ui/modals/show-import-as-layer-dialog';\r\nimport {KlImageDropper} from './ui/components/kl-image-dropper';\r\nimport {OverlayToolspace} from './ui/components/overlay-toolspace';\r\nimport {ToolspaceTopRow} from './ui/components/toolspace-top-row';\r\nimport {ToolDropdown} from './ui/components/tool-dropdown';\r\nimport {ToolspaceToolRow} from './ui/components/toolspace-tool-row';\r\nimport {ToolspaceStabilizerRow} from './ui/components/toolspace-stabilizer-row';\r\nimport {TabRow} from './ui/components/tab-row';\r\nimport {HandUi} from './ui/tool-tabs/hand-ui';\r\nimport {FillUi} from './ui/tool-tabs/fill-ui';\r\nimport {TextUi} from './ui/tool-tabs/text-ui';\r\nimport {ShapeUi} from './ui/tool-tabs/shape-ui';\r\nimport {newImageDialog} from './ui/modals/new-image-dialog';\r\nimport {ToolspaceCollapser} from './ui/components/toolspace-collapser';\r\nimport {renderText} from './image-operations/render-text';\r\nimport {textToolDialog} from './ui/modals/text-tool-dialog';\r\nimport {showImportImageDialog} from './ui/modals/show-import-image-dialog';\r\nimport {floodFillBits} from './image-operations/flood-fill';\r\nimport * as PSD from './storage/psd';\r\nimport {drawShape, ShapeTool} from './image-operations/shape-tool';\r\nimport {KlCanvas} from './canvas/kl-canvas';\r\nimport * as indexedDb from './storage/indexed-db';\r\nimport {filterLib, filterLibStatus} from './filters/filters';\r\nimport {brushes} from './brushes/brushes';\r\nimport {brushesUI} from './brushes-ui/brushes-ui';\r\nimport {showIframePopup} from './ui/modals/show-iframe-popup';\r\nimport {RadioList} from './ui/base-components/radio-list';\r\nimport {BrowserStorageUi} from './ui/components/browser-storage-ui';\r\nimport {drawProject} from './canvas/draw-project';\r\nimport {ProjectStore} from './storage/project-store';\r\nimport {FileTab} from \"./ui/tool-tabs/file-tab\";\r\nimport {FilterTab} from \"./ui/tool-tabs/filter-tab\";\r\nimport {imgurUpload} from \"./ui/modals/imgur-upload\";\r\nimport {loadAgPsd} from \"./storage/ag-psd-wrapper\";\r\nimport {SaveReminder} from \"./ui/components/save-reminder\";\r\nimport {SaveToComputer} from \"./storage/save-to-computer\";\r\nimport {UndoRedoCatchup} from \"./history/undo-redo-catchup\";\r\nimport {setDbName} from './storage/indexed-db';\r\nimport {BrushSettingService} from './brushes-ui/brush-setting-service';\r\nimport {BoxToggle} from './ui/base-components/box-toggle';\r\nimport {SettingsTab} from './ui/tool-tabs/settings-tab';\r\nimport {ToolspaceScroller} from './ui/components/toolspace-scroller';\r\n\r\n/**\r\n * paint tool functionality\r\n */\r\nexport const KL = {\r\n\r\n    // --- brushes ---\r\n    brushes,\r\n    brushesUI,\r\n    BrushSettingService,\r\n\r\n    // --- canvas ---\r\n    KlCanvas,\r\n    drawProject,\r\n\r\n    // --- canvas ui ---\r\n    WorkspaceSvgOverlay,\r\n    KlCanvasWorkspace,\r\n    KlCanvasPreview,\r\n\r\n    // --- filters ---\r\n    filterLibStatus,\r\n    filterLib,\r\n\r\n    // --- history ---\r\n    UndoRedoCatchup,\r\n\r\n    // --- image operations ---\r\n    renderText,\r\n    floodFillBits,\r\n    ShapeTool,\r\n    drawShape,\r\n\r\n    // --- storage ---\r\n    PSD,\r\n    setDbName,\r\n    indexedDb,\r\n    ProjectStore,\r\n    loadAgPsd,\r\n    SaveToComputer,\r\n\r\n    // --- ui - base components ---\r\n    calcSliderFalloffFactor,\r\n    Checkbox,\r\n    input,\r\n    Select,\r\n    ImageToggle,\r\n    ImageRadioList,\r\n    RadioList,\r\n    penPressureToggle,\r\n    KlSlider,\r\n    HexColorDialog,\r\n    KlColorSlider,\r\n    KlSmallColorSlider,\r\n    PointSlider,\r\n    ColorOptions,\r\n    Options,\r\n    BoxToggle,\r\n\r\n    // --- ui - components ---\r\n    StatusOverlay,\r\n    CropCopy,\r\n    FreeTransform,\r\n    FreeTransformCanvas,\r\n    Cropper,\r\n    LayerPreview,\r\n    FittedImage,\r\n    KlImageDropper,\r\n    OverlayToolspace,\r\n    ToolspaceTopRow,\r\n    ToolDropdown,\r\n    ToolspaceToolRow,\r\n    ToolspaceStabilizerRow,\r\n    TabRow,\r\n    ToolspaceCollapser,\r\n    BrowserStorageUi,\r\n    SaveReminder,\r\n    ToolspaceScroller,\r\n\r\n    // --- ui - modals ---\r\n    dialogCounter,\r\n    popup,\r\n    Popup,\r\n    exportDialog,\r\n    clipboardDialog,\r\n    showImportAsLayerDialog,\r\n    newImageDialog,\r\n    textToolDialog,\r\n    showImportImageDialog,\r\n    showIframePopup,\r\n    imgurUpload,\r\n\r\n    // --- ui - tool tabs ---\r\n    HandUi,\r\n    FillUi,\r\n    TextUi,\r\n    ShapeUi,\r\n    FileTab,\r\n    FilterTab,\r\n    SettingsTab,\r\n    klLayerManager,\r\n\r\n\r\n    klHistory,\r\n    DecoyKlHistory,\r\n};","\r\nexport interface IHistoryEntry {\r\n    tool: string[];\r\n    action?: string;\r\n    params?: any[];\r\n\r\n    actions?: {\r\n        action: string;\r\n        params: any[];\r\n    }[]\r\n}\r\n\r\nexport interface IHistoryBroadcast {\r\n    bufferUpdate: IHistoryEntry;\r\n}\r\n\r\nexport type IHistoryListener = (p: IHistoryBroadcast | null) => void;\r\n\r\nlet historyInstance: boolean = false;\r\n\r\nexport interface KlHistoryInterface {\r\n    pause (b: boolean): void;\r\n    addListener (l: IHistoryListener): void;\r\n    push (e: IHistoryEntry): void;\r\n    undo (): (IHistoryEntry | null)[];\r\n    redo (): (IHistoryEntry | null)[];\r\n    getAll (): (IHistoryEntry | null)[];\r\n    canRedo (): boolean;\r\n    canUndo (): boolean;\r\n    getState (): number;\r\n    getActionNumber (): number;\r\n}\r\n\r\nexport class DecoyKlHistory implements KlHistoryInterface {\r\n    pause (b: boolean): void {}\r\n    addListener (l: IHistoryListener): void {}\r\n    push (e: IHistoryEntry): void {}\r\n    undo (): (IHistoryEntry | null)[] { return []; }\r\n    redo (): (IHistoryEntry | null)[] { return []; }\r\n    getAll (): (IHistoryEntry | null)[] { return []; }\r\n    canRedo (): boolean { return false; }\r\n    canUndo (): boolean { return false; }\r\n    getState (): number { return 0; }\r\n    getActionNumber (): number { return 0; }\r\n}\r\n\r\nexport class KlHistory implements KlHistoryInterface {\r\n\r\n    private state: number; // on .push state increments by one\r\n    private dataArr: (IHistoryEntry | null)[]; // null if beyond max undo to trigger garbage collection\r\n    private listeners: IHistoryListener[];\r\n    private pauseStack: number; // how often paused without unpause\r\n    private readonly max: number = 20; // max number undo steps\r\n    private maxState: number; // can't go backwards -> max state is the buffer image(klCanvas)\r\n    private actionNumber: number; // current action the user is on. untouched document = -1 because dataArr.length is 0\r\n    \r\n    private broadcast (p: IHistoryBroadcast | null): void {\r\n        setTimeout(() => {\r\n            for (let i = 0; i < this.listeners.length; i++) {\r\n                this.listeners[i](p);\r\n            }\r\n            this.state++;\r\n        }, 1);\r\n    }\r\n    \r\n    // ---- public ----\r\n    \r\n    constructor () {\r\n        if (historyInstance) {\r\n            throw new Error('klHistory already instantiated');\r\n        }\r\n        historyInstance = true;\r\n        this.state = 0;\r\n        this.dataArr = [];\r\n        this.listeners = [];\r\n        this.pauseStack = 0;\r\n        this.maxState = -1;\r\n        this.actionNumber = -1;\r\n    }\r\n\r\n    /**\r\n     * you need pause because there are sometimes actions that would cause other\r\n     * undo steps\r\n     * for example a filter that does something crazy with two layers and then merges them\r\n     * you want that to be one undo step, and prevent merging from causing its undo step.\r\n     * so while that filter is doing its magic you should pause possible undo steps that\r\n     * that are caused by a part of its code(in this example: merging layers)\r\n     *\r\n     * @param b\r\n     */\r\n    pause (b: boolean): void {\r\n        if (b === false) {\r\n            this.pauseStack = Math.max(0, this.pauseStack - 1);\r\n        } else {\r\n            this.pauseStack++;\r\n        }\r\n    }\r\n\r\n    addListener (l: IHistoryListener): void {\r\n        this.listeners.push(l);\r\n    }\r\n\r\n    push (e: IHistoryEntry): void {\r\n        if (this.pauseStack > 0) {\r\n            return;\r\n        }\r\n        while (this.actionNumber < this.dataArr.length - 1) {\r\n            this.dataArr.pop();\r\n        }\r\n\r\n        //taking care of actions that shouldn't cause a new undo step\r\n        const top = this.dataArr[this.dataArr.length - 1];\r\n        if (e.action === 'layerOpacity' && top && top.action === 'layerOpacity' && top.params[0] === e.params[0]) {\r\n            this.dataArr[this.dataArr.length - 1] = e;\r\n            this.state++; //still needs to increment because something changed\r\n            return;\r\n        }\r\n        if (e.action === 'focusLayer' && top && top.action === 'focusLayer') {\r\n            this.dataArr[this.dataArr.length - 1] = e;\r\n            this.state++;\r\n            return;\r\n        }\r\n\r\n\r\n        this.dataArr[this.dataArr.length] = e;\r\n        this.actionNumber = this.dataArr.length - 1;\r\n        const maxBefore = this.maxState;\r\n        this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\r\n        if (maxBefore < this.maxState) {\r\n            this.broadcast({bufferUpdate: this.dataArr[this.maxState]});\r\n        } else {\r\n            this.broadcast(null);\r\n        }\r\n        if (this.maxState >= 0) {\r\n            this.dataArr[this.maxState] = null; //to free some memory...imported images take a lot of space\r\n        }\r\n    }\r\n\r\n    undo (): (IHistoryEntry | null)[] {\r\n        let result;\r\n        if (this.canUndo()) {\r\n            result = [];\r\n            for (let i = this.maxState + 1; i < this.actionNumber; i++) {\r\n                result.push(this.dataArr[i]);\r\n            }\r\n            this.actionNumber--;\r\n            this.broadcast(null);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    redo (): (IHistoryEntry | null)[] {\r\n        const result = [];\r\n        if (this.canRedo()) {\r\n            this.actionNumber++;\r\n            result.push(this.dataArr[this.actionNumber]);\r\n            this.broadcast(null);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    getAll (): (IHistoryEntry | null)[] {\r\n        return [].concat(this.dataArr);\r\n    }\r\n\r\n    canRedo (): boolean {\r\n        return this.actionNumber < this.dataArr.length - 1;\r\n    }\r\n\r\n    canUndo (): boolean {\r\n        return this.actionNumber > this.maxState;\r\n    }\r\n\r\n    getState (): number {\r\n        return this.state;\r\n    }\r\n\r\n    /**\r\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\r\n     */\r\n    getActionNumber (): number {\r\n        return (this.actionNumber + 1);\r\n    }\r\n    \r\n}\r\n\r\nexport const klHistory = new KlHistory();\r\n","import {dialogCounter} from './modal-count';\r\nimport {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport checkImg from 'url:~/src/app/img/ui/check.svg';\r\n// @ts-ignore\r\nimport cancelImg from 'url:~/src/app/img/ui/cancel.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\n\r\nwindow.onscroll = (e) => {\r\n    e.preventDefault();\r\n}\r\n\r\nexport function popup (\r\n    p: {\r\n        target: HTMLElement;\r\n        div?: HTMLElement; // node with content\r\n        message: string; // can be html\r\n        callback?: (result: string) => void;\r\n        buttons?: string[]; // \"Ok\", and \"Cancel\" will be automatically translated\r\n        primaries?: string[];\r\n        type?: 'error' | 'warning' | 'upload' | 'ok'; // todo\r\n        closefunc?: (f: () => void) => void; // returns a function you can call to close (Cancel) the dialog\r\n        style?: IKeyString;\r\n        clickOnEnter?: string; // name of button - will be clicked if enter key pressed\r\n        autoFocus?: false | string; // name of  to automatically focus - default 'Ok' - false -> none\r\n        ignoreBackground?: boolean; // deafult false; if true clicking on background doesn't close\r\n    }\r\n): void {\r\n    dialogCounter.increase();\r\n    let isClosed = false;\r\n\r\n\r\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\r\n    const rootRootEl = BB.el({\r\n        parent: document.body,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            overflow: 'hidden',\r\n        }\r\n    });\r\n    const rootEl = BB.el({\r\n        parent: rootRootEl,\r\n        className: 'kl-popup',\r\n    });\r\n\r\n    const scrollContent = BB.el({\r\n        parent: rootEl,\r\n        css: {\r\n            width: '100%',\r\n            minHeight: '100%',\r\n            // padding: '10px 0',\r\n            position: 'relative',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n        }\r\n    });\r\n\r\n    const bgEl = BB.el({\r\n        parent: scrollContent,\r\n        onClick: () => {\r\n            if (p.ignoreBackground) {\r\n                return;\r\n            }\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            zIndex: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n        }\r\n    });\r\n\r\n    const titleHeight = 40;\r\n    const xButton = BB.el({\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: () => {\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            position: 'absolute',\r\n            right: '0',\r\n            top: '0',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        }\r\n    });\r\n\r\n    const boxClasses = ['kl-popup-box'];\r\n    boxClasses.push('kl-popup-box--sm');\r\n    const boxEl = BB.el({\r\n        content: [\r\n            xButton,\r\n            BB.el({\r\n                content:p.message,\r\n                css: {\r\n                    marginBottom: p.div ? '10px' : null,\r\n                    marginRight: '15px',\r\n                }\r\n            }),\r\n            p.div,\r\n        ],\r\n        className: boxClasses.join(' '),\r\n        css: p.style ? p.style : null,\r\n    });\r\n\r\n    scrollContent.append(\r\n        BB.el({\r\n            css: {\r\n                flex: '0.5',\r\n            }\r\n        }),\r\n        boxEl,\r\n        BB.el({\r\n            css: {\r\n                flex: '1',\r\n            }\r\n        })\r\n    );\r\n\r\n    if (p.type === 'error') {\r\n        boxEl.classList.add('poperror');\r\n    }\r\n    if (p.type === 'ok') {\r\n        boxEl.classList.add('popok');\r\n    }\r\n    if (p.type === 'warning') {\r\n        boxEl.classList.add('popwarning');\r\n    }\r\n    if (p.type === 'upload') {\r\n        boxEl.classList.add('popupload');\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e, comboStr) {\r\n            if (isClosed) {\r\n                return;\r\n            }\r\n            if (clickOnEnterBtn && comboStr === 'enter' && !BB.isInputFocused()) {\r\n                e.stopPropagation();\r\n                setTimeout(function() {\r\n                    clickOnEnterBtn.click();\r\n                }, 10);\r\n            }\r\n            if (comboStr === 'esc') {\r\n                e.stopPropagation();\r\n                close('Cancel');\r\n            }\r\n        }\r\n    });\r\n    // prevent ctrl scroll -> zooming page\r\n    const wheelPrevent = (event) => {\r\n        if (keyListener.isPressed('ctrl')) {\r\n            event.preventDefault();\r\n        }\r\n    };\r\n    BB.addEventListener(rootEl, 'wheel', wheelPrevent);\r\n    rootEl.onclick = BB.handleClick;\r\n\r\n    let autoFocus = null;\r\n    if (p.autoFocus) {\r\n        autoFocus = p.autoFocus;\r\n    } else if (p.autoFocus === false) {\r\n        autoFocus = null;\r\n    } else {\r\n        autoFocus = 'Ok';\r\n    }\r\n\r\n    const buttonRowEl = p.buttons && p.buttons.length > 0 ? BB.el({\r\n        parent: boxEl,\r\n        css: {\r\n            display: 'flex',\r\n            flexWrap: 'wrap',\r\n            justifyContent: 'flex-end',\r\n            marginTop: '12px', // 8px already via buttons\r\n            marginLeft: '-8px',\r\n        }\r\n    }) : null;\r\n    let clickOnEnterBtn;\r\n    const btnElArr = [];\r\n    if (p.buttons) {\r\n        p.buttons.forEach(buttonName => {\r\n            const btnClasses = ['kl-popup__btn'];\r\n            if (buttonName === 'Ok' || (p.primaries && p.primaries.includes(buttonName))) {\r\n                btnClasses.push('kl-button-primary');\r\n            }\r\n            let iconUrl;\r\n            let label = buttonName;\r\n            if (buttonName === 'Ok') {\r\n                label = LANG('modal-ok');\r\n                iconUrl = checkImg;\r\n            }\r\n            if (buttonName === 'Cancel') {\r\n                label = LANG('modal-cancel');\r\n                iconUrl = cancelImg;\r\n            }\r\n            let iconImg = null;\r\n            if (iconUrl) {\r\n                iconImg = BB.el({\r\n                    tagName: 'img',\r\n                    custom: {\r\n                        src: iconUrl,\r\n                        height: '17',\r\n                    }\r\n                });\r\n            }\r\n            const btn = BB.el({\r\n                parent: buttonRowEl,\r\n                tagName: 'button',\r\n                className: btnClasses.join(' '),\r\n                content: [iconImg, label],\r\n                onClick: () => {\r\n                    close(buttonName);\r\n                },\r\n            });\r\n            btnElArr.push(btn);\r\n            if (autoFocus === buttonName) {\r\n                setTimeout(() => {\r\n                    btn.focus();\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 10);\r\n                setTimeout(() => {\r\n                    // safari needs a separate timeout\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 20);\r\n            }\r\n            if (buttonName === p.clickOnEnter) {\r\n                clickOnEnterBtn = btn;\r\n            }\r\n        });\r\n    }\r\n\r\n    function close (value: string) {\r\n        if (isClosed) {\r\n            return;\r\n        }\r\n\r\n        isClosed = true;\r\n        BB.clearSelection();\r\n        BB.unfocusAnyInput();\r\n        document.body.removeChild(rootRootEl);\r\n        dialogCounter.decrease();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        keyListener.destroy();\r\n        BB.removeEventListener(rootEl, 'wheel', wheelPrevent);\r\n        rootEl.onclick = null;\r\n        btnElArr.forEach(item => {\r\n            BB.destroyEl(item);\r\n        });\r\n        btnElArr.splice(0, btnElArr.length);\r\n\r\n        if (p.callback) {\r\n            p.callback(value);\r\n        }\r\n    }\r\n\r\n    if (p.closefunc) {\r\n        p.closefunc(function () {\r\n            close('Cancel');\r\n        });\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * popups that fill whole height, with some padding.\r\n * currently only used for iframe popups.\r\n *\r\n * p = {\r\n *      title: DOM Element | string, // optional (todo allow string)\r\n *      icon: 'ok', // optional todo\r\n *      content: DOM Element, // optional\r\n *      buttonArr: [ // optional todo\r\n *          'Ok',\r\n *          'Cancel'\r\n *      ],\r\n *      autoFocus: string | false, //todo\r\n *      clickOnEnter: string, //todo\r\n *      onClose: function(result: string), // optional (todo result)\r\n *\r\n *      //size and position\r\n *      width: 500,\r\n *      isMaxHeight: boolean //todo, currently always true\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const Popup = function(p) {\r\n    dialogCounter.increase();\r\n    const parent = document.body;\r\n    const div = BB.el({\r\n        parent: parent,\r\n        className: 'g-root',\r\n        css: {\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            bottom: '0',\r\n            right: '0',\r\n            background: 'rgba(0, 0, 0, 0.45)',\r\n            overflow: 'auto',\r\n            animationName: 'consoleIn',\r\n            animationDuration: '0.3s',\r\n            animationTimingFunction: 'ease-out'\r\n        }\r\n    });\r\n    div.onclick = BB.handleClick;\r\n\r\n    let updateInterval;\r\n\r\n    function close() {\r\n        dialogCounter.decrease();\r\n        div.onclick = null;\r\n        parent.removeChild(div);\r\n        clearInterval(updateInterval);\r\n        window.removeEventListener('resize', updatePos);\r\n        keyListener.destroy();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        if (p.onClose) {\r\n            p.onClose();\r\n        }\r\n    }\r\n\r\n    //background element registering clicks\r\n    const bgEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            bottom: '0',\r\n            right: '0'\r\n        },\r\n        onClick: close\r\n    });\r\n\r\n    //the actual popup box\r\n    const popupEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'absolute',\r\n            width: (BB.isCssMinMaxSupported() ?\r\n                'min(calc(100% - 40px), ' + (p.width ? p.width : 400) + 'px)' :\r\n                (p.width ? p.width : 400) + 'px'),\r\n            height: 'calc(100% - 40px)',\r\n            background: '#eee',\r\n            borderRadius: '10px',\r\n            overflow: 'hidden',\r\n            boxShadow: 'rgba(0, 0, 0, 0.25) 0px 5px 60px'\r\n        }\r\n    });\r\n\r\n    //x and y position via script. flex not powerful enough imo\r\n    function updatePos() {\r\n        const elW = popupEl.offsetWidth;\r\n        const elH = popupEl.offsetHeight;\r\n\r\n        BB.css(popupEl, {\r\n            left: Math.max(0, (window.innerWidth - elW) / 2) + 'px',\r\n            top: Math.max(20, (window.innerHeight - elH) / 2 - (elH * 0.20)) + 'px'\r\n        });\r\n    }\r\n    //todo also update when popup changes size - resizeobserver and fallback\r\n    //updateInterval = setInterval(updatePos, 100);\r\n    updatePos();\r\n    window.addEventListener('resize', updatePos);\r\n\r\n    //title row in popup\r\n    const titleHeight = 40;\r\n    const titleEl = BB.el({\r\n        parent: popupEl,\r\n        css: {\r\n            height: titleHeight + 'px',\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            paddingLeft: (titleHeight / 2) + 'px'\r\n        }\r\n    });\r\n    if (p.title) {\r\n        titleEl.appendChild(p.title);\r\n    }\r\n    const xButton = BB.el({\r\n        parent: titleEl,\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: close,\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        },\r\n        custom: {\r\n            tabindex: '0',\r\n        }\r\n    });\r\n\r\n    const contentEl = BB.el({\r\n        parent: popupEl,\r\n        css: {\r\n            height: 'calc(100% - ' + titleHeight + 'px)'\r\n        }\r\n    });\r\n    if (p.content) {\r\n        contentEl.appendChild(p.content);\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e) {\r\n            if (keyStr === 'esc') {\r\n                e.stopPropagation();\r\n                close();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n    this.close = function() {\r\n        close();\r\n    };\r\n};","\r\n// not the best\r\n\r\n/**\r\n * how many modals are open\r\n */\r\n\r\nexport class DialogCounter {\r\n    private listeners: ((v: number) => void)[] = [];\r\n    private count = 0;\r\n\r\n    private emit (): void {\r\n        this.listeners.forEach(item => {\r\n            item(this.count);\r\n        });\r\n    }\r\n\r\n    increase (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count += v;\r\n        } else {\r\n            this.count++;\r\n        }\r\n        this.emit();\r\n    }\r\n    decrease (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count -= v;\r\n        } else {\r\n            this.count--;\r\n        }\r\n        this.emit();\r\n    }\r\n    get (): number {\r\n        return this.count;\r\n    }\r\n    subscribe (listener: (v: number) => void): void {\r\n        this.listeners.push(listener);\r\n    }\r\n}\r\n\r\nexport const dialogCounter = new DialogCounter();\r\n","import * as BBEventListener from './input/event-listener';\r\nimport {\r\n    append, centerWithin, copyObj, createSvg,\r\n    css, dateDayDifference, decToFraction,\r\n    fitInto, gcd, getDate,\r\n    handleClick, imageBlobToUrl,\r\n    insertAfter, loadImage,\r\n    reduce,\r\n    setAttributes, shareCanvas\r\n} from './base/base';\r\nimport {\r\n    canShareFiles,\r\n    eventUsesHighResTimeStamp,\r\n    getVisitor,\r\n    hasPointerEvents,\r\n    hasWebGl,\r\n    isCssMinMaxSupported,\r\n    mouseEventHasMovement\r\n} from './base/browser';\r\nimport {KeyListener, sameKeys} from './input/key-listener';\r\nimport {PointerListener} from './input/pointer-listener';\r\nimport * as EventChain from './input/event-chain';\r\nimport {\r\n    convertToAlphaChannelCanvas,\r\n    copyCanvas,\r\n    createCheckerCanvas, createCheckerDataUrl,\r\n    drawTransformedImageOnCanvas,\r\n    drawTransformedImageWithBounds, freeCanvas, resizeCanvas, testShouldPixelate\r\n} from './base/canvas';\r\nimport {Matrix} from './math/matrix';\r\nimport {Vec2} from './math/vec2';\r\nimport {BezierLine, PointLine, projectPointOnLine, quadraticSplineInput, SplineInterpolator} from './math/line';\r\nimport {CMYK, ColorConverter, HSV, RGB, testIsWhiteBestContrast} from './color/color';\r\nimport {\r\n    appendTextDiv,\r\n    clearSelection,\r\n    destroyEl,\r\n    el,\r\n    isInputFocused,\r\n    makeUnfocusable,\r\n    unfocusAnyInput\r\n} from './base/ui';\r\nimport {\r\n    pointsToAngleDeg,\r\n    clamp,\r\n    dist,\r\n    mix,\r\n    pointsToAngleRad,\r\n    rotate,\r\n    rotateAround,\r\n    intDxy,\r\n    roundEven, roundUneven, distSquared, lenSquared, updateBounds, boundsInArea, round\r\n} from './math/math';\r\nimport {createCanvas} from './base/create-canvas';\r\nimport {BbLog} from './base/bb-log';\r\nimport {LocalStorage} from './base/local-storage';\r\n\r\nexport const BB = {\r\n\r\n    // ---- browser ----\r\n    eventUsesHighResTimeStamp,\r\n    mouseEventHasMovement,\r\n    hasPointerEvents,\r\n    hasWebGl,\r\n    getVisitor,\r\n    isCssMinMaxSupported,\r\n    canShareFiles,\r\n\r\n    // ---- base ----\r\n    insertAfter,\r\n    loadImage,\r\n    css,\r\n    setAttributes,\r\n    append,\r\n    fitInto,\r\n    centerWithin,\r\n    getDate,\r\n    gcd,\r\n    reduce,\r\n    decToFraction,\r\n    imageBlobToUrl,\r\n    dateDayDifference,\r\n    copyObj,\r\n    shareCanvas,\r\n    handleClick,\r\n    createSvg,\r\n    BbLog,\r\n    LocalStorage,\r\n\r\n    // ---- math ----\r\n    mix,\r\n    dist,\r\n    distSquared,\r\n    lenSquared,\r\n    pointsToAngleRad,\r\n    pointsToAngleDeg,\r\n    clamp,\r\n    rotate,\r\n    rotateAround,\r\n    Matrix,\r\n    Vec2,\r\n    intDxy,\r\n    roundEven,\r\n    roundUneven,\r\n    round,\r\n    updateBounds,\r\n    boundsInArea,\r\n\r\n    // ---- line ----\r\n    projectPointOnLine,\r\n    PointLine,\r\n    BezierLine,\r\n    SplineInterpolator,\r\n    quadraticSplineInput,\r\n\r\n    // ---- canvas ----\r\n    canvas: createCanvas,\r\n    copyCanvas,\r\n    testShouldPixelate,\r\n    drawTransformedImageWithBounds,\r\n    drawTransformedImageOnCanvas,\r\n    createCheckerCanvas,\r\n    createCheckerDataUrl,\r\n    resizeCanvas,\r\n    convertToAlphaChannelCanvas,\r\n    freeCanvas,\r\n\r\n    // ---- color ----\r\n    HSV,\r\n    RGB,\r\n    CMYK,\r\n    ColorConverter,\r\n    testIsWhiteBestContrast,\r\n\r\n    // ---- UI ----\r\n    appendTextDiv,\r\n    clearSelection,\r\n    makeUnfocusable,\r\n    el,\r\n    destroyEl,\r\n    isInputFocused,\r\n    unfocusAnyInput,\r\n\r\n\r\n    // ---- events / input ----\r\n\r\n    addEventListener: BBEventListener.addEventListener,\r\n    removeEventListener: BBEventListener.removeEventListener,\r\n    setEventListener: BBEventListener.setEventListener,\r\n\r\n    KeyListener,\r\n    PointerListener,\r\n    sameKeys,\r\n\r\n    EventChain,\r\n\r\n};\r\n","import {hasPointerEvents} from '../base/browser';\r\n\r\nconst listenerFuncObj = {}; // for debugging\r\n\r\nexport const setEventListener = function (DomEl, type, listener) {\r\n    if (!hasPointerEvents) {\r\n        type = type.replace('pointer', 'mouse');\r\n    }\r\n    DomEl[type] = listener;\r\n};\r\n\r\nexport const addEventListener = function (DomEl, type, listener, options?) {\r\n    if (!hasPointerEvents) {\r\n        type = type.replace('pointer', 'mouse');\r\n    }\r\n    /*if (!(type in listenerFuncObj)) {\r\n        listenerFuncObj[type] = [];\r\n    }\r\n    listenerFuncObj[type].push(listener);*/\r\n    DomEl.addEventListener(type, listener, options);\r\n};\r\n\r\nexport const removeEventListener = function (DomEl, type, listener, options?) {\r\n    if (!hasPointerEvents) {\r\n        type = type.replace('pointer', 'mouse');\r\n    }\r\n    /*if (type in listenerFuncObj) {\r\n        for (let i = 0; i < listenerFuncObj[type].length; i++) {\r\n            if (listenerFuncObj[type][i] === listener) {\r\n                listenerFuncObj[type].splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }*/\r\n    DomEl.removeEventListener(type, listener, options);\r\n};","import {createCanvas} from './create-canvas';\r\n\r\nexport const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\r\n\r\nexport const eventUsesHighResTimeStamp = (function() {\r\n\r\n    let eventUsesHighResTimeStamp: boolean | null = null;\r\n    if (document.body) {\r\n        (function() {\r\n            const event = new Event('');\r\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\r\n        })();\r\n    } else {\r\n        window.addEventListener('DOMContentLoaded', function(event) {\r\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\r\n        });\r\n    }\r\n\r\n    return function(): boolean {\r\n        if (eventUsesHighResTimeStamp === null) {\r\n            throw 'eventUsesHighResTimeStamp not initialized';\r\n        }\r\n        return eventUsesHighResTimeStamp;\r\n    }\r\n})();\r\n\r\nexport const mouseEventHasMovement = (() => {\r\n\r\n    // no support: IE, Safari, Safari iOS\r\n    // supported but broken: Firefox\r\n\r\n    if (!('MouseEvent' in window)) {\r\n        return false;\r\n    }\r\n    let mouseEvent;\r\n    try {\r\n        mouseEvent = new MouseEvent('mousemove'); // browsers not supporting the constructor don't have it\r\n    } catch (e) {\r\n        return false;\r\n    }\r\n    if (!('movementX' in mouseEvent)) {\r\n        return false; // likely safari\r\n    }\r\n    return !isFirefox;\r\n})();\r\n\r\nexport const hasPointerEvents = !!window.PointerEvent;\r\n\r\nexport const hasWebGl = (function() {\r\n\r\n    const hasWebgl = (function() {\r\n        const canvas = createCanvas();\r\n        try {\r\n            canvas.getContext('experimental-webgl', { premultipliedAlpha: false });\r\n            return true;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    })();\r\n\r\n    return function() {\r\n        return hasWebgl;\r\n    }\r\n})();\r\n\r\nexport const getVisitor = (function () {\r\n    const visitor = {\r\n        chrome: false,\r\n        gl: false\r\n    };\r\n    //Chrome\r\n    if ((window as any).chrome && (window as any).chrome.app) {\r\n        visitor.chrome = true;\r\n    }\r\n    //WebGL\r\n    visitor.gl = hasWebGl();\r\n    return function () {\r\n        return JSON.parse(JSON.stringify(visitor));\r\n    }\r\n})();\r\n\r\nexport const isCssMinMaxSupported = (function() {\r\n    let result: boolean | null = null;\r\n\r\n    function test() {\r\n        const div = document.createElement('div');\r\n        div.style.position = 'absolute';\r\n        div.style.top = '0';\r\n        div.style.left = 'max(0px, 25px)';\r\n        document.body.appendChild(div);\r\n        setTimeout(function() {\r\n            result = div.offsetLeft === 25;\r\n            document.body.removeChild(div);\r\n        }, 25);\r\n    }\r\n\r\n    if (document.body) {\r\n        test();\r\n    } else {\r\n        window.addEventListener('DOMContentLoaded', function() {\r\n            test();\r\n        });\r\n    }\r\n\r\n    return function(): boolean {\r\n        if (result === null) {\r\n            throw new Error('isCssMinMaxSupported not initialized');\r\n        }\r\n        return result;\r\n    };\r\n})();\r\n\r\nexport const canShareFiles = function(): boolean {\r\n    return 'share' in navigator && 'canShare' in navigator;\r\n};","/*window['canvases'] = [];\r\n\r\nwindow['printCanvases'] = () => {\r\n    let total = 0;\r\n\r\n    console.log(window['canvases'].map(item => {\r\n        total += item.width * item.height;\r\n        return {w: item.width, h: item.height};\r\n    }));\r\n\r\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\r\n};*/\r\n\r\nexport function createCanvas(w?: number, h?: number): HTMLCanvasElement {\r\n    const result = document.createElement('canvas');\r\n    if (w && h) {\r\n        result.width = w;\r\n        result.height = h;\r\n    }\r\n    // window['canvases'].push(result);\r\n    return result;\r\n}","import {IKeyString, ISize2D, ISVG, IVector2D} from '../BB.types';\r\n\r\nexport function insertAfter (referenceNode: Element, newNode: Element): void {\r\n    if (referenceNode.parentNode) {\r\n        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\r\n    }\r\n}\r\n\r\nexport function loadImage (im: HTMLImageElement, callback: () => void): void {\r\n    let counter = 0;\r\n\r\n    function check() {\r\n        if (counter === 1000) {\r\n            alert(\"couldn't load\");\r\n            return;\r\n        }\r\n        if (im.complete) {\r\n            counter++;\r\n            callback();\r\n        } else {\r\n            setTimeout(check, 1);\r\n        }\r\n    }\r\n\r\n    check();\r\n}\r\n\r\nexport function css (el: HTMLElement | SVGElement, styleObj: IKeyString): void {\r\n    const keyArr = Object.keys(styleObj);\r\n    let keyStr: string;\r\n    const style = (el.style as unknown) as IKeyString;\r\n    for (let i = 0; i < keyArr.length; i++) {\r\n        keyStr = keyArr[i];\r\n        style[keyStr] = styleObj[keyStr];\r\n        style.alignContent = 'true';\r\n        if (keyStr === 'userSelect') {\r\n            style.webkitUserSelect = styleObj[keyStr]; // safari\r\n        }\r\n    }\r\n}\r\n\r\nexport function setAttributes (el: HTMLElement, attrObj: IKeyString): void {\r\n    const keyArr = Object.keys(attrObj);\r\n    let keyStr;\r\n    for (let i = 0; i < keyArr.length; i++) {\r\n        keyStr = keyArr[i];\r\n        el.setAttribute(keyStr, attrObj[keyStr]);\r\n    }\r\n}\r\n\r\n/**\r\n * appendChild with an array\r\n * @param target\r\n * @param els\r\n */\r\nexport function append(target: HTMLElement, els: (HTMLElement | string | null)[]) {\r\n    const fragment = document.createDocumentFragment();\r\n    els.forEach(item => item ? fragment.append(item) : null);\r\n    target.append(fragment);\r\n}\r\n\r\n/**\r\n * a needs to fit into b\r\n * @param aw\r\n * @param ah\r\n * @param bw\r\n * @param bh\r\n * @param min\r\n */\r\nexport function fitInto (aw: number, ah: number, bw: number, bh: number, min?: number): ISize2D {\r\n    let width = aw * bw, height = ah * bw;\r\n    if (width > bw) {\r\n        height = bw / width * height;\r\n        width = bw;\r\n    }\r\n    if (height > bh) {\r\n        width = bh / height * width;\r\n        height = bh;\r\n    }\r\n    if (min) {\r\n        width = Math.max(min, width);\r\n        height = Math.max(min, height);\r\n    }\r\n    return {width, height};\r\n}\r\n\r\n/**\r\n * center b in a\r\n * @param aw\r\n * @param ah\r\n * @param bw\r\n * @param bh\r\n */\r\nexport function centerWithin (aw: number, ah: number, bw: number, bh: number): IVector2D {\r\n    return {\r\n        x: aw / 2 - bw / 2,\r\n        y: ah / 2 - bh / 2\r\n    };\r\n}\r\n\r\nexport function getDate (): string {\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\r\n    const day = date.getDate().toString().padStart(2, '0');\r\n    const minutes = (date.getHours() * 60 + date.getMinutes()).toString(36).padStart(3, '0');\r\n\r\n    return year + '_' + month + '_' + day + '_' + minutes + '_';\r\n}\r\n\r\nexport function gcd (a: number, b: number): number {\r\n    return b ? gcd(b, a % b) : a;\r\n}\r\n\r\nexport function reduce (numerator: number, denominator: number): [number, number] {\r\n    const g = gcd(numerator, denominator);\r\n    return [numerator / g, denominator / g];\r\n}\r\n\r\nexport function decToFraction (decimalNumber: number): [number, number] {\r\n    const len = decimalNumber.toString().length - 2;\r\n    const denominator = Math.pow(10, len);\r\n    const numerator = decimalNumber * denominator;\r\n    return reduce(numerator, denominator);\r\n}\r\n\r\n/**\r\n * blobObj isn't always a Blob, but rather an object, because Blob doesn't exist.\r\n * @param blobObj\r\n * @returns {string}\r\n */\r\nexport function imageBlobToUrl(blobObj: Blob): string {\r\n    if (!blobObj) {\r\n        throw new Error('blobObj is undefined or null');\r\n    }\r\n    if (window.Blob && blobObj instanceof Blob) {\r\n        return URL.createObjectURL(blobObj); // object url\r\n    } else if (blobObj.constructor.name === 'Object') {\r\n        const fauxBlob = (blobObj as unknown) as {type: string, encoding: string, data: string};\r\n        return 'data:' + fauxBlob.type + ';' + fauxBlob.encoding + ',' + fauxBlob.data; // data url\r\n    } else {\r\n        throw new Error('unknown blob format');\r\n    }\r\n}\r\n\r\nexport function dateDayDifference (dateA: string | Date, dateB: string | Date): number {\r\n    dateA = new Date(dateA);\r\n    dateB = new Date(dateB);\r\n    dateA.setHours(0, 0, 0, 0);\r\n    dateB.setHours(0, 0, 0, 0);\r\n    return (dateB.getTime() - dateA.getTime()) / (1000 * 60 * 60 * 24);\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\r\nexport function copyObj (obj: any): any {\r\n    return JSON.parse(JSON.stringify(obj));\r\n}\r\n\r\n/**\r\n * triggers Web Share API - share feature on mobile devices\r\n * Only works if they support file sharing - e.g. Safari can't do this yet\r\n * only call if BB.canShareFiles() -> true\r\n *\r\n * p = {\r\n *     canvas: Canvas,\r\n *     fileName: string,\r\n *     title: string\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function shareCanvas (p: {canvas: HTMLCanvasElement, fileName:string, title: string, callback: () => void}): void {\r\n    const mimetype = 'image/png';\r\n    const err = () => alert('sharing not supported');\r\n    p.canvas.toBlob(function(blob) {\r\n        if (blob === null) {\r\n            err();\r\n            p.callback();\r\n            return;\r\n        }\r\n        try {\r\n            const filesArray = [new File([blob], p.fileName, {type: mimetype})];\r\n            navigator.share({\r\n                title: p.title,\r\n                files: filesArray,\r\n            } as any)\r\n                .then(r => {\r\n\r\n                })\r\n                .catch(e => {\r\n                    err();\r\n            });\r\n        } catch(e) {\r\n            err();\r\n        }\r\n        p.callback();\r\n    }, mimetype);\r\n}\r\n\r\n/**\r\n * Prevent ipad from zooming in when double tapping. iPadOS 13 bug.\r\n * Give it your click event\r\n *\r\n * @param clickEvent\r\n * @returns {boolean}\r\n */\r\nexport function handleClick (clickEvent: MouseEvent): boolean {\r\n    const target: HTMLElement | null = clickEvent.target as HTMLElement;\r\n    if (!target) {\r\n        return false;\r\n    }\r\n    if (['A', 'LABEL', 'INPUT'].includes(target.tagName) || (target as any).allowClick) {\r\n        return true;\r\n    }\r\n    clickEvent.preventDefault();\r\n    return false;\r\n}\r\n\r\n\r\n/**\r\n * @param el {elementType: string, childrenArr: []el, ...svg attributes...}\r\n * @returns svg element tree\r\n */\r\nexport function createSvg (el: ISVG): SVGElement {\r\n    const result = document.createElementNS('http://www.w3.org/2000/svg', el.elementType);\r\n    const keyArr = Object.keys(el);\r\n    let keyStr;\r\n    for (let i = 0; i < keyArr.length; i++) {\r\n        keyStr = keyArr[i];\r\n        if (keyStr === 'childrenArr') {\r\n            for (let e = 0; e < el.childrenArr.length; e++) {\r\n                result.appendChild(createSvg(el.childrenArr[e]));\r\n            }\r\n        } else if (keyStr !== 'elementType') {\r\n            result.setAttribute(keyStr, el[keyStr] as string);\r\n        }\r\n    }\r\n    return result;\r\n}","import {addEventListener, removeEventListener} from './event-listener';\r\n\r\n\r\nconst globalKey = (() => {\r\n\r\n    const keyStrToKeyObj = { // keyStr not to contain a '+', because that's used for the comboStr\r\n        'space': [' ', 'Spacebar'], // Spacebar in IE\r\n        'alt': ['Alt', 'AltGraph'],\r\n        'shift': 'Shift',\r\n        'ctrl': 'Control',\r\n        'cmd': ['Meta', 'MetaLeft', 'MetaRight'],\r\n        'enter': 'Enter',\r\n        'esc': 'Escape',\r\n        'backspace': 'Backspace',\r\n        'delete': 'Delete',\r\n        'sqbr_open': '[',\r\n        'sqbr_close': ']',\r\n        'a': ['a', 'A'],\r\n        'b': ['b', 'B'],\r\n        'c': ['c', 'C'],\r\n        'e': ['e', 'E'],\r\n        'f': ['f', 'F'],\r\n        'g': ['g', 'G'],\r\n        'r': ['r', 'R'], // when holding shift\r\n        's': ['s', 'S'],\r\n        't': ['t', 'T'],\r\n        'u': ['u', 'U'],\r\n        'x': ['x', 'X'],\r\n        'y': ['y', 'Y'],\r\n        'z': ['z', 'Z'],\r\n        'plus': '+',\r\n        'minus': '-',\r\n        'left': 'ArrowLeft',\r\n        'right': 'ArrowRight',\r\n        'up': 'ArrowUp',\r\n        'down': 'ArrowDown',\r\n        'home': 'Home',\r\n        'end': 'End'\r\n    };\r\n    const keyToKeyStrArr = Object.keys(keyStrToKeyObj);\r\n    const isDownObj = {};\r\n    const keyToKeyStrObj = {}; // event.key to keyStr { ArrowLeft: 'left', ... }\r\n    let comboArr = [];\r\n    //a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\r\n    let codeIsDownObj = {}; // { KeyE: 'e', KeyF: null } - null not down, string, the associated keyStr\r\n    const listenerArr = [];\r\n\r\n    for (let i = 0; i < keyToKeyStrArr.length; i++) {\r\n        isDownObj[keyToKeyStrArr[i]] = false;\r\n\r\n        const code = keyStrToKeyObj[keyToKeyStrArr[i]];\r\n        if (typeof code === 'string') {\r\n            keyToKeyStrObj[keyStrToKeyObj[keyToKeyStrArr[i]]] = keyToKeyStrArr[i];\r\n        } else {\r\n            for (let e = 0; e < code.length; e++) {\r\n                keyToKeyStrObj[code[e]] = keyToKeyStrArr[i];\r\n            }\r\n        }\r\n    }\r\n\r\n    function emitDown(a, b, c, d?) {\r\n        listenerArr.forEach(item => {\r\n            if (!item[0]) {\r\n                return;\r\n            }\r\n            item[0](a, b, c, d);\r\n        });\r\n    }\r\n\r\n    function emitUp(a, b, c) {\r\n        listenerArr.forEach(item => {\r\n            if (!item[1]) {\r\n                return;\r\n            }\r\n            item[1](a, b, c);\r\n        });\r\n    }\r\n\r\n    function emitBlur() {\r\n        listenerArr.forEach(item => {\r\n            if (!item[2]) {\r\n                return;\r\n            }\r\n            item[2]();\r\n        });\r\n    }\r\n\r\n    function keyDown(e) {\r\n        const key = e.key;\r\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\r\n\r\n        if (key in keyToKeyStrObj) {\r\n            const keyStr = keyToKeyStrObj[key];\r\n            if (isDownObj[keyStr]) {\r\n                emitDown(keyStr, e, comboArr.join('+'), true);\r\n                return;\r\n            }\r\n            isDownObj[keyStr] = true;\r\n            codeIsDownObj[code] = keyStr;\r\n\r\n            //add to combo\r\n            comboArr.push(keyStr);\r\n\r\n            emitDown(keyStr, e, comboArr.join('+'));\r\n        }\r\n    }\r\n\r\n\r\n    function keyUp(e) {\r\n        const key = e.key;\r\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\r\n        const oldComboStr = comboArr.join('+');\r\n\r\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\r\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\r\n        if ([\r\n            'Meta', 'MetaLeft', 'MetaRight',\r\n            'OSLeft', 'OSRight', // Firefox\r\n        ].includes(code)) {\r\n            blur(null);\r\n            return;\r\n        }\r\n\r\n        if (code in codeIsDownObj && codeIsDownObj[code] !== null) {\r\n            const keyStr = codeIsDownObj[code];\r\n            isDownObj[keyStr] = false;\r\n            codeIsDownObj[code] = null;\r\n\r\n            //remove from combo\r\n            for (let i = 0; i < comboArr.length; i++) {\r\n                if (comboArr[i] == keyStr) {\r\n                    comboArr.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n\r\n            emitUp(keyStr, e, oldComboStr);\r\n        }\r\n    }\r\n\r\n    function blur(event) {\r\n        const oldComboStr = comboArr.join('+');\r\n        comboArr = [];\r\n        codeIsDownObj = {};\r\n\r\n        const eventArr = [];\r\n        for (let i = 0; i < keyToKeyStrArr.length; i++) {\r\n            if (isDownObj[keyToKeyStrArr[i]]) {\r\n                isDownObj[keyToKeyStrArr[i]] = false;\r\n                eventArr.push(keyToKeyStrArr[i]);\r\n            }\r\n        }\r\n        for (let i = 0; i < eventArr.length; i++) {\r\n            emitUp(\r\n                eventArr[i],\r\n                {\r\n                    preventDefault: function () {},\r\n                    stopPropagation: function () {},\r\n                },\r\n                oldComboStr,\r\n            );\r\n        }\r\n        emitBlur();\r\n    }\r\n\r\n\r\n\r\n    return {\r\n        add: (keyListener) => {\r\n            if (listenerArr.includes(keyListener)) {\r\n                return;\r\n            }\r\n            const first = listenerArr.length === 0;\r\n            listenerArr.push(keyListener);\r\n\r\n            if (first) {\r\n                addEventListener(document, 'keydown', keyDown);\r\n                addEventListener(document, 'keyup', keyUp);\r\n                addEventListener(window, 'blur', blur);\r\n            }\r\n        },\r\n        remove: (keyListener) => {\r\n            if (!listenerArr.includes(keyListener)) {\r\n                return;\r\n            }\r\n            const last = listenerArr.length === 1;\r\n            for (let i = 0; i < listenerArr.length; i++) {\r\n                if (listenerArr[i] === keyListener) {\r\n                    listenerArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n            if (last) {\r\n                removeEventListener(document, 'keydown', keyDown);\r\n                removeEventListener(document, 'keyup', keyUp);\r\n                removeEventListener(window, 'blur', blur);\r\n            }\r\n        },\r\n        getIsDown: () => {\r\n            return isDownObj;\r\n        },\r\n        getCombo: () => {\r\n            return comboArr;\r\n        },\r\n    };\r\n})();\r\n\r\n\r\n\r\n/**\r\n * Listens to key events in window. Makes combos easier - e.g. ctrl + z\r\n *\r\n * keyStr - see in implementation - my representation of a key. e.g. 'r' can be 'r' and 'R'\r\n * comboStr - string joins currently pressed keyStr with a +\r\n *              e.g. 'ctrl+z'\r\n *\r\n */\r\nexport class KeyListener {\r\n\r\n    private readonly onDown;\r\n    private readonly onUp;\r\n    private readonly onBlur;\r\n    private readonly ref;\r\n\r\n    constructor (\r\n        p: {\r\n            onDown?: (keyStr: string, e: KeyboardEvent, comboStr: string, isRepeat?: boolean) => void;\r\n            onUp?: (keyStr: string, e: KeyboardEvent, oldComboStr: string) => void;\r\n            onBlur?: () => void;\r\n        },\r\n    ) {\r\n        this.onDown = p.onDown;\r\n        this.onUp = p.onUp;\r\n        this.onBlur = p.onBlur;\r\n        this.ref = [this.onDown, this.onUp, this.onBlur];\r\n        globalKey.add(this.ref);\r\n    }\r\n\r\n    isPressed (keyStr: string): boolean {\r\n        if (!(keyStr in globalKey.getIsDown())) {\r\n            throw 'key \"' + keyStr + '\" not found';\r\n        }\r\n        return globalKey.getIsDown()[keyStr];\r\n    }\r\n\r\n    getComboStr (): string {\r\n        return globalKey.getCombo().join('+');\r\n    }\r\n\r\n    comboOnlyContains (keyStrArr: string[]): boolean {\r\n        for (let i = 0; i < globalKey.getCombo().length; i++) {\r\n            if (!keyStrArr.includes(globalKey.getCombo()[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    destroy (): void {\r\n        globalKey.remove(this.ref);\r\n    }\r\n}\r\n\r\nexport function sameKeys(comboAStr: string, comboBStr: string): boolean {\r\n    return comboAStr.split('+').sort().join('+')=== comboBStr.split('+').sort().join('+');\r\n}","import {addEventListener, removeEventListener} from './event-listener';\r\n\r\n\r\n/**\r\n * Filters wheel events. removes swipe scrolling and pinch scrolling that trackpads do. (as best as it can)\r\n * Normalizes regular scrolls.\r\n *\r\n * Why:\r\n * - trackpad scrolling is different from old school mouse scrolling\r\n * - but there is not way to learn from the browser if it's trackpad scrolling\r\n * - browsers don't even give access to the raw swiping or pinching movement, but some abstraction on top, making the scrolling\r\n *      continue an arbitrary amount, at an arbitrary scale\r\n * - each browser does this differently. So you can't offer a coherent experience\r\n *\r\n * - also trackpads are painful to draw with. So supporting a trackpad-based workflow makes not much sense.\r\n *\r\n * @param callback - func({deltaY: number, pageX: number, pageY: number, clientX: number, clientY: number}\r\n * @constructor\r\n */\r\nimport {eventUsesHighResTimeStamp, hasPointerEvents, isFirefox} from '../base/browser';\r\nimport {mix} from '../math/math';\r\n\r\nconst WheelCleaner = function (callback) {\r\n    const sequenceTimeoutMs = 200;\r\n\r\n    const knownUnitArr = [100];\r\n    let sequenceLength = 0;\r\n    let sequenceUnit = null;\r\n    let endSequenceTimeout;\r\n    let toEmitDelta = null;\r\n    let position = null;\r\n\r\n\r\n    function emit(delta) {\r\n        callback({\r\n            deltaY: Math.round(delta / sequenceUnit),\r\n            pageX: position.pageX,\r\n            pageY: position.pageY,\r\n            clientX: position.clientX,\r\n            clientY: position.clientY,\r\n        });\r\n    }\r\n\r\n    function endSequence() {\r\n        if (toEmitDelta !== null) {\r\n            emit(toEmitDelta);\r\n            toEmitDelta = null;\r\n        }\r\n        if (sequenceUnit !== null && !(knownUnitArr.includes(sequenceUnit))) {\r\n            knownUnitArr.push(sequenceUnit);\r\n        }\r\n        sequenceLength = 0;\r\n        sequenceUnit = null;\r\n    }\r\n\r\n    // --- interface ---\r\n    this.process = function (event) {\r\n\r\n        position = {\r\n            pageX: event.pageX,\r\n            pageY: event.pageY,\r\n            clientX: event.clientX,\r\n            clientY: event.clientY,\r\n        };\r\n\r\n        clearTimeout(endSequenceTimeout);\r\n        endSequenceTimeout = setTimeout(endSequence, sequenceTimeoutMs);\r\n\r\n        //prep delta\r\n        let delta = event.deltaY;\r\n        if ('deltaMode' in event && event.deltaMode === 1) {\r\n            delta *= 100 / 3;\r\n        }\r\n        const absDelta = Math.abs(delta);\r\n\r\n\r\n        if (sequenceLength > 0 && sequenceUnit === null) {\r\n            //previously determined dirty sequence\r\n            toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n        //sequence begins\r\n        if (sequenceLength === 0) {\r\n            sequenceLength++;\r\n            if (absDelta < 50) {\r\n                //dirty - probably a swipe scroll or pinch scroll on trackpad\r\n                return;\r\n            }\r\n\r\n            sequenceUnit = absDelta;\r\n            if (knownUnitArr.includes(sequenceUnit)) {\r\n                //we know this unit - emit right away\r\n                emit(delta);\r\n            } else {\r\n                //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\r\n                toEmitDelta = delta;\r\n            }\r\n            return;\r\n        }\r\n\r\n        //sequence continues\r\n        if (absDelta === 0) {\r\n            //ignore zero scroll\r\n            return;\r\n        }\r\n        if (\r\n            absDelta === sequenceUnit ||\r\n            (absDelta / sequenceUnit) % 1 < 0.0001// a multiple\r\n        ) {\r\n            //fine\r\n        } else if ((sequenceUnit / absDelta) % 1 < 0.0001) {\r\n            //unit was actually a multiple - update it\r\n            sequenceUnit = absDelta;\r\n\r\n        } else if (absDelta !== sequenceUnit) {\r\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\r\n            sequenceUnit = null;\r\n            toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n\r\n        if (toEmitDelta !== null) {\r\n            emit(toEmitDelta);\r\n            toEmitDelta = null;\r\n        }\r\n        emit(delta);\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * PointerListener - for pointer events, wheel events. uses fallbacks. ideally consistent behavior across browsers\r\n * Has some workarounds for browser specific bugs. As browsers get better, this constructor should get smaller\r\n *\r\n * p = {\r\n *     target: DOM element,\r\n *     onPointer: func (pointerEvent), //optional\r\n *     onWheel: func (wheelEvent), //optional\r\n *     onEnterLeave: func (isOver: boolean), //optional\r\n *     maxPointers: int (1 - n), //default is 1\r\n *     fixScribble: boolean, // fix ipad scribble issue\r\n * }\r\n *\r\n * pointerEvent = {\r\n *     type: 'pointerdown'|'pointermove'|'pointerup',\r\n *     pointerId: long,\r\n *     pointerType: 'touch'|'mouse'|'pen',\r\n *     pageX: number,\r\n *     pageY: number,\r\n *     clientX: number,\r\n *     clientY: number,\r\n *     relX: number, //position relative to top left of target\r\n *     relY: number,\r\n *     dX: number, //movementX not supported by safari on iOS, so need my own\r\n *     dY: number,\r\n *     downPageX: number, //where was pointer when down-event occurred - set for down|move|up\r\n *     downPageY: number,\r\n *     coalescedArr: Array of {\r\n *         pageX: number,\r\n *         pageY: number,\r\n *         clientX: number,\r\n *         clientY: number,\r\n *         relX: number, //position relative to top left of target\r\n *         relY: number,\r\n *         dX: number,\r\n *         dY: number,\r\n *         time: number// same timescale as performance.now() - might be exact same number as in parent\r\n *     },\r\n *     time: number, // same timescale as performance.now()\r\n *     button: 'left'|'middle'|'right',\r\n *     pressure: number (0-1), // always 1 for touch and mouse\r\n *     eventPreventDefault: function(),\r\n *     eventStopPropagation: function(),\r\n * }\r\n *\r\n * wheelEvent = {\r\n *     deltaY: number, // increments of 1\r\n *     pageX: number,\r\n *     pageY: number,\r\n *     relX: number,\r\n *     relY: number,\r\n * }\r\n *\r\n * isOver(): boolean - if pointer over the target\r\n *\r\n * @param p\r\n */\r\nexport const PointerListener = (function () {\r\n\r\n    //keeping track of pointers for movement fallback\r\n    const pointerArr = [];\r\n\r\n    function addPointer(event) {\r\n        const pointerObj = {\r\n            pointerId: event.pointerId,\r\n            lastPageX: null,\r\n            lastPageY: null\r\n        };\r\n        pointerArr.push(pointerObj);\r\n\r\n        if (pointerArr.length > 15) {\r\n            pointerArr.shift();\r\n        }\r\n\r\n        return pointerObj;\r\n    }\r\n\r\n    function getPointer(event) {\r\n        for (let i = pointerArr.length - 1; i >= 0; i--) {\r\n            if (event.pointerId === pointerArr[i].pointerId) {\r\n                return pointerArr[i];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    let pressureNormalizeAvgCount = 0;\r\n    let pressureNormalizeAvgPressure = null;\r\n    let pressureNormalizeIsComplete = false;\r\n    let pressureNormalizeFactor = 1;\r\n\r\n    return function (p) {\r\n        const targetElement = p.target;\r\n        const onPointerCallback = p.onPointer;\r\n        const onWheelCallback = p.onWheel;\r\n        const onEnterLeaveCallback = p.onEnterLeave;\r\n        const maxPointers = 'maxPointers' in p ? p.maxPointers : 1;\r\n        const buttonsToStr = { // translation\r\n            '1': 'left',\r\n            '2': 'right',\r\n            '4': 'middle'\r\n        };\r\n        const wheelCleaner = new WheelCleaner(function (wheelEvent) {\r\n            if (isDestroyed) {\r\n                return;\r\n            }\r\n            if (onWheelCallback) {\r\n                const bounds = targetElement.getBoundingClientRect();\r\n                wheelEvent.relX = wheelEvent.clientX - bounds.left + targetElement.scrollLeft;\r\n                wheelEvent.relY = wheelEvent.clientY - bounds.top + targetElement.scrollTop;\r\n                onWheelCallback(wheelEvent);\r\n            }\r\n        });\r\n        let isDestroyed = false;\r\n\r\n        const timeStampOffset = eventUsesHighResTimeStamp() ? 0 : -performance.timing.navigationStart;\r\n\r\n\r\n        //to circumvent a chrome input glitch\r\n        let lastPointerType = '';\r\n        let didSkip = false;\r\n\r\n\r\n        /*\r\n        pointers that are pressing a button\r\n        dragObj = {\r\n            pointerId: long,\r\n            pointerType: 'mouse'|'pen'|'touch',\r\n            downPageX: number, //where was pointer when down-event occurred\r\n            downPageY: number,\r\n            button: long,\r\n            lastPageX: number, //pageX in previous event - only for touch events, because they don't have movementX/Y\r\n            lastPageY: number,\r\n            lastTimeStamp: number\r\n        }\r\n         */\r\n        const dragObjArr = [];\r\n        const dragPointerIdArr = [];\r\n\r\n        function getDragObj(pointerId) {\r\n            for (let i = 0; i < dragObjArr.length; i++) {\r\n                if (pointerId === dragObjArr[i].pointerId) {\r\n                    return dragObjArr[i];\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        function removeDragObj(pointerId) {\r\n            let removedDragObj = null;\r\n            for (let i = 0; i < dragPointerIdArr.length; i++) {\r\n                if (dragPointerIdArr[i] === pointerId) {\r\n                    removedDragObj = dragObjArr[i];\r\n                    dragObjArr.splice(i, 1);\r\n                    dragPointerIdArr.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n            return removedDragObj;\r\n        }\r\n\r\n\r\n        function normalizePressure(pressure, type?) {\r\n            if (pressure === 0 || pressure === 1) {\r\n                return pressure;\r\n            }\r\n\r\n            // was this there to prevent some glitch?\r\n            /*if (pressureNormalizeIsComplete && type === 'pointerdown' && pressure !== 1) {\r\n                pressure *= 0.004;\r\n            }*/\r\n\r\n            if (pressureNormalizeAvgCount < 60) {\r\n                if (pressureNormalizeAvgCount === 0) {\r\n                    pressureNormalizeAvgPressure = pressure;\r\n                } else {\r\n                    pressureNormalizeAvgPressure = mix(pressure, pressureNormalizeAvgPressure, 0.95);\r\n                }\r\n                pressureNormalizeAvgCount++;\r\n            } else if (!pressureNormalizeIsComplete) {\r\n                pressureNormalizeIsComplete = true;\r\n                //BB.throwOut('avg pressure decision!' + pressureNormalizeAvgPressure);\r\n                if (pressureNormalizeAvgPressure < 0.13) { // absurd pressure needed\r\n                    pressureNormalizeFactor = 2.3;\r\n                }\r\n            }\r\n\r\n\r\n            return Math.pow(pressure, 1 / pressureNormalizeFactor);\r\n        }\r\n\r\n\r\n        /**\r\n         *\r\n         * More trustworthy pointer attributes. that behave the same across browsers.\r\n         * returns a new object. this object also gets attached to the orig event. -> event.corrected\r\n         *\r\n         * @param event\r\n         * @returns {{pointerId: number, timeStamp: number, button, buttons, pointerType: (string|string|any), movementY: number, movementX: number, pressure, coalescedArr: [], pageY, pageX, clientX, clientY, eventPreventDefault: func, eventStopPropagation: func}\r\n         */\r\n        function correctPointerEvent(event) {\r\n            if (event.corrected) {\r\n                return event.corrected;\r\n            }\r\n\r\n            /*if (event.type === 'pointermove' && !window.hidePressureOut) {\r\n                if (event.type === 'pointermove') {\r\n                    BB.throwOut(event.pressure + ' ' + event.pointerType);\r\n                }\r\n            }*/\r\n\r\n            const correctedObj = {\r\n                pointerId: event.pointerId,\r\n                pointerType: event.pointerType,\r\n                pageX: event.pageX,\r\n                pageY: event.pageY,\r\n                clientX: event.clientX,\r\n                clientY: event.clientY,\r\n                movementX: event.movementX,\r\n                movementY: event.movementY,\r\n                timeStamp: event.timeStamp + timeStampOffset,\r\n                pressure: normalizePressure(event.pressure, event.type),\r\n                buttons: event.buttons,\r\n                button: event.button,\r\n                coalescedArr: [],\r\n                eventPreventDefault: function () {\r\n                    event.preventDefault();\r\n                },\r\n                eventStopPropagation: function () {\r\n                    event.stopPropagation();\r\n                }\r\n            };\r\n            event.corrected = correctedObj;\r\n\r\n            let customPressure = null;\r\n            if ('pointerId' in event) {\r\n                if ('pressure' in event && event.buttons !== 0 && (['mouse'].includes(event.pointerType) || (event.pointerType === 'touch' && event.pressure === 0))) {\r\n                    correctedObj.pressure = 1;\r\n                    customPressure = 1;\r\n                }\r\n            } else {\r\n                correctedObj.pointerId = 0;\r\n                correctedObj.pointerType = 'mouse';\r\n                correctedObj.pressure = event.buttons !== 0 ? 1 : 0;\r\n                customPressure = correctedObj.pressure;\r\n            }\r\n\r\n            if (isFirefox && event.pointerType != 'mouse' && event.type === 'pointermove' && event.buttons === 0) { // once again firefox\r\n                correctedObj.buttons = 1; //todo wrong if no buttons actually pressed\r\n            }\r\n\r\n            let coalescedEventArr = [];\r\n            if ('getCoalescedEvents' in event) {\r\n                coalescedEventArr = event.getCoalescedEvents();\r\n            }\r\n\r\n            // chrome somehow movementX not same scale as pageX. todo: only chrome?\r\n            // so make my own\r\n\r\n            let pointerObj = getPointer(correctedObj);\r\n            if (pointerObj === null) {\r\n                pointerObj = addPointer(correctedObj);\r\n            }\r\n\r\n            const totalLastX = pointerObj.lastPageX;\r\n            const totalLastY = pointerObj.lastPageY;\r\n\r\n            for (let i = 0; i < coalescedEventArr.length; i++) {\r\n                const eventItem = coalescedEventArr[i];\r\n\r\n                correctedObj.coalescedArr.push({\r\n                    pageX: eventItem.pageX,\r\n                    pageY: eventItem.pageY,\r\n                    clientX: eventItem.clientX,\r\n                    clientY: eventItem.clientY,\r\n                    movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\r\n                    movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\r\n                    timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : (eventItem.timeStamp + timeStampOffset), // 0 in firefox\r\n                    pressure: customPressure === null ? normalizePressure(eventItem.pressure) : customPressure\r\n                });\r\n\r\n                pointerObj.lastPageX = eventItem.pageX;\r\n                pointerObj.lastPageY = eventItem.pageY;\r\n            }\r\n\r\n            pointerObj.lastPageX = correctedObj.pageX;\r\n            pointerObj.lastPageY = correctedObj.pageY;\r\n            correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\r\n            correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\r\n\r\n            return correctedObj;\r\n\r\n        }\r\n\r\n        /**\r\n         * creates a value for onPointer, from a pointer event handler\r\n         *\r\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\r\n         * @param correctedEvent - corrected pointer event from correctPointerEvent()\r\n         * @param custom - object for setting custom attributes\r\n         * @returns {{pointerId: number, pointerType: *, dX: (*), relY: number, dY: (*), relX: number, type: *, event: *, pageY: *, pageX: *}}\r\n         */\r\n        function createPointerOutEvent(typeStr, correctedEvent, custom?) {\r\n\r\n            const bounds = targetElement.getBoundingClientRect();\r\n            const result: any = {\r\n                type: typeStr,\r\n                pointerId: correctedEvent.pointerId,\r\n                pointerType: correctedEvent.pointerType,\r\n                pageX: correctedEvent.pageX,\r\n                pageY: correctedEvent.pageY,\r\n                clientX: correctedEvent.clientX,\r\n                clientY: correctedEvent.clientY,\r\n                relX: correctedEvent.clientX - bounds.left + targetElement.scrollLeft,\r\n                relY: correctedEvent.clientY - bounds.top + targetElement.scrollTop,\r\n                dX: correctedEvent.movementX,\r\n                dY: correctedEvent.movementY,\r\n                time: correctedEvent.timeStamp,\r\n                eventPreventDefault: correctedEvent.eventPreventDefault,\r\n                eventStopPropagation: correctedEvent.eventStopPropagation\r\n            };\r\n\r\n            if (typeStr === 'pointermove') {\r\n                result.coalescedArr = [];\r\n                if (correctedEvent.coalescedArr.length > 1) {\r\n                    let coalescedItem;\r\n                    for (let i = 0; i < correctedEvent.coalescedArr.length; i++) {\r\n                        coalescedItem = correctedEvent.coalescedArr[i];\r\n                        result.coalescedArr.push({\r\n                            pageX: coalescedItem.pageX,\r\n                            pageY: coalescedItem.pageY,\r\n                            clientX: coalescedItem.clientX,\r\n                            clientY: coalescedItem.clientY,\r\n                            relX: coalescedItem.clientX - bounds.left + targetElement.scrollLeft,\r\n                            relY: coalescedItem.clientY - bounds.top + targetElement.scrollTop,\r\n                            dX: coalescedItem.movementX,\r\n                            dY: coalescedItem.movementY,\r\n                            time: coalescedItem.timeStamp\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (custom) {\r\n                const keyArr = Object.keys(custom);\r\n                for (let i = 0; i < keyArr.length; i++) {\r\n                    result[keyArr[i]] = custom[keyArr[i]];\r\n                }\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        /**\r\n         * creates a value for onPointer, from a fallback touch event handler\r\n         *\r\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\r\n         * @param touchListItem - element from changed touch list\r\n         * @param touchEvent - touch event\r\n         * @param custom - object for setting custom attributes\r\n         * @returns {{pointerId: number, pointerType: string, relY: number, relX: number, type: *, event: *, pageY: *, pageX: *}}\r\n         */\r\n        function createTouchOutEvent(typeStr, touchListItem, touchEvent, custom) {\r\n            const bounds = targetElement.getBoundingClientRect();\r\n            const result: any = {\r\n                type: typeStr,\r\n                pointerId: touchListItem.identifier,\r\n                pointerType: 'touch',\r\n                pageX: touchListItem.pageX,\r\n                pageY: touchListItem.pageY,\r\n                clientX: touchListItem.clientX,\r\n                clientY: touchListItem.clientY,\r\n                relX: touchListItem.pageX - bounds.left + targetElement.scrollLeft,\r\n                relY: touchListItem.pageY - bounds.top + targetElement.scrollTop,\r\n                time: touchEvent.timeStamp + timeStampOffset,\r\n                eventPreventDefault: function() { touchEvent.preventDefault(); },\r\n                eventStopPropagation: function() { touchEvent.stopPropagation(); }\r\n            };\r\n\r\n            if (typeStr === 'pointermove') {\r\n                result.coalescedArr = [];\r\n            }\r\n\r\n            const keyArr = Object.keys(custom);\r\n            for (let i = 0; i < keyArr.length; i++) {\r\n                result[keyArr[i]] = custom[keyArr[i]];\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        function setupDocumentListeners() {\r\n            addEventListener(document, 'pointermove', onGlobalPointerMove);\r\n            addEventListener(document, 'pointerup', onGlobalPointerUp);\r\n            addEventListener(document, 'pointerleave', onGlobalPointerLeave);\r\n        }\r\n\r\n        function destroyDocumentListeners() {\r\n            removeEventListener(document, 'pointermove', onGlobalPointerMove);\r\n            removeEventListener(document, 'pointerup', onGlobalPointerUp);\r\n            removeEventListener(document, 'pointerleave', onGlobalPointerLeave);\r\n        }\r\n\r\n        let isOverCounter = 0; // might be multiple pointers\r\n        function onPointerEnter() {\r\n            isOverCounter++;\r\n            if (onEnterLeaveCallback) {\r\n                onEnterLeaveCallback(true);\r\n            }\r\n        }\r\n\r\n        function onPointerLeave() {\r\n            isOverCounter--;\r\n            if (onEnterLeaveCallback) {\r\n                onEnterLeaveCallback(false);\r\n            }\r\n        }\r\n\r\n        function onPointermove(event) {\r\n            event = correctPointerEvent(event);\r\n\r\n            const tempLastPointerType = lastPointerType;\r\n            lastPointerType = event.pointerType;\r\n\r\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || event.pointerType === 'touch') {\r\n                didSkip = false;\r\n                return;\r\n            }\r\n\r\n            // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\r\n            if (!didSkip && event.pointerType === 'mouse' && tempLastPointerType === 'pen') {\r\n                didSkip = true;\r\n                return;\r\n            }\r\n            didSkip = false;\r\n\r\n            const outEvent = createPointerOutEvent('pointermove', event);\r\n            onPointerCallback(outEvent);\r\n\r\n        }\r\n\r\n        function onPointerdown(event) {\r\n            //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' pointerdown');\r\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || !([1, 2, 4].includes(event.buttons))) {\r\n                //BB.throwOut('pointerdown ignored');\r\n                return;\r\n            }\r\n\r\n\r\n            //set up global listeners\r\n            if (dragObjArr.length === 0) {\r\n                setupDocumentListeners();\r\n            }\r\n            const dragObj = {\r\n                pointerId: event.pointerId,\r\n                pointerType: event.pointerType,\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY,\r\n                buttons: event.buttons,\r\n                lastPageX: event.pageX,\r\n                lastPageY: event.pageY,\r\n                lastTimeStamp: event.timeStamp\r\n            };\r\n            dragObjArr.push(dragObj);\r\n            setTouchTimeout(dragObj);\r\n            dragPointerIdArr.push(event.pointerId);\r\n\r\n            const outEvent = createPointerOutEvent('pointerdown', event, {\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY,\r\n                button: buttonsToStr[event.buttons],\r\n                pressure: event.pressure\r\n            });\r\n\r\n            onPointerCallback(outEvent);\r\n        }\r\n\r\n\r\n        function onGlobalPointerMove(event) {\r\n            //BB.throwOut('pointermove ' + event.pointerId);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\r\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\r\n                return;\r\n            }\r\n\r\n            const dragObj = getDragObj(event.pointerId);\r\n            clearTouchTimeout(dragObj);\r\n\r\n            //if pointer changes button its pressing -> turn into pointerup\r\n            if (event.buttons !== dragObj.buttons) {\r\n                //pointer up\r\n\r\n                //remove listener\r\n                if (dragObjArr.length === 1) {\r\n                    destroyDocumentListeners();\r\n                }\r\n                removeDragObj(event.pointerId);\r\n\r\n                const outEvent = createPointerOutEvent('pointerup', event, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY\r\n                });\r\n                onPointerCallback(outEvent);\r\n                return;\r\n\r\n            }\r\n\r\n            setTouchTimeout(dragObj);\r\n\r\n            // ipad likes to do this\r\n            if (\r\n                event.pointerType === 'pen' &&\r\n                event.pageX === dragObj.lastPageX &&\r\n                event.pageY === dragObj.lastPageY &&\r\n                event.timeStamp === dragObj.lastTimeStamp\r\n            ) {\r\n                //ignore\r\n                return;\r\n            }\r\n\r\n            const outEvent = createPointerOutEvent('pointermove', event, {\r\n                downPageX: dragObj.downPageX,\r\n                downPageY: dragObj.downPageY,\r\n                button: buttonsToStr[event.buttons],\r\n                pressure: event.pressure\r\n            });\r\n\r\n            dragObj.lastPageX = event.pageX;\r\n            dragObj.lastPageY = event.pageY;\r\n            dragObj.lastTimeStamp = event.timeStamp;\r\n\r\n            onPointerCallback(outEvent);\r\n\r\n        }\r\n\r\n        function onGlobalPointerUp(event) {\r\n            //BB.throwOut('pointerup ' + event.pointerId);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\r\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\r\n                return;\r\n            }\r\n\r\n            //remove listener\r\n            if (dragObjArr.length === 1) {\r\n                destroyDocumentListeners();\r\n            }\r\n            const dragObj = removeDragObj(event.pointerId);\r\n            clearTouchTimeout(dragObj);\r\n\r\n            const outEvent = createPointerOutEvent('pointerup', event, {\r\n                downPageX: dragObj.downPageX,\r\n                downPageY: dragObj.downPageY\r\n            });\r\n            onPointerCallback(outEvent);\r\n\r\n        }\r\n\r\n        function onGlobalPointerLeave(event) {\r\n            //BB.throwOut('pointerleave ' + event.pointerId);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\r\n            if (!(dragPointerIdArr.includes(event.pointerId))) { //} || event.target !== document) {\r\n                return;\r\n            }\r\n\r\n            //remove listener\r\n            if (dragObjArr.length === 1) {\r\n                destroyDocumentListeners();\r\n            }\r\n            const dragObj = removeDragObj(event.pointerId);\r\n            clearTouchTimeout(dragObj);\r\n\r\n            const outEvent = createPointerOutEvent('pointerup', event, {\r\n                downPageX: dragObj.downPageX,\r\n                downPageY: dragObj.downPageY\r\n            });\r\n            onPointerCallback(outEvent);\r\n        }\r\n\r\n\r\n        /*\r\n        --- ipad pointer event glitch damage control ---\r\n\r\n        ipad pointer events are glitchy. doesn't always fire pointerup.\r\n        - when two fingers get really close to each other\r\n        - when finger moves out and back in bottom\r\n\r\n        This artificially fires a pointerup\r\n        */\r\n        function onTouchTimeout(dragObj) {\r\n\r\n            //create fake event\r\n            const fakeEvent = {\r\n                pointerId: dragObj.pointerId,\r\n                pointerType: dragObj.pointerType,\r\n                type: 'pointerup',\r\n                timeStamp: performance.now(),\r\n                pageX: 0,\r\n                pageY: 0,\r\n                clientX: 0,\r\n                clientY: 0,\r\n                preventDefault: function () {\r\n                },\r\n                stopPropagation: function () {\r\n                }\r\n            };\r\n\r\n            //call onGlobalPointerUp with it\r\n            onGlobalPointerUp(fakeEvent);\r\n        }\r\n\r\n        function setTouchTimeout(dragObj) {\r\n            if (dragObj.pointerType !== 'touch') {\r\n                return;\r\n            }\r\n            dragObj.touchTimeout = setTimeout(function () {\r\n                onTouchTimeout(dragObj);\r\n            }, 2500); // 2.5 seconds\r\n        }\r\n\r\n        function clearTouchTimeout(dragObj) {\r\n            if (!dragObj.touchTimeout) {\r\n                return;\r\n            }\r\n            clearTimeout(dragObj.touchTimeout);\r\n            dragObj.touchTimeout = null;\r\n        }\r\n\r\n\r\n        if (onEnterLeaveCallback) {\r\n            addEventListener(targetElement, 'pointerenter', onPointerEnter);\r\n            addEventListener(targetElement, 'pointerleave', onPointerLeave);\r\n        }\r\n        if (onPointerCallback) {\r\n            addEventListener(targetElement, 'pointermove', onPointermove);\r\n            addEventListener(targetElement, 'pointerdown', onPointerdown);\r\n        }\r\n        if (onWheelCallback) {\r\n            addEventListener(targetElement, 'wheel', wheelCleaner.process);\r\n        }\r\n\r\n\r\n        let onTouchstart;\r\n        let onTouchmove;\r\n        let onTouchend;\r\n\r\n        // --- touch fallback ---\r\n        if (!(hasPointerEvents)) {\r\n\r\n            onTouchstart = function (event) {\r\n                ////console.log('onTouchstart', event, event.changedTouches.length);\r\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\r\n\r\n                const touchArr = event.changedTouches;\r\n                for (let i = 0; i < touchArr.length && dragObjArr.length < maxPointers; i++) {\r\n                    const touchObj = touchArr[i];\r\n\r\n                    //set up global listeners\r\n                    if (dragObjArr.length === 0) {\r\n                        addEventListener(document, 'touchmove', onTouchmove);\r\n                        addEventListener(document, 'touchend', onTouchend);\r\n                        addEventListener(document, 'touchcancel', onTouchend);\r\n                    }\r\n                    dragObjArr.push({\r\n                        pointerId: touchObj.identifier,\r\n                        downPageX: touchObj.pageX,\r\n                        downPageY: touchObj.pageY,\r\n                        buttons: 1,\r\n                        lastPageX: touchObj.pageX,\r\n                        lastPageY: touchObj.pageY,\r\n                    });\r\n                    dragPointerIdArr.push(touchObj.identifier);\r\n\r\n                    const outEvent = createTouchOutEvent('pointerdown', touchObj, event, {\r\n                        dX: 0,\r\n                        dY: 0,\r\n                        downPageX: touchObj.downPageX,\r\n                        downPageY: touchObj.downPageY,\r\n                        button: 'left',\r\n                        pressure: 1\r\n                    });\r\n                    onPointerCallback(outEvent);\r\n                }\r\n\r\n            }\r\n\r\n            onTouchmove = function (event) {\r\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\r\n\r\n\r\n                const touchArr = event.changedTouches;\r\n                for (let i = 0; i < touchArr.length; i++) {\r\n                    const touchObj = touchArr[i];\r\n\r\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\r\n                        continue;\r\n                    }\r\n                    const dragObj = getDragObj(touchObj.identifier);\r\n\r\n                    const outEvent = createTouchOutEvent('pointermove', touchObj, event, {\r\n                        dX: touchObj.pageX - dragObj.lastPageX,\r\n                        dY: touchObj.pageY - dragObj.lastPageY,\r\n                        downPageX: dragObj.downPageX,\r\n                        downPageY: dragObj.downPageY,\r\n                        button: 'left',\r\n                        isCoalesced: false,\r\n                        pressure: 1\r\n                    });\r\n                    dragObj.lastPageX = touchObj.pageX;\r\n                    dragObj.lastPageY = touchObj.pageY;\r\n                    onPointerCallback(outEvent);\r\n\r\n                }\r\n\r\n            }\r\n\r\n            onTouchend = function (event) {\r\n                if (event.type !== 'touchcancel') {\r\n                    event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\r\n                }\r\n\r\n\r\n                const touchArr = event.changedTouches;\r\n                for (let i = 0; i < touchArr.length; i++) {\r\n                    const touchObj = touchArr[i];\r\n\r\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\r\n                        continue;\r\n                    }\r\n\r\n                    //remove listener\r\n                    if (dragObjArr.length === 1) {\r\n                        removeEventListener(document, 'touchmove', onTouchmove);\r\n                        removeEventListener(document, 'touchend', onTouchend);\r\n                        removeEventListener(document, 'touchcancel', onTouchend);\r\n                    }\r\n                    const dragObj = removeDragObj(touchObj.identifier);\r\n\r\n                    const outEvent = createTouchOutEvent('pointerup', touchObj, event, {\r\n                        dX: touchObj.pageX - dragObj.lastPageX,\r\n                        dY: touchObj.pageY - dragObj.lastPageY,\r\n                        downPageX: dragObj.downPageX,\r\n                        downPageY: dragObj.downPageY,\r\n                    });\r\n\r\n                    onPointerCallback(outEvent);\r\n                }\r\n\r\n            }\r\n\r\n            if (onPointerCallback) {\r\n                addEventListener(targetElement, 'touchstart', onTouchstart);\r\n            }\r\n\r\n        } else if (p.fixScribble) {\r\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\r\n            onTouchmove = function(e) {\r\n                e.preventDefault();\r\n            }\r\n            addEventListener(targetElement, 'touchmove', onTouchmove);\r\n\r\n        }\r\n\r\n\r\n        // --- interface ---\r\n\r\n        this.isOver = function () {\r\n            return isOverCounter > 0;\r\n        };\r\n\r\n        this.destroy = function () {\r\n            if (isDestroyed) {\r\n                return;\r\n            }\r\n            isDestroyed = true;\r\n            removeEventListener(targetElement, 'pointerenter', onPointerEnter);\r\n            removeEventListener(targetElement, 'pointerleave', onPointerLeave);\r\n            removeEventListener(targetElement, 'pointermove', onPointermove);\r\n            removeEventListener(targetElement, 'pointerdown', onPointerdown);\r\n            removeEventListener(targetElement, 'wheel', wheelCleaner.process);\r\n            if (dragObjArr.length > 0) {\r\n                destroyDocumentListeners();\r\n            }\r\n\r\n            if (!(hasPointerEvents)) {\r\n                removeEventListener(targetElement, 'touchstart', onTouchstart);\r\n                if (dragObjArr.length > 0) {\r\n                    removeEventListener(document, 'touchmove', onTouchmove);\r\n                    removeEventListener(document, 'touchend', onTouchend);\r\n                    removeEventListener(document, 'touchcancel', onTouchend);\r\n                }\r\n            } else {\r\n                removeEventListener(targetElement, 'touchmove', onTouchmove);\r\n            }\r\n        };\r\n\r\n    }\r\n})();","import {IBounds, IVector2D} from '../BB.types';\r\n\r\nexport function mix (a: number, b: number, f: number): number {\r\n    return a * (1 - f) + b * f;\r\n}\r\n\r\nexport function dist (ax: number, ay: number, bx: number, by: number): number {\r\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\r\n}\r\n\r\nexport function distSquared (ax: number, ay: number, bx: number, by: number): number {\r\n    // faster because no square-root\r\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\r\n}\r\n\r\nexport function lenSquared (x: number, y: number): number {\r\n    // faster because no square-root\r\n    return x * x + y * y;\r\n}\r\n\r\nexport function pointsToAngleRad (p1: IVector2D, p2: IVector2D): number {\r\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n}\r\n\r\nexport function pointsToAngleDeg (p1: IVector2D, p2: IVector2D): number {\r\n    return pointsToAngleRad(p1, p2) * 180 / Math.PI;\r\n}\r\n\r\nexport function clamp (num: number, min: number, max: number): number {\r\n    return num <= min\r\n        ? min\r\n        : num >= max\r\n            ? max\r\n            : num;\r\n}\r\n\r\nexport function rotate (x: number, y: number, deg: number): IVector2D {\r\n    const theta = deg * (Math.PI / 180);\r\n    const cs = Math.cos(theta);\r\n    const sn = Math.sin(theta);\r\n\r\n    return {\r\n        x: x * cs - y * sn,\r\n        y: x * sn + y * cs\r\n    };\r\n}\r\n\r\nexport function rotateAround (center: IVector2D, point: IVector2D, deg: number): IVector2D {\r\n    const rot = rotate(point.x - center.x, point.y - center.y, deg);\r\n    rot.x += center.x;\r\n    rot.y += center.y;\r\n    return rot;\r\n}\r\n\r\nexport function intDxy(remainder: IVector2D, fDx: number, fDy: number) {\r\n    remainder.x += fDx;\r\n    remainder.y += fDy;\r\n    const dX = Math.round(remainder.x);\r\n    const dY = Math.round(remainder.y);\r\n    remainder.x -= dX;\r\n    remainder.y -= dY;\r\n    return {\r\n        dX,\r\n        dY,\r\n    };\r\n}\r\n\r\n/**\r\n * return closest even number\r\n * @param f\r\n */\r\nexport function roundEven(f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f;\r\n        }\r\n        return f + 1;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 0) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * return closest uneven number\r\n * @param f\r\n */\r\nexport function roundUneven(f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f + 1;\r\n        }\r\n        return f;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 1) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * round number to certain precision.\r\n * round(1.2345, 2) = 1.23\r\n * round(1.2345, 0) = 0\r\n * round(123, -1) = 120\r\n *\r\n * @param f\r\n * @param digits\r\n */\r\nexport function round(f: number, digits: number): number {\r\n    const digitMult = Math.pow(10, digits);\r\n    return Math.round((f/* + Number.EPSILON*/) * digitMult) / digitMult;\r\n}\r\n\r\n/**\r\n * update target so it includes bounds\r\n * @param target\r\n * @param bounds\r\n */\r\nexport function updateBounds (target: IBounds, bounds: IBounds): IBounds {\r\n    if (!bounds) {\r\n        return target;\r\n    }\r\n    if (!target) {\r\n        target = { x1: bounds.x1, y1: bounds.y1, x2: bounds.x2, y2: bounds.y2 };\r\n    } else {\r\n        target.x1 = Math.min(target.x1, bounds.x1);\r\n        target.y1 = Math.min(target.y1, bounds.y1);\r\n        target.x2 = Math.max(target.x2, bounds.x2);\r\n        target.y2 = Math.max(target.y2, bounds.y2);\r\n    }\r\n    return target;\r\n}\r\n\r\n/**\r\n * determine overlap of bounds with width&height\r\n */\r\nexport function boundsInArea (bounds: IBounds, width: number, height: number): IBounds | null {\r\n    let x1 = Math.max(0, bounds.x1);\r\n    let y1 = Math.max(0, bounds.y1);\r\n    let x2 = Math.min(width - 1, bounds.x2);\r\n    let y2 = Math.min(height - 1, bounds.y2);\r\n    if (x1 > x2 || y1 > y2) {\r\n        return null;\r\n    }\r\n    return { x1, y1, x2, y2 };\r\n}","import {clamp, dist, mix, pointsToAngleRad} from '../math/math';\r\n\r\n\r\ntype ChainOutFunc = (event?) => void;\r\n\r\n/**\r\n * for chaining event processing. useful for gestures (double tap, pinch zoom, max pointer filter).\r\n * each element in the chain might hold back the events, swallow them, or transform them\r\n *\r\n * p = {\r\n *     chainArr: ChainElement[]\r\n * }\r\n *\r\n * chainIn(event): null - feed an event into the chain\r\n * setChainOut(func): void - func(event) <- called when passed through chain\r\n * ^ each ChainElement needs these methods too\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const EventChain = function (p) {\r\n\r\n    const chainArr = p.chainArr;\r\n    let chainOut: ChainOutFunc = () => undefined;\r\n\r\n    function continueChain(i, event) {\r\n        for (; i < chainArr.length; i++) {\r\n            event = chainArr[i].chainIn(event);\r\n            if (event === null) {\r\n                return null;\r\n            }\r\n        }\r\n        chainOut(event);\r\n        return null;\r\n    }\r\n\r\n    for (let i = 0; i < chainArr.length; i++) {\r\n        (function (i) {\r\n            chainArr[i].setChainOut(function (event) {\r\n                continueChain(i + 1, event);\r\n            });\r\n        })(i);\r\n    }\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n        return continueChain(0, event);\r\n    };\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Detects double taps.\r\n *\r\n * p = {\r\n *     onDoubleTap: function({pageX: number, pageY: number}) - fires when double tap occurs\r\n * }\r\n *\r\n * chainIn\r\n * setChainOut\r\n * setAllowedPointerTypeArr(string[]): void - which pointer types are allowed\r\n * setAllowedButtonArr(string[]): void - which buttons are allowed\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const DoubleTapper = function (p) {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n    const minSilenceBeforeDurationMs = 400;\r\n    const maxPressedDurationMs = 300;\r\n    const maxPressedDistancePx = 10;\r\n    const maxInbetweenDistancePx = 19;\r\n    const maxUpToUpDurationMs = 500;\r\n    const maxUntilSecondDownDurationMs = 300;\r\n    const minSilenceAfterMs = 250;\r\n\r\n    let allowedPointerTypeArr = ['touch', 'mouse', 'pen'];\r\n    let allowedButtonArr = ['left'];\r\n\r\n    let sequenceArr = [];\r\n    const pointersDownIdArr = [];\r\n    let lastUpTime = 0;\r\n    let nowTime = 0;\r\n\r\n    let eventQueueArr = [];\r\n\r\n\r\n    function fail() {\r\n        if (sequenceArr.length === 0) { // no gesture started -> can be ignored\r\n            return;\r\n        }\r\n        clearTimeout(timeoutObj.fail);\r\n        clearTimeout(timeoutObj.maxUntilSecondDown);\r\n        clearTimeout(timeoutObj.success);\r\n        timeoutObj.fail = null;\r\n        timeoutObj.maxUntilSecondDown = null;\r\n        timeoutObj.success = null;\r\n\r\n\r\n        for (let i = 0; i < eventQueueArr.length; i++) {\r\n            chainOut(eventQueueArr[i]);\r\n        }\r\n        eventQueueArr = [];\r\n\r\n        sequenceArr = [];\r\n    }\r\n\r\n    // double tap achieved\r\n    function success() {\r\n        timeoutObj.fail = null;\r\n        timeoutObj.success = null;\r\n        eventQueueArr = []; // events get swallowed\r\n        const lastSequenceItem = sequenceArr[sequenceArr.length - 1];\r\n        sequenceArr = [];\r\n        p.onDoubleTap({pageX: lastSequenceItem.pageX, pageY: lastSequenceItem.pageY});\r\n    }\r\n\r\n\r\n    const timeoutObj = {\r\n        fail: null,\r\n        maxUntilSecondDown: null,\r\n        success: null\r\n    };\r\n\r\n    //returns false if time already up. otherwise sets up timeout\r\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\r\n        const diff = timeMS - nowTime;\r\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\r\n        return true;\r\n    }\r\n\r\n\r\n    /**\r\n     * @param event object - a pointer event from BB.PointerListener\r\n     */\r\n    function processEvent(event) {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\r\n                if (pointersDownIdArr[i] === event.pointerId) {\r\n                    pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!allowedPointerTypeArr.includes(event.pointerType)) { //wrong input type -> fail\r\n            //console.log('wrong input type -> fail');\r\n            fail();\r\n            return;\r\n        }\r\n\r\n        nowTime = performance.now();\r\n        const lastSequenceItem = sequenceArr.length > 0 ? sequenceArr[sequenceArr.length - 1] : null;\r\n        if (event.type === 'pointerup') {\r\n            lastUpTime = event.time;\r\n        }\r\n\r\n        if (event.type === 'pointerdown') {\r\n            if (pointersDownIdArr.length > 1) { // more than one pointer down -> fail\r\n                //console.log('more than one pointer down -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (timeoutObj.success !== null) { // silence-after not achieved -> fail\r\n                //console.log('silence-after not achieved -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (sequenceArr.length === 0 && nowTime - lastUpTime < minSilenceBeforeDurationMs) { // silence before not achieved -> fail\r\n                //console.log('silence before not achieved -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (!allowedButtonArr.includes(event.button)) { // wrong button -> fail\r\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\r\n                fail();\r\n                return;\r\n            }\r\n            if (lastSequenceItem && lastSequenceItem.isDown || sequenceArr.length > 2) { // jumbled -> fail\r\n                //console.log('jumbled -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (lastSequenceItem) {\r\n                const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n                if (distance > maxInbetweenDistancePx) { //moved too much -> reset\r\n                    //console.log('maxInbetweenDistancePx -> reset');\r\n                    fail();\r\n\r\n                    if (nowTime - lastSequenceItem.time < minSilenceBeforeDurationMs) { //silence before not achieved -> fail\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            sequenceArr.push({\r\n                isDown: true,\r\n                time: nowTime,\r\n                position: [event.pageX, event.pageY],\r\n                pointerId: event.pointerId\r\n            });\r\n            //maxUntilSecondDown\r\n\r\n            if (sequenceArr.length > 1) {\r\n                clearTimeout(timeoutObj.maxUntilSecondDown);\r\n            } else if (!setupTimeout('maxUntilSecondDown', fail, event.time + maxUntilSecondDownDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n\r\n            clearTimeout(timeoutObj.fail);\r\n            if (!setupTimeout('fail', fail, event.time + maxPressedDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointermove' && lastSequenceItem.pointerId === event.pointerId) {\r\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                console.log('another pointer mixing in -> fail');\r\n                fail();\r\n                return;\r\n            }*/\r\n            const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n            if (distance > maxPressedDistancePx) { //moved too much -> fail\r\n                //console.log('maxPressedDistancePx -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointerup') {\r\n            if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                fail();\r\n                return;\r\n            }\r\n            if (nowTime >= lastSequenceItem.time + maxPressedDurationMs) { //pressed too long -> fail\r\n                fail();\r\n                return;\r\n            }\r\n            clearTimeout(timeoutObj.fail);\r\n\r\n            if (sequenceArr.length < 3) {\r\n                if (!setupTimeout('fail', fail, event.time + maxUpToUpDurationMs)) {\r\n                    fail();\r\n                    return;\r\n                }\r\n\r\n                sequenceArr = [\r\n                    lastSequenceItem,\r\n                    {\r\n                        isUp: true,\r\n                        time: nowTime,\r\n                        position: [event.pageX, event.pageY]\r\n                    }\r\n                ];\r\n                return;\r\n            }\r\n\r\n            if (nowTime < sequenceArr[1].time + maxUpToUpDurationMs) {\r\n                // double tap almost success\r\n                // only needs silence\r\n                sequenceArr.push({\r\n                    pageX: event.pageX,\r\n                    pageY: event.pageY\r\n                });\r\n                if (!setupTimeout('success', success, event.time + minSilenceAfterMs)) {\r\n                    fail();\r\n                }\r\n            } else { // time up -> fail\r\n                fail();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        processEvent(event);\r\n\r\n        if (sequenceArr.length === 0) { //existing events can not become a double tap\r\n            fail();\r\n            return event;\r\n        }\r\n        // events might become a double tap -> queue\r\n        eventQueueArr.push(event);\r\n        return null;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n\r\n    this.setAllowedPointerTypeArr = function (arr) {\r\n        allowedPointerTypeArr = arr;\r\n    };\r\n\r\n    this.setAllowedButtonArr = function (arr) {\r\n        allowedButtonArr = arr;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Detects a single tap, done with N 'touch' pointers\r\n *\r\n * p = {\r\n *      fingers: number - number of fingers\r\n *      onTap: function() - fires when tap occurs\r\n * }\r\n *\r\n * chainIn\r\n * setChainOut\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const NFingerTapper = function (p) {\r\n\r\n    const fingers = p.fingers;\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    const minSilenceBeforeDurationMs = 50; //250;\r\n    const maxTapMs = 500;\r\n    const maxFirstLastFingerDownMs = 250;\r\n    const maxPressedDistancePx = 12; //5 + fingers * 5;\r\n    const silenceAfterDurationMs = 250;\r\n\r\n\r\n    /*\r\n        fingerObj = {\r\n            pointerId: number,\r\n            downTime: number,\r\n            downPageX: number,\r\n            downPageY: number,\r\n            isUp: boolean\r\n        }\r\n     */\r\n    let fingerArr = [];\r\n    let firstDownTime;\r\n    let eventQueueArr = [];\r\n    let lastEventTime = 0;\r\n    const pointersDownIdArr = [];\r\n\r\n    function fail() {\r\n        if (eventQueueArr.length === 0) {\r\n            return;\r\n        }\r\n        clearTimeout(timeoutObj.firstLastDownTimeout);\r\n        clearTimeout(timeoutObj.tapTimeout);\r\n        for (let i = 0; i < eventQueueArr.length; i++) {\r\n            chainOut(eventQueueArr[i]);\r\n        }\r\n        eventQueueArr = [];\r\n        fingerArr = [];\r\n    }\r\n\r\n    function success() {\r\n        clearTimeout(timeoutObj.firstLastDownTimeout);\r\n        clearTimeout(timeoutObj.tapTimeout);\r\n        eventQueueArr = []; // events get swallowed\r\n        fingerArr = [];\r\n        p.onTap();\r\n    }\r\n\r\n    let nowTime;\r\n    const timeoutObj = {\r\n        firstLastDownTimeout: null,\r\n        tapTimeout: null\r\n    };\r\n\r\n    function setupTimeout(timeoutStr, timeMS) {\r\n        const diff = timeMS - nowTime;\r\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        timeoutObj[timeoutStr] = setTimeout(fail, diff);\r\n        return true;\r\n    }\r\n\r\n    function processEvent(event) {\r\n\r\n        const tempLastEventTime = lastEventTime;\r\n        lastEventTime = event.time;\r\n\r\n        if (event.type === 'pointerdown') {\r\n            pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\r\n                if (pointersDownIdArr[i] === event.pointerId) {\r\n                    pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (event.pointerType !== 'touch') {\r\n            if (fingerArr.length > 0) { // already in gesture -> fail\r\n                fail();\r\n            }\r\n            return;\r\n        }\r\n\r\n        nowTime = performance.now();\r\n\r\n        if (event.type === 'pointerdown') {\r\n            //console.log('down');\r\n            if (fingerArr.length + 1 !== pointersDownIdArr.length) { // failed before, and some fingers are still down -> fail\r\n                fail();\r\n                return;\r\n            }\r\n            if (fingerArr.length === fingers) { // too many fingers down -> fail\r\n                //console.log(fingers + ': too many fingers down -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (fingerArr.length > 0 && event.time - maxFirstLastFingerDownMs > fingerArr[0].downTime) { // took too long to touch with all fingers -> fail\r\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (fingerArr.length === 0 && event.time - minSilenceBeforeDurationMs < tempLastEventTime) { // not enough silence before -> fail\r\n                //console.log(fingers + ': not enough silence before -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            if (fingerArr.length === 0) {\r\n                firstDownTime = event.time;\r\n\r\n                if (!setupTimeout('firstLastDownTimeout', event.time + maxFirstLastFingerDownMs) || !setupTimeout('tapTimeout', event.time + maxTapMs)) { // timeouts already up -> fail\r\n                    fail();\r\n                    return;\r\n                }\r\n\r\n            }\r\n            fingerArr.push({\r\n                pointerId: event.pointerId,\r\n                downTime: event.time,\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY\r\n            });\r\n            return;\r\n\r\n        }\r\n\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            for (let i = 0; i < fingerArr.length; i++) {\r\n                if (fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) { // finger not part of the tap is on screen -> fail\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\r\n                fail();\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'pointerup') {\r\n\r\n            if (fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            //console.log('up', event.pageX, event.pageY);\r\n            if (fingerArr.length !== fingers) { // not enough fingers -> fail\r\n                //console.log(fingers + ': not enough fingers -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            let i = 0;\r\n            for (; i < fingerArr.length; i++) {\r\n                if (fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) {\r\n                //do nothing\r\n                return;\r\n            }\r\n\r\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\r\n                //console.log(fingerArr);\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            fingerObj.isUp = true;\r\n\r\n            let allAreUp = true;\r\n            for (let i = 0; i < fingerArr.length; i++) {\r\n                if (!fingerArr[i].isUp) {\r\n                    allAreUp = false;\r\n                    break;\r\n                }\r\n            }\r\n            //console.log('fingerArr', fingerArr);\r\n\r\n            if (allAreUp) { // success\r\n                success();\r\n                return true;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        const result = processEvent(event);\r\n\r\n        //console.log(fingerArr.length);\r\n\r\n        if (result === true) {\r\n            //tap success -> event gets swallowed\r\n            return null;\r\n        }\r\n        if (fingerArr.length === 0) {\r\n            return event;\r\n        } else {\r\n            eventQueueArr.push(event);\r\n        }\r\n\r\n        return null;\r\n\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Detects a pinch zooming (2 touch pointers). If one finger lifts, then will use the remaining.\r\n * Further pointers are ignored, but their events get swallowed during the pinching.\r\n * pinching ends when ALL pointers are lifted.\r\n * Events passed through if no pinching.\r\n *\r\n * p = {\r\n *      onPinch: function({type: 'end'} | {\r\n *          type: 'move',\r\n *          relX: number,\r\n *          relY: number,\r\n *          downRelX: number,\r\n *          downRelY: number,\r\n *          angleDeg: number,\r\n *          scale: number\r\n *      }) - fires when pinching occurs\r\n * }\r\n *\r\n * chainIn\r\n * setChainOut\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const PinchZoomer = function (p) {\r\n\r\n    const firstFingerMaxDistancePx = 10;\r\n    const untilSecondFingerDurationMs = 250;\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n    const pointersDownIdArr = [];\r\n    /*\r\n    gestureObj = {\r\n        touchPointerArr: Array of {\r\n            pointerId: number,\r\n            relX: number,\r\n            relY: number,\r\n            downRelX: number, // only for first\r\n            downRelY: number\r\n        },\r\n        otherPointerIdArr: number[],\r\n        isInProgress: boolean\r\n    }\r\n    */\r\n    let gestureObj = null;\r\n    let eventQueueArr = [];\r\n\r\n\r\n    function end() {\r\n        gestureObj = null;\r\n        eventQueueArr = [];\r\n    }\r\n\r\n    function fail(doSwallow?) {\r\n        if (!gestureObj) { // no gesture happening -> ignore\r\n            return;\r\n        }\r\n\r\n        clearTimeout(timeoutObj.secondFingerTimeout);\r\n        if (!doSwallow) {\r\n            for (let i = 0; i < eventQueueArr.length; i++) {\r\n                chainOut(eventQueueArr[i]);\r\n            }\r\n        }\r\n        end();\r\n    }\r\n\r\n\r\n    let nowTime;\r\n    const timeoutObj = {\r\n        secondFingerTimeout: null\r\n    };\r\n\r\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\r\n        const diff = timeMS - nowTime;\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\r\n        return true;\r\n    }\r\n\r\n\r\n    function processEvent(event) {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            pointersDownIdArr.push(event.pointerId);\r\n\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\r\n                if (pointersDownIdArr[i] === event.pointerId) {\r\n                    pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        //pass through scenarios\r\n        if (\r\n            !gestureObj && (\r\n                event.pointerType !== 'touch' || // wrong pointer type\r\n                (event.type === 'pointermove' && pointersDownIdArr.length > 0) || // failed before\r\n                pointersDownIdArr.length > 1 || // failed before\r\n                event.type === 'pointerup' // failed before\r\n            )\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        nowTime = performance.now();\r\n\r\n\r\n        //pointer down\r\n        if (event.type === 'pointerdown') {\r\n\r\n            if (gestureObj) {\r\n                if (event.pointerType === 'touch') { // touch finger down - as nth pointer\r\n\r\n                    gestureObj.touchPointerArr.push({\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY\r\n                    });\r\n\r\n                    if (gestureObj.isInProgress) {\r\n                        continuePinch(gestureObj, {\r\n                            type: 'down',\r\n                            index: gestureObj.touchPointerArr.length - 1\r\n                        });\r\n                    } else {\r\n                        clearTimeout(timeoutObj.secondFingerTimeout);\r\n                        gestureObj.isInProgress = true;\r\n                        beginPinch(gestureObj);\r\n                    }\r\n                    return;\r\n\r\n                } else { // non-touch finger down - as nth pointer\r\n\r\n                    if (gestureObj.isInProgress) {\r\n                        gestureObj.otherPointerIdArr.push(event.pointerId);\r\n                    } else { // second pointer wrong type -> fail\r\n                        fail();\r\n                    }\r\n                    return;\r\n                }\r\n\r\n\r\n            } else {\r\n                // first finger down - can only be touch if no gestureObj\r\n                gestureObj = {\r\n                    touchPointerArr: [{\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY,\r\n                        downRelX: event.relX,\r\n                        downRelY: event.relY\r\n                    }],\r\n                    otherPointerIdArr: [],\r\n                    isInProgress: false\r\n                };\r\n                if (!setupTimeout('secondFingerTimeout', function () {\r\n                    fail();\r\n                }, event.time + untilSecondFingerDurationMs)) { // time ran out -> fail\r\n                    fail();\r\n                    return;\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n\r\n        //pointer move\r\n        if (event.type === 'pointermove' && event.pointerType === 'touch') {\r\n            //gesture object should always exist here\r\n\r\n            let touchPointerObj = null;\r\n            let i = 0;\r\n            for (; i < gestureObj.touchPointerArr.length; i++) {\r\n                if (event.pointerId === gestureObj.touchPointerArr[i].pointerId) {\r\n                    touchPointerObj = gestureObj.touchPointerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n\r\n            //null should not be possible\r\n\r\n            touchPointerObj.relX = event.relX;\r\n            touchPointerObj.relY = event.relY;\r\n\r\n            if (!gestureObj.isInProgress) { // only one finger down & pinching hasn't started\r\n                const distance = dist(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\r\n                if (distance > firstFingerMaxDistancePx) { // moved too much -> fail\r\n                    fail();\r\n                    return;\r\n                }\r\n\r\n            } else {\r\n                if (i < 2) { // only first two touches can affect pinching\r\n                    continuePinch(gestureObj, {\r\n                        type: 'move',\r\n                        index: i\r\n                    });\r\n                }\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n\r\n        //pointer up\r\n        if (event.type === 'pointerup') {\r\n            //gesture object should always exist here\r\n\r\n            if (event.pointerType === 'touch') {\r\n                let i = 0;\r\n                for (; i < gestureObj.touchPointerArr.length; i++) {\r\n                    if (gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\r\n                        gestureObj.touchPointerArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n                if (gestureObj.touchPointerArr.length > 0) {\r\n                    continuePinch(gestureObj, {\r\n                        type: 'up',\r\n                        index: i\r\n                    });\r\n                }\r\n\r\n            } else { // non-touch\r\n                for (let i = 0; i < gestureObj.otherPointerIdArr.length; i++) {\r\n                    if (gestureObj.otherPointerIdArr[i] === event.pointerId) {\r\n                        gestureObj.otherPointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            //all fingers lifted?\r\n            if (gestureObj.touchPointerArr.length === 0 && gestureObj.otherPointerIdArr.length === 0) {\r\n                if (gestureObj.isInProgress) { // lifted last finger -> end of pinching\r\n                    end();\r\n                    endPinch();\r\n                } else { // lifted finger again before pinching started -> fail\r\n                    fail();\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    // --- actual pinch transform logic ---\r\n\r\n    let pincherArr = [];\r\n\r\n    function beginPinch(gestureObj) {\r\n\r\n        for (let i = 0; i < gestureObj.touchPointerArr.length; i++) {\r\n            const pointerObj = gestureObj.touchPointerArr[i];\r\n            pincherArr.push({\r\n                pointerId: pointerObj.pointerId,\r\n                relX: pointerObj.relX,\r\n                relY: pointerObj.relY,\r\n                downRelX: pointerObj.relX,\r\n                downRelY: pointerObj.relY\r\n            });\r\n        }\r\n\r\n        const event: any = {\r\n            type: 'move',\r\n            angleRad: 0,\r\n            scale: 1\r\n        };\r\n\r\n        if (pincherArr.length === 1) {\r\n            event.relX = pincherArr[0].downRelX;\r\n            event.relY = pincherArr[0].downRelY;\r\n        } else {\r\n            event.relX = 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX);\r\n            event.relY = 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY);\r\n        }\r\n        event.downRelX = event.relX;\r\n        event.downRelY = event.relY;\r\n\r\n        p.onPinch(event);\r\n\r\n    }\r\n\r\n    //actionObj = {type: 'down'|'move'|'up', index: number}\r\n    function continuePinch(gestureObj, actionObj) {\r\n\r\n        if (actionObj.index > 1) { // only first two pointers matter\r\n            return;\r\n        }\r\n\r\n        if (actionObj.type === 'move') {\r\n\r\n            let event;\r\n            pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\r\n            pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\r\n\r\n            if (pincherArr.length === 1) {\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: pincherArr[0].downRelX,\r\n                    downRelY: pincherArr[0].downRelY,\r\n                    relX: pincherArr[0].relX,\r\n                    relY: pincherArr[0].relY,\r\n                    angleRad: 0,\r\n                    scale: 1\r\n                };\r\n\r\n            } else {\r\n\r\n                const startDist = dist(pincherArr[0].downRelX, pincherArr[0].downRelY, pincherArr[1].downRelX, pincherArr[1].downRelY);\r\n                const distance = dist(pincherArr[0].relX, pincherArr[0].relY, pincherArr[1].relX, pincherArr[1].relY);\r\n\r\n                const startAngle = pointsToAngleRad({\r\n                    x: pincherArr[0].downRelX,\r\n                    y: pincherArr[0].downRelY\r\n                }, {x: pincherArr[1].downRelX, y: pincherArr[1].downRelY});\r\n                const angle = pointsToAngleRad({\r\n                    x: pincherArr[0].relX,\r\n                    y: pincherArr[0].relY\r\n                }, {x: pincherArr[1].relX, y: pincherArr[1].relY});\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX),\r\n                    downRelY: 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY),\r\n                    relX: 0.5 * (pincherArr[0].relX + pincherArr[1].relX),\r\n                    relY: 0.5 * (pincherArr[0].relY + pincherArr[1].relY),\r\n                    angleRad: angle - startAngle,\r\n                    scale: distance / startDist\r\n                };\r\n\r\n            }\r\n\r\n            p.onPinch(event);\r\n\r\n        } else if (actionObj.type === 'down' || actionObj.type === 'up') {\r\n            endPinch();\r\n            beginPinch(gestureObj);\r\n        }\r\n\r\n    }\r\n\r\n    function endPinch() {\r\n        pincherArr = [];\r\n        p.onPinch({\r\n            type: 'end'\r\n        });\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n        processEvent(event);\r\n        if (gestureObj) {\r\n            if (!gestureObj.isInProgress) { // might still fail -> into queue\r\n                eventQueueArr.push(event);\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n        return null;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Splits up coalesced events into their own pointermove events. Otherwise regular pass through.\r\n *\r\n * @constructor\r\n */\r\nexport const CoalescedExploder = function () {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (event.coalescedArr.length > 0) {\r\n\r\n                let eventCopy = JSON.parse(JSON.stringify(event));\r\n                eventCopy.coalescedArr = [];\r\n                let coalescedItem;\r\n\r\n                for (let i = 0; i < event.coalescedArr.length; i++) {\r\n\r\n                    if (i > 0) {\r\n                        eventCopy = JSON.parse(JSON.stringify(event));\r\n                    }\r\n                    coalescedItem = event.coalescedArr[i];\r\n\r\n                    eventCopy.pageX = coalescedItem.pageX;\r\n                    eventCopy.pageY = coalescedItem.pageY;\r\n                    eventCopy.relX = coalescedItem.relX;\r\n                    eventCopy.relY = coalescedItem.relY;\r\n                    eventCopy.dX = coalescedItem.dX;\r\n                    eventCopy.dY = coalescedItem.dY;\r\n                    eventCopy.time = coalescedItem.time;\r\n                    if (i < event.coalescedArr.length - 1) {\r\n                        eventCopy.isCoalesced = true;\r\n                    }\r\n\r\n                    chainOut(eventCopy);\r\n                }\r\n\r\n            } else {\r\n                return event;\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\nexport const OnePointerLimiter = function (pointers?) {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    let downPointerId = null;\r\n    const ignorePointerIdArr = [];\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        if (ignorePointerIdArr.includes(event.pointerId)) {\r\n            if (event.type === 'pointerup') {\r\n                for (let i = 0; i < ignorePointerIdArr.length; i++) {\r\n                    if (ignorePointerIdArr[i] === event.pointerId) {\r\n                        ignorePointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        if (downPointerId === null) {\r\n            if (event.type === 'pointerdown') {\r\n                downPointerId = event.pointerId;\r\n            }\r\n            return event;\r\n\r\n        } else {\r\n            if (event.pointerId !== downPointerId) {\r\n                if (event.type === 'pointerdown') {\r\n                    ignorePointerIdArr.push(event.pointerId);\r\n                }\r\n                return null;\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                downPointerId = null;\r\n            }\r\n            return event;\r\n        }\r\n\r\n        return null;\r\n\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n\r\n};\r\n\r\n\r\n/**\r\n * Not really and event chain element. but pretty similar.\r\n *\r\n * Processes draw input events. When shift held -> linetool\r\n * line events - what KlCanvasWorkspace passes onDraw(e)\r\n *\r\n * p = {\r\n *     onDraw: function(drawEvent)\r\n * }\r\n *\r\n * pass input in with process(drawEvent)\r\n *\r\n * modifies draw event to include such events:\r\n * {\r\n *     type: 'line',\r\n *     x0: null, // you have to fill that in\r\n *     y0: null, // you have to fill that in\r\n *     pressure0: null, // you have to fill that in\r\n *     x1: number,\r\n *     y1: number,\r\n *     pressure1: number\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const LinetoolProcessor = function (p) {\r\n\r\n    let downEvent = null;\r\n    let eventQueue = [];\r\n    let direction = null;\r\n    const DIR_X = 0, DIR_Y = 1;\r\n\r\n    this.process = function (event) {\r\n        if (event.type === 'down') {\r\n            downEvent = event;\r\n            direction = null;\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                p.onDraw({\r\n                    type: 'line',\r\n                    x0: null,\r\n                    y0: null,\r\n                    pressure0: null,\r\n                    x1: event.x,\r\n                    y1: event.y,\r\n                    pressure1: event.pressure\r\n                });\r\n\r\n                eventQueue.push(event);\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'move') {\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                if (direction === null) {\r\n                    const dX = Math.abs(event.x - downEvent.x);\r\n                    const dY = Math.abs(event.y - downEvent.y);\r\n\r\n                    if (dX > 5 || dY > 5) {\r\n                        direction = dX > dY ? DIR_X : DIR_Y;\r\n\r\n                        for (let i = 0; i < eventQueue.length; i++) {\r\n                            const e = eventQueue[i];\r\n                            if (direction === DIR_X) {\r\n                                e.y = downEvent.y;\r\n                            } else {\r\n                                e.x = downEvent.x;\r\n                            }\r\n                            p.onDraw(JSON.parse(JSON.stringify(e)));\r\n                        }\r\n                        eventQueue = [];\r\n                    }\r\n                }\r\n\r\n                if (direction === null) {\r\n                    eventQueue.push(event);\r\n                    return;\r\n                }\r\n\r\n                if (direction === DIR_X) {\r\n                    event.y = downEvent.y;\r\n                } else {\r\n                    event.x = downEvent.x;\r\n                }\r\n\r\n            } else {\r\n                if (eventQueue.length > 0) {\r\n                    for (let i = 0; i < eventQueue.length; i++) {\r\n                        p.onDraw(JSON.parse(JSON.stringify(eventQueue[i])));\r\n                    }\r\n                    eventQueue = [];\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'up') {\r\n            eventQueue = [];\r\n        }\r\n\r\n        p.onDraw(JSON.parse(JSON.stringify(event)));\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * cleans up DrawEvents. More trustworthy events. EventChain element\r\n *\r\n * that events can only go line this: down -> n x move -> up\r\n * so, sanitizes this: down, down, down. becomes only one down. the other downs are ignored/swallowed\r\n * @constructor\r\n */\r\nexport const LineSanitizer = function () {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    let isDrawing = false;\r\n\r\n    // --- interface ---\r\n    this.chainIn = function (event) {\r\n\r\n        if (event.type === 'down') {\r\n            if (isDrawing) {\r\n                //console.log('line sanitizer - down, but already drawing');\r\n                chainOut({\r\n                    type: 'up',\r\n                    scale: event.scale,\r\n                    shiftIsPressed: event.shiftIsPressed,\r\n                    isCoalesced: false\r\n                });\r\n            } else {\r\n                isDrawing = true;\r\n            }\r\n        }\r\n        if (!isDrawing && (event.type === 'move' || event.type === 'up')) {\r\n            //console.log('line sanitizer - ' + event.type + ' but not drawing');\r\n            return null;\r\n        }\r\n\r\n        if (event.type === 'up' && isDrawing) {\r\n            isDrawing = false;\r\n        }\r\n\r\n        return event;\r\n    };\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n    this.getIsDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * Line smoothing. EventChain element. Smoothing via blending new position with old position.\r\n * for onDraw events from KlCanvasWorkspace.\r\n *\r\n * p = {\r\n *     smoothing: number, // 0-1, 0: no smoothing, 1: 100% smoothing -> would never catch up\r\n * }\r\n *\r\n * smoothing > 0: will fire DrawEvents in interval when no new move events\r\n *\r\n * type: 'line' Events are just passed through.\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const LineSmoothing = function (p) {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n    let smoothing = clamp(p.smoothing, 0, 1);\r\n    let lastMixedInput;\r\n    let interval;\r\n    let timeout;\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n        event = JSON.parse(JSON.stringify(event));\r\n        clearTimeout(timeout);\r\n        clearInterval(interval);\r\n\r\n        if (event.type === 'down') {\r\n            lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure\r\n            };\r\n        }\r\n\r\n        if (event.type === 'move') {\r\n\r\n            const inputX = event.x;\r\n            const inputY = event.y;\r\n            const inputPressure = event.pressure;\r\n\r\n            event.x = mix(event.x, lastMixedInput.x, smoothing);\r\n            event.y = mix(event.y, lastMixedInput.y, smoothing);\r\n            event.pressure = mix(event.pressure, lastMixedInput.pressure, smoothing);\r\n            lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure\r\n            };\r\n\r\n            if (smoothing > 0) {\r\n                timeout = setTimeout(function () {\r\n                    interval = setInterval(function () {\r\n                        event = JSON.parse(JSON.stringify(event));\r\n\r\n                        event.x = mix(inputX, lastMixedInput.x, smoothing);\r\n                        event.y = mix(inputY, lastMixedInput.y, smoothing);\r\n                        event.pressure = mix(inputPressure, lastMixedInput.pressure, smoothing);\r\n                        lastMixedInput = {\r\n                            x: event.x,\r\n                            y: event.y,\r\n                            pressure: event.pressure\r\n                        };\r\n\r\n                        chainOut(event);\r\n                    }, 35);\r\n                }, 80);\r\n            }\r\n\r\n        }\r\n\r\n        return event;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n\r\n    this.setSmoothing = function (s) {\r\n        smoothing = clamp(s, 0, 1);\r\n    };\r\n};\r\n","import {IKeyString} from '../BB.types';\r\nimport {createCanvas} from './create-canvas';\r\n\r\nexport function copyCanvas(canvas: HTMLCanvasElement): HTMLCanvasElement {\r\n    const resultCanvas = createCanvas(canvas.width, canvas.height);\r\n    const ctx = resultCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.drawImage(canvas, 0, 0);\r\n    return resultCanvas;\r\n}\r\n\r\n/**\r\n * Determine if should disable imageSmoothing for transformation.\r\n * ImageSmoothing can make images blurry even when they're in the original scale and aligned with the pixelgrid.\r\n */\r\nexport function testShouldPixelate(\r\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\r\n    scaleX: number,\r\n    scaleY: number,\r\n): boolean {\r\n    if (\r\n        ![1, -1].includes(scaleX) || ![1, -1].includes(scaleY) ||\r\n        transform.width % 1 !== 0 || transform.height % 1 !== 0 ||\r\n        Math.abs(transform.angleDeg) % 90 !== 0\r\n    ) {\r\n        return false;\r\n    }\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    const width = whSwapped ? transform.height : transform.width;\r\n    const height = whSwapped ? transform.width : transform.height;\r\n    return (\r\n            (Math.abs(width) % 2 === 0 && transform.x % 1 === 0) ||\r\n            (Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5)\r\n        ) &&\r\n        (\r\n            (Math.abs(height) % 2 === 0 && transform.y % 1 === 0) ||\r\n            (Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5)\r\n        );\r\n}\r\n\r\n\r\n/**\r\n * @param destCtx - the canvas that will be drawn on\r\n * @param transformImage - image that will be drawn on canvas\r\n * @param transform - {x, y, width, height, angle} - x and y are center of transformImage\r\n * @param bounds object - optional {x, y, width, height} - crop of transformImage in transformImage image space\r\n * @param pixelated\r\n */\r\nexport function drawTransformedImageWithBounds(\r\n    destCtx: CanvasRenderingContext2D,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\r\n    bounds?: {x: number, y: number, width: number, height: number},\r\n    pixelated?: boolean,\r\n): void {\r\n    if (!bounds) {\r\n        bounds = {\r\n            x: 0,\r\n            y: 0,\r\n            width: transformImage.width,\r\n            height: transformImage.height\r\n        };\r\n    }\r\n\r\n    destCtx.save();\r\n    if (pixelated) {\r\n        destCtx.imageSmoothingEnabled = false;\r\n    } else {\r\n        destCtx.imageSmoothingEnabled = true;\r\n        destCtx.imageSmoothingQuality = 'high';\r\n    }\r\n\r\n    destCtx.translate(transform.x, transform.y);\r\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\r\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\r\n    destCtx.drawImage(\r\n        transformImage,\r\n        bounds.x, bounds.y, bounds.width, bounds.height,\r\n        -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\r\n\r\n    destCtx.restore();\r\n}\r\n\r\n/**\r\n * all transformations are optional\r\n * center is the point around which will be scaled and rotated\r\n *\r\n * @param baseCanvas canvas - the canvas that will be drawn on\r\n * @param transformImage image|canvas - image that will be drawn on canvas\r\n * @param transformObj {center: {x, y}, scale: {x, y}, translate: {x, y}, angleDegree}\r\n */\r\nexport function drawTransformedImageOnCanvas(\r\n    baseCanvas: HTMLCanvasElement,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transformObj: {\r\n        center: {x: number, y: number},\r\n        scale: {x: number, y: number},\r\n        translate: {x: number, y: number},\r\n        angleDegree: number,\r\n    },\r\n): void {\r\n    transformObj = JSON.parse(JSON.stringify(transformObj));\r\n    if (!transformObj.center) {\r\n        transformObj.center = {\r\n            x: transformImage.width / 2,\r\n            y: transformImage.height / 2\r\n        }\r\n    }\r\n    if (!transformObj.scale) {\r\n        transformObj.scale = {\r\n            x: 1,\r\n            y: 1\r\n        };\r\n    }\r\n    if (!transformObj.angleDegree) {\r\n        transformObj.angleDegree = 0;\r\n    }\r\n    if (!transformObj.translate) {\r\n        transformObj.translate = {\r\n            x: 0,\r\n            y: 0\r\n        };\r\n    }\r\n\r\n    const ctx = baseCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.save();\r\n    if (\r\n        Math.abs(transformObj.scale.x - 1) >  0.000001 ||\r\n        Math.abs(transformObj.scale.y - 1) > 0.000001 ||\r\n        Math.abs(transformObj.angleDegree % 90) > 0.000001\r\n    ) {\r\n        ctx.imageSmoothingEnabled = true;\r\n        ctx.imageSmoothingQuality = 'high';\r\n    } else {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n\r\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\r\n    ctx.translate(transformObj.center.x, transformObj.center.y);\r\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\r\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\r\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\r\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\r\n\r\n    ctx.restore();\r\n}\r\n\r\nexport const createCheckerCanvas = function(size: number): HTMLCanvasElement {\r\n    const canvas = createCanvas();\r\n    let ctx;\r\n    if (size < 1) {\r\n        canvas.width = 1;\r\n        canvas.height = 1;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = 'rgb(128, 128, 128)';\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    } else if (size > 200) {\r\n        canvas.width = 401;\r\n        canvas.height = 401;\r\n    } else {\r\n        canvas.width = size * 2;\r\n        canvas.height = size * 2;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = 'rgb(255, 255, 255)';\r\n        ctx.fillRect(0, 0, size * 2, size * 2);\r\n        ctx.fillStyle = 'rgb(200, 200, 200)';\r\n        ctx.fillRect(0, 0, size, size);\r\n        ctx.fillRect(size, size, size * 2, size * 2);\r\n    }\r\n    return canvas;\r\n};\r\n\r\nexport const createCheckerDataUrl = (function () {\r\n    const cache: IKeyString = { // previously created dataUrls\r\n        '8': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC',\r\n        '4': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC'\r\n    };\r\n\r\n    return function (size: number, callback?: (s: string) => void) {\r\n        function create(size: number): string {\r\n            size = parseInt('' + size);\r\n            if (cache['' + size]) {\r\n                return cache['' + size];\r\n            }\r\n            const canvas = createCheckerCanvas(size);\r\n            const result = canvas.toDataURL('image/png');\r\n            cache['' + size] = result;\r\n            return result;\r\n        }\r\n\r\n        if (callback) { //async\r\n            setTimeout(function () {\r\n                callback(create(size));\r\n            }, 1);\r\n        } else { //sync\r\n            return create(size);\r\n        }\r\n    };\r\n})();\r\n\r\n/**\r\n * smooth resize image\r\n * @param canvas canvas - will be resized (modified)\r\n * @param w\r\n * @param h\r\n * @param tmp1 canvas - optional, provide to save resources\r\n * @param tmp2 canvas - optional, provide to save resources\r\n */\r\nexport function resizeCanvas(\r\n    canvas: HTMLCanvasElement,\r\n    w: number,\r\n    h: number,\r\n    tmp1?: HTMLCanvasElement,\r\n    tmp2?: HTMLCanvasElement,\r\n): void {\r\n\r\n    //determine base 2 exponents of old and new size\r\n    function getBase2Obj(oldW: number, oldH: number, newW: number, newH: number) {\r\n        const result = {\r\n            oldWidthEx: Math.round(Math.log2(oldW)),\r\n            oldHeightEx: Math.round(Math.log2(oldH)),\r\n            newWidthEx: Math.ceil(Math.log2(newW)),\r\n            newHeightEx: Math.ceil(Math.log2(newH))\r\n        };\r\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\r\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\r\n        return result;\r\n    }\r\n\r\n    if (!w || !h || (w === canvas.width && h === canvas.height)) {\r\n        return;\r\n    }\r\n    w = Math.max(w, 1);\r\n    h = Math.max(h, 1);\r\n    if (w <= canvas.width && h <= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp2 = !tmp2 ? createCanvas() : tmp2;\r\n\r\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\r\n\r\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\r\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\r\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\r\n        tmp1.getContext('2d')!.save();\r\n        tmp2.getContext('2d')!.save();\r\n\r\n        let ew, eh;\r\n        let buffer1 = tmp1, buffer2 = tmp2;\r\n\r\n        ew = base2.oldWidthEx;\r\n        eh = base2.oldHeightEx;\r\n\r\n        let bufferCtx = buffer2.getContext('2d')!;\r\n        bufferCtx.imageSmoothingEnabled = true;\r\n        bufferCtx.imageSmoothingQuality  = 'high';\r\n        bufferCtx.globalCompositeOperation  = 'copy';\r\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\r\n\r\n        let currentWidth = buffer2.width;\r\n        let currentHeight = buffer2.height;\r\n\r\n        //stepwise half the size\r\n        for (; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--) {\r\n            bufferCtx = buffer1.getContext('2d')!;\r\n            bufferCtx.imageSmoothingEnabled = true;\r\n            bufferCtx.imageSmoothingQuality  = 'high';\r\n            bufferCtx.globalCompositeOperation  = 'copy';\r\n\r\n            const newWidth = (ew > base2.newWidthEx) ? currentWidth / 2 : currentWidth;\r\n            const newHeight = (eh > base2.newHeightEx) ? currentHeight / 2 : currentHeight;\r\n\r\n            //buffer also needs to be properly sized, unfortunately\r\n            buffer1.width = newWidth;\r\n            buffer1.height = newHeight;\r\n\r\n            bufferCtx.drawImage(\r\n                buffer2,\r\n                0, 0,\r\n                currentWidth, currentHeight,\r\n                0, 0,\r\n                newWidth, newHeight\r\n            );\r\n            currentWidth = newWidth;\r\n            currentHeight = newHeight;\r\n\r\n            //swap\r\n            const tmp = buffer1;\r\n            buffer1 = buffer2;\r\n            buffer2 = tmp;\r\n        }\r\n\r\n        //when no longer can be halved, bring to target size\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        const canvasCtx = canvas.getContext('2d')!;\r\n        canvasCtx.save();\r\n        canvasCtx.imageSmoothingEnabled = true;\r\n        canvasCtx.imageSmoothingQuality  = 'high';\r\n        canvasCtx.drawImage(\r\n            buffer2,\r\n            0, 0,\r\n            currentWidth, currentHeight,\r\n            0, 0,\r\n            w, h\r\n        );\r\n        canvasCtx.restore();\r\n        tmp1.getContext('2d')!.restore();\r\n        tmp2.getContext('2d')!.restore();\r\n\r\n    } else if (w >= canvas.width && h >= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp1.width = w;\r\n        tmp1.height = h;\r\n        const tmp1Ctx = tmp1.getContext('2d')!;\r\n        tmp1Ctx.save();\r\n        tmp1Ctx.imageSmoothingEnabled = true;\r\n        tmp1Ctx.imageSmoothingQuality  = 'high';\r\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\r\n        tmp1Ctx.restore();\r\n\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        canvas.getContext('2d')!.drawImage(tmp1, 0, 0);\r\n\r\n    } else {\r\n        resizeCanvas(canvas, w, canvas.height, tmp1, tmp2);\r\n        resizeCanvas(canvas, w, h, tmp1, tmp2);\r\n    }\r\n}\r\n\r\n/**\r\n * puts naive greyscale version of image into alpha channel.\r\n * only writes a, doesn't write rgb\r\n * @param canvas\r\n */\r\nexport function convertToAlphaChannelCanvas(canvas: HTMLCanvasElement): void {\r\n    const imdat = canvas.getContext('2d')!.getImageData(0, 0, canvas.width, canvas.height);\r\n    for (let i = 0; i < imdat.data.length; i += 4) {\r\n        if (imdat.data[i + 3] === 0) {\r\n            continue;\r\n        }\r\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\r\n    }\r\n    canvas.getContext('2d')!.putImageData(imdat, 0, 0);\r\n}\r\n\r\n/**\r\n * Sometimes garbage collection is too slow, and canvases use up too much memory,\r\n * or there is a hard to fix memory leak.\r\n * This function manually makes the canvas use as little memory as possible.\r\n */\r\nexport function freeCanvas(canvas: HTMLCanvasElement): void {\r\n    canvas.width = 1;\r\n    canvas.height = 1;\r\n    const ctx = canvas.getContext('2d');\r\n    ctx && ctx.clearRect(0, 0, 1, 1);\r\n}","export const Matrix = (function () {\r\n\r\n    // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\r\n    // yes not optimized - but it's not used for physics simulations.\r\n\r\n    // const perfTotal = 0;\r\n\r\n    // point  matrix\r\n    function multiplyMatrixAndPoint(matrix, point) {\r\n        const result = [\r\n            (point[0] * matrix[0]) + (point[1] * matrix[4]) + (point[2] * matrix[8]) + (point[3] * matrix[12]), // x\r\n            (point[0] * matrix[1]) + (point[1] * matrix[5]) + (point[2] * matrix[9]) + (point[3] * matrix[13]), // y\r\n            (point[0] * matrix[2]) + (point[1] * matrix[6]) + (point[2] * matrix[10]) + (point[3] * matrix[14]), // z\r\n            (point[0] * matrix[3]) + (point[1] * matrix[7]) + (point[2] * matrix[11]) + (point[3] * matrix[15]) // w\r\n        ];\r\n        return result;\r\n    }\r\n\r\n    //matrixB  matrixA\r\n    function multiplyMatrices(matrixA, matrixB) {\r\n\r\n        // Slice the second matrix up into rows\r\n        const row0 = [matrixB[0], matrixB[1], matrixB[2], matrixB[3]];\r\n        const row1 = [matrixB[4], matrixB[5], matrixB[6], matrixB[7]];\r\n        const row2 = [matrixB[8], matrixB[9], matrixB[10], matrixB[11]];\r\n        const row3 = [matrixB[12], matrixB[13], matrixB[14], matrixB[15]];\r\n\r\n        // Multiply each row by matrixA\r\n        const result0 = multiplyMatrixAndPoint(matrixA, row0);\r\n        const result1 = multiplyMatrixAndPoint(matrixA, row1);\r\n        const result2 = multiplyMatrixAndPoint(matrixA, row2);\r\n        const result3 = multiplyMatrixAndPoint(matrixA, row3);\r\n\r\n        // Turn the result rows back into a single matrix\r\n        return [\r\n            result0[0], result0[1], result0[2], result0[3],\r\n            result1[0], result1[1], result1[2], result1[3],\r\n            result2[0], result2[1], result2[2], result2[3],\r\n            result3[0], result3[1], result3[2], result3[3]\r\n        ];\r\n    }\r\n\r\n    function createTranslationMatrix(x, y) {\r\n        return [\r\n            1, 0, 0, 0,\r\n            0, 1, 0, 0,\r\n            0, 0, 1, 0,\r\n            x, y, 0, 1\r\n        ];\r\n    }\r\n\r\n    function createRotationMatrix(angleRad) {\r\n        //let angleRad = angleDeg / 360 * 2 * Math.PI;\r\n        return [\r\n            Math.cos(-angleRad), -Math.sin(-angleRad), 0, 0,\r\n            Math.sin(-angleRad), Math.cos(-angleRad), 0, 0,\r\n            0, 0, 1, 0,\r\n            0, 0, 0, 1\r\n        ];\r\n    }\r\n\r\n    function createScaleMatrix(f) {\r\n        return [\r\n            f, 0, 0, 0,\r\n            0, f, 0, 0,\r\n            0, 0, 1, 0,\r\n            0, 0, 0, 1\r\n        ];\r\n    }\r\n\r\n    return {\r\n        getIdentity: function () {\r\n            return [\r\n                1, 0, 0, 0,\r\n                0, 1, 0, 0,\r\n                0, 0, 1, 0,\r\n                0, 0, 0, 1\r\n            ];\r\n        },\r\n        multiplyMatrixAndPoint: multiplyMatrixAndPoint,\r\n        multiplyMatrices: multiplyMatrices,\r\n        createTranslationMatrix: createTranslationMatrix,\r\n        createRotationMatrix: createRotationMatrix,\r\n        createScaleMatrix: createScaleMatrix\r\n    };\r\n})();","import {IVector2D} from '../BB.types';\r\n\r\nexport const Vec2 = {\r\n    add: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x + p2.x, y: p1.y + p2.y};\r\n    },\r\n    sub: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x - p2.x, y: p1.y - p2.y};\r\n    },\r\n    nor: function (p: IVector2D): IVector2D {\r\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n        return {x: p.x / len, y: p.y / len};\r\n    },\r\n    len: function (p: IVector2D): number {\r\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n    },\r\n    dist: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Vec2.len(Vec2.sub(p1, p2));\r\n    },\r\n    mul: function (p: IVector2D, s: number): IVector2D {\r\n        return {x: p.x * s, y: p.y * s};\r\n    },\r\n    angle: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n    },\r\n    dot: function(a: IVector2D, b: IVector2D): number {\r\n        const aArr = [a.x, a.y];\r\n        const bArr = [b.x, b.y];\r\n        return aArr.map((x, i) => aArr[i] * bArr[i]).reduce((m, n) => m + n);\r\n    }\r\n};","import {Vec2} from './vec2';\r\nimport {pointsToAngleDeg, clamp, dist, mix} from './math';\r\nimport {IVector2D} from \"../bb.types\";\r\n\r\n/**\r\n * project p onto line\r\n * @param lineStart\r\n * @param lineEnd\r\n * @param p\r\n */\r\nexport const projectPointOnLine = function (lineStart: IVector2D, lineEnd: IVector2D, p: IVector2D): IVector2D {\r\n    let x, y;\r\n    if (lineStart.x === lineEnd.x) {\r\n        x = lineStart.x;\r\n        y = p.y;\r\n\r\n        return {\r\n            x: x,\r\n            y: y\r\n        };\r\n    }\r\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\r\n    const b = lineStart.y - (m * lineStart.x);\r\n\r\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\r\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\r\n\r\n    return {\r\n        x: x,\r\n        y: y\r\n    };\r\n};\r\n\r\n\r\n\r\n/**\r\n * Operations on a line made up of points\r\n *\r\n * getAtDist(dist) - point when traveling *dist* along the line\r\n * getLength - gives you total length of line\r\n *\r\n * @param params object - {points: [{x:float, y:float}, ...]}\r\n * @constructor\r\n */\r\nexport const PointLine = function (params) {\r\n    const segmentArr = [];\r\n    const _this = this;\r\n\r\n    for (let i = 0; i < params.points.length; i++) {\r\n        (function (i) {\r\n            let length = undefined;\r\n            if (i < params.points.length - 1) {\r\n                length = dist(params.points[i].x, params.points[i].y, params.points[i + 1].x, params.points[i + 1].y);\r\n            }\r\n            segmentArr[i] = {\r\n                x: params.points[i].x,\r\n                y: params.points[i].y,\r\n                length: length\r\n            };\r\n        })(i);\r\n    }\r\n\r\n    /**\r\n     * @param dist number - distance in pixels, > 0\r\n     * @returns {{x: number, y: number}}\r\n     */\r\n    this.getAtDist = function (dist) {\r\n        let remainder = Math.min(_this.getLength(), dist);\r\n        let i = 0;\r\n\r\n        for (; remainder > segmentArr[i].length && i < segmentArr.length - 2; i++) {\r\n            remainder -= segmentArr[i].length;\r\n        }\r\n\r\n        const fac = Math.min(1, Math.max(0, remainder / segmentArr[i].length));\r\n\r\n        return {\r\n            x: (segmentArr[i].x * (1 - fac) + segmentArr[i + 1].x * fac),\r\n            y: (segmentArr[i].y * (1 - fac) + segmentArr[i + 1].y * fac)\r\n        };\r\n    };\r\n    this.getLength = function () {\r\n        let result = 0;\r\n        for (let i = 0; i < segmentArr.length - 1; i++) {\r\n            result += segmentArr[i].length;\r\n        }\r\n        return result;\r\n    };\r\n};\r\n\r\n/**\r\n * Each instance is one line made up of bezier interpolated segments.\r\n * You feed it points. It calculates control points on its own, and the resulting curve.\r\n *\r\n * @constructor\r\n */\r\nexport const BezierLine = function () {\r\n    const _this = this;\r\n    const pointArr = [];\r\n    let lastDot = 0;\r\n    let lastPoint;\r\n    let lastCallbackPoint;\r\n    let lastAngle;\r\n    let lastSpacing = null;\r\n\r\n    /**\r\n     * creates bezier curve from control points\r\n     *\r\n     * @param p1 - control point 1 {x: float, y: float}\r\n     * @param p2 - control point 2 {x: float, y: float}\r\n     * @param p3 - control point 3 {x: float, y: float}\r\n     * @param p4 - control point 4 {x: float, y: float}\r\n     * @param resolution - int\r\n     * @returns {Array} - bezier curve made up of points {x: float, y: float}\r\n     */\r\n    function getBezierPoints(p1, p2, p3, p4, resolution) {\r\n        const curvePoints = [];\r\n        let t, result;\r\n        for (let i = 0; i <= resolution; i++) {\r\n            t = i / resolution;\r\n            result = {};\r\n            result.x = Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x;\r\n            result.y = Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y;\r\n            curvePoints[curvePoints.length] = result;\r\n        }\r\n        return curvePoints;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * add now point to line\r\n     * line will go until the previous point\r\n     *\r\n     * @param x - coord of new point\r\n     * @param y - coord of new point\r\n     * @param spacing - space between each step\r\n     * @param callback - calls for each step - x, y, t - t is 0-1 how far along\r\n     * @param controlsCallback - calls that callback with the bezier control points p1, p2, p3, p4 - each {x: float, y: float}\r\n     */\r\n    this.add = function (x, y, spacing, callback, controlsCallback) {\r\n        if (lastPoint && x === lastPoint.x && y === lastPoint.y) {\r\n            return;\r\n        }\r\n        lastPoint = {x: x, y: y};\r\n        pointArr[pointArr.length] = {\r\n            x: x,\r\n            y: y,\r\n            spacing: spacing\r\n        };\r\n\r\n        //calculate directions\r\n        if (pointArr.length === 1) {\r\n            lastSpacing = spacing;\r\n            return;\r\n        } else if (pointArr.length === 2) {\r\n            pointArr[0].dir = Vec2.nor(Vec2.sub(pointArr[1], pointArr[0]));\r\n            lastDot = spacing;\r\n            lastSpacing = spacing;\r\n            return;\r\n        } else {\r\n            const pointM1 = pointArr[pointArr.length - 1];\r\n            const pointM2 = pointArr[pointArr.length - 2];\r\n            const pointM3 = pointArr[pointArr.length - 3];\r\n            pointM2.dir = Vec2.nor(Vec2.sub(pointM1, pointM3));\r\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) {\r\n                //when xy -3 == -1\r\n                pointM2.dir = JSON.parse(JSON.stringify(pointM3.dir));\r\n            }\r\n        }\r\n\r\n        //get bezier curve\r\n        const a = pointArr[pointArr.length - 3];\r\n        const b = pointArr[pointArr.length - 2];\r\n        const p1 = a;\r\n        const p2 = Vec2.add(a, Vec2.mul(a.dir, Vec2.dist(a, b) / 4));\r\n        const p3 = Vec2.sub(b, Vec2.mul(b.dir, Vec2.dist(a, b) / 4));\r\n        const p4 = b;\r\n\r\n\r\n        let pointLine;\r\n        if (callback) {\r\n            let curvePoints;\r\n            curvePoints = getBezierPoints(p1, p2, p3, p4, 20);\r\n            pointLine = new PointLine({points: curvePoints});\r\n        } else {\r\n            pointLine = new PointLine({points: [p1, p4]});\r\n        }\r\n\r\n        //interate over curve with spacing and callback\r\n        const len = pointLine.getLength();\r\n        let tempSpacing = mix(lastSpacing, spacing, clamp(lastDot / len, 0, 1));\r\n        let d = lastDot;\r\n        for (; d <= len; d += tempSpacing) {\r\n            tempSpacing = mix(lastSpacing, spacing, clamp(d / len, 0, 1));\r\n            const point = pointLine.getAtDist(d);\r\n            const angle = lastCallbackPoint ? pointsToAngleDeg(lastCallbackPoint, point) : undefined;\r\n            if (callback) {\r\n                callback({\r\n                    x: point.x,\r\n                    y: point.y,\r\n                    t: d / len,\r\n                    angle: angle,\r\n                    dAngle: lastCallbackPoint ? angle - lastAngle : 0\r\n                });\r\n            }\r\n            lastCallbackPoint = point;\r\n            lastAngle = angle;\r\n        }\r\n\r\n        if (callback) {\r\n            lastDot = d - len;\r\n        } else {\r\n            lastDot = 0;\r\n            controlsCallback({p1: p1, p2: p2, p3: p3, p4: p4});\r\n        }\r\n\r\n        lastSpacing = spacing;\r\n    };\r\n\r\n    this.addFinal = function(spacing, callback, controlsCallback) {\r\n        if (pointArr.length < 2) {\r\n            return;\r\n        }\r\n\r\n        const p1 = pointArr[pointArr.length - 2];\r\n        const p2 = pointArr[pointArr.length - 1];\r\n\r\n        const newP = Vec2.add(p2, Vec2.sub(p2, p1));\r\n\r\n        _this.add(newP.x, newP.y, spacing, callback, controlsCallback);\r\n    };\r\n\r\n};\r\n\r\n/**\r\n * from glfx.script by evanW:\r\n * from SplineInterpolator.cs in the Paint.NET source code\r\n *\r\n * points go 0 - 1. I think.\r\n *\r\n * @param points\r\n * @constructor\r\n */\r\nexport const SplineInterpolator = function (points) {\r\n    const n = points.length;\r\n    this.xa = [];\r\n    this.ya = [];\r\n    this.u = [];\r\n    this.y2 = [];\r\n    let i;\r\n\r\n    const first = points[0][0];\r\n    const last = points[points.length - 1][0];\r\n\r\n    points.sort(function (a, b) {\r\n        return a[0] - b[0];\r\n    });\r\n    for (i = 0; i < n; i++) {\r\n        this.xa.push(points[i][0]);\r\n        this.ya.push(points[i][1]);\r\n    }\r\n\r\n    this.u[0] = 0;\r\n    this.y2[0] = 0;\r\n\r\n    for (i = 1; i < n - 1; ++i) {\r\n        // This is the decomposition loop of the tridiagonal algorithm.\r\n        // y2 and u are used for temporary storage of the decomposed factors.\r\n        const wx = this.xa[i + 1] - this.xa[i - 1];\r\n        const sig = (this.xa[i] - this.xa[i - 1]) / wx;\r\n        const p = sig * this.y2[i - 1] + 2.0;\r\n\r\n        this.y2[i] = (sig - 1.0) / p;\r\n\r\n        const ddydx =\r\n            (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\r\n            (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\r\n\r\n        this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\r\n    }\r\n\r\n    this.y2[n - 1] = 0;\r\n\r\n    // This is the backsubstitution loop of the tridiagonal algorithm\r\n    for (i = n - 2; i >= 0; --i) {\r\n        this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\r\n    }\r\n\r\n    this.getFirstX = function () {\r\n        return first;\r\n    };\r\n    this.getLastX = function () {\r\n        return last;\r\n    };\r\n};\r\n\r\nSplineInterpolator.prototype.interpolate = function (x) {\r\n    const n = this.ya.length;\r\n    let klo = 0;\r\n    let khi = n - 1;\r\n\r\n    // We will find the right place in the table by means of\r\n    // bisection. This is optimal if sequential calls to this\r\n    // routine are at random values of x. If sequential calls\r\n    // are in order, and closely spaced, one would do better\r\n    // to store previous values of klo and khi.\r\n    while (khi - klo > 1) {\r\n        const k = (khi + klo) >> 1;\r\n\r\n        if (this.xa[k] > x) {\r\n            khi = k;\r\n        } else {\r\n            klo = k;\r\n        }\r\n    }\r\n\r\n    const h = this.xa[khi] - this.xa[klo];\r\n    const a = (this.xa[khi] - x) / h;\r\n    const b = (x - this.xa[klo]) / h;\r\n\r\n    // Cubic spline polynomial is now evaluated.\r\n    return a * this.ya[klo] + b * this.ya[khi] +\r\n        ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\r\n};\r\n\r\n/**\r\n * find x to y. simply by stepping through. suboptimal, so don't call often.\r\n * searches in x 0-1 range\r\n *\r\n * @param y\r\n * @param resolution\r\n */\r\nSplineInterpolator.prototype.findX = function (y, resolution) {\r\n    let x = null;\r\n    let dist = null;\r\n    for (let i = 0; i <= resolution; i++) {\r\n        const tempX = i / resolution;\r\n        const tempY = this.interpolate(tempX);\r\n        if (x === null) {\r\n            x = tempX;\r\n            dist = Math.abs(tempY - y);\r\n            continue;\r\n        }\r\n\r\n        const tempDist = Math.abs(tempY - y);\r\n\r\n        if (tempDist < dist) {\r\n            x = tempX;\r\n            dist = tempDist;\r\n        } else {\r\n            //distance increasing\r\n            break;\r\n        }\r\n    }\r\n    return x;\r\n};\r\n\r\n/**\r\n * input for a spline, following curve of quadratic function x^2 [0 - 1]\r\n * returns [[0, startVal], ..., [1, endVal]]\r\n * @param startVal\r\n * @param endVal\r\n * @param stepSize\r\n * @returns {[]}\r\n */\r\nexport const quadraticSplineInput = function (startVal, endVal, stepSize) {\r\n    function round(v, dec) {\r\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\r\n    }\r\n\r\n    const resultArr = [];\r\n    for (let i = 0; i <= 1; i += stepSize) {\r\n        resultArr.push([round(i, 4), round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)]);\r\n    }\r\n    return resultArr;\r\n};","\r\n\r\n\r\n// based on js color conversion http://www.webtoolkit.info/\r\n\r\n\r\nexport class HSV {\r\n    h: number;\r\n    s: number;\r\n    v: number;\r\n    constructor(h: number, s: number, v: number) {\r\n        this.h = Math.max(0, Math.min(360, h));\r\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\r\n        this.v = Math.max(0, Math.min(100, v));\r\n    }\r\n}\r\n\r\nexport class RGB {\r\n    r : number;\r\n    g: number;\r\n    b: number;\r\n    constructor(r: number, g: number, b: number) {\r\n        this.r = Math.max(0, Math.min(255, r));\r\n        this.g = Math.max(0, Math.min(255, g));\r\n        this.b = Math.max(0, Math.min(255, b));\r\n    }\r\n}\r\n\r\nexport class CMYK {\r\n    c: number;\r\n    m: number;\r\n    y: number;\r\n    k: number;\r\n    constructor(c: number, m: number, y: number, k: number) {\r\n        this.c = Math.max(0, Math.min(100, c));\r\n        this.m = Math.max(0, Math.min(100, m));\r\n        this.y = Math.max(0, Math.min(100, y));\r\n        this.k = Math.max(0, Math.min(100, k));\r\n    }\r\n}\r\n\r\nexport const ColorConverter = {\r\n\r\n    _RGBtoHSV: function (RGB: RGB): HSV {\r\n        const result = new HSV(0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        const minVal = Math.min(r, g, b);\r\n        const maxVal = Math.max(r, g, b);\r\n        const delta = maxVal - minVal;\r\n\r\n        result.v = maxVal;\r\n\r\n        if (delta == 0) {\r\n            result.h = 0;\r\n            result.s = 0;\r\n        } else {\r\n            result.s = delta / maxVal;\r\n            const del_R = (((maxVal - r) / 6) + (delta / 2)) / delta;\r\n            const del_G = (((maxVal - g) / 6) + (delta / 2)) / delta;\r\n            const del_B = (((maxVal - b) / 6) + (delta / 2)) / delta;\r\n\r\n            if (r == maxVal) {\r\n                result.h = del_B - del_G;\r\n            } else if (g == maxVal) {\r\n                result.h = (1 / 3) + del_R - del_B;\r\n            } else if (b == maxVal) {\r\n                result.h = (2 / 3) + del_G - del_R;\r\n            }\r\n\r\n            if (result.h < 0) {\r\n                result.h += 1;\r\n            }\r\n            if (result.h > 1) {\r\n                result.h -= 1;\r\n            }\r\n        }\r\n\r\n        result.h = Math.round(result.h * 360);\r\n        result.s = Math.round(result.s * 100);\r\n        result.v = Math.round(result.v * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    _HSVtoRGB: function (HSV: HSV): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\r\n\r\n        const h = (HSV.h / 360) % 1;\r\n        const s = HSV.s / 100;\r\n        const v = HSV.v / 100;\r\n\r\n        if (s == 0) {\r\n            result.r = v * 255;\r\n            result.g = v * 255;\r\n            result.b = v * 255;\r\n        } else {\r\n            var_h = h * 6;\r\n            var_i = Math.floor(var_h);\r\n            var_1 = v * (1 - s);\r\n            var_2 = v * (1 - s * (var_h - var_i));\r\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\r\n\r\n            if (var_i == 0) {\r\n                var_r = v;\r\n                var_g = var_3;\r\n                var_b = var_1\r\n            } else if (var_i == 1) {\r\n                var_r = var_2;\r\n                var_g = v;\r\n                var_b = var_1\r\n            } else if (var_i == 2) {\r\n                var_r = var_1;\r\n                var_g = v;\r\n                var_b = var_3\r\n            } else if (var_i == 3) {\r\n                var_r = var_1;\r\n                var_g = var_2;\r\n                var_b = v\r\n            } else if (var_i == 4) {\r\n                var_r = var_3;\r\n                var_g = var_1;\r\n                var_b = v\r\n            } else {\r\n                var_r = v;\r\n                var_g = var_1;\r\n                var_b = var_2\r\n            }\r\n\r\n            result.r = var_r * 255;\r\n            result.g = var_g * 255;\r\n            result.b = var_b * 255;\r\n\r\n            result.r = Math.round(result.r);\r\n            result.g = Math.round(result.g);\r\n            result.b = Math.round(result.b);\r\n        }\r\n\r\n        return result;\r\n    },\r\n\r\n    _CMYKtoRGB: function (CMYK: CMYK): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        const c = CMYK.c / 100;\r\n        const m = CMYK.m / 100;\r\n        const y = CMYK.y / 100;\r\n        const k = CMYK.k / 100;\r\n\r\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\r\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\r\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\r\n\r\n        result.r = Math.round(result.r * 255);\r\n        result.g = Math.round(result.g * 255);\r\n        result.b = Math.round(result.b * 255);\r\n\r\n        return result;\r\n    },\r\n\r\n    _RGBtoCMYK: function (RGB: RGB): CMYK {\r\n        const result = new CMYK(0, 0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\r\n        result.c = (1 - r - result.k) / (1 - result.k);\r\n        result.m = (1 - g - result.k) / (1 - result.k);\r\n        result.y = (1 - b - result.k) / (1 - result.k);\r\n\r\n        result.c = Math.round(result.c * 100);\r\n        result.m = Math.round(result.m * 100);\r\n        result.y = Math.round(result.y * 100);\r\n        result.k = Math.round(result.k * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    toRGB: function (o: RGB | HSV | CMYK): RGB {\r\n        if (o instanceof RGB) {\r\n            return o;\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._HSVtoRGB(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._CMYKtoRGB(o);\r\n        }\r\n    },\r\n\r\n    toHSV: function (o: RGB | HSV | CMYK): HSV {\r\n        if (o instanceof HSV) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoHSV(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._RGBtoHSV(this._CMYKtoRGB(o));\r\n        }\r\n    },\r\n\r\n    toCMYK: function (o: RGB | HSV | CMYK): CMYK {\r\n        if (o instanceof CMYK) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoCMYK(o);\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._RGBtoCMYK(this._HSVtoRGB(o));\r\n        }\r\n    },\r\n    toHexString: function (o: RGB): string {\r\n        if (o instanceof RGB || ('r' in o && 'g' in o && 'b' in o)) {\r\n            let ha = (parseInt('' + o.r)).toString(16);\r\n            let hb = (parseInt('' + o.g)).toString(16);\r\n            let hc = (parseInt('' + o.b)).toString(16);\r\n            if (ha.length == 1)\r\n                ha = '0' + ha;\r\n            if (hb.length == 1)\r\n                hb = '0' + hb;\r\n            if (hc.length == 1)\r\n                hc = '0' + hc;\r\n            return ha + hb + hc;\r\n        }\r\n    },\r\n    toRgbStr: function(rgbObj: {r: number, g: number, b: number}): string {\r\n        return 'rgb(' + Math.round(rgbObj.r) + ', ' + Math.round(rgbObj.g) + ', ' + Math.round(rgbObj.b) + ')';\r\n    },\r\n    toRgbaStr: function(rgbaObj: {r: number, g: number, b: number, a: number}): string {\r\n        return 'rgba(' + Math.round(rgbaObj.r) + ', ' + Math.round(rgbaObj.g) + ', ' + Math.round(rgbaObj.b) + ', ' + rgbaObj.a + ')';\r\n    },\r\n    hexToRGB: function(hexStr: string): RGB | null {\r\n        hexStr = hexStr.trim();\r\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\r\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n        hexStr = hexStr.replace(shorthandRegex, function(m, r, g, b) {\r\n            return r + r + g + g + b + b;\r\n        });\r\n\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\r\n        return result ? new RGB(\r\n            parseInt(result[1], 16),\r\n            parseInt(result[2], 16),\r\n            parseInt(result[3], 16)\r\n        ) : null;\r\n    }\r\n\r\n};\r\n\r\nexport function testIsWhiteBestContrast(rgbObj: {r: number, g: number, b: number}): boolean {\r\n    return (rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114) < 125;\r\n}","import {addEventListener} from '../input/event-listener';\r\nimport {css} from './base';\r\nimport {BB} from '../bb';\r\n\r\n\r\nexport function appendTextDiv(target: HTMLElement, text: string): HTMLDivElement {\r\n    const div = document.createElement('div');\r\n    div.innerHTML = text;\r\n    target.appendChild(div);\r\n    return div;\r\n}\r\n\r\n/**\r\n * Is an input element focused.\r\n * Set attribute \"data-ignore-focus\" to \"true\" if its focus should be ignored.\r\n *\r\n * @param getAll - check all, even those with \"data-ignore-focus\" = \"true\"\r\n */\r\nexport function isInputFocused(getAll: boolean = false): boolean {\r\n    let result = document.activeElement && ['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName);\r\n    if (getAll) {\r\n        return result;\r\n    } else {\r\n        return result && !document.activeElement.getAttribute('data-ignore-focus');\r\n    }\r\n}\r\n\r\nexport function unfocusAnyInput(): void {\r\n    if (isInputFocused(true)) {\r\n        /*\r\n            Unfocus anything that is focused.\r\n\r\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\r\n            that isn't its direct parent, then Firefox will keep anything attached to this\r\n            Input in memory. It will not be garbage collected until a new Input is focused.\r\n\r\n            Workaround: Temporarily create an input, focus it, detach it.\r\n             */\r\n        const focusEl = BB.el({\r\n            parent: document.body,\r\n            tagName: 'input',\r\n            css: {\r\n                opacity: '0',\r\n                width: '0',\r\n                height: '0',\r\n            }\r\n        }) as HTMLInputElement;\r\n        setTimeout(() => {\r\n            focusEl.select();\r\n            focusEl.focus();\r\n            focusEl.parentNode.removeChild(focusEl);\r\n        }, 10);\r\n    }\r\n}\r\n\r\n/**\r\n * clears text selection in window\r\n */\r\nexport function clearSelection(): void {\r\n    if (window.getSelection) {\r\n        const sel = window.getSelection();\r\n        if (sel) {\r\n            if (sel.empty) {\r\n                sel.empty();\r\n            } else if (sel.removeAllRanges) {\r\n                sel.removeAllRanges();\r\n            }\r\n        }\r\n    } else if ('selection' in document) {\r\n        (document as any).selection.empty();\r\n    }\r\n}\r\n\r\n/**\r\n * prevents being able to focus element.\r\n * warning: it creates a listener\r\n *\r\n * @param el - dom element\r\n */\r\nexport const makeUnfocusable = (function() {\r\n\r\n    function preventFocus(event: MouseEvent) {\r\n        event.preventDefault();\r\n        let didFocusRelated = false;\r\n        if (event.relatedTarget) {\r\n            try {\r\n                (event.relatedTarget as HTMLElement).focus();\r\n                didFocusRelated = true;\r\n            } catch(e) {\r\n                console.error('failed to focus');\r\n            }\r\n        }\r\n        if (!didFocusRelated) {\r\n            (event.currentTarget as HTMLElement).blur();\r\n        }\r\n    }\r\n\r\n    return function(el) {\r\n        el.setAttribute('tabindex', '-1');\r\n        addEventListener(el, 'focus', preventFocus);\r\n    };\r\n})();\r\n\r\n\r\nconst els: {\r\n    el: HTMLElement;\r\n    listeners: [string, any][];\r\n}[] = [];\r\n// window['els'] = els;\r\n\r\n/**\r\n *\r\n * Create DOM element - div by default\r\n * params = {\r\n * \t    parent: someOtherDiv,\r\n * \t    css: {\r\n * \t\t    width: \"500px\",\r\n * \t\t    backgroundColor: \"#fff\"\r\n * \t    },\r\n * \t    content: \"test\", //or  content: [divA, divB, divC]   or content: someDiv\r\n * \t    className: \"bla\",\r\n *      id: \"bla\"\r\n * }\r\n *\r\n *  If onClick or onChange is used, then BB.destroyEl MUST be called\r\n *  to prevent a memory leak.\r\n *\r\n * @param params\r\n */\r\nexport function el(\r\n    params: {\r\n        parent?: HTMLElement,\r\n        css?: { [key: string]: string },\r\n        custom?: { [key: string]: any },\r\n        content?: string | (HTMLElement | string | null)[] | HTMLElement | SVGElement,\r\n        textContent?: string,\r\n        className?: string,\r\n        title?: string,\r\n        id?: string,\r\n        tagName?: string,\r\n        onClick?: (e: Event) => void,\r\n        onChange?: (e: Event) => void,\r\n    }\r\n): HTMLElement {\r\n    const div = document.createElement(params.tagName ? params.tagName : 'div');\r\n    if (params.css) {\r\n        css(div, params.css);\r\n    }\r\n\r\n    if (params.content) {\r\n        if (typeof params.content === typeof 'aa') {\r\n            div.innerHTML = params.content as string;\r\n\r\n        } else if (Array.isArray(params.content)) {\r\n            BB.append(div, params.content);\r\n\r\n        } else {\r\n            div.appendChild(params.content as HTMLElement);\r\n\r\n        }\r\n    }\r\n    if (params.textContent) {\r\n        div.textContent = params.textContent;\r\n    }\r\n    if (params.className) {\r\n        div.className = params.className;\r\n    }\r\n    if (params.id) {\r\n        div.id = params.id;\r\n    }\r\n    if (params.parent) {\r\n        params.parent.appendChild(div);\r\n    }\r\n    if ('title' in params && params.title !== undefined) {\r\n        div.title = params.title;\r\n    }\r\n    const listeners = [];\r\n    if ('onClick' in params) {\r\n        addEventListener(div, 'click', params.onClick);\r\n        listeners.push(['click', params.onClick]);\r\n    }\r\n    if ('onChange' in params) {\r\n        addEventListener(div, 'change', params.onChange);\r\n        listeners.push(['change', params.onChange]);\r\n    }\r\n    if (listeners.length > 0) {\r\n        els.push({\r\n            el: div,\r\n            listeners: listeners,\r\n        })\r\n        /*div.style.backgroundColor = '#ff0';\r\n        div.style.border = '1px solid #ff0';*/\r\n    }\r\n    if ('custom' in params) {\r\n        const customKeyArr = Object.keys(params.custom);\r\n        for (let i = 0; i < customKeyArr.length; i++) {\r\n            div.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\r\n        }\r\n    }\r\n    return div;\r\n}\r\n\r\n/**\r\n * removes event listeners for Elements created via el()\r\n * @param el\r\n */\r\nexport function destroyEl(el: HTMLElement) {\r\n    for (let i = 0; i < els.length; i++) {\r\n        const item = els[i];\r\n        if (item.el === el) {\r\n            item.listeners.forEach(item => {\r\n                el.removeEventListener(item[0], item[1]);\r\n            });\r\n            els.splice(i, 1);\r\n            return;\r\n        }\r\n    }\r\n    // not found\r\n    return;\r\n}\r\n","\r\nexport class BbLog {\r\n\r\n    private static listeners: any[] = [];\r\n\r\n    constructor() {\r\n    }\r\n\r\n    static subscribe(listener) {\r\n        if (BbLog.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        BbLog.listeners.push(listener);\r\n    }\r\n\r\n    static unsubscribe(listener) {\r\n        for (let i = 0; i < BbLog.listeners.length; i++) {\r\n            if (listener === BbLog.listeners[i]) {\r\n                BbLog.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    static emit (msg) {\r\n        BbLog.listeners.forEach(item => {\r\n            item(msg);\r\n        });\r\n    }\r\n}",null,"/**\r\n * LocalStorage wrapper that does not throw exceptions.\r\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\r\n */\r\nexport class LocalStorage {\r\n\r\n    private static error;\r\n\r\n    static getItem (key: string): string {\r\n        let result = null;\r\n        try {\r\n            result = localStorage.getItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static setItem (key: string, value: string): void {\r\n        try {\r\n            localStorage.setItem(key, value);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static removeItem (key: string): void {\r\n        try {\r\n            localStorage.removeItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static getError (): any {\r\n        return this.error;\r\n    }\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"l7FYj\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kbyFQ\");","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Checkbox - with label\r\n */\r\nexport class Checkbox {\r\n\r\n    private element: HTMLElement;\r\n    private check: HTMLInputElement;\r\n    private doHighlight: boolean;\r\n\r\n    // --- public ---\r\n\r\n    constructor (params: {\r\n        init?: boolean; // default false\r\n        label: string;\r\n        callback: (boolean) => void;\r\n        allowTab?: boolean; // default false\r\n        title?: string;\r\n        doHighlight?: boolean; // default false\r\n        css?: any;\r\n    }) {\r\n        this.doHighlight = params.doHighlight;\r\n\r\n        this.element = BB.el({\r\n            className: 'kl-checkbox'\r\n        });\r\n\r\n        const innerEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'label',\r\n            className: 'kl-checkbox__inner'\r\n        });\r\n\r\n        this.check = BB.el({\r\n            parent: innerEl,\r\n            tagName: 'input',\r\n            css: {\r\n                marginLeft: '0',\r\n                display: 'inline-block'\r\n            },\r\n            custom: {\r\n                type: 'checkbox'\r\n            }\r\n        }) as HTMLInputElement;\r\n        this.check.checked = params.init;\r\n        if (this.doHighlight && this.check.checked) {\r\n            this.element.classList.add('kl-checkbox--highlight');\r\n        }\r\n        if (!params.allowTab) {\r\n            this.check.tabIndex = -1;\r\n        }\r\n\r\n        if (params.title) {\r\n            innerEl.title = params.title;\r\n        }\r\n\r\n        const label = document.createElement('div');\r\n        label.style.display = 'inline-block';\r\n        label.innerHTML = params.label;\r\n        (label as any).allowClick = true;\r\n        innerEl.appendChild(label);\r\n\r\n        this.check.onchange = () => {\r\n            if (this.doHighlight) {\r\n                this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\r\n            }\r\n            params.callback(this.check.checked);\r\n            setTimeout(() => {\r\n                this.check.blur();\r\n            }, 0);\r\n        };\r\n        if (params.css) {\r\n            BB.css(this.element, params.css);\r\n        }\r\n    }\r\n\r\n    getValue(): boolean {\r\n        return this.check.checked;\r\n    }\r\n\r\n    setValue(b: boolean) {\r\n        this.check.checked = !!b;\r\n        if (this.doHighlight) {\r\n            this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\r\n        }\r\n    }\r\n\r\n    getElement(): HTMLElement {\r\n        return this.element;\r\n    }\r\n\r\n    destroy() {\r\n        this.check.onchange = null;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\n\r\nexport const input = function (params: {\r\n    type?: 'button' | 'checkbox' | 'number' | 'text' | 'color'; // default text\r\n    min?: number;\r\n    max?: number;\r\n    callback: (val: string) => void;\r\n    init: string | number;\r\n    css?: IKeyString;\r\n}) {\r\n    const result = document.createElement('input');\r\n    if (params.type) {\r\n        try {\r\n            result.type = params.type;\r\n        } catch(e) {} // ie can't deal with number\r\n    } else {\r\n        result.type = 'text';\r\n    }\r\n    if (params.min !== undefined) {\r\n        result.min = '' + params.min;\r\n    }\r\n    if (params.max !== undefined) {\r\n        result.max = '' + params.max;\r\n    }\r\n    result.value = '' + params.init;\r\n    if (params.callback) {\r\n        result.onchange = function() {\r\n            params.callback(result.value);\r\n        };\r\n    }\r\n    if (params.css) {\r\n        BB.css(result, params.css);\r\n    }\r\n\r\n    return result;\r\n};","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\n\r\n/**\r\n * A select dropdown\r\n */\r\nexport class Select {\r\n\r\n    private selectEl: HTMLSelectElement;\r\n    private optionArr: ([string, string] | null)[]; // [value, label]\r\n    private changeListener: (event) => void;\r\n    private onChange: (val: string) => void;\r\n\r\n    \r\n    // --- public ---\r\n    constructor (p: {\r\n        isFocusable?: boolean; // default false\r\n        optionArr: ([string, string] | null)[], // [value, label]\r\n        initValue?: string; // default null\r\n        onChange: (val: string) => void;\r\n        css?: IKeyString;\r\n        title?: string;\r\n    }) {\r\n        this.selectEl = BB.el({\r\n            tagName: 'select',\r\n            title: p.title,\r\n            css: {\r\n                cursor: 'pointer',\r\n                fontSize: '15px',\r\n                padding: '3px',\r\n                background: '#fff', // makes safari pay attention to font-size\r\n                //webkitAppearance: 'none'\r\n                colorScheme: 'only light', // chrome doesn't properly invert the text color\r\n            }\r\n        }) as HTMLSelectElement;\r\n        if (p.css) {\r\n            BB.css(this.selectEl, p.css);\r\n        }\r\n\r\n        const isFocusable = p.isFocusable;\r\n        if (!isFocusable) {\r\n            this.selectEl.tabIndex = -1;\r\n        }\r\n        this.optionArr = p.optionArr;\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            if (this.optionArr[i] === null) {\r\n                continue;\r\n            }\r\n            const option = document.createElement('option');\r\n            option.value = this.optionArr[i][0];\r\n            option.textContent = this.optionArr[i][1];\r\n            this.selectEl.append(option);\r\n        }\r\n        this.onChange = p.onChange;\r\n        this.changeListener = (e) => {\r\n            if (!isFocusable) {\r\n                this.selectEl.blur();\r\n            }\r\n            this.onChange(this.selectEl.value);\r\n        };\r\n        this.selectEl.addEventListener('change', this.changeListener);\r\n        this.selectEl.value = 'initValue' in p ? p.initValue : null;\r\n    }\r\n\r\n    setValue (val) {\r\n        this.selectEl.value = val;\r\n    }\r\n\r\n    getValue () {\r\n        return this.selectEl.value;\r\n    }\r\n\r\n    setDeltaValue (delta) {\r\n        let index = 0;\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            if ('' + this.optionArr[i][0] === this.selectEl.value) {\r\n                index = i;\r\n                break;\r\n            }\r\n        }\r\n        index = Math.max(0, Math.min(this.optionArr.length -1, index + delta));\r\n        this.selectEl.value = this.optionArr[index][0];\r\n        this.onChange(this.selectEl.value);\r\n    }\r\n\r\n    getElement () {\r\n        return this.selectEl;\r\n    }\r\n\r\n    destroy = () => {\r\n        this.selectEl.removeEventListener('change', this.changeListener);\r\n    }\r\n    \r\n}\r\n","import {BB} from '../../../bb/bb';\r\n\r\n\r\n/**\r\n * Toggle button with an image\r\n *\r\n * p = {\r\n *     initValue: boolean,\r\n *     title: string,\r\n *     isRadio: boolean, // if true, can't click when active\r\n *     onChange: function(boolean)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const ImageToggle = function(p) {\r\n    let isActive = !!p.initValue;\r\n    const div = BB.el({\r\n        className: 'image-toggle',\r\n        title: p.title,\r\n        css: {\r\n            backgroundImage: \"url('\" + p.image + \"')\"\r\n        },\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            if (p.isRadio && isActive) {\r\n                return;\r\n            }\r\n            isActive = !isActive;\r\n            update();\r\n            p.onChange(isActive);\r\n        },\r\n    });\r\n\r\n    function update() {\r\n        div.classList.toggle('image-toggle-active', isActive);\r\n    }\r\n\r\n    update();\r\n\r\n    // --- interface ---\r\n    this.setValue = function(b) {\r\n        isActive = !!b;\r\n        update();\r\n    };\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.getValue = function() {\r\n        return isActive;\r\n    };\r\n    this.destroy = () => {\r\n        BB.destroyEl(div);\r\n    };\r\n\r\n};","import {BB} from '../../../bb/bb';\r\nimport {ImageToggle} from './image-toggle';\r\n\r\n/**\r\n * Radio input group. each one has an image\r\n *\r\n * p = {\r\n *     optionArr: {\r\n *         id: string,\r\n *         title: string,\r\n *         image: string,\r\n *     }[],\r\n *     initId: string,\r\n *     sizePx: number,\r\n *     onChange: function(id: string): void\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport const ImageRadioList = function(p) {\r\n\r\n    const div = BB.el({\r\n        className: 'image-radio-wrapper',\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n\r\n    let activeIndex;\r\n    const optionArr = [];\r\n\r\n    function select(index, id) {\r\n        activeIndex = index;\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            optionArr[i].setValue(i === activeIndex);\r\n        }\r\n        p.onChange(id);\r\n    }\r\n\r\n    function createOption(index, o) {\r\n        if (o.id === p.initId) {\r\n            activeIndex = index;\r\n        }\r\n        const radioEl = new ImageToggle({\r\n            image: o.image,\r\n            title: o.title,\r\n            initValue: o.id === p.initId,\r\n            isRadio: true,\r\n            onChange: function() {\r\n                select(index, o.id);\r\n            }\r\n        });\r\n        div.appendChild(radioEl.getElement());\r\n\r\n        return radioEl;\r\n\r\n    }\r\n\r\n    for (let i = 0; i < p.optionArr.length; i++) {\r\n        optionArr.push(createOption(i, p.optionArr[i]));\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.getValue = function() {\r\n        return p.optionArr[activeIndex].id;\r\n    };\r\n    this.destroy = () => {\r\n        optionArr.forEach(item => {\r\n            item.destroy();\r\n        })\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport iconImg from 'url:~/src/app/img/ui/brush-pressure.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * small toggle button with a pen icon - representing toggling pressure sensitivity\r\n * @param isChecked - boolean - initial value\r\n * @param changeCallback - function(isChecked boolean) - called on change\r\n * @returns {HTMLElement} - the toggle button\r\n */\r\nexport const penPressureToggle = function(isChecked, changeCallback) {\r\n\r\n    const toggleDiv = BB.el({\r\n        css: {\r\n            cssFloat: 'right',\r\n            borderRadius: '3px',\r\n            width: '18px',\r\n            height: '18px',\r\n            backgroundImage: 'url(\"' + iconImg + '\")',\r\n            backgroundSize: 'contain',\r\n            backgroundRepeat: 'no-repeat',\r\n            cursor: 'pointer',\r\n            boxSizing: 'border-box',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n\r\n    if (!BB.hasPointerEvents) {\r\n        toggleDiv.style.display = 'none';\r\n    }\r\n\r\n    function redraw() {\r\n        if (isChecked) {\r\n            BB.css(toggleDiv, {\r\n                backgroundColor: '#fff',\r\n                opacity: '0.9',\r\n                border: '1px solid var(--active-highlight-color)'\r\n            });\r\n        } else {\r\n            BB.css(toggleDiv, {\r\n                backgroundColor: 'transparent',\r\n                opacity: '0.5',\r\n                border: '1px solid #666'\r\n            });\r\n        }\r\n    }\r\n\r\n    toggleDiv.title = LANG('brush-toggle-pressure');\r\n    toggleDiv.onclick = function() {\r\n        isChecked = !isChecked;\r\n        redraw();\r\n        changeCallback(isChecked);\r\n    };\r\n\r\n    redraw();\r\n    changeCallback(isChecked);\r\n\r\n    return toggleDiv;\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"5H9IS\");","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport {IKlSliderConfig} from '../../kl.types';\r\nimport {languageStrings} from '../../../language/language';\r\nimport {DoubleTapper, EventChain} from '../../../bb/input/event-chain';\r\nimport {KlSliderManualInput} from './kl-slider-manual-input';\r\n\r\n/**\r\n * Horizontal slider, can be changed by dragging anywhere on it. Has a label & value.\r\n * e.g. used for brush size\r\n *\r\n * left mouse button - set absolute value\r\n * right mouse button - change relative value\r\n * drag mouse vertically away - high precision mode\r\n * double-click/tap slider -> manual input mode\r\n *\r\n * Values can be spline interpolated\r\n * On change callback can be debounced\r\n *\r\n */\r\nexport class KlSlider {\r\n\r\n    /*\r\n    Three types of values\r\n    - value - the actual value, when using setValue(), getValue(), and what is emitted\r\n    - displayValue - the number that the user sees on the slider and in the manual input field\r\n        - might be further formatted with formatFunc\r\n        - also might be the same as value, if no toDisplayValue function provided\r\n    - sliderValue - the draggable position of the slider, 0 - 1\r\n     */\r\n\r\n    private value: number;\r\n\r\n    private elementWidth: number;\r\n    private elementHeight: number;\r\n    private isEnabled: boolean;\r\n\r\n    private min: number; // min value\r\n    private max: number; // max value\r\n    private useSpline: boolean;\r\n    private splineInterpolator: any; // todo type\r\n    private resolution: number;\r\n\r\n    private isChangeOnFinal: boolean;\r\n    private formatFunc: null | ((val: number) => number);\r\n\r\n    private onChange: (val: number) => void;\r\n    private valueToDisplayValue: (value: number) => number;\r\n    private displayValueToValue: (displayValue: number) => number;\r\n\r\n\r\n    private roolEl: HTMLElement;\r\n    private sliderWrapperEl: HTMLElement;\r\n    private textEl: HTMLElement; // displays label, displayValue\r\n    private label: string;\r\n    private control: HTMLElement;\r\n    private manualInput: null | KlSliderManualInput;\r\n    private manualInputRoundDigits: number;\r\n\r\n    private pointerListener: any; // todo type\r\n    private pointerListenerTimeout: any;\r\n\r\n    private eventResMs: null | number;\r\n    private emitValue: null | number = null; // next value for interval\r\n    private emitInterval: null | any; // interval of eventResMs which calls onChange()\r\n\r\n    private valueToSliderValue(value: number): number {\r\n        if (this.useSpline) {\r\n            return this.splineInterpolator.findX(value, Math.floor(this.resolution));\r\n        }\r\n        return (value - this.min) / (this.max - this.min);\r\n    }\r\n\r\n    private sliderValuetoValue(sliderValue: number): number {\r\n        let result = this.min + sliderValue * (this.max - this.min);\r\n        if (this.useSpline) {\r\n            result = this.splineInterpolator.interpolate(sliderValue);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private updateLabel(): void {\r\n        let displayValue: number | string = this.valueToDisplayValue(this.value);\r\n        displayValue = this.formatFunc ? this.formatFunc(displayValue) : Math.round(displayValue);\r\n        displayValue = displayValue.toLocaleString(languageStrings.getCode());\r\n        this.textEl.innerHTML = this.label + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + displayValue + '</span>';\r\n\r\n        const sliderValue = this.valueToSliderValue(this.value);\r\n        this.control.style.width = (sliderValue * this.elementWidth) + 'px';\r\n    }\r\n\r\n    private emit(isFinal: boolean): void {\r\n        if (!isFinal && this.isChangeOnFinal) {\r\n            return;\r\n        }\r\n\r\n        if (isFinal || !this.eventResMs) {\r\n            this.onChange(this.value);\r\n            if (this.emitInterval) {\r\n                clearInterval(this.emitInterval);\r\n                this.emitInterval = null;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (this.emitInterval) {\r\n            this.emitValue = this.value;\r\n\r\n        } else {\r\n            this.onChange(this.value);\r\n\r\n            this.emitInterval = setInterval(() => {\r\n                if (this.emitValue === null) {\r\n                    clearInterval(this.emitInterval);\r\n                    this.emitInterval = null;\r\n                } else {\r\n                    this.onChange(this.emitValue);\r\n                    this.emitValue = null;\r\n                }\r\n            }, this.eventResMs);\r\n        }\r\n    }\r\n\r\n    private updateEnable(): void {\r\n        BB.css(this.sliderWrapperEl, {\r\n            opacity: this.isEnabled ? null : '0.5',\r\n            pointerEvents: this.isEnabled ? null : 'none',\r\n        });\r\n        if (this.manualInput) {\r\n            this.manualInput.setIsEnabled(this.isEnabled);\r\n        }\r\n    }\r\n\r\n    private showManualInput(): void {\r\n\r\n        this.manualInput = new KlSliderManualInput(\r\n            this.valueToDisplayValue(this.value),\r\n            this.valueToDisplayValue(this.min),\r\n            this.valueToDisplayValue(this.max),\r\n            this.sliderWrapperEl.getBoundingClientRect(),\r\n            (val) => {\r\n                val = this.displayValueToValue(val);\r\n                this.setValue(BB.clamp(val, this.min, this.max));\r\n                this.onChange(this.value);\r\n            },\r\n            () => {\r\n                BB.css(this.sliderWrapperEl, {\r\n                    display: null,\r\n                });\r\n                this.roolEl.removeChild(this.manualInput.getElement());\r\n                this.manualInput.destroy();\r\n                this.manualInput = null;\r\n            },\r\n            (this.manualInputRoundDigits && this.manualInputRoundDigits > 0) ? this.manualInputRoundDigits : 0,\r\n        );\r\n        this.roolEl.append(this.manualInput.getElement());\r\n        setTimeout(() => {\r\n            this.manualInput.focus();\r\n        });\r\n        BB.css(this.sliderWrapperEl, {\r\n            display: 'none',\r\n        });\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        p: {\r\n            label: string,\r\n            width: number, // px\r\n            height: number, // px\r\n            min: number, // min value\r\n            max: number,\r\n            value: number,\r\n            resolution?: number, // int, if you want spline.findX() to use a custom resolution\r\n            curve?: 'quadratic' | any[], // optional. array is BB.SplineInterpolator points. 0-1\r\n            formatFunc?: (val: number) => number, // function to display a different number than value\r\n            onChange?: (val: number) => void,\r\n            isChangeOnFinal?: boolean, // only fire onChange on pointerUp\r\n            eventResMs?: number, // frequency of change events\r\n            isEnabled?: boolean, // default = true\r\n            manualInputRoundDigits?: number, // default 0, how value should be rounded for manual input\r\n            toDisplayValue?: (value: number) => number,\r\n            toValue?: (displayValue: number) => number,\r\n        }\r\n    ) {\r\n        const _this = this;\r\n        this.isEnabled = p.isEnabled !== false;\r\n        this.manualInputRoundDigits = p.manualInputRoundDigits;\r\n        this.useSpline = !!p.curve;\r\n\r\n        if (!p.label) {\r\n            throw new Error('KlSlider missing params');\r\n        }\r\n        if (p.min != 0 && p.max != 0 && p.value != 0) {\r\n            if (!p.min || !p.max || !p.value) {\r\n                throw new Error('KlSlider broken params');\r\n            }\r\n        }\r\n        if (p.min >= p.max) {\r\n            throw new Error('KlSlider broken params');\r\n        }\r\n\r\n        this.min = p.min;\r\n        this.max = p.max;\r\n        this.value = BB.clamp(p.value, this.min, this.max);\r\n        this.elementWidth = p.width;\r\n        this.elementHeight = p.height;\r\n        this.resolution = p.resolution ? p.resolution : this.elementWidth * 2;\r\n\r\n        this.onChange = p.onChange ? p.onChange : () => {};\r\n        if (!this.displayValueToValue !== !this.valueToDisplayValue) {\r\n            throw new Error('both or neither have to be set, toValue and toDisplayValue');\r\n        }\r\n        this.displayValueToValue = p.toValue ? p.toValue : (displayValue) => displayValue;\r\n        this.valueToDisplayValue = p.toDisplayValue ? p.toDisplayValue : (value) => value;\r\n        this.isChangeOnFinal = !!p.isChangeOnFinal;\r\n        this.formatFunc = p.formatFunc;\r\n        this.eventResMs = p.eventResMs;\r\n\r\n        if (this.useSpline) {\r\n            const curveArr = p.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : p.curve;\r\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        }\r\n\r\n        this.roolEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n        this.sliderWrapperEl = BB.el({\r\n            parent: this.roolEl,\r\n            className: 'sliderWrapper',\r\n            css: {\r\n                overflow: 'hidden',\r\n                position: 'relative',\r\n                width: this.elementWidth + 'px',\r\n                height: this.elementHeight + 'px',\r\n                userSelect: 'none'\r\n            }\r\n        });\r\n        this.roolEl.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        this.label = p.label;\r\n        const labelFontSize = this.elementHeight - 14;\r\n        this.textEl = BB.el({\r\n            content: this.label,\r\n            css: {\r\n                position: 'absolute',\r\n                left: '7px',\r\n                top: (this.elementHeight / 2 - labelFontSize / 2 + 1) + 'px',\r\n                lineHeight: labelFontSize + 'px',\r\n                fontSize: labelFontSize + 'px',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        this.control = BB.el({\r\n            className: 'sliderInner',\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                width: (this.valueToSliderValue(this.value) * this.elementWidth) + 'px',\r\n                height: this.elementHeight + 'px',\r\n            }\r\n        });\r\n        const controlInner = document.createElement('div');\r\n\r\n        this.sliderWrapperEl.append(this.control, this.textEl);\r\n        this.control.append(controlInner);\r\n\r\n        this.updateEnable();\r\n\r\n\r\n        const doubleTapper = new DoubleTapper({\r\n            onDoubleTap: () => {\r\n                this.showManualInput();\r\n            }\r\n        })\r\n        doubleTapper.setAllowedButtonArr(['left', 'right']);\r\n        const eventChain = new EventChain({\r\n            chainArr: [\r\n                doubleTapper\r\n            ]\r\n        });\r\n\r\n        let virtualVal;\r\n        const onPointer = (event) => {\r\n            event.eventPreventDefault();\r\n\r\n            if (!this.isEnabled) {\r\n                return;\r\n            }\r\n\r\n            if (event.type === 'pointerdown') {\r\n\r\n                // unfocus manual slider input\r\n                BB.unfocusAnyInput();\r\n\r\n                this.sliderWrapperEl.className = 'sliderWrapper sliderWrapperActive';\r\n\r\n                if (event.button === 'left') {\r\n                    let sliderValue = event.relX / this.elementWidth;\r\n                    sliderValue = Math.max(0, Math.min(1, sliderValue));\r\n                    this.value = this.sliderValuetoValue(sliderValue);\r\n                    this.updateLabel();\r\n                    this.emit(false);\r\n                }\r\n                virtualVal = this.valueToSliderValue(this.value);\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                let deltaX = event.dX;\r\n                const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n                deltaX *= factor;\r\n                deltaX /= this.elementWidth;\r\n\r\n                virtualVal += deltaX;\r\n\r\n                let sliderValue = Math.max(0, Math.min(1, virtualVal));\r\n                this.value = this.sliderValuetoValue(sliderValue);\r\n                this.updateLabel();\r\n                this.emit(false);\r\n            }\r\n\r\n            if (event.type === 'pointerup') {\r\n                this.sliderWrapperEl.className = 'sliderWrapper';\r\n                this.emit(true);\r\n            }\r\n\r\n        }\r\n\r\n        this.pointerListenerTimeout = setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.sliderWrapperEl,\r\n                maxPointers: 1,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    onPointer(e);\r\n                    eventChain.chainIn(e);\r\n                },\r\n                onWheel: (event) => {\r\n                    let sliderValue = this.valueToSliderValue(this.value);\r\n                    sliderValue = BB.clamp(sliderValue - event.deltaY / 40, 0, 1);\r\n                    this.value = this.sliderValuetoValue(sliderValue);\r\n                    this.updateLabel();\r\n                    this.onChange(this.value);\r\n                }\r\n            });\r\n            this.updateLabel();\r\n        }, 1);\r\n    }\r\n\r\n    changeSliderValue(f: number): void {\r\n        if (!this.isEnabled) {\r\n            return;\r\n        }\r\n        let sliderValue = this.valueToSliderValue(this.value);\r\n        sliderValue = BB.clamp(sliderValue + f, 0, 1);\r\n        this.value = this.sliderValuetoValue(sliderValue);\r\n        this.updateLabel();\r\n        this.onChange(this.value);\r\n    }\r\n\r\n    setValue (v: number): void {\r\n        this.value = BB.clamp(v, this.min, this.max);\r\n        this.updateLabel();\r\n    }\r\n\r\n    getValue (): number {\r\n        return this.value;\r\n    }\r\n\r\n    update (config: IKlSliderConfig): void {\r\n        this.min = config.min;\r\n        this.max = config.max;\r\n        this.useSpline = !!config.curve;\r\n        if (this.useSpline) {\r\n            const curveArr = config.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : config.curve;\r\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        } else {\r\n            this.splineInterpolator = null;\r\n        }\r\n        this.setIsEnabled(!config.isDisabled);\r\n    }\r\n\r\n    setIsEnabled (e: boolean): void {\r\n        this.isEnabled = !!e;\r\n        this.updateEnable();\r\n    }\r\n\r\n    destroy (): void {\r\n        clearTimeout(this.pointerListenerTimeout);\r\n        if (this.pointerListener) {\r\n            this.pointerListener.destroy();\r\n        }\r\n        if (this.manualInput) {\r\n            this.manualInput.destroy();\r\n        }\r\n        if (this.emitInterval) {\r\n            clearInterval(this.emitInterval);\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.roolEl;\r\n    }\r\n\r\n}\r\n","\r\n\r\n/**\r\n * to make sliders more finegrained.\r\n * @param deltaY number - how far pointer moved away vertically since down\r\n * @returns {number} the factor 0-1. 0 -> infinite movement for change of 1. 1 -> 1px for change of 1\r\n */\r\nexport const calcSliderFalloffFactor = function(deltaY, isRightButton) {\r\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\r\n    if (isRightButton) {\r\n        result *= 2;\r\n    }\r\n    return 1 / result;\r\n};\r\n","import {BB} from '../../../bb/bb';\r\nimport {input} from './input';\r\n\r\n/**\r\n * Used by KlSlider. Allows user to type in value in input (type=number) field, instead of dragging with mouse.\r\n * Input goes away when losing focus, or when pressing Enter/Escape.\r\n */\r\nexport class KlSliderManualInput {\r\n\r\n    private input: HTMLInputElement;\r\n    private isEnabled: boolean;\r\n    private scrollBefore: { x: number, y: number }; // window scroll position on creation\r\n    private lastValue: number; // last emitted value\r\n    private isClosed: boolean = false;\r\n\r\n    private emit(): void {\r\n        if (this.lastValue !== Number(this.input.value)) {\r\n            this.onChange(Number(this.input.value));\r\n            this.lastValue = Number(this.input.value);\r\n        }\r\n    }\r\n\r\n    private privateOnClose(): void {\r\n        if (this.isClosed) {\r\n            return;\r\n        }\r\n        this.isClosed = true;\r\n\r\n        this.emit();\r\n        this.onClose();\r\n        setTimeout(() => {\r\n            // because iPad keyboard changes the scroll position\r\n            window.scrollTo(this.scrollBefore.x, this.scrollBefore.y);\r\n            this.scrollBefore = null;\r\n        });\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor(\r\n        value: number, // initial value (displayValue)\r\n        min: number,\r\n        max: number,\r\n        rect: DOMRect, // size of input field\r\n        private onChange: (displayValue: number) => void,\r\n        private onClose: () => void,\r\n        roundDigits?: number,\r\n    ) {\r\n\r\n        this.input = input({\r\n            type: 'number',\r\n            init: value,\r\n            min,\r\n            max,\r\n            callback: (val) => {\r\n                this.emit();\r\n            },\r\n        });\r\n        if (roundDigits !== 0) {\r\n            this.input.setAttribute('step', 'any');\r\n        }\r\n        this.input.onblur = () => {\r\n            this.privateOnClose();\r\n        };\r\n        this.input.addEventListener('keyup', (e) => {\r\n            if (['Enter', 'Escape'].includes(e.key)) {\r\n                this.privateOnClose();\r\n            } else {\r\n                this.emit();\r\n            }\r\n        });\r\n        this.input.addEventListener('wheel', () => this.emit());\r\n\r\n        this.scrollBefore = {\r\n            x: window.scrollX,\r\n            y: window.scrollY,\r\n        };\r\n\r\n        let currentValue;\r\n        if (roundDigits || roundDigits === 0) {\r\n            currentValue = BB.round(value, roundDigits);\r\n        } else {\r\n            currentValue = value;\r\n        }\r\n        this.lastValue = currentValue;\r\n        this.input.value = '' + currentValue;\r\n\r\n        BB.css(this.input, {\r\n            width: rect.width + 'px',\r\n            height: rect.height + 'px',\r\n        });\r\n    }\r\n\r\n    getElement() {\r\n        return this.input;\r\n    }\r\n\r\n    setIsEnabled(b: boolean): void {\r\n        this.isEnabled = !!b;\r\n    }\r\n\r\n    focus(): void {\r\n        this.input.focus();\r\n        this.input.select();\r\n    }\r\n\r\n    destroy(): void {\r\n        BB.destroyEl(this.input);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {input} from '../base-components/input';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n// @ts-ignore\r\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\r\n\r\n/**\r\n * dialog for manually inputting the color\r\n * @param p {color: rgbObj, onClose: function(rgbObj | null)}\r\n * @constructor\r\n */\r\nexport const HexColorDialog = function (p) {\r\n\r\n    let lastValidRgb = new BB.RGB(p.color.r, p.color.g, p.color.b);\r\n\r\n    const div = BB.el({});\r\n\r\n    const previewEl = BB.el({\r\n        css: {\r\n            width: '20px',\r\n            height: '20px',\r\n            marginBottom: '10px',\r\n            boxShadow: 'inset 0 0 0 1px #fff, 0 0 0 1px #000',\r\n            background: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.appendChild(previewEl);\r\n\r\n\r\n    // --- Hex ---\r\n    const hexRowEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginBottom: '15px'\r\n        }\r\n    });\r\n    const hexLabel = BB.el({\r\n        content: LANG('mci-hex'),\r\n        css: {\r\n            width: '60px'\r\n        }\r\n    });\r\n    const hexInput = input({\r\n        init: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n        css: {\r\n            width: '80px'\r\n        },\r\n        callback: function() {\r\n            let rgbObj = BB.ColorConverter.hexToRGB(hexInput.value);\r\n            if (rgbObj === null) {\r\n                rgbObj = lastValidRgb;\r\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n            } else {\r\n                lastValidRgb = rgbObj;\r\n            }\r\n            previewEl.style.background = '#' + BB.ColorConverter.toHexString(rgbObj);\r\n\r\n            for (let i = 0; i < rgbArr.length; i++) {\r\n                rgbArr[i].update();\r\n            }\r\n        }\r\n    });\r\n    const copyButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img src=\"' + copyImg + '\" height=\"20\"/>',\r\n        title: LANG('mci-copy'),\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            hexInput.select();\r\n            document.execCommand('copy');\r\n        }\r\n    });\r\n    hexRowEl.appendChild(hexLabel);\r\n    hexRowEl.appendChild(hexInput);\r\n    hexRowEl.appendChild(copyButton);\r\n    div.appendChild(hexRowEl);\r\n    setTimeout(function () {\r\n        hexInput.focus();\r\n        hexInput.select();\r\n    }, 0);\r\n\r\n\r\n    // --- R G B ---\r\n    function createRgbInputRow(labelStr, attributeStr) {\r\n        const result: any = {};\r\n\r\n        const rowEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '5px',\r\n            }\r\n        });\r\n        const labelEl = BB.el({\r\n            content: labelStr,\r\n            css: {\r\n                width: '60px'\r\n            }\r\n        });\r\n\r\n        const inputEl = input({\r\n            init: lastValidRgb[attributeStr],\r\n            min: 0,\r\n            max: 255,\r\n            type: 'number',\r\n            css: {\r\n                width: '80px'\r\n            },\r\n            callback: function() {\r\n                if (inputEl.value === '' || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\r\n                    result.update();\r\n                    return;\r\n                }\r\n                inputEl.value = '' + Math.round(parseFloat(inputEl.value));\r\n                lastValidRgb[attributeStr] = inputEl.value;\r\n                previewEl.style.background = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n            }\r\n        });\r\n\r\n        rowEl.appendChild(labelEl);\r\n        rowEl.appendChild(inputEl);\r\n        div.appendChild(rowEl);\r\n\r\n\r\n        result.update = function() {\r\n            inputEl.value = lastValidRgb[attributeStr];\r\n        };\r\n        result.destroy = () => {\r\n            inputEl.onchange = null;\r\n        };\r\n        return result;\r\n    }\r\n    const rgbArr = [];\r\n    rgbArr.push(createRgbInputRow(LANG('red'), 'r'));\r\n    rgbArr.push(createRgbInputRow(LANG('green'), 'g'));\r\n    rgbArr.push(createRgbInputRow(LANG('blue'), 'b'));\r\n\r\n\r\n    popup({\r\n        target: document.body,\r\n        message: `<b>${LANG('manual-color-input')}</b>`,\r\n        div: div,\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (resultStr) {\r\n            BB.destroyEl(copyButton);\r\n            rgbArr.forEach(item => item.destroy());\r\n            rgbArr.splice(0, rgbArr.length);\r\n\r\n            p.onClose(resultStr === 'Ok' ? BB.ColorConverter.hexToRGB(hexInput.value) : null);\r\n        }\r\n    });\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"la7yv\");","import {BB} from '../../../bb/bb';\r\nimport {HexColorDialog} from '../modals/color-slider-hex-dialog';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\n// @ts-ignore\r\nimport eyedropperImg from 'url:~/src/app/img/ui/tool-picker.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * big main HS+V color slider\r\n * 2 elements: slider, and colorpreview(output) + eyedropper\r\n *\r\n * p = {\r\n *     width: number,\r\n *     height: number, // hue slider and output height\r\n *     svHeight: number,\r\n *     startValue: rgb, // 0-255\r\n *     onPick: function(rgb)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const KlColorSlider = function (p) {\r\n\r\n    const _this = this;\r\n    let pickCallback = function(result?) {};\r\n    const div = document.createElement('div');\r\n    div.style.position = 'relative';\r\n    div.className = 'colorSlider';\r\n    const outputDiv = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center'\r\n        }\r\n    });\r\n    const width = p.width;\r\n    let svHeight = p.svHeight;\r\n    const height = p.height;\r\n    const emitColor = p.onPick;\r\n\r\n    let primaryColorRGB = {\r\n        r: parseInt(p.startValue.r, 10),\r\n        g: parseInt(p.startValue.g, 10),\r\n        b: parseInt(p.startValue.b, 10)\r\n    };\r\n    let primaryColorHSV = BB.ColorConverter.toHSV(p.startValue); // BB.HSV\r\n    let secondaryColorRGB = {r: 255, g: 255, b: 255};\r\n    let secondaryColorHSV = BB.ColorConverter._RGBtoHSV(secondaryColorRGB); // BB.HSV\r\n\r\n    const svWrapper = BB.el({});\r\n    const svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"> <defs> <linearGradient id=\"value\" gradientTransform=\"rotate(90)\"> <stop offset=\"0\" stop-color=\"rgba(0,0,0,0)\"/> <stop offset=\"100%\" stop-color=\"rgba(0,0,0,1)\"/> </linearGradient> <linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"> <stop offset=\"0\" stop-color=\"#fff\"/> <stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/> </linearGradient> </defs> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\"/></svg>', 'image/svg+xml').documentElement;\r\n    const hueStop = (svSvg as any).getElementById('hue-stop');\r\n    BB.setAttributes(hueStop, {\r\n        'stop-color': '#f0f'\r\n    });\r\n    BB.css(svSvg, {\r\n        width: width + 'px',\r\n        height: svHeight + 'px'\r\n    });\r\n    svWrapper.appendChild(svSvg);\r\n\r\n    const divH = document.createElement('div');\r\n    BB.css(divH, {\r\n        position: 'relative',\r\n        height: height + 'px'\r\n    });\r\n    const divPreview = document.createElement('div');\r\n    const controlH = document.createElement('div');\r\n\r\n    const enabled = true;\r\n\r\n    function updatePrimaryHSV(hsv) {\r\n        if (hsv.s === 0) {\r\n            primaryColorHSV = new BB.HSV(primaryColorHSV.h, hsv.s, hsv.v);\r\n        } else {\r\n            primaryColorHSV = new BB.HSV(hsv.h, hsv.s, hsv.v);\r\n        }\r\n    }\r\n\r\n    function createHueBg(targetEl) {\r\n        const im = new Image();\r\n        BB.css(im, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            display: 'none',\r\n            pointerEvents: 'none'\r\n        });\r\n        const cv = BB.canvas(width, height);\r\n        const ctx = cv.getContext('2d');\r\n        const gradH = ctx.createLinearGradient(0, 0, width, 0);\r\n        for (let i = 0; i < 1; i += 0.01) {\r\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n            let ha = (parseInt('' + col.r)).toString(16);\r\n            let hb = (parseInt('' + col.g)).toString(16);\r\n            let hc = (parseInt('' + col.b)).toString(16);\r\n            if (ha.length === 1)\r\n                ha = '0' + ha;\r\n            if (hb.length === 1)\r\n                hb = '0' + hb;\r\n            if (hc.length === 1)\r\n                hc = '0' + hc;\r\n            gradH.addColorStop(i, '#' + ha + hb + hc);\r\n        }\r\n        ctx.fillStyle = gradH;\r\n        ctx.fillRect(0, 0, width, height);\r\n\r\n        targetEl.appendChild(im);\r\n        im.alt = 'hue';\r\n        im.src = cv.toDataURL('image/png');\r\n        im.style.display = 'block';\r\n    }\r\n\r\n\r\n    function updateSVCanvas() {\r\n        const rgb = BB.ColorConverter.toRGB(new BB.HSV(primaryColorHSV.h, 100, 100));\r\n        BB.setAttributes(hueStop, {\r\n            'stop-color': '#' + BB.ColorConverter.toHexString(rgb)\r\n        });\r\n    }\r\n\r\n    function updateSVPointer() {\r\n\r\n        const left = primaryColorHSV.s / 100 * width - 7;\r\n        const top = (1 - primaryColorHSV.v / 100) * svHeight - 6;\r\n        BB.css(pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px'\r\n        });\r\n    }\r\n\r\n    function setColPreview() {\r\n        divPreview.style.backgroundColor = 'rgb(' + primaryColorRGB.r + ',' + primaryColorRGB.g + ',' + primaryColorRGB.b + ')';\r\n\r\n        if (BB.testIsWhiteBestContrast(primaryColorRGB)) {\r\n            BB.css(pickerButton, {\r\n                filter: 'invert(1)'\r\n            });\r\n            BB.css(hexButton, {\r\n                filter: 'invert(1)'\r\n            });\r\n        } else{\r\n            BB.css(pickerButton, {\r\n                filter: ''\r\n            });\r\n            BB.css(hexButton, {\r\n                filter: ''\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    updateSVCanvas();\r\n    div.style.width = width + 'px';\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    const SVContainer = document.createElement('div');\r\n    BB.css(SVContainer, {\r\n        width: width + 'px',\r\n        height: svHeight + 'px',\r\n        overflow: 'hidden',\r\n        display: 'block',\r\n        position: 'relative',\r\n        cursor: 'crosshair',\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\r\n    });\r\n\r\n    const pointerSV = document.createElement('div');\r\n    BB.css(pointerSV, {\r\n        width: '12px',\r\n        height: '12px',\r\n        borderRadius: '6px',\r\n        position: 'absolute',\r\n        pointerEvents: 'none',\r\n        boxShadow: '0px 0px 0 1px #000, inset 0px 0px 0 1px #fff'\r\n    });\r\n\r\n    SVContainer.appendChild(svWrapper);\r\n    SVContainer.appendChild(pointerSV);\r\n    updateSVPointer();\r\n    div.appendChild(SVContainer);\r\n    div.appendChild(divH);\r\n    outputDiv.appendChild(divPreview);\r\n    BB.css(divPreview, {\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        width: (height * 2.5) + 'px',\r\n        height: height + 'px',\r\n        //position: \"relative\",\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\r\n        colorScheme: 'only light',\r\n    });\r\n\r\n    BB.css(divH, {\r\n        overflow: 'hidden',\r\n        position: 'relative',\r\n        width: width + 'px',\r\n        height: height + 'px',\r\n        cursor: 'ew-resize',\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\r\n        marginTop: '1px',\r\n        marginBottom: '1px'\r\n    });\r\n\r\n    //divH.className = \"svSlider\";\r\n    BB.css(controlH, {\r\n        width: '1px',\r\n        height: height + 'px',\r\n        background: '#000',\r\n        borderLeft: '1px solid #fff',\r\n        position: 'absolute',\r\n        top: '0',\r\n        left: parseInt('' + (primaryColorHSV.h / 360 * width - 1)) + 'px'\r\n    });\r\n\r\n\r\n    const virtualHSV = {\r\n        h: 0,\r\n        s: 0,\r\n        v: 0\r\n    };\r\n    let svPointerListener;\r\n    let hPointerListener;\r\n\r\n\r\n    const pickerButton = BB.el({\r\n        title: LANG('eyedropper') + ' [Alt]',\r\n        className: 'color-picker-preview-button',\r\n        css: {\r\n            width: '30px',\r\n            height: '30px',\r\n            backgroundImage: 'url(' + eyedropperImg + ')',\r\n            backgroundRepeat:  'no-repeat',\r\n            backgroundSize: '70%',\r\n            backgroundPosition: 'center'\r\n        }\r\n    });\r\n    let isPicking = false;\r\n\r\n\r\n    pickerButton.onclick = function () {\r\n        if (isPicking === false) {\r\n            pickerButton.classList.remove('color-picker-preview-button-hover');\r\n            pickerButton.classList.add('color-picker-preview-button-active');\r\n            isPicking = true;\r\n            pickCallback(true);\r\n        } else {\r\n            pickCallback(false);\r\n            _this.pickingDone();\r\n        }\r\n    };\r\n    const pickerButtonPointerListener = new BB.PointerListener({\r\n        target: pickerButton,\r\n        onEnterLeave: function(isOver) {\r\n            if (isPicking) {\r\n                return;\r\n            }\r\n            pickerButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n        }\r\n    });\r\n    divPreview.appendChild(pickerButton);\r\n\r\n\r\n    const hexButton = BB.el({\r\n        content: '#',\r\n        className: 'color-picker-preview-button',\r\n        title: LANG('manual-color-input'),\r\n        css: {\r\n            height: '100%',\r\n            width: height + 'px',\r\n            lineHeight: height + 'px',\r\n            fontSize: (height * 0.65) + 'px'\r\n        },\r\n        onClick: function() {\r\n            HexColorDialog({\r\n                color: new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b),\r\n                onClose: function(rgbObj) {\r\n                    if (!rgbObj) {\r\n                        return;\r\n                    }\r\n                    _this.setColor(rgbObj);\r\n                    emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\r\n                }\r\n            });\r\n        }\r\n    });\r\n    const hexButtonPointerListener = new BB.PointerListener({\r\n        target: hexButton,\r\n        onEnterLeave: function(isOver) {\r\n            hexButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n        }\r\n    });\r\n    divPreview.appendChild(hexButton);\r\n\r\n    setColPreview();\r\n\r\n\r\n    setTimeout(function() {\r\n        createHueBg(divH);\r\n        divH.appendChild(controlH);\r\n        svPointerListener = new BB.PointerListener({\r\n            target: svWrapper,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown') {\r\n\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    BB.unfocusAnyInput();\r\n\r\n                    BB.css(SVContainer, {\r\n                        boxShadow: '0px 0px 0px 1px rgb(255,255,255)',\r\n                        zIndex: '1'\r\n                    });\r\n\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.s = event.relX / width * 100;\r\n                        virtualHSV.v = 100 - event.relY / svHeight * 100;\r\n\r\n                        primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n\r\n                        updateSVPointer();\r\n                        setColPreview();\r\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n                    } else {\r\n                        virtualHSV.s = primaryColorHSV.s;\r\n                        virtualHSV.v = primaryColorHSV.v;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                    let factor = 1;\r\n                    if (event.button === 'right') {\r\n                        factor = 0.5;\r\n                    }\r\n\r\n                    virtualHSV.s += event.dX / width * 100 * factor;\r\n                    virtualHSV.v -= event.dY / svHeight * 100 * factor;\r\n\r\n                    primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                    updateSVPointer();\r\n                    setColPreview();\r\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n\r\n                }\r\n\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(SVContainer, {\r\n                        boxShadow: '0 0 0 1px rgb(188, 188, 188)',\r\n                        zIndex: '0'\r\n                    });\r\n                }\r\n\r\n            }\r\n        });\r\n        hPointerListener = new BB.PointerListener({\r\n            target: divH,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n\r\n                if (event.type === 'pointerdown') {\r\n\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    BB.unfocusAnyInput();\r\n\r\n                    BB.css(divH, {\r\n                        boxShadow: '0px 0px 0px 1px rgba(255,255,255,1)'\r\n                    });\r\n\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.h = event.relX / width * 359.99;\r\n\r\n                        primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\r\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                        controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\r\n                        updateSVCanvas();\r\n                        setColPreview();\r\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n                    } else {\r\n                        virtualHSV.h = primaryColorHSV.h;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                    const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                    const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                    virtualHSV.h += event.dX / width * 359.99 * factor;\r\n\r\n                    if (event.button === 'right') {\r\n                        virtualHSV.h = virtualHSV.h % 359.99;\r\n                        if (virtualHSV.h < 0) {\r\n                            virtualHSV.h += 359.99;\r\n                        }\r\n                    }\r\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                    primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\r\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                    controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\r\n                    updateSVCanvas();\r\n                    setColPreview();\r\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n\r\n                }\r\n\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(divH, {\r\n                        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    }, 1);\r\n\r\n\r\n    // --- second color ---\r\n\r\n    const secondaryColorBtn = BB.el({\r\n        parent: outputDiv,\r\n        title: LANG('secondary-color') + ' [X]',\r\n        css: {\r\n            cursor: 'pointer',\r\n            marginLeft: '5px',\r\n            width: '22px',\r\n            height: '22px',\r\n            boxShadow: 'rgb(188, 188, 188) 0px 0px 0px 1px',\r\n            colorScheme: 'only light',\r\n        },\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            swapColors();\r\n        }\r\n    });\r\n    function updateSecondaryColor() {\r\n        secondaryColorBtn.style.backgroundColor = BB.ColorConverter.toRgbStr(secondaryColorRGB);\r\n    }\r\n    function swapColors() {\r\n        // swap hsv\r\n        let tmp: any = secondaryColorHSV;\r\n        secondaryColorHSV = primaryColorHSV;\r\n        updatePrimaryHSV(tmp);\r\n        // swap rgb\r\n        tmp = secondaryColorRGB;\r\n        secondaryColorRGB = primaryColorRGB;\r\n        primaryColorRGB = tmp;\r\n\r\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\r\n        updateSVCanvas();\r\n        updateSVPointer();\r\n        setColPreview();\r\n        updateSecondaryColor();\r\n\r\n        emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\r\n    }\r\n    updateSecondaryColor();\r\n\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.setColor = function (c) {\r\n        primaryColorRGB = {r: parseInt(c.r, 10), g: parseInt(c.g, 10), b: parseInt(c.b, 10)};\r\n        updatePrimaryHSV(BB.ColorConverter.toHSV(c));\r\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\r\n        updateSVCanvas();\r\n        updateSVPointer();\r\n        setColPreview();\r\n    };\r\n\r\n    this.getColor = function () {\r\n        return new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b);\r\n    };\r\n\r\n    this.getSecondaryRGB = function() {\r\n        return new BB.RGB(secondaryColorRGB.r, secondaryColorRGB.g, secondaryColorRGB.b);\r\n    };\r\n\r\n    this.setPickCallback = function (func) {\r\n        pickCallback = func;\r\n    };\r\n\r\n    this.pickingDone = function () {\r\n        if (!isPicking) {\r\n            return;\r\n        }\r\n        isPicking = false;\r\n        pickerButton.classList.remove('color-picker-preview-button-active');\r\n    };\r\n\r\n    this.enable = function (e) {\r\n        if (e) {\r\n            div.style.pointerEvents = '';\r\n            div.style.opacity = '1';\r\n            outputDiv.style.pointerEvents = '';\r\n            outputDiv.style.opacity = '1';\r\n        } else {\r\n            div.style.pointerEvents = 'none';\r\n            div.style.opacity = '0.5';\r\n            outputDiv.style.pointerEvents = 'none';\r\n            outputDiv.style.opacity = '0.5';\r\n        }\r\n    };\r\n\r\n    this.setHeight = function (h) {\r\n        h = parseInt('' +(h - height * 2 - 3), 10);\r\n        if (h === svHeight) {\r\n            return;\r\n        }\r\n        svHeight = h;\r\n        BB.css(svSvg, {\r\n            width: width + 'px',\r\n            height: svHeight + 'px'\r\n        });\r\n        SVContainer.style.height = svHeight + 'px';\r\n        updateSVPointer();\r\n    };\r\n\r\n    this.swapColors = function() {\r\n        swapColors();\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.getOutputElement = function() {\r\n        return outputDiv;\r\n    }\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cTtMO\");","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\n\r\n\r\n/**\r\n * a small color slider\r\n *\r\n * params {\r\n * \t width: 200,\r\n * \t heightSV: 200,\r\n * \t heightH: 10,\r\n * \t color: {r,g,b}\r\n * \t callback: function(c){}\r\n * }\r\n *\r\n * @param params\r\n * @constructor\r\n */\r\nexport const KlSmallColorSlider = function (params) {\r\n    const div = document.createElement('div');\r\n    div.oncontextmenu = function(e) {\r\n        e.preventDefault();\r\n    };\r\n    let color = BB.ColorConverter.toHSV(new BB.RGB(params.color.r, params.color.g, params.color.b));\r\n    BB.css(div, {\r\n        width: params.width + 'px',\r\n        position: 'relative',\r\n        overflow: 'hidden',\r\n        userSelect: 'none'\r\n    });\r\n\r\n    const canvasSV = BB.canvas(10, 10);\r\n    canvasSV.style.width = params.width + 'px';\r\n    canvasSV.style.height = params.heightSV + 'px';\r\n    canvasSV.style.cursor = 'crosshair';\r\n\r\n    function updateSV() {\r\n        const ctx = canvasSV.getContext('2d');\r\n        for (let i = 0; i < canvasSV.height; i += 1) {\r\n            const gradient1 = ctx.createLinearGradient(0, 0, canvasSV.width, 0);\r\n\r\n            const colleft = BB.ColorConverter.toRGB(new BB.HSV(color.h, 1, 100 - (i / canvasSV.height * 100.0)));\r\n            const colright = BB.ColorConverter.toRGB(new BB.HSV(color.h, 100, 100 - (i / canvasSV.height * 100.0)));\r\n            gradient1.addColorStop(0, '#' + BB.ColorConverter.toHexString(colleft));\r\n            gradient1.addColorStop(1, '#' + BB.ColorConverter.toHexString(colright));\r\n            ctx.fillStyle = '#ff0000'; //needed for chrome...otherwise alpha problem\r\n            ctx.fillStyle = gradient1;\r\n            ctx.fillRect(0, i, canvasSV.width, 1);\r\n        }\r\n    }\r\n\r\n    updateSV();\r\n\r\n    const canvasH = BB.canvas(params.width, params.heightH);\r\n    canvasH.style.cursor = 'ew-resize';\r\n    (function () {\r\n        const ctx = canvasH.getContext('2d');\r\n\r\n        const gradH = ctx.createLinearGradient(0, 0, params.width, 0);\r\n        for (let i = 0; i < 1; i += 0.01) {\r\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n            gradH.addColorStop(i, 'rgba(' + parseInt('' + col.r) + ', ' + parseInt('' + col.g) + ', ' + parseInt('' + col.b) + ', 1)');\r\n        }\r\n        ctx.fillStyle = gradH;\r\n        ctx.fillRect(0, 0, params.width, params.heightH);\r\n\r\n    })();\r\n    BB.css(canvasSV, {\r\n        width: params.width + 'px',\r\n        height: params.heightSV + 'px',\r\n        overflow: 'hidden',\r\n        position: 'relative'\r\n    });\r\n    canvasSV.style.cssFloat = 'left';\r\n    canvasH.style.cssFloat = 'left';\r\n\r\n    div.appendChild(canvasSV);\r\n    div.appendChild(canvasH);\r\n\r\n    const pointerSV = document.createElement('div');\r\n    BB.css(pointerSV, {\r\n        width: '8px',\r\n        height: '8px',\r\n        borderRadius: '8px',\r\n        position: 'absolute',\r\n        pointerEvents: 'none',\r\n        boxShadow: '0 0 0 1px #000, inset 0 0 0 1px #fff'\r\n    });\r\n    div.appendChild(pointerSV);\r\n\r\n    const pointerH = document.createElement('div');\r\n    BB.css(pointerH, {\r\n        width: '0',\r\n        height: params.heightH + 'px',\r\n        borderLeft: '1px solid #fff',\r\n        borderRight: '1px solid #000',\r\n        position: 'absolute',\r\n        top: params.heightSV + 'px',\r\n        pointerEvents: 'none'\r\n    });\r\n    div.appendChild(pointerH);\r\n\r\n\r\n    function updateSVPointer() {\r\n        const left = color.s / 100 * params.width - 4;\r\n        const top = (1 - color.v / 100) * params.heightSV - 4;\r\n        BB.css(pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px'\r\n        });\r\n        /*if (top < params.heightSV/3) {\r\n        pointerSV.style.border = \"1px solid rgba(0,0,0,1)\";\r\n    } else {\r\n        pointerSV.style.border = \"1px solid rgba(255,255,255,1)\";\r\n    }*/\r\n    }\r\n\r\n    function updateHPointer() {\r\n        pointerH.style.left = (color.h / 359.999 * params.width - 1) + 'px';\r\n    }\r\n\r\n    updateSVPointer();\r\n    updateHPointer();\r\n\r\n    const virtualHSV = {\r\n        h: 0,\r\n        s: 0,\r\n        v: 0\r\n    };\r\n\r\n    let svPointerId = null;\r\n    const svPointerListener = new BB.PointerListener({\r\n        target: canvasSV,\r\n        maxPointers: 1,\r\n        fixScribble: true,\r\n        onPointer: function(event) {\r\n\r\n            if (event.type === 'pointerdown') {\r\n\r\n                // prevent manual slider input keeping focus on iPad\r\n                BB.unfocusAnyInput();\r\n\r\n                svPointerId = event.pointerId;\r\n                if (event.button === 'left') {\r\n\r\n                    virtualHSV.s = event.relX / params.width * 100;\r\n                    virtualHSV.v = 100 - event.relY / params.heightSV * 100;\r\n\r\n                    color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\r\n\r\n                    updateSVPointer();\r\n                    params.callback(BB.ColorConverter.toRGB(color));\r\n                } else {\r\n                    virtualHSV.s = color.s;\r\n                    virtualHSV.v = color.v;\r\n                }\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && svPointerId === event.pointerId) {\r\n\r\n                let factor = 1;\r\n                if (event.button === 'right') {\r\n                    factor = 0.5;\r\n                }\r\n\r\n                virtualHSV.s += event.dX / params.width * 100 * factor;\r\n                virtualHSV.v -= event.dY / params.heightSV * 100 * factor;\r\n\r\n                color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\r\n                updateSVPointer();\r\n                params.callback(BB.ColorConverter.toRGB(color));\r\n\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                svPointerId = null;\r\n            }\r\n\r\n        }\r\n    });\r\n\r\n    let hPointerId = null;\r\n    const hPointerListener = new BB.PointerListener({\r\n        target: canvasH,\r\n        maxPointers: 1,\r\n        fixScribble: true,\r\n        onPointer: function(event) {\r\n\r\n            if (event.type === 'pointerdown') {\r\n                hPointerId = event.pointerId;\r\n                if (event.button === 'left') {\r\n\r\n                    virtualHSV.h = event.relX / params.width * 359.99;\r\n\r\n                    color = new BB.HSV(virtualHSV.h, color.s, color.v);\r\n                    updateSV();\r\n                    updateHPointer();\r\n                    params.callback(BB.ColorConverter.toRGB(color));\r\n                } else {\r\n                    virtualHSV.h = color.h;\r\n                }\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && hPointerId === event.pointerId) {\r\n\r\n                const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                virtualHSV.h += event.dX / params.width * 359.99 * factor;\r\n\r\n                if (event.button === 'right') {\r\n                    virtualHSV.h = virtualHSV.h % 359.99;\r\n                    if (virtualHSV.h < 0) {\r\n                        virtualHSV.h += 359.99;\r\n                    }\r\n                }\r\n                virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                color = new BB.HSV(virtualHSV.h, color.s, color.v);\r\n                updateSV();\r\n                updateHPointer();\r\n                params.callback(BB.ColorConverter.toRGB(color));\r\n\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                hPointerId = null;\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    const cleardiv = document.createElement('div');\r\n    cleardiv.style.clear = 'both';\r\n    div.appendChild(cleardiv);\r\n\r\n    // --- interface ---\r\n    this.setColor = function (c) {\r\n        color = BB.ColorConverter.toHSV(new BB.RGB(c.r, c.g, c.b));\r\n        updateSV();\r\n        updateSVPointer();\r\n        updateHPointer();\r\n    };\r\n    this.getColor = function () {\r\n        return BB.ColorConverter.toRGB(color);\r\n    };\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.destroy = function() {\r\n        svPointerListener.destroy();\r\n        hPointerListener.destroy();\r\n    };\r\n    this.end = function() {\r\n        svPointerId = null;\r\n        hPointerId = null;\r\n    };\r\n\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n\r\n/**\r\n * a slider that looks like this\r\n * ------O----\r\n *\r\n * param: {init, width, pointSize, callback(value, isFirst, isLast)}\r\n *\r\n * @param param\r\n * @constructor\r\n */\r\nexport const PointSlider = function(param) {\r\n\r\n    const div = document.createElement('div');\r\n    div.style.position = 'relative';\r\n    const sliderLine = BB.el({});\r\n    const sliderPoint = BB.el({\r\n        css: {\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.appendChild(sliderLine);\r\n    div.appendChild(sliderPoint);\r\n    let sliderPos;\r\n    let isDragging = false;\r\n\r\n    //sliderLine\r\n    {\r\n        BB.css(sliderLine, {\r\n            marginTop: parseInt('' + (param.pointSize / 2 - 1)) + 'px',\r\n            height: '2px',\r\n            background: '#aaa',\r\n            width: param.width + 'px'\r\n        });\r\n    }\r\n    //sliderPoint\r\n    const touchAreaEl = BB.el({ // expand clickable area\r\n        parent: sliderPoint,\r\n        css: {\r\n            // background: 'rgba(255,0,0,0.4)',\r\n            margin: '-7px 0 0 -7px',\r\n            width: 'calc(100% + 14px)',\r\n            height: 'calc(100% + 7px)',\r\n        }\r\n    });\r\n\r\n    function redrawPoint() {\r\n        sliderPoint.style.left = sliderPos + 'px';\r\n        if (isDragging) {\r\n            sliderPoint.style.boxShadow = '0 0 6px rgba(0,0,0,1)';\r\n        } else {\r\n            sliderPoint.style.boxShadow = '0 0 3px rgba(0,0,0,0.8)';\r\n        }\r\n    }\r\n    function getValue() {\r\n        return sliderPos /  (param.width - param.pointSize);\r\n    }\r\n\r\n    let pointerListener;\r\n    {\r\n        let isFirst;\r\n        sliderPos = BB.clamp(param.init * (param.width - param.pointSize), 0, param.width - param.pointSize);\r\n        BB.css(sliderPoint, {\r\n            position: 'absolute',\r\n            top: '0px',\r\n            backgroundColor: '#eaeaea',\r\n            boxShadow: '0 0 3px rgba(0,0,0,0.8)',\r\n            width: param.pointSize + 'px',\r\n            height: param.pointSize + 'px',\r\n            borderRadius: param.pointSize + 'px',\r\n            cursor: 'ew-resize',\r\n            transition: 'box-shadow 0.2s ease-in-out'\r\n        });\r\n        redrawPoint();\r\n        let imaginaryPos;\r\n        pointerListener = new BB.PointerListener({\r\n            target: sliderPoint,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    isFirst = true;\r\n                    isDragging = true;\r\n                    imaginaryPos = sliderPos;\r\n                    redrawPoint();\r\n                    event.eventStopPropagation();\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                    event.eventStopPropagation();\r\n                    imaginaryPos = imaginaryPos + event.dX;\r\n                    sliderPos = parseInt('' + BB.clamp(imaginaryPos, 0, param.width - param.pointSize));\r\n                    redrawPoint();\r\n                    param.callback(getValue(), isFirst, false);\r\n                    isFirst = false;\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    event.eventStopPropagation();\r\n                    isDragging = false;\r\n                    redrawPoint();\r\n                    param.callback(getValue(), false, true);\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    // --- interface ---\r\n    this.getEl = function() {\r\n        return div;\r\n    };\r\n    this.setActive = function(isActive) {\r\n        if (isActive) {\r\n            sliderPoint.style.backgroundColor = '#fff';\r\n        } else {\r\n            sliderPoint.style.backgroundColor = '#eaeaea';\r\n        }\r\n    };\r\n    this.destroy = function() {\r\n        pointerListener.destroy();\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * UI to pick between colors in colorArr. can display full transparent (checkerboard).\r\n * Can't deal with 0.5 alpha.\r\n * Rectangular buttons.\r\n *\r\n * p = {\r\n *     colorArr: rgba[], // duplicates are removed\r\n *     onChange: func(rgbaObj),\r\n *     label: string,\r\n *     initialIndex: int// optional, index before duplicates were removed\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const ColorOptions = function(p) {\r\n    const div = BB.el({\r\n        content: p.label ? p.label : '',\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n\r\n    let selectedIndex = 0;\r\n    const colorArr = [];\r\n    const buttonArr = [];\r\n    const buttonSize = 22;\r\n    const checkerUrl = BB.createCheckerDataUrl(5);\r\n\r\n    // build colorArr while removing duplicates\r\n    for (let i = 0; i < p.colorArr.length; i++) {\r\n        const item = p.colorArr[i];\r\n        let found = false;\r\n        for (let e = 0; e < colorArr.length; e++) {\r\n            const sItem = colorArr[e];\r\n            if (sItem === null || item === null) {\r\n                continue;\r\n            }\r\n            if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\r\n                found = true;\r\n                break;\r\n            }\r\n        }\r\n        if (found) {\r\n            continue;\r\n        }\r\n        colorArr.push(item);\r\n        if ('initialIndex' in p && p.initialIndex === i) {\r\n            selectedIndex = colorArr.length - 1;\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < colorArr.length; i++) {\r\n        (function(i) {\r\n\r\n            const colorButton = BB.el({\r\n                content: colorArr[i] ? '' : 'X',\r\n                css: {\r\n                    width: buttonSize + 'px',\r\n                    height: buttonSize + 'px',\r\n                    backgroundColor: colorArr[i] ? BB.ColorConverter.toRgbaStr(colorArr[i]) : 'transparent',\r\n                    marginLeft: '7px',\r\n                    boxShadow: '0 0 0 1px #aaa',\r\n                    cursor: 'pointer',\r\n                    userSelect: 'none',\r\n                    textAlign: 'center',\r\n                    lineHeight: (buttonSize + 1) + 'px',\r\n                    color: '#aaa'\r\n                }\r\n            });\r\n            if (colorArr[i] && colorArr[i].a === 0) {\r\n                colorButton.style.backgroundImage = 'url(' + checkerUrl + ')';\r\n            }\r\n\r\n            colorButton.onclick = function(e) {\r\n                e.preventDefault();\r\n                selectedIndex = i;\r\n                update();\r\n                p.onChange(colorArr[i]);\r\n            };\r\n\r\n            (colorButton as any).setIsSelected = function(b) {\r\n                if (b) {\r\n                    BB.css(colorButton, {\r\n                        boxShadow: '0 0 0 2px var(--active-highlight-color), 0 0 5px 0 var(--active-highlight-color)',\r\n                        pointerEvents: 'none'\r\n                    });\r\n                } else {\r\n                    BB.css(colorButton, {\r\n                        boxShadow: '0 0 0 1px #aaa',\r\n                        pointerEvents: ''\r\n                    });\r\n                }\r\n            };\r\n\r\n\r\n            div.appendChild(colorButton);\r\n            buttonArr.push(colorButton);\r\n        })(i);\r\n    }\r\n\r\n\r\n    function update() {\r\n        for (let i = 0; i < buttonArr.length; i++) {\r\n            buttonArr[i].setIsSelected(i === selectedIndex);\r\n        }\r\n    }\r\n    update();\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.destroy = () => {\r\n        buttonArr.forEach(item => {\r\n            item.onclick = null;\r\n        });\r\n        buttonArr.splice(0, buttonArr.length);\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * selectable options\r\n * p = {\r\n *     optionArr: {\r\n *          id: string,\r\n *          label: string | HTMLElement\r\n *     }[],\r\n *     initialId?: string,\r\n *     onChange: function(id string): void,\r\n *     changeOnInit?: boolean, // trigger change on creation\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const Options = function(p) {\r\n    const div = BB.el({});\r\n\r\n    const wrapperEl = BB.el({\r\n        parent: div,\r\n        className: 'kl-option-wrapper',\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n\r\n    const optionArr: {\r\n        id: string;\r\n        el: HTMLElement;\r\n    }[] = [];\r\n    let selectedId = 'initialId' in p ? p.initialId : p.optionArr[0].id;\r\n\r\n    function createOption(o) {\r\n        const optionObj = {\r\n            id: o.id,\r\n            el: null,\r\n        };\r\n\r\n        const classArr = ['kl-option'];\r\n        if (p.isSmall) {\r\n            classArr.push('kl-option--small');\r\n        }\r\n        if (typeof o.label !== 'string') {\r\n            classArr.push('kl-option--custom-el');\r\n            BB.css(o.label, {\r\n                display: 'block',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n\r\n        optionObj.el = BB.el({\r\n            parent: wrapperEl,\r\n            content: o.label,\r\n            className: classArr.join(' '),\r\n            onClick: function() {\r\n                if (selectedId !== optionObj.id) {\r\n                    selectedId = optionObj.id;\r\n                    update();\r\n                    p.onChange(selectedId);\r\n                }\r\n            }\r\n        });\r\n\r\n        if (o.title) {\r\n            optionObj.el.title = o.title;\r\n        }\r\n\r\n        optionArr.push(optionObj);\r\n    }\r\n\r\n    function update() {\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            optionArr[i].el.classList.toggle('kl-option-selected', optionArr[i].id === selectedId);\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < p.optionArr.length; i++) {\r\n        createOption(p.optionArr[i]);\r\n    }\r\n\r\n    update();\r\n\r\n    if (p.changeOnInit) {\r\n        setTimeout(function() {\r\n            p.onChange(selectedId);\r\n        }, 0);\r\n    }\r\n\r\n    function getIndex() {\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            if (optionArr[i].id === selectedId) {\r\n                return i;\r\n            }\r\n        }\r\n    }\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.getValue = function() {\r\n        return selectedId;\r\n    }\r\n    this.next = function() {\r\n        selectedId = optionArr[(getIndex() + 1) % optionArr.length].id;\r\n        update();\r\n        p.onChange(selectedId);\r\n    };\r\n    this.previous = function() {\r\n        selectedId = optionArr[(optionArr.length + getIndex() - 1) % optionArr.length].id;\r\n        update();\r\n        p.onChange(selectedId);\r\n    };\r\n    this.destroy = () => {\r\n        optionArr.forEach(item => {\r\n            BB.destroyEl(item.el);\r\n        });\r\n        optionArr.splice(0, optionArr.length);\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport angleSvg from 'url:~/src/app/img/ui/angle.svg';\r\n\r\n\r\ntype TUiState = 'left' | 'right';\r\n\r\n/**\r\n * display little messages at the top of KlWorkspace\r\n */\r\nexport class StatusOverlay {\r\n\r\n    private el: HTMLDivElement;\r\n    private innerEl: HTMLDivElement;\r\n    private angleIm: HTMLImageElement;\r\n    private innerInnerEl: HTMLDivElement;\r\n    private isWide: boolean;\r\n    private uiState: TUiState;\r\n\r\n    private timeout: number;\r\n    private timeout2: number;\r\n    private timeout3: number;\r\n\r\n    private updateUiState() {\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n        setTimeout(()=>{}, 100);\r\n        if (this.uiState === 'left') {\r\n            this.el.style.left = '271px';\r\n        } else {\r\n            this.el.style.removeProperty('left');\r\n        }\r\n    }\r\n\r\n    private init() {\r\n        this.el = BB.el({\r\n            className: \"top-overlay g-root\",\r\n            onClick: BB.handleClick,\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n        }\r\n\r\n        this.updateUiState();\r\n\r\n        this.innerEl = BB.el({\r\n            className: 'top-overlay-inner',\r\n        }) as HTMLDivElement\r\n\r\n\r\n        this.angleIm = new Image();\r\n        this.angleIm.src = angleSvg;\r\n        BB.css(this.angleIm, {\r\n            verticalAlign: 'bottom',\r\n            width: '20px',\r\n            height: '20px',\r\n            marginLeft: '5px',\r\n            borderRadius: '10px'\r\n        });\r\n\r\n        this.innerInnerEl = document.createElement('div');\r\n        this.innerInnerEl.style.display = 'inline-block';\r\n\r\n        this.innerEl.appendChild(this.innerInnerEl);\r\n        this.innerEl.appendChild(this.angleIm);\r\n        this.el.appendChild(this.innerEl);\r\n        document.body.appendChild(this.el);\r\n        this.el.style.display = \"none\";\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        this.init();\r\n    }\r\n\r\n    setWide(b: boolean) {\r\n        this.isWide = !!b;\r\n\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n            this.el.style.left = '';\r\n        } else {\r\n            this.el.style.removeProperty('width');\r\n            this.el.style.left = this.uiState === 'left' ? '271px' : '';\r\n        }\r\n    }\r\n\r\n    setUiState(state: TUiState) {\r\n        this.uiState = state;\r\n        this.updateUiState();\r\n    }\r\n\r\n    out(msg: string | {type: 'transform', angleDeg: number, scale: number}, doPulse?: boolean) {\r\n\r\n        if (msg && typeof msg === 'object') {\r\n\r\n            if (msg.type === 'transform') {\r\n                this.angleIm.style.display = 'inline-block';\r\n                this.angleIm.style.transform = 'rotate(' + msg.angleDeg + 'deg)';\r\n\r\n                if (msg.angleDeg % 90 === 0) {\r\n                    this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255, 255, 255, 0.7)';\r\n                } else {\r\n                    this.angleIm.style.boxShadow = '';\r\n                }\r\n\r\n                this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + \"%\";\r\n\r\n\r\n            } else {\r\n                this.angleIm.style.display = 'none';\r\n            }\r\n\r\n\r\n\r\n        } else if (typeof msg === 'string') {\r\n            this.angleIm.style.display = 'none';\r\n            this.innerInnerEl.innerHTML = msg;\r\n        }\r\n\r\n        if (doPulse) {\r\n            this.innerEl.style.animation = '';\r\n            setTimeout(\r\n                () => this.innerEl.style.animation = 'top-overlay-pulse 0.5s ease-out',\r\n                20\r\n            );\r\n            if (this.timeout3) {\r\n                clearTimeout(this.timeout3);\r\n            }\r\n            this.timeout3 = window.setTimeout(\r\n                () => this.innerEl.style.animation = '',\r\n                520\r\n            );\r\n        }\r\n\r\n\r\n\r\n        if (this.timeout) {\r\n            clearTimeout(this.timeout);\r\n        }\r\n        if (this.timeout2) {\r\n            clearTimeout(this.timeout2);\r\n        }\r\n        this.el.style.animationName = doPulse ? 'consoleInFast' : \"consoleIn\";\r\n        this.el.style.opacity = \"1\";\r\n        this.timeout = window.setTimeout(() => {\r\n            this.el.style.opacity = \"0\";\r\n            this.el.style.animationName = \"consoleOut\";\r\n            this.timeout2 = window.setTimeout(() => {\r\n                this.el.style.display = \"none\";\r\n                this.timeout2 = 0;\r\n            }, 450);\r\n            this.timeout = 0;\r\n        }, 1200);\r\n        this.el.style.display = \"flex\";\r\n    }\r\n\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iQ1f0\");","import {BB} from '../../../bb/bb';\r\nimport {popup} from './popup';\r\n\r\nexport function exportDialog(parent, image) {\r\n    let boxSize, aboutCloseFunc, aboutDiv, closed, aniToggle, imageContainer, coverImage, coverSize,\r\n        text, holding, aniTimeout, halfBoxSize;\r\n    boxSize = 22 * 2;\r\n    halfBoxSize = 22;\r\n    aboutCloseFunc = function () {\r\n    };\r\n    closed = false;\r\n    aniToggle = false;\r\n    aboutDiv = document.createElement(\"div\");\r\n    BB.css(aboutDiv, {\r\n        width: (7 * boxSize) + \"px\"\r\n    });\r\n\r\n    imageContainer = document.createElement(\"div\");\r\n    coverImage = new Image();\r\n    coverImage.src = image.src;\r\n\r\n    imageContainer.appendChild(coverImage);\r\n    imageContainer.appendChild(image);\r\n\r\n    BB.css(imageContainer, {\r\n        width: (6 * boxSize) + \"px\",\r\n        height: (4 * boxSize) + \"px\",\r\n        marginTop: (boxSize / 2 - 1) + \"px\",\r\n        marginLeft: (boxSize / 2 - 1) + \"px\",\r\n        position: \"relative\",\r\n        overflow: \"hidden\",\r\n        boxShadow: \"0 0 10px 4px rgba(255,255,255, 0)\",\r\n        border: \"1px solid rgba(255, 255, 255, 1)\",\r\n        transition: \"box-shadow 0.7s linear\"\r\n    });\r\n    BB.css(image, {\r\n        position: \"absolute\",\r\n        left: '0',\r\n        top: '0',\r\n        width: (6 * boxSize) + \"px\",\r\n        height: (4 * boxSize) + \"px\",\r\n        opacity: '0'\r\n    });\r\n    coverSize = {\r\n        width: (6 * boxSize),\r\n        height: (6 * boxSize / image.width) * image.height\r\n    };\r\n    if (coverSize.height < (4 * boxSize)) {\r\n        coverSize.height = (4 * boxSize);\r\n        coverSize.width = (coverSize.height / image.height) * image.width;\r\n    }\r\n    BB.css(coverImage, {\r\n        position: \"absolute\",\r\n        top: (2 * boxSize) + \"px\",\r\n        left: (3 * boxSize) + \"px\",\r\n        width: coverSize.width + \"px\",\r\n        height: coverSize.height + \"px\",\r\n        marginLeft: (-coverSize.width / 2) + \"px\",\r\n        marginTop: (-coverSize.height / 2) + \"px\"\r\n    });\r\n\r\n    function animation() {\r\n        if (closed) {\r\n            return;\r\n        }\r\n        aniToggle = !aniToggle;\r\n        if (aniToggle) {\r\n            BB.css(imageContainer, {\r\n                border: \"1px solid rgba(0, 0, 0, 1)\"\r\n            });\r\n        } else {\r\n            BB.css(imageContainer, {\r\n                border: \"1px solid rgba(200, 200, 200, 1)\"\r\n            });\r\n        }\r\n        setTimeout(animation, 510);\r\n    }\r\n\r\n    animation();\r\n\r\n    text = document.createElement(\"div\");\r\n    text.innerHTML = \"Right-Click or Press-Hold on the image, then save.\";\r\n    text.ontouchstart = function () {\r\n        return false;\r\n    };\r\n    BB.css(text, {\r\n        fontSize: (boxSize / 2.5) + \"px\",\r\n        color: \"#666\",\r\n        padding: \"10px\",\r\n        textAlign: \"center\"\r\n    });\r\n\r\n    aboutDiv.appendChild(imageContainer);\r\n    aboutDiv.appendChild(text);\r\n\r\n    holding = false;\r\n    image.ontouchstart = function () {\r\n        BB.css(imageContainer, {\r\n            boxShadow: \"0 0 10px 8px rgba(0,255,255, 1)\"\r\n        });\r\n        holding = true;\r\n        aniTimeout = setTimeout(function () {\r\n            holding = false;\r\n            BB.css(imageContainer, {\r\n                boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\r\n            });\r\n        }, 1500);\r\n    };\r\n    image.ontouchmove = function () {\r\n        BB.css(imageContainer, {\r\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\r\n        });\r\n        holding = false;\r\n        clearTimeout(aniTimeout);\r\n    };\r\n    image.ontouchend = function () {\r\n        BB.css(imageContainer, {\r\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\r\n        });\r\n        holding = false;\r\n        clearTimeout(aniTimeout);\r\n    };\r\n\r\n    popup({\r\n        target: parent,\r\n        message: \"<b>Save Image</b>\",\r\n        div: aboutDiv,\r\n        buttons: [\"Close\"],\r\n        callback: function (result) {\r\n            closed = true;\r\n        }\r\n    });\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * element that lets you crop an image and copy it via right click\r\n *\r\n * param = {\r\n *     width: number,\r\n *     height: number,\r\n *     canvas: image | canvas,\r\n *     isNotCopy: boolean,\r\n *     onChange: function(width, height)\r\n * }\r\n *\r\n * @param param object\r\n * @constructor\r\n */\r\nexport function CropCopy(param) {\r\n    const div = document.createElement('div');\r\n    BB.css(div, {\r\n        position: 'relative',\r\n        height: param.height + 'px',\r\n        width: param.width + 'px',\r\n        overflow: 'hidden',\r\n        colorScheme: 'only light',\r\n    });\r\n    div.style.position = 'relative';\r\n\r\n    let crop;\r\n    function resetCrop() {\r\n        crop = {\r\n            x: 0,\r\n            y: 0,\r\n            width: param.canvas.width,\r\n            height: param.canvas.height\r\n        };\r\n    }\r\n    resetCrop();\r\n\r\n\r\n    function updateCroppedCanvas() {\r\n        croppedCanvas.width = Math.round(crop.width);\r\n        croppedCanvas.height = Math.round(crop.height);\r\n        let ctx = croppedCanvas.getContext('2d');\r\n        ctx.drawImage(param.canvas, Math.round(-crop.x), Math.round(-crop.y));\r\n        if (croppedImage) {\r\n            croppedImage.src = croppedCanvas.toDataURL('image/png');\r\n        }\r\n\r\n        if (param.onChange) {\r\n            param.onChange(croppedCanvas.width, croppedCanvas.height);\r\n        }\r\n    }\r\n    function updateSelectionRect() {\r\n        BB.css(selectionRect, {\r\n            left: (thumbX + crop.x * scaleW) + 'px',\r\n            top: (thumbY + crop.y * scaleH) + 'px',\r\n            width: (crop.width * scaleW) + 'px',\r\n            height: (crop.height * scaleH) + 'px'\r\n        });\r\n        if (param.onChange) {\r\n            param.onChange(Math.round(crop.width), Math.round(crop.height));\r\n        }\r\n    }\r\n    function isInsideSelectionRect(p) {\r\n        let rect = {\r\n            x: Math.round(thumbX + crop.x * scaleW),\r\n            y: Math.round(thumbY + crop.y * scaleH),\r\n            width: Math.round(crop.width * scaleW),\r\n            height: Math.round(crop.height * scaleH)\r\n        };\r\n        return rect.x <= p.x && p.x <= rect.x + rect.width &&\r\n            rect.y <= p.y && p.y <= rect.y + rect.height;\r\n    }\r\n\r\n    const croppedCanvas = BB.canvas();\r\n    let eventTarget = croppedCanvas;\r\n    let croppedImage = null;\r\n    if (!param.isNotCopy) { //navigator.appName === 'Microsoft Internet Explorer') { //i would prefer not using an image\r\n        croppedImage = new Image();\r\n        eventTarget = croppedImage;\r\n    }\r\n    BB.css(eventTarget, {\r\n        height: param.height + 'px',\r\n        width: param.width + 'px'\r\n    });\r\n    div.appendChild(eventTarget);\r\n    updateCroppedCanvas();\r\n\r\n    const padding = 20;\r\n    const previewWrapper = BB.el({\r\n        css: {\r\n            width: param.width + 'px',\r\n            height: param.height + 'px',\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            pointerEvents: 'none'\r\n        }\r\n    });\r\n    div.appendChild(previewWrapper);\r\n    BB.createCheckerDataUrl(4, function(v) {\r\n        previewWrapper.style.backgroundImage = 'url('+v+')';\r\n    });\r\n\r\n    const thumbSize = BB.fitInto(param.canvas.width, param.canvas.height, param.width - padding * 2, param.height - padding * 2, 1);\r\n    const thumbCanvas = BB.canvas(Math.round(thumbSize.width), Math.round(thumbSize.height));\r\n    thumbCanvas.style.imageRendering = 'pixelated';\r\n    const scaleW = thumbCanvas.width / param.canvas.width;\r\n    const scaleH = thumbCanvas.height / param.canvas.height;\r\n    const thumbCtx = thumbCanvas.getContext('2d');\r\n    thumbCtx.imageSmoothingEnabled = false;\r\n    thumbCtx.drawImage(param.canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);\r\n    previewWrapper.appendChild(thumbCanvas);\r\n    const thumbX = parseInt('' + ((param.width - thumbCanvas.width) / 2));\r\n    const thumbY = parseInt('' + ((param.height - thumbCanvas.height) / 2));\r\n    BB.css(thumbCanvas, {\r\n        position: 'absolute',\r\n        left: thumbX + \"px\",\r\n        top: thumbY + \"px\"\r\n    });\r\n\r\n    const selectionRect = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            boxShadow: '0 0 0 1px #fff, 0 0 0 2px #000, 0 0 40px 1px #000',\r\n        }\r\n    });\r\n    previewWrapper.appendChild(selectionRect);\r\n    updateSelectionRect();\r\n\r\n\r\n    function toOriginalSpace(p) {\r\n        return {\r\n            x: BB.clamp((p.x - thumbX) / scaleW, 0, param.canvas.width),\r\n            y: BB.clamp((p.y - thumbY) / scaleH, 0, param.canvas.height),\r\n        };\r\n    }\r\n    //gen crop from thumb-space points\r\n    function genCrop(p1, p2) {\r\n        let topLeftP = {\r\n            x: Math.min(p1.x, p2.x),\r\n            y: Math.min(p1.y, p2.y)\r\n        };\r\n        let bottomRightP = {\r\n            x: Math.max(p1.x, p2.x),\r\n            y: Math.max(p1.y, p2.y)\r\n        };\r\n        let origTopLeftP = toOriginalSpace(topLeftP);\r\n        let origBottomRightP = toOriginalSpace(bottomRightP);\r\n        origTopLeftP.x = Math.floor(origTopLeftP.x);\r\n        origTopLeftP.y = Math.floor(origTopLeftP.y);\r\n        origBottomRightP.x = Math.ceil(origBottomRightP.x);\r\n        origBottomRightP.y = Math.ceil(origBottomRightP.y);\r\n        return {\r\n            x: origTopLeftP.x,\r\n            y: origTopLeftP.y,\r\n            width: origBottomRightP.x - origTopLeftP.x,\r\n            height: origBottomRightP.y - origTopLeftP.y\r\n        };\r\n    }\r\n\r\n    function isReset() {\r\n        return crop.x === 0 && crop.y === 0 && crop.width === param.canvas.width && crop.height === param.canvas.height;\r\n    }\r\n\r\n    let startP;\r\n    let startCrop = null;\r\n    let isDragging = false;\r\n    let didMove = false;\r\n    let updateCropTimeout;\r\n    const pointerListener = new BB.PointerListener({\r\n        target: eventTarget,\r\n        fixScribble: true,\r\n        onPointer: function(event) {\r\n            let fullPos;\r\n            if (event.type === 'pointerdown' && event.button === 'left') {\r\n                event.eventPreventDefault();\r\n                isDragging = true;\r\n                startP = {\r\n                    x: event.relX,\r\n                    y: event.relY\r\n                };\r\n                if (!isReset() && isInsideSelectionRect(startP)) {\r\n                    startCrop = {\r\n                        x: crop.x,\r\n                        y: crop.y,\r\n                        width: crop.width,\r\n                        height: crop.height\r\n                    };\r\n                } else {\r\n                    crop = genCrop(startP, startP);\r\n                }\r\n            } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                event.eventPreventDefault();\r\n                didMove = true;\r\n                if (startCrop) {\r\n                    crop.x = startCrop.x + Math.round((event.relX - startP.x) / scaleW);\r\n                    crop.y = startCrop.y + Math.round((event.relY - startP.y) / scaleH);\r\n                    crop.x = BB.clamp(crop.x, 0, param.canvas.width - crop.width);\r\n                    crop.y = BB.clamp(crop.y, 0, param.canvas.height - crop.height);\r\n                } else {\r\n                    crop = genCrop(startP, {x: event.relX, y: event.relY});\r\n                }\r\n                updateSelectionRect();\r\n            } else if (event.type === 'pointerup' && startP) {\r\n                event.eventPreventDefault();\r\n                isDragging = false;\r\n                startCrop = null;\r\n                startP = null;\r\n                if (crop.width === 0 || crop.height === 0 || !didMove) {\r\n                    resetCrop();\r\n                    updateSelectionRect();\r\n                }\r\n                didMove = false;\r\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e, comboStr) {\r\n            if (isDragging) {\r\n                return;\r\n            }\r\n            let doUpdate = false;\r\n\r\n            let stepSize = Math.max(1, 1 / scaleW);\r\n            let shiftIsPressed = keyListener.isPressed('shift');\r\n\r\n            if (keyStr === 'left') {\r\n                if (shiftIsPressed) {\r\n                    crop.width = BB.clamp(crop.width - stepSize, 1, param.canvas.width - crop.x);\r\n                } else {\r\n                    crop.x = BB.clamp(crop.x - stepSize, 0, param.canvas.width - crop.width);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n            if (keyStr === 'right') {\r\n                if (shiftIsPressed) {\r\n                    crop.width = BB.clamp(crop.width + stepSize, 1, param.canvas.width - crop.x);\r\n                } else {\r\n                    crop.x = BB.clamp(crop.x + stepSize, 0, param.canvas.width - crop.width);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n            if (keyStr === 'up') {\r\n                if (shiftIsPressed) {\r\n                    crop.height = BB.clamp(crop.height - stepSize, 1, param.canvas.height - crop.y);\r\n                } else {\r\n                    crop.y = BB.clamp(crop.y - stepSize, 0, param.canvas.height - crop.height);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n            if (keyStr === 'down') {\r\n                if (shiftIsPressed) {\r\n                    crop.height = BB.clamp(crop.height + stepSize, 1, param.canvas.height - crop.y);\r\n                } else {\r\n                    crop.y = BB.clamp(crop.y + stepSize, 0, param.canvas.height - crop.height);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n\r\n            if (doUpdate) {\r\n                e.preventDefault();\r\n                updateSelectionRect();\r\n                clearTimeout(updateCropTimeout);\r\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 100);\r\n            }\r\n        }\r\n    });\r\n\r\n    this.getEl = function() {\r\n        return div;\r\n    };\r\n    this.reset = function() {\r\n        resetCrop();\r\n        updateCroppedCanvas();\r\n        updateSelectionRect();\r\n    };\r\n    this.destroy = function() {\r\n        eventTarget.style.removeProperty('width');\r\n        eventTarget.style.removeProperty('height');\r\n        keyListener.destroy();\r\n        pointerListener.destroy();\r\n    };\r\n    this.isReset = function() {\r\n        return isReset();\r\n    };\r\n    this.getRect = function() {\r\n        return JSON.parse(JSON.stringify(crop));\r\n    };\r\n    this.getCroppedImage = function() {\r\n        return croppedCanvas;\r\n    };\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {popup} from './popup';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/// <reference path=\"./types.d.ts\" />\r\n\r\n/**\r\n *\r\n * @param parent\r\n * @param fullCanvas\r\n * @param cropCallback\r\n * @param output - BB.Output\r\n * @param showCrop - boolean - show crop button\r\n */\r\nexport function clipboardDialog(parent, fullCanvas, cropCallback, output, showCrop) {\r\n\r\n    let clipboardItemIsSupported = false;\r\n    try {\r\n        clipboardItemIsSupported = !!ClipboardItem;\r\n    } catch (e) {}\r\n\r\n    const div = document.createElement(\"div\");\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n\r\n    let topWrapper = BB.el({\r\n        content: LANG('crop-drag-to-crop') + (clipboardItemIsSupported ? '' : '<br>' + LANG('cropcopy-click-hold')),\r\n        css: {\r\n            textAlign: 'center'\r\n        }\r\n    });\r\n    div.appendChild(topWrapper);\r\n\r\n\r\n    let cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 350,\r\n        canvas: fullCanvas,\r\n        clipboardItemIsSupported\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n        borderTop: '1px solid #bbb',\r\n        borderBottom: '1px solid #bbb'\r\n    });\r\n    div.appendChild(cropCopy.getEl());\r\n\r\n    function toClipboard() {\r\n        const imgURL = cropCopy.getCroppedImage().toDataURL('image/png');\r\n        setTimeout(async function() {\r\n            try {\r\n                const data = await fetch(imgURL);\r\n                const blob = await data.blob();\r\n                await (navigator.clipboard as any).write([\r\n                    new ClipboardItem({\r\n                        [blob.type]: blob\r\n                    } as any) // todo check is possible?\r\n                ]);\r\n                setTimeout(function() {\r\n                    output.out(LANG('cropcopy-copied'), true);\r\n                }, 200);\r\n            } catch (err) {\r\n                console.error(err.name, err.message);\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, KeyEvent, comboStr) {\r\n            if (comboStr === 'ctrl+c') {\r\n                toClipboard();\r\n                closefunc();\r\n            }\r\n        }\r\n    });\r\n\r\n    let closefunc;\r\n    function blur() {\r\n        closefunc();\r\n    }\r\n    BB.addEventListener(window, \"blur\", blur);\r\n\r\n    const buttonArr = [];\r\n    if (clipboardItemIsSupported) {\r\n        buttonArr.push(LANG('cropcopy-btn-copy'));\r\n    }\r\n    if (showCrop) {\r\n        buttonArr.push(LANG('cropcopy-btn-crop'));\r\n    }\r\n    buttonArr.push('Cancel');\r\n\r\n    popup({\r\n        target: parent,\r\n        message: '<b>' + (showCrop ? `${LANG('cropcopy-title-copy')} / ${LANG('cropcopy-title-crop')}` : `${LANG('cropcopy-title-copy')}`) + '</b>',\r\n        div: div,\r\n        style: isSmall ? {} : {\r\n            width: \"500px\"\r\n        },\r\n        buttons: buttonArr,\r\n        primaries: [LANG('cropcopy-btn-copy')],\r\n        callback: function (result) {\r\n            if (result === LANG('cropcopy-btn-copy')) {\r\n                toClipboard();\r\n            } else if (result === LANG('cropcopy-btn-crop')) {\r\n                let rectObj = cropCopy.getRect();\r\n                cropCallback({\r\n                    left: Math.round(-rectObj.x),\r\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\r\n                    top: Math.round(-rectObj.y),\r\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height)\r\n                });\r\n            }\r\n            BB.removeEventListener(window, \"blur\", blur);\r\n            cropCopy.destroy();\r\n            keyListener.destroy();\r\n        },\r\n        clickOnEnter: LANG('cropcopy-btn-copy'),\r\n        closefunc: function (func) {\r\n            closefunc = func;\r\n        }\r\n    });\r\n}","import {BB} from '../../../bb/bb';\r\nimport {popup} from '../modals/popup';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {Options} from '../base-components/options';\r\nimport {Select} from '../base-components/select';\r\nimport {PointSlider} from '../base-components/point-slider';\r\n// @ts-ignore\r\nimport addLayerImg from 'url:~/src/app/img/ui/add-layer.svg';\r\n// @ts-ignore\r\nimport duplicateLayerImg from 'url:~/src/app/img/ui/duplicate-layer.svg';\r\n// @ts-ignore\r\nimport mergeLayerImg from 'url:~/src/app/img/ui/merge-layers.svg';\r\n// @ts-ignore\r\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\r\n// @ts-ignore\r\nimport renameLayerImg from 'url:~/src/app/img/ui/rename-layer.svg';\r\nimport {KlCanvas, MAX_LAYERS} from '../../canvas/kl-canvas';\r\nimport {IMixMode} from '../../kl.types';\r\nimport {LANG} from '../../../language/language';\r\nimport {translateBlending} from '../../canvas/translate-blending';\r\n\r\n\r\nexport function klLayerManager(p_canvas: KlCanvas, p_func, p_rootDiv) {\r\n    let klCanvas: KlCanvas = p_canvas;\r\n    let layerElArr = [];\r\n    let layerHeight = 35;\r\n    let layerSpacing = 0;\r\n    let width = 250;\r\n    let oldHistoryState;\r\n    let updatefunc = p_func;\r\n    let uiState = 'right'; // 'left | 'right'\r\n\r\n\r\n    let largeThumbDiv = BB.el({\r\n        onClick: BB.handleClick,\r\n        css: {\r\n            position: \"absolute\",\r\n            right: \"280px\",\r\n            top: \"500px\",\r\n            background: \"#aaa\",\r\n            boxShadow: \"1px 1px 3px rgba(0,0,0,0.3)\",\r\n            pointerEvents: \"none\",\r\n            padding: '0',\r\n            border: \"1px solid #aaa\",\r\n            transition: \"opacity 0.3s ease-out\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    BB.createCheckerDataUrl(4, function(url) {\r\n        largeThumbDiv.style.backgroundImage = \"url(\" + url + \")\";\r\n    });\r\n    let largeThumbCanvas = BB.canvas(200, 200);\r\n    largeThumbCanvas.style.display = \"block\";\r\n    largeThumbDiv.appendChild(largeThumbCanvas);\r\n    let largeThumbTimeout, largeThumbInTimeout;\r\n    let largeThumbInDocument = false;\r\n\r\n\r\n    let klCanvasLayerArr = klCanvas.getLayers();\r\n    let selectedSpotIndex = klCanvasLayerArr.length - 1;\r\n    let div = document.createElement(\"div\");\r\n    div.style.marginRight = \"10px\";\r\n    div.style.marginBottom = \"10px\";\r\n    div.style.marginLeft = \"10px\";\r\n    div.style.marginTop = \"10px\";\r\n    div.style.cursor = \"default\";\r\n\r\n    let listdiv = document.createElement(\"div\");\r\n    BB.css(listdiv, {\r\n        width: width + \"px\",\r\n        position: \"relative\"\r\n\r\n    });\r\n\r\n\r\n    function renameLayer(layer) {\r\n        let div = document.createElement('div');\r\n\r\n        let label = BB.el({\r\n            content: LANG('layers-rename-name') + ':',\r\n            css: {\r\n                marginRight: '5px'\r\n            }\r\n        });\r\n\r\n        const row = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n        let input = document.createElement('input');\r\n        input.value = klCanvas.getLayer(layer).name;\r\n        input.setAttribute('data-ignore-focus', 'true');\r\n        const clearBtn = BB.el({\r\n            tagName: 'Button',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/>',\r\n            title: LANG('layers-rename-clear'),\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: () => {\r\n                input.value = '';\r\n                input.focus();\r\n            }\r\n        });\r\n        const suggestions = [\r\n            LANG('layers-rename-sketch'),\r\n            LANG('layers-rename-colors'),\r\n            LANG('layers-rename-lines'),\r\n            LANG('background'),\r\n            LANG('layers-rename-foreground'),\r\n        ];\r\n        const suggestionBtns = [];\r\n        const row2 = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginTop: '5px',\r\n                marginLeft: '-5px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        suggestions.forEach(item => {\r\n            const btn = BB.el({\r\n                parent: row2,\r\n                tagName: 'Button',\r\n                content: item,\r\n                onClick: () => {\r\n                    input.value = btn.textContent;\r\n                },\r\n                css: {\r\n                    margin: '5px 0 0 5px',\r\n                }\r\n            });\r\n            suggestionBtns.push(btn);\r\n        });\r\n\r\n        div.appendChild(label);\r\n        label.append(row, row2);\r\n        row.append(input, clearBtn);\r\n\r\n        setTimeout(function() {\r\n            input.focus();\r\n            input.select();\r\n        }, 10);\r\n\r\n        popup({\r\n            target: p_rootDiv,\r\n            message: `<b>${LANG('layers-rename-title')}</b>`,\r\n            div: div,\r\n            buttons: [LANG('layers-rename'), 'Cancel'],\r\n            primaries: [LANG('layers-rename')],\r\n            callback: function (val) {\r\n                BB.destroyEl(clearBtn);\r\n                suggestionBtns.forEach(item => {\r\n                    BB.destroyEl(item);\r\n                });\r\n                suggestionBtns.splice(0, suggestionBtns.length);\r\n                if (val === LANG('layers-rename')) {\r\n                    if (input.value === klCanvas.getLayer(layer).name) {\r\n                        return;\r\n                    }\r\n                    klCanvas.renameLayer(layer, input.value);\r\n                    createLayerList();\r\n                    klHistory.pause(true);\r\n                    updatefunc(layer);\r\n                    klHistory.pause(false);\r\n                }\r\n            },\r\n            clickOnEnter: LANG('layers-rename')\r\n        });\r\n    }\r\n\r\n\r\n    let layerListEl = BB.el({});\r\n\r\n    (div as any).disableButtons = function(){}; //probably remove\r\n    (div as any).enableButtons = function(){}; //probably remove\r\n    let addnewBtn = document.createElement(\"button\");\r\n    let duplicateBtn = document.createElement(\"button\");\r\n    let mergeBtn = document.createElement(\"button\");\r\n    let removeBtn = document.createElement(\"button\");\r\n    let renameBtn = document.createElement(\"button\");\r\n\r\n    function createButtons() {\r\n        let div = document.createElement(\"div\");\r\n        function async() {\r\n            BB.makeUnfocusable(addnewBtn);\r\n            BB.makeUnfocusable(duplicateBtn);\r\n            BB.makeUnfocusable(mergeBtn);\r\n            BB.makeUnfocusable(removeBtn);\r\n            BB.makeUnfocusable(renameBtn);\r\n\r\n            addnewBtn.style.cssFloat = 'left';\r\n            duplicateBtn.style.cssFloat = 'left';\r\n            mergeBtn.style.cssFloat = 'left';\r\n            removeBtn.style.cssFloat = 'left';\r\n            renameBtn.style.cssFloat = 'left';\r\n\r\n            addnewBtn.title = LANG('layers-new');\r\n            duplicateBtn.title = LANG('layers-duplicate');\r\n            removeBtn.title = LANG('layers-remove');\r\n            mergeBtn.title = LANG('layers-merge');\r\n            renameBtn.title = LANG('layers-rename-title');\r\n\r\n            addnewBtn.style.paddingLeft = \"5px\";\r\n            addnewBtn.style.paddingRight = \"3px\";\r\n\r\n            removeBtn.style.paddingLeft = \"5px\";\r\n            removeBtn.style.paddingRight = \"3px\";\r\n\r\n            duplicateBtn.style.paddingLeft = \"5px\";\r\n            duplicateBtn.style.paddingRight = \"3px\";\r\n\r\n            mergeBtn.style.paddingLeft = \"5px\";\r\n            mergeBtn.style.paddingRight = \"3px\";\r\n\r\n            renameBtn.style.height = \"30px\";\r\n            renameBtn.style.lineHeight = \"20px\";\r\n\r\n            addnewBtn.innerHTML = \"<img src='\" + addLayerImg + \"' height='20'/>\";\r\n            duplicateBtn.innerHTML = \"<img src='\" + duplicateLayerImg + \"' height='20'/>\";\r\n            mergeBtn.innerHTML = \"<img src='\" + mergeLayerImg + \"' height='20'/>\";\r\n            removeBtn.innerHTML = \"<img src='\" + removeLayerImg + \"' height='20'/>\";\r\n            renameBtn.innerHTML = \"<img src='\" + renameLayerImg + \"' height='20'/>\";\r\n            addnewBtn.style.marginRight = \"5px\";\r\n            removeBtn.style.marginRight = \"5px\";\r\n            duplicateBtn.style.marginRight = \"5px\";\r\n            mergeBtn.style.marginRight = \"5px\";\r\n            div.appendChild(addnewBtn);\r\n            div.appendChild(removeBtn);\r\n            div.appendChild(duplicateBtn);\r\n            div.appendChild(mergeBtn);\r\n            div.appendChild(renameBtn);\r\n            div.appendChild(BB.el({\r\n                css: {\r\n                    clear: 'both'\r\n                }\r\n            }));\r\n\r\n            let clearboth = document.createElement(\"div\");\r\n            clearboth.style.clear = \"both\";\r\n            clearboth.style.height = \"10px\";\r\n            div.appendChild(clearboth);\r\n\r\n\r\n            addnewBtn.onclick = function () {\r\n                if (klCanvas.addLayer(selectedSpotIndex) === false) {\r\n                    return;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n\r\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n                    addnewBtn.disabled = true;\r\n                    duplicateBtn.disabled = true;\r\n                }\r\n                removeBtn.disabled = false;\r\n                selectedSpotIndex = selectedSpotIndex + 1;\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n            };\r\n            duplicateBtn.onclick = function () {\r\n                if (klCanvas.duplicateLayer(selectedSpotIndex) === false) {\r\n                    return;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n                    addnewBtn.disabled = true;\r\n                    duplicateBtn.disabled = true;\r\n                }\r\n                removeBtn.disabled = false;\r\n                selectedSpotIndex++;\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n            };\r\n            removeBtn.onclick = function () {\r\n                if (layerElArr.length <= 1) {\r\n                    return;\r\n                }\r\n\r\n                klCanvas.removeLayer(selectedSpotIndex);\r\n                if (selectedSpotIndex > 0) {\r\n                    selectedSpotIndex--;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n                if (klCanvasLayerArr.length === 1) {\r\n                    removeBtn.disabled = true;\r\n                }\r\n                if (klCanvasLayerArr.length < MAX_LAYERS) {\r\n                    addnewBtn.disabled = false;\r\n                    duplicateBtn.disabled = false;\r\n                }\r\n            };\r\n            mergeBtn.onclick = function () {\r\n                if (selectedSpotIndex <= 0) {\r\n                    return;\r\n                }\r\n\r\n                function mergeDialog(p) {\r\n                    let div = document.createElement(\"div\");\r\n                    div.innerHTML = LANG('layers-merge-description');\r\n\r\n                    let options = new Options({\r\n                        optionArr: [\r\n                            {id: p.mixModeStr, label: translateBlending(p.mixModeStr)},\r\n                            {id: 'source-in', label: 'source-in'},\r\n                            {id: 'source-out', label: 'source-out'},\r\n                            {id: 'source-atop', label: 'source-atop'},\r\n                            {id: 'destination-in', label: 'destination-in'},\r\n                            {id: 'destination-out', label: 'destination-out'},\r\n                            {id: 'destination-atop', label: 'destination-atop'},\r\n                            {id: 'xor', label: 'xor'}\r\n                        ],\r\n                        initId: p.mixModeStr,\r\n                        onChange: function(id) {\r\n                            update();\r\n                        },\r\n                        isSmall: true\r\n                    });\r\n                    options.getElement().style.marginTop = '5px';\r\n                    div.appendChild(options.getElement());\r\n\r\n                    const thumbDimensions = BB.fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\r\n                    let preview = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n                    preview.title = LANG('preview');\r\n                    let spacer = document.createElement(\"div\");\r\n                    spacer.innerHTML = \"<br/>\";\r\n                    spacer.style.clear = \"both\";\r\n                    div.appendChild(spacer);\r\n                    div.appendChild(preview);\r\n                    BB.css(preview, {\r\n                        display: \"block\",\r\n                        marginLeft: \"auto\",\r\n                        marginRight: \"auto\",\r\n                        colorScheme: 'only light',\r\n                    });\r\n                    preview.style.boxShadow = \"0 0 3px rgba(0,0,0,0.5)\";\r\n                    BB.createCheckerDataUrl(4, function(url) {\r\n                        preview.style.backgroundImage = \"url(\" + url + \")\";\r\n                    });\r\n\r\n                    let alphaCanvas = BB.copyCanvas(preview);\r\n                    alphaCanvas.getContext(\"2d\").drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\r\n                    BB.convertToAlphaChannelCanvas(alphaCanvas);\r\n\r\n                    function update() {\r\n                        let ctx = preview.getContext(\"2d\");\r\n                        ctx.save();\r\n                        ctx.clearRect(0, 0, preview.width, preview.height);\r\n                        if (preview.width > p.topCanvas.width) {\r\n                            ctx.imageSmoothingEnabled = false;\r\n                        }\r\n                        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\r\n\r\n                        if (options.getValue() === 'as-alpha') {\r\n                            ctx.globalCompositeOperation = 'destination-in';\r\n                            ctx.globalAlpha = p.topOpacity;\r\n                            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\r\n                        } else {\r\n                            ctx.globalCompositeOperation = options.getValue();\r\n                            ctx.globalAlpha = p.topOpacity;\r\n                            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\r\n                        }\r\n                        ctx.restore();\r\n                    }\r\n\r\n                    update();\r\n\r\n\r\n                    let keyListener = new BB.KeyListener({\r\n                        onDown: function(keyStr) {\r\n                            if (keyStr === 'right') {\r\n                                options.next();\r\n                            }\r\n                            if (keyStr === 'left') {\r\n                                options.previous();\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    popup({\r\n                        target: p_rootDiv,\r\n                        message: `<b>${LANG('layers-merge-modal-title')}</b>`,\r\n                        div: div,\r\n                        buttons: [\"Ok\", \"Cancel\"],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: function (val) {\r\n                            keyListener.destroy();\r\n                            options.destroy();\r\n                            if (val === \"Ok\") {\r\n                                p.callback(options.getValue());\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                mergeDialog({\r\n                    topCanvas: klCanvasLayerArr[selectedSpotIndex].context.canvas,\r\n                    bottomCanvas: klCanvasLayerArr[selectedSpotIndex - 1].context.canvas,\r\n                    topOpacity: klCanvas.getLayer(selectedSpotIndex).opacity,\r\n                    mixModeStr: klCanvasLayerArr[selectedSpotIndex].mixModeStr,\r\n                    callback: function (mode) {\r\n                        klCanvas.mergeLayers(selectedSpotIndex, selectedSpotIndex - 1, mode);\r\n                        klCanvasLayerArr = klCanvas.getLayers();\r\n                        selectedSpotIndex--;\r\n                        if (klCanvasLayerArr.length === 1) {\r\n                            removeBtn.disabled = true;\r\n                        }\r\n                        if (klCanvasLayerArr.length < MAX_LAYERS) {\r\n                            addnewBtn.disabled = false;\r\n                            duplicateBtn.disabled = false;\r\n                        }\r\n                        createLayerList();\r\n                        klHistory.pause(true);\r\n                        updatefunc(selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                });\r\n            };\r\n\r\n            renameBtn.onclick = function () {\r\n                renameLayer(selectedSpotIndex);\r\n            };\r\n        }\r\n        setTimeout(async, 1);\r\n        return div;\r\n    }\r\n    div.appendChild(createButtons());\r\n\r\n    let modeWrapper;\r\n    let modeSelect;\r\n    {\r\n        modeWrapper = BB.el({\r\n            content: LANG('layers-blending') + '&nbsp;',\r\n            css: {\r\n                fontSize: '15px'\r\n            }\r\n        });\r\n\r\n        modeSelect = new Select({\r\n            optionArr: [\r\n                'source-over',\r\n                null,\r\n                'darken',\r\n                'multiply',\r\n                'color-burn',\r\n                null,\r\n                'lighten',\r\n                'screen',\r\n                'color-dodge',\r\n                null,\r\n                'overlay',\r\n                'soft-light',\r\n                'hard-light',\r\n                null,\r\n                'difference',\r\n                'exclusion',\r\n                null,\r\n                'hue',\r\n                'saturation',\r\n                'color',\r\n                'luminosity',\r\n            ].map((item: IMixMode) => {\r\n                return item ? [item, translateBlending(item)] : null;\r\n            }),\r\n            onChange: function(val) {\r\n                klCanvas.setMixMode(selectedSpotIndex, val as IMixMode);\r\n                (div as any).update(selectedSpotIndex);\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n\r\n        modeWrapper.appendChild(modeSelect.getElement());\r\n        div.appendChild(modeWrapper);\r\n\r\n    }\r\n\r\n\r\n    function createLayerList() {\r\n        oldHistoryState = klHistory.getState();\r\n        function createLayerEntry(index) {\r\n            let layerName = klCanvas.getLayer(index).name;\r\n            let opacity = klCanvasLayerArr[index].opacity;\r\n            let layercanvas = klCanvasLayerArr[index].context.canvas;\r\n\r\n            let layer = document.createElement(\"div\");\r\n            layer.className = \"layerBox\";\r\n            layerElArr[index] = layer;\r\n            (layer as any).posY = ((klCanvasLayerArr.length - 1) * 35 - index * 35);\r\n            BB.css(layer, {\r\n                width: \"250px\",\r\n                height: \"34px\",\r\n                backgroundColor: \"rgb( 220, 220, 220)\",\r\n                border: \"1px solid #aaa\",\r\n                position: \"absolute\",\r\n                left: \"0 px\",\r\n                top: (layer as any).posY + \"px\",\r\n                transition: \"all 0.1s linear\",\r\n                borderRadius: \"5px\",\r\n                boxSizing: 'border-box'\r\n            });\r\n            let innerLayer = document.createElement(\"div\");\r\n            BB.css(innerLayer, {\r\n                position: \"relative\"\r\n            });\r\n\r\n            let container1 = document.createElement(\"div\");\r\n            BB.css(container1, {\r\n                width: \"250px\",\r\n                height: \"34px\"\r\n            });\r\n            let container2 = document.createElement(\"div\");\r\n            layer.appendChild(innerLayer);\r\n            innerLayer.appendChild(container1);\r\n            innerLayer.appendChild(container2);\r\n\r\n            (layer as any).spot = index;\r\n\r\n            //thumb\r\n            {\r\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\r\n                let thumb = (layer as any).thumb = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n\r\n                let thc = thumb.getContext(\"2d\");\r\n                thc.save();\r\n                if (thumb.width > layercanvas.width) {\r\n                    thc.imageSmoothingEnabled = false;\r\n                }\r\n                thc.drawImage(layercanvas, 0, 0, thumb.width, thumb.height);\r\n                thc.restore();\r\n                BB.css((layer as any).thumb, {\r\n                    position: \"absolute\",\r\n                    left: ((32 - (layer as any).thumb.width) / 2) + \"px\",\r\n                    top: ((32 - (layer as any).thumb.height) / 2) + \"px\",\r\n                    colorScheme: 'only light',\r\n                });\r\n                BB.createCheckerDataUrl(4, function(url) {\r\n                    thumb.style.backgroundImage = \"url(\" + url + \")\";\r\n                });\r\n            }\r\n\r\n            //layerlabel\r\n            {\r\n                (layer as any).label = document.createElement(\"div\");\r\n                (layer as any).lname = layerName;\r\n                (layer as any).label.append((layer as any).lname);\r\n\r\n                BB.css((layer as any).label, {\r\n                    position: \"absolute\",\r\n                    left: (1 + 32 + 5) + \"px\",\r\n                    top: 1 + \"px\",\r\n                    fontSize: \"13px\",\r\n                    width: \"170px\",\r\n                    height: \"20px\",\r\n                    overflow: \"hidden\",\r\n                    color: \"#666\",\r\n                    whiteSpace: 'nowrap'\r\n                });\r\n\r\n                (layer as any).label.ondblclick = function() {\r\n                    renameLayer((layer as any).spot);\r\n                };\r\n            }\r\n            //layerlabel\r\n            {\r\n                (layer as any).opacityLabel = document.createElement(\"div\");\r\n                (layer as any).opacity = opacity;\r\n                (layer as any).opacityLabel.append(parseInt('' + ((layer as any).opacity * 100)) + \"%\");\r\n\r\n                BB.css((layer as any).opacityLabel, {\r\n                    position: \"absolute\",\r\n                    left: (250 - 1 - 5 - 50) + \"px\",\r\n                    top: 1 + \"px\",\r\n                    fontSize: \"13px\",\r\n                    textAlign: \"right\",\r\n                    width: \"50px\",\r\n                    color: \"#666\",\r\n                    transition: \"color 0.2s ease-in-out\"\r\n                });\r\n            }\r\n\r\n            let oldOpacity;\r\n            let opacitySlider = new PointSlider({\r\n                init: (layer as any).opacity,\r\n                width: 204,\r\n                pointSize: 14,\r\n                callback: function(sliderValue, isFirst, isLast) {\r\n                    if (isFirst) {\r\n                        oldOpacity = klCanvas.getLayer((layer as any).spot).opacity;\r\n                        klHistory.pause(true);\r\n                        return;\r\n                    }\r\n                    if (isLast) {\r\n                        klHistory.pause(false);\r\n                        if (oldOpacity !== sliderValue) {\r\n                            klCanvas.layerOpacity((layer as any).spot, sliderValue);\r\n                        }\r\n                        return;\r\n                    }\r\n                    (layer as any).opacityLabel.innerHTML = Math.round(sliderValue * 100) + \"%\";\r\n                    klCanvas.layerOpacity((layer as any).spot, sliderValue);\r\n                }\r\n            });\r\n            BB.css(opacitySlider.getEl(), {\r\n                position: 'absolute',\r\n                left: '39px',\r\n                top: '17px'\r\n            });\r\n            (layer as any).opacitySlider = opacitySlider;\r\n\r\n            //larger layer preview - hover\r\n            BB.setEventListener((layer as any).thumb, 'onpointerover', function (e) {\r\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== 'touch')) { //shouldn't show while dragging\r\n                    return;\r\n                }\r\n\r\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\r\n\r\n                if (largeThumbCanvas.width !== thumbDimensions.width || largeThumbCanvas.height !== thumbDimensions.height) {\r\n                    largeThumbCanvas.width = thumbDimensions.width;\r\n                    largeThumbCanvas.height = thumbDimensions.height;\r\n                }\r\n                let ctx = largeThumbCanvas.getContext(\"2d\");\r\n                ctx.save();\r\n                if (largeThumbCanvas.width > layercanvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.imageSmoothingQuality = 'high';\r\n                ctx.clearRect(0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\r\n                ctx.drawImage(layercanvas, 0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\r\n                ctx.restore();\r\n                BB.css(largeThumbDiv, {\r\n                    top: (e.clientY - largeThumbCanvas.height / 2) + \"px\",\r\n                    opacity: '0'\r\n                });\r\n                if (largeThumbInDocument === false) {\r\n                    document.body.appendChild(largeThumbDiv);\r\n                    largeThumbInDocument = true;\r\n                }\r\n                clearTimeout(largeThumbInTimeout);\r\n                largeThumbInTimeout = setTimeout(function () {\r\n                    BB.css(largeThumbDiv, {\r\n                        opacity: '1'\r\n                    });\r\n                }, 20);\r\n                clearTimeout(largeThumbTimeout);\r\n            });\r\n            BB.setEventListener((layer as any).thumb, 'onpointerout', function () {\r\n                clearTimeout(largeThumbInTimeout);\r\n                BB.css(largeThumbDiv, {\r\n                    opacity: '0'\r\n                });\r\n                clearTimeout(largeThumbTimeout);\r\n                largeThumbTimeout = setTimeout(function () {\r\n                    if (!largeThumbInDocument) {\r\n                        return;\r\n                    }\r\n                    document.body.removeChild(largeThumbDiv);\r\n                    largeThumbInDocument = false;\r\n                }, 300);\r\n            });\r\n\r\n            container1.appendChild((layer as any).thumb);\r\n            container1.appendChild((layer as any).label);\r\n            container1.appendChild((layer as any).opacityLabel);\r\n            container1.appendChild(opacitySlider.getEl());\r\n            let dragstart = false;\r\n            let freshSelection = false;\r\n\r\n            //events for moving layers up and down\r\n            function dragEventHandler(event) {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    BB.css(layer, {\r\n                        transition: \"box-shadow 0.3s ease-in-out\"\r\n                    });\r\n                    //dragContainer.appendChild(layer);\r\n                    layer.style.zIndex = '1';\r\n                    lastpos = (layer as any).spot;\r\n                    freshSelection = false;\r\n                    if (!(layer as any).isSelected) {\r\n                        freshSelection = true;\r\n                        (div as any).activateLayer((layer as any).spot);\r\n                    }\r\n                    dragstart = true;\r\n\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    if (dragstart) {\r\n                        dragstart = false;\r\n                        BB.css(layer, {\r\n                            boxShadow: \"1px 3px 5px rgba(0,0,0,0.4)\"\r\n                        });\r\n                    }\r\n                    (layer as any).posY += event.dY;\r\n                    let corrected = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\r\n                    layer.style.top = corrected + \"px\";\r\n                    updateLayersVerticalPosition((layer as any).spot, posToSpot((layer as any).posY));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(layer, {\r\n                        transition: \"all 0.1s linear\"\r\n                    });\r\n                    setTimeout(function () {\r\n                        BB.css(layer, {\r\n                            boxShadow: \"\"\r\n                        });\r\n                    }, 20);\r\n                    (layer as any).posY = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\r\n                    //regularContainer.appendChild(layer);\r\n                    layer.style.zIndex = \"\";\r\n                    let newSpot = posToSpot((layer as any).posY);\r\n                    let oldSpot = (layer as any).spot;\r\n                    move((layer as any).spot, newSpot);\r\n                    if (oldSpot != newSpot) {\r\n                        klHistory.pause(true);\r\n                        updatefunc(selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                    if (oldSpot === newSpot && freshSelection) {\r\n                        updatefunc(selectedSpotIndex);\r\n                    }\r\n                    freshSelection = false;\r\n                }\r\n            }\r\n\r\n            (layer as any).pointerListener = new BB.PointerListener({\r\n                target: container1,\r\n                maxPointers: 1,\r\n                onPointer: dragEventHandler\r\n            });\r\n\r\n            layerListEl.appendChild(layer);\r\n        }\r\n        layerElArr = [];\r\n        while (layerListEl.firstChild) {\r\n            let child = layerListEl.firstChild;\r\n            (child as any).pointerListener.destroy();\r\n            (child as any).opacitySlider.destroy();\r\n            layerListEl.removeChild(child);\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            createLayerEntry(i);\r\n        }\r\n        (div as any).activateLayer(selectedSpotIndex);\r\n        updateHeight();\r\n    }\r\n\r\n\r\n    listdiv.appendChild(layerListEl);\r\n    div.appendChild(listdiv);\r\n\r\n\r\n    function posToSpot(p) {\r\n        let result = parseInt('' + ((p) / (layerHeight + layerSpacing) + 0.5));\r\n        result = Math.min(klCanvasLayerArr.length - 1, Math.max(0, result));\r\n        result = klCanvasLayerArr.length - result - 1;\r\n        return result;\r\n    }\r\n\r\n    let lastpos = 0;\r\n\r\n    //update css position of all layers that are not being dragged, while dragging\r\n    function updateLayersVerticalPosition(id, newspot) {\r\n        newspot = Math.min(klCanvasLayerArr.length - 1, Math.max(0, newspot));\r\n        if (newspot === lastpos) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            if (layerElArr[i].spot === id) { // <- here\r\n                continue;\r\n            }\r\n            let posy = layerElArr[i].spot;\r\n            if (layerElArr[i].spot > id) {\r\n                posy--;\r\n            }\r\n            if (posy >= newspot) {\r\n                posy++;\r\n            }\r\n            layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\r\n            layerElArr[i].style.top = layerElArr[i].posY + \"px\";\r\n        }\r\n        lastpos = newspot;\r\n    }\r\n\r\n    function move(oldSpotIndex, newSpotIndex) {\r\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) {\r\n            throw 'layermanager - invalid move';\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            (function (i) {\r\n                let posy = layerElArr[i].spot; // <- here\r\n                if (layerElArr[i].spot === oldSpotIndex) {\r\n                    posy = newSpotIndex;\r\n                } else {\r\n                    if (layerElArr[i].spot > oldSpotIndex)\r\n                        posy--;\r\n                    if (posy >= newSpotIndex)\r\n                        posy++;\r\n                }\r\n                layerElArr[i].spot = posy;\r\n                layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\r\n                layerElArr[i].style.top = layerElArr[i].posY + \"px\";\r\n            }(i));\r\n        }\r\n        if (oldSpotIndex === newSpotIndex) {\r\n            return;\r\n        }\r\n        klCanvas.moveLayer(selectedSpotIndex, newSpotIndex - oldSpotIndex);\r\n        klCanvasLayerArr = klCanvas.getLayers();\r\n        selectedSpotIndex = newSpotIndex;\r\n        mergeBtn.disabled = selectedSpotIndex === 0;\r\n    }\r\n\r\n\r\n    //updating the thumbs in interval\r\n    //don't update when: manager not visible || layer didn't change || is drawing\r\n    let updateThumbsInterval = setInterval(function() {\r\n        if (div.style.display !== \"block\") {\r\n            return;\r\n        }\r\n\r\n        let historyState = klHistory.getState();\r\n        if (historyState === oldHistoryState) {\r\n            return;\r\n        }\r\n        oldHistoryState = historyState;\r\n\r\n        for (let i = 0; i < layerElArr.length; i++) {\r\n            if (selectedSpotIndex === layerElArr[i].spot && klCanvasLayerArr[layerElArr[i].spot]) { // second check, because might be out of date\r\n                let ctx = layerElArr[i].thumb.getContext(\"2d\");\r\n                ctx.save();\r\n                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n                if (klCanvasLayerArr[layerElArr[i].spot].context.canvas.width < layerElArr[i].thumb.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.drawImage(klCanvasLayerArr[layerElArr[i].spot].context.canvas, 0, 0, layerElArr[i].thumb.width, layerElArr[i].thumb.height);\r\n                ctx.restore();\r\n            }\r\n        }\r\n\r\n    }, 1);\r\n\r\n    function updateHeight() {\r\n        layerListEl.style.height = (layerElArr.length * 35) + 'px';\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    (div as any).update = function (activeLayerSpotIndex) {\r\n        klCanvasLayerArr = klCanvas.getLayers();\r\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) {\r\n            selectedSpotIndex = activeLayerSpotIndex;\r\n        }\r\n        removeBtn.disabled = klCanvasLayerArr.length === 1;\r\n        if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n            addnewBtn.disabled = true;\r\n            duplicateBtn.disabled = true;\r\n        } else {\r\n            addnewBtn.disabled = false;\r\n            duplicateBtn.disabled = false;\r\n        }\r\n        setTimeout(function() {\r\n            createLayerList();\r\n        }, 1);\r\n    };\r\n    (div as any).getSelected = function () {\r\n        return selectedSpotIndex;\r\n    };\r\n    (div as any).activateLayer = function (spotIndex) {\r\n        if (spotIndex < 0 || spotIndex > layerElArr.length - 1) {\r\n            throw 'invalid spotIndex ' + spotIndex + ', layerElArr.length ' + layerElArr.length;\r\n        }\r\n        selectedSpotIndex = spotIndex;\r\n        modeSelect.setValue(klCanvasLayerArr[selectedSpotIndex].mixModeStr);\r\n        for (let i = 0; i < layerElArr.length; i++) {\r\n            if (selectedSpotIndex === layerElArr[i].spot) {\r\n                layerElArr[i].style.backgroundColor = \"rgb( 250, 250, 250)\";\r\n                layerElArr[i].label.style.color = \"#000\";\r\n                layerElArr[i].style.boxShadow = \"\";\r\n                layerElArr[i].style.border = \"1px solid var(--active-highlight-color)\";\r\n                layerElArr[i].opacitySlider.setActive(true);\r\n                layerElArr[i].isSelected = true;\r\n            } else {\r\n                layerElArr[i].style.backgroundColor = \"rgb( 220, 220, 220)\";\r\n                layerElArr[i].label.style.color = \"#666\";\r\n                layerElArr[i].style.boxShadow = \"\";\r\n                layerElArr[i].style.border = \"1px solid rgb(158, 158, 158)\";\r\n                layerElArr[i].opacitySlider.setActive(false);\r\n                layerElArr[i].isSelected = false;\r\n            }\r\n        }\r\n        mergeBtn.disabled = selectedSpotIndex === 0;\r\n    };\r\n    (div as any).setUiState = function(stateStr) {\r\n        uiState = '' + stateStr;\r\n\r\n        if (uiState === 'left') {\r\n            BB.css(largeThumbDiv, {\r\n                left: '280px',\r\n                right: ''\r\n            });\r\n        } else {\r\n            BB.css(largeThumbDiv, {\r\n                left: '',\r\n                right: '280px'\r\n            });\r\n        }\r\n    };\r\n\r\n    createLayerList();\r\n\r\n    return div;\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1mb1v\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"11KJK\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"floUo\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kino6\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hhQeq\");","import {BB} from '../../bb/bb';\r\nimport {floodFillBits} from '../image-operations/flood-fill';\r\nimport {drawShape} from '../image-operations/shape-tool';\r\nimport {IRenderTextParam, renderText} from '../image-operations/render-text';\r\nimport {IKlProject, IMixMode, IRGB, IShapeToolObject} from '../kl.types';\r\nimport {DecoyKlHistory, KlHistoryInterface} from '../history/kl-history';\r\nimport {drawProject} from './draw-project';\r\nimport {LANG} from '../../language/language';\r\n\r\n\r\nconst allowedMixModes = [\r\n    'source-over',\r\n    'darken',\r\n    'multiply',\r\n    'color-burn',\r\n    'lighten',\r\n    'screen',\r\n    'color-dodge',\r\n    'overlay',\r\n    'soft-light',\r\n    'hard-light',\r\n    'difference',\r\n    'exclusion',\r\n    'hue',\r\n    'saturation',\r\n    'color',\r\n    'luminosity',\r\n];\r\n\r\nexport const MAX_LAYERS = 16;\r\n\r\ninterface KlCanvasLayer extends HTMLCanvasElement {\r\n    name: string;\r\n    mixModeStr: IMixMode;\r\n    opacity: number;\r\n    compositeObj?: {\r\n        draw: (ctx: CanvasRenderingContext2D) => void;\r\n    },\r\n    index: number; // certain brushes need to know\r\n}\r\n\r\n/**\r\n * The image/canvas that the user paints on\r\n * Has layers. layers have names and opacity.\r\n *\r\n * Interacts with the history you specify (for undo/redo)\r\n */\r\nexport class KlCanvas {\r\n\r\n    // todo changeListener consistent concept\r\n    // todo history interaction, consistent concept - currently have to look at code to know if something pushes on history\r\n\r\n    private width: number;\r\n    private height: number;\r\n    private layerCanvasArr: KlCanvasLayer[];\r\n    private pickCanvas: HTMLCanvasElement; // canvas to draw into for color picker\r\n    private history: KlHistoryInterface;\r\n    private changeListenerArr:  (() => void)[]; // subscribers get notified when opacity changes\r\n\r\n\r\n    private init (w: number, h: number): void {\r\n        if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            throw new Error('init - invalid canvas size: ' + w + ', ' + h);\r\n        }\r\n        this.width = w;\r\n        this.height = h;\r\n    }\r\n\r\n    private emitChange (): void {\r\n        // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\r\n        this.changeListenerArr.forEach(item => item());\r\n    }\r\n\r\n    private updateIndices (): void {\r\n        this.layerCanvasArr.forEach((item, index) => {\r\n            item.index = index;\r\n        });\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        params: {\r\n            projectObj: {\r\n                width: number;\r\n                height: number;\r\n                layers: {\r\n                    name: string;\r\n                    opacity: number;\r\n                    image: HTMLImageElement | HTMLCanvasElement; // already loaded!\r\n                }[];\r\n            }\r\n        } | {\r\n            // creates blank KlCanvas, 0 layers\r\n            width: number;\r\n            height: number;\r\n        } | {\r\n            copy: KlCanvas;\r\n        },\r\n        private layerNrOffset: number = 0,\r\n    ) {\r\n        this.layerCanvasArr = [];\r\n        this.pickCanvas = BB.canvas(1, 1);\r\n        this.history = new DecoyKlHistory();\r\n        if ('copy' in params) {\r\n            this.width = 1;\r\n            this.height = 1;\r\n        } else {\r\n            if ('width' in params && 'height' in params) {\r\n                this.width = params.width;\r\n                this.height = params.height;\r\n            } else {\r\n                this.width = 1;\r\n                this.height = 1;\r\n            }\r\n        }\r\n        this.init(this.width, this.height);\r\n\r\n        this.changeListenerArr = [];\r\n\r\n        if ('copy' in params) {\r\n            try {\r\n                this.copy(params.copy);\r\n            } catch (e) {\r\n                this.destroy();\r\n                throw e;\r\n            }\r\n        } else if ('projectObj' in params) {\r\n            const origLayers = [].concat(params.projectObj.layers);\r\n            this.init(params.projectObj.width, params.projectObj.height);\r\n\r\n            if (!origLayers.length) {\r\n                throw new Error('project.layers needs at least 1 layer');\r\n            }\r\n\r\n            for (let i = 0; i < origLayers.length; i++) {\r\n                if (origLayers[i].mixModeStr && !allowedMixModes.includes(origLayers[i].mixModeStr)) {\r\n                    throw new Error('unknown mixModeStr ' + origLayers[i].mixModeStr);\r\n                }\r\n\r\n                this.addLayer();\r\n                this.layerOpacity(i, origLayers[i].opacity);\r\n                this.layerCanvasArr[i].name = origLayers[i].name;\r\n                this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr ? origLayers[i].mixModeStr : 'source-over';\r\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    /**\r\n     * Resets canvas -> 1 layer, 100% opacity,\r\n     * unless layers provided.\r\n     * @param p\r\n     */\r\n    reset (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n            color?: IRGB; // optional - fill color\r\n            image?: HTMLImageElement | HTMLCanvasElement; // image drawn on layer\r\n            layerName?: string; // if via image\r\n            layers?: {\r\n                name: string;\r\n                opacity: number;\r\n                mixModeStr: IMixMode;\r\n                image: HTMLCanvasElement;\r\n            }[];\r\n        }\r\n    ): void | number {\r\n        if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height) ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        this.history.pause(true);\r\n\r\n        this.width = p.width;\r\n        this.height = p.height;\r\n\r\n        this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\r\n\r\n        if (p.layers) {\r\n            for (let i = 0; i < p.layers.length; i++) {\r\n                let item = p.layers[i];\r\n                if (!this.layerCanvasArr[i]) {\r\n                    this.addLayer();\r\n                }\r\n                this.layerCanvasArr[i].name = item.name;\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n                this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : 'source-over';\r\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(item.image, 0, 0);\r\n                this.layerOpacity(i, item.opacity);\r\n            }\r\n        } else {\r\n            this.layerCanvasArr[0].name = p.layerName ? p.layerName : LANG('layers-layer') + \" 1\";\r\n            this.layerCanvasArr[0].width = this.width;\r\n            this.layerCanvasArr[0].height = this.height;\r\n            this.layerCanvasArr[0].mixModeStr = 'source-over';\r\n            this.layerOpacity(0, 1);\r\n            if (p.color) {\r\n                this.layerFill(0, p.color);\r\n            } else if (p.image) {\r\n                this.layerCanvasArr[0].getContext(\"2d\").drawImage(p.image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n\r\n        this.history.pause(false);\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"reset\",\r\n            params: [p] // dont screw with p\r\n        });\r\n\r\n        return this.layerCanvasArr.length - 1;\r\n    }\r\n\r\n    isLayerLimitReached (): boolean {\r\n        return this.layerCanvasArr.length >= MAX_LAYERS;\r\n    }\r\n\r\n    getWidth (): number {\r\n        return this.width;\r\n    }\r\n\r\n    getHeight (): number {\r\n        return this.height;\r\n    }\r\n\r\n    copy (toCopyCanvas: KlCanvas): void {\r\n        if (\r\n            toCopyCanvas.getWidth() < 1 ||\r\n            toCopyCanvas.getHeight() < 1 ||\r\n            isNaN(toCopyCanvas.getWidth()) ||\r\n            isNaN(toCopyCanvas.getHeight())\r\n        ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        // keep existing canvases\r\n\r\n        let origLayers = toCopyCanvas.getLayers();\r\n\r\n        while (this.layerCanvasArr.length > origLayers.length) {\r\n            this.removeLayer(this.layerCanvasArr.length - 1);\r\n        }\r\n\r\n        if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) {\r\n            this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\r\n        }\r\n        for (let i = 0; i < origLayers.length; i++) {\r\n            if (i >= this.layerCanvasArr.length) {\r\n                this.addLayer();\r\n            } else {\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n            }\r\n            this.layerOpacity(i, origLayers[i].opacity);\r\n            this.layerCanvasArr[i].name = origLayers[i].name;\r\n            this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].context.canvas, 0, 0);\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    getLayerCount (): number {\r\n        return this.layerCanvasArr.length;\r\n    }\r\n\r\n    resize (w: number, h: number, algorithm: 'smooth' | 'pixelated' = 'smooth'): boolean {\r\n        if (!w || !h || (w === this.width && h === this.height) || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            return false;\r\n        }\r\n        w = Math.max(w, 1);\r\n        h = Math.max(h, 1);\r\n\r\n        let tmp1, tmp2;\r\n\r\n        if (algorithm === 'pixelated') {\r\n            tmp1 = BB.canvas(w, h);\r\n            let tmp1Ctx = tmp1.getContext('2d');\r\n            tmp1Ctx.imageSmoothingEnabled = false;\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                if (i > 0) {\r\n                    tmp1Ctx.clearRect(0, 0, w, h);\r\n                }\r\n                let layerCanvas = this.layerCanvasArr[i];\r\n                tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\r\n                layerCanvas.width = w;\r\n                layerCanvas.height = h;\r\n                let layerContext = layerCanvas.getContext('2d');\r\n                layerContext.drawImage(tmp1, 0, 0);\r\n            }\r\n\r\n        } else if (algorithm === 'smooth') {\r\n            tmp1 = BB.canvas();\r\n            tmp2 = BB.canvas();\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                BB.resizeCanvas(this.layerCanvasArr[i], w, h, tmp1, tmp2);\r\n            }\r\n        } else {\r\n            throw new Error('unknown resize algorithm');\r\n        }\r\n\r\n        this.width = w;\r\n        this.height = h;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * crop / extend\r\n     * @param p\r\n     */\r\n    resizeCanvas (p: {\r\n        left: number;\r\n        top: number;\r\n        right: number;\r\n        bottom: number;\r\n        fillColor?: IRGB\r\n    }): void {\r\n\r\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\r\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\r\n        const offX = Math.round(p.left);\r\n        const offY = Math.round(p.top);\r\n\r\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) {\r\n            throw new Error('KlCanvas.resizeCanvas - invalid canvas size');\r\n        }\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            const ctemp = BB.canvas(this.width, this.height);\r\n            let layerCanvas = this.layerCanvasArr[i];\r\n            let layerCtx = this.layerCanvasArr[i].getContext(\"2d\");\r\n            ctemp.getContext(\"2d\").drawImage(layerCanvas, 0, 0);\r\n\r\n            this.layerCanvasArr[i].width = newW;\r\n            this.layerCanvasArr[i].height = newH;\r\n\r\n            layerCtx.save();\r\n            if (i === 0 && p.fillColor) {\r\n                layerCtx.fillStyle = BB.ColorConverter.toRgbStr(p.fillColor);\r\n                layerCtx.fillRect(0, 0, newW, newH);\r\n                layerCtx.clearRect(offX, offY, this.width, this.height);\r\n            }\r\n            layerCtx.drawImage(ctemp, offX, offY);\r\n            layerCtx.restore();\r\n        }\r\n        this.width = newW;\r\n        this.height = newH;\r\n    }\r\n\r\n    /**\r\n     * will be inserted on top of selected\r\n     * @param selected\r\n     */\r\n    addLayer (selected?: number): false | number {\r\n        if (this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        let canvas = BB.canvas(this.width, this.height);\r\n        if (!canvas.getContext('2d')) {\r\n            throw new Error('kl-create-canvas-error');\r\n        }\r\n\r\n        (canvas as any).mixModeStr = 'source-over';\r\n\r\n        if (selected === undefined) {\r\n            this.layerCanvasArr[this.layerCanvasArr.length] = canvas as any;\r\n            selected = Math.max(0, this.layerCanvasArr.length - 1);\r\n        } else {\r\n            this.layerCanvasArr.splice(selected + 1, 0, canvas as any);\r\n            selected++;\r\n        }\r\n\r\n        (canvas as any).name = LANG('layers-layer') + \" \" + (this.layerCanvasArr.length + this.layerNrOffset);\r\n        this.history.pause(true);\r\n        this.layerOpacity(selected, 1);\r\n        this.history.pause(false);\r\n        this.updateIndices();\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"addLayer\",\r\n            params: [selected - 1]\r\n        });\r\n        return selected;\r\n    }\r\n\r\n    duplicateLayer (i: number): false | number {\r\n        if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        let canvas = BB.canvas(this.width, this.height);\r\n        this.layerCanvasArr.splice(i + 1, 0, canvas as any);\r\n\r\n        (canvas as any).name = this.layerCanvasArr[i].name + \" \" + LANG('layers-copy');\r\n        (canvas as any).mixModeStr = this.layerCanvasArr[i].mixModeStr;\r\n        canvas.getContext(\"2d\").drawImage(this.layerCanvasArr[i], 0, 0);\r\n        this.history.pause(true);\r\n        this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\r\n        this.history.pause(false);\r\n\r\n        this.updateIndices();\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"duplicateLayer\",\r\n            params: [i]\r\n        });\r\n        return i + 1;\r\n    }\r\n\r\n    getLayerContext (i: number, doReturnNull?: boolean): CanvasRenderingContext2D | null {\r\n        if (this.layerCanvasArr[i]) {\r\n            return this.layerCanvasArr[i].getContext(\"2d\");\r\n        }\r\n        if (doReturnNull) {\r\n            return null;\r\n        }\r\n        throw new Error(\"layer of index \" + i + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n    }\r\n\r\n    removeLayer (i: number): false | number {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr.splice(i, 1);\r\n            this.updateIndices();\r\n        } else {\r\n            return false;\r\n        }\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"removeLayer\",\r\n            params: [i]\r\n        });\r\n\r\n        return Math.max(0, i - 1);\r\n    }\r\n\r\n    renameLayer (i: number, name: string): boolean {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr[i].name = name;\r\n        } else {\r\n            return false;\r\n        }\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"renameLayer\",\r\n            params: [i, name]\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n    layerOpacity (i: number, o: number): void {\r\n        if (!this.layerCanvasArr[i]) {\r\n            return;\r\n        }\r\n        o = Math.max(0, Math.min(1, o));\r\n        this.layerCanvasArr[i].opacity = o;\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"layerOpacity\",\r\n            params: [i, o]\r\n        });\r\n\r\n        this.emitChange();\r\n    }\r\n\r\n    moveLayer (i: number, d: number): void | number {\r\n        if (d === 0) {\r\n            return;\r\n        }\r\n        if (this.layerCanvasArr[i]) {\r\n            const temp = this.layerCanvasArr[i];\r\n            this.layerCanvasArr.splice(i, 1);\r\n            const targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\r\n            this.layerCanvasArr.splice(targetIndex, 0, temp);\r\n            this.updateIndices();\r\n            this.history.push({\r\n                tool: [\"canvas\"],\r\n                action: \"moveLayer\",\r\n                params: [i, d]\r\n            });\r\n            return targetIndex;\r\n        }\r\n    }\r\n\r\n    mergeLayers (layerBottomIndex: number, layerTopIndex: number, mixModeStr: IMixMode | 'as-alpha'): void | number {\r\n        if (\r\n            !this.layerCanvasArr[layerBottomIndex] ||\r\n            !this.layerCanvasArr[layerTopIndex] ||\r\n            layerBottomIndex === layerTopIndex\r\n        ) {\r\n            return;\r\n        }\r\n        //order messed up\r\n        if (layerBottomIndex > layerTopIndex) {\r\n            let temp = layerBottomIndex;\r\n            layerBottomIndex = layerTopIndex;\r\n            layerTopIndex = temp;\r\n        }\r\n\r\n        let topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\r\n        if (topOpacity !== 0 && topOpacity) {\r\n            let ctx = this.layerCanvasArr[layerBottomIndex].getContext(\"2d\");\r\n            ctx.save();\r\n\r\n            if (mixModeStr === 'as-alpha') { // todo remove this?\r\n\r\n                BB.convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\r\n                ctx.globalCompositeOperation = 'destination-in';\r\n                ctx.globalAlpha = topOpacity;\r\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            } else {\r\n\r\n                if (mixModeStr) {\r\n                    ctx.globalCompositeOperation = mixModeStr;\r\n                }\r\n                ctx.globalAlpha = topOpacity;\r\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            }\r\n\r\n            ctx.restore();\r\n\r\n            // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n            // TODO remove if chrome updated\r\n            if (mixModeStr) {\r\n                ctx.save();\r\n                ctx.fillStyle = \"rgba(0,0,0,0.01)\";\r\n                ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n                ctx.restore();\r\n            }\r\n        }\r\n        this.updateIndices();\r\n        this.history.pause(true);\r\n        this.removeLayer(layerTopIndex);\r\n        this.history.pause(false);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"mergeLayers\",\r\n            params: [layerBottomIndex, layerTopIndex, mixModeStr]\r\n        });\r\n\r\n        return layerBottomIndex;\r\n    }\r\n\r\n    rotate (deg: number): void {\r\n        while (deg < 0) {\r\n            deg += 360;\r\n        }\r\n        deg %= 360;\r\n        if (deg % 90 != 0 || deg === 0)\r\n            return;\r\n        let temp = BB.canvas();\r\n        if (deg === 0 || deg === 180) {\r\n            temp.width = this.width;\r\n            temp.height = this.height;\r\n        } else if (deg === 90 || deg === 270) {\r\n            temp.width = this.height;\r\n            temp.height = this.width;\r\n        }\r\n        let ctx = temp.getContext(\"2d\");\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.clearRect(0, 0, temp.width, temp.height);\r\n            ctx.save();\r\n            ctx.translate(temp.width / 2, temp.height / 2);\r\n            ctx.rotate(deg * Math.PI / 180);\r\n            if (deg === 180) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            } else if (deg === 90 || deg === 270) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\r\n            }\r\n            this.layerCanvasArr[i].width = temp.width;\r\n            this.layerCanvasArr[i].height = temp.height;\r\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\r\n            ctx.restore();\r\n        }\r\n        this.width = temp.width;\r\n        this.height = temp.height;\r\n    }\r\n\r\n    flip (isHorizontal: boolean, isVertical: boolean, layerIndex: number): void {\r\n        if (!isHorizontal && !isVertical) {\r\n            return;\r\n        }\r\n\r\n        let temp = BB.canvas(this.width, this.height);\r\n        temp.width = this.width;\r\n        temp.height = this.height;\r\n        let tempCtx = temp.getContext(\"2d\");\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n\r\n            if ( (layerIndex || layerIndex === 0) && i !== layerIndex) {\r\n                continue;\r\n            }\r\n\r\n            tempCtx.save();\r\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\r\n            tempCtx.translate(temp.width / 2, temp.height / 2);\r\n            tempCtx.scale((isHorizontal ? -1 : 1), (isVertical ? -1 : 1));\r\n            tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            tempCtx.restore();\r\n\r\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\r\n        }\r\n    }\r\n\r\n    layerFill (layerIndex: number, colorObj: IRGB, compositeOperation?: string): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.save();\r\n        if (compositeOperation) {\r\n            ctx.globalCompositeOperation = compositeOperation as GlobalCompositeOperation;\r\n        }\r\n        ctx.fillStyle = \"rgba(\" + colorObj.r + \",\" + colorObj.g + \",\" + colorObj.b + \",1)\";\r\n        ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n        // TODO remove if chrome updated\r\n        ctx.save();\r\n        ctx.fillStyle = \"rgba(0,0,0,0.01)\";\r\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n        ctx.restore();\r\n\r\n        /*if (!document.getElementById('testocanvas')) {\r\n            layerCanvasArr[layerIndex].id = 'testocanvas';\r\n            document.body.appendChild(layerCanvasArr[layerIndex]);\r\n            BB.css(layerCanvasArr[layerIndex], {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }\r\n        if (!document.getElementById('testocanvas')) {\r\n            let c = document.createElement('canvas');\r\n            c.width = 1000;\r\n            c.height = 1000;\r\n            let ctx2 = c.getContext('2d');\r\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\r\n            c.id = 'testocanvas';\r\n            document.body.appendChild(c);\r\n            BB.css(c, {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }*/\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"layerFill\",\r\n            params: [layerIndex, colorObj, compositeOperation]\r\n        });\r\n    }\r\n\r\n    floodFill (\r\n        layerIndex: number, // index of layer to be filled\r\n        x: number, // starting point\r\n        y: number,\r\n        rgb: IRGB, // fill color\r\n        opacity: number,\r\n        tolerance: number,\r\n        sampleStr: 'current' | 'all' | 'above',\r\n        grow: number, // int >= 0 - radius around filled area that is to be filled too\r\n        isContiguous: boolean,\r\n    ): void {\r\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) {\r\n            return;\r\n        }\r\n        tolerance = Math.round(tolerance);\r\n\r\n        if (!(['above', 'current', 'all'].includes(sampleStr))) {\r\n            throw new Error('invalid sampleStr');\r\n        }\r\n\r\n        let result;\r\n\r\n        let srcCtx;\r\n        let srcImageData;\r\n        let srcData;\r\n\r\n        let targetCtx;\r\n        let targetImageData;\r\n        let targetData;\r\n\r\n\r\n        if (sampleStr === 'all') {\r\n\r\n            let srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\r\n            srcCtx = srcCanvas.getContext('2d');\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            srcCanvas = null;\r\n            srcCtx = null;\r\n            srcImageData = null;\r\n            srcData = null;\r\n\r\n            targetCtx = this.layerCanvasArr[layerIndex].getContext('2d');\r\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        } else {\r\n            let srcIndex = sampleStr === 'above' ? layerIndex + 1 : layerIndex;\r\n\r\n            if (srcIndex >= this.layerCanvasArr.length) {\r\n                return;\r\n            }\r\n\r\n            srcCtx = this.layerCanvasArr[srcIndex].getContext('2d');\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            if (layerIndex !== srcIndex) {\r\n                srcCtx = null;\r\n                srcImageData = null;\r\n                srcData = null;\r\n            }\r\n\r\n            targetCtx = layerIndex === srcIndex ? srcCtx : this.layerCanvasArr[layerIndex].getContext('2d');\r\n            targetImageData = layerIndex === srcIndex ? srcImageData : targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        }\r\n\r\n        targetData = targetImageData.data;\r\n        if (opacity === 1) {\r\n            for (let i = 0; i < this.width * this.height; i++) {\r\n                if (result.data[i] === 255) {\r\n                    targetData[i * 4] = rgb.r;\r\n                    targetData[i * 4 + 1] = rgb.g;\r\n                    targetData[i * 4 + 2] = rgb.b;\r\n                    targetData[i * 4 + 3] = 255;\r\n                }\r\n            }\r\n        } else {\r\n            for (let i = 0; i < this.width * this.height; i++) {\r\n                if (result.data[i] === 255) {\r\n                    targetData[i * 4] = BB.mix(targetData[i * 4], rgb.r, opacity);\r\n                    targetData[i * 4 + 1] = BB.mix(targetData[i * 4 + 1], rgb.g, opacity);\r\n                    targetData[i * 4 + 2] = BB.mix(targetData[i * 4 + 2], rgb.b, opacity);\r\n                    targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 255, opacity);\r\n                }\r\n            }\r\n        }\r\n        targetCtx.putImageData(targetImageData, 0, 0);\r\n\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [layerIndex, targetImageData]\r\n        });\r\n    }\r\n\r\n    /**\r\n     * draw shape via BB.drawShape\r\n     * @param layerIndex\r\n     * @param shapeObj\r\n     */\r\n    drawShape (layerIndex: number, shapeObj: IShapeToolObject): void {\r\n        if (shapeObj.x1 === shapeObj.x2 && shapeObj.y1 === shapeObj.y2) {\r\n            return;\r\n        }\r\n        drawShape(this.layerCanvasArr[layerIndex].getContext(\"2d\"), shapeObj);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"drawShape\",\r\n            params: [layerIndex, BB.copyObj(shapeObj)],\r\n        });\r\n    }\r\n\r\n    text (layerIndex: number, p: IRenderTextParam): void {\r\n        renderText(this.layerCanvasArr[layerIndex], BB.copyObj(p));\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"text\",\r\n            params: [layerIndex, BB.copyObj(p)],\r\n        });\r\n    }\r\n\r\n    replaceLayer (layerIndex: number, imageData: ImageData): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.putImageData(imageData, 0, 0);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [layerIndex, imageData],\r\n        });\r\n    }\r\n\r\n    clearLayer (layerIndex: number): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"clearLayer\",\r\n            params: [layerIndex]\r\n        });\r\n    }\r\n\r\n    getLayers (): {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                context: item.getContext(\"2d\"),\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayersFast (): {\r\n        canvas: KlCanvasLayer;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                canvas: item,\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayerIndex (canvasObj: HTMLCanvasElement, doReturnNull?: boolean): null | number {\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            if (this.layerCanvasArr[i] === canvasObj) {\r\n                return i;\r\n            }\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error(\"layer not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getLayer (index: number, doReturnNull?: boolean): null | {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        id: number;\r\n    } {\r\n        if (this.layerCanvasArr[index]) {\r\n            return {\r\n                context: this.layerCanvasArr[index].getContext(\"2d\"),\r\n                opacity: this.layerCanvasArr[index].opacity,\r\n                name: this.layerCanvasArr[index].name,\r\n                id: index,\r\n            };\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error(\"layer of index \" + index + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getColorAt (x: number, y: number): IRGB {\r\n        x = Math.floor(x);\r\n        y = Math.floor(y);\r\n        let ctx = this.pickCanvas.getContext(\"2d\");\r\n        ctx.save();\r\n        ctx.imageSmoothingEnabled = false;\r\n        ctx.clearRect(0, 0, 1, 1);\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.globalAlpha = this.layerCanvasArr[i].opacity;\r\n            ctx.globalCompositeOperation = this.layerCanvasArr[i].mixModeStr;\r\n            ctx.drawImage(this.layerCanvasArr[i], -x, -y);\r\n        }\r\n        ctx.restore();\r\n        let imData = ctx.getImageData(0, 0, 1, 1);\r\n        return new BB.RGB(imData.data[0], imData.data[1], imData.data[2]);\r\n    }\r\n\r\n    getCompleteCanvas (factor: number): HTMLCanvasElement {\r\n        return drawProject(this.getProject(), factor);\r\n    }\r\n\r\n    getProject (): IKlProject {\r\n        return {\r\n            width: this.width,\r\n            height: this.height,\r\n            layers: this.layerCanvasArr.map(layer => {\r\n                return {\r\n                    name: layer.name,\r\n                    opacity: layer.opacity,\r\n                    mixModeStr: layer.mixModeStr,\r\n                    image: layer,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    addChangeListener (func: () => void): void {\r\n        if (this.changeListenerArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.changeListenerArr.push(func);\r\n    }\r\n\r\n    removeChangeListener (func: () => void): void {\r\n        for (let i = 0; i < this.changeListenerArr.length; i++) {\r\n            if (this.changeListenerArr[i] === func) {\r\n                this.changeListenerArr.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    setMixMode (layerIndex: number, mixModeStr: IMixMode): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"setMixMode\",\r\n            params: [layerIndex, '' + mixModeStr],\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Set composite drawing step for KlCanvasWorkspace.\r\n     * To apply temporary manipulations to a layer.\r\n     *\r\n     * @param layerIndex\r\n     * @param compositeObj\r\n     */\r\n    setComposite (\r\n        layerIndex: number,\r\n        compositeObj: null | {\r\n            draw: (ctx: CanvasRenderingContext2D) => void;\r\n        }\r\n    ): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].compositeObj = compositeObj;\r\n    }\r\n\r\n    destroy (): void {\r\n        if (this.layerCanvasArr === null) {\r\n            return;\r\n        }\r\n        this.layerCanvasArr.forEach(canvas => {\r\n            BB.freeCanvas(canvas);\r\n        });\r\n        this.layerCanvasArr = null;\r\n    }\r\n\r\n}\r\n","\r\n/**\r\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/ but it implemented tolerance wrong, and had bugs.\r\n * So, my own implementation. can handle tolerance, grow, opacity.\r\n * Needs to be optimized.\r\n */\r\n\r\n/**\r\n * Set values in data within rect to 254, unless they're 255\r\n *\r\n * @param data Uint8Array\r\n * @param width int\r\n * @param x0 int\r\n * @param y0 int\r\n * @param x1 int >x0\r\n * @param y1 int >y0\r\n */\r\nfunction fillRect(data, width, x0, y0, x1, y1) {\r\n    for (let x = x0; x <= x1; x++) {\r\n        for (let y = y0; y <= y1; y++) {\r\n            if (data[y * width + x] === 255) {\r\n                continue;\r\n            }\r\n            data[y * width + x] = 254;\r\n        }\r\n    }\r\n}\r\n\r\nlet mx, my;\r\n\r\n/**\r\n * Get index i moved by dX, dY. in array with dimensions width height.\r\n * Returns null if outside bounds.\r\n *\r\n * @param width int\r\n * @param height int\r\n * @param i int\r\n * @param dX int\r\n * @param dY int\r\n * @returns {null|*}\r\n */\r\nfunction moveIndex(width, height, i, dX, dY) {\r\n    mx = i % width + dX;\r\n    my = Math.floor(i / width) + dY;\r\n\r\n    if (mx < 0 || my < 0 || mx >= width || my >= height) {\r\n        return null;\r\n    }\r\n\r\n    return my * width + mx;\r\n}\r\n\r\n/**\r\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\r\n * returns false if already filled, or i is null\r\n *\r\n * @param srcArr Uint8Array rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param initRgba rgba\r\n * @param tolerance int 0 - 255\r\n * @param i int - srcArr index\r\n * @returns {boolean}\r\n */\r\nfunction testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i) {\r\n    if (i === null || targetArr[i] === 255) {\r\n        return false;\r\n    }\r\n\r\n    if (\r\n        srcArr[i * 4] === initRgba[0] &&\r\n        srcArr[i * 4 + 1] === initRgba[1] &&\r\n        srcArr[i * 4 + 2] === initRgba[2] &&\r\n        srcArr[i * 4 + 3] === initRgba[3]\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    if (\r\n        tolerance > 0 &&\r\n        Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n\r\n/**\r\n *\r\n * @param srcArr Uint8Array rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param px int\r\n * @param py int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n */\r\nfunction floodFill(srcArr, targetArr, width, height, px, py, tolerance, grow, isContiguous) {\r\n\r\n    let initRgba = [\r\n        srcArr[(py * width + px) * 4],\r\n        srcArr[(py * width + px) * 4 + 1],\r\n        srcArr[(py * width + px) * 4 + 2],\r\n        srcArr[(py * width + px) * 4 + 3]\r\n    ];\r\n\r\n    if (isContiguous) {\r\n        let q = [];\r\n        q.push(py * width + px);\r\n        targetArr[py * width + px] = 255;\r\n\r\n        let i, e;\r\n        while (q.length) {\r\n            i = q.pop();\r\n\r\n            // queue up unfilled neighbors\r\n            e = moveIndex(width, height, i, -1, 0); // left\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n\r\n            e = moveIndex(width, height, i, 1, 0); // right\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n\r\n            e = moveIndex(width, height, i, 0, -1); // up\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n\r\n            e = moveIndex(width, height, i, 0, 1); // bottom\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n        }\r\n    } else {\r\n        for (let i = 0; i < width * height; i++) {\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i);\r\n        }\r\n    }\r\n\r\n\r\n    // grow\r\n    if (grow === 0) {\r\n        return;\r\n    }\r\n\r\n    // how does it grow? it finds all pixel at the edge.\r\n    // then depending on what kind of edge it is, it draws a rectangle into target\r\n    // the rectangle has the value 254, or else it mess it all up.\r\n    // after it's all done, replaces it with 255\r\n    let x0, x1, y0, y1;\r\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\r\n    for (let x = 0; x < width; x++) {\r\n        for (let y = 0; y < height; y++) {\r\n            if (targetArr[y * width + x] !== 255) {\r\n                continue;\r\n            }\r\n\r\n            // bounds of rectangle\r\n            x0 = x;\r\n            x1 = x;\r\n            y0 = y;\r\n            y1 = y;\r\n\r\n            l = targetArr[(y) * width + x - 1] !== 255;\r\n            tl = targetArr[(y - 1) * width + x - 1] !== 255;\r\n            t = targetArr[(y - 1) * width + x] !== 255;\r\n            tr = targetArr[(y - 1) * width + x + 1] !== 255;\r\n            r = targetArr[(y) * width + x + 1] !== 255;\r\n            br = targetArr[(y + 1) * width + x + 1] !== 255;\r\n            b = targetArr[(y + 1) * width + x] !== 255;\r\n            bl = targetArr[(y + 1) * width + x - 1] !== 255;\r\n\r\n            if (l) { // left\r\n                x0 = x - grow;\r\n            }\r\n            if (l && tl && t) { // top left\r\n                x0 = x - grow;\r\n                y0 = y - grow;\r\n            }\r\n            if (t) { // top\r\n                y0 = Math.min(y0, y - grow);\r\n            }\r\n            if (t && tr && r) { // top right\r\n                y0 = Math.min(y0, y - grow);\r\n                x1 = x + grow;\r\n            }\r\n            if (r) { // right\r\n                x1 = Math.max(x1, x + 1 * grow);\r\n            }\r\n            if (r && br && b) { // bottom right\r\n                x1 = Math.max(x1, x + 1 * grow);\r\n                y1 = Math.max(y1, y + 1 * grow);\r\n            }\r\n            if (b) { // bottom\r\n                y1 = Math.max(y1, y + 1 * grow);\r\n            }\r\n            if (b && bl && l) { // bottom left\r\n                x0 = Math.min(x0, x - 1 * grow);\r\n                y1 = Math.max(y1, y + 1 * grow);\r\n            }\r\n\r\n            if (!l && !tl && !t && !tr && !r && !br && !b && !bl) {\r\n                continue;\r\n            }\r\n\r\n            fillRect(\r\n                targetArr,\r\n                width,\r\n                Math.max(0, x0),\r\n                Math.max(0, y0),\r\n                Math.min(width - 1, x1),\r\n                Math.min(height - 1, y1)\r\n            );\r\n        }\r\n    }\r\n    for (let i = 0; i < width * height; i++) {\r\n        if (targetArr[i] === 254) {\r\n            targetArr[i] = 255;\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * Does flood fill, and returns that. an array - 0 not filled. 255 filled\r\n *\r\n * returns {\r\n *     data: Uint8Array\r\n * }\r\n *\r\n * @param rgbaArr Uint8Array rgba\r\n * @param width int\r\n * @param height int\r\n * @param x int\r\n * @param y int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n * @returns {{data: Uint8Array}}\r\n */\r\nexport function floodFillBits(rgbaArr, width, height, x, y, tolerance, grow, isContiguous) {\r\n    x = Math.round(x);\r\n    y = Math.round(y);\r\n\r\n    let resultArr = new Uint8Array(new ArrayBuffer(width * height));\r\n\r\n    floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\r\n\r\n    return {\r\n        data: resultArr\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IShapeToolObject} from '../kl.types';\r\n\r\n\r\n/**\r\n * Input processor for shape tool.\r\n * Coordinates are in canvas space.\r\n * angleRad is the angle of the canvas.\r\n *\r\n * @param p - {onShape: func(isDone, x1, y1, x2, y2, angleRad)}\r\n * @constructor\r\n */\r\nexport function ShapeTool(p) {\r\n\r\n    let downX, downY, downAngleRad;\r\n\r\n    this.onDown = function(x, y, angleRad) {\r\n        downX = x;\r\n        downY = y;\r\n        downAngleRad = angleRad;\r\n    };\r\n\r\n    this.onMove = function(x, y) {\r\n        p.onShape(false, downX, downY, x, y, downAngleRad);\r\n    };\r\n\r\n    this.onUp = function(x, y) {\r\n        p.onShape(true, downX, downY, x, y, downAngleRad);\r\n    };\r\n}\r\n\r\n/**\r\n * Draw a shape (rectangle, ellipse, line)\r\n *\r\n * @param ctx\r\n * @param shapeObj\r\n */\r\nexport function drawShape(\r\n    ctx: CanvasRenderingContext2D,\r\n    shapeObj: IShapeToolObject,\r\n) {\r\n\r\n    if (['rect', 'ellipse', 'line'].includes(shapeObj.type)) {\r\n        const lineWidth = Math.round(shapeObj.lineWidth);\r\n        const angleDeg = shapeObj.angleRad * 180 / Math.PI;\r\n\r\n        // --- prep canvas ---\r\n        ctx.save();\r\n        if (shapeObj.opacity) {\r\n            ctx.globalAlpha = shapeObj.opacity;\r\n        }\r\n        if (shapeObj.isEraser) {\r\n            ctx.globalCompositeOperation = 'destination-out';\r\n        }\r\n        ctx.rotate(-shapeObj.angleRad);\r\n        if (shapeObj.fillRgb) {\r\n            ctx.fillStyle = BB.ColorConverter.toRgbStr(shapeObj.fillRgb);\r\n        } else if (shapeObj.strokeRgb) {\r\n            ctx.strokeStyle = BB.ColorConverter.toRgbStr(shapeObj.strokeRgb);\r\n            ctx.lineWidth = lineWidth;\r\n        }\r\n\r\n        let x1 = shapeObj.x1;\r\n        let y1 = shapeObj.y1;\r\n        let x2 = shapeObj.x2;\r\n        let y2 = shapeObj.y2;\r\n\r\n        // --- angle snapping ---\r\n        if (shapeObj.isAngleSnap) {\r\n            let r1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            let r2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            let pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\r\n            let pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\r\n            let rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\r\n            x2 = rotated.x;\r\n            y2 = rotated.y;\r\n\r\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\r\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\r\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\r\n                    x2 = x1;\r\n                } else { // left or right\r\n                    y2 = y1;\r\n                }\r\n            }\r\n        }\r\n\r\n        let x = x1;\r\n        let y = y1;\r\n        let dX = x2 - x1;\r\n        let dY = y2 - y1;\r\n\r\n        // --- 1:1 ratio ---\r\n        if (shapeObj.type !== 'line' && shapeObj.isFixedRatio) {\r\n            let r1 = BB.rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\r\n            let r2 = BB.rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            let rx = r1.x;\r\n            let ry = r1.y;\r\n            let rdX = r2.x - r1.x;\r\n            let rdY = r2.y - r1.y;\r\n\r\n            if (Math.abs(rdX) < Math.abs(rdY)) {\r\n                rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\r\n            } else {\r\n                rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\r\n            }\r\n            r2.x = rx + rdX;\r\n            r2.y = ry + rdY;\r\n\r\n            r1 = BB.rotate(r1.x, r1.y, -shapeObj.angleRad / Math.PI * 180);\r\n            r2 = BB.rotate(r2.x, r2.y, -shapeObj.angleRad / Math.PI * 180);\r\n\r\n            x1 = r1.x;\r\n            y1 = r1.y;\r\n            x2 = r2.x;\r\n            y2 = r2.y;\r\n\r\n            x = x1;\r\n            y = y1;\r\n            dX = x2 - x1;\r\n            dY = y2 - y1;\r\n        }\r\n\r\n        // outwards modifier\r\n        if (shapeObj.isOutwards) {\r\n            x -= dX;\r\n            y -= dY;\r\n            dX *= 2;\r\n            dY *= 2;\r\n\r\n            x1 = x;\r\n            y1 = y;\r\n            x2 = x + dX;\r\n            y2 = y + dY;\r\n        }\r\n\r\n        let p1;\r\n        let p2;\r\n        if (shapeObj.type === 'line') { // --- line ---\r\n\r\n            // rounded\r\n            const x1r = Math.round(x1);\r\n            const y1r = Math.round(y1);\r\n            const x2r = Math.round(x2);\r\n            const y2r = Math.round(y2);\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (lineWidth % 2 === 0) {\r\n\r\n                if (y1r === y2r) {\r\n                    p1 = {\r\n                        x: x1f,\r\n                        y: y1r,\r\n                    };\r\n                    p2 = {\r\n                        x: x2f,\r\n                        y: y2r,\r\n                    };\r\n\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                } else if (x1r === x2r) {\r\n                    p1 = {\r\n                        x: x1r,\r\n                        y: y1f,\r\n                    };\r\n                    p2 = {\r\n                        x: x2r,\r\n                        y: y2f,\r\n                    };\r\n\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                } else {\r\n                    p1 = {\r\n                        x: x1,\r\n                        y: y1,\r\n                    };\r\n                    p2 = {\r\n                        x: x2,\r\n                        y: y2,\r\n                    };\r\n                }\r\n\r\n            } else {\r\n                p1 = {\r\n                    x: x1f,\r\n                    y: y1f,\r\n                };\r\n                p2 = {\r\n                    x: x2f,\r\n                    y: y2f,\r\n                };\r\n                if (y1f === y2f) {\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                    p1.y += 0.5;\r\n                    p2.y += 0.5;\r\n                } else if (x1f === x2f) {\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                    p1.x += 0.5;\r\n                    p2.x += 0.5;\r\n                } else {\r\n                    p1.x = x1;\r\n                    p1.y = y1;\r\n                    p2.x = x2;\r\n                    p2.y = y2;\r\n                }\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            ctx.beginPath();\r\n            ctx.moveTo(p1.x, p1.y);\r\n            ctx.lineTo(p2.x, p2.y);\r\n            ctx.stroke();\r\n\r\n        } else if (shapeObj.type === 'rect') { // --- rect ---\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (angleDeg % 90 === 0) {\r\n                if (shapeObj.fillRgb) {\r\n                    if (x1 % 1 === 0) {\r\n                        x1 += 1;\r\n                    }\r\n                    if (y1 % 1 === 0) {\r\n                        y1 += 1;\r\n                    }\r\n                    if (x2 % 1 === 0) {\r\n                        x2 += 1;\r\n                    }\r\n                    if (y2 % 1 === 0) {\r\n                        y2 += 1;\r\n                    }\r\n\r\n                    p1 = {\r\n                        x: x1 < x2 ? x1f : x2f,\r\n                        y: y1 < y2 ? y1f : y2f,\r\n                    };\r\n                    p2 = {\r\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\r\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y),\r\n                    };\r\n                    p2.x = p1.x + p2.x;\r\n                    p2.y = p1.y + p2.y;\r\n\r\n                } else {\r\n                    if (lineWidth % 2 === 0) {\r\n                        p1 = {\r\n                            x: x1f,\r\n                            y: y1f,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f,\r\n                            y: y2f,\r\n                        };\r\n                    } else {\r\n                        p1 = {\r\n                            x: x1f + 0.5,\r\n                            y: y1f + 0.5,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f + 0.5,\r\n                            y: y2f + 0.5,\r\n                        };\r\n                    }\r\n                }\r\n            } else {\r\n                p1 = {\r\n                    x: x1,\r\n                    y: y1,\r\n                };\r\n                p2 = {\r\n                    x: x2,\r\n                    y: y2,\r\n                };\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2.x = p2.x - p1.x;\r\n            p2.y = p2.y - p1.y;\r\n\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\r\n            } else {\r\n                ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\r\n            }\r\n\r\n        } else {  // --- circle ---\r\n            p1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n            x = p1.x;\r\n            y = p1.y;\r\n            dX = p2.x - p1.x;\r\n            dY = p2.y - p1.y;\r\n\r\n            ctx.beginPath();\r\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fill();\r\n            } else {\r\n                ctx.stroke();\r\n            }\r\n        }\r\n\r\n\r\n        ctx.restore();\r\n\r\n    } else {\r\n        throw new Error('unknown shape');\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {IRect} from '../../bb/bb.types';\r\n\r\nexport interface IRenderTextParam {\r\n    textStr: string; // text to be drawn. can contain newlines\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\r\n    align: 'left' | 'center' | 'right'; // default 'left'\r\n    isBold: boolean; // default false\r\n    isItalic: boolean; // default false\r\n    angleRad: number; // default 0 - rotates around x y\r\n    lineHeight?: number; // pixels\r\n    color: string;\r\n    isDebug?: boolean;\r\n}\r\n\r\n\r\n/**\r\n * Draw text on a canvas.\r\n *\r\n * @param canvas\r\n * @param p\r\n * @returns - bounds. coords relative to p.x p.y\r\n */\r\nexport function renderText(canvas: HTMLCanvasElement, p: IRenderTextParam): IRect {\r\n\r\n    // always at least a space. so bounds aren't just a dot\r\n    let textStr = p.textStr === '' ? ' ' : p.textStr;\r\n\r\n    // --- create el ---\r\n    // create an actual dom element. figure out where exactly each letter is positioned.\r\n    // that way multiline is feasible. canvas can't do multiline or text-align\r\n    let outer = BB.el({\r\n        css: {\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            width: '100000px',\r\n            fontSize: p.size + 'px',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n        }\r\n    });\r\n    let div = BB.el({\r\n        parent: outer,\r\n        css: {\r\n            display: 'inline-block',\r\n            textAlign: p.align ? p.align : 'left',\r\n            fontFamily: p.font ? p.font : 'sans-serif',\r\n            fontSize: p.size + 'px',\r\n            fontWeight: p.isBold ? 'bold' : 'normal',\r\n            fontStyle: p.isItalic ? 'italic' : 'normal',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n\r\n\r\n            opacity: '0',\r\n            pointerEvents: 'none'\r\n        }\r\n    });\r\n    let spanStr = '';\r\n    let replaceObj = {\r\n        \"\\n\": '<br>',\r\n        \" \": '&nbsp;',\r\n        \"\t\": '&nbsp;&nbsp;&nbsp;&nbsp;',\r\n    };\r\n    for (let i = 0; i < textStr.length; i++) {\r\n        if (textStr[i] === \"\\n\") {\r\n            div.appendChild(BB.el({\r\n                tagName: 'span',\r\n                textContent: spanStr,\r\n                css: {\r\n                    whiteSpace: 'pre'\r\n                }\r\n            }));\r\n            spanStr = '';\r\n            div.appendChild(BB.el({\r\n                tagName: 'br'\r\n            }));\r\n            continue;\r\n        }\r\n        spanStr += textStr[i].replace(\"\\t\", '    ');\r\n    }\r\n    div.appendChild(BB.el({\r\n        tagName: 'span',\r\n        textContent: spanStr,\r\n        css: {\r\n            whiteSpace: 'pre'\r\n        }\r\n    }));\r\n    document.body.appendChild(outer);\r\n\r\n\r\n    // --- determine bounds ---\r\n    let bounds = {\r\n        x0: 99999999,\r\n        y0: 99999999,\r\n        x1: 0,\r\n        y1: 0\r\n    }\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        let el = div.children[i] as HTMLElement;\r\n        bounds.x0 = Math.min(bounds.x0, el.offsetLeft);\r\n        bounds.y0 = Math.min(bounds.y0, el.offsetTop);\r\n        bounds.x1 = Math.max(bounds.x1, el.offsetLeft + el.offsetWidth);\r\n        bounds.y1 = Math.max(bounds.y1, el.offsetTop + el.offsetHeight);\r\n    }\r\n\r\n    // --- draw ---\r\n    let ctx = canvas.getContext('2d');\r\n    ctx.save();\r\n\r\n    let font = [];\r\n    if (p.isItalic) {\r\n        font.push('italic');\r\n    }\r\n    if (p.isBold) {\r\n        font.push('bold');\r\n    }\r\n    font.push(p.size + 'px ' + (p.font ? p.font : 'sans-serif'));\r\n    ctx.font = font.join(' ');\r\n    ctx.fillStyle = p.color ? p.color : '#000';\r\n\r\n    let x = p.x;\r\n    let y = p.y;\r\n    if (p.align === 'right') {\r\n        x += -bounds.x1 + bounds.x0;\r\n    }\r\n    if (p.align === 'center') {\r\n        x += (-bounds.x1 + bounds.x0) / 2;\r\n    }\r\n    ctx.translate(p.x, p.y);\r\n    ctx.rotate(p.angleRad ? -p.angleRad : 0);\r\n    ctx.translate(-p.x, -p.y);\r\n    ctx.translate(x, y);\r\n\r\n    // fill\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        let el = div.children[i] as HTMLElement;\r\n\r\n        //ctx.fillText(el.innerText, 0, 0);\r\n        ctx.fillText(el.innerText, el.offsetLeft, el.offsetTop);\r\n    }\r\n\r\n    if (p.isDebug) {\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeRect(0, -p.size * 0.85, bounds.x1, bounds.y1);\r\n        ctx.restore();\r\n        ctx.fillRect(p.x - 1, p.y - 1, 2, 2);\r\n    } else {\r\n        ctx.restore();\r\n    }\r\n\r\n    document.body.removeChild(outer);\r\n\r\n    return {\r\n        x: x - p.x,\r\n        y: y - p.y -p.size * 0.85,\r\n        width: bounds.x1 - bounds.x0,\r\n        height: bounds.y1 - bounds.y0\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IKlProject} from '../kl.types';\r\n\r\nexport function drawProject(project: IKlProject, factor) {\r\n    let resultCanvas = BB.canvas(\r\n        Math.max(1, Math.round(project.width * factor)),\r\n        Math.max(1, Math.round(project.height * factor))\r\n    );\r\n    let ctx = resultCanvas.getContext(\"2d\");\r\n    ctx.save();\r\n    if (factor > 1) {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n    for (let i = 0; i < project.layers.length; i++) {\r\n        if (project.layers[i].opacity === 0) {\r\n            continue;\r\n        }\r\n        ctx.globalAlpha = project.layers[i].opacity;\r\n        ctx.globalCompositeOperation = project.layers[i].mixModeStr ? project.layers[i].mixModeStr : 'source-over';\r\n        ctx.drawImage(project.layers[i].image, 0, 0, resultCanvas.width, resultCanvas.height);\r\n    }\r\n    ctx.restore();\r\n    return resultCanvas;\r\n}","import {IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {TTranslationCode} from '../../../languages/languages';\r\n\r\nexport function translateBlending(blendMode?: IMixMode): string {\r\n    if (!blendMode) {\r\n        return LANG('layers-blend-normal');\r\n    }\r\n\r\n    const codes: {\r\n        [key: string]: TTranslationCode\r\n    } = {\r\n        'source-over': 'layers-blend-normal',\r\n        'darken': 'layers-blend-darken',\r\n        'multiply': 'layers-blend-multiply',\r\n        'color-burn': 'layers-blend-color-burn',\r\n        'lighten': 'layers-blend-lighten',\r\n        'screen': 'layers-blend-screen',\r\n        'color-dodge': 'layers-blend-color-dodge',\r\n        'overlay': 'layers-blend-overlay',\r\n        'soft-light': 'layers-blend-soft-light',\r\n        'hard-light': 'layers-blend-hard-light',\r\n        'difference': 'layers-blend-difference',\r\n        'exclusion': 'layers-blend-exclusion',\r\n        'hue': 'layers-blend-hue',\r\n        'saturation': 'layers-blend-saturation',\r\n        'color': 'layers-blend-color',\r\n        'luminosity': 'layers-blend-luminosity',\r\n    };\r\n\r\n    if (!(blendMode in codes)) {\r\n        throw new Error('unknown blend mode');\r\n    }\r\n    return LANG(codes[blendMode]);\r\n}","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl.types';\r\n\r\n/**\r\n * Overlay for KlCanvasWorkspace.\r\n * - brush circle\r\n * - eyedropper circle\r\n * - compass needle (rotation hud)\r\n */\r\nexport class WorkspaceSvgOverlay {\r\n    private rootElement: SVGElement;\r\n    private brushCircleOuter: SVGElement;\r\n    private brushCircleInner: SVGElement;\r\n    private pickerPreviewBorder: SVGElement;\r\n    private pickerPreviewCol: SVGElement;\r\n    private readonly compassSize: number;\r\n    private compass: SVGElement;\r\n    private compassInner: SVGElement;\r\n    private compassBaseCircle: SVGElement;\r\n    private compassLineCircle: SVGElement;\r\n    private compassUpperTriangle: SVGElement;\r\n    private compassLowerTriangle: SVGElement;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n        }\r\n    ) {\r\n        this.rootElement = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + p.width,\r\n            height: '' + p.height,\r\n        });\r\n        BB.css(this.rootElement, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            pointerEvents: 'none',\r\n            userSelect: 'none'\r\n        });\r\n\r\n        //brush circles\r\n        this.brushCircleOuter = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '10',\r\n            stroke: 'rgba(0,0,0,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.brushCircleInner = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '9',\r\n            stroke: 'rgba(255,255,255,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\r\n\r\n        //color picker preview circle\r\n        this.pickerPreviewBorder = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '22',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewBorder.style.opacity = '0';\r\n        this.pickerPreviewCol = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '20',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewCol.style.opacity = '0';\r\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\r\n\r\n\r\n        //rotation compass\r\n        this.compassSize = 30;\r\n        this.compass = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'translate(' + (p.width/2) + ', ' + (p.height/2) + ')',\r\n        });\r\n        BB.css(this.compass, {\r\n            transition: 'opacity 0.25s ease-in-out',\r\n            opacity: '0',\r\n        });\r\n        this.compassInner = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'rotate(45)',\r\n        });\r\n        this.compassBaseCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'rgba(0,0,0,0.9)',\r\n            stroke: 'none',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + this.compassSize,\r\n        });\r\n        this.compassLineCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'none',\r\n            stroke: 'rgba(255,255,255,0.75)',\r\n            'stroke-width': '1',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + (this.compassSize * 0.9),\r\n        });\r\n        this.compassUpperTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#f00',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,-'+(this.compassSize * 0.9)+' z',\r\n        });\r\n        this.compassLowerTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#fff',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,'+(this.compassSize * 0.9)+' z',\r\n        });\r\n\r\n        this.compassInner.append(\r\n            this.compassBaseCircle,\r\n            this.compassLineCircle,\r\n            this.compassUpperTriangle,\r\n            this.compassLowerTriangle\r\n        );\r\n        this.compass.append(this.compassInner);\r\n        this.rootElement.append(this.compass);\r\n    }\r\n\r\n    getElement (): SVGElement {\r\n        return this.rootElement;\r\n    }\r\n\r\n    setSize (width: number, height: number): void {\r\n        this.rootElement.setAttribute('width', '' + width);\r\n        this.rootElement.setAttribute('height', '' + height);\r\n        this.compass.setAttribute('transform', 'translate(' + (width/2) + ', ' + (height/2) + ')');\r\n    }\r\n\r\n    updateCursor (p: {\r\n        x?: number;\r\n        y?: number;\r\n        radius?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if ('x' in p) {\r\n            this.brushCircleOuter.setAttribute('cx', '' + p.x);\r\n            this.brushCircleInner.setAttribute('cx', '' + p.x);\r\n        }\r\n        if ('y' in p) {\r\n            this.brushCircleOuter.setAttribute('cy', '' + p.y);\r\n            this.brushCircleInner.setAttribute('cy', '' + p.y);\r\n        }\r\n        if ('radius' in p) {\r\n            this.brushCircleOuter.setAttribute('r', '' + Math.max(0, p.radius));\r\n            this.brushCircleInner.setAttribute('r', '' + Math.max(0, p.radius - 1));\r\n        }\r\n        if ('isVisible' in p) {\r\n            this.brushCircleOuter.style.opacity = p.isVisible ? '1' : '0';\r\n            this.brushCircleInner.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateColorPreview (p: {\r\n        x?: number;\r\n        y?: number;\r\n        color?: IRGB;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if ('x' in p) {\r\n            this.pickerPreviewCol.setAttribute('cx', '' + p.x);\r\n            this.pickerPreviewBorder.setAttribute('cx', '' + p.x);\r\n        }\r\n        if ('y' in p) {\r\n            this.pickerPreviewCol.setAttribute('cy', '' + p.y);\r\n            this.pickerPreviewBorder.setAttribute('cy', '' + p.y);\r\n        }\r\n        if ('color' in p) {\r\n            this.pickerPreviewCol.setAttribute('stroke', BB.ColorConverter.toRgbStr(p.color));\r\n            let borderColor = BB.testIsWhiteBestContrast(p.color) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\r\n            this.pickerPreviewBorder.setAttribute('stroke', borderColor);\r\n        }\r\n        if ('isVisible' in p) {\r\n            this.pickerPreviewCol.style.opacity = p.isVisible ? '1' : '0';\r\n            this.pickerPreviewBorder.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateCompass (p: {\r\n        angleDeg?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if ('angleDeg' in p) {\r\n            this.compassInner.setAttribute('transform', 'rotate(' + p.angleDeg + ')');\r\n            this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? '1' : '0';\r\n        }\r\n        if ('isVisible' in p) {\r\n            this.compass.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB, ITransform} from '../kl.types';\r\nimport {WorkspaceSvgOverlay} from './workspace-svg-overlay';\r\nimport {klHistory} from '../history/kl-history';\r\n// @ts-ignore\r\nimport pickerImg from 'url:~/src/app/img/ui/cursor-picker.png';\r\n// @ts-ignore\r\nimport zoomEwImg from 'url:~/src/app/img/ui/cursor-zoom-ew.png';\r\n// @ts-ignore\r\nimport fillImg from 'url:~/src/app/img/ui/cursor-fill.png';\r\n// @ts-ignore\r\nimport textImg from 'url:~/src/app/img/ui/cursor-text.png';\r\nimport {IPressureInput, IVector2D} from '../../bb/bb.types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {KeyListener} from '../../bb/input/key-listener';\r\nimport {KL} from '../kl';\r\n\r\nexport interface IViewChangeEvent {\r\n    changed: ('scale' | 'angle')[];\r\n    angle: number;\r\n    scale: number;\r\n}\r\n\r\ntype TModeStr = 'draw' | 'pick' | 'hand' | 'shape' | 'fill' | 'text'; // | 'transform' | 'select'\r\n\r\nconst MIN_SCALE = 1 / 16;\r\nconst MAX_SCALE = 64;\r\nenum TMode {\r\n    Draw,\r\n    Hand,\r\n    HandGrabbing,\r\n    Pick,\r\n    Zoom,\r\n    Rotate,\r\n    Rotating,\r\n    Fill,\r\n    Text,\r\n    Shape,\r\n}\r\nconst ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\r\n\r\n/**\r\n * Work area that displays the KlCanvas.\r\n * - pan, zoom, rotate (also via multi-touch)\r\n * - input modes: drawing, hand, pick, fill, text // transform, select\r\n * - drawing input events\r\n * - view change events\r\n * - eyedropper input events (pick)\r\n * - draws cursor, eyedropper overlay\r\n *\r\n * subscribes to klCanvas changes\r\n * listens to kl history for changes\r\n * and you can manually trigger redraw\r\n */\r\nexport class KlCanvasWorkspace {\r\n\r\n    private rootEl: HTMLElement;\r\n    private klCanvas: KlCanvas;\r\n    private renderTargetCanvas: HTMLCanvasElement;\r\n    private renderTargetCtx: CanvasRenderingContext2D;\r\n    private renderWidth: number;\r\n    private renderHeight: number;\r\n    private compositeCanvas: HTMLCanvasElement; // for drawing klcanvas layer composite\r\n    private compositeCtx: CanvasRenderingContext2D;\r\n    private doResizeCanvas: boolean;\r\n    private oldTransformObj: ITransform;\r\n    private targetTransformObj: ITransform; // animation target\r\n    private highResTransformObj: ITransform; // animated, internal high res\r\n    private renderedTransformObj: ITransform; // same as highRes, but rounded - what's actually displayed\r\n    private cursorPos: IVector2D;\r\n    private usesCssCursor: boolean;\r\n    private bgVisible: boolean;\r\n    private transformIsDirty: boolean;\r\n    private doAnimateTranslate: boolean;\r\n    private svgOverlay: WorkspaceSvgOverlay;\r\n    private emptyCanvas: HTMLCanvasElement;\r\n    private keyListener: KeyListener;\r\n    private currentMode: TMode;\r\n    private globalMode: TMode;\r\n    private renderTime: number; // for debugging - average ms per render()\r\n    private lastDrawEvent: IPressureInput | null; // previous drawing input\r\n    private linetoolProcessor: any; // todo type - BB.EventChain.LinetoolProcessor\r\n    private pointer: IVector2D | null; // position of cursor\r\n    private isDrawing: boolean;\r\n    private inputProcessorObj: any; // todo type\r\n    private currentInputProcessor: any; // todo type\r\n    private angleIsExtraSticky: boolean;\r\n    private pinchZoomer: any; // todo type - BB.EventChain.PinchZoomer\r\n    private mainDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\r\n    private middleDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\r\n    private twoFingerTap: any; // todo type - BB.EventChain.NFingerTapper\r\n    private threeFingerTap: any; // todo type - BB.EventChain.NFingerTapper\r\n    private pointerEventChain: any; // todo type - BB.EventChain.EventChain\r\n    private pointerListener: any; // todo type - BB.PointerListener\r\n    private brushRadius: number;\r\n    private animationFrameRequested: boolean;\r\n    private lastRenderedState: number; // KlHistory state - to detect if there are changes to draw\r\n    private lastRenderTime: number; // ms from performance.now()\r\n    private hideBrushCursorTimeout: number;\r\n    private onViewChange: (e:  IViewChangeEvent) => void;\r\n\r\n    private getRenderedTransform (): ITransform {\r\n        // rounded x & y so canvas is less blurry.\r\n        const result = this.renderedTransformObj;\r\n        result.x = this.highResTransformObj.x;\r\n        result.y = this.highResTransformObj.y;\r\n        result.scale = this.highResTransformObj.scale;\r\n        result.angle = this.highResTransformObj.angle;\r\n\r\n        if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\r\n            result.x = Math.round(result.x);\r\n            result.y = Math.round(result.y);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private updateChangeListener (): void {\r\n        this.klCanvas.addChangeListener(() => {\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n        });\r\n    }\r\n\r\n    private updateCursor (modeInt: TMode, doForce?: boolean): void {\r\n        if (modeInt === this.currentMode && !doForce) {\r\n            return;\r\n        }\r\n        const oldMode = this.currentMode;\r\n        this.currentMode = modeInt;\r\n        this.lastRenderedState = -1;\r\n        if (this.currentMode === TMode.Draw) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        } else if (this.currentMode === TMode.Hand) {\r\n            this.rootEl.style.cursor = 'grab';\r\n        } else if (this.currentMode === TMode.HandGrabbing) {\r\n            this.rootEl.style.cursor = 'grabbing';\r\n        } else if (this.currentMode === TMode.Pick) {\r\n            this.rootEl.style.cursor = \"url('\" + pickerImg + \"') 0 15, crosshair\";\r\n        } else if (this.currentMode === TMode.Zoom) {\r\n            this.rootEl.style.cursor = \"url('\" + zoomEwImg + \"') 7 7, zoom-in\";\r\n        } else if (this.currentMode === TMode.Rotate) {\r\n            this.rootEl.style.cursor = \"grab\";\r\n        } else if (this.currentMode === TMode.Rotating) {\r\n            this.rootEl.style.cursor = \"grabbing\";\r\n        } else if (this.currentMode === TMode.Fill) {\r\n            this.rootEl.style.cursor = \"url('\" + fillImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Text) {\r\n            this.rootEl.style.cursor = \"url('\" + textImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Shape) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        }\r\n\r\n        if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode)) {\r\n            const oldIsHand = [TMode.Hand, TMode.HandGrabbing].includes(oldMode);\r\n            const currentIsHand = [TMode.Hand, TMode.HandGrabbing].includes(this.currentMode);\r\n            if (!oldIsHand && currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n            }\r\n            if (oldIsHand && !currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n            }\r\n        }\r\n\r\n        if (this.currentMode !== TMode.Pick) {\r\n            this.svgOverlay.updateColorPreview({isVisible: false});\r\n        }\r\n    }\r\n\r\n    /**\r\n     * returns false if no change of zoom\r\n     * @param stepNum\r\n     * @param centerX\r\n     * @param centerY\r\n     * @private\r\n     */\r\n    private internalZoomByStep (stepNum: number, centerX: number, centerY: number): boolean {\r\n        const step = Math.log2(this.targetTransformObj.scale);\r\n\r\n        let newStep = step / Math.abs(stepNum);\r\n        newStep += stepNum > 0 ? 1 : -1;\r\n        newStep = Math.round(newStep);\r\n        newStep *= Math.abs(stepNum);\r\n        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, Math.pow(2, newStep)));\r\n\r\n        //has zoomed?\r\n        if (newScale === this.targetTransformObj.scale) {\r\n            return false;\r\n        }\r\n\r\n\r\n        const effectiveFactor = newScale / this.targetTransformObj.scale;\r\n        this.targetTransformObj.scale = newScale;\r\n\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerX, centerY));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerX, -centerY));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.transformIsDirty = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * mixes two transform objects. modifies A\r\n     * @param transformA\r\n     * @param transformB\r\n     * @param blendFactor 0 -> A, 1 -> B\r\n     * @private\r\n     */\r\n    private mixTransformObj (transformA: ITransform, transformB: ITransform, blendFactor: number): void {\r\n        if (transformA.angle === transformB.angle) {\r\n            transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n            transformA.x = BB.mix(transformA.x, transformB.x, blendFactor);\r\n            transformA.y = BB.mix(transformA.y, transformB.y, blendFactor);\r\n            transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n            return;\r\n        }\r\n\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        // --- determine centerPosA, centerPosB ---\r\n        const centerPosA = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2\r\n        }, transformA);\r\n        const centerPosB = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2\r\n        }, transformB);\r\n\r\n        // --- centerPosMixed ---\r\n        transformA.x = BB.mix(centerPosA.x , centerPosB.x, blendFactor);\r\n        transformA.y = BB.mix(centerPosA.y , centerPosB.y, blendFactor);\r\n\r\n        // --- scale and angle ---\r\n        transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n        transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n\r\n        // --- x and y ---\r\n        const mixedPos = this.canvasToWorkspaceCoord({\r\n            x: -w / 2,\r\n            y: -h / 2\r\n        }, transformA);\r\n        transformA.x = mixedPos.x;\r\n        transformA.y = mixedPos.y;\r\n    }\r\n\r\n    private render (): void {\r\n        if (this.doResizeCanvas) {\r\n            this.doResizeCanvas = false;\r\n            this.renderTargetCanvas.width = this.renderWidth;\r\n            this.renderTargetCanvas.height = this.renderHeight;\r\n        }\r\n        this.renderContext(this.renderTargetCtx);\r\n    }\r\n\r\n    /**\r\n     * is the gray background that surrounds canvas visible?\r\n     * @private\r\n     */\r\n    private testBgVisible (): boolean {\r\n        //bring workspace points (corners of workspace) into canvas coordinate system\r\n        //then check if any corner point is outside of the canvas -> that means the bg is visible\r\n\r\n        const workspacePointArr = [\r\n            [0, 0], // top left\r\n            [this.renderWidth, 0], // top right\r\n            [this.renderWidth, this.renderHeight], // bottom right\r\n            [0, this.renderHeight], // bottom left\r\n        ];\r\n\r\n        const art = this.getRenderedTransform();\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        //transform points, then test if outside of canvas\r\n        for (let i = 0; i < workspacePointArr.length; i++) {\r\n            let coords = [workspacePointArr[i][0], workspacePointArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n            if (\r\n                !(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() &&\r\n                    0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())\r\n            ){\r\n                //if not inside -> bg visible\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private renderContext (ctx: CanvasRenderingContext2D): void {\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        const art = this.getRenderedTransform();\r\n\r\n        if (art.scale >= 4 || (art.scale === 1 && art.angle === 0)) {\r\n            ctx.imageSmoothingEnabled = false;\r\n        } else {\r\n            ctx.imageSmoothingEnabled = true;\r\n            ctx.imageSmoothingQuality  = 'low'; // art.scale >= 1 ? 'low' : 'medium';\r\n        }\r\n        //ctx.imageSmoothingEnabled = false;\r\n        //renderTargetCtx.globalCompositeOperation  = 'multiply';\r\n\r\n\r\n\r\n        ctx.save();\r\n        {\r\n            if (this.bgVisible) {\r\n                ctx.fillStyle = 'rgb(158,158,158)'; // 'rgb(185,185,185)';\r\n                ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\r\n            } else {\r\n                ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\r\n            }\r\n\r\n\r\n\r\n            if (this.bgVisible) {\r\n                ctx.save();\r\n\r\n                ctx.translate(art.x, art.y);\r\n                ctx.scale(art.scale, art.scale);\r\n                ctx.rotate(art.angle);\r\n\r\n                ctx.imageSmoothingEnabled = false;\r\n\r\n                //outline\r\n                const borderSize = 1;\r\n                ctx.globalAlpha = 0.2;\r\n                ctx.drawImage(\r\n                    this.emptyCanvas,\r\n                    -borderSize / art.scale,\r\n                    -borderSize / art.scale,\r\n                    w + borderSize * 2 / art.scale,\r\n                    h + borderSize * 2 / art.scale\r\n                );\r\n                ctx.globalAlpha = 1;\r\n\r\n                //erase\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n                ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\r\n\r\n                ctx.restore();\r\n            }\r\n\r\n            /*const region = new Path2D();\r\n            region.rect(80, 10, 20, 130);\r\n            ctx.clip(region);*/\r\n\r\n            ctx.translate(art.x, art.y);\r\n            ctx.scale(art.scale, art.scale);\r\n            ctx.rotate(art.angle);\r\n\r\n            const layerArr = this.klCanvas.getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    ctx.globalAlpha = layerArr[i].opacity;\r\n                    ctx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n\r\n                    if (layerArr[i].canvas.compositeObj) {\r\n                        if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\r\n                            this.compositeCanvas.width = layerArr[i].canvas.width;\r\n                            this.compositeCanvas.height = layerArr[i].canvas.height;\r\n                        } else {\r\n                            this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\r\n                        }\r\n                        this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\r\n                        layerArr[i].canvas.compositeObj.draw(this.compositeCtx);\r\n                        ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\r\n                    } else {\r\n                        ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\r\n                    }\r\n                }\r\n            }\r\n            ctx.globalAlpha = 1;\r\n\r\n\r\n\r\n        }\r\n        ctx.restore();\r\n\r\n        // rotation hud\r\n        if (TMode.Rotate === this.currentMode || TMode.Rotating === this.currentMode) {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: true,\r\n                angleDeg: art.angle / Math.PI * 180\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: false\r\n            });\r\n        }\r\n    }\r\n\r\n    private workspaceToCanvasCoord (p: IVector2D): IVector2D {\r\n        const art = this.getRenderedTransform();\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private canvasToWorkspaceCoord (p: IVector2D, transformObj: ITransform): IVector2D {\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(transformObj.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(transformObj.scale));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private snapAngleRad (angleRad: number, snapDegIncrement: number, maxDistDeg: number): number {\r\n        let angleDeg = angleRad * 180 / Math.PI;\r\n        const modDeg = Math.abs(angleDeg % snapDegIncrement);\r\n        const dist = Math.min(modDeg, snapDegIncrement - modDeg);\r\n\r\n        if (dist <= maxDistDeg) {\r\n            angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\r\n        }\r\n\r\n        return angleDeg / 180 * Math.PI;\r\n    }\r\n\r\n    /**\r\n     * angle always in range [-PI, PI]\r\n     * @param angleRad\r\n     * @private\r\n     */\r\n    private minimizeAngleRad (angleRad: number): number {\r\n        angleRad = angleRad % (2 * Math.PI);\r\n        if (angleRad > Math.PI) {\r\n            angleRad -= 2 * Math.PI;\r\n        } else if (angleRad < -Math.PI) {\r\n            angleRad += 2 * Math.PI;\r\n        }\r\n        return angleRad;\r\n    }\r\n\r\n    private resetInputProcessor (): void {\r\n        this.currentInputProcessor = null;\r\n        this.updateCursor(this.globalMode);\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    private reqFrame (doRedrawCanvas?: boolean): void {\r\n        this.animationFrameRequested = true;\r\n        if (doRedrawCanvas) {\r\n            this.lastRenderedState = -1;\r\n        }\r\n    }\r\n\r\n    private updateLoop (): void {\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState;\r\n\r\n        //handle variable framerate\r\n        const nowTime = performance.now();\r\n        const elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\r\n        this.lastRenderTime = nowTime;\r\n\r\n        if (this.animationFrameRequested || doRender) {\r\n            this.animationFrameRequested = false;\r\n            this.checkChange(elapsedFrames);\r\n        }\r\n    }\r\n\r\n    private checkChange (elapsedFrames: number): void {\r\n\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState ||\r\n            this.highResTransformObj.scale !== this.targetTransformObj.scale ||\r\n            this.highResTransformObj.x !== this.targetTransformObj.x ||\r\n            this.highResTransformObj.y !== this.targetTransformObj.y;\r\n\r\n        //update transform\r\n        if (\r\n            !this.doAnimateTranslate &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else if (\r\n            (this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) &&\r\n            (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            this. doAnimateTranslate = false;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else {\r\n            this.reqFrame(); //probably needs another frame\r\n            const blendFactor = Math.min(1, ANIMATION_SPEED * elapsedFrames);\r\n            this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\r\n            this.bgVisible = true; // spare yourself the calculation\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        }\r\n\r\n        if (this.pointer && this.currentMode == TMode.Draw && !this.usesCssCursor) {\r\n            this.svgOverlay.updateCursor({\r\n                x: this.pointer.x,\r\n                y: this.pointer.y,\r\n                isVisible: true\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCursor({isVisible: false});\r\n        }\r\n\r\n\r\n        if (doRender) {\r\n            //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\r\n            this.lastRenderedState = newState;\r\n            const start = performance.now();\r\n            this.render();\r\n            this.renderTime = BB.mix(this.renderTime, performance.now() - start, 0.05);\r\n        }\r\n        //setTimeout(this.checkChange, 100);\r\n\r\n\r\n\r\n        if (doRender) {\r\n\r\n            //console.log('rendertime ms: ', this.renderTime);\r\n        }\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            klCanvas: any; // todo\r\n            width: number;\r\n            height: number;\r\n            onDraw: (val) => void; // todo\r\n            onPick: (rgb: IRGB, isPointerup: boolean) => void;\r\n            onFill: (canvasX: number, canvasY: number) => void;\r\n            onText: (canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onShape: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onViewChange: (e:  IViewChangeEvent) => void;\r\n            onUndo: () => void;\r\n            onRedo: () => void;\r\n        }\r\n    ) {\r\n        const _this = this;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                right: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                cursor: 'crosshair',\r\n                userSelect: 'none',\r\n                colorScheme: 'only light',\r\n            }\r\n        });\r\n        this.klCanvas = p.klCanvas;\r\n        this.onViewChange = p.onViewChange;\r\n        this.renderTargetCanvas = BB.canvas(p.width, p.height);\r\n        this.renderTargetCtx = this.renderTargetCanvas.getContext('2d');\r\n        this.renderWidth = p.width;\r\n        this.renderHeight = p.height;\r\n        this.compositeCanvas = BB.canvas(1, 1); // for drawing klcanvas layer composite\r\n        this.compositeCtx = this.compositeCanvas.getContext('2d');\r\n        this.doResizeCanvas = false;\r\n        this.oldTransformObj = null;\r\n        this.targetTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0\r\n        };\r\n        this.highResTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0\r\n        };\r\n        this.renderedTransformObj = {\r\n            x: null,\r\n            y: null,\r\n            scale: null,\r\n            angle: null\r\n        };\r\n        this.cursorPos = {\r\n            x: 0,\r\n            y: 0\r\n        };\r\n        this.usesCssCursor = false;\r\n        this.bgVisible = true;\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n\r\n        this.svgOverlay = new WorkspaceSvgOverlay({\r\n            width: p.width,\r\n            height: p.height\r\n        });\r\n\r\n        BB.css(this.renderTargetCanvas, {\r\n            userSelect: 'none',\r\n            pointerEvents: 'none',\r\n        });\r\n        BB.createCheckerDataUrl(8, (url) => {\r\n            this.renderTargetCanvas.style.background = \"url(\" + url + \")\";\r\n        });\r\n        this.rootEl.appendChild(this.renderTargetCanvas);\r\n        this.rootEl.appendChild(this.svgOverlay.getElement());\r\n        BB.addEventListener(this.rootEl, 'touchend', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        BB.addEventListener(this.rootEl, 'contextmenu', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        BB.addEventListener(this.rootEl, 'dragstart', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n\r\n        this.emptyCanvas = BB.canvas(1, 1);\r\n        {\r\n            const ctx = this.emptyCanvas.getContext('2d');\r\n            ctx.fillRect(0, 0, 1, 1);\r\n        }\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n                if (isRepeat) {\r\n                    return;\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n\r\n                } else {\r\n\r\n                    if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'space') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.spaceHand;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ([TMode.Draw, TMode.Hand, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'alt') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.altPicker;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if (['r', 'shift+r'].includes(comboStr)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.rotate;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ('z' === comboStr) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.zoom;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                }\r\n\r\n            },\r\n            onUp: (keyStr, event, oldComboStr) => {\r\n                // prevent menu bar in Firefox\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.currentMode = TMode.Draw;\r\n        this.globalMode = TMode.Draw;\r\n\r\n        this.renderTime = 0;\r\n\r\n        this.lastDrawEvent = null;\r\n\r\n        this.linetoolProcessor = new BB.EventChain.LinetoolProcessor({\r\n            onDraw: (event) => {\r\n                const getMatrix = () => {\r\n                    const art = this.getRenderedTransform();\r\n                    let matrix = BB.Matrix.getIdentity();\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n                    return matrix;\r\n                };\r\n\r\n                if (event.type === 'line' && !this.lastDrawEvent) {\r\n                    const matrix = getMatrix();\r\n                    let coords = [event.x1, event.y1, 0, 1];\r\n                    coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                    this.lastDrawEvent = {\r\n                        x: coords[0],\r\n                        y: coords[1],\r\n                        pressure: event.pressure1\r\n                    };\r\n                    return;\r\n                }\r\n\r\n                if ('x' in event || 'x0' in event) {\r\n\r\n                    const matrix = getMatrix();\r\n\r\n                    if ('x' in event) { //down or move\r\n                        let coords = [event.x, event.y, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x = coords[0];\r\n                        event.y = coords[1];\r\n                    }\r\n                    if ('x0' in event) { //line\r\n                        event.x0 = this.lastDrawEvent.x;\r\n                        event.y0 = this.lastDrawEvent.y;\r\n                        event.pressure0 = this.lastDrawEvent.pressure;\r\n                        let coords = [event.x1, event.y1, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x1 = coords[0];\r\n                        event.y1 = coords[1];\r\n\r\n                        this.lastDrawEvent = {\r\n                            x: event.x1,\r\n                            y: event.y1,\r\n                            pressure: event.pressure1,\r\n                        };\r\n                    }\r\n                }\r\n\r\n\r\n                if (['down', 'move'].includes(event.type)) {\r\n                    this.lastDrawEvent = event;\r\n                }\r\n                p.onDraw(event);\r\n            }\r\n        });\r\n\r\n        this.pointer = null;\r\n        this.isDrawing = false;\r\n\r\n\r\n        this.inputProcessorObj = {\r\n            draw: {\r\n                onPointer: (val) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Draw);\r\n\r\n                    const comboStr = this.keyListener.getComboStr();\r\n\r\n                    const event: any = {\r\n                        scale: this.highResTransformObj.scale\r\n                    };\r\n                    event.shiftIsPressed = comboStr === 'shift';\r\n                    event.pressure = val.pressure;\r\n                    event.isCoalesced = !!val.isCoalesced;\r\n\r\n                    if (val.type === 'pointerdown') {\r\n\r\n                        this.isDrawing = true;\r\n                        event.type = 'down';\r\n\r\n                    } else if (val.button) {\r\n                        event.type = 'move';\r\n\r\n                    } else if (val.type === 'pointerup') {\r\n\r\n                        this.isDrawing = false;\r\n                        event.type = 'up';\r\n\r\n                        this.linetoolProcessor.process(event);\r\n                        this.resetInputProcessor();\r\n                        return;\r\n                    } else {\r\n                        return;\r\n                    }\r\n\r\n                    event.x = val.relX;\r\n                    event.y = val.relY;\r\n\r\n                    this.linetoolProcessor.process(event);\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            fill: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Fill);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            text: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Text);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            shape: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Shape);\r\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        this.isDrawing = true;\r\n                        p.onShape('down', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        p.onShape('move', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.isDrawing = false;\r\n                        p.onShape('up', coord.x, coord.y, this.renderedTransformObj.angle);\r\n                        this.resetInputProcessor();\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            hand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            spaceHand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'space') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                }\r\n            },\r\n            zoom: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Zoom);\r\n\r\n                    if (event.button === 'left' && !event.isCoalesced && event.dX != 0) {\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n\r\n                        this.internalZoomByStep(event.dX / 175, event.downPageX - offsetX, event.downPageY - offsetY);\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'z') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Zoom);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                }\r\n            },\r\n            picker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup'\r\n                        });\r\n\r\n                        if (event.type === 'pointerup') {\r\n                            this.resetInputProcessor();\r\n                        }\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            altPicker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup'\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'alt') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                }\r\n            },\r\n            rotate: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(event.button === 'left' ? TMode.Rotating : TMode.Rotate);\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                    } else if (event.button === 'left' && !event.isCoalesced && this.oldTransformObj) {\r\n\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n                        //rotation done around center\r\n                        const centerObj = {\r\n                            x: this.renderWidth / 2,\r\n                            y: this.renderHeight / 2\r\n                        };\r\n\r\n                        const startAngleRad = BB.Vec2.angle(centerObj, {x: event.downPageX - offsetX, y: event.downPageY - offsetY});\r\n                        const angleRad = BB.Vec2.angle(centerObj, {x: event.pageX - offsetX, y: event.pageY - offsetY});\r\n                        let dAngleRad = angleRad - startAngleRad;\r\n\r\n                        //apply angle\r\n                        this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\r\n                        this.targetTransformObj.angle += dAngleRad;\r\n\r\n                        if (this.keyListener.isPressed('shift')) {\r\n                            this.targetTransformObj.angle = Math.round(this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\r\n                            dAngleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n                        }\r\n\r\n                        this.targetTransformObj.angle = this.minimizeAngleRad(this.targetTransformObj.angle);\r\n\r\n                        //rotate transform.xy\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(dAngleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n\r\n                        this.transformIsDirty = true;\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['angle'],\r\n                            scale: this.targetTransformObj.scale,\r\n                            angle: this.targetTransformObj.angle\r\n                        });\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    const comboStr = this.keyListener.getComboStr();\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        this.currentInputProcessor = null;\r\n\r\n\r\n        this.angleIsExtraSticky = false;\r\n        this.pinchZoomer = new BB.EventChain.PinchZoomer({\r\n            onPinch: (event) => {\r\n\r\n                if (event.type === 'move') {\r\n\r\n                    if (!this.oldTransformObj) {\r\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.angleIsExtraSticky = this.targetTransformObj.angle % (Math.PI / 2) === 0;\r\n                    }\r\n\r\n                    this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\r\n\r\n                    event.scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, this.targetTransformObj.scale * event.scale)) / this.targetTransformObj.scale;\r\n\r\n                    this.targetTransformObj.scale *= event.scale;\r\n                    this.targetTransformObj.angle += event.angleRad;\r\n                    this.targetTransformObj.angle = this.minimizeAngleRad(\r\n                        this.snapAngleRad(\r\n                            this.targetTransformObj.angle,\r\n                            90,\r\n                            this.angleIsExtraSticky ? 12 : 4\r\n                        )\r\n                    );\r\n                    if (this.targetTransformObj.angle % (Math.PI / 2) !== 0) {\r\n                        this.angleIsExtraSticky = false;\r\n                    }\r\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\r\n                    event.angleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n\r\n                    //calc translation\r\n                    {\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX, event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(event.scale));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(event.angleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-event.relX, -event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\r\n\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                    }\r\n\r\n                    this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n\r\n                    //if (event.scale !== 1) {\r\n                    this.onViewChange({\r\n                        changed: ['scale', 'angle'],\r\n                        scale: this.targetTransformObj.scale,\r\n                        angle: this.targetTransformObj.angle\r\n                    });\r\n                    //}\r\n                    this.reqFrame();\r\n                    this.transformIsDirty = true;\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                } else if (event.type === 'end') {\r\n                    this.oldTransformObj = null;\r\n                }\r\n\r\n\r\n            }\r\n        });\r\n\r\n        const onDoubleTap = () => {\r\n            let oldTransform = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n            _this.fitView();\r\n            //_this.resetView(true);\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n\r\n            if (\r\n                oldTransform.scale !== this.targetTransformObj.scale ||\r\n                oldTransform.angle !== this.targetTransformObj.angle\r\n            ) {\r\n                this.onViewChange({\r\n                    changed: ['scale', 'angle'],\r\n                    angle: this.targetTransformObj.angle,\r\n                    scale: this.targetTransformObj.scale\r\n                });\r\n            }\r\n        }\r\n\r\n        this.mainDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper.setAllowedButtonArr(['middle']);\r\n\r\n\r\n        this.twoFingerTap = new BB.EventChain.NFingerTapper({\r\n            fingers: 2,\r\n            onTap: () => {\r\n                p.onUndo();\r\n            }\r\n        });\r\n        this.threeFingerTap = new BB.EventChain.NFingerTapper({\r\n            fingers: 3,\r\n            onTap: () => {\r\n                p.onRedo();\r\n            }\r\n        });\r\n\r\n\r\n        this.pointerEventChain = new BB.EventChain.EventChain({\r\n            chainArr: [\r\n                this.twoFingerTap,\r\n                this.threeFingerTap,\r\n                this.mainDoubleTapper,\r\n                this.middleDoubleTapper,\r\n                this.pinchZoomer,\r\n                new BB.EventChain.OnePointerLimiter(),\r\n                new BB.EventChain.CoalescedExploder()\r\n            ]\r\n        });\r\n        this.pointerEventChain.setChainOut((event) => {\r\n\r\n            this.cursorPos.x = event.relX;\r\n            this.cursorPos.y = event.relY;\r\n            if (event.type === 'pointerup' && event.pointerType === 'touch') {\r\n                this.pointer = null;\r\n                this.lastRenderedState = -1;\r\n                this.reqFrame();\r\n            } else {\r\n                if (!this.pointer) {\r\n                    this.pointer = { x: 0, y: 0 };\r\n                }\r\n                this.pointer.x = event.relX;\r\n                this.pointer.y = event.relY;\r\n            }\r\n\r\n            if (this.currentInputProcessor) {\r\n                this.currentInputProcessor.onPointer(event);\r\n\r\n            } else {\r\n\r\n                let comboStr = this.keyListener.getComboStr();\r\n\r\n                if (this.globalMode === TMode.Draw) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.draw;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Draw);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Hand) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'middle'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Pick) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'right'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Fill) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.fill;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Fill);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Text) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.text;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Text);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Shape) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.shape;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Shape);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n        });\r\n\r\n        //prevent ctrl scroll -> zooming page\r\n        BB.addEventListener(this.rootEl, 'wheel', (event) => {\r\n            event.preventDefault();\r\n        });\r\n\r\n\r\n        setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.rootEl,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    if (e.type === 'pointerdown' && e.button === 'middle') {\r\n                        try {\r\n                            e.eventPreventDefault();\r\n                        } catch (e) {}\r\n                    }\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    if (e.type === 'pointerdown') {\r\n                        BB.unfocusAnyInput();\r\n                    }\r\n                    /*if (e.type === 'pointermove') {\r\n                        BB.throwOut(JSON.stringify(e));\r\n                    }*/\r\n\r\n                    this.pointerEventChain.chainIn(e)\r\n                },\r\n                onWheel: (wheelEvent) => {\r\n\r\n                    if (this.isDrawing) {\r\n                        return;\r\n                    }\r\n\r\n                    this.reqFrame();\r\n                    let didZoom = this.internalZoomByStep(\r\n                        -wheelEvent.deltaY / (this.keyListener.isPressed('shift') ? 8 : 2),\r\n                        wheelEvent.relX,\r\n                        wheelEvent.relY\r\n                    );\r\n                    if (didZoom) {\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale\r\n                        });\r\n                    }\r\n\r\n                    //updateCursor(TMode.Draw, true);\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                },\r\n                onEnterLeave: (isOver) => {\r\n                    if (!isOver) {\r\n                        if (!this.isDrawing) {\r\n                            this.pointer = null;\r\n                            this.lastRenderedState = -1;\r\n                        }\r\n                    }\r\n                },\r\n                maxPointers: 4\r\n            });\r\n        }, 1);\r\n\r\n        this.brushRadius = 1;\r\n\r\n        this.animationFrameRequested = false;\r\n\r\n\r\n\r\n\r\n        //setup rendering\r\n        this.lastRenderedState = -2;\r\n        this.lastRenderTime = performance.now();\r\n\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n\r\n        this.resetView();\r\n    }\r\n\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setCanvas (klC: KlCanvas): void {\r\n        this.klCanvas = klC;\r\n        this.lastDrawEvent = null;\r\n        this.resetView();\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    /**\r\n     * set size of workspace area in pixels\r\n     * @param width\r\n     * @param height\r\n     */\r\n    setSize (width: number, height: number): void {\r\n        const oldWidth = this.renderWidth;\r\n        const oldHeight = this.renderHeight;\r\n\r\n        if (width === oldWidth && height === oldHeight) {\r\n            return;\r\n        }\r\n\r\n        this.doResizeCanvas = true;\r\n        this.renderWidth = width;\r\n        this.renderHeight = height;\r\n\r\n        this.svgOverlay.setSize(width, height);\r\n\r\n        this.targetTransformObj.x += (width - oldWidth) / 2;\r\n        this.targetTransformObj.y += (height - oldHeight) / 2;\r\n\r\n        this.highResTransformObj.x = this.targetTransformObj.x;\r\n        this.highResTransformObj.y = this.targetTransformObj.y;\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setMode (modeStr: TModeStr): void {\r\n        //only sets the base mode\r\n        if (modeStr === 'draw') {\r\n            this.globalMode = TMode.Draw;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'fill') {\r\n            this.globalMode = TMode.Fill;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'text') {\r\n            this.globalMode = TMode.Text;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'shape') {\r\n            this.globalMode = TMode.Shape;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'hand') {\r\n            this.globalMode = TMode.Hand;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n        }\r\n        if (modeStr === 'pick') {\r\n            this.globalMode = TMode.Pick;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n    }\r\n\r\n    setEnabled (b: boolean): void {\r\n        // todo\r\n    }\r\n\r\n    setCursorSize (diameter: number): void {\r\n        this.brushRadius = diameter / 2;\r\n\r\n        this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n\r\n        if (this.pointer === null) {\r\n            clearTimeout(this.hideBrushCursorTimeout);\r\n\r\n            this.svgOverlay.updateCursor({\r\n                x: this.renderWidth / 2,\r\n                y: this.renderHeight / 2,\r\n                isVisible: true\r\n            });\r\n\r\n            // @ts-ignore\r\n            this.hideBrushCursorTimeout = setTimeout(() => {\r\n                if (this.pointer !== null) {\r\n                    return;\r\n                }\r\n                this.svgOverlay.updateCursor({isVisible: false});\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n    zoomByStep (stepNum: number): void {\r\n        if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) {\r\n            return;\r\n        }\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale'],\r\n            angle: this.targetTransformObj.angle,\r\n            scale: this.targetTransformObj.scale\r\n        });\r\n    }\r\n\r\n    resetView (doAnimate?: boolean): void {\r\n        this.targetTransformObj.scale = 1;\r\n        this.targetTransformObj.angle = 0;\r\n\r\n        this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\r\n        this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\r\n\r\n        if (!doAnimate) {\r\n            this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n        } else {\r\n            this.doAnimateTranslate = true;\r\n            this.transformIsDirty = true;\r\n        }\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n        this.reqFrame();\r\n\r\n        if (doAnimate) {\r\n            this.onViewChange({\r\n                changed: ['scale', 'angle'],\r\n                scale: this.targetTransformObj.scale,\r\n                angle: this.targetTransformObj.angle\r\n            });\r\n        }\r\n    }\r\n\r\n    fitView (): void {\r\n        //fit into view. center. snap angle. margin of 10px\r\n\r\n        this.targetTransformObj.angle = this.snapAngleRad(this.targetTransformObj.angle, 90, 90);\r\n\r\n        //calc width and height of bounds\r\n        const canvasPointsArr = [\r\n            [0, 0], // top left\r\n            [this.klCanvas.getWidth(), 0], // top right\r\n            [this.klCanvas.getWidth(), this.klCanvas.getHeight()], // bottom right\r\n            [0, this.klCanvas.getHeight()], // bottom left\r\n            [this.klCanvas.getWidth() / 2, this.klCanvas.getHeight() / 2], // center\r\n        ];\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle));\r\n\r\n        //rotate points\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            let coords = [canvasPointsArr[i][0], canvasPointsArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n            canvasPointsArr[i][0] = coords[0];\r\n            canvasPointsArr[i][1] = coords[1];\r\n        }\r\n\r\n        const boundsObj = {\r\n            x0: null,\r\n            y0: null,\r\n            x1: null,\r\n            y1: null\r\n        };\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            if (boundsObj.x0 === null || canvasPointsArr[i][0] < boundsObj.x0) {\r\n                boundsObj.x0 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y0 === null || canvasPointsArr[i][1] < boundsObj.y0) {\r\n                boundsObj.y0 = canvasPointsArr[i][1];\r\n            }\r\n            if (boundsObj.x1 === null || canvasPointsArr[i][0] > boundsObj.x1) {\r\n                boundsObj.x1 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y1 === null || canvasPointsArr[i][1] > boundsObj.y1) {\r\n                boundsObj.y1 = canvasPointsArr[i][1];\r\n            }\r\n        }\r\n        const boundsWidth = boundsObj.x1 - boundsObj.x0;\r\n        const boundsHeight = boundsObj.y1 - boundsObj.y0;\r\n\r\n        //fit bounds\r\n        const padding = 40;\r\n        const { width: fitWidth } = BB.fitInto(\r\n            boundsWidth,\r\n            boundsHeight, \r\n            this.renderWidth - padding, \r\n            this.renderHeight - padding, \r\n            1\r\n        );\r\n\r\n        //determine scale\r\n        const factor = fitWidth / boundsWidth;\r\n\r\n        //center\r\n        this.targetTransformObj.x = (this.renderWidth / 2) - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor;\r\n        this.targetTransformObj.y = (this.renderHeight / 2) - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor;\r\n\r\n        this.targetTransformObj.scale = factor;\r\n        this.doAnimateTranslate = true;\r\n        this.transformIsDirty = true;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale', 'angle'],\r\n            scale: this.targetTransformObj.scale,\r\n            angle: this.targetTransformObj.angle\r\n        });\r\n    }\r\n\r\n    setAngle (angleDeg: number, isRelative?: boolean): void {\r\n        //rotation done around center\r\n        const centerObj = {\r\n            x: this.renderWidth / 2,\r\n            y: this.renderHeight / 2\r\n        };\r\n\r\n        const oldAngleRad = this.targetTransformObj.angle;\r\n        const angleRad = angleDeg / 180 * Math.PI;\r\n\r\n        if (isRelative) {\r\n            this.targetTransformObj.angle += angleRad;\r\n        } else {\r\n            this.targetTransformObj.angle = angleRad;\r\n        }\r\n\r\n        this.targetTransformObj.angle = this.minimizeAngleRad(\r\n            this.snapAngleRad(\r\n                this.targetTransformObj.angle,\r\n                90,\r\n                4\r\n            )\r\n        );\r\n\r\n        //rotate transform.xy\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n        this.transformIsDirty = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    /**\r\n     * translate canvas by viewport pixels\r\n     * @param tx\r\n     * @param ty\r\n     */\r\n    translateView (tx: number, ty: number): void {\r\n        const scale = 40;\r\n\r\n        this.targetTransformObj.x += tx * scale;\r\n        this.targetTransformObj.y += ty * scale;\r\n\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    getScale (): number {\r\n        return this.targetTransformObj.scale;\r\n    }\r\n\r\n    getAngleDeg (): number {\r\n        return this.targetTransformObj.angle * 180 / Math.PI;\r\n    }\r\n\r\n    getMaxScale (): number {\r\n        return MAX_SCALE;\r\n    }\r\n\r\n    getMinScale (): number {\r\n        return MIN_SCALE;\r\n    }\r\n\r\n    requestFrame (): void {\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setLastDrawEvent (x: number | null, y?: number, pressure?: number): void {\r\n        if (x === null) {\r\n            this.lastDrawEvent = null;\r\n            return;\r\n        }\r\n\r\n        if (!this.lastDrawEvent) {\r\n            this.lastDrawEvent = {x: 0, y: 0, pressure: 0};\r\n        }\r\n        this.lastDrawEvent.x = x;\r\n        this.lastDrawEvent.y = y;\r\n        this.lastDrawEvent.pressure = pressure;\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1dLwT\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"9wZxU\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hQSEH\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"916ZI\");","import {BB} from '../../bb/bb';\r\nimport {IKlBasicLayer} from '../kl.types';\r\n\r\n/**\r\n * preview of image with layers. can do mix modes and opacity.\r\n * creates a canvas.\r\n *\r\n * p = {\r\n *     width: 123,\r\n *     height: 123,\r\n *     layers: [// can be changed after the fact\r\n *         {\r\n *             image: Canvas,\r\n *             opacity: 1,\r\n *             mixModeStr: 'source-over'\r\n *         }\r\n *     ]\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function KlCanvasPreview(\r\n    p: {\r\n        width: number;\r\n        height: number;\r\n        layers: IKlBasicLayer[];\r\n    }\r\n) {\r\n    const scale = p.width / p.layers[0].image.width;\r\n    const width = scale > 1 ? p.layers[0].image.width : p.width;\r\n    const height = scale > 1 ? p.layers[0].image.height : p.height;\r\n\r\n    let canvas = BB.canvas(width, height);\r\n    canvas.style.backgroundImage = 'url(' + BB.createCheckerDataUrl(8) + ')';\r\n    let ctx = canvas.getContext('2d');\r\n\r\n    BB.css(canvas, {\r\n        width: '100%',\r\n        height: '100%',\r\n        imageRendering: scale > 1 ? 'pixelated' : null,\r\n    });\r\n\r\n    function render() {\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        for (let i = 0; i < p.layers.length; i++) {\r\n            ctx.globalAlpha = p.layers[i].opacity;\r\n            ctx.globalCompositeOperation = p.layers[i].mixModeStr;\r\n            if (canvas.width > p.layers[i].image.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(p.layers[i].image, 0, 0, canvas.width, canvas.height);\r\n        }\r\n        ctx.restore();\r\n    }\r\n\r\n    setTimeout(render, 0);\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return canvas;\r\n    };\r\n\r\n    this.render = function() {\r\n        render();\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport rotateImg from 'url:~/src/app/img/ui/cursor-rotate.png';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {IVector2D} from '../../../bb/bb.types';\r\n\r\nexport interface ITransform {\r\n    x: number; // center of transform region. image space\r\n    y: number;\r\n    width: number; // size of transform region. image space\r\n    height: number;\r\n    angleDeg: number; // angle of transform region. degrees\r\n}\r\n\r\n\r\n/**\r\n * snap entire transform to pixel grid. changes transform\r\n *\r\n * for x y:\r\n * If a dimension has an even size, it be an integer.\r\n * If it's uneven, it's sits exactly half way between two pixels.\r\n *\r\n * @param transform\r\n */\r\nfunction snapToPixel(transform: ITransform): void {\r\n    if (Math.abs(transform.angleDeg) % 90 !== 0) {\r\n        return;\r\n    }\r\n\r\n    transform.width = Math.round(transform.width);\r\n    transform.height = Math.round(transform.height);\r\n    // 0 is original orientation.\r\n    // At 90 and 270 width and height become swapped due to different orientation.\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    transform.x = ((whSwapped ? transform.height : transform.width) % 2 === 0) ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\r\n    transform.y = ((whSwapped ? transform.width : transform.height) % 2 === 0)  ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\r\n}\r\n\r\nfunction copyTransform(transform: ITransform): ITransform {\r\n    return {\r\n        x: transform.x,\r\n        y: transform.y,\r\n        width: transform.width,\r\n        height: transform.height,\r\n        angleDeg: transform.angleDeg,\r\n    };\r\n}\r\n\r\n/**\r\n * image space to transform space\r\n * - origin of transform space is at center of transform bounds.\r\n * - same scale as image space. -> one unit is x: 1/width, y: 1/height\r\n * - up is where transform points up\r\n * - x goes right\r\n * - y goes down\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nfunction toTransformSpace (x: number, y: number, transform: ITransform): IVector2D {\r\n    let px, py;\r\n    px = x - transform.x;\r\n    py = y - transform.y;\r\n\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: px, y: py},\r\n        -transform.angleDeg);\r\n    px = rot.x;\r\n    py = rot.y;\r\n\r\n    return {\r\n        x: px,\r\n        y: py,\r\n    };\r\n}\r\n\r\n/**\r\n * transform space to image space\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nfunction toImageSpace(x: number, y: number, transform: ITransform): IVector2D {\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: x, y: y},\r\n        transform.angleDeg);\r\n    return {\r\n        x: rot.x + transform.x,\r\n        y: rot.y + transform.y,\r\n    };\r\n}\r\n\r\n\r\n\r\n/**\r\n * Free Transform UI\r\n * rotate, scale, translate\r\n *\r\n * - if rotation is multiple of 90 it will snap to pixels, to be more useful for pixel art\r\n * - when rotation goes from non-multiple of 90 to a multiple, it will snap position and width height to pixels\r\n * - transform.x, transform.y can sit between pixels (by 0.5) if width or height is odd number.\r\n *      - this is what complicates things\r\n * - if transform region small, corner grips move out of the way\r\n *\r\n * iX iY, iP.x, iP.y - i indicates image space\r\n * tX tY, tP.x, tP.y - t indicates transform space\r\n *\r\n * Not sure if can be used for navigable canvas. (especially if canvas rotates view)\r\n * Probably can't be extended for distort. Needs a different approach.\r\n *\r\n * --- DOM structure ---\r\n * rootEl {\r\n * \ttransEl [\r\n * \t\tboundsEl\r\n * \t\tedges[]\r\n * \t\tcorners[] - round grips in the corner of transform region\r\n * \t\tangleGrip\r\n * \t]\r\n * }\r\n *\r\n */\r\nexport class FreeTransform {\r\n\r\n    // --- private ---\r\n    private readonly transform: ITransform; // coordinates and dimensions of transformation\r\n    private isConstrained: boolean;\r\n    private ratio: number; // aspect ratio of transform\r\n    private readonly scale: number;\r\n    private readonly scaled = { // scaled coordinates and dimensions for screenspace\r\n        x: 0,\r\n        y: 0,\r\n        width: 0,\r\n        height: 0,\r\n        corners: [{x: 0, y: 0}], // in transform space\r\n    };\r\n    private readonly minSnapDist = 7; // minimal snapping distance in px screenspace\r\n    private snappingEnabled: boolean;\r\n    private readonly snapX: number[];\r\n    private readonly snapY: number[];\r\n    private readonly callback: (transform: ITransform) => void;\r\n\r\n\r\n    private readonly cornerCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n    private readonly gripSize = 14;\r\n    private readonly edgeSize = 10;\r\n\r\n    private readonly rootEl: HTMLElement; // sits at origin of image\r\n    private readonly transEl: HTMLElement; // at middle of transform. rotates\r\n    private readonly boundsEl: HTMLElement; // draggable bounds rectangle with outline\r\n    private readonly corners: {\r\n        i: number; // index in corners array\r\n        el: HTMLElement; // draggable corner circle in DOM\r\n        x: number; // unscaled position (transform space)\r\n        y: number;\r\n        virtualPos: IVector2D; // unscaled temporary position (image space)\r\n        updateDOM: () => void; // update styling in DOM\r\n        pointerListener: any;\r\n    }[] = [];\r\n    private keyListener: KeyListener;\r\n    private boundsPointerListener: any; // BB.PointerListener\r\n    private anglePointerListener: any; // BB.PointerListener\r\n    private readonly edges: { // derive position from corners\r\n        el: HTMLElement;\r\n        updateDOM: () => void;\r\n        pointerListener: any;\r\n    }[] = [];\r\n    private readonly angleGrip: {\r\n        el: HTMLElement,\r\n        x: number; // transform space\r\n        y: number;\r\n        snap: boolean,\r\n        updateDOM: () => void,\r\n    };\r\n\r\n    private updateScaled(): void {\r\n        this.scaled.x = this.transform.x * this.scale;\r\n        this.scaled.y = this.transform.y * this.scale;\r\n        this.scaled.width = this.transform.width * this.scale;\r\n        this.scaled.height = this.transform.height * this.scale;\r\n        this.scaled.corners = this.corners.map((item) => {\r\n            return {x: item.x * this.scale, y: item.y * this.scale};\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\r\n     * both in image space\r\n     *\r\n     * @param iX - image space\r\n     * @param iY - image space\r\n     * @private\r\n     */\r\n    private snapCorner (iX: number, iY: number): IVector2D {\r\n        if (!this.snappingEnabled) {\r\n            return {x: iX, y: iY};\r\n        }\r\n        let dist: number;\r\n        const snap: {\r\n            x: number;\r\n            y: number;\r\n            dist: {\r\n                x: number;\r\n                y: number;\r\n            }\r\n        } = {\r\n            x: null,\r\n            y: null,\r\n            dist: {\r\n                x: null,\r\n                y: null,\r\n            }\r\n        };\r\n        for (let e = 0; e < this.snapX.length; e++) {\r\n            dist = Math.abs(iX - this.snapX[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.x === null || dist < snap.dist.x) {\r\n                    snap.x = this.snapX[e];\r\n                    snap.dist.x = dist;\r\n                }\r\n            }\r\n        }\r\n        for (let e = 0; e < this.snapY.length; e++) {\r\n            dist = Math.abs(iY - this.snapY[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.y === null || dist < snap.dist.y) {\r\n                    snap.y = this.snapY[e];\r\n                    snap.dist.y = dist;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (snap.x === null && snap.y === null) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        return {\r\n            x: snap.x ?? iX,\r\n            y: snap.y ?? iY,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * If constrained return nearest corner pos that fits aspect ratio\r\n     *\r\n     * @param cornerIndex\r\n     * @param iX\r\n     * @param iY\r\n     * @private\r\n     */\r\n    private constrainCorner (cornerIndex: number, iX: number, iY: number): IVector2D {\r\n        if (!this.isConstrained) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        const flip = this.transform.width * this.transform.height < 0 ? -1 : 1;\r\n        return BB.projectPointOnLine(\r\n            {x: this.transform.x, y: this.transform.y},\r\n            toImageSpace(this.ratio, flip * ([0, 2].includes(cornerIndex) ? 1 : -1), this.transform),\r\n            {x: iX, y: iY}\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Update corners according to width height.\r\n     * Not their DOM.\r\n     */\r\n    private updateCornerPositions (): void {\r\n        this.corners[0].x = (-this.transform.width / 2); // top left\r\n        this.corners[0].y = (-this.transform.height / 2);\r\n\r\n        this.corners[1].x = (this.transform.width / 2); // top right\r\n        this.corners[1].y = (-this.transform.height / 2);\r\n\r\n        this.corners[2].x = (this.transform.width / 2); // bottom right\r\n        this.corners[2].y = (this.transform.height / 2);\r\n\r\n        this.corners[3].x = (-this.transform.width / 2); // bottom left\r\n        this.corners[3].y = (this.transform.height / 2);\r\n    }\r\n\r\n    /**\r\n     * If constrained and dragging an edge, restore aspect ratio\r\n     * Updates corner positions.\r\n     *\r\n     * @param widthChanged\r\n     * @param heightChanged\r\n     * @private\r\n     */\r\n    private restoreRatio (widthChanged: boolean, heightChanged: boolean): void {\r\n        if (!this.isConstrained) {\r\n            return;\r\n        }\r\n        const angle90 = Math.abs(this.transform.angleDeg) % 90 === 0;\r\n        const whSwapped = Math.abs(this.transform.angleDeg - 90) % 180 === 0;\r\n        if (heightChanged && !widthChanged) {\r\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\r\n            let newWidth = this.ratio * newHeight;\r\n            if (angle90) {\r\n                newWidth = (whSwapped ? this.transform.y % 1 : this.transform.x % 1) === 0 ?\r\n                    BB.roundEven(newWidth) : BB.roundUneven(newWidth);\r\n            }\r\n            if (this.corners[1].x - this.corners[0].x < 0) {\r\n                newWidth *= -1;\r\n            }\r\n            this.corners[0].x = -newWidth / 2;\r\n            this.corners[3].x = -newWidth / 2;\r\n            this.corners[1].x = newWidth / 2;\r\n            this.corners[2].x = newWidth / 2;\r\n        }\r\n        if (!heightChanged && widthChanged) {\r\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\r\n            let newHeight = newWidth / this.ratio;\r\n            if (angle90) {\r\n                newHeight = (whSwapped ? this.transform.x % 1 : this.transform.y % 1) === 0  ?\r\n                    BB.roundEven(newHeight) : BB.roundUneven(newHeight);\r\n            }\r\n            if (this.corners[3].y - this.corners[0].y < 0) {\r\n                newHeight *= -1;\r\n            }\r\n            this.corners[0].y = -newHeight / 2;\r\n            this.corners[1].y = -newHeight / 2;\r\n            this.corners[2].y = newHeight / 2;\r\n            this.corners[3].y = newHeight / 2;\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * update transform based on corners\r\n     * @private\r\n     */\r\n    private updateTransformViaCorners (): void {\r\n\r\n        // calc transform center in image space\r\n        const rot = BB.rotateAround(\r\n            {x: 0, y: 0},\r\n            {\r\n                x: (this.corners[0].x + this.corners[1].x) / 2,\r\n                y: (this.corners[0].y + this.corners[3].y) / 2,\r\n            },\r\n            this.transform.angleDeg\r\n        );\r\n        this.transform.x = rot.x + this.transform.x;\r\n        this.transform.y = rot.y + this.transform.y;\r\n\r\n        // update size\r\n        this.transform.width = this.corners[1].x - this.corners[0].x;\r\n        this.transform.height = this.corners[3].y - this.corners[0].y;\r\n\r\n        // new center means corners changed their position\r\n        this.updateCornerPositions();\r\n\r\n        this.updateDOM();\r\n    }\r\n\r\n    /**\r\n     * updates DOM according to transform\r\n     * @param skipCallback\r\n     */\r\n    private updateDOM (skipCallback?: boolean) {\r\n        this.updateScaled();\r\n\r\n        BB.css(this.transEl, {\r\n            left: this.scaled.x + \"px\",\r\n            top: this.scaled.y + \"px\",\r\n            transformOrigin: \"0 0\",\r\n            transform: \"rotate(\" + this.transform.angleDeg + \"deg)\",\r\n        });\r\n\r\n        BB.css(this.boundsEl, {\r\n            width: Math.abs(this.scaled.width) + \"px\",\r\n            height: Math.abs(this.scaled.height) + \"px\",\r\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + \"px\",\r\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + \"px\"\r\n        });\r\n\r\n        this.corners[0].updateDOM();\r\n        this.corners[1].updateDOM();\r\n        this.corners[2].updateDOM();\r\n        this.corners[3].updateDOM();\r\n\r\n        this.edges[0].updateDOM();\r\n        this.edges[1].updateDOM();\r\n        this.edges[2].updateDOM();\r\n        this.edges[3].updateDOM();\r\n\r\n\r\n        this.angleGrip.x = 0;\r\n        this.angleGrip.y = (-Math.abs(this.transform.height * this.scale) / 2) - 20;\r\n        this.angleGrip.updateDOM();\r\n        if (!skipCallback) {\r\n            if (this.callback) { // why should updateDOM trigger the callback?\r\n                this.callback(copyTransform(this.transform));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // --- public ---\r\n    constructor (\r\n        params: {\r\n            x: number; // center of transform region. image space\r\n            y: number;\r\n            width: number; // size of transform region. image space\r\n            height: number;\r\n            angleDeg: number; // angle of transform region. degrees\r\n\r\n            isConstrained: boolean; // proportions constrained\r\n            snapX: number[]; // where snapping along X axis. image space\r\n            snapY: number[]; // where snapping along X axis. image space\r\n            scale: number; // ratio of screen-space / image-space\r\n            callback: (transform: ITransform) => void;\r\n        }\r\n    ) {\r\n        this.transform = { // coordinates and dimensions of transformation\r\n            x: params.x,\r\n            y: params.y,\r\n            width: params.width,\r\n            height: params.height,\r\n            angleDeg: params.angleDeg,\r\n        };\r\n\r\n        this.isConstrained = !!params.isConstrained;\r\n\r\n        this.snapX = params.snapX;\r\n        this.snapY = params.snapY;\r\n        this.callback = params.callback;\r\n        this.scale = params.scale;\r\n        this.snappingEnabled = true;\r\n        this.ratio = this.transform.width / this.transform.height;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-free-transform',\r\n            css: {\r\n                userSelect: 'none',\r\n            }\r\n        });\r\n        this.transEl = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                position: 'absolute',\r\n            }\r\n        });\r\n\r\n        this.boundsEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                cursor: 'move',\r\n                boxShadow: 'rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px',\r\n            }\r\n        });\r\n\r\n        const pointerRemainder = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        function resetRemainder() {\r\n            pointerRemainder.x = 0;\r\n            pointerRemainder.y = 0;\r\n        }\r\n        this.keyListener = new BB.KeyListener({});\r\n\r\n        let boundsStartP = {\r\n            x: 0,\r\n            y: 0,\r\n        }\r\n        this.boundsPointerListener = new BB.PointerListener({\r\n            target: this.boundsEl,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointerdown') {\r\n                    boundsStartP = {x: this.transform.x, y: this.transform.y};\r\n                }\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    this.transform.x = boundsStartP.x + (event.pageX - event.downPageX) / this.scale;\r\n                    this.transform.y = boundsStartP.y + (event.pageY - event.downPageY) / this.scale;\r\n\r\n\r\n                    let dist;\r\n                    let snap: any = {};\r\n                    if (this.snappingEnabled) {\r\n                        let i;\r\n                        for (i = 0; i < this.snapX.length; i++) {\r\n                            dist = Math.abs(this.transform.x - this.snapX[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.x || dist < snap.distX) {\r\n                                    snap.x = this.snapX[i];\r\n                                    snap.distX = dist;\r\n                                }\r\n                            }\r\n                        }\r\n                        for (i = 0; i < this.snapY.length; i++) {\r\n                            dist = Math.abs(this.transform.y - this.snapY[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.y || dist < snap.distY) {\r\n                                    snap.y = this.snapY[i];\r\n                                    snap.distY = dist;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        let iP;\r\n                        for (i = 0; i < 4; i++) {\r\n                            iP = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n                            let j;\r\n                            for (j = 0; j < this.snapX.length; j++) {\r\n                                dist = Math.abs(iP.x - this.snapX[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.x || dist < snap.distX) {\r\n                                        snap.x = this.snapX[j] - (iP.x - this.transform.x);\r\n                                        snap.distX = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                            for (j = 0; j < this.snapY.length; j++) {\r\n                                dist = Math.abs(iP.y - this.snapY[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.y || dist < snap.distY) {\r\n                                        snap.y = this.snapY[j] - (iP.y - this.transform.y);\r\n                                        snap.distY = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        let projected = BB.projectPointOnLine(\r\n                            {x: 0, y: boundsStartP.y},\r\n                            {x: 10, y: boundsStartP.y},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        let dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        snap = {};\r\n                        snap.x = projected.x;\r\n                        snap.y = projected.y;\r\n                        snap.distX = dist;\r\n                        snap.distY = dist;\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: 0},\r\n                            {x: boundsStartP.x, y: 10},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap.x = projected.x;\r\n                            snap.y = projected.y;\r\n                            snap.distX = dist;\r\n                            snap.distY = dist;\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y + 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap.x = projected.x;\r\n                            snap.y = projected.y;\r\n                            snap.distX = dist;\r\n                            snap.distY = dist;\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y - 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap.x = projected.x;\r\n                            snap.y = projected.y;\r\n                            snap.distX = dist;\r\n                            snap.distY = dist;\r\n                        }\r\n                    }\r\n                    if (snap.x != undefined) {\r\n                        this.transform.x = snap.x;\r\n                    }\r\n                    if (snap.y != undefined) {\r\n                        this.transform.y = snap.y;\r\n                    }\r\n\r\n                    // snap to pixels\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                    }\r\n\r\n                    this.updateDOM();\r\n                }\r\n            }\r\n        })\r\n\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                const g = this.corners[i] = {\r\n                    i: i,\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.gripSize + 'px',\r\n                            height: this.gripSize + 'px',\r\n                            background: '#fff',\r\n                            /*background: [\r\n                                '#ff0000',\r\n                                '#00ff00',\r\n                                '#0000ff',\r\n                                '#ff00ff',\r\n                            ][i],*/\r\n                            borderRadius: this.gripSize + 'px',\r\n                            position: 'absolute',\r\n                            boxShadow: 'inset 0 0 0 2px #000'\r\n                        }\r\n                    }),\r\n                    x: 0,\r\n                    y: 0,\r\n                    virtualPos: {\r\n                        x: 0,\r\n                        y: 0,\r\n                    },\r\n                    updateDOM: null,\r\n                    pointerListener: null,\r\n                };\r\n                g.updateDOM = () => {\r\n\r\n                    // grip position\r\n                    // if gets small, offset grips, so easier to handle\r\n                    const offsetArr = [[-1, -1], [1, -1], [1, 1], [-1, 1]].map(item => {\r\n                        item[0] *= this.transform.width > 0 ? 1 : -1;\r\n                        item[1] *= this.transform.height > 0 ? 1 : -1;\r\n                        return item;\r\n                    });\r\n                    const tinyOffset = Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20 ? 10 : 0;\r\n\r\n                    BB.css(g.el, {\r\n                        left: (this.scaled.corners[g.i].x - this.gripSize / 2 + offsetArr[i][0] * tinyOffset) + 'px',\r\n                        top: (this.scaled.corners[g.i].y - this.gripSize / 2 + offsetArr[i][1] * tinyOffset) + 'px'\r\n                    });\r\n\r\n\r\n                    // cursor\r\n                    let angle = BB.pointsToAngleDeg(\r\n                        {\r\n                            x: this.transform.x,\r\n                            y: this.transform.y,\r\n                        },\r\n                        toImageSpace(g.x, g.y, this.transform),\r\n                    ) + 135; // offset so nw is 0\r\n                    while (angle < 0) {\r\n                        angle += 360;\r\n                    }\r\n                    let index = Math.round(angle / 45) % this.cornerCursors.length;\r\n                    BB.css(g.el, {\r\n                        cursor: this.cornerCursors[index] + '-resize',\r\n                    });\r\n                };\r\n\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.corners[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            this.corners[i].virtualPos = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n\r\n                        } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                            this.corners[i].virtualPos.x += event.dX / this.scale;\r\n                            this.corners[i].virtualPos.y += event.dY / this.scale;\r\n\r\n                            let iP = {\r\n                                x: this.corners[i].virtualPos.x,\r\n                                y: this.corners[i].virtualPos.y,\r\n                            };\r\n                            iP = this.constrainCorner(i, iP.x, iP.y);\r\n                            if (!this.isConstrained) {\r\n                                iP = this.snapCorner(iP.x, iP.y);\r\n                            }\r\n\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                iP.x = Math.round(iP.x);\r\n                                iP.y = Math.round(iP.y);\r\n                            }\r\n\r\n                            const tP = toTransformSpace(iP.x, iP.y, this.transform);\r\n\r\n                            const dX = tP.x - this.corners[i].x;\r\n                            const dY = tP.y - this.corners[i].y;\r\n                            this.corners[i].x = tP.x;\r\n                            this.corners[i].y = tP.y;\r\n\r\n                            let indexes = [];\r\n                            if (i === 0) { // top left\r\n                                indexes = [3, 1, 2];\r\n                            } else if (i === 1) { // top right\r\n                                indexes = [2, 0, 3];\r\n                            } else if (i === 2) { // bottom right\r\n                                indexes = [1, 3, 0];\r\n                            } else if (i === 3) { // bottom left\r\n                                indexes = [0, 2, 1];\r\n                            }\r\n\r\n                            this.corners[indexes[0]].x = this.corners[i].x;\r\n                            this.corners[indexes[1]].y = this.corners[i].y;\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                this.corners[indexes[2]].x -= dX;\r\n                                this.corners[indexes[2]].y -= dY;\r\n                                this.corners[indexes[1]].x = this.corners[indexes[2]].x;\r\n                                this.corners[indexes[0]].y = this.corners[indexes[2]].y;\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    }\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.updateCornerPositions();\r\n        this.updateScaled();\r\n\r\n        let isInverted: boolean;\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                this.edges[i] = {\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.edgeSize + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                            /*background: [\r\n                                '#ff000044',\r\n                                '#00ff0044',\r\n                                '#0000ff44',\r\n                                '#ff00ff44',\r\n                            ][i],*/\r\n                            position: 'absolute',\r\n                        },\r\n                    }),\r\n                    updateDOM: null,\r\n                    pointerListener: null,\r\n                };\r\n                const g = this.edges[i];\r\n                g.updateDOM = () => {\r\n                    if (i === 0) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: (Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) - this.edgeSize) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 1) {\r\n                        BB.css(g.el, {\r\n                            left: Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    } else if (i === 2) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + 'px',\r\n                            top: Math.max(this.scaled.corners[0].y,this.scaled.corners[3].y) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 3) {\r\n                        BB.css(g.el, {\r\n                            left: (Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) - this.edgeSize) + 'px',\r\n                            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    }\r\n                    let angleOffset = Math.round(this.transform.angleDeg / 45);\r\n                    while (angleOffset < 0)\r\n                        angleOffset += 8;\r\n                    angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\r\n                    g.el.style.cursor = this.cornerCursors[angleOffset] + '-resize';\r\n\r\n                };\r\n\r\n                const isVertical = [0, 2].includes(i);\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.edges[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            if (isVertical) { // top bottom\r\n                                isInverted = this.corners[0].y >= this.corners[3].y;\r\n                            } else { // left right\r\n                                isInverted = this.corners[0].x >= this.corners[1].x;\r\n                            }\r\n                            resetRemainder();\r\n                        }\r\n                        if (event.type === 'pointermove' && event.button === 'left') {\r\n                            const tfD = BB.rotateAround({x: 0, y: 0},\r\n                                {x: event.dX / this.scale, y: event.dY / this.scale},\r\n                                -this.transform.angleDeg);\r\n                            let ti = {\r\n                                dX: tfD.x,\r\n                                dY: tfD.y,\r\n                            };\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                ti = BB.intDxy(pointerRemainder, tfD.x, tfD.y);\r\n                            }\r\n\r\n                            let indexes = [];\r\n                            if (i === 0) { // top\r\n                                indexes = [2, 3, 0, 1];\r\n                            } else if (i === 1) { // right\r\n                                indexes = [0, 3, 1, 2];\r\n                            } else if (i === 2) { // bottom\r\n                                indexes = [0, 1, 2, 3];\r\n                            } else if (i === 3) { // left\r\n                                indexes = [1, 2, 0, 3];\r\n                            }\r\n\r\n                            let dimension = isVertical ? 'y' : 'x';\r\n                            let d = isVertical ? ti.dY : ti.dX;\r\n\r\n                            if (isInverted) {\r\n                                this.corners[indexes[0]][dimension] += d;\r\n                                this.corners[indexes[1]][dimension] += d;\r\n                            } else {\r\n                                this.corners[indexes[2]][dimension] += d;\r\n                                this.corners[indexes[3]][dimension] += d;\r\n                            }\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                if (isInverted) {\r\n                                    this.corners[indexes[2]][dimension] -= d;\r\n                                    this.corners[indexes[3]][dimension] -= d;\r\n                                } else {\r\n                                    this.corners[indexes[0]][dimension] -= d;\r\n                                    this.corners[indexes[1]][dimension] -= d;\r\n                                }\r\n                            }\r\n\r\n                            if (isVertical) { // top bottom\r\n                                this.restoreRatio(false, true);\r\n                            } else { // left right\r\n                                this.restoreRatio(true, false);\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    }\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.angleGrip = {\r\n            el: BB.el({\r\n                css: {\r\n                    cursor: 'url(' + rotateImg + ') 10 10, move',\r\n                    width: this.gripSize + 'px',\r\n                    height: this.gripSize + 'px',\r\n                    background: '#0ff',\r\n                    borderRadius: this.gripSize + 'px',\r\n                    position: 'absolute',\r\n                    boxShadow: 'inset 0 0 0 2px #000',\r\n                },\r\n            }),\r\n            x: 0,\r\n            y: 0,\r\n            snap: false,\r\n            updateDOM: () => {\r\n                BB.css(this.angleGrip.el, {\r\n                    left: (this.angleGrip.x - this.gripSize / 2) + 'px',\r\n                    top: (this.angleGrip.y - this.gripSize / 2) + 'px',\r\n                });\r\n            },\r\n        };\r\n        BB.el({\r\n            parent: this.angleGrip.el,\r\n            css: {\r\n                width: '2px',\r\n                height: '13px',\r\n                left: (this.gripSize / 2 - 1) + 'px',\r\n                top: this.gripSize + 'px',\r\n                background: '#0ff',\r\n                position: 'absolute'\r\n            }\r\n        });\r\n\r\n        this.anglePointerListener = new BB.PointerListener({\r\n            target: this.angleGrip.el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    const bounds = this.rootEl.getBoundingClientRect();\r\n                    const offset = {\r\n                        x: bounds.left - this.rootEl.scrollLeft,\r\n                        y: bounds.top - this.rootEl.scrollTop,\r\n                    };\r\n                    const iP = {x: (event.clientX - offset.x) / this.scale, y: (event.clientY - offset.y) / this.scale};\r\n\r\n                    const a = BB.pointsToAngleDeg({x: this.transform.x, y: this.transform.y}, iP) + 90;\r\n                    this.transform.angleDeg = a;\r\n                    const snapDeg = Math.round(a / 360 * 8) * 45;\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    } else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    }\r\n                    this.updateDOM();\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                        this.updateDOM();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        snapToPixel(this.transform);\r\n        this.updateDOM(true);\r\n        BB.append(this.transEl, [\r\n            this.boundsEl,\r\n            this.edges[0].el,\r\n            this.edges[1].el,\r\n            this.edges[2].el,\r\n            this.edges[3].el,\r\n            this.corners[0].el,\r\n            this.corners[1].el,\r\n            this.corners[2].el,\r\n            this.corners[3].el,\r\n            this.angleGrip.el,\r\n        ]);\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    getTransform (): ITransform {\r\n        return copyTransform(this.transform);\r\n    }\r\n\r\n    setConstrained (b: boolean): void {\r\n        this.isConstrained = !!b;\r\n        if (b && this.transform.width !== 0 && this.transform.height !== 0) {\r\n            this.ratio = Math.abs(this.transform.width / this.transform.height);\r\n        }\r\n    }\r\n\r\n    setSnapping (s: boolean): void {\r\n        this.snappingEnabled = !!s;\r\n    }\r\n\r\n    setPos (p: IVector2D): void {\r\n        this.transform.x = p.x;\r\n        this.transform.y = p.y;\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    move (dX: number, dY: number): void {\r\n        this.transform.x += dX;\r\n        this.transform.y += dY;\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setSize (w: number, h: number): void {\r\n        this.transform.width = w;\r\n        this.transform.height = h;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n        }\r\n        this.updateCornerPositions();\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setAngleDeg (a: number): void {\r\n        this.transform.angleDeg = a;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n            this.updateCornerPositions();\r\n        }\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getRatio (): number {\r\n        return this.ratio;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.keyListener.destroy();\r\n        this.boundsPointerListener.destroy();\r\n        this.corners[0].pointerListener.destroy();\r\n        this.corners[1].pointerListener.destroy();\r\n        this.corners[2].pointerListener.destroy();\r\n        this.corners[3].pointerListener.destroy();\r\n        this.edges[0].pointerListener.destroy();\r\n        this.edges[1].pointerListener.destroy();\r\n        this.edges[2].pointerListener.destroy();\r\n        this.edges[3].pointerListener.destroy();\r\n        this.anglePointerListener.destroy();\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"045N6\");","import {BB} from '../../../bb/bb';\r\nimport {KlCanvasPreview} from '../../canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './free-transform';\r\nimport {IKlBasicLayer, IMixMode} from '../../kl.types';\r\n\r\n/**\r\n * a basic canvas where you can transform one layer(move around, rotate, scale)\r\n *\r\n * @param params\r\n * @returns {HTMLDivElement}\r\n * @constructor\r\n */\r\nexport function FreeTransformCanvas(params: {\r\n    elementWidth: number;\r\n    elementHeight: number;\r\n    imageWidth: number;\r\n    imageHeight: number;\r\n    layers: IKlBasicLayer[];\r\n    transformIndex: number;\r\n}) {\r\n    /*\r\n    div\r\n        innerWrapper\r\n            klCanvasPreview\r\n            transform.div\r\n    */\r\n\r\n    let previewFit = BB.fitInto(\r\n        params.imageWidth,\r\n        params.imageHeight,\r\n        params.elementWidth - 20,\r\n        params.elementHeight - 60,\r\n        1\r\n    );\r\n    let scale = previewFit.width / params.imageWidth;\r\n\r\n    let div = BB.el({\r\n        css: {\r\n            width: params.elementWidth + \"px\",\r\n            height: params.elementHeight + \"px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            userSelect: \"none\",\r\n            position: \"relative\",\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    let innerWrapper = BB.el({\r\n        css: {\r\n            position: 'relative',\r\n            boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n            width: previewFit.width + 'px',\r\n            height: previewFit.height + 'px'\r\n        }\r\n    });\r\n    div.appendChild(innerWrapper);\r\n\r\n    let previewLayerArr = params.layers.map(item => {\r\n        return {\r\n            image: item.image,\r\n            mixModeStr: item.mixModeStr,\r\n            opacity: item.opacity,\r\n        }\r\n    });\r\n    previewLayerArr[previewLayerArr.length - 1].image = BB.canvas(\r\n        scale > 1 ? params.imageWidth : previewFit.width,\r\n        scale > 1 ? params.imageHeight : previewFit.height,\r\n    );\r\n    let klCanvasPreview = new KlCanvasPreview({\r\n        width: previewFit.width,\r\n        height: previewFit.height,\r\n        layers: previewLayerArr\r\n    });\r\n    innerWrapper.appendChild(klCanvasPreview.getElement());\r\n\r\n    let freeTransform;\r\n    let initTransform;\r\n    function updatePreview() {\r\n        if (!freeTransform) {\r\n            return;\r\n        }\r\n\r\n        let transform = freeTransform.getTransform();\r\n        if (scale < 1) {\r\n            transform.x *= scale;\r\n            transform.y *= scale;\r\n            transform.width *= scale;\r\n            transform.height *= scale;\r\n        }\r\n\r\n        let destCanvas = previewLayerArr[params.transformIndex].image;\r\n        let ctx = (destCanvas as HTMLCanvasElement).getContext('2d');\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, destCanvas.width, destCanvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            ctx,\r\n            params.layers[params.transformIndex].image,\r\n            transform,\r\n            null,\r\n            BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n        );\r\n        ctx.restore();\r\n        klCanvasPreview.render();\r\n    }\r\n\r\n    {\r\n        let transformSize = {\r\n            width: params.layers[params.transformIndex].image.width * scale,\r\n            height: params.layers[params.transformIndex].image.height * scale\r\n        };\r\n        if (transformSize.width > previewFit.width || transformSize.height > previewFit.height) {\r\n            transformSize = BB.fitInto(\r\n                params.layers[params.transformIndex].image.width,\r\n                params.layers[params.transformIndex].image.height,\r\n                previewFit.width,\r\n                previewFit.height,\r\n                1\r\n            );\r\n        }\r\n        initTransform = {\r\n            x: params.imageWidth / 2,\r\n            y: params.imageHeight / 2,\r\n            width: params.layers[params.transformIndex].image.width,\r\n            height: params.layers[params.transformIndex].image.height,\r\n        };\r\n        freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: 0,\r\n            isConstrained: true,\r\n            snapX: [0, params.imageWidth],\r\n            snapY: [0, params.imageHeight],\r\n            scale: scale,\r\n            callback: (transform) => {\r\n                updatePreview();\r\n            },\r\n        });\r\n    }\r\n    BB.css(freeTransform.getElement(), {\r\n        position: 'absolute',\r\n        left: '0',\r\n        top: '0'\r\n    });\r\n    innerWrapper.appendChild(freeTransform.getElement());\r\n    setTimeout(updatePreview, 0);\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.move = function(dX, dY) {\r\n        freeTransform.move(dX, dY);\r\n    };\r\n    this.reset = function() {\r\n        let w = params.layers[params.transformIndex].image.width;\r\n        let h = params.layers[params.transformIndex].image.height;\r\n\r\n        freeTransform.setSize(w, h);\r\n        freeTransform.setPos({x: w / 2, y: h / 2});\r\n        freeTransform.setAngleDeg(0);\r\n        updatePreview();\r\n    };\r\n    this.setTransformFit = function() {\r\n\r\n        let fit = BB.fitInto(\r\n            params.layers[params.transformIndex].image.width,\r\n            params.layers[params.transformIndex].image.height,\r\n            params.imageWidth,\r\n            params.imageHeight,\r\n            1\r\n        );\r\n\r\n        freeTransform.setSize(fit.width, fit.height);\r\n        freeTransform.setPos({x: fit.width / 2, y: fit.height / 2});\r\n        freeTransform.setAngleDeg(0);\r\n        updatePreview();\r\n    };\r\n    this.setTransformCenter = function() {\r\n        freeTransform.setPos({x: params.imageWidth / 2, y: params.imageHeight / 2});\r\n        freeTransform.setAngleDeg(0);\r\n        updatePreview();\r\n    };\r\n    //gives you the transformation in the original scale\r\n    this.getTransformation = function () {\r\n        if (!freeTransform) {\r\n            return false;\r\n        }\r\n        return freeTransform.getTransform();\r\n    };\r\n    this.getIsPixelated = () => {\r\n        const transform = freeTransform.getTransform();\r\n        return BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height);\r\n    };\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.destroy = function() {\r\n        freeTransform.destroy();\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/*\r\n\tCropper params\r\n\t{\r\n\t\tx: int, //pos in relation zum bild\r\n\t\ty: int,\r\n\t\tw: int,\r\n\t\th: int,\r\n\t\tscale: float, //zoom\r\n\t\tcallback: function //wenn sich was ndert\r\n\t}\r\n\tthe div that you append this to must be relative\r\n*/\r\nexport function Cropper (params) {\r\n    let x = params.x,\r\n        y = params.y,\r\n        width = params.width,\r\n        height = params.height,\r\n        scale = params.scale,\r\n        callback = params.callback,\r\n        maxW = params.maxW,\r\n        maxH = params.maxH;\r\n    let div = document.createElement(\"div\");\r\n    let gripCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n\r\n    let keyListener = new BB.KeyListener({});\r\n\r\n    BB.css(div, {\r\n        position: \"absolute\",\r\n        left: (x * scale) + \"px\",\r\n        top: (y * scale) + \"px\"\r\n    });\r\n\r\n    let outline = document.createElement(\"div\");\r\n    BB.css(outline, {\r\n        position: \"absolute\",\r\n        border: \"1px dashed #fff\",\r\n        cursor: \"move\"\r\n    });\r\n    (outline as any).update = function () {\r\n        BB.css(outline, {\r\n            left: (grips[0].x * scale - 1) + \"px\",\r\n            top: (grips[0].y * scale - 1) + \"px\",\r\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\r\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\r\n        });\r\n    };\r\n    let pointerRemainder = { // needs to be reset after dragging complete\r\n        x: 0,\r\n        y: 0,\r\n    };\r\n    let outlinePointerListener = new BB.PointerListener({\r\n        target: outline,\r\n        onPointer: function(event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n\r\n                grips[0].x += dX;\r\n                grips[0].y += dY;\r\n                grips[1].x += dX;\r\n                grips[1].y += dY;\r\n                grips[2].x += dX;\r\n                grips[2].y += dY;\r\n                grips[3].x += dX;\r\n                grips[3].y += dY;\r\n\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n\r\n    let thirdsHorizontal = document.createElement(\"div\");\r\n    BB.css(thirdsHorizontal, {\r\n        position: \"absolute\",\r\n        borderTop: \"1px solid #0ff\",\r\n        borderBottom: \"1px solid #0ff\"\r\n    });\r\n    (thirdsHorizontal as any).update = function () {\r\n        BB.css(thirdsHorizontal, {\r\n            left: (grips[0].x * scale) + \"px\",\r\n            top: ((grips[0].y + (grips[2].y - grips[0].y) / 3) * scale) + \"px\",\r\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\r\n            height: ((grips[2].y - grips[0].y) / 3 * scale) + \"px\"\r\n\r\n        });\r\n    };\r\n    let thirdsVertical = document.createElement(\"div\");\r\n    BB.css(thirdsVertical, {\r\n        position: \"absolute\",\r\n        borderLeft: \"1px solid #0ff\",\r\n        borderRight: \"1px solid #0ff\"\r\n    });\r\n    (thirdsVertical as any).update = function () {\r\n        BB.css(thirdsVertical, {\r\n            left: ((grips[0].x + (grips[2].x - grips[0].x) / 3) * scale) + \"px\",\r\n            top: (grips[0].y * scale) + \"px\",\r\n            width: ((grips[2].x - grips[0].x) / 3 * scale) + \"px\",\r\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\r\n\r\n        });\r\n    };\r\n\r\n    const gripSize = 40;\r\n    const gripOverlay = 10;\r\n\r\n    let grips: {\r\n        x: number; // int\r\n        y: number;\r\n    }[] = [ // aka corner coordinates\r\n        {x: 0, y: 0}, // top left\r\n        {x: width, y: 0}, // top right\r\n        {x: width, y: height}, // bottom right\r\n        {x: 0, y: height}, //bottom left\r\n    ];\r\n\r\n    function transformTop(dY) {\r\n        grips[0].y += dY;\r\n        grips[0].y = Math.max(grips[3].y - maxH, Math.min(grips[3].y - 1, grips[0].y));\r\n        grips[1].y = grips[0].y;\r\n    }\r\n    function transformRight(dX) {\r\n        grips[1].x += dX;\r\n        grips[1].x = Math.min(grips[0].x + maxW, Math.max(grips[0].x + 1, grips[1].x));\r\n        grips[2].x = grips[1].x;\r\n    }\r\n    function transformBottom(dY) {\r\n        grips[2].y += dY;\r\n        grips[2].y = Math.min(grips[1].y + maxH, Math.max(grips[1].y + 1, grips[2].y));\r\n        grips[3].y = grips[2].y;\r\n    }\r\n    function transformLeft(dX) {\r\n        grips[0].x += dX;\r\n        grips[0].x = Math.max(grips[1].x - maxW, Math.min(grips[1].x - 1, grips[0].x));\r\n        grips[3].x = grips[0].x;\r\n    }\r\n\r\n    function commit() {\r\n        pointerRemainder.x = 0;\r\n        pointerRemainder.y = 0;\r\n        callback(getTransform());\r\n    }\r\n\r\n\r\n\r\n\r\n    let edges = [];\r\n    for (let i = 0; i < 4; i++) {\r\n        (function (i) {\r\n            edges[i] = document.createElement(\"div\");\r\n            let g = edges[i];\r\n            g.style.width = gripSize + \"px\";\r\n            g.style.height = gripSize + \"px\";\r\n            //g.style.background = \"#0f0\";\r\n            g.style.position = \"absolute\";\r\n            g.update = function () {\r\n                if (i === 0) { //top\r\n                    g.style.left = (grips[0].x * scale + gripOverlay) + \"px\";\r\n                    g.style.top = (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\";\r\n                    g.style.width = ((grips[1].x - grips[0].x) * scale - gripOverlay * 2) + \"px\";\r\n                    g.style.height = (gripSize * 2) + \"px\";\r\n                } else if (i === 1) { //right\r\n                    g.style.left = (grips[1].x * scale - gripOverlay) + \"px\";\r\n                    g.style.top = (grips[1].y * scale + gripOverlay) + \"px\";\r\n                    g.style.width = (gripSize * 2) + \"px\";\r\n                    g.style.height = ((grips[2].y - grips[1].y) * scale - gripOverlay * 2) + \"px\";\r\n                } else if (i === 2) { //bottom\r\n                    g.style.left = (grips[3].x * scale + gripOverlay) + \"px\";\r\n                    g.style.top = (grips[3].y * scale - gripOverlay) + \"px\";\r\n                    g.style.width = ((grips[2].x - grips[3].x) * scale - gripOverlay * 2) + \"px\";\r\n                    g.style.height = (gripSize * 2) + \"px\";\r\n                } else if (i === 3) { //left\r\n                    g.style.left = (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\";\r\n                    g.style.top = (grips[0].y * scale + gripOverlay) + \"px\";\r\n                    g.style.width = (gripSize * 2) + \"px\";\r\n                    g.style.height = ((grips[3].y - grips[0].y) * scale - gripOverlay * 2) + \"px\";\r\n                }\r\n                let angleOffset = i * 2 + 1;\r\n                g.style.cursor = gripCursors[angleOffset] + \"-resize\";\r\n\r\n            };\r\n        })(i);\r\n    }\r\n\r\n    let darken = [];\r\n    for (let i = 0; i < 4; i++) {\r\n        (function (i) {\r\n            darken[i] = document.createElement(\"div\");\r\n            let g = darken[i];\r\n            g.style.position = \"absolute\";\r\n            g.style.background = \"#000\";\r\n            g.style.opacity = \"0.5\";\r\n            g.update = function () {\r\n                if (i === 0) {\r\n                    g.style.left = (grips[0].x * scale) + \"px\";\r\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\r\n                    g.style.width = ((grips[1].x - grips[0].x) * scale) + \"px\";\r\n                    g.style.height = \"8000px\";\r\n                } else if (i === 1) {\r\n                    g.style.left = (grips[1].x * scale) + \"px\";\r\n                    g.style.top = (grips[1].y * scale - 8000) + \"px\";\r\n                    g.style.width = \"8000px\";\r\n                    g.style.height = 16000 + \"px\";\r\n                } else if (i === 2) {\r\n                    g.style.left = (grips[3].x * scale) + \"px\";\r\n                    g.style.top = (grips[3].y * scale) + \"px\";\r\n                    g.style.width = ((grips[2].x - grips[3].x) * scale) + \"px\";\r\n                    g.style.height = \"8000px\";\r\n                } else if (i === 3) {\r\n                    g.style.left = (grips[0].x * scale - 8000) + \"px\";\r\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\r\n                    g.style.width = \"8000px\";\r\n                    g.style.height = 16000 + \"px\";\r\n                }\r\n\r\n            };\r\n        })(i);\r\n    }\r\n\r\n    let edge0PointerListener = new BB.PointerListener({\r\n        target: edges[0],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformTop(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformBottom(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    let edge1PointerListener = new BB.PointerListener({\r\n        target: edges[1],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformRight(dX);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformLeft(-dX);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    let edge2PointerListener = new BB.PointerListener({\r\n        target: edges[2],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformBottom(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformTop(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    let edge3PointerListener = new BB.PointerListener({\r\n        target: edges[3],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformLeft(dX);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformRight(-dX);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    let cornerElArr = [];\r\n    (function() {\r\n        for (let i = 0; i < 4; i++) {\r\n            (function (i) {\r\n                cornerElArr[i] = document.createElement(\"div\");\r\n                let g = cornerElArr[i];\r\n                BB.css(g, {\r\n                    //background: '#f00',\r\n                    width: (gripSize * 2) + 'px',\r\n                    height: (gripSize * 2) + 'px',\r\n                    position: 'absolute'\r\n                });\r\n                g.style.cursor = ['nwse-resize', 'nesw-resize'][i % 2];\r\n                g.update = function () {\r\n                    if (i === 0) { //top left\r\n                        BB.css(g, {\r\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\r\n                            top: (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\"\r\n                        });\r\n                    } else if (i === 1) { //top right\r\n                        BB.css(g, {\r\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\r\n                            top: (grips[1].y * scale - gripSize * 2 + gripOverlay) + \"px\"\r\n                        });\r\n                    } else if (i === 2) { //bottom right\r\n                        BB.css(g, {\r\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\r\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\r\n                        });\r\n                    } else if (i === 3) { //bottom left\r\n                        BB.css(g, {\r\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\r\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\r\n                        });\r\n                    }\r\n                };\r\n            })(i);\r\n        }\r\n    })();\r\n    //top left\r\n    let corner0PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[0],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformLeft(dX);\r\n                transformTop(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformRight(-dX);\r\n                    transformBottom(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    //top right\r\n    let corner1PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[1],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformRight(dX);\r\n                transformTop(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformLeft(-dX);\r\n                    transformBottom(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    //bottom right\r\n    let corner2PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[2],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformRight(dX);\r\n                transformBottom(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformLeft(-dX);\r\n                    transformTop(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    //bottom left\r\n    let corner3PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[3],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformLeft(dX);\r\n                transformBottom(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformRight(-dX);\r\n                    transformTop(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n\r\n\r\n    function getTransform() {\r\n        grips[1].x -= grips[0].x;\r\n        grips[1].y -= grips[0].y;\r\n        grips[2].x -= grips[0].x;\r\n        grips[2].y -= grips[0].y;\r\n        grips[3].x -= grips[0].x;\r\n        grips[3].y -= grips[0].y;\r\n        x += grips[0].x;\r\n        y += grips[0].y;\r\n        grips[0].x = 0;\r\n        grips[0].y = 0;\r\n        return {\r\n            x: x,\r\n            y: y,\r\n            width: grips[1].x,\r\n            height: grips[2].y\r\n        };\r\n    }\r\n\r\n\r\n    div.append(\r\n        darken[1],\r\n        darken[0],\r\n        darken[2],\r\n        darken[3],\r\n        thirdsHorizontal,\r\n        thirdsVertical,\r\n        outline,\r\n\r\n        edges[1],\r\n        edges[0],\r\n        edges[2],\r\n        edges[3],\r\n\r\n        cornerElArr[0],\r\n        cornerElArr[1],\r\n        cornerElArr[2],\r\n        cornerElArr[3],\r\n    );\r\n\r\n\r\n    function update() {\r\n\r\n        edges[0].update();\r\n        edges[1].update();\r\n        edges[2].update();\r\n        edges[3].update();\r\n        cornerElArr[0].update();\r\n        cornerElArr[1].update();\r\n        cornerElArr[2].update();\r\n        cornerElArr[3].update();\r\n        darken[0].update();\r\n        darken[1].update();\r\n        darken[2].update();\r\n        darken[3].update();\r\n        (outline as any).update();\r\n        (thirdsHorizontal as any).update();\r\n        (thirdsVertical as any).update();\r\n    }\r\n\r\n    update();\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getTransform = getTransform;\r\n\r\n    this.setTransform = function (p) {\r\n        x = p.x;\r\n        y = p.y;\r\n        width = p.width;\r\n        height = p.height;\r\n\r\n        BB.css(div, {\r\n            left: (x * scale) + \"px\",\r\n            top: (y * scale) + \"px\"\r\n        });\r\n\r\n        grips[0].x = 0;\r\n        grips[0].y = 0;\r\n        grips[1].x = width;\r\n        grips[1].y = 0;\r\n        grips[2].x = width;\r\n        grips[2].y = height;\r\n        grips[3].x = 0;\r\n        grips[3].y = height;\r\n\r\n        update();\r\n        commit();\r\n    };\r\n\r\n    this.setScale = function (s) {\r\n        scale = s;\r\n        BB.css(div, {\r\n            left: (x * scale) + \"px\",\r\n            top: (y * scale) + \"px\"\r\n        });\r\n        update();\r\n    };\r\n\r\n    this.showThirds = function (b) {\r\n        if (b) {\r\n            thirdsHorizontal.style.display = \"block\";\r\n            thirdsVertical.style.display = \"block\";\r\n        } else {\r\n            thirdsHorizontal.style.display = \"none\";\r\n            thirdsVertical.style.display = \"none\";\r\n        }\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.destroy = function() {\r\n        keyListener.destroy();\r\n        outlinePointerListener.destroy();\r\n        corner0PointerListener.destroy();\r\n        corner1PointerListener.destroy();\r\n        corner2PointerListener.destroy();\r\n        corner3PointerListener.destroy();\r\n        edge0PointerListener.destroy();\r\n        edge1PointerListener.destroy();\r\n        edge2PointerListener.destroy();\r\n        edge3PointerListener.destroy();\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Previews currently active layer\r\n * thumbnail (hover shows bigger preview), layername, opacity\r\n *\r\n * internally listens to kl history. updates when there's a change.\r\n * but you need to update it when the active layer changed. (different canvas object)\r\n *\r\n * update visibility for performance\r\n *\r\n * p = {\r\n *     onClick: function() // when clicking on layer name\r\n *     klRootEl: klRootEl,\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function LayerPreview(p) {\r\n\r\n    // internally redraws with in an interval. checks history is something changed\r\n    // this update will be animated\r\n    // it will not be animated if the resolution changed\r\n    // also redraws when you call updateLayer - not animated\r\n\r\n    // syncs via updateLayer, and internally updates layer opacity via a hack\r\n\r\n    let div = BB.el({});\r\n    let layerObj;\r\n    let isVisible = true;\r\n    const height = 40;\r\n    const canvasSize = height - 10;\r\n    const largeCanvasSize = 300;\r\n    let lastDrawnState = -2;\r\n    let lastDrawnSize = {\r\n        width: 0,\r\n        height: 0\r\n    };\r\n    let animationCanvas = BB.canvas(); // to help animate the transition\r\n    let animationCanvasCtx = animationCanvas.getContext('2d');\r\n    const animationLength = 30;\r\n    let animationCount = 0; // >0 means it's animating\r\n    let largeCanvasIsVisible = false;\r\n    let largeCanvasAnimationTimeout;\r\n    const largeCanvasAnimationDurationMs = 300;\r\n    let uiState = 'right'; // 'left' | 'right'\r\n\r\n\r\n    // --- setup dom ---\r\n    let contentWrapperEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            height: height + 'px',\r\n            color: '#666',\r\n        }\r\n    });\r\n    let canvasWrapperEl = BB.el({\r\n        css: {\r\n            //background: '#f00',\r\n            minWidth: height + 'px',\r\n            height: height + 'px',\r\n            display: 'flex',\r\n            justifyContent: 'center',\r\n            alignItems: 'center'\r\n        }\r\n    });\r\n    let canvas = BB.canvas(canvasSize, canvasSize);\r\n    let canvasCtx = canvas.getContext('2d');\r\n    canvas.title = LANG('layers-active-layer');\r\n    BB.css(canvas, {\r\n        boxShadow: '0 0 0 1px #9e9e9e',\r\n        colorScheme: 'only light',\r\n    });\r\n    let nameWrapper = BB.el({\r\n        css: {\r\n            //background: '#ff0',\r\n            flexGrow: '1',\r\n            paddingLeft: '10px',\r\n            fontSize: '13px',\r\n            overflow: 'hidden',\r\n            position: 'relative'\r\n        }\r\n    });\r\n    let nameLabelEl = BB.el({\r\n        content: '',\r\n        css: {\r\n            cssFloat: 'left',\r\n            whiteSpace: 'nowrap'\r\n        }\r\n    });\r\n    let nameFadeEl = BB.el({\r\n        css: {\r\n            backgroundImage: 'linear-gradient(to right, rgba(221,221,221,0) 0%, rgba(221,221,221,0.8) 100%)',\r\n            position: 'absolute',\r\n            right: \"0\",\r\n            top: \"0\",\r\n            width: \"50px\",\r\n            height: '100%'\r\n        }\r\n    });\r\n    let clickableEl = BB.el({\r\n        css: {\r\n            //background: 'rgba(0,255,0,0.6)',\r\n            position: 'absolute',\r\n            left: \"10px\",\r\n            top: \"0\",\r\n            width: \"90px\",\r\n            height: '100%'\r\n        }\r\n    });\r\n    if (p.onClick) {\r\n        BB.addEventListener(clickableEl,'click', function() {\r\n            p.onClick();\r\n        });\r\n        BB.addEventListener(canvas,'click', function() {\r\n            p.onClick();\r\n        });\r\n    }\r\n    let opacityEl = BB.el({\r\n        content: LANG('opacity') + '<br>100%',\r\n        css: {\r\n            minWidth: '60px',\r\n            fontSize: '12px',\r\n            textAlign: 'center',\r\n            background: '#dddddd',\r\n            color: '#555'\r\n        }\r\n    });\r\n\r\n    const largeCanvasWrapper = BB.el({\r\n        onClick: BB.handleClick,\r\n        css: {\r\n            pointerEvents: 'none',\r\n            background: '#fff',\r\n            position: 'absolute',\r\n            right: '280px',\r\n            top: '10px',\r\n            border: '1px solid #aaa',\r\n            boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\r\n            transition: 'opacity '+largeCanvasAnimationDurationMs+'ms ease-in-out',\r\n            userSelect: 'none',\r\n            display: 'block',\r\n            webkitTouchCallout: 'none',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    let largeCanvas = BB.canvas(largeCanvasSize, largeCanvasSize);\r\n    largeCanvasWrapper.append(largeCanvas);\r\n    let largeCanvasCtx = largeCanvas.getContext('2d');\r\n    BB.css(largeCanvas, {\r\n        display: 'block',\r\n    });\r\n\r\n    div.appendChild(contentWrapperEl);\r\n    contentWrapperEl.appendChild(canvasWrapperEl);\r\n    canvasWrapperEl.appendChild(canvas);\r\n    contentWrapperEl.appendChild(nameWrapper);\r\n    nameWrapper.appendChild(nameLabelEl);\r\n    nameWrapper.appendChild(nameFadeEl);\r\n    nameWrapper.appendChild(clickableEl);\r\n    contentWrapperEl.appendChild(opacityEl);\r\n\r\n\r\n    let animationCanvasCheckerPattern = animationCanvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\r\n    let largeCanvasCheckerPattern = canvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\r\n\r\n\r\n\r\n    // --- update logic ---\r\n\r\n    function animate() {\r\n        if (animationCount === 0) {\r\n            return;\r\n        }\r\n\r\n        animationCount--;\r\n\r\n        canvasCtx.save();\r\n        canvasCtx.globalAlpha = Math.pow((animationLength - animationCount) / animationLength, 2);\r\n        canvasCtx.drawImage(animationCanvas, 0, 0);\r\n        canvasCtx.restore();\r\n\r\n        if (animationCount > 0) {\r\n            requestAnimationFrame(animate);\r\n        }\r\n    }\r\n\r\n    function draw(isInstant) {\r\n\r\n        if (!isVisible) {\r\n            return;\r\n        }\r\n\r\n        nameLabelEl.textContent = layerObj.name;\r\n        opacityEl.innerHTML = LANG('opacity') + '<br>' + Math.round(layerObj.opacity * 100) + '%';\r\n\r\n        let layerCanvas = layerObj.context.canvas;\r\n\r\n        if (layerCanvas.width !== lastDrawnSize.width || layerCanvas.height !== lastDrawnSize.height) {\r\n            let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, canvasSize, canvasSize, 1);\r\n            canvas.width = Math.round(canvasDimensions.width);\r\n            canvas.height = Math.round(canvasDimensions.height);\r\n\r\n            isInstant = true;\r\n        }\r\n\r\n        animationCanvas.width = canvas.width;\r\n        animationCanvas.height = canvas.height;\r\n\r\n        animationCanvasCtx.save();\r\n        animationCanvasCtx.imageSmoothingEnabled = false;\r\n        animationCanvasCtx.fillStyle = animationCanvasCheckerPattern;\r\n        animationCanvasCtx.fillRect(0, 0, animationCanvas.width, animationCanvas.height);\r\n        animationCanvasCtx.drawImage(layerCanvas, 0, 0, animationCanvas.width, animationCanvas.height);\r\n        animationCanvasCtx.restore();\r\n\r\n        if (isInstant) {\r\n            animationCount = 0;\r\n            canvasCtx.save();\r\n            canvasCtx.drawImage(animationCanvas, 0, 0);\r\n            canvasCtx.restore();\r\n\r\n        } else {\r\n            animationCount = animationLength;\r\n            animate();\r\n\r\n        }\r\n\r\n        drawLargeCanvas();\r\n\r\n        lastDrawnState = klHistory.getState();\r\n        lastDrawnSize.width = layerCanvas.width;\r\n        lastDrawnSize.height = layerCanvas.height;\r\n    }\r\n\r\n    function update() {\r\n        draw(true);\r\n    }\r\n\r\n    setInterval(function() {\r\n\r\n        if (!layerObj) {\r\n            return;\r\n        }\r\n\r\n        let currentState = klHistory.getState();\r\n        if (currentState === lastDrawnState) {\r\n            return;\r\n        }\r\n\r\n        //update opacity w hack\r\n        layerObj.opacity = layerObj.context.canvas.opacity;\r\n\r\n        draw(false);\r\n\r\n    }, 2000);\r\n\r\n\r\n    //is always instant\r\n    function drawLargeCanvas() {\r\n\r\n        if (!largeCanvasIsVisible || !layerObj) {\r\n            return;\r\n        }\r\n\r\n        let layerCanvas = layerObj.context.canvas;\r\n\r\n        let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, largeCanvasSize, largeCanvasSize, 1);\r\n        largeCanvas.width = Math.round(canvasDimensions.width);\r\n        largeCanvas.height = Math.round(canvasDimensions.height);\r\n        largeCanvasCtx.save();\r\n        if (largeCanvas.width > layerCanvas.width) {\r\n            largeCanvasCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            largeCanvasCtx.imageSmoothingEnabled = true;\r\n            largeCanvasCtx.imageSmoothingQuality = 'high';\r\n        }\r\n        largeCanvasCtx.fillStyle = largeCanvasCheckerPattern;\r\n        largeCanvasCtx.fillRect(0, 0, largeCanvas.width, largeCanvas.height);\r\n        largeCanvasCtx.drawImage(layerCanvas, 0, 0, largeCanvas.width, largeCanvas.height);\r\n        largeCanvasCtx.restore();\r\n\r\n        const bounds = div.getBoundingClientRect();\r\n        BB.css(largeCanvasWrapper, {\r\n            top: Math.max(10, (bounds.top + height / 2 - largeCanvas.height / 2)) + \"px\"\r\n        });\r\n\r\n    }\r\n\r\n    function removeLargeCanvas() {\r\n        try {\r\n            p.klRootEl.removeChild(largeCanvasWrapper);\r\n        } catch(e) {\r\n\r\n        }\r\n    }\r\n\r\n    function showLargeCanvas(b) {\r\n        if (largeCanvasIsVisible === b) {\r\n            return;\r\n        }\r\n\r\n        clearTimeout(largeCanvasAnimationTimeout);\r\n        largeCanvasIsVisible = b;\r\n\r\n        if (b) {\r\n            largeCanvasAnimationTimeout = setTimeout(function() {\r\n                drawLargeCanvas();\r\n                largeCanvasWrapper.style.opacity = '0';\r\n                p.klRootEl.appendChild(largeCanvasWrapper);\r\n                setTimeout(function() {\r\n                    largeCanvasWrapper.style.opacity = '1';\r\n                }, 20);\r\n            }, 250);\r\n\r\n        } else {\r\n            largeCanvasWrapper.style.opacity = '0';\r\n            largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\r\n        }\r\n\r\n    }\r\n\r\n    let pointerListener = new BB.PointerListener({\r\n        target: canvas,\r\n        onEnterLeave: function(b) {\r\n            showLargeCanvas(b);\r\n        }\r\n    });\r\n\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(b) {\r\n        if (isVisible === b) {\r\n            return;\r\n        }\r\n        isVisible = b;\r\n        contentWrapperEl.style.display = isVisible ? 'flex' : 'none';\r\n        div.style.marginBottom = isVisible ? '' : '10px';\r\n\r\n        let currentState = klHistory.getState();\r\n        if (b && lastDrawnState !== currentState) {\r\n            update();\r\n        }\r\n    };\r\n\r\n    //when the layer might have changed\r\n    this.setLayer = function(klCanvasLayerObj) {\r\n        layerObj = klCanvasLayerObj;\r\n        update();\r\n    };\r\n\r\n    this.setUiState = function(stateStr) {\r\n        uiState = '' + stateStr;\r\n\r\n        if (uiState === 'left') {\r\n            BB.css(largeCanvasWrapper, {\r\n                left: '280px',\r\n                right: ''\r\n            });\r\n        } else {\r\n            BB.css(largeCanvasWrapper, {\r\n                left: '',\r\n                right: '280px'\r\n            });\r\n        }\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * fits image into a size\r\n * params: {\r\n *    image: image,\r\n *    width: int,\r\n *    height: int\r\n * }\r\n *\r\n * methods:\r\n * getDiv()\r\n *\r\n * @param params\r\n * @constructor\r\n */\r\nexport function FittedImage(params) {\r\n    let fit = BB.fitInto(params.image.width, params.image.height, params.width, params.height, 1);\r\n    let w = parseInt('' + fit.width);\r\n    let h = parseInt('' + fit.height);\r\n\r\n    let canvas = BB.canvas(w, h);\r\n\r\n    canvas.getContext(\"2d\").drawImage(params.image, 0, 0, w, h);\r\n    BB.css(canvas, {\r\n        display: \"block\",\r\n        boxShadow: \"0 0 0 1px #aaa\"\r\n    });\r\n\r\n    this.getElement = function() {\r\n        return canvas;\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\nimport {FreeTransformCanvas} from '../components/free-transform-canvas';\r\nimport {popup} from './popup';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {IKlBasicLayer} from '../../kl.types';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showImportAsLayerDialog(\r\n    params: {\r\n        target: HTMLElement;\r\n        klCanvas: KlCanvas;\r\n        importImage: HTMLImageElement | HTMLCanvasElement;\r\n        callback: (\r\n            p?: {x: number, y: number, width:number, height: number, angleDeg: number},\r\n            isPixelated?: boolean\r\n        ) => void;\r\n    }\r\n): void {\r\n\r\n    let div = document.createElement(\"div\");\r\n    BB.appendTextDiv(div, LANG('import-as-layer-description'));\r\n    if (params.klCanvas.isLayerLimitReached()) {\r\n        let noteEl = BB.el({\r\n            content: LANG('import-as-layer-limit-reached'),\r\n            css: {\r\n                background: '#ff0',\r\n                padding: '10px',\r\n                marginTop: '5px',\r\n                marginBottom: '5px',\r\n                border: '1px solid #e7d321',\r\n                borderRadius: '5px'\r\n            }\r\n        });\r\n        div.appendChild(noteEl);\r\n    }\r\n    let isSmall = window.innerWidth < 550;\r\n\r\n    let buttonRowEl = BB.el({\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n    let originalSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: '1:1',\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function() {\r\n            freeTransformCanvas.reset();\r\n        }\r\n    });\r\n    let fitSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('import-as-layer-fit'),\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function() {\r\n            freeTransformCanvas.setTransformFit();\r\n        }\r\n    });\r\n    let centerBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('center'),\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function() {\r\n            freeTransformCanvas.setTransformCenter();\r\n        }\r\n    });\r\n    buttonRowEl.appendChild(originalSizeBtn);\r\n    buttonRowEl.appendChild(fitSizeBtn);\r\n    buttonRowEl.appendChild(centerBtn);\r\n    div.appendChild(buttonRowEl);\r\n\r\n\r\n\r\n    let layers: IKlBasicLayer[] = [];\r\n    {\r\n        let klCanvasLayerArr = params.klCanvas.getLayers();\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            layers.push({\r\n                image: klCanvasLayerArr[i].context.canvas,\r\n                opacity: klCanvasLayerArr[i].opacity,\r\n                mixModeStr: klCanvasLayerArr[i].mixModeStr\r\n            });\r\n        }\r\n    }\r\n    layers.push({\r\n        image: params.importImage,\r\n        opacity: 1,\r\n        mixModeStr: 'source-over'\r\n    });\r\n\r\n\r\n    let freeTransformCanvas = new FreeTransformCanvas({\r\n        elementWidth: isSmall ? 340 : 540,\r\n        elementHeight: isSmall ? 280 : 350,\r\n        imageWidth: params.klCanvas.getLayerContext(0).canvas.width,\r\n        imageHeight: params.klCanvas.getLayerContext(0).canvas.height,\r\n        layers: layers,\r\n        transformIndex: layers.length - 1,\r\n    });\r\n    BB.css(freeTransformCanvas.getElement(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n    });\r\n    div.appendChild(freeTransformCanvas.getElement());\r\n\r\n    function move(x, y) {\r\n        freeTransformCanvas.move(x, y);\r\n    }\r\n\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr) {\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    popup({\r\n        target: params.target,\r\n        message: `<b>${LANG('import-as-layer-title')}</b>`,\r\n        div: div,\r\n        style: isSmall ? null : {\r\n            width: '500px'\r\n        },\r\n        buttons: [\"Ok\", \"Cancel\"],\r\n        clickOnEnter: 'Ok',\r\n        callback: function(buttonStr) {\r\n            keyListener.destroy();\r\n            freeTransformCanvas.destroy();\r\n            BB.destroyEl(originalSizeBtn);\r\n            BB.destroyEl(fitSizeBtn);\r\n            BB.destroyEl(centerBtn);\r\n            if (buttonStr === 'Ok') {\r\n                params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\r\n            } else {\r\n                params.callback();\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Not really generalized. UI when you drag/drop an image into window.\r\n * The moment you create it, it will listen.\r\n *\r\n * @param p object {onDrop: func(files, optionStr), target: DOM Element, enabledTest: func -> bool} - optionStr: 'default'|'layer'|'image'\r\n * @constructor\r\n */\r\nexport function KlImageDropper(p) {\r\n\r\n    //set up DOM\r\n    let rootEl = BB.el({\r\n        content: 'Drop to import',\r\n        css: {\r\n            paddingTop: '100px',\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n            background: 'rgba(50, 50, 50, 0.7)',\r\n            color: '#fff',\r\n            textShadow: '2px 2px #000',\r\n            textAlign: 'center',\r\n            fontSize: '25px'\r\n        }\r\n    });\r\n    let wrapperEl = BB.el({\r\n        css: {\r\n            'marginTop': '50px',\r\n            'display': 'flex',\r\n            'justifyContent': 'center'\r\n        }\r\n    });\r\n    let optionStyle = {\r\n        width: '200px',\r\n        padding: '50px',\r\n        margin: '10px',\r\n        //opacity: 0.5,\r\n        borderRadius: '20px',\r\n        border: '1px dashed #fff',\r\n        background: '#00aefe',\r\n        fontWeight: 'bold'\r\n    };\r\n    let optionLayerEl = BB.el({\r\n        content: 'As Layer',\r\n        css: optionStyle\r\n    });\r\n    let optionImageEl = BB.el({\r\n        content: 'As New Image',\r\n        css: optionStyle\r\n    });\r\n\r\n    rootEl.appendChild(wrapperEl);\r\n    wrapperEl.appendChild(optionLayerEl);\r\n    wrapperEl.appendChild(optionImageEl);\r\n\r\n\r\n    let rootCounter = 0;\r\n    let optionLayerCounter = 0;\r\n    let optionImageCounter = 0;\r\n\r\n    function destroy() {\r\n        rootCounter = 0;\r\n        optionLayerCounter = 0;\r\n        optionImageCounter = 0;\r\n        try {\r\n            p.target.removeChild(rootEl);\r\n        } catch (e) { }\r\n    }\r\n\r\n    function testAcceptType(event) {\r\n        try {\r\n            return !event.dataTransfer.types.includes('text/plain');\r\n        } catch(e) {\r\n\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function updateOptions() {\r\n        let boxShadow = '0 0 20px 4px #fff';\r\n        if (optionLayerCounter > 0) {\r\n            optionLayerEl.style.boxShadow = boxShadow;\r\n            optionImageEl.style.boxShadow = '';\r\n        } else if (optionImageCounter > 0) {\r\n            optionLayerEl.style.boxShadow = '';\r\n            optionImageEl.style.boxShadow = boxShadow;\r\n        } else {\r\n            optionLayerEl.style.boxShadow = '';\r\n            optionImageEl.style.boxShadow = '';\r\n        }\r\n    }\r\n\r\n    BB.addEventListener(optionLayerEl,'dragenter', function() {\r\n        optionLayerCounter++;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionLayerEl,'dragleave', function() {\r\n        optionLayerCounter--;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionImageEl,'dragenter', function() {\r\n        optionImageCounter++;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionImageEl,'dragleave', function() {\r\n        optionImageCounter--;\r\n        updateOptions();\r\n    });\r\n\r\n\r\n    function rootDragOver(event) {\r\n        if (!testAcceptType(event)) {\r\n            return;\r\n        }\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n    }\r\n    function rootDragEnter(event) {\r\n        if (!p.enabledTest() || !testAcceptType(event)) {\r\n            return;\r\n        }\r\n        if (rootCounter === 0) {\r\n            p.target.appendChild(rootEl);\r\n        }\r\n        rootCounter++;\r\n\r\n    }\r\n    function rootDragLeave(event) {\r\n        if (!testAcceptType(event) || rootCounter === 0) {\r\n            return;\r\n        }\r\n        rootCounter = Math.max(0, rootCounter - 1);\r\n        if (rootCounter === 0) {\r\n            p.target.removeChild(rootEl);\r\n        }\r\n\r\n    }\r\n    function rootDrop(event) {\r\n        if (!testAcceptType(event) || event.dataTransfer.files.length === 0) {\r\n            destroy();\r\n            return;\r\n        }\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n\r\n        let optionStr = 'default';\r\n        if (optionLayerCounter > 0) {\r\n            optionStr = 'layer';\r\n        } else if (optionImageCounter > 0) {\r\n            optionStr = 'image';\r\n        }\r\n\r\n        p.onDrop(event.dataTransfer.files, optionStr);\r\n\r\n\r\n        if (rootCounter > 0) {\r\n            p.target.removeChild(rootEl);\r\n        }\r\n        rootCounter = 0;\r\n        optionLayerCounter = 0;\r\n        optionImageCounter = 0;\r\n        updateOptions();\r\n    }\r\n\r\n    BB.addEventListener(window,'dragover', rootDragOver, false);\r\n    BB.addEventListener(window,'dragenter', rootDragEnter, false);\r\n    BB.addEventListener(window,'dragleave', rootDragLeave, false);\r\n    BB.addEventListener(window,'drop', rootDrop, false);\r\n\r\n    // if something goes wrong and you're stuck with overlay\r\n    BB.addEventListener(rootEl, 'pointerdown', function() {\r\n        destroy();\r\n    });\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr) {\r\n            if (rootCounter > 0 && keyStr === 'esc') {\r\n                destroy();\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KlSmallColorSlider} from '../base-components/kl-color-slider-small';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {BrushSettingService} from '../../brushes-ui/brush-setting-service';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Compressed HUD toolspace. When you hold ctrl+alt.\r\n * small color picker, brush settings\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function OverlayToolspace(\r\n    p: {\r\n        brushSettingService: BrushSettingService; // to sync with outside\r\n        enabledTest: () => boolean; // calls to see if it's allowed to show\r\n    }\r\n) {\r\n\r\n    const sizeObj = {\r\n        width: 150,\r\n        svHeight: 90,\r\n        hHeight: 20,\r\n        sliderHeight: 25\r\n    };\r\n\r\n    let isVisible = false;\r\n    const div = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            left: '500px',\r\n            top: '500px',\r\n            background: 'rgb(221, 221, 221)',\r\n            display: 'none',\r\n            border: '1px solid #fff',\r\n            boxShadow: '0 0 10px rgba(0,0,0,0.5)',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    const queuedObj = {\r\n        color: null,\r\n        size: null,\r\n        opacity: null\r\n    };\r\n\r\n\r\n    // --- inputs ---\r\n\r\n    //color selection\r\n    const colorSlider = new KlSmallColorSlider({\r\n        width: sizeObj.width,\r\n        heightSV: sizeObj.svHeight,\r\n        heightH: sizeObj.hHeight,\r\n        color: p.brushSettingService.getColor(),\r\n        callback: function (rgbObj) {\r\n            selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\r\n            p.brushSettingService.setColor(rgbObj, subscriptionFunc);\r\n        }\r\n    });\r\n    const selectedColorEl = BB.el({\r\n        css: {\r\n            width: sizeObj.width + 'px',\r\n            height: sizeObj.hHeight + 'px',\r\n            pointerEvents: 'none'\r\n        }\r\n    });\r\n    {\r\n        const initialColor = p.brushSettingService.getColor();\r\n        selectedColorEl.style.backgroundColor = \"rgb(\" + initialColor.r + \",\" + initialColor.g + \",\" + initialColor.b + \")\";\r\n    }\r\n\r\n    div.appendChild(selectedColorEl);\r\n    div.appendChild(colorSlider.getElement());\r\n\r\n\r\n    function updateColor(rgbObj) {\r\n        colorSlider.setColor(rgbObj);\r\n        selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    //brushsize slider\r\n\r\n    const sizeSlider = new KlSlider({\r\n        label: LANG('brush-size'),\r\n        width: sizeObj.width,\r\n        height: sizeObj.sliderHeight,\r\n        min: 0,\r\n        max: 500,\r\n        value: 50,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        toDisplayValue: (val) => val * 2,\r\n        toValue: (displayValue) => displayValue / 2,\r\n        onChange: function(v) {\r\n            p.brushSettingService.setSize(v);\r\n        },\r\n        formatFunc: (displayValue) => {\r\n            if (displayValue < 10) {\r\n                return BB.round(displayValue, 1);\r\n            } else {\r\n                return Math.round(displayValue);\r\n            }\r\n        },\r\n    });\r\n    BB.css(sizeSlider.getElement(), {\r\n        marginTop: '2px'\r\n    });\r\n    div.appendChild(sizeSlider.getElement());\r\n\r\n    const opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: sizeObj.width,\r\n        height: sizeObj.sliderHeight,\r\n        min: 0,\r\n        max: 1,\r\n        value: 1,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        toDisplayValue: (val) => val * 100,\r\n        toValue: (displayValue) => displayValue / 100,\r\n        onChange: function(v) {\r\n            p.brushSettingService.setOpacity(v);\r\n        },\r\n    });\r\n    BB.css(opacitySlider.getElement(), {\r\n        margin: '2px 0'\r\n    });\r\n    div.appendChild(opacitySlider.getElement());\r\n\r\n\r\n\r\n    // --- general setup ---\r\n\r\n    const subscriptionFunc = function(event) {\r\n        if (event.type === 'color') {\r\n            if (!isVisible) {\r\n                queuedObj.color = event.value;\r\n            } else {\r\n                updateColor(event.value);\r\n            }\r\n        }\r\n        if (event.type === 'size') {\r\n            if (!isVisible) {\r\n                queuedObj.size = event.value;\r\n            } else {\r\n                sizeSlider.setValue(event.value);\r\n            }\r\n        }\r\n        if (event.type === 'opacity') {\r\n            if (!isVisible) {\r\n                queuedObj.opacity = event.value;\r\n            } else {\r\n                opacitySlider.setValue(event.value);\r\n            }\r\n        }\r\n        if (event.type === 'sliderConfig') {\r\n            sizeSlider.update(event.value.sizeSlider);\r\n            opacitySlider.update(event.value.opacitySlider);\r\n        }\r\n    };\r\n    p.brushSettingService.subscribe(subscriptionFunc);\r\n    {\r\n        const sliderConfig = p.brushSettingService.getSliderConfig();\r\n        sizeSlider.update(sliderConfig.sizeSlider);\r\n        opacitySlider.update(sliderConfig.opacitySlider);\r\n        sizeSlider.setValue(p.brushSettingService.getSize());\r\n        opacitySlider.setValue(p.brushSettingService.getOpacity());\r\n    }\r\n\r\n    function updateUI() {\r\n\r\n        // unfocus manual slider input\r\n        BB.unfocusAnyInput();\r\n\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible && mousePos) {\r\n            div.style.left = (mousePos.x - Math.round(sizeObj.width / 2)) + 'px';\r\n            div.style.top = (mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2)) + 'px';\r\n        }\r\n    }\r\n\r\n    let mousePos = null;\r\n    BB.addEventListener(document, 'pointermove', function(event) {\r\n        mousePos = {\r\n            x: event.pageX,\r\n            y: event.pageY,\r\n        };\r\n    });\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, event, comboStr, isRepeat) {\r\n            if (isRepeat) {\r\n                return;\r\n            }\r\n            if (isVisible) {\r\n                isVisible = false;\r\n                updateUI();\r\n                return;\r\n            }\r\n\r\n            if (!p.enabledTest() || !mousePos) {\r\n                return;\r\n            }\r\n\r\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(comboStr)) {\r\n                event.preventDefault();\r\n                isVisible = true;\r\n\r\n                if (queuedObj.color !== null) {\r\n                    updateColor(queuedObj.color);\r\n                    queuedObj.color = null;\r\n                }\r\n                if (queuedObj.size !== null) {\r\n                    sizeSlider.setValue(queuedObj.size);\r\n                    queuedObj.size = null;\r\n                }\r\n                if (queuedObj.opacity !== null) {\r\n                    opacitySlider.setValue(queuedObj.opacity);\r\n                    queuedObj.opacity = null;\r\n                }\r\n\r\n                updateUI();\r\n            }\r\n\r\n        },\r\n        onUp: function(keyStr, event, oldComboStr) {\r\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(oldComboStr) && isVisible) {\r\n                isVisible = false;\r\n                colorSlider.end();\r\n                updateUI();\r\n            }\r\n        },\r\n        onBlur: function() {\r\n            if (isVisible) {\r\n                isVisible = false;\r\n                colorSlider.end();\r\n                updateUI();\r\n            }\r\n        }\r\n    });\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * Topmost row of buttons in toolspace (with the app logo)\r\n *\r\n * p = { // button click callbacks\r\n *      logoImg: img,\r\n *     onLogo: function(),\r\n *     onNew: function(),\r\n *     onImport: function(),\r\n *     onSave: function(),\r\n *     onShare: function(),\r\n *     onHelp: function()\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceTopRow(p) {\r\n    let div = document.createElement('div');\r\n    BB.css(div, {\r\n        height: '36px',\r\n        //background: '#f00',\r\n        display: 'flex',\r\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n    });\r\n\r\n    function createButton(p) {\r\n        let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n        let result = BB.el({\r\n            className: 'toolspace-row-button nohighlight',\r\n            title: p.title,\r\n            onClick: p.onClick,\r\n            css: {\r\n                padding: p.contain ? padding + 'px 0' : ''\r\n            }\r\n        });\r\n        let im = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: p.contain ? 'contain' : '',\r\n                //filter: 'grayscale(1)',\r\n                height: '100%'\r\n            }\r\n        });\r\n        im.style.pointerEvents = 'none';\r\n        result.appendChild(im);\r\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: result,\r\n            onEnterLeave: function(isOver) {\r\n                result.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n        return result;\r\n    }\r\n\r\n    let logoButton = createButton({\r\n        onClick: p.onLogo,\r\n        title: LANG('home'),\r\n        image: p.logoImg ? p.logoImg : klecksLogoImg,\r\n        contain: true\r\n    });\r\n    logoButton.style.width = '45px';\r\n    logoButton.style.borderRight = '1px solid rgb(212, 212, 212)';\r\n    let newButton = createButton({\r\n        onClick: p.onNew,\r\n        title: LANG('file-new'),\r\n        image: newImageImg,\r\n        extraPadding: 1,\r\n        contain: true\r\n    });\r\n    let importButton = createButton({\r\n        onClick: p.onImport,\r\n        title: LANG('file-import'),\r\n        image: importImg,\r\n        extraPadding: 1,\r\n        contain: true\r\n    });\r\n    let saveButton = createButton({\r\n        onClick: p.onSave,\r\n        title: LANG('file-save'),\r\n        image: exportImg,\r\n        extraPadding: 1,\r\n        contain: true\r\n    });\r\n\r\n    let shareButton = null;\r\n    if (BB.canShareFiles()) {\r\n        shareButton = createButton({\r\n            onClick: p.onShare,\r\n            title: LANG('file-share'),\r\n            image: shareImg,\r\n            contain: true\r\n        });\r\n    }\r\n    let helpButton = createButton({\r\n        onClick: p.onHelp,\r\n        title: LANG('help'),\r\n        image: helpImg,\r\n        contain: true\r\n    });\r\n\r\n    div.appendChild(logoButton);\r\n    div.appendChild(newButton);\r\n    div.appendChild(importButton);\r\n    div.appendChild(saveButton);\r\n    if (shareButton) {\r\n        div.appendChild(shareButton);\r\n    }\r\n    div.appendChild(helpButton);\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    }\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eHdqz\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3x5dR\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hbDTd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"16iGk\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2ME3z\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hZnSk\");","import {BB} from '../../../bb/bb';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n// @ts-ignore\r\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\r\n// @ts-ignore\r\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\r\n// @ts-ignore\r\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\r\n// @ts-ignore\r\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\r\n// @ts-ignore\r\nimport caretDownImg from 'url:~/src/app/img/ui/caret-down.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Toolrow Dropdown. The button where you select: brush, fill, select, transform, etc.\r\n *\r\n * p = {\r\n *     onChange: func(activeStr)\r\n * }\r\n *\r\n * activeStr = 'draw' | 'fill' | 'text'\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolDropdown(p) {\r\n\r\n    let optionArr = ['draw', 'fill', 'text', 'shape'];\r\n    let imArr = [\r\n        toolPaintImg,\r\n        toolFillImg,\r\n        toolTextImg,\r\n        toolShapeImg\r\n    ];\r\n    let titleArr = [\r\n        `${LANG('tool-brush')} [B]`,\r\n        `${LANG('tool-paint-bucket')} [G]`,\r\n        `${LANG('tool-text')} [T]`,\r\n        `${LANG('tool-shape')} [U]`,\r\n    ];\r\n    let currentActiveIndex = 0;\r\n    let isActive = true;\r\n    let isOpen = false;\r\n\r\n    //preload images\r\n    setTimeout(function() {\r\n        for (let i = 1; i < imArr.length; i++) {\r\n            let im = new Image();\r\n            im.src = imArr[i];\r\n        }\r\n    }, 100);\r\n\r\n    let smallMargin = '6px 0';\r\n    let div = BB.el({\r\n        css: {\r\n            position: 'relative',\r\n            flexGrow: '1'\r\n        }\r\n    });\r\n\r\n    let openTimeout;\r\n    let isDragging = false;\r\n    let startX, startY;\r\n    let pointerListener;\r\n    if (BB.hasPointerEvents) {\r\n        pointerListener = new BB.PointerListener({\r\n            target: div,\r\n            maxPointers: 1,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown') {\r\n                    if (isOpen) {\r\n                        return;\r\n                    }\r\n\r\n                    openTimeout = setTimeout(function() {\r\n                        showDropdown();\r\n                    }, 400);\r\n                    isDragging = true;\r\n                    startX = event.pageX;\r\n                    startY = event.pageY;\r\n\r\n                } else if (event.type === 'pointermove') {\r\n                    if (isDragging && !isOpen && BB.dist(startX, startY, event.pageX, event.pageY) > 5) {\r\n                        clearTimeout(openTimeout);\r\n                        showDropdown();\r\n                    }\r\n\r\n                } else if (event.type === 'pointerup') {\r\n                    clearTimeout(openTimeout);\r\n                    if (isOpen && isDragging) {\r\n                        let target = document.elementFromPoint(event.pageX, event.pageY);\r\n                        for (let i = 0; i < dropdownBtnArr.length; i++) {\r\n                            if (target === dropdownBtnArr[i].wrapper) {\r\n                                closeDropdown();\r\n                                isActive = true;\r\n                                currentActiveIndex = i;\r\n                                updateButton();\r\n                                p.onChange(optionArr[currentActiveIndex]);\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                    isDragging = false;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    let activeButton = BB.el({\r\n        parent: div,\r\n        className: 'toolspace-row-button nohighlight toolspace-row-button-activated',\r\n        title: titleArr[currentActiveIndex],\r\n        onClick: function(e) {\r\n            if (isActive && !isOpen) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                showDropdown();\r\n                return;\r\n            }\r\n\r\n            isActive = true;\r\n            p.onChange(optionArr[currentActiveIndex]);\r\n            if (isOpen) {\r\n                closeDropdown();\r\n            }\r\n        },\r\n        css: {\r\n            padding: '10px 0',\r\n            pointerEvents: 'auto',\r\n            height: '100%',\r\n            boxSizing: 'border-box'\r\n        }\r\n    });\r\n\r\n    let activeButtonIm = BB.el({\r\n        parent: activeButton,\r\n        css: {\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            backgroundSize: 'contain',\r\n            width: 'calc(100% - 7px)',\r\n            height: '100%',\r\n            pointerEvents: 'none',\r\n            opacity: '0.75',\r\n        }\r\n    });\r\n\r\n    let arrowButton = BB.el({\r\n        parent: activeButton,\r\n        css: {\r\n            position: 'absolute',\r\n            right: '1px',\r\n            bottom: '1px',\r\n            width: '18px',\r\n            height: '18px',\r\n            //background: '#aaa',\r\n            //borderRadius: '2px',\r\n            cursor: 'pointer',\r\n\r\n            backgroundImage: 'url(\\'' + caretDownImg + '\\')',\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            backgroundSize: '60%'\r\n        },\r\n        title: 'More Tools',\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            showDropdown();\r\n        }\r\n    });\r\n\r\n\r\n    let overlay = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            //background: 'rgba(255,0,0,0.5)',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0'\r\n        }\r\n    });\r\n    let overlayPointerListener = new BB.PointerListener({\r\n        target: overlay,\r\n        pointers: 1,\r\n        onPointer: function(e) {\r\n            if (e.type === 'pointerdown') {\r\n                e.eventPreventDefault();\r\n                closeDropdown();\r\n            }\r\n        }\r\n    });\r\n\r\n    let dropdownWrapper = BB.el({\r\n        className: 'tool-dropdown-wrapper',\r\n        css: {\r\n            position: 'absolute',\r\n            width: '100%',\r\n            height: (100 * (optionArr.length - 1)) + '%',\r\n            top: '100%',\r\n            left: '0',\r\n            zIndex: '1',\r\n            boxSizing: 'border-box',\r\n            cursor: 'pointer',\r\n            transition: 'height 0.1s ease-in-out, opacity 0.1s ease-in-out',\r\n            borderBottomLeftRadius: '5px',\r\n            borderBottomRightRadius: '5px',\r\n            overflow: 'hidden',\r\n        }\r\n    });\r\n\r\n    let dropdownBtnArr = [];\r\n\r\n    function createDropdownButton(p) {\r\n        let result = {};\r\n\r\n        let wrapper = BB.el({\r\n            parent: dropdownWrapper,\r\n            className: 'tool-dropdown-button',\r\n            title: p.title,\r\n            css: {\r\n                padding: '10px 0',\r\n                height: (100 / (optionArr.length - 1)) + '%',\r\n                boxSizing: 'border-box'\r\n            },\r\n            onClick: function(e) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                p.onClick(p.index, p.id);\r\n            }\r\n        });\r\n        (result as any).wrapper = wrapper;\r\n        let im = BB.el({\r\n            parent: wrapper,\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: 'contain',\r\n                height: '100%',\r\n                pointerEvents: 'none',\r\n                opacity: '0.75'\r\n            }\r\n        });\r\n\r\n        // --- interface ---\r\n        (result as any).show = function(b) {\r\n            wrapper.style.display = b ? 'block' : 'none';\r\n        };\r\n\r\n        (result as any).setIsSmall = function(b) {\r\n            wrapper.style.padding = b ? smallMargin : '10px 0';\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    function onClickDropdownBtn(index, id) {\r\n        closeDropdown();\r\n\r\n        isActive = true;\r\n        currentActiveIndex = index;\r\n\r\n        updateButton();\r\n\r\n        p.onChange(optionArr[currentActiveIndex]);\r\n    }\r\n\r\n    for (let i = 0; i < optionArr.length; i++) {\r\n        dropdownBtnArr.push(createDropdownButton({\r\n            index: i,\r\n            id: optionArr[i],\r\n            image: imArr[i],\r\n            title: titleArr[i],\r\n            onClick: onClickDropdownBtn\r\n        }));\r\n    }\r\n\r\n    function showDropdown() {\r\n        dialogCounter.increase(0.5);\r\n        isOpen = true;\r\n\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            dropdownBtnArr[i].show(currentActiveIndex !== i);\r\n        }\r\n\r\n        arrowButton.style.display = 'none';\r\n        div.style.zIndex = '1';\r\n        document.body.appendChild(overlay);\r\n        div.appendChild(dropdownWrapper);\r\n    }\r\n\r\n    function closeDropdown() {\r\n        dialogCounter.decrease(0.5);\r\n        isOpen = false;\r\n        arrowButton.style.removeProperty('display');\r\n        div.style.removeProperty('z-index');\r\n        document.body.removeChild(overlay);\r\n\r\n        div.removeChild(dropdownWrapper);\r\n    }\r\n\r\n    function updateButton() {\r\n        activeButton.title = titleArr[currentActiveIndex];\r\n        activeButtonIm.style.backgroundImage = 'url(\\'' + imArr[currentActiveIndex] + '\\')';\r\n    }\r\n    updateButton();\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.setIsSmall = function(b) {\r\n        activeButton.style.padding = b ? smallMargin : '10px 0';\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            dropdownBtnArr[i].setIsSmall(b);\r\n        }\r\n        if (b) {\r\n            arrowButton.style.width = '14px';\r\n            arrowButton.style.height = '14px';\r\n        } else {\r\n            arrowButton.style.width = '18px';\r\n            arrowButton.style.height = '18px';\r\n        }\r\n    };\r\n\r\n    this.setActive = function(activeStr) {\r\n        if (optionArr.includes(activeStr)) {\r\n            isActive = true;\r\n            for (let i = 0; i < optionArr.length; i++) {\r\n                if (optionArr[i] === activeStr) {\r\n                    currentActiveIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n            activeButton.classList.add('toolspace-row-button-activated');\r\n            updateButton();\r\n        } else {\r\n            isActive = false;\r\n            activeButton.classList.remove('toolspace-row-button-activated');\r\n        }\r\n    };\r\n\r\n    this.getActive = function() {\r\n        return optionArr[currentActiveIndex];\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6mHrC\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hS5Hj\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"doX4v\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7NqHO\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dz3mY\");","import {BB} from '../../../bb/bb';\r\nimport {ToolDropdown} from './tool-dropdown';\r\n// @ts-ignore\r\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\r\n// @ts-ignore\r\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\r\n// @ts-ignore\r\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\r\n// @ts-ignore\r\nimport toolUndoImg from 'url:~/src/app/img/ui/tool-undo.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * Row of buttons in toolspace. image-operations (draw, hand), zoom, undo/redo\r\n * Need to do syncing. So tool is correct, and zoom/undo/redo buttons are properly enabled/disabled\r\n * heights: 54px tall, 36px small -> via setIsSmall\r\n *\r\n * p = {\r\n *     onActivate: function(activeStr), // clicking on tool button - activating it\r\n *     onZoomIn: function(),\r\n *     onZoomOut: function(),\r\n *     onUndo: function(),\r\n *     onRedo: function(),\r\n * }\r\n *\r\n * activeStr = 'draw' | 'hand' | 'fill' | 'text'\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceToolRow(p) {\r\n    let div = document.createElement('div');\r\n    BB.css(div, {\r\n        height: '54px',\r\n        //height: '36px',\r\n        display: 'flex',\r\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n    });\r\n\r\n    let currentActiveStr = 'draw'; // 'draw' | 'hand' | 'fill'\r\n\r\n    function setActive(activeStr, doEmit?) {\r\n        if (currentActiveStr === activeStr) {\r\n            return;\r\n        }\r\n\r\n        currentActiveStr = activeStr;\r\n\r\n        toolDropdown.setActive(currentActiveStr);\r\n        handButton.classList.toggle('toolspace-row-button-activated', currentActiveStr === 'hand');\r\n\r\n        if (doEmit) {\r\n            p.onActivate(currentActiveStr);\r\n        }\r\n    }\r\n\r\n    function createButton(p) {\r\n\r\n        let smallMargin = p.doLighten ? '6px 0' : '8px 0';\r\n\r\n        let result = BB.el({\r\n            className: 'toolspace-row-button nohighlight',\r\n            //title: p.title,\r\n            onClick: p.onClick,\r\n            css: {\r\n                padding: p.contain ? '10px 0' : ''\r\n            }\r\n        });\r\n        let im = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: p.contain ? 'contain' : '',\r\n                //filter: 'grayscale(1)',\r\n                height: '100%',\r\n                transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none',\r\n                opacity: p.doLighten ? '0.75' : '1'\r\n            }\r\n        });\r\n        result.appendChild(im);\r\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: result,\r\n            onEnterLeave: function(isOver) {\r\n                result.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n        (result as any).setIsSmall = function(b) {\r\n            result.style.padding = p.contain ? (b ? smallMargin : '10px 0') : '';\r\n        }\r\n        return result;\r\n    }\r\n\r\n\r\n    function createTriangleButton(p) { // because IE and Edge don't support clip path\r\n\r\n        let result = document.createElement('div');\r\n        BB.css(result, {\r\n            flexGrow: '1',\r\n            position: 'relative'\r\n        });\r\n\r\n        let svg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '67px', // can't think of a way doing with percentage\r\n            height: '54px',\r\n            viewBox: '0 0 100 100',\r\n            preserveAspectRatio: 'none'\r\n        });\r\n        BB.css(svg, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0'\r\n        });\r\n\r\n        let blurRadius = 10;\r\n        let blurOffsetX = 2;\r\n        let blurOffsetY = 2;\r\n\r\n        let defs = BB.createSvg( { // inset shadow via svg\r\n            elementType: 'defs',\r\n            childrenArr: [\r\n                {\r\n                    elementType: 'filter',\r\n                    id: 'innershadow',\r\n                    x0: '-50%',\r\n                    y0: '-50%',\r\n                    width: '200%',\r\n                    height: '200%',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'feGaussianBlur',\r\n                            in: 'SourceAlpha',\r\n                            stdDeviation: '' + blurRadius,\r\n                            result: 'blur'\r\n                        }, {\r\n                            elementType: 'feOffset',\r\n                            dx: '' + blurOffsetX,\r\n                            dy: '' + blurOffsetY\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'SourceAlpha',\r\n                            operator: 'arithmetic',\r\n                            k2: '-1',\r\n                            k3: '1',\r\n                            result: 'shadowDiff'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feFlood',\r\n                            'flood-color': '#000',\r\n                            'flood-opacity': '0.2'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'shadowDiff',\r\n                            operator: 'in'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'SourceGraphic',\r\n                            operator: 'over',\r\n                            result: 'firstfilter'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feGaussianBlur',\r\n                            in: 'firstfilter',\r\n                            stdDeviation: '' + blurRadius,\r\n                            result: 'blur2'\r\n                        }, {\r\n                            elementType: 'feOffset',\r\n                            dx: '' + blurOffsetX,\r\n                            dy: '' + blurOffsetY\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'firstfilter',\r\n                            operator: 'arithmetic',\r\n                            k2: '-1',\r\n                            k3: '1',\r\n                            result: 'shadowDiff'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feFlood',\r\n                            'flood-color': '#000',\r\n                            'flood-opacity': '0.2'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'shadowDiff',\r\n                            operator: 'in'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'firstfilter',\r\n                            operator: 'over'\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        });\r\n\r\n\r\n        let svgTriangleLeft = BB.createSvg({\r\n            elementType: 'path',\r\n            'vector-effect': 'non-scaling-stroke',\r\n            d: 'M0,0 L 100,0 0,100 z',\r\n            fill: 'rgba(0,0,0,0)',\r\n            class: 'toolspace-svg-triangle-button'\r\n        });\r\n        svgTriangleLeft.onclick = function() {\r\n            p.onLeft();\r\n            svgTriangleLeft.classList.remove('toolspace-svg-triangle-button-hover');\r\n        };\r\n\r\n        let svgTriangleRight = BB.createSvg({\r\n            elementType: 'path',\r\n            'vector-effect': 'non-scaling-stroke',\r\n            d: 'M100,100 L 100,0 0,100 z',\r\n            fill: 'rgba(0,0,0,0)',\r\n            class: 'toolspace-svg-triangle-button'\r\n        });\r\n        svgTriangleRight.onclick = function() {\r\n            p.onRight();\r\n            svgTriangleRight.classList.remove('toolspace-svg-triangle-button-hover');\r\n        };\r\n\r\n        // because :hover causes problems w touch\r\n        (result as any).leftPointerListener = new BB.PointerListener({\r\n            target: svgTriangleLeft,\r\n            onEnterLeave: function(isOver) {\r\n                svgTriangleLeft.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n            }\r\n        });\r\n        (result as any).rightPointerListener = new BB.PointerListener({\r\n            target: svgTriangleRight,\r\n            onEnterLeave: function(isOver) {\r\n                svgTriangleRight.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n            }\r\n        });\r\n\r\n\r\n        svg.appendChild(defs);\r\n        svg.appendChild(svgTriangleLeft);\r\n        svg.appendChild(svgTriangleRight);\r\n        result.appendChild(svg);\r\n\r\n\r\n        let leftIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '8px',\r\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        result.appendChild(leftIm);\r\n\r\n\r\n        let rightIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                right: '10px',\r\n                bottom: '8px',\r\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        result.appendChild(rightIm);\r\n\r\n\r\n\r\n\r\n\r\n        (result as any).setIsEnabledLeft = function(b) {\r\n            svgTriangleLeft.classList.toggle('toolspace-row-button-disabled', !b);\r\n            leftIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n        (result as any).setIsEnabledRight = function(b) {\r\n            svgTriangleRight.classList.toggle('toolspace-row-button-disabled', !b);\r\n            rightIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    function createTriangleButtonViaClipPath(p) {\r\n        let result = document.createElement('div');\r\n        BB.css(result, {\r\n            flexGrow: '1',\r\n            position: 'relative'\r\n        });\r\n\r\n\r\n        let leftButton = BB.el({\r\n            className: 'toolspace-triangle-button',\r\n            onClick: p.onLeft,\r\n            css: {\r\n                clipPath: 'polygon(0% 0%, 100% 0%, 100% 0%, 0% 100%)'\r\n            }\r\n        });\r\n\r\n        let leftIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '8px',\r\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        leftButton.appendChild(leftIm);\r\n\r\n\r\n\r\n        let rightButton = BB.el({\r\n            className: 'toolspace-triangle-button',\r\n            onClick: p.onRight,\r\n            css: {\r\n                clipPath: 'polygon(0% 100%, 100% 0%, 100% 100%, 0% 100%)'\r\n            }\r\n        });\r\n\r\n        let rightIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                right: '10px',\r\n                bottom: '8px',\r\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        rightButton.appendChild(rightIm);\r\n\r\n\r\n\r\n        result.appendChild(leftButton);\r\n        result.appendChild(rightButton);\r\n\r\n\r\n        // because :hover causes problems w touch\r\n        (result as any).leftPointerListener = new BB.PointerListener({\r\n            target: leftButton,\r\n            onEnterLeave: function(isOver) {\r\n                leftButton.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n        (result as any).rightPointerListener = new BB.PointerListener({\r\n            target: rightButton,\r\n            onEnterLeave: function(isOver) {\r\n                rightButton.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n\r\n\r\n\r\n        (result as any).setIsEnabledLeft = function(b) {\r\n            leftButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n        (result as any).setIsEnabledRight = function(b) {\r\n            rightButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n        return result;\r\n    }\r\n\r\n    let toolDropdown = new ToolDropdown({\r\n        onChange: function(activeStr) {\r\n            setActive(activeStr, true);\r\n        }\r\n    });\r\n    div.appendChild(toolDropdown.getElement());\r\n\r\n    let handButton = createButton({\r\n        onClick: function() {\r\n            setActive('hand', true);\r\n        },\r\n        image: toolHandImg,\r\n        contain: true,\r\n        doLighten: true\r\n    });\r\n    handButton.style.borderRight = '1px solid rgb(212, 212, 212)';\r\n    handButton.title = LANG('tool-hand');\r\n    div.appendChild(handButton);\r\n\r\n    let zoomInNOutButton = createTriangleButton({\r\n        onLeft: p.onZoomIn,\r\n        onRight: p.onZoomOut,\r\n        leftImage: toolZoomInImg,\r\n        rightImage: toolZoomOutImg,\r\n    });\r\n    zoomInNOutButton.title = LANG('tool-zoom');\r\n    div.appendChild(zoomInNOutButton);\r\n\r\n    let zoomInButton = createButton({\r\n        onClick: p.onZoomIn,\r\n        image: toolZoomInImg,\r\n        contain: true\r\n    });\r\n    zoomInButton.title = LANG('zoom-in');\r\n    div.appendChild(zoomInButton);\r\n\r\n    let zoomOutButton = createButton({\r\n        onClick: p.onZoomOut,\r\n        image: toolZoomOutImg,\r\n        contain: true\r\n    });\r\n    zoomOutButton.title = LANG('zoom-out');\r\n    div.appendChild(zoomOutButton);\r\n\r\n    let undoNRedoButton = createTriangleButton({\r\n        onLeft: p.onUndo,\r\n        onRight: p.onRedo,\r\n        leftImage: toolUndoImg,\r\n        rightImage: null,\r\n    });\r\n    undoNRedoButton.title = LANG('tool-undo-redo');\r\n    (undoNRedoButton as any).setIsEnabledLeft(false);\r\n    (undoNRedoButton as any).setIsEnabledRight(false);\r\n    div.appendChild(undoNRedoButton);\r\n\r\n    let undoButton = createButton({\r\n        onClick: p.onUndo,\r\n        image: toolUndoImg,\r\n        contain: true\r\n    });\r\n    undoButton.title = LANG('undo');\r\n    undoButton.classList.add('toolspace-row-button-disabled');\r\n    div.appendChild(undoButton);\r\n\r\n    let redoButton = createButton({\r\n        onClick: p.onRedo,\r\n        image: toolUndoImg,\r\n        contain: true,\r\n        doMirror: true\r\n    });\r\n    redoButton.title = LANG('redo');\r\n    redoButton.classList.add('toolspace-row-button-disabled');\r\n    div.appendChild(redoButton);\r\n\r\n    zoomInButton.style.display = 'none';\r\n    zoomOutButton.style.display = 'none';\r\n    undoButton.style.display = 'none';\r\n    redoButton.style.display = 'none';\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.setIsSmall = function(b) {\r\n        BB.css(div, {\r\n            height: b ? '36px' : '54px'\r\n        });\r\n\r\n        toolDropdown.setIsSmall(b);\r\n        (handButton as any).setIsSmall(b);\r\n        (zoomInButton as any).setIsSmall(b);\r\n        (zoomOutButton as any).setIsSmall(b);\r\n        (undoButton as any).setIsSmall(b);\r\n        (redoButton as any).setIsSmall(b);\r\n\r\n        if (b) {\r\n            zoomInNOutButton.style.display = 'none';\r\n            undoNRedoButton.style.display = 'none';\r\n            zoomInButton.style.display = 'block';\r\n            zoomOutButton.style.display = 'block';\r\n            undoButton.style.display = 'block';\r\n            redoButton.style.display = 'block';\r\n        } else {\r\n            zoomInNOutButton.style.display = 'block';\r\n            undoNRedoButton.style.display = 'block';\r\n            zoomInButton.style.display = 'none';\r\n            zoomOutButton.style.display = 'none';\r\n            undoButton.style.display = 'none';\r\n            redoButton.style.display = 'none';\r\n        }\r\n\r\n    };\r\n\r\n    this.setEnableZoomIn = function(b) {\r\n        zoomInButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (zoomInNOutButton as any).setIsEnabledLeft(b);\r\n    };\r\n    this.setEnableZoomOut = function(b) {\r\n        zoomOutButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (zoomInNOutButton as any).setIsEnabledRight(b);\r\n    };\r\n    this.setEnableUndo = function(b) {\r\n        undoButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (undoNRedoButton as any).setIsEnabledLeft(b);\r\n    };\r\n    this.setEnableRedo = function(b) {\r\n        redoButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (undoNRedoButton as any).setIsEnabledRight(b);\r\n    };\r\n    this.setActive = function(activeStr) {\r\n        setActive(activeStr);\r\n    };\r\n    this.getActive = function() {\r\n        return currentActiveStr;\r\n    };\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2gZH2\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"04ZZm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"j9xio\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"AnO0a\");","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../base-components/select';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Ui to select stabilizer level. 4 options. returned as 0-3\r\n *\r\n * p = {\r\n *     smoothing: number, // initial level 0-3\r\n *     onSelect: function(level number) // 0-3, when level changes\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceStabilizerRow(p) {\r\n\r\n    let div = BB.el({\r\n        tagName: 'label',\r\n        content: LANG('stabilizer') + '&nbsp;',\r\n        title: LANG('stabilizer-title'),\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            fontSize: '13px',\r\n            color: 'rgba(0,0,0,0.6)'\r\n        }\r\n    });\r\n\r\n    let strengthSelect = new Select({\r\n        optionArr: [\r\n            ['0', '0'],\r\n            ['1', '1'],\r\n            ['2', '2'],\r\n            ['3', '3'],\r\n            ['4', '4'],\r\n            ['5', '5']\r\n        ],\r\n        initValue: p.smoothing,\r\n        onChange: function(val) {\r\n            p.onSelect(parseInt(val));\r\n        }\r\n    });\r\n    div.appendChild(strengthSelect.getElement());\r\n\r\n    let pointerListener = new BB.PointerListener({\r\n        target: div,\r\n        onWheel: function(e) {\r\n            strengthSelect.setDeltaValue(e.deltaY);\r\n        }\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport invertedBorderImg from 'url:~/src/app/img/ui/inverted-border.svg';\r\n\r\n/**\r\n * row of tabs. uses css class .tabrow-tab\r\n *\r\n * p = {\r\n *     initialId: string, // e.g. 'draw'\r\n *     useAccent: boolean,\r\n *     tabArr: [\r\n *         {\r\n *             id: string, // e.g. 'draw',\r\n *             label: string, // optional\r\n *             image: string, // optional background image\r\n *             title: string, // optional\r\n *             isVisible: boolean, // optional - default is true\r\n *             onOpen: function(),\r\n *             onClose: function(),\r\n *             css: {...},\r\n *         }\r\n *     ]\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function TabRow(p) {\r\n    let _this = this;\r\n    let height = 35;\r\n    let div = BB.el({\r\n        className: 'tabrow',\r\n        css: {\r\n            height: height + 'px'\r\n        }\r\n    });\r\n\r\n    let tabArr = []; //creates its own internal arr\r\n    let openedTabObj = null;\r\n\r\n    const roundSize = 10;\r\n    const roundRight = BB.el({\r\n        css: {\r\n            width: roundSize + 'px',\r\n            height: roundSize + 'px',\r\n            backgroundImage: `url('${invertedBorderImg}')`,\r\n            backgroundSize: 'cover',\r\n            position: 'absolute',\r\n            right: -roundSize + 'px',\r\n            bottom: '0',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n    const roundLeft = BB.el({\r\n        css: {\r\n            width: roundSize + 'px',\r\n            height: roundSize + 'px',\r\n            backgroundImage: `url('${invertedBorderImg}')`,\r\n            backgroundSize: 'cover',\r\n            position: 'absolute',\r\n            left: -roundSize + 'px',\r\n            bottom: '0',\r\n            transform: 'scale(-1,1)',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n\r\n    function createTab(pTabObj, initialId, useAccent) {\r\n        let result: any = {\r\n            id: pTabObj.id,\r\n            isVisible: 'isVisible' in pTabObj ? pTabObj.isVisible : true,\r\n            onOpen: pTabObj.onOpen,\r\n            onClose: pTabObj.onClose,\r\n            update: function(openedTabObj) {\r\n                tabDiv.className = openedTabObj === result ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab';\r\n                tabDiv.style.display = result.isVisible ? 'block' : 'none';\r\n            }\r\n        };\r\n        let tabDiv = BB.el({\r\n            content: 'label' in pTabObj ? pTabObj.label : '',\r\n            title: 'title' in pTabObj ? pTabObj.title : undefined,\r\n            className: initialId === result.id ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab',\r\n            css: {\r\n                lineHeight: height + 'px',\r\n                display: result.isVisible ? 'block' : 'none',\r\n                zIndex: '0',\r\n            },\r\n            onClick: function() {\r\n                if (openedTabObj === result) {\r\n                    return;\r\n                }\r\n                _this.open(result.id);\r\n            }\r\n        });\r\n        result.div = tabDiv;\r\n        if ('image' in pTabObj) {\r\n            BB.css(tabDiv, {\r\n                backgroundImage: 'url(\\'' + pTabObj.image + '\\')',\r\n                backgroundSize: (height - 7) + 'px'\r\n            });\r\n        }\r\n        if ('css' in pTabObj) {\r\n            BB.css(tabDiv, pTabObj.css);\r\n        }\r\n        div.appendChild(tabDiv);\r\n\r\n        let pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: tabDiv,\r\n            onEnterLeave: function(isOver) {\r\n                tabDiv.classList.toggle('tabrow-tab-hover', isOver);\r\n            }\r\n        });\r\n\r\n        if (initialId === result.id) {\r\n            result.onOpen();\r\n            result.div.appendChild(roundRight);\r\n            result.div.appendChild(roundLeft);\r\n        } else {\r\n            result.onClose();\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    for (let i = 0; i < p.tabArr.length; i++) {\r\n        tabArr.push(createTab(p.tabArr[i], p.initialId, p.useAccent));\r\n    }\r\n\r\n    for (let i = 0; i < tabArr.length; i++) {\r\n        if (tabArr[i].id === p.initialId) {\r\n            openedTabObj = tabArr[i];\r\n        }\r\n    }\r\n    if (openedTabObj === null) {\r\n        throw 'invalid initialId';\r\n    }\r\n\r\n    function update() {\r\n        for (let i = 0; i < tabArr.length; i++) {\r\n            tabArr[i].update(openedTabObj);\r\n        }\r\n    }\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.open = function(tabId) {\r\n        for (let i = 0; i < tabArr.length; i++) {\r\n            if (tabArr[i].id === tabId) {\r\n                if (openedTabObj === tabArr[i]) { // already open\r\n                    return;\r\n                }\r\n                openedTabObj.onClose();\r\n                openedTabObj = tabArr[i];\r\n                openedTabObj.onOpen();\r\n                openedTabObj.div.appendChild(roundRight);\r\n                openedTabObj.div.appendChild(roundLeft);\r\n                update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.open - invalid tabId';\r\n    };\r\n\r\n    this.getOpenedTabId = function() {\r\n        return '' + openedTabObj.id;\r\n    };\r\n\r\n    this.setIsVisible = function(tabId, isVisible) {\r\n        for (let i = 0; i < tabArr.length; i++) {\r\n            if (tabArr[i].id === tabId) {\r\n                tabArr[i].isVisible = !!isVisible;\r\n                update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.setIsVisible - invalid tabId';\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"nTvP2\");","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport angleImg from 'url:~/src/app/img/ui/angle.svg';\r\n// @ts-ignore\r\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Ui, when hand tool tab is open.\r\n *\r\n * p = {\r\n *     scale: number, // initial value\r\n *     angleDeg: number, // initial value\r\n *     onReset: function(),\r\n *     onFit: function(),\r\n *     onAngleChange: function(angleDeg number, isRelative number)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function HandUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n    let scale = p.scale;\r\n    let angleDeg = p.angleDeg;\r\n\r\n    let row1 = BB.el({\r\n        css: {\r\n            marginBottom: '10px',\r\n            display: 'flex'\r\n        }\r\n    });\r\n    let row2 = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            marginBottom: '10px',\r\n        }\r\n    });\r\n    let row3 = BB.el({\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n    div.append(row1, row2, row3);\r\n\r\n\r\n    let scaleEl = BB.el({\r\n        css: {\r\n            width: '55px',\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    row1.appendChild(scaleEl);\r\n\r\n    let angleIm = new Image();\r\n    angleIm.src = angleImg;\r\n    BB.css(angleIm, {\r\n        verticalAlign: 'bottom',\r\n        width: '20px',\r\n        height: '20px',\r\n        marginRight: '5px',\r\n        borderRadius: '10px',\r\n        background: 'rgba(0,0,0,0.2)',\r\n        userSelect: 'none'\r\n    });\r\n    row1.appendChild(angleIm);\r\n\r\n    let angleEl = BB.el({\r\n        css: {\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    row1.appendChild(angleEl);\r\n\r\n\r\n    function update() {\r\n        scaleEl.innerHTML = Math.round(scale * 100) + '%';\r\n        angleEl.innerHTML =  Math.round(angleDeg) + '';\r\n\r\n\r\n        angleIm.style.transform = 'rotate(' + angleDeg + 'deg)';\r\n        if (angleDeg % 90 === 0) {\r\n            angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)';\r\n        } else {\r\n            angleIm.style.boxShadow = '';\r\n        }\r\n    }\r\n    update();\r\n\r\n\r\n    let resetButton = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('hand-reset'),\r\n        onClick: p.onReset\r\n    });\r\n    BB.makeUnfocusable(resetButton);\r\n\r\n    let fitButton = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('hand-fit'),\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: p.onFit\r\n    });\r\n    BB.makeUnfocusable(fitButton);\r\n    row2.append(resetButton, fitButton);\r\n\r\n    let leftRotateButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\r\n        onClick: function() {\r\n            p.onAngleChange(-15, true);\r\n        }\r\n    });\r\n    BB.makeUnfocusable(leftRotateButton);\r\n\r\n    let resetAngleButton = BB.el({\r\n        tagName: 'button',\r\n        content: '0',\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            p.onAngleChange(0);\r\n        }\r\n    });\r\n    BB.makeUnfocusable(resetAngleButton);\r\n\r\n    let rightRotateButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\"/>',\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            p.onAngleChange(15, true);\r\n        }\r\n    });\r\n    BB.makeUnfocusable(rightRotateButton);\r\n    row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\r\n\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            update();\r\n        }\r\n    };\r\n    this.update = function(pScale, pAngleDeg) {\r\n        scale = pScale;\r\n        angleDeg = pAngleDeg;\r\n        if (isVisible) {\r\n            update();\r\n        }\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6toXQ\");","import {BB} from '../../../bb/bb';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {Select} from '../base-components/select';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Paint Bucket tab contents (color slider, opacity slider, etc)\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function FillUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n\r\n    let colorDiv = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginBottom: '10px'\r\n        }\r\n    });\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 1 / 100,\r\n        max: 1,\r\n        value: 1,\r\n        toValue: (displayValue) => displayValue / 100,\r\n        toDisplayValue: (value) => value * 100,\r\n    });\r\n    div.appendChild(opacitySlider.getElement());\r\n\r\n    let toleranceSlider = new KlSlider({\r\n        label: LANG('bucket-tolerance'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 0,\r\n        max: 255,\r\n        value: 20 * (255 / 100),\r\n        toValue: (displayValue) => displayValue * (255 / 100),\r\n        toDisplayValue: (value) => value / (255 / 100),\r\n    });\r\n    BB.css(toleranceSlider.getElement(), {\r\n        marginTop: '10px'\r\n    });\r\n    div.appendChild(toleranceSlider.getElement());\r\n\r\n    let selectRow = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n\r\n    let modeWrapper;\r\n    let modeSelect;\r\n    modeWrapper = BB.el({\r\n        content: LANG('bucket-sample') + '&nbsp;',\r\n        title: LANG('bucket-sample-title'),\r\n        css: {\r\n            fontSize: '15px'\r\n        }\r\n    });\r\n    modeSelect = new Select({\r\n        optionArr: [\r\n            ['all', LANG('bucket-sample-all')],\r\n            ['current', LANG('bucket-sample-active')],\r\n            ['above', LANG('bucket-sample-above')]\r\n        ],\r\n        initValue: 'all',\r\n        onChange: function(val) {}\r\n    });\r\n    let modePointerListener = new BB.PointerListener({\r\n        target: modeSelect.getElement(),\r\n        onWheel: function(e) {\r\n            modeSelect.setDeltaValue(e.deltaY);\r\n        }\r\n    });\r\n    modeWrapper.appendChild(modeSelect.getElement());\r\n    selectRow.appendChild(modeWrapper);\r\n\r\n    let growWrapper;\r\n    let growSelect;\r\n    growWrapper = BB.el({\r\n        content: LANG('bucket-grow') + '&nbsp;',\r\n        title: LANG('bucket-grow-title'),\r\n        css: {\r\n            fontSize: '15px',\r\n            marginLeft: '10px'\r\n        }\r\n    });\r\n    growSelect = new Select({\r\n        optionArr: [\r\n            ['0', '0'],\r\n            ['1', '1'],\r\n            ['2', '2'],\r\n            ['3', '3'],\r\n            ['4', '4'],\r\n            ['5', '5'],\r\n            ['6', '6'],\r\n            ['7', '7'],\r\n        ],\r\n        initValue: '0',\r\n        onChange: function(val) {}\r\n    });\r\n    let growPointerListener = new BB.PointerListener({\r\n        target: growSelect.getElement(),\r\n        onWheel: function(e) {\r\n            growSelect.setDeltaValue(e.deltaY);\r\n        }\r\n    });\r\n    growWrapper.appendChild(growSelect.getElement());\r\n    selectRow.appendChild(growWrapper);\r\n\r\n\r\n    let isContiguous = true;\r\n    let contiguousToggle = new Checkbox({\r\n        init: true,\r\n        label: LANG('bucket-contiguous'),\r\n        title: LANG('bucket-contiguous-title'),\r\n        callback: function (b) {\r\n            isContiguous = b;\r\n        },\r\n        css: {\r\n            marginTop: '10px',\r\n            paddingRight: '5px',\r\n            display: 'inline-block',\r\n        }\r\n    });\r\n    div.appendChild(contiguousToggle.getElement());\r\n\r\n\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            colorDiv.appendChild(p.colorSlider.getElement());\r\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\r\n        }\r\n    };\r\n\r\n    this.getTolerance = function() {\r\n        return toleranceSlider.getValue();\r\n    };\r\n\r\n    this.getOpacity = function() {\r\n        return opacitySlider.getValue();\r\n    };\r\n\r\n    /**\r\n     * returns string 'current' | 'all' | 'above'\r\n     */\r\n    this.getSample = function() {\r\n        return modeSelect.getValue();\r\n    };\r\n\r\n    this.getGrow = function() {\r\n        return parseInt(growSelect.getValue(), 10);\r\n    }\r\n\r\n    this.getContiguous = function() {\r\n        return isContiguous;\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Text Tool tab contents (color slider)\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function TextUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n\r\n    let colorDiv = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginBottom: '10px'\r\n        }\r\n    });\r\n\r\n    let hint = BB.el({\r\n        parent: div,\r\n        content: LANG('text-instruction'),\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            colorDiv.appendChild(p.colorSlider.getElement());\r\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\r\n            //update();\r\n        }\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {Options} from '../base-components/options';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Shape Tool tab contents\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ShapeUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n\r\n    let colorDiv = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginBottom: '10px'\r\n        }\r\n    });\r\n\r\n    let previewSize = 35;\r\n    let previewPadding = 8;\r\n    let shape; // 'rect'|'ellipse'|'line'\r\n    let mode; // 'stroke'|'fill'\r\n\r\n\r\n    let rectStrokeSvgRect = BB.createSvg({\r\n        elementType: 'rect',\r\n        x: '' + previewPadding,\r\n        width: '' + (previewSize - previewPadding * 2)\r\n    });\r\n    let rectStrokeSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize\r\n    });\r\n    rectStrokeSvg.appendChild(rectStrokeSvgRect);\r\n    BB.css(rectStrokeSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n    let rectFilledSvgRect = BB.createSvg({\r\n        elementType: 'rect',\r\n        x: '' + previewPadding,\r\n        width: '' + (previewSize - previewPadding * 2)\r\n    });\r\n    let rectFilledSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize\r\n    });\r\n    rectFilledSvg.appendChild(rectFilledSvgRect);\r\n    BB.css(rectFilledSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n\r\n    let ellipseStrokeSvgEllipse = BB.createSvg({\r\n        elementType: 'ellipse',\r\n        cx: '' + (previewSize / 2),\r\n        cy: '' + (previewSize / 2),\r\n        rx: '' + (previewSize / 2 - previewPadding)\r\n    });\r\n    let ellipseStrokeSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize,\r\n    });\r\n    ellipseStrokeSvg.appendChild(ellipseStrokeSvgEllipse);\r\n    BB.css(ellipseStrokeSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n    let ellipseFilledSvgEllipse = BB.createSvg({\r\n        elementType: 'ellipse',\r\n        cx: '' + (previewSize / 2),\r\n        cy: '' + (previewSize / 2),\r\n        rx: '' + (previewSize / 2 - previewPadding)\r\n    });\r\n    let ellipseFilledSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize,\r\n    });\r\n    ellipseFilledSvg.appendChild(ellipseFilledSvgEllipse);\r\n    BB.css(ellipseFilledSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n\r\n    let lineSvgLine = BB.createSvg({\r\n        elementType: 'line',\r\n        x1: '' + previewPadding,\r\n        x2: '' + (previewSize - previewPadding)\r\n    });\r\n    let lineSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize\r\n    });\r\n    lineSvg.appendChild(lineSvgLine);\r\n    BB.css(lineSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n    function updatePreviews() {\r\n        let strokeWidth = BB.clamp(Math.round(lineWidthSlider.getValue() / 10), 1, 10) + 'px';\r\n\r\n        let squish = 1.35;\r\n\r\n        BB.css(rectStrokeSvgRect, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n        BB.css(rectFilledSvgRect, { fill: 'black', stroke: 'none' });\r\n\r\n        BB.css(ellipseStrokeSvgEllipse, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n        BB.css(ellipseFilledSvgEllipse, { fill: 'black', stroke: 'none' });\r\n\r\n        BB.css(\r\n            lineSvgLine,\r\n            { fill: 'none', stroke: 'black', strokeWidth: strokeWidth }\r\n        );\r\n\r\n        if ((fixedToggle as any).getValue()) {\r\n            rectStrokeSvgRect.setAttribute('y', '' + previewPadding);\r\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n            rectFilledSvgRect.setAttribute('y', '' + previewPadding);\r\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n\r\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n        } else {\r\n            rectStrokeSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n            rectFilledSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n\r\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n        }\r\n\r\n        if ((snapToggle as any).getValue()) {\r\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding));\r\n            lineSvgLine.setAttribute('y2', '' + previewPadding);\r\n        } else {\r\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding * squish));\r\n            lineSvgLine.setAttribute('y2', '' + (previewPadding * squish));\r\n        }\r\n    }\r\n\r\n    let row1 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'start'\r\n        }\r\n    });\r\n\r\n    let shapeOptions = new Options({\r\n        optionArr: [\r\n            {\r\n                id: 'rect-stroke',\r\n                label: rectStrokeSvg,\r\n                title: LANG('shape-rect') + ' ' + LANG('shape-stroke'),\r\n            },\r\n            {\r\n                id: 'ellipse-stroke',\r\n                label: ellipseStrokeSvg,\r\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-stroke'),\r\n            },\r\n            {\r\n                id: 'line',\r\n                label: lineSvg,\r\n                title: LANG('shape-line'),\r\n            },\r\n            {\r\n                id: 'rect-fill',\r\n                label: rectFilledSvg,\r\n                title: LANG('shape-rect') + ' ' + LANG('shape-fill'),\r\n            },\r\n            {\r\n                id: 'ellipse-fill',\r\n                label: ellipseFilledSvg,\r\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-fill'),\r\n            },\r\n        ],\r\n        initId: 'rect',\r\n        onChange: function(id) {\r\n            let split = id.split('-');\r\n            shape = split[0];\r\n            mode = split[1];\r\n\r\n            BB.css(fixedToggle.getElement(), {\r\n                display: shape === 'line' ? 'none' : null\r\n            });\r\n            BB.css(snapToggle.getElement(), {\r\n                display: shape === 'line' ? null : 'none'\r\n            });\r\n            BB.css(lineWidthSlider.getElement(), {\r\n                display: (shape !== 'line' && mode === 'fill') ? 'none' : null\r\n            });\r\n        },\r\n        changeOnInit: true\r\n    });\r\n    shapeOptions.getElement().style.width = '120px';\r\n    row1.appendChild(shapeOptions.getElement());\r\n\r\n    let eraserToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('eraser'),\r\n        callback: function(b) {\r\n            updatePreviews();\r\n        }\r\n    });\r\n    row1.appendChild(eraserToggle.getElement());\r\n\r\n    let lineWidthSlider = new KlSlider({\r\n        label: LANG('shape-line-width'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 1,\r\n        max: 200,\r\n        value: 4,\r\n        curve: 'quadratic',\r\n        onChange: (val) => {\r\n            updatePreviews();\r\n        },\r\n    });\r\n    BB.css(lineWidthSlider.getElement(), {\r\n        marginTop: '10px'\r\n    });\r\n    div.appendChild(lineWidthSlider.getElement());\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 1 / 100,\r\n        max: 1,\r\n        value: 1,\r\n        toValue: (displayValue) => displayValue / 100,\r\n        toDisplayValue: (value) => value * 100,\r\n    });\r\n    BB.css(opacitySlider.getElement(), {\r\n        marginTop: '10px'\r\n    });\r\n    div.appendChild(opacitySlider.getElement());\r\n\r\n    let row2 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n\r\n    let outwardsToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('shape-outwards'),\r\n        callback: function(b) {},\r\n        css: {\r\n            width: '50%',\r\n            marginRight: '10px',\r\n        }\r\n    });\r\n    row2.appendChild(outwardsToggle.getElement());\r\n\r\n    let fixedToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('shape-fixed'),\r\n        callback: function(b) {\r\n            updatePreviews();\r\n        },\r\n        css: {\r\n            flexGrow: '1',\r\n        }\r\n    });\r\n    row2.appendChild(fixedToggle.getElement());\r\n\r\n    let snapToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('shape-snap'),\r\n        title: LANG('shape-snap-title'),\r\n        callback: function(b) {\r\n            updatePreviews();\r\n        },\r\n        css: {\r\n            flexGrow: '1',\r\n        }\r\n    });\r\n    row2.appendChild(snapToggle.getElement());\r\n\r\n\r\n\r\n    updatePreviews();\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            colorDiv.appendChild(p.colorSlider.getElement());\r\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\r\n            //update();\r\n        }\r\n    };\r\n\r\n    this.getShape = function() {\r\n        return shape;\r\n    };\r\n\r\n    this.getMode = function() {\r\n        return mode;\r\n    };\r\n\r\n    this.getIsEraser = function() {\r\n        return (eraserToggle as any).getValue();\r\n    };\r\n\r\n    this.getOpacity = function() {\r\n        return opacitySlider.getValue();\r\n    };\r\n\r\n    this.getLineWidth = function() {\r\n        return lineWidthSlider.getValue();\r\n    };\r\n\r\n    this.getIsOutwards = function() {\r\n        return (outwardsToggle as any).getValue();\r\n    };\r\n\r\n    this.getIsFixed = function() {\r\n        return (fixedToggle as any).getValue();\r\n    };\r\n\r\n    this.getIsSnap = function() {\r\n        return (snapToggle as any).getValue();\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../base-components/select';\r\nimport {ColorOptions} from '../base-components/color-options';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * P = {\r\n *     currentColor: RGB, // current color\r\n *     secondaryColor: RGB,\r\n *     maxCanvasSize: number,\r\n *     canvasWidth: number, // current canvas size\r\n *     canvasHeight: number, // current canvas size\r\n *     workspaceWidth: number,\r\n *     workspaceHeight: number,\r\n *     onConfirm: function(width number, height number, color RGBA),\r\n *     onCancel: function()\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function newImageDialog(p) {\r\n\r\n    let currentColor = p.currentColor;\r\n    let secondaryColor = p.secondaryColor;\r\n    let maxCanvasSize = p.maxCanvasSize;\r\n    let canvasWidth = p.canvasWidth;\r\n    let canvasHeight = p.canvasHeight;\r\n    let workspaceWidth = p.workspaceWidth;\r\n    let workspaceHeight = p.workspaceHeight;\r\n    let onConfirm = p.onConfirm;\r\n    let onCancel = p.onCancel;\r\n\r\n\r\n    function createRatioSize(ratioX, ratioY, width, height, padding) {\r\n        return BB.fitInto(ratioX, ratioY, Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding), 1);\r\n    }\r\n\r\n    let newImDiv = document.createElement(\"div\");\r\n    let widthWrapper = document.createElement(\"div\");\r\n    let heightWrapper = document.createElement(\"div\");\r\n    let widthInput = document.createElement(\"input\");\r\n    let widthUnit = document.createElement(\"div\");\r\n    let heightInput = document.createElement(\"input\");\r\n    let heightUnit = document.createElement(\"div\");\r\n    widthWrapper.style.position = \"relative\";\r\n    widthWrapper.style.width = \"145px\";\r\n    widthWrapper.style.height = \"35px\";\r\n    widthWrapper.style.lineHeight = \"30px\";\r\n    heightWrapper.style.width = \"145px\";\r\n    heightWrapper.style.height = \"35px\";\r\n    heightWrapper.style.lineHeight = \"30px\";\r\n\r\n    widthUnit.innerText = LANG('new-px');\r\n    widthUnit.style.color = '#888';\r\n    widthUnit.style.fontSize = \"12px\";\r\n    widthUnit.style.marginLeft = \"5px\";\r\n    widthUnit.style.cssFloat = \"right\";\r\n\r\n    heightUnit.innerText = LANG('new-px');\r\n    heightUnit.style.color = '#888';\r\n    heightUnit.style.fontSize = \"12px\";\r\n    heightUnit.style.marginLeft = \"5px\";\r\n    heightUnit.style.cssFloat = \"right\";\r\n\r\n    widthInput.setAttribute('data-ignore-focus', 'true');\r\n    heightInput.setAttribute('data-ignore-focus', 'true');\r\n\r\n    widthInput.type = 'number';\r\n    widthInput.min = '1';\r\n    widthInput.max = maxCanvasSize;\r\n    widthInput.style.cssFloat = \"right\";\r\n    widthInput.style.width = \"70px\";\r\n\r\n    heightInput.type = 'number';\r\n    heightInput.min = '1';\r\n    heightInput.max = maxCanvasSize;\r\n    heightInput.style.cssFloat = \"right\";\r\n    heightInput.style.width = \"70px\";\r\n    widthInput.value = canvasWidth;\r\n    heightInput.value = canvasHeight;\r\n    widthInput.onclick = function () {\r\n        (this as any).focus();\r\n        updateRatio();\r\n    };\r\n    heightInput.onclick = function () {\r\n        (this as any).focus();\r\n        updateRatio();\r\n    };\r\n    widthWrapper.appendChild(widthUnit);\r\n    widthWrapper.appendChild(widthInput);\r\n    BB.appendTextDiv(widthWrapper, LANG('width') + \": \");\r\n    heightWrapper.appendChild(heightUnit);\r\n    heightWrapper.appendChild(heightInput);\r\n    BB.appendTextDiv(heightWrapper, LANG('height') + \": \");\r\n    let ratioWrapper = document.createElement(\"div\");\r\n    ratioWrapper.style.marginTop = '5px';\r\n    ratioWrapper.style.color = '#888';\r\n\r\n    let templateWrapper = document.createElement(\"div\");\r\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\r\n    let presetFitBtn = document.createElement(\"button\");\r\n    templateWrapper.style.marginBottom = \"10px\";\r\n    let presetCurrentBtn = document.createElement(\"button\");\r\n    let presetSquareBtn = document.createElement(\"button\");\r\n    let presetLandscapeBtn = document.createElement(\"button\");\r\n    let presetPortraitBtn = document.createElement(\"button\");\r\n    let presetOversizeBtn = document.createElement(\"button\");\r\n\r\n    presetCurrentBtn.textContent = LANG('new-current');\r\n    presetFitBtn.textContent = LANG('new-fit');\r\n    presetOversizeBtn.textContent = LANG('new-oversize');\r\n    presetLandscapeBtn.textContent = LANG('new-landscape');\r\n    presetPortraitBtn.textContent = LANG('new-portrait');\r\n    presetSquareBtn.textContent = LANG('new-square');\r\n\r\n    presetCurrentBtn.style.marginRight = \"5px\";\r\n    presetFitBtn.style.marginRight = \"5px\";\r\n    presetOversizeBtn.style.marginRight = \"5px\";\r\n    presetLandscapeBtn.style.marginTop = \"5px\";\r\n    presetLandscapeBtn.style.marginRight = \"5px\";\r\n    presetPortraitBtn.style.marginTop = \"5px\";\r\n    presetPortraitBtn.style.marginRight = \"5px\";\r\n\r\n    templateWrapper.appendChild(presetCurrentBtn);\r\n    templateWrapper.appendChild(presetFitBtn);\r\n    templateWrapper.appendChild(presetOversizeBtn);\r\n    templateWrapper.appendChild(presetSquareBtn);\r\n    templateWrapper.appendChild(presetLandscapeBtn);\r\n    templateWrapper.appendChild(presetPortraitBtn);\r\n\r\n    let templatePadding = 50;\r\n\r\n    presetCurrentBtn.onclick = function () {\r\n        widthInput.value = canvasWidth;\r\n        heightInput.value = canvasHeight;\r\n        updateRatio();\r\n    };\r\n    presetFitBtn.onclick = function () {\r\n        widthInput.value = workspaceWidth;\r\n        heightInput.value = workspaceHeight;\r\n        updateRatio();\r\n    };\r\n    presetOversizeBtn.onclick = function () {\r\n        widthInput.value = workspaceWidth + 500;\r\n        heightInput.value = workspaceHeight + 500;\r\n        updateRatio();\r\n    };\r\n    presetSquareBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetLandscapeBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetPortraitBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n\r\n    let select = new Select({\r\n        isFocusable: true,\r\n        optionArr: [\r\n            ['screen', LANG('new-screen')],\r\n            ['16 9', LANG('new-video') + ' 16:9'],\r\n            ['3 2', '3:2'],\r\n            ['5 3', '5:3'],\r\n            ['2 1', '2:1'],\r\n            ['paper', LANG('new-din-paper') + ' 2:1'],\r\n            ['9 16', '9:16'],\r\n            ['2 3', '2:3'],\r\n            ['3 5', '3:5'],\r\n            ['1 2', '1:2'],\r\n            ['1 1.4142135623730951', '1:2']\r\n        ],\r\n        onChange: function(val) {\r\n            if (val === 'screen') {\r\n                widthInput.value = '' + window.screen.width;\r\n                heightInput.value = '' + window.screen.height;\r\n            } else if (val === 'paper') {\r\n                let sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            } else {\r\n                let split = val.split(' ');\r\n                let sizeObj = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            }\r\n            updateRatio();\r\n            select.setValue(null);\r\n        }\r\n    });\r\n    setTimeout(() => {\r\n        // safari: not empty without also setting it to null via timeout\r\n        select.setValue(null);\r\n    }, 0);\r\n    BB.css(select.getElement(), {\r\n        width: '80px',\r\n    });\r\n    templateWrapper.appendChild(select.getElement());\r\n\r\n\r\n\r\n    let backgroundRGBA = {r: 255, g: 255, b: 255, a: 1};\r\n\r\n    let colorOptionsArr = [\r\n        {r: 255, g: 255, b: 255, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 0}\r\n    ];\r\n    colorOptionsArr.push({\r\n        r: currentColor.r,\r\n        g: currentColor.g,\r\n        b: currentColor.b,\r\n        a: 1\r\n    });\r\n    colorOptionsArr.push({\r\n        r: secondaryColor.r,\r\n        g: secondaryColor.g,\r\n        b: secondaryColor.b,\r\n        a: 1\r\n    });\r\n\r\n    let colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        onChange: function(rgbaObj) {\r\n            backgroundRGBA = rgbaObj;\r\n            preview.style.backgroundColor = \"rgba(\" + rgbaObj.r + \",\" + rgbaObj.g + \",\" + rgbaObj.b + \", \" + rgbaObj.a + \")\";\r\n        }\r\n    });\r\n\r\n    let previewWrapper = document.createElement(\"div\");\r\n    BB.css(previewWrapper, {\r\n        boxSizing: 'border-box',\r\n        width: '340px',\r\n        height: '140px',\r\n        display: 'table',\r\n        backgroundColor: '#9e9e9e',\r\n        padding: '10px',\r\n        marginTop: '10px',\r\n        boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\r\n        marginLeft: '-20px',\r\n        colorScheme: 'only light',\r\n    });\r\n    let preview = document.createElement(\"div\");\r\n    BB.css(preview, {\r\n        width: 200 + \"px\",\r\n        height: 100 + \"px\",\r\n        backgroundColor: \"#fff\",\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n        color: \"#aaa\",\r\n        fontSize: \"16px\",\r\n        fontWeight: \"bold\",\r\n        textAlign: \"center\",\r\n        verticalAlign: \"center\",\r\n        display: \"table\",\r\n        overflow: \"hidden\",\r\n        boxShadow: \"0px 0px 3px rgba(0,0,0,0.5)\"\r\n    });\r\n    let previewcell = document.createElement(\"div\");\r\n    previewcell.style.display = \"table-cell\";\r\n    previewcell.style.verticalAlign = \"middle\";\r\n    previewcell.appendChild(preview);\r\n    previewWrapper.appendChild(previewcell);\r\n    let cell = BB.appendTextDiv(preview, \"\");\r\n    //let ratio = BB.appendTextDiv(cell, \"1:2\");\r\n    cell.style.display = \"table-cell\";\r\n    cell.style.verticalAlign = \"middle\";\r\n    let prevW = parseInt(widthInput.value);\r\n    let prevH = parseInt(heightInput.value);\r\n\r\n    function updateRatio() {\r\n        widthInput.value = '' + Math.min(maxCanvasSize, parseInt(widthInput.value));\r\n        heightInput.value = '' + Math.min(maxCanvasSize, parseInt(heightInput.value));\r\n\r\n        function HCF(u, v) {\r\n            let U = u, V = v;\r\n            while (true) {\r\n                if (!(U %= V))\r\n                    return V;\r\n                if (!(V %= U))\r\n                    return U;\r\n            }\r\n        }\r\n\r\n        let w = parseInt(widthInput.value);\r\n        let h = parseInt(heightInput.value);\r\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\r\n            if (w > maxCanvasSize)\r\n                w = maxCanvasSize;\r\n            else if (h > maxCanvasSize)\r\n                h = maxCanvasSize;\r\n\r\n            widthInput.value = '' + w;\r\n            heightInput.value = '' + h;\r\n        }\r\n\r\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\r\n        let commonRatios = [\r\n            [1, 2], [2, 1],\r\n            [2, 3], [3, 2],\r\n            [3, 4], [4, 3],\r\n            [4, 5], [5, 4],\r\n            [16, 9], [9, 16],\r\n            [3, 2], [2, 3],\r\n            [5, 3], [3, 5],\r\n            [2, 1], [1, 2],\r\n            [1.414, 1], [1, 1.414],\r\n        ];\r\n        let reducedArr = BB.reduce(w, h);\r\n        let closestRatio = null;\r\n        let closestDistance = null;\r\n        for (let i = 0; i < commonRatios.length; i++) {\r\n            if (i === 0 || Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\r\n                closestRatio = commonRatios[i];\r\n                closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\r\n            }\r\n        }\r\n        //display ratio\r\n        if (closestDistance > 0 && closestDistance < 0.005) {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ~' + closestRatio[0] + ':' + closestRatio[1];\r\n        } else {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ' + reducedArr[0] + ':' + reducedArr[1];\r\n        }\r\n\r\n        prevW = w;\r\n        prevH = h;\r\n        let realw = w;\r\n        let T = HCF(w, h);\r\n        w /= T;\r\n        h /= T;\r\n        w *= 260;\r\n        h *= 260;\r\n        if (w > 260) {\r\n            h = 260 / w * h;\r\n            w = 260;\r\n        }\r\n        if (h > 100) {\r\n            w = 100 / h * w;\r\n            h = 100;\r\n\r\n        }\r\n\r\n        preview.style.width = w + \"px\";\r\n        preview.style.height = h + \"px\";\r\n        BB.createCheckerDataUrl(parseInt('' + (30 * (w / realw))), function (url) {\r\n            previewWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n    }\r\n\r\n    widthInput.onchange = function () {\r\n        if (widthInput.value === '' || parseInt(widthInput.value) < 0) {\r\n            widthInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    widthInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    heightInput.onchange = function () {\r\n        if (heightInput.value === '' || parseFloat(heightInput.value) < 0) {\r\n            heightInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    heightInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    updateRatio();\r\n\r\n    newImDiv.appendChild(templateWrapper);\r\n    let secondRow = BB.el({\r\n        parent: newImDiv,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'flex-end'\r\n        }\r\n    });\r\n    let secondRowLeft = BB.el({\r\n        parent: secondRow\r\n    });\r\n    secondRowLeft.appendChild(widthWrapper);\r\n    secondRowLeft.appendChild(heightWrapper);\r\n    secondRowLeft.appendChild(ratioWrapper);\r\n    secondRow.appendChild(colorOptions.getElement());\r\n\r\n    newImDiv.appendChild(previewWrapper);\r\n\r\n    popup({\r\n        target: document.body,\r\n        message: `<b>${LANG('new-title')}</b>`,\r\n        div: newImDiv,\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (result) {\r\n            widthInput.onclick = null;\r\n            heightInput.onclick = null;\r\n            presetCurrentBtn.onclick = null;\r\n            presetFitBtn.onclick = null;\r\n            presetOversizeBtn.onclick = null;\r\n            presetSquareBtn.onclick = null;\r\n            presetLandscapeBtn.onclick = null;\r\n            presetPortraitBtn.onclick = null;\r\n            widthInput.onchange = null;\r\n            widthInput.onkeyup = null;\r\n            heightInput.onchange = null;\r\n            heightInput.onkeyup = null;\r\n            select.destroy();\r\n            colorOptions.destroy();\r\n\r\n            if (result === \"Cancel\" || parseInt(widthInput.value) <= 0 || parseInt(heightInput.value) <= 0 || isNaN(parseInt(widthInput.value)) || isNaN(parseInt(heightInput.value))) {\r\n                onCancel();\r\n                return;\r\n            }\r\n            onConfirm(parseInt(widthInput.value), parseInt(heightInput.value), backgroundRGBA);\r\n        },\r\n        clickOnEnter: 'Ok'\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport collapseImg from 'url:~/src/app/img/ui/ui-collapse.svg';\r\nimport {LANG} from \"../../../language/language\";\r\n\r\n/**\r\n * button that allows to collapse toolspace (for mobile)\r\n *\r\n * p = {\r\n *     onChange: function()\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceCollapser(p) {\r\n    let isOpen = true;\r\n    let directionStr = 'right'; // 'left' | 'right'\r\n\r\n    function update() {\r\n        if (directionStr === 'left') {\r\n            icon.style.transform = isOpen ? 'rotate(180deg)' : '';\r\n        } else {\r\n            icon.style.transform = isOpen ? '' : 'rotate(180deg)';\r\n        }\r\n    }\r\n\r\n    let div = BB.el({\r\n        css: {\r\n            width: '36px',\r\n            height: '36px',\r\n            background: 'rgba(100, 100, 100, 0.9)',\r\n            color: '#fff',\r\n            position: 'absolute',\r\n            top: '0',\r\n            textAlign: 'center',\r\n            lineHeight: '36px',\r\n            cursor: 'pointer',\r\n            userSelect: 'none',\r\n            padding: '6px',\r\n            boxSizing: 'border-box'\r\n        },\r\n        title: LANG('toggle-show-tools'),\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            isOpen = !isOpen;\r\n            update();\r\n            p.onChange();\r\n        }\r\n    });\r\n\r\n    let icon = BB.el({\r\n        parent: div,\r\n        css: {\r\n            backgroundImage: `url(${collapseImg})`,\r\n            width: '100%',\r\n            height: '100%',\r\n            backgroundSize: 'contain',\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    // --- interface ---\r\n    this.isOpen = function() {\r\n        return isOpen;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param dirStr\r\n     */\r\n    this.setDirection = function(dirStr) {\r\n        directionStr = dirStr;\r\n        update();\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"b1UMP\");","import {BB} from '../../../bb/bb';\r\nimport {renderText} from '../../image-operations/render-text';\r\nimport {ColorOptions} from '../base-components/color-options';\r\nimport {Select} from '../base-components/select';\r\nimport {ImageRadioList} from '../base-components/image-radio-list';\r\nimport {ImageToggle} from '../base-components/image-toggle';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {popup} from './popup';\r\n// @ts-ignore\r\nimport alignLeftImg from 'url:~/src/app/img/ui/align-left.svg';\r\n// @ts-ignore\r\nimport alignCenterImg from 'url:~/src/app/img/ui/align-center.svg';\r\n// @ts-ignore\r\nimport alignRightImg from 'url:~/src/app/img/ui/align-right.svg';\r\n// @ts-ignore\r\nimport typoItalicImg from 'url:~/src/app/img/ui/typo-italic.svg';\r\n// @ts-ignore\r\nimport typoBoldImg from 'url:~/src/app/img/ui/typo-bold.svg';\r\n// @ts-ignore\r\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\r\n// @ts-ignore\r\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\r\nimport {IRGB} from '../../kl.types';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Text Tool dialog\r\n *\r\n * confirmP = {\r\n *     x: number,\r\n *     y: number,\r\n *     textStr: string,\r\n *     align: 'left' | 'center' | 'right',\r\n *     isItalic: boolean,\r\n *     isBold: boolean,\r\n *     color: rgb,\r\n *     size: number, // px\r\n *     font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy',\r\n *     opacity: number, // 0 - 1\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function textToolDialog(\r\n    p: {\r\n        klCanvas: KlCanvas;\r\n        layerIndex: number;\r\n        x: number;\r\n        y: number;\r\n        angleRad: number;\r\n        color: IRGB;\r\n        secondaryColor: IRGB;\r\n        size: number; // px\r\n        align: 'left' | 'center' | 'right'; // default 'left'\r\n        isBold: boolean; // default false\r\n        isItalic: boolean; // default false\r\n        font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\r\n        opacity: number; // 0 - 1; default 1\r\n        onConfirm: (confirmP) => void;\r\n    }\r\n) {\r\n\r\n    let div = BB.el({});\r\n\r\n    let isSmallWidth = window.innerWidth < 550;\r\n    let isSmallHeight = window.innerHeight < 630;\r\n\r\n    // --- preview ---\r\n    // Text drawn on klCanvas-sized canvas: textCanvas\r\n    // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\r\n    //      they are transformed. canvas size of final preview\r\n    // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\r\n    // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\r\n\r\n    let width = isSmallWidth ? 340 : 540;\r\n    let height = isSmallWidth ? (isSmallHeight ? 210 : 260) : (isSmallHeight ? 230 : 350);\r\n    let scale = 1;\r\n\r\n    let layerArr = p.klCanvas.getLayersFast();\r\n    let textCanvas = BB.canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\r\n    let textCtx = textCanvas.getContext('2d');\r\n    let targetCanvas = BB.canvas(width, height);\r\n    let targetCtx = targetCanvas.getContext('2d');\r\n    let layersCanvas = BB.canvas(width, height);\r\n    let layersCtx = layersCanvas.getContext('2d');\r\n    let previewCanvas = BB.canvas(width, height); // the one that is visible\r\n    let previewCtx = previewCanvas.getContext('2d');\r\n    BB.css(previewCanvas, {\r\n        display: 'block'\r\n    });\r\n    let previewWrapper = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'relative',\r\n            width: width + 'px',\r\n            marginLeft: '-20px',\r\n            cursor: 'move',\r\n            colorScheme: 'only light',\r\n            touchAction: 'none',\r\n        },\r\n        onClick: function() {\r\n            textInput.focus();\r\n        }\r\n    });\r\n    BB.el({ // inset shadow on preview\r\n        parent: previewWrapper,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n    previewWrapper.appendChild(previewCanvas);\r\n    let checkerPattern = previewCtx.createPattern(BB.createCheckerCanvas(8), 'repeat');\r\n    let emptyCanvas = BB.canvas(1, 1);\r\n    {\r\n        let ctx = emptyCanvas.getContext('2d');\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    }\r\n\r\n    function updatePreview() {\r\n\r\n        // try to draw very much like klCanvasWorkspace\r\n\r\n        // --- draw text ---\r\n        textCtx.clearRect(0, 0, textCanvas.width, textCanvas.height);\r\n        let colorRGBA = {\r\n            ...p.color,\r\n            a: opacitySlider.getValue(),\r\n        };\r\n        let bounds = renderText(textCanvas, {\r\n            x: p.x,\r\n            y: p.y,\r\n            textStr: textInput.value,\r\n            align: alignRadioList.getValue(),\r\n            isItalic: italicToggle.getValue(),\r\n            isBold: boldToggle.getValue(),\r\n            size: parseFloat(sizeInput.value),\r\n            font: fontSelect.getValue(),\r\n            color: BB.ColorConverter.toRgbaStr(colorRGBA),\r\n            angleRad: p.angleRad\r\n        });\r\n\r\n\r\n        // --- determine transformation of viewport ---\r\n        // text should always be visible\r\n        bounds.width = Math.max(bounds.width, 1);\r\n        bounds.height = Math.max(bounds.height, 1);\r\n        let rotatedXY = BB.rotate(bounds.x, bounds.y, -p.angleRad / Math.PI * 180);\r\n        let rotatedWH = BB.rotate(bounds.width, bounds.height, -p.angleRad / Math.PI * 180);\r\n        let centerX = p.x + rotatedXY.x + rotatedWH.x / 2;\r\n        let centerY = p.y + rotatedXY.y + rotatedWH.y / 2;\r\n\r\n        let padding = 100;\r\n        let fitBounds = BB.fitInto(bounds.width, bounds.height, width - padding, height - padding);\r\n        scale = Math.min(1, fitBounds.width / bounds.width);\r\n        scale = Math.min(4, scale * Math.pow(2, zoomFac));\r\n\r\n\r\n        // --- compose text and target layer ---\r\n        targetCtx.save();\r\n\r\n        if (scale >= 4) {\r\n            targetCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            targetCtx.imageSmoothingEnabled = true;\r\n            targetCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n        }\r\n\r\n        targetCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        targetCtx.translate(width / 2, height / 2);\r\n        targetCtx.scale(scale, scale);\r\n        targetCtx.rotate(p.angleRad);\r\n        targetCtx.drawImage(layerArr[p.layerIndex].canvas, -centerX, -centerY);\r\n        targetCtx.drawImage(textCanvas, -centerX, -centerY);\r\n        targetCtx.restore();\r\n\r\n\r\n        // --- layers ---\r\n        layersCtx.save();\r\n\r\n        layersCtx.fillStyle = 'rgb(158,158,158)';\r\n        layersCtx.fillRect(0, 0, width, height);\r\n\r\n        { // bg\r\n            layersCtx.save();\r\n\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n\r\n            layersCtx.imageSmoothingEnabled = false;\r\n\r\n            //outline\r\n            let borderSize = 1 / scale;\r\n            layersCtx.globalAlpha = 0.2;\r\n            layersCtx.drawImage(emptyCanvas, -centerX - borderSize, -centerY - borderSize, textCanvas.width + borderSize * 2, textCanvas.height + borderSize * 2);\r\n            layersCtx.globalAlpha = 1;\r\n\r\n            //erase\r\n            layersCtx.globalCompositeOperation = 'destination-out';\r\n            layersCtx.drawImage(emptyCanvas, -centerX, -centerY, textCanvas.width, textCanvas.height);\r\n\r\n            layersCtx.restore();\r\n        }\r\n\r\n        { // individual layers\r\n\r\n            if (scale >= 4) {\r\n                layersCtx.imageSmoothingEnabled = false;\r\n            } else {\r\n                layersCtx.imageSmoothingEnabled = true;\r\n                layersCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n            }\r\n\r\n            // layers below\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (var i = 0; i < p.layerIndex; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n            // target layer\r\n            layersCtx.globalAlpha = layerArr[p.layerIndex].opacity;\r\n            layersCtx.globalCompositeOperation = layerArr[p.layerIndex].mixModeStr;\r\n            layersCtx.drawImage(targetCanvas, 0, 0);\r\n\r\n            // layers above\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (let i = p.layerIndex + 1; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n        }\r\n\r\n        layersCtx.restore();\r\n\r\n\r\n\r\n        // --- final composite ---\r\n        previewCtx.save();\r\n        previewCtx.fillStyle = checkerPattern;\r\n        previewCtx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        previewCtx.drawImage(layersCanvas, 0, 0);\r\n        previewCtx.restore();\r\n\r\n        // bounds\r\n        previewCtx.save();\r\n        previewCtx.globalCompositeOperation = 'difference';\r\n        previewCtx.strokeStyle = '#fff';\r\n        previewCtx.lineWidth = 1;\r\n        // centerX = p.x + bounds.x + bounds.width / 2;\r\n        // centerY = p.y + bounds.y + bounds.height / 2;\r\n        previewCtx.strokeRect(\r\n            Math.round(width / 2 - (bounds.width / 2) * scale),\r\n            Math.round(height / 2 - (bounds.height / 2) * scale),\r\n            Math.round(bounds.width * scale),\r\n            Math.round(bounds.height * scale)\r\n        );\r\n        previewCtx.restore();\r\n\r\n    }\r\n\r\n    function move(x, y) {\r\n        let rotated = BB.rotate(x, y, -p.angleRad / Math.PI * 180);\r\n        p.x += rotated.x / scale;\r\n        p.y += rotated.y / scale;\r\n        updatePreview();\r\n    }\r\n\r\n    let previewPointerListener = new BB.PointerListener({\r\n        target: previewCanvas,\r\n        pointers: 1,\r\n        onPointer: function(e) {\r\n            if (e.type === 'pointermove' && e.button) {\r\n                e.eventPreventDefault();\r\n                move(-e.dX, -e.dY);\r\n            }\r\n        },\r\n        onWheel: function(e) {\r\n            changeZoomFac(-e.deltaY);\r\n        }\r\n    });\r\n\r\n    const wheelPrevent = (event) => {\r\n        event.preventDefault();\r\n    }\r\n    BB.addEventListener(previewCanvas, 'wheel', wheelPrevent);\r\n\r\n\r\n\r\n    let row1 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n    let row2n3Wrapper = BB.el({\r\n        parent: div,\r\n        css: isSmallWidth ? {} : {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between'\r\n        }\r\n    });\r\n    let row2 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginTop: '5px'\r\n        }\r\n    });\r\n    let row3 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n            marginTop: '5px',\r\n            width: isSmallWidth ? '' : '300px'\r\n        }\r\n    });\r\n\r\n    // --- row 1 ---\r\n\r\n    // color\r\n    let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n    let colorOptionsArr = [\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 255, g: 255, b: 255, a: 1}\r\n    ];\r\n    colorOptionsArr.unshift({\r\n        r: p.secondaryColor.r,\r\n        g: p.secondaryColor.g,\r\n        b: p.secondaryColor.b,\r\n        a: 1,\r\n    });\r\n    colorOptionsArr.unshift({\r\n        r: p.color.r,\r\n        g: p.color.g,\r\n        b: p.color.b,\r\n        a: 1,\r\n    });\r\n\r\n    let colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        initialIndex: 0,\r\n        onChange: function(rgbaObj) {\r\n            p.color = rgbaObj;\r\n            updatePreview();\r\n        }\r\n    });\r\n    colorOptions.getElement().title = LANG('text-color');\r\n    colorOptions.getElement().style.marginLeft = '-5px';\r\n    row1.appendChild(colorOptions.getElement());\r\n\r\n\r\n    let zoomFac = 0;\r\n    function changeZoomFac(d) {\r\n        zoomFac = Math.min(2, Math.max(-2, zoomFac + d));\r\n        updatePreview();\r\n        zoomInBtn.disabled = !canZoom(1);\r\n        zoomOutBtn.disabled = !canZoom(-1);\r\n    }\r\n    function canZoom(d) {\r\n        return zoomFac !== Math.min(2, Math.max(-2, zoomFac + d));\r\n    }\r\n\r\n    let zoomWrapper = BB.el({\r\n        parent: row1,\r\n        css: {\r\n\r\n        }\r\n    })\r\n\r\n    let zoomInBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomInImg}\">`,\r\n        title: LANG('zoom-in'),\r\n        tagName: 'button',\r\n        onClick: function() {\r\n            changeZoomFac(1);\r\n        },\r\n        css: {\r\n            fontWeight: 'bold'\r\n        }\r\n    }) as HTMLButtonElement;\r\n    let zoomOutBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomOutImg}\">`,\r\n        title: LANG('zoom-out'),\r\n        tagName: 'button',\r\n        onClick: function() {\r\n            changeZoomFac(-1);\r\n        },\r\n        css: {\r\n            fontWeight: 'bold',\r\n            marginLeft: '5px'\r\n        }\r\n    }) as HTMLButtonElement;\r\n\r\n\r\n\r\n    // --- row 2 ---\r\n    let sizeInput = BB.el({\r\n        parent: row2,\r\n        tagName: 'input',\r\n        title: LANG('text-size'),\r\n        custom: {\r\n            type: 'number',\r\n            min: 1,\r\n            max: 10000,\r\n            value: p.size\r\n        },\r\n        css: {\r\n            width: '60px'\r\n        },\r\n        onChange: function() {\r\n            sizeInput.value = '' + Math.max(1, Math.min(10000, parseInt(sizeInput.value)));\r\n            updatePreview();\r\n        }\r\n    }) as HTMLInputElement;\r\n    let sizePointerListener = new BB.PointerListener({\r\n        target: sizeInput,\r\n        onWheel: function(e) {\r\n            sizeInput.value = '' + Math.max(1, Math.min(1000, parseInt(sizeInput.value) - e.deltaY));\r\n            updatePreview();\r\n        }\r\n    });\r\n\r\n    let modeWrapper;\r\n    let fontSelect;\r\n    let fontPointerListener;\r\n    {\r\n        modeWrapper = BB.el({\r\n            css: {\r\n                fontSize: '15px',\r\n                marginLeft: '10px'\r\n            }\r\n        });\r\n        fontSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['sans-serif', 'Sans-serif'],\r\n                ['serif', 'Serif'],\r\n                ['monospace', 'Monospace'],\r\n                ['cursive', 'Cursive'],\r\n                ['fantasy', 'Fantasy'],\r\n            ],\r\n            initValue: p.font,\r\n            onChange: function(val) {\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        modeWrapper.appendChild(fontSelect.getElement());\r\n        row2.appendChild(modeWrapper);\r\n\r\n        fontPointerListener = new BB.PointerListener({\r\n            target: fontSelect.getElement(),\r\n            onWheel: function(e) {\r\n                fontSelect.setDeltaValue(e.deltaY);\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n    // --- row 3 ---\r\n\r\n    let alignRadioList = new ImageRadioList({\r\n        optionArr: [\r\n            {\r\n                id: 'left',\r\n                title: LANG('text-left'),\r\n                image: alignLeftImg,\r\n            },\r\n            {\r\n                id: 'center',\r\n                title: LANG('text-center'),\r\n                image: alignCenterImg,\r\n            },\r\n            {\r\n                id: 'right',\r\n                title: LANG('text-right'),\r\n                image: alignRightImg,\r\n            }\r\n        ],\r\n        initId: p.align,\r\n        onChange: function(id) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(alignRadioList.getElement());\r\n\r\n    let italicToggle = new ImageToggle({\r\n        image: typoItalicImg,\r\n        title: LANG('text-italic'),\r\n        initValue: p.isItalic,\r\n        onChange: function(b) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(italicToggle.getElement());\r\n\r\n    let boldToggle = new ImageToggle({\r\n        image: typoBoldImg,\r\n        title: LANG('text-bold'),\r\n        initValue: p.isBold,\r\n        onChange: function(b) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(boldToggle.getElement());\r\n\r\n\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 150,\r\n        height: 30,\r\n        min: 1 / 100,\r\n        max: 1,\r\n        value: p.opacity,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        toValue: (displayValue) => displayValue / 100,\r\n        toDisplayValue: (value) => value * 100,\r\n        onChange: function(v) {\r\n            updatePreview();\r\n        },\r\n    });\r\n    row3.appendChild(opacitySlider.getElement());\r\n\r\n\r\n\r\n    let textInput = BB.el({\r\n        parent: div,\r\n        tagName: 'textarea',\r\n        custom: {\r\n            placeholder: LANG('text-placeholder'),\r\n            'data-ignore-focus': 'true',\r\n        },\r\n        css: {\r\n            whiteSpace: 'pre',\r\n            overflow: 'auto',\r\n            width: '100%',\r\n            height: '70px',\r\n            resize: 'vertical',\r\n            marginTop: '10px'\r\n        },\r\n        onChange: function() {\r\n            updatePreview();\r\n        }\r\n    }) as HTMLTextAreaElement;\r\n    textInput.addEventListener('input', updatePreview);\r\n    setTimeout(function() {\r\n        textInput.focus();\r\n        textInput.select();\r\n    });\r\n    let closefunc;\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e, comboStr) {\r\n            if (BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    // prevent mobile keyboards scrolling page\r\n    function onScroll() {\r\n        window.scrollTo(0, 0);\r\n    }\r\n    window.addEventListener('scroll', onScroll);\r\n\r\n\r\n    popup({\r\n        target: document.body,\r\n        message: `<b>${LANG('text-title')}</b>`,\r\n        div: div,\r\n        buttons: [\"Ok\", \"Cancel\"],\r\n        style: isSmallWidth ? {} : {\r\n            width: '500px'\r\n        },\r\n        callback: function(val) {\r\n            let result = {\r\n                x: p.x,\r\n                y: p.y,\r\n                textStr: textInput.value,\r\n                align: alignRadioList.getValue(),\r\n                isItalic: italicToggle.getValue(),\r\n                isBold: boldToggle.getValue(),\r\n                color: p.color,\r\n                size: sizeInput.value,\r\n                font: fontSelect.getValue(),\r\n                opacity: opacitySlider.getValue(),\r\n            };\r\n\r\n            window.removeEventListener('scroll', onScroll);\r\n            textInput.removeEventListener('input', updatePreview);\r\n            BB.destroyEl(textInput);\r\n            previewPointerListener.destroy();\r\n            sizePointerListener.destroy();\r\n            fontPointerListener.destroy();\r\n            BB.removeEventListener(previewCanvas, 'wheel', wheelPrevent);\r\n            BB.destroyEl(previewWrapper);\r\n            BB.destroyEl(zoomInBtn);\r\n            BB.destroyEl(zoomOutBtn);\r\n            BB.destroyEl(sizeInput);\r\n            colorOptions.destroy();\r\n            fontSelect.destroy();\r\n            keyListener.destroy();\r\n            alignRadioList.destroy();\r\n            italicToggle.destroy();\r\n            boldToggle.destroy();\r\n            opacitySlider.destroy();\r\n            if (val === 'Ok') {\r\n                p.onConfirm(result);\r\n            }\r\n        },\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        ignoreBackground: true,\r\n        closefunc: function (func) {\r\n            closefunc = func;\r\n        },\r\n    });\r\n\r\n    updatePreview();\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"lvwQ5\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"imAvm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dC0sF\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h3hPo\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1pAeY\");","import {BB} from '../../../bb/bb';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n *\r\n * p = {\r\n *     image: convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas},\r\n *     maxSize: number,\r\n *     target: htmlElement,\r\n *     callback: func(\r\n *         {\r\n *             type: 'as-image',\r\n *             image: image | canvas,\r\n *         } | {\r\n *             type: 'as-image-psd',\r\n *             image: convertedPsd,\r\n *             cropObj: {x: number, y: number, width: number, height: number}\r\n *         } | {\r\n *             type: 'as-layer',\r\n *             image: image | canvas,\r\n *         } | {\r\n *             type: 'cancel',\r\n *         }\r\n *     )\r\n * }\r\n *\r\n * @param p {}\r\n */\r\nexport function showImportImageDialog(p) {\r\n    const div = BB.el({});\r\n\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n    const style = isSmall ? {} : { width: '500px' };\r\n    let resolutionEl;\r\n    const cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 400,\r\n        canvas: p.image.canvas,\r\n        isNotCopy: true,\r\n        onChange: function(width, height) {\r\n            if (!resolutionEl) {\r\n                return;\r\n            }\r\n            updateResolution(width, height);\r\n        }\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginLeft: '-20px',\r\n        borderTop: '1px solid #bbb',\r\n        borderBottom: '1px solid #bbb'\r\n    });\r\n    cropCopy.getEl().title = LANG('crop-drag-to-crop');\r\n    div.appendChild(cropCopy.getEl());\r\n\r\n\r\n    resolutionEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginTop: '10px',\r\n            textAlign: 'center',\r\n            color: '#888',\r\n            lineHeight: '20px',\r\n        }\r\n    });\r\n    function updateResolution(w: number, h: number) {\r\n        const fit = BB.fitInto(w, h, p.maxSize, p.maxSize);\r\n\r\n        if (fit.width < w) {\r\n            resolutionEl.innerHTML = `<span style=\"color:#f00\">${w} X ${h}</span>  ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\r\n            resolutionEl.title = LANG('import-too-large');\r\n        } else {\r\n            resolutionEl.innerHTML = `${w} X ${h}`;\r\n            resolutionEl.title = '';\r\n        }\r\n    }\r\n    updateResolution(p.image.width, p.image.height);\r\n\r\n\r\n    let doFlatten = false;\r\n    function showWarnings(psdWarningArr) {\r\n        let contentArr = [];\r\n        let warningMap = {\r\n            'mask': 'Masks not supported. Mask was applied.',\r\n            'clipping': 'Clipping not supported. Clipping layers were merged.',\r\n            'group': 'Groups not supported. Layers were ungrouped.',\r\n            'adjustment': 'Adjustment layers not supported.',\r\n            'layer-effect': 'Layer effects not supported.',\r\n            'smart-object': 'Smart objects not supported.',\r\n            'blend-mode': 'Unsupported layer blend mode.',\r\n            'bits-per-channel': 'Unsupported color depth. Only 8bit per channel supported.',\r\n        };\r\n        for (let i = 0; i < psdWarningArr.length; i++) {\r\n            contentArr.push('- ' + warningMap[psdWarningArr[i]]);\r\n        }\r\n        alert(contentArr.join(\"\\n\"));\r\n    }\r\n\r\n    let flattenCheckbox;\r\n    if (p.image.type === 'psd') {\r\n        const noteStyle = {\r\n            background: 'rgba(255,255,0,0.5)',\r\n            padding: '10px',\r\n            marginTop: '5px',\r\n            marginBottom: '5px',\r\n            border: '1px solid #e7d321',\r\n            borderRadius: '5px'\r\n        };\r\n        if (p.image.layers) {\r\n            flattenCheckbox = new Checkbox({\r\n                init: doFlatten,\r\n                label: LANG('import-flatten'),\r\n                callback: function(b) {\r\n                    doFlatten = b;\r\n                }\r\n            });\r\n            div.appendChild(flattenCheckbox.getElement());\r\n\r\n            if (p.image.warningArr) {\r\n                const noteEl = BB.el({\r\n                    content: LANG('import-psd-limited-support'),\r\n                    css: noteStyle\r\n                });\r\n                noteEl.appendChild(BB.el({\r\n                    tagName: 'a',\r\n                    content: 'Details',\r\n                    onClick: function() {\r\n                        showWarnings(p.image.warningArr);\r\n                    }\r\n                }));\r\n                div.appendChild(noteEl);\r\n            }\r\n        } else {\r\n            const noteEl = BB.el({\r\n                content: LANG('import-psd-unsupported'),\r\n                css: noteStyle\r\n            });\r\n            div.appendChild(noteEl);\r\n        }\r\n    }\r\n\r\n    function callback(result) {\r\n        const croppedImage = cropCopy.getCroppedImage();\r\n        const cropRect = cropCopy.getRect();\r\n        cropCopy.destroy();\r\n        if (flattenCheckbox) {\r\n            flattenCheckbox.destroy();\r\n        }\r\n\r\n        if (result === LANG('import-btn-as-layer')) {\r\n            p.callback({\r\n                type: 'as-layer',\r\n                image: croppedImage\r\n            });\r\n\r\n        } else if (result === LANG('import-btn-as-image')) {\r\n            if (p.image.type === 'psd') {\r\n                if (doFlatten) {\r\n                    p.image.layers = null;\r\n                }\r\n                p.callback({\r\n                    type: 'as-image-psd',\r\n                    image: p.image,\r\n                    cropObj: cropRect\r\n                });\r\n            } else if (p.image.type === 'image') {\r\n                p.callback({\r\n                    type: 'as-image',\r\n                    image: croppedImage\r\n                });\r\n            }\r\n        } else {\r\n            p.callback({\r\n                type: 'cancel'\r\n            });\r\n        }\r\n    }\r\n    popup({\r\n        target: p.target,\r\n        message: `<b>${LANG('import-title')}</b>`,\r\n        div: div,\r\n        style,\r\n        buttons: [LANG('import-btn-as-layer'), LANG('import-btn-as-image'), \"Cancel\"],\r\n        callback: callback,\r\n        autoFocus: 'As Image'\r\n    });\r\n}","import {createCanvas} from '../../bb/base/create-canvas';\r\nimport {Psd} from 'ag-psd/dist/psd';\r\nimport {IKlProject, IKlPsd, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {MAX_LAYERS} from '../canvas/kl-canvas';\r\n\r\nlet kl2PsdMap;\r\nlet psd2KlMap;\r\n\r\nfunction init() {\r\n    if (kl2PsdMap) {\r\n        return;\r\n    }\r\n\r\n    kl2PsdMap = {\r\n        'source-over': 'normal',\r\n\r\n        'darken': 'darken',\r\n        'multiply': 'multiply',\r\n        'color-burn': 'color burn',\r\n\r\n        'lighten': 'lighten',\r\n        'screen': 'screen',\r\n        'color-dodge': 'color dodge',\r\n\r\n        'overlay': 'overlay',\r\n        'soft-light': 'soft light',\r\n        'hard-light': 'hard light',\r\n\r\n        'difference': 'difference',\r\n        'exclusion': 'exclusion',\r\n\r\n        'hue': 'hue',\r\n        'saturation': 'saturation',\r\n        'color': 'color',\r\n        'luminosity': 'luminosity',\r\n    };\r\n\r\n    psd2KlMap = {};\r\n    let keys = Object.keys(kl2PsdMap);\r\n    for (let i = 0; i < keys.length; i++) {\r\n        psd2KlMap[kl2PsdMap[keys[i]]] = keys[i];\r\n    }\r\n}\r\n\r\nexport function blendPsdToKl(str: string): IMixMode {\r\n    init();\r\n    return psd2KlMap[str];\r\n}\r\n\r\nexport function blendKlToPsd(str: string): string {\r\n    init();\r\n    return kl2PsdMap[str];\r\n}\r\n\r\n\r\n/**\r\n * Converts ag-psd object into something that KlCanvas can represent\r\n * @param psdObj\r\n */\r\nexport function readPsd(psdObj: Psd): IKlPsd {\r\n    let result: IKlPsd = {\r\n        type: 'psd',\r\n        canvas: psdObj.canvas,\r\n        width: psdObj.width,\r\n        height: psdObj.height\r\n    };\r\n\r\n    function addWarning(warningStr) {\r\n        if (!result.warningArr) {\r\n            result.warningArr = [];\r\n        }\r\n        if (result.warningArr.includes(warningStr)) {\r\n            return;\r\n        }\r\n        result.warningArr.push(warningStr);\r\n    }\r\n\r\n    function getMixModeStr(blendMode): IMixMode {\r\n        let mixModeStr: IMixMode = blendPsdToKl(blendMode);\r\n        if (!mixModeStr) {\r\n            addWarning('blend-mode');\r\n            mixModeStr = 'source-over';\r\n        }\r\n        return mixModeStr;\r\n    }\r\n\r\n    if (psdObj.bitsPerChannel !== 8) {\r\n        addWarning('bits-per-channel');\r\n    }\r\n\r\n    if (!psdObj.children) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    // count resulting layers\r\n    let maxLayers = MAX_LAYERS;\r\n    let layerCount = 0;\r\n    function countWithinGroup(groupObj) {\r\n        let result = 0;\r\n        if (groupObj.blendMode) {\r\n            let mixModeStr = blendPsdToKl(groupObj.blendMode);\r\n            if (mixModeStr && mixModeStr !== 'source-over') {\r\n                return 1;\r\n            }\r\n        }\r\n        for (let i = 0; i < groupObj.children.length; i++) {\r\n            let item = groupObj.children[i];\r\n            if (item.clipping || item.adjustment) {\r\n                continue;\r\n            }\r\n\r\n            if (item.children) {\r\n                addWarning('group');\r\n                result += countWithinGroup(item);\r\n            } else {\r\n                result++;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    layerCount += countWithinGroup(psdObj);\r\n    if (layerCount > maxLayers) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    result.layers = [];\r\n\r\n    function prepareMask(maskCanvas, defaultColor) {\r\n        const groupMaskCtx = maskCanvas.getContext('2d');\r\n        let imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n        if (defaultColor === 0) {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = imData.data[i];\r\n            }\r\n        } else {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = 255 - imData.data[i];\r\n            }\r\n        }\r\n        groupMaskCtx.putImageData(imData, 0, 0);\r\n    }\r\n\r\n    function convertGroup(psdGroupObj): {\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n        opacity: number;\r\n        image: HTMLCanvasElement;\r\n    }[] {\r\n\r\n        let resultArr: {\r\n            name: string;\r\n            mixModeStr: IMixMode;\r\n            opacity: number;\r\n            image: HTMLCanvasElement;\r\n        }[] = [];\r\n        let groupOpacity = psdGroupObj.hidden ? 0 : psdGroupObj.opacity;\r\n        let groupMixModeStr = getMixModeStr(psdGroupObj.blendMode);\r\n        let groupCanvas;\r\n        let groupCtx;\r\n        if (groupMixModeStr !== 'source-over') {\r\n            groupCanvas = createCanvas(result.width, result.height);\r\n            groupCtx = groupCanvas.getContext('2d');\r\n        }\r\n\r\n\r\n        // prepare group mask\r\n        if (psdGroupObj.mask) {\r\n            addWarning('mask');\r\n            prepareMask(psdGroupObj.mask.canvas, psdGroupObj.mask.defaultColor);\r\n        }\r\n\r\n\r\n        for (let i = 0; i < psdGroupObj.children.length; i++) {\r\n            let item = psdGroupObj.children[i];\r\n            if (item.clipping) {\r\n                continue;\r\n            }\r\n            if (item.adjustment) {\r\n                addWarning('adjustment');\r\n                continue;\r\n            }\r\n\r\n            let hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\r\n            if (hasClipping) {\r\n                addWarning('clipping');\r\n            }\r\n\r\n            if (item.children) {\r\n                let innerArr = convertGroup(item);\r\n\r\n                for (let e = 0; e < innerArr.length; e++) {\r\n                    let innerItem = innerArr[e];\r\n                    let innerCtx = innerItem.image.getContext('2d');\r\n\r\n                    // clipping\r\n                    if (hasClipping) {\r\n                        let clippingCanvas = createCanvas(result.width, result.height);\r\n                        let clippingCtx = clippingCanvas.getContext('2d');\r\n                        clippingCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                        for (let f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++) {\r\n                            let clippingItem = psdGroupObj.children[f];\r\n                            if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                                continue;\r\n                            }\r\n                            clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                            clippingCtx.globalAlpha = clippingItem.opacity;\r\n                            clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\r\n                        }\r\n\r\n                        innerCtx.globalCompositeOperation = 'source-atop';\r\n                        innerCtx.drawImage(clippingCanvas, 0, 0);\r\n                    }\r\n\r\n\r\n\r\n                    // group mask\r\n                    if (psdGroupObj.mask) {\r\n                        innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                        innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n                    }\r\n\r\n                    if (groupCanvas) {\r\n                        groupCtx.globalCompositeOperation = innerItem.mixModeStr;\r\n                        groupCtx.globalAlpha = innerItem.opacity;\r\n                        groupCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                    } else {\r\n                        innerItem.opacity = innerItem.opacity * groupOpacity;\r\n                        resultArr.push(innerItem);\r\n                    }\r\n                }\r\n\r\n                continue;\r\n            }\r\n\r\n            let canvas = createCanvas(result.width, result.height);\r\n            let ctx = canvas.getContext('2d');\r\n            if (item.canvas) { // if a layer is empty it has no canvas\r\n                ctx.drawImage(item.canvas, item.left, item.top);\r\n            }\r\n\r\n            // effects\r\n            if (item.effects) {\r\n                addWarning('layer-effect');\r\n            }\r\n\r\n            // mask\r\n            if (item.mask) {\r\n                addWarning('mask');\r\n                prepareMask(item.mask.canvas, item.mask.defaultColor);\r\n\r\n                ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\r\n            }\r\n\r\n            // clipping\r\n            if (hasClipping) {\r\n                let clippingCanvas = createCanvas(item.right - item.left, item.bottom - item.top);\r\n                let clippingCtx = clippingCanvas.getContext('2d');\r\n                clippingCtx.drawImage(item.canvas, 0, 0);\r\n\r\n                for (let e = i + 1; e < psdGroupObj.children.length && psdGroupObj.children[e].clipping; e++) {\r\n                    let clippingItem = psdGroupObj.children[e];\r\n                    if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                        continue;\r\n                    }\r\n                    clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                    clippingCtx.globalAlpha = clippingItem.opacity;\r\n                    clippingCtx.drawImage(clippingItem.canvas, clippingItem.left - item.left, clippingItem.top - item.top);\r\n                }\r\n\r\n                ctx.globalCompositeOperation = 'source-atop';\r\n                ctx.drawImage(clippingCanvas, item.left, item.top);\r\n            }\r\n\r\n            // group mask\r\n            if (psdGroupObj.mask) {\r\n                ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n            }\r\n\r\n            if (groupCanvas) {\r\n                if (groupOpacity > 0) {\r\n                    groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\r\n                    groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\r\n                    groupCtx.drawImage(canvas, 0, 0);\r\n                }\r\n\r\n            } else {\r\n                resultArr.push({\r\n                    name: item.name,\r\n                    opacity: (item.hidden ? 0 : item.opacity) * groupOpacity,\r\n                    mixModeStr: getMixModeStr(item.blendMode),\r\n                    image: canvas,\r\n                });\r\n            }\r\n        }\r\n\r\n        if (groupCanvas) {\r\n            resultArr = [\r\n                {\r\n                    name: psdGroupObj.name,\r\n                    opacity: groupOpacity,\r\n                    mixModeStr: groupMixModeStr,\r\n                    image: groupCanvas,\r\n                }\r\n            ];\r\n        }\r\n\r\n        return resultArr;\r\n    }\r\n\r\n    result.layers = convertGroup({\r\n        name: 'root',\r\n        opacity: 1,\r\n        blendMode: 'normal',\r\n        children: psdObj.children\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\nexport function klPsdToKlProject(klPsd: IKlPsd): IKlProject {\r\n    // only share references to Canvas elements\r\n    const result: IKlProject = {\r\n        width: klPsd.width,\r\n        height: klPsd.height,\r\n        layers: [],\r\n    };\r\n    if (klPsd.layers) {\r\n        result.layers = result.layers.concat(klPsd.layers.map(item => {\r\n            return {\r\n                name: item.name,\r\n                opacity: item.opacity,\r\n                mixModeStr: item.mixModeStr,\r\n                image: item.image,\r\n            };\r\n        }));\r\n    } else {\r\n        // flattened\r\n        result.layers.push({\r\n            name: LANG('background'),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over',\r\n            image: klPsd.canvas,\r\n        });\r\n    }\r\n    return result;\r\n}","//browser storage indexedDB\r\n\r\n\r\nimport {IKlStorageProject} from '../kl.types';\r\n\r\nconst indexedDbIsSupported = !!window.indexedDB;\r\nlet dbNameStr = 'Klecks';\r\nconst storageNameStr = 'ProjectStore';\r\n\r\nexport function setDbName(name: string) {\r\n    dbNameStr = '' + name;\r\n}\r\n\r\n/**\r\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\r\n * with index 'id'\r\n *\r\n * @param actionFunction function(storeObj) - what you want to execute during transaction\r\n * @param successCallback function() - on succesful transaction\r\n * @param errorCallback function(errorStr) - on error\r\n */\r\nfunction execIndexedDBTransaction(actionFunction, successCallback, errorCallback) {\r\n\r\n    let hasFinished = false;\r\n\r\n    function onSuccess() {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        successCallback();\r\n    }\r\n\r\n    function onError(errorStr) {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        errorCallback(errorStr);\r\n    }\r\n\r\n    if (!indexedDbIsSupported) {\r\n        setTimeout(function () {\r\n            onError('no indexed db available');\r\n        }, 0);\r\n        return;\r\n    }\r\n    let requestObj;\r\n\r\n    try {\r\n        requestObj = window.indexedDB.open(dbNameStr, 1);\r\n    } catch (e) {\r\n        onError(e.message);\r\n        return;\r\n    }\r\n\r\n    requestObj.onupgradeneeded = function (e) {\r\n        try {\r\n            let db = requestObj.result;\r\n            let store = db.createObjectStore(storageNameStr, {keyPath: 'id'});\r\n            store.createIndex('id', 'id', {unique: true});\r\n        } catch (e) {\r\n            onError(e.message);\r\n        }\r\n    };\r\n    requestObj.onerror = function (e) {\r\n        onError('indexedDB.open failed, ' + requestObj.error);\r\n    };\r\n    requestObj.onsuccess = function (e) {\r\n        let databaseObj;\r\n        let transactionObj;\r\n        let storeObj;\r\n\r\n        try {\r\n            databaseObj = requestObj.result;\r\n            if (!databaseObj.objectStoreNames.contains(storageNameStr)) {\r\n                //someone maybe messed with the db, or creation failed earlier\r\n                //it's broken -> destroy\r\n                window.indexedDB.deleteDatabase(dbNameStr);\r\n                onError('object store ' + storageNameStr + ' missing. destroying db');\r\n                return;\r\n            }\r\n            transactionObj = databaseObj.transaction(storageNameStr, 'readwrite');\r\n            storeObj = transactionObj.objectStore(storageNameStr);\r\n            storeObj.index('id');\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        databaseObj.onerror = function (e) {\r\n            onError('database error, ' + databaseObj.error);\r\n        };\r\n\r\n        try {\r\n            actionFunction(storeObj);\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        transactionObj.oncomplete = function () {\r\n            onSuccess();\r\n            databaseObj.close();\r\n        };\r\n        transactionObj.onerror = function () {\r\n            onError('transaction error, ' + transactionObj.error);\r\n        };\r\n    };\r\n}\r\n\r\n/**\r\n * getKlProjectObj {\r\n *     width: int,\r\n *     height: int,\r\n *     layers: {\r\n *        name: string,\r\n *        opacity: float (0 - 1),\r\n *        mixModeStr: string,\r\n *        image: image object                <--------- image already loaded!\r\n *     }[]\r\n * }\r\n *\r\n * @param successCallback function - called when succesfully queried. passes KlProjectObj\r\n * @param errorCallback - function(errorStr) - called when error during query\r\n */\r\nexport function getKlProjectObj(successCallback, errorCallback) {\r\n    if (indexedDbIsSupported) {\r\n        let query;\r\n        execIndexedDBTransaction(function (storeObj) {\r\n            query = storeObj.get(1);\r\n        }, function () {\r\n            successCallback(query.result);\r\n        }, function (errorStr) {\r\n            errorCallback('execIndexedDBTransaction error, ' + errorStr);\r\n        });\r\n    } else {\r\n        successCallback(null);\r\n    }\r\n}\r\n\r\n/**\r\n * stores a klProjectObj into id = 1 in database:dbNameStr > storage: storageNameStr\r\n *\r\n * KlProjectObj {\r\n *     width: int,\r\n *     height: int,\r\n *     layers: {\r\n *        name: string,\r\n *        opacity: float (0 - 1),\r\n *        mixModeStr: string,\r\n *        blob: blob object                 <--------- blob!\r\n *     }[]\r\n * }\r\n *\r\n * @param storageProject IKlStorageProject - project to be stored\r\n * @param successCallback function() - on successful transaction\r\n * @param errorCallback function(errorStr) - on error\r\n */\r\nexport function storeKlProjectObj(storageProject: IKlStorageProject, successCallback, errorCallback) {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.put(storageProject);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (errorStr) {\r\n        errorCallback(errorStr);\r\n    });\r\n\r\n}\r\n\r\n/**\r\n * removes id = 1 from database:dbNameStr > storage: storageNameStr\r\n *\r\n * @param successCallback function() - on successful transaction\r\n * @param errorCallback function(error) - on error\r\n */\r\nexport function clear(successCallback, errorCallback) {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.delete(1);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (error) {\r\n        errorCallback(error);\r\n    });\r\n\r\n}\r\n","import {IFilter} from '../kl.types';\r\n// @ts-ignore\r\nimport glBrightnessContrastImg from 'url:~/src/app/img/ui/edit-brightness-contrast.svg';\r\n// @ts-ignore\r\nimport cropExtendImg from 'url:~/src/app/img/ui/edit-crop.svg';\r\n// @ts-ignore\r\nimport glCurvesImg from 'url:~/src/app/img/ui/edit-curves.svg';\r\n// @ts-ignore\r\nimport flipImg from 'url:~/src/app/img/ui/edit-flip.svg';\r\n// @ts-ignore\r\nimport glHueSaturationImg from 'url:~/src/app/img/ui/edit-hue-saturation.svg';\r\n// @ts-ignore\r\nimport invertImg from 'url:~/src/app/img/ui/edit-invert.png';\r\n// @ts-ignore\r\nimport glPerspectiveImg from 'url:~/src/app/img/ui/edit-perspective.svg';\r\n// @ts-ignore\r\nimport resizeImg from 'url:~/src/app/img/ui/edit-resize.svg';\r\n// @ts-ignore\r\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\r\n// @ts-ignore\r\nimport glTiltShiftImg from 'url:~/src/app/img/ui/edit-tilt-shift.png';\r\n// @ts-ignore\r\nimport toAlphaImg from 'url:~/src/app/img/ui/edit-to-alpha.svg';\r\n// @ts-ignore\r\nimport transformImg from 'url:~/src/app/img/ui/edit-transform.svg';\r\n// @ts-ignore\r\nimport glBlurImg from 'url:~/src/app/img/ui/edit-triangle-blur.png';\r\n// @ts-ignore\r\nimport glUnsharpMaskImg from 'url:~/src/app/img/ui/edit-unsharp-mask.png';\r\n// @ts-ignore\r\nimport gridImg from 'url:~/src/app/img/ui/edit-grid.svg';\r\n// @ts-ignore\r\nimport noiseImg from 'url:~/src/app/img/ui/edit-noise.svg';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\n\r\nexport const filterLibStatus = {\r\n    isLoaded: false,\r\n};\r\nexport const filterLib: {\r\n    [key:string]: IFilter;\r\n} = {\r\n    brightnessContrast: {\r\n        lang: {name: 'filter-bright-contrast-title', button: 'filter-bright-contrast'},\r\n        icon: glBrightnessContrastImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    cropExtend: {\r\n        lang: {name: 'filter-crop-title', button: 'filter-crop-extend'},\r\n        icon: cropExtendImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    curves: {\r\n        lang: {name: 'filter-curves-title', button: 'filter-curves'},\r\n        icon: glCurvesImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    flip: {\r\n        lang: {name: 'filter-flip-title', button: 'filter-flip'},\r\n        icon: flipImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    hueSaturation: {\r\n        lang: {name: 'filter-hue-sat-title', button: 'filter-hue-sat'},\r\n        icon: glHueSaturationImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    invert: {\r\n        lang: {name: 'filter-invert', button: 'filter-invert'},\r\n        icon: invertImg,\r\n        updatePos: false,\r\n        isInstant: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    perspective: {\r\n        lang: {name: 'filter-perspective-title', button: 'filter-perspective'},\r\n        icon: glPerspectiveImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    resize: {\r\n        lang: {name: 'filter-resize-title', button: 'filter-resize'},\r\n        icon: resizeImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    rotate: {\r\n        lang: {name: 'filter-rotate-title', button: 'filter-rotate'},\r\n        icon: rotateImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    tiltShift: {\r\n        lang: {name: 'filter-tilt-shift-title', button: 'filter-tilt-shift'},\r\n        icon: glTiltShiftImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    toAlpha: {\r\n        lang: {name: 'filter-to-alpha-title', button: 'filter-to-alpha'},\r\n        icon: toAlphaImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    transform: {\r\n        lang: {name: 'filter-transform-title', button: 'filter-transform'},\r\n        icon: transformImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    blur: {\r\n        lang: {name: 'filter-triangle-blur-title', button: 'filter-triangle-blur'},\r\n        icon: glBlurImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    unsharpMask: {\r\n        lang: {name: 'filter-unsharp-mask-title', button: 'filter-unsharp-mask'},\r\n        icon: glUnsharpMaskImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    grid: {\r\n        lang: {name: 'filter-grid', button: 'filter-grid'},\r\n        icon: gridImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    noise: {\r\n        lang: {name: 'filter-noise', button: 'filter-noise'},\r\n        icon: noiseImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n};\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"5tPq3\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cazOx\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"245NA\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1hkCG\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"k2eFf\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"krKGd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ehfxY\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"beOjS\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"Gk9bV\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"csed7\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"equSE\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h1dN3\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"LfAXI\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cB6q6\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"S9ano\");","import {PenBrush} from './pen-brush';\r\nimport {BlendBrush} from './blend-brush';\r\nimport {SketchyBrush} from './sketchy-brush';\r\nimport {PixelBrush} from './pixel-brush';\r\nimport {EraserBrush} from './eraser-brush';\r\nimport {SmudgeBrush} from './smudge-brush';\r\nimport {ChemyBrush} from './chemy-brush';\r\n\r\nexport const brushes = {\r\n    PenBrush,\r\n    BlendBrush,\r\n    SketchyBrush,\r\n    PixelBrush,\r\n    ChemyBrush,\r\n    SmudgeBrush,\r\n    EraserBrush,\r\n}","import {BB} from '../../bb/bb';\r\nimport {alphaImArr} from './brushes-common';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\n\r\nexport function PenBrush() {\r\n\r\n    let context;\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n\r\n    let settingColor, settingSize = 2, settingSpacing = 0.8489, settingOpacity = 1;\r\n    let settingColorStr;\r\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\r\n    let settingLockLayerAlpha = false;\r\n    let ALPHA_CIRCLE = 0, ALPHA_CHALK = 1, ALPHA_CAL = 2, ALPHA_SQUARE = 3;\r\n    let settingAlphaId = ALPHA_CIRCLE;\r\n\r\n    let lineToolLastDot;\r\n    let lastInput = {x: 0, y: 0, pressure: 0};\r\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\r\n\r\n    let isDrawing = false;\r\n    let alphaOpacityArr = [1, 0.9, 1, 1];\r\n\r\n    //mipmapping\r\n    let alphaCanvas128 = BB.canvas(128, 128);\r\n    let alphaCanvas64 = BB.canvas(64, 64);\r\n    let alphaCanvas32 = BB.canvas(32, 32);\r\n\r\n    let bezierLine = null;\r\n\r\n    let twoPI = Math.PI * 2;\r\n    let hasDrawnDot = false; // current stroke has drawn at least one dot\r\n    let inputArr: {x: number, y: number, pressure: number}[];\r\n\r\n    // pressure: 0-1\r\n    function calcOpacity(pressure: number) {\r\n        return settingOpacity * (settingHasOpacityPressure ? pressure * pressure : 1);\r\n    }\r\n\r\n    function updateAlphaCanvas() {\r\n        if (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE) {\r\n            return;\r\n        }\r\n\r\n        let instructionArr = [\r\n            [alphaCanvas128, 128],\r\n            [alphaCanvas64, 64],\r\n            [alphaCanvas32, 32]\r\n        ];\r\n\r\n        let ctx;\r\n\r\n        for (let i = 0; i < instructionArr.length; i++) {\r\n            ctx = (instructionArr[i][0] as any).getContext(\"2d\");\r\n\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.fillStyle = \"rgba(\" + settingColor.r + \", \" + settingColor.g + \", \" + settingColor.b + \", \" + alphaOpacityArr[settingAlphaId] + \")\";\r\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.globalCompositeOperation = \"destination-in\";\r\n            ctx.imageSmoothingQuality = 'high';\r\n            ctx.drawImage(alphaImArr[settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.restore();\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     * @param angle\r\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\r\n     */\r\n    function drawDot(x, y, size, opacity, angle?, before?) {\r\n        if (size <= 0) {\r\n            return;\r\n        }\r\n\r\n        if (settingLockLayerAlpha) {\r\n            context.globalCompositeOperation = \"source-atop\";\r\n        }\r\n\r\n        if (!before || before[3] !== opacity) {\r\n            context.globalAlpha = opacity;\r\n        }\r\n\r\n        if (!before && (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE)) {\r\n            context.fillStyle = settingColorStr;\r\n        }\r\n\r\n        if (settingAlphaId === ALPHA_CIRCLE) {\r\n            context.beginPath();\r\n            context.arc(x, y, size, 0, twoPI);\r\n            context.closePath();\r\n            context.fill();\r\n            hasDrawnDot = true;\r\n\r\n        } else if (settingAlphaId === ALPHA_SQUARE) {\r\n            if (angle !== undefined) {\r\n                context.save();\r\n                context.translate(x, y);\r\n                context.rotate(angle / 180 * Math.PI);\r\n                context.fillRect(-size, -size, size * 2, size * 2);\r\n                context.restore();\r\n                hasDrawnDot = true;\r\n            }\r\n\r\n        } else { // other brush alphas\r\n            context.save();\r\n            context.translate(x, y);\r\n            let targetMipmap = alphaCanvas128;\r\n            if (size <= 32 && size > 16) {\r\n                targetMipmap = alphaCanvas64;\r\n            } else if (size <= 16) {\r\n                targetMipmap = alphaCanvas32;\r\n            }\r\n            context.scale(size, size);\r\n            if (settingAlphaId === ALPHA_CHALK) {\r\n                context.rotate(((x + y) * 53123) % twoPI); // without mod it sometimes looks different\r\n            }\r\n            context.drawImage(targetMipmap, -1, -1, 2, 2);\r\n\r\n            context.restore();\r\n            hasDrawnDot = true;\r\n        }\r\n    }\r\n\r\n    function continueLine(x, y, size, pressure) {\r\n        if (bezierLine === null) {\r\n            bezierLine = new BB.BezierLine();\r\n            bezierLine.add(lastInput.x, lastInput.y, 0, function(){});\r\n        }\r\n\r\n        let drawArr = []; //draw instructions. will be all drawn at once\r\n\r\n        function dotCallback(val) {\r\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\r\n            let localOpacity = calcOpacity(localPressure);\r\n            let localSize = Math.max(0.1, settingSize * (settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        }\r\n\r\n        let localSpacing = size * settingSpacing;\r\n        if (x === null) {\r\n            bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        context.save();\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            let item = drawArr[i];\r\n            drawDot(item[0], item[1], item[2], item[3], item[4], before);\r\n            before = item;\r\n        }\r\n        context.restore();\r\n    }\r\n\r\n    //------------------ interface ---------------------------------------------------\r\n\r\n\r\n    this.startLine = function (x, y, p) {\r\n        historyEntry = {\r\n            tool: [\"brush\", \"PenBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [settingHasOpacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setAlpha\",\r\n            params: [settingAlphaId]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        let localOpacity = calcOpacity(p);\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, p * settingSize) : Math.max(0.1, settingSize);\r\n\r\n        hasDrawnDot = false;\r\n\r\n        isDrawing = true;\r\n        context.save();\r\n        drawDot(x, y, localSize, localOpacity);\r\n        context.restore();\r\n\r\n        lineToolLastDot = localSize * settingSpacing;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n        lastInput2.pressure = p;\r\n\r\n        inputArr = [{\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        }];\r\n\r\n        historyEntry.actions.push({\r\n            action: \"startLine\",\r\n            params: [x, y, p]\r\n        });\r\n    };\r\n\r\n    this.goLine = function (x, y, p) {\r\n        if (!isDrawing) {\r\n            return;\r\n        }\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [x, y, p]\r\n        });\r\n\r\n        let pressure = BB.clamp(p, 0, 1);\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n\r\n        context.save();\r\n        continueLine(x, y, localSize, lastInput.pressure);\r\n\r\n        /*context.fillStyle = 'red';\r\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\r\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/\r\n\r\n        context.restore();\r\n\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput2.pressure = lastInput.pressure;\r\n        lastInput.pressure = pressure;\r\n\r\n        inputArr.push({\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        });\r\n    };\r\n\r\n    this.endLine = function (x, y) {\r\n\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n        context.save();\r\n        continueLine(null, null, localSize, lastInput.pressure);\r\n        context.restore();\r\n\r\n        isDrawing = false;\r\n\r\n        if (settingAlphaId === ALPHA_SQUARE && !hasDrawnDot) {\r\n            // find max pressure input, use that one\r\n            let maxInput = inputArr[0];\r\n            inputArr.forEach(item => {\r\n                if (item.pressure > maxInput.pressure) {\r\n                    maxInput = item;\r\n                }\r\n            })\r\n\r\n            context.save();\r\n            let p = BB.clamp(maxInput.pressure, 0, 1);\r\n            let localOpacity = calcOpacity(p);\r\n            drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\r\n            context.restore();\r\n        }\r\n\r\n        bezierLine = null;\r\n\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: [x, y]\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n\r\n        hasDrawnDot = false;\r\n        inputArr = [];\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = settingSize * settingSpacing;\r\n        lineToolLastDot = settingSize * settingSpacing;\r\n        context.save();\r\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\r\n        }\r\n        context.restore();\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"PenBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [settingHasOpacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setAlpha\",\r\n            params: [settingAlphaId]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    //IS\r\n    this.isDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n    //SET\r\n    this.setAlpha = function (a) {\r\n        if (settingAlphaId === a) {\r\n            return;\r\n        }\r\n        settingAlphaId = a;\r\n        updateAlphaCanvas();\r\n    };\r\n    this.setColor = function (c) {\r\n        if (settingColor === c) {\r\n            return;\r\n        }\r\n        settingColor = {r: c.r, g: c.g, b: c.b};\r\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\r\n        updateAlphaCanvas();\r\n    };\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSize = function (s) {\r\n        settingSize = s;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        settingOpacity = o;\r\n    };\r\n    this.setSpacing = function (s) {\r\n        settingSpacing = s;\r\n    };\r\n    this.sizePressure = function (b) {\r\n        settingHasSizePressure = b;\r\n    };\r\n    this.opacityPressure = function (b) {\r\n        settingHasOpacityPressure = b;\r\n    };\r\n    this.setLockAlpha = function (b) {\r\n        settingLockLayerAlpha = b;\r\n    };\r\n    //GET\r\n    this.getSpacing = function () {\r\n        return settingSpacing;\r\n    };\r\n    this.getSize = function () {\r\n        return settingSize;\r\n    };\r\n    this.getOpacity = function () {\r\n        return settingOpacity;\r\n    };\r\n    this.getLockAlpha = function (b) {\r\n        return settingLockLayerAlpha;\r\n    };\r\n}","import {genBrushAlpha01, genBrushAlpha02} from './alphas/brush-alphas';\r\n\r\nexport const alphaImArr = []; //used by default brush\r\nalphaImArr[1] = genBrushAlpha01(128);\r\nalphaImArr[2] = genBrushAlpha02(128);","import {BB} from '../../../bb/bb';\r\nimport {noise} from '../../../bb/math/perlin';\r\nimport {IVector2D} from '../../../bb/bb.types';\r\n\r\n// chalk\r\nexport function genBrushAlpha01(w: number): HTMLCanvasElement {\r\n\r\n    const scaleFac = w / 500;\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    const ctx = canvas.getContext('2d');\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            let i = (y * w + x) * 4;\r\n\r\n            // base noise\r\n            const sFac2 = scaleFac + noise.simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\r\n            let noisePattern = 100 + (noise.simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\r\n            noisePattern -= (noise.simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\r\n\r\n            // fade out in circular shape\r\n            const centerDist = BB.dist(w / 2, h / 2, x, y);\r\n            let falloff = BB.clamp(\r\n                1 - ((centerDist - (w / 2.5)) / (w / 14) + noise.simplex2(x / 22 / sFac2, y / 22 / sFac2)),\r\n                0,\r\n                1);\r\n            noisePattern = noisePattern * falloff;\r\n\r\n            // make the middle darker\r\n            const falloff2 = BB.clamp(1 - centerDist / w, 0, 1) * 2;\r\n            noisePattern = noisePattern * falloff2;\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = BB.clamp(noisePattern, 0, 255);\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}\r\n\r\n// https://www.shadertoy.com/view/3tdSDj\r\nfunction udSegment( p: IVector2D, a: IVector2D, b: IVector2D ) {\r\n    let ba = BB.Vec2.sub(b, a);\r\n    let pa = BB.Vec2.sub(p, a);\r\n    let h = BB.clamp( BB.Vec2.dot(pa,ba) / BB.Vec2.dot(ba,ba), 0.0, 1.0 );\r\n    return BB.Vec2.len(BB.Vec2.sub(pa, BB.Vec2.mul(ba, h)));\r\n}\r\n\r\n// calligraphy\r\nexport function genBrushAlpha02(w: number): HTMLCanvasElement {\r\n\r\n    const pDist = 1 / 4;\r\n    let centerSize = 2 / 3;\r\n    let transitionSize = 1 / 3;\r\n    centerSize *= pDist;\r\n    transitionSize *= pDist;\r\n    const p1 = {x: pDist * w, y: w - (w * pDist)};\r\n    const p2 = {x: w - (w * pDist), y: pDist * w};\r\n\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    let ctx = canvas.getContext('2d');\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            const i = (y * w + x) * 4;\r\n\r\n            let col = udSegment({x: x, y: y}, p1, p2);\r\n\r\n            col = BB.clamp(\r\n                255 - ((col - (w * centerSize)) / (w * transitionSize) * 255),\r\n                0,\r\n                255\r\n            );\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = col;\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}","/*\r\n * A speed-improved perlin and simplex noise algorithms for 2D.\r\n *\r\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\n * Better rank ordering method by Stefan Gustavson in 2012.\r\n * Converted to Javascript by Joseph Gentle.\r\n *\r\n * Version 2012-03-09\r\n *\r\n * This code was placed in the public domain by its original author,\r\n * Stefan Gustavson. You may use it as you see fit, but\r\n * attribution is appreciated.\r\n *\r\n */\r\n\r\nconst myModule = {} as any;\r\n\r\n\r\nfunction Grad(x, y, z) {\r\n    this.x = x; this.y = y; this.z = z;\r\n}\r\n\r\nGrad.prototype.dot2 = function(x, y) {\r\n    return this.x*x + this.y*y;\r\n};\r\n/*\r\nGrad.prototype.dot3 = function(x, y, z) {\r\n    return this.x*x + this.y*y + this.z*z;\r\n};*/\r\n\r\nlet grad3 = [new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),\r\n    new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),\r\n    new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];\r\n\r\nlet p = [151,160,137,91,90,15,\r\n    131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,\r\n    190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,\r\n    88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,\r\n    77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,\r\n    102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,\r\n    135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,\r\n    5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,\r\n    223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,\r\n    129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,\r\n    251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,\r\n    49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,\r\n    138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\r\n// To remove the need for index wrapping, double the permutation table length\r\nlet perm = new Array(512);\r\nlet gradP = new Array(512);\r\n\r\n// This isn't a very good seeding function, but it works ok. It supports 2^16\r\n// different seed values. Write something better if you need more seeds.\r\nmyModule.seed = function(seed) {\r\n    if (seed > 0 && seed < 1) {\r\n        // Scale the seed out\r\n        seed *= 65536;\r\n    }\r\n\r\n    seed = Math.floor(seed);\r\n    if (seed < 256) {\r\n        seed |= seed << 8;\r\n    }\r\n\r\n    for (let i = 0; i < 256; i++) {\r\n        let v;\r\n        if (i & 1) {\r\n            v = p[i] ^ (seed & 255);\r\n        } else {\r\n            v = p[i] ^ ((seed>>8) & 255);\r\n        }\r\n\r\n        perm[i] = perm[i + 256] = v;\r\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\r\n    }\r\n};\r\n\r\nmyModule.seed(0);\r\n\r\n/*\r\nfor (let i=0; i<256; i++) {\r\n  perm[i] = perm[i + 256] = p[i];\r\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\r\n}*/\r\n\r\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\r\nlet F2 = 0.5*(Math.sqrt(3)-1);\r\nlet G2 = (3-Math.sqrt(3))/6;\r\n\r\n/*let F3 = 1/3;\r\nlet G3 = 1/6;*/\r\n\r\n// 2D simplex noise\r\nmyModule.simplex2 = function(xin, yin) {\r\n    let n0, n1, n2; // Noise contributions from the three corners\r\n    // Skew the input space to determine which simplex cell we're in\r\n    let s = (xin+yin)*F2; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    let t = (i+j)*G2;\r\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin-j+t;\r\n    // For the 2D case, the simplex shape is an equilateral triangle.\r\n    // Determine which simplex we are in.\r\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n    if (x0>y0) { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n        i1=1; j1=0;\r\n    } else {    // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n        i1=0; j1=1;\r\n    }\r\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n    // c = (3-sqrt(3))/6\r\n    let x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n    let y1 = y0 - j1 + G2;\r\n    let x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n    let y2 = y0 - 1 + 2 * G2;\r\n    // Work out the hashed gradient indices of the three simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    let gi0 = gradP[i+perm[j]];\r\n    let gi1 = gradP[i+i1+perm[j+j1]];\r\n    let gi2 = gradP[i+1+perm[j+1]];\r\n    // Calculate the contribution from the three corners\r\n    let t0 = 0.5 - x0*x0-y0*y0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot2(x0, y0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.5 - x1*x1-y1*y1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\r\n    }\r\n    let t2 = 0.5 - x2*x2-y2*y2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 70 * (n0 + n1 + n2);\r\n};\r\n/*\r\n// 3D simplex noise\r\nmyModule.simplex3 = function(xin, yin, zin) {\r\n    let n0, n1, n2, n3; // Noise contributions from the four corners\r\n\r\n    // Skew the input space to determine which simplex cell we're in\r\n    let s = (xin+yin+zin)*F3; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    let k = Math.floor(zin+s);\r\n\r\n    let t = (i+j+k)*G3;\r\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin-j+t;\r\n    let z0 = zin-k+t;\r\n\r\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n    // Determine which simplex we are in.\r\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n    if (x0 >= y0) {\r\n        if (y0 >= z0)      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; }\r\n        else if (x0 >= z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; }\r\n        else              { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; }\r\n    } else {\r\n        if (y0 < z0)      { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; }\r\n        else if (x0 < z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; }\r\n        else             { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; }\r\n    }\r\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n    // c = 1/6.\r\n    let x1 = x0 - i1 + G3; // Offsets for second corner\r\n    let y1 = y0 - j1 + G3;\r\n    let z1 = z0 - k1 + G3;\r\n\r\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\r\n    let y2 = y0 - j2 + 2 * G3;\r\n    let z2 = z0 - k2 + 2 * G3;\r\n\r\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\r\n    let y3 = y0 - 1 + 3 * G3;\r\n    let z3 = z0 - 1 + 3 * G3;\r\n\r\n    // Work out the hashed gradient indices of the four simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    k &= 255;\r\n    let gi0 = gradP[i+   perm[j+   perm[k   ]]];\r\n    let gi1 = gradP[i+i1+perm[j+j1+perm[k+k1]]];\r\n    let gi2 = gradP[i+i2+perm[j+j2+perm[k+k2]]];\r\n    let gi3 = gradP[i+ 1+perm[j+ 1+perm[k+ 1]]];\r\n\r\n    // Calculate the contribution from the four corners\r\n    let t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\r\n    }\r\n    let t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\r\n    }\r\n    let t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\r\n    if (t3<0) {\r\n        n3 = 0;\r\n    } else {\r\n        t3 *= t3;\r\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 32 * (n0 + n1 + n2 + n3);\r\n\r\n};\r\n*/\r\n// ##### Perlin noise stuff\r\n/*\r\nfunction fade(t) {\r\n    return t*t*t*(t*(t*6-15)+10);\r\n}\r\n\r\nfunction lerp(a, b, t) {\r\n    return (1-t)*a + t*b;\r\n}\r\n\r\n// 2D Perlin Noise\r\nmyModule.perlin2 = function(x, y) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y);\r\n    // Get relative xy coordinates of point within that cell\r\n    x = x - X; y = y - Y;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255;\r\n\r\n    // Calculate noise contributions from each of the four corners\r\n    let n00 = gradP[X+perm[Y]].dot2(x, y);\r\n    let n01 = gradP[X+perm[Y+1]].dot2(x, y-1);\r\n    let n10 = gradP[X+1+perm[Y]].dot2(x-1, y);\r\n    let n11 = gradP[X+1+perm[Y+1]].dot2(x-1, y-1);\r\n\r\n    // Compute the fade curve value for x\r\n    let u = fade(x);\r\n\r\n    // Interpolate the four results\r\n    return lerp(\r\n        lerp(n00, n10, u),\r\n        lerp(n01, n11, u),\r\n        fade(y));\r\n};*/\r\n/*\r\n// 3D Perlin Noise\r\nmyModule.perlin3 = function(x, y, z) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y), Z = Math.floor(z);\r\n    // Get relative xyz coordinates of point within that cell\r\n    x = x - X; y = y - Y; z = z - Z;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255; Z = Z & 255;\r\n\r\n    // Calculate noise contributions from each of the eight corners\r\n    let n000 = gradP[X+  perm[Y+  perm[Z  ]]].dot3(x,   y,     z);\r\n    let n001 = gradP[X+  perm[Y+  perm[Z+1]]].dot3(x,   y,   z-1);\r\n    let n010 = gradP[X+  perm[Y+1+perm[Z  ]]].dot3(x,   y-1,   z);\r\n    let n011 = gradP[X+  perm[Y+1+perm[Z+1]]].dot3(x,   y-1, z-1);\r\n    let n100 = gradP[X+1+perm[Y+  perm[Z  ]]].dot3(x-1,   y,   z);\r\n    let n101 = gradP[X+1+perm[Y+  perm[Z+1]]].dot3(x-1,   y, z-1);\r\n    let n110 = gradP[X+1+perm[Y+1+perm[Z  ]]].dot3(x-1, y-1,   z);\r\n    let n111 = gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1, y-1, z-1);\r\n\r\n    // Compute the fade curve value for x, y, z\r\n    let u = fade(x);\r\n    let v = fade(y);\r\n    let w = fade(z);\r\n\r\n    // Interpolate\r\n    return lerp(\r\n        lerp(\r\n            lerp(n000, n100, u),\r\n            lerp(n001, n101, u), w),\r\n        lerp(\r\n            lerp(n010, n110, u),\r\n            lerp(n011, n111, u), w),\r\n        v);\r\n};*/\r\n\r\nexport const noise = myModule;","import {BB} from '../../bb/bb';\r\nimport {IRGB, IRGBA} from '../kl.types';\r\nimport {IBounds, IPressureInput} from '../../bb/bb.types';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\n\r\nconst cellSize = 256;\r\n\r\ninterface IDrawBufferItem {\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    opacity: number;\r\n    x1: number;\r\n    y1: number;\r\n    x2: number;\r\n    y2: number;\r\n    r: number;\r\n    g: number;\r\n    b: number;\r\n}\r\n\r\n// faster than using BB.clamp somehow (in chrome)\r\nfunction clamp(num, min, max) {\r\n    return num <= min\r\n        ? min\r\n        : num >= max\r\n            ? max\r\n            : num\r\n}\r\n\r\nexport class BlendBrush {\r\n\r\n    private isTesting: boolean = false; // testing mode - context only gets updated when line is finished\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private color: IRGB;\r\n    private size: number = 29; // radius - 0.5 - 99999\r\n    private opacity: number = 0.6; // 0-1\r\n    private blending: number = 0.65; // 0-1\r\n\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingSizePressure: boolean = true;\r\n    private settingOpacityPressure: boolean = false;\r\n\r\n    private blendCol: IRGBA = {r: 0, g: 0, b: 0, a: 1}; // todo docs\r\n    private blendMix: number = 0.45; // todo docs\r\n    private mixr: number; // todo docs\r\n    private mixg: number; // todo docs\r\n    private mixb: number; // todo docs\r\n    private localColOld: IRGBA; // todo docs\r\n\r\n    private isDrawing: boolean = false;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private bezierLine: any; // todo type\r\n\r\n    private history: KlHistoryInterface | null;\r\n    private historyEntry: IHistoryEntry;\r\n    private redrawBounds: IBounds;\r\n    private cells: (ImageData | null)[];\r\n    private drawBuffer: IDrawBufferItem[];\r\n\r\n    private updateRedrawBounds (bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    private getCellsWidth(): number {\r\n        return Math.ceil(this.context.canvas.width / cellSize);\r\n    }\r\n\r\n    /**\r\n     * draw changed cells (changed by brushstroke) onto context\r\n     * @private\r\n     */\r\n    private drawChangedCells(): void {\r\n        const cells = this.cells.map(item => null);\r\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\r\n        touchedCells.forEach((isTouched, index) => {\r\n            if (isTouched) {\r\n                cells[index] = this.cells[index];\r\n            }\r\n        });\r\n        this.drawCells(cells);\r\n        this.redrawBounds = null;\r\n    }\r\n\r\n    private getTouchedCells(bounds: IBounds): boolean[] {\r\n        const touchedCells = this.cells.map(item => false);\r\n        const cellsW = this.getCellsWidth();\r\n        bounds = {\r\n            x1: Math.floor(bounds.x1 / cellSize),\r\n            y1: Math.floor(bounds.y1 / cellSize),\r\n            x2: Math.floor(bounds.x2 / cellSize),\r\n            y2: Math.floor(bounds.y2 / cellSize),\r\n        };\r\n        for (let i = bounds.x1; i <= bounds.x2; i++) {\r\n            for (let e = bounds.y1; e <= bounds.y2; e++) {\r\n                touchedCells[e * cellsW + i] = true;\r\n            }\r\n        }\r\n        return touchedCells;\r\n    }\r\n\r\n    /**\r\n     * Slice up bounds accordings to cells\r\n     * @param bounds\r\n     * @private\r\n     */\r\n    private sliceBounds(bounds: IBounds): {index: number; bounds: IBounds}[] {\r\n        const cellsW = this.getCellsWidth();\r\n        const result: {index: number; bounds: IBounds}[] = [];\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n\r\n        touchedCells.forEach((cell, i) => {\r\n            if (!cell) {\r\n                return;\r\n            }\r\n\r\n            const cellOffsetX = (i % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(i / cellsW) * cellSize;\r\n            const cellWidth = this.cells[i].width;\r\n            const cellHeight = this.cells[i].height;\r\n\r\n            const inCellBounds = {\r\n                x1: Math.max(0, bounds.x1 - cellOffsetX),\r\n                y1: Math.max(0, bounds.y1 - cellOffsetY),\r\n                x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\r\n                y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY),\r\n            }\r\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) {\r\n                return;\r\n            }\r\n            result.push({\r\n                index: i,\r\n                bounds: inCellBounds,\r\n            });\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    private copyFromCanvas(bounds: IBounds) {\r\n        if (!bounds) {\r\n            return;\r\n        }\r\n\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n        const cellsW = this.getCellsWidth();\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.cells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * cellSize + cellSize, this.context.canvas.width) - 1) % cellSize + 1;\r\n            const h = (Math.min(y * cellSize + cellSize, this.context.canvas.height) - 1) % cellSize + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = tmpCanvas.getContext('2d');\r\n            tmpCtx.drawImage(this.context.canvas, -x * cellSize, -y * cellSize);\r\n\r\n            this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\r\n        });\r\n    }\r\n\r\n    private getAverage (x, y, size): IRGBA {\r\n\r\n        size = Math.max(0.5, size * 0.75);\r\n        const x1 = Math.max(0, Math.floor(x - size));\r\n        const y1 = Math.max(0, Math.floor(y - size));\r\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return {\r\n                r: 0,\r\n                g: 0,\r\n                b: 0,\r\n                a: 0,\r\n            };\r\n        }\r\n\r\n        let ar = 0, ag = 0, ab = 0, aa = 0, alpha;\r\n\r\n        const slicedBounds = this.sliceBounds({ x1, y1, x2, y2 });\r\n        slicedBounds.forEach(slice => {\r\n            const width = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n            const bounds = slice.bounds;\r\n\r\n            for (let i = bounds.y1; i <= bounds.y2; i += 4) {\r\n                for (let e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 4 * 4) {\r\n                    alpha = data[e2 + 3];\r\n                    ar += data[e2] * alpha;\r\n                    ag += data[e2 + 1] * alpha;\r\n                    ab += data[e2 + 2] * alpha;\r\n                    aa += alpha;\r\n                }\r\n            }\r\n        });\r\n\r\n        if (aa !== 0) {\r\n            ar /= aa;\r\n            ag /= aa;\r\n            ab /= aa;\r\n            aa = Math.min(1, aa);\r\n        }\r\n        return {\r\n            r: ar,\r\n            g: ag,\r\n            b: ab,\r\n            a: aa\r\n        };\r\n    }\r\n\r\n    private prepDot (x: number, y: number, size: number): IBounds {\r\n        size = Math.max(0.5, size);\r\n        let x1 = Math.max(0, Math.floor(x - size));\r\n        let y1 = Math.max(0, Math.floor(y - size));\r\n        let x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        let y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return null;\r\n        }\r\n        return { x1, y1, x2, y2 };\r\n    }\r\n\r\n    private drawDot (params: IDrawBufferItem): void {\r\n        // array with random numbers. faster than Math.random()\r\n        let randI = 0;\r\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n        const randArr = [];\r\n        for (let i = 0; i < randLen; i++) {\r\n            randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n        }\r\n\r\n        // thin lines take more than just 1 sample\r\n        const sampleArr = [8,4,4,4,2,2,2,2,2,2]; // <0.5, 0.5, 1, 1.5, etc.\r\n        const samples = sampleArr[Math.floor(params.size * 2)];\r\n        const samplesSquared: number = samples ? samples * samples : 0;\r\n        const sampleOffsets = [];\r\n        if (samples) {\r\n            let i = 0;\r\n            for (let n = 0; n < samples; n++) {\r\n                for (let m = 0; m < samples; m++, i += 2) {\r\n                    sampleOffsets[i] = (n + 1) / samples; // x offset\r\n                    sampleOffsets[i + 1] = (m + 1) / samples; // y offset\r\n                }\r\n            }\r\n        }\r\n\r\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\r\n        // to optimize calculations\r\n        const invSharpness = 1 - sharpness;\r\n        const sharpnessSubtrahend = sharpness / invSharpness;\r\n        const sizeSquared = params.size * params.size;\r\n        const distDivisor = sizeSquared * invSharpness / params.opacity;\r\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\r\n\r\n\r\n        const slicedBounds = this.sliceBounds({\r\n            x1: params.x1,\r\n            y1: params.y1,\r\n            x2: params.x2,\r\n            y2: params.y2,\r\n        });\r\n\r\n        const cellsW = this.getCellsWidth();\r\n        slicedBounds.forEach(slice => {\r\n            const cellOffsetX = (slice.index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(slice.index / cellsW) * cellSize;\r\n            const cellWidth = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n\r\n            // i - y index within cell\r\n            // e - x index within cell\r\n\r\n            // e2 - index in image data\r\n\r\n            // ri - y index within image relative to dot-center\r\n            // re - x index within image relative to dot-center\r\n\r\n            for (let i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++) {\r\n                for (\r\n                    let e = slice.bounds.x1,\r\n                        e2 = i * cellWidth * 4 + slice.bounds.x1 * 4,\r\n                        re = e + cellOffsetX - params.x;\r\n                    e <= slice.bounds.x2;\r\n                    e++,\r\n                        e2 += 4,\r\n                        re++\r\n                ) {\r\n                    // O = over -> brush-dot\r\n                    // U = under -> image\r\n\r\n                    let alphaO = 0;\r\n                    if (samplesSquared) {\r\n                        for (let f = 0; f < sampleOffsets.length; f += 2) {\r\n                            const dist = BB.lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\r\n                            if (dist >= sizeSquared) {\r\n                                continue;\r\n                            }\r\n                            alphaO += clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                        }\r\n                        if (!alphaO) {\r\n                            continue;\r\n                        }\r\n                        alphaO /= samplesSquared;\r\n                    } else {\r\n                        // technically needs + 0.5 offset, but not noticeable with large brush\r\n                        const dist = Math.pow(re, 2) + Math.pow(ri, 2);\r\n                        if (dist >= sizeSquared) {\r\n                            continue;\r\n                        }\r\n                        alphaO = clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                    }\r\n\r\n                    const invAlphaO = 1 - alphaO;\r\n                    const alphaU =data[e2 + 3] / 255;\r\n\r\n                    if (this.settingLockLayerAlpha) {\r\n                        const underR = (params.r * alphaO) + ((data[e2]) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1]) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2]) * invAlphaO);\r\n                        if (alphaU) {\r\n                            data[e2] = Math.floor(underR + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB + randArr[randI]);\r\n                        }\r\n                    } else {\r\n                        const underR = (params.r * alphaO) + ((data[e2] * alphaU) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1] * alphaU) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2] * alphaU) * invAlphaO);\r\n\r\n                        let newAlpha = 1 - invAlphaO * (1 - alphaU);\r\n                        data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\r\n                        if (newAlpha) {\r\n                            data[e2] = Math.floor(underR / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB / (newAlpha) + randArr[randI]);\r\n                        }\r\n                    }\r\n                    randI = (randI + 1) % randLen;\r\n\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    private calcSpacing (size: number): number {\r\n        return BB.mix(\r\n            (size * 2) / 2, // until size 5.3\r\n            (size * 2) / 9, // at size 24\r\n            BB.clamp((size - 2.7) / (12 - 2.7), 0, 1)\r\n        );\r\n    }\r\n\r\n    private continueLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n\r\n        this.drawBuffer = [];\r\n\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (this.settingSizePressure) ? Math.max(1, p * this.size) : Math.max(1, this.size);\r\n\r\n        let bdist = this.calcSpacing(localSize);\r\n\r\n        let avgX = x;\r\n        let avgY = y;\r\n        if (x === null) {\r\n            avgX = this.lastInput.x;\r\n            avgY = this.lastInput.y;\r\n        }\r\n\r\n        let localColNew;\r\n\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            let average;\r\n            if (isCoalesced) {\r\n                average = {r: this.localColOld.r, g: this.localColOld.g, b: this.localColOld.b, a: 0};\r\n            } else {\r\n                const avgParams = [avgX, avgY, ((this.settingSizePressure) ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size))];\r\n                const bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\r\n                this.copyFromCanvas(bounds);\r\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\r\n            }\r\n            localColNew = {r: 0, g: 0, b: 0, a: 0};\r\n\r\n            if (average.a > 0 && this.blendCol.a === 0) {\r\n                this.blendCol.r = average.r;\r\n                this.blendCol.g = average.g;\r\n                this.blendCol.b = average.b;\r\n                this.blendCol.a = average.a;\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n\r\n            } else {\r\n                if (average.a === 0) {\r\n                    average.r = this.color.r;\r\n                    average.g = this.color.g;\r\n                    average.b = this.color.b;\r\n                    average.a = 1 - this.blending;\r\n                }\r\n\r\n                this.blendCol.r = BB.mix(this.blendCol.r, BB.mix(this.blendCol.r, average.r, this.blendMix), average.a);\r\n                this.blendCol.g = BB.mix(this.blendCol.g, BB.mix(this.blendCol.g, average.g, this.blendMix), average.a);\r\n                this.blendCol.b = BB.mix(this.blendCol.b, BB.mix(this.blendCol.b, average.b, this.blendMix), average.a);\r\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n            }\r\n\r\n        }\r\n\r\n\r\n        const bezierCallback = (val) => {\r\n            if (this.blending >= 1 && this.blendCol.a <= 0) {\r\n                return;\r\n            }\r\n            let factor = val.t;\r\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (this.settingOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\r\n            localSize = (this.settingSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\r\n            if (this.blending != 0) {\r\n                this.mixr = BB.mix(this.localColOld.r, localColNew.r, factor);\r\n                this.mixg = BB.mix(this.localColOld.g, localColNew.g, factor);\r\n                this.mixb = BB.mix(this.localColOld.b, localColNew.b, factor);\r\n            }\r\n            if (this.blending === 1 && this.localColOld.a === 0) {\r\n                this.mixr = localColNew.r;\r\n                this.mixg = localColNew.g;\r\n                this.mixb = localColNew.b;\r\n            }\r\n            const bounds = this.prepDot(val.x, val.y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: val.x,\r\n                    y: val.y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                })\r\n            }\r\n        };\r\n\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.localColOld = localColNew;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.size;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.size = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.opacity = o;\r\n    }\r\n\r\n    getBlending (): number {\r\n        return this.blending;\r\n    }\r\n\r\n    setBlending (b: number) {\r\n        this.blending = b;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.color = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setSizePressure (b: boolean): void {\r\n        this.settingSizePressure = !!b;\r\n    }\r\n\r\n    setOpacityPressure (b: boolean): void {\r\n        this.settingOpacityPressure = !!b;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setIsTesting (b: boolean): void {\r\n        this.isTesting = !!b;\r\n    }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: [\"brush\", \"BlendBrush\"],\r\n            actions: []\r\n        };\r\n\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n\r\n        this.isDrawing = true;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        let localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            this.copyFromCanvas(this.prepDot(x, y, localSize));\r\n\r\n            let average = this.getAverage(\r\n                x,\r\n                y,\r\n                ((this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size))\r\n            );\r\n            if (average.a === 0) {\r\n                this.blendCol = {\r\n                    r: this.color.r,\r\n                    g: this.color.g,\r\n                    b: this.color.b,\r\n                    a: 1 - this.blending,\r\n                };\r\n            } else {\r\n                this.blendCol = {\r\n                    r: average.r,\r\n                    g: average.g,\r\n                    b: average.b,\r\n                    a: average.a,\r\n                };\r\n            }\r\n\r\n            this.mixr = this.blendCol.r;\r\n            this.mixg = this.blendCol.g;\r\n            this.mixb = this.blendCol.b;\r\n        }\r\n\r\n        this.localColOld = {r: this.mixr, g: this.mixg, b: this.mixb, a: this.blendCol.a};\r\n\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        if (this.blending < 1 || this.blendCol.a > 0) {\r\n            const bounds = this.prepDot(x, y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x,\r\n                    y: y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                })\r\n            }\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.bezierLine = new BB.BezierLine();\r\n        this.bezierLine.add(x, y, 0, function () {\r\n        });\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    endLine (): void {\r\n        if (this.bezierLine) {\r\n            this.continueLine(null, null, this.lastInput.pressure, false);\r\n        }\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.drawChangedCells();\r\n        }\r\n\r\n        if (this.historyEntry && this.history && this.cells.find(item => !!item)) {\r\n            this.historyEntry.actions.push({\r\n                action: \"drawCells\",\r\n                params: [this.cells],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n\r\n    /**\r\n     * draw cells onto context\r\n     * @param cells\r\n     */\r\n    drawCells (cells: (ImageData | null)[]): void {\r\n        const cellsW = this.getCellsWidth();\r\n        cells.forEach((imageData, index) => {\r\n            if (!imageData) {\r\n                return;\r\n            }\r\n            const cellOffsetX = (index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(index / cellsW) * cellSize;\r\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\r\n        });\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\r\n        let average = this.getAverage(x1, y1, Math.max(0.1, this.size));\r\n\r\n        if (average.a === 0) {\r\n            this.blendCol = {\r\n                r: this.color.r,\r\n                g: this.color.g,\r\n                b: this.color.b,\r\n                a: 1 - this.blending,\r\n            };\r\n        } else {\r\n            this.blendCol = {\r\n                r: average.r,\r\n                g: average.g,\r\n                b: average.b,\r\n                a: average.a,\r\n            };\r\n        }\r\n\r\n        this.mixr = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixg = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixb = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\r\n\r\n\r\n        const p = 1;\r\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        const bdist = this.calcSpacing(localSize);\r\n        for (let loopDist = 0; loopDist <= mouseDist; loopDist += bdist) {\r\n            const bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\r\n            if (bounds) {\r\n                this.copyFromCanvas(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x1 + eX * loopDist,\r\n                    y: y1 + eY * loopDist,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                })\r\n            }\r\n        }\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        if (this.history && this.cells.find(item => !!item)) {\r\n            this.drawCells(this.cells);\r\n            this.historyEntry = {\r\n                tool: [\"brush\", \"BlendBrush\"],\r\n                actions: [{\r\n                    action: \"drawCells\",\r\n                    params: [this.cells],\r\n                }],\r\n            };\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\nconst sampleCanvas = BB.canvas(32, 32);\r\nconst sampleCtx = sampleCanvas.getContext('2d');\r\n\r\nexport function SketchyBrush() {\r\n    let context;\r\n    let settingColor;\r\n\r\n    let settingSize = 1, settingOpacity = 0.2;\r\n    let settingBlending = 0.5;\r\n    let settingScale = 1;\r\n\r\n    let lastX, lastY;\r\n    let isDrawing = false;\r\n    let lastInput = {x: 0, y: 0, pressure: 0};\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n    let sketchySeed = 0;\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSeed = function (s) {\r\n        sketchySeed = parseInt(s);\r\n    };\r\n    this.getSeed = function () {\r\n        return parseInt('' + sketchySeed);\r\n    };\r\n\r\n    function rand() {\r\n        sketchySeed++;\r\n        return Math.sin(6324634.2345 * Math.cos(sketchySeed * 5342.3423)) * 0.5 + 0.5;\r\n    }\r\n\r\n    let points = [];\r\n    let count = 0;\r\n    let mixmode = [\r\n        function (c1, c2) {\r\n            return c1;\r\n        },\r\n        function (c1, c2) {\r\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\r\n            result.r *= c2.r / 255;\r\n            result.g *= c2.g / 255;\r\n            result.b *= c2.b / 255;\r\n            return result;\r\n        },\r\n        function (c1, c2) {\r\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\r\n            result.r *= c2.r / 255;\r\n            result.g *= c2.g / 255;\r\n            result.b *= c2.b / 255;\r\n            return result;\r\n        }\r\n    ];\r\n\r\n    this.getSize = function () {\r\n        return settingSize / 2;\r\n    };\r\n    this.setColor = function (c) {\r\n        settingColor = c;\r\n    };\r\n    this.getOpacity = function () {\r\n        return settingOpacity;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        settingOpacity = o;\r\n    };\r\n    this.getBlending = function () {\r\n        return settingBlending;\r\n    };\r\n    this.setBlending = function (b) {\r\n        settingBlending = b;\r\n    };\r\n    this.setSize = function (s) {\r\n        settingSize = s * 2;\r\n    };\r\n    this.getScale = function () {\r\n        return settingScale;\r\n    };\r\n    this.setScale = function (s) {\r\n        settingScale = s;\r\n    };\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.startLine = function (x, y, pressure, shift) {\r\n        if (shift && lastInput.x) {\r\n            let lx = lastInput.x, ly = lastInput.y;\r\n            isDrawing = true;\r\n            //this.goLine(x,y,pressure);\r\n            this.endLine();\r\n        } else {\r\n            isDrawing = true;\r\n            lastX = x;\r\n            lastY = y;\r\n            lastInput.x = x;\r\n            lastInput.y = y;\r\n            historyEntry = {\r\n                tool: [\"brush\", \"SketchyBrush\"],\r\n                actions: []\r\n            };\r\n            historyEntry.actions.push({\r\n                action: \"setScale\",\r\n                params: [settingScale]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setSize\",\r\n                params: [settingSize / 2]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setOpacity\",\r\n                params: [settingOpacity]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setColor\",\r\n                params: [settingColor]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setBlending\",\r\n                params: [settingBlending]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"startLine\",\r\n                params: [x, y, pressure]\r\n            });\r\n        }\r\n\r\n    };\r\n    this.goLine = function (p_x, p_y, pressure, preMixedColor) {\r\n        if (!isDrawing || (p_x === lastInput.x && p_y === lastInput.y)) {\r\n            return;\r\n        }\r\n\r\n        let e, b, a, g;\r\n        let x = parseInt(p_x);\r\n        let y = parseInt(p_y);\r\n        points.push([x, y]);\r\n\r\n        let mixr = settingColor.r;\r\n        let mixg = settingColor.g;\r\n        let mixb = settingColor.b;\r\n\r\n        if (preMixedColor !== null) {\r\n            mixr = preMixedColor.r;\r\n            mixg = preMixedColor.g;\r\n            mixb = preMixedColor.b;\r\n        } else {\r\n            if (settingBlending !== 0) {\r\n                if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < context.canvas.width - 1 && y - 5 < context.canvas.height - 1) {\r\n                    mixr = 0;\r\n                    mixg = 0;\r\n                    mixb = 0;\r\n                    let mixx = Math.min(context.canvas.width - 1, Math.max(0, x - 5));\r\n                    let mixy = Math.min(context.canvas.height - 1, Math.max(0, y - 5));\r\n                    let mixw = Math.min(context.canvas.width - 1, Math.max(0, x + 5));\r\n                    let mixh = Math.min(context.canvas.height - 1, Math.max(0, y + 5));\r\n                    mixw -= mixx;\r\n                    mixh -= mixy;\r\n\r\n                    if (mixw > 0 && mixh > 0) {\r\n                        let imdat = context.getImageData(mixx, mixy, mixw, mixh);\r\n                        let countmix = 0;\r\n                        for (let i = 0; i < imdat.data.length; i += 4) {\r\n                            mixr += imdat.data[i + 0];\r\n                            mixg += imdat.data[i + 1];\r\n                            mixb += imdat.data[i + 2];\r\n                            countmix++;\r\n                        }\r\n                        mixr /= countmix;\r\n                        mixg /= countmix;\r\n                        mixb /= countmix;\r\n                    }\r\n\r\n                    let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\r\n                    mixr = parseInt('' + BB.mix(settingColor.r, mixed.r, settingBlending));\r\n                    mixg = parseInt('' + BB.mix(settingColor.g, mixed.g, settingBlending));\r\n                    mixb = parseInt('' + BB.mix(settingColor.b, mixed.b, settingBlending));\r\n                }\r\n            }\r\n        }\r\n\r\n        context.save();\r\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\r\n        context.lineWidth = settingSize;\r\n\r\n        context.beginPath();\r\n        context.moveTo(lastX, lastY);\r\n        context.lineTo(x, y);\r\n\r\n        for (e = 0; e < points.length; e++) {\r\n            b = points[e][0] - points[count][0];\r\n            a = points[e][1] - points[count][1];\r\n            g = b * b + a * a;\r\n            if (g < 4000 * settingScale * settingScale && rand() > g / 2000 / settingScale / settingScale) {\r\n                context.moveTo(points[count][0] + (b * 0.3), points[count][1] + (a * 0.3));\r\n                context.lineTo(points[e][0] - (b * 0.3), points[e][1] - (a * 0.3));\r\n            }\r\n        }\r\n\r\n        context.stroke();\r\n        context.restore();\r\n\r\n\r\n        count++;\r\n        lastX = x;\r\n        lastY = y;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [p_x, p_y, pressure, {r: mixr, g: mixg, b: mixb}]\r\n        });\r\n    };\r\n    this.endLine = function () {\r\n        isDrawing = false;\r\n        count = 0;\r\n        points = [];\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: []\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n\r\n        context.save();\r\n        context.lineWidth = settingSize;\r\n\r\n        let mixr = settingColor.r, mixg = settingColor.g, mixb = settingColor.b;\r\n        if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < context.canvas.width - 1 && y1 - 5 < context.canvas.height - 1) {\r\n            mixr = 0;\r\n            mixg = 0;\r\n            mixb = 0;\r\n            let mixx = Math.min(context.canvas.width - 1, Math.max(0, x1 - 5));\r\n            let mixy = Math.min(context.canvas.height - 1, Math.max(0, y1 - 5));\r\n            let mixw = Math.min(context.canvas.width - 1, Math.max(0, x1 + 5));\r\n            let mixh = Math.min(context.canvas.height - 1, Math.max(0, y1 + 5));\r\n            mixw -= mixx;\r\n            mixh -= mixy;\r\n            if (mixw > 0 && mixh > 0) {\r\n                let w = Math.min(sampleCanvas.width, mixw);\r\n                let h = Math.min(sampleCanvas.height, mixh);\r\n                sampleCtx.save();\r\n                sampleCtx.globalCompositeOperation = 'copy';\r\n                sampleCtx.drawImage(context.canvas, mixx, mixy, mixw, mixh, 0, 0, w, h);\r\n                sampleCtx.restore();\r\n\r\n                let imdat = sampleCtx.getImageData(mixx, mixy, mixw, mixh);\r\n                let countmix = 0;\r\n                for (let i = 0; i < imdat.data.length; i += 4) {\r\n                    mixr += imdat.data[i + 0];\r\n                    mixg += imdat.data[i + 1];\r\n                    mixb += imdat.data[i + 2];\r\n                    countmix++;\r\n                }\r\n                mixr /= countmix;\r\n                mixg /= countmix;\r\n                mixb /= countmix;\r\n            }\r\n        }\r\n        let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\r\n        mixr = parseInt('' + (settingBlending * mixed.r + settingColor.r * (1 - settingBlending)));\r\n        mixg = parseInt('' + (settingBlending * mixed.g + settingColor.g * (1 - settingBlending)));\r\n        mixb = parseInt('' + (settingBlending * mixed.b + settingColor.b * (1 - settingBlending)));\r\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\r\n        context.beginPath();\r\n        context.moveTo(x1, y1);\r\n        context.lineTo(x2, y2);\r\n        context.stroke();\r\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\r\n        context.restore();\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"SketchyBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"setScale\",\r\n            params: [settingScale]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize / 2]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setBlending\",\r\n            params: [settingBlending]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    this.isDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\nexport function PixelBrush() {\r\n\r\n    let context;\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n\r\n    let settingColor, settingSize = 0.5, settingSpacing = 0.9, settingOpacity = 1;\r\n    let settingColorStr;\r\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\r\n    let settingLockLayerAlpha = false;\r\n    let settingIsEraser = false;\r\n    let settingUseDither = true;\r\n\r\n    let lineToolLastDot;\r\n    let lastInput = {x: 0, y: 0, pressure: 0};\r\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\r\n\r\n    let isDrawing = false;\r\n    let bezierLine = null;\r\n    let twoPI = Math.PI * 2;\r\n\r\n\r\n    let ditherCanvas = BB.canvas(4, 4);\r\n    let ditherCtx = ditherCanvas.getContext('2d');\r\n    let ditherPattern;\r\n    let ditherArr = [\r\n        [3, 2],\r\n        [1, 0],\r\n        [3, 0],\r\n        [1, 2],\r\n        [2, 1],\r\n        [0, 3],\r\n        [0, 1],\r\n        [2, 3],\r\n\r\n        [2, 0],\r\n        [0, 2],\r\n        [0, 0],\r\n        [2, 2],\r\n        [1, 1],\r\n        [3, 3],\r\n        [3, 1],\r\n        [1, 3]\r\n    ];\r\n\r\n    function updateDither() {\r\n        ditherCtx.clearRect(0, 0, 4, 4);\r\n        ditherCtx.fillStyle = settingIsEraser ? '#fff' : settingColorStr;\r\n        for (let i = 0; i < Math.max(1, Math.round(settingOpacity * ditherArr.length)); i++) {\r\n            ditherCtx.fillRect(ditherArr[i][0], ditherArr[i][1], 1, 1);\r\n        }\r\n        ditherPattern = context.createPattern(ditherCanvas, 'repeat');\r\n    }\r\n\r\n\r\n    /**\r\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\r\n     * @param p1\r\n     * @param p2\r\n     * @param p3\r\n     * @param p4\r\n     * @param maxAngleRad\r\n     */\r\n    function cubicCurveOverThreshold(p1, p2, p3, p4, max) {\r\n        let d = BB.Vec2.nor({\r\n            x: p4.x - p1.x,\r\n            y: p4.y - p1.y\r\n        });\r\n        let d2 = BB.Vec2.nor({\r\n            x: p2.x - p1.x,\r\n            y: p2.y - p1.y\r\n        });\r\n        let d3 = BB.Vec2.nor({\r\n            x: p4.x - p3.x,\r\n            y: p4.y - p3.y\r\n        });\r\n        let a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\r\n        let a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\r\n\r\n        return Math.max(BB.Vec2.dist(d, d2), BB.Vec2.dist(d, d3)) > max;\r\n    }\r\n\r\n    //bresenheim line drawing\r\n    function plotLine(x0, y0, x1, y1, skipFirst) {\r\n        context.save();\r\n\r\n        if (settingIsEraser) {\r\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            } else {\r\n                context.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        } else {\r\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        }\r\n        context.globalAlpha = settingUseDither ? 1 : settingOpacity;\r\n\r\n        x0 = Math.floor(x0);\r\n        y0 = Math.floor(y0);\r\n        x1 = Math.floor(x1);\r\n        y1 = Math.floor(y1);\r\n\r\n        let dX = Math.abs(x1 - x0);\r\n        let sX = x0 < x1 ? 1 : -1;\r\n        let dY = -Math.abs(y1 - y0);\r\n        let sY = y0 < y1 ? 1 : -1;\r\n        let err = dX + dY;\r\n        while (true) {\r\n            if (skipFirst) {\r\n                skipFirst = false;\r\n            } else {\r\n                context.fillRect(x0, y0, 1, 1);\r\n            }\r\n            if (x0 === x1 && y0 === y1) {\r\n                break;\r\n            }\r\n            let e2 = 2 * err;\r\n            if (e2 >= dY) {\r\n                err += dY;\r\n                x0 += sX;\r\n            }\r\n            if (e2 <= dX) {\r\n                err += dX;\r\n                y0 += sY;\r\n            }\r\n        }\r\n\r\n        context.restore();\r\n    }\r\n\r\n    function plotCubicBezierLine(p1, p2, p3, p4) {\r\n\r\n        let isOverThreshold = cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\r\n\r\n        p1.x = Math.floor(p1.x);\r\n        p1.y = Math.floor(p1.y);\r\n        p4.x = Math.floor(p4.x);\r\n        p4.y = Math.floor(p4.y);\r\n\r\n        let dist = BB.dist(p1.x, p1.y, p4.x, p4.y);\r\n        if (!isOverThreshold || dist < 7) {\r\n            plotLine(p1.x, p1.y, p4.x, p4.y, true);\r\n            return;\r\n        }\r\n\r\n        let n = Math.max(2, Math.round(dist / 4));\r\n        let pointArr = [];\r\n        for (let i = 0; i <= n; i++) {\r\n            let t = i / n;\r\n            let a = Math.pow(1 - t, 3);\r\n            let b = 3 * t * Math.pow(1 - t, 2);\r\n            let c = 3 * Math.pow(t, 2) * (1 - t);\r\n            let d = Math.pow(t, 3);\r\n            pointArr.push({\r\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\r\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            plotLine(\r\n                Math.round(pointArr[i].x),\r\n                Math.round(pointArr[i].y),\r\n                Math.round(pointArr[i + 1].x),\r\n                Math.round(pointArr[i + 1].y),\r\n                true\r\n            );\r\n        }\r\n    }\r\n\r\n    function drawDot(x, y, size, opacity, angle?) {\r\n        context.save();\r\n        if (settingIsEraser) {\r\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            } else {\r\n                context.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        } else {\r\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        }\r\n        context.globalAlpha = settingUseDither ? 1 : opacity;\r\n        context.fillRect(\r\n            Math.round(x + -size),\r\n            Math.round(y + -size),\r\n            Math.round(size * 2),\r\n            Math.round(size * 2)\r\n        );\r\n        context.restore();\r\n    }\r\n\r\n\r\n    function continueLine(x, y, size, pressure) {\r\n        if (bezierLine === null) {\r\n            bezierLine = new BB.BezierLine();\r\n            bezierLine.add(lastInput.x, lastInput.y, 0, function () {\r\n            });\r\n        }\r\n\r\n        context.save();\r\n\r\n        function dotCallback(val) {\r\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\r\n            let localOpacity = settingOpacity * (settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            let localSize = Math.max(0.5, settingSize * (settingHasSizePressure ? localPressure : 1));\r\n            drawDot(val.x, val.y, localSize, localOpacity, val.angle);\r\n        }\r\n\r\n        function controlCallback(controlObj) {\r\n            plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\r\n        }\r\n\r\n        if (Math.round(settingSize * 2) === 1) {\r\n            if (x === null) {\r\n                bezierLine.addFinal(4, null, controlCallback);\r\n            } else {\r\n                bezierLine.add(x, y, 4, null, controlCallback);\r\n            }\r\n\r\n        } else {\r\n            let localSpacing = size * settingSpacing;\r\n\r\n            if (x === null) {\r\n                bezierLine.addFinal(localSpacing, dotCallback);\r\n            } else {\r\n                bezierLine.add(x, y, localSpacing, dotCallback);\r\n            }\r\n        }\r\n\r\n        context.restore();\r\n    }\r\n\r\n    //------------------ interface ---------------------------------------------------\r\n\r\n\r\n    this.startLine = function (x, y, p) {\r\n        historyEntry = {\r\n            tool: [\"brush\", \"PixelBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setIsEraser\",\r\n            params: [settingIsEraser]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setUseDither\",\r\n            params: [settingUseDither]\r\n        });\r\n\r\n        if (settingUseDither) {\r\n            updateDither();\r\n        }\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localOpacity = settingHasOpacityPressure ? (settingOpacity * p * p) : settingOpacity;\r\n        let localSize = settingHasSizePressure ? Math.max(0.5, p * settingSize) : Math.max(0.5, settingSize);\r\n\r\n        isDrawing = true;\r\n        drawDot(x, y, localSize, localOpacity);\r\n        lineToolLastDot = localSize * settingSpacing;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n        lastInput2 = BB.copyObj(lastInput);\r\n\r\n        historyEntry.actions.push({\r\n            action: \"startLine\",\r\n            params: [x, y, p]\r\n        });\r\n    };\r\n\r\n    this.goLine = function (x, y, p) {\r\n        if (!isDrawing) {\r\n            return;\r\n        }\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [x, y, p]\r\n        });\r\n\r\n        //debug\r\n        //drawDot(x, y, 1, 0.5);\r\n\r\n        let pressure = BB.clamp(p, 0, 1);\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n\r\n        continueLine(x, y, localSize, lastInput.pressure);\r\n\r\n        lastInput2 = BB.copyObj(lastInput);\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = pressure;\r\n    };\r\n\r\n    this.endLine = function (x, y) {\r\n\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n        continueLine(null, null, localSize, lastInput.pressure);\r\n\r\n        //debug\r\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\r\n        //drawDot(x, y, 10, 0.1);\r\n\r\n        isDrawing = false;\r\n\r\n        bezierLine = null;\r\n\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: [x, y]\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (settingUseDither) {\r\n            updateDither();\r\n        }\r\n\r\n        if (Math.round(settingSize * 2) === 1) {\r\n            plotLine(x1, y1, x2, y2, true);\r\n        } else {\r\n            let angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\r\n            let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n            let eX = (x2 - x1) / mouseDist;\r\n            let eY = (y2 - y1) / mouseDist;\r\n            let loopDist;\r\n            let bdist = settingSize * settingSpacing;\r\n            lineToolLastDot = settingSize * settingSpacing;\r\n            for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n                drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\r\n            }\r\n        }\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"PixelBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setIsEraser\",\r\n            params: [settingIsEraser]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setUseDither\",\r\n            params: [settingUseDither]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    //IS\r\n    this.isDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n    //SET\r\n    this.setColor = function (c) {\r\n        if (settingColor === c) {\r\n            return;\r\n        }\r\n        settingColor = c;\r\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\r\n    };\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSize = function (s) {\r\n        settingSize = Math.round(s * 2) / 2;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        settingOpacity = o;\r\n    };\r\n    this.setSpacing = function (s) {\r\n        settingSpacing = s;\r\n    };\r\n    this.sizePressure = function (b) {\r\n        settingHasSizePressure = b;\r\n    };\r\n    this.opacityPressure = function (b) {\r\n        settingHasOpacityPressure = b;\r\n    };\r\n    this.setLockAlpha = function (b) {\r\n        settingLockLayerAlpha = b;\r\n    };\r\n    this.setIsEraser = function (b) {\r\n        settingIsEraser = !!b;\r\n    };\r\n    this.setUseDither = function (b) {\r\n        settingUseDither = !!b;\r\n    };\r\n    //GET\r\n    this.getSpacing = function () {\r\n        return settingSpacing;\r\n    };\r\n    this.getSize = function () {\r\n        return settingSize;\r\n    };\r\n    this.getOpacity = function () {\r\n        return settingOpacity;\r\n    };\r\n    this.getLockAlpha = function () {\r\n        return settingLockLayerAlpha;\r\n    };\r\n    this.getIsEraser = function () {\r\n        return settingIsEraser;\r\n    };\r\n    this.getUseDither = function () {\r\n        return settingUseDither;\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\nexport function EraserBrush() {\r\n    let context;\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n\r\n    let size = 30, spacing = 0.4, opacity = 1;\r\n    let sizePressure = true, opacityPressure = false;\r\n    let lastDot, lastInput = {x: 0, y: 0, pressure: 0};\r\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\r\n    let started = false;\r\n\r\n    let bezierLine;\r\n    let isBaseLayer = false;\r\n    let isTransparentBG = false;\r\n\r\n    function drawDot(x, y, size, opacity) {\r\n\r\n        context.save();\r\n        if (isBaseLayer) {\r\n            if (isTransparentBG) {\r\n                context.globalCompositeOperation = \"destination-out\";\r\n            } else {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        } else {\r\n            context.globalCompositeOperation = \"destination-out\";\r\n        }\r\n        let radgrad = context.createRadialGradient(size, size, 0, size, size, size);\r\n        let sharpness = Math.pow(opacity, 2);\r\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\r\n        let oFac = Math.max(0, Math.min(1, opacity));\r\n        let localOpacity = 2 * oFac - oFac * oFac;\r\n        radgrad.addColorStop(sharpness, \"rgba(255, 255, 255, \" + localOpacity + \")\");\r\n        radgrad.addColorStop(1, \"rgba(255, 255, 255, 0)\");\r\n        context.fillStyle = radgrad;\r\n        context.translate(x - size, y - size);\r\n        context.fillRect(0, 0, size * 2, size * 2);\r\n        context.restore();\r\n    }\r\n\r\n    function continueLine(x, y, p) {\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\r\n\r\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * localSize * spacing);\r\n\r\n        function bezierCallback(val) {\r\n            let factor = val.t;\r\n            localPressure = lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (opacityPressure) ? (opacity * localPressure * localPressure) : opacity;\r\n            localSize = (sizePressure) ? Math.max(0.1, localPressure * size) : Math.max(0.1, size);\r\n\r\n            drawDot(val.x, val.y, localSize, localOpacity);\r\n        }\r\n\r\n        if (x === null) {\r\n            bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n    }\r\n\r\n\r\n    this.startLine = function (x, y, p) {\r\n        historyEntry = {\r\n            tool: [\"brush\", \"EraserBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [opacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [sizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [size]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [opacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setTransparentBG\",\r\n            params: [isTransparentBG]\r\n        });\r\n\r\n        isBaseLayer = 0 === context.canvas.index;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localOpacity = (opacityPressure) ? (opacity * p * p) : opacity;\r\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\r\n\r\n        started = true;\r\n        if (localSize > 1) {\r\n            drawDot(x, y, localSize, localOpacity);\r\n        }\r\n        lastDot = localSize * spacing;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n        lastInput2 = BB.copyObj(lastInput);\r\n\r\n        bezierLine = new BB.BezierLine();\r\n        bezierLine.add(x, y, 0, function () {\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"startLine\",\r\n            params: [x, y, p]\r\n        });\r\n    };\r\n    this.goLine = function (x, y, p) {\r\n        if (!started) {\r\n            return;\r\n        }\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [x, y, p]\r\n        });\r\n\r\n        continueLine(x, y, lastInput.pressure);\r\n\r\n        lastInput2 = BB.copyObj(lastInput);\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n    };\r\n    this.endLine = function () {\r\n\r\n        if (bezierLine) {\r\n            continueLine(null, null, lastInput.pressure);\r\n        }\r\n\r\n        started = false;\r\n        bezierLine = undefined;\r\n\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: []\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n\r\n        isBaseLayer = 0 === context.canvas.index;\r\n\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n\r\n        if (started || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * size * spacing);\r\n        lastDot = 0;\r\n        for (loopDist = lastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, size, opacity);\r\n        }\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"EraserBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [opacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [sizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [size]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [opacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setTransparentBG\",\r\n            params: [isTransparentBG]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    //IS\r\n    this.isDrawing = function () {\r\n        return started;\r\n    };\r\n    //SET\r\n    /*this.setAlpha = function(a) {\r\n        lastInput = {};\r\n        alpha = a;\r\n        updateAlphaCanvas();\r\n    };*/\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSize = function (s) {\r\n        size = s;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        opacity = o;\r\n    };\r\n    this.sizePressure = function (b) {\r\n        sizePressure = b;\r\n    };\r\n    this.opacityPressure = function (b) {\r\n        opacityPressure = b;\r\n    };\r\n    this.setTransparentBG = function (b) {\r\n        isTransparentBG = b == true;\r\n    };\r\n    //GET\r\n    this.getSize = function () {\r\n        return size;\r\n    };\r\n    this.getOpacity = function () {\r\n        return opacity;\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb.types';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB} from '../kl.types';\r\n\r\n// let statCount = 1;\r\n// let statAcc = 0;\r\n// stats on win10, chrome, size 100, opacity 80, smudge()\r\n// unoptimized: 1 ms\r\n// minimal: 0.09 ms\r\n// minimal + circle: 0.5ms\r\n// minimal + circle + ix, iy: 0.23ms\r\n// unoptimized + ix, iy: 0.64 ms\r\n// unoptimized + ix, iy + sans rounding: 0.61 ms\r\n// ix, iy + sans rounding + sans random: 0.32ms\r\n// ix, iy + sans rounding + fast random: 0.46 ms\r\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\r\n\r\nconst CELL_SIZE = 256;\r\n\r\ninterface ISmudgeParams {\r\n    aP: IVector2D;\r\n    bP: IVector2D;\r\n    size: {\r\n        w: number;\r\n        h: number;\r\n    };\r\n    brush: {\r\n        center: IVector2D,\r\n        size: number;\r\n        opacity: number;\r\n        alphaLock: boolean;\r\n    };\r\n}\r\n\r\n\r\n/**\r\n * determine bounds of smudge\r\n * @param imWidth\r\n * @param imHeight\r\n * @param aP\r\n * @param bP\r\n * @param size\r\n */\r\nfunction prepSmudge(\r\n    imWidth: number,\r\n    imHeight: number,\r\n    aP: IVector2D, // top left of source, integers\r\n    bP: IVector2D, // top left of dest, integers\r\n    size: {w: number; h: number}, // size of both rectangles, integers\r\n): {\r\n    aP: IVector2D,\r\n    bP: IVector2D,\r\n    size: {w: number; h: number},\r\n} {\r\n\r\n    if (aP.x === bP.x && aP.y === bP.y) {\r\n        return null;\r\n    }\r\n\r\n    aP = BB.copyObj(aP);\r\n    bP = BB.copyObj(bP);\r\n    size = BB.copyObj(size);\r\n\r\n    // corner behavior\r\n    // cut down rectangles, if a or b go outside\r\n    // i.e. if user drags partially or fully outside the canvas\r\n    {\r\n        let top = 0;\r\n        let right = 0;\r\n        let bottom = 0;\r\n        let left = 0;\r\n\r\n        if (aP.x < 0) {\r\n            left = -aP.x;\r\n        }\r\n        if (aP.y < 0) {\r\n            top = -aP.y;\r\n        }\r\n        if (bP.x < 0) {\r\n            left = Math.max(left, -bP.x);\r\n        }\r\n        if (bP.y < 0) {\r\n            top = Math.max(top, -bP.y);\r\n        }\r\n        if (aP.x + size.w > imWidth) {\r\n            right = aP.x + size.w - imWidth;\r\n        }\r\n        if (aP.y + size.h > imHeight) {\r\n            bottom = aP.y + size.h - imHeight;\r\n        }\r\n        if (bP.x + size.w > imWidth) {\r\n            right = Math.max(right, bP.x + size.w - imWidth);\r\n        }\r\n        if (bP.y + size.h > imHeight) {\r\n            bottom = Math.max(bottom, bP.y + size.h - imHeight);\r\n        }\r\n\r\n        aP.x += left;\r\n        bP.x += left;\r\n        aP.y += top;\r\n        bP.y += top;\r\n\r\n        size.w = size.w - left - right;\r\n        size.h = size.h - top - bottom;\r\n        if (size.w <= 0 || size.h <= 0) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    return {\r\n        aP: {\r\n            x: aP.x,\r\n            y: aP.y,\r\n        },\r\n        bP: {\r\n            x: bP.x,\r\n            y: bP.y,\r\n        },\r\n        size: {\r\n            w: size.w,\r\n            h: size.h,\r\n        }\r\n    };\r\n}\r\n\r\n// faster than using BB.clamp somehow (in chrome)\r\nfunction clamp(num, min, max) {\r\n    return num <= min\r\n        ? min\r\n        : num >= max\r\n            ? max\r\n            : num\r\n}\r\n\r\n/**\r\n * Pixel operations that do the smudging via ImageData\r\n * @param imageData\r\n * @param p\r\n */\r\nfunction smudge(imageData: ImageData, p : ISmudgeParams): void {\r\n\r\n    p = BB.copyObj(p);\r\n\r\n    const cSize = p.brush.size;\r\n    const cX = p.brush.center.x;\r\n    const cY = p.brush.center.y;\r\n\r\n    /*if (statCount % 1000 === 0) {\r\n        console.log(statAcc / 1000);\r\n        statAcc = 0;\r\n    }\r\n    let start = performance.now();*/\r\n\r\n\r\n    // determine offset\r\n    let aIndex = p.aP.y * imageData.width + p.aP.x;\r\n    let bIndex = p.bP.y * imageData.width + p.bP.x;\r\n    const offset = (bIndex - aIndex) * 4;\r\n\r\n    // array with random numbers. faster than Math.random()\r\n    let randI = 0;\r\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n    const randArr = [];\r\n    for (let i = 0; i < randLen; i++) {\r\n        randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n    }\r\n\r\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\r\n\r\n    const pixel = (ai, bi, ix, iy) => {\r\n\r\n        const dist = BB.dist(cX, cY, ix, iy);\r\n        const fac = 1 - p.brush.opacity * (1 - clamp((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\r\n\r\n        if (fac === 1) {\r\n            return;\r\n        }\r\n\r\n        if (!imageData.data[ai + 3]) {\r\n\r\n        } else if (!imageData.data[bi + 3]) { // don't mix if target fully transparent. pixel might have a strange color.\r\n            imageData.data[bi] = imageData.data[ai + 0];\r\n            imageData.data[bi + 1] = imageData.data[ai + 1];\r\n            imageData.data[bi + 2] = imageData.data[ai + 2];\r\n        } else {\r\n\r\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\r\n            // not totally accurate. TODO same compositing as blend brush\r\n            let fac2;\r\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) {\r\n                fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\r\n            } else {\r\n                fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\r\n            }\r\n\r\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\r\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\r\n            // No +0.5, because it cancels out with rand.\r\n            imageData.data[bi] = Math.floor(BB.mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\r\n            imageData.data[bi + 1] = Math.floor(BB.mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\r\n            imageData.data[bi + 2] = Math.floor(BB.mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\r\n\r\n            randI = (randI + 1) % randLen;\r\n        }\r\n        // Always mix alpha. unless alpha lock\r\n        if (!p.brush.alphaLock) {\r\n            imageData.data[bi + 3] = Math.floor(BB.mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\r\n        }\r\n\r\n    };\r\n\r\n    const bx1 = p.bP.x * 4;\r\n    const bx2 = bx1 + (p.size.w - 1) * 4;\r\n\r\n    // transfer of pixels depends on direction of smudging if there is overlap\r\n    if (p.aP.y < p.bP.y) {\r\n        for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else if (p.aP.y > p.bP.y) {\r\n        for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else {\r\n        if (p.aP.x < p.bP.x) {\r\n            for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        } else {\r\n            for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x; x < bx2 + yStart; x += 4, x2 += 4, ix++) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //statCount++;\r\n    //statAcc += performance.now() - start;\r\n}\r\n\r\nexport class SmudgeBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IHistoryEntry;\r\n\r\n    private settingColor: IRGB = {r: 0, g: 0, b: 0};\r\n    private settingSize: number = 35;\r\n    private settingSpacing: number = 0.20446882736951905;\r\n    private settingOpacity: number = 0.8;\r\n    private settingColorStr: string;\r\n    private settingHasSizePressure: boolean = false;\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingLockLayerAlpha: boolean = false;\r\n\r\n    private lineToolLastDot: number;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastDot: IVector2D;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private bezierLine: any = null; // todo type BezierLine\r\n\r\n    private redrawBounds: IBounds;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    private copyImageData: ImageData;\r\n\r\n    private drawBuffer: ISmudgeParams[] = [];\r\n\r\n    private copiedCells: boolean[];\r\n\r\n    updateRedrawBounds(bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    updateCompleteRedrawBounds (x1, y1, x2, y2): void {\r\n        this.completeRedrawBounds = BB.updateBounds(\r\n            this.completeRedrawBounds,\r\n            { x1, y1, x2, y2 }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    copyFromCanvas(): void {\r\n\r\n        const touchedCells = this.copiedCells.map(item => false);\r\n\r\n        const bounds: IBounds[] = [];\r\n        const cellsW = Math.ceil(this.copyImageData.width / CELL_SIZE);\r\n\r\n        if (!this.redrawBounds) {\r\n            return;\r\n        }\r\n        bounds.push({\r\n            x1: Math.floor(this.redrawBounds.x1 / CELL_SIZE),\r\n            y1: Math.floor(this.redrawBounds.y1 / CELL_SIZE),\r\n            x2: Math.floor(this.redrawBounds.x2 / CELL_SIZE),\r\n            y2: Math.floor(this.redrawBounds.y2 / CELL_SIZE),\r\n        });\r\n        bounds.forEach(item => {\r\n            for (let i = item.x1; i <= item.x2; i++) {\r\n                for (let e = item.y1; e <= item.y2; e++) {\r\n                    touchedCells[e * cellsW + i] = true;\r\n                }\r\n            }\r\n        });\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.copiedCells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            this.copiedCells[i] = true;\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * CELL_SIZE + CELL_SIZE, this.copyImageData.width) - 1) % CELL_SIZE + 1;\r\n            const h = (Math.min(y * CELL_SIZE + CELL_SIZE, this.copyImageData.height) - 1) % CELL_SIZE + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = tmpCanvas.getContext('2d');\r\n            tmpCtx.drawImage(this.context.canvas, -x * CELL_SIZE, -y * CELL_SIZE);\r\n\r\n            const data = tmpCtx.getImageData(0, 0, w, h);\r\n\r\n            for (let i = 0; i < h; i++) {\r\n                for (let e = 0, e2 = i * w * 4, e3 = ((y * CELL_SIZE + i) * this.copyImageData.width + x * CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4) {\r\n                    this.copyImageData.data[e3] = data.data[e2];\r\n                    this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\r\n                    this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\r\n                    this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * fill drawBuffer with params about to be drawn\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     */\r\n    prepDot (x: number, y: number, size: number, opacity: number): void {\r\n        if (!this.lastDot) {\r\n            this.lastDot = {\r\n                x: x,\r\n                y: y,\r\n            };\r\n            return;\r\n        }\r\n\r\n        size = Math.round(size);\r\n\r\n\r\n        const w = Math.round(size * 2);\r\n        const h = Math.round(size * 2);\r\n\r\n        const bounds = prepSmudge(\r\n            this.copyImageData.width,\r\n            this.copyImageData.height,\r\n            {\r\n                x: Math.round(this.lastDot.x - size),\r\n                y: Math.round(this.lastDot.y - size),\r\n            },\r\n            {\r\n                x: Math.round(x - size),\r\n                y: Math.round(y - size),\r\n            },\r\n            {\r\n                w,\r\n                h,\r\n            },\r\n        );\r\n\r\n        if (bounds) {\r\n            const params: ISmudgeParams = {\r\n                aP: bounds.aP,\r\n                bP: bounds.bP,\r\n                size: bounds.size,\r\n                brush: {\r\n                    center: { x, y },\r\n                    size,\r\n                    opacity,\r\n                    alphaLock: this.settingLockLayerAlpha,\r\n                }\r\n            };\r\n            this.updateRedrawBounds({\r\n                x1: params.bP.x,\r\n                y1: params.bP.y,\r\n                x2: params.bP.x + params.brush.size * 2,\r\n                y2: params.bP.y + params.brush.size * 2,\r\n            });\r\n            this.drawBuffer.push(params);\r\n        }\r\n\r\n        this.lastDot = {\r\n            x: x,\r\n            y: y,\r\n        };\r\n    }\r\n\r\n    continueLine (x: number, y: number, size: number, pressure: number): void {\r\n        this.drawBuffer = [];\r\n\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function(){});\r\n        }\r\n\r\n        const drawArr = []; //draw instructions. will be all drawn at once\r\n\r\n        const dotCallback = (val): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        };\r\n\r\n        const localSpacing = size * this.settingSpacing / 3;\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            const item = drawArr[i];\r\n            this.prepDot(item[0], item[1], item[2], item[3]);\r\n            before = item;\r\n        }\r\n\r\n        this.copyFromCanvas();\r\n\r\n        for (let i = 0; i < this.drawBuffer.length; i++) {\r\n            smudge(this.copyImageData, this.drawBuffer[i]);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor () { }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: [\"brush\", \"SmudgeBrush\"],\r\n            actions: []\r\n        };\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.lastDot = null;\r\n        this.isDrawing = true;\r\n\r\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\r\n        const totalCells = Math.ceil(this.context.canvas.width / CELL_SIZE) * Math.ceil(this.context.canvas.height / CELL_SIZE);\r\n        this.copiedCells = '0'.repeat(totalCells).split('').map(item => false);\r\n\r\n        this.prepDot(x, y, localSize, localOpacity);\r\n\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2.pressure = p;\r\n\r\n        this.completeRedrawBounds = null;\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        this.redrawBounds = null;\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput2.pressure = this.lastInput.pressure;\r\n        this.lastInput.pressure = pressure;\r\n    }\r\n\r\n    endLine (): void {\r\n        this.redrawBounds = null;\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.context.save();\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n        this.context.restore();\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        if (this.historyEntry && this.completeRedrawBounds) {\r\n            let historyIm: ImageData | HTMLCanvasElement = this.copyImageData;\r\n            if (!(\r\n                this.completeRedrawBounds.x1 === 0 &&\r\n                this.completeRedrawBounds.y1 === 0 &&\r\n                this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 &&\r\n                this.completeRedrawBounds.y2 >= this.context.canvas.height - 1\r\n            )) {\r\n\r\n                // temp canvas to prevent main canvas from getting slowed down in chrome\r\n                const tmpCanvas = BB.canvas(\r\n                    this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                    this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n                );\r\n                const tmpCtx = tmpCanvas.getContext('2d');\r\n                tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n                historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\r\n            }\r\n            this.historyEntry.actions.push({\r\n                action: \"drawImage\",\r\n                params: [\r\n                    historyIm,\r\n                    this.completeRedrawBounds.x1,\r\n                    this.completeRedrawBounds.y1,\r\n                ],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n        this.copyImageData = null;\r\n    }\r\n\r\n    drawImage (im: ImageData | HTMLCanvasElement, x: number, y: number): void {\r\n        if (im instanceof ImageData) {\r\n            this.context.putImageData(im, x, y);\r\n        } else {\r\n            this.context.clearRect(x, y, im.width, im.height);\r\n            this.context.drawImage(im, x, y);\r\n        }\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        return;\r\n        /*\r\n        // todo\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = settingSize * settingSpacing;\r\n        lineToolLastDot = settingSize * settingSpacing;\r\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\r\n        }\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"SmudgeBrush\"],\r\n            actions: []\r\n        };\r\n        // todo\r\n        history.add(historyEntry);*/\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) {\r\n            return;\r\n        }\r\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\r\n        this.settingColorStr = BB.ColorConverter.toRgbStr(this.settingColor);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = !!b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = !!b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl.types';\r\nimport {IBounds} from '../../bb/bb.types';\r\nimport {KlHistoryInterface} from '../history/kl-history';\r\n\r\ntype TChemyMode = 'fill' | 'stroke';\r\n\r\nexport class ChemyBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private settingColor: IRGB;\r\n    private settingSize: number = 0.25; // radius - 0.5 - 99999\r\n    private settingOpacity: number = 1; // 0-1\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingIsEraser: boolean = false;\r\n    private settingMode: TChemyMode = 'fill';\r\n    private settingDistort: number = 0; // 0 - 1\r\n    private settingXSymmetry: boolean = false;\r\n    private settingYSymmetry: boolean = false;\r\n    private settingGradient: boolean = false;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private history: KlHistoryInterface;\r\n\r\n    private copyCanvas: HTMLCanvasElement;\r\n    private path: {x: number, y: number}[];\r\n    private minY: number;\r\n    private maxY: number;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    updateCompleteRedrawBounds (x, y): void {\r\n        let bounds = { x1: x, y1: y, x2: x, y2: y};\r\n        if (this.settingXSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: -x + this.copyCanvas.width,\r\n                    y1: y,\r\n                    x2: -x + this.copyCanvas.width,\r\n                    y2: y,\r\n                }\r\n                );\r\n        }\r\n        if (this.settingYSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: x,\r\n                    y1: -y + this.copyCanvas.height,\r\n                    x2: x,\r\n                    y2: -y + this.copyCanvas.height,\r\n                }\r\n            );\r\n        }\r\n        const buffer = this.settingMode === 'stroke' ? this.settingSize + 1 : 1;\r\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\r\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\r\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\r\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\r\n\r\n        this.completeRedrawBounds = BB.updateBounds(this.completeRedrawBounds, bounds);\r\n    }\r\n\r\n    private drawShape (): void {\r\n        this.context.save();\r\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\r\n        this.context.drawImage(this.copyCanvas, 0, 0);\r\n\r\n        let color = {...this.settingColor};\r\n        if (this.settingIsEraser) {\r\n            color.r = 255;\r\n            color.g = 255;\r\n            color.b = 255;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = \"source-atop\";\r\n            } else {\r\n                this.context.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        } else {\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        }\r\n\r\n        if (this.path) {\r\n\r\n            // path\r\n            const path = new Path2D();\r\n            this.path.forEach((item, index) => {\r\n                if (index === 0) {\r\n                    path.moveTo(item.x, item.y);\r\n                } else {\r\n                    path.lineTo(item.x, item.y);\r\n                }\r\n            });\r\n\r\n            let style: string | CanvasGradient = BB.ColorConverter.toRgbaStr({\r\n                r: color.r,\r\n                g: color.g,\r\n                b: color.b,\r\n                a: this.settingOpacity,\r\n            });\r\n            if (this.settingGradient) {\r\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\r\n                const gradient = this.context.createLinearGradient(\r\n                    0, startAtTop ? this.minY : this.maxY,\r\n                    0, startAtTop ? this.maxY : this.minY,\r\n                );\r\n                gradient.addColorStop(\r\n                    0,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: this.settingOpacity,\r\n                    })\r\n                );\r\n                gradient.addColorStop(\r\n                    1,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: 0,\r\n                    })\r\n                );\r\n                style = gradient;\r\n            }\r\n\r\n            // setup params\r\n            if (this.settingMode === 'fill') {\r\n                this.context.fillStyle = style;\r\n\r\n            } else {\r\n                this.context.lineWidth = this.settingSize * 2;\r\n                this.context.lineJoin = 'bevel';\r\n                this.context.strokeStyle = style;\r\n            }\r\n\r\n            // draw\r\n            const draw = () => {\r\n                if (this.settingMode === 'fill') {\r\n                    this.context.fill(path);\r\n                } else {\r\n                    this.context.stroke(path);\r\n                }\r\n            };\r\n\r\n            draw();\r\n            if (this.settingXSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(this.context.canvas.width / 2, 0);\r\n                this.context.scale(-1, 1);\r\n                this.context.translate(-this.context.canvas.width / 2, 0);\r\n                draw();\r\n                this.context.restore();\r\n            }\r\n            if (this.settingYSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(0, this.context.canvas.height / 2);\r\n                this.context.scale(1, -1);\r\n                this.context.translate(0, -this.context.canvas.height / 2);\r\n                draw();\r\n                this.context.restore();\r\n                if (this.settingXSymmetry) {\r\n                    this.context.save();\r\n                    this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\r\n                    this.context.scale(-1, -1);\r\n                    this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\r\n                    draw();\r\n                    this.context.restore();\r\n                }\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingMode === 'stroke' ? this.settingSize : 0;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.settingColor = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setMode (mode: TChemyMode): void {\r\n        this.settingMode = mode;\r\n    }\r\n\r\n    getMode (): TChemyMode {\r\n        return this.settingMode;\r\n    }\r\n\r\n    setDistort (distort: number): void {\r\n        this.settingDistort = BB.clamp(distort, 0, 1);\r\n    }\r\n\r\n    getDistort (): number {\r\n        return this.settingDistort;\r\n    }\r\n\r\n    setXSymmetry (b: boolean): void {\r\n        this.settingXSymmetry = !!b;\r\n    }\r\n\r\n    getXSymmetry (): boolean {\r\n        return this.settingXSymmetry;\r\n    }\r\n\r\n    setYSymmetry (b: boolean): void {\r\n        this.settingYSymmetry = !!b;\r\n    }\r\n\r\n    getYSymmetry (): boolean {\r\n        return this.settingYSymmetry;\r\n    }\r\n\r\n    setGradient (b: boolean): void {\r\n        this.settingGradient = !!b;\r\n    }\r\n\r\n    getGradient (): boolean {\r\n        return this.settingGradient;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.settingIsEraser;\r\n    }\r\n\r\n    setIsEraser (b: boolean): void {\r\n        this.settingIsEraser = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    startLine (x: number, y: number): void {\r\n        this.isDrawing = true;\r\n        this.path = [{x, y}];\r\n        this.minY = y;\r\n        this.maxY = y;\r\n        this.copyCanvas = BB.canvas(this.context.canvas.width, this.context.canvas.height);\r\n        this.copyCanvas.getContext('2d').drawImage(this.context.canvas, 0, 0);\r\n        this.completeRedrawBounds = null;\r\n        this.updateCompleteRedrawBounds(x, y);\r\n    }\r\n\r\n    goLine (x: number, y: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        let pos = { x, y };\r\n        if (this.settingDistort > 0) {\r\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\r\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\r\n        }\r\n\r\n        this.minY = Math.min(this.minY, pos.y);\r\n        this.maxY = Math.max(this.maxY, pos.y);\r\n        this.path.push(pos);\r\n        this.updateCompleteRedrawBounds(x, y);\r\n        this.drawShape();\r\n    }\r\n\r\n    endLine (): void {\r\n        this.isDrawing = false;\r\n        this.completeRedrawBounds = BB.boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\r\n        if (this.path.length > 1 && this.completeRedrawBounds) {\r\n            const historyCanvas = BB.canvas(\r\n                this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n            );\r\n            const historyCtx = historyCanvas.getContext('2d');\r\n            historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n            this.history.push({\r\n                tool: [\"brush\", \"ChemyBrush\"],\r\n                actions: [\r\n                    {\r\n                        action: \"drawImage\",\r\n                        params: [\r\n                            historyCanvas, // faster than getting image data (measured on 2018 lenovo chromebook)\r\n                            this.completeRedrawBounds.x1,\r\n                            this.completeRedrawBounds.y1,\r\n                        ],\r\n                    }\r\n                ]\r\n            });\r\n        }\r\n        this.path = null;\r\n        this.copyCanvas = null;\r\n    }\r\n\r\n    drawImage (im: HTMLCanvasElement, x: number, y: number): void {\r\n        this.context.save();\r\n        this.context.clearRect(x, y, im.width, im.height);\r\n        this.context.drawImage(im, x, y);\r\n        this.context.restore();\r\n    }\r\n\r\n    drawLineSegment (x1, y1, x2, y2): void {\r\n        // might make sense for stroke\r\n    }\r\n}\r\n","import {penBrushUi} from './pen-brush-ui';\r\nimport {blendBrushUi} from './blend-brush-ui';\r\nimport {sketchyBrushUi} from './sketchy-brush-ui';\r\nimport {pixelBrushUi} from './pixel-brush-ui';\r\nimport {eraserBrushUi} from './eraser-brush-ui';\r\nimport {smudgeBrushUi} from './smudge-brush-ui';\r\nimport {chemyBrushUi} from './chemy-brush-ui';\r\nimport {IBrushUi} from '../kl.types';\r\n\r\n/**\r\n * UI for brushes.\r\n * Each brush ui carries the brush with it.\r\n * So if you want to draw, you do it through the UI. should be changed sometime.\r\n */\r\n\r\nexport const brushesUI: {\r\n    [key: string]: IBrushUi;\r\n} = {\r\n    penBrush: penBrushUi,\r\n    blendBrush: blendBrushUi,\r\n    sketchyBrush: sketchyBrushUi,\r\n    pixelBrush: pixelBrushUi,\r\n    chemyBrush: chemyBrushUi,\r\n    smudgeBrush: smudgeBrushUi,\r\n    eraserBrush: eraserBrushUi,\r\n};\r\n","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pen.svg';\r\nimport {genBrushAlpha01, genBrushAlpha02} from '../brushes/alphas/brush-alphas';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {input} from '../ui/base-components/input';\r\n\r\nexport const penBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pen'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1/100,\r\n            max: 1,\r\n            curve: [[0, 1/100], [0.5, 30/100], [1, 1]]\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    let alphaNames = [\r\n        LANG('brush-pen-circle'),\r\n        LANG('brush-pen-chalk'),\r\n        LANG('brush-pen-calligraphy'),\r\n        LANG('brush-pen-square'),\r\n    ];\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pen');\r\n        alphaNames = [\r\n            LANG('brush-pen-circle'),\r\n            LANG('brush-pen-chalk'),\r\n            LANG('brush-pen-calligraphy'),\r\n            LANG('brush-pen-square'),\r\n        ];\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.PenBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        let alphas = [];\r\n        let currentAlpha = 0;\r\n        for (let i = 0; i < 4; i++) {\r\n            (function (i) {\r\n                let alpha = BB.el({\r\n                    title: alphaNames[i],\r\n                    onClick: () => {\r\n                        alphaClick(i);\r\n                    }\r\n                });\r\n                let canvas = BB.canvas(70, 70);\r\n                let ctx = canvas.getContext('2d');\r\n                if (i === 0 || i === 3) {\r\n                    if (i === 0) {\r\n                        ctx.beginPath();\r\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\r\n                        ctx.closePath();\r\n                        ctx.fill();\r\n                    } else {\r\n                        ctx.fillRect(5, 5, 60, 60);\r\n                    }\r\n                } else if (i === 1) {\r\n                    ctx.drawImage(genBrushAlpha01(60), 5, 5);\r\n                } else if (i === 2) {\r\n                    ctx.drawImage(genBrushAlpha02(60), 5, 5);\r\n                }\r\n                alpha.style.backgroundImage = 'url(' + canvas.toDataURL('image/png') + ')';\r\n\r\n                alphas.push(alpha);\r\n            }(i));\r\n        }\r\n\r\n        function updateAlphas() {\r\n            for (let i = 0; i < alphas.length; i++) {\r\n                if (i === currentAlpha) {\r\n                    alphas[i].className = 'brush-alpha-selected';\r\n                } else {\r\n                    alphas[i].className = 'brush-alpha';\r\n                }\r\n            }\r\n        }\r\n\r\n        updateAlphas();\r\n\r\n        function alphaClick(id) {\r\n            currentAlpha = id;\r\n            brush.setAlpha(id);\r\n            updateAlphas();\r\n        }\r\n\r\n        let lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('brush-lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('brush-lock-alpha-title'),\r\n            css: {\r\n                cssFloat: 'right',\r\n                textAlign: 'right',\r\n            }\r\n        });\r\n\r\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                })\r\n            );\r\n\r\n            let alphaWrapper = document.createElement(\"div\");\r\n            for (let i = 0; i < alphas.length; i++) {\r\n                alphaWrapper.appendChild(alphas[i]);\r\n            }\r\n            alphaWrapper.style.marginTop = \"10px\";\r\n            div.appendChild(alphaWrapper);\r\n            alphaWrapper.appendChild(lockAlphaToggle.getElement());\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","\r\nexport const eventResMs = 20;","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iiCd6\");","import {BB} from '../../bb/bb';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-blend.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const blendBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-blend'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-blend');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.BlendBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: 58,\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n            let blendingSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 225,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: brush.getBlending(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val);\r\n                },\r\n            });\r\n            blendingSlider.getElement().style.marginTop = \"10px\";\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.setSizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.setOpacityPressure(b);\r\n            });\r\n\r\n            let lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('brush-lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('brush-lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                    display: 'inline-block',\r\n                }\r\n            });\r\n\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                }),\r\n                blendingSlider.getElement(),\r\n                lockAlphaToggle.getElement()\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y, p, isCoalesced);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6fRlX\");","import {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-sketchy.png';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {BB} from '../../bb/bb';\r\n\r\nexport const sketchyBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-sketchy'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 10\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-sketchy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.SketchyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize() * 2,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: function (val) {\r\n                    brush.setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n            let blendSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: brush.getBlending(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val);\r\n                },\r\n            });\r\n            let scaleSlider = new KlSlider({\r\n                label: LANG('brush-sketchy-scale'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 1,\r\n                max: 20,\r\n                value: brush.getScale(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setScale(val);\r\n                },\r\n            });\r\n            opacitySlider.getElement().style.marginTop = \"10px\";\r\n            blendSlider.getElement().style.marginTop = \"10px\";\r\n            scaleSlider.getElement().style.marginTop = \"10px\";\r\n            div.appendChild(sizeSlider.getElement());\r\n            div.appendChild(opacitySlider.getElement());\r\n            div.appendChild(blendSlider.getElement());\r\n            div.appendChild(scaleSlider.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, pressure) {\r\n            brush.startLine(x, y, pressure);\r\n        };\r\n        this.goLine = function (x, y, pressure) {\r\n            brush.goLine(x, y, pressure, null);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getSeed = function () {\r\n            return parseInt(brush.getSeed());\r\n        };\r\n        this.setSeed = function (s) {\r\n            brush.setSeed(parseInt(s));\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hC7PC\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pixel.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const pixelBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pixel'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pixel');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.PixelBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        let lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('brush-lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('brush-lock-alpha-title'),\r\n            css: {\r\n                marginRight: '10px',\r\n            }\r\n        });\r\n\r\n        let eraserToggle = new Checkbox({\r\n            init: brush.getIsEraser(),\r\n            label: LANG('eraser'),\r\n            callback: function (b) {\r\n                brush.setIsEraser(b);\r\n            },\r\n            css: {\r\n                marginRight: '10px',\r\n            }\r\n        });\r\n\r\n        let ditherToggle = new Checkbox({\r\n            init: brush.getUseDither(),\r\n            label: LANG('brush-pixel-dither'),\r\n            callback: function (b) {\r\n                brush.setUseDither(b);\r\n            }\r\n        });\r\n\r\n        let spacingSpline = new BB.SplineInterpolator([[0.5, 0.45], [100, 4]]);\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                opacitySlider.getElement()\r\n            );\r\n\r\n            let toggleRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px'\r\n                }\r\n            });\r\n\r\n            toggleRow.appendChild(lockAlphaToggle.getElement());\r\n            toggleRow.appendChild(eraserToggle.getElement());\r\n            toggleRow.appendChild(ditherToggle.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size * 2);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity * 100);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eZgVv\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-eraser.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const eraserBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('eraser') + ' [E]',\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 200,\r\n            curve: BB.quadraticSplineInput(0.5, 200, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('eraser') + ' [E]';\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.EraserBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n        let isTransparentBg = false;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: 30,\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                })\r\n            );\r\n\r\n            let transparencyToggle = new Checkbox({\r\n                init: false,\r\n                label: LANG('brush-eraser-transparent-bg'),\r\n                callback: function (b) {\r\n                    isTransparentBg = b;\r\n                    brush.setTransparentBG(b);\r\n                },\r\n                css: {\r\n                    marginTop: \"10px\",\r\n                }\r\n            });\r\n            div.appendChild(transparencyToggle.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        function drawDot(x, y) {\r\n            brush.drawDot(x, y);\r\n        }\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            //brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.getIsTransparentBg = function () {\r\n            return isTransparentBg;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        }\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fPZin\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-smudge.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const smudgeBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-smudge'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-smudge');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.SmudgeBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        let lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('brush-lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('brush-lock-alpha-title'),\r\n        });\r\n\r\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(false, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                })\r\n            );\r\n\r\n            let bottomRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            bottomRow.append(lockAlphaToggle.getElement());\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fp7H1\");","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-chemy.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {BoxToggle} from '../ui/base-components/box-toggle';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const chemyBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-chemy'),\r\n        sizeSlider: {\r\n            min: 0.25,\r\n            max: 25,\r\n            curve: BB.quadraticSplineInput(0.25, 25, 0.1),\r\n            isDisabled: true,\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-chemy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement(\"div\"); // the gui\r\n        const brush = new brushes.ChemyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider: KlSlider;\r\n        let opacitySlider: KlSlider;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                isEnabled: brush.getMode() === 'stroke',\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 5) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            BB.css(opacitySlider.getElement(), {\r\n                marginTop: '10px',\r\n            });\r\n\r\n            let eraserToggle = new Checkbox({\r\n                init: brush.getIsEraser(),\r\n                label: LANG('eraser'),\r\n                callback: function (b) {\r\n                    brush.setIsEraser(b);\r\n                },\r\n                css: {\r\n                    marginTop: '10px',\r\n                    marginLeft: '10px',\r\n                }\r\n            });\r\n\r\n            const lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('brush-lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('brush-lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n\r\n            const toggleRow = BB.el({\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n\r\n            const iconSize = 35;\r\n            const padding = 8;\r\n            const actualIconSize = iconSize - padding * 2;\r\n            const halfSize = actualIconSize / 2;\r\n\r\n            const modeOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'fill',\r\n                        label: BB.createSvg({\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: '#000',\r\n                                    style: `transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-fill'),\r\n                    },\r\n                    {\r\n                        id: 'stroke',\r\n                        label: BB.createSvg({\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: 'none',\r\n                                    stroke: '#000',\r\n                                    style: `stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-stroke'),\r\n                    }\r\n                ],\r\n                initId: brush.getMode(),\r\n                onChange: (id: string): void => {\r\n                    brush.setMode(id as 'stroke' | 'fill');\r\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === 'fill';\r\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\r\n\r\n                    const brushSize = brush.getSize();\r\n                    sizeSlider.setValue(brushSize);\r\n                    p.onSizeChange(brushSize);\r\n                    p.onConfigChange();\r\n                }\r\n            });\r\n\r\n            const mirrorXToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`,\r\n                        },\r\n                    ]\r\n                }),\r\n                title: LANG('brush-chemy-mirror-x'),\r\n                init: brush.getXSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setXSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const mirrorYToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`,\r\n                        },\r\n                    ]\r\n                }),\r\n                title: LANG('brush-chemy-mirror-y'),\r\n                init: brush.getYSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setYSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const gradientToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'defs',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'linearGradient',\r\n                                    id: 'gradient',\r\n                                    x1: '0',\r\n                                    y1: '0',\r\n                                    x2: '0',\r\n                                    y2: '1',\r\n                                    childrenArr: [\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '0%',\r\n                                            'stop-color': 'rgba(0,0,0,0)',\r\n                                        },\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '100%',\r\n                                            'stop-color': 'rgba(0,0,0,1)',\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            elementType: 'rect',\r\n                            fill: \"url('#gradient')\",\r\n                            x: '' + padding,\r\n                            y: '' + padding,\r\n                            width: '' + actualIconSize,\r\n                            height: '' + actualIconSize,\r\n                        },\r\n                    ]\r\n                }),\r\n                title: LANG('brush-chemy-gradient'),\r\n                init: brush.getGradient(),\r\n                onChange: (b) => {\r\n                    brush.setGradient(b);\r\n                },\r\n            });\r\n\r\n            BB.css(mirrorXToggle.getElement(), {\r\n                marginLeft: '10px',\r\n            });\r\n            {\r\n                const margin = {\r\n                    marginLeft: '4px',\r\n                };\r\n                BB.css(mirrorYToggle.getElement(), margin);\r\n                BB.css(gradientToggle.getElement(), margin);\r\n            }\r\n\r\n            toggleRow.append(\r\n                modeOptions.getElement(),\r\n                mirrorXToggle.getElement(),\r\n                mirrorYToggle.getElement(),\r\n                gradientToggle.getElement(),\r\n            );\r\n\r\n            div.append(\r\n                sizeSlider.getElement(),\r\n                opacitySlider.getElement(),\r\n                toggleRow,\r\n                BB.el({\r\n                    content: [\r\n                        lockAlphaToggle.getElement(),\r\n                        eraserToggle.getElement(),\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                    }\r\n                })\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eX098\");","import {BB} from '../../../bb/bb';\r\n\r\nexport class BoxToggle {\r\n    el: HTMLElement;\r\n    value: boolean;\r\n\r\n    update (): void {\r\n        this.el.classList.toggle('kl-box-toggle--active', this.value);\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            label: string | HTMLElement | SVGElement;\r\n            title?: string;\r\n            init?: boolean;\r\n            onChange: (b: boolean) => void;\r\n        }\r\n    ) {\r\n        this.value = !!p.init;\r\n        this.el = BB.el({\r\n            content: p.label,\r\n            title: p.title,\r\n            className: (typeof p.label === 'string') ? 'kl-box-toggle' : 'kl-box-toggle kl-box-toggle--custom-el',\r\n            onClick: () => {\r\n                this.value = !this.value;\r\n                this.update();\r\n                p.onChange(this.value);\r\n            },\r\n            css: {\r\n                cursor: 'pointer',\r\n            }\r\n        });\r\n        if (typeof p.label !== 'string') {\r\n            BB.css(p.label, {\r\n                display: 'block',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n        this.update();\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.value;\r\n    }\r\n\r\n    setValue (b: boolean): void {\r\n        this.value = !!b;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.el);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {Popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showIframePopup(url, isEmbed) {\r\n    if (!isEmbed && (window.innerHeight < 500 || window.innerWidth < 700)) {\r\n        window.open(url);\r\n        return;\r\n    }\r\n\r\n    let iframe = BB.el({\r\n        tagName: 'iframe',\r\n        custom: {\r\n            src: url,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            height: '100%'\r\n        }\r\n    }) as HTMLIFrameElement;\r\n    let titleEl = BB.el({});\r\n\r\n    let linkEl;\r\n    if (!isEmbed) {\r\n        linkEl = BB.el({\r\n            tagName: 'a',\r\n            parent: titleEl,\r\n            content: LANG('modal-new-tab'),\r\n            custom: {\r\n                href: 'help',\r\n                target: '_blank',\r\n            },\r\n            onClick: function() {\r\n                popup.close();\r\n            }\r\n        }) as HTMLAnchorElement;\r\n        iframe.onload = function() {\r\n            BB.setAttributes(linkEl, {\r\n                href: '' + iframe.contentWindow.location,\r\n            });\r\n        };\r\n    }\r\n\r\n\r\n    let popup = new Popup({\r\n        title: titleEl,\r\n        content: iframe,\r\n        width: 880,\r\n        isMaxHeight: true,\r\n        onClose: () => {\r\n            if (linkEl) {\r\n                BB.destroyEl(linkEl);\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nexport class RadioList {\r\n\r\n    el: HTMLDivElement;\r\n    inputs: HTMLInputElement[] = [];\r\n\r\n    constructor({name, init, items, ignoreFocus}: {\r\n        name: string;\r\n        init?: string;\r\n        items: {\r\n            label: string;\r\n            value: string;\r\n        }[],\r\n        ignoreFocus?: boolean; // default false\r\n    }) {\r\n        this.el = BB.el({\r\n            className: 'kl-radio'\r\n        }) as HTMLDivElement;\r\n\r\n        items.forEach(item => {\r\n            let label = BB.el({\r\n                tagName: 'label'\r\n            });\r\n            let input = BB.el({\r\n                tagName: 'input',\r\n                parent: label,\r\n                custom: {\r\n                    name: name,\r\n                    value: item.value,\r\n                    type: 'radio',\r\n                }\r\n            }) as HTMLInputElement;\r\n            if (ignoreFocus) {\r\n                input.setAttribute('data-ignore-focus', 'true');\r\n            }\r\n            if (init === item.value) {\r\n                input.checked = true;\r\n            }\r\n            label.append(item.label);\r\n            this.el.append(label);\r\n            this.inputs.push(input);\r\n        });\r\n    }\r\n\r\n\r\n    getValue(): string {\r\n        for (let i = 0; i < this.inputs.length; i++) {\r\n            if (this.inputs[i].checked) {\r\n                return this.inputs[i].value;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getElement() {\r\n        return this.el;\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n// @ts-ignore\r\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\r\nimport {IKlProject} from '../../kl.types';\r\nimport {showIframePopup} from '../modals/show-iframe-popup';\r\nimport {SaveReminder} from './save-reminder';\r\nimport {IProjectStoreListener, ProjectStore} from '../../storage/project-store';\r\nimport {KL} from '../../kl';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport class BrowserStorageUi {\r\n\r\n    private previewEl: HTMLDivElement;\r\n    private infoEl: HTMLDivElement;\r\n    private ageEl: HTMLDivElement;\r\n    private storeButtonEl: HTMLButtonElement;\r\n    private clearButtonEl: HTMLButtonElement;\r\n    private storeListener: IProjectStoreListener;\r\n\r\n    private timestamp: number;\r\n\r\n    private updateAge() {\r\n        if (!this.timestamp) {\r\n            return;\r\n        }\r\n        let age = new Date().getTime() - this.timestamp;\r\n        let ageStr;\r\n        age = Math.floor(age / 1000 / 60);\r\n        ageStr = LANG('file-storage-min-ago').replace('{x}', '' + age);\r\n        if (age > 60) {\r\n            age = Math.floor(age / 60);\r\n            ageStr = LANG('file-storage-hours-ago').replace('{x}', '' + age);\r\n            if (age > 24) {\r\n                age = Math.floor(age / 24);\r\n                ageStr = LANG('file-storage-days-ago').replace('{x}', '' + age);\r\n                if (age > 31) {\r\n                    ageStr = LANG('file-storage-month-ago');\r\n                }\r\n            }\r\n        }\r\n        this.ageEl.textContent = ageStr;\r\n    }\r\n\r\n    private resetButtons() {\r\n        if (this.timestamp) {\r\n            this.storeButtonEl.textContent = LANG('file-storage-overwrite');\r\n            this.storeButtonEl.disabled = false;\r\n            this.clearButtonEl.disabled = false;\r\n        } else {\r\n            this.storeButtonEl.textContent = LANG('file-storage-store');\r\n            this.storeButtonEl.disabled = false;\r\n            this.clearButtonEl.disabled = true;\r\n        }\r\n    }\r\n\r\n    private updateThumb(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.timestamp = timestamp;\r\n        if (this.timestamp) {\r\n            BB.css(thumbnail, {\r\n                display: 'block',\r\n                maxWidth: 'calc(100% - 2px)',\r\n                maxHeight: 'calc(100% - 2px)',\r\n                margin: '0 auto',\r\n                background: \"url('\" + BB.createCheckerCanvas(4).toDataURL('image/png') + \"')\",\r\n                boxShadow: '0 0 0 1px #aaa',\r\n                pointerEvents: 'none',\r\n            });\r\n            this.previewEl.innerHTML = '';\r\n            this.updateAge();\r\n            this.previewEl.append(thumbnail, this.ageEl);\r\n        } else {\r\n            this.previewEl.innerHTML = LANG('file-storage-empty');\r\n        }\r\n        this.resetButtons();\r\n    }\r\n\r\n    private async store() {\r\n        this.storeButtonEl.textContent = LANG('file-storage-storing');\r\n        this.storeButtonEl.disabled = true;\r\n        this.clearButtonEl.disabled = true;\r\n        await new Promise((resolve) => {\r\n            setTimeout(() => resolve(null), 20);\r\n        });\r\n        try {\r\n            await this.projectStore.store(this.getProject());\r\n            this.saveReminder.reset();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: [\r\n                    `${LANG('file-storage-failed-1')}<ul>`,\r\n                    `<li>${LANG('file-storage-failed-2')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-3')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-4')}</li>`,\r\n                    `</ul>`,\r\n                ].join(''),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to store browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    private async clear() {\r\n        this.storeButtonEl.disabled = true;\r\n        this.clearButtonEl.disabled = true;\r\n        try {\r\n            await this.projectStore.clear();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: LANG('file-storage-failed-clear'),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to clear browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    element: HTMLDivElement;\r\n\r\n    constructor (\r\n        private projectStore: ProjectStore,\r\n        private getProject: () => IKlProject,\r\n        private saveReminder: SaveReminder,\r\n        private klRootEl: HTMLDivElement,\r\n        private options?: { hideClearButton?: boolean; isFocusable?: boolean }, // isFocusable default = false\r\n    ) {\r\n        this.element = BB.el({\r\n            css: {\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 0fr',\r\n                gridTemplateRows: '0fr 0fr 0fr',\r\n                gap: '0 0',\r\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"',\r\n            }\r\n        }) as HTMLDivElement;\r\n\r\n\r\n        const title = BB.el({\r\n            parent: this.element,\r\n            content: LANG('file-storage'),\r\n            css: {\r\n                gridArea: 'title',\r\n                display: 'flex',\r\n                margin: '-5px 0',\r\n                //background: '#f00',\r\n            }\r\n        });\r\n\r\n        this.infoEl = BB.el({\r\n            parent: title,\r\n            content: '?',\r\n            title: LANG('file-storage-about'),\r\n            css: {\r\n                cursor: 'pointer',\r\n                marginLeft: '5px',\r\n                width: '19px',\r\n                height: '19px',\r\n                borderRadius: '100%',\r\n                textAlign: 'center',\r\n                lineHeight: '19px',\r\n                fontWeight: 'bold',\r\n                boxShadow: 'inset 0 0 0 1px #000',\r\n            },\r\n            onClick: () => {\r\n                showIframePopup('./help/#help-browser-storage', false);\r\n            }\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.projectStore.isBroken()) {\r\n            BB.el({\r\n                parent: this.element,\r\n                content: \" \" + LANG('file-storage-cant-access'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            return;\r\n        }\r\n\r\n        this.previewEl = BB.el({\r\n            parent: this.element,\r\n            title: LANG('file-storage-thumb-title'),\r\n            css: {\r\n                gridArea: 'preview',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                marginTop: '10px',\r\n                position: 'relative',\r\n                boxShadow: 'inset 0 0 0 1px #aaa',\r\n                background: '#cdcdcd',\r\n                color: '#545454',\r\n                colorScheme: 'only light',\r\n                minHeight: '67px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        this.ageEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                right: '0',\r\n                bottom: '0',\r\n                width: '100%',\r\n                textAlign: 'center',\r\n                background: 'rgba(0,0,0,0.7)',\r\n                color: '#fff',\r\n                textSize: '13px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        const btnCustom = options?.isFocusable ?  {} : {\r\n            tabIndex: -1,\r\n        };\r\n        this.storeButtonEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'gridButton',\r\n            content: LANG('file-storage-store'),\r\n            css: {\r\n                gridArea: 'store',\r\n                //background: '#00f',\r\n            },\r\n            custom: btnCustom,\r\n            onClick: () => this.store(),\r\n        }) as HTMLButtonElement;\r\n        this.clearButtonEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'gridButton',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/> ' + LANG('file-storage-clear'),\r\n            css: {\r\n                gridArea: 'clear',\r\n                //background: '#ff0',\r\n            },\r\n            custom: btnCustom,\r\n            onClick: () => this.clear(),\r\n        }) as HTMLButtonElement;\r\n\r\n        if (this.options?.hideClearButton) {\r\n            this.clearButtonEl.style.visibility = 'hidden';\r\n        }\r\n\r\n        this.storeListener = {\r\n            onUpdate: (timestamp, thumbnail) => {\r\n                this.updateThumb(timestamp, thumbnail);\r\n            },\r\n        };\r\n        this.projectStore.subscribe(this.storeListener);\r\n\r\n        setInterval(() => this.updateAge(), 1000 * 60);\r\n\r\n        (async () => {\r\n            try {\r\n                const readResult = await this.projectStore.read();\r\n                if (readResult) {\r\n                    this.updateThumb(readResult.timestamp, readResult.thumbnail);\r\n                } else {\r\n                    this.updateThumb();\r\n                }\r\n            } catch (e) {\r\n                setTimeout(() => {\r\n                    throw new Error('storage-ui: failed initial read browser storage, ' + e);\r\n                }, 0);\r\n            }\r\n        })();\r\n    }\r\n\r\n\r\n    getElement() {\r\n        return this.element;\r\n    }\r\n\r\n    show () {\r\n        // todo\r\n    }\r\n\r\n    hide () {\r\n        // todo\r\n    }\r\n\r\n    destroy() {\r\n        BB.destroyEl(this.infoEl);\r\n        BB.destroyEl(this.storeButtonEl);\r\n        BB.destroyEl(this.clearButtonEl);\r\n        this.projectStore.unsubscribe(this.storeListener);\r\n    }\r\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\r\nimport {ProjectConverter} from './project-converter';\r\nimport {clear, getKlProjectObj, storeKlProjectObj} from './indexed-db';\r\nimport {LocalStorage} from '../../bb/base/local-storage';\r\n\r\n\r\nexport interface IProjectStoreListener {\r\n    onUpdate: (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) => void,\r\n}\r\n\r\nfunction makeAsync(func): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n        func(resolve, reject);\r\n    });\r\n}\r\n\r\n/**\r\n * simplified interface for storing projects into browser storage\r\n */\r\nexport class ProjectStore {\r\n\r\n    private listeners: IProjectStoreListener[] = [];\r\n    private accessHasFailed: boolean = false;\r\n\r\n    async lowLevelStore (project: IKlStorageProject): Promise<any> {\r\n        await new Promise((resolve, reject) => {\r\n            storeKlProjectObj(project, resolve, reject);\r\n        });\r\n    }\r\n\r\n    async lowLevelRead (): Promise<IKlStorageProject> {\r\n        return await makeAsync(getKlProjectObj) as IKlStorageProject;\r\n    }\r\n\r\n    async lowLevelClear (): Promise<any> {\r\n        await makeAsync(clear);\r\n    }\r\n\r\n\r\n\r\n    private emit(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.listeners.forEach(item => {\r\n            item.onUpdate(timestamp, thumbnail);\r\n        });\r\n    }\r\n\r\n    private updateTimestamp() {\r\n        LocalStorage.setItem('indexedDbUpdatedAt', '' + new Date().getTime());\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== 'indexedDbUpdatedAt' || this.listeners.length === 0) {\r\n                return;\r\n            }\r\n            try {\r\n                ( async () => {\r\n                    const readResult = await this.read();\r\n                    if (readResult) {\r\n                        this.emit(readResult.timestamp, readResult.thumbnail);\r\n                    } else {\r\n                        this.emit();\r\n                    }\r\n                })();\r\n            } catch (e) {\r\n                if (e.message.indexOf('db-error') === 0) {\r\n                    this.accessHasFailed = true;\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    async read(): Promise<{\r\n        project: IKlProject,\r\n        timestamp: number,\r\n        thumbnail: HTMLImageElement | HTMLCanvasElement\r\n    } | null> {\r\n        let storageProject;\r\n        try {\r\n            storageProject = await this.lowLevelRead();\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        if (!storageProject) {\r\n            return null;\r\n        }\r\n        let result;\r\n        try {\r\n            result = await ProjectConverter.readStorageProject(storageProject);\r\n        } catch (e) {\r\n            throw new Error('format-error: ' + e);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    async store(project: IKlProject): Promise<void> {\r\n        try {\r\n            const storageProject = ProjectConverter.createStorageProject(project);\r\n            await this.lowLevelStore(storageProject);\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        {\r\n            // immediately test if it can be read\r\n            const storageProject = await this.lowLevelRead();\r\n            let readResult = null;\r\n            try {\r\n                readResult = await ProjectConverter.readStorageProject(storageProject);\r\n            } catch (e) {\r\n                await this.lowLevelClear();\r\n                this.updateTimestamp();\r\n                setTimeout(() => this.emit(), 0);\r\n                throw new Error('format-error: ' + e);\r\n            }\r\n            this.updateTimestamp();\r\n            setTimeout(() => this.emit(readResult.timestamp, readResult.thumbnail), 0);\r\n        }\r\n    }\r\n\r\n    async clear(): Promise<void> {\r\n        await this.lowLevelClear();\r\n        this.updateTimestamp();\r\n        setTimeout(() => this.emit(), 0);\r\n    }\r\n\r\n    subscribe(listener: IProjectStoreListener) {\r\n        if (this.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        this.listeners.push(listener);\r\n    }\r\n\r\n    unsubscribe(listener: IProjectStoreListener) {\r\n        for (let i = 0; i < this.listeners.length; i++) {\r\n            if (listener === this.listeners[i]) {\r\n                this.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    isBroken() {\r\n        return this.accessHasFailed;\r\n    }\r\n\r\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\r\nimport {BB} from '../../bb/bb';\r\nimport {drawProject} from '../canvas/draw-project';\r\nimport {base64ToBlob} from './base-64-to-blob';\r\n\r\n\r\nconst thumbSize = 240;\r\n\r\nfunction loadImage(blob: Blob): Promise<HTMLImageElement> {\r\n    return new Promise<HTMLImageElement>((resolve, reject) => {\r\n        const im = new Image();\r\n        try {\r\n            im.src = BB.imageBlobToUrl(blob);\r\n        } catch (e) {\r\n            reject('imageBlobToUrl, ' + e.message);\r\n            return;\r\n        }\r\n        im.onload = () => {\r\n            URL.revokeObjectURL(im.src);\r\n            resolve(im);\r\n        }\r\n        im.onabort = function () {\r\n            reject('layer image failed loading');\r\n        };\r\n        im.onerror = function () {\r\n            reject('layer image failed loading');\r\n        };\r\n    });\r\n}\r\n\r\n/**\r\n * for:\r\n * - preparing project to be stored in ProjectStore\r\n * - reading a project that came out of the ProjectStore\r\n */\r\nexport class ProjectConverter {\r\n\r\n    private static createThumbnail(project): HTMLCanvasElement {\r\n        const size = BB.fitInto(project.width, project.height, thumbSize, thumbSize);\r\n        const factor = size.width / project.width;\r\n        return drawProject(project, factor);\r\n    }\r\n\r\n    static createStorageProject(project: IKlProject): IKlStorageProject {\r\n        return {\r\n            id: 1,\r\n            timestamp: new Date().getTime(),\r\n            thumbnail: base64ToBlob(ProjectConverter.createThumbnail(project).toDataURL('image/png')),\r\n            width: project.width,\r\n            height: project.height,\r\n            layers: project.layers.map(item => {\r\n                let blob;\r\n                if (item.image instanceof HTMLCanvasElement) {\r\n                    blob = base64ToBlob((item.image as HTMLCanvasElement).toDataURL('image/png'));\r\n                } else {\r\n                    // todo image\r\n                    throw new Error('Not implemented');\r\n                }\r\n                return {\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                    blob,\r\n                }\r\n            }),\r\n        };\r\n    }\r\n\r\n    static async readStorageProject(storageProject: IKlStorageProject): Promise<{\r\n        project: IKlProject,\r\n        timestamp: number,\r\n        thumbnail: HTMLImageElement | HTMLCanvasElement\r\n    }> {\r\n        if (\r\n            !storageProject.width || !storageProject.height ||\r\n            isNaN(storageProject.width) || isNaN(storageProject.height) ||\r\n            storageProject.width < 1 || storageProject.height < 1\r\n        ) {\r\n            throw new Error('readStorageProject invalid canvas size: ' + storageProject.width + ', ' + storageProject.height);\r\n        }\r\n        const project: IKlProject = {\r\n            width: storageProject.width,\r\n            height: storageProject.height,\r\n            layers: (await Promise.all(storageProject.layers.map(layer => loadImage(layer.blob))))\r\n                .map((image, i) => {\r\n                    return {\r\n                        name: storageProject.layers[i].name,\r\n                        opacity: storageProject.layers[i].opacity,\r\n                        mixModeStr: storageProject.layers[i].mixModeStr,\r\n                        image,\r\n                    };\r\n                }),\r\n        };\r\n\r\n        let thumbnail;\r\n        if (storageProject.thumbnail) {\r\n            thumbnail = await loadImage(storageProject.thumbnail);\r\n        } else {\r\n            thumbnail = ProjectConverter.createThumbnail(project);\r\n        }\r\n\r\n        return {\r\n            project: project,\r\n            timestamp: storageProject.timestamp,\r\n            thumbnail: thumbnail,\r\n        };\r\n    }\r\n\r\n}","\r\nexport function base64ToBlob(base64Str: string): Blob {\r\n    let parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n    let binStr = atob(parts[3]);\r\n    let buf = new ArrayBuffer(binStr.length);\r\n    let view = new Uint8Array(buf);\r\n    for (let i = 0; i < view.length; i++) {\r\n        view[i] = binStr.charCodeAt(i);\r\n    }\r\n    return new Blob([view], {'type': parts[1]});\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\n// @ts-ignore\r\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\r\nimport {BrowserStorageUi} from '../components/browser-storage-ui';\r\nimport {IKlProject} from '../../kl.types';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport type exportType = 'png' | 'layers' | 'psd';\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport class FileTab {\r\n\r\n    private readonly div: HTMLDivElement;\r\n    private importButton: HTMLInputElement;\r\n    private fileBrowserStorage: BrowserStorageUi;\r\n\r\n    constructor(\r\n        klRootEl,\r\n        projectStore: ProjectStore,\r\n        getProject: () => IKlProject,\r\n        private exportType,\r\n        onExportTypeChange,\r\n        onFileSelect,\r\n        onSaveImageToComputer,\r\n        onNewImage,\r\n        onShareImage,\r\n        onUpload,\r\n        onCopyToClipboard,\r\n        saveReminder: SaveReminder,\r\n    ) {\r\n        const _this = this;\r\n        this.div = document.createElement(\"div\");\r\n\r\n        const asyncCreation = () => {\r\n            let filemenu = document.createElement(\"div\");\r\n            let newButton = document.createElement(\"button\");\r\n            let saveButton = document.createElement(\"button\");\r\n            let shareButton = document.createElement(\"button\");\r\n            let uploadImgurButton = document.createElement(\"button\");\r\n            let clipboardButton = document.createElement(\"button\");\r\n\r\n            newButton.style.cssFloat = 'left';\r\n            BB.css(saveButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n            });\r\n            BB.css(clipboardButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n            });\r\n\r\n            newButton.tabIndex = -1;\r\n            saveButton.tabIndex = -1;\r\n            shareButton.tabIndex = -1;\r\n            uploadImgurButton.tabIndex = -1;\r\n            clipboardButton.tabIndex = -1;\r\n\r\n            newButton.innerHTML = `<img src='${newImageImg}' alt='icon' height='20'/>${LANG('file-new')}`;\r\n            saveButton.innerHTML = `<img src='${exportImg}' alt='icon' height='20'/>${LANG('file-save')}`;\r\n            shareButton.innerHTML = `<img src='${shareImg}' alt='icon' height='20'/>${LANG('file-share')}`;\r\n            uploadImgurButton.innerHTML = `<img style='float:left' src='${uploadImg}' height='20' alt='icon'/>${LANG('file-upload')}`;\r\n            clipboardButton.innerHTML = `<img src='${copyImg}' alt='icon' height='20'/>${LANG('file-copy')}`;\r\n            clipboardButton.title = LANG('file-copy-title');\r\n            newButton.className = \"gridButton\";\r\n            saveButton.className = \"gridButton\";\r\n            shareButton.className = \"gridButton\";\r\n            uploadImgurButton.className = \"gridButton\";\r\n            clipboardButton.className = \"gridButton\";\r\n\r\n\r\n            this.importButton = document.createElement(\"input\");\r\n            this.importButton.tabIndex = -1;\r\n            this.importButton.type = \"file\";\r\n            this.importButton.multiple = true;\r\n            this.importButton.accept = \"image\";\r\n            (this.importButton as any).size = \"71\";\r\n            this.importButton.textContent = \"Import\";\r\n            let importWrapper: any = this.importButton;\r\n\r\n            function createImportButton() {\r\n                importWrapper = document.createElement(\"div\");\r\n                importWrapper.className = \"gridButton\";\r\n                importWrapper.style.position = \"relative\";\r\n                importWrapper.style.cursor = \"pointer\";\r\n                importWrapper.style.cssFloat = \"left\";\r\n\r\n                let innerMask = document.createElement(\"div\");\r\n                innerMask.style.width = \"120px\";\r\n                innerMask.style.height = \"28px\";\r\n                innerMask.style.overflow = \"hidden\";\r\n                innerMask.style.cursor = \"pointer\";\r\n                innerMask.style.position = \"relative\";\r\n\r\n                importWrapper.appendChild(innerMask);\r\n                innerMask.appendChild(_this.importButton);\r\n\r\n                let importFakeButton = document.createElement(\"button\");\r\n                importFakeButton.innerHTML = \"<img style='float:left' height='20' src='\" + importImg + \"' alt='icon'/>\" + LANG('file-import');\r\n                importFakeButton.tabIndex = -1;\r\n\r\n                BB.css(importFakeButton, {\r\n                    width: \"120px\",\r\n                    display: \"box\",\r\n                    position: \"absolute\",\r\n                    left: '0',\r\n                    top: '0',\r\n                    cursor: \"pointer\"\r\n                });\r\n                BB.css(_this.importButton, {\r\n                    display: 'none'\r\n                });\r\n                importWrapper.appendChild(importFakeButton);\r\n\r\n                importFakeButton.onclick = function() {\r\n                    _this.importButton.click();\r\n                }\r\n            }\r\n\r\n            createImportButton();\r\n\r\n            this.importButton.onchange = function (e) {\r\n                onFileSelect(_this.importButton.files, 'default');\r\n                _this.importButton.value = \"\";\r\n\r\n            };\r\n\r\n\r\n            // --- export filetype dropdown ---\r\n            let exportTypeWrapper;\r\n            let exportTypeSelect;\r\n            {\r\n                exportTypeWrapper = BB.el({\r\n                    css: {\r\n                        fontSize: '15px',\r\n                        marginLeft: '10px',\r\n                        marginTop: '10px',\r\n                        cssFloat: 'left',\r\n                        width: 'calc(50% - 15px)',\r\n                        height: '30px'\r\n                    }\r\n                });\r\n                exportTypeSelect = new KL.Select({\r\n                    optionArr: [\r\n                        ['png', LANG('file-save-png')],\r\n                        ['psd', LANG('file-save-psd')],\r\n                        ['layers', LANG('file-save-layers')],\r\n                    ],\r\n                    initValue: exportType,\r\n                    onChange: function(val) {\r\n                        exportType = val;\r\n                        onExportTypeChange(exportType);\r\n                        onSaveImageToComputer();\r\n                    }\r\n                });\r\n                BB.css(exportTypeSelect.getElement(), {\r\n                    width: '120px',\r\n                    height: '30px'\r\n                });\r\n                exportTypeWrapper.appendChild(exportTypeSelect.getElement());\r\n\r\n            }\r\n\r\n\r\n\r\n            newButton.onclick = onNewImage;\r\n            saveButton.onclick = function () {\r\n                onSaveImageToComputer();\r\n            };\r\n            shareButton.onclick = function() {\r\n                shareButton.disabled = true;\r\n                onShareImage(() => {\r\n                    shareButton.disabled = false;\r\n                });\r\n            };\r\n            uploadImgurButton.onclick = function () {\r\n                onUpload();\r\n            };\r\n\r\n            clipboardButton.onclick = function() {\r\n                clipboardButton.blur();\r\n                onCopyToClipboard();\r\n            };\r\n\r\n            let saveNote = document.createElement(\"div\");\r\n            saveNote.textContent = \" \" + LANG('file-no-autosave');\r\n            BB.css(saveNote, {\r\n                textAlign: \"center\",\r\n                marginTop: \"10px\",\r\n                background: \"rgb(243, 243, 161)\",\r\n                padding: \"5px 0px\",\r\n                color: 'rgba(0,0,0,0.65)',\r\n                fontSize: '15px',\r\n            });\r\n\r\n            function createSpacer() {\r\n                let el = document.createElement(\"div\");\r\n                let clearer = document.createElement(\"div\");\r\n                let line = document.createElement(\"div\");\r\n                el.appendChild(clearer);\r\n                el.appendChild(line);\r\n                BB.css(clearer, {\r\n                    clear: 'both'\r\n                });\r\n                BB.css(line, {\r\n                    marginLeft: \"10px\",\r\n                    marginRight: \"10px\",\r\n                    marginTop: \"10px\",\r\n                    borderBottom: \"1px solid rgba(0,0,0,0.2)\",\r\n                    clear: 'both'\r\n                });\r\n                return el;\r\n            }\r\n\r\n            _this.fileBrowserStorage = new BrowserStorageUi(projectStore, getProject, saveReminder, klRootEl);\r\n            BB.css(_this.fileBrowserStorage.getElement(), {\r\n                //background: 'red',\r\n                margin: '10px',\r\n            });\r\n\r\n\r\n            //actual structure\r\n            BB.append(filemenu, [\r\n                saveNote,\r\n                newButton,\r\n                importWrapper,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                saveButton,\r\n                exportTypeWrapper,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                clipboardButton,\r\n                BB.canShareFiles() ? shareButton : null,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                createSpacer(),\r\n                _this.fileBrowserStorage.getElement(),\r\n                createSpacer(),\r\n                uploadImgurButton,\r\n            ]);\r\n\r\n            this.div.appendChild(filemenu);\r\n        };\r\n\r\n        setTimeout(asyncCreation, 1);\r\n    }\r\n\r\n    refresh() {\r\n    }\r\n\r\n    getElement() {\r\n        return this.div;\r\n    }\r\n\r\n    setIsVisible(isVisible: boolean) {\r\n        if (isVisible) {\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    triggerImport() {\r\n        this.importButton.click();\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2oHM2\");","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\nimport {StatusOverlay} from '../components/status-overlay';\r\nimport {KlCanvasWorkspace} from '../../canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../../kl.types';\r\n\r\n\r\nexport class FilterTab {\r\n\r\n    private readonly div: HTMLDivElement;\r\n    private isInit = false;\r\n\r\n    constructor (\r\n        private klRootEl,\r\n        private klColorSlider,\r\n        private layerManager,\r\n        // private setCurrentLayer,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private handUi,\r\n        private getCurrentColor,\r\n        private getKlMaxCanvasSize,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx,\r\n        private isEmbed: boolean,\r\n        private statusOverlay: StatusOverlay,\r\n    ) {\r\n        this.div = document.createElement(\"div\");\r\n    }\r\n\r\n    private init() {\r\n        const _this = this;\r\n        let filters = KL.filterLib;\r\n        let buttons = [];\r\n\r\n        BB.BbLog.emit({\r\n            type: 'init-filters',\r\n        });\r\n\r\n        if (!KL.filterLibStatus.isLoaded) {\r\n            throw new Error('filters not loaded');\r\n        }\r\n\r\n        function createButton(filterKey, filterArr) {\r\n            let button = document.createElement(\"button\");\r\n            let buttonLabel = LANG(filterArr[filterKey].lang.button);\r\n            let im = '<img height=\"20\" width=\"18\" src=\"' + filterArr[filterKey].icon + '\" alt=\"icon\" />';\r\n            button.innerHTML = im + buttonLabel;\r\n            button.className = \"gridButton\";\r\n            BB.css(button, {\r\n                lineHeight: '20px',\r\n                fontSize: '12px',\r\n            });\r\n            button.tabIndex = -1;\r\n\r\n            const filterName = LANG(filterArr[filterKey].lang.name);\r\n\r\n            button.onclick = function () {\r\n\r\n                function finishedDialog(result, filterDialog) {\r\n                    if (result == \"Cancel\") {\r\n                        if (filterDialog.destroy) {\r\n                            filterDialog.destroy();\r\n                        }\r\n                        return;\r\n                    }\r\n                    let input;\r\n                    try {\r\n                        input = filterDialog.getInput(); // also destroys\r\n                    } catch (e) {\r\n                        if (e.message.indexOf('.getInput is not a function') !== -1) {\r\n                            throw 'filterDialog.getInput is not a function, filter: ' + filterName;\r\n                        } else {\r\n                            throw e;\r\n                        }\r\n                    }\r\n                    applyFilter(input);\r\n                }\r\n\r\n                if (!('apply' in filterArr[filterKey])) {\r\n                    alert('Application not fully loaded');\r\n                    return;\r\n                }\r\n\r\n                function applyFilter(input) {\r\n                    let filterResult = filterArr[filterKey].apply({\r\n                        context: _this.getCurrentLayerCtx(),\r\n                        klCanvas: _this.getKlCanvas(),\r\n                        history: klHistory,\r\n                        input: input\r\n                    } as IFilterApply);\r\n                    if (filterResult === false) {\r\n                        alert(\"Couldn't apply the edit action\");\r\n                    }\r\n                    /*\r\n                     _this.setCurrentLayer(_this.getKlCanvas().getLayer(_this.layerManager.getSelected()));\r\n                    */\r\n                    if (filterArr[filterKey].updatePos === true) {\r\n                        _this.klCanvasWorkspace.resetView();\r\n                        _this.handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                    _this.layerManager.update();\r\n                }\r\n\r\n                if (filterArr[filterKey].isInstant){\r\n                    button.blur();\r\n                    applyFilter(null);\r\n                    _this.statusOverlay.out('\"' + filterName + '\" ' + LANG('filter-applied'), true);\r\n                } else {\r\n                    let secondaryColorRGB = _this.klColorSlider.getSecondaryRGB();\r\n                    let filterDialog = filterArr[filterKey].getDialog({\r\n                        context: _this.getCurrentLayerCtx(),\r\n                        klCanvas: _this.getKlCanvas(),\r\n                        maxWidth: _this.getKlMaxCanvasSize(),\r\n                        maxHeight: _this.getKlMaxCanvasSize(),\r\n                        currentColorRgb: {r: _this.getCurrentColor().r, g: _this.getCurrentColor().g, b: _this.getCurrentColor().b},\r\n                        secondaryColorRgb: {r: secondaryColorRGB.r, g: secondaryColorRGB.g, b: secondaryColorRGB.b}\r\n                    } as IFilterGetDialogParam);\r\n\r\n                    if (!filterDialog) {\r\n                        return;\r\n                        //alert('Error: could not perform action');\r\n                        //throw('filter['+filterKey+'].getDialog returned '+filterDialog+'. ctx:' + currentLayerCtx + ' klCanvas:' + klCanvas);\r\n                    }\r\n\r\n                    let closefunc;\r\n                    filterDialog.errorCallback = function(e) {\r\n                        setTimeout(function() {\r\n                            alert('Error: could not perform action');\r\n                            throw e;\r\n                        }, 0);\r\n                        closefunc();\r\n                    };\r\n\r\n\r\n                    let style: IKeyString = {};\r\n                    if ('width' in filterDialog) {\r\n                        style.width = filterDialog.width + 'px'\r\n                    }\r\n\r\n                    KL.popup({\r\n                        target: _this.klRootEl,\r\n                        message: \"<b>\" + filterName + \"</b>\",\r\n                        div: filterDialog.element,\r\n                        style: style,\r\n                        buttons: [\"Ok\", \"Cancel\"],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: function(result) {\r\n                            finishedDialog(result, filterDialog);\r\n                        },\r\n                        closefunc: function (func) {\r\n                            closefunc = func;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            buttons[buttons.length] = button;\r\n            return button;\r\n        }\r\n\r\n        function addGroup(groupArr, filterArr, targetEl) {\r\n            for (let filterKey in filterArr) {\r\n                if (filterArr.hasOwnProperty[filterKey] || !groupArr.includes(filterKey)) {\r\n                    continue;\r\n                }\r\n                if (_this.isEmbed && !filterArr[filterKey].inEmbed) {\r\n                    continue;\r\n                }\r\n                targetEl.appendChild(createButton(filterKey, filterArr));\r\n            }\r\n        }\r\n\r\n        const groupA = [\r\n            'cropExtend',\r\n            'flip',\r\n            'perspective',\r\n            'resize',\r\n            'rotate',\r\n            'transform',\r\n        ];\r\n        const groupB = [\r\n            'brightnessContrast',\r\n            'curves',\r\n            'hueSaturation',\r\n            'invert',\r\n            'tiltShift',\r\n            'toAlpha',\r\n            'blur',\r\n            'unsharpMask',\r\n        ];\r\n        const groupC = [\r\n            'grid',\r\n            'noise',\r\n        ];\r\n\r\n        addGroup(groupA, filters, _this.div);\r\n\r\n        _this.div.appendChild(BB.el({className: 'gridHr'}));\r\n        addGroup(groupB, filters, _this.div);\r\n        _this.div.appendChild(BB.el({className: 'gridHr'}));\r\n        addGroup(groupC, filters, _this.div);\r\n\r\n        this.isInit = true;\r\n    }\r\n\r\n    getElement() {\r\n        return this.div;\r\n    }\r\n\r\n    show() {\r\n        if (!this.isInit) {\r\n            this.init();\r\n        }\r\n        this.div.style.display = 'block';\r\n    }\r\n\r\n    hide() {\r\n        this.div.style.display = 'none';\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\n// @ts-ignore\r\nimport loadingImg from 'url:~/src/app/img/ui/loading.gif';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {base64ToBlob} from '../../storage/base-64-to-blob';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\nasync function upload(canvas, title, description, type: 'png' | 'jpeg', imgurKey: string): Promise<{deletehash: string}> {\r\n    let img = base64ToBlob(canvas.toDataURL(\"image/\" + type));\r\n\r\n    let w = window.open();\r\n    let label = w.document.createElement(\"div\");\r\n    let gif = w.document.createElement(\"img\");\r\n    gif.src = loadingImg;\r\n    label.appendChild(gif);\r\n    BB.css(gif, {\r\n        filter: \"invert(1)\"\r\n    });\r\n    w.document.body.style.backgroundColor = \"#121211\";\r\n    w.document.body.style.backgroundImage = \"linear-gradient(#2b2b2b 0%, #121211 50%)\";\r\n    w.document.body.style.backgroundRepeat = \"no-repeat\";\r\n    let labelText = w.document.createElement(\"div\");\r\n    labelText.style.marginTop = \"10px\";\r\n    label.appendChild(labelText);\r\n    labelText.textContent = LANG('upload-uploading');\r\n\r\n    w.document.body.appendChild(label);\r\n    BB.css(label, {\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n        marginTop: \"100px\",\r\n        fontFamily: \"Arial, sans-serif\",\r\n        fontSize: \"20px\",\r\n        textAlign: \"center\",\r\n        transition: \"opacity 0.3s ease-in-out\",\r\n        opacity: '0',\r\n        color: \"#ccc\"\r\n    });\r\n    setTimeout(function () {\r\n        label.style.opacity = '1';\r\n    }, 20);\r\n\r\n    let response;\r\n    try {\r\n        const formData = new FormData();\r\n        formData.append('title', title);\r\n        formData.append('description', description);\r\n        formData.append('image', img);\r\n        response = await fetch('https://api.imgur.com/3/image',  {\r\n            method: 'POST',\r\n            headers: {\r\n                Authorization: 'Client-ID ' + imgurKey,\r\n            },\r\n            body: formData\r\n        });\r\n\r\n    } catch (e) {\r\n        w.close();\r\n        throw new Error(e);\r\n    }\r\n    if (!response.ok) {\r\n        w.close();\r\n        throw new Error();\r\n    }\r\n    let data = (await response.json()).data;\r\n\r\n    w.location.href = (data as any).link.replace(/\\.(jpg|png)/, '');\r\n\r\n    return data;\r\n}\r\n\r\n\r\nexport function imgurUpload(klCanvas: KlCanvas, klRootEl, saveReminder: SaveReminder, imgurKey: string) {\r\n    if (!imgurKey) {\r\n        throw new Error('imgur key missing');\r\n    }\r\n\r\n    let inputTitle = document.createElement(\"input\");\r\n    inputTitle.type = \"text\";\r\n    inputTitle.value = LANG('upload-title-untitled');\r\n    let inputDescription = BB.el({\r\n        tagName: 'textarea',\r\n        custom: {\r\n            rows: 2,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            maxWidth: '100%',\r\n        },\r\n    }) as HTMLTextAreaElement;\r\n\r\n    let labelTitle = document.createElement(\"div\");\r\n    labelTitle.textContent = LANG('upload-name') + \":\";\r\n    let labelDescription = BB.el({\r\n        content: LANG('upload-caption') + ':',\r\n        css: {\r\n            marginTop: '10px',\r\n        }\r\n    });\r\n\r\n    let tos = document.createElement(\"div\");\r\n    tos.innerHTML = `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${LANG('upload-tos')}</a> ${LANG('upload-tos-2')}`;\r\n\r\n    const typeRadio = new KL.RadioList({\r\n        name: 'filetype',\r\n        init: 'jpeg',\r\n        items: [\r\n            { label: 'JPG', value: 'jpeg' },\r\n            { label: 'PNG', value: 'png' },\r\n        ],\r\n        ignoreFocus: true,\r\n    });\r\n    BB.css(typeRadio.getElement(), {\r\n        marginBottom: '10px',\r\n    });\r\n\r\n\r\n    let outDiv = document.createElement(\"div\");\r\n    let infoHint = document.createElement(\"div\");\r\n    infoHint.className = \"info-hint\";\r\n    infoHint.textContent = LANG('upload-link-notice');\r\n    outDiv.append(\r\n        infoHint,\r\n        typeRadio.getElement(),\r\n        labelTitle,\r\n        inputTitle,\r\n        labelDescription,\r\n        inputDescription,\r\n        tos\r\n    );\r\n    KL.popup({\r\n        target: klRootEl,\r\n        message: `<b>${LANG('upload-title')}</b>`,\r\n        type: \"upload\",\r\n        div: outDiv,\r\n        buttons: [LANG('upload-submit'), \"Cancel\"],\r\n        clickOnEnter: LANG('upload-submit'),\r\n        primaries: [LANG('upload-submit')],\r\n        autoFocus: LANG('upload-submit'),\r\n        callback: async function (val) {\r\n            if (val === LANG('upload-submit') || val === \"Yes\" || val === \"Ok\") {\r\n                try {\r\n                    const result = await upload(\r\n                        klCanvas.getCompleteCanvas(1),\r\n                        inputTitle.value,\r\n                        inputDescription.value,\r\n                        typeRadio.getValue() as 'png' | 'jpeg',\r\n                        imgurKey,\r\n                    );\r\n\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: \"ok\",\r\n                        message: `<h3>${LANG('upload-success')}</h3><br>${LANG('upload-delete')}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/<b>delete</b>/${result.deletehash}</a><br><br>`,\r\n                        buttons: [\"Ok\"]\r\n                    });\r\n                    saveReminder.reset();\r\n\r\n                } catch(e) {\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: \"error\",\r\n                        message: LANG('upload-failed'),\r\n                        buttons: [\"Ok\"]\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iGeXe\");","import {BB} from '../../bb/bb';\r\n\r\nlet agPsdLazy;\r\nexport async function loadAgPsd() {\r\n    if (!agPsdLazy) {\r\n        agPsdLazy = await import('ag-psd');\r\n        BB.BbLog.emit({\r\n            type: 'loaded-agpsd',\r\n        });\r\n    }\r\n    return agPsdLazy;\r\n}","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kNYzr\"))).then(() => parcelRequire('2m2jt'));","import {KL} from '../../kl';\r\nimport {BB} from '../../../bb/bb';\r\nimport {KlHistoryInterface} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\nimport {BrowserStorageUi} from './browser-storage-ui';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {IKlProject} from '../../kl.types';\r\n\r\n\r\nconst reminderTimelimitMs = 1000 * 60 * 20; // 20 minutes\r\nconst unsavedActionsLimit = 100; // number of actions user did since last save\r\n\r\n\r\n/**\r\n * remind user of saving, keep user aware of save state\r\n */\r\nexport class SaveReminder {\r\n    private lastSavedActionNumber: number = null;\r\n    private lastSavedAt: number;\r\n\r\n    private lastReminderShownAt: number;\r\n    private unsavedInterval;\r\n    private closeFunc: () => void;\r\n\r\n    showPopup (): void {\r\n        if (!this.projectStore || !this.getProject) {\r\n            throw new Error('projectStore and getProject need to be set');\r\n        }\r\n\r\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\r\n\r\n        const contentEl = BB.el({});\r\n\r\n        contentEl.append(\r\n            BB.el({\r\n                content: LANG(\r\n                    'save-reminder-text',\r\n                    {\r\n                        a: '<strong>' + min,\r\n                        b: '</strong>',\r\n                    }\r\n                ),\r\n                css: {\r\n                    marginBottom: '20px',\r\n                }\r\n            }),\r\n        );\r\n\r\n        const psdWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n            }\r\n        });\r\n        const storageWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n                paddingBottom: '0',\r\n            }\r\n        });\r\n        contentEl.append(psdWrapper, storageWrapper);\r\n\r\n\r\n        const psdBtn = BB.el({\r\n            tagName: 'button',\r\n            className: 'kl-button',\r\n            content: LANG('save-reminder-save-psd'),\r\n            onClick: () => this.onSaveAsPsd(),\r\n        });\r\n        psdWrapper.append(\r\n            psdBtn,\r\n            BB.el({\r\n                content: LANG('save-reminder-psd-layers'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            }),\r\n        );\r\n\r\n\r\n        const storageUi = new BrowserStorageUi(\r\n            this.projectStore,\r\n            this.getProject,\r\n            this,\r\n            document.body as any,\r\n            {\r\n                hideClearButton: true,\r\n                isFocusable: true,\r\n            }\r\n        );\r\n        storageWrapper.append(storageUi.getElement());\r\n\r\n\r\n        KL.popup({\r\n            target: document.body,\r\n            message: `<b>${LANG('save-reminder-title')}</b>`,\r\n            div: contentEl,\r\n            ignoreBackground: true,\r\n            callback: () => {\r\n                storageUi.destroy();\r\n                BB.destroyEl(psdBtn);\r\n                this.closeFunc = null;\r\n                this.lastReminderShownAt = performance.now();\r\n            },\r\n            closefunc: (f) => {\r\n                this.closeFunc = f;\r\n            }\r\n        });\r\n        setTimeout(() => {\r\n            psdBtn.focus();\r\n        }, 40);\r\n    }\r\n\r\n    constructor (\r\n        private history: KlHistoryInterface,\r\n        private showReminder: boolean,\r\n        private changeTitle: boolean,\r\n        private onSaveAsPsd: () => void,\r\n        private isDrawing: () => boolean,\r\n        private projectStore: ProjectStore | null, // needed if showReminder\r\n        private getProject: (() => IKlProject) | null, // needed if showReminder\r\n        private title: string = 'Klecks',\r\n    ) { }\r\n\r\n    init (): void {\r\n        if (this.lastSavedActionNumber !== null) { // already initialized\r\n            return;\r\n        }\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n\r\n        if (this.showReminder) {\r\n            setInterval(() => {\r\n                if (document.visibilityState !== 'visible') {\r\n                    return;\r\n                }\r\n\r\n                let unsavedActions = Math.abs(this.history.getActionNumber() - this.lastSavedActionNumber);\r\n\r\n                if (\r\n                    KL.dialogCounter.get() === 0 &&\r\n                    !this.isDrawing() &&\r\n                    this.lastReminderShownAt + reminderTimelimitMs < performance.now() &&\r\n                    unsavedActions >= unsavedActionsLimit\r\n                ) {\r\n                    this.showPopup();\r\n                }\r\n            }, 1000 * 5);\r\n        }\r\n\r\n        // confirmation dialog when closing tab\r\n        function onBeforeUnload(e) {\r\n            e.preventDefault();\r\n            e.returnValue = '';\r\n        }\r\n\r\n        this.history.addListener(() => {\r\n            let actionNumber = this.history.getActionNumber();\r\n            if (this.lastSavedActionNumber !== actionNumber) {\r\n                BB.setEventListener(window, 'onbeforeunload', onBeforeUnload);\r\n            } else {\r\n                BB.setEventListener(window, 'onbeforeunload', null);\r\n            }\r\n        });\r\n\r\n        if (this.changeTitle) {\r\n            document.addEventListener(\"visibilitychange\", () => {\r\n                if (document.visibilityState === 'visible') {\r\n                    document.title = this.title;\r\n                    clearInterval(this.unsavedInterval);\r\n                } else {\r\n                    let actionNumber = this.history.getActionNumber();\r\n                    if (this.lastSavedActionNumber !== actionNumber) {\r\n                        document.title = LANG('unsaved') + ' - ' + this.title;\r\n                        let state = 0;\r\n                        this.unsavedInterval = setInterval(() => {\r\n                            state = (state + 1) % 2;\r\n                            if (state === 1) {\r\n                                document.title = LANG('unsaved') + '  ' + this.title;\r\n                            } else {\r\n                                document.title = LANG('unsaved') + ' - ' + this.title;\r\n                            }\r\n                        }, 1000 * 60 * 3);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    reset (): void {\r\n        if (this.lastSavedActionNumber === null) { // not initialized\r\n            return;\r\n        }\r\n\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n        BB.setEventListener(window, 'onbeforeunload', null);\r\n\r\n        if (this.closeFunc) {\r\n            this.closeFunc();\r\n        }\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {KL} from '../kl';\r\nimport {saveAs} from 'file-saver';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\n\r\nexport class SaveToComputer {\r\n\r\n    constructor(\r\n        private saveReminder,\r\n        private klRootEl,\r\n        private getExportType,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private filenameBase: string,\r\n    ) {}\r\n\r\n    save(format?: 'psd' | 'layers' | 'png') {\r\n        const _this = this;\r\n\r\n        _this.saveReminder.reset();\r\n\r\n\r\n        function saveImage(canvas, filename, mimeType) {\r\n            let parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n            //assume base64 encoding\r\n            let binStr = atob(parts[3]);\r\n            //convert to binary in ArrayBuffer\r\n            let buf = new ArrayBuffer(binStr.length);\r\n            let view = new Uint8Array(buf);\r\n            for (let i = 0; i < view.length; i++) {\r\n                view[i] = binStr.charCodeAt(i);\r\n            }\r\n            let blob = new Blob([view], {'type': parts[1]});\r\n            saveAs(blob, filename);\r\n        }\r\n\r\n        if (!format) {\r\n            format = _this.getExportType();\r\n        }\r\n\r\n        if (format === 'png') {\r\n            let extension = 'png';\r\n            let mimeType = 'image/png';\r\n            let filename = BB.getDate() + this.filenameBase + \".\" + extension;\r\n            let fullCanvas = _this.getKlCanvas().getCompleteCanvas(1);\r\n\r\n            /*fullCanvas.toBlob(function(blob) {\r\n                if (blob === null) {\r\n                    throw 'save image error, blob is null';\r\n                }\r\n                saveAs(blob, filename);\r\n            }, mimetype);*/\r\n\r\n            //using old code, because saving somehow doesn't work for ipad before ios 13\r\n            //and it doesn't even throw an exception\r\n            try {\r\n                saveImage(fullCanvas, filename, mimeType);\r\n            } catch (error) { //fallback for old browsers\r\n                let im = new Image();\r\n                im.width = _this.getKlCanvas().getWidth();\r\n                im.height = _this.getKlCanvas().getHeight();\r\n                im.src = fullCanvas.toDataURL(mimeType);\r\n                KL.exportDialog(_this.klRootEl, im);\r\n            }\r\n        } else if (format === 'layers') {\r\n            let extension = 'png';\r\n            let mimeType = 'image/png';\r\n            let fileBase = BB.getDate() + this.filenameBase;\r\n            let layerArr = _this.getKlCanvas().getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                let item = layerArr[i];\r\n                let fnameArr = [\r\n                    fileBase,\r\n                    '_',\r\n                    ('' + (i + 1)).padStart(2, '0'),\r\n                    '_',\r\n                    item.name,\r\n                    '.',\r\n                    extension\r\n                ];\r\n                saveImage(item.canvas, fnameArr.join(''), mimeType);\r\n            }\r\n        } else if (format === 'psd') {\r\n\r\n            let layerArr = _this.getKlCanvas().getLayersFast();\r\n\r\n            let psdConfig = {\r\n                width: _this.getKlCanvas().getWidth(),\r\n                height: _this.getKlCanvas().getHeight(),\r\n                children: [],\r\n                canvas: _this.getKlCanvas().getCompleteCanvas(1)\r\n            };\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                let item = layerArr[i];\r\n                psdConfig.children.push({\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    canvas: item.canvas,\r\n                    blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n                    left: 0,\r\n                    top: 0\r\n                });\r\n            }\r\n\r\n            KL.loadAgPsd().then((agPsdLazy) => {\r\n                let buffer = agPsdLazy.writePsdBuffer(psdConfig);\r\n                let blob = new Blob([buffer], { type: 'application/octet-stream' });\r\n                saveAs(blob, BB.getDate() + this.filenameBase + '.psd');\r\n            }).catch(() => {\r\n                alert('Error: failed to load PSD library');\r\n            });\r\n\r\n        }\r\n\r\n    }\r\n\r\n}","/*\n* FileSaver.js\n* A saveAs() FileSaver implementation.\n*\n* By Eli Grey, http://eligrey.com\n*\n* License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)\n* source  : http://purl.eligrey.com/github/FileSaver.js\n*/\n\n// The one and only way of getting global scope in all environments\n// https://stackoverflow.com/q/3277182/1008999\nvar _global = typeof window === 'object' && window.window === window\n  ? window : typeof self === 'object' && self.self === self\n  ? self : typeof global === 'object' && global.global === global\n  ? global\n  : this\n\nfunction bom (blob, opts) {\n  if (typeof opts === 'undefined') opts = { autoBom: false }\n  else if (typeof opts !== 'object') {\n    console.warn('Deprecated: Expected third argument to be a object')\n    opts = { autoBom: !opts }\n  }\n\n  // prepend BOM for UTF-8 XML and text/* types (including HTML)\n  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n  if (opts.autoBom && /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n    return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type })\n  }\n  return blob\n}\n\nfunction download (url, name, opts) {\n  var xhr = new XMLHttpRequest()\n  xhr.open('GET', url)\n  xhr.responseType = 'blob'\n  xhr.onload = function () {\n    saveAs(xhr.response, name, opts)\n  }\n  xhr.onerror = function () {\n    console.error('could not download file')\n  }\n  xhr.send()\n}\n\nfunction corsEnabled (url) {\n  var xhr = new XMLHttpRequest()\n  // use sync to avoid popup blocker\n  xhr.open('HEAD', url, false)\n  try {\n    xhr.send()\n  } catch (e) {}\n  return xhr.status >= 200 && xhr.status <= 299\n}\n\n// `a.click()` doesn't work for all browsers (#465)\nfunction click (node) {\n  try {\n    node.dispatchEvent(new MouseEvent('click'))\n  } catch (e) {\n    var evt = document.createEvent('MouseEvents')\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,\n                          20, false, false, false, false, 0, null)\n    node.dispatchEvent(evt)\n  }\n}\n\n// Detect WebView inside a native macOS app by ruling out all browsers\n// We just need to check for 'Safari' because all other browsers (besides Firefox) include that too\n// https://www.whatismybrowser.com/guides/the-latest-user-agent/macos\nvar isMacOSWebView = _global.navigator && /Macintosh/.test(navigator.userAgent) && /AppleWebKit/.test(navigator.userAgent) && !/Safari/.test(navigator.userAgent)\n\nvar saveAs = _global.saveAs || (\n  // probably in some web worker\n  (typeof window !== 'object' || window !== _global)\n    ? function saveAs () { /* noop */ }\n\n  // Use download attribute first if possible (#193 Lumia mobile) unless this is a macOS WebView\n  : ('download' in HTMLAnchorElement.prototype && !isMacOSWebView)\n  ? function saveAs (blob, name, opts) {\n    var URL = _global.URL || _global.webkitURL\n    var a = document.createElement('a')\n    name = name || blob.name || 'download'\n\n    a.download = name\n    a.rel = 'noopener' // tabnabbing\n\n    // TODO: detect chrome extensions & packaged apps\n    // a.target = '_blank'\n\n    if (typeof blob === 'string') {\n      // Support regular links\n      a.href = blob\n      if (a.origin !== location.origin) {\n        corsEnabled(a.href)\n          ? download(blob, name, opts)\n          : click(a, a.target = '_blank')\n      } else {\n        click(a)\n      }\n    } else {\n      // Support blobs\n      a.href = URL.createObjectURL(blob)\n      setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s\n      setTimeout(function () { click(a) }, 0)\n    }\n  }\n\n  // Use msSaveOrOpenBlob as a second approach\n  : 'msSaveOrOpenBlob' in navigator\n  ? function saveAs (blob, name, opts) {\n    name = name || blob.name || 'download'\n\n    if (typeof blob === 'string') {\n      if (corsEnabled(blob)) {\n        download(blob, name, opts)\n      } else {\n        var a = document.createElement('a')\n        a.href = blob\n        a.target = '_blank'\n        setTimeout(function () { click(a) })\n      }\n    } else {\n      navigator.msSaveOrOpenBlob(bom(blob, opts), name)\n    }\n  }\n\n  // Fallback to using FileReader and a popup\n  : function saveAs (blob, name, opts, popup) {\n    // Open a popup immediately do go around popup blocker\n    // Mostly only available on user interaction and the fileReader is async so...\n    popup = popup || open('', '_blank')\n    if (popup) {\n      popup.document.title =\n      popup.document.body.innerText = 'downloading...'\n    }\n\n    if (typeof blob === 'string') return download(blob, name, opts)\n\n    var force = blob.type === 'application/octet-stream'\n    var isSafari = /constructor/i.test(_global.HTMLElement) || _global.safari\n    var isChromeIOS = /CriOS\\/[\\d]+/.test(navigator.userAgent)\n\n    if ((isChromeIOS || (force && isSafari) || isMacOSWebView) && typeof FileReader !== 'undefined') {\n      // Safari doesn't allow downloading of blob URLs\n      var reader = new FileReader()\n      reader.onloadend = function () {\n        var url = reader.result\n        url = isChromeIOS ? url : url.replace(/^data:[^;]*;/, 'data:attachment/file;')\n        if (popup) popup.location.href = url\n        else location = url\n        popup = null // reverse-tabnabbing #460\n      }\n      reader.readAsDataURL(blob)\n    } else {\n      var URL = _global.URL || _global.webkitURL\n      var url = URL.createObjectURL(blob)\n      if (popup) popup.location = url\n      else location.href = url\n      popup = null // reverse-tabnabbing #460\n      setTimeout(function () { URL.revokeObjectURL(url) }, 4E4) // 40s\n    }\n  }\n)\n\n_global.saveAs = saveAs.saveAs = saveAs\n\nif (typeof module !== 'undefined') {\n  module.exports = saveAs;\n}\n","import {KL} from '../kl';\r\nimport {IHistoryBroadcast, IHistoryEntry, klHistory} from './kl-history';\r\nimport {KlCanvasWorkspace} from '../canvas-ui/kl-canvas-workspace';\r\nimport {IFilterApply, IInitState} from '../kl.types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\n\r\nexport class UndoRedoCatchup {\r\n\r\n    private doIgnore = false;\r\n\r\n    /**\r\n     * Prevent multiple undo / redo getting triggered at once.\r\n     * Might be confusing if main thread is choking.\r\n     */\r\n    private ignoreTest (): boolean {\r\n        if (this.doIgnore) {\r\n            return false;\r\n        }\r\n        this.doIgnore = true;\r\n        setTimeout(() => {\r\n            this.doIgnore = false;\r\n        }, 0);\r\n        return true;\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        private brushUiObj,\r\n        private layerPreview,\r\n        private layerManager,\r\n        private handUi,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private getInitState: () => IInitState,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx,\r\n        private setCurrentLayerCtx,\r\n        private getCurrentBrush,\r\n    ) { }\r\n\r\n    undo (): boolean {\r\n        if (!this.ignoreTest()) {\r\n            return false;\r\n        }\r\n\r\n        if (!klHistory.canUndo()) { // || workspace.isPainting()) {\r\n            return false;\r\n        }\r\n        const actions: IHistoryEntry[] = klHistory.undo();\r\n        klHistory.pause(true);\r\n        const initState: IInitState = this.getInitState();\r\n        const oldSize = {w: this.getKlCanvas().getWidth(), h: this.getKlCanvas().getHeight()};\r\n        this.getKlCanvas().copy(initState.canvas);\r\n        let layerIndex = initState.focus;\r\n        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\r\n        const brushes: any = {};\r\n        for (let b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\r\n        for (let i = 0; i < actions.length; i++) {\r\n            ((i) => {\r\n                if (actions[i].tool[0] === \"brush\") {\r\n                    const b = brushes[actions[i].tool[1]];\r\n                    if (actions[i].actions) {\r\n                        for (let e = 0; e < actions[i].actions.length; e++) {\r\n                            const p = actions[i].actions[e].params;\r\n                            b[actions[i].actions[e].action].apply(b, p);\r\n                        }\r\n                    } else {\r\n                        const p = actions[i].params;\r\n                        b[actions[i].action].apply(b, p);\r\n                    }\r\n                } else if (actions[i].tool[0] === \"canvas\") {\r\n                    const p = actions[i].params;\r\n                    const id = this.getKlCanvas()[actions[i].action].apply(this.getKlCanvas(), p);\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"filter\") {\r\n                    const p = [{\r\n                        context: this.getCurrentLayerCtx(),\r\n                        klCanvas: this.getKlCanvas(),\r\n                        input: actions[i].params[0].input,\r\n                        history: new KL.DecoyKlHistory(),\r\n                    } as IFilterApply];\r\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\r\n\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\r\n                    layerIndex = actions[i].params[0];\r\n                    this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(actions[i].params[0]));\r\n                    for (let b in brushes) {\r\n                        if (brushes.hasOwnProperty(b)) {\r\n                            brushes[b].setContext(this.getCurrentLayerCtx());\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\r\n                    const id = this.getKlCanvas().addLayer();\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        if (actions[i].params[1]) {\r\n                            this.getKlCanvas().renameLayer(layerIndex, actions[i].params[1]);\r\n                        }\r\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\r\n                }\r\n            })(i);\r\n        }\r\n        if (oldSize.w !== this.getKlCanvas().getWidth() || oldSize.h !== this.getKlCanvas().getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        this.layerManager.update(layerIndex);\r\n        this.layerPreview.setLayer(this.getKlCanvas().getLayer(layerIndex));\r\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n\r\n        klHistory.pause(false);\r\n        return true;\r\n    }\r\n\r\n    redo (): boolean {\r\n        if (!this.ignoreTest()) {\r\n            return false;\r\n        }\r\n\r\n        if (!klHistory.canRedo()) {\r\n            return false;\r\n        }\r\n        const actions = klHistory.redo();\r\n        klHistory.pause(true);\r\n        const oldSize = {w: this.getKlCanvas().getWidth(), h: this.getKlCanvas().getHeight()};\r\n        let layerIndex;\r\n        const brushes: any = {};\r\n        for (let b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(this.brushUiObj.sketchyBrush.getSeed());\r\n        for (let i = 0; i < actions.length; i++) {\r\n            ((i) => {\r\n                if (actions[i].tool[0] === \"brush\") {\r\n                    const b = brushes[actions[i].tool[1]];\r\n                    if (actions[i].actions) {\r\n                        for (let e = 0; e < actions[i].actions.length; e++) {\r\n                            const p = actions[i].actions[e].params;\r\n                            b[actions[i].actions[e].action].apply(b, p);\r\n                        }\r\n                    } else {\r\n                        const p = actions[i].params;\r\n                        b[actions[i].action].apply(b, p);\r\n                    }\r\n                } else if (actions[i].tool[0] === \"canvas\") {\r\n                    const p = actions[i].params;\r\n                    const id = this.getKlCanvas()[actions[i].action].apply(this.getKlCanvas(), p);\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"filter\") {\r\n                    const p = [{\r\n                        context: this.getCurrentLayerCtx(),\r\n                        klCanvas: this.getKlCanvas(),\r\n                        input: actions[i].params[0].input,\r\n                        history: new KL.DecoyKlHistory(),\r\n                    } as IFilterApply];\r\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\r\n\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\r\n                    layerIndex = actions[i].params[0];\r\n                    this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(actions[i].params[0]));\r\n                    for (let b in brushes) {\r\n                        if (brushes.hasOwnProperty(b)) {\r\n                            brushes[b].setContext(this.getCurrentLayerCtx());\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\r\n                    const id = this.getKlCanvas().addLayer();\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        if (actions[i].params[1]) {\r\n                            this.getKlCanvas().renameLayer(layerIndex, actions[i].params[1]);\r\n                        }\r\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\r\n                }\r\n            })(i);\r\n        }\r\n\r\n        if (oldSize.w !== this.getKlCanvas().getWidth() || oldSize.h !== this.getKlCanvas().getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        const currentLayerIndex = this.getKlCanvas().getLayerIndex(this.getCurrentLayerCtx().canvas);\r\n        this.layerManager.update(currentLayerIndex);\r\n        this.layerPreview.setLayer(this.getKlCanvas().getLayer(currentLayerIndex));\r\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n        klHistory.pause(false);\r\n\r\n        return true;\r\n    }\r\n\r\n    catchup (logParam: IHistoryBroadcast | null): void {\r\n        // const start = performance.now();\r\n        //play catch up (the version that is a few steps behind)\r\n        if (logParam && logParam.bufferUpdate) {\r\n            const initState: IInitState = this.getInitState();\r\n\r\n            const brushes = initState.brushes;\r\n            const actions = [logParam.bufferUpdate];\r\n            let localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\r\n            const canvas = initState.canvas;\r\n            let layerIndex = initState.focus;\r\n            ((i) => {\r\n                if (actions[i].tool[0] === \"brush\") {\r\n                    let b = brushes[actions[i].tool[1]];\r\n                    if (actions[i].actions) {\r\n                        for (let e = 0; e < actions[i].actions.length; e++) {\r\n                            const p = actions[i].actions[e].params;\r\n                            b[actions[i].actions[e].action].apply(b, p);\r\n                        }\r\n                    } else {\r\n                        const p = actions[i].params;\r\n                        b[actions[i].action].apply(b, p);\r\n                    }\r\n                } else if (actions[i].tool[0] === \"canvas\") {\r\n                    const p = actions[i].params;\r\n                    const id = canvas[actions[i].action].apply(canvas, p);\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        localCurrentLayerCtx = canvas.getLayerContext(layerIndex);\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(localCurrentLayerCtx);\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"filter\") {\r\n                    const p = [{\r\n                        context: localCurrentLayerCtx,\r\n                        klCanvas: canvas,\r\n                        input: actions[i].params[0].input,\r\n                        history: new KL.DecoyKlHistory(),\r\n                    } as IFilterApply];\r\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\r\n\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\r\n                    layerIndex = actions[i].params[0];\r\n                    localCurrentLayerCtx = canvas.getLayerContext(actions[i].params[0]);\r\n                    for (let b in brushes) {\r\n                        if (brushes.hasOwnProperty(b)) {\r\n                            brushes[b].setContext(localCurrentLayerCtx);\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\r\n                    const id = canvas.addLayer();\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        if (actions[i].params[1]) {\r\n                            this.getKlCanvas().renameLayer(layerIndex, actions[i].params[1]);\r\n                        }\r\n                        localCurrentLayerCtx = canvas.getLayerContext(layerIndex);\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(localCurrentLayerCtx);\r\n                            }\r\n                        }\r\n                    }\r\n                    localCurrentLayerCtx.drawImage(actions[i].params[0], 0, 0);\r\n                }\r\n            })(0);\r\n            initState.focus = layerIndex;\r\n        }\r\n        // console.log('catchup', performance.now() - start);\r\n    }\r\n\r\n\r\n}","import {IRGB, ISliderConfig} from '../kl.types';\r\n\r\nexport type TBrushSettingEmit = { type: 'color'; value: IRGB } |\r\n    { type: 'opacity'; value: number } |\r\n    { type: 'size'; value: number } |\r\n    { type: 'sliderConfig'; value: ISliderConfig };\r\n\r\nexport type TBrushSettingSubscriber = (p : TBrushSettingEmit) => void;\r\n\r\n/**\r\n * Central place to update brush settings, and to subscribe to changes.\r\n */\r\nexport class BrushSettingService {\r\n\r\n    private static instance: BrushSettingService;\r\n    subscriberArr: TBrushSettingSubscriber[] = [];\r\n\r\n    private emit (obj: TBrushSettingEmit, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (this.subscriberArr[i] === skipSubscriber) {\r\n                continue;\r\n            }\r\n            this.subscriberArr[i](obj);\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        private onSetColor: (rgb: IRGB) => void,\r\n        private onSetSize: (size: number) => void,\r\n        private onSetOpacity: (opacity: number) => void,\r\n        private onGetColor: () => IRGB,\r\n        private onGetSize: () => number,\r\n        private onGetOpacity: () => number,\r\n        private onGetSliderConfig: () => ISliderConfig,\r\n    ) {\r\n        if (BrushSettingService.instance) {\r\n            throw new Error('BrushSettingService already instantiated');\r\n        }\r\n        BrushSettingService.instance = this;\r\n    }\r\n\r\n    emitColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'color',\r\n                value: color\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSize (size: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'size',\r\n                value: size\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'opacity',\r\n                value: opacity\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSliderConfig (sliderConfig: ISliderConfig, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.emit(\r\n            {\r\n                type: 'sliderConfig',\r\n                value: sliderConfig\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    /**\r\n     * set current brush color\r\n     * @param color\r\n     * @param skipSubscriber\r\n     */\r\n    setColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetColor(color);\r\n        this.emitColor(color, skipSubscriber);\r\n    }\r\n\r\n    /**\r\n     * set current brush size\r\n     * @param size\r\n     * @param skipSubscriber\r\n     */\r\n    setSize (size: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetSize(size);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * set current opacity\r\n     * @param opacity\r\n     * @param skipSubscriber\r\n     */\r\n    setOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetOpacity(opacity);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * get current brush color\r\n     */\r\n    getColor (): IRGB {\r\n        return this.onGetColor();\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.onGetSize();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.onGetOpacity();\r\n    }\r\n\r\n    getSliderConfig (): ISliderConfig {\r\n        return this.onGetSliderConfig();\r\n    }\r\n\r\n    /**\r\n     * subscribe to changes\r\n     * @param func\r\n     */\r\n    subscribe (func: TBrushSettingSubscriber): void {\r\n        if (this.subscriberArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.subscriberArr.push(func);\r\n    }\r\n\r\n    unsubscribe (func: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (func === this.subscriberArr[i]) {\r\n                this.subscriberArr.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG, languageStrings, LS_LANGUAGE_KEY} from '../../../language/language';\r\nimport {KL} from '../../kl';\r\nimport {languages} from '../../../../languages/languages';\r\nimport {Popup} from '../modals/popup';\r\n// @ts-ignore\r\nimport bitbofLogoImg from 'url:~/src/app/img/bitbof-logo.svg';\r\n// @ts-ignore\r\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\r\n// @ts-ignore\r\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\r\nimport {LocalStorage} from '../../../bb/base/local-storage';\r\n\r\nexport class SettingsTab {\r\n\r\n    private el: HTMLElement;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        onLeftRight: () => void,\r\n        customAbout?: HTMLElement,\r\n    ) {\r\n\r\n        // ---- language ----\r\n        const language = languageStrings.getLanguage();\r\n\r\n        this.el = BB.el({\r\n            content: `\r\n${LANG('settings-language')}: ${language.name} (${language.code})\r\n            `,\r\n            css: {\r\n                margin: '10px',\r\n            }\r\n        });\r\n\r\n        const preferredLanguageRow = BB.el({\r\n            content: LANG('settings-preferred-language') + ':<br>',\r\n            css: {\r\n                marginTop: '10px',\r\n            }\r\n        });\r\n        const options: [string, string][] = [\r\n            ['auto', LANG('auto')] as [string, string]\r\n        ].concat(\r\n            languages.map(item => {\r\n                return [item.code, item.name + ` (${item.code})`];\r\n            })\r\n        );\r\n        const languageSelect = new KL.Select({\r\n            initValue: LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto',\r\n            optionArr: options,\r\n            onChange: (val) => {\r\n                if (val === 'auto') {\r\n                    LocalStorage.removeItem(LS_LANGUAGE_KEY);\r\n                } else {\r\n                    LocalStorage.setItem(LS_LANGUAGE_KEY, val);\r\n                }\r\n                languageHint.style.display = 'block';\r\n            },\r\n        });\r\n        const languageHint = BB.el({\r\n            content: LANG('settings-language-reload'),\r\n            css: {\r\n                display: 'none',\r\n                marginTop: '5px',\r\n            }\r\n        });\r\n\r\n        preferredLanguageRow.append(\r\n            languageSelect.getElement(),\r\n            languageHint,\r\n        );\r\n\r\n        this.el.append(preferredLanguageRow);\r\n\r\n        // ---- flip ui ----\r\n        BB.el({\r\n            tagName: 'button',\r\n            parent: this.el,\r\n            content: '<img height=\"20\" width=\"18\" src=\"' + uiSwapImg + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + LANG('switch-ui-left-right'),\r\n            onClick: () => onLeftRight(),\r\n            css: {\r\n                marginTop: '20px',\r\n            },\r\n            custom: {\r\n                tabIndex: '-1',\r\n            }\r\n        });\r\n\r\n\r\n        // ---- about ----\r\n        this.el.append(BB.el({className: 'gridHr', css: {margin: '10px 0'}}));\r\n\r\n        function makeLicenses() {\r\n            return BB.el({\r\n                tagName: 'a',\r\n                content: LANG('licenses'),\r\n                onClick: () => {\r\n                    import('./licenses').then(result => {\r\n                        new Popup({\r\n                            title: BB.el({\r\n                                content: LANG('licenses'),\r\n                            }),\r\n                            content: BB.el({\r\n                                content: BB.el({\r\n                                    content: result.licenses.replace(/\\n/g, '<br>'),\r\n                                    css: {\r\n                                        padding: '20px',\r\n                                    }\r\n                                }),\r\n                                css: {\r\n                                    height: '100%',\r\n                                    overflowY: 'scroll',\r\n                                }\r\n                            }),\r\n                            width: 800,\r\n                            isMaxHeight: true,\r\n                        });\r\n                    });\r\n                },\r\n            });\r\n        }\r\n\r\n        if (customAbout) {\r\n            this.el.append(customAbout);\r\n            if (!customAbout.innerHTML) {\r\n                const minimalAbout = BB.el({\r\n                    parent: customAbout,\r\n                    css: {\r\n                       textAlign: 'center',\r\n                   }\r\n                });\r\n                minimalAbout.append(\r\n                    BB.el({\r\n                        content: `<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2022<br>`,\r\n                    }),\r\n                    makeLicenses(),\r\n                );\r\n            }\r\n        } else {\r\n            const versionEl = BB.el({\r\n                parent: this.el,\r\n                css: {\r\n                    textAlign: 'center',\r\n                },\r\n                content: `\r\n<img alt=\"Klecks\" height=\"25\" src=\"${klecksLogoImg}\"><br>\r\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2022<br>`\r\n            });\r\n\r\n            versionEl.append(\r\n                makeLicenses(),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('donate'),\r\n                    custom: {\r\n                        href: 'https://kleki.com/donate/',\r\n                        target: '_blank',\r\n                    }\r\n                }),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('source-code'),\r\n                    custom: {\r\n                        href: 'https://klecks.org',\r\n                        target: '_blank',\r\n                    }\r\n                }),\r\n            );\r\n\r\n\r\n        }\r\n\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== LS_LANGUAGE_KEY) {\r\n                return;\r\n            }\r\n            languageSelect.setValue(\r\n                LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'\r\n            );\r\n        });\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kSWIa\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"4FMUg\");","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"79hnx\"))).then(() => parcelRequire('jNQF2'));","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport caretImg from 'url:~/src/app/img/ui/caret-down.svg';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\nimport {LANG} from '../../../language/language';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n\r\n/**\r\n * Scroll buttons at the top and bottom of toolspace\r\n * Show up when window is very small.\r\n * Allow user to scroll up and down toolspace.\r\n */\r\nexport class ToolspaceScroller {\r\n\r\n    private toolspace: HTMLElement;\r\n    private upBtn: HTMLElement;\r\n    private downBtn: HTMLElement;\r\n    private downInterval: any;\r\n    private upInterval: any;\r\n\r\n    private update(): void {\r\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) { // small buffer where it's not worth it\r\n            if (!this.upInterval) {\r\n                this.upBtn.style.display = this.toolspace.scrollTop === 0 ? 'none' : 'block';\r\n            }\r\n            if (!this.downInterval) {\r\n                this.downBtn.style.display = (\r\n                    this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ?\r\n                        'none' : 'block'\r\n                );\r\n            }\r\n        } else {\r\n            this.upBtn.style.display = 'none';\r\n            this.downBtn.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n    constructor(p: {toolspace: HTMLElement, uiState: 'left' | 'right'}) {\r\n        this.toolspace = p.toolspace;\r\n        this.upBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                top: '0',\r\n                transform: 'rotate(180deg)',\r\n            }\r\n        });\r\n        this.downBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                bottom: '0',\r\n            }\r\n        });\r\n        this.updateUiState(p.uiState);\r\n\r\n        const upListener = new BB.PointerListener({\r\n            target: this.upBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.upInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, -13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.upInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.upInterval = null;\r\n                        this.update()\r\n                    }, 50);\r\n                }\r\n            },\r\n        });\r\n        const downListener = new BB.PointerListener({\r\n            target: this.downBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.downInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, 13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.downInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.downInterval = null;\r\n                        this.update()\r\n                    }, 50);\r\n                }\r\n            }\r\n        });\r\n\r\n        const wheelListener = (e: WheelEvent) => {\r\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\r\n            this.update();\r\n        };\r\n        this.upBtn.addEventListener('wheel', wheelListener);\r\n        this.downBtn.addEventListener('wheel', wheelListener);\r\n\r\n        this.update();\r\n\r\n        const observer = new MutationObserver(() => this.update());\r\n        observer.observe(\r\n            this.toolspace,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n        window.addEventListener('resize', () => this.update());\r\n\r\n        // hide if in dialog because that can have its own scrollbar\r\n        dialogCounter.subscribe((v) => {\r\n            // ignores the 0.5 by tool dropdown\r\n            this.upBtn.style.opacity = v >= 1 ? '0' : '';\r\n            this.downBtn.style.opacity = v >= 1 ? '0' : '';\r\n        });\r\n    }\r\n\r\n    updateUiState (uiState: 'left' | 'right'): void {\r\n        BB.css(this.upBtn, {\r\n            left: uiState === 'left' ? '0' : null,\r\n            right: uiState === 'right' ? '0' : null,\r\n        });\r\n        BB.css(this.downBtn, {\r\n            left: uiState === 'left' ? '0' : null,\r\n            right: uiState === 'right' ? '0' : null,\r\n        });\r\n    }\r\n}","/**\r\n * Topmost row of buttons in toolspace\r\n *\r\n * p = { // button click callbacks\r\n *     onSubmit: function(),\r\n *     onLeftRight: function(),\r\n *     onHelp: function()\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nimport {BB} from \"../bb/bb\";\r\n// @ts-ignore\r\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\r\n// @ts-ignore\r\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\r\nimport {LANG} from '../language/language';\r\n\r\nexport class ToolspaceTopRow {\r\n    el: HTMLDivElement;\r\n\r\n    constructor(p: {onSubmit: () => void, onLeftRight: () => void, onHelp: () => void}) {\r\n        let div = document.createElement('div');\r\n        this.el = div;\r\n        BB.css(div, {\r\n            height: '36px',\r\n            //background: '#f00',\r\n            display: 'flex',\r\n            backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n        });\r\n\r\n        function createButton(p) {\r\n            let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n            let result = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.content ? '' : (p.contain ? padding + 'px 0' : ''),\r\n                }\r\n            });\r\n            if (p.content) {\r\n                result.appendChild(p.content);\r\n            } else {\r\n                let im = BB.el({\r\n                    css: {\r\n                        backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                        backgroundRepeat: 'no-repeat',\r\n                        backgroundPosition: 'center',\r\n                        backgroundSize: p.contain ? 'contain' : '',\r\n                        //filter: 'grayscale(1)',\r\n                        height: '100%'\r\n                    }\r\n                });\r\n                im.style.pointerEvents = 'none';\r\n                result.appendChild(im);\r\n            }\r\n            (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: result,\r\n                onEnterLeave: function(isOver) {\r\n                    result.classList.toggle('toolspace-row-button-hover', isOver);\r\n                }\r\n            });\r\n            return result;\r\n        }\r\n\r\n        let submitButton = createButton({\r\n            onClick: p.onSubmit,\r\n            title: LANG('submit-title'),\r\n            content: BB.el({\r\n                content: LANG('submit'),\r\n                className: 'toolspace-row-button__submit',\r\n                css: {\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    width: '100%',\r\n                    height: '100%'\r\n                }\r\n            }),\r\n            contain: true\r\n        });\r\n        submitButton.style.width = '45px';\r\n\r\n        let helpButton = createButton({\r\n            onClick: p.onHelp,\r\n            title: LANG('help'),\r\n            image: helpImg,\r\n            contain: true\r\n        });\r\n\r\n        let leftRightButton = createButton({\r\n            onClick: p.onLeftRight,\r\n            title: LANG('switch-ui-left-right'),\r\n            image: uiSwapImg,\r\n            contain: true\r\n        });\r\n\r\n        div.appendChild(submitButton);\r\n        div.appendChild(leftRightButton);\r\n        div.appendChild(helpButton);\r\n    }\r\n\r\n    getElement() {\r\n        return this.el;\r\n    }\r\n}\r\n","import {filterLib, filterLibStatus} from './filters';\r\nimport {filterBrightnessContrast} from './filter-brightness-contrast';\r\nimport {filterCropExtend} from './filter-crop-extend';\r\nimport {filterCurves} from './filter-curves';\r\nimport {filterFlip} from './filter-flip';\r\nimport {filterHueSaturation} from './filter-hue-saturation';\r\nimport {filterInvert} from './filter-invert';\r\nimport {filterPerspective} from './filter-perspective';\r\nimport {filterResize} from './filter-resize';\r\nimport {filterRotate} from './filter-rotate';\r\nimport {filterTiltShift} from './filter-tilt-shift';\r\nimport {filterTransform} from './filter-transform';\r\nimport {filterBlur} from './filter-blur';\r\nimport {filterUnsharpMask} from './filter-unsharp-mask';\r\nimport {filterToAlpha} from './filter-to-alpha';\r\nimport {filterGrid} from './filter-grid';\r\nimport {filterNoise} from './filter-noise';\r\n\r\nlet embed: boolean;\r\nfunction importFilter(libObj, moduleObj): void {\r\n    if (moduleObj.getDialog) {\r\n        libObj.getDialog = moduleObj.getDialog;\r\n    }\r\n    libObj.apply = moduleObj.apply;\r\n}\r\n\r\n\r\nexport function importFilters(isEmbed?: boolean) {\r\n    if (filterLibStatus.isLoaded) {\r\n        return;\r\n    }\r\n    embed = isEmbed\r\n\r\n    importFilter(filterLib.brightnessContrast, filterBrightnessContrast);\r\n    importFilter(filterLib.cropExtend, filterCropExtend);\r\n    importFilter(filterLib.curves, filterCurves);\r\n    importFilter(filterLib.flip, filterFlip);\r\n    importFilter(filterLib.hueSaturation, filterHueSaturation);\r\n    importFilter(filterLib.invert, filterInvert);\r\n    importFilter(filterLib.perspective, filterPerspective);\r\n    importFilter(filterLib.resize, filterResize);\r\n    importFilter(filterLib.rotate, filterRotate);\r\n    importFilter(filterLib.tiltShift, filterTiltShift);\r\n    importFilter(filterLib.transform, filterTransform);\r\n    importFilter(filterLib.blur, filterBlur);\r\n    importFilter(filterLib.unsharpMask, filterUnsharpMask);\r\n    importFilter(filterLib.toAlpha, filterToAlpha);\r\n    importFilter(filterLib.grid, filterGrid);\r\n    importFilter(filterLib.noise, filterNoise);\r\n\r\n    filterLibStatus.isLoaded = true;\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterBrightnessContrast = {\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n\r\n        function finishInit() {\r\n\r\n            let brightness = 0, contrast = 0;\r\n            div.innerHTML = LANG('filter-bright-contrast-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let brightnessSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-brightness'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (brightness + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brightness = val / 50 - 1;\r\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            let contrastSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-contrast'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (contrast + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    contrast = val / 50 - 1;\r\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            brightnessSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(brightnessSlider.getElement());\r\n            div.appendChild(contrastSlider.getElement());\r\n\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                brightnessSlider.destroy();\r\n                contrastSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    brightness: brightness,\r\n                    contrast: contrast\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let brightness = params.input.brightness;\r\n        let contrast = params.input.contrast;\r\n        let history = params.history;\r\n        if (!context || brightness === null || contrast === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"brightnessContrast\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n\r\n        return true;\r\n    }\r\n}","\r\nexport const eventResMs = 60;","import {fx} from '../../../script-vendor/glfx';\r\n\r\nlet fxCanvas = null\r\ntry {\r\n    fxCanvas = fx.canvas();\r\n} catch (e) {\r\n}\r\n\r\nexport function getSharedFx() {\r\n    if (!fxCanvas || fxCanvas._.gl.isContextLost()) {\r\n        try {\r\n            fxCanvas = fx.canvas();\r\n        } catch (e) {\r\n        }\r\n    }\r\n    return fxCanvas;\r\n}","\r\n// @ts-ignore\r\nimport shaderNoise from './shader-noise.glsl';\r\n\r\n/*\r\n * glfx.script\r\n * http://evanw.github.com/glfx.js/\r\n *\r\n * Copyright 2011 Evan Wallace\r\n * Released under the MIT license\r\n *\r\n * modifications by bitbof\r\n */\r\nexport const fx = (function () {\r\n    let exports: any = {};\r\n\r\n// src/OES_texture_float_linear-polyfill.script\r\n// From: https://github.com/evanw/OES_texture_float_linear-polyfill\r\n    (function () {\r\n        // Uploads a 2x2 floating-point texture where one pixel is 2 and the other\r\n        // three pixels are 0. Linear filtering is only supported if a sample taken\r\n        // from the center of that texture is (2 + 0 + 0 + 0) / 4 = 0.5.\r\n        function supportsOESTextureFloatLinear(gl) {\r\n            // Need floating point textures in the first place\r\n            if (!gl.getExtension('OES_texture_float')) {\r\n                return false;\r\n            }\r\n\r\n            // Create a render target\r\n            let framebuffer = gl.createFramebuffer();\r\n            let byteTexture = gl.createTexture();\r\n            gl.bindTexture(gl.TEXTURE_2D, byteTexture);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, byteTexture, 0);\r\n\r\n            // Create a simple floating-point texture with value of 0.5 in the center\r\n            let rgba = [\r\n                2, 0, 0, 0,\r\n                0, 0, 0, 0,\r\n                0, 0, 0, 0,\r\n                0, 0, 0, 0\r\n            ];\r\n            let floatTexture = gl.createTexture();\r\n            gl.bindTexture(gl.TEXTURE_2D, floatTexture);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, gl.FLOAT, new Float32Array(rgba));\r\n\r\n            // Create the test shader\r\n            let program = gl.createProgram();\r\n            let vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n            let fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n            gl.shaderSource(vertexShader, '\\\r\n      attribute vec2 vertex;\\\r\n      void main() {\\\r\n        gl_Position = vec4(vertex, 0.0, 1.0);\\\r\n      }\\\r\n    ');\r\n            gl.shaderSource(fragmentShader, '\\\r\n      uniform sampler2D texture;\\\r\n      void main() {\\\r\n        gl_FragColor = texture2D(texture, vec2(0.5));\\\r\n      }\\\r\n    ');\r\n            gl.compileShader(vertexShader);\r\n            gl.compileShader(fragmentShader);\r\n            gl.attachShader(program, vertexShader);\r\n            gl.attachShader(program, fragmentShader);\r\n            gl.linkProgram(program);\r\n\r\n            // Create a buffer containing a single point\r\n            let buffer = gl.createBuffer();\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0]), gl.STREAM_DRAW);\r\n            gl.enableVertexAttribArray(0);\r\n            gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\r\n\r\n            // Render the point and read back the rendered pixel\r\n            let pixel = new Uint8Array(4);\r\n            gl.useProgram(program);\r\n            gl.viewport(0, 0, 1, 1);\r\n            gl.bindTexture(gl.TEXTURE_2D, floatTexture);\r\n            gl.drawArrays(gl.POINTS, 0, 1);\r\n            gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixel);\r\n\r\n            // The center sample will only have a value of 0.5 if linear filtering works\r\n            return pixel[0] === 127 || pixel[0] === 128;\r\n        }\r\n\r\n        // The constructor for the returned extension object\r\n        function OESTextureFloatLinear() {\r\n        }\r\n\r\n        // Cache the extension so it's specific to each context like extensions should be\r\n        function getOESTextureFloatLinear(gl) {\r\n            if (gl.$OES_texture_float_linear$ === void 0) {\r\n                Object.defineProperty(gl, '$OES_texture_float_linear$', {\r\n                    enumerable: false,\r\n                    configurable: false,\r\n                    writable: false,\r\n                    value: new OESTextureFloatLinear()\r\n                });\r\n            }\r\n            return gl.$OES_texture_float_linear$;\r\n        }\r\n\r\n        // This replaces the real getExtension()\r\n        function getExtension(name) {\r\n            return name === 'OES_texture_float_linear'\r\n                ? getOESTextureFloatLinear(this)\r\n                : oldGetExtension.call(this, name);\r\n        }\r\n\r\n        // This replaces the real getSupportedExtensions()\r\n        function getSupportedExtensions() {\r\n            let extensions = oldGetSupportedExtensions.call(this);\r\n            if (extensions.indexOf('OES_texture_float_linear') === -1) {\r\n                extensions.push('OES_texture_float_linear');\r\n            }\r\n            return extensions;\r\n        }\r\n\r\n        // Get a WebGL context\r\n        try {\r\n            let gl = document.createElement('canvas').getContext('experimental-webgl');\r\n        } catch (e) {\r\n        }\r\n\r\n        // Don't install the polyfill if the browser already supports it or doesn't have WebGL\r\n        if (!gl || (gl as any).getSupportedExtensions().indexOf('OES_texture_float_linear') !== -1) {\r\n            return;\r\n        }\r\n\r\n        // Install the polyfill if linear filtering works with floating-point textures\r\n        let oldGetExtension;\r\n        let oldGetSupportedExtensions;\r\n        if (supportsOESTextureFloatLinear(gl)) {\r\n            oldGetExtension = WebGLRenderingContext.prototype.getExtension;\r\n            oldGetSupportedExtensions = WebGLRenderingContext.prototype.getSupportedExtensions;\r\n            WebGLRenderingContext.prototype.getExtension = getExtension;\r\n            WebGLRenderingContext.prototype.getSupportedExtensions = getSupportedExtensions;\r\n        }\r\n    }());\r\n\r\n// src/core\\canvas.script\r\n    var gl;\r\n\r\n    function clamp(lo, value, hi) {\r\n        return Math.max(lo, Math.min(value, hi));\r\n    }\r\n\r\n    function wrapTexture(texture) {\r\n        return {\r\n            _: texture,\r\n            loadContentsOf: function (element) {\r\n                // Make sure that we're using the correct global WebGL context\r\n                gl = this._.gl;\r\n                this._.loadContentsOf(element);\r\n            },\r\n            destroy: function () {\r\n                // Make sure that we're using the correct global WebGL context\r\n                gl = this._.gl;\r\n                this._.destroy();\r\n            }\r\n        };\r\n    }\r\n\r\n    function texture(element) {\r\n        return wrapTexture(Texture.fromElement(element));\r\n    }\r\n\r\n    function initialize(width, height) {\r\n        let type = gl.UNSIGNED_BYTE;\r\n\r\n        // Go for floating point buffer textures if we can, it'll make the bokeh\r\n        // filter look a lot better. Note that on Windows, ANGLE does not let you\r\n        // render to a floating-point texture when linear filtering is enabled.\r\n        // See http://crbug.com/172278 for more information.\r\n        if (gl.getExtension('OES_texture_float') && gl.getExtension('OES_texture_float_linear')) {\r\n            let testTexture = new Texture(100, 100, gl.RGBA, gl.FLOAT);\r\n            try {\r\n                // Only use gl.FLOAT if we can render to it\r\n                testTexture.drawTo(function () {\r\n                    type = gl.FLOAT;\r\n                });\r\n            } catch (e) {\r\n            }\r\n            testTexture.destroy();\r\n        }\r\n\r\n        if (this._.texture) this._.texture.destroy();\r\n        if (this._.spareTexture) this._.spareTexture.destroy();\r\n        this.width = width;\r\n        this.height = height;\r\n        this._.texture = new Texture(width, height, gl.RGBA, type);\r\n        this._.spareTexture = new Texture(width, height, gl.RGBA, type);\r\n        this._.extraTexture = this._.extraTexture || new Texture(0, 0, gl.RGBA, type);\r\n        this._.flippedShader = this._.flippedShader || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\\\r\n        }\\\r\n    ', 'flippedShader');\r\n        this._.isInitialized = true;\r\n    }\r\n\r\n    /*\r\n       Draw a texture to the canvas, with an optional width and height to scale to.\r\n       If no width and height are given then the original texture width and height\r\n       are used.\r\n    */\r\n    function draw(texture, width, height) {\r\n        if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\r\n            initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\r\n        }\r\n\r\n        texture._.use();\r\n        this._.texture.drawTo(function () {\r\n            Shader.getDefaultShader().drawRect();\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    function update() {\r\n        this._.texture.use();\r\n        this._.flippedShader.drawRect();\r\n        return this;\r\n    }\r\n\r\n    function simpleShader(shader, uniforms, textureIn, textureOut) {\r\n        (textureIn || this._.texture).use();\r\n        this._.spareTexture.drawTo(function () {\r\n            shader.uniforms(uniforms).drawRect();\r\n        });\r\n        this._.spareTexture.swapWith(textureOut || this._.texture);\r\n    }\r\n\r\n    function replace(node) {\r\n        node.parentNode.insertBefore(this, node);\r\n        node.parentNode.removeChild(node);\r\n        return this;\r\n    }\r\n\r\n    function contents() {\r\n        let texture = new Texture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\r\n        this._.texture.use();\r\n        texture.drawTo(function () {\r\n            Shader.getDefaultShader().drawRect();\r\n        });\r\n        return wrapTexture(texture);\r\n    }\r\n\r\n    /*\r\n       Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\r\n       Length of the array will be width * height * 4.\r\n    */\r\n    function getPixelArray() {\r\n        let w = this._.texture.width;\r\n        let h = this._.texture.height;\r\n        let array = new Uint8Array(w * h * 4);\r\n        this._.texture.drawTo(function () {\r\n            gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\r\n        });\r\n        return array;\r\n    }\r\n\r\n    function wrap(func) {\r\n        return function () {\r\n            // Make sure that we're using the correct global WebGL context\r\n            gl = this._.gl;\r\n\r\n            // Now that the context has been switched, we can call the wrapped function\r\n            return func.apply(this, arguments);\r\n        };\r\n    }\r\n\r\n    exports.canvas = function () {\r\n        let canvas: any = document.createElement('canvas');\r\n        try {\r\n            gl = canvas.getContext('experimental-webgl', {premultipliedAlpha: false});\r\n        } catch (e) {\r\n            gl = null;\r\n        }\r\n        if (!gl) {\r\n            throw 'This browser does not support WebGL';\r\n        }\r\n        canvas._ = {\r\n            gl: gl,\r\n            isInitialized: false,\r\n            texture: null,\r\n            spareTexture: null,\r\n            flippedShader: null\r\n        };\r\n\r\n        // Core methods\r\n        canvas.texture = wrap(texture);\r\n        canvas.draw = wrap(draw);\r\n        canvas.update = wrap(update);\r\n        canvas.replace = wrap(replace);\r\n        canvas.contents = wrap(contents);\r\n        canvas.getPixelArray = wrap(getPixelArray);\r\n\r\n        // Filter methods\r\n        canvas.brightnessContrast = wrap(brightnessContrast);\r\n        canvas.hexagonalPixelate = wrap(hexagonalPixelate);\r\n        canvas.hueSaturation = wrap(hueSaturation);\r\n        canvas.colorHalftone = wrap(colorHalftone);\r\n        canvas.triangleBlur = wrap(triangleBlur);\r\n        canvas.unsharpMask = wrap(unsharpMask);\r\n        canvas.perspective = wrap(perspective);\r\n        canvas.matrixWarp = wrap(matrixWarp);\r\n        canvas.bulgePinch = wrap(bulgePinch);\r\n        canvas.tiltShift = wrap(tiltShift);\r\n        canvas.dotScreen = wrap(dotScreen);\r\n        canvas.edgeWork = wrap(edgeWork);\r\n        canvas.lensBlur = wrap(lensBlur);\r\n        canvas.zoomBlur = wrap(zoomBlur);\r\n        canvas.noise = wrap(noise);\r\n        canvas.denoise = wrap(denoise);\r\n        canvas.curves = wrap(curves);\r\n        canvas.swirl = wrap(swirl);\r\n        canvas.ink = wrap(ink);\r\n        canvas.vignette = wrap(vignette);\r\n        canvas.vibrance = wrap(vibrance);\r\n        canvas.sepia = wrap(sepia);\r\n        canvas.invert = wrap(invert);\r\n        canvas.toAlpha = wrap(toAlpha);\r\n\r\n        return canvas;\r\n    };\r\n    exports.splineInterpolate = splineInterpolate;\r\n\r\n// src/core\\matrix.script\r\n// from javax.media.jai.PerspectiveTransform\r\n\r\n    function getSquareToQuad(x0, y0, x1, y1, x2, y2, x3, y3) {\r\n        let dx1 = x1 - x2;\r\n        let dy1 = y1 - y2;\r\n        let dx2 = x3 - x2;\r\n        let dy2 = y3 - y2;\r\n        let dx3 = x0 - x1 + x2 - x3;\r\n        let dy3 = y0 - y1 + y2 - y3;\r\n        let det = dx1 * dy2 - dx2 * dy1;\r\n        let a = (dx3 * dy2 - dx2 * dy3) / det;\r\n        let b = (dx1 * dy3 - dx3 * dy1) / det;\r\n        return [\r\n            x1 - x0 + a * x1, y1 - y0 + a * y1, a,\r\n            x3 - x0 + b * x3, y3 - y0 + b * y3, b,\r\n            x0, y0, 1\r\n        ];\r\n    }\r\n\r\n    function getInverse(m) {\r\n        let a = m[0], b = m[1], c = m[2];\r\n        let d = m[3], e = m[4], f = m[5];\r\n        let g = m[6], h = m[7], i = m[8];\r\n        let det = a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\r\n        return [\r\n            (e * i - f * h) / det, (c * h - b * i) / det, (b * f - c * e) / det,\r\n            (f * g - d * i) / det, (a * i - c * g) / det, (c * d - a * f) / det,\r\n            (d * h - e * g) / det, (b * g - a * h) / det, (a * e - b * d) / det\r\n        ];\r\n    }\r\n\r\n    function multiply(a, b) {\r\n        return [\r\n            a[0] * b[0] + a[1] * b[3] + a[2] * b[6],\r\n            a[0] * b[1] + a[1] * b[4] + a[2] * b[7],\r\n            a[0] * b[2] + a[1] * b[5] + a[2] * b[8],\r\n            a[3] * b[0] + a[4] * b[3] + a[5] * b[6],\r\n            a[3] * b[1] + a[4] * b[4] + a[5] * b[7],\r\n            a[3] * b[2] + a[4] * b[5] + a[5] * b[8],\r\n            a[6] * b[0] + a[7] * b[3] + a[8] * b[6],\r\n            a[6] * b[1] + a[7] * b[4] + a[8] * b[7],\r\n            a[6] * b[2] + a[7] * b[5] + a[8] * b[8]\r\n        ];\r\n    }\r\n\r\n// src/core\\shader.script\r\n    var Shader = (function () {\r\n        function isArray(obj) {\r\n            return Object.prototype.toString.call(obj) == '[object Array]';\r\n        }\r\n\r\n        function isNumber(obj) {\r\n            return Object.prototype.toString.call(obj) == '[object Number]';\r\n        }\r\n\r\n        function compileSource(type, source, nameStr) {\r\n            let shader = gl.createShader(type);\r\n            gl.shaderSource(shader, source.replace(/#define.*/, '')); // glslify adds a line add the beginning that breaks it\r\n            gl.compileShader(shader);\r\n            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n                throw 'compile error: ' + nameStr + ' - ' + gl.getShaderInfoLog(shader);\r\n            }\r\n            return shader;\r\n        }\r\n\r\n        let defaultVertexSource = '\\\r\n    attribute vec2 vertex;\\\r\n    attribute vec2 _texCoord;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        texCoord = _texCoord;\\\r\n        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\r\n    }';\r\n\r\n        let defaultFragmentSource = '\\\r\n    uniform sampler2D texture;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        gl_FragColor = texture2D(texture, texCoord);\\\r\n    }';\r\n\r\n        // added test 2020-04-27 bitbof\r\n        let floatPrecision = null;\r\n\r\n        function testPrecisionSupport(precisionType) {\r\n            let format = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, precisionType);\r\n            return format !== null && format.precision !== 0;\r\n        }\r\n\r\n        function Shader(vertexSource?, fragmentSource?, nameStr?) {\r\n            this.vertexAttribute = null;\r\n            this.texCoordAttribute = null;\r\n            this.program = gl.createProgram();\r\n            vertexSource = vertexSource || defaultVertexSource;\r\n            fragmentSource = fragmentSource || defaultFragmentSource;\r\n            if (floatPrecision === null) {\r\n                floatPrecision = testPrecisionSupport(gl.HIGH_FLOAT) ? 'highp' : (testPrecisionSupport(gl.MEDIUM_FLOAT) ? 'mediump' : 'lowp');\r\n            }\r\n            fragmentSource = 'precision ' + floatPrecision + ' float;' + fragmentSource; // annoying requirement is annoying\r\n            gl.attachShader(this.program, compileSource(gl.VERTEX_SHADER, vertexSource, nameStr + '(vertex)'));\r\n            gl.attachShader(this.program, compileSource(gl.FRAGMENT_SHADER, fragmentSource, nameStr + '(fragment)'));\r\n            gl.linkProgram(this.program);\r\n            if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\r\n                throw 'link error: ' + gl.getProgramInfoLog(this.program);\r\n            }\r\n        }\r\n\r\n        Shader.prototype.destroy = function () {\r\n            gl.deleteProgram(this.program);\r\n            this.program = null;\r\n        };\r\n\r\n        Shader.prototype.uniforms = function (uniforms) {\r\n            gl.useProgram(this.program);\r\n            for (var name in uniforms) {\r\n                if (!uniforms.hasOwnProperty(name)) continue;\r\n                let location = gl.getUniformLocation(this.program, name);\r\n                if (location === null) continue; // will be null if the uniform isn't used in the shader\r\n                let value = uniforms[name];\r\n                if (isArray(value)) {\r\n                    switch (value.length) {\r\n                        case 1:\r\n                            gl.uniform1fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 2:\r\n                            gl.uniform2fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 3:\r\n                            gl.uniform3fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 4:\r\n                            gl.uniform4fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 9:\r\n                            gl.uniformMatrix3fv(location, false, new Float32Array(value));\r\n                            break;\r\n                        case 16:\r\n                            gl.uniformMatrix4fv(location, false, new Float32Array(value));\r\n                            break;\r\n                        default:\r\n                            throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\r\n                    }\r\n                } else if (isNumber(value)) {\r\n                    gl.uniform1f(location, value);\r\n                } else {\r\n                    throw 'attempted to set uniform \"' + name + '\" to invalid value ' + (value || 'undefined').toString();\r\n                }\r\n            }\r\n            // allow chaining\r\n            return this;\r\n        };\r\n\r\n        // textures are uniforms too but for some reason can't be specified by gl.uniform1f,\r\n        // even though floating point numbers represent the integers 0 through 7 exactly\r\n        Shader.prototype.textures = function (textures) {\r\n            gl.useProgram(this.program);\r\n            for (var name in textures) {\r\n                if (!textures.hasOwnProperty(name)) continue;\r\n                gl.uniform1i(gl.getUniformLocation(this.program, name), textures[name]);\r\n            }\r\n            // allow chaining\r\n            return this;\r\n        };\r\n\r\n        Shader.prototype.drawRect = function (left, top, right, bottom) {\r\n            let undefined;\r\n            let viewport = gl.getParameter(gl.VIEWPORT);\r\n            top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\r\n            left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\r\n            right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\r\n            bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\r\n            if (gl.vertexBuffer == null) {\r\n                gl.vertexBuffer = gl.createBuffer();\r\n            }\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([left, top, left, bottom, right, top, right, bottom]), gl.STATIC_DRAW);\r\n            if (gl.texCoordBuffer == null) {\r\n                gl.texCoordBuffer = gl.createBuffer();\r\n                gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n                gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\r\n            }\r\n            if (this.vertexAttribute == null) {\r\n                this.vertexAttribute = gl.getAttribLocation(this.program, 'vertex');\r\n                gl.enableVertexAttribArray(this.vertexAttribute);\r\n            }\r\n            if (this.texCoordAttribute == null) {\r\n                this.texCoordAttribute = gl.getAttribLocation(this.program, '_texCoord');\r\n                gl.enableVertexAttribArray(this.texCoordAttribute);\r\n            }\r\n            gl.useProgram(this.program);\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n            gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n            gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\r\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n        };\r\n\r\n        Shader.getDefaultShader = function () {\r\n            gl.defaultShader = gl.defaultShader || new Shader();\r\n            return gl.defaultShader;\r\n        };\r\n\r\n        return Shader;\r\n    })();\r\n\r\n// src/core\\spline.script\r\n// from SplineInterpolator.cs in the Paint.NET source code\r\n\r\n    function SplineInterpolator(points) {\r\n        let n = points.length;\r\n        this.xa = [];\r\n        this.ya = [];\r\n        this.u = [];\r\n        this.y2 = [];\r\n\r\n        points.sort(function (a, b) {\r\n            return a[0] - b[0];\r\n        });\r\n        for (var i = 0; i < n; i++) {\r\n            this.xa.push(points[i][0]);\r\n            this.ya.push(points[i][1]);\r\n        }\r\n\r\n        this.u[0] = 0;\r\n        this.y2[0] = 0;\r\n\r\n        for (var i = 1; i < n - 1; ++i) {\r\n            // This is the decomposition loop of the tridiagonal algorithm.\r\n            // y2 and u are used for temporary storage of the decomposed factors.\r\n            let wx = this.xa[i + 1] - this.xa[i - 1];\r\n            let sig = (this.xa[i] - this.xa[i - 1]) / wx;\r\n            let p = sig * this.y2[i - 1] + 2.0;\r\n\r\n            this.y2[i] = (sig - 1.0) / p;\r\n\r\n            let ddydx =\r\n                (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\r\n                (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\r\n\r\n            this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\r\n        }\r\n\r\n        this.y2[n - 1] = 0;\r\n\r\n        // This is the backsubstitution loop of the tridiagonal algorithm\r\n        for (var i = n - 2; i >= 0; --i) {\r\n            this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\r\n        }\r\n    }\r\n\r\n    SplineInterpolator.prototype.interpolate = function (x) {\r\n        let n = this.ya.length;\r\n        let klo = 0;\r\n        let khi = n - 1;\r\n\r\n        // We will find the right place in the table by means of\r\n        // bisection. This is optimal if sequential calls to this\r\n        // routine are at random values of x. If sequential calls\r\n        // are in order, and closely spaced, one would do better\r\n        // to store previous values of klo and khi.\r\n        while (khi - klo > 1) {\r\n            let k = (khi + klo) >> 1;\r\n\r\n            if (this.xa[k] > x) {\r\n                khi = k;\r\n            } else {\r\n                klo = k;\r\n            }\r\n        }\r\n\r\n        let h = this.xa[khi] - this.xa[klo];\r\n        let a = (this.xa[khi] - x) / h;\r\n        let b = (x - this.xa[klo]) / h;\r\n\r\n        // Cubic spline polynomial is now evaluated.\r\n        return a * this.ya[klo] + b * this.ya[khi] +\r\n            ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\r\n    };\r\n\r\n// src/core\\texture.script\r\n    var Texture = (function () {\r\n        Texture.fromElement = function (element) {\r\n            let texture = new Texture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\r\n            texture.loadContentsOf(element);\r\n            return texture;\r\n        };\r\n\r\n        function Texture(width, height, format, type) {\r\n            this.gl = gl;\r\n            this.id = gl.createTexture();\r\n            this.width = width;\r\n            this.height = height;\r\n            this.format = format;\r\n            this.type = type;\r\n\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            if (width && height) gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n        }\r\n\r\n        Texture.prototype.loadContentsOf = function (element) {\r\n            this.width = element.width || element.videoWidth;\r\n            this.height = element.height || element.videoHeight;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\r\n        };\r\n\r\n        Texture.prototype.initFromBytes = function (width, height, data) {\r\n            this.width = width;\r\n            this.height = height;\r\n            this.format = gl.RGBA;\r\n            this.type = gl.UNSIGNED_BYTE;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\r\n        };\r\n\r\n        Texture.prototype.destroy = function () {\r\n            gl.deleteTexture(this.id);\r\n            this.id = null;\r\n        };\r\n\r\n        Texture.prototype.use = function (unit) {\r\n            gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        };\r\n\r\n        Texture.prototype.unuse = function (unit) {\r\n            gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n            gl.bindTexture(gl.TEXTURE_2D, null);\r\n        };\r\n\r\n        Texture.prototype.ensureFormat = function (width, height, format, type) {\r\n            // allow passing an existing texture instead of individual arguments\r\n            if (arguments.length == 1) {\r\n                let texture = arguments[0];\r\n                width = texture.width;\r\n                height = texture.height;\r\n                format = texture.format;\r\n                type = texture.type;\r\n            }\r\n\r\n            // change the format only if required\r\n            if (width != this.width || height != this.height || format != this.format || type != this.type) {\r\n                this.width = width;\r\n                this.height = height;\r\n                this.format = format;\r\n                this.type = type;\r\n                gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n                gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n            }\r\n        };\r\n\r\n        Texture.prototype.drawTo = function (callback) {\r\n            // start rendering to this texture\r\n            gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\r\n            if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\r\n                throw new Error('incomplete framebuffer');\r\n            }\r\n            gl.viewport(0, 0, this.width, this.height);\r\n\r\n            // do the drawing\r\n            callback();\r\n\r\n            // stop rendering to this texture\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n        };\r\n\r\n        let canvas = null;\r\n\r\n        function getCanvas(texture) {\r\n            if (canvas == null) canvas = document.createElement('canvas');\r\n            canvas.width = texture.width;\r\n            canvas.height = texture.height;\r\n            let c = canvas.getContext('2d');\r\n            c.clearRect(0, 0, canvas.width, canvas.height);\r\n            return c;\r\n        }\r\n\r\n        Texture.prototype.fillUsingCanvas = function (callback) {\r\n            callback(getCanvas(this));\r\n            this.format = gl.RGBA;\r\n            this.type = gl.UNSIGNED_BYTE;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, canvas);\r\n            return this;\r\n        };\r\n\r\n        Texture.prototype.toImage = function (image) {\r\n            this.use();\r\n            Shader.getDefaultShader().drawRect();\r\n            let size = this.width * this.height * 4;\r\n            let pixels = new Uint8Array(size);\r\n            let c = getCanvas(this);\r\n            let data = c.createImageData(this.width, this.height);\r\n            gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n            for (var i = 0; i < size; i++) {\r\n                data.data[i] = pixels[i];\r\n            }\r\n            c.putImageData(data, 0, 0);\r\n            image.src = canvas.toDataURL();\r\n        };\r\n\r\n        Texture.prototype.swapWith = function (other) {\r\n            let temp;\r\n            temp = other.id;\r\n            other.id = this.id;\r\n            this.id = temp;\r\n            temp = other.width;\r\n            other.width = this.width;\r\n            this.width = temp;\r\n            temp = other.height;\r\n            other.height = this.height;\r\n            this.height = temp;\r\n            temp = other.format;\r\n            other.format = this.format;\r\n            this.format = temp;\r\n        };\r\n\r\n        return Texture;\r\n    })();\r\n\r\n// src/filters\\common.script\r\n    function warpShader(uniforms, warp) {\r\n        return new Shader(null, uniforms + '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        vec2 coord = texCoord * texSize;\\\r\n        ' + warp + '\\\r\n        gl_FragColor = texture2D(texture, coord / texSize);\\\r\n        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\r\n        if (coord != clampedCoord) {\\\r\n            /* fade to transparent if we are outside the image */\\\r\n            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\r\n        }\\\r\n    }', 'warp');\r\n    }\r\n\r\n// returns a random number between 0 and 1\r\n    var randomShaderFunc = '\\\r\n    float random(vec3 scale, float seed) {\\\r\n        /* use the fragment position for a different seed per-pixel */\\\r\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\r\n    }\\\r\n';\r\n\r\n// src/filters\\adjust\\brightnesscontrast.script\r\n    /**\r\n     * @filter           Brightness / Contrast\r\n     * @description      Provides additive brightness and multiplicative contrast control.\r\n     * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\r\n     * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n     */\r\n    function brightnessContrast(brightness, contrast) {\r\n        gl.brightnessContrast = gl.brightnessContrast || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float brightness;\\\r\n        uniform float contrast;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.rgb += brightness;\\\r\n            if (contrast > 0.0) {\\\r\n                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\r\n            } else {\\\r\n                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\r\n            }\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'brightnessContrast');\r\n\r\n        simpleShader.call(this, gl.brightnessContrast, {\r\n            brightness: clamp(-1, brightness, 1),\r\n            contrast: clamp(-1, contrast, 1)\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\curves.script\r\n    function splineInterpolate(points) {\r\n        let interpolator = new SplineInterpolator(points);\r\n        let array = [];\r\n        for (var i = 0; i < 256; i++) {\r\n            array.push(clamp(0, Math.floor(interpolator.interpolate(i / 255) * 256), 255));\r\n        }\r\n        return array;\r\n    }\r\n\r\n    /**\r\n     * @filter      Curves\r\n     * @description A powerful mapping tool that transforms the colors in the image\r\n     *              by an arbitrary function. The function is interpolated between\r\n     *              a set of 2D points using splines. The curves filter can take\r\n     *              either one or three arguments which will apply the mapping to\r\n     *              either luminance or RGB values, respectively.\r\n     * @param red   A list of points that define the function for the red channel.\r\n     *              Each point is a list of two values: the value before the mapping\r\n     *              and the value after the mapping, both in the range 0 to 1. For\r\n     *              example, [[0,1], [1,0]] would invert the red channel while\r\n     *              [[0,0], [1,1]] would leave the red channel unchanged. If green\r\n     *              and blue are omitted then this argument also applies to the\r\n     *              green and blue channels.\r\n     * @param green (optional) A list of points that define the function for the green\r\n     *              channel (just like for red).\r\n     * @param blue  (optional) A list of points that define the function for the blue\r\n     *              channel (just like for red).\r\n     */\r\n    function curves(red, green, blue) {\r\n        // Create the ramp texture\r\n        red = splineInterpolate(red);\r\n        if (arguments.length == 1) {\r\n            green = blue = red;\r\n        } else {\r\n            green = splineInterpolate(green);\r\n            blue = splineInterpolate(blue);\r\n        }\r\n        let array = [];\r\n        for (var i = 0; i < 256; i++) {\r\n            array.splice(array.length, 0, red[i], green[i], blue[i], 255);\r\n        }\r\n        this._.extraTexture.initFromBytes(256, 1, array);\r\n        this._.extraTexture.use(1);\r\n\r\n        gl.curves = gl.curves || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform sampler2D map;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.r = texture2D(map, vec2(color.r)).r;\\\r\n            color.g = texture2D(map, vec2(color.g)).g;\\\r\n            color.b = texture2D(map, vec2(color.b)).b;\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'curves');\r\n\r\n        gl.curves.textures({\r\n            map: 1\r\n        });\r\n        simpleShader.call(this, gl.curves, {});\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\denoise.script\r\n    /**\r\n     * @filter         Denoise\r\n     * @description    Smooths over grainy noise in dark images using an 9x9 box filter\r\n     *                 weighted by color intensity, similar to a bilateral filter.\r\n     * @param exponent The exponent of the color intensity difference, should be greater\r\n     *                 than zero. A value of zero just gives an 9x9 box blur and high values\r\n     *                 give the original image, but ideal values are usually around 10-20.\r\n     */\r\n    function denoise(exponent) {\r\n        // Do a 9x9 bilateral box filter\r\n        gl.denoise = gl.denoise || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float exponent;\\\r\n        uniform float strength;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 center = texture2D(texture, texCoord);\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            for (float x = -4.0; x <= 4.0; x += 1.0) {\\\r\n                for (float y = -4.0; y <= 4.0; y += 1.0) {\\\r\n                    vec4 sample = texture2D(texture, texCoord + vec2(x, y) / texSize);\\\r\n                    float weight = 1.0 - abs(dot(sample.rgb - center.rgb, vec3(0.25)));\\\r\n                    weight = pow(weight, exponent);\\\r\n                    color += sample * weight;\\\r\n                    total += weight;\\\r\n                }\\\r\n            }\\\r\n            gl_FragColor = color / total;\\\r\n        }\\\r\n    ', 'denoise');\r\n\r\n        // Perform two iterations for stronger results\r\n        for (var i = 0; i < 2; i++) {\r\n            simpleShader.call(this, gl.denoise, {\r\n                exponent: Math.max(0, exponent),\r\n                texSize: [this.width, this.height]\r\n            });\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\huesaturation.script\r\n    /**\r\n     * @filter           Hue / Saturation\r\n     * @description      Provides rotational hue and multiplicative saturation control. RGB color space\r\n     *                   can be imagined as a cube where the axes are the red, green, and blue color\r\n     *                   values. Hue changing works by rotating the color vector around the grayscale\r\n     *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\r\n     *                   Saturation is implemented by scaling all color channel values either toward\r\n     *                   or away from the average color channel value.\r\n     * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\r\n     *                   and 1 is 180 degree rotation in the positive direction)\r\n     * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n     */\r\n    function hueSaturation(hue, saturation) {\r\n        gl.hueSaturation = gl.hueSaturation || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float hue;\\\r\n        uniform float saturation;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\r\n            float angle = hue * 3.14159265;\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\r\n            float len = length(color.rgb);\\\r\n            color.rgb = vec3(\\\r\n                dot(color.rgb, weights.xyz),\\\r\n                dot(color.rgb, weights.zxy),\\\r\n                dot(color.rgb, weights.yzx)\\\r\n            );\\\r\n            \\\r\n            /* saturation adjustment */\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            if (saturation > 0.0) {\\\r\n                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\r\n            } else {\\\r\n                color.rgb += (average - color.rgb) * (-saturation);\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'hueSaturation');\r\n\r\n        simpleShader.call(this, gl.hueSaturation, {\r\n            hue: clamp(-1, hue, 1),\r\n            saturation: clamp(-1, saturation, 1)\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\noise.script\r\n    /**\r\n     * @filter         Noise\r\n     * @description    draws noise, completely replaces original image\r\n     * @param seed\r\n     * @param type\r\n     * @param scale\r\n     * @param offset\r\n     * @param angleDeg\r\n     * @param octaves\r\n     * @param isMonochrome\r\n     * @param samples\r\n     * @param peaks\r\n     * @param brightness\r\n     * @param contrast\r\n     * @param doInvert\r\n     * @param colA\r\n     * @param colB\r\n     * @param channels\r\n     */\r\n    function noise(\r\n        seed: number, // float, any value okay\r\n        type: number, // 1 value, 2 simplex, 3 cellular\r\n        scale: [number, number], // float, small scale will show repeating patterns\r\n        offset: [number, number], // offset x, y - large offsets will show repeating patterns\r\n        octaves: number, // int 0 - 4\r\n        samples: number, // 1 | 4 | 8 -> super-sampling\r\n        peaks: number, // how often it will ramp *additionally* from 0 to 1\r\n        brightness: number, // range [-1, 1]\r\n        contrast: number, // range [-1, 1]\r\n        doInvert: boolean, // invert 0-1 range, will not invert colA, colB\r\n        colA: {r: number, g: number, b: number}, // which color at 0, if rgb\r\n        colB: {r: number, g: number, b: number}, // which color at 1, if rgb\r\n        channels: 'rgb' | 'alpha', // which channel to target\r\n    ) {\r\n        gl.noise = gl.noise || new Shader(null, shaderNoise.replace(/#define.*/, ''), 'noise');\r\n        simpleShader.call(this, gl.noise, {\r\n            seed,\r\n            type,\r\n            scale: [scale[0], scale[1]],\r\n            offset,\r\n            octaves,\r\n            samples,\r\n            texSize: [this.width, this.height],\r\n            peaks,\r\n            brightness,\r\n            contrast,\r\n            doInvert: doInvert ? 1.0 : 0.0,\r\n            colA: colA ? [colA.r / 255, colA.g / 255, colA.b / 255] : [0, 0, 0],\r\n            colB: colB ? [colB.r / 255, colB.g / 255, colB.b / 255] : [1, 1, 1],\r\n            channels: channels === 'rgb' ? 0 : 1,\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\sepia.script\r\n    /**\r\n     * @filter         Sepia\r\n     * @description    Gives the image a reddish-brown monochrome tint that imitates an old photograph.\r\n     * @param amount   0 to 1 (0 for no effect, 1 for full sepia coloring)\r\n     */\r\n    function sepia(amount) {\r\n        gl.sepia = gl.sepia || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float r = color.r;\\\r\n            float g = color.g;\\\r\n            float b = color.b;\\\r\n            \\\r\n            color.r = min(1.0, (r * (1.0 - (0.607 * amount))) + (g * (0.769 * amount)) + (b * (0.189 * amount)));\\\r\n            color.g = min(1.0, (r * 0.349 * amount) + (g * (1.0 - (0.314 * amount))) + (b * 0.168 * amount));\\\r\n            color.b = min(1.0, (r * 0.272 * amount) + (g * 0.534 * amount) + (b * (1.0 - (0.869 * amount))));\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'sepia');\r\n\r\n        simpleShader.call(this, gl.sepia, {\r\n            amount: clamp(0, amount, 1)\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\unsharpmask.script\r\n    /**\r\n     * @filter         Unsharp Mask\r\n     * @description    A form of image sharpening that amplifies high-frequencies in the image. It\r\n     *                 is implemented by scaling pixels away from the average of their neighbors.\r\n     * @param radius   The blur radius that calculates the average of the neighboring pixels.\r\n     * @param strength A scale factor where 0 is no effect and higher values cause a stronger effect.\r\n     */\r\n    function unsharpMask(radius, strength) {\r\n        gl.unsharpMask = gl.unsharpMask || new Shader(null, '\\\r\n        uniform sampler2D blurredTexture;\\\r\n        uniform sampler2D originalTexture;\\\r\n        uniform float strength;\\\r\n        uniform float threshold;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 blurred = texture2D(blurredTexture, texCoord);\\\r\n            vec4 original = texture2D(originalTexture, texCoord);\\\r\n            gl_FragColor = mix(blurred, original, 1.0 + strength);\\\r\n        }\\\r\n    ', 'unsharpMask');\r\n\r\n        // Store a copy of the current texture in the second texture unit\r\n        this._.extraTexture.ensureFormat(this._.texture);\r\n        this._.texture.use();\r\n        this._.extraTexture.drawTo(function () {\r\n            Shader.getDefaultShader().drawRect();\r\n        });\r\n\r\n        // Blur the current texture, then use the stored texture to detect edges\r\n        this._.extraTexture.use(1);\r\n        this.triangleBlur(radius);\r\n        gl.unsharpMask.textures({\r\n            originalTexture: 1\r\n        });\r\n        simpleShader.call(this, gl.unsharpMask, {\r\n            strength: strength\r\n        });\r\n        this._.extraTexture.unuse(1);\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\vibrance.script\r\n    /**\r\n     * @filter       Vibrance\r\n     * @description  Modifies the saturation of desaturated colors, leaving saturated colors unmodified.\r\n     * @param amount -1 to 1 (-1 is minimum vibrance, 0 is no change, and 1 is maximum vibrance)\r\n     */\r\n    function vibrance(amount) {\r\n        gl.vibrance = gl.vibrance || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            float mx = max(color.r, max(color.g, color.b));\\\r\n            float amt = (mx - average) * (-amount * 3.0);\\\r\n            color.rgb = mix(color.rgb, vec3(mx), amt);\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'vibrance');\r\n\r\n        simpleShader.call(this, gl.vibrance, {\r\n            amount: clamp(-1, amount, 1)\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\vignette.script\r\n    /**\r\n     * @filter         Vignette\r\n     * @description    Adds a simulated lens edge darkening effect.\r\n     * @param size     0 to 1 (0 for center of frame, 1 for edge of frame)\r\n     * @param amount   0 to 1 (0 for no effect, 1 for maximum lens darkening)\r\n     */\r\n    function vignette(size, amount) {\r\n        gl.vignette = gl.vignette || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float size;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            float dist = distance(texCoord, vec2(0.5, 0.5));\\\r\n            color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount + size));\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'vignette');\r\n\r\n        simpleShader.call(this, gl.vignette, {\r\n            size: clamp(0, size, 1),\r\n            amount: clamp(0, amount, 1)\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\blur\\lensblur.script\r\n    /**\r\n     * @filter           Lens Blur\r\n     * @description      Imitates a camera capturing the image out of focus by using a blur that generates\r\n     *                   the large shapes known as bokeh. The polygonal shape of real bokeh is due to the\r\n     *                   blades of the aperture diaphragm when it isn't fully open. This blur renders\r\n     *                   bokeh from a 6-bladed diaphragm because the computation is more efficient. It\r\n     *                   can be separated into three rhombi, each of which is just a skewed box blur.\r\n     *                   This filter makes use of the floating point texture WebGL extension to implement\r\n     *                   the brightness parameter, so there will be severe visual artifacts if brightness\r\n     *                   is non-zero and the floating point texture extension is not available. The\r\n     *                   idea was from John White's SIGGRAPH 2011 talk but this effect has an additional\r\n     *                   brightness parameter that fakes what would otherwise come from a HDR source.\r\n     * @param radius     the radius of the hexagonal disk convolved with the image\r\n     * @param brightness -1 to 1 (the brightness of the bokeh, negative values will create dark bokeh)\r\n     * @param angle      the rotation of the bokeh in radians\r\n     */\r\n    function lensBlur(radius, brightness, angle) {\r\n        // All averaging is done on values raised to a power to make more obvious bokeh\r\n        // (we will raise the average to the inverse power at the end to compensate).\r\n        // Without this the image looks almost like a normal blurred image. This hack is\r\n        // obviously not realistic, but to accurately simulate this we would need a high\r\n        // dynamic range source photograph which we don't have.\r\n        gl.lensBlurPrePass = gl.lensBlurPrePass || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float power;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color = pow(color, vec4(power));\\\r\n            gl_FragColor = vec4(color);\\\r\n        }\\\r\n    ', 'lensBlurPrePass');\r\n\r\n        let common = '\\\r\n        uniform sampler2D texture0;\\\r\n        uniform sampler2D texture1;\\\r\n        uniform vec2 delta0;\\\r\n        uniform vec2 delta1;\\\r\n        uniform float power;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        vec4 sample(vec2 delta) {\\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(delta, 151.7182), 0.0);\\\r\n            \\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            for (float t = 0.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset) / 30.0;\\\r\n                color += texture2D(texture0, texCoord + delta * percent);\\\r\n                total += 1.0;\\\r\n            }\\\r\n            return color / total;\\\r\n        }\\\r\n    ';\r\n\r\n        gl.lensBlur0 = gl.lensBlur0 || new Shader(null, common + '\\\r\n        void main() {\\\r\n            gl_FragColor = sample(delta0);\\\r\n        }\\\r\n    ', 'lensBlur0');\r\n        gl.lensBlur1 = gl.lensBlur1 || new Shader(null, common + '\\\r\n        void main() {\\\r\n            gl_FragColor = (sample(delta0) + sample(delta1)) * 0.5;\\\r\n        }\\\r\n    ', 'lensBlur1');\r\n        gl.lensBlur2 = gl.lensBlur2 || new Shader(null, common + '\\\r\n        void main() {\\\r\n            vec4 color = (sample(delta0) + 2.0 * texture2D(texture1, texCoord)) / 3.0;\\\r\n            gl_FragColor = pow(color, vec4(power));\\\r\n        }\\\r\n    ', 'lensBlur2').textures({texture1: 1});\r\n\r\n        // Generate\r\n        let dir = [];\r\n        for (var i = 0; i < 3; i++) {\r\n            let a = angle + i * Math.PI * 2 / 3;\r\n            dir.push([radius * Math.sin(a) / this.width, radius * Math.cos(a) / this.height]);\r\n        }\r\n        let power = Math.pow(10, clamp(-1, brightness, 1));\r\n\r\n        // Remap the texture values, which will help make the bokeh effect\r\n        simpleShader.call(this, gl.lensBlurPrePass, {\r\n            power: power\r\n        });\r\n\r\n        // Blur two rhombi in parallel into extraTexture\r\n        this._.extraTexture.ensureFormat(this._.texture);\r\n        simpleShader.call(this, gl.lensBlur0, {\r\n            delta0: dir[0]\r\n        }, this._.texture, this._.extraTexture);\r\n        simpleShader.call(this, gl.lensBlur1, {\r\n            delta0: dir[1],\r\n            delta1: dir[2]\r\n        }, this._.extraTexture, this._.extraTexture);\r\n\r\n        // Blur the last rhombus and combine with extraTexture\r\n        simpleShader.call(this, gl.lensBlur0, {\r\n            delta0: dir[1]\r\n        });\r\n        this._.extraTexture.use(1);\r\n        simpleShader.call(this, gl.lensBlur2, {\r\n            power: 1 / power,\r\n            delta0: dir[2]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\blur\\tiltshift.script\r\n    /**\r\n     * @filter               Tilt Shift\r\n     * @description          Simulates the shallow depth of field normally encountered in close-up\r\n     *                       photography, which makes the scene seem much smaller than it actually\r\n     *                       is. This filter assumes the scene is relatively planar, in which case\r\n     *                       the part of the scene that is completely in focus can be described by\r\n     *                       a line (the intersection of the focal plane and the scene). An example\r\n     *                       of a planar scene might be looking at a road from above at a downward\r\n     *                       angle. The image is then blurred with a blur radius that starts at zero\r\n     *                       on the line and increases further from the line.\r\n     * @param startX         The x coordinate of the start of the line segment.\r\n     * @param startY         The y coordinate of the start of the line segment.\r\n     * @param endX           The x coordinate of the end of the line segment.\r\n     * @param endY           The y coordinate of the end of the line segment.\r\n     * @param blurRadius     The maximum radius of the pyramid blur.\r\n     * @param gradientRadius The distance from the line at which the maximum blur radius is reached.\r\n     */\r\n    function tiltShift(startX, startY, endX, endY, blurRadius, gradientRadius) {\r\n        gl.tiltShift = gl.tiltShift || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float blurRadius;\\\r\n        uniform float gradientRadius;\\\r\n        uniform vec2 start;\\\r\n        uniform vec2 end;\\\r\n        uniform vec2 delta;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\\\r\n            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'tiltShift');\r\n\r\n        let dx = endX - startX;\r\n        let dy = endY - startY;\r\n        let d = Math.sqrt(dx * dx + dy * dy);\r\n        simpleShader.call(this, gl.tiltShift, {\r\n            blurRadius: blurRadius,\r\n            gradientRadius: gradientRadius,\r\n            start: [startX, startY],\r\n            end: [endX, endY],\r\n            delta: [dx / d, dy / d],\r\n            texSize: [this.width, this.height]\r\n        });\r\n        simpleShader.call(this, gl.tiltShift, {\r\n            blurRadius: blurRadius,\r\n            gradientRadius: gradientRadius,\r\n            start: [startX, startY],\r\n            end: [endX, endY],\r\n            delta: [-dy / d, dx / d],\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\blur\\triangleblur.script\r\n    /**\r\n     * @filter       Triangle Blur\r\n     * @description  This is the most basic blur filter, which convolves the image with a\r\n     *               pyramid filter. The pyramid filter is separable and is applied as two\r\n     *               perpendicular triangle filters.\r\n     * @param radius The radius of the pyramid convolved with the image.\r\n     */\r\n    function triangleBlur(radius) {\r\n        gl.triangleBlur = gl.triangleBlur || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta * percent);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'triangleBlur');\r\n\r\n        simpleShader.call(this, gl.triangleBlur, {\r\n            delta: [radius / this.width, 0]\r\n        });\r\n        simpleShader.call(this, gl.triangleBlur, {\r\n            delta: [0, radius / this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\blur\\zoomblur.script\r\n    /**\r\n     * @filter         Zoom Blur\r\n     * @description    Blurs the image away from a certain point, which looks like radial motion blur.\r\n     * @param centerX  The x coordinate of the blur origin.\r\n     * @param centerY  The y coordinate of the blur origin.\r\n     * @param strength The strength of the blur. Values in the range 0 to 1 are usually sufficient,\r\n     *                 where 0 doesn't change the image and 1 creates a highly blurred image.\r\n     */\r\n    function zoomBlur(centerX, centerY, strength) {\r\n        gl.zoomBlur = gl.zoomBlur || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float strength;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            vec2 toCenter = center - texCoord * texSize;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = 0.0; t <= 40.0; t++) {\\\r\n                float percent = (t + offset) / 40.0;\\\r\n                float weight = 4.0 * (percent - percent * percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + toCenter * percent * strength / texSize);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'zoomBlur');\r\n\r\n        simpleShader.call(this, gl.zoomBlur, {\r\n            center: [centerX, centerY],\r\n            strength: strength,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\fun\\colorhalftone.script\r\n    /**\r\n     * @filter        Color Halftone\r\n     * @description   Simulates a CMYK halftone rendering of the image by multiplying pixel values\r\n     *                with a four rotated 2D sine wave patterns, one each for cyan, magenta, yellow,\r\n     *                and black.\r\n     * @param centerX The x coordinate of the pattern origin.\r\n     * @param centerY The y coordinate of the pattern origin.\r\n     * @param angle   The rotation of the pattern in radians.\r\n     * @param size    The diameter of a dot in pixels.\r\n     */\r\n    function colorHalftone(centerX, centerY, angle, size) {\r\n        gl.colorHalftone = gl.colorHalftone || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float angle;\\\r\n        uniform float scale;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        \\\r\n        float pattern(float angle) {\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec2 tex = texCoord * texSize - center;\\\r\n            vec2 point = vec2(\\\r\n                c * tex.x - s * tex.y,\\\r\n                s * tex.x + c * tex.y\\\r\n            ) * scale;\\\r\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\r\n        }\\\r\n        \\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            vec3 cmy = 1.0 - color.rgb;\\\r\n            float k = min(cmy.x, min(cmy.y, cmy.z));\\\r\n            cmy = (cmy - k) / (1.0 - k);\\\r\n            cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(angle + 0.26179), pattern(angle + 1.30899), pattern(angle)), 0.0, 1.0);\\\r\n            k = clamp(k * 10.0 - 5.0 + pattern(angle + 0.78539), 0.0, 1.0);\\\r\n            gl_FragColor = vec4(1.0 - cmy - k, color.a);\\\r\n        }\\\r\n    ', 'colorHalftone');\r\n\r\n        simpleShader.call(this, gl.colorHalftone, {\r\n            center: [centerX, centerY],\r\n            angle: angle,\r\n            scale: Math.PI / size,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\fun\\dotscreen.script\r\n    /**\r\n     * @filter        Dot Screen\r\n     * @description   Simulates a black and white halftone rendering of the image by multiplying\r\n     *                pixel values with a rotated 2D sine wave pattern.\r\n     * @param centerX The x coordinate of the pattern origin.\r\n     * @param centerY The y coordinate of the pattern origin.\r\n     * @param angle   The rotation of the pattern in radians.\r\n     * @param size    The diameter of a dot in pixels.\r\n     */\r\n    function dotScreen(centerX, centerY, angle, size) {\r\n        gl.dotScreen = gl.dotScreen || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float angle;\\\r\n        uniform float scale;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        \\\r\n        float pattern() {\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec2 tex = texCoord * texSize - center;\\\r\n            vec2 point = vec2(\\\r\n                c * tex.x - s * tex.y,\\\r\n                s * tex.x + c * tex.y\\\r\n            ) * scale;\\\r\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\r\n        }\\\r\n        \\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\\\r\n        }\\\r\n    ', 'dotScreen');\r\n\r\n        simpleShader.call(this, gl.dotScreen, {\r\n            center: [centerX, centerY],\r\n            angle: angle,\r\n            scale: Math.PI / size,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\fun\\edgework.script\r\n    /**\r\n     * @filter       Edge Work\r\n     * @description  Picks out different frequencies in the image by subtracting two\r\n     *               copies of the image blurred with different radii.\r\n     * @param radius The radius of the effect in pixels.\r\n     */\r\n    function edgeWork(radius) {\r\n        gl.edgeWork1 = gl.edgeWork1 || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec2 color = vec2(0.0);\\\r\n            vec2 total = vec2(0.0);\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec3 sample = texture2D(texture, texCoord + delta * percent).rgb;\\\r\n                float average = (sample.r + sample.g + sample.b) / 3.0;\\\r\n                color.x += average * weight;\\\r\n                total.x += weight;\\\r\n                if (abs(t) < 15.0) {\\\r\n                    weight = weight * 2.0 - 1.0;\\\r\n                    color.y += average * weight;\\\r\n                    total.y += weight;\\\r\n                }\\\r\n            }\\\r\n            gl_FragColor = vec4(color / total, 0.0, 1.0);\\\r\n        }\\\r\n    ', 'edgeWork1');\r\n        gl.edgeWork2 = gl.edgeWork2 || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec2 color = vec2(0.0);\\\r\n            vec2 total = vec2(0.0);\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec2 sample = texture2D(texture, texCoord + delta * percent).xy;\\\r\n                color.x += sample.x * weight;\\\r\n                total.x += weight;\\\r\n                if (abs(t) < 15.0) {\\\r\n                    weight = weight * 2.0 - 1.0;\\\r\n                    color.y += sample.y * weight;\\\r\n                    total.y += weight;\\\r\n                }\\\r\n            }\\\r\n            float c = clamp(10000.0 * (color.y / total.y - color.x / total.x) + 0.5, 0.0, 1.0);\\\r\n            gl_FragColor = vec4(c, c, c, 1.0);\\\r\n        }\\\r\n    ', 'edgeWork2');\r\n\r\n        simpleShader.call(this, gl.edgeWork1, {\r\n            delta: [radius / this.width, 0]\r\n        });\r\n        simpleShader.call(this, gl.edgeWork2, {\r\n            delta: [0, radius / this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\fun\\hexagonalpixelate.script\r\n    /**\r\n     * @filter        Hexagonal Pixelate\r\n     * @description   Renders the image using a pattern of hexagonal tiles. Tile colors\r\n     *                are nearest-neighbor sampled from the centers of the tiles.\r\n     * @param centerX The x coordinate of the pattern center.\r\n     * @param centerY The y coordinate of the pattern center.\r\n     * @param scale   The width of an individual tile, in pixels.\r\n     */\r\n    function hexagonalPixelate(centerX, centerY, scale) {\r\n        gl.hexagonalPixelate = gl.hexagonalPixelate || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float scale;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec2 tex = (texCoord * texSize - center) / scale;\\\r\n            tex.y /= 0.866025404;\\\r\n            tex.x -= tex.y * 0.5;\\\r\n            \\\r\n            vec2 a;\\\r\n            if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) a = vec2(floor(tex.x), floor(tex.y));\\\r\n            else a = vec2(ceil(tex.x), ceil(tex.y));\\\r\n            vec2 b = vec2(ceil(tex.x), floor(tex.y));\\\r\n            vec2 c = vec2(floor(tex.x), ceil(tex.y));\\\r\n            \\\r\n            vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\\\r\n            vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\\\r\n            vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\\\r\n            vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\\\r\n            \\\r\n            float alen = length(TEX - A);\\\r\n            float blen = length(TEX - B);\\\r\n            float clen = length(TEX - C);\\\r\n            \\\r\n            vec2 choice;\\\r\n            if (alen < blen) {\\\r\n                if (alen < clen) choice = a;\\\r\n                else choice = c;\\\r\n            } else {\\\r\n                if (blen < clen) choice = b;\\\r\n                else choice = c;\\\r\n            }\\\r\n            \\\r\n            choice.x += choice.y * 0.5;\\\r\n            choice.y *= 0.866025404;\\\r\n            choice *= scale / texSize;\\\r\n            gl_FragColor = texture2D(texture, choice + center / texSize);\\\r\n        }\\\r\n    ', 'hexagonalPixelate');\r\n\r\n        simpleShader.call(this, gl.hexagonalPixelate, {\r\n            center: [centerX, centerY],\r\n            scale: scale,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\fun\\ink.script\r\n    /**\r\n     * @filter         Ink\r\n     * @description    Simulates outlining the image in ink by darkening edges stronger than a\r\n     *                 certain threshold. The edge detection value is the difference of two\r\n     *                 copies of the image, each blurred using a blur of a different radius.\r\n     * @param strength The multiplicative scale of the ink edges. Values in the range 0 to 1\r\n     *                 are usually sufficient, where 0 doesn't change the image and 1 adds lots\r\n     *                 of black edges. Negative strength values will create white ink edges\r\n     *                 instead of black ones.\r\n     */\r\n    function ink(strength) {\r\n        gl.ink = gl.ink || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float strength;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec2 dx = vec2(1.0 / texSize.x, 0.0);\\\r\n            vec2 dy = vec2(0.0, 1.0 / texSize.y);\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float bigTotal = 0.0;\\\r\n            float smallTotal = 0.0;\\\r\n            vec3 bigAverage = vec3(0.0);\\\r\n            vec3 smallAverage = vec3(0.0);\\\r\n            for (float x = -2.0; x <= 2.0; x += 1.0) {\\\r\n                for (float y = -2.0; y <= 2.0; y += 1.0) {\\\r\n                    vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\\\r\n                    bigAverage += sample;\\\r\n                    bigTotal += 1.0;\\\r\n                    if (abs(x) + abs(y) < 2.0) {\\\r\n                        smallAverage += sample;\\\r\n                        smallTotal += 1.0;\\\r\n                    }\\\r\n                }\\\r\n            }\\\r\n            vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\\\r\n            gl_FragColor = vec4(color.rgb - dot(edge, edge) * strength * 100000.0, color.a);\\\r\n        }\\\r\n    ', 'ink');\r\n\r\n        simpleShader.call(this, gl.ink, {\r\n            strength: strength * strength * strength * strength * strength,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\warp\\bulgepinch.script\r\n    /**\r\n     * @filter         Bulge / Pinch\r\n     * @description    Bulges or pinches the image in a circle.\r\n     * @param centerX  The x coordinate of the center of the circle of effect.\r\n     * @param centerY  The y coordinate of the center of the circle of effect.\r\n     * @param radius   The radius of the circle of effect.\r\n     * @param strength -1 to 1 (-1 is strong pinch, 0 is no effect, 1 is strong bulge)\r\n     */\r\n    function bulgePinch(centerX, centerY, radius, strength) {\r\n        gl.bulgePinch = gl.bulgePinch || warpShader('\\\r\n        uniform float radius;\\\r\n        uniform float strength;\\\r\n        uniform vec2 center;\\\r\n    ', '\\\r\n        coord -= center;\\\r\n        float distance = length(coord);\\\r\n        if (distance < radius) {\\\r\n            float percent = distance / radius;\\\r\n            if (strength > 0.0) {\\\r\n                coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);\\\r\n            } else {\\\r\n                coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);\\\r\n            }\\\r\n        }\\\r\n        coord += center;\\\r\n    ');\r\n\r\n        simpleShader.call(this, gl.bulgePinch, {\r\n            radius: radius,\r\n            strength: clamp(-1, strength, 1),\r\n            center: [centerX, centerY],\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\warp\\matrixwarp.script\r\n    /**\r\n     * @filter                Matrix Warp\r\n     * @description           Transforms an image by a 2x2 or 3x3 matrix. The coordinates used in\r\n     *                        the transformation are (x, y) for a 2x2 matrix or (x, y, 1) for a\r\n     *                        3x3 matrix, where x and y are in units of pixels.\r\n     * @param matrix          A 2x2 or 3x3 matrix represented as either a list or a list of lists.\r\n     *                        For example, the 3x3 matrix [[2,0,0],[0,3,0],[0,0,1]] can also be\r\n     *                        represented as [2,0,0,0,3,0,0,0,1] or just [2,0,0,3].\r\n     * @param inverse         A boolean value that, when true, applies the inverse transformation\r\n     *                        instead. (optional, defaults to false)\r\n     * @param useTextureSpace A boolean value that, when true, uses texture-space coordinates\r\n     *                        instead of screen-space coordinates. Texture-space coordinates range\r\n     *                        from -1 to 1 instead of 0 to width - 1 or height - 1, and are easier\r\n     *                        to use for simple operations like flipping and rotating.\r\n     */\r\n    function matrixWarp(matrix, inverse, useTextureSpace) {\r\n        gl.matrixWarp = gl.matrixWarp || warpShader('\\\r\n        uniform mat3 matrix;\\\r\n        uniform bool useTextureSpace;\\\r\n    ', '\\\r\n        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;\\\r\n        vec3 warp = matrix * vec3(coord, 1.0);\\\r\n        coord = warp.xy / warp.z;\\\r\n        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;\\\r\n    ');\r\n\r\n        // Flatten all members of matrix into one big list\r\n        matrix = Array.prototype.concat.apply([], matrix);\r\n\r\n        // Extract a 3x3 matrix out of the arguments\r\n        if (matrix.length == 4) {\r\n            matrix = [\r\n                matrix[0], matrix[1], 0,\r\n                matrix[2], matrix[3], 0,\r\n                0, 0, 1\r\n            ];\r\n        } else if (matrix.length != 9) {\r\n            throw 'can only warp with 2x2 or 3x3 matrix';\r\n        }\r\n\r\n        simpleShader.call(this, gl.matrixWarp, {\r\n            matrix: inverse ? getInverse(matrix) : matrix,\r\n            texSize: [this.width, this.height],\r\n            useTextureSpace: useTextureSpace | 0\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\warp\\perspective.script\r\n    /**\r\n     * @filter       Perspective\r\n     * @description  Warps one quadrangle to another with a perspective transform. This can be used to\r\n     *               make a 2D image look 3D or to recover a 2D image captured in a 3D environment.\r\n     * @param before The x and y coordinates of four points before the transform in a flat list. This\r\n     *               would look like [ax, ay, bx, by, cx, cy, dx, dy] for four points (ax, ay), (bx, by),\r\n     *               (cx, cy), and (dx, dy).\r\n     * @param after  The x and y coordinates of four points after the transform in a flat list, just\r\n     *               like the other argument.\r\n     */\r\n    function perspective(before, after) {\r\n        let a = getSquareToQuad.apply(null, after);\r\n        let b = getSquareToQuad.apply(null, before);\r\n        let c = multiply(getInverse(a), b);\r\n        return this.matrixWarp(c);\r\n    }\r\n\r\n// src/filters\\warp\\swirl.script\r\n    /**\r\n     * @filter        Swirl\r\n     * @description   Warps a circular region of the image in a swirl.\r\n     * @param centerX The x coordinate of the center of the circular region.\r\n     * @param centerY The y coordinate of the center of the circular region.\r\n     * @param radius  The radius of the circular region.\r\n     * @param angle   The angle in radians that the pixels in the center of\r\n     *                the circular region will be rotated by.\r\n     */\r\n    function swirl(centerX, centerY, radius, angle) {\r\n        gl.swirl = gl.swirl || warpShader('\\\r\n        uniform float radius;\\\r\n        uniform float angle;\\\r\n        uniform vec2 center;\\\r\n    ', '\\\r\n        coord -= center;\\\r\n        float distance = length(coord);\\\r\n        if (distance < radius) {\\\r\n            float percent = (radius - distance) / radius;\\\r\n            float theta = percent * percent * angle;\\\r\n            float s = sin(theta);\\\r\n            float c = cos(theta);\\\r\n            coord = vec2(\\\r\n                coord.x * c - coord.y * s,\\\r\n                coord.x * s + coord.y * c\\\r\n            );\\\r\n        }\\\r\n        coord += center;\\\r\n    ');\r\n\r\n        simpleShader.call(this, gl.swirl, {\r\n            radius: radius,\r\n            center: [centerX, centerY],\r\n            angle: angle,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @filter        Invert\r\n     * @description   Inverts color of each pixel\r\n     */\r\n    function invert() {\r\n        gl.invert = gl.invert || new Shader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        gl_FragColor = vec4(1.0 - color.r, 1.0 - color.g, 1.0 - color.b, color.a);\\\r\n    }\\\r\n', 'invert');\r\n\r\n        simpleShader.call(this, gl.invert, {\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @filter        To Alpha\r\n     * @description   Generates alpha channel from luminance (r+g+b)\r\n     * @param isInverted    boolean - invert luminance\r\n     * @param replaceRGBA    rgba - color to replace rgb with. if a = 0 -> keep orig color\r\n     */\r\n    function toAlpha(isInverted, replaceRGBA) {\r\n        gl.toAlpha = gl.toAlpha || new Shader(null, '\\\r\n    uniform bool isInverted;\\\r\n    uniform vec4 replace;\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        float alpha = (color.r + color.g + color.b) / 3.0;\\\r\n        if (isInverted) alpha = 1.0 - alpha;\\\r\n        alpha = min(color.a, alpha);\\\r\n        if (replace.a > 0.0) color = replace;\\\r\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha);\\\r\n    }\\\r\n', 'toAlpha');\r\n\r\n        simpleShader.call(this, gl.toAlpha, {\r\n\t\t\tisInverted: isInverted ? 1 : 0,\r\n            replace: replaceRGBA ? [replaceRGBA.r / 255, replaceRGBA.g / 255, replaceRGBA.b / 255, replaceRGBA.a] : [0, 0, 0, 0],\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    return exports;\r\n})();\r\n","uniform sampler2D texture;\r\nvarying vec2 texCoord;\r\nuniform vec2 texSize;\r\n\r\nuniform float seed;\r\nuniform float type;\r\nuniform vec2 scale;\r\nuniform vec2 offset;\r\nuniform float octaves;\r\nuniform float samples;\r\n\r\nuniform float peaks;\r\nuniform float contrast;\r\nuniform float brightness;\r\nuniform float doInvert;\r\n\r\nuniform vec3 colA;\r\nuniform vec3 colB;\r\n\r\nuniform float channels; // 0 - rgb, 1 - alpha\r\n\r\n// fbm, cellular_noise based on\r\n// https://github.com/Gonkee/Gonkees-Shaders\r\n// MIT, Copyright  Gonkee\r\n\r\n// hash & simplex based on\r\n// https://www.shadertoy.com/view/Msf3WH\r\n// MIT, Copyright  2013 Inigo Quilez\r\n// https://www.youtube.com/c/InigoQuilez\r\n// https://iquilezles.org\r\n\r\n\r\n\r\nfloat rand(vec2 co) {\r\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\r\n}\r\n\r\nfloat value_noise(vec2 coord){\r\n    return rand(floor(coord) / 100.0);\r\n}\r\n\r\nfloat cellular_noise(vec2 coord) {\r\n    vec2 i = floor(coord);\r\n    vec2 f = fract(coord);\r\n\r\n    float min_dist = 99999.0;\r\n    for (float x = -1.0; x <= 1.0; x++) {\r\n        for (float y = -1.0; y <= 1.0; y++) {\r\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\r\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\r\n            min_dist = min(min_dist, dist);\r\n        }\r\n    }\r\n    return min_dist;\r\n}\r\n\r\n// ---------- Simplex Alternative _--------------------\r\n\r\nvec3 hash(vec3 p)\r\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\r\n, dot(p, vec3(269.5, 183.3, 246.1))\r\n, dot(p, vec3(113.5, 271.9, 124.6)))\r\n;return fract(sin(p)*43758.5453123)*2.-1.; }\r\n\r\nmat3 hash(mat3 p)\r\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\r\n\r\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\r\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\r\n\r\n//return noiseGra13dx as .x, and its derivatives as .yzw\r\n// https://www.shadertoy.com/view/llByD1\r\nvec3 noiseGra13dx(in vec3 x) {\r\n    vec3 p=floor(x), w=fract(x)\r\n    #if 1\r\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\r\n    #else\r\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\r\n    #endif\r\n    //gradients\r\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\r\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\r\n    //projections\r\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\r\n    //interpolations\r\n    float g=dot(G, w), f=dot(F, w-vec3(1));\r\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\r\n    mat3 S=D-mat3(G, G, G), W=D-E;\r\n    a.x=(a.x+a.y+a.z)+f-g;\r\n    ;float b=u.x*u.y*u.z;\r\n\r\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\r\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\r\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\r\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\r\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\r\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\r\n    return 0.5 + 0.5 * result.xxx;\r\n}\r\n\r\nfloat fbm(vec2 coord) {\r\n    float normalize_factor = 0.0;\r\n    float value = 0.0;\r\n    float scale = 0.5;\r\n\r\n    for (float i = 0.0; i < 7.0; i++){\r\n        if (i < octaves) {\r\n            if (type == 0.0) {\r\n                value += value_noise(coord) * scale;\r\n            } else if (type == 1.0) {\r\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\r\n            } else if (type == 2.0) {\r\n                value += cellular_noise(coord) * scale;\r\n            }\r\n            normalize_factor += scale;\r\n            coord *= 2.0;\r\n            scale *= 0.5;\r\n        }\r\n    }\r\n    return value / normalize_factor;\r\n}\r\n\r\nfloat render (vec2 pos) {\r\n    float result = fbm(pos);\r\n    //\r\n\r\n    if (peaks > 0.0) {\r\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\r\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\r\n    }\r\n\r\n    result += brightness;\r\n    if (contrast > 0.0) {\r\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\r\n    } else if (contrast < 0.0) {\r\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\r\n    }\r\n\r\n    if (doInvert == 1.0) {\r\n        result = 1.0 - result;\r\n    }\r\n    return result;\r\n}\r\n\r\n\r\nvoid main() {\r\n    vec4 color;\r\n\r\n    vec2 seedOffset;\r\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\r\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\r\n\r\n    float val = 0.0;\r\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\r\n\r\n    if (samples == 1.0) {\r\n        val = render(basePos);\r\n\r\n    }/* else if (samples == 4.0) {\r\n        for (float i = 0.0; i < 2.0; i++) {\r\n            for (float e = 0.0; e < 2.0; e++) {\r\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\r\n            }\r\n        }\r\n        val /= 4.0;\r\n\r\n    }*/ else if (samples == 16.0) {\r\n        for (float i = 0.0; i < 4.0; i++) {\r\n            for (float e = 0.0; e < 4.0; e++) {\r\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\r\n            }\r\n        }\r\n        val /= 16.0;\r\n    }\r\n\r\n    if (channels == 0.0) {\r\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\r\n    } else {\r\n        gl_FragColor = vec4(vec3(1.0), val);\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {input} from '../ui/base-components/input';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {Cropper} from '../ui/components/cropper';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterCropExtend = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        const klCanvas = params.klCanvas;\r\n        if (!klCanvas)\r\n            return false;\r\n        const tempCanvas = BB.canvas();\r\n        {\r\n            let fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 560, 400, 1);\r\n            let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n            let previewFactor = w / klCanvas.getWidth();\r\n            tempCanvas.width = w;\r\n            tempCanvas.height = h;\r\n            tempCanvas.style.display = 'block';\r\n            tempCanvas.getContext(\"2d\").drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n        }\r\n\r\n        const div = document.createElement(\"div\");\r\n        const result: any = {\r\n            element: div\r\n        };\r\n        div.innerHTML = LANG('filter-crop-description') + \"<br/><br/>\";\r\n        let left = 0, right = 0, top = 0, bottom = 0;\r\n        let leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\r\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n        let scale;\r\n\r\n\r\n\r\n        // --- input elements ---\r\n\r\n        const lrWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'}\r\n        });\r\n        const tbWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'}\r\n        });\r\n        div.appendChild(lrWrapper);\r\n        div.appendChild(tbWrapper);\r\n\r\n        const leftInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                leftChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n        const rightInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px'},\r\n            callback: function(v) {\r\n                rightChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n        const topInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                topChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n        const bottomInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px'},\r\n            callback: function(v) {\r\n                bottomChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            width: '60px'\r\n        };\r\n        lrWrapper.append(\r\n            BB.el({content: LANG('filter-crop-left') + ':', css: labelStyle}),\r\n            leftInput,\r\n            BB.el({content: LANG('filter-crop-right') + ':', css: labelStyle}),\r\n            rightInput\r\n        );\r\n        tbWrapper.append(\r\n            BB.el({content: LANG('filter-crop-top') + ':', css: labelStyle}),\r\n            topInput,\r\n            BB.el({content: LANG('filter-crop-bottom') + ':', css: labelStyle}),\r\n            bottomInput\r\n        );\r\n\r\n        function updateInput() {\r\n            left = parseInt(leftInput.value);\r\n            right = parseInt(rightInput.value);\r\n            top = parseInt(topInput.value);\r\n            bottom = parseInt(bottomInput.value);\r\n            let newWidth = klCanvas.getWidth() + left + right;\r\n            let newHeight = klCanvas.getHeight() + top + bottom;\r\n\r\n            if (newWidth <= 0) {\r\n                if (leftChanged) {\r\n                    left = -klCanvas.getWidth() - right + 1;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -klCanvas.getWidth() - left + 1;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = 1;\r\n            }\r\n            if (newWidth > maxWidth) {\r\n                if (leftChanged) {\r\n                    left = -klCanvas.getWidth() - right + maxWidth;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -klCanvas.getWidth() - left + maxWidth;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = maxWidth;\r\n            }\r\n            if (newHeight <= 0) {\r\n                if (topChanged) {\r\n                    top = -klCanvas.getHeight() - bottom + 1;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -klCanvas.getHeight() - top + 1;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = 1;\r\n            }\r\n            if (newHeight > maxHeight) {\r\n                if (topChanged) {\r\n                    top = -klCanvas.getHeight() - bottom + maxHeight;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -klCanvas.getHeight() - top + maxHeight;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = maxHeight;\r\n            }\r\n            cropper.setTransform({\r\n                x: -left,\r\n                y: -top,\r\n                width: newWidth,\r\n                height: newHeight\r\n            });\r\n\r\n\r\n            leftChanged = false;\r\n            rightChanged = false;\r\n            topChanged = false;\r\n            bottomChanged = false;\r\n        }\r\n\r\n        let useRuleOfThirds = true;\r\n        let ruleOThirdsCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-crop-rule-thirds'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                useRuleOfThirds = b;\r\n                cropper.showThirds(useRuleOfThirds);\r\n            }\r\n        });\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both'\r\n            }\r\n        }));\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 0};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 0},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n            {r: 0, g: 0, b: 0, a: 1}\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('filter-crop-fill'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function(rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                updateBg(rgbaObj);\r\n            }\r\n        });\r\n\r\n\r\n        const flexRow = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between'\r\n            }\r\n        });\r\n        div.appendChild(flexRow);\r\n        flexRow.appendChild(ruleOThirdsCheckbox.getElement());\r\n        flexRow.appendChild(colorOptions.getElement());\r\n\r\n\r\n        // when input field changed, or dragging in preview finished\r\n        // adjusts the zoom\r\n        function update(transform) {\r\n            const fit = BB.fitInto(transform.width, transform.height, 260, 180, 1);\r\n            scale = fit.width / transform.width;\r\n\r\n            const offset = BB.centerWithin(340, 220, fit.width, fit.height);\r\n\r\n            tempCanvas.style.width = klCanvas.getWidth() * scale + \"px\";\r\n            tempCanvas.style.height = klCanvas.getHeight() * scale + \"px\";\r\n\r\n            offsetWrapper.style.left = (offset.x - transform.x * scale) + \"px\";\r\n            offsetWrapper.style.top = (offset.y - transform.y * scale) + \"px\";\r\n\r\n            left = parseInt('' + -transform.x);\r\n            top = parseInt('' + -transform.y);\r\n            right = parseInt('' + (transform.x + transform.width - klCanvas.getWidth()));\r\n            bottom = parseInt('' + (transform.y + transform.height - klCanvas.getHeight()));\r\n            leftInput.value = '' + left;\r\n            topInput.value = '' + top;\r\n            rightInput.value = '' + right;\r\n            bottomInput.value = '' + bottom;\r\n\r\n            BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                previewWrapper.style.background = \"url(\" + url + \")\";\r\n                if (selectedRgbaObj.a !== 0) {\r\n                    tempCanvas.style.background = \"url(\" + url + \")\";\r\n                }\r\n            });\r\n            previewWrapper.style.backgroundPosition = (offset.x) + \"px \" + (offset.y) + \"px\";\r\n\r\n            cropper.setScale(scale);\r\n        }\r\n\r\n        const previewWrapper = BB.el({\r\n            css: {\r\n                width: \"340px\",\r\n                marginTop: '10px',\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                position: \"relative\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                userSelect: 'none',\r\n                colorScheme: 'only light',\r\n                touchAction: 'none',\r\n            }\r\n        });\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        const bgColorOverlay = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0'\r\n            }\r\n        });\r\n        previewWrapper.appendChild(bgColorOverlay);\r\n\r\n        const offsetWrapper = document.createElement(\"div\");\r\n        offsetWrapper.style.position = \"absolute\";\r\n        offsetWrapper.style.left = \"0px\";\r\n        offsetWrapper.style.top = \"0px\";\r\n        previewWrapper.appendChild(offsetWrapper);\r\n\r\n\r\n        const canvasWrapper = BB.appendTextDiv(offsetWrapper, \"\");\r\n        canvasWrapper.appendChild(tempCanvas);\r\n        //tempCanvas.style.width = w + \"px\";\r\n        //tempCanvas.style.height = h + \"px\";\r\n        tempCanvas.style.boxShadow = \"0 0 3px 1px rgba(0,0,0,0.5)\";\r\n        tempCanvas.style.position = \"absolute\";\r\n        tempCanvas.style.left = \"0px\";\r\n        tempCanvas.style.top = \"0px\";\r\n\r\n        div.appendChild(previewWrapper);\r\n        const cropper = new Cropper({\r\n            x: 0,\r\n            y: 0,\r\n            width: klCanvas.getWidth(),\r\n            height: klCanvas.getHeight(),\r\n            scale: scale,\r\n            callback: update,\r\n            maxW: maxWidth,\r\n            maxH: maxHeight\r\n        });\r\n        update(cropper.getTransform());\r\n        offsetWrapper.appendChild(cropper.getElement());\r\n\r\n        function updateBg(rgbaObj) {\r\n\r\n            let borderColor;\r\n            if (rgbaObj.a === 0) {\r\n                borderColor = 'rgba(0,0,0,0.5)';\r\n                bgColorOverlay.style.background = '';\r\n                tempCanvas.style.background = '';\r\n            } else {\r\n                borderColor = (rgbaObj.r + rgbaObj.g + rgbaObj.b < 255 * 3 / 2) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\r\n                bgColorOverlay.style.background = BB.ColorConverter.toRgbStr(rgbaObj);\r\n\r\n                BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                    tempCanvas.style.background = \"url(\" + url + \")\";\r\n                });\r\n            }\r\n            tempCanvas.style.boxShadow = \"0 0 3px 1px \" + borderColor;\r\n        }\r\n\r\n        result.destroy = () => {\r\n            cropper.destroy();\r\n            ruleOThirdsCheckbox.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return {\r\n                left: left,\r\n                right: right,\r\n                top: top,\r\n                bottom: bottom,\r\n                fillColor: selectedRgbaObj.a === 0 ? null : selectedRgbaObj\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!klCanvas || !history || isNaN(params.input.left) || isNaN(params.input.right) || isNaN(params.input.top) || isNaN(params.input.bottom)) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.resizeCanvas(params.input);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"cropExtend\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: JSON.parse(JSON.stringify(params.input))\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterCurves = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div,\r\n        };\r\n        let klCanvasPreview;\r\n\r\n        function finishInit() {\r\n\r\n            let previewFactor = w / context.canvas.width;\r\n            let brightness = 0, contrast = 0;\r\n\r\n            div.innerHTML = LANG('filter-curves-description') + \"<br/><br/>\";\r\n\r\n            let curves = {\r\n                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n            };\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n                    if (klCanvasPreview) {\r\n                        klCanvasPreview.render();\r\n                    }\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            let modeButtons;\r\n\r\n            function CurvesInput(p) {\r\n                let div = document.createElement(\"div\");\r\n                div.oncontextmenu = function () {\r\n                    return false;\r\n                };\r\n                div.style.position = \"relative\";\r\n                div.style.marginBottom = \"10px\";\r\n                let mode = \"All\";\r\n                let curves = p.curves;\r\n                modeButtons = new Options( {\r\n                    optionArr: [\r\n                        {\r\n                            id: 'All',\r\n                            label: LANG('filter-curves-all')\r\n                        },\r\n                        {\r\n                            id: 'Red',\r\n                            label: LANG('red')\r\n                        },\r\n                        {\r\n                            id: 'Green',\r\n                            label: LANG('green')\r\n                        },\r\n                        {\r\n                            id: 'Blue',\r\n                            label: LANG('blue')\r\n                        },\r\n                    ],\r\n                    initialId: 'All',\r\n                    onChange: function(id) {\r\n                        mode = id;\r\n                        if (mode === \"All\") {\r\n                            curves = {\r\n                                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                            };\r\n                        }\r\n                        let curve = curves.r;\r\n                        if (mode === \"Green\") {\r\n                            curve = curves.g;\r\n                        }\r\n                        if (mode === \"Blue\") {\r\n                            curve = curves.b;\r\n                        }\r\n                        (p0 as any).setPos(0, areah - curve[0][1] * areah);\r\n                        (p1 as any).setPos(curve[1][0] * areaw, areah - curve[1][1] * areah);\r\n                        (p2 as any).setPos(curve[2][0] * areaw, areah - curve[2][1] * areah);\r\n                        (p3 as any).setPos(areaw, areah - curve[3][1] * areah);\r\n\r\n                        update();\r\n                    }\r\n                });\r\n                div.appendChild(modeButtons.getElement());\r\n\r\n                let curveArea = document.createElement(\"div\");\r\n                BB.css(curveArea, {\r\n                    position: 'relative',\r\n                    marginTop: '10px',\r\n                    colorScheme: 'only light',\r\n                })\r\n                div.appendChild(curveArea);\r\n\r\n                let areaw = 300, areah = 100;\r\n                let canvas = BB.canvas(areaw, areah);\r\n                BB.css(canvas, {\r\n                    background: \"#c6c6c6\",\r\n                    boxShadow: \"0 0 0 1px rgba(0,0,0,0.3)\"\r\n                });\r\n                let ctx = canvas.getContext(\"2d\");\r\n                curveArea.appendChild(canvas);\r\n\r\n                let points = {\r\n                    r: [],\r\n                    g: [],\r\n                    b: []\r\n                };\r\n\r\n                function fit(v) {\r\n                    return Math.max(0, Math.min(1, v));\r\n                }\r\n\r\n                function createPoint(x, y, callback, lock?) {\r\n                    let gripSize = 14;\r\n                    let internalY = y, internalX = x;\r\n                    let point = document.createElement(\"div\");\r\n                    BB.css(point, {\r\n                        position: \"absolute\",\r\n                        left: (x - gripSize / 2) + \"px\",\r\n                        top: (y - gripSize / 2) + \"px\",\r\n                        width: gripSize + \"px\",\r\n                        height: gripSize + \"px\",\r\n                        background: \"#fff\",\r\n                        cursor: \"move\",\r\n                        borderRadius: gripSize + \"px\",\r\n                        boxShadow: \"inset 0 0 0 2px #000\",\r\n                        userSelect: 'none',\r\n                        touchAction: 'none',\r\n                    });\r\n\r\n                    function update() {\r\n                        BB.css(point, {\r\n                            left: (x - gripSize / 2) + \"px\",\r\n                            top: (y - gripSize / 2) + \"px\"\r\n                        });\r\n                    }\r\n\r\n                    (point as any).pointerListener = new BB.PointerListener({\r\n                        target: point,\r\n                        maxPointers: 1,\r\n                        onPointer: function(event) {\r\n                            event.eventPreventDefault();\r\n                            if (event.type === 'pointerdown') {\r\n                                internalX = x;\r\n                                internalY = y;\r\n                            }\r\n                            if (event.button === 'left' && event.type === 'pointermove') {\r\n                                if (!lock) {\r\n                                    internalX += event.dX;\r\n                                }\r\n                                x = Math.max(0, Math.min(areaw, internalX));\r\n                                internalY += event.dY;\r\n                                y = Math.max(0, Math.min(areah, internalY));\r\n                                update();\r\n                                callback({\r\n                                    x: x,\r\n                                    y: y\r\n                                });\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    curveArea.appendChild(point);\r\n\r\n                    (point as any).setPos = function (newX, newY) {\r\n                        x = newX;\r\n                        y = newY;\r\n                        internalY = y;\r\n                        internalX = x;\r\n                        BB.css(point, {\r\n                            left: (x - gripSize / 2) + \"px\",\r\n                            top: (y - gripSize / 2) + \"px\"\r\n                        });\r\n                    };\r\n\r\n                    return point;\r\n                }\r\n\r\n                function updateControl(i, x, y) {\r\n                    if (mode === \"All\") {\r\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                    if (mode === \"Red\") {\r\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                    if (mode === \"Green\") {\r\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                    if (mode === \"Blue\") {\r\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                }\r\n\r\n                let p0 = createPoint(0, areah, function (val) {\r\n                    updateControl(0, val.x, val.y);\r\n                    update();\r\n                }, true);\r\n                let p1 = createPoint(areaw / 3, areah / 3 * 2, function (val) {\r\n                    updateControl(1, val.x, val.y);\r\n                    update();\r\n                });\r\n                let p2 = createPoint(areaw / 3 * 2, areah / 3, function (val) {\r\n                    updateControl(2, val.x, val.y);\r\n                    update();\r\n                });\r\n                let p3 = createPoint(areaw, 0, function (val) {\r\n                    updateControl(3, val.x, val.y);\r\n                    update();\r\n                }, true);\r\n\r\n\r\n                function update() {\r\n                    canvas.width = canvas.width;\r\n                    ctx = canvas.getContext(\"2d\");\r\n\r\n                    let outCurves = {\r\n                        r: [],\r\n                        g: [],\r\n                        b: []\r\n                    };\r\n                    for (let i = 0; i < curves.r.length; i++) {\r\n                        outCurves.r.push(curves.r[i]);\r\n                        outCurves.g.push(curves.g[i]);\r\n                        outCurves.b.push(curves.b[i]);\r\n                    }\r\n\r\n                    function drawCurve(curve) {\r\n                        ctx.beginPath();\r\n                        let spline = new BB.SplineInterpolator(curve);\r\n                        for (let i = 0; i < 100; i++) {\r\n                            let y = spline.interpolate(i / 100);\r\n                            y = Math.max(0, Math.min(1, y));\r\n\r\n                            if (i === 0) {\r\n                                ctx.moveTo(i / 100 * areaw, areah - y * areah);\r\n                            } else {\r\n                                ctx.lineTo(i / 100 * areaw, areah - y * areah);\r\n                            }\r\n                        }\r\n                        ctx.stroke();\r\n                    }\r\n\r\n                    ctx.save();\r\n                    if (mode === \"All\") {\r\n                        ctx.strokeStyle = \"black\";\r\n                        drawCurve(outCurves.r);\r\n                    } else {\r\n                        ctx.globalAlpha = 0.5;\r\n                        ctx.strokeStyle = \"red\";\r\n                        drawCurve(outCurves.r);\r\n                        ctx.strokeStyle = \"green\";\r\n                        drawCurve(outCurves.g);\r\n                        ctx.strokeStyle = \"blue\";\r\n                        drawCurve(outCurves.b);\r\n                    }\r\n                    ctx.restore();\r\n                    p.callback(outCurves);\r\n                }\r\n\r\n                update();\r\n\r\n\r\n                this.getDiv = function () {\r\n                    return div;\r\n                };\r\n                this.destroy = function() {\r\n                    (p0 as any).pointerListener.destroy();\r\n                    (p1 as any).pointerListener.destroy();\r\n                    (p2 as any).pointerListener.destroy();\r\n                    (p3 as any).pointerListener.destroy();\r\n                };\r\n            }\r\n\r\n            let input = new CurvesInput({\r\n                curves: curves,\r\n                callback: function (val) {\r\n                    curves = val;\r\n                    update();\r\n                }\r\n            });\r\n\r\n\r\n            div.appendChild(input.getDiv());\r\n\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            result.destroy = () => {\r\n                input.destroy();\r\n                texture.destroy();\r\n                modeButtons.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    curves: curves\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let curves = params.input.curves;\r\n        let history = params.history;\r\n        if (!context || curves === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"curves\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterFlip = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        let isHorizontal = true;\r\n        let isVertical = false;\r\n        let doFlipCanvas = true;\r\n        div.innerHTML = LANG('filter-flip-description') + \"<br/><br/>\";\r\n\r\n\r\n        let horizontalCheckbox = new Checkbox({\r\n            init: isHorizontal,\r\n            label: LANG('filter-flip-horizontal') + ' ',\r\n            allowTab: true,\r\n            callback: function(v) {\r\n                isHorizontal = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n        let verticalCheckbox = new Checkbox({\r\n            init: isVertical,\r\n            label: LANG('filter-flip-vertical') + ' ',\r\n            allowTab: true,\r\n            callback: function(v) {\r\n                isVertical = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n        div.appendChild(horizontalCheckbox.getElement());\r\n        div.appendChild(verticalCheckbox.getElement());\r\n\r\n\r\n\r\n\r\n\r\n        let fcOption = document.createElement(\"div\");\r\n        BB.setEventListener(fcOption, 'onpointerdown', function () {\r\n            return false;\r\n        });\r\n        fcOption.textContent = LANG('filter-flip-image');\r\n        fcOption.style.width = \"150px\";\r\n        fcOption.style.height = \"30px\";\r\n        fcOption.style.paddingTop = \"10px\";\r\n        fcOption.style.textAlign = \"center\";\r\n        fcOption.style.cssFloat = \"left\";\r\n        fcOption.style.paddingBottom = \"0px\";\r\n        fcOption.style.borderTopLeftRadius = \"10px\";\r\n        fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n        fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n        fcOption.style.backgroundSize = '8%';\r\n        fcOption.style.backgroundColor = \"#9e9e9e\";\r\n\r\n        let flOption = document.createElement(\"div\");\r\n        BB.setEventListener(flOption, 'onpointerdown', function () {\r\n            return false;\r\n        });\r\n        flOption.textContent = LANG('filter-flip-layer');\r\n        flOption.style.width = \"150px\";\r\n        flOption.style.height = \"30px\";\r\n        flOption.style.paddingTop = \"10px\";\r\n        flOption.style.textAlign = \"center\";\r\n        flOption.style.cssFloat = \"left\";\r\n        flOption.style.paddingBottom = \"0px\";\r\n        flOption.style.borderTopRightRadius = \"10px\";\r\n        flOption.style.cursor = \"pointer\";\r\n        flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n        flOption.style.backgroundSize = '8%';\r\n\r\n        BB.setEventListener(fcOption, 'onpointerover', function () {\r\n            if (doFlipCanvas === false)\r\n                fcOption.style.backgroundColor = \"#ccc\";\r\n        });\r\n        BB.setEventListener(fcOption, 'onpointerout', function () {\r\n            if (doFlipCanvas === false)\r\n                fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n        });\r\n        BB.setEventListener(flOption, 'onpointerover', function () {\r\n            if (doFlipCanvas === true)\r\n                flOption.style.backgroundColor = \"#ccc\";\r\n        });\r\n        BB.setEventListener(flOption, 'onpointerout', function () {\r\n            if (doFlipCanvas === true)\r\n                flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n        });\r\n\r\n        fcOption.onclick = function () {\r\n            doFlipCanvas = true;\r\n\r\n            flOption.style.background = \"\";\r\n            flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            flOption.style.boxShadow = \"\";\r\n            flOption.style.cursor = \"pointer\";\r\n\r\n            fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n            fcOption.style.backgroundSize = '8%';\r\n            fcOption.style.backgroundColor = \"#9e9e9e\";\r\n            fcOption.style.cursor = \"default\";\r\n            fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n\r\n            updatePreview();\r\n        };\r\n        flOption.onclick = function () {\r\n            doFlipCanvas = false;\r\n\r\n            fcOption.style.background = \"\";\r\n            fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            fcOption.style.boxShadow = \"\";\r\n            fcOption.style.cursor = \"pointer\";\r\n\r\n            flOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n            flOption.style.backgroundSize = '8%';\r\n            flOption.style.backgroundColor = \"#9e9e9e\";\r\n            flOption.style.cursor = \"default\";\r\n            flOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n\r\n            updatePreview();\r\n        };\r\n\r\n        let optionWrapper = document.createElement(\"div\");\r\n        optionWrapper.appendChild(fcOption);\r\n        optionWrapper.appendChild(flOption);\r\n        div.appendChild(optionWrapper);\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(Math.round(w), Math.round(h)),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over' as IMixMode,\r\n        };\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: [previewLayer]\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        function updatePreview() {\r\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\r\n\r\n            if (doFlipCanvas) {\r\n                if (isHorizontal) {\r\n                    ctx.translate(previewLayer.image.width, 0);\r\n                    ctx.scale(-1, 1);\r\n                }\r\n                if (isVertical) {\r\n                    ctx.translate(0, previewLayer.image.height);\r\n                    ctx.scale(1, -1);\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < layers.length; i++) {\r\n                ctx.save();\r\n                if (!doFlipCanvas && selectedLayerIndex === i) {\r\n                    if (isHorizontal) {\r\n                        ctx.translate(previewLayer.image.width, 0);\r\n                        ctx.scale(-1, 1);\r\n                    }\r\n                    if (isVertical) {\r\n                        ctx.translate(0, previewLayer.image.height);\r\n                        ctx.scale(1, -1);\r\n                    }\r\n                }\r\n                if (ctx.canvas.width > layers[i].context.canvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.globalAlpha = layers[i].opacity;\r\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\r\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\r\n                ctx.restore();\r\n            }\r\n            klCanvasPreview.render();\r\n            ctx.restore();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            horizontalCheckbox.destroy();\r\n            verticalCheckbox.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return {\r\n                horizontal: isHorizontal,\r\n                vertical: isVertical,\r\n                flipCanvas: doFlipCanvas\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        let horizontal = params.input.horizontal;\r\n        let vertical = params.input.vertical;\r\n        let flipCanvas = params.input.flipCanvas;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        klCanvas.flip(horizontal, vertical, flipCanvas ? null : klCanvas.getLayerIndex(context.canvas));\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: [\"filter\", \"flip\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    },\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eFiVD\");","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterHueSaturation = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height,280, 200,  1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        function finishInit() {\r\n            let hue = 0, saturation = 0;\r\n            div.innerHTML = LANG('filter-hue-sat-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let hueSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-hue'),\r\n                width: 300,\r\n                height: 30,\r\n                min: -100,\r\n                max: 100,\r\n                value: hue * 100,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    hue = val / 100;\r\n                    glCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            let saturationSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-saturation'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (saturation + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    saturation = val / 50 - 1;\r\n                    glCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            hueSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(hueSlider.getElement());\r\n            div.appendChild(saturationSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                hueSlider.destroy();\r\n                saturationSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    hue: hue,\r\n                    Saturation: saturation\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let hue = params.input.hue;\r\n        let history = params.history;\r\n        let Saturation = params.input.Saturation;\r\n        if (!context || hue === null || Saturation === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"hueSaturation\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply} from '../kl.types';\r\n\r\nexport const filterInvert = {\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false;\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).invert().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"invert\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterPerspective = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let isSmall = window.innerWidth < 550;\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n\r\n        let pointerListenerArr = [];\r\n\r\n        function finishInit() {\r\n            div.innerHTML = LANG('filter-perspective-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n            let ba, bb, bc, bd; //before\r\n            let aa, ab, ac, ad; //after\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).perspective(\r\n                        [ba.x, ba.y, bb.x, bb.y, bc.x, bc.y, bd.x, bd.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        }),\r\n                        [aa.x, aa.y, ab.x, ab.y, ac.x, ac.y, ad.x, ad.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        })\r\n                    ).update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob(x, y, callback?) {\r\n                let nobSize = 14;\r\n                let div = document.createElement(\"div\");\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                BB.css(div, {\r\n                    width: nobSize + \"px\",\r\n                    height: nobSize + \"px\",\r\n                    backgroundColor: \"#fff\",\r\n                    boxShadow: \"inset 0 0 0 2px #000\",\r\n                    borderRadius: nobSize + \"px\",\r\n                    position: \"absolute\",\r\n                    cursor: \"move\",\r\n                    left: ((div as any).x - nobSize / 2) + \"px\",\r\n                    top: ((div as any).y - nobSize / 2) + \"px\",\r\n                    userSelect: 'none',\r\n                    touchAction: 'none',\r\n                });\r\n\r\n                let pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    maxPointers: 1,\r\n                    onPointer: function(event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                            if (callback) {\r\n                                callback();\r\n                            }\r\n                            update();\r\n                        }\r\n                    }\r\n                });\r\n                (div as any).copy = function (p) {\r\n                    (div as any).x = p.x;\r\n                    (div as any).y = p.y;\r\n                    div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                    div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                };\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            function updateAfter() {\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            }\r\n\r\n            ba = nob(0, 0, updateAfter);\r\n            bb = nob(displayW, 0, updateAfter);\r\n            bc = nob(displayW, displayH, updateAfter);\r\n            bd = nob(0, displayH, updateAfter);\r\n            aa = nob(0, 0);\r\n            ab = nob(displayW, 0);\r\n            ac = nob(displayW, displayH);\r\n            ad = nob(0, displayH);\r\n\r\n            let before = false;\r\n            let beforeOption = document.createElement(\"div\");\r\n            BB.setEventListener(beforeOption, 'onpointerdown', function () {\r\n                return false;\r\n            });\r\n            beforeOption.textContent = LANG('filter-perspective-before');\r\n            beforeOption.style.width = \"150px\";\r\n            beforeOption.style.height = \"30px\";\r\n            beforeOption.style.marginLeft = isSmall ? '0' : \"100px\";\r\n            beforeOption.style.paddingTop = \"10px\";\r\n            beforeOption.style.textAlign = \"center\";\r\n            beforeOption.style.cssFloat = \"left\";\r\n            beforeOption.style.paddingBottom = \"0px\";\r\n            beforeOption.style.borderTopLeftRadius = \"10px\";\r\n            beforeOption.style.cursor = \"pointer\";\r\n            beforeOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            beforeOption.style.backgroundSize = '8%';\r\n\r\n            let afterOption = document.createElement(\"div\");\r\n            BB.setEventListener(afterOption, 'onpointerdown', function () {\r\n                return false;\r\n            });\r\n            afterOption.textContent = LANG('filter-perspective-after');\r\n            afterOption.style.width = \"150px\";\r\n            afterOption.style.height = \"30px\";\r\n            afterOption.style.paddingTop = \"10px\";\r\n            afterOption.style.textAlign = \"center\";\r\n            afterOption.style.cssFloat = \"left\";\r\n            afterOption.style.paddingBottom = \"0px\";\r\n            afterOption.style.borderTopRightRadius = \"10px\";\r\n            afterOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n            afterOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n            afterOption.style.backgroundSize = '8%';\r\n            afterOption.style.backgroundColor = \"#9e9e9e\";\r\n\r\n\r\n            BB.setEventListener(beforeOption, 'onpointerover', function () {\r\n                if (before === false)\r\n                    beforeOption.style.backgroundColor = \"#ccc\";\r\n            });\r\n            BB.setEventListener(beforeOption, 'onpointerout', function () {\r\n                if (before === false)\r\n                    beforeOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            });\r\n            BB.setEventListener(afterOption, 'onpointerover', function () {\r\n                if (before === true)\r\n                    afterOption.style.backgroundColor = \"#ccc\";\r\n            });\r\n            BB.setEventListener(afterOption, 'onpointerout', function () {\r\n                if (before === true)\r\n                    afterOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            });\r\n\r\n            beforeOption.onclick = function () {\r\n\r\n                beforeOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n                beforeOption.style.backgroundSize = '8%';\r\n                beforeOption.style.backgroundColor = \"#9e9e9e\";\r\n                beforeOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n                beforeOption.style.cursor = \"default\";\r\n\r\n                afterOption.style.background = \"\";\r\n                afterOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n                afterOption.style.boxShadow = \"\";\r\n                afterOption.style.cursor = \"pointer\";\r\n\r\n                aa.style.display = \"none\";\r\n                ab.style.display = \"none\";\r\n                ac.style.display = \"none\";\r\n                ad.style.display = \"none\";\r\n\r\n                ba.style.display = \"block\";\r\n                bb.style.display = \"block\";\r\n                bc.style.display = \"block\";\r\n                bd.style.display = \"block\";\r\n                ba.copy(aa);\r\n                bb.copy(ab);\r\n                bc.copy(ac);\r\n                bd.copy(ad);\r\n                before = true;\r\n                update();\r\n            };\r\n            afterOption.onclick = function () {\r\n                before = false;\r\n\r\n                afterOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n                afterOption.style.backgroundSize = '8%';\r\n                afterOption.style.backgroundColor = \"#9e9e9e\";\r\n                afterOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n                afterOption.style.cursor = \"default\";\r\n\r\n                beforeOption.style.background = \"\";\r\n                beforeOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n                beforeOption.style.boxShadow = \"\";\r\n                beforeOption.style.cursor = \"pointer\";\r\n\r\n                ba.style.display = \"none\";\r\n                bb.style.display = \"none\";\r\n                bc.style.display = \"none\";\r\n                bd.style.display = \"none\";\r\n\r\n                aa.style.display = \"block\";\r\n                ab.style.display = \"block\";\r\n                ac.style.display = \"block\";\r\n                ad.style.display = \"block\";\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            };\r\n\r\n            let optionWrapper = document.createElement(\"div\");\r\n            optionWrapper.appendChild(beforeOption);\r\n            optionWrapper.appendChild(afterOption);\r\n            div.appendChild(optionWrapper);\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n            BB.css(previewWrapper, {\r\n                width: isSmall ? '340px' : '540px',\r\n                marginLeft: \"-20px\",\r\n                height: isSmall ? '260px' : '300px',\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    let canvas = i === selectedLayerIndex ? glCanvas : layers[i].context.canvas;\r\n                    previewLayerArr.push({\r\n                        image: canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.appendChild(aa);\r\n            previewInnerWrapper.appendChild(ab);\r\n            previewInnerWrapper.appendChild(ac);\r\n            previewInnerWrapper.appendChild(ad);\r\n\r\n            ba.style.display = \"none\";\r\n            bb.style.display = \"none\";\r\n            bc.style.display = \"none\";\r\n            bd.style.display = \"none\";\r\n            previewInnerWrapper.appendChild(ba);\r\n            previewInnerWrapper.appendChild(bb);\r\n            previewInnerWrapper.appendChild(bc);\r\n            previewInnerWrapper.appendChild(bd);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n            update();\r\n            result.destroy = () => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    before: [\r\n                        ba.x / displayPreviewFactor,\r\n                        ba.y / displayPreviewFactor,\r\n\r\n                        bb.x / displayPreviewFactor,\r\n                        bb.y / displayPreviewFactor,\r\n\r\n                        bc.x / displayPreviewFactor,\r\n                        bc.y / displayPreviewFactor,\r\n\r\n                        bd.x / displayPreviewFactor,\r\n                        bd.y / displayPreviewFactor,\r\n                    ],\r\n                    after: [\r\n                        aa.x / displayPreviewFactor,\r\n                        aa.y / displayPreviewFactor,\r\n\r\n                        ab.x / displayPreviewFactor,\r\n                        ab.y / displayPreviewFactor,\r\n\r\n                        ac.x / displayPreviewFactor,\r\n                        ac.y / displayPreviewFactor,\r\n\r\n                        ad.x / displayPreviewFactor,\r\n                        ad.y / displayPreviewFactor,\r\n                    ]\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let before = params.input.before;\r\n        let after = params.input.after;\r\n        if (!context || !before || !after || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        let w = context.canvas.width;\r\n        let h = context.canvas.height;\r\n        glCanvas.draw(texture).perspective(before, after).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"perspective\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {Select} from '../ui/base-components/select';\r\n// @ts-ignore\r\nimport constrainImg from 'url:~/src/app/img/ui/constrain.svg';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterResize = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        //BB.centerWithin\r\n        let klCanvas = params.klCanvas;\r\n        if (!klCanvas)\r\n            return false;\r\n\r\n        let fit = BB.fitInto( klCanvas.getWidth(), klCanvas.getHeight(), 280, 200,1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let previewFactor = w / klCanvas.getWidth();\r\n        let tempCanvas = klCanvas.getCompleteCanvas(1);\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        let newWidth = klCanvas.getWidth(), newHeight = klCanvas.getHeight();\r\n\r\n        div.innerHTML = LANG('filter-resize-description') + \"<br/><br/>\";\r\n\r\n\r\n        let maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n\r\n        let widthWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            }\r\n        });\r\n        let heightWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            }\r\n        });\r\n        let widthInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxWidth,\r\n                value: '' + klCanvas.getWidth(),\r\n            }\r\n        }) as HTMLInputElement;\r\n        let heightInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxHeight,\r\n                value: '' + klCanvas.getHeight(),\r\n            }\r\n        }) as HTMLInputElement;\r\n        widthInput.onclick = function () {\r\n            (this as any).focus();\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onclick = function () {\r\n            (this as any).focus();\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthInput.onchange = function () {\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onchange = function () {\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthWrapper.append(LANG('width') + \": \", widthInput);\r\n        heightWrapper.append(LANG('height') + \": \", heightInput);\r\n        let inputWrapper = BB.el({\r\n            css: {\r\n                background: \"url(\" + constrainImg + \") no-repeat 140px 5px\",\r\n                backgroundSize: '50px 52px',\r\n            }\r\n        });\r\n        inputWrapper.append(widthWrapper, heightWrapper);\r\n        div.appendChild(inputWrapper);\r\n\r\n        //contrain checkbox\r\n        let heightChanged = false, widthChanged = false;\r\n        let ratio = klCanvas.getWidth() / klCanvas.getHeight();\r\n\r\n        function updateConstrain() {\r\n            if (isConstrained) {\r\n                widthInput.value = '' + klCanvas.getWidth();\r\n                heightInput.value = '' + klCanvas.getHeight();\r\n                inputWrapper.style.background = \"url(\" + constrainImg + \") no-repeat 140px 5px\";\r\n                inputWrapper.style.backgroundSize = '50px 52px';\r\n                update();\r\n            } else {\r\n                inputWrapper.style.background = \"\";\r\n            }\r\n        }\r\n\r\n        let isConstrained = true;\r\n        let constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isConstrained = b;\r\n                updateConstrain();\r\n            }\r\n        });\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both'\r\n            }\r\n        }));\r\n\r\n\r\n        let algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')]\r\n            ],\r\n            title: LANG('scaling-algorithm'),\r\n            initValue: 'smooth',\r\n            onChange: function() {\r\n                update();\r\n            },\r\n        });\r\n\r\n        let secondRowElement = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between'\r\n            }\r\n        });\r\n        secondRowElement.appendChild(constrainCheckbox.getElement());\r\n        secondRowElement.appendChild(algorithmSelect.getElement());\r\n\r\n        let previewCanvas = BB.canvas(w, h);\r\n        previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n\r\n        let previewCtx = previewCanvas.getContext('2d');\r\n\r\n\r\n        function draw() {\r\n            if (algorithmSelect.getValue() === 'smooth') {\r\n                previewCanvas.style.imageRendering = previewFactor > 1 ? 'pixelated' : '';\r\n\r\n                previewCanvas.width = klCanvas.getWidth();\r\n                previewCanvas.height = klCanvas.getHeight();\r\n\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingQuality = 'high';\r\n                previewCtx.drawImage(tempCanvas, 0, 0);\r\n                BB.resizeCanvas(previewCanvas, newWidth, newHeight);\r\n                previewCtx.restore();\r\n\r\n            } else {\r\n                previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n                previewCanvas.width = newWidth;\r\n                previewCanvas.height = newHeight;\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingEnabled = false;\r\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\r\n                previewCtx.restore();\r\n            }\r\n\r\n        }\r\n\r\n        function update() {\r\n            if ((widthInput.value.length === 0 && widthChanged) || (heightInput.value.length === 0 && heightChanged)) {\r\n                heightChanged = false;\r\n                widthChanged = false;\r\n                return;\r\n            }\r\n            widthInput.value = '' + Math.max(1, parseInt(widthInput.value));\r\n            heightInput.value = '' + Math.max(1, parseInt(heightInput.value));\r\n            if (isConstrained) {\r\n                if (heightChanged) {\r\n                    widthInput.value = '' + parseInt('' + (parseInt(heightInput.value) * ratio));\r\n                }\r\n                if (widthChanged) {\r\n                    heightInput.value = '' + parseInt('' + (parseInt(widthInput.value) / ratio));\r\n                }\r\n\r\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\r\n                    let fit = BB.fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\r\n                    widthInput.value = '' + parseInt('' + fit.width);\r\n                    heightInput.value = '' + parseInt('' + fit.height);\r\n                }\r\n            }\r\n\r\n            if (parseInt(widthInput.value) > maxWidth) {\r\n                widthInput.value = '' + maxWidth;\r\n            }\r\n            if (parseInt(heightInput.value) > maxHeight) {\r\n                heightInput.value = '' + maxHeight;\r\n            }\r\n\r\n            heightChanged = false;\r\n            widthChanged = false;\r\n\r\n            newWidth = parseInt(widthInput.value);\r\n            newHeight = parseInt(heightInput.value);\r\n\r\n            let preview = BB.fitInto(newWidth, newHeight, 280, 200, 1);\r\n            let previewW = parseInt('' + preview.width), previewH = parseInt('' + preview.height);\r\n            previewFactor = previewW / newWidth;\r\n\r\n            let offset = BB.centerWithin(340, 220, previewW, previewH);\r\n\r\n            draw();\r\n\r\n            previewCanvas.style.width = Math.max(1, previewW) + \"px\";\r\n            previewCanvas.style.height = Math.max(1, previewH) + \"px\";\r\n            canvasWrapper.style.left = offset.x + \"px\";\r\n            canvasWrapper.style.top = offset.y + \"px\";\r\n            canvasWrapper.style.width = Math.max(1, previewW) + \"px\";\r\n            canvasWrapper.style.height = Math.max(1, previewH) + \"px\";\r\n        }\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            display: \"table\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n\r\n        let canvasWrapper = BB.appendTextDiv(previewWrapper, \"\");\r\n        canvasWrapper.appendChild(previewCanvas);\r\n        canvasWrapper.style.width = w + \"px\";\r\n        canvasWrapper.style.height = h + \"px\";\r\n        canvasWrapper.style.position = \"absolute\";\r\n        canvasWrapper.style.overflow = \"hidden\";\r\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\r\n        canvasWrapper.style.overflow = \"hidden\";\r\n        BB.createCheckerDataUrl(8, function (url) {\r\n            previewWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n\r\n        div.appendChild(previewWrapper);\r\n        update();\r\n\r\n        result.destroy = () => {\r\n            constrainCheckbox.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return {\r\n                width: newWidth,\r\n                height: newHeight,\r\n                algorithm: algorithmSelect.getValue()\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        let width = params.input.width;\r\n        let height = params.input.height;\r\n        let algorithm = params.input.algorithm;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.resize(width, height, algorithm);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"resize\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2BZYe\");","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterRotate = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let klCanvas = params.klCanvas;\r\n        if (!klCanvas)\r\n            return false;\r\n\r\n        let fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let previewFactor = w / klCanvas.getWidth();\r\n        let tempCanvas = BB.canvas(w, h);\r\n        tempCanvas.style.display = 'block';\r\n        tempCanvas.getContext(\"2d\").drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        let deg = 0;\r\n        div.innerHTML = LANG('filter-rotate-description') + \"<br/><br/>\";\r\n\r\n        let first = true;\r\n\r\n        function update() {\r\n            (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg)\";\r\n            (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg)\";\r\n            (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg)\";\r\n            (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg)\";\r\n            if (Math.abs(deg % 180) === 90) {\r\n                //height has to fit width because of rotation\r\n                let fit = BB.fitInto(h, w, 280, 200, 1);\r\n                let scale = parseInt('' + fit.height) / w;\r\n                (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n                (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n                (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n                (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n            }\r\n        }\r\n\r\n        let btnPlus = document.createElement(\"button\");\r\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        let btnMinus = document.createElement(\"button\");\r\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        btnMinus.style.marginRight = '5px';\r\n\r\n\r\n        btnPlus.onclick = function () {\r\n            deg += 90;\r\n            update();\r\n        };\r\n        btnMinus.onclick = function () {\r\n            deg -= 90;\r\n            update();\r\n        };\r\n\r\n        div.appendChild(btnMinus);\r\n        div.appendChild(btnPlus);\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            display: \"table\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewcell = document.createElement(\"div\");\r\n        previewcell.style.display = \"table-cell\";\r\n        previewcell.style.verticalAlign = \"middle\";\r\n        let canvasWrapper = BB.appendTextDiv(previewcell, \"\");\r\n        canvasWrapper.appendChild(tempCanvas);\r\n        previewWrapper.appendChild(previewcell);\r\n        canvasWrapper.style.width = w + \"px\";\r\n        canvasWrapper.style.height = h + \"px\";\r\n        canvasWrapper.style.marginLeft = \"auto\";\r\n        canvasWrapper.style.marginRight = \"auto\";\r\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\r\n        canvasWrapper.style.overflow = \"hidden\";\r\n        BB.createCheckerDataUrl(4, function (url) {\r\n            canvasWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n        canvasWrapper.style.transition = \"all 0.2s ease-out\";\r\n\r\n        div.appendChild(previewWrapper);\r\n        update();\r\n\r\n        result.getInput = function () {\r\n            return {\r\n                deg: deg\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        let deg = params.input.deg;\r\n        if (!klCanvas || !history)\r\n            return false;\r\n        history.pause(true);\r\n        klCanvas.rotate(deg);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"rotate\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterTiltShift = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let previewFactor = w / context.canvas.width;\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        let pointerListenerArr = [];\r\n\r\n        function finishInit() {\r\n            let blur = 20, gradient = 200;\r\n            div.innerHTML = LANG('filter-tilt-shift-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n            let fa, fb; // focus line\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).tiltShift(\r\n                        fa.x / displayPreviewFactor * previewFactor,\r\n                        fa.y / displayPreviewFactor * previewFactor,\r\n                        fb.x / displayPreviewFactor * previewFactor,\r\n                        fb.y / displayPreviewFactor * previewFactor,\r\n                        blur * previewFactor,\r\n                        gradient * previewFactor\r\n                    ).update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob(x, y) {\r\n                let nobSize = 14;\r\n                let div = BB.el({\r\n                    css: {\r\n                        width: nobSize + \"px\",\r\n                        height: nobSize + \"px\",\r\n                        backgroundColor: '#fff',\r\n                        boxShadow: \"inset 0 0 0 2px #000\",\r\n                        borderRadius: nobSize + \"px\",\r\n                        position: \"absolute\",\r\n                        cursor: 'move',\r\n                        left: (x - nobSize / 2) + \"px\",\r\n                        top: (y - nobSize / 2) + \"px\",\r\n                        userSelect: 'none',\r\n                        touchAction: 'none',\r\n                    }\r\n                });\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                let pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    maxPointers: 1,\r\n                    onPointer: function(event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                            update();\r\n                        }\r\n                    }\r\n                });\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            fa = nob(parseInt('' + (displayW / 6)), parseInt('' + (displayH / 2)));\r\n            fb = nob(parseInt('' + (displayW - displayW / 6)), parseInt('' + (displayH - displayH / 3)));\r\n\r\n            let blurSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-blur'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                value: blur,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    blur = val;\r\n                    update();\r\n                },\r\n            });\r\n            blurSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(blurSlider.getElement());\r\n            let gradientSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-gradient'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1000,\r\n                value: gradient,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    gradient = val;\r\n                    update();\r\n                },\r\n            });\r\n            div.appendChild(gradientSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.appendChild(fa);\r\n            previewInnerWrapper.appendChild(fb);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n            update();\r\n            result.destroy = () => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                blurSlider.destroy();\r\n                gradientSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    a: {x: fa.x / displayPreviewFactor, y: fa.y / displayPreviewFactor},\r\n                    b: {x: fb.x / displayPreviewFactor, y: fb.y / displayPreviewFactor},\r\n                    blur: blur,\r\n                    gradient: gradient\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let a = params.input.a;\r\n        let b = params.input.b;\r\n        let blur = params.input.blur;\r\n        let gradient = params.input.gradient;\r\n        if (!context || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).tiltShift(a.x, a.y, b.x, b.y, blur, gradient).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"tiltShift\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {FreeTransform, ITransform} from '../ui/components/free-transform';\r\nimport {Select} from '../ui/base-components/select';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\ninterface IFilterTransformInput {\r\n    bounds: {x: number, y: number, width: number, height: number};\r\n    transform: ITransform;\r\n    isPixelated: boolean;\r\n}\r\n\r\nexport const filterTransform = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let i;\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let isSmall = window.innerWidth < 550;\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n        let freeTransform: FreeTransform;\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        // determine bounds and initial transformation\r\n        let boundsObj: {\r\n            x: number;\r\n            y: number;\r\n            width: number;\r\n            height: number;\r\n        } = { x: 0, y: 0, width: 0, height: 0 };\r\n        {\r\n            let tempBounds: any = {\r\n                x1: null,\r\n                y1: null,\r\n                x2: null,\r\n                y2: null\r\n            };\r\n            let imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\r\n\r\n            if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\r\n                tempBounds.x1 = 0;\r\n                tempBounds.y1 = 0;\r\n                tempBounds.x2 = context.canvas.width - 1;\r\n                tempBounds.y2 = context.canvas.height - 1;\r\n            } else {\r\n                for (i = 3; i < imdat.data.length; i += 4) {\r\n                    if (imdat.data[i] > 0 ) {\r\n                        let x = ((i - 3) / 4) %  context.canvas.width;\r\n                        let y = Math.floor((i - 3) / 4 / context.canvas.width);\r\n                        if (tempBounds.x1 > x || tempBounds.x1 === null) {\r\n                            tempBounds.x1 = x;\r\n                        }\r\n                        if (tempBounds.y1 === null) {\r\n                            tempBounds.y1 = y;\r\n                        }\r\n                        if (tempBounds.x2 < x || tempBounds.x2 === null) {\r\n                            tempBounds.x2 = x;\r\n                        }\r\n                        if (tempBounds.y2 < y || tempBounds.y2 === null) {\r\n                            tempBounds.y2 = y;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if (tempBounds.x1 === null || tempBounds.y1 === null) {\r\n                alert(LANG('filter-transform-empty'));\r\n                return false;\r\n            }\r\n            boundsObj.x = tempBounds.x1;\r\n            boundsObj.y = tempBounds.y1;\r\n            boundsObj.width = tempBounds.x2 - tempBounds.x1 + 1;\r\n            boundsObj.height = tempBounds.y2 - tempBounds.y1 + 1;\r\n        }\r\n\r\n        const initTransform = {\r\n            x: boundsObj.x + boundsObj.width / 2,\r\n            y: boundsObj.y + boundsObj.height / 2,\r\n            width: boundsObj.width,\r\n            height: boundsObj.height,\r\n            angleDeg: 0,\r\n        };\r\n\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        div.innerHTML = LANG('filter-transform-description');\r\n\r\n        let keyListener = new BB.KeyListener({\r\n            onDown: function(keyStr) {\r\n                if (BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n\r\n                if (keyStr === 'left') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'right') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'up') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'down') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n            }\r\n\r\n        });\r\n\r\n        let leftWrapper = document.createElement(\"div\");\r\n        let rightWrapper = document.createElement(\"div\");\r\n        let rotWrapper = document.createElement(\"div\");\r\n        let inputY = document.createElement(\"input\");\r\n        let inputX = document.createElement(\"input\");\r\n        let inputR = document.createElement(\"input\");\r\n        leftWrapper.style.width = \"100px\";\r\n        leftWrapper.style.height = \"30px\";\r\n        rightWrapper.style.width = \"100px\";\r\n        rightWrapper.style.height = \"30px\";\r\n        rightWrapper.style.display = \"inline-block\";\r\n        leftWrapper.style.display = \"inline-block\";\r\n        rotWrapper.style.display = \"inline-block\";\r\n        rotWrapper.style.width = \"150px\";\r\n        rotWrapper.style.height = \"30px\";\r\n        inputY.type = \"number\";\r\n        inputX.type = \"number\";\r\n        inputR.type = \"number\";\r\n        inputX.style.width = 70 + \"px\";\r\n        inputY.style.width = 70 + \"px\";\r\n        inputR.style.width = 70 + \"px\";\r\n        inputY.value = '0';\r\n        inputX.value = '0';\r\n        inputR.value = '0';\r\n        inputY.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputX.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputR.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputY.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputY.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        leftWrapper.append(\"X: \", inputX);\r\n        rightWrapper.append(\"Y: \", inputY);\r\n        rotWrapper.append(LANG('filter-transform-rotation') + ': ', inputR);\r\n        if (!isSmall) {\r\n            const inputRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\r\n        }\r\n\r\n        // buttons\r\n        const actionBtnCss = {\r\n            marginLeft: '10px',\r\n            marginTop: '10px',\r\n        };\r\n        const buttonRow = BB.el ({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginLeft: '-10px',\r\n            }\r\n        });\r\n        const flipXBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' X',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(-t.width, t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const flipYBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' Y',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(t.width, -t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotLeftBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '-90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg -= 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotRightBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '+90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg += 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleDoubleBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                if (constrainCheckbox.getValue()) {\r\n                    freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\r\n                } else {\r\n                    freeTransform.setSize(t.width * 2, t.height * 2);\r\n                }\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleHalfBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '1/2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const centerBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('center'),\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setPos({ x: context.canvas.width / 2, y: context.canvas.height / 2 });\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n\r\n\r\n\r\n\r\n\r\n        let isConstrained = true;\r\n        let constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-constrain'),\r\n            title: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isConstrained = b;\r\n                freeTransform.setConstrained(isConstrained);\r\n            },\r\n            css: {\r\n                display: 'inline-block'\r\n            }\r\n        });\r\n        let isSnapping = false;\r\n        let snappingCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-snap'),\r\n            title: LANG('filter-transform-snap-title'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isSnapping = b;\r\n                freeTransform.setSnapping(isSnapping);\r\n            },\r\n            css: {\r\n                display: 'inline-block',\r\n                marginLeft: '10px',\r\n            }\r\n        });\r\n        const checkboxWrapper = BB.el({});\r\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\r\n\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n                height: '10px'\r\n            }\r\n        }));\r\n\r\n        const bottomRow = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n            }\r\n        });\r\n\r\n        let algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')]\r\n            ],\r\n            initValue: 'smooth',\r\n            title: LANG('scaling-algorithm'),\r\n            onChange: function() {\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        BB.css(previewWrapper, {\r\n            width: isSmall ? '340px' : '540px',\r\n            marginLeft: \"-20px\",\r\n            height: isSmall ? '260px' : '300px',\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayerArr: IKlBasicLayer[] = [];\r\n        {\r\n            for (let i = 0; i < layers.length; i++) {\r\n                let canvas;\r\n                if (i === selectedLayerIndex) {\r\n                    canvas = BB.canvas(parseInt('' + w), parseInt('' + h));\r\n                    let ctx = canvas.getContext('2d');\r\n                    ctx.drawImage(layers[i].context.canvas, 0, 0, canvas.width, canvas.height);\r\n                } else {\r\n                    canvas = layers[i].context.canvas;\r\n                }\r\n                previewLayerArr.push({\r\n                    image: canvas,\r\n                    opacity: layers[i].opacity,\r\n                    mixModeStr: layers[i].mixModeStr\r\n                });\r\n            }\r\n        }\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: parseInt('' + displayW),\r\n            height: parseInt('' + displayH),\r\n            layers: previewLayerArr\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + displayW) + 'px',\r\n                height: parseInt('' + displayH) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        let lastDrawnTransformStr;\r\n        function updatePreview(doForce: boolean = false) {\r\n            if (!freeTransform) {\r\n                return;\r\n            }\r\n            let transform = freeTransform.getTransform();\r\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) {\r\n                return;\r\n            }\r\n            lastDrawnTransformStr = JSON.stringify(transform);\r\n            if (displayPreviewFactor < 1) {\r\n                transform.x *= displayPreviewFactor;\r\n                transform.y *= displayPreviewFactor;\r\n                transform.width *= displayPreviewFactor;\r\n                transform.height *= displayPreviewFactor;\r\n            }\r\n            let transformLayerCanvas = previewLayerArr[selectedLayerIndex].image as HTMLCanvasElement;\r\n            let ctx = transformLayerCanvas.getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, transformLayerCanvas.width, transformLayerCanvas.height);\r\n            BB.drawTransformedImageWithBounds(\r\n                ctx,\r\n                layers[selectedLayerIndex].context.canvas,\r\n                transform,\r\n                boundsObj,\r\n                algorithmSelect.getValue() === 'pixelated' ||\r\n                BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            );\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: initTransform.angleDeg,\r\n            isConstrained: true,\r\n            snapX: [0, context.canvas.width],\r\n            snapY: [0, context.canvas.height],\r\n            callback: function (t) {\r\n                inputX.value = '' + Math.round(t.x - initTransform.x);\r\n                inputY.value = '' + Math.round(t.y - initTransform.y);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            scale: displayPreviewFactor\r\n        });\r\n        BB.css(freeTransform.getElement(), {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0'\r\n        });\r\n        previewInnerWrapper.appendChild(freeTransform.getElement());\r\n\r\n        function onInputsChanged() {\r\n            freeTransform.setPos({\r\n                x: parseInt(inputX.value) + initTransform.x,\r\n                y: parseInt(inputY.value) + initTransform.y}\r\n            );\r\n            freeTransform.setAngleDeg(parseInt(inputR.value));\r\n            updatePreview();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            keyListener.destroy();\r\n            freeTransform.destroy();\r\n            constrainCheckbox.destroy();\r\n            snappingCheckbox.destroy();\r\n            BB.destroyEl(flipXBtn);\r\n            BB.destroyEl(flipYBtn);\r\n            BB.destroyEl(scaleRotLeftBtn);\r\n            BB.destroyEl(scaleRotRightBtn);\r\n            BB.destroyEl(scaleDoubleBtn);\r\n            BB.destroyEl(scaleHalfBtn);\r\n            BB.destroyEl(centerBtn);\r\n        };\r\n        result.getInput = function () {\r\n            const transform = freeTransform.getTransform();\r\n            let input = {\r\n                transform,\r\n                bounds: boundsObj,\r\n                isPixelated: algorithmSelect.getValue() === 'pixelated' ||\r\n                    BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            } as IFilterTransformInput;\r\n            result.destroy();\r\n            return JSON.parse(JSON.stringify(input));\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const input: IFilterTransformInput = params.input;\r\n\r\n        let copyCanvas = BB.copyCanvas(context.canvas);\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            context,\r\n            copyCanvas,\r\n            input.transform,\r\n            input.bounds,\r\n            input.isPixelated,\r\n        );\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"transform\"],\r\n            action: \"apply\",\r\n            params: [{input}],\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterBlur = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let klCanvas = params.klCanvas;\r\n        let context = params.context;\r\n        if (!klCanvas || !context) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let previewFactor = w / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n\r\n        function finishInit() {\r\n            let radius = 10;\r\n            div.innerHTML = LANG('filter-triangle-blur-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 1,\r\n                max: 200,\r\n                value: radius,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    radius = val;\r\n                    glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            div.appendChild(radiusSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                texture.destroy();\r\n                radiusSlider.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let radius = params.input.radius;\r\n        if (!context || !radius || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).triangleBlur(radius).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"blur\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterUnsharpMask = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let previewFactor = w / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        function finishInit() {\r\n            let radius = 2, strength = 5.1 / 10;\r\n            div.innerHTML = LANG('filter-unsharp-mask-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                value: 2,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    radius = val;\r\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 50], [1, 200]],\r\n            });\r\n            let strengthSlider = new KlSlider({\r\n                label: LANG('filter-unsharp-mask-strength'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 50,\r\n                value: 5.1,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    strength = val / 10;\r\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 10], [1, 50]],\r\n            });\r\n            radiusSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(radiusSlider.getElement());\r\n            div.appendChild(strengthSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                radiusSlider.destroy();\r\n                strengthSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius,\r\n                    strength: strength\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let radius = params.input.radius;\r\n        let strength = params.input.strength;\r\n        if (!context || radius === null || strength === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).unsharpMask(radius, strength).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"unsharpMask\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterToAlpha = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        function finishInit() {\r\n            let radius = 2, strength = 5.1 / 10;\r\n            div.appendChild(BB.el({\r\n                content: LANG('filter-to-alpha-description'),\r\n                css: {\r\n                    marginBottom: '5px'\r\n                }\r\n            }));\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            function updatePreview() {\r\n                glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n                klCanvasPreview.render();\r\n            }\r\n\r\n            // source\r\n            let sourceId = 'inverted-luminance';\r\n            let sourceOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'inverted-luminance',\r\n                        label: LANG('filter-to-alpha-inverted-lum')\r\n                    },\r\n                    {\r\n                        id: 'luminance',\r\n                        label: LANG('filter-to-alpha-lum')\r\n                    }\r\n                ],\r\n                initialId: sourceId,\r\n                onChange: function(id) {\r\n                    sourceId = id;\r\n                    updatePreview();\r\n                }\r\n            });\r\n            div.appendChild(sourceOptions.getElement());\r\n\r\n            // color\r\n            let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n            let colorOptionsArr = [\r\n                null,\r\n                {r: 0, g: 0, b: 0, a: 1},\r\n                {r: 255, g: 255, b: 255, a: 1}\r\n            ];\r\n            colorOptionsArr.push({\r\n                r: params.currentColorRgb.r,\r\n                g: params.currentColorRgb.g,\r\n                b: params.currentColorRgb.b,\r\n                a: 1,\r\n            });\r\n            colorOptionsArr.push({\r\n                r: params.secondaryColorRgb.r,\r\n                g: params.secondaryColorRgb.g,\r\n                b: params.secondaryColorRgb.b,\r\n                a: 1,\r\n            });\r\n\r\n            let colorOptions = new ColorOptions({\r\n                label: LANG('filter-to-alpha-replace'),\r\n                colorArr: colorOptionsArr,\r\n                initialIndex: 1,\r\n                onChange: function(rgbaObj) {\r\n                    selectedRgbaObj = rgbaObj;\r\n                    updatePreview();\r\n                }\r\n            });\r\n            colorOptions.getElement().style.marginTop = '10px';\r\n            div.appendChild(colorOptions.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            setTimeout(function() { //ie has a problem otherwise...\r\n                try {\r\n                    updatePreview();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }, 1);\r\n\r\n            result.destroy = () => {\r\n                texture.destroy();\r\n                sourceOptions.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    sourceId: sourceId,\r\n                    selectedRgbaObj: selectedRgbaObj\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let sourceId = params.input.sourceId;\r\n        let selectedRgbaObj = params.input.selectedRgbaObj;\r\n        if (!context || !sourceId || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"toAlpha\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {input} from '../ui/base-components/input';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {drawGrid} from '../image-operations/draw-grid';\r\n\r\n\r\n\r\nexport const filterGrid = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        div.innerHTML = LANG('filter-grid-description') + \"<br/><br/>\";\r\n\r\n        const settingsObj = {\r\n            x: 2,\r\n            y: 2,\r\n            thickness: 2,\r\n            color: '#000',\r\n            opacity: 1,\r\n        };\r\n\r\n        let line1 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            }\r\n        });\r\n        let line2 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px'\r\n            }\r\n        });\r\n        const xInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.x = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const yInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.y = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const thicknessInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.thickness = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n        settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('shape-stroke'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function(rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            marginRight: '5px',\r\n        };\r\n        line1.append(\r\n            BB.el({content: 'X:', css: labelStyle}),\r\n            xInput,\r\n            BB.el({content: 'Y:', css: labelStyle}),\r\n            yInput,\r\n        );\r\n        line2.append(\r\n            BB.el({content: LANG('brush-size') + ':', css: labelStyle}),\r\n            thicknessInput,\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorOptions.getElement(),\r\n        );\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            })\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        function updatePreview() {\r\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n            drawGrid(ctx, settingsObj.x, settingsObj.y, Math.max(settingsObj.thickness * renderFactor, 1), settingsObj.color, settingsObj.opacity);\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        drawGrid(context, params.input.x, params.input.y, params.input.thickness, params.input.color, params.input.opacity);\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: [\"filter\", \"grid\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    },\r\n\r\n};","\r\n// ideas: padding, gutter, other shapes\r\n\r\nexport function drawGrid(\r\n    ctx: CanvasRenderingContext2D,\r\n    cellsX: number,\r\n    cellsY: number,\r\n    thickness: number, // px\r\n    color: string,\r\n    opacity: number, // 0 - 1\r\n) {\r\n    ctx.save();\r\n    const w = ctx.canvas.width;\r\n    const h = ctx.canvas.height;\r\n    thickness = Math.round(thickness);\r\n    const thickIsRound = thickness % 2 === 0;\r\n\r\n    ctx.beginPath();\r\n    ctx.lineWidth = thickness;\r\n    ctx.strokeStyle = color;\r\n    ctx.globalAlpha = opacity;\r\n\r\n    for(let i = 0; i < cellsX - 1; i++) {\r\n        const cw = w / (cellsX);\r\n        let pos = cw * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n        ctx.moveTo(pos, 0);\r\n        ctx.lineTo(pos, h);\r\n\r\n    }\r\n    for(let i = 0; i < cellsY - 1; i++) {\r\n        const ch = h / (cellsY);\r\n        let pos = ch * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n\r\n        ctx.moveTo(0, pos);\r\n        ctx.lineTo(w, pos);\r\n    }\r\n\r\n    ctx.stroke();\r\n    ctx.restore();\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode, IRGB} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {eventResMs} from './filters-consts';\r\nimport {Select} from '../ui/base-components/select';\r\nimport {translateBlending} from '../canvas/translate-blending';\r\nimport {KL} from '../kl';\r\nimport {ColorConverter} from '../../bb/color/color';\r\n// @ts-ignore\r\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\n\r\n// see noise(...) in glfx.ts\r\ninterface INoisePreset {\r\n    type: number;\r\n    scaleX: number;\r\n    scaleY: number;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    octaves: number;\r\n    samples: number;\r\n    peaks: number;\r\n    brightness: number;\r\n    contrast: number;\r\n    doInvert: boolean;\r\n}\r\n\r\ntype TNoiseChannels = 'rgb' | 'alpha';\r\n\r\ninterface INoiseSettings extends INoisePreset {\r\n    seed: number;\r\n    colA: IRGB;\r\n    colB: IRGB;\r\n    channels: TNoiseChannels;\r\n}\r\n\r\ninterface INoiseFilterInput {\r\n    seed: number;\r\n    presetIndex: number; // which preset from presetArr\r\n    scale: number; // applies to both scaleX and scaleX\r\n    opacity: number; // aka strength\r\n    doInvert: boolean;\r\n    channels: TNoiseChannels;\r\n\r\n    // only for channels = rgb\r\n    mixModeStr: GlobalCompositeOperation; // how mixed with image\r\n    colA: IRGB;\r\n    colB: IRGB;\r\n}\r\n\r\nconst presetArr: INoisePreset[] = [\r\n    // each pixel random value\r\n    {type: 0, scaleX: 1, scaleY: 1, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, doInvert: true},\r\n\r\n    // cloud\r\n    {type: 1, scaleX: 166, scaleY: 164, offsetX: 105, offsetY: 30, octaves: 6, samples: 1, peaks: 0, brightness: 0.055, contrast: 0.23, doInvert: true},\r\n\r\n    // thin lines\r\n    {type: 1, scaleX: 235, scaleY: 190, offsetX: 3227, offsetY: 2156, octaves: 4, samples: 16, peaks: 22, brightness: -0.375, contrast: 1, doInvert: false},\r\n\r\n    // soft large simplex, only 1 octave\r\n    {type: 1, scaleX: 40, scaleY: 40, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, doInvert: false},\r\n\r\n    // two value large pixels\r\n    {type: 0, scaleX: 26, scaleY: 26, offsetX: 557, offsetY: 365, octaves: 1, samples: 1, peaks: 0, brightness: 0.02, contrast: 1, doInvert: true},\r\n\r\n    // zebra\r\n    {type: 1, scaleX: 1500, scaleY: 1500, offsetX: 745, offsetY: 2871, octaves: 5, samples: 16, peaks: 156.02, brightness: 0.03, contrast: 1, doInvert: true},\r\n\r\n    // sparse dots / stars\r\n    {type: 1, scaleX: 11, scaleY: 11, offsetX: 2940, offsetY: 2045, octaves: 1, samples: 16, peaks: 1, brightness: -0.045, contrast: 1, doInvert: true},\r\n\r\n    // pseudo marble\r\n    {type: 2, scaleX: 74, scaleY: 74, offsetX: 4816, offsetY: 1304, octaves: 3, samples: 1, peaks: 2.78, brightness: 0, contrast: 0, doInvert: false},\r\n];\r\n\r\nfunction drawNoise(glCanvas, settings: INoiseSettings): void {\r\n    glCanvas.noise(\r\n        settings.seed  ? settings.seed : 0,\r\n        settings.type,\r\n        [settings.scaleX, settings.scaleY],\r\n        [glCanvas.width / 2, glCanvas.height / 2],\r\n        settings.octaves,\r\n        settings.samples,\r\n        settings.peaks,\r\n        settings.brightness,\r\n        settings.contrast,\r\n        settings.doInvert,\r\n        settings.colA,\r\n        settings.colB,\r\n        settings.channels ? settings.channels : 'rgb',\r\n    ).update();\r\n}\r\n\r\n\r\nexport const filterNoise = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n\r\n\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return; // todo throw?\r\n        }\r\n        let texture;\r\n\r\n        const thumbImgArr = [];\r\n        const thumbSize = 32;\r\n        {\r\n            const canvas = BB.canvas(thumbSize, thumbSize);\r\n            const ctx = canvas.getContext('2d');\r\n            texture = glCanvas.texture(canvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n            texture.destroy();\r\n\r\n            presetArr.forEach((preset, index) => {\r\n                const thumbImg = new Image();\r\n                const presetCopy = BB.copyObj(preset);\r\n                presetCopy.scaleX /= 10;\r\n                presetCopy.scaleY /= 10;\r\n                drawNoise(glCanvas, presetCopy);\r\n                ctx.drawImage(glCanvas, 0, 0);\r\n                thumbImg.src = canvas.toDataURL('image/png');\r\n                thumbImgArr.push(thumbImg);\r\n            });\r\n\r\n        }\r\n\r\n        let tempCanvas = BB.canvas(renderW, renderH);\r\n        texture = glCanvas.texture(tempCanvas);\r\n        glCanvas.draw(texture).update(); // update glCanvas size\r\n        tempCanvas = null;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        div.innerHTML = LANG('filter-noise-description') + \"<br/><br/>\";\r\n\r\n        const settingsObj: INoiseFilterInput = {\r\n            seed: Math.random() * 300,\r\n            presetIndex: 0,\r\n            scale: 50,\r\n            opacity: 0.5,\r\n            doInvert: false,\r\n            channels: 'rgb',\r\n            mixModeStr: 'source-over' as GlobalCompositeOperation,\r\n            colA: {r: 0, g: 0, b: 0},\r\n            colB: {r: 255, g: 255, b: 255},\r\n        };\r\n\r\n\r\n        const presetOptions = new Options({\r\n            optionArr: thumbImgArr.map((img, index) => {\r\n                BB.css(img, {\r\n                    margin: '1px',\r\n                    borderRadius: '3px',\r\n                    transition: 'all 0.1s ease-in-out',\r\n                })\r\n                return {\r\n                    id: '' + index,\r\n                    label: img,\r\n                };\r\n            }),\r\n            initialId: '0',\r\n            onChange: (id) => {\r\n                settingsObj.presetIndex = Number(id);\r\n                updatePreview();\r\n            }\r\n        });\r\n        presetOptions.getElement().style.marginBottom = '10px';\r\n        div.append(presetOptions.getElement());\r\n\r\n        const scaleSlider = new KlSlider({\r\n            label: LANG('filter-noise-scale'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1,\r\n            max: 1000,\r\n            value: settingsObj.scale,\r\n            eventResMs: eventResMs,\r\n            curve: BB.quadraticSplineInput(1, 1000, 0.1),\r\n            onChange: (value) => {\r\n                settingsObj.scale = value;\r\n                updatePreview();\r\n            },\r\n        });\r\n        scaleSlider.getElement().style.marginBottom = \"10px\";\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: settingsObj.opacity,\r\n            eventResMs: eventResMs,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n            onChange: (value) => {\r\n                settingsObj.opacity = value;\r\n                updatePreview();\r\n            },\r\n        });\r\n        opacitySlider.getElement().style.marginBottom = \"10px\";\r\n\r\n        const row1El = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginBottom: '10px',\r\n            }\r\n        });\r\n\r\n        const row2El = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n\r\n        const channelsOptions = new Options({\r\n            optionArr: [\r\n                {id: 'rgb', label: 'RGB'},\r\n                {id: 'alpha', label: LANG('filter-noise-alpha')},\r\n            ],\r\n            initialId: 'rgb',\r\n            onChange: (id: TNoiseChannels) => {\r\n                settingsObj.channels = id;\r\n                if (id === 'rgb') {\r\n                    row2El.style.visibility = '';\r\n                } else {\r\n                    row2El.style.visibility = 'hidden';\r\n                }\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const invertedToggle = new Checkbox({\r\n            label: LANG('filter-noise-inverted'),\r\n            callback: (val) => {\r\n                settingsObj.doInvert = val;\r\n                updatePreview();\r\n            },\r\n            allowTab: true,\r\n        });\r\n\r\n        const blendSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                'source-over',\r\n                null,\r\n                'darken',\r\n                'multiply',\r\n                'color-burn',\r\n                null,\r\n                'lighten',\r\n                'screen',\r\n                'color-dodge',\r\n                null,\r\n                'overlay',\r\n                'soft-light',\r\n                'hard-light',\r\n                null,\r\n                'difference',\r\n                'exclusion',\r\n                null,\r\n                'hue',\r\n                'saturation',\r\n                'color',\r\n                'luminosity',\r\n            ].map((item: IMixMode) => {\r\n                return item ? [item, translateBlending(item)] : null;\r\n            }),\r\n            initValue: settingsObj.mixModeStr,\r\n            onChange: (val: GlobalCompositeOperation) => {\r\n                settingsObj.mixModeStr = val;\r\n                updatePreview();\r\n            },\r\n        });\r\n        blendSelect.getElement().title = LANG('layers-blending');\r\n\r\n        const colorWrapper = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n\r\n        const colInputStyle = {\r\n            width: '34px',\r\n            height: '34px',\r\n            marginRight: '5px',\r\n        }\r\n        const colAInput = KL.input({\r\n            type: 'color',\r\n            init: '#' + ColorConverter.toHexString(settingsObj.colA),\r\n            callback: (val) => {\r\n                settingsObj.colA = ColorConverter.hexToRGB(val);\r\n                updatePreview();\r\n            },\r\n            css: colInputStyle,\r\n        });\r\n\r\n        const colBInput = KL.input({\r\n            type: 'color',\r\n            init: '#' + ColorConverter.toHexString(settingsObj.colB),\r\n            callback: (val) => {\r\n                settingsObj.colB = ColorConverter.hexToRGB(val);\r\n                updatePreview();\r\n            },\r\n            css: colInputStyle,\r\n        });\r\n\r\n        colorWrapper.append(\r\n            colAInput,\r\n            colBInput,\r\n        );\r\n\r\n\r\n        row1El.append(\r\n            channelsOptions.getElement(),\r\n            BB.el({css:{flexGrow: '1',}}),\r\n            invertedToggle.getElement(),\r\n        );\r\n\r\n        row2El.append(\r\n            blendSelect.getElement(),\r\n            BB.el({css:{flexGrow: '1',}}),\r\n            colorWrapper,\r\n        );\r\n\r\n        div.append(\r\n            scaleSlider.getElement(),\r\n            opacitySlider.getElement(),\r\n            row1El,\r\n            row2El,\r\n        );\r\n\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            })\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        function updatePreview() {\r\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n\r\n            ctx.globalAlpha = settingsObj.opacity;\r\n\r\n            const presetCopy = BB.copyObj(presetArr[settingsObj.presetIndex]);\r\n            presetCopy.seed = settingsObj.seed;\r\n            presetCopy.scaleX = presetCopy.scaleX  * settingsObj.scale / 50 * renderFactor;\r\n            presetCopy.scaleY = presetCopy.scaleY  * settingsObj.scale / 50 * renderFactor;\r\n            presetCopy.colA = settingsObj.colA;\r\n            presetCopy.colB = settingsObj.colB;\r\n            presetCopy.doInvert = settingsObj.doInvert ? !presetCopy.doInvert : presetCopy.doInvert;\r\n            presetCopy.channels  = settingsObj.channels;\r\n            drawNoise(glCanvas, presetCopy);\r\n\r\n            if (settingsObj.channels === 'alpha') {\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n            } else {\r\n                ctx.globalCompositeOperation = settingsObj.mixModeStr;\r\n            }\r\n\r\n            ctx.drawImage(glCanvas, 0, 0);\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            presetOptions.destroy();\r\n            scaleSlider.destroy();\r\n            opacitySlider.destroy();\r\n            invertedToggle.destroy();\r\n            channelsOptions.destroy();\r\n            texture.destroy();\r\n            blendSelect.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).update();\r\n        texture.destroy();\r\n\r\n        const input: INoiseFilterInput = params.input;\r\n\r\n        const presetCopy = BB.copyObj(presetArr[input.presetIndex]);\r\n        presetCopy.seed = input.seed;\r\n        presetCopy.scaleX = presetCopy.scaleX  * input.scale / 50;\r\n        presetCopy.scaleY = presetCopy.scaleY  * input.scale / 50;\r\n        presetCopy.colA = input.colA;\r\n        presetCopy.colB = input.colB;\r\n        presetCopy.doInvert = input.doInvert ? !presetCopy.doInvert : presetCopy.doInvert;\r\n        presetCopy.channels  = input.channels;\r\n        drawNoise(glCanvas, presetCopy);\r\n\r\n        context.save();\r\n        context.globalAlpha = input.opacity;\r\n        if (input.channels === 'alpha') {\r\n            context.globalCompositeOperation = 'destination-out';\r\n        } else {\r\n            context.globalCompositeOperation = input.mixModeStr;\r\n        }\r\n        context.drawImage(glCanvas, 0, 0);\r\n        context.restore();\r\n\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [\r\n                klCanvas.getLayerIndex(context.canvas),\r\n                context.getImageData(0, 0, context.canvas.width, context.canvas.height),\r\n            ]\r\n        });\r\n        return true;\r\n    },\r\n\r\n};","import {KL} from '../kl';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\n\r\nexport async function klCanvasToPsdBlob(klCanvas: KlCanvas): Promise<Blob> {\r\n    let layerArr = klCanvas.getLayersFast();\r\n\r\n    let psdConfig = {\r\n        width: klCanvas.getWidth(),\r\n        height: klCanvas.getHeight(),\r\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\r\n        children: []\r\n    };\r\n    for (let i = 0; i < layerArr.length; i++) {\r\n        // todo - can be optimized if layer mostly empty\r\n        let item = layerArr[i];\r\n        psdConfig.children.push({\r\n            name: item.name,\r\n            opacity: item.opacity,\r\n            canvas: item.canvas,\r\n            blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n            left: 0,\r\n            top: 0\r\n        });\r\n    }\r\n\r\n    let agPsd = await import('ag-psd');\r\n    let buffer = agPsd.writePsdBuffer(psdConfig);\r\n    return new Blob([buffer], { type: 'application/octet-stream' });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"k9Nks\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"bBxqy\");"],"names":["$3kC7t","parcelRequire","$d2fa9a947070c225$export$a84540bc8b694b2d","p","klApp","agPsd","onProjectReady","project","isInitialized","Error","saveReminder","$5ngYX","SaveReminder","$gWfkn","klHistory","isDrawing","$3C7jC","KlApp","bottomBar","aboutEl","embed","url","embedUrl","onSubmit","init","loadingScreenEl","parentNode","removeChild","loadingScreenTextEl","document","body","appendChild","getEl","e","textContent","className","console","error","psdQueue","getElementById","$1mH1z","LANG","this","openProject","initError","getPNG","getPSD","default","$parcel$interopDefault","$cijLd","mark","_callee","readPSDs","psds","length","readItem","item","psd","readPsd","blob","$941rU","klPsdToKlProject","callback","forEach","_ctx","sent","shift","push","Element","prototype","Object","defineProperty","value","x","y","scrollLeft","scrollTop","window","getItem","setItem","removeItem","t","Array","slice","call","arguments","n","createDocumentFragment","Node","createTextNode","String","Document","DocumentFragment","hasOwnProperty","configurable","enumerable","writable","insertBefore","firstChild","padStart","repeat","$cf5d938ee512ebca$export$96f6458b62e4c2c","pProject","pOptions","ref","translateSmoothing","s","sizeWatcher","val","brushSettingService","emitSize","klCanvasWorkspace","setCursorSize","importFinishedLoading","importedImage","filename","optionStr","getResizedDimensions","width","height","w","parseInt","h","klMaxCanvasSize","importAsImage","canvas","resizedDimensions","tempCanvas","$eWjiX","BB","getContext","drawImage","resizeCanvas","reset","image","layerName","layerManager","update","setCurrentLayer","klCanvas","getLayer","resetView","handUi","getScale","getAngleDeg","importAsImagePsd","convertedPsdObj","cropObj","crop","targetCanvas","cropCanvas","layers","i","layerIndex","i1","item1","KL","showImportAsLayerDialog","klRootEl","transformObj","isPixelated","pause","addLayer","getLayers","renameLayer","activeLayerIndex","activeLayerContext","getLayerContext","drawTransformedImageWithBounds","tool","action","params","copyCanvas","isNaN","popup","type","message","buttons","$hrnUX","showImportImageDialog","target","maxSize","res","importAsLayer","files","showWarningPsdFlattened","file","name","split","extension","toLowerCase","f","size","loaderIsOpen","result","closeLoader","FileReader","readerResult","loadAgPsd","then","agPsdLazy","doShowLoader","maxResolution","replace","convertedPsd","PSD","skipLayerImageData","skipThumbnail","e1","catch","alert","match","URL","webkitURL","createObjectURL","im","Image","src","loadImage","hasUnsupportedFile","collapseThreshold","getElement","style","display","setDirection","uiState","isOpen","css","toolspaceCollapser","left","right","setSize","Math","max","uiWidth","toolWidth","uiHeight","setWide","statusOverlay","toolspace","borderLeft","borderRight","setUiState","updateCollapse","toolspaceScroller","updateUiState","layer","currentLayerCtx","context","currentBrush","setContext","layerPreview","setLayer","newImageDialog","currentColor","klColorSlider","getSecondaryRGB","getWidth","getHeight","innerWidth","color","a","onCancel","shareImage","shareCanvas","getCompleteCanvas","fileName","getDate","filenameBase","title","updateMainTabVisibility","mainTabRow","activeStr","toolspaceToolRow","getActive","oldTabId","getOpenedTabId","keysArr","keys","draw","fill","text","shape","setIsVisible","open","showCrop","clipboardDialog","inputObj","top","bottom","filterLib","cropExtend","apply","input","history","updateBottomBar","isVisible","innerHeight","toolspaceInner","scrollHeight","bottomBarWrapper","min","screen","$6l0gQ","LocalStorage","app","projectStore","createElement","exportType","KlCanvas","projectObj","setHistory","layerFill","b","initState","copy","focus","getLayerCount","brushes","destroy","currentBrushId","RGB","lastNonEraserBrushId","BrushSettingService","setColor","copyObj","opacity","setOpacity","getColor","brushUiObj","getSize","getOpacity","sizeSlider","brushesUI","opacitySlider","lineSmoothing","EventChain","LineSmoothing","smoothing","LineSanitizer","lineSanitizer","setChainOut","event","pointerEvents","startLine","pressure","requestFrame","goLine","isCoalesced","setLastDrawEvent","endLine","getBrush","drawLineSegment","x0","y0","x1","y1","textToolSettings","align","isBold","isItalic","KlCanvasWorkspace","drawEventChain","chainIn","rgbObj","isDragDone","pickingDone","setMode","canvasX","canvasY","getLayerIndex","floodFill","fillUi","getTolerance","getSample","getGrow","getContiguous","angleRad","dialogCounter","get","textToolDialog","font","colorRGBA","textStr","ColorConverter","toRgbaStr","typeStr","shapeTool","onDown","onMove","onUp","viewChangeObj","changed","includes","out","scale","angleDeg","angle","PI","setEnableZoomIn","getMaxScale","setEnableZoomOut","getMinScale","canUndo","undoRedoCatchup","undo","canRedo","redo","KeyListener","keyStr","comboStr","isInputFocused","getIsDrawing","zoomByStep","keyListener","isPressed","fitView","preventDefault","sameKeys","prev","next","store","getProject","t0","stop","copyToClipboard","comboOnlyContains","translateView","setAngle","decreaseSize","increaseSize","eraserBrush","getIsTransparentBg","clearLayer","r","g","setActive","brushTabRow","swapColors","KlImageDropper","onDrop","handleFileSelect","enabledTest","addEventListener","pasteEvent","clipboardData","undefined","items","indexOf","getAsFile","retrieveImageFromClipboardAsBlob","imageBlob","img","onload","revokeObjectURL","URLObj","getAsString","pasteStr","trim","onerror","log","crossOrigin","hexToRGB","b1","Ui","onOpacityChange","emitOpacity","onConfigChange","emitSliderConfig","ui","padding","position","StatusOverlay","el","oncontextmenu","onclick","handleClick","overlayToolspace","ToolspaceCollapser","setTimeout","OverlayToolspace","append","toolspaceTopRow","$85H3x","ToolspaceTopRow","showIframePopup","wrap","abrupt","parent","overlay","_ref","updateUi","logoImg","onLogo","$5ebUJ","onNew","showNewImageDialog","onImport","fileTab","triggerImport","onSave","saveToComputer","save","onShare","classList","add","marginBottom","ToolspaceToolRow","onZoomIn","onZoomOut","onUndo","onRedo","setIsSmall","addListener","setEnableUndo","setEnableRedo","KlColorSlider","onPick","p_color","emitColor","setHeight","setPickCallback","doPick","brushDiv","colorDiv","flexWrap","justifyContent","alignItems","toolspaceStabilizerRow","ToolspaceStabilizerRow","onSelect","v","setSmoothing","getOutputElement","TabRow","tooltip","brushId","enable","onClose","keyArr","createTab","b2","HandUi","onFit","onAngleChange","isRelative","FillUi","colorSlider","TextUi","ShapeUi","ShapeTool","isDone","x2","y2","shapeObj","shapeUi","getShape","isOutwards","getIsOutwards","getIsEraser","strokeRgb","lineWidth","getLineWidth","isAngleSnap","getIsSnap","isFixedRatio","getIsFixed","getMode","fillRgb","setComposite","drawShape","ctx","klLayerManager","LayerPreview","onClick","filterTab","FilterTab","UndoRedoCatchup","clctx","catchup","SaveToComputer","FileTab","imgurUpload","imgurKey","SettingsTab","$fxAg2","onOpen","minWidth","$2dTGs","$fuF9j","$adBnR","textUi","$cafM1","$23J3k","show","hide","id","$eIlXd","settingsTab","MutationObserver","observe","attributes","childList","subtree","ToolspaceScroller","resize","scrollY","scrollTo","$3WOmu","klCanvasToPsdBlob","swapUiLeftRight","saveAsPsd","_this","zIndex","userSelect","ResizeObserver","windowResizeWatcher","$iUR3L","importFilters","$9cbe98d1fb398012$export$6e4a713ddcda1e5e","$dAXbp","$3P46L","$7pyBK","$705qg","drawProject","$aSJRf","WorkspaceSvgOverlay","$7bo3M","$lV6Vy","KlCanvasPreview","$i5nyl","filterLibStatus","$kyVjY","$6rdi0","renderText","$h20yl","floodFillBits","$30Cml","$3ujzu","setDbName","$9BlwZ","indexedDb","ProjectStore","$6mTnI","$lkluh","$eyygR","calcSliderFalloffFactor","$l4PqG","Checkbox","$lXqiv","$c4LUw","Select","$21VAD","ImageToggle","$jKOQl","ImageRadioList","$gmlbk","RadioList","$bHZQg","penPressureToggle","$fCJWy","KlSlider","$llzZ0","HexColorDialog","$lfHl9","$h7i9r","KlSmallColorSlider","$kzhsD","PointSlider","$bd9hB","ColorOptions","$9A7OD","Options","$iskOY","BoxToggle","$iDHln","$bmB93","CropCopy","$hRdOL","FreeTransform","$cNhNm","FreeTransformCanvas","$kEeSq","Cropper","$32CBv","$kqmpc","FittedImage","$j1kEL","$13r5y","$9p4Zp","$8jqzp","ToolDropdown","$84zxV","$9Kxky","$1Ax5m","$e4sAN","$1uc3b","BrowserStorageUi","$9pcu9","$iVHpg","$i8UFO","$ekHRj","Popup","exportDialog","$auloj","$isYih","$8ebuX","$76Qvv","$keKW3","$kDGzx","$5ENro","$khi8I","$dJXmR","$iS9xS","$9J17G","$eK8ID","$2umOB","$bIgqE","$5rdL4","DecoyKlHistory","$gFgFC","$b60fce38973759d6$var$historyInstance","$b60fce38973759d6$export$2a772a91f059c0f9","key","l","KlHistory","$7U0Ew","state","dataArr","listeners","pauseStack","maxState","actionNumber","pop","maxBefore","broadcast","bufferUpdate","$9fd01211d0fde0a8$export$63b4813c5280c707","close","isClosed","clearSelection","unfocusAnyInput","rootRootEl","decrease","destroyEl","xButton","bgEl","removeEventListener","rootEl","wheelPrevent","btnElArr","splice","increase","overflow","scrollContent","minHeight","flexDirection","ignoreBackground","tagName","content","concat","$fh18w","titleHeight","lineHeight","background","boxShadow","boxClasses","boxEl","div","marginRight","join","flex","clickOnEnterBtn","stopPropagation","click","autoFocus","buttonRowEl","marginTop","marginLeft","buttonName","iconUrl","btnClasses","primaries","label","$c0kqC","iconImg","custom","btn","clickOnEnter","closefunc","onscroll","$9fd01211d0fde0a8$export$129a32eedafa97c5","clearInterval","updateInterval","updatePos","elW","popupEl","offsetWidth","elH","offsetHeight","animationName","animationDuration","animationTimingFunction","isCssMinMaxSupported","borderRadius","titleEl","paddingLeft","tabindex","contentEl","$dd0d395ff14a3e11$export$17eb8275e0c4cab8","DialogCounter","count","emit","listener","$h4olN","$05ec456c8871d48f$export$921068d8846a1559","eventUsesHighResTimeStamp","$6J2My","mouseEventHasMovement","hasPointerEvents","hasWebGl","getVisitor","canShareFiles","insertAfter","$7jh4K","setAttributes","fitInto","centerWithin","gcd","reduce","decToFraction","imageBlobToUrl","dateDayDifference","createSvg","BbLog","$i0uIf","mix","$eg83P","dist","distSquared","lenSquared","pointsToAngleRad","pointsToAngleDeg","clamp","rotate","rotateAround","Matrix","$kVHNC","Vec2","$4toIY","intDxy","roundEven","roundUneven","round","updateBounds","boundsInArea","projectPointOnLine","$af1iA","PointLine","BezierLine","SplineInterpolator","quadraticSplineInput","$eelgW","createCanvas","$eIcQa","testShouldPixelate","drawTransformedImageOnCanvas","createCheckerCanvas","createCheckerDataUrl","convertToAlphaChannelCanvas","freeCanvas","HSV","$dJ1E2","CMYK","testIsWhiteBestContrast","appendTextDiv","$72Jv0","makeUnfocusable","setEventListener","$idV3L","PointerListener","$04lDo","$exufe","$cdd5ef6b176accd6$export$d031894fc27e45","DomEl","$cdd5ef6b176accd6$export$3f65cefe8380dbea","options","$cdd5ef6b176accd6$export$8ff9f68337b520c0","hasWebgl","visitor","test","$878b1f179a521546$export$b7d78993b74f766d","navigator","userAgent","$878b1f179a521546$export$4ec3bfbae69fbb50","Event","timeStamp","$878b1f179a521546$export$ebcc19037a7ab076","mouseEvent","MouseEvent","$878b1f179a521546$export$b7b64c480b083ae0","PointerEvent","$878b1f179a521546$export$9cbe517943afd6db","premultipliedAlpha","$878b1f179a521546$export$96cd70eaafd80100","chrome","gl","JSON","parse","stringify","$878b1f179a521546$export$fe0a7220ab4eecad","offsetLeft","$878b1f179a521546$export$558f5e20caee48c2","$44dda2e48e48a872$export$cd3d1f114b139967","$2bd9b7b9bc92046d$export$c4f94c8b3850a5a9","referenceNode","newNode","nextSibling","$2bd9b7b9bc92046d$export$fe58198efe02b173","counter","check","complete","$2bd9b7b9bc92046d$export$dbf350e5966cf602","styleObj","alignContent","webkitUserSelect","$2bd9b7b9bc92046d$export$74da2cba014bdc09","attrObj","setAttribute","$2bd9b7b9bc92046d$export$10d8903dec122b9d","els","fragment","$2bd9b7b9bc92046d$export$fa55905620c22535","aw","ah","bw","bh","$2bd9b7b9bc92046d$export$76d0c1a172b67a61","$2bd9b7b9bc92046d$export$aa350b96d91cd94","date","Date","getFullYear","getMonth","toString","getHours","getMinutes","$2bd9b7b9bc92046d$export$f81847884871263e","$2bd9b7b9bc92046d$export$533b26079ad0b4b","numerator","denominator","$2bd9b7b9bc92046d$export$8215e6b900906daa","decimalNumber","len","pow","$2bd9b7b9bc92046d$export$5063ec57a23c4f2e","blobObj","Blob","constructor","fauxBlob","encoding","data","$2bd9b7b9bc92046d$export$1093707c159148e8","dateA","dateB","setHours","getTime","$2bd9b7b9bc92046d$export$af0d87255f3cfd7e","obj","$2bd9b7b9bc92046d$export$331c30fd60da0115","mimetype","err","toBlob","filesArray","File","share","$2bd9b7b9bc92046d$export$b981489921ee18cd","clickEvent","allowClick","$2bd9b7b9bc92046d$export$c54fe3b9ecaa84cf","createElementNS","elementType","childrenArr","$74d1f29ad2137b2c$var$globalKey","emitDown","c","d","listenerArr","emitUp","keyDown","code","keyCode","keyToKeyStrObj","isDownObj","comboArr","codeIsDownObj","keyUp","oldComboStr","blur","eventArr","keyToKeyStrArr","keyStrToKeyObj","space","alt","ctrl","cmd","enter","esc","backspace","delete","sqbr_open","sqbr_close","u","z","plus","minus","up","down","home","end","first","remove","last","getIsDown","getCombo","$74d1f29ad2137b2c$export$f17908c5de22d32e","onBlur","keyStrArr","$74d1f29ad2137b2c$export$e9f65b0175de4c03","comboAStr","comboBStr","sort","pointerArr","pressureNormalizeAvgCount","pressureNormalizeAvgPressure","pressureNormalizeIsComplete","pressureNormalizeFactor","$893e90c2dcf687ac$var$WheelCleaner","endSequenceTimeout","delta","deltaY","sequenceUnit","pageX","pageY","clientX","clientY","endSequence","toEmitDelta","knownUnitArr","sequenceLength","process","clearTimeout","deltaMode","absDelta","abs","$893e90c2dcf687ac$export$9371bd96776f4e82","getDragObj","pointerId","dragObjArr","removeDragObj","removedDragObj","dragPointerIdArr","normalizePressure","correctPointerEvent","corrected","correctedObj","pointerType","movementX","movementY","timeStampOffset","button","eventStopPropagation","customPressure","isFirefox","coalescedEventArr","getCoalescedEvents","getPointer","pointerObj","lastPageX","lastPageY","addPointer","totalLastY","eventItem","coalescedArr","totalLastX","correctedEvent","targetElement","getBoundingClientRect","bounds","eventPreventDefault","coalescedItem","relX","relY","dX","dY","time","createTouchOutEvent","touchListItem","touchEvent","identifier","destroyDocumentListeners","onGlobalPointerMove","onGlobalPointerUp","onGlobalPointerLeave","onPointerEnter","isOverCounter","onEnterLeaveCallback","onPointerLeave","onPointermove","tempLastPointerType","lastPointerType","maxPointers","didSkip","outEvent","createPointerOutEvent","dragObj","downPageX","downPageY","buttonsToStr","clearTouchTimeout","setTouchTimeout","lastTimeStamp","outEvent1","onPointerCallback","touchTimeout","fakeEvent","performance","now","onTouchTimeout","onPointer","onWheelCallback","onWheel","onEnterLeave","wheelEvent","timing","navigationStart","onPointerdown","wheelCleaner","touchArr","changedTouches","touchObj","onTouchmove","onTouchend","$9a5bdb07e7a7c42f$export$2c9e8a9632a706b2","$9a5bdb07e7a7c42f$export$6c4a311cc157c764","ax","ay","bx","by","sqrt","$9a5bdb07e7a7c42f$export$499eb56409f6cbc2","$9a5bdb07e7a7c42f$export$a4f99f99d3e99cfa","$9a5bdb07e7a7c42f$export$627023b405ba5028","p1","p2","atan2","$9a5bdb07e7a7c42f$export$c03a8450eabc2532","$9a5bdb07e7a7c42f$export$7d15b64cf5a3a4c4","num","$9a5bdb07e7a7c42f$export$bb628a54ab399bc9","deg","theta","cs","cos","sn","sin","$9a5bdb07e7a7c42f$export$95ec0760d3d00713","center","point","rot","$9a5bdb07e7a7c42f$export$bbf9af158036c5e9","remainder","fDx","fDy","$9a5bdb07e7a7c42f$export$94cce7adf2ec2d08","above","ceil","below","floor","$9a5bdb07e7a7c42f$export$f373b6a7b0c159a","$9a5bdb07e7a7c42f$export$2077e0241d6afd3c","digits","digitMult","$9a5bdb07e7a7c42f$export$f4467a4f41373bc7","$9a5bdb07e7a7c42f$export$bbb91bbc54e7d9ac","$12950380ec51f25d$export$649a211db9812745","continueChain","chainArr","chainOut","func","$12950380ec51f25d$export$db3963a21c01d803","fail","sequenceArr","timeoutObj","maxUntilSecondDown","success","eventQueueArr","lastSequenceItem","onDoubleTap","setupTimeout","timeoutStr","targetFunc","timeMS","diff","nowTime","minSilenceBeforeDurationMs","maxPressedDurationMs","maxPressedDistancePx","maxInbetweenDistancePx","maxUpToUpDurationMs","maxUntilSecondDownDurationMs","minSilenceAfterMs","allowedPointerTypeArr","allowedButtonArr","pointersDownIdArr","lastUpTime","isDown","isUp","processEvent","setAllowedPointerTypeArr","arr","setAllowedButtonArr","firstDownTime","firstLastDownTimeout","tapTimeout","fingerArr","lastEventTime","fingers","maxFirstLastFingerDownMs","downTime","tempLastEventTime","maxTapMs","fingerObj","fingerObj1","i2","allAreUp","i3","onTap","gestureObj","doSwallow","secondFingerTimeout","touchPointerArr","isInProgress","continuePinch","index","otherPointerIdArr","downRelX","downRelY","untilSecondFingerDurationMs","endPinch","touchPointerObj","firstFingerMaxDistancePx","pincherArr","actionObj","startDist","distance","startAngle","onPinch","beginPinch","$12950380ec51f25d$export$fe11e0afe623a677","eventCopy","pointers","downPointerId","ignorePointerIdArr","pressure0","pressure1","eventQueue","shiftIsPressed","direction","downEvent","onDraw","$12950380ec51f25d$export$91dcf4209534d21f","lastMixedInput","inputX","inputY","inputPressure","$3f0e2f35371c9852$export$dd0873c0fb3ccff6","resultCanvas","$3f0e2f35371c9852$export$1555f643cc9a976","transform","scaleX","scaleY","whSwapped","$3f0e2f35371c9852$export$ded2b43392504635","destCtx","transformImage","pixelated","imageSmoothingEnabled","imageSmoothingQuality","translate","restore","$3f0e2f35371c9852$export$425a419ef9fc761f","baseCanvas","angleDegree","cache","$3f0e2f35371c9852$export$754559b36e94ea2f","fillStyle","fillRect","$3f0e2f35371c9852$export$42af33c76b681867","create","toDataURL","$3f0e2f35371c9852$export$59b33278b5b2fc8a","tmp1","tmp2","oldW","oldH","newW","newH","ew","eh","base2","oldWidthEx","log2","oldHeightEx","newWidthEx","newHeightEx","buffer1","buffer2","bufferCtx","globalCompositeOperation","currentWidth","currentHeight","newWidth","newHeight","tmp","canvasCtx","tmp1Ctx","$3f0e2f35371c9852$export$5a7576952c826b4f","imdat","getImageData","putImageData","$3f0e2f35371c9852$export$2384aff49c9b73c2","clearRect","multiplyMatrixAndPoint","$e4df33b4b16105d5$export$5b12bf1653c0dd85","getIdentity","matrix","multiplyMatrices","matrixA","matrixB","row0","row1","row2","row3","result0","result1","result2","result3","createTranslationMatrix","createRotationMatrix","createScaleMatrix","$531c9f41f98b7ec0$export$ac4bca90992eed1","sub","nor","mul","dot","aArr","bArr","map","m","$77ae015f37ebe4f1$export$b4c5b177db876445","lineStart","lineEnd","$77ae015f37ebe4f1$export$8b36a4a83269a640","segmentArr","points","getAtDist","getLength","fac","pointArr","lastSpacing","spacing","controlsCallback","lastPoint","dir","lastDot","pointM1","pointM2","pointM3","curvePoints","p3","p4","resolution","getBezierPoints","pointLine","tempSpacing","lastCallbackPoint","dAngle","lastAngle","addFinal","newP","xa","ya","wx","sig","ddydx","getFirstX","getLastX","interpolate","klo","khi","k","$77ae015f37ebe4f1$export$80967b1eb9fd6eb4","findX","$5e7aac2fa49b6b1f$export$d2edaecd208aed43","$5e7aac2fa49b6b1f$export$8f9ece5a47764b93","$5e7aac2fa49b6b1f$export$89d3f85304bf0767","$5e7aac2fa49b6b1f$export$fb7efcd2e153af6e","_RGBtoHSV","minVal","maxVal","del_R","del_G","del_B","_HSVtoRGB","var_h","var_i","var_1","var_2","var_3","var_r","var_g","var_b","_CMYKtoRGB","_RGBtoCMYK","toRGB","o","toHSV","toCMYK","toHexString","ha","hb","hc","toRgbStr","rgbaObj","hexStr","exec","$5e7aac2fa49b6b1f$export$5cf396345d1238ae","$cfe3aa45a75894cc$export$7868464f598ba79d","innerHTML","$cfe3aa45a75894cc$export$906dfdb7df31ccfc","getAll","activeElement","getAttribute","$cfe3aa45a75894cc$export$e05240ca9e0b8bd9","focusEl","select","$cfe3aa45a75894cc$export$a3d02541b0ebf605","getSelection","sel","empty","removeAllRanges","selection","didFocusRelated","relatedTarget","currentTarget","preventFocus","$cfe3aa45a75894cc$export$c3da0dad1b44eea9","isArray","onChange","$cfe3aa45a75894cc$var$els","customKeyArr","$0d0e99c175410ac4$export$9860cd9e09e6f8ba","msg","$9e5fd8359d8b22f2$export$19fffca37ef3e106","localStorage","module","exports","getBundleURL","resolve","$d82e0c66c1aaca81$export$48513f6b9f8ce62d","doHighlight","element","innerEl","checked","allowTab","tabIndex","onchange","toggle","$aa0ec58519fa7d10$export$b7e3ae3d7c15e42e","$eb01976a4bab51ce$export$ef9b1a59e592288f","selectEl","changeListener","cursor","fontSize","colorScheme","isFocusable","optionArr","option","initValue","$5cde84e643fb89d6$export$b6d053cded550773","isActive","backgroundImage","isRadio","setValue","getValue","$459eb3dcb08ae3f8$export$7cc1012a658e6ad8","activeIndex","createOption","initId","radioEl","$12a3b74a8702bb1f$export$77219f67585650fa","isChecked","changeCallback","redraw","toggleDiv","backgroundColor","border","cssFloat","$e1Rnq","backgroundSize","backgroundRepeat","boxSizing","$cf8be10874d1afb1$export$a1855b925e534de7","isEnabled","manualInputRoundDigits","useSpline","curve","elementWidth","elementHeight","displayValueToValue","valueToDisplayValue","toValue","displayValue","toDisplayValue","isChangeOnFinal","formatFunc","eventResMs","curveArr","splineInterpolator","roolEl","sliderWrapperEl","labelFontSize","textEl","control","valueToSliderValue","controlInner","updateEnable","doubleTapper","DoubleTapper","showManualInput","virtualVal","eventChain","pointerListenerTimeout","pointerListener","fixScribble","sliderValue","sliderValuetoValue","updateLabel","deltaX","sliderValue1","toLocaleString","languageStrings","getCode","isFinal","emitInterval","emitValue","setInterval","manualInput","setIsEnabled","$348ou","KlSliderManualInput","config","isDisabled","$0c2dd884393cffca$export$f8e41e222e32615d","isRightButton","$a36067096711f77d$export$db3d4fde05db9a5e","rect","roundDigits","currentValue","onblur","privateOnClose","scrollBefore","scrollX","lastValue","Number","$dada52d673c8c4ac$export$cc42e119007cb939","createRgbInputRow","labelStr","attributeStr","rowEl","labelEl","inputEl","lastValidRgb","parseFloat","previewEl","hexInput","hexRowEl","hexLabel","rgbArr","copyButton","$fcsnL","execCommand","resultStr","$9eeb6c00ea2d3242$export$4e5102252876c5d7","updatePrimaryHSV","hsv","primaryColorHSV","updateSVCanvas","rgb","hueStop","updateSVPointer","svHeight","pointerSV","setColPreview","divPreview","primaryColorRGB","pickerButton","filter","hexButton","updateSecondaryColor","secondaryColorBtn","secondaryColorRGB","secondaryColorHSV","controlH","pickCallback","outputDiv","startValue","svWrapper","svSvg","DOMParser","parseFromString","documentElement","divH","SVContainer","virtualHSV","$1nsGS","backgroundPosition","isPicking","isOver","targetEl","cv","gradH","createLinearGradient","col","addColorStop","createHueBg","factor","$3ac3f56275b45315$export$dcd33f7653c95f09","updateSV","canvasSV","gradient1","colleft","colright","heightSV","updateHPointer","pointerH","canvasH","heightH","svPointerId","svPointerListener","hPointerId","hPointerListener","cleardiv","clear","$0b17443c34517974$export$ac00cea56cec3037","param","redrawPoint","sliderPoint","sliderPos","isDragging","pointSize","sliderLine","isFirst","imaginaryPos","margin","transition","$a19b2655062f09b7$export$24ba9b81662d4366","buttonArr","setIsSelected","selectedIndex","colorArr","checkerUrl","found","sItem","initialIndex","colorButton","buttonSize","textAlign","$c8511e371b1e3768$export$c019608e5b5bb4cb","optionObj","classArr","isSmall","wrapperEl","selectedId","getIndex","initialId","changeOnInit","previous","$c1a93a3cd82636c9$export$5ee0af1d5c87e856","removeProperty","isWide","angleIm","$bv5Zj","verticalAlign","innerInnerEl","doPulse","animation","timeout3","timeout","timeout2","$81ac8fccf3fa43c3$export$8e17099f54853f0e","aboutDiv","closed","aniToggle","imageContainer","coverImage","coverSize","aniTimeout","boxSize","ontouchstart","ontouchmove","ontouchend","$01fcd0ed15aa4018$export$40175a5948a88a57","resetCrop","updateCroppedCanvas","croppedCanvas","croppedImage","updateSelectionRect","selectionRect","thumbX","scaleW","thumbY","scaleH","toOriginalSpace","genCrop","topLeftP","bottomRightP","origTopLeftP","origBottomRightP","isReset","eventTarget","isNotCopy","previewWrapper","thumbSize","thumbCanvas","imageRendering","thumbCtx","startP","updateCropTimeout","startCrop","didMove","doUpdate","stepSize","getRect","getCroppedImage","$ffd40240385bb9f9$export$32b89bc9bb92706a","fullCanvas","cropCallback","output","toClipboard","imgURL","cropCopy","fetch","clipboard","write","ClipboardItem","clipboardItemIsSupported","topWrapper","borderTop","borderBottom","KeyEvent","rectObj","$aacd8170d7ccb1c6$export$56cc6eb0b4c43d97","p_canvas","p_func","p_rootDiv","oldHistoryState","row","clearBtn","$8yL1I","suggestions","suggestionBtns","createLayerList","updatefunc","createLayerEntry","klCanvasLayerArr","layercanvas","layerElArr","posY","innerLayer","container1","container2","spot","oldOpacity","thumbDimensions","thumb","thc","lname","whiteSpace","ondblclick","opacityLabel","isLast","layerOpacity","largeThumbCanvas","largeThumbDiv","largeThumbInDocument","largeThumbInTimeout","largeThumbTimeout","dragstart","freshSelection","lastpos","isSelected","activateLayer","updateLayersVerticalPosition","posToSpot","newSpot","oldSpot","move","selectedSpotIndex","layerListEl","getState","child","updateHeight","layerHeight","layerSpacing","newspot","posy","oldSpotIndex","newSpotIndex","moveLayer","mergeBtn","disabled","listdiv","disableButtons","enableButtons","modeWrapper","modeSelect","addnewBtn","duplicateBtn","removeBtn","renameBtn","paddingRight","$d42vI","$dKwR8","$3VpTB","$g91IK","clearboth","MAX_LAYERS","duplicateLayer","removeLayer","mixModeStr","$bBcC4","translateBlending","topCanvas","preview","spacer","alphaCanvas","bottomCanvas","globalAlpha","topOpacity","mergeDialog","mode","mergeLayers","createButtons","setMixMode","historyState","activeLayerSpotIndex","getSelected","spotIndex","stateStr","$0621fc8724f6bfac$var$allowedMixModes","$0621fc8724f6bfac$export$9f4f73b1bd7c2f26","$0621fc8724f6bfac$export$4a819bde91671014","layerNrOffset","layerCanvasArr","pickCanvas","changeListenerArr","origLayers","updateIndices","toCopyCanvas","algorithm","layerCanvas","layerContext","offX","offY","ctemp","layerCtx","fillColor","selected","isLayerLimitReached","doReturnNull","emitChange","temp","targetIndex","layerBottomIndex","layerTopIndex","isHorizontal","isVertical","tempCtx","colorObj","compositeOperation","tolerance","sampleStr","grow","isContiguous","targetCtx","targetImageData","srcCanvas","srcData","srcCtx","srcIndex","srcImageData","targetData","imageData","canvasObj","$7069db2f5e23d00f$var$fillRect","$7069db2f5e23d00f$var$mx","$7069db2f5e23d00f$var$my","$7069db2f5e23d00f$var$moveIndex","$7069db2f5e23d00f$var$testAndFill","srcArr","targetArr","initRgba","px","py","q","tl","tr","br","bl","$01d7180c5d1d0fdf$export$27550cc14d7ae85a","downX","downY","downAngleRad","onShape","$01d7180c5d1d0fdf$export$71b514a25c47df50","isEraser","strokeStyle","r1","r2","pAngleDeg","pAngleDegSnapped","rotated","r11","r21","rx","ry","rdX","rdY","x1r","y1r","x2r","y2r","x1f","y1f","x2f","y2f","beginPath","moveTo","lineTo","stroke","x1f1","y1f1","x2f1","y2f1","strokeRect","ellipse","$fdc12d72a3df9be9$export$482c90f94eb9717c","outer","fontFamily","fontWeight","fontStyle","spanStr","children","offsetTop","el1","fillText","innerText","isDebug","$089586a542a12f27$export$5f63a7b18dc4503a","$2f1281ced73ab1dc$export$6e1bedb2a6cdff30","blendMode","codes","darken","multiply","lighten","difference","exclusion","hue","saturation","luminosity","$d256278b259ca979$export$6b9252711ea5997f","rootElement","brushCircleOuter","brushCircleInner","pickerPreviewBorder","pickerPreviewCol","compassSize","compass","compassInner","compassBaseCircle","cx","cy","compassLineCircle","compassUpperTriangle","compassLowerTriangle","radius","borderColor","$d492af58f4721011$var$TMode","TMode","$d492af58f4721011$var$MIN_SCALE","$d492af58f4721011$export$6eaf6f7c0cc177fc","_this1","onViewChange","renderTargetCanvas","renderTargetCtx","renderWidth","renderHeight","compositeCanvas","compositeCtx","doResizeCanvas","oldTransformObj","targetTransformObj","highResTransformObj","renderedTransformObj","cursorPos","usesCssCursor","bgVisible","transformIsDirty","doAnimateTranslate","svgOverlay","emptyCanvas","isRepeat","currentInputProcessor","onKeyDown","Draw","Pick","Fill","Text","Shape","globalMode","inputProcessorObj","spaceHand","Hand","altPicker","zoom","onKeyUp","updateChangeListener","currentMode","renderTime","lastDrawEvent","linetoolProcessor","LinetoolProcessor","getMatrix","art","getRenderedTransform","coords","matrix1","coords1","coords2","pointer","reqFrame","updateCursor","getComboStr","resetInputProcessor","coord","workspaceToCanvasCoord","onFill","onText","hand","HandGrabbing","Zoom","offsetX","offsetY","internalZoomByStep","lastRenderedState","picker","pickedColor","getColorAt","updateColorPreview","Rotating","Rotate","centerObj","startAngleRad","dAngleRad","minimizeAngleRad","origin","angleIsExtraSticky","pinchZoomer","PinchZoomer","snapAngleRad","oldTransform","mainDoubleTapper","middleDoubleTapper","twoFingerTap","NFingerTapper","threeFingerTap","pointerEventChain","OnePointerLimiter","CoalescedExploder","brushRadius","animationFrameRequested","requestAnimationFrame","updateLoop","addChangeListener","modeInt","doForce","oldMode","$hNEwm","$iOLNv","$3zTyb","$kFdtJ","oldIsHand","currentIsHand","stepNum","centerX","centerY","newStep","newScale","effectiveFactor","transformA","transformB","blendFactor","centerPosA","canvasToWorkspaceCoord","centerPosB","mixedPos","workspacePointArr","borderSize","layerArr","getLayersFast","compositeObj","updateCompass","snapDegIncrement","maxDistDeg","modDeg","doRedrawCanvas","newState","elapsedFrames","lastRenderTime","doRender","checkChange","testBgVisible","start","klC","oldWidth","oldHeight","modeStr","diameter","hideBrushCursorTimeout","doAnimate","canvasPointsArr","boundsObj","boundsWidth","boundsHeight","oldAngleRad","tx","ty","$6faa9d948ec87f40$export$e258ade1648009b7","render","$0370167ee97a20d9$var$snapToPixel","$0370167ee97a20d9$var$copyTransform","$0370167ee97a20d9$var$toTransformSpace","$0370167ee97a20d9$var$toImageSpace","corners","isConstrained","snapX","snapY","snappingEnabled","ratio","transEl","boundsEl","boundsStartP","iP","minSnapDist","snap","distX","distY","j","projected","dist1","updateCornerPositions","updateDOM","gripSize","offsetArr","scaled","tinyOffset","cornerCursors","virtualPos","constrainCorner","snapCorner","tP","indexes","updateTransformViaCorners","edgeSize","edges","angleOffset","isInverted","pointerRemainder","tfD","ti","dimension","restoreRatio","angleGrip","$lQMok","anglePointerListener","offset","snapDeg","iX","iY","_x","_y","cornerIndex","flip","widthChanged","heightChanged","angle90","newHeight1","skipCallback","transformOrigin","$48f5d87739d28bf9$export$205c2dd29f8a66b5","updatePreview","freeTransform","getTransform","destCanvas","previewLayerArr","transformIndex","initTransform","klCanvasPreview","imageWidth","imageHeight","previewFit","innerWrapper","transformSize","setPos","setAngleDeg","fit","setTransformCenter","getTransformation","getIsPixelated","$de496a1759b04ed9$export$71ed2b85d4ca43d3","transformTop","grips","maxH","transformRight","maxW","transformBottom","transformLeft","commit","cornerElArr","outline","thirdsHorizontal","thirdsVertical","gripCursors","outlinePointerListener","gripOverlay","edge0PointerListener","edge1PointerListener","edge2PointerListener","edge3PointerListener","corner0PointerListener","corner1PointerListener","corner2PointerListener","corner3PointerListener","setTransform","setScale","showThirds","$18e69c7d4cb991e8$export$d25420b53e16716f","layerObj","largeCanvasAnimationTimeout","isInstant","nameLabelEl","opacityEl","lastDrawnSize","canvasDimensions","canvasSize","animationCanvas","animationCanvasCtx","animationCanvasCheckerPattern","animationCount","animationLength","animate","drawLargeCanvas","lastDrawnState","largeCanvasIsVisible","largeCanvasSize","largeCanvas","largeCanvasCtx","largeCanvasCheckerPattern","largeCanvasWrapper","removeLargeCanvas","largeCanvasAnimationDurationMs","contentWrapperEl","canvasWrapperEl","nameWrapper","flexGrow","nameFadeEl","clickableEl","webkitTouchCallout","createPattern","showLargeCanvas","currentState","klCanvasLayerObj","$a29ff52bf33e0691$export$83ae33786c7b4ee5","$e3dfa43019bc3f08$export$962af7e240721d88","freeTransformCanvas","noteEl","originalSizeBtn","fitSizeBtn","setTransformFit","centerBtn","importImage","buttonStr","$01cb8095758db224$export$e789742143ba5b1","rootCounter","optionLayerCounter","optionImageCounter","testAcceptType","dataTransfer","types","updateOptions","optionLayerEl","optionImageEl","paddingTop","textShadow","optionStyle","$d6fe881e8fc421ac$export$9f0da9b942594e99","updateColor","selectedColorEl","updateUI","mousePos","sizeObj","hHeight","sliderHeight","queuedObj","subscriptionFunc","initialColor","subscribe","sliderConfig","getSliderConfig","$6003e73b8cbb69e2$export$665d2c76b1eb8459","createButton","extraPadding","contain","logoButton","$8oUiM","newButton","$1gUFn","importButton","$gswMe","saveButton","$lLh5u","shareButton","$5xpQb","helpButton","onHelp","$kS5uZ","$18c597dee53260ff$export$a0a40f8a0b8fee15","createDropdownButton","wrapper","dropdownWrapper","smallMargin","onClickDropdownBtn","closeDropdown","currentActiveIndex","updateButton","showDropdown","dropdownBtnArr","arrowButton","activeButton","titleArr","activeButtonIm","imArr","openTimeout","startX","startY","elementFromPoint","$gzZrf","borderBottomLeftRadius","borderBottomRightRadius","$a372d78c806cd0cc$export$c744a22bef9e0b97","doEmit","currentActiveStr","toolDropdown","handButton","onActivate","doLighten","doMirror","createTriangleButton","svg","viewBox","preserveAspectRatio","defs","in","stdDeviation","dx","dy","in2","operator","k2","k3","svgTriangleLeft","class","onLeft","svgTriangleRight","onRight","leftPointerListener","rightPointerListener","leftIm","leftImage","rightIm","rightImage","setIsEnabledLeft","setIsEnabledRight","zoomInNOutButton","$3KoFh","$eWf2I","zoomInButton","zoomOutButton","undoNRedoButton","$fc34V","undoButton","redoButton","$90c04b5ac185bf3d$export$8162a66cd18867a7","strengthSelect","setDeltaValue","$d04d72b97d637d65$export$3c6d17ed0106bfb9","pTabObj","useAccent","openedTabObj","tabDiv","roundRight","roundLeft","tabArr","roundSize","$4m0AU","tabId","$9934467c988b088a$export$cf20160367bae46c","scaleEl","angleEl","resetButton","onReset","fitButton","leftRotateButton","$2n4Fs","resetAngleButton","rightRotateButton","pIsVisible","pScale","$51d47356d698ffec$export$1e63e3b0645421a2","toleranceSlider","selectRow","growWrapper","growSelect","contiguousToggle","$d06987f550ff485e$export$32a22540e4b2f123","$45c003c723de07b5$export$a9387b1d4260d39c","updatePreviews","strokeWidth","lineWidthSlider","squish","rectStrokeSvgRect","rectFilledSvgRect","ellipseStrokeSvgEllipse","ellipseFilledSvgEllipse","lineSvgLine","fixedToggle","previewPadding","previewSize","snapToggle","rectStrokeSvg","rectFilledSvg","ellipseStrokeSvg","ellipseFilledSvg","lineSvg","shapeOptions","eraserToggle","outwardsToggle","$4fb68589de8a8c9a$export$f77a89101d7d6586","createRatioSize","ratioX","ratioY","maxCanvasSize","updateRatio","widthInput","heightInput","commonRatios","reducedArr","closestRatio","closestDistance","ratioWrapper","realw","T","U","V","HCF","secondaryColor","canvasWidth","canvasHeight","workspaceWidth","workspaceHeight","onConfirm","newImDiv","widthWrapper","heightWrapper","widthUnit","heightUnit","templateWrapper","presetFitBtn","presetCurrentBtn","presetSquareBtn","presetLandscapeBtn","presetPortraitBtn","presetOversizeBtn","sizeObj1","backgroundRGBA","colorOptionsArr","colorOptions","previewcell","cell","onkeyup","secondRow","secondRowLeft","$3f73fb4b1b574d52$export$5b91f641162972fc","icon","directionStr","$jiQkU","dirStr","$3Rl3W","$cd9e7df6e228ea45$export$e263e067d6140649","textCtx","textCanvas","$a7ch7","textInput","alignRadioList","italicToggle","boldToggle","sizeInput","fontSelect","rotatedXY","rotatedWH","fitBounds","zoomFac","previewCanvas","layersCtx","previewCtx","checkerPattern","layersCanvas","changeZoomFac","zoomInBtn","canZoom","zoomOutBtn","onScroll","isSmallWidth","isSmallHeight","touchAction","previewPointerListener","row2n3Wrapper","unshift","fontPointerListener","zoomWrapper","sizePointerListener","$2dqOY","$rk4vM","$hucjG","$cZa2s","$03Zd8","placeholder","$c8d2eb7d799b314c$export$1bf16d9bd59fd8f9","resolutionEl","updateResolution","flattenCheckbox","doFlatten","noteStyle","warningArr","psdWarningArr","contentArr","warningMap","mask","clipping","group","adjustment","showWarnings","noteEl1","cropRect","$4c230b0de5e1a470$var$kl2PsdMap","$4c230b0de5e1a470$var$psd2KlMap","$4c230b0de5e1a470$var$init","$4c230b0de5e1a470$export$6df36f0c42d2440f","str","$4c230b0de5e1a470$export$4e3b1f7d3ad623b4","$4c230b0de5e1a470$export$3d649861c4b13fa2","psdObj","addWarning","warningStr","getMixModeStr","prepareMask","maskCanvas","defaultColor","groupMaskCtx","imData","bitsPerChannel","maxLayers","layerCount","countWithinGroup","groupObj","convertGroup","psdGroupObj","groupCanvas","groupCtx","resultArr","groupOpacity","hidden","groupMixModeStr","hasClipping","innerArr","innerItem","innerCtx","clippingCanvas","clippingCtx","clippingItem","effects","clippingCanvas1","clippingCtx1","clippingItem1","$4c230b0de5e1a470$export$56493bf279c387b3","klPsd","$41164c8aeaf53227$var$indexedDbIsSupported","indexedDB","$41164c8aeaf53227$var$dbNameStr","$41164c8aeaf53227$var$storageNameStr","$41164c8aeaf53227$export$1347f8be1f25c479","$41164c8aeaf53227$var$execIndexedDBTransaction","actionFunction","successCallback","errorCallback","onError","errorStr","hasFinished","requestObj","createObjectStore","keyPath","createIndex","unique","objectStoreNames","contains","deleteDatabase","storeObj","transactionObj","databaseObj","transaction","objectStore","e2","oncomplete","$41164c8aeaf53227$export$1448a0dd0d3fde8e","query","$41164c8aeaf53227$export$21ade4eb935254aa","storageProject","put","$41164c8aeaf53227$export$42ffd38884aecdac","$8k5kH","$805be15a1e91c0ee$export$7a4e0b62a5d854bc","isLoaded","$805be15a1e91c0ee$export$395d33c8e06b92c9","brightnessContrast","lang","getDialog","inEmbed","$4UkHZ","curves","$e7LnL","$iI5sC","hueSaturation","$eySuj","invert","$iPRwU","perspective","$krmR4","$92iBR","tiltShift","$bFASM","toAlpha","$9m6gZ","$4fkq2","$dPWA8","unsharpMask","$cQHFd","grid","$9vOYE","noise","$as29q","$68QTJ","$42ac5b30ad65dabb$export$7d68cd8857639377","PenBrush","BlendBrush","$5PSXS","SketchyBrush","$ewgr9","PixelBrush","$kic4a","ChemyBrush","$6Nq1H","SmudgeBrush","$ltaBP","EraserBrush","$7cUpm","$3f0923cd3c55ea92$export$6f96c8f9e6ae7341","historyEntry","settingColor","settingColorStr","lineToolLastDot","calcOpacity","settingOpacity","settingHasOpacityPressure","updateAlphaCanvas","settingAlphaId","ALPHA_CIRCLE","ALPHA_SQUARE","instructionArr","alphaCanvas128","alphaCanvas64","alphaCanvas32","alphaOpacityArr","$5CF7D","alphaImArr","drawDot","before","settingLockLayerAlpha","arc","twoPI","closePath","hasDrawnDot","targetMipmap","ALPHA_CHALK","bezierLine","lastInput","dotCallback","localPressure","lastInput2","localOpacity","localSize","settingSize","settingHasSizePressure","drawArr","localSpacing","settingSpacing","actions","inputArr","maxInput","loopDist","mouseDist","bdist","eX","eY","setAlpha","setSpacing","sizePressure","opacityPressure","setLockAlpha","getSpacing","$74D3O","$ff6c1f784f50f5d5$export$d116ae91f77f1f19","genBrushAlpha01","genBrushAlpha02","$f875015ce1aeb4d3$export$74a44bbc21d06a28","scaleFac","createImageData","sFac2","$gZSR2","simplex2","noisePattern","centerDist","$f875015ce1aeb4d3$var$udSegment","ba","pa","$f875015ce1aeb4d3$export$eaa218d5d17c8f1c","pDist","centerSize","transitionSize","$dfc47a34ad9bc378$var$myModule","$dfc47a34ad9bc378$var$Grad","dot2","$dfc47a34ad9bc378$var$grad3","$dfc47a34ad9bc378$var$p","$dfc47a34ad9bc378$var$perm","$dfc47a34ad9bc378$var$gradP","seed","$dfc47a34ad9bc378$var$G2","xin","yin","j1","$dfc47a34ad9bc378$var$F2","gi0","gi1","gi2","$02d77b8dd5755328$var$cellSize","$02d77b8dd5755328$var$clamp","$02d77b8dd5755328$export$9659db8d01dd5313","redrawBounds","cells","getTouchedCells","isTouched","touchedCells","cellsW","getCellsWidth","cellOffsetX","cellOffsetY","cellWidth","cellHeight","inCellBounds","tmpCtx","alpha","ar","ag","ab","aa","sliceBounds","randI","randLen","randArr","random","samples","samplesSquared","sampleOffsets","sharpness","invSharpness","sharpnessSubtrahend","sizeSquared","distDivisor","alphaMinuend","slicedBounds","ri","re","alphaO","underR","invAlphaO","underG","underB","alphaU","underR1","underG1","underB1","newAlpha","drawBuffer","settingSizePressure","calcSpacing","avgX","avgY","blending","mixr","mixg","mixb","average","localColOld","avgParams","prepDot","copyFromCanvas","getAverage","blendCol","localColNew","blendMix","settingOpacityPressure","updateRedrawBounds","totalCells","isTesting","drawChangedCells","continueLine","find","$c214fbe9e4fc15b0$var$sampleCanvas","$c214fbe9e4fc15b0$var$sampleCtx","$c214fbe9e4fc15b0$export$566f9061f0f5ba33","lastX","lastY","settingBlending","settingScale","sketchySeed","setSeed","getSeed","mixmode","c1","c2","getBlending","setBlending","p_x","p_y","preMixedColor","mixx","mixy","mixw","mixh","countmix","mixed","$58b45953679baa4a$export$4de5ef8eecde6f12","ditherPattern","updateDither","ditherCtx","settingIsEraser","ditherArr","ditherCanvas","skipFirst","settingUseDither","sX","sY","plotCubicBezierLine","isOverThreshold","d2","d3","cubicCurveOverThreshold","plotLine","controlCallback","controlObj","setIsEraser","setUseDither","getLockAlpha","$fc1a683099fb2d61$export$fe52c90afd1cf5ba","isBaseLayer","isTransparentBG","radgrad","createRadialGradient","oFac","bezierCallback","started","setTransparentBG","$78ad817c60f81b7c$var$CELL_SIZE","$78ad817c60f81b7c$var$smudge","cSize","brush","cX","cY","aP","bP","aIndex","ai","bi","ix","iy","softnessPx","fac2","alphaLock","bx1","yStart","bx2","pixel","iy1","yStart1","x21","ix1","yStart2","x3","x22","ix2","iy2","y3","iy3","yStart3","x4","x23","ix3","completeRedrawBounds","copiedCells","copyImageData","_$i","e3","imWidth","imHeight","$78ad817c60f81b7c$var$prepSmudge","ImageData","updateCompleteRedrawBounds","historyIm","tmpCanvas","$348fcce123898af9$export$38b08aa4ea8f61c6","settingXSymmetry","settingYSymmetry","buffer","settingMode","path","Path2D","settingGradient","startAtTop","gradient","minY","maxY","lineJoin","distort","settingDistort","pos","historyCanvas","$cVFne","$7de2f0eab7a9ead7$export$f1561c72be54c6a7","penBrush","penBrushUi","blendBrush","$9mjXI","blendBrushUi","sketchyBrush","$iYbUv","sketchyBrushUi","pixelBrush","$brjBD","pixelBrushUi","chemyBrush","$vCnsd","chemyBrushUi","smudgeBrush","$dS2qM","smudgeBrushUi","$9rc5F","eraserBrushUi","brushInterface","alphaNames","$8b6ca25eb0830594$export$a0d4983f3b0b5c8e","$7gVvp","updateAlphas","alphas","currentAlpha","spacingSpline","onSizeChange","lockAlphaToggle","$7NTKy","pressureSizeToggle","pressureOpacityToggle","alphaWrapper","changeSliderValue","$e8a5c017c49bb311$export$5ec472fd0ce20d84","$2e3c50106ba150d5$export$156bb4fe8f4bcb4b","$cQSIC","blendingSlider","setSizePressure","setOpacityPressure","$94537af75923b9e3$export$ffae56164d1bde68","$bteky","blendSlider","scaleSlider","$9519e739bc9666ee$export$d001f3406562d07","$4PDnu","ditherToggle","getUseDither","toggleRow","$d6fc2ded7d9d56db$export$cf481ecf227135a8","$984eq","isTransparentBg","transparencyToggle","$1045b9bae2ffbbb4$export$84831662ba707e7a","$3QgTy","$18456e8104a5a825$export$80819a93636ebb04","$18kre","actualIconSize","iconSize","modeOptions","brushSize","mirrorXToggle","halfSize","getXSymmetry","setXSymmetry","mirrorYToggle","getYSymmetry","setYSymmetry","gradientToggle","getGradient","setGradient","$14dc4cf18966a4f4$export$2358c75ad3c15b2d","$6f92981a32875bca$export$5334e08b3589fc5c","isEmbed","linkEl","iframe","href","contentWindow","location","isMaxHeight","$142eacf53b1eb43d$export$3dff5655255b5729","ignoreFocus","inputs","$0e681e75eb3cab30$export$9c72cf485ef46673","gridTemplateColumns","gridTemplateRows","gap","gridTemplateAreas","gridArea","infoEl","isBroken","ageEl","textSize","btnCustom","storeButtonEl","clearButtonEl","hideClearButton","visibility","storeListener","onUpdate","timestamp","thumbnail","updateThumb","updateAge","readResult","read","ageStr","age","maxWidth","maxHeight","resetButtons","Promise","unsubscribe","$14b343f2c12ca9c5$var$makeAsync","reject","$14b343f2c12ca9c5$export$93d91060b9af7e2a","accessHasFailed","storeKlProjectObj","getKlProjectObj","lowLevelRead","$3hwQ7","ProjectConverter","readStorageProject","t1","storageProject1","createStorageProject","lowLevelStore","lowLevelClear","updateTimestamp","$3ee249752703e788$var$loadImage","onabort","$3ee249752703e788$export$f3c1ac6650038646","$2wCWz","base64ToBlob","createThumbnail","HTMLCanvasElement","all","t2","$e3587a28373f51f9$export$b3fb17ae4345ac8f","base64Str","parts","binStr","atob","buf","ArrayBuffer","view","Uint8Array","charCodeAt","$01ce2e23a2667e77$export$a2647fbf5f056b0a","onExportTypeChange","onFileSelect","onSaveImageToComputer","onNewImage","onShareImage","onUpload","onCopyToClipboard","createSpacer","clearer","line","filemenu","uploadImgurButton","clipboardButton","$4xKQD","multiple","accept","exportTypeWrapper","exportTypeSelect","importWrapper","innerMask","importFakeButton","createImportButton","saveNote","fileBrowserStorage","refresh","$0d10046ca7f6fbd0$export$3f17d740ad471e50","getCurrentColor","getKlMaxCanvasSize","getKlCanvas","getCurrentLayerCtx","isInit","filterKey","filterArr","buttonLabel","filterName","applyFilter","filterDialog","getInput","finishedDialog","groupArr","filters","addGroup","$6349b006a6604e1b$var$upload","description","$6349b006a6604e1b$var$_upload","gif","labelText","response","formData","$j8sUl","FormData","method","headers","Authorization","ok","json","link","$6349b006a6604e1b$export$b1dd62fa0b5f32f5","inputTitle","inputDescription","rows","labelTitle","labelDescription","tos","typeRadio","outDiv","infoHint","deletehash","$ae23cd0c3e53f398$var$agPsdLazy","$ae23cd0c3e53f398$export$ab3d838b1d336b38","$ae23cd0c3e53f398$var$_loadAgPsd","$06e8423858d08972$export$befc6437ad34b28a","showReminder","changeTitle","onSaveAsPsd","lastSavedActionNumber","lastSavedAt","psdWrapper","storageWrapper","paddingBottom","psdBtn","storageUi","closeFunc","lastReminderShownAt","onBeforeUnload","returnValue","getActionNumber","visibilityState","unsavedActions","showPopup","unsavedInterval","$956d06d740fc5053$export$75e7b60500bb415b","getExportType","format","saveImage","mimeType","$98ax7","saveAs","fnameArr","fileBase","layerArr1","psdConfig","blendKlToPsd","writePsdBuffer","XMLHttpRequest","responseType","send","a1","status","dispatchEvent","createEvent","initMouseEvent","self","$parcel$global","global","HTMLAnchorElement","download","rel","msSaveOrOpenBlob","autoBom","warn","HTMLElement","safari","onloadend","readAsDataURL","define","amd","$48534f13b7192dff$export$5cebd3bb2d68229a","getInitState","setCurrentLayerCtx","getCurrentBrush","doIgnore","ignoreTest","oldSize","id1","b3","currentLayerIndex","logParam","localCurrentLayerCtx","$53cc60fd413705d6$export$272bfd3ef9ef2f48","onSetColor","onSetSize","onSetOpacity","onGetColor","onGetSize","onGetOpacity","onGetSliderConfig","subscriberArr","instance","skipSubscriber","$5562b5b6c391a7ca$export$5d396b237bd33221","onLeftRight","customAbout","makeLicenses","licenses","overflowY","language","getLanguage","preferredLanguageRow","$fgfvl","languages","languageSelect","LS_LANGUAGE_KEY","languageHint","$7OLuX","$6qSiv","$951e508110f8a437$export$42a534af7eb650e8","upBtn","downBtn","upInterval","scrollBy","downInterval","wheelListener","$b37f5cd553722692$export$665d2c76b1eb8459","submitButton","leftRightButton","$4bb0d03ef02dc0c0$var$importFilter","libObj","moduleObj","$4bb0d03ef02dc0c0$export$4283b00eae4a6956","$iiVKq","filterBrightnessContrast","$lorQQ","filterCropExtend","$8Ri8I","filterCurves","$fADXF","filterFlip","$bIns5","filterHueSaturation","$30jcG","filterInvert","$cCks8","filterPerspective","$huXOx","filterResize","$dsRff","filterRotate","$lhchB","filterTiltShift","$lXpcU","filterTransform","$1CjeM","filterBlur","$dNWKZ","filterUnsharpMask","$94Tq7","filterToAlpha","$d8Fqy","filterGrid","$gtdB1","filterNoise","$024aabab8b30bbfd$export$af433fb90aa90a38","selectedLayerIndex","brightness","contrast","glCanvas","$5RaQo","getSharedFx","texture","brightnessSlider","$cH2YE","contrastSlider","previewInnerWrapper","$fca35583bfaa35b6$export$5ec472fd0ce20d84","$TEtAx","$0e6e34a2063e157d$var$fxCanvas","fx","$0e6e34a2063e157d$export$8c4423af32b21158","_","isContextLost","$dVkJn","$5eb53faa48338ac6$export$68ae324f2f6c6252","lo","hi","wrapTexture","loadContentsOf","Texture","fromElement","initialize","UNSIGNED_BYTE","getExtension","testTexture","RGBA","FLOAT","drawTo","spareTexture","extraTexture","flippedShader","Shader","use","getDefaultShader","drawRect","shader","uniforms","textureIn","textureOut","swapWith","node","getPixelArray","array","readPixels","getSquareToQuad","dx1","dy1","dx2","dy2","dx3","dy3","det","warpShader","warp","simpleShader","interpolator","red","green","blue","splineInterpolate","initFromBytes","textures","exponent","denoise","texSize","octaves","peaks","doInvert","colA","colB","channels","amount","sepia","strength","ensureFormat","triangleBlur","originalTexture","unuse","vibrance","vignette","lensBlurPrePass","randomShaderFunc","lensBlur0","common","lensBlur1","lensBlur2","texture1","power","delta0","endX","endY","blurRadius","gradientRadius","zoomBlur","colorHalftone","dotScreen","edgeWork","edgeWork1","edgeWork2","hexagonalPixelate","ink","bulgePinch","matrixWarp","inverse","useTextureSpace","getInverse","after","swirl","replaceRGBA","oldGetExtension","oldGetSupportedExtensions","getSupportedExtensions","createFramebuffer","createTexture","TEXTURE_2D","byteTexture","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","FRAMEBUFFER","framebuffer","COLOR_ATTACHMENT0","floatTexture","bindTexture","texParameteri","LINEAR","texImage2D","Float32Array","program","createProgram","vertexShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","shaderSource","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STREAM_DRAW","enableVertexAttribArray","vertexAttribPointer","useProgram","viewport","drawArrays","POINTS","WebGLRenderingContext","$OES_texture_float_linear$","OESTextureFloatLinear","getOESTextureFloatLinear","extensions","contents","lensBlur","source","nameStr","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","precisionType","getShaderPrecisionFormat","precision","vertexSource","fragmentSource","vertexAttribute","texCoordAttribute","defaultVertexSource","defaultFragmentSource","floatPrecision","testPrecisionSupport","HIGH_FLOAT","MEDIUM_FLOAT","attachShader","compileSource","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","getUniformLocation","uniform1fv","uniform2fv","uniform3fv","uniform4fv","uniformMatrix3fv","uniformMatrix4fv","isNumber","uniform1f","$2680b5781517cb67$export$e5937df51b9e1d86","updateInput","leftInput","rightInput","topInput","bottomInput","leftChanged","rightChanged","topChanged","bottomChanged","cropper","offsetWrapper","selectedRgbaObj","previewFactor","lrWrapper","tbWrapper","labelStyle","useRuleOfThirds","ruleOThirdsCheckbox","currentColorRgb","secondaryColorRgb","bgColorOverlay","updateBg","flexRow","$4c948640eb8ef791$export$309483fcb6d5c7ca","modeButtons","p0","areah","areaw","curveArea","createPoint","lock","internalY","internalX","newX","newY","updateControl","outCurves","drawCurve","spline","getDiv","$6b01e1931d168e01$export$9b1b7b3985b9625a","previewLayer","doFlipCanvas","horizontalCheckbox","verticalCheckbox","fcOption","borderTopLeftRadius","$1RI49","flOption","borderTopRightRadius","optionWrapper","horizontal","vertical","flipCanvas","$041c656037c77a96$export$2aa46bd5587f0eb","hueSlider","saturationSlider","Saturation","$82b3d1ba61b3412f$export$b7ebcfbdc840ef76","$460859cbeb601dec$export$a76d798fa7d85e4e","displayW","displayH","displayPreviewFactor","pointerListenerArr","bb","bc","bd","ac","ad","nob","updateAfter","beforeOption","afterOption","nobSize","$63d62a20f3ba2c7d$export$5705240d31427a82","previewW","previewH","algorithmSelect","canvasWrapper","inputWrapper","$jfTWC","constrainCheckbox","secondRowElement","$878715182dcd377b$export$ac7e9efc751d5791","WebkitTransform","MozTransform","OTransform","msTransform","btnPlus","btnMinus","$aa97ed406a9700f0$export$1b8796b18b7c19ed","fa","fb","blurSlider","gradientSlider","$31a0dd41d7428d32$export$dc15474d94cdc2b3","lastDrawnTransformStr","transformLayerCanvas","onInputsChanged","inputR","tempBounds","leftWrapper","rightWrapper","rotWrapper","actionBtnCss","buttonRow","flipXBtn","flipYBtn","scaleRotLeftBtn","scaleRotRightBtn","scaleDoubleBtn","getRatio","scaleHalfBtn","setConstrained","isSnapping","snappingCheckbox","setSnapping","checkboxWrapper","bottomRow","$95b95646154e8218$export$55e7eb2ebd0db869","radiusSlider","$82f12ab116cea855$export$62ac74a5ea43bd5c","strengthSlider","$a535e7a374deb8f5$export$6158ed2b22ebf4d9","sourceId","sourceOptions","$bad33651972f8d2c$export$50020de79e1bc23","renderW","renderH","$1xi6g","drawGrid","settingsObj","thickness","renderFactor","line1","line2","xInput","yInput","thicknessInput","$74df8e8cd35bce4e$export$20d2db9c68afeac","cellsX","cellsY","thickIsRound","pos1","$595c9469b8f94062$var$presetArr","$595c9469b8f94062$var$drawNoise","settings","$595c9469b8f94062$export$1dab0536099042f5","presetCopy","presetIndex","thumbImgArr","preset","thumbImg","presetOptions","row1El","row2El","channelsOptions","invertedToggle","blendSelect","colorWrapper","colInputStyle","colAInput","colBInput","$40b8cea12adf584e$export$92433b641be3f7a","$40b8cea12adf584e$var$_klCanvasToPsdBlob"],"version":3,"file":"main-embed.00f99f72.js.map"}