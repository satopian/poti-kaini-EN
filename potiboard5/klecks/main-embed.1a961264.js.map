{"mappings":"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","sources":["src/app/script/main-embed.ts","src/app/script/polyfills/polyfills.ts","src/app/script/polyfills/polyfills-nomodule.ts","node_modules/mdn-polyfills/Node.prototype.append.js","node_modules/mdn-polyfills/Node.prototype.prepend.js","node_modules/mdn-polyfills/String.prototype.padStart.js","node_modules/mdn-polyfills/Array.prototype.findIndex.js","src/app/script/app/kl-app.ts","<<jsx-config-pragma.js>>","node_modules/@swc/helpers/src/_to_consumable_array.mjs","node_modules/@swc/helpers/src/_array_without_holes.mjs","node_modules/@swc/helpers/src/_non_iterable_spread.mjs","src/app/script/klecks/kl.ts","src/app/script/klecks/history/kl-history.ts","src/app/script/klecks/ui/modals/base/showModal.ts","src/app/script/klecks/ui/modals/modal-count.ts","src/app/script/bb/bb.ts","src/app/script/bb/base/browser.ts","src/app/script/bb/base/create-canvas.ts","src/app/script/bb/input/key-listener.ts","src/app/script/bb/input/pointer-listener.ts","src/app/script/bb/input/wheel-cleaner.ts","src/app/script/bb/input/pressure-normalizer.ts","src/app/script/bb/math/math.ts","src/app/script/bb/base/canvas.ts","src/app/script/bb/math/matrix.ts","src/app/script/bb/math/vec2.ts","src/app/script/bb/math/line.ts","src/app/script/bb/color/color.ts","src/app/script/bb/base/ui.ts","src/app/script/bb/base/bb-log.ts","src/app/script/bb/base/local-storage.ts","src/app/script/bb/input/event-chain/coalesced-exploder.ts","src/app/script/bb/input/event-chain/n-finger-tapper.ts","src/app/script/bb/input/event-chain/pinch-zoomer.ts","src/app/script/bb/input/event-chain/double-tapper.ts","src/app/script/bb/input/event-chain/one-pointer-limiter.ts","src/app/script/bb/input/event-chain/event-chain.ts","src/app/script/klecks/ui/modals/base/scroll-fix.ts","node_modules/@parcel/runtime-js/lib/runtime-ac5a13e6ed7d1c32.js","node_modules/@parcel/runtime-js/lib/runtime-287f00094a316f99.js","src/app/script/klecks/ui/modals/base/dynamic-modal.ts","src/app/script/klecks/ui/components/checkbox.ts","src/app/script/klecks/ui/components/input.ts","src/app/script/klecks/ui/components/select.ts","src/app/script/klecks/ui/components/image-toggle.ts","src/app/script/klecks/ui/components/image-radio-list.ts","src/app/script/klecks/ui/components/create-pen-pressure-toggle.ts","node_modules/@parcel/runtime-js/lib/runtime-5d5af97961b0b866.js","src/app/script/klecks/ui/components/box-toggle.ts","src/app/script/klecks/ui/components/kl-slider.ts","src/app/script/klecks/ui/components/slider-falloff.ts","src/app/script/klecks/ui/components/kl-slider-manual-input.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-343023b05f023704.js","src/app/script/klecks/ui/components/kl-color-slider.ts","node_modules/@parcel/runtime-js/lib/runtime-e949988766af13d3.js","src/app/script/klecks/brushes/erase-color.ts","src/app/script/klecks/ui/components/kl-color-slider-small.ts","src/app/script/klecks/ui/components/point-slider.ts","src/app/script/klecks/ui/components/color-options.ts","src/app/script/klecks/ui/components/options.ts","src/app/script/klecks/ui/components/status-overlay.ts","node_modules/@parcel/runtime-js/lib/runtime-e99dce5763a53828.js","src/app/script/klecks/ui/components/crop-copy.ts","src/app/script/klecks/ui/modals/clipboard-dialog.ts","src/app/script/klecks/ui/tool-tabs/layer-manager/layer-manager.ts","src/app/script/klecks/canvas/kl-canvas.ts","src/app/script/klecks/image-operations/flood-fill.ts","src/app/script/klecks/image-operations/shape-tool.ts","src/app/script/klecks/image-operations/render-text.ts","src/app/script/klecks/canvas/draw-project.ts","src/app/script/klecks/image-operations/gradient-tool.ts","src/app/script/klecks/canvas/translate-blending.ts","src/app/script/klecks/ui/tool-tabs/layer-manager/rename-layer-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-b31ab580fe87ed91.js","src/app/script/klecks/ui/tool-tabs/layer-manager/merge-layer-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-9d4db9a16894fc5d.js","node_modules/@parcel/runtime-js/lib/runtime-8689d3bdc90716d5.js","node_modules/@parcel/runtime-js/lib/runtime-67c3e5d0b4ea898f.js","node_modules/@parcel/runtime-js/lib/runtime-6f5bf53dff43e557.js","src/app/script/klecks/canvas-ui/workspace-svg-overlay.ts","src/app/script/klecks/canvas-ui/kl-canvas-workspace.ts","node_modules/@parcel/runtime-js/lib/runtime-d3176d0a84b6cab2.js","node_modules/@parcel/runtime-js/lib/runtime-fae9a2679085aa34.js","node_modules/@parcel/runtime-js/lib/runtime-313dd5ffb9b9f520.js","node_modules/@parcel/runtime-js/lib/runtime-2a18e2880edd0998.js","src/app/script/klecks/events/linetool-processor.ts","src/app/script/klecks/canvas-ui/canvas-preview.ts","src/app/script/klecks/ui/components/free-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-719757e47171233d.js","src/app/script/klecks/ui/components/free-transform-utils.ts","src/app/script/klecks/ui/components/free-transform-canvas.ts","src/app/script/klecks/ui/components/cropper.ts","src/app/script/klecks/ui/components/layer-preview.ts","src/app/script/klecks/ui/modals/show-import-as-layer-dialog.ts","src/app/script/klecks/ui/components/kl-image-dropper.ts","src/app/script/klecks/ui/components/overlay-toolspace.ts","src/app/script/klecks/ui/components/toolspace-top-row.ts","node_modules/@parcel/runtime-js/lib/runtime-7df504581c8b86ae.js","node_modules/@parcel/runtime-js/lib/runtime-051039d7aa46660a.js","node_modules/@parcel/runtime-js/lib/runtime-c3ac4661b4a56a9b.js","node_modules/@parcel/runtime-js/lib/runtime-b17cc4a4601be3c4.js","node_modules/@parcel/runtime-js/lib/runtime-ba29718ea135d20f.js","node_modules/@parcel/runtime-js/lib/runtime-4ecaac3815a70635.js","src/app/script/klecks/ui/components/tool-dropdown.ts","node_modules/@parcel/runtime-js/lib/runtime-8bdb8bdd8828f06e.js","node_modules/@parcel/runtime-js/lib/runtime-0b39f3111ea9252b.js","node_modules/@parcel/runtime-js/lib/runtime-48932223f89234d1.js","node_modules/@parcel/runtime-js/lib/runtime-7d10910deba19d0d.js","node_modules/@parcel/runtime-js/lib/runtime-88790bdf968aa944.js","node_modules/@parcel/runtime-js/lib/runtime-19a2d39e17cbc785.js","src/app/script/klecks/ui/components/toolspace-tool-row.ts","node_modules/@parcel/runtime-js/lib/runtime-41c7a6bdeb9cc3fc.js","node_modules/@parcel/runtime-js/lib/runtime-c4a854cd9c2e49c9.js","node_modules/@parcel/runtime-js/lib/runtime-71bc2704037e4034.js","node_modules/@parcel/runtime-js/lib/runtime-1efd7f94627b6b51.js","src/app/script/klecks/ui/components/toolspace-stabilizer-row.ts","src/app/script/klecks/ui/components/tab-row.ts","node_modules/@parcel/runtime-js/lib/runtime-16dea92aa233c3d8.js","src/app/script/klecks/ui/tool-tabs/hand-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-144f3179c6c3fe3c.js","src/app/script/klecks/ui/tool-tabs/fill-ui.ts","src/app/script/klecks/ui/tool-tabs/text-ui.ts","src/app/script/klecks/ui/tool-tabs/shape-ui.ts","src/app/script/klecks/ui/modals/new-image-dialog.ts","src/app/script/klecks/ui/components/table.ts","src/app/script/klecks/ui/components/toolspace-collapser.ts","node_modules/@parcel/runtime-js/lib/runtime-61134bbd82dc83a9.js","src/app/script/klecks/ui/modals/text-tool-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-4b94518680a7ea9a.js","node_modules/@parcel/runtime-js/lib/runtime-27c12d26a5335a1c.js","node_modules/@parcel/runtime-js/lib/runtime-a2156221f02ea6ff.js","node_modules/@parcel/runtime-js/lib/runtime-095fd25bc9573bb4.js","node_modules/@parcel/runtime-js/lib/runtime-91916a44e9213781.js","src/app/script/klecks/ui/modals/show-import-image-dialog.ts","src/app/script/klecks/storage/psd.ts","src/app/script/klecks/storage/indexed-db.ts","src/app/script/klecks/filters/filters.ts","node_modules/@parcel/runtime-js/lib/runtime-acf4a19a71cb937a.js","node_modules/@parcel/runtime-js/lib/runtime-d67887a6c0fb147f.js","node_modules/@parcel/runtime-js/lib/runtime-1951d0f45b837ff9.js","node_modules/@parcel/runtime-js/lib/runtime-bb176b3b6425aaaa.js","node_modules/@parcel/runtime-js/lib/runtime-dbc18e2745ca65c5.js","node_modules/@parcel/runtime-js/lib/runtime-80911ed486f33545.js","node_modules/@parcel/runtime-js/lib/runtime-eead2608d2fa5bd2.js","node_modules/@parcel/runtime-js/lib/runtime-9a1e033a88e16096.js","node_modules/@parcel/runtime-js/lib/runtime-c9bd458795fed0ba.js","node_modules/@parcel/runtime-js/lib/runtime-5626aa10019711dd.js","node_modules/@parcel/runtime-js/lib/runtime-2044b7aa526106e6.js","node_modules/@parcel/runtime-js/lib/runtime-21795bc53efbcb17.js","node_modules/@parcel/runtime-js/lib/runtime-d5912d6d1ba72424.js","node_modules/@parcel/runtime-js/lib/runtime-d72562b990dee7d8.js","node_modules/@parcel/runtime-js/lib/runtime-0b2b4c30952b5c7d.js","node_modules/@parcel/runtime-js/lib/runtime-64c83be280987e8f.js","node_modules/@parcel/runtime-js/lib/runtime-ca97bf89fb66f180.js","node_modules/@parcel/runtime-js/lib/runtime-9fe1796050e673a2.js","src/app/script/klecks/brushes/brushes.ts","src/app/script/klecks/brushes/pen-brush.ts","src/app/script/klecks/brushes/brushes-common.ts","src/app/script/klecks/brushes/alphas/brush-alphas.ts","src/app/script/bb/math/perlin.ts","src/app/script/klecks/brushes/blend-brush.ts","src/app/script/klecks/brushes/sketchy-brush.ts","src/app/script/klecks/brushes/pixel-brush.ts","src/app/script/klecks/brushes/eraser-brush.ts","src/app/script/klecks/brushes/smudge-brush.ts","src/app/script/klecks/brushes/chemy-brush.ts","src/app/script/klecks/brushes-ui/brushes-ui.ts","src/app/script/klecks/brushes-ui/pen-brush-ui.ts","src/app/script/klecks/brushes-ui/brushes-consts.ts","node_modules/@parcel/runtime-js/lib/runtime-317d41dd30e22153.js","src/app/script/klecks/brushes-ui/blend-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-fb4dfe91dd51f3ab.js","src/app/script/klecks/brushes-ui/sketchy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-9c55c239f6725590.js","src/app/script/klecks/brushes-ui/pixel-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-7deb3a76132d4783.js","src/app/script/klecks/brushes-ui/eraser-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-64ee3a6e15622cad.js","src/app/script/klecks/brushes-ui/smudge-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-69a46bfcd4b52be6.js","src/app/script/klecks/brushes-ui/chemy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-67968a5afa6a1356.js","src/app/script/klecks/ui/modals/show-iframe-modal.ts","src/app/script/klecks/ui/components/radio-list.ts","src/app/script/klecks/ui/components/browser-storage-ui.ts","src/app/script/klecks/storage/project-store.ts","src/app/script/klecks/storage/project-converter.ts","src/app/script/klecks/storage/base-64-to-blob.ts","src/app/script/klecks/ui/tool-tabs/file-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-237dc2978439233a.js","src/app/script/klecks/ui/tool-tabs/filter-tab.ts","src/app/script/klecks/ui/modals/imgur-upload.ts","node_modules/@parcel/runtime-js/lib/runtime-5b3a6227e48c006a.js","src/app/script/klecks/ui/components/save-reminder.ts","src/app/script/klecks/storage/save-to-computer.ts","src/app/script/bb/base/save-as.ts","src/app/script/klecks/history/undo-redo-catchup.ts","src/app/script/klecks/brushes-ui/brush-setting-service.ts","src/app/script/klecks/ui/tool-tabs/settings-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-476b50212be070a0.js","node_modules/@parcel/runtime-js/lib/runtime-f5c56ad551a77e9a.js","node_modules/@parcel/runtime-js/lib/runtime-4135c6b241ed0f39.js","src/app/script/klecks/ui/components/toolspace-scroller.ts","src/app/script/klecks/ui/tool-tabs/gradient-ui.ts","src/app/script/embed/embed-toolspace-top-row.ts","src/app/script/klecks/filters/filters-lazy.ts","src/app/script/klecks/filters/filter-brightness-contrast.ts","src/app/script/klecks/filters/filters-consts.ts","src/app/script/fx-canvas/shared-fx.ts","src/app/script/fx-canvas/fx-canvas.ts","src/app/script/fx-canvas/filters/brightness-contrast.ts","src/app/script/fx-canvas/core/simple-shader.ts","src/app/script/fx-canvas/core/fx-shader.ts","src/app/script/fx-canvas/core/gl.ts","src/app/script/fx-canvas/core/fx-texture.ts","src/app/script/fx-canvas/filters/curves.ts","src/app/script/fx-canvas/math/spline-interpolate.ts","src/app/script/fx-canvas/filters/hue-saturation.ts","src/app/script/fx-canvas/filters/noise.ts","src/app/script/fx-canvas/shaders/shader-noise.glsl","src/app/script/fx-canvas/filters/triangle-blur.ts","src/app/script/fx-canvas/shaders/random-shader-func.ts","src/app/script/fx-canvas/filters/tilt-shift.ts","src/app/script/fx-canvas/filters/matrix-warp.ts","src/app/script/fx-canvas/shaders/warp-shader.ts","src/app/script/fx-canvas/math/matrix.ts","src/app/script/fx-canvas/filters/unsharp-mask.ts","src/app/script/fx-canvas/filters/to-alpha.ts","src/app/script/fx-canvas/filters/invert.ts","src/app/script/fx-canvas/filters/perspective.ts","src/app/script/fx-canvas/filters/unmultiply-alpha.ts","src/app/script/fx-canvas/filters/distort.ts","src/app/script/fx-canvas/filters/multiply-alpha.ts","src/app/script/klecks/filters/filter-crop-extend.ts","src/app/script/klecks/filters/filter-curves.ts","src/app/script/klecks/filters/filter-curves/curves-input.ts","src/app/script/klecks/filters/filter-flip.ts","src/app/script/klecks/filters/filter-hue-saturation.ts","src/app/script/klecks/filters/filter-invert.ts","src/app/script/klecks/filters/filter-perspective.ts","src/app/script/klecks/ui/components/two-tabs.ts","src/app/script/klecks/filters/filter-resize.ts","node_modules/@parcel/runtime-js/lib/runtime-cd2cbb52134a8268.js","src/app/script/klecks/filters/filter-rotate.ts","src/app/script/klecks/filters/filter-tilt-shift.ts","src/app/script/klecks/filters/filter-transform.ts","src/app/script/klecks/filters/filter-blur.ts","src/app/script/klecks/filters/filter-unsharp-mask.ts","src/app/script/klecks/filters/filter-to-alpha.ts","src/app/script/klecks/filters/filter-grid.ts","src/app/script/klecks/image-operations/draw-grid.ts","src/app/script/klecks/filters/filter-noise.ts","src/app/script/klecks/filters/filter-pattern.ts","src/app/script/klecks/filters/filter-distort.ts","src/app/script/klecks/filters/filter-vanish-point.ts","src/app/script/klecks/image-operations/draw-vanish-point.ts","src/app/script/klecks/storage/kl-canvas-to-psd-blob.ts","src/app/script/klecks/events/line-smoothing.ts","src/app/script/klecks/events/line-sanitizer.ts","src/app/script/klecks/utils/translate-smoothing.ts","src/app/script/app/import-handler.ts","node_modules/@parcel/runtime-js/lib/runtime-6ea03b887069337c.js","node_modules/@parcel/runtime-js/lib/runtime-a1a8750389ec178d.js","src/app/script/app/console-api.ts"],"sourcesContent":["import './polyfills/polyfills';\r\nimport {KlApp} from './app/kl-app';\r\nimport {IKlProject} from './klecks/kl-types';\r\nimport {SaveReminder} from './klecks/ui/components/save-reminder';\r\nimport {klHistory} from './klecks/history/kl-history';\r\nimport {klPsdToKlProject, readPsd} from './klecks/storage/psd';\r\nimport {LANG} from './language/language';\r\nimport {loadAgPsd} from './klecks/storage/load-ag-psd';\r\n\r\nexport interface IEmbedParams {\r\n    project?: IKlProject;\r\n    psdBlob?: Blob;\r\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    embedUrl: string;\r\n    logoImg?: any;\r\n    bottomBar?: HTMLElement;\r\n    aboutEl?: HTMLElement;\r\n}\r\n\r\nexport interface IReadPSD {\r\n    blob: Blob;\r\n    callback: (k: IKlProject) => void;\r\n}\r\n\r\nexport function Embed (p: IEmbedParams) {\r\n\r\n    let isInitialized: boolean = false;\r\n    let klApp;\r\n    const psdQueue: IReadPSD[] = []; // queue of psds waiting while ag-psd is loading\r\n    let agPsd: any | 'error';\r\n\r\n    let loadingScreenEl = document.getElementById('loading-screen');\r\n    let loadingScreenTextEl = document.getElementById('loading-screen-text');\r\n    if (loadingScreenTextEl) {\r\n        loadingScreenTextEl.textContent = LANG('embed-init-waiting');\r\n    }\r\n\r\n    function onProjectReady (project: IKlProject) {\r\n        try {\r\n            if (isInitialized) {\r\n                throw new Error('Already called openProject');\r\n            }\r\n            isInitialized = true;\r\n\r\n            const saveReminder = new SaveReminder(\r\n                klHistory,\r\n                false,\r\n                false,\r\n                () => {},\r\n                () => klApp ? klApp.isDrawing() : false,\r\n                null,\r\n                null,\r\n            );\r\n            klApp = new KlApp(\r\n                project,\r\n                {\r\n                    saveReminder,\r\n                    bottomBar: p.bottomBar,\r\n                    aboutEl: p.aboutEl,\r\n                    embed: {\r\n                        url: p.embedUrl,\r\n                        onSubmit: p.onSubmit,\r\n                    },\r\n                }\r\n            );\r\n            saveReminder.init();\r\n\r\n            if (loadingScreenEl && loadingScreenEl.parentNode) {\r\n                loadingScreenEl.parentNode.removeChild(loadingScreenEl);\r\n            }\r\n            loadingScreenEl = null;\r\n            loadingScreenTextEl = null;\r\n\r\n            document.body.append(klApp.getEl());\r\n        } catch (e) {\r\n            if (loadingScreenTextEl) {\r\n                loadingScreenTextEl.textContent = ' ' + e;\r\n            }\r\n            if (loadingScreenEl) {\r\n                loadingScreenEl.className += 'loading-screen-error';\r\n            }\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    if (p.project) {\r\n        onProjectReady(p.project);\r\n    }\r\n    this.openProject = onProjectReady;\r\n    this.initError = (error: string) => {\r\n        if (loadingScreenTextEl) {\r\n            loadingScreenTextEl.textContent = ' ' + error;\r\n        }\r\n        if (loadingScreenEl) {\r\n            loadingScreenEl.className += 'loading-screen-error';\r\n        }\r\n    };\r\n    this.getPNG = (): Blob => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return klApp.getPNG();\r\n    };\r\n    this.getPSD = async (): Promise<Blob> => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return await klApp.getPSD();\r\n    };\r\n    this.readPSDs = (psds: IReadPSD[]) => {\r\n        if (psds.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const readItem = (item: IReadPSD) => {\r\n            try {\r\n                const psd = agPsd.readPsd(item.blob);\r\n                const project = klPsdToKlProject(readPsd(psd));\r\n                item.callback(project);\r\n            } catch (e) {\r\n                console.error('failed to read psd', e);\r\n                item.callback(null);\r\n            }\r\n        };\r\n\r\n        if (!agPsd) {\r\n            if (psdQueue.length === 0) {\r\n                // load ag-psd\r\n                (async () => {\r\n                    try {\r\n                        agPsd = await loadAgPsd();\r\n                    } catch (e) {\r\n                        agPsd = 'error';\r\n                    }\r\n                    while (psdQueue.length) {\r\n                        readItem(psdQueue.shift());\r\n                    }\r\n                })();\r\n            }\r\n            psds.forEach(item => {\r\n                psdQueue.push(item);\r\n            });\r\n        } else {\r\n            psds.forEach(readItem);\r\n        }\r\n    };\r\n}","import './polyfills-nomodule';\r\n\r\n/*\r\n * ---- Below ----------------------\r\n * features that didn't have support until *after* browsers supported the modules script tag:\r\n * chrome 61\r\n * edge 16\r\n * safari 11\r\n * firefox 60\r\n * https://caniuse.com/es6-module\r\n */\r\n\r\n// chrome 61, edge 79, safari 16, firefox 107\r\nif (!('scrollTo' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollTo', {\r\n        value: function (x: number, y: number) {\r\n            this.scrollLeft = x;\r\n            this.scrollTop = y;\r\n        },\r\n    });\r\n}\r\n\r\n// chrome 61, edge 79, safari 16, firefox 107\r\nif (!('scrollBy' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollBy', {\r\n        value: function (x: number, y: number) {\r\n            this.scrollLeft += x;\r\n            this.scrollTop += y;\r\n        },\r\n    });\r\n}\r\n\r\n// chrome 69, edge 79, safari 12, firefox 62\r\nif (!Array.prototype.flat) {\r\n    Object.defineProperty(Array.prototype, 'flat', {\r\n        configurable: true,\r\n        value: function flat () {\r\n            const depth = isNaN(arguments[0]) ? 1 : Number(arguments[0]);\r\n\r\n            return depth ? Array.prototype.reduce.call(this, function (acc, cur) {\r\n                if (Array.isArray(cur)) {\r\n                    acc.push.apply(acc, flat.call(cur, depth - 1));\r\n                } else {\r\n                    acc.push(cur);\r\n                }\r\n\r\n                return acc;\r\n            }, []) : Array.prototype.slice.call(this);\r\n        },\r\n        writable: true,\r\n    });\r\n}\r\n\r\n// sometimes Android WebView has no localStorage\r\nif (!('localStorage' in window)) {\r\n    try {\r\n        window['localStorage'] = {\r\n            getItem: () => null,\r\n            setItem: () => {},\r\n            removeItem: () => {},\r\n        } as any;\r\n    } catch (e) {\r\n        // maybe it fails?\r\n    }\r\n}\r\n","/**\r\n * features that were available before module script tags:\r\n * chrome 61\r\n * edge 16\r\n * safari 11\r\n * firefox 60\r\n * https://caniuse.com/es6-module\r\n */\r\n\r\nimport 'mdn-polyfills/Node.prototype.append';\r\nimport 'mdn-polyfills/Node.prototype.prepend'; // edge 17 (one version after module)\r\nimport 'mdn-polyfills/String.prototype.padStart';\r\nimport 'mdn-polyfills/Array.prototype.findIndex';","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"append\")||Object.defineProperty(e,\"append\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(n,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"prepend\")||Object.defineProperty(e,\"prepend\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","String.prototype.padStart||(String.prototype.padStart=function(t,n){return t>>=0,n=String(n||\" \"),this.length>t?String(this):((t-=this.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(this))});\n","Array.prototype.findIndex||Object.defineProperty(Array.prototype,\"findIndex\",{value:function(r){if(null==this)throw new TypeError('\"this\" is null or not defined');var e=Object(this),t=e.length>>>0;if(\"function\"!=typeof r)throw new TypeError(\"predicate must be a function\");for(var n=arguments[1],o=0;o<t;){var i=e[o];if(r.call(n,i,o,e))return o;o++}return-1}});\n","import {KL} from '../klecks/kl';\r\nimport {klHistory, TMiscFocusLayerHistoryEntry} from '../klecks/history/kl-history';\r\nimport {BB} from '../bb/bb';\r\nimport {showIframeModal} from '../klecks/ui/modals/show-iframe-modal';\r\nimport {EmbedToolspaceTopRow} from '../embed/embed-toolspace-top-row';\r\nimport {\r\n    IGradient,\r\n    IInitState,\r\n    IKlProject,\r\n    TDrawEvent,\r\n    TExportType,\r\n    TKlCanvasLayer,\r\n    TUiLayout,\r\n} from '../klecks/kl-types';\r\nimport {importFilters} from '../klecks/filters/filters-lazy';\r\nimport {base64ToBlob} from '../klecks/storage/base-64-to-blob';\r\nimport {klCanvasToPsdBlob} from '../klecks/storage/kl-canvas-to-psd-blob';\r\nimport {ProjectStore} from '../klecks/storage/project-store';\r\nimport {SaveReminder} from '../klecks/ui/components/save-reminder';\r\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\r\nimport {LANG} from '../language/language';\r\nimport {LocalStorage} from '../bb/base/local-storage';\r\nimport {LineSmoothing} from '../klecks/events/line-smoothing';\r\nimport {LineSanitizer} from '../klecks/events/line-sanitizer';\r\nimport {TabRow} from '../klecks/ui/components/tab-row';\r\nimport {LayerPreview} from '../klecks/ui/components/layer-preview';\r\nimport {KlColorSlider} from '../klecks/ui/components/kl-color-slider';\r\nimport {ToolspaceToolRow} from '../klecks/ui/components/toolspace-tool-row';\r\nimport {StatusOverlay} from '../klecks/ui/components/status-overlay';\r\nimport {SaveToComputer} from '../klecks/storage/save-to-computer';\r\nimport {ToolspaceCollapser} from '../klecks/ui/components/toolspace-collapser';\r\nimport {ToolspaceScroller} from '../klecks/ui/components/toolspace-scroller';\r\nimport {translateSmoothing} from '../klecks/utils/translate-smoothing';\r\nimport {ImportHandler} from './import-handler';\r\n\r\nimport toolPaintImg from '/src/app/img/ui/tool-paint.svg';\r\nimport toolHandImg from '/src/app/img/ui/tool-hand.svg';\r\nimport toolFillImg from '/src/app/img/ui/tool-fill.svg';\r\nimport toolGradientImg from '/src/app/img/ui/tool-gradient.svg';\r\nimport toolTextImg from '/src/app/img/ui/tool-text.svg';\r\nimport toolShapeImg from '/src/app/img/ui/tool-shape.svg';\r\nimport tabSettingsImg from '/src/app/img/ui/tab-settings.svg';\r\nimport tabLayersImg from '/src/app/img/ui/tab-layers.svg';\r\nimport {LayerManager} from '../klecks/ui/tool-tabs/layer-manager/layer-manager';\r\nimport {IVector2D} from '../bb/bb-types';\r\nimport {createConsoleApi} from './console-api';\r\nimport {ERASE_COLOR} from '../klecks/brushes/erase-color';\r\n\r\ntype KlAppOptionsEmbed = {\r\n    url: string;\r\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n};\r\n\r\ninterface IKlAppOptions {\r\n    saveReminder?: SaveReminder;\r\n    projectStore?: ProjectStore;\r\n    logoImg?: string; // app logo\r\n    bottomBar?: HTMLElement; // row at bottom of toolspace\r\n    embed?: KlAppOptionsEmbed;\r\n    app?: {\r\n        filenameBase?: string; // part of filename when downloading drawing\r\n        imgurKey?: string; // for imgur uploads\r\n    };\r\n    aboutEl?: HTMLElement; // replaces info about Klecks in settings tab\r\n}\r\n\r\nimportFilters();\r\n\r\nexport class KlApp {\r\n\r\n    private readonly klRootEl: HTMLElement;\r\n    private uiWidth: number;\r\n    private uiHeight: number;\r\n    private readonly layerPreview: LayerPreview;\r\n    private readonly klColorSlider: KlColorSlider;\r\n    private readonly toolspaceToolRow: ToolspaceToolRow;\r\n    private readonly statusOverlay: StatusOverlay;\r\n    private readonly klCanvas: KlCanvas;\r\n    private uiState: TUiLayout;\r\n    private readonly embed: undefined | KlAppOptionsEmbed;\r\n    private readonly saveToComputer: SaveToComputer;\r\n    private readonly lineSanitizer: LineSanitizer;\r\n    private readonly klCanvasWorkspace: KlCanvasWorkspace;\r\n    private readonly collapseThreshold: number = 820;\r\n    private readonly toolspaceCollapser: ToolspaceCollapser;\r\n    private readonly toolspace: HTMLElement;\r\n    private readonly toolspaceInner: HTMLElement;\r\n    private readonly toolWidth: number = 271;\r\n    private readonly bottomBar: HTMLElement | undefined;\r\n    private readonly layerManager: LayerManager;\r\n    private readonly toolspaceScroller: ToolspaceScroller;\r\n    private readonly bottomBarWrapper: HTMLElement;\r\n\r\n    private updateCollapse (): void {\r\n\r\n        //collapser\r\n        if (this.uiWidth < this.collapseThreshold) {\r\n            this.toolspaceCollapser.getElement().style.display = 'block';\r\n\r\n            this.toolspaceCollapser.setDirection(this.uiState);\r\n            if (this.toolspaceCollapser.isOpen()) {\r\n                if (this.uiState === 'left') {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '271px',\r\n                        right: '',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '271px',\r\n                    });\r\n                } else {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '271px',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '0',\r\n                    });\r\n                }\r\n                this.toolspace.style.display = 'block';\r\n                this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\r\n                this.statusOverlay.setWide(false);\r\n\r\n            } else {\r\n                if (this.uiState === 'left') {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '0',\r\n                        right: '',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '0',\r\n                    });\r\n                } else {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '0',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '0',\r\n                    });\r\n                }\r\n                this.toolspace.style.display = 'none';\r\n                this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth), this.uiHeight);\r\n                this.statusOverlay.setWide(true);\r\n\r\n            }\r\n\r\n        } else {\r\n            this.toolspaceCollapser.getElement().style.display = 'none';\r\n            if (this.uiState === 'left') {\r\n                BB.css(this.klCanvasWorkspace.getElement(), {\r\n                    left: '271px',\r\n                });\r\n            } else {\r\n                BB.css(this.klCanvasWorkspace.getElement(), {\r\n                    left: '0',\r\n                });\r\n            }\r\n            this.toolspace.style.display = 'block';\r\n            this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\r\n            this.statusOverlay.setWide(false);\r\n        }\r\n    }\r\n\r\n    private updateBottomBar (): void {\r\n        if (!this.bottomBar) {\r\n            return;\r\n        }\r\n        const isVisible = (this.toolspaceInner.scrollHeight + 40 < window.innerHeight);\r\n        this.bottomBarWrapper.style.display = isVisible ? '' : 'none';\r\n    }\r\n\r\n    private updateUi (): void {\r\n        this.toolspace.classList.toggle('kl-toolspace--left', this.uiState === 'left');\r\n        this.toolspace.classList.toggle('kl-toolspace--right', this.uiState === 'right');\r\n        if (this.uiState === 'left') {\r\n            BB.css(this.toolspace, {\r\n                left: '0',\r\n                right: '',\r\n            });\r\n            BB.css(this.klCanvasWorkspace.getElement(), {\r\n                left: '271px',\r\n            });\r\n        } else {\r\n            BB.css(this.toolspace, {\r\n                left: '',\r\n                right: '0',\r\n            });\r\n            BB.css(this.klCanvasWorkspace.getElement(), {\r\n                left: '0',\r\n            });\r\n        }\r\n        this.statusOverlay.setUiState(this.uiState);\r\n        this.layerPreview.setUiState(this.uiState);\r\n        this.layerManager.setUiState(this.uiState);\r\n        this.updateCollapse();\r\n        this.toolspaceScroller.updateUiState(this.uiState);\r\n    }\r\n\r\n    // -------- public --------\r\n    constructor (\r\n        pProject: IKlProject | null,\r\n        pOptions: IKlAppOptions,\r\n    ) {\r\n        this.embed = pOptions.embed;\r\n        // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\r\n        // but not larger than 4096 - a fairly arbitrary decision\r\n        const klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\r\n        this.uiState = (this.embed ? 'left' : (LocalStorage.getItem('uiState') ? LocalStorage.getItem('uiState') : 'right')) as TUiLayout;\r\n        const filenameBase = pOptions.app?.filenameBase ? pOptions.app.filenameBase : 'Klecks';\r\n        const projectStore = pOptions.projectStore;\r\n        this.klRootEl = BB.el({\r\n            className: 'g-root',\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n            },\r\n        });\r\n        this.uiWidth = Math.max(0, window.innerWidth);\r\n        this.uiHeight = Math.max(0, window.innerHeight);\r\n        let exportType: TExportType = 'png';\r\n        this.klCanvas = new KL.KlCanvas(\r\n            pProject ? {\r\n                projectObj: pProject,\r\n            } : {\r\n                width: Math.max(10, Math.min(klMaxCanvasSize, window.innerWidth < this.collapseThreshold ? this.uiWidth : this.uiWidth - this.toolWidth)),\r\n                height: Math.max(10, Math.min(klMaxCanvasSize, this.uiHeight)),\r\n            }, this.embed ? -1 : 0);\r\n        this.klCanvas.setHistory(klHistory);\r\n        let initState: IInitState | null = null;\r\n        let mainTabRow: TabRow | undefined;\r\n\r\n        if (!pOptions.saveReminder) {\r\n            pOptions.saveReminder = {init: () => {}, reset: () => {}} as SaveReminder;\r\n        }\r\n\r\n        if (pProject) {\r\n            pProject.layers.forEach(layer => {\r\n                layer.image = null;\r\n            });\r\n            pProject = null;\r\n        } else {\r\n            klHistory.pause(true);\r\n            this.klCanvas.addLayer();\r\n            this.klCanvas.layerFill(0, {r: ERASE_COLOR, g: ERASE_COLOR, b: ERASE_COLOR});\r\n            klHistory.pause(false);\r\n        }\r\n        try {\r\n            initState = {\r\n                canvas: new KL.KlCanvas({copy: this.klCanvas}, this.embed ? -1 : 0),\r\n                focus: this.klCanvas.getLayerCount() - 1,\r\n                brushes: {},\r\n            };\r\n        } catch (e) {\r\n            if (e.message === 'kl-create-canvas-error') {\r\n                this.klCanvas.destroy();\r\n            }\r\n            throw e;\r\n        }\r\n        Object.entries(KL.brushes).forEach(([b, Brush]) => {\r\n            initState.brushes[b] = new Brush();\r\n            if (initState.canvas) {\r\n                initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\r\n            }\r\n        });\r\n\r\n\r\n        let currentColor = new BB.RGB(0, 0, 0);\r\n        let currentBrushUi;\r\n        let currentBrushId: string;\r\n        let lastNonEraserBrushId: string;\r\n        let currentLayerCtx = this.klCanvas.getLayerContext(this.klCanvas.getLayerCount() - 1);\r\n\r\n        // when cycling through brushes you need to know the next non-eraser brush\r\n        const getNextBrushId = (): string => {\r\n            if (currentBrushId === 'eraserBrush') {\r\n                return lastNonEraserBrushId;\r\n            }\r\n            const keyArr = Object.keys(brushUiMap).filter(item => item !== 'eraserBrush');\r\n            const i = keyArr.findIndex(item => item === currentBrushId);\r\n            return keyArr[(i + 1) % keyArr.length];\r\n        };\r\n\r\n        const sizeWatcher = (val) => {\r\n            brushSettingService.emitSize(val);\r\n            if (this.klCanvasWorkspace) {\r\n                this.klCanvasWorkspace.setCursorSize(val * 2);\r\n            }\r\n        };\r\n\r\n        const brushSettingService = new KL.BrushSettingService(\r\n            (color) => {\r\n                this.klColorSlider.setColor(color);\r\n                currentBrushUi.setColor(color);\r\n                currentColor = BB.copyObj(color);\r\n            },\r\n            (size) => {\r\n                currentBrushUi.setSize(size);\r\n                this.klCanvasWorkspace.setCursorSize(size * 2);\r\n            },\r\n            (opacity) => {\r\n                currentBrushUi.setOpacity(opacity);\r\n            },\r\n            () => this.klColorSlider.getColor(),\r\n            () => brushUiMap[currentBrushId].getSize(),\r\n            () => brushUiMap[currentBrushId].getOpacity(),\r\n            () => {\r\n                return {\r\n                    sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                    opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\r\n                };\r\n            }\r\n        );\r\n\r\n        const lineSmoothing = new LineSmoothing({\r\n            smoothing: translateSmoothing(1),\r\n        });\r\n        this.lineSanitizer = new LineSanitizer();\r\n\r\n        const drawEventChain = new BB.EventChain({\r\n            chainArr: [\r\n                this.lineSanitizer,\r\n                lineSmoothing,\r\n            ],\r\n        });\r\n\r\n        drawEventChain.setChainOut((event: TDrawEvent) => {\r\n            if (event.type === 'down') {\r\n                this.toolspace.style.pointerEvents = 'none';\r\n                currentBrushUi.startLine(event.x, event.y, event.pressure);\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n            if (event.type === 'move') {\r\n                currentBrushUi.goLine(event.x, event.y, event.pressure, false, event.isCoalesced);\r\n                this.klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n            if (event.type === 'up') {\r\n                this.toolspace.style.pointerEvents = '';\r\n                currentBrushUi.endLine();\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n            if (event.type === 'line') {\r\n                currentBrushUi.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n        });\r\n\r\n        const textToolSettings = {\r\n            size: 20,\r\n            align: 'left' as ('left' | 'center' | 'right'),\r\n            isBold: false,\r\n            isItalic: false,\r\n            font: 'sans-serif' as ('serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'),\r\n            opacity: 1,\r\n        };\r\n\r\n        this.klCanvasWorkspace = new KL.KlCanvasWorkspace({\r\n            klCanvas: this.klCanvas,\r\n            width: Math.max(0, this.uiWidth - this.toolWidth),\r\n            height: this.uiHeight,\r\n            onDraw: (e) => drawEventChain.chainIn(e),\r\n            onPick: (rgbObj, isDragDone) => {\r\n                brushSettingService.setColor(rgbObj);\r\n                if (isDragDone) {\r\n                    this.klColorSlider.pickingDone();\r\n                    this.klCanvasWorkspace.setMode(this.toolspaceToolRow.getActive());\r\n                }\r\n            },\r\n            onFill: (canvasX, canvasY) => {\r\n                const layerIndex = this.klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                this.klCanvas.floodFill(\r\n                    layerIndex,\r\n                    canvasX,\r\n                    canvasY,\r\n                    fillUi.getIsEraser() ? null : this.klColorSlider.getColor(),\r\n                    fillUi.getOpacity(),\r\n                    fillUi.getTolerance(),\r\n                    fillUi.getSample(),\r\n                    fillUi.getGrow(),\r\n                    fillUi.getContiguous()\r\n                );\r\n                this.klCanvasWorkspace.requestFrame();\r\n            },\r\n            onGradient: (typeStr, canvasX, canvasY, angleRad) => {\r\n                if (typeStr === 'down') {\r\n                    gradientTool.onDown(canvasX, canvasY, angleRad);\r\n                }\r\n                if (typeStr === 'move') {\r\n                    gradientTool.onMove(canvasX, canvasY);\r\n                }\r\n                if (typeStr === 'up') {\r\n                    gradientTool.onUp(canvasX, canvasY);\r\n                }\r\n            },\r\n            onText: (canvasX, canvasY, angleRad) => {\r\n                if (KL.dialogCounter.get() > 0) {\r\n                    return;\r\n                }\r\n\r\n                KL.textToolDialog({\r\n                    klCanvas: this.klCanvas,\r\n                    layerIndex: this.klCanvas.getLayerIndex(currentLayerCtx.canvas),\r\n                    x: canvasX,\r\n                    y: canvasY,\r\n                    angleRad: angleRad,\r\n                    color: this.klColorSlider.getColor(),\r\n                    secondaryColor: this.klColorSlider.getSecondaryRGB(),\r\n                    size: textToolSettings.size,\r\n                    align: textToolSettings.align,\r\n                    isBold: textToolSettings.isBold,\r\n                    isItalic: textToolSettings.isItalic,\r\n                    font: textToolSettings.font,\r\n                    opacity: textToolSettings.opacity,\r\n                    onConfirm: (val) => {\r\n\r\n                        const colorRGBA = val.color;\r\n                        colorRGBA.a = val.opacity;\r\n\r\n                        textToolSettings.size = val.size;\r\n                        textToolSettings.align = val.align;\r\n                        textToolSettings.isBold = val.isBold;\r\n                        textToolSettings.isItalic = val.isItalic;\r\n                        textToolSettings.font = val.font;\r\n                        textToolSettings.opacity = val.opacity;\r\n\r\n                        const layerIndex = this.klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                        this.klCanvas.text(layerIndex, {\r\n                            textStr: val.textStr,\r\n                            x: val.x,\r\n                            y: val.y,\r\n                            size: val.size,\r\n                            font: val.font,\r\n                            align: val.align,\r\n                            isBold: val.isBold,\r\n                            isItalic: val.isItalic,\r\n                            angleRad: angleRad,\r\n                            color: BB.ColorConverter.toRgbaStr(colorRGBA),\r\n                        });\r\n                        this.klCanvasWorkspace.requestFrame();\r\n                    },\r\n                });\r\n\r\n            },\r\n            onShape: (typeStr, canvasX, canvasY, angleRad) => {\r\n                if (typeStr === 'down') {\r\n                    shapeTool.onDown(canvasX, canvasY, angleRad);\r\n                }\r\n                if (typeStr === 'move') {\r\n                    shapeTool.onMove(canvasX, canvasY);\r\n                }\r\n                if (typeStr === 'up') {\r\n                    shapeTool.onUp(canvasX, canvasY);\r\n                }\r\n            },\r\n\r\n            onViewChange: (viewChangeObj) => {\r\n\r\n                if (viewChangeObj.changed.includes('scale')) {\r\n                    this.statusOverlay.out({\r\n                        type: 'transform',\r\n                        scale: viewChangeObj.scale,\r\n                        angleDeg: viewChangeObj.angle * 180 / Math.PI,\r\n                    });\r\n                }\r\n\r\n                this.toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== this.klCanvasWorkspace.getMaxScale());\r\n                this.toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== this.klCanvasWorkspace.getMinScale());\r\n\r\n                handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\r\n            },\r\n            onUndo: () => {\r\n                if (klHistory.canUndo()) {\r\n                    if (undoRedoCatchup.undo()) {\r\n                        this.statusOverlay.out(LANG('undo'), true);\r\n                    }\r\n                }\r\n            },\r\n            onRedo: () => {\r\n                if (klHistory.canRedo()) {\r\n                    if (undoRedoCatchup.redo()) {\r\n                        this.statusOverlay.out(LANG('redo'), true);\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        const updateMainTabVisibility = () => {\r\n            if (!mainTabRow) {\r\n                return;\r\n            }\r\n\r\n            const toolObj = {\r\n                'draw': {},\r\n                'hand': {},\r\n                'fill': {},\r\n                'gradient': {},\r\n                'text': {},\r\n                'shape': {},\r\n            };\r\n\r\n            const activeStr = this.toolspaceToolRow.getActive();\r\n            const oldTabId = mainTabRow.getOpenedTabId();\r\n\r\n            const keysArr = Object.keys(toolObj);\r\n            for (let i = 0; i < keysArr.length; i++) {\r\n                if (activeStr === keysArr[i]) {\r\n                    mainTabRow.setIsVisible(keysArr[i], true);\r\n                } else {\r\n                    mainTabRow.setIsVisible(keysArr[i], false);\r\n                    if (oldTabId === keysArr[i]) {\r\n                        mainTabRow.open(activeStr);\r\n                    }\r\n                }\r\n            }\r\n\r\n        };\r\n\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr) => {\r\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n\r\n                const isDrawing = this.lineSanitizer.getIsDrawing() || this.klCanvasWorkspace.getIsDrawing();\r\n                if (isDrawing) {\r\n                    return;\r\n                }\r\n\r\n                if (comboStr === 'plus') {\r\n                    this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n                }\r\n                if (comboStr === 'minus') {\r\n                    this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n                }\r\n                if (comboStr === 'home') {\r\n                    this.klCanvasWorkspace.fitView();\r\n                }\r\n                if (comboStr === 'end') {\r\n                    this.klCanvasWorkspace.resetView(true);\r\n                }\r\n                if (['ctrl+z', 'cmd+z'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    undoRedoCatchup.undo();\r\n                }\r\n                if (\r\n                    ['ctrl+y', 'cmd+y'].includes(comboStr) ||\r\n                    (\r\n                        (\r\n                            BB.sameKeys('ctrl+shift+z', comboStr) ||\r\n                            BB.sameKeys('cmd+shift+z', comboStr)\r\n                        ) && keyStr === 'z'\r\n                    )\r\n                ) {\r\n                    event.preventDefault();\r\n                    undoRedoCatchup.redo();\r\n                }\r\n                if (!this.embed) {\r\n                    if (['ctrl+s', 'cmd+s'].includes(comboStr)) {\r\n                        event.preventDefault();\r\n                        this.saveToComputer.save();\r\n                    }\r\n                    if (['ctrl+shift+s', 'cmd+shift+s'].includes(comboStr)) {\r\n                        event.preventDefault();\r\n\r\n                        (async () => {\r\n                            let success = true;\r\n                            try {\r\n                                await projectStore.store(this.klCanvas.getProject());\r\n                            } catch (e) {\r\n                                success = false;\r\n                                setTimeout(() => {\r\n                                    throw new Error('keyboard-shortcut: failed to store browser storage, ' + e);\r\n                                }, 0);\r\n                                this.statusOverlay.out(' ' + LANG('file-storage-failed'), true);\r\n                            }\r\n                            if (success) {\r\n                                pOptions.saveReminder.reset();\r\n                                this.statusOverlay.out(LANG('file-storage-stored'), true);\r\n                            }\r\n                        })();\r\n                    }\r\n                    if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\r\n                        event.preventDefault();\r\n                        copyToClipboard(true);\r\n                    }\r\n                }\r\n                if (['ctrl+a', 'cmd+a'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                }\r\n\r\n\r\n                if (keyListener.comboOnlyContains(['left', 'right', 'up', 'down'])) {\r\n                    if (keyStr === 'left') {\r\n                        this.klCanvasWorkspace.translateView(1, 0);\r\n                    }\r\n                    if (keyStr === 'right') {\r\n                        this.klCanvasWorkspace.translateView(-1, 0);\r\n                    }\r\n                    if (keyStr === 'up') {\r\n                        this.klCanvasWorkspace.translateView(0, 1);\r\n                    }\r\n                    if (keyStr === 'down') {\r\n                        this.klCanvasWorkspace.translateView(0, -1);\r\n                    }\r\n                }\r\n\r\n\r\n                if (['r+left','r+right'].includes(comboStr)) {\r\n                    if (keyStr === 'left') {\r\n                        this.klCanvasWorkspace.setAngle(-15, true);\r\n                        handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                    if (keyStr === 'right') {\r\n                        this.klCanvasWorkspace.setAngle(15, true);\r\n                        handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                }\r\n                if (['r+up'].includes(comboStr)) {\r\n                    this.klCanvasWorkspace.setAngle(0);\r\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                }\r\n\r\n\r\n                if (comboStr === 'sqbr_open') {\r\n                    currentBrushUi.decreaseSize(0.03 / this.klCanvasWorkspace.getScale());\r\n                }\r\n                if (comboStr === 'sqbr_close') {\r\n                    currentBrushUi.increaseSize(0.03 / this.klCanvasWorkspace.getScale());\r\n                }\r\n                if (comboStr === 'enter') {\r\n                    this.klCanvas.layerFill(this.klCanvas.getLayerIndex(currentLayerCtx.canvas), this.klColorSlider.getColor());\r\n                    this.statusOverlay.out(LANG('filled'), true);\r\n                }\r\n                if (['delete', 'backspace'].includes(comboStr)) {\r\n                    const layerIndex = this.klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                    if (layerIndex === 0 && !brushUiMap.eraserBrush.getIsTransparentBg()) {\r\n                        this.klCanvas.layerFill(layerIndex, {r: 255, g: 255, b: 255}, 'source-in');\r\n                    } else {\r\n                        this.klCanvas.clearLayer(layerIndex);\r\n                    }\r\n                    this.statusOverlay.out(LANG('cleared-layer'), true);\r\n                }\r\n                if (comboStr === 'e') {\r\n                    event.preventDefault();\r\n                    this.klCanvasWorkspace.setMode('draw');\r\n                    this.toolspaceToolRow.setActive('draw');\r\n                    mainTabRow && mainTabRow.open('draw');\r\n                    updateMainTabVisibility();\r\n                    brushTabRow.open('eraserBrush');\r\n                }\r\n                if (comboStr === 'b') {\r\n                    event.preventDefault();\r\n                    const prevMode = this.klCanvasWorkspace.getMode();\r\n                    this.klCanvasWorkspace.setMode('draw');\r\n                    this.toolspaceToolRow.setActive('draw');\r\n                    mainTabRow && mainTabRow.open('draw');\r\n                    updateMainTabVisibility();\r\n                    brushTabRow.open(prevMode === 'draw' ? getNextBrushId() : currentBrushId);\r\n                }\r\n                if (comboStr === 'g') {\r\n                    event.preventDefault();\r\n                    const newMode = this.klCanvasWorkspace.getMode() === 'fill' ? 'gradient' : 'fill';\r\n                    this.klCanvasWorkspace.setMode(newMode);\r\n                    this.toolspaceToolRow.setActive(newMode);\r\n                    mainTabRow && mainTabRow.open(newMode);\r\n                    updateMainTabVisibility();\r\n                }\r\n                if (comboStr === 't') {\r\n                    event.preventDefault();\r\n                    this.klCanvasWorkspace.setMode('text');\r\n                    this.toolspaceToolRow.setActive('text');\r\n                    mainTabRow && mainTabRow.open('text');\r\n                    updateMainTabVisibility();\r\n                }\r\n                if (comboStr === 'u') {\r\n                    event.preventDefault();\r\n                    this.klCanvasWorkspace.setMode('shape');\r\n                    this.toolspaceToolRow.setActive('shape');\r\n                    mainTabRow && mainTabRow.open('shape');\r\n                    updateMainTabVisibility();\r\n                }\r\n                if (comboStr === 'x') {\r\n                    event.preventDefault();\r\n                    this.klColorSlider.swapColors();\r\n                }\r\n\r\n\r\n            },\r\n            onUp: (keyStr, event) => {\r\n            },\r\n        });\r\n\r\n        const brushUiMap = {};\r\n        // create brush UIs\r\n        Object.entries(KL.brushesUI).forEach(([b, brushUi]) => {\r\n            const ui = new brushUi.Ui({\r\n                onSizeChange: sizeWatcher,\r\n                onOpacityChange: (opacity) => {\r\n                    brushSettingService.emitOpacity(opacity);\r\n                },\r\n                onConfigChange: () => {\r\n                    brushSettingService.emitSliderConfig({\r\n                        sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                        opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\r\n                    });\r\n                },\r\n            });\r\n            brushUiMap[b] = ui;\r\n            ui.getElement().style.padding = 10 + 'px';\r\n        });\r\n\r\n        this.statusOverlay = new KL.StatusOverlay();\r\n\r\n        this.toolspace = BB.el({\r\n            className: 'kl-toolspace',\r\n            css: {\r\n                position: 'absolute',\r\n                right: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                width: (this.toolWidth - 1) + 'px',\r\n                overflow: 'hidden',\r\n                userSelect: 'none',\r\n                touchAction: 'none',\r\n            },\r\n        });\r\n        this.toolspaceInner = BB.el({\r\n            parent: this.toolspace,\r\n        });\r\n        this.toolspace.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n        this.toolspace.onclick = BB.handleClick;\r\n\r\n\r\n        this.toolspaceCollapser = new KL.ToolspaceCollapser({\r\n            onChange: () => {\r\n                this.updateCollapse();\r\n            },\r\n        });\r\n\r\n        this.updateCollapse();\r\n\r\n\r\n\r\n\r\n\r\n        let overlayToolspace;\r\n        setTimeout(() => {\r\n            overlayToolspace = new KL.OverlayToolspace({\r\n                enabledTest: () => {\r\n                    return KL.dialogCounter.get() === 0 && !this.lineSanitizer.getIsDrawing();\r\n                },\r\n                brushSettingService,\r\n            });\r\n            this.klRootEl.append(overlayToolspace.getElement());\r\n        }, 0);\r\n\r\n        BB.append(\r\n            this.klRootEl,\r\n            [\r\n                this.klCanvasWorkspace.getElement(),\r\n                this.toolspace,\r\n                this.toolspaceCollapser.getElement(),\r\n            ]\r\n        );\r\n\r\n        let toolspaceTopRow;\r\n        if (this.embed) {\r\n            toolspaceTopRow = new EmbedToolspaceTopRow({\r\n                onHelp: () => {\r\n                    showIframeModal(this.embed.url + '/help.html', !!this.embed);\r\n                },\r\n                onSubmit: () => {\r\n                    KL.popup({\r\n                        target: this.klRootEl,\r\n                        message: LANG('submit-prompt'),\r\n                        buttons: [LANG('submit'), 'Cancel'],\r\n                        callback: async (result) => {\r\n                            if (result !== LANG('submit')) {\r\n                                return;\r\n                            }\r\n\r\n                            const overlay = BB.el({\r\n                                parent: this.klRootEl,\r\n                                className: 'upload-overlay',\r\n                                content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\r\n                            });\r\n\r\n                            this.embed.onSubmit(\r\n                                () => {\r\n                                    pOptions.saveReminder.reset();\r\n                                    this.klRootEl.removeChild(overlay);\r\n                                },\r\n                                () => {\r\n                                    this.klRootEl.removeChild(overlay);\r\n                                });\r\n                        },\r\n                    });\r\n                },\r\n                onLeftRight: () => {\r\n                    this.uiState = this.uiState === 'left' ? 'right' : 'left';\r\n                    this.updateUi();\r\n                },\r\n            });\r\n        } else {\r\n            toolspaceTopRow = new KL.ToolspaceTopRow({\r\n                logoImg: pOptions.logoImg,\r\n                onLogo: () => {\r\n                    showIframeModal('./home/', !!this.embed);\r\n                },\r\n                onNew: () => {\r\n                    showNewImageDialog();\r\n                },\r\n                onImport: () => {\r\n                    fileTab.triggerImport();\r\n                },\r\n                onSave: () => {\r\n                    this.saveToComputer.save();\r\n                },\r\n                onShare: () => {\r\n                    shareImage();\r\n                },\r\n                onHelp: () => {\r\n                    showIframeModal('./help/', !!this.embed);\r\n                },\r\n            });\r\n        }\r\n        toolspaceTopRow.getElement().style.marginBottom = '10px';\r\n        this.toolspaceInner.append(toolspaceTopRow.getElement());\r\n\r\n        this.toolspaceToolRow = new KL.ToolspaceToolRow({\r\n            onActivate: (activeStr) => {\r\n                if (activeStr === 'draw') {\r\n                    this.klCanvasWorkspace.setMode('draw');\r\n                } else if (activeStr === 'hand') {\r\n                    this.klCanvasWorkspace.setMode('hand');\r\n                } else if (activeStr === 'fill') {\r\n                    this.klCanvasWorkspace.setMode('fill');\r\n                } else if (activeStr === 'gradient') {\r\n                    this.klCanvasWorkspace.setMode('gradient');\r\n                } else if (activeStr === 'text') {\r\n                    this.klCanvasWorkspace.setMode('text');\r\n                } else if (activeStr === 'shape') {\r\n                    this.klCanvasWorkspace.setMode('shape');\r\n                } else {\r\n                    throw new Error('unknown activeStr');\r\n                }\r\n                mainTabRow && mainTabRow.open(activeStr);\r\n                updateMainTabVisibility();\r\n                this.klColorSlider.pickingDone();\r\n            },\r\n            onZoomIn: () => {\r\n                this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n            },\r\n            onZoomOut: () => {\r\n                this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n            },\r\n            onUndo: () => {\r\n                undoRedoCatchup.undo();\r\n            },\r\n            onRedo: () => {\r\n                undoRedoCatchup.redo();\r\n            },\r\n        });\r\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\r\n        klHistory.addListener(() => {\r\n            this.toolspaceToolRow.setEnableUndo(klHistory.canUndo());\r\n            this.toolspaceToolRow.setEnableRedo(klHistory.canRedo());\r\n        });\r\n        this.toolspaceInner.append(this.toolspaceToolRow.getElement());\r\n\r\n        const setBrushColor = (p_color) => {\r\n            currentColor = p_color;\r\n            currentBrushUi.setColor(p_color);\r\n            brushSettingService.emitColor(p_color);\r\n            this.klColorSlider.pickingDone();\r\n        };\r\n\r\n        this.klColorSlider = new KL.KlColorSlider({\r\n            width: 250,\r\n            height: 30,\r\n            svHeight: 100,\r\n            startValue: new BB.RGB(0, 0, 0),\r\n            onPick: setBrushColor,\r\n        });\r\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\r\n        this.klColorSlider.setPickCallback((doPick) => {\r\n\r\n            if (doPick) {\r\n                this.klCanvasWorkspace.setMode('pick');\r\n            } else {\r\n                this.klCanvasWorkspace.setMode(this.toolspaceToolRow.getActive());\r\n                updateMainTabVisibility();\r\n            }\r\n\r\n        });\r\n\r\n        const setCurrentBrush = (brushId) => {\r\n            if (brushId !== 'eraserBrush') {\r\n                lastNonEraserBrushId = brushId;\r\n            }\r\n\r\n            if (this.klColorSlider) {\r\n                if (brushId === 'eraserBrush') {\r\n                    this.klColorSlider.enable(false);\r\n                } else {\r\n                    this.klColorSlider.enable(true);\r\n                }\r\n            }\r\n\r\n            currentBrushId = brushId;\r\n            currentBrushUi = brushUiMap[brushId];\r\n            currentBrushUi.setColor(currentColor);\r\n            currentBrushUi.setContext(currentLayerCtx);\r\n            this.klCanvasWorkspace.setMode('draw');\r\n            this.toolspaceToolRow.setActive('draw');\r\n            updateMainTabVisibility();\r\n        };\r\n\r\n        const setCurrentLayer = (layer: TKlCanvasLayer) => { //BrushContext(p_context) {\r\n            currentLayerCtx = layer.context;\r\n            currentBrushUi.setContext(layer.context);\r\n            this.layerPreview.setLayer(layer);\r\n        };\r\n\r\n        const brushDiv = BB.el();\r\n        const colorDiv = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'flex-end',\r\n            },\r\n        });\r\n        const toolspaceStabilizerRow = new KL.ToolspaceStabilizerRow({\r\n            smoothing: 1,\r\n            onSelect: (v) => {\r\n                lineSmoothing.setSmoothing(translateSmoothing(v));\r\n            },\r\n        });\r\n\r\n\r\n        brushDiv.append(colorDiv);\r\n        BB.append(\r\n            colorDiv,\r\n            [this.klColorSlider.getElement(), this.klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n        );\r\n\r\n        const brushTabRow = new KL.TabRow({\r\n            initialId: 'penBrush',\r\n            useAccent: true,\r\n            tabArr: (() => {\r\n                const result = [];\r\n\r\n                const createTab = (keyStr) => {\r\n                    return {\r\n                        id: keyStr,\r\n                        image: KL.brushesUI[keyStr].image,\r\n                        title: KL.brushesUI[keyStr].tooltip,\r\n                        onOpen: () => {\r\n                            brushUiMap[keyStr].getElement().style.display = 'block';\r\n                            setCurrentBrush(keyStr);\r\n                            this.klColorSlider.pickingDone();\r\n                            brushSettingService.emitSliderConfig({\r\n                                sizeSlider: KL.brushesUI[keyStr].sizeSlider,\r\n                                opacitySlider: KL.brushesUI[keyStr].opacitySlider,\r\n                            });\r\n                            sizeWatcher(brushUiMap[keyStr].getSize());\r\n                            brushSettingService.emitOpacity(brushUiMap[keyStr].getOpacity());\r\n                        },\r\n                        onClose: () => {\r\n                            brushUiMap[keyStr].getElement().style.display = 'none';\r\n                        },\r\n                    };\r\n                };\r\n\r\n                const keyArr = Object.keys(brushUiMap);\r\n                for (let i = 0; i < keyArr.length; i++) {\r\n                    result.push(createTab(keyArr[i]));\r\n                }\r\n                return result;\r\n            })(),\r\n        });\r\n        BB.append(brushDiv, [\r\n            brushTabRow.getElement(),\r\n            ...Object.entries(KL.brushesUI).map(([b]) => brushUiMap[b].getElement()),\r\n        ]);\r\n\r\n        const handUi = new KL.HandUi({\r\n            scale: 1,\r\n            angleDeg: 0,\r\n            onReset: () => {\r\n                this.klCanvasWorkspace.resetView(true);\r\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n            },\r\n            onFit: () => {\r\n                this.klCanvasWorkspace.fitView();\r\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n            },\r\n            onAngleChange: (angleDeg, isRelative) => {\r\n                this.klCanvasWorkspace.setAngle(angleDeg, isRelative);\r\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n            },\r\n        });\r\n\r\n        const fillUi = new KL.FillUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const gradientUi = new KL.GradientUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const textUi = new KL.TextUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const shapeUi = new KL.ShapeUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const gradientTool = new KL.GradientTool({\r\n            onGradient: (isDone, x1, y1, x2, y2, angleRad) => {\r\n                const layerIndex = this.klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                const settings = gradientUi.getSettings();\r\n                const gradientObj: IGradient = {\r\n                    type: settings.type,\r\n                    color1: this.klColorSlider.getColor(),\r\n                    isReversed: settings.isReversed,\r\n                    opacity: settings.opacity,\r\n                    doLockAlpha: settings.doLockAlpha,\r\n                    isEraser: settings.isEraser,\r\n                    doSnap: keyListener.isPressed('shift') || settings.doSnap,\r\n                    x1,\r\n                    y1,\r\n                    x2,\r\n                    y2,\r\n                    angleRad,\r\n                };\r\n\r\n                if (isDone) {\r\n                    this.klCanvas.setComposite(layerIndex, null);\r\n                    this.klCanvas.drawGradient(layerIndex, gradientObj);\r\n                } else {\r\n                    this.klCanvas.setComposite(layerIndex, {\r\n                        draw: (ctx) => {\r\n                            KL.drawGradient(ctx, gradientObj);\r\n                        },\r\n                    });\r\n                }\r\n                this.klCanvasWorkspace.requestFrame();\r\n            },\r\n        });\r\n\r\n        const shapeTool = new KL.ShapeTool({\r\n            onShape: (isDone, x1, y1, x2, y2, angleRad) => {\r\n\r\n                const layerIndex = this.klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n\r\n                const shapeObj: any = {\r\n                    type: shapeUi.getShape(),\r\n                    x1: x1,\r\n                    y1: y1,\r\n                    x2: x2,\r\n                    y2: y2,\r\n                    angleRad: angleRad,\r\n                    isOutwards: shapeUi.getIsOutwards(),\r\n                    opacity: shapeUi.getOpacity(),\r\n                    isEraser: shapeUi.getIsEraser(),\r\n                    doLockAlpha: shapeUi.getDoLockAlpha(),\r\n                };\r\n                if (shapeUi.getShape() === 'line') {\r\n                    shapeObj.strokeRgb = this.klColorSlider.getColor();\r\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                    shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed('shift');\r\n                } else {\r\n                    shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed('shift');\r\n                    if (shapeUi.getMode() === 'stroke') {\r\n                        shapeObj.strokeRgb = this.klColorSlider.getColor();\r\n                        shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                    } else {\r\n                        shapeObj.fillRgb = this.klColorSlider.getColor();\r\n                    }\r\n                }\r\n\r\n                if (isDone) {\r\n                    this.klCanvas.setComposite(layerIndex, null);\r\n                    this.klCanvas.drawShape(layerIndex, shapeObj);\r\n                } else {\r\n                    this.klCanvas.setComposite(layerIndex, {\r\n                        draw: (ctx) => {\r\n                            KL.drawShape(ctx, shapeObj);\r\n                        },\r\n                    });\r\n                }\r\n                this.klCanvasWorkspace.requestFrame();\r\n\r\n            },\r\n        });\r\n\r\n        this.layerManager = new KL.LayerManager(\r\n            this.klCanvas,\r\n            (val) => {\r\n                setCurrentLayer(this.klCanvas.getLayer(val));\r\n                klHistory.push({\r\n                    tool: ['misc'],\r\n                    action: 'focusLayer',\r\n                    params: [val],\r\n                } as TMiscFocusLayerHistoryEntry);\r\n            },\r\n            this.klRootEl,\r\n            this.uiState,\r\n        );\r\n        this.layerPreview = new KL.LayerPreview({\r\n            klRootEl: this.klRootEl,\r\n            onClick: () => {\r\n                mainTabRow && mainTabRow.open('layers');\r\n            },\r\n            uiState: this.uiState,\r\n        });\r\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\r\n        this.layerPreview.setLayer(this.klCanvas.getLayer(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)));\r\n\r\n        const filterTab = new KL.FilterTab(\r\n            this.klRootEl,\r\n            this.klColorSlider,\r\n            this.layerManager,\r\n            this.klCanvasWorkspace,\r\n            handUi,\r\n            () => currentColor,\r\n            () => klMaxCanvasSize,\r\n            () => this.klCanvas,\r\n            () => currentLayerCtx,\r\n            !!this.embed,\r\n            this.statusOverlay,\r\n        );\r\n\r\n        const undoRedoCatchup = new KL.UndoRedoCatchup(\r\n            brushUiMap,\r\n            this.layerPreview,\r\n            this.layerManager,\r\n            handUi,\r\n            this.klCanvasWorkspace,\r\n            () => {\r\n                if (!initState) {\r\n                    throw new Error('initState not initialized');\r\n                }\r\n                return initState;\r\n            },\r\n            () => this.klCanvas,\r\n            () => currentLayerCtx,\r\n            (ctx) => {\r\n                currentLayerCtx = ctx;\r\n            },\r\n            () => currentBrushUi,\r\n        );\r\n        klHistory.addListener((p) => {\r\n            undoRedoCatchup.catchup(p);\r\n        });\r\n\r\n        const showNewImageDialog = () => {\r\n            KL.newImageDialog({\r\n                currentColor: currentColor,\r\n                secondaryColor: this.klColorSlider.getSecondaryRGB(),\r\n                maxCanvasSize: klMaxCanvasSize,\r\n                canvasWidth: this.klCanvas.getWidth(),\r\n                canvasHeight: this.klCanvas.getHeight(),\r\n                workspaceWidth: window.innerWidth < this.collapseThreshold ? this.uiWidth : this.uiWidth - this.toolWidth,\r\n                workspaceHeight: this.uiHeight,\r\n                onConfirm: (width, height, color) => {\r\n                    this.klCanvas.reset({\r\n                        width: width,\r\n                        height: height,\r\n                        color: color.a === 1 ? color : null,\r\n                    });\r\n\r\n                    this.layerManager.update(0);\r\n                    setCurrentLayer(this.klCanvas.getLayer(0));\r\n                    this.klCanvasWorkspace.resetView();\r\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                },\r\n                onCancel: () => {},\r\n            });\r\n        };\r\n\r\n        const shareImage = (callback?: () => void) => {\r\n            BB.shareCanvas({\r\n                canvas: this.klCanvas.getCompleteCanvas(1),\r\n                fileName: BB.getDate() + filenameBase + '.png',\r\n                title: BB.getDate() + filenameBase + '.png',\r\n                callback: callback ? callback : () => {},\r\n            });\r\n        };\r\n\r\n        this.saveToComputer = new KL.SaveToComputer(\r\n            pOptions.saveReminder,\r\n            this.klRootEl,\r\n            () => exportType,\r\n            () => this.klCanvas,\r\n            filenameBase,\r\n        );\r\n\r\n        const copyToClipboard = (showCrop?: boolean) => {\r\n            KL.clipboardDialog(\r\n                this.klRootEl,\r\n                this.klCanvas.getCompleteCanvas(1),\r\n                (inputObj) => {\r\n                    if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) {\r\n                        return;\r\n                    }\r\n                    //do a crop\r\n                    KL.filterLib.cropExtend.apply({\r\n                        context: currentLayerCtx,\r\n                        klCanvas: this.klCanvas,\r\n                        input: inputObj,\r\n                        history: klHistory,\r\n                    });\r\n                    this.layerManager.update();\r\n                    this.klCanvasWorkspace.resetView();\r\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                },\r\n                this.statusOverlay,\r\n                showCrop || false,\r\n            );\r\n        };\r\n\r\n        const fileTab = this.embed ? null : new KL.FileTab(\r\n            this.klRootEl,\r\n            projectStore,\r\n            () => this.klCanvas.getProject(),\r\n            exportType,\r\n            (type) => {\r\n                exportType = type;\r\n            },\r\n            (files, optionsStr) => importHandler.handleFileSelect(files, optionsStr),\r\n            () => this.saveToComputer.save(),\r\n            showNewImageDialog,\r\n            shareImage,\r\n            () => { // on upload\r\n                KL.imgurUpload(\r\n                    this.klCanvas,\r\n                    this.klRootEl,\r\n                    pOptions.saveReminder,\r\n                    pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : null,\r\n                );\r\n            },\r\n            copyToClipboard,\r\n            pOptions.saveReminder,\r\n        );\r\n\r\n        const settingsTab = new KL.SettingsTab(\r\n            () => {\r\n                this.uiState = this.uiState === 'left' ? 'right' : 'left';\r\n                this.updateUi();\r\n                if (!this.embed) {\r\n                    LocalStorage.setItem('uiState', this.uiState);\r\n                }\r\n            },\r\n            pOptions.aboutEl\r\n        );\r\n\r\n        mainTabRow = new KL.TabRow({\r\n            initialId: 'draw',\r\n            tabArr: [\r\n                {\r\n                    id: 'draw',\r\n                    title: LANG('tool-brush'),\r\n                    image: toolPaintImg,\r\n                    onOpen: () => {\r\n                        if (currentBrushId === 'eraserBrush') {\r\n                            this.klColorSlider.enable(false);\r\n                        }\r\n                        BB.append(\r\n                            colorDiv,\r\n                            [this.klColorSlider.getElement(), this.klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n                        );\r\n                        brushDiv.style.display = 'block';\r\n                    },\r\n                    onClose: () => {\r\n                        brushDiv.style.display = 'none';\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'hand',\r\n                    title: LANG('tool-hand'),\r\n                    image: toolHandImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        handUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        handUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'fill',\r\n                    title: LANG('tool-paint-bucket'),\r\n                    image: toolFillImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        fillUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        fillUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'gradient',\r\n                    title: LANG('tool-gradient'),\r\n                    image: toolGradientImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        gradientUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        gradientUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'text',\r\n                    title: LANG('tool-text'),\r\n                    image: toolTextImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        textUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        textUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'shape',\r\n                    title: LANG('tool-shape'),\r\n                    image: toolShapeImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        shapeUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        shapeUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'layers',\r\n                    title: LANG('layers'),\r\n                    image: tabLayersImg,\r\n                    onOpen: () => {\r\n                        this.layerManager.update();\r\n                        this.layerManager.getElement().style.display = 'block';\r\n                    },\r\n                    onClose: () => {\r\n                        this.layerManager.getElement().style.display = 'none';\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'edit',\r\n                    label: LANG('tab-edit'),\r\n                    onOpen: () => {\r\n                        filterTab.show();\r\n                    },\r\n                    onClose: () => {\r\n                        filterTab.hide();\r\n                    },\r\n                    css: {\r\n                        padding: '0 7px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'file',\r\n                    label: LANG('tab-file'),\r\n                    isVisible: !!fileTab,\r\n                    onOpen: () => {\r\n                        if (!fileTab) {\r\n                            return;\r\n                        }\r\n                        fileTab.getElement().style.display = 'block';\r\n                        fileTab.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        if (!fileTab) {\r\n                            return;\r\n                        }\r\n                        fileTab.getElement().style.display = 'none';\r\n                        fileTab.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        padding: '0 7px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'settings',\r\n                    title: LANG('tab-settings'),\r\n                    image: tabSettingsImg,\r\n                    onOpen: () => {\r\n                        settingsTab.getElement().style.display = 'block';\r\n                        // settingsTab.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        settingsTab.getElement().style.display = 'none';\r\n                        // settingsTab.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n            ],\r\n        });\r\n\r\n        this.bottomBarWrapper = BB.el({\r\n            css: {\r\n                width: '270px',\r\n                position: 'absolute',\r\n                bottom: '0',\r\n                left: '0',\r\n            },\r\n        });\r\n        if (pOptions.bottomBar) {\r\n            this.bottomBar = pOptions.bottomBar;\r\n            this.bottomBarWrapper.append(this.bottomBar);\r\n            const observer = new MutationObserver(() => this.updateBottomBar());\r\n            observer.observe(\r\n                this.toolspaceInner,\r\n                {\r\n                    attributes: true,\r\n                    childList: true,\r\n                    subtree: true,\r\n                }\r\n            );\r\n        }\r\n\r\n\r\n\r\n\r\n        BB.append(this.toolspaceInner, [\r\n            this.layerPreview.getElement(),\r\n            mainTabRow.getElement(),\r\n            brushDiv,\r\n            handUi.getElement(),\r\n            fillUi.getElement(),\r\n            gradientUi.getElement(),\r\n            textUi.getElement(),\r\n            shapeUi.getElement(),\r\n            this.layerManager.getElement(),\r\n            filterTab.getElement(),\r\n            fileTab ? fileTab.getElement() : undefined,\r\n            settingsTab.getElement(),\r\n            BB.el({\r\n                css: {\r\n                    height: '10px', // a bit of spacing at the bottom\r\n                },\r\n            }),\r\n            this.bottomBarWrapper ? this.bottomBarWrapper : undefined,\r\n        ]);\r\n\r\n        this.toolspaceScroller = new KL.ToolspaceScroller({\r\n            toolspace: this.toolspace,\r\n            uiState: this.uiState,\r\n        });\r\n\r\n        if (!this.embed) {\r\n            Object.defineProperty(window, 'KL', {\r\n                value: createConsoleApi({\r\n                    onDraw: (path: IVector2D[]): void => {\r\n                        if (!path || path.length === 0) {\r\n                            return;\r\n                        }\r\n                        path.forEach((p, index) => {\r\n                            if (index === 0) {\r\n                                currentBrushUi.startLine(p.x, p.y, 1);\r\n                            } else {\r\n                                currentBrushUi.goLine(p.x, p.y, 1);\r\n                            }\r\n                        });\r\n                        currentBrushUi.endLine();\r\n                        this.klCanvasWorkspace.requestFrame();\r\n                    },\r\n                }),\r\n                writable: false,\r\n            });\r\n        }\r\n\r\n        this.resize(this.uiWidth, this.uiHeight);\r\n        this.updateUi();\r\n\r\n        const importHandler = new ImportHandler({\r\n            klRootEl: this.klRootEl,\r\n            klMaxCanvasSize,\r\n            layerManager: this.layerManager,\r\n            setCurrentLayer,\r\n            klCanvas: this.klCanvas,\r\n            klCanvasWorkspace: this.klCanvasWorkspace,\r\n            handUi,\r\n        }, {\r\n            onColor: (rgb) => brushSettingService.setColor(rgb),\r\n        });\r\n\r\n        if (!this.embed) {\r\n            new KL.KlImageDropper({\r\n                target: document.body,\r\n                onDrop: (files, optionStr) => {\r\n                    if (KL.dialogCounter.get() > 0) {\r\n                        return;\r\n                    }\r\n                    importHandler.handleFileSelect(files, optionStr);\r\n                },\r\n                enabledTest: () => {\r\n                    return KL.dialogCounter.get() === 0;\r\n                },\r\n            });\r\n\r\n            window.addEventListener('paste', (e) => importHandler.onPaste(e), false);\r\n        }\r\n\r\n        {\r\n            window.addEventListener('resize', () => {\r\n                this.resize(window.innerWidth, window.innerHeight);\r\n            });\r\n            window.addEventListener('orientationchange', () => {\r\n                this.resize(window.innerWidth, window.innerHeight);\r\n            });\r\n\r\n            // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\r\n            // Workaround: place a div in the body that fills the window, and use a ResizeObserver\r\n            const windowResizeWatcher = BB.el({\r\n                parent: document.body,\r\n                css: {\r\n                    position: 'fixed',\r\n                    left: '0',\r\n                    top: '0',\r\n                    right: '0',\r\n                    bottom: '0',\r\n                    pointerEvents: 'none',\r\n                    zIndex: '-1',\r\n                    userSelect: 'none',\r\n                },\r\n            });\r\n            try {\r\n                // Not all browsers support ResizeObserver. Not critical though.\r\n                const observer = new ResizeObserver(() => this.resize(window.innerWidth, window.innerHeight));\r\n                observer.observe(windowResizeWatcher);\r\n            } catch (e) {\r\n                windowResizeWatcher.parentNode.removeChild(windowResizeWatcher);\r\n            }\r\n\r\n            // prevent ctrl scroll -> zooming page\r\n            this.klRootEl.addEventListener('wheel', (event) => {\r\n                if (keyListener.isPressed('ctrl')) {\r\n                    event.preventDefault();\r\n                }\r\n            });\r\n            //maybe prevent zooming on safari mac os - todo still needed?\r\n            const prevent = (e) => {\r\n                e.preventDefault();\r\n            };\r\n            window.addEventListener('gesturestart', prevent);\r\n            window.addEventListener('gesturechange', prevent);\r\n            window.addEventListener('gestureend', prevent);\r\n        }\r\n    }\r\n\r\n    // -------- interface --------\r\n\r\n    getEl (): HTMLElement {\r\n        return this.klRootEl;\r\n    }\r\n\r\n    resize (w: number, h: number): void {\r\n\r\n        // iPad scrolls down when increasing text zoom\r\n        if (window.scrollY > 0) {\r\n            window.scrollTo(0, 0);\r\n        }\r\n\r\n        if (this.uiWidth === Math.max(0, w) && this.uiHeight === Math.max(0, h)) {\r\n            return;\r\n        }\r\n\r\n        this.uiWidth = Math.max(0, w);\r\n        this.uiHeight = Math.max(0, h);\r\n\r\n        this.updateCollapse();\r\n        this.updateBottomBar();\r\n\r\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\r\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\r\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\r\n    }\r\n\r\n    out (msg: string): void {\r\n        this.statusOverlay.out(msg);\r\n    }\r\n\r\n    getPNG (): Blob {\r\n        return base64ToBlob(this.klCanvas.getCompleteCanvas(1).toDataURL('image/png'));\r\n    }\r\n\r\n    getPSD = async ():  Promise<Blob> => {\r\n        return await klCanvasToPsdBlob(this.klCanvas);\r\n    };\r\n\r\n    getProject (): IKlProject {\r\n        return this.klCanvas.getProject();\r\n    }\r\n\r\n    swapUiLeftRight (): void {\r\n        this.uiState = this.uiState === 'left' ? 'right' : 'left';\r\n        if (!this.embed) {\r\n            LocalStorage.setItem('uiState', this.uiState);\r\n        }\r\n        this.updateUi();\r\n    }\r\n\r\n    saveAsPsd (): void {\r\n        this.saveToComputer.save('psd');\r\n    }\r\n\r\n    isDrawing (): boolean {\r\n        return this.lineSanitizer.getIsDrawing() || this.klCanvasWorkspace.getIsDrawing();\r\n    }\r\n}\r\n",null,"import arrayWithoutHoles from './_array_without_holes.mjs';\nimport iterableToArray from './_iterable_to_array.mjs';\nimport nonIterableSpread from './_non_iterable_spread.mjs';\nimport unsupportedIterableToArray from './_unsupported_iterable_to_array.mjs';\n\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}\n","import _arrayLikeToArray from './_array_like_to_array.mjs';\n\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n","import {DecoyKlHistory, klHistory} from './history/kl-history';\r\nimport {showModal} from './ui/modals/base/showModal';\r\nimport {DynamicModal} from './ui/modals/base/dynamic-modal';\r\nimport {dialogCounter} from './ui/modals/modal-count';\r\nimport {Checkbox} from './ui/components/checkbox';\r\nimport {input} from './ui/components/input';\r\nimport {Select} from './ui/components/select';\r\nimport {ImageToggle} from './ui/components/image-toggle';\r\nimport {ImageRadioList} from './ui/components/image-radio-list';\r\nimport {createPenPressureToggle} from './ui/components/create-pen-pressure-toggle';\r\nimport {KlSlider} from './ui/components/kl-slider';\r\nimport {calcSliderFalloffFactor} from './ui/components/slider-falloff';\r\nimport {HexColorDialog} from './ui/modals/color-slider-hex-dialog';\r\nimport {KlColorSlider} from './ui/components/kl-color-slider';\r\nimport {KlColorSliderSmall} from './ui/components/kl-color-slider-small';\r\nimport {PointSlider} from './ui/components/point-slider';\r\nimport {ColorOptions} from './ui/components/color-options';\r\nimport {Options} from './ui/components/options';\r\nimport {StatusOverlay} from './ui/components/status-overlay';\r\nimport {CropCopy} from './ui/components/crop-copy';\r\nimport {clipboardDialog} from './ui/modals/clipboard-dialog';\r\nimport {LayerManager} from './ui/tool-tabs/layer-manager/layer-manager';\r\nimport {WorkspaceSvgOverlay} from './canvas-ui/workspace-svg-overlay';\r\nimport {KlCanvasWorkspace} from './canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvasPreview} from './canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './ui/components/free-transform';\r\nimport {FreeTransformCanvas} from './ui/components/free-transform-canvas';\r\nimport {Cropper} from './ui/components/cropper';\r\nimport {LayerPreview} from './ui/components/layer-preview';\r\nimport {showImportAsLayerDialog} from './ui/modals/show-import-as-layer-dialog';\r\nimport {KlImageDropper} from './ui/components/kl-image-dropper';\r\nimport {OverlayToolspace} from './ui/components/overlay-toolspace';\r\nimport {ToolspaceTopRow} from './ui/components/toolspace-top-row';\r\nimport {ToolDropdown} from './ui/components/tool-dropdown';\r\nimport {ToolspaceToolRow} from './ui/components/toolspace-tool-row';\r\nimport {ToolspaceStabilizerRow} from './ui/components/toolspace-stabilizer-row';\r\nimport {TabRow} from './ui/components/tab-row';\r\nimport {HandUi} from './ui/tool-tabs/hand-ui';\r\nimport {FillUi} from './ui/tool-tabs/fill-ui';\r\nimport {TextUi} from './ui/tool-tabs/text-ui';\r\nimport {ShapeUi} from './ui/tool-tabs/shape-ui';\r\nimport {newImageDialog} from './ui/modals/new-image-dialog';\r\nimport {ToolspaceCollapser} from './ui/components/toolspace-collapser';\r\nimport {renderText} from './image-operations/render-text';\r\nimport {textToolDialog} from './ui/modals/text-tool-dialog';\r\nimport {showImportImageDialog} from './ui/modals/show-import-image-dialog';\r\nimport {floodFillBits} from './image-operations/flood-fill';\r\nimport * as PSD from './storage/psd';\r\nimport {drawShape, ShapeTool} from './image-operations/shape-tool';\r\nimport {KlCanvas} from './canvas/kl-canvas';\r\nimport * as indexedDb from './storage/indexed-db';\r\nimport {setDbName} from './storage/indexed-db';\r\nimport {filterLib, filterLibStatus} from './filters/filters';\r\nimport {brushes} from './brushes/brushes';\r\nimport {brushesUI} from './brushes-ui/brushes-ui';\r\nimport {showIframeModal} from './ui/modals/show-iframe-modal';\r\nimport {RadioList} from './ui/components/radio-list';\r\nimport {BrowserStorageUi} from './ui/components/browser-storage-ui';\r\nimport {drawProject} from './canvas/draw-project';\r\nimport {ProjectStore} from './storage/project-store';\r\nimport {FileTab} from './ui/tool-tabs/file-tab';\r\nimport {FilterTab} from './ui/tool-tabs/filter-tab';\r\nimport {imgurUpload} from './ui/modals/imgur-upload';\r\nimport {loadAgPsd} from './storage/load-ag-psd';\r\nimport {SaveReminder} from './ui/components/save-reminder';\r\nimport {SaveToComputer} from './storage/save-to-computer';\r\nimport {UndoRedoCatchup} from './history/undo-redo-catchup';\r\nimport {BrushSettingService} from './brushes-ui/brush-setting-service';\r\nimport {BoxToggle} from './ui/components/box-toggle';\r\nimport {SettingsTab} from './ui/tool-tabs/settings-tab';\r\nimport {ToolspaceScroller} from './ui/components/toolspace-scroller';\r\nimport {GradientUi} from './ui/tool-tabs/gradient-ui';\r\nimport {drawGradient, GradientTool} from './image-operations/gradient-tool';\r\n\r\n/**\r\n * paint tool functionality\r\n */\r\nexport const KL = {\r\n\r\n    // --- brushes ---\r\n    brushes,\r\n    brushesUI,\r\n    BrushSettingService,\r\n\r\n    // --- canvas ---\r\n    KlCanvas,\r\n    drawProject,\r\n\r\n    // --- canvas ui ---\r\n    WorkspaceSvgOverlay,\r\n    KlCanvasWorkspace,\r\n    KlCanvasPreview,\r\n\r\n    // --- filters ---\r\n    filterLibStatus,\r\n    filterLib,\r\n\r\n    // --- history ---\r\n    UndoRedoCatchup,\r\n\r\n    // --- image operations ---\r\n    renderText,\r\n    floodFillBits,\r\n    ShapeTool,\r\n    drawShape,\r\n    GradientTool,\r\n    drawGradient,\r\n\r\n    // --- storage ---\r\n    PSD,\r\n    setDbName,\r\n    indexedDb,\r\n    ProjectStore,\r\n    loadAgPsd,\r\n    SaveToComputer,\r\n    \r\n    // --- ui - components ---\r\n    calcSliderFalloffFactor,\r\n    Checkbox,\r\n    input,\r\n    Select,\r\n    ImageToggle,\r\n    ImageRadioList,\r\n    RadioList,\r\n    createPenPressureToggle,\r\n    KlSlider,\r\n    HexColorDialog,\r\n    KlColorSlider,\r\n    KlColorSliderSmall,\r\n    PointSlider,\r\n    ColorOptions,\r\n    Options,\r\n    BoxToggle,\r\n    StatusOverlay,\r\n    CropCopy,\r\n    FreeTransform,\r\n    FreeTransformCanvas,\r\n    Cropper,\r\n    LayerPreview,\r\n    KlImageDropper,\r\n    OverlayToolspace,\r\n    ToolspaceTopRow,\r\n    ToolDropdown,\r\n    ToolspaceToolRow,\r\n    ToolspaceStabilizerRow,\r\n    TabRow,\r\n    ToolspaceCollapser,\r\n    BrowserStorageUi,\r\n    SaveReminder,\r\n    ToolspaceScroller,\r\n\r\n    // --- ui - modals ---\r\n    dialogCounter,\r\n    popup: showModal,\r\n    Popup: DynamicModal,\r\n    clipboardDialog,\r\n    showImportAsLayerDialog,\r\n    newImageDialog,\r\n    textToolDialog,\r\n    showImportImageDialog,\r\n    showIframePopup: showIframeModal,\r\n    imgurUpload,\r\n\r\n    // --- ui - tool tabs ---\r\n    HandUi,\r\n    FillUi,\r\n    GradientUi,\r\n    TextUi,\r\n    ShapeUi,\r\n    FileTab,\r\n    FilterTab,\r\n    SettingsTab,\r\n    LayerManager,\r\n\r\n    klHistory,\r\n    DecoyKlHistory,\r\n};","\r\n\r\n// --------- history entry types ------------------------------\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\nexport interface IHistoryAction {\r\n    action: string;\r\n    params: any[];\r\n}\r\n\r\nexport interface IHistoryEntry {\r\n    tool: string[];\r\n    action?: string;\r\n    params?: any[];\r\n    actions?: IHistoryAction[];\r\n}\r\n\r\ntype THistoryActionParams<T> = T extends (...args: infer A) => void ? A : never;\r\nexport type THistoryActions<ToolName, T> = {\r\n    [K in keyof T]: {\r\n        tool: [ToolName];\r\n        action: K;\r\n        params: THistoryActionParams<T[K]>;\r\n    }\r\n}[keyof T];\r\n\r\nexport type THistoryInnerActions<T> = {\r\n    [K in keyof T]: {\r\n        action: K;\r\n        params: THistoryActionParams<T[K]>;\r\n    }\r\n}[keyof T];\r\n\r\nexport type THistoryEntryG<Tool extends string[], Action extends string, Params extends unknown[]> = {\r\n    tool: Tool;\r\n    action: Action;\r\n    params: Params;\r\n}\r\n\r\nexport type TMiscImportImageHistoryEntry = THistoryEntryG<\r\n    ['misc'],\r\n    'importImage',\r\n    [HTMLCanvasElement, string | undefined]>;\r\n\r\nexport type TMiscFocusLayerHistoryEntry = THistoryEntryG<\r\n    ['misc'],\r\n    'focusLayer',\r\n    [number]>;\r\n\r\n// --------- classes etc ------------------------------\r\n\r\nexport interface IHistoryBroadcast {\r\n    bufferUpdate: IHistoryEntry;\r\n}\r\n\r\nlet historyInstance: boolean = false;\r\n\r\nexport type IHistoryListener = (p: IHistoryBroadcast | null) => void;\r\n\r\nexport interface KlHistoryInterface {\r\n    pause (b: boolean): void;\r\n    addListener (l: IHistoryListener): void;\r\n    push (e: IHistoryEntry): void;\r\n    undo (): IHistoryEntry[];\r\n    redo (): IHistoryEntry | undefined;\r\n    getAll (): (IHistoryEntry | null)[];\r\n    canRedo (): boolean;\r\n    canUndo (): boolean;\r\n    getState (): number;\r\n    getActionNumber (): number;\r\n}\r\n\r\nexport class DecoyKlHistory implements KlHistoryInterface {\r\n    pause (): void {}\r\n    addListener (): void {}\r\n    push (): void {}\r\n    undo (): IHistoryEntry[] { return []; }\r\n    redo (): (IHistoryEntry | undefined) { return undefined; }\r\n    getAll (): (IHistoryEntry | null)[] { return []; }\r\n    canRedo (): boolean { return false; }\r\n    canUndo (): boolean { return false; }\r\n    getState (): number { return 0; }\r\n    getActionNumber (): number { return 0; }\r\n}\r\n\r\nconst DO_DELETE_OLD = true;\r\n\r\nexport class KlHistory implements KlHistoryInterface {\r\n\r\n    private state: number; // on .push state increments by one\r\n    private readonly entries: (IHistoryEntry | null)[]; // null if beyond max undo to trigger garbage collection\r\n    private readonly listeners: IHistoryListener[];\r\n    private pauseStack: number; // how often paused without unpause\r\n    private readonly max: number = 20; // max number undo steps\r\n    private maxState: number; // can't go backwards -> max state is the buffer image(klCanvas)\r\n    private actionNumber: number; // current action the user is on. untouched document = -1 because dataArr.length is 0\r\n    \r\n    private broadcast (p: IHistoryBroadcast | null): void {\r\n        setTimeout(() => {\r\n            for (let i = 0; i < this.listeners.length; i++) {\r\n                this.listeners[i](p);\r\n            }\r\n            this.state++;\r\n        }, 1);\r\n    }\r\n    \r\n    // ---- public ----\r\n    \r\n    constructor () {\r\n        if (historyInstance) {\r\n            throw new Error('klHistory already instantiated');\r\n        }\r\n        historyInstance = true;\r\n        this.state = 0;\r\n        this.entries = [];\r\n        this.listeners = [];\r\n        this.pauseStack = 0;\r\n        this.maxState = -1;\r\n        this.actionNumber = -1;\r\n    }\r\n\r\n    /**\r\n     * Needed, because sometimes there are actions that would cause other undo steps.\r\n     * For example a filter that does something with two layers and then merges them.\r\n     * That should be a single undo step, and prevent merging from creating its own undo step.\r\n     * Pause prevents creation of unintended undo steps.\r\n     */\r\n    pause (b: boolean): void {\r\n        if (b) {\r\n            this.pauseStack++;\r\n        } else {\r\n            this.pauseStack = Math.max(0, this.pauseStack - 1);\r\n        }\r\n    }\r\n\r\n    addListener (l: IHistoryListener): void {\r\n        this.listeners.push(l);\r\n    }\r\n\r\n    push (newEntry: IHistoryEntry): void {\r\n        if (this.pauseStack > 0) {\r\n            return;\r\n        }\r\n        while (this.actionNumber < this.entries.length - 1) {\r\n            this.entries.pop();\r\n        }\r\n\r\n        //taking care of actions that shouldn't cause a new undo step\r\n        const lastEntry = this.entries[this.entries.length - 1];\r\n        if (\r\n            lastEntry && newEntry.tool[0] === 'canvas' && lastEntry.tool[0] === 'canvas' &&\r\n            newEntry.action === 'layerOpacity' && lastEntry.action === 'layerOpacity' &&\r\n            lastEntry.params[0] === newEntry.params[0]\r\n        ) {\r\n            this.entries[this.entries.length - 1] = newEntry;\r\n            this.state++; //still needs to increment because something changed\r\n            return;\r\n        }\r\n        if (newEntry.action === 'focusLayer' && lastEntry && lastEntry.action === 'focusLayer') {\r\n            this.entries[this.entries.length - 1] = newEntry;\r\n            this.state++;\r\n            return;\r\n        }\r\n\r\n        this.entries[this.entries.length] = newEntry;\r\n        this.actionNumber = this.entries.length - 1;\r\n        const maxBefore = this.maxState;\r\n        this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\r\n        if (maxBefore < this.maxState) {\r\n            const item = this.entries[this.maxState];\r\n            if (!item) {\r\n                throw new Error('this.dataArr[this.maxState] null');\r\n            }\r\n            this.broadcast({bufferUpdate: item});\r\n        } else {\r\n            this.broadcast(null);\r\n        }\r\n        if (DO_DELETE_OLD && this.maxState >= 0) {\r\n            this.entries[this.maxState] = null; //to free some memory...imported images take a lot of space\r\n        }\r\n    }\r\n\r\n    /**\r\n     * lowers action number, returns all entries that need to be executed\r\n     * on trailing snapshot to represent the canvas one undo step back.\r\n     * Empty array if can't undo\r\n     */\r\n    undo (): IHistoryEntry[] {\r\n        const result: IHistoryEntry[] = [];\r\n        if (!this.canUndo()) {\r\n            return result;\r\n        }\r\n        for (let i = this.maxState + 1; i < this.actionNumber; i++) {\r\n            result.push(throwIfNull(this.entries[i]));\r\n        }\r\n        this.actionNumber--;\r\n        this.broadcast(null);\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * raises action number, returns the action to be redone\r\n     */\r\n    redo (): (IHistoryEntry | undefined) {\r\n        if (!this.canRedo()) {\r\n            return undefined;\r\n        }\r\n        this.actionNumber++;\r\n        this.broadcast(null);\r\n        return throwIfNull(this.entries[this.actionNumber]);\r\n    }\r\n\r\n    getAll (): (IHistoryEntry | null)[] {\r\n        return [...this.entries];\r\n    }\r\n\r\n    canRedo (): boolean {\r\n        return this.actionNumber < this.entries.length - 1;\r\n    }\r\n\r\n    canUndo (): boolean {\r\n        return this.actionNumber > this.maxState;\r\n    }\r\n\r\n    getState (): number {\r\n        return this.state;\r\n    }\r\n\r\n    /**\r\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\r\n     */\r\n    getActionNumber (): number {\r\n        return (this.actionNumber + 1);\r\n    }\r\n    \r\n}\r\n\r\nexport const klHistory = new KlHistory();\r\n","import {IKeyString} from '../../../../bb/bb-types';\r\nimport {dialogCounter} from '../modal-count';\r\nimport {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport './scroll-fix';\r\nimport cancelImg from '/src/app/img/ui/cancel.svg';\r\nimport checkImg from '/src/app/img/ui/check.svg';\r\n\r\nexport function showModal (\r\n    p: {\r\n        target: HTMLElement;\r\n        div?: HTMLElement; // node with content\r\n        message: string; // can be html\r\n        callback?: (result: string) => void;\r\n        buttons?: string[]; // \"Ok\", and \"Cancel\" will be automatically translated\r\n        primaries?: string[];\r\n        type?: 'error' | 'warning' | 'upload' | 'ok'; // todo\r\n        closeFunc?: (f: () => void) => void; // returns a function you can call to close (Cancel) the dialog\r\n        style?: IKeyString;\r\n        clickOnEnter?: string; // name of button - will be clicked if enter key pressed\r\n        autoFocus?: false | string; // name of  to automatically focus - default 'Ok' - false -> none\r\n        ignoreBackground?: boolean; // deafult false; if true clicking on background doesn't close\r\n    }\r\n): void {\r\n    dialogCounter.increase();\r\n    let isClosed = false;\r\n\r\n\r\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\r\n    const rootRootEl = BB.el({\r\n        parent: document.body,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            overflow: 'hidden',\r\n        },\r\n    });\r\n    const rootEl = BB.el({\r\n        parent: rootRootEl,\r\n        className: 'kl-popup',\r\n    });\r\n\r\n    const scrollContent = BB.el({\r\n        parent: rootEl,\r\n        css: {\r\n            width: '100%',\r\n            minHeight: '100%',\r\n            // padding: '10px 0',\r\n            position: 'relative',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n        },\r\n    });\r\n\r\n    const bgEl = BB.el({\r\n        parent: scrollContent,\r\n        onClick: () => {\r\n            if (p.ignoreBackground) {\r\n                return;\r\n            }\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            zIndex: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n        },\r\n    });\r\n\r\n    const titleHeight = 40;\r\n    const xButton = BB.el({\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: () => {\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            position: 'absolute',\r\n            right: '0',\r\n            top: '0',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        },\r\n    });\r\n\r\n    const boxClasses = ['kl-popup-box'];\r\n    boxClasses.push('kl-popup-box--sm');\r\n    const boxEl = BB.el({\r\n        content: [\r\n            xButton,\r\n            BB.el({\r\n                content:p.message,\r\n                css: {\r\n                    marginBottom: p.div ? '10px' : undefined,\r\n                    marginRight: '15px',\r\n                },\r\n            }),\r\n            p.div,\r\n        ],\r\n        className: boxClasses.join(' '),\r\n        css: p.style ? p.style : undefined,\r\n    });\r\n\r\n    scrollContent.append(\r\n        BB.el({\r\n            css: {\r\n                flex: '0.5',\r\n            },\r\n        }),\r\n        boxEl,\r\n        BB.el({\r\n            css: {\r\n                flex: '1',\r\n            },\r\n        })\r\n    );\r\n\r\n    if (p.type === 'error') {\r\n        boxEl.classList.add('poperror');\r\n    }\r\n    if (p.type === 'ok') {\r\n        boxEl.classList.add('popok');\r\n    }\r\n    if (p.type === 'warning') {\r\n        boxEl.classList.add('popwarning');\r\n    }\r\n    if (p.type === 'upload') {\r\n        boxEl.classList.add('popupload');\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, e, comboStr) {\r\n            if (isClosed) {\r\n                return;\r\n            }\r\n            if (clickOnEnterBtn && comboStr === 'enter' && !BB.isInputFocused()) {\r\n                e.stopPropagation();\r\n                setTimeout(() => {\r\n                    clickOnEnterBtn && clickOnEnterBtn.click();\r\n                }, 10);\r\n            }\r\n            if (comboStr === 'esc') {\r\n                e.stopPropagation();\r\n                close('Cancel');\r\n            }\r\n        },\r\n    });\r\n    // prevent ctrl scroll -> zooming page\r\n    const wheelPrevent = (event: WheelEvent): void => {\r\n        if (keyListener.isPressed('ctrl')) {\r\n            event.preventDefault();\r\n        }\r\n    };\r\n    rootEl.addEventListener('wheel', wheelPrevent);\r\n    rootEl.onclick = BB.handleClick;\r\n\r\n    let autoFocus: string | undefined;\r\n    if (p.autoFocus) {\r\n        autoFocus = p.autoFocus;\r\n    } else if (p.autoFocus === false) {\r\n        autoFocus = undefined;\r\n    } else {\r\n        autoFocus = 'Ok';\r\n    }\r\n\r\n    const buttonRowEl = p.buttons && p.buttons.length > 0 ? BB.el({\r\n        parent: boxEl,\r\n        css: {\r\n            display: 'flex',\r\n            flexWrap: 'wrap',\r\n            justifyContent: 'flex-end',\r\n            marginTop: '12px', // 8px already via buttons\r\n            marginLeft: '-8px',\r\n        },\r\n    }) : null;\r\n    let clickOnEnterBtn: HTMLButtonElement | undefined;\r\n    const btnElArr: HTMLButtonElement[] = [];\r\n    if (p.buttons) {\r\n        p.buttons.forEach(buttonName => {\r\n            const btnClasses = ['kl-popup__btn'];\r\n            if (buttonName === 'Ok' || (p.primaries && p.primaries.includes(buttonName))) {\r\n                btnClasses.push('kl-button-primary');\r\n            }\r\n            let iconUrl;\r\n            let label = buttonName;\r\n            if (buttonName === 'Ok') {\r\n                label = LANG('modal-ok');\r\n                iconUrl = checkImg;\r\n            }\r\n            if (buttonName === 'Cancel') {\r\n                label = LANG('modal-cancel');\r\n                iconUrl = cancelImg;\r\n                btnClasses.push('kl-button-cancel');\r\n            }\r\n            let iconImg = null;\r\n            if (iconUrl) {\r\n                iconImg = BB.el({\r\n                    tagName: 'img',\r\n                    custom: {\r\n                        src: iconUrl,\r\n                        height: '17',\r\n                    },\r\n                });\r\n            }\r\n            const btn = BB.el({\r\n                parent: buttonRowEl || undefined,\r\n                tagName: 'button',\r\n                className: btnClasses.join(' '),\r\n                content: [\r\n                    iconImg || undefined,\r\n                    BB.el({\r\n                        className: 'kl-popup__btn__text',\r\n                        content: label,\r\n                    }),\r\n                ],\r\n                onClick: () => {\r\n                    close(buttonName);\r\n                },\r\n            }) as HTMLButtonElement;\r\n            btnElArr.push(btn);\r\n            if (autoFocus === buttonName) {\r\n                setTimeout(() => {\r\n                    btn.focus();\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 10);\r\n                setTimeout(() => {\r\n                    // safari needs a separate timeout\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 20);\r\n            }\r\n            if (buttonName === p.clickOnEnter) {\r\n                clickOnEnterBtn = btn;\r\n            }\r\n        });\r\n    }\r\n\r\n    function close (value: string) {\r\n        if (isClosed) {\r\n            return;\r\n        }\r\n\r\n        isClosed = true;\r\n        BB.clearSelection();\r\n        BB.unfocusAnyInput();\r\n        document.body.removeChild(rootRootEl);\r\n        dialogCounter.decrease();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        keyListener.destroy();\r\n        rootEl.removeEventListener('wheel', wheelPrevent);\r\n        rootEl.onclick = null;\r\n        btnElArr.forEach(item => BB.destroyEl(item));\r\n        btnElArr.splice(0, btnElArr.length);\r\n\r\n        if (p.callback) {\r\n            p.callback(value);\r\n        }\r\n    }\r\n\r\n    if (p.closeFunc) {\r\n        p.closeFunc(function () {\r\n            close('Cancel');\r\n        });\r\n    }\r\n\r\n}","\r\n// not the best\r\n\r\n/**\r\n * how many modals are open\r\n */\r\n\r\nexport class DialogCounter {\r\n    private listeners: ((v: number) => void)[] = [];\r\n    private count = 0;\r\n\r\n    private emit (): void {\r\n        this.listeners.forEach(item => {\r\n            item(this.count);\r\n        });\r\n    }\r\n\r\n    increase (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count += v;\r\n        } else {\r\n            this.count++;\r\n        }\r\n        this.emit();\r\n    }\r\n    decrease (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count -= v;\r\n        } else {\r\n            this.count--;\r\n        }\r\n        this.emit();\r\n    }\r\n    get (): number {\r\n        return this.count;\r\n    }\r\n    subscribe (listener: (v: number) => void): void {\r\n        this.listeners.push(listener);\r\n    }\r\n}\r\n\r\nexport const dialogCounter = new DialogCounter();\r\n","import {\r\n    append,\r\n    centerWithin,\r\n    copyObj,\r\n    createSvg,\r\n    css,\r\n    dateDayDifference,\r\n    decToFraction,\r\n    fitInto,\r\n    gcd,\r\n    getDate,\r\n    handleClick,\r\n    imageBlobToUrl,\r\n    insertAfter, isDark,\r\n    loadImage,\r\n    reduce,\r\n    setAttributes,\r\n    shareCanvas,\r\n    throwIfNull,\r\n} from './base/base';\r\nimport {\r\n    canShareFiles,\r\n    eventUsesHighResTimeStamp,\r\n    hasPointerEvents,\r\n    hasWebGl,\r\n    isCssMinMaxSupported,\r\n} from './base/browser';\r\nimport {KeyListener, sameKeys} from './input/key-listener';\r\nimport {PointerListener} from './input/pointer-listener';\r\nimport {\r\n    canvasBounds,\r\n    convertToAlphaChannelCanvas,\r\n    copyCanvas,\r\n    createCheckerCanvas,\r\n    createCheckerDataUrl,\r\n    ctx,\r\n    drawTransformedImageOnCanvas,\r\n    drawTransformedImageWithBounds,\r\n    freeCanvas,\r\n    resizeCanvas,\r\n    testShouldPixelate,\r\n} from './base/canvas';\r\nimport {Matrix} from './math/matrix';\r\nimport {Vec2} from './math/vec2';\r\nimport {BezierLine, PointLine, projectPointOnLine, quadraticSplineInput, SplineInterpolator} from './math/line';\r\nimport {CMYK, ColorConverter, HSV, RGB, testIsWhiteBestContrast} from './color/color';\r\nimport {\r\n    appendTextDiv,\r\n    clearSelection,\r\n    destroyEl,\r\n    el,\r\n    isInputFocused,\r\n    makeUnfocusable,\r\n    unfocusAnyInput,\r\n} from './base/ui';\r\nimport {\r\n    boundsInArea,\r\n    clamp,\r\n    dist,\r\n    distSquared,\r\n    intDxy,\r\n    isInsideRect,\r\n    lenSquared,\r\n    mix,\r\n    pointsToAngleDeg,\r\n    pointsToAngleRad,\r\n    rotate,\r\n    rotateAround,\r\n    round,\r\n    roundEven,\r\n    roundUneven,\r\n    updateBounds,\r\n} from './math/math';\r\nimport {createCanvas} from './base/create-canvas';\r\nimport {BbLog} from './base/bb-log';\r\nimport {LocalStorage} from './base/local-storage';\r\nimport {CoalescedExploder} from './input/event-chain/coalesced-exploder';\r\nimport {NFingerTapper} from './input/event-chain/n-finger-tapper';\r\nimport {PinchZoomer} from './input/event-chain/pinch-zoomer';\r\nimport {DoubleTapper} from './input/event-chain/double-tapper';\r\nimport {OnePointerLimiter} from './input/event-chain/one-pointer-limiter';\r\nimport {EventChain} from './input/event-chain/event-chain';\r\n\r\nexport const BB = {\r\n\r\n    // ---- browser ----\r\n    eventUsesHighResTimeStamp,\r\n    hasPointerEvents,\r\n    hasWebGl,\r\n    isCssMinMaxSupported,\r\n    canShareFiles,\r\n\r\n    // ---- base ----\r\n    insertAfter,\r\n    loadImage,\r\n    css,\r\n    setAttributes,\r\n    append,\r\n    fitInto,\r\n    centerWithin,\r\n    getDate,\r\n    gcd,\r\n    reduce,\r\n    decToFraction,\r\n    imageBlobToUrl,\r\n    dateDayDifference,\r\n    copyObj,\r\n    shareCanvas,\r\n    handleClick,\r\n    createSvg,\r\n    BbLog,\r\n    LocalStorage,\r\n    throwIfNull,\r\n    isDark,\r\n\r\n    // ---- math ----\r\n    mix,\r\n    dist,\r\n    distSquared,\r\n    lenSquared,\r\n    pointsToAngleRad,\r\n    pointsToAngleDeg,\r\n    isInsideRect,\r\n    clamp,\r\n    rotate,\r\n    rotateAround,\r\n    Matrix,\r\n    Vec2,\r\n    intDxy,\r\n    roundEven,\r\n    roundUneven,\r\n    round,\r\n    updateBounds,\r\n    boundsInArea,\r\n\r\n    // ---- line ----\r\n    projectPointOnLine,\r\n    PointLine,\r\n    BezierLine,\r\n    SplineInterpolator,\r\n    quadraticSplineInput,\r\n\r\n    // ---- canvas ----\r\n    canvas: createCanvas,\r\n    ctx,\r\n    copyCanvas,\r\n    testShouldPixelate,\r\n    drawTransformedImageWithBounds,\r\n    drawTransformedImageOnCanvas,\r\n    createCheckerCanvas,\r\n    createCheckerDataUrl,\r\n    resizeCanvas,\r\n    convertToAlphaChannelCanvas,\r\n    freeCanvas,\r\n    canvasBounds,\r\n\r\n    // ---- color ----\r\n    HSV,\r\n    RGB,\r\n    CMYK,\r\n    ColorConverter,\r\n    testIsWhiteBestContrast,\r\n\r\n    // ---- UI ----\r\n    appendTextDiv,\r\n    clearSelection,\r\n    makeUnfocusable,\r\n    el,\r\n    destroyEl,\r\n    isInputFocused,\r\n    unfocusAnyInput,\r\n\r\n\r\n    // ---- events / input ----\r\n\r\n    KeyListener,\r\n    PointerListener,\r\n    sameKeys,\r\n\r\n    EventChain,\r\n    DoubleTapper,\r\n    NFingerTapper,\r\n    PinchZoomer,\r\n    CoalescedExploder,\r\n    OnePointerLimiter,\r\n};\r\n","import {createCanvas} from './create-canvas';\r\n\r\nexport const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\r\n\r\nexport const eventUsesHighResTimeStamp = (function () {\r\n    const eventUsesHighResTimeStamp: boolean = new Event('').timeStamp < 1000 * 60 * 60;\r\n    return function (): boolean {\r\n        return eventUsesHighResTimeStamp;\r\n    };\r\n})();\r\n\r\nexport const hasPointerEvents = !!window.PointerEvent;\r\n\r\nexport const hasWebGl = (function () {\r\n\r\n    const hasWebgl = (function () {\r\n        const canvas = createCanvas();\r\n        try {\r\n            canvas.getContext('webgl', { premultipliedAlpha: false });\r\n            return true;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    })();\r\n\r\n    return function () {\r\n        return hasWebgl;\r\n    };\r\n})();\r\n\r\nexport const isCssMinMaxSupported = (function () {\r\n    let result: boolean | null = null;\r\n\r\n    function test () {\r\n        const div = document.createElement('div');\r\n        div.style.position = 'absolute';\r\n        div.style.top = '0';\r\n        div.style.left = 'max(0px, 25px)';\r\n        document.body.append(div);\r\n        setTimeout(function () {\r\n            result = div.offsetLeft === 25;\r\n            document.body.removeChild(div);\r\n        }, 25);\r\n    }\r\n\r\n    if (document.body) {\r\n        test();\r\n    } else {\r\n        window.addEventListener('DOMContentLoaded', function () {\r\n            test();\r\n        });\r\n    }\r\n\r\n    return function (): boolean {\r\n        if (result === null) {\r\n            throw new Error('isCssMinMaxSupported not initialized');\r\n        }\r\n        return result;\r\n    };\r\n})();\r\n\r\nexport const canShareFiles = function (): boolean {\r\n    return 'share' in navigator && 'canShare' in navigator;\r\n};","/*window['canvases'] = [];\r\n\r\nwindow['printCanvases'] = () => {\r\n    let total = 0;\r\n\r\n    console.log(window['canvases'].map(item => {\r\n        total += item.width * item.height;\r\n        return {w: item.width, h: item.height};\r\n    }));\r\n\r\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\r\n};*/\r\n\r\nexport function createCanvas (w?: number, h?: number): HTMLCanvasElement {\r\n    const result = document.createElement('canvas');\r\n    if (w && h) {\r\n        result.width = w;\r\n        result.height = h;\r\n    }\r\n    // window['canvases'].push(result);\r\n    return result;\r\n}","import {IKeyString} from '../bb-types';\r\n\r\ntype TGlobalKey = {\r\n    add: (keyListenerRef: TKeyListenerRef) => void;\r\n    remove: (keyListenerRef: TKeyListenerRef) => void;\r\n    getIsDown: () => TIsDown;\r\n    getCombo: () => string[];\r\n}\r\n\r\ntype TIsDown = {\r\n    [key: string]: boolean;\r\n};\r\n\r\ntype TOnDown = (keyStr: string, e: KeyboardEvent, comboStr: string, isRepeat?: boolean) => void;\r\ntype TOnUp = (keyStr: string, e: KeyboardEvent, oldComboStr: string) => void;\r\ntype TOnBlur = () => void;\r\ntype TKeyListenerRef = [\r\n    TOnDown | undefined,\r\n    TOnUp | undefined,\r\n    TOnBlur | undefined,\r\n];\r\n\r\n\r\nconst globalKey = ((): TGlobalKey => {\r\n\r\n    // keyStr - our key naming system\r\n    // key - KeyboardEvent.key\r\n    // code - KeyboardEvent.code\r\n\r\n    const keyStrToKeyObj = { // keyStr not to contain a '+', because that's used for the comboStr\r\n        'space': [' ', 'Spacebar'], // Spacebar in IE\r\n        'alt': ['Alt', 'AltGraph'],\r\n        'shift': 'Shift',\r\n        'ctrl': 'Control',\r\n        'cmd': ['Meta', 'MetaLeft', 'MetaRight'],\r\n        'enter': 'Enter',\r\n        'esc': 'Escape',\r\n        'backspace': 'Backspace',\r\n        'delete': 'Delete',\r\n        'sqbr_open': '[',\r\n        'sqbr_close': ']',\r\n        'a': ['a', 'A'],\r\n        'b': ['b', 'B'],\r\n        'c': ['c', 'C'],\r\n        'e': ['e', 'E'],\r\n        'f': ['f', 'F'],\r\n        'g': ['g', 'G'],\r\n        'r': ['r', 'R'], // when holding shift\r\n        's': ['s', 'S'],\r\n        't': ['t', 'T'],\r\n        'u': ['u', 'U'],\r\n        'x': ['x', 'X'],\r\n        'y': ['y', 'Y'],\r\n        'z': ['z', 'Z'],\r\n        'plus': '+',\r\n        'minus': '-',\r\n        'left': 'ArrowLeft',\r\n        'right': 'ArrowRight',\r\n        'up': 'ArrowUp',\r\n        'down': 'ArrowDown',\r\n        'home': 'Home',\r\n        'end': 'End',\r\n    };\r\n\r\n    // ['space', 'alt', ... ]\r\n    const keyStrArr = Object.keys(keyStrToKeyObj);\r\n\r\n    // { space: false, ... }\r\n    const isDownObj: TIsDown = Object.entries(keyStrToKeyObj).reduce((acc, [key]) => {\r\n        acc[key] = false;\r\n        return acc;\r\n    }, {} as TIsDown);\r\n\r\n    // event.key to keyStr\r\n    // { ArrowLeft: 'left', ... }\r\n    const keyToKeyStrObj = Object.entries(keyStrToKeyObj).reduce((acc, [key, code]) => {\r\n        if (typeof code === 'string') {\r\n            acc[code] = key;\r\n        } else {\r\n            code.forEach(item => {\r\n                acc[item] = key;\r\n            });\r\n        }\r\n        return acc;\r\n    }, {} as IKeyString);\r\n\r\n    let comboArr: string[] = [];\r\n\r\n    // a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\r\n    // { KeyE: 'e', KeyF: undefined } - undefined - not down, string - the associated keyStr\r\n    let codeIsDownObj: {\r\n        [key: string]: string | undefined;\r\n    } = {};\r\n    const listenerArr: TKeyListenerRef[] = [];\r\n\r\n\r\n    const emitDown: TOnDown = function (a, b, c, d?): void {\r\n        listenerArr.forEach(item => {\r\n            if (!item[0]) {\r\n                return;\r\n            }\r\n            item[0](a, b, c, d);\r\n        });\r\n    };\r\n\r\n    const emitUp: TOnUp = function (a, b, c): void {\r\n        listenerArr.forEach(item => {\r\n            if (!item[1]) {\r\n                return;\r\n            }\r\n            item[1](a, b, c);\r\n        });\r\n    };\r\n\r\n    const emitBlur: TOnBlur = function (): void {\r\n        listenerArr.forEach(item => {\r\n            if (!item[2]) {\r\n                return;\r\n            }\r\n            item[2]();\r\n        });\r\n    };\r\n\r\n    function keyDown (e: KeyboardEvent): void {\r\n        const key = e.key;\r\n        const code = e.code;\r\n\r\n        if (key in keyToKeyStrObj) {\r\n            const keyStr = keyToKeyStrObj[key];\r\n            if (isDownObj[keyStr]) {\r\n                emitDown(keyStr, e, comboArr.join('+'), true);\r\n                return;\r\n            }\r\n            isDownObj[keyStr] = true;\r\n            codeIsDownObj[code] = keyStr;\r\n\r\n            //add to combo\r\n            comboArr.push(keyStr);\r\n\r\n            emitDown(keyStr, e, comboArr.join('+'));\r\n        }\r\n    }\r\n\r\n\r\n    function keyUp (e: KeyboardEvent): void {\r\n        const code = e.code;\r\n        const oldComboStr = comboArr.join('+');\r\n\r\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\r\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\r\n        if ([\r\n            'Meta', 'MetaLeft', 'MetaRight',\r\n            'OSLeft', 'OSRight', // Firefox\r\n        ].includes(code)) {\r\n            blur();\r\n            return;\r\n        }\r\n\r\n        const keyStr = codeIsDownObj[code];\r\n        if (keyStr !== undefined) {\r\n            isDownObj[keyStr] = false;\r\n            codeIsDownObj[code] = undefined;\r\n\r\n            // remove from combo\r\n            for (let i = 0; i < comboArr.length; i++) {\r\n                if (comboArr[i] == keyStr) {\r\n                    comboArr.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n\r\n            emitUp(keyStr, e, oldComboStr);\r\n        }\r\n    }\r\n\r\n    function blur (): void {\r\n        const oldComboStr = comboArr.join('+');\r\n        comboArr = [];\r\n        codeIsDownObj = {};\r\n\r\n        const eventArr: string[] = [];\r\n        keyStrArr.forEach(keyStr => {\r\n            if (isDownObj[keyStr]) {\r\n                isDownObj[keyStr] = false;\r\n                eventArr.push(keyStr);\r\n            }\r\n        });\r\n        for (let i = 0; i < eventArr.length; i++) {\r\n            emitUp(\r\n                eventArr[i],\r\n                {\r\n                    preventDefault: function () {},\r\n                    stopPropagation: function () {},\r\n                } as KeyboardEvent,\r\n                oldComboStr,\r\n            );\r\n        }\r\n        emitBlur();\r\n    }\r\n\r\n\r\n\r\n    return {\r\n        add: (keyListenerRef: TKeyListenerRef): void => {\r\n            if (listenerArr.includes(keyListenerRef)) {\r\n                return;\r\n            }\r\n            const first = listenerArr.length === 0;\r\n            listenerArr.push(keyListenerRef);\r\n\r\n            if (first) {\r\n                document.addEventListener('keydown', keyDown);\r\n                document.addEventListener('keyup', keyUp);\r\n                window.addEventListener('blur', blur);\r\n            }\r\n        },\r\n        remove: (keyListenerRef: TKeyListenerRef): void => {\r\n            if (!listenerArr.includes(keyListenerRef)) {\r\n                return;\r\n            }\r\n            const last = listenerArr.length === 1;\r\n            for (let i = 0; i < listenerArr.length; i++) {\r\n                if (listenerArr[i] === keyListenerRef) {\r\n                    listenerArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n            if (last) {\r\n                document.removeEventListener('keydown', keyDown);\r\n                document.removeEventListener('keyup', keyUp);\r\n                window.removeEventListener('blur', blur);\r\n            }\r\n        },\r\n        getIsDown: (): TIsDown => isDownObj,\r\n        getCombo: (): string[] => comboArr,\r\n    };\r\n})();\r\n\r\n\r\n\r\n/**\r\n * Listens to key events in window. Makes combos easier - e.g. ctrl + z\r\n *\r\n * keyStr - see in implementation - my representation of a key. e.g. 'r' can be 'r' and 'R'\r\n * comboStr - string joins currently pressed keyStr with a +\r\n *              e.g. 'ctrl+z'\r\n *\r\n */\r\nexport class KeyListener {\r\n\r\n    private readonly onDown: TOnDown | undefined;\r\n    private readonly onUp: TOnUp | undefined;\r\n    private readonly onBlur: TOnBlur | undefined;\r\n    private readonly ref: TKeyListenerRef;\r\n\r\n    constructor (\r\n        p: {\r\n            onDown?: TOnDown;\r\n            onUp?: TOnUp;\r\n            onBlur?: TOnBlur;\r\n        },\r\n    ) {\r\n        this.onDown = p.onDown;\r\n        this.onUp = p.onUp;\r\n        this.onBlur = p.onBlur;\r\n        this.ref = [this.onDown, this.onUp, this.onBlur];\r\n        globalKey.add(this.ref);\r\n    }\r\n\r\n    isPressed (keyStr: string): boolean {\r\n        if (!(keyStr in globalKey.getIsDown())) {\r\n            throw 'key \"' + keyStr + '\" not found';\r\n        }\r\n        return globalKey.getIsDown()[keyStr];\r\n    }\r\n\r\n    getComboStr (): string {\r\n        return globalKey.getCombo().join('+');\r\n    }\r\n\r\n    comboOnlyContains (keyStrArr: string[]): boolean {\r\n        for (let i = 0; i < globalKey.getCombo().length; i++) {\r\n            if (!keyStrArr.includes(globalKey.getCombo()[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    destroy (): void {\r\n        globalKey.remove(this.ref);\r\n    }\r\n}\r\n\r\n/**\r\n * Test, are the same keys pressed. Order does not matter.\r\n */\r\nexport function sameKeys (comboAStr: string, comboBStr: string): boolean {\r\n    return comboAStr.split('+').sort().join('+') === comboBStr.split('+').sort().join('+');\r\n}","import {eventUsesHighResTimeStamp, hasPointerEvents, isFirefox} from '../base/browser';\r\nimport {WheelCleaner} from './wheel-cleaner';\r\nimport {IPointerEvent, IWheelEvent, TPointerButton, TPointerEventType, TPointerType} from './event.types';\r\nimport {PressureNormalizer} from './pressure-normalizer';\r\n\r\nexport interface IPointerListenerParams {\r\n    target: HTMLElement | SVGElement;\r\n    onPointer?: (pointerEvent: IPointerEvent) => void;\r\n    onWheel?: (wheelEvent: IWheelEvent) => void;\r\n    onEnterLeave?: (isOver: boolean) => void; // optional\r\n    maxPointers?: number; // int [1,n] default is 1 - how many concurrent pointers to pay attention to\r\n    fixScribble?: boolean; // fix ipad scribble issue - TODO remove, fixed start of 2022 -> https://bugs.webkit.org/show_bug.cgi?id=217430#c2\r\n}\r\n\r\ninterface IPointer {\r\n    pointerId: number;\r\n    lastPageX: number | null;\r\n    lastPageY: number | null;\r\n}\r\n\r\ninterface IDragObj {\r\n    pointerId: number; // long\r\n    pointerType?: TPointerType;\r\n    downPageX: number; //where was pointer when down-event occurred\r\n    downPageY: number;\r\n    buttons: number; // long\r\n    lastPageX: number; //pageX in previous event - only for touch events, because they don't have movementX/Y\r\n    lastPageY: number;\r\n    lastTimeStamp?: number;\r\n}\r\n\r\ninterface ICoalescedPointerEvent {\r\n    pageX: number;\r\n    pageY: number;\r\n    clientX: number;\r\n    clientY: number;\r\n    movementX: number;\r\n    movementY: number;\r\n    timeStamp: number;\r\n    pressure: number;\r\n}\r\n\r\ninterface ICorrectedPointerEvent {\r\n    pointerId: number;\r\n    pointerType: string;\r\n    pageX: number;\r\n    pageY: number;\r\n    clientX: number;\r\n    clientY: number;\r\n    movementX: number;\r\n    movementY: number;\r\n    timeStamp: number;\r\n    pressure: number; // normalized\r\n    buttons: number;\r\n    button: number;\r\n    coalescedArr: ICoalescedPointerEvent[];\r\n    eventPreventDefault: () => void;\r\n    eventStopPropagation: () => void;\r\n}\r\n\r\ninterface TExtendedDOMPointerEvent extends PointerEvent {\r\n    corrected: ICorrectedPointerEvent;\r\n}\r\n\r\n\r\n// keeping track of pointers for movement fallback\r\nconst pointerArr: IPointer[] = [];\r\n\r\nfunction addPointer (event: ICorrectedPointerEvent): IPointer {\r\n    const pointerObj: IPointer = {\r\n        pointerId: event.pointerId,\r\n        lastPageX: null,\r\n        lastPageY: null,\r\n    };\r\n    pointerArr.push(pointerObj);\r\n\r\n    if (pointerArr.length > 15) {\r\n        pointerArr.shift();\r\n    }\r\n\r\n    return pointerObj;\r\n}\r\n\r\nfunction getPointer (event: ICorrectedPointerEvent): IPointer | null {\r\n    for (let i = pointerArr.length - 1; i >= 0; i--) {\r\n        if (event.pointerId === pointerArr[i].pointerId) {\r\n            return pointerArr[i];\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction getButtonStr (buttons: number): TPointerButton | undefined {\r\n    switch (buttons) {\r\n        case 1:\r\n            return 'left';\r\n        case 2:\r\n            return 'right';\r\n        case 4:\r\n            return 'middle';\r\n        default:\r\n            return undefined;\r\n    }\r\n}\r\n\r\nconst pressureNormalizer = new PressureNormalizer();\r\nconst timeStampOffset = eventUsesHighResTimeStamp() ? 0 : -performance.timing.navigationStart;\r\n\r\n\r\nconst pointerDownEvt = hasPointerEvents ? 'pointerdown' : 'mousedown';\r\nconst pointerMoveEvt = hasPointerEvents ? 'pointermove' : 'mousemove';\r\nconst pointerUpEvt = hasPointerEvents ? 'pointerup' : 'mouseup';\r\nconst pointerCancelEvt = hasPointerEvents ? 'pointercancel' : 'mousecancel';\r\nconst pointerLeaveEvt = hasPointerEvents ? 'pointerleave' : 'mouseleave';\r\nconst pointerEnterEvt = hasPointerEvents ? 'pointerenter' : 'mouseenter';\r\n\r\n\r\n/**\r\n * More trustworthy pointer attributes. that behave the same across browsers.\r\n * returns a new object. Also attaches itself to the orig event. -> event.corrected\r\n */\r\nfunction correctPointerEvent (event: PointerEvent | TExtendedDOMPointerEvent): ICorrectedPointerEvent {\r\n    if ('corrected' in event) {\r\n        return event.corrected;\r\n    }\r\n\r\n    function determineButtons (): number {\r\n        if (event.buttons !== undefined) {\r\n            return event.buttons;\r\n        }\r\n        /*\r\n                button -> buttons\r\n        none:\tundefined -> 0\r\n        left:\t0 -> 1\r\n        middle:\t1 -> 4\r\n        right:\t2 -> 2\r\n        fourth:\t3 -> 8\r\n        fifth:\t4 -> 16\r\n         */\r\n        if (event.button !== undefined) { // old safari on mac has no buttons. remove eventually.\r\n            return [1,4,2,8,16][event.button];\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    const correctedObj: ICorrectedPointerEvent = {\r\n        pointerId: event.pointerId,\r\n        pointerType: event.pointerType,\r\n        pageX: event.pageX,\r\n        pageY: event.pageY,\r\n        clientX: event.clientX,\r\n        clientY: event.clientY,\r\n        movementX: event.movementX,\r\n        movementY: event.movementY,\r\n        timeStamp: event.timeStamp + timeStampOffset,\r\n        pressure: pressureNormalizer.normalize(event.pressure),\r\n        buttons: determineButtons(),\r\n        button: event.button,\r\n        coalescedArr: [],\r\n        eventPreventDefault: () => event.preventDefault(),\r\n        eventStopPropagation: () => event.stopPropagation(),\r\n    };\r\n    (event as TExtendedDOMPointerEvent).corrected = correctedObj;\r\n\r\n    let customPressure = null;\r\n    if ('pointerId' in event) {\r\n        if ('pressure' in event && event.buttons !== 0 && (['mouse'].includes(event.pointerType) || (event.pointerType === 'touch' && event.pressure === 0))) {\r\n            correctedObj.pressure = 1;\r\n            customPressure = 1;\r\n        }\r\n    } else {\r\n        correctedObj.pointerId = 0;\r\n        correctedObj.pointerType = 'mouse';\r\n        correctedObj.pressure = (event as PointerEvent).buttons !== 0 ? 1 : 0;\r\n        customPressure = correctedObj.pressure;\r\n    }\r\n\r\n    if (isFirefox && event.pointerType != 'mouse' && event.type === 'pointermove' && event.buttons === 0) { // once again firefox\r\n        correctedObj.buttons = 1; // todo wrong if no buttons actually pressed\r\n    }\r\n\r\n    let coalescedEventArr: PointerEvent[] = [];\r\n    if ('getCoalescedEvents' in event) {\r\n        coalescedEventArr = event.getCoalescedEvents();\r\n    }\r\n\r\n    // chrome somehow movementX not same scale as pageX. todo: only chrome?\r\n    // so make my own\r\n\r\n    const pointerObj: IPointer = getPointer(correctedObj) || addPointer(correctedObj);\r\n\r\n    const totalLastX = pointerObj.lastPageX;\r\n    const totalLastY = pointerObj.lastPageY;\r\n\r\n    for (let i = 0; i < coalescedEventArr.length; i++) {\r\n        const eventItem = coalescedEventArr[i];\r\n\r\n        correctedObj.coalescedArr.push({\r\n            pageX: eventItem.pageX,\r\n            pageY: eventItem.pageY,\r\n            clientX: eventItem.clientX,\r\n            clientY: eventItem.clientY,\r\n            movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\r\n            movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\r\n            timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : (eventItem.timeStamp + timeStampOffset), // 0 in firefox\r\n            pressure: customPressure === null ? pressureNormalizer.normalize(eventItem.pressure) : customPressure,\r\n        });\r\n\r\n        pointerObj.lastPageX = eventItem.pageX;\r\n        pointerObj.lastPageY = eventItem.pageY;\r\n    }\r\n\r\n    pointerObj.lastPageX = correctedObj.pageX;\r\n    pointerObj.lastPageY = correctedObj.pageY;\r\n    correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\r\n    correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\r\n\r\n    return correctedObj;\r\n}\r\n\r\n/**\r\n * PointerListener - for pointer events, wheel events. uses fallbacks. ideally consistent behavior across browsers.\r\n * Has some workarounds for browser specific bugs. As browsers evolve this constructor should get smaller.\r\n */\r\nexport class PointerListener {\r\n\r\n    private isDestroyed: boolean = false;\r\n\r\n    private readonly targetElement: HTMLElement | SVGElement;\r\n    private readonly onPointerCallback: undefined | ((pointerEvent: IPointerEvent) => void);\r\n    private readonly onWheelCallback: undefined | ((wheelEvent: IWheelEvent) => void);\r\n    private readonly onEnterLeaveCallback: undefined | ((isOver: boolean) => void);\r\n    private readonly maxPointers: number;\r\n    private readonly wheelCleaner: WheelCleaner;\r\n    private isOverCounter: number = 0;\r\n\r\n    // pointers that are pressing a button\r\n    private dragObjArr: IDragObj[] = [];\r\n    private dragPointerIdArr: number[] = [];\r\n\r\n    // chrome input glitch workaround\r\n    private lastPointerType: TPointerType | null = null;\r\n    private didSkip: boolean = false;\r\n\r\n    // listeners\r\n    private readonly onPointerEnter: (() => void) | undefined;\r\n    private readonly onPointerLeave: (() => void) | undefined;\r\n    private readonly onPointerMove: ((event: PointerEvent) => void) | undefined;\r\n    private readonly onPointerDown: ((event: PointerEvent, skipGlobal?: boolean) => void) | undefined;\r\n    private readonly onWheel: ((e: WheelEvent) => void) | undefined;\r\n    private readonly onTouchMoveScribbleFix: ((e: TouchEvent) => void) | undefined;\r\n    private readonly windowOnPointerMove: ((event: PointerEvent) => void) | undefined;\r\n    private readonly windowOnPointerUp: ((event: PointerEvent) => void) | undefined;\r\n    private readonly windowOnPointerLeave: ((event: PointerEvent) => void) | undefined;\r\n    // fallback pre pointer events (iOS < 13, as of 2023-02, still 4.4% of iOS users)\r\n    private readonly onTouchStart: ((e: TouchEvent) => void) | undefined;\r\n    private readonly onTouchMove: ((e: TouchEvent) => void) | undefined;\r\n    private readonly onTouchEnd: ((e: TouchEvent) => void) | undefined;\r\n    private readonly onTouchCancel: ((e: TouchEvent) => void) | undefined;\r\n\r\n\r\n    private getDragObj (pointerId: number): IDragObj | null {\r\n        for (let i = 0; i < this.dragObjArr.length; i++) {\r\n            if (pointerId === this.dragObjArr[i].pointerId) {\r\n                return this.dragObjArr[i];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private removeDragObj (pointerId: number): IDragObj | null {\r\n        let removedDragObj: IDragObj | null = null;\r\n        for (let i = 0; i < this.dragPointerIdArr.length; i++) {\r\n            if (this.dragPointerIdArr[i] === pointerId) {\r\n                removedDragObj = this.dragObjArr[i];\r\n                this.dragObjArr.splice(i, 1);\r\n                this.dragPointerIdArr.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n        return removedDragObj;\r\n    }\r\n\r\n    /**\r\n     * Creates a value for onPointer, from a pointer event handler.\r\n     */\r\n    private createPointerOutEvent (\r\n        typeStr: TPointerEventType,\r\n        correctedEvent: ICorrectedPointerEvent,\r\n        custom?: Partial<IPointerEvent>,\r\n    ): IPointerEvent {\r\n\r\n        const bounds: DOMRect = this.targetElement.getBoundingClientRect();\r\n        const result: IPointerEvent = {\r\n            type: typeStr,\r\n            pointerId: correctedEvent.pointerId,\r\n            pointerType: correctedEvent.pointerType as TPointerType,\r\n            pageX: correctedEvent.pageX,\r\n            pageY: correctedEvent.pageY,\r\n            clientX: correctedEvent.clientX,\r\n            clientY: correctedEvent.clientY,\r\n            relX: correctedEvent.clientX - bounds.left + this.targetElement.scrollLeft,\r\n            relY: correctedEvent.clientY - bounds.top + this.targetElement.scrollTop,\r\n            dX: correctedEvent.movementX,\r\n            dY: correctedEvent.movementY,\r\n            time: correctedEvent.timeStamp,\r\n            eventPreventDefault: correctedEvent.eventPreventDefault,\r\n            eventStopPropagation: correctedEvent.eventStopPropagation,\r\n            ...custom,\r\n        };\r\n\r\n        if (typeStr === 'pointermove') {\r\n            result.coalescedArr = [];\r\n            if (correctedEvent.coalescedArr.length > 1) {\r\n                let coalescedItem;\r\n                for (let i = 0; i < correctedEvent.coalescedArr.length; i++) {\r\n                    coalescedItem = correctedEvent.coalescedArr[i];\r\n                    result.coalescedArr.push({\r\n                        pageX: coalescedItem.pageX,\r\n                        pageY: coalescedItem.pageY,\r\n                        clientX: coalescedItem.clientX,\r\n                        clientY: coalescedItem.clientY,\r\n                        relX: coalescedItem.clientX - bounds.left + this.targetElement.scrollLeft,\r\n                        relY: coalescedItem.clientY - bounds.top + this.targetElement.scrollTop,\r\n                        dX: coalescedItem.movementX,\r\n                        dY: coalescedItem.movementY,\r\n                        time: coalescedItem.timeStamp,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private setupDocumentListeners () {\r\n        this.windowOnPointerMove && document.addEventListener(pointerMoveEvt, this.windowOnPointerMove);\r\n        this.windowOnPointerUp && document.addEventListener(pointerUpEvt, this.windowOnPointerUp);\r\n        this.windowOnPointerLeave && document.addEventListener(pointerCancelEvt, this.windowOnPointerLeave);\r\n        this.windowOnPointerLeave && document.addEventListener(pointerLeaveEvt, this.windowOnPointerLeave);\r\n    }\r\n\r\n    private destroyDocumentListeners () {\r\n        this.windowOnPointerMove && document.removeEventListener(pointerMoveEvt, this.windowOnPointerMove);\r\n        this.windowOnPointerUp && document.removeEventListener(pointerUpEvt, this.windowOnPointerUp);\r\n        this.windowOnPointerLeave && document.removeEventListener(pointerCancelEvt, this.windowOnPointerLeave);\r\n        this.windowOnPointerLeave && document.removeEventListener(pointerLeaveEvt, this.windowOnPointerLeave);\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (p: IPointerListenerParams) {\r\n        this.targetElement = p.target;\r\n        this.onPointerCallback = p.onPointer;\r\n        this.onWheelCallback = p.onWheel;\r\n        this.onEnterLeaveCallback = p.onEnterLeave;\r\n        this.maxPointers = Math.max(1, p.maxPointers || 1);\r\n\r\n\r\n        this.wheelCleaner = new WheelCleaner((cleanerEvent) => {\r\n            if (this.isDestroyed || !this.onWheelCallback) {\r\n                return;\r\n            }\r\n            const bounds = this.targetElement.getBoundingClientRect();\r\n            const whlEvent = {\r\n                ...cleanerEvent,\r\n                relX: cleanerEvent.clientX - bounds.left + this.targetElement.scrollLeft,\r\n                relY: cleanerEvent.clientY - bounds.top + this.targetElement.scrollTop,\r\n            };\r\n            this.onWheelCallback(whlEvent);\r\n        });\r\n\r\n        if (this.onPointerCallback) {\r\n            this.onPointerMove = (event: PointerEvent) => {\r\n                const correctedEvent = correctPointerEvent(event);\r\n\r\n                const tempLastPointerType = this.lastPointerType;\r\n                this.lastPointerType = correctedEvent.pointerType as TPointerType;\r\n\r\n                if (\r\n                    this.dragPointerIdArr.includes(correctedEvent.pointerId) ||\r\n                    this.dragPointerIdArr.length === this.maxPointers ||\r\n                    correctedEvent.pointerType === 'touch'\r\n                ) {\r\n                    this.didSkip = false;\r\n                    return;\r\n                }\r\n\r\n                // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\r\n                if (!this.didSkip && correctedEvent.pointerType === 'mouse' && tempLastPointerType === 'pen') {\r\n                    this.didSkip = true;\r\n                    return;\r\n                }\r\n                this.didSkip = false;\r\n\r\n                const outEvent = this.createPointerOutEvent('pointermove', correctedEvent);\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.onPointerDown = (event: PointerEvent, onSkipGlobal? : boolean) => {\r\n\r\n                //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' pointerdown');\r\n                if (this.dragPointerIdArr.includes(correctedEvent.pointerId) || this.dragPointerIdArr.length === this.maxPointers || ![1, 2, 4].includes(correctedEvent.buttons)) {\r\n                    //BB.throwOut('pointerdown ignored');\r\n                    return;\r\n                }\r\n\r\n                //set up global listeners\r\n                if (this.dragObjArr.length === 0 && !onSkipGlobal) {\r\n                    this.setupDocumentListeners();\r\n                }\r\n                const dragObj: IDragObj = {\r\n                    pointerId: correctedEvent.pointerId,\r\n                    pointerType: correctedEvent.pointerType as TPointerType,\r\n                    downPageX: correctedEvent.pageX,\r\n                    downPageY: correctedEvent.pageY,\r\n                    buttons: correctedEvent.buttons,\r\n                    lastPageX: correctedEvent.pageX,\r\n                    lastPageY: correctedEvent.pageY,\r\n                    lastTimeStamp: correctedEvent.timeStamp,\r\n                };\r\n                this.dragObjArr.push(dragObj);\r\n                this.dragPointerIdArr.push(correctedEvent.pointerId);\r\n\r\n                const outEvent: IPointerEvent = this.createPointerOutEvent('pointerdown', correctedEvent, {\r\n                    downPageX: correctedEvent.pageX,\r\n                    downPageY: correctedEvent.pageY,\r\n                    button: getButtonStr(correctedEvent.buttons),\r\n                    pressure: correctedEvent.pressure,\r\n                });\r\n\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.windowOnPointerMove = (event: PointerEvent) => {\r\n                //BB.throwOut('pointermove ' + event.pointerId);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\r\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) {\r\n                    return;\r\n                }\r\n\r\n                const dragObj = this.getDragObj(correctedEvent.pointerId);\r\n\r\n                if (!dragObj) {\r\n                    // todo need to handle this!\r\n                    return;\r\n                }\r\n\r\n                //if pointer changes button its pressing -> turn into pointerup\r\n                if (correctedEvent.buttons !== dragObj.buttons) {\r\n                    //pointer up\r\n\r\n                    //remove listener\r\n                    if (this.dragObjArr.length === 1) {\r\n                        this.destroyDocumentListeners();\r\n                    }\r\n                    this.removeDragObj(correctedEvent.pointerId);\r\n\r\n                    const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\r\n                        downPageX: dragObj.downPageX,\r\n                        downPageY: dragObj.downPageY,\r\n                    });\r\n                    this.onPointerCallback && this.onPointerCallback(outEvent);\r\n                    return;\r\n                }\r\n\r\n                // ipad likes to do this\r\n                if (\r\n                    correctedEvent.pointerType === 'pen' &&\r\n                    correctedEvent.pageX === dragObj.lastPageX &&\r\n                    correctedEvent.pageY === dragObj.lastPageY &&\r\n                    correctedEvent.timeStamp === dragObj.lastTimeStamp\r\n                ) {\r\n                    //ignore\r\n                    return;\r\n                }\r\n\r\n                const outEvent = this.createPointerOutEvent('pointermove', correctedEvent, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY,\r\n                    button: getButtonStr(correctedEvent.buttons),\r\n                    pressure: correctedEvent.pressure,\r\n                });\r\n\r\n                dragObj.lastPageX = correctedEvent.pageX;\r\n                dragObj.lastPageY = correctedEvent.pageY;\r\n                dragObj.lastTimeStamp = correctedEvent.timeStamp;\r\n\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.windowOnPointerUp = (event: PointerEvent) => {\r\n                //BB.throwOut('pointerup ' + event.pointerId);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\r\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) {\r\n                    return;\r\n                }\r\n\r\n                //remove listener\r\n                if (this.dragObjArr.length === 1) {\r\n                    this.destroyDocumentListeners();\r\n                }\r\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\r\n                if (!dragObj) {\r\n                    // todo need to handle this!\r\n                    return;\r\n                }\r\n\r\n                const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY,\r\n                });\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n\r\n            };\r\n\r\n            this.windowOnPointerLeave = (event: PointerEvent) => {\r\n                //BB.throwOut('pointerleave ' + event.pointerId);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\r\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) { //} || event.target !== document) {\r\n                    return;\r\n                }\r\n\r\n                //remove listener\r\n                if (this.dragObjArr.length === 1) {\r\n                    this.destroyDocumentListeners();\r\n                }\r\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\r\n                if (!dragObj) {\r\n                    // todo need to handle this!\r\n                    return;\r\n                }\r\n\r\n                const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY,\r\n                });\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.targetElement.addEventListener(pointerMoveEvt, this.onPointerMove);\r\n            this.targetElement.addEventListener(pointerDownEvt, this.onPointerDown);\r\n\r\n            if (!hasPointerEvents) {\r\n                const touchToFakePointer = (touch: Touch, touchEvent: TouchEvent, isDown: boolean) => {\r\n                    return {\r\n                        pointerId: touch.identifier,\r\n                        pointerType: 'touch',\r\n                        pageX: touch.pageX,\r\n                        pageY: touch.pageY,\r\n                        clientX: touch.clientX,\r\n                        clientY: touch.clientY,\r\n                        button: isDown ? 0 : undefined,\r\n                        buttons: isDown ? 1 : 0,\r\n                        timeStamp: touchEvent.timeStamp,\r\n                        target: touchEvent.target,\r\n                        pressure: isDown ? 1 : 0,\r\n                        preventDefault: () => touchEvent.preventDefault(),\r\n                        stopPropagation: () => touchEvent.stopPropagation(),\r\n                    };\r\n                };\r\n\r\n                const handleTouch = (e: TouchEvent, type: 'start' | 'move' | 'end' | 'cancel'): void => {\r\n                    for (let i = 0; i < e.changedTouches.length; i++) {\r\n                        const touch = e.changedTouches[i];\r\n                        const fakePointer = touchToFakePointer(touch, e, ['start', 'move'].includes(type));\r\n                        if (type === 'start') {\r\n                            this.onPointerDown(fakePointer, false);\r\n                        } else if (type === 'move') {\r\n                            this.windowOnPointerMove(fakePointer);\r\n                        } else if (type === 'end') {\r\n                            this.windowOnPointerUp(fakePointer);\r\n                        } else {\r\n                            this.windowOnPointerLeave(fakePointer);\r\n                        }\r\n                    }\r\n                };\r\n\r\n                this.onTouchStart = (e: TouchEvent): void => {\r\n                    e.preventDefault();\r\n                    handleTouch(e, 'start');\r\n                };\r\n                this.onTouchMove = (e: TouchEvent): void => {\r\n                    handleTouch(e, 'move');\r\n                };\r\n                this.onTouchEnd = (e: TouchEvent): void => {\r\n                    handleTouch(e, 'end');\r\n                };\r\n                this.onTouchCancel = (e: TouchEvent): void => {\r\n                    handleTouch(e, 'cancel');\r\n                };\r\n\r\n                this.targetElement.addEventListener('touchstart', this.onTouchStart);\r\n                this.targetElement.addEventListener('touchmove', this.onTouchMove);\r\n                this.targetElement.addEventListener('touchend', this.onTouchEnd);\r\n                this.targetElement.addEventListener('touchcancel', this.onTouchCancel);\r\n            }\r\n        }\r\n        if (this.onWheelCallback) {\r\n            this.onWheel = (e: WheelEvent) => {\r\n                this.wheelCleaner.process(e);\r\n            };\r\n            this.targetElement.addEventListener('wheel', this.onWheel);\r\n        }\r\n        if (this.onEnterLeaveCallback) {\r\n            this.onPointerEnter = () => {\r\n                this.isOverCounter++;\r\n                this.onEnterLeaveCallback && this.onEnterLeaveCallback(true);\r\n            };\r\n\r\n            this.onPointerLeave = () => {\r\n                this.isOverCounter--;\r\n                this.onEnterLeaveCallback && this.onEnterLeaveCallback(false);\r\n            };\r\n\r\n            this.targetElement.addEventListener(pointerEnterEvt, this.onPointerEnter);\r\n            this.targetElement.addEventListener(pointerLeaveEvt, this.onPointerLeave);\r\n        }\r\n\r\n        if (p.fixScribble) {\r\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\r\n            this.onTouchMoveScribbleFix = (e: TouchEvent) => e.preventDefault();\r\n            this.targetElement.addEventListener('touchmove', this.onTouchMoveScribbleFix);\r\n        }\r\n    }\r\n\r\n    destroy (): void {\r\n        if (this.isDestroyed) {\r\n            return;\r\n        }\r\n        this.isDestroyed = true;\r\n        this.onPointerEnter && this.targetElement.removeEventListener(pointerEnterEvt, this.onPointerEnter);\r\n        this.onPointerLeave && this.targetElement.removeEventListener(pointerLeaveEvt, this.onPointerLeave);\r\n        this.onPointerMove && this.targetElement.removeEventListener(pointerMoveEvt, this.onPointerMove);\r\n        this.onPointerDown && this.targetElement.removeEventListener(pointerDownEvt, this.onPointerDown);\r\n        this.onWheel && this.targetElement.removeEventListener('wheel', this.onWheel);\r\n        this.destroyDocumentListeners();\r\n        this.onTouchMoveScribbleFix && document.removeEventListener('touchmove', this.onTouchMoveScribbleFix);\r\n\r\n        this.onTouchStart && this.targetElement.removeEventListener('touchstart', this.onTouchStart);\r\n        this.onTouchMove && this.targetElement.removeEventListener('touchmove', this.onTouchMove);\r\n        this.onTouchEnd && this.targetElement.removeEventListener('touchend', this.onTouchEnd);\r\n        this.onTouchCancel && this.targetElement.removeEventListener('touchcancel', this.onTouchCancel);\r\n    }\r\n\r\n}\r\n\r\n","export interface IWheelCleanerEvent {\r\n    deltaY: number;\r\n    pageX: number;\r\n    pageY: number;\r\n    clientX: number;\r\n    clientY: number;\r\n}\r\n\r\nconst SEQUENCE_TIMEOUT_MS = 200;\r\n\r\n/**\r\n * Filters wheel events. removes swipe scrolling and pinch scrolling that trackpads do. (as best as it can)\r\n * Normalizes regular scrolls.\r\n *\r\n * Why:\r\n * - trackpad scrolling is different from old school mouse scrolling\r\n * - but there is no way to learn from the browser if it's trackpad scrolling\r\n * - browsers don't even give access to the raw swiping or pinching movement, but some abstraction on top, making the scrolling\r\n *      continue an arbitrary amount, at an arbitrary scale\r\n * - each browser does this differently. So you can't offer a consistent/controlled experience\r\n *\r\n * - also trackpads are painful to draw with. So supporting a trackpad-based workflow makes not much sense.\r\n */\r\nexport class WheelCleaner {\r\n\r\n    private readonly knownUnitArr: number[] = [100];\r\n    private sequenceLength: number = 0;\r\n    private sequenceUnit: null | number = null;\r\n    private endSequenceTimeout: undefined | ReturnType<typeof setTimeout>;\r\n    private toEmitDelta: null | number = null;\r\n    private position: null | {\r\n        pageX: number;\r\n        pageY: number;\r\n        clientX: number;\r\n        clientY: number;\r\n    } = null;\r\n\r\n\r\n    private emit (delta: number): void {\r\n        if (this.position === null || this.sequenceUnit === null) {\r\n            return;\r\n        }\r\n        this.callback({\r\n            deltaY: Math.round(delta / this.sequenceUnit),\r\n            pageX: this.position.pageX,\r\n            pageY: this.position.pageY,\r\n            clientX: this.position.clientX,\r\n            clientY: this.position.clientY,\r\n        });\r\n    }\r\n\r\n    private endSequence (): void {\r\n        if (this.toEmitDelta !== null) {\r\n            this.emit(this.toEmitDelta);\r\n            this.toEmitDelta = null;\r\n        }\r\n        if (this.sequenceUnit !== null && !(this.knownUnitArr.includes(this.sequenceUnit))) {\r\n            this.knownUnitArr.push(this.sequenceUnit);\r\n        }\r\n        this.sequenceLength = 0;\r\n        this.sequenceUnit = null;\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (private callback: (p: IWheelCleanerEvent) => void) {}\r\n\r\n    process (event: WheelEvent): void {\r\n        this.position = {\r\n            pageX: event.pageX,\r\n            pageY: event.pageY,\r\n            clientX: event.clientX,\r\n            clientY: event.clientY,\r\n        };\r\n\r\n        if (this.endSequenceTimeout) {\r\n            clearTimeout(this.endSequenceTimeout);\r\n        }\r\n        this.endSequenceTimeout = setTimeout(() => this.endSequence(), SEQUENCE_TIMEOUT_MS);\r\n\r\n        //prep delta\r\n        let delta = event.deltaY;\r\n        if ('deltaMode' in event && event.deltaMode === 1) {\r\n            delta *= 100 / 3;\r\n        }\r\n        const absDelta = Math.abs(delta);\r\n\r\n        //sequence begins\r\n        if (this.sequenceLength === 0) {\r\n            this.sequenceLength++;\r\n            if (absDelta < 50) {\r\n                //dirty - probably a swipe scroll or pinch scroll on trackpad\r\n                return;\r\n            }\r\n\r\n            this.sequenceUnit = absDelta;\r\n            if (this.knownUnitArr.includes(this.sequenceUnit)) {\r\n                //we know this unit - emit right away\r\n                this.emit(delta);\r\n            } else {\r\n                //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\r\n                this.toEmitDelta = delta;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (this.sequenceUnit === null) {\r\n            //previously determined dirty sequence\r\n            this.toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n        //sequence continues\r\n        if (absDelta === 0) {\r\n            //ignore zero scroll\r\n            return;\r\n        }\r\n        if (\r\n            absDelta === this.sequenceUnit ||\r\n            (absDelta / this.sequenceUnit) % 1 < 0.0001// a multiple\r\n        ) {\r\n            //fine\r\n        } else if ((this.sequenceUnit / absDelta) % 1 < 0.0001) {\r\n            //unit was actually a multiple - update it\r\n            this.sequenceUnit = absDelta;\r\n\r\n        } else if (absDelta !== this.sequenceUnit) {\r\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\r\n            this.sequenceUnit = null;\r\n            this.toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n\r\n        if (this.toEmitDelta !== null) {\r\n            this.emit(this.toEmitDelta);\r\n            this.toEmitDelta = null;\r\n        }\r\n        this.emit(delta);\r\n    }\r\n\r\n}\r\n","import {mix} from '../math/math';\r\n\r\n/**\r\n * different devices/browsers have different pressure curves\r\n * pressure normalize attempts to achieve similar mapping\r\n *\r\n * pressure range [0, 1]\r\n */\r\nexport class PressureNormalizer {\r\n    \r\n    private count: number = 0;\r\n    private avgPressure: number = 0; // float [0, 1]\r\n    private normalizeIsComplete: boolean = false;\r\n    private normalizeFactor: number = 1;\r\n    \r\n    // ---- public ----\r\n    normalize (pressure: number): number {\r\n        if (pressure === 0 || pressure === 1) {\r\n            return pressure;\r\n        }\r\n\r\n        if (this.count < 60) {\r\n            if (this.count === 0 || this.count === null) {\r\n                this.avgPressure = pressure;\r\n            } else {\r\n                this.avgPressure = mix(pressure, this.avgPressure, 0.95);\r\n            }\r\n            this.count++;\r\n        } else if (!this.normalizeIsComplete) {\r\n            this.normalizeIsComplete = true;\r\n            //BB.throwOut('avg pressure decision!' + this.avgPressure);\r\n            if (this.avgPressure < 0.13) { // absurd pressure needed\r\n                this.normalizeFactor = 2.3;\r\n            }\r\n        }\r\n\r\n        return Math.pow(pressure, 1 / this.normalizeFactor);\r\n    }\r\n    \r\n}","import {IBounds, IRect, IVector2D} from '../bb-types';\r\n\r\nexport function mix (a: number, b: number, f: number): number {\r\n    return a * (1 - f) + b * f;\r\n}\r\n\r\nexport function dist (ax: number, ay: number, bx: number, by: number): number {\r\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\r\n}\r\n\r\nexport function distSquared (ax: number, ay: number, bx: number, by: number): number {\r\n    // faster because no square-root\r\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\r\n}\r\n\r\nexport function lenSquared (x: number, y: number): number {\r\n    // faster because no square-root\r\n    return x * x + y * y;\r\n}\r\n\r\nexport function pointsToAngleRad (p1: IVector2D, p2: IVector2D): number {\r\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n}\r\n\r\nexport function pointsToAngleDeg (p1: IVector2D, p2: IVector2D): number {\r\n    return pointsToAngleRad(p1, p2) * 180 / Math.PI;\r\n}\r\n\r\nexport function isInsideRect (p: IVector2D, rect: IRect): boolean {\r\n    return rect.x <= p.x && p.x <= rect.x + rect.width &&\r\n        rect.y <= p.y && p.y <= rect.y + rect.height;\r\n}\r\n\r\nexport function clamp (num: number, min: number, max: number): number {\r\n    return num < min\r\n        ? min\r\n        : num > max\r\n            ? max\r\n            : num;\r\n}\r\n\r\nexport function rotate (x: number, y: number, deg: number): IVector2D {\r\n    const theta = deg * (Math.PI / 180);\r\n    const cs = Math.cos(theta);\r\n    const sn = Math.sin(theta);\r\n\r\n    return {\r\n        x: x * cs - y * sn,\r\n        y: x * sn + y * cs,\r\n    };\r\n}\r\n\r\nexport function rotateAround (center: IVector2D, point: IVector2D, deg: number): IVector2D {\r\n    const rot = rotate(point.x - center.x, point.y - center.y, deg);\r\n    rot.x += center.x;\r\n    rot.y += center.y;\r\n    return rot;\r\n}\r\n\r\nexport function intDxy (remainder: IVector2D, fDx: number, fDy: number) {\r\n    remainder.x += fDx;\r\n    remainder.y += fDy;\r\n    const dX = Math.round(remainder.x);\r\n    const dY = Math.round(remainder.y);\r\n    remainder.x -= dX;\r\n    remainder.y -= dY;\r\n    return {\r\n        dX,\r\n        dY,\r\n    };\r\n}\r\n\r\n/**\r\n * return closest even number\r\n * @param f\r\n */\r\nexport function roundEven (f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f;\r\n        }\r\n        return f + 1;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 0) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * return closest uneven number\r\n * @param f\r\n */\r\nexport function roundUneven (f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f + 1;\r\n        }\r\n        return f;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 1) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * round number to certain precision.\r\n * round(1.2345, 2) = 1.23\r\n * round(1.2345, 0) = 0\r\n * round(123, -1) = 120\r\n *\r\n * @param f\r\n * @param digits\r\n */\r\nexport function round (f: number, digits: number): number {\r\n    const digitMult = Math.pow(10, digits);\r\n    return Math.round((f/* + Number.EPSILON*/) * digitMult) / digitMult;\r\n}\r\n\r\n/**\r\n * update target so it includes bounds\r\n * @param target\r\n * @param bounds\r\n */\r\nexport function updateBounds (target: IBounds, bounds: IBounds): IBounds {\r\n    if (!bounds) {\r\n        return target;\r\n    }\r\n    if (!target) {\r\n        target = { x1: bounds.x1, y1: bounds.y1, x2: bounds.x2, y2: bounds.y2 };\r\n    } else {\r\n        target.x1 = Math.min(target.x1, bounds.x1);\r\n        target.y1 = Math.min(target.y1, bounds.y1);\r\n        target.x2 = Math.max(target.x2, bounds.x2);\r\n        target.y2 = Math.max(target.y2, bounds.y2);\r\n    }\r\n    return target;\r\n}\r\n\r\n/**\r\n * determine overlap of bounds with width&height\r\n */\r\nexport function boundsInArea (bounds: IBounds, width: number, height: number): IBounds | null {\r\n    const x1 = Math.max(0, bounds.x1);\r\n    const y1 = Math.max(0, bounds.y1);\r\n    const x2 = Math.min(width - 1, bounds.x2);\r\n    const y2 = Math.min(height - 1, bounds.y2);\r\n    if (x1 > x2 || y1 > y2) {\r\n        return null;\r\n    }\r\n    return { x1, y1, x2, y2 };\r\n}","import {IBounds, IKeyString, IRect, TNullable} from '../bb-types';\r\nimport {createCanvas} from './create-canvas';\r\nimport {copyObj} from './base';\r\n\r\nexport function copyCanvas (canvas: HTMLCanvasElement): HTMLCanvasElement {\r\n    const resultCanvas = createCanvas(canvas.width, canvas.height);\r\n    const ctx = resultCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.drawImage(canvas, 0, 0);\r\n    return resultCanvas;\r\n}\r\n\r\nexport function ctx (canvas: HTMLCanvasElement): CanvasRenderingContext2D {\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error(\"couldn't get 2d context\");\r\n    }\r\n    return ctx;\r\n}\r\n\r\n/**\r\n * Determine if should disable imageSmoothing for transformation.\r\n * ImageSmoothing can make images blurry even when they're in the original scale and aligned with the pixelgrid.\r\n */\r\nexport function testShouldPixelate (\r\n    transform: {x: number; y: number; width:number; height: number; angleDeg: number},\r\n    scaleX: number,\r\n    scaleY: number,\r\n): boolean {\r\n    if (\r\n        ![1, -1].includes(scaleX) || ![1, -1].includes(scaleY) ||\r\n        transform.width % 1 !== 0 || transform.height % 1 !== 0 ||\r\n        Math.abs(transform.angleDeg) % 90 !== 0\r\n    ) {\r\n        return false;\r\n    }\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    const width = whSwapped ? transform.height : transform.width;\r\n    const height = whSwapped ? transform.width : transform.height;\r\n    return (\r\n            (Math.abs(width) % 2 === 0 && transform.x % 1 === 0) ||\r\n            (Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5)\r\n        ) &&\r\n        (\r\n            (Math.abs(height) % 2 === 0 && transform.y % 1 === 0) ||\r\n            (Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5)\r\n        );\r\n}\r\n\r\n\r\n/**\r\n * @param destCtx - the canvas that will be drawn on\r\n * @param transformImage - image that will be drawn on canvas\r\n * @param transform - {x, y, width, height, angle} - x and y are center of transformImage\r\n * @param bounds object - optional {x, y, width, height} - crop of transformImage in transformImage image space\r\n * @param pixelated\r\n */\r\nexport function drawTransformedImageWithBounds (\r\n    destCtx: CanvasRenderingContext2D,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transform: {x: number; y: number; width:number; height: number; angleDeg: number},\r\n    bounds?: {x: number; y: number; width: number; height: number},\r\n    pixelated?: boolean,\r\n): void {\r\n    if (!bounds) {\r\n        bounds = {\r\n            x: 0,\r\n            y: 0,\r\n            width: transformImage.width,\r\n            height: transformImage.height,\r\n        };\r\n    }\r\n\r\n    destCtx.save();\r\n    if (pixelated) {\r\n        destCtx.imageSmoothingEnabled = false;\r\n    } else {\r\n        destCtx.imageSmoothingEnabled = true;\r\n        destCtx.imageSmoothingQuality = 'high';\r\n    }\r\n\r\n    destCtx.translate(transform.x, transform.y);\r\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\r\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\r\n    destCtx.drawImage(\r\n        transformImage,\r\n        bounds.x, bounds.y, bounds.width, bounds.height,\r\n        -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\r\n\r\n    destCtx.restore();\r\n}\r\n\r\n/**\r\n * all transformations are optional\r\n * center is the point around which will be scaled and rotated\r\n *\r\n * @param baseCanvas canvas - the canvas that will be drawn on\r\n * @param transformImage image|canvas - image that will be drawn on canvas\r\n * @param transformObj {center: {x, y}, scale: {x, y}, translate: {x, y}, angleDegree}\r\n */\r\nexport function drawTransformedImageOnCanvas (\r\n    baseCanvas: HTMLCanvasElement,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transformObj: {\r\n        center: {x: number; y: number};\r\n        scale: {x: number; y: number};\r\n        translate: {x: number; y: number};\r\n        angleDegree: number;\r\n    },\r\n): void {\r\n    transformObj = copyObj(transformObj);\r\n    if (!transformObj.center) {\r\n        transformObj.center = {\r\n            x: transformImage.width / 2,\r\n            y: transformImage.height / 2,\r\n        };\r\n    }\r\n    if (!transformObj.scale) {\r\n        transformObj.scale = {\r\n            x: 1,\r\n            y: 1,\r\n        };\r\n    }\r\n    if (!transformObj.angleDegree) {\r\n        transformObj.angleDegree = 0;\r\n    }\r\n    if (!transformObj.translate) {\r\n        transformObj.translate = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n    }\r\n\r\n    const ctx = baseCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.save();\r\n    if (\r\n        Math.abs(transformObj.scale.x - 1) >  0.000001 ||\r\n        Math.abs(transformObj.scale.y - 1) > 0.000001 ||\r\n        Math.abs(transformObj.angleDegree % 90) > 0.000001\r\n    ) {\r\n        ctx.imageSmoothingEnabled = true;\r\n        ctx.imageSmoothingQuality = 'high';\r\n    } else {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n\r\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\r\n    ctx.translate(transformObj.center.x, transformObj.center.y);\r\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\r\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\r\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\r\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\r\n\r\n    ctx.restore();\r\n}\r\n\r\nexport const createCheckerCanvas = function (size: number, isDark?: boolean): HTMLCanvasElement {\r\n    const canvas = createCanvas();\r\n    let ctx;\r\n    if (size < 1) {\r\n        canvas.width = 1;\r\n        canvas.height = 1;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = 'rgb(128, 128, 128)';\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    } else if (size > 200) {\r\n        canvas.width = 401;\r\n        canvas.height = 401;\r\n    } else {\r\n        canvas.width = size * 2;\r\n        canvas.height = size * 2;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = isDark ? 'rgb(90, 90, 90)' : 'rgb(255, 255, 255)';\r\n        ctx.fillRect(0, 0, size * 2, size * 2);\r\n        ctx.fillStyle = isDark ? 'rgb(63, 63, 63)': 'rgb(200, 200, 200)';\r\n        ctx.fillRect(0, 0, size, size);\r\n        ctx.fillRect(size, size, size * 2, size * 2);\r\n    }\r\n    return canvas;\r\n};\r\n\r\nexport const createCheckerDataUrl = (function () {\r\n    const cache: IKeyString = { // previously created dataUrls\r\n        '8l': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC',\r\n        '4l': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC',\r\n    };\r\n\r\n    return function (size: number, callback?: (s: string) => void, isDark?: boolean) {\r\n        const modeStr = isDark ? 'd' : 'l';\r\n\r\n        function create (size: number): string {\r\n            size = parseInt('' + size);\r\n            if (cache['' + size + modeStr]) {\r\n                return cache['' + size + modeStr];\r\n            }\r\n            const canvas = createCheckerCanvas(size, isDark);\r\n            const result = canvas.toDataURL('image/png');\r\n            cache['' + size + modeStr] = result;\r\n            return result;\r\n        }\r\n\r\n        if (callback) { //async\r\n            setTimeout(function () {\r\n                callback(create(size));\r\n            }, 1);\r\n        } else { //sync\r\n            return create(size);\r\n        }\r\n    };\r\n})();\r\n\r\n/**\r\n * smooth resize image\r\n * @param canvas canvas - will be resized (modified)\r\n * @param w\r\n * @param h\r\n * @param tmp1 canvas - optional, provide to save resources\r\n * @param tmp2 canvas - optional, provide to save resources\r\n */\r\nexport function resizeCanvas (\r\n    canvas: HTMLCanvasElement,\r\n    w: number,\r\n    h: number,\r\n    tmp1?: HTMLCanvasElement,\r\n    tmp2?: HTMLCanvasElement,\r\n): void {\r\n\r\n    //determine base 2 exponents of old and new size\r\n    function getBase2Obj (oldW: number, oldH: number, newW: number, newH: number) {\r\n        const result = {\r\n            oldWidthEx: Math.round(Math.log2(oldW)),\r\n            oldHeightEx: Math.round(Math.log2(oldH)),\r\n            newWidthEx: Math.ceil(Math.log2(newW)),\r\n            newHeightEx: Math.ceil(Math.log2(newH)),\r\n        };\r\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\r\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\r\n        return result;\r\n    }\r\n\r\n    if (!w || !h || (w === canvas.width && h === canvas.height)) {\r\n        return;\r\n    }\r\n    w = Math.max(w, 1);\r\n    h = Math.max(h, 1);\r\n    if (w <= canvas.width && h <= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp2 = !tmp2 ? createCanvas() : tmp2;\r\n\r\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\r\n\r\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\r\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\r\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\r\n        tmp1.getContext('2d')!.save();\r\n        tmp2.getContext('2d')!.save();\r\n\r\n        let ew, eh;\r\n        let buffer1 = tmp1, buffer2 = tmp2;\r\n\r\n        ew = base2.oldWidthEx;\r\n        eh = base2.oldHeightEx;\r\n\r\n        let bufferCtx = buffer2.getContext('2d')!;\r\n        bufferCtx.imageSmoothingEnabled = true;\r\n        bufferCtx.imageSmoothingQuality  = 'high';\r\n        bufferCtx.globalCompositeOperation  = 'copy';\r\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\r\n\r\n        let currentWidth = buffer2.width;\r\n        let currentHeight = buffer2.height;\r\n\r\n        //stepwise half the size\r\n        for (; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--) {\r\n            bufferCtx = buffer1.getContext('2d')!;\r\n            bufferCtx.imageSmoothingEnabled = true;\r\n            bufferCtx.imageSmoothingQuality  = 'high';\r\n            bufferCtx.globalCompositeOperation  = 'copy';\r\n\r\n            const newWidth = (ew > base2.newWidthEx) ? currentWidth / 2 : currentWidth;\r\n            const newHeight = (eh > base2.newHeightEx) ? currentHeight / 2 : currentHeight;\r\n\r\n            //buffer also needs to be properly sized, unfortunately\r\n            buffer1.width = newWidth;\r\n            buffer1.height = newHeight;\r\n\r\n            bufferCtx.drawImage(\r\n                buffer2,\r\n                0, 0,\r\n                currentWidth, currentHeight,\r\n                0, 0,\r\n                newWidth, newHeight\r\n            );\r\n            currentWidth = newWidth;\r\n            currentHeight = newHeight;\r\n\r\n            //swap\r\n            const tmp = buffer1;\r\n            buffer1 = buffer2;\r\n            buffer2 = tmp;\r\n        }\r\n\r\n        //when no longer can be halved, bring to target size\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        const canvasCtx = canvas.getContext('2d')!;\r\n        canvasCtx.save();\r\n        canvasCtx.imageSmoothingEnabled = true;\r\n        canvasCtx.imageSmoothingQuality  = 'high';\r\n        canvasCtx.drawImage(\r\n            buffer2,\r\n            0, 0,\r\n            currentWidth, currentHeight,\r\n            0, 0,\r\n            w, h\r\n        );\r\n        canvasCtx.restore();\r\n        tmp1.getContext('2d')!.restore();\r\n        tmp2.getContext('2d')!.restore();\r\n\r\n    } else if (w >= canvas.width && h >= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp1.width = w;\r\n        tmp1.height = h;\r\n        const tmp1Ctx = tmp1.getContext('2d')!;\r\n        tmp1Ctx.save();\r\n        tmp1Ctx.imageSmoothingEnabled = true;\r\n        tmp1Ctx.imageSmoothingQuality  = 'high';\r\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\r\n        tmp1Ctx.restore();\r\n\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        canvas.getContext('2d')!.drawImage(tmp1, 0, 0);\r\n\r\n    } else {\r\n        resizeCanvas(canvas, w, canvas.height, tmp1, tmp2);\r\n        resizeCanvas(canvas, w, h, tmp1, tmp2);\r\n    }\r\n}\r\n\r\n/**\r\n * puts naive greyscale version of image into alpha channel.\r\n * only writes a, doesn't write rgb\r\n * @param canvas\r\n */\r\nexport function convertToAlphaChannelCanvas (canvas: HTMLCanvasElement): void {\r\n    const imdat = canvas.getContext('2d')!.getImageData(0, 0, canvas.width, canvas.height);\r\n    for (let i = 0; i < imdat.data.length; i += 4) {\r\n        if (imdat.data[i + 3] === 0) {\r\n            continue;\r\n        }\r\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\r\n    }\r\n    canvas.getContext('2d')!.putImageData(imdat, 0, 0);\r\n}\r\n\r\n/**\r\n * Sometimes garbage collection is too slow, and canvases use up too much memory,\r\n * or there is a hard to fix memory leak.\r\n * This function manually makes the canvas use as little memory as possible.\r\n */\r\nexport function freeCanvas (canvas: HTMLCanvasElement): void {\r\n    canvas.width = 1;\r\n    canvas.height = 1;\r\n    const ctx = canvas.getContext('2d');\r\n    ctx && ctx.clearRect(0, 0, 1, 1);\r\n}\r\n\r\n/**\r\n * Determine bounding box that describes all pixels which are not fully transparent.\r\n * Returns null if empty.\r\n *\r\n * @param context\r\n */\r\nexport function canvasBounds (context: CanvasRenderingContext2D): IRect | null {\r\n    const boundsObj: {\r\n        x: number;\r\n        y: number;\r\n        width: number;\r\n        height: number;\r\n    } = { x: 0, y: 0, width: 0, height: 0 };\r\n    {\r\n        const tempBounds: TNullable<IBounds> = {\r\n            x1: null,\r\n            y1: null,\r\n            x2: null,\r\n            y2: null,\r\n        };\r\n        const imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\r\n\r\n        if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\r\n            tempBounds.x1 = 0;\r\n            tempBounds.y1 = 0;\r\n            tempBounds.x2 = context.canvas.width - 1;\r\n            tempBounds.y2 = context.canvas.height - 1;\r\n        } else {\r\n            for (let i = 3; i < imdat.data.length; i += 4) {\r\n                if (imdat.data[i] > 0 ) {\r\n                    const x = ((i - 3) / 4) %  context.canvas.width;\r\n                    const y = Math.floor((i - 3) / 4 / context.canvas.width);\r\n                    if (tempBounds.x1 === null || tempBounds.x1 > x) {\r\n                        tempBounds.x1 = x;\r\n                    }\r\n                    if (tempBounds.y1 === null) {\r\n                        tempBounds.y1 = y;\r\n                    }\r\n                    if (tempBounds.x2 === null || tempBounds.x2 < x) {\r\n                        tempBounds.x2 = x;\r\n                    }\r\n                    if (tempBounds.y2 === null || tempBounds.y2 < y) {\r\n                        tempBounds.y2 = y;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (tempBounds.x1 === null || tempBounds.y1 === null || tempBounds.x2 === null || tempBounds.y2 === null) {\r\n            return null;\r\n        }\r\n        boundsObj.x = tempBounds.x1;\r\n        boundsObj.y = tempBounds.y1;\r\n        boundsObj.width = tempBounds.x2! - tempBounds.x1 + 1;\r\n        boundsObj.height = tempBounds.y2! - tempBounds.y1 + 1;\r\n    }\r\n    return boundsObj;\r\n}","\r\n// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\r\n// not optimized\r\n\r\ntype TMatrix4x4 = [\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n];\r\n\r\ntype TVec4 = [number, number, number, number];\r\n\r\nfunction getIdentity (): TMatrix4x4 {\r\n    return [\r\n        1, 0, 0, 0,\r\n        0, 1, 0, 0,\r\n        0, 0, 1, 0,\r\n        0, 0, 0, 1,\r\n    ];\r\n}\r\n\r\n// point  matrix\r\nfunction multiplyMatrixAndPoint (matrix: TMatrix4x4, point: TVec4): TVec4 {\r\n    return [\r\n        (point[0] * matrix[0]) + (point[1] * matrix[4]) + (point[2] * matrix[8]) + (point[3] * matrix[12]), // x\r\n        (point[0] * matrix[1]) + (point[1] * matrix[5]) + (point[2] * matrix[9]) + (point[3] * matrix[13]), // y\r\n        (point[0] * matrix[2]) + (point[1] * matrix[6]) + (point[2] * matrix[10]) + (point[3] * matrix[14]), // z\r\n        (point[0] * matrix[3]) + (point[1] * matrix[7]) + (point[2] * matrix[11]) + (point[3] * matrix[15]), // w\r\n    ];\r\n}\r\n\r\n//matrixB  matrixA\r\nfunction multiplyMatrices (matrixA: TMatrix4x4, matrixB: TMatrix4x4): TMatrix4x4 {\r\n\r\n    // Slice the second matrix up into rows\r\n    const row0: TVec4 = [matrixB[0], matrixB[1], matrixB[2], matrixB[3]];\r\n    const row1: TVec4 = [matrixB[4], matrixB[5], matrixB[6], matrixB[7]];\r\n    const row2: TVec4 = [matrixB[8], matrixB[9], matrixB[10], matrixB[11]];\r\n    const row3: TVec4 = [matrixB[12], matrixB[13], matrixB[14], matrixB[15]];\r\n\r\n    // Multiply each row by matrixA\r\n    const result0 = multiplyMatrixAndPoint(matrixA, row0);\r\n    const result1 = multiplyMatrixAndPoint(matrixA, row1);\r\n    const result2 = multiplyMatrixAndPoint(matrixA, row2);\r\n    const result3 = multiplyMatrixAndPoint(matrixA, row3);\r\n\r\n    // Turn the result rows back into a single matrix\r\n    return [\r\n        result0[0], result0[1], result0[2], result0[3],\r\n        result1[0], result1[1], result1[2], result1[3],\r\n        result2[0], result2[1], result2[2], result2[3],\r\n        result3[0], result3[1], result3[2], result3[3],\r\n    ];\r\n}\r\n\r\nfunction createTranslationMatrix (x: number, y: number): TMatrix4x4 {\r\n    return [\r\n        1, 0, 0, 0,\r\n        0, 1, 0, 0,\r\n        0, 0, 1, 0,\r\n        x, y, 0, 1,\r\n    ];\r\n}\r\n\r\nfunction createRotationMatrix (angleRad: number): TMatrix4x4 {\r\n    //let angleRad = angleDeg / 360 * 2 * Math.PI;\r\n    return [\r\n        Math.cos(-angleRad), -Math.sin(-angleRad), 0, 0,\r\n        Math.sin(-angleRad), Math.cos(-angleRad), 0, 0,\r\n        0, 0, 1, 0,\r\n        0, 0, 0, 1,\r\n    ];\r\n}\r\n\r\nfunction createScaleMatrix (f: number): TMatrix4x4 {\r\n    return [\r\n        f, 0, 0, 0,\r\n        0, f, 0, 0,\r\n        0, 0, 1, 0,\r\n        0, 0, 0, 1,\r\n    ];\r\n}\r\n\r\nexport const Matrix = Object.freeze({\r\n    getIdentity,\r\n    multiplyMatrixAndPoint,\r\n    multiplyMatrices,\r\n    createTranslationMatrix,\r\n    createRotationMatrix,\r\n    createScaleMatrix,\r\n});\r\n","import {IVector2D} from '../bb-types';\r\n\r\nexport const Vec2 = {\r\n    add: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x + p2.x, y: p1.y + p2.y};\r\n    },\r\n    sub: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x - p2.x, y: p1.y - p2.y};\r\n    },\r\n    nor: function (p: IVector2D): IVector2D {\r\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n        return {x: p.x / len, y: p.y / len};\r\n    },\r\n    len: function (p: IVector2D): number {\r\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n    },\r\n    dist: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Vec2.len(Vec2.sub(p1, p2));\r\n    },\r\n    mul: function (p: IVector2D, s: number): IVector2D {\r\n        return {x: p.x * s, y: p.y * s};\r\n    },\r\n    angle: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n    },\r\n    dot: function (a: IVector2D, b: IVector2D): number {\r\n        const aArr = [a.x, a.y];\r\n        const bArr = [b.x, b.y];\r\n        return aArr.map((x, i) => aArr[i] * bArr[i]).reduce((m, n) => m + n);\r\n    },\r\n};","import {Vec2} from './vec2';\r\nimport {clamp, dist, mix, pointsToAngleDeg} from './math';\r\nimport {IVector2D} from '../bb-types';\r\nimport {copyObj} from '../base/base';\r\n\r\n/**\r\n * project p onto line\r\n * @param lineStart\r\n * @param lineEnd\r\n * @param p\r\n */\r\nexport const projectPointOnLine = function (lineStart: IVector2D, lineEnd: IVector2D, p: IVector2D): IVector2D {\r\n    let x, y;\r\n    if (lineStart.x === lineEnd.x) {\r\n        x = lineStart.x;\r\n        y = p.y;\r\n\r\n        return {\r\n            x: x,\r\n            y: y,\r\n        };\r\n    }\r\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\r\n    const b = lineStart.y - (m * lineStart.x);\r\n\r\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\r\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\r\n\r\n    return {\r\n        x: x,\r\n        y: y,\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * Operations on a line made up of points\r\n */\r\nexport class PointLine {\r\n\r\n    private readonly segmentArr: {\r\n        x: number;\r\n        y: number;\r\n        length: number; // last is 0\r\n    }[];\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            points: IVector2D[];\r\n        }\r\n    ) {\r\n        this.segmentArr = [];\r\n\r\n        for (let i = 0; i < p.points.length; i++) {\r\n            ((i) => {\r\n                let length = 0;\r\n                if (i < p.points.length - 1) {\r\n                    length = dist(p.points[i].x, p.points[i].y, p.points[i + 1].x, p.points[i + 1].y);\r\n                }\r\n                this.segmentArr[i] = {\r\n                    x: p.points[i].x,\r\n                    y: p.points[i].y,\r\n                    length: length,\r\n                };\r\n            })(i);\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    /**\r\n     * returns point when traveling *dist* along the line, > 0\r\n     * @param dist\r\n     */\r\n    getAtDist (dist: number): IVector2D {\r\n        let remainder = Math.min(this.getLength(), dist);\r\n        let i = 0;\r\n\r\n        for (; remainder > this.segmentArr[i].length && i < this.segmentArr.length - 2; i++) {\r\n            remainder -= this.segmentArr[i].length;\r\n        }\r\n\r\n        const fac = Math.min(1, Math.max(0, remainder / this.segmentArr[i].length));\r\n\r\n        return {\r\n            x: (this.segmentArr[i].x * (1 - fac) + this.segmentArr[i + 1].x * fac),\r\n            y: (this.segmentArr[i].y * (1 - fac) + this.segmentArr[i + 1].y * fac),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * total length of line\r\n     */\r\n    getLength (): number {\r\n        let result = 0;\r\n        for (let i = 0; i < this.segmentArr.length - 1; i++) {\r\n            result += this.segmentArr[i].length;\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\ntype TBezierLineCallback = (\r\n    v: {\r\n        x: number;\r\n        y: number;\r\n        t: number; // [0, 1] - how far along\r\n        angle?: number;\r\n        dAngle: number;\r\n    }\r\n) => void;\r\ntype TBezierLineControlsCallback = (\r\n    v: {\r\n        p1: IVector2D;\r\n        p2: IVector2D;\r\n        p3: IVector2D;\r\n        p4: IVector2D;\r\n    }\r\n) => void;\r\n\r\n/**\r\n * Each instance is one line made up of bezier interpolated segments.\r\n * You feed it points. It calculates control points on its own, and the resulting curve.\r\n */\r\nexport class BezierLine {\r\n\r\n    private readonly pointArr: {\r\n        x: number;\r\n        y: number;\r\n        spacing: number;\r\n        dir: IVector2D;\r\n    }[];\r\n    private lastDot: number = 0;\r\n    private lastPoint: IVector2D | undefined;\r\n    private lastCallbackPoint: IVector2D | undefined;\r\n    private lastAngle: number | undefined;\r\n    private lastSpacing: number | null = null;\r\n\r\n    /**\r\n     * creates bezier curve from control points\r\n     * @param p1 - control point 1 {x: float, y: float}\r\n     * @param p2 - control point 2 {x: float, y: float}\r\n     * @param p3 - control point 3 {x: float, y: float}\r\n     * @param p4 - control point 4 {x: float, y: float}\r\n     * @param resolution - int\r\n     * @returns bezier curve made up of points {x: float, y: float}\r\n     */\r\n    private getBezierPoints (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D, resolution: number): IVector2D[] {\r\n        const curvePoints = [];\r\n        let t;\r\n        for (let i = 0; i <= resolution; i++) {\r\n            t = i / resolution;\r\n            curvePoints[curvePoints.length] = {\r\n                x: Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x,\r\n                y: Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y,\r\n            };\r\n        }\r\n        return curvePoints;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor () {\r\n        this.pointArr = [];\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    /**\r\n     * Add new point to line. \"Drawn\" line will go until the previous point.\r\n     *\r\n     * @param x - coord of new point\r\n     * @param y\r\n     * @param spacing - space between each step\r\n     * @param callback - calls for each step\r\n     * @param controlsCallback - calls that callback with the bezier control points\r\n     */\r\n    add (\r\n        x: number,\r\n        y: number,\r\n        spacing: number,\r\n        callback?: TBezierLineCallback,\r\n        controlsCallback?: TBezierLineControlsCallback,\r\n    ): void {\r\n        if (this.lastPoint && x === this.lastPoint.x && y === this.lastPoint.y) {\r\n            return;\r\n        }\r\n        this.lastPoint = {x, y};\r\n        this.pointArr[this.pointArr.length] = {\r\n            x,\r\n            y,\r\n            spacing,\r\n        };\r\n\r\n        //calculate directions\r\n        if (this.pointArr.length === 1) {\r\n            this.lastSpacing = spacing;\r\n            return;\r\n        } else if (this.pointArr.length === 2) {\r\n            this.pointArr[0].dir = Vec2.nor(Vec2.sub(this.pointArr[1], this.pointArr[0]));\r\n            this.lastDot = spacing;\r\n            this.lastSpacing = spacing;\r\n            return;\r\n        } else {\r\n            const pointM1 = this.pointArr[this.pointArr.length - 1];\r\n            const pointM2 = this.pointArr[this.pointArr.length - 2];\r\n            const pointM3 = this.pointArr[this.pointArr.length - 3];\r\n            pointM2.dir = Vec2.nor(Vec2.sub(pointM1, pointM3));\r\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) {\r\n                //when xy -3 == -1\r\n                pointM2.dir = copyObj(pointM3.dir);\r\n            }\r\n        }\r\n\r\n        //get bezier curve\r\n        const a = this.pointArr[this.pointArr.length - 3];\r\n        const b = this.pointArr[this.pointArr.length - 2];\r\n        const p1 = a;\r\n        const p2 = Vec2.add(a, Vec2.mul(a.dir, Vec2.dist(a, b) / 4));\r\n        const p3 = Vec2.sub(b, Vec2.mul(b.dir, Vec2.dist(a, b) / 4));\r\n        const p4 = b;\r\n\r\n\r\n        let pointLine: PointLine;\r\n        if (callback) {\r\n            const curvePoints = this.getBezierPoints(p1, p2, p3, p4, 20);\r\n            pointLine = new PointLine({points: curvePoints});\r\n        } else {\r\n            pointLine = new PointLine({points: [p1, p4]});\r\n        }\r\n\r\n        //iterate over curve with spacing and callback\r\n        const len = pointLine.getLength();\r\n        let tempSpacing = mix(this.lastSpacing!, spacing, clamp(this.lastDot / len, 0, 1));\r\n        let d = this.lastDot;\r\n        for (; d <= len; d += tempSpacing) {\r\n            tempSpacing = mix(this.lastSpacing!, spacing, clamp(d / len, 0, 1));\r\n            const point = pointLine.getAtDist(d);\r\n            const angle = this.lastCallbackPoint ? pointsToAngleDeg(this.lastCallbackPoint, point) : undefined;\r\n            if (callback) {\r\n                callback({\r\n                    x: point.x,\r\n                    y: point.y,\r\n                    t: d / len,\r\n                    angle: angle,\r\n                    dAngle: this.lastCallbackPoint ? angle! - this.lastAngle! : 0,\r\n                });\r\n            }\r\n            this.lastCallbackPoint = point;\r\n            this.lastAngle = angle;\r\n        }\r\n\r\n        if (callback) {\r\n            this.lastDot = d - len;\r\n        } else {\r\n            this.lastDot = 0;\r\n            controlsCallback && controlsCallback({p1: p1, p2: p2, p3: p3, p4: p4});\r\n        }\r\n\r\n        this.lastSpacing = spacing;\r\n    }\r\n\r\n    addFinal (\r\n        spacing: number,\r\n        callback?: TBezierLineCallback,\r\n        controlsCallback?: TBezierLineControlsCallback,\r\n    ): void {\r\n        if (this.pointArr.length < 2) {\r\n            return;\r\n        }\r\n\r\n        const p1 = this.pointArr[this.pointArr.length - 2];\r\n        const p2 = this.pointArr[this.pointArr.length - 1];\r\n\r\n        const newP = Vec2.add(p2, Vec2.sub(p2, p1));\r\n\r\n        this.add(newP.x, newP.y, spacing, callback, controlsCallback);\r\n    }\r\n}\r\n\r\n/**\r\n * from SplineInterpolator.cs in the Paint.NET source code\r\n */\r\nexport class SplineInterpolator {\r\n\r\n    private readonly xa: number[];\r\n    private readonly ya: number[];\r\n    private readonly u: number[];\r\n    private readonly y2: number[];\r\n    private readonly first: number;\r\n    private readonly last: number;\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        points: [number, number][],\r\n    ) {\r\n        const n = points.length;\r\n        this.xa = [];\r\n        this.ya = [];\r\n        this.u = [];\r\n        this.y2 = [];\r\n        let i;\r\n\r\n        this.first = points[0][0];\r\n        this.last = points[points.length - 1][0];\r\n\r\n        points.sort(function (a, b) {\r\n            return a[0] - b[0];\r\n        });\r\n        for (i = 0; i < n; i++) {\r\n            this.xa.push(points[i][0]);\r\n            this.ya.push(points[i][1]);\r\n        }\r\n\r\n        this.u[0] = 0;\r\n        this.y2[0] = 0;\r\n\r\n        for (i = 1; i < n - 1; ++i) {\r\n            // This is the decomposition loop of the tridiagonal algorithm.\r\n            // y2 and u are used for temporary storage of the decomposed factors.\r\n            const wx = this.xa[i + 1] - this.xa[i - 1];\r\n            const sig = (this.xa[i] - this.xa[i - 1]) / wx;\r\n            const p = sig * this.y2[i - 1] + 2.0;\r\n\r\n            this.y2[i] = (sig - 1.0) / p;\r\n\r\n            const ddydx =\r\n                (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\r\n                (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\r\n\r\n            this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\r\n        }\r\n\r\n        this.y2[n - 1] = 0;\r\n\r\n        // This is the backsubstitution loop of the tridiagonal algorithm\r\n        for (i = n - 2; i >= 0; --i) {\r\n            this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getFirstX (): number {\r\n        return this.first;\r\n    }\r\n\r\n    getLastX (): number {\r\n        return this.last;\r\n    }\r\n\r\n    interpolate (x: number): number {\r\n        const n = this.ya.length;\r\n        let klo = 0;\r\n        let khi = n - 1;\r\n\r\n        // We will find the right place in the table by means of\r\n        // bisection. This is optimal if sequential calls to this\r\n        // routine are at random values of x. If sequential calls\r\n        // are in order, and closely spaced, one would do better\r\n        // to store previous values of klo and khi.\r\n        while (khi - klo > 1) {\r\n            const k = (khi + klo) >> 1;\r\n\r\n            if (this.xa[k] > x) {\r\n                khi = k;\r\n            } else {\r\n                klo = k;\r\n            }\r\n        }\r\n\r\n        const h = this.xa[khi] - this.xa[klo];\r\n        const a = (this.xa[khi] - x) / h;\r\n        const b = (x - this.xa[klo]) / h;\r\n\r\n        // Cubic spline polynomial is now evaluated.\r\n        return a * this.ya[klo] + b * this.ya[khi] +\r\n            ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\r\n    }\r\n\r\n    /**\r\n     * find x to y. simply by stepping through. suboptimal, so don't call often.\r\n     * searches in x 0-1 range\r\n     */\r\n    findX (y: number, resolution: number): number | null {\r\n        let x = null;\r\n        let dist = null;\r\n        for (let i = 0; i <= resolution; i++) {\r\n            const tempX = i / resolution;\r\n            const tempY = this.interpolate(tempX);\r\n            if (x === null) {\r\n                x = tempX;\r\n                dist = Math.abs(tempY - y);\r\n                continue;\r\n            }\r\n\r\n            const tempDist = Math.abs(tempY - y);\r\n\r\n            if (tempDist < dist) {\r\n                x = tempX;\r\n                dist = tempDist;\r\n            } else {\r\n                //distance increasing\r\n                break;\r\n            }\r\n        }\r\n        return x;\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * input for a spline, following curve of quadratic function x^2 [0 - 1]\r\n * returns [[0, startVal], ..., [1, endVal]]\r\n * @param startVal\r\n * @param endVal\r\n * @param stepSize\r\n */\r\nexport function quadraticSplineInput (\r\n    startVal: number,\r\n    endVal: number,\r\n    stepSize: number,\r\n): [number, number][] {\r\n    function round (v: number, dec: number): number {\r\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\r\n    }\r\n\r\n    const resultArr: [number, number][] = [];\r\n    for (let i = 0; i <= 1; i += stepSize) {\r\n        resultArr.push([round(i, 4), round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)]);\r\n    }\r\n    return resultArr;\r\n}","\r\n\r\n\r\n// based on js color conversion http://www.webtoolkit.info/\r\n\r\n\r\nexport class HSV {\r\n    h: number;\r\n    s: number;\r\n    v: number;\r\n    constructor (h: number, s: number, v: number) {\r\n        this.h = Math.max(0, Math.min(360, h));\r\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\r\n        this.v = Math.max(0, Math.min(100, v));\r\n    }\r\n}\r\n\r\nexport class RGB {\r\n    r : number;\r\n    g: number;\r\n    b: number;\r\n    constructor (r: number, g: number, b: number) {\r\n        this.r = Math.max(0, Math.min(255, r));\r\n        this.g = Math.max(0, Math.min(255, g));\r\n        this.b = Math.max(0, Math.min(255, b));\r\n    }\r\n}\r\n\r\nexport class CMYK {\r\n    c: number;\r\n    m: number;\r\n    y: number;\r\n    k: number;\r\n    constructor (c: number, m: number, y: number, k: number) {\r\n        this.c = Math.max(0, Math.min(100, c));\r\n        this.m = Math.max(0, Math.min(100, m));\r\n        this.y = Math.max(0, Math.min(100, y));\r\n        this.k = Math.max(0, Math.min(100, k));\r\n    }\r\n}\r\n\r\nexport const ColorConverter = {\r\n\r\n    _RGBtoHSV: function (RGB: RGB): HSV {\r\n        const result = new HSV(0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        const minVal = Math.min(r, g, b);\r\n        const maxVal = Math.max(r, g, b);\r\n        const delta = maxVal - minVal;\r\n\r\n        result.v = maxVal;\r\n\r\n        if (delta == 0) {\r\n            result.h = 0;\r\n            result.s = 0;\r\n        } else {\r\n            result.s = delta / maxVal;\r\n            const del_R = (((maxVal - r) / 6) + (delta / 2)) / delta;\r\n            const del_G = (((maxVal - g) / 6) + (delta / 2)) / delta;\r\n            const del_B = (((maxVal - b) / 6) + (delta / 2)) / delta;\r\n\r\n            if (r == maxVal) {\r\n                result.h = del_B - del_G;\r\n            } else if (g == maxVal) {\r\n                result.h = (1 / 3) + del_R - del_B;\r\n            } else if (b == maxVal) {\r\n                result.h = (2 / 3) + del_G - del_R;\r\n            }\r\n\r\n            if (result.h < 0) {\r\n                result.h += 1;\r\n            }\r\n            if (result.h > 1) {\r\n                result.h -= 1;\r\n            }\r\n        }\r\n\r\n        result.h = Math.round(result.h * 360);\r\n        result.s = Math.round(result.s * 100);\r\n        result.v = Math.round(result.v * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    _HSVtoRGB: function (HSV: HSV): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\r\n\r\n        const h = (HSV.h / 360) % 1;\r\n        const s = HSV.s / 100;\r\n        const v = HSV.v / 100;\r\n\r\n        if (s == 0) {\r\n            result.r = v * 255;\r\n            result.g = v * 255;\r\n            result.b = v * 255;\r\n        } else {\r\n            var_h = h * 6;\r\n            var_i = Math.floor(var_h);\r\n            var_1 = v * (1 - s);\r\n            var_2 = v * (1 - s * (var_h - var_i));\r\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\r\n\r\n            if (var_i == 0) {\r\n                var_r = v;\r\n                var_g = var_3;\r\n                var_b = var_1;\r\n            } else if (var_i == 1) {\r\n                var_r = var_2;\r\n                var_g = v;\r\n                var_b = var_1;\r\n            } else if (var_i == 2) {\r\n                var_r = var_1;\r\n                var_g = v;\r\n                var_b = var_3;\r\n            } else if (var_i == 3) {\r\n                var_r = var_1;\r\n                var_g = var_2;\r\n                var_b = v;\r\n            } else if (var_i == 4) {\r\n                var_r = var_3;\r\n                var_g = var_1;\r\n                var_b = v;\r\n            } else {\r\n                var_r = v;\r\n                var_g = var_1;\r\n                var_b = var_2;\r\n            }\r\n\r\n            result.r = var_r * 255;\r\n            result.g = var_g * 255;\r\n            result.b = var_b * 255;\r\n\r\n            result.r = Math.round(result.r);\r\n            result.g = Math.round(result.g);\r\n            result.b = Math.round(result.b);\r\n        }\r\n\r\n        return result;\r\n    },\r\n\r\n    _CMYKtoRGB: function (CMYK: CMYK): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        const c = CMYK.c / 100;\r\n        const m = CMYK.m / 100;\r\n        const y = CMYK.y / 100;\r\n        const k = CMYK.k / 100;\r\n\r\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\r\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\r\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\r\n\r\n        result.r = Math.round(result.r * 255);\r\n        result.g = Math.round(result.g * 255);\r\n        result.b = Math.round(result.b * 255);\r\n\r\n        return result;\r\n    },\r\n\r\n    _RGBtoCMYK: function (RGB: RGB): CMYK {\r\n        const result = new CMYK(0, 0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\r\n        result.c = (1 - r - result.k) / (1 - result.k);\r\n        result.m = (1 - g - result.k) / (1 - result.k);\r\n        result.y = (1 - b - result.k) / (1 - result.k);\r\n\r\n        result.c = Math.round(result.c * 100);\r\n        result.m = Math.round(result.m * 100);\r\n        result.y = Math.round(result.y * 100);\r\n        result.k = Math.round(result.k * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    toRGB: function (o: RGB | HSV | CMYK): RGB {\r\n        if (o instanceof RGB) {\r\n            return o;\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._HSVtoRGB(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._CMYKtoRGB(o);\r\n        }\r\n    },\r\n\r\n    toHSV: function (o: RGB | HSV | CMYK): HSV {\r\n        if (o instanceof HSV) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoHSV(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._RGBtoHSV(this._CMYKtoRGB(o));\r\n        }\r\n    },\r\n\r\n    toCMYK: function (o: RGB | HSV | CMYK): CMYK {\r\n        if (o instanceof CMYK) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoCMYK(o);\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._RGBtoCMYK(this._HSVtoRGB(o));\r\n        }\r\n    },\r\n    toHexString: function (o: RGB): string {\r\n        if (o instanceof RGB || ('r' in o && 'g' in o && 'b' in o)) {\r\n            let ha = (parseInt('' + o.r)).toString(16);\r\n            let hb = (parseInt('' + o.g)).toString(16);\r\n            let hc = (parseInt('' + o.b)).toString(16);\r\n            if (ha.length == 1) {\r\n                ha = '0' + ha;\r\n            }\r\n            if (hb.length == 1) {\r\n                hb = '0' + hb;\r\n            }\r\n            if (hc.length == 1) {\r\n                hc = '0' + hc;\r\n            }\r\n            return ha + hb + hc;\r\n        }\r\n    },\r\n    toRgbStr: function (rgbObj: {r: number; g: number; b: number}): string {\r\n        return 'rgb(' + Math.round(rgbObj.r) + ', ' + Math.round(rgbObj.g) + ', ' + Math.round(rgbObj.b) + ')';\r\n    },\r\n    toRgbaStr: function (rgbaObj: {r: number; g: number; b: number; a: number}): string {\r\n        return 'rgba(' + Math.round(rgbaObj.r) + ', ' + Math.round(rgbaObj.g) + ', ' + Math.round(rgbaObj.b) + ', ' + rgbaObj.a + ')';\r\n    },\r\n    hexToRGB: function (hexStr: string): RGB | null {\r\n        hexStr = hexStr.trim();\r\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\r\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n        hexStr = hexStr.replace(shorthandRegex, function (m, r, g, b) {\r\n            return r + r + g + g + b + b;\r\n        });\r\n\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\r\n        return result ? new RGB(\r\n            parseInt(result[1], 16),\r\n            parseInt(result[2], 16),\r\n            parseInt(result[3], 16)\r\n        ) : null;\r\n    },\r\n\r\n};\r\n\r\nexport function testIsWhiteBestContrast (rgbObj: {r: number; g: number; b: number}): boolean {\r\n    return (rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114) < 125;\r\n}","import {css} from './base';\r\nimport {BB} from '../bb';\r\nimport {IKeyStringOptional} from '../bb-types';\r\n\r\n\r\nexport function appendTextDiv (target: HTMLElement, text: string): HTMLDivElement {\r\n    const div = document.createElement('div');\r\n    div.innerHTML = text;\r\n    target.append(div);\r\n    return div;\r\n}\r\n\r\n/**\r\n * Is an input element focused.\r\n * Set attribute \"data-ignore-focus\" to \"true\" if its focus should be ignored.\r\n *\r\n * @param getAll - check all, even those with \"data-ignore-focus\" = \"true\"\r\n */\r\nexport function isInputFocused (getAll: boolean = false): boolean {\r\n    const result = !!(document.activeElement && ['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName));\r\n    if (getAll) {\r\n        return result;\r\n    } else {\r\n        return result && !document.activeElement?.getAttribute('data-ignore-focus');\r\n    }\r\n}\r\n\r\nexport function unfocusAnyInput (): void {\r\n    if (isInputFocused(true)) {\r\n        /*\r\n            Unfocus anything that is focused.\r\n\r\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\r\n            that isn't its direct parent, then Firefox will keep anything attached to this\r\n            Input in memory. It will not be garbage collected until a new Input is focused.\r\n\r\n            Workaround: Temporarily create an input, focus it, detach it.\r\n             */\r\n        const focusEl = BB.el({\r\n            parent: document.body,\r\n            tagName: 'input',\r\n            css: {\r\n                opacity: '0',\r\n                width: '0',\r\n                height: '0',\r\n            },\r\n        }) as HTMLInputElement;\r\n        setTimeout(() => {\r\n            focusEl.select();\r\n            focusEl.focus();\r\n            focusEl.parentNode.removeChild(focusEl);\r\n        }, 10);\r\n    }\r\n}\r\n\r\n/**\r\n * clears text selection in window\r\n */\r\nexport function clearSelection (): void {\r\n    if (window.getSelection) {\r\n        const sel = window.getSelection();\r\n        if (sel) {\r\n            if (sel.empty) {\r\n                sel.empty();\r\n            } else if (sel.removeAllRanges) {\r\n                sel.removeAllRanges();\r\n            }\r\n        }\r\n    } else if ('selection' in document) {\r\n        (document as any).selection.empty();\r\n    }\r\n}\r\n\r\n/**\r\n * prevents being able to focus element.\r\n * warning: it creates a listener\r\n *\r\n * @param el - dom element\r\n */\r\nexport const makeUnfocusable = (function () {\r\n\r\n    function preventFocus (event: MouseEvent) {\r\n        event.preventDefault();\r\n        let didFocusRelated = false;\r\n        if (event.relatedTarget) {\r\n            try {\r\n                (event.relatedTarget as HTMLElement).focus();\r\n                didFocusRelated = true;\r\n            } catch(e) {\r\n                console.error('failed to focus');\r\n            }\r\n        }\r\n        if (!didFocusRelated) {\r\n            (event.currentTarget as HTMLElement).blur();\r\n        }\r\n    }\r\n\r\n    return function (el) {\r\n        el.setAttribute('tabindex', '-1');\r\n        el.addEventListener('focus', preventFocus);\r\n    };\r\n})();\r\n\r\n\r\nconst els: {\r\n    el: HTMLElement;\r\n    listeners: [string, any][];\r\n}[] = [];\r\n// window['els'] = els;\r\n\r\n/**\r\n *\r\n * Create DOM element - div by default\r\n * params = {\r\n * \t    parent: someOtherDiv,\r\n * \t    css: {\r\n * \t\t    width: \"500px\",\r\n * \t\t    backgroundColor: \"#fff\"\r\n * \t    },\r\n * \t    content: \"test\", //or  content: [divA, divB, divC]   or content: someDiv\r\n * \t    className: \"bla\",\r\n *      id: \"bla\"\r\n * }\r\n *\r\n *  If onClick or onChange is used, then BB.destroyEl MUST be called\r\n *  to prevent a memory leak.\r\n *\r\n * @param params\r\n */\r\nexport function el (\r\n    params?: {\r\n        parent?: HTMLElement;\r\n        css?: IKeyStringOptional;\r\n        custom?: { [key: string]: any };\r\n        content?: string | (HTMLElement | string | undefined)[] | Element;\r\n        textContent?: string;\r\n        className?: string;\r\n        title?: string;\r\n        id?: string;\r\n        tagName?: string;\r\n        onClick?: (e: MouseEvent) => void;\r\n        onChange?: (e: Event) => void;\r\n    }\r\n): HTMLElement {\r\n    if (!params) {\r\n        return document.createElement('div');\r\n    }\r\n    const div = document.createElement(params.tagName ? params.tagName : 'div');\r\n    params.css && css(div, params.css);\r\n\r\n    if (params.content) {\r\n        if (typeof params.content === typeof 'aa') {\r\n            div.innerHTML = params.content as string;\r\n\r\n        } else if (Array.isArray(params.content)) {\r\n            BB.append(div, params.content);\r\n\r\n        } else {\r\n            div.append(params.content as HTMLElement);\r\n\r\n        }\r\n    }\r\n    if (params.textContent) {\r\n        div.textContent = params.textContent;\r\n    }\r\n    if (params.className) {\r\n        div.className = params.className;\r\n    }\r\n    if (params.id) {\r\n        div.id = params.id;\r\n    }\r\n    if (params.parent) {\r\n        params.parent.append(div);\r\n    }\r\n    if ('title' in params && params.title !== undefined) {\r\n        div.title = params.title;\r\n    }\r\n    const listeners = [];\r\n    if ('onClick' in params) {\r\n        div.addEventListener('click', params.onClick);\r\n        listeners.push(['click', params.onClick]);\r\n    }\r\n    if ('onChange' in params) {\r\n        div.addEventListener('change', params.onChange);\r\n        listeners.push(['change', params.onChange]);\r\n    }\r\n    if (listeners.length > 0) {\r\n        els.push({\r\n            el: div,\r\n            listeners,\r\n        });\r\n        /*div.style.backgroundColor = '#ff0';\r\n        div.style.border = '1px solid #ff0';*/\r\n    }\r\n    if ('custom' in params && params.custom) {\r\n        const customKeyArr = Object.keys(params.custom);\r\n        for (let i = 0; i < customKeyArr.length; i++) {\r\n            div.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\r\n        }\r\n    }\r\n    return div;\r\n}\r\n\r\n/**\r\n * removes event listeners for Elements created via el()\r\n * @param el\r\n */\r\nexport function destroyEl (el?: HTMLElement) {\r\n    if (!el) {\r\n        return;\r\n    }\r\n    for (let i = 0; i < els.length; i++) {\r\n        const item = els[i];\r\n        if (item.el === el) {\r\n            item.listeners.forEach(item => {\r\n                el.removeEventListener(item[0], item[1]);\r\n            });\r\n            els.splice(i, 1);\r\n            return;\r\n        }\r\n    }\r\n    // not found\r\n    return;\r\n}\r\n","\r\ntype TLogListener = (msg: any) => void;\r\n\r\nexport class BbLog {\r\n\r\n    private static listeners: TLogListener[] = [];\r\n\r\n    constructor () {\r\n    }\r\n\r\n    static subscribe (listener: TLogListener): void {\r\n        if (BbLog.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        BbLog.listeners.push(listener);\r\n    }\r\n\r\n    static unsubscribe (listener: TLogListener): void {\r\n        for (let i = 0; i < BbLog.listeners.length; i++) {\r\n            if (listener === BbLog.listeners[i]) {\r\n                BbLog.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    static emit (msg: any): void {\r\n        BbLog.listeners.forEach(item => {\r\n            item(msg);\r\n        });\r\n    }\r\n}","/**\r\n * LocalStorage wrapper that does not throw exceptions.\r\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\r\n */\r\nexport class LocalStorage {\r\n\r\n    private static error;\r\n\r\n    static getItem (key: string): string {\r\n        let result = null;\r\n        try {\r\n            result = localStorage.getItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static setItem (key: string, value: string): void {\r\n        try {\r\n            localStorage.setItem(key, value);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static removeItem (key: string): void {\r\n        try {\r\n            localStorage.removeItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static getError (): any {\r\n        return this.error;\r\n    }\r\n}","import {IPointerEvent} from '../event.types';\r\nimport {copyObj} from '../../base/base';\r\n\r\nexport interface ICoalescedPointerEvent extends IPointerEvent {\r\n    isCoalesced?: true;\r\n}\r\n\r\n/**\r\n * A ChainElement. Splits up coalesced events into their own pointermove events. Otherwise regular pass through.\r\n *\r\n * in: IPointerEvent\r\n * out: IPointerEvent with property isCoalesced: boolean\r\n *\r\n * todo: eventPreventDefault and eventStopPropagation are broken events w coalesced events. (because of json parse json stringify)\r\n * but how could that even work?\r\n */\r\nexport class CoalescedExploder {\r\n\r\n    private chainOut: ((e: ICoalescedPointerEvent) => void) | undefined;\r\n\r\n    // ---- public ----\r\n\r\n    setChainOut (func: (e: ICoalescedPointerEvent) => void) {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (event.coalescedArr && event.coalescedArr.length > 0) {\r\n                for (let i = 0; i < event.coalescedArr.length; i++) {\r\n                    const eventCopy: ICoalescedPointerEvent = copyObj(event);\r\n                    if (i === 0) {\r\n                        eventCopy.coalescedArr = [];\r\n                    }\r\n                    const coalescedItem = event.coalescedArr[i];\r\n\r\n                    eventCopy.pageX = coalescedItem.pageX;\r\n                    eventCopy.pageY = coalescedItem.pageY;\r\n                    eventCopy.relX = coalescedItem.relX;\r\n                    eventCopy.relY = coalescedItem.relY;\r\n                    eventCopy.dX = coalescedItem.dX;\r\n                    eventCopy.dY = coalescedItem.dY;\r\n                    eventCopy.time = coalescedItem.time;\r\n                    if (i < event.coalescedArr.length - 1) {\r\n                        eventCopy.isCoalesced = true;\r\n                    }\r\n\r\n                    this.chainOut && this.chainOut(eventCopy);\r\n                }\r\n\r\n            } else {\r\n                return event;\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n}\r\n","import {dist} from '../../math/math';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\n/**\r\n * A ChainElement. Detects a single tap with N 'touch' pointers\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class NFingerTapper {\r\n\r\n    private readonly minSilenceBeforeDurationMs = 50;\r\n    private readonly maxTapMs = 500;\r\n    private readonly maxFirstLastFingerDownMs = 250;\r\n    private readonly maxPressedDistancePx = 12; //5 + fingers * 5;\r\n\r\n    private chainOut: ((e: IPointerEvent) => void) | undefined;\r\n    private fingerArr: {\r\n        pointerId: number;\r\n        downTimeMs: number;\r\n        downPageX: number;\r\n        downPageY: number;\r\n        isUp?: boolean;\r\n    }[] = [];\r\n    private eventQueueArr: IPointerEvent[] = [];\r\n    private firstDownTime: number = 0;\r\n    private lastEventTime: number = 0;\r\n    private nowTime: number = performance.now();\r\n    private readonly pointersDownIdArr: number[] = [];\r\n    private readonly fingers: number;\r\n    private readonly onTap: () => void;\r\n    private readonly timeoutObj: {\r\n        firstLastDownTimeout: ReturnType<typeof setTimeout> | null;\r\n        tapTimeout: ReturnType<typeof setTimeout> | null;\r\n    } = {\r\n        firstLastDownTimeout: null,\r\n        tapTimeout: null,\r\n    };\r\n\r\n    private failGesture (): void {\r\n        if (this.eventQueueArr.length === 0) {\r\n            return;\r\n        }\r\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\r\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\r\n        for (let i = 0; i < this.eventQueueArr.length; i++) {\r\n            this.chainOut && this.chainOut(this.eventQueueArr[i]);\r\n        }\r\n        this.eventQueueArr = [];\r\n        this.fingerArr = [];\r\n    }\r\n\r\n    private success (): void {\r\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\r\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\r\n        this.eventQueueArr = []; // events get swallowed\r\n        this.fingerArr = [];\r\n        this.onTap();\r\n    }\r\n\r\n    private setupTimeout (timeoutStr: 'firstLastDownTimeout' | 'tapTimeout', timeMS: number): boolean {\r\n        const diff = timeMS - this.nowTime;\r\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        this.timeoutObj[timeoutStr] = setTimeout(() => this.failGesture(), diff);\r\n        return true;\r\n    }\r\n\r\n    private processEvent (event: IPointerEvent): true | void {\r\n\r\n        const tempLastEventTime = this.lastEventTime;\r\n        this.lastEventTime = event.time;\r\n\r\n        if (event.type === 'pointerdown') {\r\n            this.pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\r\n                if (this.pointersDownIdArr[i] === event.pointerId) {\r\n                    this.pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (event.pointerType !== 'touch') {\r\n            if (this.fingerArr.length > 0) { // already in gesture -> fail\r\n                this.failGesture();\r\n            }\r\n            return;\r\n        }\r\n\r\n        this.nowTime = performance.now();\r\n\r\n        if (event.type === 'pointerdown') {\r\n            //console.log('down');\r\n            if (this.fingerArr.length + 1 !== this.pointersDownIdArr.length) { // failed before, and some fingers are still down -> fail\r\n                this.failGesture();\r\n                return;\r\n            }\r\n            if (this.fingerArr.length === this.fingers) { // too many fingers down -> fail\r\n                //console.log(fingers + ': too many fingers down -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n            if (this.fingerArr.length > 0 && event.time - this.maxFirstLastFingerDownMs > this.fingerArr[0].downTimeMs) { // took too long to touch with all fingers -> fail\r\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n            if (this.fingerArr.length === 0 && event.time - this.minSilenceBeforeDurationMs < tempLastEventTime) { // not enough silence before -> fail\r\n                //console.log(fingers + ': not enough silence before -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            if (this.fingerArr.length === 0) {\r\n                this.firstDownTime = event.time;\r\n\r\n                if (!this.setupTimeout('firstLastDownTimeout', event.time + this.maxFirstLastFingerDownMs) || !this.setupTimeout('tapTimeout', event.time + this.maxTapMs)) { // timeouts already up -> fail\r\n                    this.failGesture();\r\n                    return;\r\n                }\r\n\r\n            }\r\n            this.fingerArr.push({\r\n                pointerId: event.pointerId,\r\n                downTimeMs: event.time,\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY,\r\n            });\r\n            return;\r\n\r\n        }\r\n\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (this.fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            for (let i = 0; i < this.fingerArr.length; i++) {\r\n                if (this.fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = this.fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) { // finger not part of the tap is on screen -> fail\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            if (event.time - this.maxTapMs > this.firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > this.maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'pointerup') {\r\n\r\n            if (this.fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            //console.log('up', event.pageX, event.pageY);\r\n            if (this.fingerArr.length !== this.fingers) { // not enough fingers -> fail\r\n                //console.log(fingers + ': not enough fingers -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            let i = 0;\r\n            for (; i < this.fingerArr.length; i++) {\r\n                if (this.fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = this.fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) {\r\n                //do nothing\r\n                return;\r\n            }\r\n\r\n            if (event.time - this.maxTapMs > this.firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > this.maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\r\n                //console.log(fingerArr);\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            fingerObj.isUp = true;\r\n\r\n            let allAreUp = true;\r\n            for (let i = 0; i < this.fingerArr.length; i++) {\r\n                if (!this.fingerArr[i].isUp) {\r\n                    allAreUp = false;\r\n                    break;\r\n                }\r\n            }\r\n            //console.log('fingerArr', fingerArr);\r\n\r\n            if (allAreUp) { // success\r\n                this.success();\r\n                return true;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            fingers: number;\r\n            onTap: () => void;\r\n        }\r\n    ) {\r\n        this.fingers = p.fingers;\r\n        this.onTap = p.onTap;\r\n    }\r\n\r\n\r\n    chainIn (event: IPointerEvent): (IPointerEvent | null) {\r\n\r\n        const result = this.processEvent(event);\r\n\r\n        //console.log(fingerArr.length);\r\n\r\n        if (result === true) {\r\n            //tap success -> event gets swallowed\r\n            return null;\r\n        }\r\n        if (this.fingerArr.length === 0) {\r\n            return event;\r\n        } else {\r\n            this.eventQueueArr.push(event);\r\n        }\r\n\r\n        return null;\r\n\r\n    }\r\n\r\n    setChainOut (func: (e: IPointerEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n\r\n}\r\n","import {dist, pointsToAngleRad} from '../../math/math';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\nexport type TPinchZoomerEvent = { type: 'end' } | {\r\n    type: 'move';\r\n\r\n    downRelX: number;\r\n    downRelY: number;\r\n    relX: number;\r\n    relY: number;\r\n\r\n    angleRad: number;\r\n    scale: number;\r\n};\r\n\r\ntype TTouchPointer =  {\r\n    pointerId: number;\r\n    relX: number;\r\n    relY: number;\r\n    downRelX?: number; // only for first\r\n    downRelY?: number;\r\n};\r\n\r\ntype TPinchGesture = {\r\n    touchPointerArr: TTouchPointer[];\r\n    otherPointerIdArr: number[];\r\n    isInProgress: boolean;\r\n};\r\n\r\n/**\r\n * A ChainElement. Detects a pinch zooming (2 touch pointers). If one finger lifts, then will use the remaining.\r\n * Further pointers are ignored, but their events get swallowed during the pinching.\r\n * pinching ends when ALL pointers are lifted.\r\n * Events passed through if no pinching.\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class PinchZoomer {\r\n\r\n    private readonly firstFingerMaxDistancePx = 10;\r\n    private readonly untilSecondFingerDurationMs = 250;\r\n\r\n\r\n    private chainOut: ((e: IPointerEvent) => void) | undefined;\r\n    private readonly pointersDownIdArr: number[] = [];\r\n    private gestureObj: null | TPinchGesture = null;\r\n    private eventQueueArr: IPointerEvent[] = [];\r\n    private nowTime: number = performance.now();\r\n    private readonly timeoutObj: {\r\n        secondFingerTimeout: ReturnType<typeof setTimeout> | null;\r\n    } = {\r\n        secondFingerTimeout: null,\r\n    };\r\n    private pincherArr: {\r\n        pointerId: number;\r\n        relX: number;\r\n        relY: number;\r\n        downRelX: number;\r\n        downRelY: number;\r\n    }[] = [];\r\n    private readonly onPinch: (e: TPinchZoomerEvent) => void;\r\n\r\n\r\n    private end (): void {\r\n        this.gestureObj = null;\r\n        this.eventQueueArr = [];\r\n    }\r\n\r\n    private fail (doSwallow?: boolean): void {\r\n        if (!this.gestureObj) { // no gesture happening -> ignore\r\n            return;\r\n        }\r\n\r\n        this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\r\n        if (!doSwallow) {\r\n            for (let i = 0; i < this.eventQueueArr.length; i++) {\r\n                this.chainOut && this.chainOut(this.eventQueueArr[i]);\r\n            }\r\n        }\r\n        this.end();\r\n    }\r\n\r\n    private setupFailTimeout (timeMS: number): boolean {\r\n        const diff = timeMS - this.nowTime;\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        this.timeoutObj.secondFingerTimeout = setTimeout(() => this.fail(), diff);\r\n        return true;\r\n    }\r\n\r\n    private processEvent (event: IPointerEvent): void {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            this.pointersDownIdArr.push(event.pointerId);\r\n\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\r\n                if (this.pointersDownIdArr[i] === event.pointerId) {\r\n                    this.pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        //pass through scenarios\r\n        if (\r\n            !this.gestureObj && (\r\n                event.pointerType !== 'touch' || // wrong pointer type\r\n                (event.type === 'pointermove' && this.pointersDownIdArr.length > 0) || // failed before\r\n                this.pointersDownIdArr.length > 1 || // failed before\r\n                event.type === 'pointerup' // failed before\r\n            )\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        this.nowTime = performance.now();\r\n\r\n\r\n        //pointer down\r\n        if (event.type === 'pointerdown') {\r\n\r\n            if (this.gestureObj) {\r\n                if (event.pointerType === 'touch') { // touch finger down - as nth pointer\r\n\r\n                    this.gestureObj.touchPointerArr.push({\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY,\r\n                    });\r\n\r\n                    if (this.gestureObj.isInProgress) {\r\n                        this.continuePinch(this.gestureObj, {\r\n                            type: 'down',\r\n                            index: this.gestureObj.touchPointerArr.length - 1,\r\n                        });\r\n                    } else {\r\n                        this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\r\n                        this.gestureObj.isInProgress = true;\r\n                        this.beginPinch(this.gestureObj);\r\n                    }\r\n                    return;\r\n\r\n                } else { // non-touch finger down - as nth pointer\r\n\r\n                    if (this.gestureObj.isInProgress) {\r\n                        this.gestureObj.otherPointerIdArr.push(event.pointerId);\r\n                    } else { // second pointer wrong type -> fail\r\n                        this.fail();\r\n                    }\r\n                    return;\r\n                }\r\n\r\n\r\n            } else {\r\n                // first finger down - can only be touch if no gestureObj\r\n                this.gestureObj = {\r\n                    touchPointerArr: [{\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY,\r\n                        downRelX: event.relX,\r\n                        downRelY: event.relY,\r\n                    }],\r\n                    otherPointerIdArr: [],\r\n                    isInProgress: false,\r\n                };\r\n                if (!this.setupFailTimeout(event.time + this.untilSecondFingerDurationMs)) { // time ran out -> fail\r\n                    this.fail();\r\n                    return;\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        // should not happen. something went wrong\r\n        if (!this.gestureObj) {\r\n            // throw? would make it less robust\r\n            this.fail();\r\n            return;\r\n        }\r\n\r\n        //pointer move\r\n        if (event.type === 'pointermove' && event.pointerType === 'touch') {\r\n            //gesture object should always exist here\r\n\r\n            let touchPointerObj: TTouchPointer | null = null;\r\n            let i = 0;\r\n            for (; i < this.gestureObj.touchPointerArr.length; i++) {\r\n                if (event.pointerId === this.gestureObj.touchPointerArr[i].pointerId) {\r\n                    touchPointerObj = this.gestureObj.touchPointerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n\r\n            //null should not be possible. something went wrong\r\n            if (!touchPointerObj) {\r\n                // throw? would make it less robust\r\n                this.fail();\r\n                return;\r\n            }\r\n\r\n            touchPointerObj.relX = event.relX;\r\n            touchPointerObj.relY = event.relY;\r\n\r\n            if (!this.gestureObj.isInProgress) { // only one finger down & pinching hasn't started\r\n\r\n                // should not happen. something went wrong\r\n                if (\r\n                    !('downRelX' in touchPointerObj && touchPointerObj.downRelX !== undefined) ||\r\n                    !('downRelY' in touchPointerObj && touchPointerObj.downRelY !== undefined)\r\n                ) {\r\n                    this.fail();\r\n                    return;\r\n                }\r\n\r\n                const distance = dist(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\r\n                if (distance > this.firstFingerMaxDistancePx) { // moved too much -> fail\r\n                    this.fail();\r\n                    return;\r\n                }\r\n\r\n            } else {\r\n                if (i < 2) { // only first two touches can affect pinching\r\n                    this.continuePinch(this.gestureObj, {\r\n                        type: 'move',\r\n                        index: i,\r\n                    });\r\n                }\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n\r\n        //pointer up\r\n        if (event.type === 'pointerup') {\r\n            //gesture object should always exist here\r\n\r\n            if (event.pointerType === 'touch') {\r\n                let i = 0;\r\n                for (; i < this.gestureObj.touchPointerArr.length; i++) {\r\n                    if (this.gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\r\n                        this.gestureObj.touchPointerArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n                if (this.gestureObj.touchPointerArr.length > 0) {\r\n                    this.continuePinch(this.gestureObj, {\r\n                        type: 'up',\r\n                        index: i,\r\n                    });\r\n                }\r\n\r\n            } else { // non-touch\r\n                for (let i = 0; i < this.gestureObj.otherPointerIdArr.length; i++) {\r\n                    if (this.gestureObj.otherPointerIdArr[i] === event.pointerId) {\r\n                        this.gestureObj.otherPointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            //all fingers lifted?\r\n            if (this.gestureObj.touchPointerArr.length === 0 && this.gestureObj.otherPointerIdArr.length === 0) {\r\n                if (this.gestureObj.isInProgress) { // lifted last finger -> end of pinching\r\n                    this.end();\r\n                    this.endPinch();\r\n                } else { // lifted finger again before pinching started -> fail\r\n                    this.fail();\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    private beginPinch (gestureObj: TPinchGesture): void {\r\n\r\n        for (let i = 0; i < gestureObj.touchPointerArr.length; i++) {\r\n            const pointerObj = gestureObj.touchPointerArr[i];\r\n            this.pincherArr.push({\r\n                pointerId: pointerObj.pointerId,\r\n                relX: pointerObj.relX,\r\n                relY: pointerObj.relY,\r\n                downRelX: pointerObj.relX,\r\n                downRelY: pointerObj.relY,\r\n            });\r\n        }\r\n\r\n        const event: TPinchZoomerEvent = {\r\n            type: 'move',\r\n\r\n            // temp\r\n            downRelX: 0,\r\n            downRelY: 0,\r\n            relX: 0,\r\n            relY: 0,\r\n\r\n            angleRad: 0,\r\n            scale: 1,\r\n        };\r\n\r\n        if (this.pincherArr.length === 1) {\r\n            event.relX = this.pincherArr[0].downRelX;\r\n            event.relY = this.pincherArr[0].downRelY;\r\n        } else {\r\n            event.relX = 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX);\r\n            event.relY = 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY);\r\n        }\r\n        event.downRelX = event.relX;\r\n        event.downRelY = event.relY;\r\n\r\n        this.onPinch(event);\r\n\r\n    }\r\n\r\n    //actionObj = {type: 'down'|'move'|'up', index: number}\r\n    private continuePinch (\r\n        gestureObj: TPinchGesture,\r\n        actionObj: {\r\n            type: 'down' | 'move' | 'up';\r\n            index: number;\r\n        }\r\n    ): void {\r\n\r\n        if (actionObj.index > 1) { // only first two pointers matter\r\n            return;\r\n        }\r\n\r\n        if (actionObj.type === 'move') {\r\n\r\n            let event: TPinchZoomerEvent;\r\n            this.pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\r\n            this.pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\r\n\r\n            if (this.pincherArr.length === 1) {\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: this.pincherArr[0].downRelX,\r\n                    downRelY: this.pincherArr[0].downRelY,\r\n                    relX: this.pincherArr[0].relX,\r\n                    relY: this.pincherArr[0].relY,\r\n                    angleRad: 0,\r\n                    scale: 1,\r\n                };\r\n\r\n            } else {\r\n\r\n                const startDist = dist(this.pincherArr[0].downRelX, this.pincherArr[0].downRelY, this.pincherArr[1].downRelX, this.pincherArr[1].downRelY);\r\n                const distance = dist(this.pincherArr[0].relX, this.pincherArr[0].relY, this.pincherArr[1].relX, this.pincherArr[1].relY);\r\n\r\n                const startAngle = pointsToAngleRad({\r\n                    x: this.pincherArr[0].downRelX,\r\n                    y: this.pincherArr[0].downRelY,\r\n                }, {x: this.pincherArr[1].downRelX, y: this.pincherArr[1].downRelY});\r\n                const angle = pointsToAngleRad({\r\n                    x: this.pincherArr[0].relX,\r\n                    y: this.pincherArr[0].relY,\r\n                }, {x: this.pincherArr[1].relX, y: this.pincherArr[1].relY});\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX),\r\n                    downRelY: 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY),\r\n                    relX: 0.5 * (this.pincherArr[0].relX + this.pincherArr[1].relX),\r\n                    relY: 0.5 * (this.pincherArr[0].relY + this.pincherArr[1].relY),\r\n                    angleRad: angle - startAngle,\r\n                    scale: distance / startDist,\r\n                };\r\n\r\n            }\r\n\r\n            this.onPinch(event);\r\n\r\n        } else if (actionObj.type === 'down' || actionObj.type === 'up') {\r\n            this.endPinch();\r\n            this.beginPinch(gestureObj);\r\n        }\r\n\r\n    }\r\n\r\n    private endPinch (): void {\r\n        this.pincherArr = [];\r\n        this.onPinch({\r\n            type: 'end',\r\n        });\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onPinch: (e: TPinchZoomerEvent) => void;\r\n        }\r\n    ) {\r\n        this.onPinch = p.onPinch;\r\n    }\r\n\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n        this.processEvent(event);\r\n        if (this.gestureObj) {\r\n            if (!this.gestureObj.isInProgress) { // might still fail -> into queue\r\n                this.eventQueueArr.push(event);\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    setChainOut (func: (e: IPointerEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n}\r\n","import {TChainOutFunc} from './event-chain.types';\r\nimport {dist} from '../../math/math';\r\nimport {IPointerEvent, TPointerButton, TPointerType} from '../event.types';\r\n\r\n\r\ninterface IDoubleTapperEvent {\r\n    pageX: number;\r\n    pageY: number;\r\n    relX: number;\r\n    relY: number;\r\n}\r\n\r\ntype TDoubleTapperTimeoutType = 'fail' | 'maxUntilSecondDown' | 'success';\r\n\r\n/**\r\n * A ChainElement. Detects double taps.\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class DoubleTapper {\r\n\r\n    private readonly onDoubleTap: (e: IDoubleTapperEvent) => void;\r\n    private chainOut: TChainOutFunc | undefined;\r\n    private allowedPointerTypeArr: TPointerType[] = ['touch', 'mouse', 'pen'];\r\n    private allowedButtonArr: TPointerButton[] = ['left'];\r\n    private minSilenceBeforeDurationMs: number = 400;\r\n    private maxPressedDurationMs: number = 300;\r\n    private maxPressedDistancePx: number = 10;\r\n    private maxInbetweenDistancePx: number = 19;\r\n    private maxUpToUpDurationMs: number = 500;\r\n    private maxUntilSecondDownDurationMs: number = 300;\r\n    private minSilenceAfterMs: number = 250;\r\n    private sequenceArr: (\r\n        {\r\n            isDown: boolean;\r\n            time: number;\r\n            position: [number, number];\r\n            pointerId: number;\r\n        } |\r\n        {\r\n            isUp: boolean;\r\n            time: number;\r\n            position: [number, number];\r\n        } |\r\n        {\r\n            pageX: number;\r\n            pageY: number;\r\n            relX: number;\r\n            relY: number;\r\n        }\r\n        )[] = [];\r\n    private pointersDownIdArr: number[] = [];\r\n    private lastUpTime: number = 0;\r\n    private nowTime: number = 0;\r\n    private eventQueueArr: IPointerEvent[] = [];\r\n    private timeoutObj: {\r\n        [K in TDoubleTapperTimeoutType]: ReturnType<typeof setTimeout> | null;\r\n    } = {\r\n        fail: null,\r\n        maxUntilSecondDown: null,\r\n        success: null,\r\n    };\r\n    private readonly gestureFailed: () => void;\r\n\r\n    // double tap achieved\r\n    private success (): void {\r\n        this.timeoutObj.fail = null;\r\n        this.timeoutObj.success = null;\r\n        this.eventQueueArr = []; // events get swallowed\r\n        const lastSequenceItem = this.sequenceArr[this.sequenceArr.length - 1];\r\n        this.sequenceArr = [];\r\n        if ('pageX' in lastSequenceItem) {\r\n            this.onDoubleTap({\r\n                pageX: lastSequenceItem.pageX,\r\n                pageY: lastSequenceItem.pageY,\r\n                relX: lastSequenceItem.relX,\r\n                relY: lastSequenceItem.relY,\r\n            });\r\n        }\r\n    }\r\n\r\n    // returns false if time already up. otherwise sets up timeout\r\n    private setupTimeout (timeoutStr: TDoubleTapperTimeoutType, targetFunc: () => void, timeMS: number): boolean {\r\n        const diff = timeMS - this.nowTime;\r\n        // console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        this.timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @param event object - a pointer event from BB.PointerListener\r\n     */\r\n    private processEvent (event: IPointerEvent): void {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            this.pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\r\n                if (this.pointersDownIdArr[i] === event.pointerId) {\r\n                    this.pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!this.allowedPointerTypeArr.includes(event.pointerType)) { //wrong input type -> fail\r\n            //console.log('wrong input type -> fail');\r\n            this.gestureFailed();\r\n            return;\r\n        }\r\n\r\n        this.nowTime = performance.now();\r\n        const lastSequenceItem = this.sequenceArr.length > 0 ? this.sequenceArr[this.sequenceArr.length - 1] : null;\r\n        if (event.type === 'pointerup') {\r\n            this.lastUpTime = event.time;\r\n        }\r\n\r\n        if (event.type === 'pointerdown') {\r\n            if (this.pointersDownIdArr.length > 1) { // more than one pointer down -> fail\r\n                //console.log('more than one pointer down -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (this.timeoutObj.success !== null) { // silence-after not achieved -> fail\r\n                //console.log('silence-after not achieved -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (this.sequenceArr.length === 0 && this.nowTime - this.lastUpTime < this.minSilenceBeforeDurationMs) { // silence before not achieved -> fail\r\n                //console.log('silence before not achieved -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (event.button && !this.allowedButtonArr.includes(event.button)) { // wrong button -> fail\r\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if ((lastSequenceItem && 'isDown' in lastSequenceItem && lastSequenceItem.isDown) || this.sequenceArr.length > 2) { // jumbled -> fail\r\n                //console.log('jumbled -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (lastSequenceItem && 'position' in lastSequenceItem) {\r\n                const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n                if (distance > this.maxInbetweenDistancePx) { //moved too much -> reset\r\n                    //console.log('maxInbetweenDistancePx -> reset');\r\n                    this.gestureFailed();\r\n\r\n\r\n                    if ('time' in lastSequenceItem && this.nowTime - lastSequenceItem.time < this.minSilenceBeforeDurationMs) { //silence before not achieved -> fail\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            this.sequenceArr.push({\r\n                isDown: true,\r\n                time: this.nowTime,\r\n                position: [event.pageX, event.pageY],\r\n                pointerId: event.pointerId,\r\n            });\r\n            //maxUntilSecondDown\r\n\r\n            if (this.sequenceArr.length > 1) {\r\n                this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\r\n            } else if (!this.setupTimeout('maxUntilSecondDown', () => this.gestureFailed(), event.time + this.maxUntilSecondDownDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n\r\n\r\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\r\n            if (!this.setupTimeout('fail', () => this.gestureFailed(), event.time + this.maxPressedDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointermove' && 'pointerId' in lastSequenceItem && lastSequenceItem.pointerId === event.pointerId) {\r\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                console.log('another pointer mixing in -> fail');\r\n                this.fail();\r\n                return;\r\n            }*/\r\n            const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n            if (distance > this.maxPressedDistancePx) { //moved too much -> fail\r\n                //console.log('maxPressedDistancePx -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointerup') {\r\n            if ('pointerId' in lastSequenceItem && lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if ('time' in lastSequenceItem && this.nowTime >= lastSequenceItem.time + this.maxPressedDurationMs) { //pressed too long -> fail\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\r\n\r\n            if (this.sequenceArr.length < 3) {\r\n                if (!this.setupTimeout('fail', () => this.gestureFailed(), event.time + this.maxUpToUpDurationMs)) {\r\n                    this.gestureFailed();\r\n                    return;\r\n                }\r\n\r\n                this.sequenceArr = [\r\n                    lastSequenceItem,\r\n                    {\r\n                        isUp: true,\r\n                        time: this.nowTime,\r\n                        position: [event.pageX, event.pageY],\r\n                    },\r\n                ];\r\n                return;\r\n            }\r\n\r\n            if ('time' in this.sequenceArr[1] && this.nowTime < this.sequenceArr[1].time + this.maxUpToUpDurationMs) {\r\n                // double tap almost success\r\n                // only needs silence\r\n                this.sequenceArr.push({\r\n                    pageX: event.pageX,\r\n                    pageY: event.pageY,\r\n                    relX: event.relX,\r\n                    relY: event.relY,\r\n                });\r\n                if (!this.setupTimeout('success', () => this.success(), event.time + this.minSilenceAfterMs)) {\r\n                    this.gestureFailed();\r\n                }\r\n            } else { // time up -> fail\r\n                this.gestureFailed();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onDoubleTap: (e: IDoubleTapperEvent) => void; // fires when double tap occurs\r\n        }\r\n    ) {\r\n        this.onDoubleTap = p.onDoubleTap;\r\n        this.gestureFailed = () => {\r\n            if (this.sequenceArr.length === 0) { // no gesture started -> can be ignored\r\n                return;\r\n            }\r\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\r\n            this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\r\n            this.timeoutObj.success && clearTimeout(this.timeoutObj.success);\r\n            this.timeoutObj.fail = null;\r\n            this.timeoutObj.maxUntilSecondDown = null;\r\n            this.timeoutObj.success = null;\r\n\r\n            if (this.chainOut) {\r\n                for (let i = 0; i < this.eventQueueArr.length; i++) {\r\n                    this.chainOut(this.eventQueueArr[i]);\r\n                }\r\n            }\r\n\r\n            this.eventQueueArr = [];\r\n            this.sequenceArr = [];\r\n        };\r\n    }\r\n\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n\r\n        this.processEvent(event);\r\n\r\n        if (this.sequenceArr.length === 0) { //existing events can not become a double tap\r\n            this.gestureFailed();\r\n            return event;\r\n        }\r\n        // events might become a double tap -> queue\r\n        this.eventQueueArr.push(event);\r\n        return null;\r\n    }\r\n\r\n    setChainOut (func: TChainOutFunc): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    setAllowedPointerTypeArr (arr: TPointerType[]): void {\r\n        this.allowedPointerTypeArr = [...arr];\r\n    }\r\n\r\n    setAllowedButtonArr (arr: TPointerButton[]): void {\r\n        this.allowedButtonArr = [...arr];\r\n    }\r\n\r\n}\r\n","import {TChainOutFunc} from './event-chain.types';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\n/**\r\n * only lets through events from one pointer at a time.\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class OnePointerLimiter {\r\n\r\n    private chainOut: TChainOutFunc | undefined;\r\n    private downPointerId: number | null = null;\r\n    private readonly ignorePointerIdArr: number[] = [];\r\n\r\n    // ---- public ----\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n\r\n        if (this.ignorePointerIdArr.includes(event.pointerId)) {\r\n            if (event.type === 'pointerup') {\r\n                for (let i = 0; i < this.ignorePointerIdArr.length; i++) {\r\n                    if (this.ignorePointerIdArr[i] === event.pointerId) {\r\n                        this.ignorePointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        if (this.downPointerId === null) {\r\n            if (event.type === 'pointerdown') {\r\n                this.downPointerId = event.pointerId;\r\n            }\r\n            return event;\r\n\r\n        } else {\r\n            if (event.pointerId !== this.downPointerId) {\r\n                if (event.type === 'pointerdown') {\r\n                    this.ignorePointerIdArr.push(event.pointerId);\r\n                }\r\n                return null;\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                this.downPointerId = null;\r\n            }\r\n            return event;\r\n        }\r\n    }\r\n\r\n    setChainOut (func: TChainOutFunc): void {\r\n        this.chainOut = func;\r\n    }\r\n}","import {IChainElement, TChainOutFunc} from './event-chain.types';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\n/**\r\n * for chaining event processing. useful for gestures (double tap, pinch zoom, max pointer filter).\r\n * each element in the chain might hold back the events, swallow them, transform them, or create new ones\r\n */\r\nexport class EventChain {\r\n    private readonly chainArr: IChainElement[];\r\n    private chainOut: TChainOutFunc | undefined;\r\n\r\n    private continueChain (i: number, event: IPointerEvent): null {\r\n        for (; i < this.chainArr.length; i++) {\r\n            event = this.chainArr[i].chainIn(event);\r\n            if (event === null) {\r\n                return null;\r\n            }\r\n        }\r\n        this.chainOut && this.chainOut(event);\r\n        return null;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            chainArr: IChainElement[];\r\n        }\r\n    ) {\r\n        this.chainArr = p.chainArr;\r\n\r\n        for (let i = 0; i < this.chainArr.length; i++) {\r\n            ( (i) => {\r\n                this.chainArr[i].setChainOut((event: IPointerEvent) => {\r\n                    this.continueChain(i + 1, event);\r\n                });\r\n            })(i);\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * feed an event into the chain\r\n     */\r\n    chainIn (event: IPointerEvent): null {\r\n        return this.continueChain(0, event);\r\n    }\r\n\r\n    /**\r\n     * func will be called when event has passed through the chain\r\n     */\r\n    setChainOut (func: TChainOutFunc): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n}\r\n","window.onscroll = (e) => {\r\n    e.preventDefault();\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hWwEP\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"83Fnk\");","import {KeyListener} from '../../../../bb/input/key-listener';\r\nimport {dialogCounter} from '../modal-count';\r\nimport {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport './scroll-fix';\r\nimport cancelImg from '/src/app/img/ui/cancel.svg';\r\n\r\n/**\r\n * popup that fill whole height, with some padding.\r\n * currently only used for iframe popups.\r\n */\r\nexport class DynamicModal {\r\n\r\n    private readonly parent: HTMLElement;\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly updatePos: () => void;\r\n    private readonly keyListener: KeyListener;\r\n    private readonly xButton: HTMLElement;\r\n    private readonly bgEl: HTMLElement;\r\n    private readonly onClose: ((result?: string) => void) | undefined;\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            title?: HTMLElement;\r\n            content?: HTMLElement;\r\n            buttonArr?: string[];\r\n            autoFocus?: string | false; // todo - not implemented\r\n            clickOnEnter?: string; // button name - todo not implemented\r\n            onClose?: (result?: string) => void;\r\n\r\n            //size and position\r\n            width: number;\r\n            isMaxHeight: boolean; // todo - not implemented\r\n        }\r\n    ) {\r\n        dialogCounter.increase();\r\n        this.onClose = p.onClose;\r\n        this.parent = document.body;\r\n        this.rootEl = BB.el({\r\n            parent: this.parent,\r\n            className: 'g-root kl-d-modal-root',\r\n            css: {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0',\r\n                overflow: 'auto',\r\n                animationName: 'consoleIn',\r\n                animationDuration: '0.3s',\r\n                animationTimingFunction: 'ease-out',\r\n            },\r\n            onClick: BB.handleClick,\r\n        });\r\n\r\n        //background element registering clicks\r\n        this.bgEl = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0',\r\n            },\r\n            onClick: () => this.close(),\r\n        });\r\n\r\n        //the actual popup box\r\n        const popupEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-d-modal',\r\n            css: {\r\n                position: 'absolute',\r\n                width: (BB.isCssMinMaxSupported() ?\r\n                    'min(calc(100% - 40px), ' + (p.width ? p.width : 400) + 'px)' :\r\n                    (p.width ? p.width : 400) + 'px'),\r\n                height: 'calc(100% - 40px)',\r\n                borderRadius: '10px',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n        //x and y position via script. flex not powerful enough imo\r\n        this.updatePos = () => {\r\n            const elW = popupEl.offsetWidth;\r\n            const elH = popupEl.offsetHeight;\r\n\r\n            BB.css(popupEl, {\r\n                left: Math.max(0, (window.innerWidth - elW) / 2) + 'px',\r\n                top: Math.max(20, (window.innerHeight - elH) / 2 - (elH * 0.20)) + 'px',\r\n            });\r\n        };\r\n\r\n        this.updatePos();\r\n        window.addEventListener('resize', this.updatePos);\r\n\r\n        //title row in popup\r\n        const titleHeight = 40;\r\n        const titleEl = BB.el({\r\n            parent: popupEl,\r\n            css: {\r\n                height: titleHeight + 'px',\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center',\r\n                paddingLeft: (titleHeight / 2) + 'px',\r\n            },\r\n        });\r\n        if (p.title) {\r\n            titleEl.append(p.title);\r\n        }\r\n        this.xButton = BB.el({\r\n            parent: titleEl,\r\n            tagName: 'button',\r\n            className: 'popup-x',\r\n            content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n            title: LANG('modal-close'),\r\n            onClick: () => this.close(),\r\n            css: {\r\n                width: titleHeight + 'px',\r\n                height: titleHeight + 'px',\r\n                lineHeight: titleHeight + 'px',\r\n                background: 'none',\r\n                boxShadow: 'none',\r\n            },\r\n            custom: {\r\n                tabindex: '0',\r\n            },\r\n        });\r\n\r\n        const contentEl = BB.el({\r\n            parent: popupEl,\r\n            css: {\r\n                height: 'calc(100% - ' + titleHeight + 'px)',\r\n            },\r\n        });\r\n        if (p.content) {\r\n            contentEl.append(p.content);\r\n        }\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, e) => {\r\n                if (keyStr === 'esc') {\r\n                    e.stopPropagation();\r\n                    this.close();\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n    close (): void {\r\n        dialogCounter.decrease();\r\n        BB.destroyEl(this.rootEl);\r\n        this.parent.removeChild(this.rootEl);\r\n        window.removeEventListener('resize', this.updatePos);\r\n        this.keyListener.destroy();\r\n        BB.destroyEl(this.xButton);\r\n        BB.destroyEl(this.bgEl);\r\n        this.onClose && this.onClose();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IKeyStringOptional} from '../../../bb/bb-types';\r\n\r\n/**\r\n * Checkbox - with label\r\n */\r\nexport class Checkbox {\r\n\r\n    private readonly element: HTMLElement;\r\n    private check: HTMLInputElement;\r\n    private readonly doHighlight: boolean;\r\n\r\n    // --- public ---\r\n\r\n    constructor (params: {\r\n        init?: boolean; // default false\r\n        label: string;\r\n        callback?: (b: boolean) => void;\r\n        allowTab?: boolean; // default false\r\n        title?: string;\r\n        doHighlight?: boolean; // default false\r\n        css?: IKeyStringOptional;\r\n    }) {\r\n        this.doHighlight = !!params.doHighlight;\r\n\r\n        this.element = BB.el({\r\n            className: 'kl-checkbox',\r\n        });\r\n\r\n        const innerEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'label',\r\n            className: 'kl-checkbox__inner',\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        this.check = BB.el({\r\n            parent: innerEl,\r\n            tagName: 'input',\r\n            css: {\r\n                margin: '0 5px 0 0',\r\n            },\r\n            custom: {\r\n                type: 'checkbox',\r\n            },\r\n        }) as HTMLInputElement;\r\n\r\n        this.check.checked = !!params.init;\r\n        if (this.doHighlight && this.check.checked) {\r\n            this.element.classList.add('kl-checkbox--highlight');\r\n        }\r\n        if (!params.allowTab) {\r\n            this.check.tabIndex = -1;\r\n        }\r\n\r\n        if (params.title) {\r\n            innerEl.title = params.title;\r\n        }\r\n\r\n        const label = BB.el({\r\n            parent: innerEl,\r\n            content: params.label,\r\n            css: {},\r\n        });\r\n        (label as any).allowClick = true;\r\n\r\n        this.check.onchange = () => {\r\n            if (this.doHighlight) {\r\n                this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\r\n            }\r\n            params.callback && params.callback(this.check.checked);\r\n            setTimeout(() => {\r\n                this.check.blur();\r\n            }, 0);\r\n        };\r\n        if (params.css) {\r\n            BB.css(this.element, params.css);\r\n        }\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.check.checked;\r\n    }\r\n\r\n    setValue (b: boolean): void {\r\n        this.check.checked = !!b;\r\n        if (this.doHighlight) {\r\n            this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.element;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.check.onchange = null;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb-types';\r\n\r\nexport const input = function (params: {\r\n    type?: 'button' | 'checkbox' | 'number' | 'text' | 'color'; // default text\r\n    min?: number;\r\n    max?: number;\r\n    callback: (val: string) => void;\r\n    init: string | number;\r\n    css?: IKeyString;\r\n}) {\r\n    const result = document.createElement('input');\r\n    if (params.type) {\r\n        try {\r\n            result.type = params.type;\r\n        } catch(e) {} // ie can't deal with number\r\n    } else {\r\n        result.type = 'text';\r\n    }\r\n    if (params.min !== undefined) {\r\n        result.min = '' + params.min;\r\n    }\r\n    if (params.max !== undefined) {\r\n        result.max = '' + params.max;\r\n    }\r\n    result.value = '' + params.init;\r\n    if (params.callback) {\r\n        result.onchange = function () {\r\n            params.callback(result.value);\r\n        };\r\n    }\r\n    if (params.css) {\r\n        BB.css(result, params.css);\r\n    }\r\n\r\n    return result;\r\n};","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb-types';\r\n\r\n/**\r\n * A select dropdown\r\n */\r\nexport class Select<ValueType extends string> {\r\n\r\n    private readonly selectEl: HTMLSelectElement;\r\n    private readonly optionArr: {\r\n        item: ([ValueType, string] | null); // [value, label]\r\n        el?: HTMLOptionElement;\r\n    }[];\r\n    private readonly changeListener: () => void;\r\n    private readonly onChange: ((val: ValueType) => void) | undefined;\r\n\r\n    \r\n    // --- public ---\r\n    constructor (p: {\r\n        isFocusable?: boolean; // default false\r\n        optionArr: ([ValueType, string] | null)[]; // [value, label]\r\n        initValue?: ValueType; // default null\r\n        onChange?: (val: ValueType) => void;\r\n        css?: IKeyString;\r\n        title?: string;\r\n    }) {\r\n        this.selectEl = BB.el({\r\n            tagName: 'select',\r\n            title: p.title,\r\n            className: 'kl-select',\r\n            css: {\r\n                cursor: 'pointer',\r\n                fontSize: '15px',\r\n                padding: '3px',\r\n            },\r\n        }) as HTMLSelectElement;\r\n        if (p.css) {\r\n            BB.css(this.selectEl, p.css);\r\n        }\r\n\r\n        const isFocusable = p.isFocusable;\r\n        if (!isFocusable) {\r\n            this.selectEl.tabIndex = -1;\r\n        }\r\n        this.optionArr = [];\r\n        for (let i = 0; i < p.optionArr.length; i++) {\r\n            const item = p.optionArr[i];\r\n            if (item === null) {\r\n                this.optionArr.push({item});\r\n                continue;\r\n            }\r\n            const el = document.createElement('option');\r\n            el.value = item[0];\r\n            el.textContent = item[1];\r\n            this.optionArr.push({\r\n                item,\r\n                el,\r\n            });\r\n            this.selectEl.append(el);\r\n        }\r\n        if (p.onChange) {\r\n            this.onChange = p.onChange;\r\n        }\r\n        this.changeListener = () => {\r\n            if (!isFocusable) {\r\n                this.selectEl.blur();\r\n            }\r\n            this.onChange && this.onChange(this.getValue());\r\n        };\r\n        this.selectEl.addEventListener('change', this.changeListener);\r\n        this.selectEl.value = ('initValue' in p && p.initValue !== undefined) ? p.initValue : '';\r\n    }\r\n\r\n    setValue (val: ValueType): void {\r\n        this.selectEl.value = val;\r\n    }\r\n\r\n    getValue (): ValueType {\r\n        return this.selectEl.value as ValueType;\r\n    }\r\n\r\n    setDeltaValue (delta: number): void {\r\n        let index = 0;\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            const option = this.optionArr[i];\r\n            if (option.item && '' + option.item[0] === this.selectEl.value) {\r\n                index = i;\r\n                break;\r\n            }\r\n        }\r\n        index = Math.max(0, Math.min(this.optionArr.length -1, index + delta));\r\n        const option = this.optionArr[index];\r\n        this.selectEl.value = option.item ? option.item[0] : '';\r\n        this.onChange && this.onChange(this.getValue());\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.selectEl;\r\n    }\r\n\r\n    updateLabel (id: ValueType, label: string): void {\r\n        this.optionArr.forEach(option => {\r\n            if (option.item && option.item[0] === id && option.el) {\r\n                option.item[1] = label;\r\n                option.el.textContent = option.item[1];\r\n            }\r\n        });\r\n    }\r\n\r\n    destroy (): void {\r\n        this.selectEl.removeEventListener('change', this.changeListener);\r\n    }\r\n    \r\n}\r\n","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Toggle button with an image\r\n */\r\nexport class ImageToggle {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private isActive: boolean;\r\n\r\n    private update (): void {\r\n        this.rootEl.classList.toggle('image-toggle-active', this.isActive);\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            initValue: boolean;\r\n            title: string;\r\n            isRadio?: boolean; // if true, can't click when active\r\n            onChange: (b: boolean) => void;\r\n            image: string;\r\n            darkInvert?: boolean;\r\n        }\r\n    ) {\r\n        this.isActive = !!p.initValue;\r\n        this.rootEl = BB.el({\r\n            className: 'image-toggle',\r\n            title: p.title,\r\n            content: BB.el({\r\n                className: 'image-toggle__im' + (p.darkInvert ? ' dark-invert' : ''),\r\n                css: {\r\n                    backgroundImage: \"url('\" + p.image + \"')\",\r\n                },\r\n            }),\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                if (p.isRadio && this.isActive) {\r\n                    return;\r\n                }\r\n                this.isActive = !this.isActive;\r\n                this.update();\r\n                p.onChange(this.isActive);\r\n            },\r\n        });\r\n\r\n\r\n        this.update();\r\n    }\r\n\r\n    // --- interface ---\r\n    setValue (b: boolean): void {\r\n        this.isActive = !!b;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.isActive;\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.rootEl);\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {ImageToggle} from './image-toggle';\r\n\r\ntype TOptionItem<IdType> = {\r\n    id: IdType;\r\n    title: string;\r\n    image: string;\r\n    darkInvert?: boolean;\r\n};\r\n\r\n/**\r\n * Radio input group. each one has an image\r\n */\r\nexport class ImageRadioList<IdType> {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private activeIndex: number;\r\n    private readonly optionArr: {\r\n        id: IdType;\r\n        radioEl: ImageToggle;\r\n    }[];\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            optionArr: TOptionItem<IdType>[];\r\n            initId: string;\r\n            onChange: (id: IdType) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'image-radio-wrapper',\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        this.optionArr = [];\r\n\r\n        const select = (index: number, id: IdType): void => {\r\n            this.activeIndex = index;\r\n            for (let i = 0; i < this.optionArr.length; i++) {\r\n                this.optionArr[i].radioEl.setValue(i === this.activeIndex);\r\n            }\r\n            p.onChange(id);\r\n        };\r\n\r\n        let initialIndex;\r\n        const createOption = (index: number, o: TOptionItem<IdType>): {\r\n            id: IdType;\r\n            radioEl: ImageToggle;\r\n        } => {\r\n            if (o.id === p.initId) {\r\n                initialIndex = index;\r\n            }\r\n            const radioEl = new ImageToggle({\r\n                image: o.image,\r\n                title: o.title,\r\n                initValue: o.id === p.initId,\r\n                isRadio: true,\r\n                onChange: () => {\r\n                    select(index, o.id);\r\n                },\r\n                darkInvert: o.darkInvert,\r\n            });\r\n            this.rootEl.append(radioEl.getElement());\r\n\r\n            return {\r\n                id: o.id,\r\n                radioEl,\r\n            };\r\n        };\r\n\r\n        for (let i = 0; i < p.optionArr.length; i++) {\r\n            this.optionArr.push(createOption(i, p.optionArr[i]));\r\n        }\r\n\r\n        if (initialIndex === undefined) {\r\n            throw new Error('initId not in optionArr');\r\n        }\r\n        this.activeIndex = initialIndex;\r\n    }\r\n\r\n    // --- interface ---\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValue (): IdType {\r\n        return this.optionArr[this.activeIndex].id;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.optionArr.forEach(item => {\r\n            item.radioEl.destroy();\r\n        });\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\nimport iconImg from '/src/app/img/ui/brush-pressure.svg';\r\nimport {BoxToggle} from './box-toggle';\r\n\r\n/**\r\n * small toggle button with a pen icon - representing toggling pressure sensitivity\r\n * @param isChecked initial value\r\n * @param changeCallback called on change\r\n */\r\nexport const createPenPressureToggle = function (\r\n    isChecked: boolean,\r\n    changeCallback: (b: boolean) => void,\r\n): HTMLElement {\r\n\r\n    const toggleEl = new BoxToggle({\r\n        label: BB.el({\r\n            className: 'dark-invert',\r\n            css: {\r\n                width: '17px',\r\n                height: '17px',\r\n                backgroundImage: 'url(\"' + iconImg + '\")',\r\n                backgroundSize: 'contain',\r\n                backgroundRepeat: 'no-repeat',\r\n                margin: '1px',\r\n                borderRadius: '3px',\r\n            },\r\n        }),\r\n        title: LANG('brush-toggle-pressure'),\r\n        init: isChecked,\r\n        onChange: (b) => {\r\n            changeCallback(b);\r\n        },\r\n    });\r\n\r\n\r\n    return toggleEl.getElement();\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h8ubb\");","import {BB} from '../../../bb/bb';\r\n\r\nexport class BoxToggle {\r\n    el: HTMLElement;\r\n    value: boolean;\r\n\r\n    update (): void {\r\n        this.el.classList.toggle('kl-box-toggle--active', this.value);\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            label: string | HTMLElement | SVGElement;\r\n            title?: string;\r\n            init?: boolean;\r\n            onChange: (b: boolean) => void;\r\n        }\r\n    ) {\r\n        this.value = !!p.init;\r\n        this.el = BB.el({\r\n            content: p.label,\r\n            title: p.title,\r\n            className: (typeof p.label === 'string') ? 'kl-box-toggle' : 'kl-box-toggle kl-box-toggle--custom-el',\r\n            onClick: () => {\r\n                this.value = !this.value;\r\n                this.update();\r\n                p.onChange(this.value);\r\n            },\r\n            css: {\r\n                cursor: 'pointer',\r\n            },\r\n        });\r\n        if (typeof p.label !== 'string') {\r\n            BB.css(p.label, {\r\n                display: 'block',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n        this.update();\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.value;\r\n    }\r\n\r\n    setValue (b: boolean): void {\r\n        this.value = !!b;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.el);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport {IKlSliderConfig} from '../../kl-types';\r\nimport {languageStrings} from '../../../language/language';\r\nimport {KlSliderManualInput} from './kl-slider-manual-input';\r\nimport {SplineInterpolator} from '../../../bb/math/line';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {IPointerEvent} from '../../../bb/input/event.types';\r\n\r\n/**\r\n * Horizontal slider, can be changed by dragging anywhere on it. Has a label & value.\r\n * e.g. used for brush size\r\n *\r\n * left mouse button - set absolute value\r\n * right mouse button - change relative value\r\n * drag mouse vertically away - precision mode\r\n * double-click/tap slider - manual input mode\r\n *\r\n * Values can be spline interpolated\r\n * On change callback can be debounced\r\n *\r\n */\r\nexport class KlSlider {\r\n\r\n    /*\r\n    Three types of values\r\n    - value - the actual value, when using setValue(), getValue(), and what is emitted\r\n    - displayValue - the number that the user sees on the slider and in the manual input field\r\n        - might be further formatted with formatFunc\r\n        - also might be the same as value, if no toDisplayValue function provided\r\n    - sliderValue - the draggable position of the slider, 0 - 1\r\n     */\r\n\r\n    private value: number;\r\n\r\n    private readonly elementWidth: number;\r\n    private readonly elementHeight: number;\r\n    private isEnabled: boolean;\r\n\r\n    private min: number; // min value\r\n    private max: number; // max value\r\n    private useSpline: boolean;\r\n    private splineInterpolator: undefined | SplineInterpolator;\r\n    private readonly resolution: number;\r\n\r\n    private readonly isChangeOnFinal: boolean;\r\n    private readonly formatFunc: undefined | ((val: number) => number);\r\n\r\n    private readonly onChange: (val: number) => void;\r\n    private readonly valueToDisplayValue: (value: number) => number;\r\n    private readonly displayValueToValue: (displayValue: number) => number;\r\n\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly sliderWrapperEl: HTMLElement;\r\n    private readonly textEl: HTMLElement; // displays label, displayValue\r\n    private readonly label: string;\r\n    private readonly control: HTMLElement;\r\n    private manualInput: undefined | KlSliderManualInput;\r\n    private readonly manualInputRoundDigits: number | undefined;\r\n\r\n    private pointerListener: PointerListener | undefined;\r\n    private readonly pointerListenerTimeout: ReturnType<typeof setTimeout>;\r\n\r\n    private readonly eventResMs: undefined | number;\r\n    private emitValue: undefined | number; // next value for interval\r\n    private emitInterval: (ReturnType<typeof setTimeout> | undefined); // interval of eventResMs which calls onChange()\r\n\r\n    private valueToSliderValue (value: number): number {\r\n        if (this.useSpline && this.splineInterpolator) {\r\n            return this.splineInterpolator.findX(value, Math.floor(this.resolution)) || 0;\r\n        }\r\n        return (value - this.min) / (this.max - this.min);\r\n    }\r\n\r\n    private sliderValueToValue (sliderValue: number): number {\r\n        let result = this.min + sliderValue * (this.max - this.min);\r\n        if (this.useSpline && this.splineInterpolator) {\r\n            result = this.splineInterpolator.interpolate(sliderValue) || 0;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private updateLabel (): void {\r\n        let displayValue: number | string = this.valueToDisplayValue(this.value);\r\n        displayValue = this.formatFunc ? this.formatFunc(displayValue) : Math.round(displayValue);\r\n        displayValue = displayValue.toLocaleString(languageStrings.getCode());\r\n        this.textEl.innerHTML = this.label + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + displayValue + '</span>';\r\n\r\n        const sliderValue = this.valueToSliderValue(this.value);\r\n        this.control.style.width = (sliderValue * this.elementWidth) + 'px';\r\n    }\r\n\r\n    private emit (isFinal: boolean): void {\r\n        if (!isFinal && this.isChangeOnFinal) {\r\n            return;\r\n        }\r\n\r\n        if (isFinal || !this.eventResMs) {\r\n            this.onChange(this.value);\r\n            if (this.emitInterval) {\r\n                clearInterval(this.emitInterval);\r\n                this.emitInterval = undefined;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (this.emitInterval) {\r\n            this.emitValue = this.value;\r\n\r\n        } else {\r\n            this.onChange(this.value);\r\n\r\n            this.emitInterval = setInterval(() => {\r\n                if (this.emitValue === undefined) {\r\n                    clearInterval(this.emitInterval);\r\n                    this.emitInterval = undefined;\r\n                } else {\r\n                    this.onChange(this.emitValue);\r\n                    this.emitValue = undefined;\r\n                }\r\n            }, this.eventResMs);\r\n        }\r\n    }\r\n\r\n    private updateEnable (): void {\r\n        this.sliderWrapperEl.classList.toggle('slider-wrapper--disabled', !this.isEnabled);\r\n        BB.css(this.sliderWrapperEl, {\r\n            opacity: this.isEnabled ? '' : '0.5',\r\n            pointerEvents: this.isEnabled ? '' : 'none',\r\n        });\r\n        if (this.manualInput) {\r\n            this.manualInput.setIsEnabled(this.isEnabled);\r\n        }\r\n    }\r\n\r\n    private showManualInput (): void {\r\n\r\n        this.manualInput = new KlSliderManualInput(\r\n            this.valueToDisplayValue(this.value),\r\n            this.valueToDisplayValue(this.min),\r\n            this.valueToDisplayValue(this.max),\r\n            this.sliderWrapperEl.getBoundingClientRect(),\r\n            (val) => {\r\n                val = this.displayValueToValue(val);\r\n                this.setValue(BB.clamp(val, this.min, this.max));\r\n                this.onChange(this.value);\r\n            },\r\n            () => {\r\n                BB.css(this.sliderWrapperEl, {\r\n                    display: '',\r\n                });\r\n                if (this.manualInput) {\r\n                    this.rootEl.removeChild(this.manualInput.getElement());\r\n                    this.manualInput.destroy();\r\n                }\r\n                this.manualInput = undefined;\r\n            },\r\n            (this.manualInputRoundDigits && this.manualInputRoundDigits > 0) ? this.manualInputRoundDigits : 0,\r\n        );\r\n        this.rootEl.append(this.manualInput.getElement());\r\n        setTimeout(() => {\r\n            this.manualInput && this.manualInput.focus();\r\n        });\r\n        BB.css(this.sliderWrapperEl, {\r\n            display: 'none',\r\n        });\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        p: {\r\n            label: string;\r\n            width: number; // px\r\n            height: number; // px\r\n            min: number; // min value\r\n            max: number;\r\n            value: number;\r\n            resolution?: number; // int, if you want spline.findX() to use a custom resolution\r\n            curve?: 'quadratic' | [number, number][]; // optional. array is BB.SplineInterpolator points. 0-1\r\n            formatFunc?: (val: number) => number; // function to display a different number than value\r\n            onChange?: (val: number) => void;\r\n            isChangeOnFinal?: boolean; // only fire onChange on pointerUp\r\n            eventResMs?: number; // frequency of change events\r\n            isEnabled?: boolean; // default = true\r\n            manualInputRoundDigits?: number; // default 0, how value should be rounded for manual input\r\n            toDisplayValue?: (value: number) => number;\r\n            toValue?: (displayValue: number) => number;\r\n        }\r\n    ) {\r\n        this.isEnabled = p.isEnabled !== false;\r\n        this.manualInputRoundDigits = p.manualInputRoundDigits;\r\n        this.useSpline = !!p.curve;\r\n\r\n        if (!p.label) {\r\n            throw new Error('KlSlider missing params');\r\n        }\r\n        if (p.min != 0 && p.max != 0 && p.value != 0) {\r\n            if (!p.min || !p.max || !p.value) {\r\n                throw new Error('KlSlider broken params');\r\n            }\r\n        }\r\n        if (p.min >= p.max) {\r\n            throw new Error('KlSlider broken params');\r\n        }\r\n\r\n        this.min = p.min;\r\n        this.max = p.max;\r\n        this.value = BB.clamp(p.value, this.min, this.max);\r\n        this.elementWidth = p.width;\r\n        this.elementHeight = p.height;\r\n        this.resolution = p.resolution ? p.resolution : this.elementWidth * 2;\r\n\r\n        this.onChange = p.onChange ? p.onChange : () => {};\r\n        if (!p.toValue !== !p.toDisplayValue) {\r\n            throw new Error('both or neither have to be set, toValue and toDisplayValue');\r\n        }\r\n        this.displayValueToValue = p.toValue ? p.toValue : (displayValue) => displayValue;\r\n        this.valueToDisplayValue = p.toDisplayValue ? p.toDisplayValue : (value) => value;\r\n        this.isChangeOnFinal = !!p.isChangeOnFinal;\r\n        this.formatFunc = p.formatFunc;\r\n        this.eventResMs = p.eventResMs;\r\n\r\n        if (this.useSpline) {\r\n            if (!p.curve) {\r\n                throw new Error('curve needs to be set if useSpline true');\r\n            }\r\n            const curveArr: [number, number][] = p.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : p.curve;\r\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        }\r\n\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n        this.sliderWrapperEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'slider-wrapper',\r\n            css: {\r\n                overflow: 'hidden',\r\n                position: 'relative',\r\n                width: this.elementWidth + 'px',\r\n                height: this.elementHeight + 'px',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        this.label = p.label;\r\n        const labelFontSize = this.elementHeight - 14;\r\n        this.textEl = BB.el({\r\n            content: this.label,\r\n            css: {\r\n                position: 'absolute',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginLeft: '7px',\r\n                height: '100%',\r\n                fontSize: labelFontSize + 'px',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        this.control = BB.el({\r\n            className: 'slider-inner',\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                width: (this.valueToSliderValue(this.value) * this.elementWidth) + 'px',\r\n                height: this.elementHeight + 'px',\r\n            },\r\n        });\r\n        const controlInner = document.createElement('div');\r\n\r\n        this.sliderWrapperEl.append(this.control, this.textEl);\r\n        this.control.append(controlInner);\r\n\r\n        this.updateEnable();\r\n\r\n\r\n        const doubleTapper = new BB.DoubleTapper({\r\n            onDoubleTap: () => {\r\n                this.showManualInput();\r\n            },\r\n        });\r\n        doubleTapper.setAllowedButtonArr(['left', 'right']);\r\n        const eventChain = new BB.EventChain({\r\n            chainArr: [\r\n                doubleTapper,\r\n            ],\r\n        });\r\n\r\n        let virtualVal: number;\r\n        const onPointer = (event: IPointerEvent) => {\r\n            event.eventPreventDefault();\r\n\r\n            if (!this.isEnabled) {\r\n                return;\r\n            }\r\n\r\n            if (event.type === 'pointerdown') {\r\n\r\n                // unfocus manual slider input\r\n                BB.unfocusAnyInput();\r\n\r\n                this.sliderWrapperEl.className = 'slider-wrapper slider-wrapper--active';\r\n\r\n                if (event.button === 'left') {\r\n                    let sliderValue = event.relX / this.elementWidth;\r\n                    sliderValue = Math.max(0, Math.min(1, sliderValue));\r\n                    this.value = this.sliderValueToValue(sliderValue);\r\n                    this.updateLabel();\r\n                    this.emit(false);\r\n                }\r\n                virtualVal = this.valueToSliderValue(this.value);\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button || '')) {\r\n\r\n                let deltaX = event.dX;\r\n                const deltaY = Math.abs(event.pageY - (event.downPageY || 0));\r\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n                deltaX *= factor;\r\n                deltaX /= this.elementWidth;\r\n\r\n                virtualVal += deltaX;\r\n\r\n                const sliderValue = Math.max(0, Math.min(1, virtualVal));\r\n                this.value = this.sliderValueToValue(sliderValue);\r\n                this.updateLabel();\r\n                this.emit(false);\r\n            }\r\n\r\n            if (event.type === 'pointerup') {\r\n                this.sliderWrapperEl.className = 'slider-wrapper';\r\n                this.emit(true);\r\n            }\r\n\r\n        };\r\n\r\n        this.pointerListenerTimeout = setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.sliderWrapperEl,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    onPointer(e);\r\n                    eventChain.chainIn(e);\r\n                },\r\n                onWheel: (event) => {\r\n                    let sliderValue = this.valueToSliderValue(this.value);\r\n                    sliderValue = BB.clamp(sliderValue - event.deltaY / 40, 0, 1);\r\n                    this.value = this.sliderValueToValue(sliderValue);\r\n                    this.updateLabel();\r\n                    this.onChange(this.value);\r\n                },\r\n            });\r\n            this.updateLabel();\r\n        }, 1);\r\n    }\r\n\r\n    changeSliderValue (f: number): void {\r\n        if (!this.isEnabled) {\r\n            return;\r\n        }\r\n        let sliderValue = this.valueToSliderValue(this.value);\r\n        sliderValue = BB.clamp(sliderValue + f, 0, 1);\r\n        this.value = this.sliderValueToValue(sliderValue);\r\n        this.updateLabel();\r\n        this.onChange(this.value);\r\n    }\r\n\r\n    setValue (v: number): void {\r\n        this.value = BB.clamp(v, this.min, this.max);\r\n        this.updateLabel();\r\n    }\r\n\r\n    getValue (): number {\r\n        return this.value;\r\n    }\r\n\r\n    update (config: IKlSliderConfig): void {\r\n        this.min = config.min;\r\n        this.max = config.max;\r\n        this.useSpline = !!config.curve;\r\n        if (this.useSpline) {\r\n            if (!config.curve) {\r\n                throw new Error('curve needs to be set if useSpline true');\r\n            }\r\n            const curveArr = config.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : config.curve;\r\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        } else {\r\n            this.splineInterpolator = undefined;\r\n        }\r\n        this.setIsEnabled(!config.isDisabled);\r\n    }\r\n\r\n    setIsEnabled (e: boolean): void {\r\n        this.isEnabled = !!e;\r\n        this.updateEnable();\r\n    }\r\n\r\n    destroy (): void {\r\n        clearTimeout(this.pointerListenerTimeout);\r\n        this.pointerListener && this.pointerListener.destroy();\r\n        if (this.manualInput) {\r\n            this.manualInput.destroy();\r\n        }\r\n        if (this.emitInterval) {\r\n            clearInterval(this.emitInterval);\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n}\r\n","/**\r\n * To make sliders more fine-grained. The falloff when moving cursor away from cursor.\r\n * Returns the factor [0,1]\r\n *  0 -> infinite movement required for change of 1\r\n *  1 -> 1px movement for change of 1\r\n *\r\n * @param deltaY vertical distance from pointerdown\r\n * @param isRightButton\r\n */\r\nexport function calcSliderFalloffFactor (deltaY: number, isRightButton: boolean): number {\r\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\r\n    if (isRightButton) {\r\n        result *= 2;\r\n    }\r\n    return 1 / result;\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {input} from './input';\r\n\r\n/**\r\n * Used by KlSlider. Allows user to type in value in input (type=number) field, instead of dragging with mouse.\r\n * Input goes away when losing focus, or when pressing Enter/Escape.\r\n */\r\nexport class KlSliderManualInput {\r\n\r\n    private readonly input: HTMLInputElement;\r\n    private isEnabled: boolean;\r\n    private scrollBefore: { x: number; y: number }; // window scroll position on creation\r\n    private lastValue: number; // last emitted value\r\n    private isClosed: boolean = false;\r\n\r\n    private emit (): void {\r\n        if (this.lastValue !== Number(this.input.value)) {\r\n            this.onChange(Number(this.input.value));\r\n            this.lastValue = Number(this.input.value);\r\n        }\r\n    }\r\n\r\n    private privateOnClose (): void {\r\n        if (this.isClosed) {\r\n            return;\r\n        }\r\n        this.isClosed = true;\r\n\r\n        this.emit();\r\n        this.onClose();\r\n        setTimeout(() => {\r\n            // because iPad keyboard changes the scroll position\r\n            window.scrollTo(this.scrollBefore.x, this.scrollBefore.y);\r\n            this.scrollBefore = null;\r\n        });\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        value: number, // initial value (displayValue)\r\n        min: number,\r\n        max: number,\r\n        rect: DOMRect, // size of input field\r\n        private onChange: (displayValue: number) => void,\r\n        private onClose: () => void,\r\n        roundDigits?: number,\r\n    ) {\r\n\r\n        this.input = input({\r\n            type: 'number',\r\n            init: value,\r\n            min,\r\n            max,\r\n            callback: (val) => {\r\n                this.emit();\r\n            },\r\n        });\r\n        if (roundDigits !== 0) {\r\n            this.input.setAttribute('step', 'any');\r\n        }\r\n        this.input.onblur = () => {\r\n            this.privateOnClose();\r\n        };\r\n        this.input.addEventListener('keyup', (e) => {\r\n            if (['Enter', 'Escape'].includes(e.key)) {\r\n                this.privateOnClose();\r\n            } else {\r\n                this.emit();\r\n            }\r\n        });\r\n        this.input.addEventListener('wheel', () => this.emit());\r\n\r\n        this.scrollBefore = {\r\n            x: window.scrollX,\r\n            y: window.scrollY,\r\n        };\r\n\r\n        let currentValue;\r\n        if (roundDigits || roundDigits === 0) {\r\n            currentValue = BB.round(value, roundDigits);\r\n        } else {\r\n            currentValue = value;\r\n        }\r\n        this.lastValue = currentValue;\r\n        this.input.value = '' + currentValue;\r\n\r\n        BB.css(this.input, {\r\n            width: rect.width + 'px',\r\n            height: rect.height + 'px',\r\n        });\r\n    }\r\n\r\n    getElement () {\r\n        return this.input;\r\n    }\r\n\r\n    setIsEnabled (b: boolean): void {\r\n        this.isEnabled = !!b;\r\n    }\r\n\r\n    focus (): void {\r\n        this.input.focus();\r\n        this.input.select();\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.input);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {input} from '../components/input';\r\nimport {showModal} from './base/showModal';\r\nimport {LANG} from '../../../language/language';\r\nimport copyImg from '/src/app/img/ui/copy.svg';\r\nimport {IRGB} from '../../kl-types';\r\nimport {RGB} from '../../../bb/color/color';\r\n\r\n\r\ntype TInputRow = {\r\n    update: () => void;\r\n    destroy: () => void;\r\n};\r\n\r\n/**\r\n * dialog for manually inputting the color\r\n */\r\nexport class HexColorDialog {\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            color: IRGB;\r\n            onClose: (rgb: IRGB | null) => void;\r\n        }\r\n    ) {\r\n        let lastValidRgb: RGB = new BB.RGB(p.color.r, p.color.g, p.color.b);\r\n\r\n        const div = BB.el();\r\n\r\n        const previewEl = BB.el({\r\n            css: {\r\n                width: '20px',\r\n                height: '20px',\r\n                marginBottom: '10px',\r\n                boxShadow: 'inset 0 0 0 1px #fff, 0 0 0 1px #000',\r\n                background: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n            },\r\n        });\r\n        div.append(previewEl);\r\n\r\n\r\n        // --- Hex ---\r\n        const hexRowEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginBottom: '15px',\r\n            },\r\n        });\r\n        const hexLabel = BB.el({\r\n            content: LANG('mci-hex'),\r\n            css: {\r\n                width: '60px',\r\n            },\r\n        });\r\n        const hexInput = input({\r\n            init: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n            css: {\r\n                width: '80px',\r\n            },\r\n            callback: function () {\r\n                let rgbObj = BB.ColorConverter.hexToRGB(hexInput.value);\r\n                if (rgbObj === null) {\r\n                    rgbObj = lastValidRgb;\r\n                    hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                } else {\r\n                    lastValidRgb = rgbObj;\r\n                }\r\n                previewEl.style.background = '#' + BB.ColorConverter.toHexString(rgbObj);\r\n\r\n                for (let i = 0; i < rgbArr.length; i++) {\r\n                    rgbArr[i].update();\r\n                }\r\n            },\r\n        });\r\n        const copyButton = BB.el({\r\n            tagName: 'button',\r\n            content: '<img src=\"' + copyImg + '\" height=\"20\"/>',\r\n            title: LANG('mci-copy'),\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: function () {\r\n                hexInput.select();\r\n                document.execCommand('copy');\r\n            },\r\n        });\r\n        hexRowEl.append(hexLabel, hexInput, copyButton);\r\n        div.append(hexRowEl);\r\n        setTimeout(function () {\r\n            hexInput.focus();\r\n            hexInput.select();\r\n        }, 0);\r\n\r\n\r\n        // --- R G B ---\r\n        function createRgbInputRow (labelStr: string, attributeStr: 'r' | 'g' | 'b'): TInputRow {\r\n\r\n            const rowEl = BB.el({\r\n                css: {\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    marginTop: '5px',\r\n                },\r\n            });\r\n            const labelEl = BB.el({\r\n                content: labelStr,\r\n                css: {\r\n                    width: '60px',\r\n                },\r\n            });\r\n\r\n            const inputEl = input({\r\n                init: lastValidRgb[attributeStr],\r\n                min: 0,\r\n                max: 255,\r\n                type: 'number',\r\n                css: {\r\n                    width: '80px',\r\n                },\r\n                callback: function () {\r\n                    if (inputEl.value === '' || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\r\n                        result.update();\r\n                        return;\r\n                    }\r\n                    inputEl.value = '' + Math.round(parseFloat(inputEl.value));\r\n                    lastValidRgb[attributeStr] = Number(inputEl.value);\r\n                    previewEl.style.background = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                    hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                },\r\n            });\r\n\r\n            rowEl.append(labelEl, inputEl);\r\n            div.append(rowEl);\r\n\r\n            const result = {\r\n                update: () => {\r\n                    inputEl.value = '' + lastValidRgb[attributeStr];\r\n                },\r\n                destroy: () => {\r\n                    inputEl.onchange = null;\r\n                },\r\n            };\r\n            return result;\r\n        }\r\n        const rgbArr: TInputRow[] = [];\r\n        rgbArr.push(createRgbInputRow(LANG('red'), 'r'));\r\n        rgbArr.push(createRgbInputRow(LANG('green'), 'g'));\r\n        rgbArr.push(createRgbInputRow(LANG('blue'), 'b'));\r\n\r\n\r\n        showModal({\r\n            target: document.body,\r\n            message: `<b>${LANG('manual-color-input')}</b>`,\r\n            div: div,\r\n            autoFocus: false,\r\n            clickOnEnter: 'Ok',\r\n            buttons: ['Ok', 'Cancel'],\r\n            callback: function (resultStr) {\r\n                BB.destroyEl(copyButton);\r\n                rgbArr.forEach(item => item.destroy());\r\n                rgbArr.splice(0, rgbArr.length);\r\n\r\n                p.onClose(resultStr === 'Ok' ? BB.ColorConverter.hexToRGB(hexInput.value) : null);\r\n            },\r\n        });\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"htADd\");","import {BB} from '../../../bb/bb';\r\nimport {HexColorDialog} from '../modals/color-slider-hex-dialog';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport eyedropperImg from '/src/app/img/ui/tool-picker.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {IRGB} from '../../kl-types';\r\nimport {HSV, RGB} from '../../../bb/color/color';\r\nimport {ERASE_COLOR} from '../../brushes/erase-color';\r\n\r\n/**\r\n * big main HS+V color slider\r\n * 2 elements: slider, and colorpreview(output) + eyedropper\r\n */\r\nexport class KlColorSlider {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly outputDiv: HTMLElement;\r\n    private readonly divPreview: HTMLElement;\r\n    private readonly hexButton: HTMLElement;\r\n    private readonly secondaryColorBtn: HTMLElement;\r\n    private primaryColorRGB: RGB;\r\n    private primaryColorHSV: HSV;\r\n    private secondaryColorRGB: RGB;\r\n    private secondaryColorHSV: HSV;\r\n    private readonly controlH: HTMLElement;\r\n    private pickCallback: undefined | ((b: boolean) => void);\r\n    private isPicking: boolean;\r\n    private readonly pickerButton: HTMLElement;\r\n    private readonly width: number;\r\n    private readonly height: number; // hue slider and output height\r\n    private readonly hueStop: Element;\r\n\r\n    private readonly SVContainer: HTMLElement;\r\n    private readonly pointerSV: HTMLElement;\r\n    private svHeight: number;\r\n    private readonly svSvg: HTMLElement;\r\n\r\n    private readonly emitColor: (rgb: RGB) => void;\r\n\r\n\r\n\r\n    private updatePrimaryHSV (hsv: HSV): void {\r\n        if (hsv.s === 0) {\r\n            this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, hsv.s, hsv.v);\r\n        } else {\r\n            this.primaryColorHSV = new BB.HSV(hsv.h, hsv.s, hsv.v);\r\n        }\r\n    }\r\n\r\n    private updateSVCanvas (): void {\r\n        const rgb = BB.ColorConverter.toRGB(new BB.HSV(this.primaryColorHSV.h, 100, 100));\r\n        BB.setAttributes(this.hueStop, {\r\n            'stop-color': '#' + BB.ColorConverter.toHexString(rgb),\r\n        });\r\n    }\r\n\r\n    private updateSVPointer (): void {\r\n        const left = this.primaryColorHSV.s / 100 * this.width - 7;\r\n        const top = (1 - this.primaryColorHSV.v / 100) * this.svHeight - 6;\r\n        BB.css(this.pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px',\r\n        });\r\n    }\r\n\r\n    private setColPreview (): void {\r\n        this.divPreview.style.backgroundColor = 'rgb(' + this.primaryColorRGB.r + ',' + this.primaryColorRGB.g + ',' + this.primaryColorRGB.b + ')';\r\n\r\n        if (BB.testIsWhiteBestContrast(this.primaryColorRGB)) {\r\n            BB.css(this.pickerButton, {\r\n                filter: 'invert(1)',\r\n            });\r\n            BB.css(this.hexButton, {\r\n                filter: 'invert(1)',\r\n            });\r\n        } else{\r\n            BB.css(this.pickerButton, {\r\n                filter: '',\r\n            });\r\n            BB.css(this.hexButton, {\r\n                filter: '',\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    private updateSecondaryColor (): void {\r\n        this.secondaryColorBtn.style.backgroundColor = BB.ColorConverter.toRgbStr(this.secondaryColorRGB);\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number; // hue slider and output height\r\n            svHeight: number;\r\n            startValue: IRGB; // 0-255\r\n            onPick: (rgb: IRGB) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-color-picker',\r\n            css: {\r\n                position: 'relative',\r\n            },\r\n        });\r\n        this.outputDiv = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        this.width = p.width;\r\n        this.svHeight = p.svHeight;\r\n        this.height = p.height;\r\n        this.emitColor = p.onPick;\r\n\r\n        this.primaryColorRGB = {\r\n            r: parseInt('' + p.startValue.r),\r\n            g: parseInt('' + p.startValue.g),\r\n            b: parseInt('' + p.startValue.b),\r\n        };\r\n        this.primaryColorHSV = BB.ColorConverter.toHSV(p.startValue); // BB.HSV\r\n        this.secondaryColorRGB = {r: ERASE_COLOR, g: ERASE_COLOR, b: ERASE_COLOR};\r\n        this.secondaryColorHSV = BB.ColorConverter._RGBtoHSV(this.secondaryColorRGB); // BB.HSV\r\n\r\n        const svWrapper = BB.el();\r\n        this.svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"><defs><linearGradient id=\"value\" gradientTransform=\"rotate(90)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop offset=\"100%\" stop-color=\"#000\"/></linearGradient><linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/></linearGradient></defs><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\" style=\"mix-blend-mode: multiply\"/></svg>', 'image/svg+xml').documentElement;\r\n        {\r\n            const hueStop = this.svSvg.querySelector('#hue-stop');\r\n            if (!hueStop) {\r\n                throw Error('#hue-stop not found in svSvg');\r\n            }\r\n            this.hueStop = hueStop;\r\n        }\r\n        BB.setAttributes(this.hueStop, {\r\n            'stop-color': '#f0f',\r\n        });\r\n        BB.css(this.svSvg, {\r\n            width: this.width + 'px',\r\n            height: this.svHeight + 'px',\r\n        });\r\n        svWrapper.append(this.svSvg);\r\n\r\n        const divH = BB.el({\r\n            className: 'kl-color-picker__h',\r\n            css: {\r\n                overflow: 'hidden',\r\n                position: 'relative',\r\n                width: this.width + 'px',\r\n                height: this.height + 'px',\r\n                cursor: 'ew-resize',\r\n                marginTop: '1px',\r\n                marginBottom: '1px',\r\n            },\r\n        });\r\n        this.divPreview = BB.el({\r\n            className: 'kl-color-picker__preview',\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                width: (this.height * 2.5) + 'px',\r\n                height: this.height + 'px',\r\n            },\r\n        });\r\n        this.controlH = BB.el();\r\n\r\n\r\n\r\n        const createHueBg = (targetEl: HTMLElement) => {\r\n            const im = new Image();\r\n            BB.css(im, {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                display: 'none',\r\n                pointerEvents: 'none',\r\n            });\r\n            const cv = BB.canvas(this.width, this.height);\r\n            const ctx = BB.ctx(cv);\r\n            const gradH = ctx.createLinearGradient(0, 0, this.width, 0);\r\n            for (let i = 0; i < 1; i += 0.01) {\r\n                const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n                let ha = (parseInt('' + col.r)).toString(16);\r\n                let hb = (parseInt('' + col.g)).toString(16);\r\n                let hc = (parseInt('' + col.b)).toString(16);\r\n                if (ha.length === 1) {\r\n                    ha = '0' + ha;\r\n                }\r\n                if (hb.length === 1) {\r\n                    hb = '0' + hb;\r\n                }\r\n                if (hc.length === 1) {\r\n                    hc = '0' + hc;\r\n                }\r\n                gradH.addColorStop(i, '#' + ha + hb + hc);\r\n            }\r\n            ctx.fillStyle = gradH;\r\n            ctx.fillRect(0, 0, this.width, this.height);\r\n\r\n            targetEl.append(im);\r\n            im.alt = 'hue';\r\n            im.src = cv.toDataURL('image/png');\r\n            im.style.display = 'block';\r\n        };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        this.updateSVCanvas();\r\n        this.rootEl.style.width = this.width + 'px';\r\n        this.rootEl.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n\r\n        this.SVContainer = BB.el({\r\n            className: 'kl-color-picker__sv',\r\n            css: {\r\n                width: this.width + 'px',\r\n                height: this.svHeight + 'px',\r\n                overflow: 'hidden',\r\n                display: 'block',\r\n                position: 'relative',\r\n                cursor: 'crosshair',\r\n            },\r\n        });\r\n\r\n        this.pointerSV = BB.el({\r\n           css: {\r\n               width: '12px',\r\n               height: '12px',\r\n               borderRadius: '6px',\r\n               position: 'absolute',\r\n               pointerEvents: 'none',\r\n               boxShadow: '0px 0px 0 1px #000, inset 0px 0px 0 1px #fff',\r\n           },\r\n        });\r\n\r\n        this.SVContainer.append(svWrapper, this.pointerSV);\r\n        this.updateSVPointer();\r\n        this.rootEl.append(this.SVContainer, divH);\r\n        this.outputDiv.append(this.divPreview);\r\n\r\n        //divH.className = \"svSlider\";\r\n        BB.css(this.controlH, {\r\n            width: '1px',\r\n            height: this.height + 'px',\r\n            background: '#000',\r\n            borderLeft: '1px solid #fff',\r\n            position: 'absolute',\r\n            top: '0',\r\n            left: parseInt('' + (this.primaryColorHSV.h / 360 * this.width - 1)) + 'px',\r\n        });\r\n\r\n\r\n        const virtualHSV = {\r\n            h: 0,\r\n            s: 0,\r\n            v: 0,\r\n        };\r\n\r\n\r\n        this.pickerButton = BB.el({\r\n            title: LANG('eyedropper') + ' [Alt]',\r\n            className: 'color-picker-preview-button',\r\n            css: {\r\n                width: '30px',\r\n                height: '30px',\r\n                backgroundImage: 'url(' + eyedropperImg + ')',\r\n                backgroundRepeat:  'no-repeat',\r\n                backgroundSize: '70%',\r\n                backgroundPosition: 'center',\r\n            },\r\n            onClick: () => {\r\n                if (this.isPicking) {\r\n                    this.pickCallback && this.pickCallback(false);\r\n                    this.pickingDone();\r\n                } else {\r\n                    this.pickerButton.classList.remove('color-picker-preview-button-hover');\r\n                    this.pickerButton.classList.add('color-picker-preview-button-active');\r\n                    this.isPicking = true;\r\n                    this.pickCallback && this.pickCallback(true);\r\n                }\r\n            },\r\n        });\r\n        this.isPicking = false;\r\n\r\n        const pickerButtonPointerListener = new BB.PointerListener({\r\n            target: this.pickerButton,\r\n            onEnterLeave: (isOver) => {\r\n                if (this.isPicking) {\r\n                    return;\r\n                }\r\n                this.pickerButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n            },\r\n        });\r\n        this.divPreview.append(this.pickerButton);\r\n\r\n\r\n        this.hexButton = BB.el({\r\n            content: '#',\r\n            className: 'color-picker-preview-button',\r\n            title: LANG('manual-color-input'),\r\n            css: {\r\n                height: '100%',\r\n                width: this.height + 'px',\r\n                lineHeight: this.height + 'px',\r\n                fontSize: (this.height * 0.65) + 'px',\r\n            },\r\n            onClick: () => {\r\n                new HexColorDialog({\r\n                    color: new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b),\r\n                    onClose: (rgbObj) => {\r\n                        if (!rgbObj) {\r\n                            return;\r\n                        }\r\n                        this.setColor(rgbObj);\r\n                        this.emitColor(new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b));\r\n                    },\r\n                });\r\n            },\r\n        });\r\n        const hexButtonPointerListener = new BB.PointerListener({\r\n            target: this.hexButton,\r\n            onEnterLeave: (isOver) => {\r\n                this.hexButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n            },\r\n        });\r\n        this.divPreview.append(this.hexButton);\r\n\r\n        this.setColPreview();\r\n\r\n\r\n        setTimeout(() => {\r\n            createHueBg(divH);\r\n            divH.append(this.controlH);\r\n            const svPointerListener = new BB.PointerListener({\r\n                target: svWrapper,\r\n                fixScribble: true,\r\n                onPointer: (event) => {\r\n                    if (event.type === 'pointerdown') {\r\n\r\n                        // prevent manual slider input keeping focus on iPad\r\n                        BB.unfocusAnyInput();\r\n\r\n                        this.SVContainer.classList.toggle('kl-color-picker--active', true);\r\n\r\n                        if (event.button === 'left') {\r\n\r\n                            virtualHSV.s = event.relX / this.width * 100;\r\n                            virtualHSV.v = 100 - event.relY / this.svHeight * 100;\r\n\r\n                            this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                            this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n\r\n                            this.updateSVPointer();\r\n                            this.setColPreview();\r\n                            this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n                        } else {\r\n                            virtualHSV.s = this.primaryColorHSV.s;\r\n                            virtualHSV.v = this.primaryColorHSV.v;\r\n                        }\r\n                    }\r\n\r\n                    if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                        let factor = 1;\r\n                        if (event.button === 'right') {\r\n                            factor = 0.5;\r\n                        }\r\n\r\n                        virtualHSV.s += event.dX / this.width * 100 * factor;\r\n                        virtualHSV.v -= event.dY / this.svHeight * 100 * factor;\r\n\r\n                        this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                        this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n                        this.updateSVPointer();\r\n                        this.setColPreview();\r\n                        this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n\r\n                    }\r\n\r\n                    if (event.type === 'pointerup') {\r\n                        this.SVContainer.classList.toggle('kl-color-picker--active', false);\r\n                    }\r\n\r\n                },\r\n            });\r\n            const hPointerListener = new BB.PointerListener({\r\n                target: divH,\r\n                fixScribble: true,\r\n                onPointer: (event) => {\r\n\r\n                    if (event.type === 'pointerdown') {\r\n\r\n                        // prevent manual slider input keeping focus on iPad\r\n                        BB.unfocusAnyInput();\r\n\r\n                        divH.classList.toggle('kl-color-picker--active', true);\r\n\r\n                        if (event.button === 'left') {\r\n\r\n                            virtualHSV.h = event.relX / this.width * 359.99;\r\n\r\n                            this.primaryColorHSV = new BB.HSV(virtualHSV.h, this.primaryColorHSV.s, this.primaryColorHSV.v);\r\n                            this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n                            this.controlH.style.left = (Math.round(this.primaryColorHSV.h / 359.99 * this.width) - 1) + 'px';\r\n                            this.updateSVCanvas();\r\n                            this.setColPreview();\r\n                            this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n                        } else {\r\n                            virtualHSV.h = this.primaryColorHSV.h;\r\n                        }\r\n                    }\r\n\r\n                    if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                        const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                        const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                        virtualHSV.h += event.dX / this.width * 359.99 * factor;\r\n\r\n                        if (event.button === 'right') {\r\n                            virtualHSV.h = virtualHSV.h % 359.99;\r\n                            if (virtualHSV.h < 0) {\r\n                                virtualHSV.h += 359.99;\r\n                            }\r\n                        }\r\n                        virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                        this.primaryColorHSV = new BB.HSV(virtualHSV.h, this.primaryColorHSV.s, this.primaryColorHSV.v);\r\n                        this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n                        this.controlH.style.left = (Math.round(this.primaryColorHSV.h / 359.99 * this.width) - 1) + 'px';\r\n                        this.updateSVCanvas();\r\n                        this.setColPreview();\r\n                        this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n\r\n                    }\r\n\r\n                    if (event.type === 'pointerup') {\r\n                        divH.classList.toggle('kl-color-picker--active', false);\r\n                    }\r\n                },\r\n            });\r\n        }, 1);\r\n\r\n\r\n        // --- secondary color ---\r\n\r\n        this.secondaryColorBtn = BB.el({\r\n            parent: this.outputDiv,\r\n            title: LANG('secondary-color') + ' [X]',\r\n            className: 'kl-color-picker__secondary',\r\n            css: {\r\n                cursor: 'pointer',\r\n                marginLeft: '5px',\r\n                width: '22px',\r\n                height: '22px',\r\n            },\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                this.swapColors();\r\n            },\r\n        });\r\n        this.updateSecondaryColor();\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.primaryColorRGB = {r: parseInt('' + c.r), g: parseInt('' + c.g), b: parseInt('' + c.b)};\r\n        this.updatePrimaryHSV(BB.ColorConverter.toHSV(c));\r\n        this.controlH.style.left = parseInt('' + (this.primaryColorHSV.h / 359 * this.width - 1)) + 'px';\r\n        this.updateSVCanvas();\r\n        this.updateSVPointer();\r\n        this.setColPreview();\r\n    }\r\n\r\n    getColor (): RGB {\r\n        return new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b);\r\n    }\r\n\r\n    getSecondaryRGB (): RGB {\r\n        return new BB.RGB(this.secondaryColorRGB.r, this.secondaryColorRGB.g, this.secondaryColorRGB.b);\r\n    }\r\n\r\n    setPickCallback (func: (b: boolean) => void): void {\r\n        this.pickCallback = func;\r\n    }\r\n\r\n    pickingDone (): void {\r\n        if (!this.isPicking) {\r\n            return;\r\n        }\r\n        this.isPicking = false;\r\n        this.pickerButton.classList.remove('color-picker-preview-button-active');\r\n    }\r\n\r\n    enable (e: boolean): void {\r\n        if (e) {\r\n            this.rootEl.style.pointerEvents = '';\r\n            this.rootEl.style.opacity = '1';\r\n            this.outputDiv.style.pointerEvents = '';\r\n            this.outputDiv.style.opacity = '1';\r\n        } else {\r\n            this.rootEl.style.pointerEvents = 'none';\r\n            this.rootEl.style.opacity = '0.5';\r\n            this.outputDiv.style.pointerEvents = 'none';\r\n            this.outputDiv.style.opacity = '0.5';\r\n        }\r\n    }\r\n\r\n    setHeight (h: number): void {\r\n        h = parseInt('' +(h - this.height * 2 - 3), 10);\r\n        if (h === this.svHeight) {\r\n            return;\r\n        }\r\n        this.svHeight = h;\r\n        BB.css(this.svSvg, {\r\n            width: this.width + 'px',\r\n            height: this.svHeight + 'px',\r\n        });\r\n        this.SVContainer.style.height = this.svHeight + 'px';\r\n        this.updateSVPointer();\r\n    }\r\n\r\n    swapColors (): void {\r\n        // swap hsv\r\n        let tmp: RGB | HSV = this.secondaryColorHSV;\r\n        this.secondaryColorHSV = this.primaryColorHSV;\r\n        this.updatePrimaryHSV(tmp);\r\n        // swap rgb\r\n        tmp = this.secondaryColorRGB;\r\n        this.secondaryColorRGB = this.primaryColorRGB;\r\n        this.primaryColorRGB = tmp;\r\n\r\n        this.controlH.style.left = parseInt('' + (this.primaryColorHSV.h / 359 * this.width - 1)) + 'px';\r\n        this.updateSVCanvas();\r\n        this.updateSVPointer();\r\n        this.setColPreview();\r\n        this.updateSecondaryColor();\r\n\r\n        this.emitColor(new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b));\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getOutputElement (): HTMLElement {\r\n        return this.outputDiv;\r\n    }\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ffKNP\");","import {theme} from '../../theme/theme';\r\n\r\nexport const ERASE_COLOR = theme.isDark() ? 255 : 255;","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport {IRGB} from '../../kl-types';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {HSV} from '../../../bb/color/color';\r\n\r\n/**\r\n * a small color slider\r\n */\r\nexport class KlColorSliderSmall {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private color: HSV;\r\n    private readonly svPointerListener: PointerListener;\r\n    private readonly hPointerListener: PointerListener;\r\n    private svPointerId: number | null;\r\n    private hPointerId: number | null;\r\n    private readonly width: number;\r\n    private readonly heightSV: number;\r\n    private readonly pointerSV: HTMLElement;\r\n    private readonly pointerH: HTMLElement;\r\n    private readonly canvasSV: HTMLCanvasElement;\r\n\r\n\r\n    private updateSV (): void {\r\n        const ctx = BB.ctx(this.canvasSV);\r\n        if(!ctx) {\r\n            throw new Error('couldnt create canvas');\r\n        }\r\n        for (let i = 0; i < this.canvasSV.height; i += 1) {\r\n            const gradient1 = ctx.createLinearGradient(0, 0, this.canvasSV.width, 0);\r\n\r\n            const colleft = BB.ColorConverter.toRGB(new BB.HSV(this.color.h, 1, 100 - (i / this.canvasSV.height * 100.0)));\r\n            const colright = BB.ColorConverter.toRGB(new BB.HSV(this.color.h, 100, 100 - (i / this.canvasSV.height * 100.0)));\r\n            gradient1.addColorStop(0, '#' + BB.ColorConverter.toHexString(colleft));\r\n            gradient1.addColorStop(1, '#' + BB.ColorConverter.toHexString(colright));\r\n            ctx.fillStyle = '#ff0000'; //needed for chrome...otherwise alpha problem\r\n            ctx.fillStyle = gradient1;\r\n            ctx.fillRect(0, i, this.canvasSV.width, 1);\r\n        }\r\n    }\r\n\r\n    private updateSVPointer (): void {\r\n        const left = this.color.s / 100 * this.width - 4;\r\n        const top = (1 - this.color.v / 100) * this.heightSV - 4;\r\n        BB.css(this.pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px',\r\n        });\r\n    }\r\n\r\n    private updateHPointer (): void {\r\n        this.pointerH.style.left = (this.color.h / 359.999 * this.width - 1) + 'px';\r\n    }\r\n\r\n\r\n\r\n\r\n    // ----- public ----\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            heightSV: number; // height of saturation/value\r\n            heightH: number; // height of hue\r\n            color: IRGB;\r\n            callback: (c: IRGB) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                width: p.width + 'px',\r\n                position: 'relative',\r\n                overflow: 'hidden',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = (e) => {\r\n            e.preventDefault();\r\n        };\r\n        this.color = BB.ColorConverter.toHSV(new BB.RGB(p.color.r, p.color.g, p.color.b));\r\n        this.width = p.width;\r\n        this.heightSV = p.heightSV;\r\n\r\n        this.canvasSV = BB.canvas(10, 10);\r\n        BB.css(this.canvasSV, {\r\n            width: this.width + 'px',\r\n            height: this.heightSV + 'px',\r\n            cursor: 'crosshair',\r\n        });\r\n\r\n\r\n        this.updateSV();\r\n\r\n        const canvasH = BB.canvas(p.width, p.heightH);\r\n        canvasH.style.cursor = 'ew-resize';\r\n        (() => {\r\n            const ctx = BB.ctx(canvasH);\r\n\r\n            const gradH = ctx.createLinearGradient(0, 0, p.width, 0);\r\n            for (let i = 0; i < 1; i += 0.01) {\r\n                const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n                gradH.addColorStop(i, 'rgba(' + parseInt('' + col.r) + ', ' + parseInt('' + col.g) + ', ' + parseInt('' + col.b) + ', 1)');\r\n            }\r\n            ctx.fillStyle = gradH;\r\n            ctx.fillRect(0, 0, p.width, p.heightH);\r\n\r\n        })();\r\n        BB.css(this.canvasSV, {\r\n            width: p.width + 'px',\r\n            height: p.heightSV + 'px',\r\n            overflow: 'hidden',\r\n            position: 'relative',\r\n        });\r\n        this.canvasSV.style.cssFloat = 'left';\r\n        canvasH.style.cssFloat = 'left';\r\n\r\n        this.rootEl.append(this.canvasSV, canvasH);\r\n\r\n        this.pointerSV = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                width: '8px',\r\n                height: '8px',\r\n                borderRadius: '8px',\r\n                position: 'absolute',\r\n                pointerEvents: 'none',\r\n                boxShadow: '0 0 0 1px #000, inset 0 0 0 1px #fff',\r\n            },\r\n        });\r\n\r\n        this.pointerH = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                width: '0',\r\n                height: p.heightH + 'px',\r\n                borderLeft: '1px solid #fff',\r\n                borderRight: '1px solid #000',\r\n                position: 'absolute',\r\n                top: p.heightSV + 'px',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n\r\n        this.updateSVPointer();\r\n        this.updateHPointer();\r\n\r\n        const virtualHSV = {\r\n            h: 0,\r\n            s: 0,\r\n            v: 0,\r\n        };\r\n\r\n        this.svPointerId = null;\r\n        this.svPointerListener = new BB.PointerListener({\r\n            target: this.canvasSV,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n\r\n                if (event.type === 'pointerdown') {\r\n\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    BB.unfocusAnyInput();\r\n\r\n                    this.svPointerId = event.pointerId;\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.s = event.relX / p.width * 100;\r\n                        virtualHSV.v = 100 - event.relY / p.heightSV * 100;\r\n\r\n                        this.color = new BB.HSV(this.color.h, virtualHSV.s, virtualHSV.v);\r\n\r\n                        this.updateSVPointer();\r\n                        p.callback(BB.ColorConverter.toRGB(this.color));\r\n                    } else {\r\n                        virtualHSV.s = this.color.s;\r\n                        virtualHSV.v = this.color.v;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes('' + event.button) && this.svPointerId === event.pointerId) {\r\n\r\n                    let factor = 1;\r\n                    if (event.button === 'right') {\r\n                        factor = 0.5;\r\n                    }\r\n\r\n                    virtualHSV.s += event.dX / p.width * 100 * factor;\r\n                    virtualHSV.v -= event.dY / p.heightSV * 100 * factor;\r\n\r\n                    this.color = new BB.HSV(this.color.h, virtualHSV.s, virtualHSV.v);\r\n                    this.updateSVPointer();\r\n                    p.callback(BB.ColorConverter.toRGB(this.color));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.svPointerId = null;\r\n                }\r\n\r\n            },\r\n        });\r\n\r\n        this.hPointerId = null;\r\n        this.hPointerListener = new BB.PointerListener({\r\n            target: canvasH,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n\r\n                if (event.type === 'pointerdown') {\r\n                    this.hPointerId = event.pointerId;\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.h = event.relX / p.width * 359.99;\r\n\r\n                        this.color = new BB.HSV(virtualHSV.h, this.color.s, this.color.v);\r\n                        this.updateSV();\r\n                        this.updateHPointer();\r\n                        p.callback(BB.ColorConverter.toRGB(this.color));\r\n                    } else {\r\n                        virtualHSV.h = this.color.h;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes('' + event.button) && this.hPointerId === event.pointerId) {\r\n\r\n                    const deltaY = Math.abs(event.pageY - event.downPageY!);\r\n                    const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                    virtualHSV.h += event.dX / p.width * 359.99 * factor;\r\n\r\n                    if (event.button === 'right') {\r\n                        virtualHSV.h = virtualHSV.h % 359.99;\r\n                        if (virtualHSV.h < 0) {\r\n                            virtualHSV.h += 359.99;\r\n                        }\r\n                    }\r\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                    this.color = new BB.HSV(virtualHSV.h, this.color.s, this.color.v);\r\n                    this.updateSV();\r\n                    this.updateHPointer();\r\n                    p.callback(BB.ColorConverter.toRGB(this.color));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.hPointerId = null;\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n        const cleardiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                clear: 'both',\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n    setColor (c: IRGB): void {\r\n        this.color = BB.ColorConverter.toHSV(new BB.RGB(c.r, c.g, c.b));\r\n        this.updateSV();\r\n        this.updateSVPointer();\r\n        this.updateHPointer();\r\n    }\r\n\r\n    getColor (): IRGB {\r\n        return BB.ColorConverter.toRGB(this.color);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.svPointerListener.destroy();\r\n        this.hPointerListener.destroy();\r\n    }\r\n\r\n    end (): void {\r\n        this.svPointerId = null;\r\n        this.hPointerId = null;\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n/**\r\n * A slider that looks like this\r\n * ------O----\r\n */\r\nexport class PointSlider {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly sliderPoint: HTMLElement;\r\n    private readonly pointerListener: PointerListener;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            init: number;\r\n            width: number;\r\n            pointSize: number;\r\n            callback: (value: number, isFirst: boolean, isLast: boolean) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n            },\r\n        });\r\n        const sliderLine = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-point-slider__line',\r\n            css: {\r\n                marginTop: parseInt('' + (p.pointSize / 2 - 1)) + 'px',\r\n                width: p.width + 'px',\r\n            },\r\n        });\r\n        this.sliderPoint = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-point-slider__point',\r\n        });\r\n        let sliderPos: number;\r\n        let isDragging = false;\r\n\r\n        //sliderPoint\r\n        const touchAreaEl = BB.el({ // expand clickable area\r\n            parent: this.sliderPoint,\r\n            css: {\r\n                // background: 'rgba(255,0,0,0.4)',\r\n                margin: '-7px 0 0 -7px',\r\n                width: 'calc(100% + 14px)',\r\n                height: 'calc(100% + 7px)',\r\n            },\r\n        });\r\n\r\n        const redrawPoint = () => {\r\n            BB.css(this.sliderPoint, {\r\n                left: sliderPos + 'px',\r\n            });\r\n        };\r\n        const getValue = () => {\r\n            return sliderPos /  (p.width - p.pointSize);\r\n        };\r\n\r\n        {\r\n            let isFirst: boolean;\r\n            sliderPos = BB.clamp(p.init * (p.width - p.pointSize), 0, p.width - p.pointSize);\r\n            BB.css(this.sliderPoint, {\r\n                width: p.pointSize + 'px',\r\n                height: p.pointSize + 'px',\r\n                borderRadius: p.pointSize + 'px',\r\n            });\r\n            redrawPoint();\r\n            let imaginaryPos: number;\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.sliderPoint,\r\n                fixScribble: true,\r\n                onPointer: (event): void => {\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        isFirst = true;\r\n                        isDragging = true;\r\n                        imaginaryPos = sliderPos;\r\n                        redrawPoint();\r\n                        event.eventStopPropagation();\r\n                    } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                        event.eventStopPropagation();\r\n                        imaginaryPos = imaginaryPos + event.dX;\r\n                        sliderPos = parseInt('' + BB.clamp(imaginaryPos, 0, p.width - p.pointSize));\r\n                        redrawPoint();\r\n                        p.callback(getValue(), isFirst, false);\r\n                        isFirst = false;\r\n                    }\r\n                    if (event.type === 'pointerup') {\r\n                        event.eventStopPropagation();\r\n                        isDragging = false;\r\n                        redrawPoint();\r\n                        p.callback(getValue(), false, true);\r\n                    }\r\n                },\r\n            });\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getEl (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setActive (isActive: boolean): void {\r\n        this.sliderPoint.style.backgroundColor = isActive ? '#fff' : '#eaeaea';\r\n    }\r\n\r\n    destroy (): void {\r\n        this.pointerListener.destroy();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IRGBA} from '../../kl-types';\r\nimport {theme} from '../../../theme/theme';\r\n\r\n/**\r\n * UI to pick between colors in colorArr. can display full transparent (checkerboard).\r\n * Can't deal with 0.5 alpha.\r\n * Rectangular buttons.\r\n */\r\nexport class ColorOptions {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly buttonArr: {\r\n        el: HTMLElement;\r\n        setIsSelected: (b: boolean) => void;\r\n    }[];\r\n\r\n    private readonly updateCheckerboard: () => void;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            colorArr: IRGBA[]; // duplicates will be removed\r\n            onChange: (rgbaObj: IRGBA) => void;\r\n            label?: string;\r\n            initialIndex?: number; // index before duplicates were removed\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            content: p.label ? p.label : '',\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n\r\n        let selectedIndex = 0;\r\n        const colorArr: IRGBA[] = [];\r\n        this.buttonArr = [];\r\n        const buttonSize = 22;\r\n        const checkerUrl = BB.createCheckerDataUrl(5, undefined, theme.isDark());\r\n\r\n        // build colorArr while removing duplicates\r\n        for (let i = 0; i < p.colorArr.length; i++) {\r\n            const item = p.colorArr[i];\r\n            let found = false;\r\n            for (let e = 0; e < colorArr.length; e++) {\r\n                const sItem = colorArr[e];\r\n                if (sItem === null || item === null) {\r\n                    continue;\r\n                }\r\n                if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\r\n                    found = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (found) {\r\n                continue;\r\n            }\r\n            colorArr.push(item);\r\n            if ('initialIndex' in p && p.initialIndex === i) {\r\n                selectedIndex = colorArr.length - 1;\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < colorArr.length; i++) {\r\n            ((i) => {\r\n\r\n                const colorButton = BB.el({\r\n                    parent: this.rootEl,\r\n                    content: colorArr[i] ? '' : 'X',\r\n                    className: 'kl-color-option',\r\n                    css: {\r\n                        width: buttonSize + 'px',\r\n                        height: buttonSize + 'px',\r\n                        backgroundColor: colorArr[i] ? BB.ColorConverter.toRgbaStr(colorArr[i]) : 'transparent',\r\n                        lineHeight: (buttonSize + 1) + 'px',\r\n                    },\r\n                    onClick: (e) => {\r\n                        e.preventDefault();\r\n                        selectedIndex = i;\r\n                        update();\r\n                        p.onChange(colorArr[i]);\r\n                    },\r\n                });\r\n                if (colorArr[i] && colorArr[i].a === 0) {\r\n                    colorButton.style.backgroundImage = 'url(' + checkerUrl + ')';\r\n                }\r\n\r\n                const setIsSelected = (b: boolean): void => {\r\n                    colorButton.classList.toggle('kl-color-option--active', b);\r\n                };\r\n\r\n                this.buttonArr.push({\r\n                    el: colorButton,\r\n                    setIsSelected,\r\n                });\r\n            })(i);\r\n        }\r\n\r\n\r\n        const update = () => {\r\n            for (let i = 0; i < this.buttonArr.length; i++) {\r\n                this.buttonArr[i].setIsSelected(i === selectedIndex);\r\n            }\r\n        };\r\n        update();\r\n\r\n        this.updateCheckerboard = (): void => {\r\n            const checkerUrl = BB.createCheckerDataUrl(5, undefined, theme.isDark());\r\n            this.buttonArr.forEach((button, i) => {\r\n                if (colorArr[i] && colorArr[i].a === 0) {\r\n                    button.el.style.backgroundImage = 'url(' + checkerUrl + ')';\r\n                }\r\n            });\r\n        };\r\n        theme.addIsDarkListener(this.updateCheckerboard);\r\n    }\r\n\r\n    // ---- interface ----\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.buttonArr.forEach(item => {\r\n            BB.destroyEl(item.el);\r\n        });\r\n        this.buttonArr.splice(0, this.buttonArr.length);\r\n        theme.removeIsDarkListener(this.updateCheckerboard);\r\n    }\r\n\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * selectable options\r\n */\r\nexport class Options<IdType> {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private selectedId: IdType;\r\n    private readonly optionArr: {\r\n        id: IdType;\r\n        el: HTMLElement;\r\n    }[];\r\n    private readonly onChange: ((id: IdType) => void) | undefined;\r\n\r\n    private getIndex (): number {\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            if (this.optionArr[i].id === this.selectedId) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    private update (): void {\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            this.optionArr[i].el.classList.toggle(\r\n                'kl-option-selected',\r\n                this.optionArr[i].id === this.selectedId\r\n            );\r\n        }\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            optionArr: {\r\n                id: IdType;\r\n                label: string | HTMLElement | SVGElement;\r\n                title?: string;\r\n            }[];\r\n            initId?: IdType;\r\n            onChange?: (id: IdType) => void;\r\n            changeOnInit?: boolean; // trigger change on creation\r\n            isSmall? :boolean;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el();\r\n\r\n        const wrapperEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-option-wrapper',\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        if (p.onChange) {\r\n            this.onChange = p.onChange;\r\n        }\r\n        this.optionArr = [];\r\n        this.selectedId = ('initialId' in p && p.initId !== undefined) ? p.initId : p.optionArr[0].id;\r\n\r\n        const createOption = (o: {\r\n            id: IdType;\r\n            label: string | HTMLElement | SVGElement;\r\n            title?: string;\r\n        }) => {\r\n\r\n            const classArr = ['kl-option'];\r\n            if (p.isSmall) {\r\n                classArr.push('kl-option--small');\r\n            }\r\n            if (typeof o.label !== 'string') {\r\n                classArr.push('kl-option--custom-el');\r\n                BB.css(o.label, {\r\n                    display: 'block',\r\n                    pointerEvents: 'none',\r\n                });\r\n            }\r\n\r\n            const optionObj = {\r\n                id: o.id,\r\n                el: BB.el({\r\n                    parent: wrapperEl,\r\n                    content: o.label,\r\n                    className: classArr.join(' '),\r\n                    onClick: () => {\r\n                        if (this.selectedId !== optionObj.id) {\r\n                            this.selectedId = optionObj.id;\r\n                            this.update();\r\n                            this.onChange && this.onChange(this.selectedId);\r\n                        }\r\n                    },\r\n                }),\r\n            };\r\n\r\n            if (o.title) {\r\n                optionObj.el.title = o.title;\r\n            }\r\n\r\n            this.optionArr.push(optionObj);\r\n        };\r\n\r\n        for (let i = 0; i < p.optionArr.length; i++) {\r\n            createOption(p.optionArr[i]);\r\n        }\r\n\r\n        this.update();\r\n\r\n        if (p.changeOnInit) {\r\n            setTimeout(() => {\r\n                this.onChange && this.onChange(this.selectedId);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValue (): IdType {\r\n        return this.selectedId;\r\n    }\r\n\r\n    next (): void {\r\n        this.selectedId = this.optionArr[(this.getIndex() + 1) % this.optionArr.length].id;\r\n        this.update();\r\n        this.onChange && this.onChange(this.selectedId);\r\n    }\r\n\r\n    previous (): void {\r\n        this.selectedId = this.optionArr[(this.optionArr.length + this.getIndex() - 1) % this.optionArr.length].id;\r\n        this.update();\r\n        this.onChange && this.onChange(this.selectedId);\r\n    }\r\n\r\n    destroy (): void {\r\n        this.optionArr.forEach(item => {\r\n            BB.destroyEl(item.el);\r\n        });\r\n        this.optionArr.splice(0, this.optionArr.length);\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport angleSvg from '/src/app/img/ui/angle.svg';\r\n\r\n\r\ntype TUiState = 'left' | 'right';\r\n\r\n/**\r\n * display little messages at the top of KlWorkspace\r\n */\r\nexport class StatusOverlay {\r\n\r\n    private el: HTMLDivElement;\r\n    private innerEl: HTMLDivElement;\r\n    private angleIm: HTMLImageElement;\r\n    private innerInnerEl: HTMLDivElement;\r\n    private isWide: boolean;\r\n    private uiState: TUiState;\r\n\r\n    private timeout: number;\r\n    private timeout2: number;\r\n    private timeout3: number;\r\n\r\n    private updateUiState () {\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n        setTimeout(()=>{}, 100);\r\n        if (this.uiState === 'left') {\r\n            this.el.style.left = '271px';\r\n        } else {\r\n            this.el.style.removeProperty('left');\r\n        }\r\n    }\r\n\r\n    private init () {\r\n        this.el = BB.el({\r\n            className: 'top-overlay g-root',\r\n            onClick: BB.handleClick,\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n        }\r\n\r\n        this.updateUiState();\r\n\r\n        this.innerEl = BB.el({\r\n            className: 'top-overlay--inner',\r\n        }) as HTMLDivElement;\r\n\r\n\r\n        this.angleIm = new Image();\r\n        this.angleIm.src = angleSvg;\r\n        BB.css(this.angleIm, {\r\n            verticalAlign: 'bottom',\r\n            width: '20px',\r\n            height: '20px',\r\n            marginLeft: '5px',\r\n            borderRadius: '10px',\r\n        });\r\n\r\n        this.innerInnerEl = document.createElement('div');\r\n        this.innerInnerEl.style.display = 'inline-block';\r\n\r\n        this.innerEl.append(this.innerInnerEl, this.angleIm);\r\n        this.el.append(this.innerEl);\r\n        document.body.append(this.el);\r\n        this.el.style.display = 'none';\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        this.init();\r\n    }\r\n\r\n    setWide (b: boolean) {\r\n        this.isWide = !!b;\r\n\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n            this.el.style.left = '';\r\n        } else {\r\n            this.el.style.removeProperty('width');\r\n            this.el.style.left = this.uiState === 'left' ? '271px' : '';\r\n        }\r\n    }\r\n\r\n    setUiState (state: TUiState) {\r\n        this.uiState = state;\r\n        this.updateUiState();\r\n    }\r\n\r\n    out (msg: string | {type: 'transform'; angleDeg: number; scale: number}, doPulse?: boolean) {\r\n\r\n        if (msg && typeof msg === 'object') {\r\n\r\n            if (msg.type === 'transform') {\r\n                this.angleIm.style.display = 'inline-block';\r\n                this.angleIm.style.transform = 'rotate(' + msg.angleDeg + 'deg)';\r\n\r\n                if (msg.angleDeg % 90 === 0) {\r\n                    this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255, 255, 255, 0.7)';\r\n                } else {\r\n                    this.angleIm.style.boxShadow = '';\r\n                }\r\n\r\n                this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + '%';\r\n\r\n\r\n            } else {\r\n                this.angleIm.style.display = 'none';\r\n            }\r\n\r\n\r\n\r\n        } else if (typeof msg === 'string') {\r\n            this.angleIm.style.display = 'none';\r\n            this.innerInnerEl.innerHTML = msg;\r\n        }\r\n\r\n        if (doPulse) {\r\n            this.innerEl.style.animation = '';\r\n            setTimeout(\r\n                () => this.innerEl.style.animation = 'topOverlayPulse 0.5s ease-out',\r\n                20\r\n            );\r\n            if (this.timeout3) {\r\n                clearTimeout(this.timeout3);\r\n            }\r\n            this.timeout3 = window.setTimeout(\r\n                () => this.innerEl.style.animation = '',\r\n                520\r\n            );\r\n        }\r\n\r\n\r\n\r\n        if (this.timeout) {\r\n            clearTimeout(this.timeout);\r\n        }\r\n        if (this.timeout2) {\r\n            clearTimeout(this.timeout2);\r\n        }\r\n        this.el.style.animationName = doPulse ? 'consoleInFast' : 'consoleIn';\r\n        this.el.style.opacity = '1';\r\n        this.timeout = window.setTimeout(() => {\r\n            this.el.style.opacity = '0';\r\n            this.el.style.animationName = 'consoleOut';\r\n            this.timeout2 = window.setTimeout(() => {\r\n                this.el.style.display = 'none';\r\n                this.timeout2 = 0;\r\n            }, 450);\r\n            this.timeout = 0;\r\n        }, 1200);\r\n        this.el.style.display = 'flex';\r\n    }\r\n\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iqIgb\");","import {BB} from '../../../bb/bb';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {IRect, IVector2D} from '../../../bb/bb-types';\r\nimport {theme} from '../../../theme/theme';\r\n\r\n/**\r\n * element that lets you crop an image and copy it via right click\r\n */\r\nexport class CropCopy {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly eventTarget: HTMLElement;\r\n    private crop: IRect = {x: 0, y: 0, width: 0, height: 0};\r\n    private readonly croppedCanvas: HTMLCanvasElement;\r\n    private readonly keyListener: KeyListener;\r\n    private readonly pointerListener: PointerListener;\r\n    private readonly canvas: HTMLImageElement | HTMLCanvasElement;\r\n    private readonly onChange: undefined | ((width: number, height: number) => void);\r\n    private readonly selectionRect: HTMLElement;\r\n    private readonly thumbX: number;\r\n    private readonly thumbY: number;\r\n    private readonly scaleW: number;\r\n    private readonly scaleH: number;\r\n    private readonly croppedImage: undefined | HTMLImageElement;\r\n\r\n\r\n    private resetCrop (): void {\r\n        this.crop = {\r\n            x: 0,\r\n            y: 0,\r\n            width: this.canvas.width,\r\n            height: this.canvas.height,\r\n        };\r\n    }\r\n    private updateCroppedCanvas (): void {\r\n        this.croppedCanvas.width = Math.round(this.crop.width);\r\n        this.croppedCanvas.height = Math.round(this.crop.height);\r\n        const ctx = BB.ctx(this.croppedCanvas);\r\n        ctx.drawImage(this.canvas, Math.round(-this.crop.x), Math.round(-this.crop.y));\r\n        if (this.croppedImage) {\r\n            this.croppedImage.src = this.croppedCanvas.toDataURL('image/png');\r\n        }\r\n\r\n        this.onChange && this.onChange(this.croppedCanvas.width, this.croppedCanvas.height);\r\n    }\r\n    private updateSelectionRect (): void {\r\n        BB.css(this.selectionRect, {\r\n            left: (this.thumbX + this.crop.x * this.scaleW) + 'px',\r\n            top: (this.thumbY + this.crop.y * this.scaleH) + 'px',\r\n            width: (this.crop.width * this.scaleW) + 'px',\r\n            height: (this.crop.height * this.scaleH) + 'px',\r\n        });\r\n        this.onChange && this.onChange(Math.round(this.crop.width), Math.round(this.crop.height));\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        param: {\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLImageElement | HTMLCanvasElement;\r\n            isNotCopy: boolean;\r\n            onChange?: (width: number, height: number) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-edit-crop-preview',\r\n            css: {\r\n                position: 'relative',\r\n                height: param.height + 'px',\r\n                width: param.width + 'px',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n        if (param.onChange) {\r\n            this.onChange = param.onChange;\r\n        }\r\n        this.canvas = param.canvas;\r\n\r\n        this.resetCrop();\r\n\r\n\r\n\r\n\r\n        const isInsideSelectionRect = (p: IVector2D): boolean => {\r\n            const rect = {\r\n                x: Math.round(this.thumbX + this.crop.x * this.scaleW),\r\n                y: Math.round(this.thumbY + this.crop.y * this.scaleH),\r\n                width: Math.round(this.crop.width * this.scaleW),\r\n                height: Math.round(this.crop.height * this.scaleH),\r\n            };\r\n            return BB.isInsideRect(p, rect);\r\n        };\r\n\r\n        this.croppedCanvas = BB.canvas();\r\n        this.eventTarget = this.croppedCanvas;\r\n        if (!param.isNotCopy) {\r\n            this.croppedImage = new Image();\r\n            this.eventTarget = this.croppedImage;\r\n        }\r\n        BB.css(this.eventTarget, {\r\n            height: param.height + 'px',\r\n            width: param.width + 'px',\r\n        });\r\n        this.rootEl.append(this.eventTarget);\r\n        this.updateCroppedCanvas();\r\n\r\n        const padding = 20;\r\n        const previewWrapper = BB.el({\r\n            css: {\r\n                width: param.width + 'px',\r\n                height: param.height + 'px',\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        this.rootEl.append(previewWrapper);\r\n        BB.createCheckerDataUrl(4, (v) => {\r\n            previewWrapper.style.backgroundImage = 'url('+v+')';\r\n        }, theme.isDark());\r\n\r\n        const thumbSize = BB.fitInto(this.canvas.width, this.canvas.height, param.width - padding * 2, param.height - padding * 2, 1);\r\n        const thumbCanvas = BB.canvas(Math.round(thumbSize.width), Math.round(thumbSize.height));\r\n        thumbCanvas.style.imageRendering = 'pixelated';\r\n        this.scaleW = thumbCanvas.width / this.canvas.width;\r\n        this.scaleH = thumbCanvas.height / this.canvas.height;\r\n        const thumbCtx = BB.ctx(thumbCanvas);\r\n        thumbCtx.imageSmoothingEnabled = false;\r\n        thumbCtx.drawImage(this.canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);\r\n        previewWrapper.append(thumbCanvas);\r\n        this.thumbX = parseInt('' + ((param.width - thumbCanvas.width) / 2));\r\n        this.thumbY = parseInt('' + ((param.height - thumbCanvas.height) / 2));\r\n        BB.css(thumbCanvas, {\r\n            position: 'absolute',\r\n            left: this.thumbX + 'px',\r\n            top: this.thumbY + 'px',\r\n        });\r\n\r\n        this.selectionRect = BB.el({\r\n            parent: previewWrapper,\r\n            className: 'kl-edit-crop-preview__sel',\r\n        });\r\n        this.updateSelectionRect();\r\n\r\n\r\n        const toOriginalSpace = (p: IVector2D): IVector2D => {\r\n            return {\r\n                x: BB.clamp((p.x - this.thumbX) / this.scaleW, 0, this.canvas.width),\r\n                y: BB.clamp((p.y - this.thumbY) / this.scaleH, 0, this.canvas.height),\r\n            };\r\n        };\r\n        //gen crop from thumb-space points\r\n        const genCrop = (p1: IVector2D, p2: IVector2D): IRect => {\r\n            const topLeftP = {\r\n                x: Math.min(p1.x, p2.x),\r\n                y: Math.min(p1.y, p2.y),\r\n            };\r\n            const bottomRightP = {\r\n                x: Math.max(p1.x, p2.x),\r\n                y: Math.max(p1.y, p2.y),\r\n            };\r\n            const origTopLeftP = toOriginalSpace(topLeftP);\r\n            const origBottomRightP = toOriginalSpace(bottomRightP);\r\n            origTopLeftP.x = Math.floor(origTopLeftP.x);\r\n            origTopLeftP.y = Math.floor(origTopLeftP.y);\r\n            origBottomRightP.x = Math.ceil(origBottomRightP.x);\r\n            origBottomRightP.y = Math.ceil(origBottomRightP.y);\r\n            return {\r\n                x: origTopLeftP.x,\r\n                y: origTopLeftP.y,\r\n                width: origBottomRightP.x - origTopLeftP.x,\r\n                height: origBottomRightP.y - origTopLeftP.y,\r\n            };\r\n        };\r\n\r\n\r\n\r\n        let startP: IVector2D | null;\r\n        let startCrop: IRect | null = null;\r\n        let isDragging = false;\r\n        let didMove = false;\r\n        let updateCropTimeout: ReturnType<typeof setTimeout>;\r\n        this.pointerListener = new BB.PointerListener({\r\n            target: this.eventTarget,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    event.eventPreventDefault();\r\n                    isDragging = true;\r\n                    startP = {\r\n                        x: event.relX,\r\n                        y: event.relY,\r\n                    };\r\n                    if (!this.isReset() && isInsideSelectionRect(startP)) {\r\n                        startCrop = {\r\n                            x: this.crop.x,\r\n                            y: this.crop.y,\r\n                            width: this.crop.width,\r\n                            height: this.crop.height,\r\n                        };\r\n                    } else {\r\n                        this.crop = genCrop(startP, startP);\r\n                    }\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                    event.eventPreventDefault();\r\n                    didMove = true;\r\n                    if (startCrop) {\r\n                        this.crop.x = startCrop.x + Math.round((event.relX - startP!.x) / this.scaleW);\r\n                        this.crop.y = startCrop.y + Math.round((event.relY - startP!.y) / this.scaleH);\r\n                        this.crop.x = BB.clamp(this.crop.x, 0, this.canvas.width - this.crop.width);\r\n                        this.crop.y = BB.clamp(this.crop.y, 0, this.canvas.height - this.crop.height);\r\n                    } else {\r\n                        this.crop = genCrop(startP!, {x: event.relX, y: event.relY});\r\n                    }\r\n                    this.updateSelectionRect();\r\n                } else if (event.type === 'pointerup' && startP) {\r\n                    event.eventPreventDefault();\r\n                    isDragging = false;\r\n                    startCrop = null;\r\n                    startP = null;\r\n                    if (this.crop.width === 0 || this.crop.height === 0 || !didMove) {\r\n                        this.resetCrop();\r\n                        this.updateSelectionRect();\r\n                    }\r\n                    didMove = false;\r\n                    updateCropTimeout = setTimeout(() => this.updateCroppedCanvas(), 1);\r\n                }\r\n            },\r\n        });\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, e, comboStr) => {\r\n                if (isDragging) {\r\n                    return;\r\n                }\r\n                let doUpdate = false;\r\n\r\n                const stepSize = Math.max(1, 1 / this.scaleW);\r\n                const shiftIsPressed = this.keyListener.isPressed('shift');\r\n\r\n                if (keyStr === 'left') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.width = BB.clamp(this.crop.width - stepSize, 1, this.canvas.width - this.crop.x);\r\n                    } else {\r\n                        this.crop.x = BB.clamp(this.crop.x - stepSize, 0, this.canvas.width - this.crop.width);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n                if (keyStr === 'right') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.width = BB.clamp(this.crop.width + stepSize, 1, this.canvas.width - this.crop.x);\r\n                    } else {\r\n                        this.crop.x = BB.clamp(this.crop.x + stepSize, 0, this.canvas.width - this.crop.width);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n                if (keyStr === 'up') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.height = BB.clamp(this.crop.height - stepSize, 1, this.canvas.height - this.crop.y);\r\n                    } else {\r\n                        this.crop.y = BB.clamp(this.crop.y - stepSize, 0, this.canvas.height - this.crop.height);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n                if (keyStr === 'down') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.height = BB.clamp(this.crop.height + stepSize, 1, this.canvas.height - this.crop.y);\r\n                    } else {\r\n                        this.crop.y = BB.clamp(this.crop.y + stepSize, 0, this.canvas.height - this.crop.height);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n\r\n                if (doUpdate) {\r\n                    e.preventDefault();\r\n                    this.updateSelectionRect();\r\n                    clearTimeout(updateCropTimeout);\r\n                    updateCropTimeout = setTimeout(() => this.updateCroppedCanvas(), 100);\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getEl (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n    reset (): void {\r\n        this.resetCrop();\r\n        this.updateCroppedCanvas();\r\n        this.updateSelectionRect();\r\n    }\r\n    destroy (): void {\r\n        this.eventTarget.style.removeProperty('width');\r\n        this.eventTarget.style.removeProperty('height');\r\n        this.keyListener.destroy();\r\n        this.pointerListener.destroy();\r\n    }\r\n    isReset (): boolean {\r\n        return this.crop.x === 0 && this.crop.y === 0 && this.crop.width === this.canvas.width && this.crop.height === this.canvas.height;\r\n    }\r\n    getRect (): IRect {\r\n        return BB.copyObj(this.crop);\r\n    }\r\n    getCroppedImage (): HTMLCanvasElement {\r\n        return this.croppedCanvas;\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {showModal} from './base/showModal';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {LANG} from '../../../language/language';\r\nimport {StatusOverlay} from '../components/status-overlay';\r\nimport {ICropRect} from '../../../bb/bb-types';\r\n\r\nexport function clipboardDialog (\r\n    parent: HTMLElement,\r\n    fullCanvas: HTMLCanvasElement,\r\n    cropCallback: (crop: ICropRect) => void,\r\n    output: StatusOverlay,\r\n    showCrop: boolean, // show crop button\r\n): void {\r\n\r\n    let clipboardItemIsSupported: boolean = false;\r\n    try {\r\n        clipboardItemIsSupported = !!ClipboardItem;\r\n    } catch (e) {}\r\n\r\n    const div = document.createElement('div');\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n\r\n    const topWrapper = BB.el({\r\n        content: LANG('crop-drag-to-crop') + (clipboardItemIsSupported ? '' : '<br>' + LANG('cropcopy-click-hold')),\r\n        css: {\r\n            textAlign: 'center',\r\n        },\r\n    });\r\n    div.append(topWrapper);\r\n\r\n\r\n    const cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 350,\r\n        canvas: fullCanvas,\r\n        isNotCopy: false,\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n    });\r\n    div.append(cropCopy.getEl());\r\n\r\n    function toClipboard () {\r\n        const imgURL = cropCopy.getCroppedImage().toDataURL('image/png');\r\n        setTimeout(async function () {\r\n            try {\r\n                const data = await fetch(imgURL);\r\n                const blob = await data.blob();\r\n                await (navigator.clipboard as any).write([\r\n                    new ClipboardItem({\r\n                        [blob.type]: blob,\r\n                    } as any), // todo check is possible?\r\n                ]);\r\n                setTimeout(function () {\r\n                    output.out(LANG('cropcopy-copied'), true);\r\n                }, 200);\r\n            } catch (err) {\r\n                console.error(err.name, err.message);\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, KeyEvent, comboStr) {\r\n            if (comboStr === 'ctrl+c') {\r\n                toClipboard();\r\n                closeFunc && closeFunc();\r\n            }\r\n        },\r\n    });\r\n\r\n    let closeFunc: () => void;\r\n    function blur () {\r\n        closeFunc && closeFunc();\r\n    }\r\n    window.addEventListener('blur', blur);\r\n\r\n    const buttonArr = [];\r\n    if (clipboardItemIsSupported) {\r\n        buttonArr.push(LANG('cropcopy-btn-copy'));\r\n    }\r\n    if (showCrop) {\r\n        buttonArr.push(LANG('cropcopy-btn-crop'));\r\n    }\r\n    buttonArr.push('Cancel');\r\n\r\n    showModal({\r\n        target: parent,\r\n        message: '<b>' + (showCrop ? `${LANG('cropcopy-title-copy')} / ${LANG('cropcopy-title-crop')}` : `${LANG('cropcopy-title-copy')}`) + '</b>',\r\n        div: div,\r\n        style: isSmall ? {} : {\r\n            width: '500px',\r\n        },\r\n        buttons: buttonArr,\r\n        primaries: [LANG('cropcopy-btn-copy')],\r\n        callback: function (result) {\r\n            if (result === LANG('cropcopy-btn-copy')) {\r\n                toClipboard();\r\n            } else if (result === LANG('cropcopy-btn-crop')) {\r\n                const rectObj = cropCopy.getRect();\r\n                cropCallback({\r\n                    left: Math.round(-rectObj.x),\r\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\r\n                    top: Math.round(-rectObj.y),\r\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height),\r\n                });\r\n            }\r\n            window.removeEventListener('blur', blur);\r\n            cropCopy.destroy();\r\n            keyListener.destroy();\r\n        },\r\n        clickOnEnter: LANG('cropcopy-btn-copy'),\r\n        closeFunc: function (func) {\r\n            closeFunc = func;\r\n        },\r\n    });\r\n}","import {BB} from '../../../../bb/bb';\r\nimport {klHistory} from '../../../history/kl-history';\r\nimport {Select} from '../../components/select';\r\nimport {PointSlider} from '../../components/point-slider';\r\nimport {KlCanvas, MAX_LAYERS} from '../../../canvas/kl-canvas';\r\nimport {TMixMode, TUiLayout} from '../../../kl-types';\r\nimport {LANG} from '../../../../language/language';\r\nimport {translateBlending} from '../../../canvas/translate-blending';\r\nimport {PointerListener} from '../../../../bb/input/pointer-listener';\r\nimport {IPointerEvent} from '../../../../bb/input/event.types';\r\nimport {renameLayerDialog} from './rename-layer-dialog';\r\nimport {mergeLayerDialog} from './merge-layer-dialog';\r\nimport addLayerImg from '/src/app/img/ui/add-layer.svg';\r\nimport duplicateLayerImg from '/src/app/img/ui/duplicate-layer.svg';\r\nimport mergeLayerImg from '/src/app/img/ui/merge-layers.svg';\r\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\r\nimport renameLayerImg from '/src/app/img/ui/rename-layer.svg';\r\nimport {theme} from '../../../../theme/theme';\r\n\r\ntype TLayerEl = HTMLElement & {\r\n    label: HTMLElement;\r\n    opacityLabel: HTMLElement;\r\n    thumb: HTMLCanvasElement;\r\n\r\n    spot: number;\r\n    posY: number;\r\n    layerName: string;\r\n    opacity: number;\r\n    pointerListener: PointerListener;\r\n    opacitySlider: PointSlider;\r\n    isSelected: boolean;\r\n};\r\n\r\nexport class LayerManager {\r\n\r\n    private readonly parentEl: HTMLElement;\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly klCanvas: KlCanvas;\r\n    private klCanvasLayerArr: {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: TMixMode;\r\n    }[];\r\n    private readonly layerListEl: HTMLElement;\r\n    private layerElArr: TLayerEl[];\r\n    private selectedSpotIndex: number;\r\n    private readonly removeBtn: HTMLButtonElement;\r\n    private readonly addBtn: HTMLButtonElement;\r\n    private readonly duplicateBtn: HTMLButtonElement;\r\n    private readonly mergeBtn: HTMLButtonElement;\r\n    private readonly modeSelect: Select;\r\n    private uiState: TUiLayout;\r\n    private readonly largeThumbDiv: HTMLElement;\r\n    private oldHistoryState: number | undefined;\r\n\r\n    private readonly largeThumbCanvas: HTMLCanvasElement;\r\n    private largeThumbInDocument: boolean;\r\n    private largeThumbInTimeout: undefined | ReturnType<typeof setTimeout>;\r\n    private largeThumbTimeout: undefined | ReturnType<typeof setTimeout>;\r\n    private lastpos: number = 0;\r\n\r\n    private readonly onSelect: (layerIndex: number) => void;\r\n    private readonly layerHeight: number = 35;\r\n    private readonly layerSpacing: number = 0;\r\n\r\n    private move (oldSpotIndex: number, newSpotIndex: number): void {\r\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) {\r\n            throw 'layermanager - invalid move';\r\n        }\r\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\r\n            ((i) => {\r\n                let posy = this.layerElArr[i].spot; // <- here\r\n                if (this.layerElArr[i].spot === oldSpotIndex) {\r\n                    posy = newSpotIndex;\r\n                } else {\r\n                    if (this.layerElArr[i].spot > oldSpotIndex) {\r\n                        posy--;\r\n                    }\r\n                    if (posy >= newSpotIndex) {\r\n                        posy++;\r\n                    }\r\n                }\r\n                this.layerElArr[i].spot = posy;\r\n                this.layerElArr[i].posY = (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\r\n                this.layerElArr[i].style.top = this.layerElArr[i].posY + 'px';\r\n            })(i);\r\n        }\r\n        if (oldSpotIndex === newSpotIndex) {\r\n            return;\r\n        }\r\n        this.klCanvas.moveLayer(this.selectedSpotIndex, newSpotIndex - oldSpotIndex);\r\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n        this.selectedSpotIndex = newSpotIndex;\r\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\r\n    }\r\n\r\n    private posToSpot (p: number): number {\r\n        let result = parseInt('' + (p / (this.layerHeight + this.layerSpacing) + 0.5));\r\n        result = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, result));\r\n        result = this.klCanvasLayerArr.length - result - 1;\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * update css position of all layers that are not being dragged, while dragging\r\n     */\r\n    private updateLayersVerticalPosition (id: number, newspot: number): void {\r\n        newspot = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, newspot));\r\n        if (newspot === this.lastpos) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\r\n            if (this.layerElArr[i].spot === id) { // <- here\r\n                continue;\r\n            }\r\n            let posy = this.layerElArr[i].spot;\r\n            if (this.layerElArr[i].spot > id) {\r\n                posy--;\r\n            }\r\n            if (posy >= newspot) {\r\n                posy++;\r\n            }\r\n            this.layerElArr[i].posY = (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\r\n            this.layerElArr[i].style.top = this.layerElArr[i].posY + 'px';\r\n        }\r\n        this.lastpos = newspot;\r\n    }\r\n\r\n    private renameLayer (layerSpot: number): void {\r\n\r\n        renameLayerDialog(\r\n            this.parentEl,\r\n            this.klCanvas.getLayer(layerSpot).name,\r\n            (newName) => {\r\n                if (newName === undefined || newName === this.klCanvas.getLayer(layerSpot).name) {\r\n                    return;\r\n                }\r\n                this.klCanvas.renameLayer(layerSpot, newName);\r\n                this.createLayerList();\r\n                klHistory.pause(true);\r\n                this.onSelect(layerSpot);\r\n                klHistory.pause(false);\r\n            }\r\n        );\r\n    }\r\n\r\n    private updateHeight (): void {\r\n        this.layerListEl.style.height = (this.layerElArr.length * 35) + 'px';\r\n    }\r\n\r\n    private createLayerList (): void {\r\n        this.oldHistoryState = klHistory.getState();\r\n        const createLayerEntry = (index: number): void => {\r\n            const layerName = this.klCanvas.getLayer(index).name;\r\n            const opacity = this.klCanvasLayerArr[index].opacity;\r\n            const layercanvas = this.klCanvasLayerArr[index].context.canvas;\r\n\r\n            const layer: TLayerEl = BB.el() as TLayerEl;\r\n            layer.className = 'kl-layer';\r\n            this.layerElArr[index] = layer;\r\n            layer.posY = ((this.klCanvasLayerArr.length - 1) * 35 - index * 35);\r\n            BB.css(layer, {\r\n                top: layer.posY + 'px',\r\n            });\r\n            const innerLayer = BB.el();\r\n            BB.css(innerLayer, {\r\n                position: 'relative',\r\n            });\r\n\r\n            const container1 = BB.el();\r\n            BB.css(container1, {\r\n                width: '250px',\r\n                height: '34px',\r\n            });\r\n            const container2 = BB.el();\r\n            layer.append(innerLayer);\r\n            innerLayer.append(container1, container2);\r\n\r\n            layer.spot = index;\r\n\r\n            //thumb\r\n            {\r\n                const thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\r\n                const thumb = layer.thumb = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n\r\n                const thc = BB.ctx(thumb);\r\n                thc.save();\r\n                if (thumb.width > layercanvas.width) {\r\n                    thc.imageSmoothingEnabled = false;\r\n                }\r\n                thc.drawImage(layercanvas, 0, 0, thumb.width, thumb.height);\r\n                thc.restore();\r\n                BB.css(layer.thumb, {\r\n                    position: 'absolute',\r\n                    left: ((32 - layer.thumb.width) / 2) + 'px',\r\n                    top: ((32 - layer.thumb.height) / 2) + 'px',\r\n                });\r\n                BB.createCheckerDataUrl(4, (url) => {\r\n                    thumb.style.backgroundImage = 'url(' + url + ')';\r\n                }, theme.isDark());\r\n            }\r\n\r\n            //layerlabel\r\n            {\r\n                layer.label = BB.el({\r\n                    className: 'kl-layer__label',\r\n                });\r\n                layer.layerName = layerName;\r\n                layer.label.append(layer.layerName);\r\n\r\n                BB.css(layer.label, {\r\n                    position: 'absolute',\r\n                    left: (1 + 32 + 5) + 'px',\r\n                    top: 1 + 'px',\r\n                    fontSize: '13px',\r\n                    width: '170px',\r\n                    height: '20px',\r\n                    overflow: 'hidden',\r\n                    whiteSpace: 'nowrap',\r\n                });\r\n\r\n                layer.label.ondblclick = () => {\r\n                    this.renameLayer(layer.spot);\r\n                };\r\n            }\r\n            //layerlabel\r\n            {\r\n                layer.opacityLabel = BB.el({\r\n                    className: 'kl-layer__opacity-label',\r\n                });\r\n                layer.opacity = opacity;\r\n                layer.opacityLabel.append(parseInt('' + (layer.opacity * 100)) + '%');\r\n\r\n                BB.css(layer.opacityLabel, {\r\n                    position: 'absolute',\r\n                    left: (250 - 1 - 5 - 50) + 'px',\r\n                    top: 1 + 'px',\r\n                    fontSize: '13px',\r\n                    textAlign: 'right',\r\n                    width: '50px',\r\n                    transition: 'color 0.2s ease-in-out',\r\n                });\r\n            }\r\n\r\n            let oldOpacity: number;\r\n            const opacitySlider = new PointSlider({\r\n                init: layer.opacity,\r\n                width: 204,\r\n                pointSize: 14,\r\n                callback: (sliderValue, isFirst, isLast) => {\r\n                    if (isFirst) {\r\n                        oldOpacity = this.klCanvas.getLayer(layer.spot).opacity;\r\n                        klHistory.pause(true);\r\n                        return;\r\n                    }\r\n                    if (isLast) {\r\n                        klHistory.pause(false);\r\n                        if (oldOpacity !== sliderValue) {\r\n                            this.klCanvas.layerOpacity(layer.spot, sliderValue);\r\n                        }\r\n                        return;\r\n                    }\r\n                    layer.opacityLabel.innerHTML = Math.round(sliderValue * 100) + '%';\r\n                    this.klCanvas.layerOpacity(layer.spot, sliderValue);\r\n                },\r\n            });\r\n            BB.css(opacitySlider.getEl(), {\r\n                position: 'absolute',\r\n                left: '39px',\r\n                top: '17px',\r\n            });\r\n            layer.opacitySlider = opacitySlider;\r\n\r\n            //larger layer preview - hover\r\n            layer.thumb.onpointerover = (e) => {\r\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== 'touch')) { //shouldn't show while dragging\r\n                    return;\r\n                }\r\n\r\n                const thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\r\n\r\n                if (this.largeThumbCanvas.width !== thumbDimensions.width || this.largeThumbCanvas.height !== thumbDimensions.height) {\r\n                    this.largeThumbCanvas.width = thumbDimensions.width;\r\n                    this.largeThumbCanvas.height = thumbDimensions.height;\r\n                }\r\n                const ctx = BB.ctx(this.largeThumbCanvas);\r\n                ctx.save();\r\n                if (this.largeThumbCanvas.width > layercanvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.imageSmoothingQuality = 'high';\r\n                ctx.clearRect(0, 0, this.largeThumbCanvas.width, this.largeThumbCanvas.height);\r\n                ctx.drawImage(layercanvas, 0, 0, this.largeThumbCanvas.width, this.largeThumbCanvas.height);\r\n                ctx.restore();\r\n                BB.css(this.largeThumbDiv, {\r\n                    top: (e.clientY - this.largeThumbCanvas.height / 2) + 'px',\r\n                    opacity: '0',\r\n                });\r\n                if (!this.largeThumbInDocument) {\r\n                    document.body.append(this.largeThumbDiv);\r\n                    this.largeThumbInDocument = true;\r\n                }\r\n                clearTimeout(this.largeThumbInTimeout);\r\n                this.largeThumbInTimeout = setTimeout(() => {\r\n                    BB.css(this.largeThumbDiv, {\r\n                        opacity: '1',\r\n                    });\r\n                }, 20);\r\n                clearTimeout(this.largeThumbTimeout);\r\n            };\r\n            layer.thumb.onpointerout = () => {\r\n                clearTimeout(this.largeThumbInTimeout);\r\n                BB.css(this.largeThumbDiv, {\r\n                    opacity: '0',\r\n                });\r\n                clearTimeout(this.largeThumbTimeout);\r\n                this.largeThumbTimeout = setTimeout(() => {\r\n                    if (!this.largeThumbInDocument) {\r\n                        return;\r\n                    }\r\n                    document.body.removeChild(this.largeThumbDiv);\r\n                    this.largeThumbInDocument = false;\r\n                }, 300);\r\n            };\r\n\r\n            container1.append(layer.thumb, layer.label, layer.opacityLabel, opacitySlider.getEl());\r\n            let dragstart = false;\r\n            let freshSelection = false;\r\n\r\n            //events for moving layers up and down\r\n            const dragEventHandler = (event: IPointerEvent) => {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    BB.css(layer, {\r\n                        transition: 'box-shadow 0.3s ease-in-out',\r\n                    });\r\n                    layer.style.zIndex = '1';\r\n                    this.lastpos = layer.spot;\r\n                    freshSelection = false;\r\n                    if (!layer.isSelected) {\r\n                        freshSelection = true;\r\n                        this.activateLayer(layer.spot);\r\n                    }\r\n                    dragstart = true;\r\n\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    if (dragstart) {\r\n                        dragstart = false;\r\n                        BB.css(layer, {\r\n                            boxShadow: '1px 3px 5px rgba(0,0,0,0.4)',\r\n                        });\r\n                    }\r\n                    layer.posY += event.dY;\r\n                    const corrected = Math.max(0, Math.min((this.klCanvasLayerArr.length - 1) * (35), layer.posY));\r\n                    layer.style.top = corrected + 'px';\r\n                    this.updateLayersVerticalPosition(layer.spot, this.posToSpot(layer.posY));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(layer, {\r\n                        transition: 'all 0.1s linear',\r\n                    });\r\n                    setTimeout(() => {\r\n                        BB.css(layer, {\r\n                            boxShadow: '',\r\n                        });\r\n                    }, 20);\r\n                    layer.posY = Math.max(0, Math.min((this.klCanvasLayerArr.length - 1) * (35), layer.posY));\r\n                    layer.style.zIndex = '';\r\n                    const newSpot = this.posToSpot(layer.posY);\r\n                    const oldSpot = layer.spot;\r\n                    this.move(layer.spot, newSpot);\r\n                    if (oldSpot != newSpot) {\r\n                        klHistory.pause(true);\r\n                        this.onSelect(this.selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                    if (oldSpot === newSpot && freshSelection) {\r\n                        this.onSelect(this.selectedSpotIndex);\r\n                    }\r\n                    freshSelection = false;\r\n                }\r\n            };\r\n\r\n            layer.pointerListener = new BB.PointerListener({\r\n                target: container1,\r\n                onPointer: dragEventHandler,\r\n            });\r\n\r\n            this.layerListEl.append(layer);\r\n        };\r\n        this.layerElArr = [];\r\n        while (this.layerListEl.firstChild) {\r\n            const child = this.layerListEl.firstChild as TLayerEl;\r\n            child.pointerListener.destroy();\r\n            child.opacitySlider.destroy();\r\n            this.layerListEl.removeChild(child);\r\n        }\r\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\r\n            createLayerEntry(i);\r\n        }\r\n        this.activateLayer(this.selectedSpotIndex);\r\n        this.updateHeight();\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        klCanvas: KlCanvas,\r\n        onSelect: (layerIndex: number) => void,\r\n        parentEl: HTMLElement,\r\n        uiState: TUiLayout,\r\n    ) {\r\n        this.parentEl = parentEl;\r\n        this.klCanvas = klCanvas;\r\n        this.layerElArr = [];\r\n        this.layerHeight = 35;\r\n        this.layerSpacing = 0;\r\n        const width = 250;\r\n        this.onSelect = onSelect;\r\n        this.uiState = uiState;\r\n\r\n        this.largeThumbDiv = BB.el({\r\n            onClick: BB.handleClick,\r\n            css: {\r\n                position: 'absolute',\r\n                top: '500px',\r\n                background: '#aaa',\r\n                boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\r\n                pointerEvents: 'none',\r\n                padding: '0',\r\n                border: '1px solid #aaa',\r\n                transition: 'opacity 0.3s ease-out',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.setUiState(uiState);\r\n        BB.createCheckerDataUrl(4, (url) => {\r\n            this.largeThumbDiv.style.backgroundImage = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n        this.largeThumbCanvas = BB.canvas(200, 200);\r\n        this.largeThumbCanvas.style.display = 'block';\r\n        this.largeThumbDiv.append(this.largeThumbCanvas);\r\n        this.largeThumbInDocument = false;\r\n\r\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n        this.selectedSpotIndex = this.klCanvasLayerArr.length - 1;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                marginRight: '10px',\r\n                marginBottom: '10px',\r\n                marginLeft: '10px',\r\n                marginTop: '10px',\r\n                cursor: 'default',\r\n            },\r\n        });\r\n\r\n        const listDiv = BB.el({\r\n            css: {\r\n                width: width + 'px',\r\n                position: 'relative',\r\n            },\r\n        });\r\n\r\n        this.layerListEl = BB.el();\r\n\r\n        this.addBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n        this.duplicateBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n        this.mergeBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n        this.removeBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n        const renameBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n\r\n        const createButtons = () => {\r\n            const div = BB.el();\r\n            const async = () => {\r\n                BB.makeUnfocusable(this.addBtn);\r\n                BB.makeUnfocusable(this.duplicateBtn);\r\n                BB.makeUnfocusable(this.mergeBtn);\r\n                BB.makeUnfocusable(this.removeBtn);\r\n                BB.makeUnfocusable(renameBtn);\r\n\r\n                this.addBtn.style.cssFloat = 'left';\r\n                this.duplicateBtn.style.cssFloat = 'left';\r\n                this.mergeBtn.style.cssFloat = 'left';\r\n                this.removeBtn.style.cssFloat = 'left';\r\n                renameBtn.style.cssFloat = 'left';\r\n\r\n                this.addBtn.title = LANG('layers-new');\r\n                this.duplicateBtn.title = LANG('layers-duplicate');\r\n                this.removeBtn.title = LANG('layers-remove');\r\n                this.mergeBtn.title = LANG('layers-merge');\r\n                renameBtn.title = LANG('layers-rename-title');\r\n\r\n                this.addBtn.style.paddingLeft = '5px';\r\n                this.addBtn.style.paddingRight = '3px';\r\n\r\n                this.removeBtn.style.paddingLeft = '5px';\r\n                this.removeBtn.style.paddingRight = '3px';\r\n\r\n                this.duplicateBtn.style.paddingLeft = '5px';\r\n                this.duplicateBtn.style.paddingRight = '3px';\r\n\r\n                this.mergeBtn.style.paddingLeft = '5px';\r\n                this.mergeBtn.style.paddingRight = '3px';\r\n\r\n                renameBtn.style.height = '30px';\r\n                renameBtn.style.lineHeight = '20px';\r\n\r\n                this.addBtn.innerHTML = \"<img src='\" + addLayerImg + \"' height='20'/>\";\r\n                this.duplicateBtn.innerHTML = \"<img src='\" + duplicateLayerImg + \"' height='20'/>\";\r\n                this.mergeBtn.innerHTML = \"<img src='\" + mergeLayerImg + \"' height='20'/>\";\r\n                this.removeBtn.innerHTML = \"<img src='\" + removeLayerImg + \"' height='20'/>\";\r\n                renameBtn.innerHTML = \"<img src='\" + renameLayerImg + \"' height='20'/>\";\r\n                this.addBtn.style.marginRight = '5px';\r\n                this.removeBtn.style.marginRight = '5px';\r\n                this.duplicateBtn.style.marginRight = '5px';\r\n                this.mergeBtn.style.marginRight = '5px';\r\n                div.append(\r\n                    this.addBtn,\r\n                    this.removeBtn,\r\n                    this.duplicateBtn,\r\n                    this.mergeBtn,\r\n                    renameBtn,\r\n                    BB.el({\r\n                        css: {\r\n                            clear: 'both',\r\n                            height: '10px',\r\n                        },\r\n                    }),\r\n                );\r\n\r\n                this.addBtn.onclick = () => {\r\n                    if (this.klCanvas.addLayer(this.selectedSpotIndex) === false) {\r\n                        return;\r\n                    }\r\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n\r\n                    if (this.klCanvasLayerArr.length === MAX_LAYERS) {\r\n                        this.addBtn.disabled = true;\r\n                        this.duplicateBtn.disabled = true;\r\n                    }\r\n                    this.removeBtn.disabled = false;\r\n                    this.selectedSpotIndex = this.selectedSpotIndex + 1;\r\n                    this.createLayerList();\r\n                    klHistory.pause(true);\r\n                    this.onSelect(this.selectedSpotIndex);\r\n                    klHistory.pause(false);\r\n                };\r\n                this.duplicateBtn.onclick = () => {\r\n                    if (this.klCanvas.duplicateLayer(this.selectedSpotIndex) === false) {\r\n                        return;\r\n                    }\r\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n                    if (this.klCanvasLayerArr.length === MAX_LAYERS) {\r\n                        this.addBtn.disabled = true;\r\n                        this.duplicateBtn.disabled = true;\r\n                    }\r\n                    this.removeBtn.disabled = false;\r\n                    this.selectedSpotIndex++;\r\n                    this.createLayerList();\r\n                    klHistory.pause(true);\r\n                    this.onSelect(this.selectedSpotIndex);\r\n                    klHistory.pause(false);\r\n                };\r\n                this.removeBtn.onclick = () => {\r\n                    if (this.layerElArr.length <= 1) {\r\n                        return;\r\n                    }\r\n\r\n                    this.klCanvas.removeLayer(this.selectedSpotIndex);\r\n                    if (this.selectedSpotIndex > 0) {\r\n                        this.selectedSpotIndex--;\r\n                    }\r\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n                    this.createLayerList();\r\n                    klHistory.pause(true);\r\n                    this.onSelect(this.selectedSpotIndex);\r\n                    klHistory.pause(false);\r\n                    if (this.klCanvasLayerArr.length === 1) {\r\n                        this.removeBtn.disabled = true;\r\n                    }\r\n                    if (this.klCanvasLayerArr.length < MAX_LAYERS) {\r\n                        this.addBtn.disabled = false;\r\n                        this.duplicateBtn.disabled = false;\r\n                    }\r\n                };\r\n                this.mergeBtn.onclick = () => {\r\n                    if (this.selectedSpotIndex <= 0) {\r\n                        return;\r\n                    }\r\n                    mergeLayerDialog(this.parentEl, {\r\n                        topCanvas: this.klCanvasLayerArr[this.selectedSpotIndex].context.canvas,\r\n                        bottomCanvas: this.klCanvasLayerArr[this.selectedSpotIndex - 1].context.canvas,\r\n                        topOpacity: this.klCanvas.getLayer(this.selectedSpotIndex).opacity,\r\n                        mixModeStr: this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr,\r\n                        callback: (mode) => {\r\n                            this.klCanvas.mergeLayers(this.selectedSpotIndex, this.selectedSpotIndex - 1, mode);\r\n                            this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n                            this.selectedSpotIndex--;\r\n                            if (this.klCanvasLayerArr.length === 1) {\r\n                                this.removeBtn.disabled = true;\r\n                            }\r\n                            if (this.klCanvasLayerArr.length < MAX_LAYERS) {\r\n                                this.addBtn.disabled = false;\r\n                                this.duplicateBtn.disabled = false;\r\n                            }\r\n                            this.createLayerList();\r\n                            klHistory.pause(true);\r\n                            this.onSelect(this.selectedSpotIndex);\r\n                            klHistory.pause(false);\r\n                        },\r\n                    });\r\n                };\r\n\r\n                renameBtn.onclick = () => {\r\n                    this.renameLayer(this.selectedSpotIndex);\r\n                };\r\n            };\r\n            setTimeout(async, 1);\r\n            return div;\r\n        };\r\n        this.rootEl.append(createButtons());\r\n\r\n        let modeWrapper;\r\n        {\r\n            modeWrapper = BB.el({\r\n                content: LANG('layers-blending') + '&nbsp;',\r\n                css: {\r\n                    fontSize: '15px',\r\n                },\r\n            });\r\n\r\n            this.modeSelect = new Select({\r\n                optionArr: [\r\n                    'source-over',\r\n                    null,\r\n                    'darken',\r\n                    'multiply',\r\n                    'color-burn',\r\n                    null,\r\n                    'lighten',\r\n                    'screen',\r\n                    'color-dodge',\r\n                    null,\r\n                    'overlay',\r\n                    'soft-light',\r\n                    'hard-light',\r\n                    null,\r\n                    'difference',\r\n                    'exclusion',\r\n                    null,\r\n                    'hue',\r\n                    'saturation',\r\n                    'color',\r\n                    'luminosity',\r\n                ].map((item: TMixMode) => {\r\n                    return item ? [item, translateBlending(item)] : null;\r\n                }),\r\n                onChange: (val) => {\r\n                    this.klCanvas.setMixMode(this.selectedSpotIndex, val as TMixMode);\r\n                    this.update(this.selectedSpotIndex);\r\n                },\r\n                css: {\r\n                    marginBottom: '10px',\r\n                },\r\n            });\r\n\r\n            modeWrapper.append(this.modeSelect.getElement());\r\n            this.rootEl.append(modeWrapper);\r\n\r\n        }\r\n\r\n\r\n        listDiv.append(this.layerListEl);\r\n        this.rootEl.append(listDiv);\r\n\r\n        //updating the thumbs in interval\r\n        //don't update when: manager not visible || layer didn't change || is drawing\r\n        setInterval(() => {\r\n            if (this.rootEl.style.display !== 'block') {\r\n                return;\r\n            }\r\n\r\n            const historyState = klHistory.getState();\r\n            if (historyState === this.oldHistoryState) {\r\n                return;\r\n            }\r\n            this.oldHistoryState = historyState;\r\n\r\n            for (let i = 0; i < this.layerElArr.length; i++) {\r\n                if (this.selectedSpotIndex === this.layerElArr[i].spot && this.klCanvasLayerArr[this.layerElArr[i].spot]) { // second check, because might be out of date\r\n                    const ctx = BB.ctx(this.layerElArr[i].thumb);\r\n                    ctx.save();\r\n                    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n                    if (this.klCanvasLayerArr[this.layerElArr[i].spot].context.canvas.width < this.layerElArr[i].thumb.width) {\r\n                        ctx.imageSmoothingEnabled = false;\r\n                    }\r\n                    ctx.drawImage(this.klCanvasLayerArr[this.layerElArr[i].spot].context.canvas, 0, 0, this.layerElArr[i].thumb.width, this.layerElArr[i].thumb.height);\r\n                    ctx.restore();\r\n                }\r\n            }\r\n\r\n        }, 1);\r\n\r\n        theme.addIsDarkListener(() => {\r\n            this.createLayerList();\r\n        });\r\n\r\n        this.createLayerList();\r\n    }\r\n\r\n    // ---- interface ----\r\n    update (activeLayerSpotIndex?: number): void {\r\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) {\r\n            this.selectedSpotIndex = activeLayerSpotIndex;\r\n        }\r\n        this.removeBtn.disabled = this.klCanvasLayerArr.length === 1;\r\n        if (this.klCanvasLayerArr.length === MAX_LAYERS) {\r\n            this.addBtn.disabled = true;\r\n            this.duplicateBtn.disabled = true;\r\n        } else {\r\n            this.addBtn.disabled = false;\r\n            this.duplicateBtn.disabled = false;\r\n        }\r\n        setTimeout(() => this.createLayerList(), 1);\r\n    }\r\n\r\n    getSelected (): number {\r\n        return this.selectedSpotIndex;\r\n    }\r\n\r\n    activateLayer (spotIndex: number): void {\r\n        if (spotIndex < 0 || spotIndex > this.layerElArr.length - 1) {\r\n            throw 'invalid spotIndex ' + spotIndex + ', layerElArr.length ' + this.layerElArr.length;\r\n        }\r\n        this.selectedSpotIndex = spotIndex;\r\n        this.modeSelect.setValue(this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr);\r\n        for (let i = 0; i < this.layerElArr.length; i++) {\r\n            const layer = this.layerElArr[i];\r\n            const isSelected = this.selectedSpotIndex === layer.spot;\r\n\r\n            BB.css(layer, {\r\n                boxShadow: '',\r\n            });\r\n            layer.classList.toggle('kl-layer--selected', isSelected);\r\n            layer.opacitySlider.setActive(isSelected);\r\n            layer.isSelected = isSelected;\r\n        }\r\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\r\n    }\r\n\r\n    setUiState (stateStr: TUiLayout): void {\r\n        this.uiState = stateStr;\r\n\r\n        if (this.uiState === 'left') {\r\n            BB.css(this.largeThumbDiv, {\r\n                left: '280px',\r\n                right: '',\r\n            });\r\n        } else {\r\n            BB.css(this.largeThumbDiv, {\r\n                left: '',\r\n                right: '280px',\r\n            });\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {floodFillBits} from '../image-operations/flood-fill';\r\nimport {drawShape} from '../image-operations/shape-tool';\r\nimport {IRenderTextParam, renderText} from '../image-operations/render-text';\r\nimport {IGradient, IKlProject, IRGB, IShapeToolObject, TFillSampling, TKlCanvasLayer, TMixMode} from '../kl-types';\r\nimport {DecoyKlHistory, KlHistoryInterface, THistoryActions} from '../history/kl-history';\r\nimport {drawProject} from './draw-project';\r\nimport {LANG} from '../../language/language';\r\nimport {drawGradient} from '../image-operations/gradient-tool';\r\n\r\nexport type TKlCanvasHistoryEntry = THistoryActions<'canvas', KlCanvas>;\r\n\r\nconst allowedMixModes = [\r\n    'source-over',\r\n    'darken',\r\n    'multiply',\r\n    'color-burn',\r\n    'lighten',\r\n    'screen',\r\n    'color-dodge',\r\n    'overlay',\r\n    'soft-light',\r\n    'hard-light',\r\n    'difference',\r\n    'exclusion',\r\n    'hue',\r\n    'saturation',\r\n    'color',\r\n    'luminosity',\r\n];\r\n\r\nexport const MAX_LAYERS = 16;\r\n\r\ninterface KlCanvasLayer extends HTMLCanvasElement {\r\n    name: string;\r\n    mixModeStr: TMixMode;\r\n    opacity: number;\r\n    compositeObj?: {\r\n        draw: (ctx: CanvasRenderingContext2D) => void;\r\n    };\r\n    index: number; // certain brushes need to know\r\n}\r\n\r\n/**\r\n * The image/canvas that the user paints on\r\n * Has layers. layers have names and opacity.\r\n *\r\n * Interacts with the history you specify (for undo/redo)\r\n */\r\nexport class KlCanvas {\r\n\r\n    // todo changeListener consistent concept\r\n    // todo history interaction, consistent concept - currently have to look at code to know if something pushes on history\r\n\r\n    private width: number;\r\n    private height: number;\r\n    private layerCanvasArr: KlCanvasLayer[];\r\n    private pickCanvas: HTMLCanvasElement; // canvas to draw into for color picker\r\n    private history: KlHistoryInterface;\r\n    private changeListenerArr:  (() => void)[]; // subscribers get notified when opacity changes\r\n\r\n\r\n    private init (w: number, h: number): void {\r\n        if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            throw new Error('init - invalid canvas size: ' + w + ', ' + h);\r\n        }\r\n        this.width = w;\r\n        this.height = h;\r\n    }\r\n\r\n    private emitChange (): void {\r\n        // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\r\n        this.changeListenerArr.forEach(item => item());\r\n    }\r\n\r\n    private updateIndices (): void {\r\n        this.layerCanvasArr.forEach((item, index) => {\r\n            item.index = index;\r\n        });\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        params: {\r\n            projectObj: {\r\n                width: number;\r\n                height: number;\r\n                layers: {\r\n                    name: string;\r\n                    opacity: number;\r\n                    image: HTMLImageElement | HTMLCanvasElement; // already loaded!\r\n                }[];\r\n            };\r\n        } | {\r\n            // creates blank KlCanvas, 0 layers\r\n            width: number;\r\n            height: number;\r\n        } | {\r\n            copy: KlCanvas;\r\n        },\r\n        private layerNrOffset: number = 0,\r\n    ) {\r\n        this.layerCanvasArr = [];\r\n        this.pickCanvas = BB.canvas(1, 1);\r\n        this.history = new DecoyKlHistory();\r\n        if ('copy' in params) {\r\n            this.width = 1;\r\n            this.height = 1;\r\n        } else {\r\n            if ('width' in params && 'height' in params) {\r\n                this.width = params.width;\r\n                this.height = params.height;\r\n            } else {\r\n                this.width = 1;\r\n                this.height = 1;\r\n            }\r\n        }\r\n        this.init(this.width, this.height);\r\n\r\n        this.changeListenerArr = [];\r\n\r\n        if ('copy' in params) {\r\n            try {\r\n                this.copy(params.copy);\r\n            } catch (e) {\r\n                this.destroy();\r\n                throw e;\r\n            }\r\n        } else if ('projectObj' in params) {\r\n            const origLayers = [...params.projectObj.layers];\r\n            this.init(params.projectObj.width, params.projectObj.height);\r\n\r\n            if (!origLayers.length) {\r\n                throw new Error('project.layers needs at least 1 layer');\r\n            }\r\n\r\n            for (let i = 0; i < origLayers.length; i++) {\r\n                if (origLayers[i].mixModeStr && !allowedMixModes.includes(origLayers[i].mixModeStr)) {\r\n                    throw new Error('unknown mixModeStr ' + origLayers[i].mixModeStr);\r\n                }\r\n\r\n                this.addLayer();\r\n                this.layerOpacity(i, origLayers[i].opacity);\r\n                this.layerCanvasArr[i].name = origLayers[i].name;\r\n                this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr ? origLayers[i].mixModeStr : 'source-over';\r\n                BB.ctx(this.layerCanvasArr[i]).drawImage(origLayers[i].image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    /**\r\n     * Resets canvas -> 1 layer, 100% opacity,\r\n     * unless layers provided.\r\n     * @param p\r\n     */\r\n    reset (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n            color?: IRGB; // optional - fill color\r\n            image?: HTMLImageElement | HTMLCanvasElement; // image drawn on layer\r\n            layerName?: string; // if via image\r\n            layers?: {\r\n                name: string;\r\n                opacity: number;\r\n                mixModeStr: TMixMode;\r\n                image: HTMLCanvasElement;\r\n            }[];\r\n        }\r\n    ): void | number {\r\n        if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height) ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        this.history.pause(true);\r\n\r\n        this.width = p.width;\r\n        this.height = p.height;\r\n\r\n        this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\r\n\r\n        if (p.layers) {\r\n            for (let i = 0; i < p.layers.length; i++) {\r\n                const item = p.layers[i];\r\n                if (!this.layerCanvasArr[i]) {\r\n                    this.addLayer();\r\n                }\r\n                this.layerCanvasArr[i].name = item.name;\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n                this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : 'source-over';\r\n                BB.ctx(this.layerCanvasArr[i]).drawImage(item.image, 0, 0);\r\n                this.layerOpacity(i, item.opacity);\r\n            }\r\n        } else {\r\n            this.layerCanvasArr[0].name = p.layerName ? p.layerName : LANG('layers-layer') + ' 1';\r\n            this.layerCanvasArr[0].width = this.width;\r\n            this.layerCanvasArr[0].height = this.height;\r\n            this.layerCanvasArr[0].mixModeStr = 'source-over';\r\n            this.layerOpacity(0, 1);\r\n            if (p.color) {\r\n                this.layerFill(0, p.color);\r\n            } else if (p.image) {\r\n                BB.ctx(this.layerCanvasArr[0]).drawImage(p.image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n\r\n        this.history.pause(false);\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'reset',\r\n            params: [p], // don't modify with p\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return this.layerCanvasArr.length - 1;\r\n    }\r\n\r\n    isLayerLimitReached (): boolean {\r\n        return this.layerCanvasArr.length >= MAX_LAYERS;\r\n    }\r\n\r\n    getWidth (): number {\r\n        return this.width;\r\n    }\r\n\r\n    getHeight (): number {\r\n        return this.height;\r\n    }\r\n\r\n    copy (toCopyCanvas: KlCanvas): void {\r\n        if (\r\n            toCopyCanvas.getWidth() < 1 ||\r\n            toCopyCanvas.getHeight() < 1 ||\r\n            isNaN(toCopyCanvas.getWidth()) ||\r\n            isNaN(toCopyCanvas.getHeight())\r\n        ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        // keep existing canvases\r\n\r\n        const origLayers = toCopyCanvas.getLayers();\r\n\r\n        while (this.layerCanvasArr.length > origLayers.length) {\r\n            this.removeLayer(this.layerCanvasArr.length - 1);\r\n        }\r\n\r\n        if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) {\r\n            this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\r\n        }\r\n        for (let i = 0; i < origLayers.length; i++) {\r\n            if (i >= this.layerCanvasArr.length) {\r\n                this.addLayer();\r\n            } else {\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n            }\r\n            this.layerOpacity(i, origLayers[i].opacity);\r\n            this.layerCanvasArr[i].name = origLayers[i].name;\r\n            this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\r\n            BB.ctx(this.layerCanvasArr[i]).drawImage(origLayers[i].context.canvas, 0, 0);\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    getLayerCount (): number {\r\n        return this.layerCanvasArr.length;\r\n    }\r\n\r\n    resize (w: number, h: number, algorithm: 'smooth' | 'pixelated' = 'smooth'): boolean {\r\n        if (!w || !h || (w === this.width && h === this.height) || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            return false;\r\n        }\r\n        w = Math.max(w, 1);\r\n        h = Math.max(h, 1);\r\n\r\n        let tmp1, tmp2;\r\n\r\n        if (algorithm === 'pixelated') {\r\n            tmp1 = BB.canvas(w, h);\r\n            const tmp1Ctx = BB.ctx(tmp1);\r\n            tmp1Ctx.imageSmoothingEnabled = false;\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                if (i > 0) {\r\n                    tmp1Ctx.clearRect(0, 0, w, h);\r\n                }\r\n                const layerCanvas = this.layerCanvasArr[i];\r\n                tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\r\n                layerCanvas.width = w;\r\n                layerCanvas.height = h;\r\n                const layerContext = BB.ctx(layerCanvas);\r\n                layerContext.drawImage(tmp1, 0, 0);\r\n            }\r\n\r\n        } else if (algorithm === 'smooth') {\r\n            tmp1 = BB.canvas();\r\n            tmp2 = BB.canvas();\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                BB.resizeCanvas(this.layerCanvasArr[i], w, h, tmp1, tmp2);\r\n            }\r\n        } else {\r\n            throw new Error('unknown resize algorithm');\r\n        }\r\n\r\n        this.width = w;\r\n        this.height = h;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * crop / extend\r\n     * @param p\r\n     */\r\n    resizeCanvas (p: {\r\n        left: number;\r\n        top: number;\r\n        right: number;\r\n        bottom: number;\r\n        fillColor?: IRGB;\r\n    }): void {\r\n\r\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\r\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\r\n        const offX = Math.round(p.left);\r\n        const offY = Math.round(p.top);\r\n\r\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) {\r\n            throw new Error('KlCanvas.resizeCanvas - invalid canvas size');\r\n        }\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            const ctemp = BB.canvas(this.width, this.height);\r\n            const layerCanvas = this.layerCanvasArr[i];\r\n            const layerCtx = BB.ctx(this.layerCanvasArr[i]);\r\n            BB.ctx(ctemp).drawImage(layerCanvas, 0, 0);\r\n\r\n            this.layerCanvasArr[i].width = newW;\r\n            this.layerCanvasArr[i].height = newH;\r\n\r\n            layerCtx.save();\r\n            if (i === 0 && p.fillColor) {\r\n                layerCtx.fillStyle = BB.ColorConverter.toRgbStr(p.fillColor);\r\n                layerCtx.fillRect(0, 0, newW, newH);\r\n                layerCtx.clearRect(offX, offY, this.width, this.height);\r\n            }\r\n            layerCtx.drawImage(ctemp, offX, offY);\r\n            layerCtx.restore();\r\n        }\r\n        this.width = newW;\r\n        this.height = newH;\r\n    }\r\n\r\n    /**\r\n     * will be inserted on top of selected\r\n     * @param selected\r\n     */\r\n    addLayer (selected?: number): false | number {\r\n        if (this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        const canvas = BB.canvas(this.width, this.height);\r\n        if (!canvas.getContext('2d')) {\r\n            throw new Error('kl-create-canvas-error');\r\n        }\r\n\r\n        (canvas as any).mixModeStr = 'source-over';\r\n\r\n        if (selected === undefined) {\r\n            this.layerCanvasArr[this.layerCanvasArr.length] = canvas as any;\r\n            selected = Math.max(0, this.layerCanvasArr.length - 1);\r\n        } else {\r\n            this.layerCanvasArr.splice(selected + 1, 0, canvas as any);\r\n            selected++;\r\n        }\r\n\r\n        (canvas as any).name = LANG('layers-layer') + ' ' + (this.layerCanvasArr.length + this.layerNrOffset);\r\n        this.history.pause(true);\r\n        this.layerOpacity(selected, 1);\r\n        this.history.pause(false);\r\n        this.updateIndices();\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'addLayer',\r\n            params: [selected - 1],\r\n        } as TKlCanvasHistoryEntry);\r\n        return selected;\r\n    }\r\n\r\n    duplicateLayer (i: number): false | number {\r\n        if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        const canvas = BB.canvas(this.width, this.height);\r\n        this.layerCanvasArr.splice(i + 1, 0, canvas as any);\r\n\r\n        (canvas as any).name = this.layerCanvasArr[i].name + ' ' + LANG('layers-copy');\r\n        (canvas as any).mixModeStr = this.layerCanvasArr[i].mixModeStr;\r\n        BB.ctx(canvas).drawImage(this.layerCanvasArr[i], 0, 0);\r\n        this.history.pause(true);\r\n        this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\r\n        this.history.pause(false);\r\n\r\n        this.updateIndices();\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'duplicateLayer',\r\n            params: [i],\r\n        } as TKlCanvasHistoryEntry);\r\n        return i + 1;\r\n    }\r\n\r\n    getLayerContext (i: number, doReturnNull?: boolean): CanvasRenderingContext2D | null {\r\n        if (this.layerCanvasArr[i]) {\r\n            return BB.ctx(this.layerCanvasArr[i]);\r\n        }\r\n        if (doReturnNull) {\r\n            return null;\r\n        }\r\n        throw new Error('layer of index ' + i + ' not found (in ' + this.layerCanvasArr.length + ' layers)');\r\n    }\r\n\r\n    removeLayer (i: number): false | number {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr.splice(i, 1);\r\n            this.updateIndices();\r\n        } else {\r\n            return false;\r\n        }\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'removeLayer',\r\n            params: [i],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return Math.max(0, i - 1);\r\n    }\r\n\r\n    renameLayer (i: number, name: string): boolean {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr[i].name = name;\r\n        } else {\r\n            return false;\r\n        }\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'renameLayer',\r\n            params: [i, name],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return true;\r\n    }\r\n\r\n    layerOpacity (i: number, o: number): void {\r\n        if (!this.layerCanvasArr[i]) {\r\n            return;\r\n        }\r\n        o = Math.max(0, Math.min(1, o));\r\n        this.layerCanvasArr[i].opacity = o;\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'layerOpacity',\r\n            params: [i, o],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        this.emitChange();\r\n    }\r\n\r\n    moveLayer (i: number, d: number): void | number {\r\n        if (d === 0) {\r\n            return;\r\n        }\r\n        if (this.layerCanvasArr[i]) {\r\n            const temp = this.layerCanvasArr[i];\r\n            this.layerCanvasArr.splice(i, 1);\r\n            const targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\r\n            this.layerCanvasArr.splice(targetIndex, 0, temp);\r\n            this.updateIndices();\r\n            this.history.push({\r\n                tool: ['canvas'],\r\n                action: 'moveLayer',\r\n                params: [i, d],\r\n            } as TKlCanvasHistoryEntry);\r\n            return targetIndex;\r\n        }\r\n    }\r\n\r\n    mergeLayers (layerBottomIndex: number, layerTopIndex: number, mixModeStr: TMixMode | 'as-alpha'): void | number {\r\n        if (\r\n            !this.layerCanvasArr[layerBottomIndex] ||\r\n            !this.layerCanvasArr[layerTopIndex] ||\r\n            layerBottomIndex === layerTopIndex\r\n        ) {\r\n            return;\r\n        }\r\n        //order messed up\r\n        if (layerBottomIndex > layerTopIndex) {\r\n            const temp = layerBottomIndex;\r\n            layerBottomIndex = layerTopIndex;\r\n            layerTopIndex = temp;\r\n        }\r\n\r\n        const topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\r\n        if (topOpacity !== 0 && topOpacity) {\r\n            const ctx = BB.ctx(this.layerCanvasArr[layerBottomIndex]);\r\n            ctx.save();\r\n\r\n            if (mixModeStr === 'as-alpha') { // todo remove this?\r\n\r\n                BB.convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\r\n                ctx.globalCompositeOperation = 'destination-in';\r\n                ctx.globalAlpha = topOpacity;\r\n                BB.ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            } else {\r\n\r\n                if (mixModeStr) {\r\n                    ctx.globalCompositeOperation = mixModeStr;\r\n                }\r\n                ctx.globalAlpha = topOpacity;\r\n                BB.ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            }\r\n\r\n            ctx.restore();\r\n\r\n            // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n            // TODO remove if chrome updated\r\n            if (mixModeStr) {\r\n                ctx.save();\r\n                ctx.fillStyle = 'rgba(0,0,0,0.01)';\r\n                ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n                ctx.restore();\r\n            }\r\n        }\r\n        this.updateIndices();\r\n        this.history.pause(true);\r\n        this.removeLayer(layerTopIndex);\r\n        this.history.pause(false);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'mergeLayers',\r\n            params: [layerBottomIndex, layerTopIndex, mixModeStr],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return layerBottomIndex;\r\n    }\r\n\r\n    rotate (deg: number): void {\r\n        while (deg < 0) {\r\n            deg += 360;\r\n        }\r\n        deg %= 360;\r\n        if (deg % 90 != 0 || deg === 0) {\r\n            return;\r\n        }\r\n        const temp = BB.canvas();\r\n        if (deg === 0 || deg === 180) {\r\n            temp.width = this.width;\r\n            temp.height = this.height;\r\n        } else if (deg === 90 || deg === 270) {\r\n            temp.width = this.height;\r\n            temp.height = this.width;\r\n        }\r\n        const ctx = BB.ctx(temp);\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.clearRect(0, 0, temp.width, temp.height);\r\n            ctx.save();\r\n            ctx.translate(temp.width / 2, temp.height / 2);\r\n            ctx.rotate(deg * Math.PI / 180);\r\n            if (deg === 180) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            } else if (deg === 90 || deg === 270) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\r\n            }\r\n            this.layerCanvasArr[i].width = temp.width;\r\n            this.layerCanvasArr[i].height = temp.height;\r\n            BB.ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            BB.ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\r\n            ctx.restore();\r\n        }\r\n        this.width = temp.width;\r\n        this.height = temp.height;\r\n    }\r\n\r\n    flip (isHorizontal: boolean, isVertical: boolean, layerIndex?: number): void {\r\n        if (!isHorizontal && !isVertical) {\r\n            return;\r\n        }\r\n\r\n        const temp = BB.canvas(this.width, this.height);\r\n        temp.width = this.width;\r\n        temp.height = this.height;\r\n        const tempCtx = BB.ctx(temp);\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n\r\n            if ( (layerIndex || layerIndex === 0) && i !== layerIndex) {\r\n                continue;\r\n            }\r\n\r\n            tempCtx.save();\r\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\r\n            tempCtx.translate(temp.width / 2, temp.height / 2);\r\n            tempCtx.scale((isHorizontal ? -1 : 1), (isVertical ? -1 : 1));\r\n            tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            tempCtx.restore();\r\n\r\n            BB.ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            BB.ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\r\n        }\r\n    }\r\n\r\n    layerFill (layerIndex: number, colorObj: IRGB, compositeOperation?: string): void {\r\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n        ctx.save();\r\n        if (compositeOperation) {\r\n            ctx.globalCompositeOperation = compositeOperation as GlobalCompositeOperation;\r\n        }\r\n        ctx.fillStyle = 'rgba(' + colorObj.r + ',' + colorObj.g + ',' + colorObj.b + ',1)';\r\n        ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n        // TODO remove if chrome updated\r\n        ctx.save();\r\n        ctx.fillStyle = 'rgba(0,0,0,0.01)';\r\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n        ctx.restore();\r\n\r\n        /*if (!document.getElementById('testocanvas')) {\r\n            layerCanvasArr[layerIndex].id = 'testocanvas';\r\n            document.body.append(layerCanvasArr[layerIndex]);\r\n            BB.css(layerCanvasArr[layerIndex], {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }\r\n        if (!document.getElementById('testocanvas')) {\r\n            let c = document.createElement('canvas');\r\n            c.width = 1000;\r\n            c.height = 1000;\r\n            let ctx2 = c.getContext('2d');\r\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\r\n            c.id = 'testocanvas';\r\n            document.body.append(c);\r\n            BB.css(c, {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }*/\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'layerFill',\r\n            params: [layerIndex, colorObj, compositeOperation],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    floodFill (\r\n        layerIndex: number, // index of layer to be filled\r\n        x: number, // starting point\r\n        y: number,\r\n        rgb: IRGB | null, // fill color, if null -> erase\r\n        opacity: number,\r\n        tolerance: number,\r\n        sampleStr: TFillSampling,\r\n        grow: number, // int >= 0 - radius around filled area that is to be filled too\r\n        isContiguous: boolean,\r\n    ): void {\r\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) {\r\n            return;\r\n        }\r\n        tolerance = Math.round(tolerance);\r\n\r\n        if (!(['above', 'current', 'all'].includes(sampleStr))) {\r\n            throw new Error('invalid sampleStr');\r\n        }\r\n\r\n        let result;\r\n\r\n        let srcCtx;\r\n        let srcImageData;\r\n        let srcData;\r\n\r\n        let targetCtx;\r\n        let targetImageData;\r\n        let targetData;\r\n\r\n\r\n        if (sampleStr === 'all') {\r\n\r\n            let srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\r\n            srcCtx = BB.ctx(srcCanvas);\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            srcCanvas = null;\r\n            srcCtx = null;\r\n            srcImageData = null;\r\n            srcData = null;\r\n\r\n            targetCtx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        } else {\r\n            const srcIndex = sampleStr === 'above' ? layerIndex + 1 : layerIndex;\r\n\r\n            if (srcIndex >= this.layerCanvasArr.length) {\r\n                return;\r\n            }\r\n\r\n            srcCtx = BB.ctx(this.layerCanvasArr[srcIndex]);\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            if (layerIndex !== srcIndex) {\r\n                srcCtx = null;\r\n                srcImageData = null;\r\n                srcData = null;\r\n            }\r\n\r\n            targetCtx = layerIndex === srcIndex ? srcCtx : BB.ctx(this.layerCanvasArr[layerIndex]);\r\n            targetImageData = layerIndex === srcIndex ? srcImageData : targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        }\r\n\r\n        targetData = targetImageData.data;\r\n        if (rgb) {\r\n            if (opacity === 1) {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4] = rgb.r;\r\n                        targetData[i * 4 + 1] = rgb.g;\r\n                        targetData[i * 4 + 2] = rgb.b;\r\n                        targetData[i * 4 + 3] = 255;\r\n                    }\r\n                }\r\n            } else {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4] = BB.mix(targetData[i * 4], rgb.r, opacity);\r\n                        targetData[i * 4 + 1] = BB.mix(targetData[i * 4 + 1], rgb.g, opacity);\r\n                        targetData[i * 4 + 2] = BB.mix(targetData[i * 4 + 2], rgb.b, opacity);\r\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 255, opacity);\r\n                    }\r\n                }\r\n            }\r\n        } else { // erase\r\n            if (opacity === 1) {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4 + 3] = 0;\r\n                    }\r\n                }\r\n            } else {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 0, opacity);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        targetCtx.putImageData(targetImageData, 0, 0);\r\n\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'replaceLayer',\r\n            params: [layerIndex, targetImageData],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    /**\r\n     * draw shape via BB.drawShape\r\n     * @param layerIndex\r\n     * @param shapeObj\r\n     */\r\n    drawShape (layerIndex: number, shapeObj: IShapeToolObject): void {\r\n        if (shapeObj.x1 === shapeObj.x2 && shapeObj.y1 === shapeObj.y2) {\r\n            return;\r\n        }\r\n        drawShape(BB.ctx(this.layerCanvasArr[layerIndex]), shapeObj);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'drawShape',\r\n            params: [layerIndex, BB.copyObj(shapeObj)],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    drawGradient (layerIndex: number, gradientObj: IGradient): void {\r\n        drawGradient(BB.ctx(this.layerCanvasArr[layerIndex]), gradientObj);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'drawGradient',\r\n            params: [layerIndex, BB.copyObj(gradientObj)],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    text (layerIndex: number, p: IRenderTextParam): void {\r\n        renderText(this.layerCanvasArr[layerIndex], BB.copyObj(p));\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'text',\r\n            params: [layerIndex, BB.copyObj(p)],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    replaceLayer (layerIndex: number, imageData: ImageData): void {\r\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n\r\n        // 2023-04-30 workaround for https://bugs.webkit.org/show_bug.cgi?id=256151\r\n        // todo remove eventually when safari fixed\r\n        ctx.fillRect(-1, -1, 1, 1);\r\n\r\n        ctx.putImageData(imageData, 0, 0);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'replaceLayer',\r\n            params: [layerIndex, imageData],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    clearLayer (layerIndex: number): void {\r\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'clearLayer',\r\n            params: [layerIndex],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    getLayers (): {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: TMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                context: BB.ctx(item),\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayersFast (): {\r\n        canvas: KlCanvasLayer;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: TMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                canvas: item,\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayerIndex (canvasObj: HTMLCanvasElement, doReturnNull?: boolean): null | number {\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            if (this.layerCanvasArr[i] === canvasObj) {\r\n                return i;\r\n            }\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error('layer not found (in ' + this.layerCanvasArr.length + ' layers)');\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getLayer (index: number, doReturnNull?: boolean): null | TKlCanvasLayer {\r\n        if (this.layerCanvasArr[index]) {\r\n            return {\r\n                context: BB.ctx(this.layerCanvasArr[index]),\r\n                opacity: this.layerCanvasArr[index].opacity,\r\n                name: this.layerCanvasArr[index].name,\r\n                id: index,\r\n            };\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error('layer of index ' + index + ' not found (in ' + this.layerCanvasArr.length + ' layers)');\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getColorAt (x: number, y: number): IRGB {\r\n        x = Math.floor(x);\r\n        y = Math.floor(y);\r\n        const ctx = BB.ctx(this.pickCanvas);\r\n        ctx.save();\r\n        ctx.imageSmoothingEnabled = false;\r\n        ctx.clearRect(0, 0, 1, 1);\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.globalAlpha = this.layerCanvasArr[i].opacity;\r\n            ctx.globalCompositeOperation = this.layerCanvasArr[i].mixModeStr;\r\n            ctx.drawImage(this.layerCanvasArr[i], -x, -y);\r\n        }\r\n        ctx.restore();\r\n        const imData = ctx.getImageData(0, 0, 1, 1);\r\n        return new BB.RGB(imData.data[0], imData.data[1], imData.data[2]);\r\n    }\r\n\r\n    getCompleteCanvas (factor: number): HTMLCanvasElement {\r\n        return drawProject(this.getProject(), factor);\r\n    }\r\n\r\n    getProject (): IKlProject {\r\n        return {\r\n            width: this.width,\r\n            height: this.height,\r\n            layers: this.layerCanvasArr.map(layer => {\r\n                return {\r\n                    name: layer.name,\r\n                    opacity: layer.opacity,\r\n                    mixModeStr: layer.mixModeStr,\r\n                    image: layer,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    addChangeListener (func: () => void): void {\r\n        if (this.changeListenerArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.changeListenerArr.push(func);\r\n    }\r\n\r\n    removeChangeListener (func: () => void): void {\r\n        for (let i = 0; i < this.changeListenerArr.length; i++) {\r\n            if (this.changeListenerArr[i] === func) {\r\n                this.changeListenerArr.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    setMixMode (layerIndex: number, mixModeStr: TMixMode): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'setMixMode',\r\n            params: [layerIndex, '' + mixModeStr],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    /**\r\n     * Set composite drawing step for KlCanvasWorkspace.\r\n     * To apply temporary manipulations to a layer.\r\n     *\r\n     * @param layerIndex\r\n     * @param compositeObj\r\n     */\r\n    setComposite (\r\n        layerIndex: number,\r\n        compositeObj: null | {\r\n            draw: (ctx: CanvasRenderingContext2D) => void;\r\n        }\r\n    ): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].compositeObj = compositeObj;\r\n    }\r\n\r\n    destroy (): void {\r\n        if (this.layerCanvasArr === null) {\r\n            return;\r\n        }\r\n        this.layerCanvasArr.forEach(canvas => {\r\n            BB.freeCanvas(canvas);\r\n        });\r\n        this.layerCanvasArr = null;\r\n    }\r\n\r\n}\r\n","\r\n/**\r\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/, but it implemented tolerance wrong, and had bugs.\r\n * So, my own implementation. can handle tolerance, grow, opacity.\r\n * Needs to be optimized.\r\n */\r\n\r\n/**\r\n * Set values in data within rect to 254, unless they're 255\r\n *\r\n * @param data Uint8Array\r\n * @param width int\r\n * @param x0 int\r\n * @param y0 int\r\n * @param x1 int >x0\r\n * @param y1 int >y0\r\n */\r\nfunction fillRect (data: Uint8Array, width: number, x0: number, y0: number, x1: number, y1: number): void {\r\n    for (let x = x0; x <= x1; x++) {\r\n        for (let y = y0; y <= y1; y++) {\r\n            if (data[y * width + x] === 255) {\r\n                continue;\r\n            }\r\n            data[y * width + x] = 254;\r\n        }\r\n    }\r\n}\r\n\r\nlet mx, my;\r\n\r\n/**\r\n * Get index i moved by dX, dY. in array with dimensions width height.\r\n * Returns null if outside bounds.\r\n *\r\n * @param width int\r\n * @param height int\r\n * @param i int\r\n * @param dX int\r\n * @param dY int\r\n */\r\nfunction moveIndex (width: number, height: number, i: number, dX: number, dY: number): (undefined | number) {\r\n    mx = i % width + dX;\r\n    my = Math.floor(i / width) + dY;\r\n\r\n    if (mx < 0 || my < 0 || mx >= width || my >= height) {\r\n        return undefined;\r\n    }\r\n\r\n    return my * width + mx;\r\n}\r\n\r\n/**\r\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\r\n * returns false if already filled, or i is null\r\n *\r\n * @param srcArr Uint8ClampedArray rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param initRgba rgba\r\n * @param tolerance int 0 - 255\r\n * @param i int - srcArr index\r\n * @returns {boolean}\r\n */\r\nfunction testAndFill (\r\n    srcArr: Uint8ClampedArray,\r\n    targetArr: Uint8Array,\r\n    width: number,\r\n    height: number,\r\n    initRgba: [number, number, number, number],\r\n    tolerance: number,\r\n    i: number | undefined,\r\n): boolean {\r\n    if (i === undefined || targetArr[i] === 255) {\r\n        return false;\r\n    }\r\n\r\n    if (\r\n        srcArr[i * 4] === initRgba[0] &&\r\n        srcArr[i * 4 + 1] === initRgba[1] &&\r\n        srcArr[i * 4 + 2] === initRgba[2] &&\r\n        srcArr[i * 4 + 3] === initRgba[3]\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    if (\r\n        tolerance > 0 &&\r\n        Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n\r\n/**\r\n *\r\n * @param srcArr Uint8ClampedArray rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param px int\r\n * @param py int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n */\r\nfunction floodFill (\r\n    srcArr: Uint8ClampedArray,\r\n    targetArr: Uint8Array,\r\n    width: number,\r\n    height: number,\r\n    px: number,\r\n    py: number,\r\n    tolerance: number,\r\n    grow: number,\r\n    isContiguous: boolean,\r\n): void {\r\n\r\n    const initRgba: [number, number, number, number] = [\r\n        srcArr[(py * width + px) * 4],\r\n        srcArr[(py * width + px) * 4 + 1],\r\n        srcArr[(py * width + px) * 4 + 2],\r\n        srcArr[(py * width + px) * 4 + 3],\r\n    ];\r\n\r\n    if (isContiguous) {\r\n        const q: number[] = [];\r\n        q.push(py * width + px);\r\n        targetArr[py * width + px] = 255;\r\n\r\n        let i: number, e: number | undefined;\r\n        while (q.length) {\r\n            i = q.pop() as number; // a test would slow down the code\r\n\r\n            // queue up unfilled neighbors\r\n            e = moveIndex(width, height, i, -1, 0); // left\r\n            // test will return false if e is undefined -> only numbers will be pushed to q\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n\r\n            e = moveIndex(width, height, i, 1, 0); // right\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n\r\n            e = moveIndex(width, height, i, 0, -1); // up\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n\r\n            e = moveIndex(width, height, i, 0, 1); // bottom\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n        }\r\n    } else {\r\n        for (let i = 0; i < width * height; i++) {\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i);\r\n        }\r\n    }\r\n\r\n    // grow\r\n    if (grow === 0) {\r\n        return;\r\n    }\r\n\r\n    // how does it grow? it finds all pixel at the edge.\r\n    // then depending on what kind of edge it is, it draws a rectangle into target\r\n    // the rectangle has the value 254, or else it will mess it all up.\r\n    // after it's all done, replaces it with 255\r\n    let x0, x1, y0, y1;\r\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\r\n    for (let x = 0; x < width; x++) {\r\n        for (let y = 0; y < height; y++) {\r\n            if (targetArr[y * width + x] !== 255) {\r\n                continue;\r\n            }\r\n\r\n            // bounds of rectangle\r\n            x0 = x;\r\n            x1 = x;\r\n            y0 = y;\r\n            y1 = y;\r\n\r\n            l = targetArr[(y) * width + x - 1] !== 255;\r\n            tl = targetArr[(y - 1) * width + x - 1] !== 255;\r\n            t = targetArr[(y - 1) * width + x] !== 255;\r\n            tr = targetArr[(y - 1) * width + x + 1] !== 255;\r\n            r = targetArr[(y) * width + x + 1] !== 255;\r\n            br = targetArr[(y + 1) * width + x + 1] !== 255;\r\n            b = targetArr[(y + 1) * width + x] !== 255;\r\n            bl = targetArr[(y + 1) * width + x - 1] !== 255;\r\n\r\n            if (l) { // left\r\n                x0 = x - grow;\r\n            }\r\n            if (l && tl && t) { // top left\r\n                x0 = x - grow;\r\n                y0 = y - grow;\r\n            }\r\n            if (t) { // top\r\n                y0 = Math.min(y0, y - grow);\r\n            }\r\n            if (t && tr && r) { // top right\r\n                y0 = Math.min(y0, y - grow);\r\n                x1 = x + grow;\r\n            }\r\n            if (r) { // right\r\n                x1 = Math.max(x1, x + grow);\r\n            }\r\n            if (r && br && b) { // bottom right\r\n                x1 = Math.max(x1, x + grow);\r\n                y1 = Math.max(y1, y + grow);\r\n            }\r\n            if (b) { // bottom\r\n                y1 = Math.max(y1, y + grow);\r\n            }\r\n            if (b && bl && l) { // bottom left\r\n                x0 = Math.min(x0, x - grow);\r\n                y1 = Math.max(y1, y + grow);\r\n            }\r\n\r\n            if (!l && !tl && !t && !tr && !r && !br && !b && !bl) {\r\n                continue;\r\n            }\r\n\r\n            fillRect(\r\n                targetArr,\r\n                width,\r\n                Math.max(0, x0),\r\n                Math.max(0, y0),\r\n                Math.min(width - 1, x1),\r\n                Math.min(height - 1, y1)\r\n            );\r\n        }\r\n    }\r\n    for (let i = 0; i < width * height; i++) {\r\n        if (targetArr[i] === 254) {\r\n            targetArr[i] = 255;\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * Does flood fill, and returns that. an array - 0 not filled. 255 filled\r\n\r\n * @param rgbaArr Uint8ClampedArray rgba\r\n * @param width int\r\n * @param height int\r\n * @param x int\r\n * @param y int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n */\r\nexport function floodFillBits (\r\n    rgbaArr: Uint8ClampedArray,\r\n    width: number,\r\n    height: number,\r\n    x: number,\r\n    y: number,\r\n    tolerance: number,\r\n    grow: number,\r\n    isContiguous: boolean,\r\n): {\r\n    data: Uint8Array;\r\n} {\r\n    x = Math.round(x);\r\n    y = Math.round(y);\r\n\r\n    const resultArr = new Uint8Array(new ArrayBuffer(width * height));\r\n\r\n    floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\r\n\r\n    return {\r\n        data: resultArr,\r\n    };\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB, IShapeToolObject} from '../kl-types';\r\n\r\n/**\r\n * Input processor for shape tool.\r\n * Coordinates are in canvas space.\r\n * angleRad is the angle of the canvas.\r\n */\r\nexport class ShapeTool {\r\n\r\n    private readonly onShape: (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\r\n    private downX: number = 0;\r\n    private downY: number = 0;\r\n    private downAngleRad: number = 0;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onShape: (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\r\n        }\r\n    ) {\r\n        this.onShape = p.onShape;\r\n    }\r\n\r\n    onDown (x: number, y: number, angleRad: number): void {\r\n        this.downX = x;\r\n        this.downY = y;\r\n        this.downAngleRad = angleRad;\r\n    }\r\n\r\n    onMove (x: number, y: number): void {\r\n        this.onShape(false, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n\r\n    onUp (x: number, y: number): void {\r\n        this.onShape(true, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n}\r\n\r\n/**\r\n * Draw a shape (rectangle, ellipse, line)\r\n */\r\nexport function drawShape (\r\n    ctx: CanvasRenderingContext2D,\r\n    shapeObj: IShapeToolObject,\r\n): void {\r\n    shapeObj = {\r\n        // defaults\r\n        angleRad: 0,\r\n        isOutwards: false,\r\n        opacity: 1,\r\n        isEraser: false,\r\n        doLockAlpha: false,\r\n\r\n        ...BB.copyObj(shapeObj),\r\n    };\r\n\r\n    if (['rect', 'ellipse', 'line'].includes(shapeObj.type)) {\r\n        if (shapeObj.angleRad === undefined) {\r\n            throw new Error('angleRad undefined');\r\n        }\r\n\r\n        const lineWidth = shapeObj.lineWidth === undefined ? -1 : Math.round(shapeObj.lineWidth);\r\n        const angleDeg = shapeObj.angleRad * 180 / Math.PI;\r\n\r\n        // --- prep color ---\r\n        if (!shapeObj.isEraser && shapeObj.fillRgb === undefined && shapeObj.strokeRgb === undefined) {\r\n            throw new Error('fillRgb and strokeRgb undefined');\r\n        }\r\n        const colorRGB: IRGB = shapeObj.isEraser ? {r: 255, g: 255, b: 255} : (shapeObj.fillRgb ? shapeObj.fillRgb : shapeObj.strokeRgb!);\r\n\r\n\r\n        // --- prep canvas ---\r\n        ctx.save();\r\n        if (shapeObj.opacity) {\r\n            ctx.globalAlpha = shapeObj.opacity;\r\n        }\r\n        if (shapeObj.isEraser) {\r\n            ctx.globalCompositeOperation = 'destination-out';\r\n        }\r\n        if (shapeObj.doLockAlpha) {\r\n            ctx.globalCompositeOperation = 'source-atop';\r\n        }\r\n        ctx.rotate(-shapeObj.angleRad);\r\n        if (shapeObj.fillRgb) {\r\n            ctx.fillStyle = BB.ColorConverter.toRgbStr(colorRGB);\r\n        } else if (shapeObj.strokeRgb) {\r\n            ctx.strokeStyle = BB.ColorConverter.toRgbStr(colorRGB);\r\n            ctx.lineWidth = lineWidth;\r\n        }\r\n\r\n        let x1 = shapeObj.x1;\r\n        let y1 = shapeObj.y1;\r\n        let x2 = shapeObj.x2;\r\n        let y2 = shapeObj.y2;\r\n\r\n        // --- angle snapping ---\r\n        if (shapeObj.isAngleSnap) {\r\n            const r1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            const r2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            const pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\r\n            const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\r\n            const rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\r\n            x2 = rotated.x;\r\n            y2 = rotated.y;\r\n\r\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\r\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\r\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\r\n                    x2 = x1;\r\n                } else { // left or right\r\n                    y2 = y1;\r\n                }\r\n            }\r\n        }\r\n\r\n        let x = x1;\r\n        let y = y1;\r\n        let dX = x2 - x1;\r\n        let dY = y2 - y1;\r\n\r\n        // --- 1:1 ratio ---\r\n        if (shapeObj.type !== 'line' && shapeObj.isFixedRatio) {\r\n            let r1 = BB.rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\r\n            let r2 = BB.rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            const rx = r1.x;\r\n            const ry = r1.y;\r\n            let rdX = r2.x - r1.x;\r\n            let rdY = r2.y - r1.y;\r\n\r\n            if (Math.abs(rdX) < Math.abs(rdY)) {\r\n                rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\r\n            } else {\r\n                rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\r\n            }\r\n            r2.x = rx + rdX;\r\n            r2.y = ry + rdY;\r\n\r\n            r1 = BB.rotate(r1.x, r1.y, -shapeObj.angleRad / Math.PI * 180);\r\n            r2 = BB.rotate(r2.x, r2.y, -shapeObj.angleRad / Math.PI * 180);\r\n\r\n            x1 = r1.x;\r\n            y1 = r1.y;\r\n            x2 = r2.x;\r\n            y2 = r2.y;\r\n\r\n            x = x1;\r\n            y = y1;\r\n            dX = x2 - x1;\r\n            dY = y2 - y1;\r\n        }\r\n\r\n        // outwards modifier\r\n        if (shapeObj.isOutwards) {\r\n            x -= dX;\r\n            y -= dY;\r\n            dX *= 2;\r\n            dY *= 2;\r\n\r\n            x1 = x;\r\n            y1 = y;\r\n            x2 = x + dX;\r\n            y2 = y + dY;\r\n        }\r\n\r\n        let p1;\r\n        let p2;\r\n        if (shapeObj.type === 'line') { // --- line ---\r\n\r\n            // rounded\r\n            const x1r = Math.round(x1);\r\n            const y1r = Math.round(y1);\r\n            const x2r = Math.round(x2);\r\n            const y2r = Math.round(y2);\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (lineWidth % 2 === 0) {\r\n\r\n                if (y1r === y2r) {\r\n                    p1 = {\r\n                        x: x1f,\r\n                        y: y1r,\r\n                    };\r\n                    p2 = {\r\n                        x: x2f,\r\n                        y: y2r,\r\n                    };\r\n\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                } else if (x1r === x2r) {\r\n                    p1 = {\r\n                        x: x1r,\r\n                        y: y1f,\r\n                    };\r\n                    p2 = {\r\n                        x: x2r,\r\n                        y: y2f,\r\n                    };\r\n\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                } else {\r\n                    p1 = {\r\n                        x: x1,\r\n                        y: y1,\r\n                    };\r\n                    p2 = {\r\n                        x: x2,\r\n                        y: y2,\r\n                    };\r\n                }\r\n\r\n            } else {\r\n                p1 = {\r\n                    x: x1f,\r\n                    y: y1f,\r\n                };\r\n                p2 = {\r\n                    x: x2f,\r\n                    y: y2f,\r\n                };\r\n                if (y1f === y2f) {\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                    p1.y += 0.5;\r\n                    p2.y += 0.5;\r\n                } else if (x1f === x2f) {\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                    p1.x += 0.5;\r\n                    p2.x += 0.5;\r\n                } else {\r\n                    p1.x = x1;\r\n                    p1.y = y1;\r\n                    p2.x = x2;\r\n                    p2.y = y2;\r\n                }\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            ctx.beginPath();\r\n            ctx.moveTo(p1.x, p1.y);\r\n            ctx.lineTo(p2.x, p2.y);\r\n            ctx.stroke();\r\n\r\n        } else if (shapeObj.type === 'rect') { // --- rect ---\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (angleDeg % 90 === 0) {\r\n                if (shapeObj.fillRgb) {\r\n                    if (x1 % 1 === 0) {\r\n                        x1 += 1;\r\n                    }\r\n                    if (y1 % 1 === 0) {\r\n                        y1 += 1;\r\n                    }\r\n                    if (x2 % 1 === 0) {\r\n                        x2 += 1;\r\n                    }\r\n                    if (y2 % 1 === 0) {\r\n                        y2 += 1;\r\n                    }\r\n\r\n                    p1 = {\r\n                        x: x1 < x2 ? x1f : x2f,\r\n                        y: y1 < y2 ? y1f : y2f,\r\n                    };\r\n                    p2 = {\r\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\r\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y),\r\n                    };\r\n                    p2.x = p1.x + p2.x;\r\n                    p2.y = p1.y + p2.y;\r\n\r\n                } else {\r\n                    if (lineWidth % 2 === 0) {\r\n                        p1 = {\r\n                            x: x1f,\r\n                            y: y1f,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f,\r\n                            y: y2f,\r\n                        };\r\n                    } else {\r\n                        p1 = {\r\n                            x: x1f + 0.5,\r\n                            y: y1f + 0.5,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f + 0.5,\r\n                            y: y2f + 0.5,\r\n                        };\r\n                    }\r\n                }\r\n            } else {\r\n                p1 = {\r\n                    x: x1,\r\n                    y: y1,\r\n                };\r\n                p2 = {\r\n                    x: x2,\r\n                    y: y2,\r\n                };\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2.x = p2.x - p1.x;\r\n            p2.y = p2.y - p1.y;\r\n\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\r\n            } else {\r\n                ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\r\n            }\r\n\r\n        } else {  // --- circle ---\r\n            p1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n            x = p1.x;\r\n            y = p1.y;\r\n            dX = p2.x - p1.x;\r\n            dY = p2.y - p1.y;\r\n\r\n            ctx.beginPath();\r\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fill();\r\n            } else {\r\n                ctx.stroke();\r\n            }\r\n        }\r\n\r\n\r\n        ctx.restore();\r\n\r\n    } else {\r\n        throw new Error('unknown shape');\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {IRect} from '../../bb/bb-types';\r\n\r\nexport interface IRenderTextParam {\r\n    textStr: string; // text to be drawn. can contain newlines\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\r\n    align: 'left' | 'center' | 'right'; // default 'left'\r\n    isBold: boolean; // default false\r\n    isItalic: boolean; // default false\r\n    angleRad: number; // default 0 - rotates around x y\r\n    lineHeight?: number; // pixels\r\n    color: string;\r\n    isDebug?: boolean;\r\n}\r\n\r\n\r\n/**\r\n * Draw text on a canvas.\r\n *\r\n * @param canvas\r\n * @param p\r\n * @returns - bounds. coords relative to p.x p.y\r\n */\r\nexport function renderText (canvas: HTMLCanvasElement, p: IRenderTextParam): IRect {\r\n\r\n    // always at least a space. so bounds aren't just a dot\r\n    const textStr = p.textStr === '' ? ' ' : p.textStr;\r\n\r\n    // --- create el ---\r\n    // create an actual dom element. figure out where exactly each letter is positioned.\r\n    // that way multiline is feasible. canvas can't do multiline or text-align\r\n    const outer = BB.el({\r\n        css: {\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            width: '100000px',\r\n            fontSize: p.size + 'px',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n        },\r\n    });\r\n    const div = BB.el({\r\n        parent: outer,\r\n        css: {\r\n            display: 'inline-block',\r\n            textAlign: p.align ? p.align : 'left',\r\n            fontFamily: p.font ? p.font : 'sans-serif',\r\n            fontSize: p.size + 'px',\r\n            fontWeight: p.isBold ? 'bold' : 'normal',\r\n            fontStyle: p.isItalic ? 'italic' : 'normal',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n\r\n\r\n            opacity: '0',\r\n            pointerEvents: 'none',\r\n        },\r\n    });\r\n    let spanStr = '';\r\n    const replaceObj = {\r\n        '\\n': '<br>',\r\n        ' ': '&nbsp;',\r\n        '\t': '&nbsp;&nbsp;&nbsp;&nbsp;',\r\n    };\r\n    for (let i = 0; i < textStr.length; i++) {\r\n        if (textStr[i] === '\\n') {\r\n            BB.el({\r\n                parent: div,\r\n                tagName: 'span',\r\n                textContent: spanStr,\r\n                css: {\r\n                    whiteSpace: 'pre',\r\n                },\r\n            });\r\n            spanStr = '';\r\n            div.append(BB.el({\r\n                tagName: 'br',\r\n            }));\r\n            continue;\r\n        }\r\n        spanStr += textStr[i].replace('\\t', '    ');\r\n    }\r\n    BB.el({\r\n        parent: div,\r\n        tagName: 'span',\r\n        textContent: spanStr,\r\n        css: {\r\n            whiteSpace: 'pre',\r\n        },\r\n    });\r\n    document.body.append(outer);\r\n\r\n\r\n    // --- determine bounds ---\r\n    const bounds = {\r\n        x0: 99999999,\r\n        y0: 99999999,\r\n        x1: 0,\r\n        y1: 0,\r\n    };\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        const el = div.children[i] as HTMLElement;\r\n        bounds.x0 = Math.min(bounds.x0, el.offsetLeft);\r\n        bounds.y0 = Math.min(bounds.y0, el.offsetTop);\r\n        bounds.x1 = Math.max(bounds.x1, el.offsetLeft + el.offsetWidth);\r\n        bounds.y1 = Math.max(bounds.y1, el.offsetTop + el.offsetHeight);\r\n    }\r\n\r\n    // --- draw ---\r\n    const ctx = BB.ctx(canvas);\r\n    ctx.save();\r\n\r\n    const font = [];\r\n    if (p.isItalic) {\r\n        font.push('italic');\r\n    }\r\n    if (p.isBold) {\r\n        font.push('bold');\r\n    }\r\n    font.push(p.size + 'px ' + (p.font ? p.font : 'sans-serif'));\r\n    ctx.font = font.join(' ');\r\n    ctx.fillStyle = p.color ? p.color : '#000';\r\n\r\n    let x = p.x;\r\n    const y = p.y;\r\n    if (p.align === 'right') {\r\n        x += -bounds.x1 + bounds.x0;\r\n    }\r\n    if (p.align === 'center') {\r\n        x += (-bounds.x1 + bounds.x0) / 2;\r\n    }\r\n    ctx.translate(p.x, p.y);\r\n    ctx.rotate(p.angleRad ? -p.angleRad : 0);\r\n    ctx.translate(-p.x, -p.y);\r\n    ctx.translate(x, y);\r\n\r\n    // fill\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        const el = div.children[i] as HTMLElement;\r\n\r\n        //ctx.fillText(el.innerText, 0, 0);\r\n        ctx.fillText(el.innerText, el.offsetLeft, el.offsetTop);\r\n    }\r\n\r\n    if (p.isDebug) {\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeRect(0, -p.size * 0.85, bounds.x1, bounds.y1);\r\n        ctx.restore();\r\n        ctx.fillRect(p.x - 1, p.y - 1, 2, 2);\r\n    } else {\r\n        ctx.restore();\r\n    }\r\n\r\n    document.body.removeChild(outer);\r\n\r\n    return {\r\n        x: x - p.x,\r\n        y: y - p.y -p.size * 0.85,\r\n        width: bounds.x1 - bounds.x0,\r\n        height: bounds.y1 - bounds.y0,\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IKlProject} from '../kl-types';\r\n\r\nexport function drawProject (project: IKlProject, factor: number): HTMLCanvasElement {\r\n    const resultCanvas = BB.canvas(\r\n        Math.max(1, Math.round(project.width * factor)),\r\n        Math.max(1, Math.round(project.height * factor))\r\n    );\r\n    const ctx = BB.ctx(resultCanvas);\r\n    ctx.save();\r\n    if (factor > 1) {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n    for (let i = 0; i < project.layers.length; i++) {\r\n        if (project.layers[i].opacity === 0) {\r\n            continue;\r\n        }\r\n        ctx.globalAlpha = project.layers[i].opacity;\r\n        const mixModeStr = project.layers[i].mixModeStr;\r\n        ctx.globalCompositeOperation = mixModeStr !== undefined ? mixModeStr : 'source-over';\r\n        ctx.drawImage(project.layers[i].image, 0, 0, resultCanvas.width, resultCanvas.height);\r\n    }\r\n    ctx.restore();\r\n    return resultCanvas;\r\n}","import {IGradient} from '../kl-types';\r\nimport {BB} from '../../bb/bb';\r\n\r\n\r\ntype TOnGradient = (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\r\n\r\n/**\r\n * Input processor for gradient tool.\r\n * Coordinates are in canvas space.\r\n * angleRad is the angle of the canvas.\r\n */\r\nexport class GradientTool {\r\n    private downX: number;\r\n    private downY: number;\r\n    private downAngleRad: number;\r\n    private readonly onGradient: TOnGradient;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onGradient: TOnGradient;\r\n        }\r\n    ) {\r\n        this.onGradient = p.onGradient;\r\n    }\r\n\r\n    onDown (x: number, y: number, angleRad: number): void {\r\n        this.downX = x;\r\n        this.downY = y;\r\n        this.downAngleRad = angleRad;\r\n    }\r\n\r\n    onMove (x: number, y: number): void {\r\n        this.onGradient(false, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n\r\n    onUp (x: number, y: number): void {\r\n        this.onGradient(true, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n}\r\n\r\nexport function drawGradient (\r\n    ctx: CanvasRenderingContext2D,\r\n    gradientObj: IGradient,\r\n): void {\r\n    ctx.save();\r\n\r\n    const x1 = gradientObj.x1;\r\n    const y1 = gradientObj.y1;\r\n    let x2 = gradientObj.x2;\r\n    let y2 = gradientObj.y2;\r\n\r\n    if (gradientObj.doSnap) {\r\n        const angleDeg = gradientObj.angleRad * 180 / Math.PI;\r\n\r\n        const r1 = BB.rotate(x1, y1, gradientObj.angleRad / Math.PI * 180);\r\n        const r2 = BB.rotate(x2, y2, gradientObj.angleRad / Math.PI * 180);\r\n\r\n        const pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\r\n        const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\r\n        const rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\r\n        x2 = rotated.x;\r\n        y2 = rotated.y;\r\n\r\n        // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\r\n        if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\r\n            if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\r\n                x2 = x1;\r\n            } else { // left or right\r\n                y2 = y1;\r\n            }\r\n        }\r\n    }\r\n\r\n    let baseColor = gradientObj.color1;\r\n    if (gradientObj.isEraser && gradientObj.doLockAlpha) {\r\n        baseColor = {r: 255, g: 255, b: 255};\r\n    }\r\n    let color1 = BB.copyObj(baseColor);\r\n    color1.a = gradientObj.opacity;\r\n    let color2 = BB.copyObj(baseColor);\r\n    color2.a = 0;\r\n    if (gradientObj.isReversed) {\r\n        const temp = color1;\r\n        color1 = color2;\r\n        color2 = temp;\r\n    }\r\n\r\n    let gradient: CanvasGradient;\r\n    if (gradientObj.type === 'linear') {\r\n        gradient = ctx.createLinearGradient(x1, y1, x2, y2);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n\r\n    } else if (gradientObj.type === 'linear-mirror') {\r\n        const d = {\r\n            x: x2 - x1,\r\n            y: y2 - y1,\r\n        };\r\n        gradient = ctx.createLinearGradient(x1 - d.x,y1 - d.y, x2, y2);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color2));\r\n        gradient.addColorStop(0.5, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n\r\n    } else if (gradientObj.type === 'radial') {\r\n        const r = BB.Vec2.dist(\r\n            {x: x1, y: y1},\r\n            {x: x2, y: y2},\r\n        );\r\n        gradient = ctx.createRadialGradient(x1, y1, 0, x1, y1, r);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n    }\r\n\r\n    ctx.fillStyle = gradient!;\r\n    if (gradientObj.isEraser) {\r\n        ctx.globalCompositeOperation = 'destination-out';\r\n    }\r\n    if (gradientObj.doLockAlpha) {\r\n        ctx.globalCompositeOperation = 'source-atop';\r\n    }\r\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n\r\n    ctx.restore();\r\n}","import {TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TTranslationCode} from '../../../languages/languages';\r\n\r\nexport function translateBlending (blendMode?: TMixMode): string {\r\n    if (!blendMode) {\r\n        return LANG('layers-blend-normal');\r\n    }\r\n\r\n    const codes: {\r\n        [key: string]: TTranslationCode;\r\n    } = {\r\n        'source-over': 'layers-blend-normal',\r\n        'darken': 'layers-blend-darken',\r\n        'multiply': 'layers-blend-multiply',\r\n        'color-burn': 'layers-blend-color-burn',\r\n        'lighten': 'layers-blend-lighten',\r\n        'screen': 'layers-blend-screen',\r\n        'color-dodge': 'layers-blend-color-dodge',\r\n        'overlay': 'layers-blend-overlay',\r\n        'soft-light': 'layers-blend-soft-light',\r\n        'hard-light': 'layers-blend-hard-light',\r\n        'difference': 'layers-blend-difference',\r\n        'exclusion': 'layers-blend-exclusion',\r\n        'hue': 'layers-blend-hue',\r\n        'saturation': 'layers-blend-saturation',\r\n        'color': 'layers-blend-color',\r\n        'luminosity': 'layers-blend-luminosity',\r\n    };\r\n\r\n    if (!(blendMode in codes)) {\r\n        throw new Error('unknown blend mode');\r\n    }\r\n    return LANG(codes[blendMode]);\r\n}","import {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport {showModal} from '../../modals/base/showModal';\r\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\r\n\r\n\r\nexport function renameLayerDialog (\r\n    parentEl: HTMLElement,\r\n    currentName: string,\r\n    callback: (newName: string | undefined) => void\r\n): void {\r\n    const div = BB.el();\r\n\r\n    const label = BB.el({\r\n        content: LANG('layers-rename-name') + ':',\r\n        css: {\r\n            marginRight: '5px',\r\n        },\r\n    });\r\n\r\n    const row = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n        },\r\n    });\r\n    const input = BB.el({tagName: 'input'}) as HTMLInputElement;\r\n    input.value = currentName;\r\n    input.setAttribute('data-ignore-focus', 'true');\r\n    const clearBtn = BB.el({\r\n        tagName: 'Button',\r\n        content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/>',\r\n        title: LANG('layers-rename-clear'),\r\n        css: {\r\n            marginLeft: '10px',\r\n        },\r\n        onClick: () => {\r\n            input.value = '';\r\n            input.focus();\r\n        },\r\n    });\r\n    const suggestions = [\r\n        LANG('layers-rename-sketch'),\r\n        LANG('layers-rename-colors'),\r\n        LANG('layers-rename-shading'),\r\n        LANG('layers-rename-lines'),\r\n        LANG('layers-rename-effects'),\r\n        LANG('background'),\r\n        LANG('layers-rename-foreground'),\r\n    ];\r\n    const suggestionBtns: HTMLButtonElement[] = [];\r\n    const row2 = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            flexWrap: 'wrap',\r\n            marginTop: '5px',\r\n            marginLeft: '-5px',\r\n        },\r\n    }) as HTMLDivElement;\r\n    suggestions.forEach(item => {\r\n        const btn = BB.el({\r\n            parent: row2,\r\n            tagName: 'Button',\r\n            content: item,\r\n            onClick: () => {\r\n                input.value = '' + btn.textContent;\r\n            },\r\n            css: {\r\n                margin: '5px 0 0 5px',\r\n            },\r\n        }) as HTMLButtonElement;\r\n        suggestionBtns.push(btn);\r\n    });\r\n\r\n    div.append(label);\r\n    label.append(row, row2);\r\n    row.append(input, clearBtn);\r\n\r\n    setTimeout(() => {\r\n        input.focus();\r\n        input.select();\r\n    }, 10);\r\n\r\n    showModal({\r\n        target: parentEl,\r\n        message: `<b>${LANG('layers-rename-title')}</b>`,\r\n        div: div,\r\n        buttons: [LANG('layers-rename'), 'Cancel'],\r\n        primaries: [LANG('layers-rename')],\r\n        callback: (val) => {\r\n            BB.destroyEl(clearBtn);\r\n            suggestionBtns.forEach(item => {\r\n                BB.destroyEl(item);\r\n            });\r\n            suggestionBtns.splice(0, suggestionBtns.length);\r\n            if (val === LANG('layers-rename')) {\r\n                callback(input.value);\r\n            } else {\r\n                callback(undefined);\r\n            }\r\n        },\r\n        clickOnEnter: LANG('layers-rename'),\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1twgF\");","import {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport {Options} from '../../components/options';\r\nimport {translateBlending} from '../../../canvas/translate-blending';\r\nimport {showModal} from '../../modals/base/showModal';\r\nimport {TMixMode} from '../../../kl-types';\r\nimport {theme} from '../../../../theme/theme';\r\n\r\nexport function mergeLayerDialog (\r\n    parentEl: HTMLElement,\r\n    p: {\r\n        topCanvas: HTMLCanvasElement;\r\n        bottomCanvas: HTMLCanvasElement;\r\n        topOpacity: number;\r\n        mixModeStr: TMixMode;\r\n        callback: (mode?: string) => void;\r\n    }\r\n): void {\r\n    const div = BB.el();\r\n    div.innerHTML = LANG('layers-merge-description');\r\n\r\n    const options = new Options({\r\n        optionArr: [\r\n            {id: p.mixModeStr, label: translateBlending(p.mixModeStr)},\r\n            {id: 'source-in', label: 'source-in'},\r\n            {id: 'source-out', label: 'source-out'},\r\n            {id: 'source-atop', label: 'source-atop'},\r\n            {id: 'destination-in', label: 'destination-in'},\r\n            {id: 'destination-out', label: 'destination-out'},\r\n            {id: 'destination-atop', label: 'destination-atop'},\r\n            {id: 'xor', label: 'xor'},\r\n        ],\r\n        initId: p.mixModeStr,\r\n        onChange: () => {\r\n            update();\r\n        },\r\n        isSmall: true,\r\n    });\r\n    options.getElement().style.marginTop = '5px';\r\n    div.append(options.getElement());\r\n\r\n    const thumbDimensions = BB.fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\r\n    const preview = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n    preview.title = LANG('preview');\r\n    preview.className = 'kl-merge-preview';\r\n    const spacer = BB.el({\r\n        content: '<br/>',\r\n        css: {\r\n            clear: 'both',\r\n        },\r\n    });\r\n    div.append(spacer, preview);\r\n\r\n    function updateCheckerboard (): void {\r\n        BB.createCheckerDataUrl(4, (url) => {\r\n            preview.style.backgroundImage = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n    }\r\n    updateCheckerboard();\r\n    theme.addIsDarkListener(updateCheckerboard);\r\n\r\n    const alphaCanvas = BB.copyCanvas(preview);\r\n    BB.ctx(alphaCanvas).drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\r\n    BB.convertToAlphaChannelCanvas(alphaCanvas);\r\n\r\n    const update = () => {\r\n        const ctx = BB.ctx(preview);\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, preview.width, preview.height);\r\n        if (preview.width > p.topCanvas.width) {\r\n            ctx.imageSmoothingEnabled = false;\r\n        }\r\n        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\r\n\r\n        if (options.getValue() === 'as-alpha') {\r\n            ctx.globalCompositeOperation = 'destination-in';\r\n            ctx.globalAlpha = p.topOpacity;\r\n            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\r\n        } else {\r\n            ctx.globalCompositeOperation = options.getValue();\r\n            ctx.globalAlpha = p.topOpacity;\r\n            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\r\n        }\r\n        ctx.restore();\r\n    };\r\n\r\n    update();\r\n\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: (keyStr: string) => {\r\n            if (keyStr === 'right') {\r\n                options.next();\r\n            }\r\n            if (keyStr === 'left') {\r\n                options.previous();\r\n            }\r\n        },\r\n    });\r\n\r\n    showModal({\r\n        target: parentEl,\r\n        message: `<b>${LANG('layers-merge-modal-title')}</b>`,\r\n        div: div,\r\n        buttons: ['Ok', 'Cancel'],\r\n        clickOnEnter: 'Ok',\r\n        callback: (val) => {\r\n            keyListener.destroy();\r\n            options.destroy();\r\n            theme.removeIsDarkListener(updateCheckerboard);\r\n            if (val === 'Ok') {\r\n                p.callback(options.getValue());\r\n            }\r\n        },\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"70WHw\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3huo1\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1AvFX\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ftA1L\");","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl-types';\r\n\r\n/**\r\n * Overlay for KlCanvasWorkspace.\r\n * - brush circle\r\n * - eyedropper circle\r\n * - compass needle (rotation hud)\r\n */\r\nexport class WorkspaceSvgOverlay {\r\n    private readonly rootElement: SVGElement;\r\n    private readonly brushCircleOuter: SVGElement;\r\n    private readonly brushCircleInner: SVGElement;\r\n    private readonly pickerPreviewBorder: SVGElement;\r\n    private readonly pickerPreviewCol: SVGElement;\r\n    private readonly compassSize: number;\r\n    private readonly compass: SVGElement;\r\n    private readonly compassInner: SVGElement;\r\n    private readonly compassBaseCircle: SVGElement;\r\n    private readonly compassLineCircle: SVGElement;\r\n    private readonly compassUpperTriangle: SVGElement;\r\n    private readonly compassLowerTriangle: SVGElement;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n        }\r\n    ) {\r\n        this.rootElement = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + p.width,\r\n            height: '' + p.height,\r\n        });\r\n        BB.css(this.rootElement, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            pointerEvents: 'none',\r\n            userSelect: 'none',\r\n        });\r\n\r\n        //brush circles\r\n        this.brushCircleOuter = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '10',\r\n            stroke: 'rgba(0,0,0,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.brushCircleInner = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '9',\r\n            stroke: 'rgba(255,255,255,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\r\n\r\n        //color picker preview circle\r\n        this.pickerPreviewBorder = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '22',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewBorder.style.opacity = '0';\r\n        this.pickerPreviewCol = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '20',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewCol.style.opacity = '0';\r\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\r\n\r\n\r\n        //rotation compass\r\n        this.compassSize = 30;\r\n        this.compass = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'translate(' + (p.width/2) + ', ' + (p.height/2) + ')',\r\n        });\r\n        BB.css(this.compass, {\r\n            transition: 'opacity 0.25s ease-in-out',\r\n            opacity: '0',\r\n        });\r\n        this.compassInner = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'rotate(45)',\r\n        });\r\n        this.compassBaseCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'rgba(0,0,0,0.9)',\r\n            stroke: 'none',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + this.compassSize,\r\n        });\r\n        this.compassLineCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'none',\r\n            stroke: 'rgba(255,255,255,0.75)',\r\n            'stroke-width': '1',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + (this.compassSize * 0.9),\r\n        });\r\n        this.compassUpperTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#f00',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,-'+(this.compassSize * 0.9)+' z',\r\n        });\r\n        this.compassLowerTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#fff',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,'+(this.compassSize * 0.9)+' z',\r\n        });\r\n\r\n        this.compassInner.append(\r\n            this.compassBaseCircle,\r\n            this.compassLineCircle,\r\n            this.compassUpperTriangle,\r\n            this.compassLowerTriangle\r\n        );\r\n        this.compass.append(this.compassInner);\r\n        this.rootElement.append(this.compass);\r\n    }\r\n\r\n    getElement (): SVGElement {\r\n        return this.rootElement;\r\n    }\r\n\r\n    setSize (width: number, height: number): void {\r\n        this.rootElement.setAttribute('width', '' + width);\r\n        this.rootElement.setAttribute('height', '' + height);\r\n        this.compass.setAttribute('transform', 'translate(' + (width/2) + ', ' + (height/2) + ')');\r\n    }\r\n\r\n    updateCursor (p: {\r\n        x?: number;\r\n        y?: number;\r\n        radius?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if (p.x !== undefined) {\r\n            this.brushCircleOuter.setAttribute('cx', '' + p.x);\r\n            this.brushCircleInner.setAttribute('cx', '' + p.x);\r\n        }\r\n        if (p.y !== undefined) {\r\n            this.brushCircleOuter.setAttribute('cy', '' + p.y);\r\n            this.brushCircleInner.setAttribute('cy', '' + p.y);\r\n        }\r\n        if (p.radius !== undefined) {\r\n            this.brushCircleOuter.setAttribute('r', '' + Math.max(0, p.radius));\r\n            this.brushCircleInner.setAttribute('r', '' + Math.max(0, p.radius - 1));\r\n        }\r\n        if (p.isVisible !== undefined) {\r\n            this.brushCircleOuter.style.opacity = p.isVisible ? '1' : '0';\r\n            this.brushCircleInner.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateColorPreview (p: {\r\n        x?: number;\r\n        y?: number;\r\n        color?: IRGB;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if (p.x !== undefined) {\r\n            this.pickerPreviewCol.setAttribute('cx', '' + p.x);\r\n            this.pickerPreviewBorder.setAttribute('cx', '' + p.x);\r\n        }\r\n        if (p.y !== undefined) {\r\n            this.pickerPreviewCol.setAttribute('cy', '' + p.y);\r\n            this.pickerPreviewBorder.setAttribute('cy', '' + p.y);\r\n        }\r\n        if (p.color) {\r\n            this.pickerPreviewCol.setAttribute('stroke', BB.ColorConverter.toRgbStr(p.color));\r\n            const borderColor = BB.testIsWhiteBestContrast(p.color) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)';\r\n            this.pickerPreviewBorder.setAttribute('stroke', borderColor);\r\n        }\r\n        if (p.isVisible !== undefined) {\r\n            this.pickerPreviewCol.style.opacity = p.isVisible ? '1' : '0';\r\n            this.pickerPreviewBorder.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateCompass (p: {\r\n        angleDeg?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if (p.angleDeg !== undefined) {\r\n            this.compassInner.setAttribute('transform', 'rotate(' + p.angleDeg + ')');\r\n            this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? '1' : '0';\r\n        }\r\n        if (p.isVisible !== undefined) {\r\n            this.compass.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB, ITransform, TDrawEvent} from '../kl-types';\r\nimport {WorkspaceSvgOverlay} from './workspace-svg-overlay';\r\nimport {klHistory} from '../history/kl-history';\r\nimport pickerImg from '/src/app/img/ui/cursor-picker.png';\r\nimport zoomEwImg from '/src/app/img/ui/cursor-zoom-ew.png';\r\nimport fillImg from '/src/app/img/ui/cursor-fill.png';\r\nimport textImg from '/src/app/img/ui/cursor-text.png';\r\nimport {IPressureInput, IVector2D} from '../../bb/bb-types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {KeyListener} from '../../bb/input/key-listener';\r\nimport {KL} from '../kl';\r\nimport {IPointerEvent} from '../../bb/input/event.types';\r\nimport {LinetoolProcessor} from '../events/linetool-processor';\r\nimport {PinchZoomer} from '../../bb/input/event-chain/pinch-zoomer';\r\nimport {DoubleTapper} from '../../bb/input/event-chain/double-tapper';\r\nimport {NFingerTapper} from '../../bb/input/event-chain/n-finger-tapper';\r\nimport {EventChain} from '../../bb/input/event-chain/event-chain';\r\nimport {PointerListener} from '../../bb/input/pointer-listener';\r\nimport {theme} from '../../theme/theme';\r\n\r\nexport interface IViewChangeEvent {\r\n    changed: ('scale' | 'angle')[];\r\n    angle: number;\r\n    scale: number;\r\n}\r\n\r\ntype TModeStr = 'draw' | 'pick' | 'hand' | 'shape' | 'fill' | 'gradient' | 'text'; // | 'transform' | 'select'\r\n\r\nconst MIN_SCALE = 1 / 16;\r\nconst MAX_SCALE = 64;\r\nenum TMode {\r\n    Draw,\r\n    Hand,\r\n    HandGrabbing,\r\n    Pick,\r\n    Zoom,\r\n    Rotate,\r\n    Rotating,\r\n    Fill,\r\n    Gradient,\r\n    Text,\r\n    Shape,\r\n}\r\nconst ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\r\n\r\n/**\r\n * Work area that displays the KlCanvas.\r\n * - pan, zoom, rotate (also via multi-touch)\r\n * - input modes: drawing, hand, pick, fill, text // transform, select\r\n * - drawing input events\r\n * - view change events\r\n * - eyedropper input events (pick)\r\n * - draws cursor, eyedropper overlay\r\n *\r\n * subscribes to klCanvas changes\r\n * listens to kl history for changes\r\n * and you can manually trigger redraw\r\n */\r\nexport class KlCanvasWorkspace {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private klCanvas: KlCanvas;\r\n    private readonly renderTargetCanvas: HTMLCanvasElement;\r\n    private readonly renderTargetCtx: CanvasRenderingContext2D;\r\n    private renderWidth: number;\r\n    private renderHeight: number;\r\n    private readonly compositeCanvas: HTMLCanvasElement; // for drawing klcanvas layer composite\r\n    private readonly compositeCtx: CanvasRenderingContext2D;\r\n    private doResizeCanvas: boolean;\r\n    private oldTransformObj: ITransform;\r\n    private targetTransformObj: ITransform; // animation target\r\n    private highResTransformObj: ITransform; // animated, internal high res\r\n    private readonly renderedTransformObj: ITransform; // same as highRes, but rounded - what's actually displayed\r\n    private cursorPos: IVector2D;\r\n    private readonly usesCssCursor: boolean;\r\n    private bgVisible: boolean;\r\n    private transformIsDirty: boolean;\r\n    private doAnimateTranslate: boolean;\r\n    private svgOverlay: WorkspaceSvgOverlay;\r\n    private readonly emptyCanvas: HTMLCanvasElement;\r\n    private readonly emptyLightCanvas: HTMLCanvasElement;\r\n    private keyListener: KeyListener;\r\n    private currentMode: TMode;\r\n    private globalMode: TMode;\r\n    private renderTime: number; // for debugging - average ms per render()\r\n    private lastDrawEvent: IPressureInput | null; // previous drawing input\r\n    private linetoolProcessor: LinetoolProcessor;\r\n    private pointer: IVector2D | null; // position of cursor\r\n    private isDrawing: boolean;\r\n    private inputProcessorObj: any; // todo type\r\n    private currentInputProcessor: any; // todo type\r\n    private angleIsExtraSticky: boolean;\r\n    private readonly pinchZoomer: PinchZoomer;\r\n    private readonly mainDoubleTapper: DoubleTapper;\r\n    private readonly middleDoubleTapper: DoubleTapper;\r\n    private readonly twoFingerTap: NFingerTapper;\r\n    private readonly threeFingerTap: NFingerTapper;\r\n    private pointerEventChain: EventChain;\r\n    private pointerListener: PointerListener | undefined;\r\n    private brushRadius: number;\r\n    private animationFrameRequested: boolean;\r\n    private lastRenderedState: number; // KlHistory state - to detect if there are changes to draw\r\n    private lastRenderTime: number; // ms from performance.now()\r\n    private hideBrushCursorTimeout: (ReturnType<typeof setTimeout>) | undefined;\r\n    private readonly onViewChange: (e:  IViewChangeEvent) => void;\r\n\r\n    private getRenderedTransform (): ITransform {\r\n        // rounded x & y so canvas is less blurry.\r\n        const result = this.renderedTransformObj;\r\n        result.x = this.highResTransformObj.x;\r\n        result.y = this.highResTransformObj.y;\r\n        result.scale = this.highResTransformObj.scale;\r\n        result.angle = this.highResTransformObj.angle;\r\n\r\n        if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\r\n            result.x = Math.round(result.x);\r\n            result.y = Math.round(result.y);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private updateChangeListener (): void {\r\n        this.klCanvas.addChangeListener(() => {\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n        });\r\n    }\r\n\r\n    private updateCursor (modeInt: TMode, doForce?: boolean): void {\r\n        if (modeInt === this.currentMode && !doForce) {\r\n            return;\r\n        }\r\n        const oldMode = this.currentMode;\r\n        this.currentMode = modeInt;\r\n        this.lastRenderedState = -1;\r\n        if (this.currentMode === TMode.Draw) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        } else if (this.currentMode === TMode.Hand) {\r\n            this.rootEl.style.cursor = 'grab';\r\n        } else if (this.currentMode === TMode.HandGrabbing) {\r\n            this.rootEl.style.cursor = 'grabbing';\r\n        } else if (this.currentMode === TMode.Pick) {\r\n            this.rootEl.style.cursor = \"url('\" + pickerImg + \"') 0 15, crosshair\";\r\n        } else if (this.currentMode === TMode.Zoom) {\r\n            this.rootEl.style.cursor = \"url('\" + zoomEwImg + \"') 7 7, zoom-in\";\r\n        } else if (this.currentMode === TMode.Rotate) {\r\n            this.rootEl.style.cursor = 'grab';\r\n        } else if (this.currentMode === TMode.Rotating) {\r\n            this.rootEl.style.cursor = 'grabbing';\r\n        } else if (this.currentMode === TMode.Fill) {\r\n            this.rootEl.style.cursor = \"url('\" + fillImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Gradient) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        } else if (this.currentMode === TMode.Text) {\r\n            this.rootEl.style.cursor = \"url('\" + textImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Shape) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        }\r\n\r\n        if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode)) {\r\n            const oldIsHand = [TMode.Hand, TMode.HandGrabbing].includes(oldMode);\r\n            const currentIsHand = [TMode.Hand, TMode.HandGrabbing].includes(this.currentMode);\r\n            if (!oldIsHand && currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n            }\r\n            if (oldIsHand && !currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n            }\r\n        }\r\n\r\n        if (this.currentMode !== TMode.Pick) {\r\n            this.svgOverlay.updateColorPreview({isVisible: false});\r\n        }\r\n    }\r\n\r\n    /**\r\n     * returns false if no change of zoom\r\n     * @param stepNum\r\n     * @param centerX\r\n     * @param centerY\r\n     * @private\r\n     */\r\n    private internalZoomByStep (stepNum: number, centerX: number, centerY: number): boolean {\r\n        const step = Math.log2(this.targetTransformObj.scale);\r\n\r\n        let newStep = step / Math.abs(stepNum);\r\n        newStep += stepNum > 0 ? 1 : -1;\r\n        newStep = Math.round(newStep);\r\n        newStep *= Math.abs(stepNum);\r\n        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, Math.pow(2, newStep)));\r\n\r\n        //has zoomed?\r\n        if (newScale === this.targetTransformObj.scale) {\r\n            return false;\r\n        }\r\n\r\n\r\n        const effectiveFactor = newScale / this.targetTransformObj.scale;\r\n        this.targetTransformObj.scale = newScale;\r\n\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerX, centerY));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerX, -centerY));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.transformIsDirty = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * mixes two transform objects. modifies A\r\n     * @param transformA\r\n     * @param transformB\r\n     * @param blendFactor 0 -> A, 1 -> B\r\n     * @private\r\n     */\r\n    private mixTransformObj (transformA: ITransform, transformB: ITransform, blendFactor: number): void {\r\n        if (transformA.angle === transformB.angle) {\r\n            transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n            transformA.x = BB.mix(transformA.x, transformB.x, blendFactor);\r\n            transformA.y = BB.mix(transformA.y, transformB.y, blendFactor);\r\n            transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n            return;\r\n        }\r\n\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        // --- determine centerPosA, centerPosB ---\r\n        const centerPosA = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2,\r\n        }, transformA);\r\n        const centerPosB = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2,\r\n        }, transformB);\r\n\r\n        // --- centerPosMixed ---\r\n        transformA.x = BB.mix(centerPosA.x , centerPosB.x, blendFactor);\r\n        transformA.y = BB.mix(centerPosA.y , centerPosB.y, blendFactor);\r\n\r\n        // --- scale and angle ---\r\n        transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n        transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n\r\n        // --- x and y ---\r\n        const mixedPos = this.canvasToWorkspaceCoord({\r\n            x: -w / 2,\r\n            y: -h / 2,\r\n        }, transformA);\r\n        transformA.x = mixedPos.x;\r\n        transformA.y = mixedPos.y;\r\n    }\r\n\r\n    private render (): void {\r\n        if (this.doResizeCanvas) {\r\n            this.doResizeCanvas = false;\r\n            this.renderTargetCanvas.width = this.renderWidth;\r\n            this.renderTargetCanvas.height = this.renderHeight;\r\n        }\r\n        this.renderContext(this.renderTargetCtx);\r\n    }\r\n\r\n    /**\r\n     * is the gray background that surrounds canvas visible?\r\n     * @private\r\n     */\r\n    private testBgVisible (): boolean {\r\n        //bring workspace points (corners of workspace) into canvas coordinate system\r\n        //then check if any corner point is outside of the canvas -> that means the bg is visible\r\n\r\n        const workspacePointArr = [\r\n            [0, 0], // top left\r\n            [this.renderWidth, 0], // top right\r\n            [this.renderWidth, this.renderHeight], // bottom right\r\n            [0, this.renderHeight], // bottom left\r\n        ];\r\n\r\n        const art = this.getRenderedTransform();\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        //transform points, then test if outside of canvas\r\n        for (let i = 0; i < workspacePointArr.length; i++) {\r\n            let coords = [workspacePointArr[i][0], workspacePointArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n            if (\r\n                !(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() &&\r\n                    0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())\r\n            ){\r\n                //if not inside -> bg visible\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private renderContext (ctx: CanvasRenderingContext2D): void {\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        const art = this.getRenderedTransform();\r\n        const isDark = theme.isDark();\r\n\r\n        if (art.scale >= 4 || (art.scale === 1 && art.angle === 0)) {\r\n            ctx.imageSmoothingEnabled = false;\r\n        } else {\r\n            ctx.imageSmoothingEnabled = true;\r\n            ctx.imageSmoothingQuality  = 'low'; // art.scale >= 1 ? 'low' : 'medium';\r\n        }\r\n        //ctx.imageSmoothingEnabled = false;\r\n        //renderTargetCtx.globalCompositeOperation  = 'multiply';\r\n\r\n\r\n\r\n        ctx.save();\r\n        {\r\n            if (this.bgVisible) {\r\n                ctx.fillStyle = isDark ? 'rgb(33, 33, 33)' : 'rgb(158,158,158)'; // 'rgb(185,185,185)';\r\n                ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\r\n            } else {\r\n                ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\r\n            }\r\n\r\n\r\n\r\n            if (this.bgVisible) {\r\n                ctx.save();\r\n\r\n                ctx.translate(art.x, art.y);\r\n                ctx.scale(art.scale, art.scale);\r\n                ctx.rotate(art.angle);\r\n\r\n                ctx.imageSmoothingEnabled = false;\r\n\r\n                //outline\r\n                const borderSize = 1;\r\n                ctx.globalAlpha = isDark ? 0.25 : 0.2;\r\n                ctx.drawImage(\r\n                    isDark ? this.emptyLightCanvas : this.emptyCanvas,\r\n                    -borderSize / art.scale,\r\n                    -borderSize / art.scale,\r\n                    w + borderSize * 2 / art.scale,\r\n                    h + borderSize * 2 / art.scale\r\n                );\r\n                ctx.globalAlpha = 1;\r\n\r\n                //erase\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n                ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\r\n\r\n                ctx.restore();\r\n            }\r\n\r\n            /*const region = new Path2D();\r\n            region.rect(80, 10, 20, 130);\r\n            ctx.clip(region);*/\r\n\r\n            ctx.translate(art.x, art.y);\r\n            ctx.scale(art.scale, art.scale);\r\n            ctx.rotate(art.angle);\r\n\r\n            const layerArr = this.klCanvas.getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    ctx.globalAlpha = layerArr[i].opacity;\r\n                    ctx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n\r\n                    if (layerArr[i].canvas.compositeObj) {\r\n                        if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\r\n                            this.compositeCanvas.width = layerArr[i].canvas.width;\r\n                            this.compositeCanvas.height = layerArr[i].canvas.height;\r\n                        } else {\r\n                            this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\r\n                        }\r\n                        this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\r\n                        layerArr[i].canvas.compositeObj.draw(this.compositeCtx);\r\n                        ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\r\n                    } else {\r\n                        ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\r\n                    }\r\n                }\r\n            }\r\n            ctx.globalAlpha = 1;\r\n\r\n\r\n\r\n        }\r\n        ctx.restore();\r\n\r\n        // rotation hud\r\n        if (TMode.Rotate === this.currentMode || TMode.Rotating === this.currentMode) {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: true,\r\n                angleDeg: art.angle / Math.PI * 180,\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: false,\r\n            });\r\n        }\r\n    }\r\n\r\n    private workspaceToCanvasCoord (p: IVector2D): IVector2D {\r\n        const art = this.getRenderedTransform();\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private canvasToWorkspaceCoord (p: IVector2D, transformObj: ITransform): IVector2D {\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(transformObj.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(transformObj.scale));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private snapAngleRad (angleRad: number, snapDegIncrement: number, maxDistDeg: number): number {\r\n        let angleDeg = angleRad * 180 / Math.PI;\r\n        const modDeg = Math.abs(angleDeg % snapDegIncrement);\r\n        const dist = Math.min(modDeg, snapDegIncrement - modDeg);\r\n\r\n        if (dist <= maxDistDeg) {\r\n            angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\r\n        }\r\n\r\n        return angleDeg / 180 * Math.PI;\r\n    }\r\n\r\n    /**\r\n     * angle always in range [-PI, PI]\r\n     * @param angleRad\r\n     * @private\r\n     */\r\n    private minimizeAngleRad (angleRad: number): number {\r\n        angleRad = angleRad % (2 * Math.PI);\r\n        if (angleRad > Math.PI) {\r\n            angleRad -= 2 * Math.PI;\r\n        } else if (angleRad < -Math.PI) {\r\n            angleRad += 2 * Math.PI;\r\n        }\r\n        return angleRad;\r\n    }\r\n\r\n    private resetInputProcessor (): void {\r\n        this.currentInputProcessor = null;\r\n        this.updateCursor(this.globalMode);\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    private reqFrame (doRedrawCanvas?: boolean): void {\r\n        this.animationFrameRequested = true;\r\n        if (doRedrawCanvas) {\r\n            this.lastRenderedState = -1;\r\n        }\r\n    }\r\n\r\n    private updateLoop (): void {\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState;\r\n\r\n        //handle variable framerate\r\n        const nowTime = performance.now();\r\n        const elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\r\n        this.lastRenderTime = nowTime;\r\n\r\n        if (this.animationFrameRequested || doRender) {\r\n            this.animationFrameRequested = false;\r\n            this.checkChange(elapsedFrames);\r\n        }\r\n    }\r\n\r\n    private checkChange (elapsedFrames: number): void {\r\n\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState ||\r\n            this.highResTransformObj.scale !== this.targetTransformObj.scale ||\r\n            this.highResTransformObj.x !== this.targetTransformObj.x ||\r\n            this.highResTransformObj.y !== this.targetTransformObj.y;\r\n\r\n        //update transform\r\n        if (\r\n            !this.doAnimateTranslate &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else if (\r\n            (this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) &&\r\n            (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            this. doAnimateTranslate = false;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else {\r\n            this.reqFrame(); //probably needs another frame\r\n            const blendFactor = Math.min(1, ANIMATION_SPEED * elapsedFrames);\r\n            this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\r\n            this.bgVisible = true; // spare yourself the calculation\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        }\r\n\r\n        if (this.pointer && this.currentMode == TMode.Draw && !this.usesCssCursor) {\r\n            this.svgOverlay.updateCursor({\r\n                x: this.pointer.x,\r\n                y: this.pointer.y,\r\n                isVisible: true,\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCursor({isVisible: false});\r\n        }\r\n\r\n\r\n        if (doRender) {\r\n            //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\r\n            this.lastRenderedState = newState;\r\n            const start = performance.now();\r\n            this.render();\r\n            this.renderTime = BB.mix(this.renderTime, performance.now() - start, 0.05);\r\n        }\r\n        //setTimeout(this.checkChange, 100);\r\n\r\n\r\n\r\n        if (doRender) {\r\n\r\n            //console.log('rendertime ms: ', this.renderTime);\r\n        }\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            klCanvas: any; // todo\r\n            width: number;\r\n            height: number;\r\n            onDraw: (val: TDrawEvent) => void; // todo\r\n            onPick: (rgb: IRGB, isPointerup: boolean) => void;\r\n            onFill: (canvasX: number, canvasY: number) => void;\r\n            onGradient: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onText: (canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onShape: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onViewChange: (e:  IViewChangeEvent) => void;\r\n            onUndo: () => void;\r\n            onRedo: () => void;\r\n        }\r\n    ) {\r\n        const _this = this;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                right: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                cursor: 'crosshair',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.klCanvas = p.klCanvas;\r\n        this.onViewChange = p.onViewChange;\r\n        this.renderTargetCanvas = BB.canvas(p.width, p.height);\r\n        this.renderTargetCtx = BB.ctx(this.renderTargetCanvas);\r\n        this.renderWidth = p.width;\r\n        this.renderHeight = p.height;\r\n        this.compositeCanvas = BB.canvas(1, 1); // for drawing klcanvas layer composite\r\n        this.compositeCtx = BB.ctx(this.compositeCanvas);\r\n        this.doResizeCanvas = false;\r\n        this.oldTransformObj = null;\r\n        this.targetTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0,\r\n        };\r\n        this.highResTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0,\r\n        };\r\n        this.renderedTransformObj = {\r\n            x: null,\r\n            y: null,\r\n            scale: null,\r\n            angle: null,\r\n        };\r\n        this.cursorPos = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        this.usesCssCursor = false;\r\n        this.bgVisible = true;\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n\r\n        this.svgOverlay = new WorkspaceSvgOverlay({\r\n            width: p.width,\r\n            height: p.height,\r\n        });\r\n\r\n        BB.css(this.renderTargetCanvas, {\r\n            userSelect: 'none',\r\n            pointerEvents: 'none',\r\n        });\r\n        BB.createCheckerDataUrl(8, (url) => {\r\n            this.renderTargetCanvas.style.background = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n\r\n        theme.addIsDarkListener(() => {\r\n            this.renderTargetCanvas.style.background = 'url(' + BB.createCheckerDataUrl(8, undefined, theme.isDark()) + ')';\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n        });\r\n\r\n        this.rootEl.append(this.renderTargetCanvas, this.svgOverlay.getElement());\r\n        this.rootEl.addEventListener( 'touchend', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        this.rootEl.addEventListener('contextmenu', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        this.rootEl.addEventListener('dragstart', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n\r\n        this.emptyCanvas = BB.canvas(1, 1);\r\n        this.emptyLightCanvas = BB.canvas(1, 1);\r\n        {\r\n            let ctx = BB.ctx(this.emptyCanvas);\r\n            ctx.fillRect(0, 0, 1, 1);\r\n            ctx = BB.ctx(this.emptyLightCanvas);\r\n            ctx.fillStyle = '#fff';\r\n            ctx.fillRect(0, 0, 1, 1);\r\n        }\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n                if (isRepeat) {\r\n                    return;\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n\r\n                } else {\r\n\r\n                    if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'space') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.spaceHand;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ([TMode.Draw, TMode.Hand, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'alt') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.altPicker;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if (['r', 'shift+r'].includes(comboStr)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.rotate;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ('z' === comboStr) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.zoom;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                }\r\n\r\n            },\r\n            onUp: (keyStr, event, oldComboStr) => {\r\n                // prevent menu bar in Firefox\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\r\n                }\r\n            },\r\n        });\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.currentMode = TMode.Draw;\r\n        this.globalMode = TMode.Draw;\r\n\r\n        this.renderTime = 0;\r\n\r\n        this.lastDrawEvent = null;\r\n\r\n        this.linetoolProcessor = new LinetoolProcessor({\r\n            onDraw: (event) => {\r\n                const getMatrix = () => {\r\n                    const art = this.getRenderedTransform();\r\n                    let matrix = BB.Matrix.getIdentity();\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n                    return matrix;\r\n                };\r\n\r\n                if (event.type === 'line' && !this.lastDrawEvent) {\r\n                    const matrix = getMatrix();\r\n                    let coords = [event.x1, event.y1, 0, 1];\r\n                    coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                    this.lastDrawEvent = {\r\n                        x: coords[0],\r\n                        y: coords[1],\r\n                        pressure: event.pressure1,\r\n                    };\r\n                    return;\r\n                }\r\n\r\n                if ('x' in event || 'x0' in event) {\r\n\r\n                    const matrix = getMatrix();\r\n\r\n                    if ('x' in event) { //down or move\r\n                        let coords = [event.x, event.y, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x = coords[0];\r\n                        event.y = coords[1];\r\n                    }\r\n                    if ('x0' in event) { //line\r\n                        event.x0 = this.lastDrawEvent.x;\r\n                        event.y0 = this.lastDrawEvent.y;\r\n                        event.pressure0 = this.lastDrawEvent.pressure;\r\n                        let coords = [event.x1, event.y1, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x1 = coords[0];\r\n                        event.y1 = coords[1];\r\n\r\n                        this.lastDrawEvent = {\r\n                            x: event.x1,\r\n                            y: event.y1,\r\n                            pressure: event.pressure1,\r\n                        };\r\n                    }\r\n                }\r\n\r\n\r\n                if (event.type === 'down' || event.type === 'move') {\r\n                    this.lastDrawEvent = {\r\n                        x: event.x,\r\n                        y: event.y,\r\n                        pressure: event.pressure,\r\n                    };\r\n                }\r\n                p.onDraw(event);\r\n            },\r\n        });\r\n\r\n        this.pointer = null;\r\n        this.isDrawing = false;\r\n\r\n\r\n        this.inputProcessorObj = {\r\n            draw: {\r\n                onPointer: (val) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Draw);\r\n\r\n                    const comboStr = this.keyListener.getComboStr();\r\n\r\n                    const event: any = {\r\n                        scale: this.highResTransformObj.scale,\r\n                    };\r\n                    event.shiftIsPressed = comboStr === 'shift';\r\n                    event.pressure = val.pressure;\r\n                    event.isCoalesced = !!val.isCoalesced;\r\n\r\n                    if (val.type === 'pointerdown') {\r\n\r\n                        this.isDrawing = true;\r\n                        event.type = 'down';\r\n\r\n                    } else if (val.button) {\r\n                        event.type = 'move';\r\n\r\n                    } else if (val.type === 'pointerup') {\r\n\r\n                        this.isDrawing = false;\r\n                        event.type = 'up';\r\n\r\n                        this.linetoolProcessor.process(event);\r\n                        this.resetInputProcessor();\r\n                        return;\r\n                    } else {\r\n                        return;\r\n                    }\r\n\r\n                    event.x = val.relX;\r\n                    event.y = val.relY;\r\n\r\n                    this.linetoolProcessor.process(event);\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            fill: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Fill);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            gradient: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Gradient);\r\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        this.isDrawing = true;\r\n                        p.onGradient('down', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        p.onGradient('move', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.isDrawing = false;\r\n                        p.onGradient('up', coord.x, coord.y, this.renderedTransformObj.angle);\r\n                        this.resetInputProcessor();\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            text: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Text);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            shape: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Shape);\r\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        this.isDrawing = true;\r\n                        p.onShape('down', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        p.onShape('move', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.isDrawing = false;\r\n                        p.onShape('up', coord.x, coord.y, this.renderedTransformObj.angle);\r\n                        this.resetInputProcessor();\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            hand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            spaceHand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'space') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                },\r\n            },\r\n            zoom: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Zoom);\r\n\r\n                    if (event.button === 'left' && !event.isCoalesced && event.dX != 0) {\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n\r\n                        this.internalZoomByStep(event.dX / 175, event.downPageX - offsetX, event.downPageY - offsetY);\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale,\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'z') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Zoom);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                },\r\n            },\r\n            picker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup',\r\n                        });\r\n\r\n                        if (event.type === 'pointerup') {\r\n                            this.resetInputProcessor();\r\n                        }\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            altPicker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup',\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'alt') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                },\r\n            },\r\n            rotate: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(event.button === 'left' ? TMode.Rotating : TMode.Rotate);\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.oldTransformObj = BB.copyObj(this.targetTransformObj);\r\n                    } else if (event.button === 'left' && !event.isCoalesced && this.oldTransformObj) {\r\n\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n                        //rotation done around center\r\n                        const centerObj = {\r\n                            x: this.renderWidth / 2,\r\n                            y: this.renderHeight / 2,\r\n                        };\r\n\r\n                        const startAngleRad = BB.Vec2.angle(centerObj, {x: event.downPageX - offsetX, y: event.downPageY - offsetY});\r\n                        const angleRad = BB.Vec2.angle(centerObj, {x: event.pageX - offsetX, y: event.pageY - offsetY});\r\n                        let dAngleRad = angleRad - startAngleRad;\r\n\r\n                        //apply angle\r\n                        this.targetTransformObj = BB.copyObj(this.oldTransformObj);\r\n                        this.targetTransformObj.angle += dAngleRad;\r\n\r\n                        if (this.keyListener.isPressed('shift')) {\r\n                            this.targetTransformObj.angle = Math.round(this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\r\n                            dAngleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n                        }\r\n\r\n                        this.targetTransformObj.angle = this.minimizeAngleRad(this.targetTransformObj.angle);\r\n\r\n                        //rotate transform.xy\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(dAngleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n\r\n                        this.transformIsDirty = true;\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['angle'],\r\n                            scale: this.targetTransformObj.scale,\r\n                            angle: this.targetTransformObj.angle,\r\n                        });\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    const comboStr = this.keyListener.getComboStr();\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n            },\r\n        };\r\n        this.currentInputProcessor = null;\r\n\r\n\r\n        this.angleIsExtraSticky = false;\r\n        this.pinchZoomer = new BB.PinchZoomer({\r\n            onPinch: (event) => {\r\n\r\n                if (event.type === 'move') {\r\n\r\n                    if (!this.oldTransformObj) {\r\n                        this.oldTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.angleIsExtraSticky = this.targetTransformObj.angle % (Math.PI / 2) === 0;\r\n                    }\r\n\r\n                    this.targetTransformObj = BB.copyObj(this.oldTransformObj);\r\n\r\n                    event.scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, this.targetTransformObj.scale * event.scale)) / this.targetTransformObj.scale;\r\n\r\n                    this.targetTransformObj.scale *= event.scale;\r\n                    this.targetTransformObj.angle += event.angleRad;\r\n                    this.targetTransformObj.angle = this.minimizeAngleRad(\r\n                        this.snapAngleRad(\r\n                            this.targetTransformObj.angle,\r\n                            90,\r\n                            this.angleIsExtraSticky ? 12 : 4\r\n                        )\r\n                    );\r\n                    if (this.targetTransformObj.angle % (Math.PI / 2) !== 0) {\r\n                        this.angleIsExtraSticky = false;\r\n                    }\r\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\r\n                    event.angleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n\r\n                    //calc translation\r\n                    {\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX, event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(event.scale));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(event.angleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-event.relX, -event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\r\n\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                    }\r\n\r\n                    this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n\r\n                    //if (event.scale !== 1) {\r\n                    this.onViewChange({\r\n                        changed: ['scale', 'angle'],\r\n                        scale: this.targetTransformObj.scale,\r\n                        angle: this.targetTransformObj.angle,\r\n                    });\r\n                    //}\r\n                    this.reqFrame();\r\n                    this.transformIsDirty = true;\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                } else if (event.type === 'end') {\r\n                    this.oldTransformObj = null;\r\n                }\r\n\r\n\r\n            },\r\n        });\r\n\r\n        const onDoubleTap = (event) => {\r\n            if (_this.fitView()) {\r\n                this.lastRenderedState = -1;\r\n                this.reqFrame();\r\n            } else {\r\n                // zoom 2 steps further\r\n\r\n                const didZoom = this.internalZoomByStep(\r\n                    2,\r\n                    event.relX,\r\n                    event.relY,\r\n                );\r\n                if (didZoom) {\r\n                    this.onViewChange({\r\n                        changed: ['scale'],\r\n                        angle: this.targetTransformObj.angle,\r\n                        scale: this.targetTransformObj.scale,\r\n                    });\r\n                }\r\n\r\n                //updateCursor(TMode.Draw, true);\r\n                this.lastRenderedState = -1;\r\n            }\r\n        };\r\n\r\n        this.mainDoubleTapper = new BB.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper = new BB.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper.setAllowedButtonArr(['middle']);\r\n\r\n\r\n        this.twoFingerTap = new BB.NFingerTapper({\r\n            fingers: 2,\r\n            onTap: () => {\r\n                p.onUndo();\r\n            },\r\n        });\r\n        this.threeFingerTap = new BB.NFingerTapper({\r\n            fingers: 3,\r\n            onTap: () => {\r\n                p.onRedo();\r\n            },\r\n        });\r\n\r\n\r\n        this.pointerEventChain = new BB.EventChain({\r\n            chainArr: [\r\n                this.twoFingerTap,\r\n                this.threeFingerTap,\r\n                this.mainDoubleTapper,\r\n                this.middleDoubleTapper,\r\n                this.pinchZoomer,\r\n                new BB.OnePointerLimiter(),\r\n                new BB.CoalescedExploder(),\r\n            ],\r\n        });\r\n        this.pointerEventChain.setChainOut((event: IPointerEvent) => {\r\n\r\n            this.cursorPos.x = event.relX;\r\n            this.cursorPos.y = event.relY;\r\n            if (event.type === 'pointerup' && event.pointerType === 'touch') {\r\n                this.pointer = null;\r\n                this.lastRenderedState = -1;\r\n                this.reqFrame();\r\n            } else {\r\n                if (!this.pointer) {\r\n                    this.pointer = { x: 0, y: 0 };\r\n                }\r\n                this.pointer.x = event.relX;\r\n                this.pointer.y = event.relY;\r\n            }\r\n\r\n            if (this.currentInputProcessor) {\r\n                this.currentInputProcessor.onPointer(event);\r\n\r\n            } else {\r\n\r\n                const comboStr = this.keyListener.getComboStr();\r\n\r\n                if (this.globalMode === TMode.Draw) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.draw;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Draw);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Hand) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'middle'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Pick) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'right'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Fill) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.fill;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Fill);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Gradient) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.gradient;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Gradient);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Text) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.text;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Text);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Shape) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.shape;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Shape);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n        });\r\n\r\n        //prevent ctrl scroll -> zooming page\r\n        this.rootEl.addEventListener('wheel', (event) => {\r\n            event.preventDefault();\r\n        });\r\n\r\n\r\n        setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.rootEl,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    if (e.type === 'pointerdown' && e.button === 'middle') {\r\n                        try {\r\n                            e.eventPreventDefault();\r\n                        } catch (e) {}\r\n                    }\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    if (e.type === 'pointerdown') {\r\n                        BB.unfocusAnyInput();\r\n                    }\r\n                    /*if (e.type === 'pointermove') {\r\n                        BB.throwOut(JSON.stringify(e));\r\n                    }*/\r\n\r\n                    this.pointerEventChain.chainIn(e);\r\n                },\r\n                onWheel: (wheelEvent) => {\r\n\r\n                    if (this.isDrawing) {\r\n                        return;\r\n                    }\r\n\r\n                    this.reqFrame();\r\n                    const didZoom = this.internalZoomByStep(\r\n                        -wheelEvent.deltaY / (this.keyListener.isPressed('shift') ? 8 : 2),\r\n                        wheelEvent.relX,\r\n                        wheelEvent.relY\r\n                    );\r\n                    if (didZoom) {\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale,\r\n                        });\r\n                    }\r\n\r\n                    //updateCursor(TMode.Draw, true);\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                },\r\n                onEnterLeave: (isOver) => {\r\n                    if (!isOver) {\r\n                        if (!this.isDrawing) {\r\n                            this.pointer = null;\r\n                            this.lastRenderedState = -1;\r\n                        }\r\n                    }\r\n                },\r\n                maxPointers: 4,\r\n            });\r\n        }, 1);\r\n\r\n        this.brushRadius = 1;\r\n\r\n        this.animationFrameRequested = false;\r\n\r\n\r\n\r\n\r\n        //setup rendering\r\n        this.lastRenderedState = -2;\r\n        this.lastRenderTime = performance.now();\r\n\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n\r\n        this.resetView();\r\n    }\r\n\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setCanvas (klC: KlCanvas): void {\r\n        this.klCanvas = klC;\r\n        this.lastDrawEvent = null;\r\n        this.resetView();\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    /**\r\n     * set size of workspace area in pixels\r\n     * @param width\r\n     * @param height\r\n     */\r\n    setSize (width: number, height: number): void {\r\n        const oldWidth = this.renderWidth;\r\n        const oldHeight = this.renderHeight;\r\n\r\n        if (width === oldWidth && height === oldHeight) {\r\n            return;\r\n        }\r\n\r\n        this.doResizeCanvas = true;\r\n        this.renderWidth = width;\r\n        this.renderHeight = height;\r\n\r\n        this.svgOverlay.setSize(width, height);\r\n\r\n        this.targetTransformObj.x += (width - oldWidth) / 2;\r\n        this.targetTransformObj.y += (height - oldHeight) / 2;\r\n\r\n        this.highResTransformObj.x = this.targetTransformObj.x;\r\n        this.highResTransformObj.y = this.targetTransformObj.y;\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setMode (modeStr: TModeStr): void {\r\n        //only sets the base mode\r\n        if (modeStr === 'draw') {\r\n            this.globalMode = TMode.Draw;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'fill') {\r\n            this.globalMode = TMode.Fill;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'gradient') {\r\n            this.globalMode = TMode.Gradient;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'text') {\r\n            this.globalMode = TMode.Text;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'shape') {\r\n            this.globalMode = TMode.Shape;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'hand') {\r\n            this.globalMode = TMode.Hand;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n        }\r\n        if (modeStr === 'pick') {\r\n            this.globalMode = TMode.Pick;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n    }\r\n\r\n    getMode (): TModeStr {\r\n        if (this.globalMode === TMode.Draw) {\r\n            return 'draw';\r\n        }\r\n        if (this.globalMode === TMode.Fill) {\r\n            return 'fill';\r\n        }\r\n        if (this.globalMode === TMode.Gradient) {\r\n            return 'gradient';\r\n        }\r\n        if (this.globalMode === TMode.Text) {\r\n            return 'text';\r\n        }\r\n        if (this.globalMode === TMode.Shape) {\r\n            return 'shape';\r\n        }\r\n        if (this.globalMode === TMode.Hand) {\r\n            return 'hand';\r\n        }\r\n        if (this.globalMode === TMode.Pick) {\r\n            return 'pick';\r\n        }\r\n    }\r\n\r\n    setEnabled (b: boolean): void {\r\n        // todo\r\n    }\r\n\r\n    setCursorSize (diameter: number): void {\r\n        this.brushRadius = diameter / 2;\r\n\r\n        this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n\r\n        if (this.pointer === null) {\r\n            this.hideBrushCursorTimeout && clearTimeout(this.hideBrushCursorTimeout);\r\n\r\n            this.svgOverlay.updateCursor({\r\n                x: this.renderWidth / 2,\r\n                y: this.renderHeight / 2,\r\n                isVisible: true,\r\n            });\r\n\r\n            this.hideBrushCursorTimeout = setTimeout(() => {\r\n                if (this.pointer !== null) {\r\n                    return;\r\n                }\r\n                this.svgOverlay.updateCursor({isVisible: false});\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n    zoomByStep (stepNum: number): void {\r\n        if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) {\r\n            return;\r\n        }\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale'],\r\n            angle: this.targetTransformObj.angle,\r\n            scale: this.targetTransformObj.scale,\r\n        });\r\n    }\r\n\r\n    resetView (doAnimate?: boolean): void {\r\n        this.targetTransformObj.scale = 1;\r\n        this.targetTransformObj.angle = 0;\r\n\r\n        this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\r\n        this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\r\n\r\n        if (!doAnimate) {\r\n            this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n        } else {\r\n            this.doAnimateTranslate = true;\r\n            this.transformIsDirty = true;\r\n        }\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n        this.reqFrame();\r\n\r\n        if (doAnimate) {\r\n            this.onViewChange({\r\n                changed: ['scale', 'angle'],\r\n                scale: this.targetTransformObj.scale,\r\n                angle: this.targetTransformObj.angle,\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * fit into view. center. snap angle. padding\r\n     * returns true if transform changes\r\n     */\r\n    fitView (): boolean {\r\n        // determine new transform\r\n        const newAngle = this.snapAngleRad(this.targetTransformObj.angle, 90, 90);\r\n\r\n        //calc width and height of bounds\r\n        const canvasPointsArr = [\r\n            [0, 0], // top left\r\n            [this.klCanvas.getWidth(), 0], // top right\r\n            [this.klCanvas.getWidth(), this.klCanvas.getHeight()], // bottom right\r\n            [0, this.klCanvas.getHeight()], // bottom left\r\n            [this.klCanvas.getWidth() / 2, this.klCanvas.getHeight() / 2], // center\r\n        ];\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(newAngle));\r\n\r\n        //rotate points\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            let coords = [canvasPointsArr[i][0], canvasPointsArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n            canvasPointsArr[i][0] = coords[0];\r\n            canvasPointsArr[i][1] = coords[1];\r\n        }\r\n\r\n        const boundsObj = {\r\n            x0: null,\r\n            y0: null,\r\n            x1: null,\r\n            y1: null,\r\n        };\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            if (boundsObj.x0 === null || canvasPointsArr[i][0] < boundsObj.x0) {\r\n                boundsObj.x0 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y0 === null || canvasPointsArr[i][1] < boundsObj.y0) {\r\n                boundsObj.y0 = canvasPointsArr[i][1];\r\n            }\r\n            if (boundsObj.x1 === null || canvasPointsArr[i][0] > boundsObj.x1) {\r\n                boundsObj.x1 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y1 === null || canvasPointsArr[i][1] > boundsObj.y1) {\r\n                boundsObj.y1 = canvasPointsArr[i][1];\r\n            }\r\n        }\r\n        const boundsWidth = boundsObj.x1 - boundsObj.x0;\r\n        const boundsHeight = boundsObj.y1 - boundsObj.y0;\r\n\r\n        //fit bounds\r\n        const padding = 0;\r\n        const { width: fitWidth } = BB.fitInto(\r\n            boundsWidth,\r\n            boundsHeight, \r\n            this.renderWidth - padding, \r\n            this.renderHeight - padding, \r\n            1\r\n        );\r\n\r\n        //determine scale\r\n        const factor = fitWidth / boundsWidth;\r\n\r\n        const newTargetTransformObj = {\r\n            angle: newAngle,\r\n            x: (this.renderWidth / 2) - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor,\r\n            y: (this.renderHeight / 2) - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor,\r\n            scale: factor,\r\n        };\r\n\r\n        if (\r\n            newTargetTransformObj.angle === this.targetTransformObj.angle &&\r\n            Math.abs(newTargetTransformObj.x - this.targetTransformObj.x) < 0.0000000001 &&\r\n            Math.abs(newTargetTransformObj.y - this.targetTransformObj.y) < 0.0000000001 &&\r\n            newTargetTransformObj.scale === this.targetTransformObj.scale\r\n        ) {\r\n            return false;\r\n        }\r\n        this.targetTransformObj = newTargetTransformObj;\r\n\r\n        this.doAnimateTranslate = true;\r\n        this.transformIsDirty = true;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale', 'angle'],\r\n            scale: this.targetTransformObj.scale,\r\n            angle: this.targetTransformObj.angle,\r\n        });\r\n        return true;\r\n    }\r\n\r\n    setAngle (angleDeg: number, isRelative?: boolean): void {\r\n        //rotation done around center\r\n        const centerObj = {\r\n            x: this.renderWidth / 2,\r\n            y: this.renderHeight / 2,\r\n        };\r\n\r\n        const oldAngleRad = this.targetTransformObj.angle;\r\n        const angleRad = angleDeg / 180 * Math.PI;\r\n\r\n        if (isRelative) {\r\n            this.targetTransformObj.angle += angleRad;\r\n        } else {\r\n            this.targetTransformObj.angle = angleRad;\r\n        }\r\n\r\n        this.targetTransformObj.angle = this.minimizeAngleRad(\r\n            this.snapAngleRad(\r\n                this.targetTransformObj.angle,\r\n                90,\r\n                4\r\n            )\r\n        );\r\n\r\n        //rotate transform.xy\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n        this.transformIsDirty = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    /**\r\n     * translate canvas by viewport pixels\r\n     * @param tx\r\n     * @param ty\r\n     */\r\n    translateView (tx: number, ty: number): void {\r\n        const scale = 40;\r\n\r\n        this.targetTransformObj.x += tx * scale;\r\n        this.targetTransformObj.y += ty * scale;\r\n\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    getScale (): number {\r\n        return this.targetTransformObj.scale;\r\n    }\r\n\r\n    getAngleDeg (): number {\r\n        return this.targetTransformObj.angle * 180 / Math.PI;\r\n    }\r\n\r\n    getMaxScale (): number {\r\n        return MAX_SCALE;\r\n    }\r\n\r\n    getMinScale (): number {\r\n        return MIN_SCALE;\r\n    }\r\n\r\n    requestFrame (): void {\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setLastDrawEvent (x: number | null, y?: number, pressure?: number): void {\r\n        if (x === null) {\r\n            this.lastDrawEvent = null;\r\n            return;\r\n        }\r\n\r\n        if (!this.lastDrawEvent) {\r\n            this.lastDrawEvent = {x: 0, y: 0, pressure: 0};\r\n        }\r\n        this.lastDrawEvent.x = x;\r\n        this.lastDrawEvent.y = y;\r\n        this.lastDrawEvent.pressure = pressure;\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ayl5b\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"8Sx0P\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ixtEz\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3iHbP\");","import {IDrawDownEvent, IDrawMoveEvent, IDrawUpEvent, TDrawEvent} from '../kl-types';\r\nimport {BB} from '../../bb/bb';\r\n\r\nconst DIR_X = 0;\r\nconst DIR_Y = 1;\r\n\r\n/**\r\n * Not really and event chain element. but pretty similar.\r\n *\r\n * Processes draw input events. When shift held -> linetool\r\n * line events - what KlCanvasWorkspace passes onDraw(e)\r\n *\r\n * pass input in with process(drawEvent)\r\n *\r\n * modifies draw event to include such events:\r\n * {\r\n *     type: 'line',\r\n *     x0: null, // you have to fill that in\r\n *     y0: null, // you have to fill that in\r\n *     pressure0: null, // you have to fill that in\r\n *     x1: number,\r\n *     y1: number,\r\n *     pressure1: number\r\n * }\r\n */\r\nexport class LinetoolProcessor {\r\n\r\n    private readonly onDraw: (drawEvent: TDrawEvent) => void;\r\n    private downEvent: IDrawDownEvent | null = null;\r\n    private eventQueue: (IDrawDownEvent | IDrawMoveEvent | IDrawUpEvent)[] = [];\r\n    private direction: 0 | 1 | null = null;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p : {\r\n            onDraw: (drawEvent: TDrawEvent) => void;\r\n        }\r\n    ) {\r\n        this.onDraw = p.onDraw;\r\n    }\r\n\r\n    process (event: IDrawDownEvent | IDrawMoveEvent | IDrawUpEvent): void {\r\n        if (event.type === 'down') {\r\n            this.downEvent = event;\r\n            this.direction = null;\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                this.onDraw({\r\n                    type: 'line',\r\n                    x0: null,\r\n                    y0: null,\r\n                    pressure0: null,\r\n                    x1: event.x,\r\n                    y1: event.y,\r\n                    pressure1: event.pressure,\r\n                });\r\n\r\n                this.eventQueue.push(event);\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'move' && this.downEvent) {\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                if (this.direction === null) {\r\n                    const dX = Math.abs(event.x - this.downEvent.x);\r\n                    const dY = Math.abs(event.y - this.downEvent.y);\r\n\r\n                    if (dX > 5 || dY > 5) {\r\n                        this.direction = dX > dY ? DIR_X : DIR_Y;\r\n\r\n                        for (let i = 0; i < this.eventQueue.length; i++) {\r\n                            const e = this.eventQueue[i];\r\n                            if (e.type !== 'up') {\r\n                                if (this.direction === DIR_X) {\r\n                                    e.y = this.downEvent.y;\r\n                                } else {\r\n                                    e.x = this.downEvent.x;\r\n                                }\r\n                            }\r\n                            this.onDraw(BB.copyObj(e));\r\n                        }\r\n                        this.eventQueue = [];\r\n                    }\r\n                }\r\n\r\n                if (this.direction === null) {\r\n                    this.eventQueue.push(event);\r\n                    return;\r\n                }\r\n\r\n                if (this.direction === DIR_X) {\r\n                    event.y = this.downEvent.y;\r\n                } else {\r\n                    event.x = this.downEvent.x;\r\n                }\r\n\r\n            } else {\r\n                if (this.eventQueue.length > 0) {\r\n                    for (let i = 0; i < this.eventQueue.length; i++) {\r\n                        this.onDraw(BB.copyObj(this.eventQueue[i]));\r\n                    }\r\n                    this.eventQueue = [];\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'up') {\r\n            this.eventQueue = [];\r\n            this.downEvent = null;\r\n        }\r\n\r\n        this.onDraw(BB.copyObj(event));\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IKlBasicLayer} from '../kl-types';\r\nimport {theme} from '../../theme/theme';\r\n\r\n/**\r\n * preview of image with layers. can do mix modes and opacity.\r\n * creates a canvas.\r\n */\r\nexport class KlCanvasPreview {\r\n\r\n    private readonly canvas: HTMLCanvasElement;\r\n    private readonly ctx: CanvasRenderingContext2D | null;\r\n    private readonly layers: IKlBasicLayer[];\r\n    private readonly updateCheckerboard: () => void;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n            layers: IKlBasicLayer[]; // items can be changed after the fact - but not the object\r\n        }\r\n    ) {\r\n        this.layers = p.layers;\r\n\r\n        const scale = p.width / p.layers[0].image.width;\r\n        const width = scale > 1 ? p.layers[0].image.width : p.width;\r\n        const height = scale > 1 ? p.layers[0].image.height : p.height;\r\n\r\n        this.canvas = BB.canvas(width, height);\r\n        this.updateCheckerboard = () => {\r\n            this.canvas.style.backgroundImage = 'url(' + BB.createCheckerDataUrl(8, undefined, theme.isDark()) + ')';\r\n        };\r\n        this.updateCheckerboard();\r\n        this.ctx = BB.ctx(this.canvas);\r\n\r\n        BB.css(this.canvas, {\r\n            width: '100%',\r\n            height: '100%',\r\n            imageRendering: scale > 1 ? 'pixelated' : undefined,\r\n        });\r\n\r\n        setTimeout(() => this.render(), 0);\r\n        theme.addIsDarkListener(this.updateCheckerboard);\r\n    }\r\n\r\n    getElement (): HTMLCanvasElement {\r\n        return this.canvas;\r\n    }\r\n\r\n    render (): void {\r\n        if (!this.ctx) {\r\n            return;\r\n        }\r\n\r\n        this.ctx.save();\r\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        for (let i = 0; i < this.layers.length; i++) {\r\n            this.ctx.globalAlpha = this.layers[i].opacity;\r\n            this.ctx.globalCompositeOperation = this.layers[i].mixModeStr as GlobalCompositeOperation;\r\n            if (this.canvas.width > this.layers[i].image.width) {\r\n                this.ctx.imageSmoothingEnabled = false;\r\n            }\r\n            this.ctx.drawImage(this.layers[i].image, 0, 0, this.canvas.width, this.canvas.height);\r\n        }\r\n        this.ctx.restore();\r\n    }\r\n\r\n    destroy (): void {\r\n        theme.removeIsDarkListener(this.updateCheckerboard);\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport rotateImg from '/src/app/img/ui/cursor-rotate.png';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {\r\n    copyTransform,\r\n    IFreeTransform,\r\n    snapToPixel,\r\n    TFreeTransformCorner,\r\n    TFreeTransformEdge,\r\n    toImageSpace,\r\n    toTransformSpace,\r\n} from './free-transform-utils';\r\n\r\n/**\r\n * Free Transform UI\r\n * rotate, scale, translate\r\n *\r\n * - if rotation is multiple of 90 it will snap to pixels, to be more useful for pixel art\r\n * - when rotation goes from non-multiple of 90 to a multiple, it will snap position and width height to pixels\r\n * - transform.x, transform.y can sit between pixels (by 0.5) if width or height is odd number.\r\n *      - this is what complicates things\r\n * - if transform region small, corner grips move out of the way\r\n *\r\n * iX iY, iP.x, iP.y - i indicates image space\r\n * tX tY, tP.x, tP.y - t indicates transform space\r\n *\r\n * Not sure if it can be used for navigable canvas. (especially if canvas rotates view)\r\n * Probably can't be extended for distort. Needs a different approach.\r\n *\r\n * --- DOM structure ---\r\n * rootEl {\r\n * \ttransEl [\r\n * \t\tboundsEl\r\n * \t\tedges[]\r\n * \t\tcorners[] - round grips in the corner of transform region\r\n * \t\tangleGrip\r\n * \t]\r\n * }\r\n *\r\n */\r\nexport class FreeTransform {\r\n\r\n    // --- private ---\r\n    private readonly transform: IFreeTransform; // coordinates and dimensions of transformation\r\n    private isConstrained: boolean;\r\n    private ratio: number; // aspect ratio of transform\r\n    private readonly scale: number;\r\n    private readonly scaled = { // scaled coordinates and dimensions for screenspace\r\n        x: 0,\r\n        y: 0,\r\n        width: 0,\r\n        height: 0,\r\n        corners: [{x: 0, y: 0}], // in transform space\r\n    };\r\n    private readonly minSnapDist = 7; // minimal snapping distance in px screenspace\r\n    private snappingEnabled: boolean;\r\n    private readonly snapX: number[];\r\n    private readonly snapY: number[];\r\n    private readonly callback: (transform: IFreeTransform) => void;\r\n\r\n\r\n    private readonly cornerCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n    private readonly gripSize = 14;\r\n    private readonly edgeSize = 10;\r\n\r\n    private readonly rootEl: HTMLElement; // sits at origin of image\r\n    private readonly transEl: HTMLElement; // at middle of transform. rotates\r\n    private readonly boundsEl: HTMLElement; // draggable bounds rectangle with outline\r\n    private readonly corners: TFreeTransformCorner[] = [];\r\n    private keyListener: KeyListener;\r\n    private boundsPointerListener: PointerListener; // BB.PointerListener\r\n    private anglePointerListener: PointerListener; // BB.PointerListener\r\n    private readonly edges: TFreeTransformEdge[] = [];\r\n    private readonly angleGrip: {\r\n        el: HTMLElement;\r\n        x: number; // transform space\r\n        y: number;\r\n        snap: boolean;\r\n        updateDOM: () => void;\r\n    };\r\n\r\n    private updateScaled (): void {\r\n        this.scaled.x = this.transform.x * this.scale;\r\n        this.scaled.y = this.transform.y * this.scale;\r\n        this.scaled.width = this.transform.width * this.scale;\r\n        this.scaled.height = this.transform.height * this.scale;\r\n        this.scaled.corners = this.corners.map((item) => {\r\n            return {x: item.x * this.scale, y: item.y * this.scale};\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\r\n     * both in image space\r\n     *\r\n     * @param iX - image space\r\n     * @param iY - image space\r\n     * @private\r\n     */\r\n    private snapCorner (iX: number, iY: number): IVector2D {\r\n        if (!this.snappingEnabled) {\r\n            return {x: iX, y: iY};\r\n        }\r\n        let dist: number;\r\n        const snap: {\r\n            x?: number;\r\n            y?: number;\r\n            dist: {\r\n                x?: number;\r\n                y?: number;\r\n            };\r\n        } = {\r\n            x: undefined,\r\n            y: undefined,\r\n            dist: {\r\n                x: undefined,\r\n                y: undefined,\r\n            },\r\n        };\r\n        for (let e = 0; e < this.snapX.length; e++) {\r\n            dist = Math.abs(iX - this.snapX[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.x === undefined || dist < snap.dist.x) {\r\n                    snap.x = this.snapX[e];\r\n                    snap.dist.x = dist;\r\n                }\r\n            }\r\n        }\r\n        for (let e = 0; e < this.snapY.length; e++) {\r\n            dist = Math.abs(iY - this.snapY[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.y === undefined || dist < snap.dist.y) {\r\n                    snap.y = this.snapY[e];\r\n                    snap.dist.y = dist;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (snap.x === undefined && snap.y === undefined) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        return {\r\n            x: snap.x ?? iX,\r\n            y: snap.y ?? iY,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * If constrained return nearest corner pos that fits aspect ratio\r\n     *\r\n     * @param cornerIndex\r\n     * @param iX\r\n     * @param iY\r\n     * @private\r\n     */\r\n    private constrainCorner (cornerIndex: number, iX: number, iY: number): IVector2D {\r\n        if (!this.isConstrained) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        const flip = this.transform.width * this.transform.height < 0 ? -1 : 1;\r\n        return BB.projectPointOnLine(\r\n            {x: this.transform.x, y: this.transform.y},\r\n            toImageSpace(this.ratio, flip * ([0, 2].includes(cornerIndex) ? 1 : -1), this.transform),\r\n            {x: iX, y: iY}\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Update corners according to width height.\r\n     * Not their DOM.\r\n     */\r\n    private updateCornerPositions (): void {\r\n        this.corners[0].x = (-this.transform.width / 2); // top left\r\n        this.corners[0].y = (-this.transform.height / 2);\r\n\r\n        this.corners[1].x = (this.transform.width / 2); // top right\r\n        this.corners[1].y = (-this.transform.height / 2);\r\n\r\n        this.corners[2].x = (this.transform.width / 2); // bottom right\r\n        this.corners[2].y = (this.transform.height / 2);\r\n\r\n        this.corners[3].x = (-this.transform.width / 2); // bottom left\r\n        this.corners[3].y = (this.transform.height / 2);\r\n    }\r\n\r\n    /**\r\n     * If constrained and dragging an edge, restore aspect ratio\r\n     * Updates corner positions.\r\n     *\r\n     * @param widthChanged\r\n     * @param heightChanged\r\n     * @private\r\n     */\r\n    private restoreRatio (widthChanged: boolean, heightChanged: boolean): void {\r\n        if (!this.isConstrained) {\r\n            return;\r\n        }\r\n        const angle90 = Math.abs(this.transform.angleDeg) % 90 === 0;\r\n        const whSwapped = Math.abs(this.transform.angleDeg - 90) % 180 === 0;\r\n        if (heightChanged && !widthChanged) {\r\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\r\n            let newWidth = this.ratio * newHeight;\r\n            if (angle90) {\r\n                newWidth = (whSwapped ? this.transform.y % 1 : this.transform.x % 1) === 0 ?\r\n                    BB.roundEven(newWidth) : BB.roundUneven(newWidth);\r\n            }\r\n            if (this.corners[1].x - this.corners[0].x < 0) {\r\n                newWidth *= -1;\r\n            }\r\n            this.corners[0].x = -newWidth / 2;\r\n            this.corners[3].x = -newWidth / 2;\r\n            this.corners[1].x = newWidth / 2;\r\n            this.corners[2].x = newWidth / 2;\r\n        }\r\n        if (!heightChanged && widthChanged) {\r\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\r\n            let newHeight = newWidth / this.ratio;\r\n            if (angle90) {\r\n                newHeight = (whSwapped ? this.transform.x % 1 : this.transform.y % 1) === 0  ?\r\n                    BB.roundEven(newHeight) : BB.roundUneven(newHeight);\r\n            }\r\n            if (this.corners[3].y - this.corners[0].y < 0) {\r\n                newHeight *= -1;\r\n            }\r\n            this.corners[0].y = -newHeight / 2;\r\n            this.corners[1].y = -newHeight / 2;\r\n            this.corners[2].y = newHeight / 2;\r\n            this.corners[3].y = newHeight / 2;\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * update transform based on corners\r\n     * @private\r\n     */\r\n    private updateTransformViaCorners (): void {\r\n\r\n        // calc transform center in image space\r\n        const rot = BB.rotateAround(\r\n            {x: 0, y: 0},\r\n            {\r\n                x: (this.corners[0].x + this.corners[1].x) / 2,\r\n                y: (this.corners[0].y + this.corners[3].y) / 2,\r\n            },\r\n            this.transform.angleDeg\r\n        );\r\n        this.transform.x = rot.x + this.transform.x;\r\n        this.transform.y = rot.y + this.transform.y;\r\n\r\n        // update size\r\n        this.transform.width = this.corners[1].x - this.corners[0].x;\r\n        this.transform.height = this.corners[3].y - this.corners[0].y;\r\n\r\n        // new center means corners changed their position\r\n        this.updateCornerPositions();\r\n\r\n        this.updateDOM();\r\n    }\r\n\r\n    /**\r\n     * updates DOM according to transform\r\n     * @param skipCallback\r\n     */\r\n    private updateDOM (skipCallback?: boolean): void {\r\n        this.updateScaled();\r\n\r\n        BB.css(this.transEl, {\r\n            left: this.scaled.x + 'px',\r\n            top: this.scaled.y + 'px',\r\n            transformOrigin: '0 0',\r\n            transform: 'rotate(' + this.transform.angleDeg + 'deg)',\r\n        });\r\n\r\n        BB.css(this.boundsEl, {\r\n            width: Math.abs(this.scaled.width) + 'px',\r\n            height: Math.abs(this.scaled.height) + 'px',\r\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\r\n        });\r\n\r\n        this.corners[0].updateDOM();\r\n        this.corners[1].updateDOM();\r\n        this.corners[2].updateDOM();\r\n        this.corners[3].updateDOM();\r\n\r\n        this.edges[0].updateDOM();\r\n        this.edges[1].updateDOM();\r\n        this.edges[2].updateDOM();\r\n        this.edges[3].updateDOM();\r\n\r\n\r\n        this.angleGrip.x = 0;\r\n        this.angleGrip.y = (-Math.abs(this.transform.height * this.scale) / 2) - 20;\r\n        this.angleGrip.updateDOM();\r\n        if (!skipCallback) {\r\n            if (this.callback) { // why should updateDOM trigger the callback?\r\n                this.callback(copyTransform(this.transform));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // --- public ---\r\n    constructor (\r\n        params: {\r\n            x: number; // center of transform region. image space\r\n            y: number;\r\n            width: number; // size of transform region. image space\r\n            height: number;\r\n            angleDeg: number; // angle of transform region. degrees\r\n\r\n            isConstrained: boolean; // proportions constrained\r\n            snapX: number[]; // where snapping along X axis. image space\r\n            snapY: number[]; // where snapping along X axis. image space\r\n            scale: number; // ratio of screen-space / image-space\r\n            callback: (transform: IFreeTransform) => void;\r\n        }\r\n    ) {\r\n        this.transform = { // coordinates and dimensions of transformation\r\n            x: params.x,\r\n            y: params.y,\r\n            width: params.width,\r\n            height: params.height,\r\n            angleDeg: params.angleDeg,\r\n        };\r\n\r\n        this.isConstrained = params.isConstrained;\r\n\r\n        this.snapX = params.snapX;\r\n        this.snapY = params.snapY;\r\n        this.callback = params.callback;\r\n        this.scale = params.scale;\r\n        this.snappingEnabled = true;\r\n        this.ratio = this.transform.width / this.transform.height;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-free-transform',\r\n            css: {\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.transEl = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                position: 'absolute',\r\n            },\r\n        });\r\n\r\n        this.boundsEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                cursor: 'move',\r\n                boxShadow: 'rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px',\r\n            },\r\n        });\r\n\r\n        const pointerRemainder = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        function resetRemainder (): void {\r\n            pointerRemainder.x = 0;\r\n            pointerRemainder.y = 0;\r\n        }\r\n        this.keyListener = new BB.KeyListener({});\r\n\r\n        let boundsStartP = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        this.boundsPointerListener = new BB.PointerListener({\r\n            target: this.boundsEl,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointerdown') {\r\n                    boundsStartP = {x: this.transform.x, y: this.transform.y};\r\n                }\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    this.transform.x = boundsStartP.x + (event.pageX - event.downPageX) / this.scale;\r\n                    this.transform.y = boundsStartP.y + (event.pageY - event.downPageY) / this.scale;\r\n\r\n\r\n                    let dist: number;\r\n                    let snap: {\r\n                        x?: number;\r\n                        y?: number;\r\n                        distX?: number;\r\n                        distY?: number;\r\n                    } = {};\r\n                    if (this.snappingEnabled) {\r\n                        let i;\r\n                        for (i = 0; i < this.snapX.length; i++) {\r\n                            dist = Math.abs(this.transform.x - this.snapX[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.x || dist < snap.distX) {\r\n                                    snap.x = this.snapX[i];\r\n                                    snap.distX = dist;\r\n                                }\r\n                            }\r\n                        }\r\n                        for (i = 0; i < this.snapY.length; i++) {\r\n                            dist = Math.abs(this.transform.y - this.snapY[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.y || dist < snap.distY) {\r\n                                    snap.y = this.snapY[i];\r\n                                    snap.distY = dist;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        let iP;\r\n                        for (i = 0; i < 4; i++) {\r\n                            iP = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n                            let j;\r\n                            for (j = 0; j < this.snapX.length; j++) {\r\n                                dist = Math.abs(iP.x - this.snapX[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.x || dist < snap.distX) {\r\n                                        snap.x = this.snapX[j] - (iP.x - this.transform.x);\r\n                                        snap.distX = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                            for (j = 0; j < this.snapY.length; j++) {\r\n                                dist = Math.abs(iP.y - this.snapY[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.y || dist < snap.distY) {\r\n                                        snap.y = this.snapY[j] - (iP.y - this.transform.y);\r\n                                        snap.distY = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        let projected = BB.projectPointOnLine(\r\n                            {x: 0, y: boundsStartP.y},\r\n                            {x: 10, y: boundsStartP.y},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        let dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        snap = {\r\n                            x: projected.x,\r\n                            y: projected.y,\r\n                            distX: dist,\r\n                            distY: dist,\r\n                        };\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: 0},\r\n                            {x: boundsStartP.x, y: 10},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap = {\r\n                                x: projected.x,\r\n                                y: projected.y,\r\n                                distX: dist,\r\n                                distY: dist,\r\n                            };\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y + 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap = {\r\n                                x: projected.x,\r\n                                y: projected.y,\r\n                                distX: dist,\r\n                                distY: dist,\r\n                            };\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y - 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap = {\r\n                                x: projected.x,\r\n                                y: projected.y,\r\n                                distX: dist,\r\n                                distY: dist,\r\n                            };\r\n                        }\r\n                    }\r\n                    if (snap.x != undefined) {\r\n                        this.transform.x = snap.x;\r\n                    }\r\n                    if (snap.y != undefined) {\r\n                        this.transform.y = snap.y;\r\n                    }\r\n\r\n                    // snap to pixels\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                    }\r\n\r\n                    this.updateDOM();\r\n                }\r\n            },\r\n        });\r\n\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                const g = this.corners[i] = {\r\n                    i: i,\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.gripSize + 'px',\r\n                            height: this.gripSize + 'px',\r\n                            background: '#fff',\r\n                            /*background: [\r\n                                '#ff0000',\r\n                                '#00ff00',\r\n                                '#0000ff',\r\n                                '#ff00ff',\r\n                            ][i],*/\r\n                            borderRadius: this.gripSize + 'px',\r\n                            position: 'absolute',\r\n                            boxShadow: 'inset 0 0 0 2px #000',\r\n                        },\r\n                    }),\r\n                    x: 0,\r\n                    y: 0,\r\n                    virtualPos: {\r\n                        x: 0,\r\n                        y: 0,\r\n                    },\r\n                } as TFreeTransformCorner;\r\n                g.updateDOM = (): void => {\r\n\r\n                    // grip position\r\n                    // if gets small, offset grips, so easier to handle\r\n                    const offsetArr = [[-1, -1], [1, -1], [1, 1], [-1, 1]].map(item => {\r\n                        item[0] *= this.transform.width > 0 ? 1 : -1;\r\n                        item[1] *= this.transform.height > 0 ? 1 : -1;\r\n                        return item;\r\n                    });\r\n                    const tinyOffset = Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20 ? 10 : 0;\r\n\r\n                    BB.css(g.el, {\r\n                        left: (this.scaled.corners[g.i].x - this.gripSize / 2 + offsetArr[i][0] * tinyOffset) + 'px',\r\n                        top: (this.scaled.corners[g.i].y - this.gripSize / 2 + offsetArr[i][1] * tinyOffset) + 'px',\r\n                    });\r\n\r\n\r\n                    // cursor\r\n                    let angle = BB.pointsToAngleDeg(\r\n                        {\r\n                            x: this.transform.x,\r\n                            y: this.transform.y,\r\n                        },\r\n                        toImageSpace(g.x, g.y, this.transform),\r\n                    ) + 135; // offset so nw is 0\r\n                    while (angle < 0) {\r\n                        angle += 360;\r\n                    }\r\n                    const index = Math.round(angle / 45) % this.cornerCursors.length;\r\n                    BB.css(g.el, {\r\n                        cursor: this.cornerCursors[index] + '-resize',\r\n                    });\r\n                };\r\n\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.corners[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            this.corners[i].virtualPos = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n\r\n                        } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                            this.corners[i].virtualPos.x += event.dX / this.scale;\r\n                            this.corners[i].virtualPos.y += event.dY / this.scale;\r\n\r\n                            let iP = {\r\n                                x: this.corners[i].virtualPos.x,\r\n                                y: this.corners[i].virtualPos.y,\r\n                            };\r\n                            iP = this.constrainCorner(i, iP.x, iP.y);\r\n                            if (!this.isConstrained) {\r\n                                iP = this.snapCorner(iP.x, iP.y);\r\n                            }\r\n\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                iP.x = Math.round(iP.x);\r\n                                iP.y = Math.round(iP.y);\r\n                            }\r\n\r\n                            const tP = toTransformSpace(iP.x, iP.y, this.transform);\r\n\r\n                            const dX = tP.x - this.corners[i].x;\r\n                            const dY = tP.y - this.corners[i].y;\r\n                            this.corners[i].x = tP.x;\r\n                            this.corners[i].y = tP.y;\r\n\r\n                            let indexes: number[] = [];\r\n                            if (i === 0) { // top left\r\n                                indexes = [3, 1, 2];\r\n                            } else if (i === 1) { // top right\r\n                                indexes = [2, 0, 3];\r\n                            } else if (i === 2) { // bottom right\r\n                                indexes = [1, 3, 0];\r\n                            } else if (i === 3) { // bottom left\r\n                                indexes = [0, 2, 1];\r\n                            }\r\n\r\n                            this.corners[indexes[0]].x = this.corners[i].x;\r\n                            this.corners[indexes[1]].y = this.corners[i].y;\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                this.corners[indexes[2]].x -= dX;\r\n                                this.corners[indexes[2]].y -= dY;\r\n                                this.corners[indexes[1]].x = this.corners[indexes[2]].x;\r\n                                this.corners[indexes[0]].y = this.corners[indexes[2]].y;\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    },\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.updateCornerPositions();\r\n        this.updateScaled();\r\n\r\n        let isInverted: boolean;\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i): void => {\r\n                this.edges[i] = {\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.edgeSize + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                            /*background: [\r\n                                '#ff000044',\r\n                                '#00ff0044',\r\n                                '#0000ff44',\r\n                                '#ff00ff44',\r\n                            ][i],*/\r\n                            position: 'absolute',\r\n                        },\r\n                    }),\r\n                } as TFreeTransformEdge;\r\n                const g = this.edges[i];\r\n                g.updateDOM = () => {\r\n                    if (i === 0) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: (Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) - this.edgeSize) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 1) {\r\n                        BB.css(g.el, {\r\n                            left: Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    } else if (i === 2) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + 'px',\r\n                            top: Math.max(this.scaled.corners[0].y,this.scaled.corners[3].y) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 3) {\r\n                        BB.css(g.el, {\r\n                            left: (Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) - this.edgeSize) + 'px',\r\n                            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    }\r\n                    let angleOffset = Math.round(this.transform.angleDeg / 45);\r\n                    while (angleOffset < 0) {\r\n                        angleOffset += 8;\r\n                    }\r\n                    angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\r\n                    g.el.style.cursor = this.cornerCursors[angleOffset] + '-resize';\r\n\r\n                };\r\n\r\n                const isVertical = [0, 2].includes(i);\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.edges[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            if (isVertical) { // top bottom\r\n                                isInverted = this.corners[0].y >= this.corners[3].y;\r\n                            } else { // left right\r\n                                isInverted = this.corners[0].x >= this.corners[1].x;\r\n                            }\r\n                            resetRemainder();\r\n                        }\r\n                        if (event.type === 'pointermove' && event.button === 'left') {\r\n                            const tfD = BB.rotateAround({x: 0, y: 0},\r\n                                {x: event.dX / this.scale, y: event.dY / this.scale},\r\n                                -this.transform.angleDeg);\r\n                            let ti = {\r\n                                dX: tfD.x,\r\n                                dY: tfD.y,\r\n                            };\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                ti = BB.intDxy(pointerRemainder, tfD.x, tfD.y);\r\n                            }\r\n\r\n                            let indexes: number[] = [];\r\n                            if (i === 0) { // top\r\n                                indexes = [2, 3, 0, 1];\r\n                            } else if (i === 1) { // right\r\n                                indexes = [0, 3, 1, 2];\r\n                            } else if (i === 2) { // bottom\r\n                                indexes = [0, 1, 2, 3];\r\n                            } else if (i === 3) { // left\r\n                                indexes = [1, 2, 0, 3];\r\n                            }\r\n\r\n                            const dimension = isVertical ? 'y' : 'x';\r\n                            const d = isVertical ? ti.dY : ti.dX;\r\n\r\n                            if (isInverted) {\r\n                                this.corners[indexes[0]][dimension] += d;\r\n                                this.corners[indexes[1]][dimension] += d;\r\n                            } else {\r\n                                this.corners[indexes[2]][dimension] += d;\r\n                                this.corners[indexes[3]][dimension] += d;\r\n                            }\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                if (isInverted) {\r\n                                    this.corners[indexes[2]][dimension] -= d;\r\n                                    this.corners[indexes[3]][dimension] -= d;\r\n                                } else {\r\n                                    this.corners[indexes[0]][dimension] -= d;\r\n                                    this.corners[indexes[1]][dimension] -= d;\r\n                                }\r\n                            }\r\n\r\n                            if (isVertical) { // top bottom\r\n                                this.restoreRatio(false, true);\r\n                            } else { // left right\r\n                                this.restoreRatio(true, false);\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    },\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.angleGrip = {\r\n            el: BB.el({\r\n                css: {\r\n                    cursor: 'url(' + rotateImg + ') 10 10, move',\r\n                    width: this.gripSize + 'px',\r\n                    height: this.gripSize + 'px',\r\n                    background: '#0ff',\r\n                    borderRadius: this.gripSize + 'px',\r\n                    position: 'absolute',\r\n                    boxShadow: 'inset 0 0 0 2px #000',\r\n                },\r\n            }),\r\n            x: 0,\r\n            y: 0,\r\n            snap: false,\r\n            updateDOM: () => {\r\n                BB.css(this.angleGrip.el, {\r\n                    left: (this.angleGrip.x - this.gripSize / 2) + 'px',\r\n                    top: (this.angleGrip.y - this.gripSize / 2) + 'px',\r\n                });\r\n            },\r\n        };\r\n        BB.el({\r\n            parent: this.angleGrip.el,\r\n            css: {\r\n                width: '2px',\r\n                height: '13px',\r\n                left: (this.gripSize / 2 - 1) + 'px',\r\n                top: this.gripSize + 'px',\r\n                background: '#0ff',\r\n                position: 'absolute',\r\n            },\r\n        });\r\n\r\n        this.anglePointerListener = new BB.PointerListener({\r\n            target: this.angleGrip.el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    const bounds = this.rootEl.getBoundingClientRect();\r\n                    const offset = {\r\n                        x: bounds.left - this.rootEl.scrollLeft,\r\n                        y: bounds.top - this.rootEl.scrollTop,\r\n                    };\r\n                    const iP = {x: (event.clientX - offset.x) / this.scale, y: (event.clientY - offset.y) / this.scale};\r\n\r\n                    const a = BB.pointsToAngleDeg({x: this.transform.x, y: this.transform.y}, iP) + 90;\r\n                    this.transform.angleDeg = a;\r\n                    const snapDeg = Math.round(a / 360 * 8) * 45;\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    } else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    }\r\n                    this.updateDOM();\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                        this.updateDOM();\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        snapToPixel(this.transform);\r\n        this.updateDOM(true);\r\n        BB.append(this.transEl, [\r\n            this.boundsEl,\r\n            this.edges[0].el,\r\n            this.edges[1].el,\r\n            this.edges[2].el,\r\n            this.edges[3].el,\r\n            this.corners[0].el,\r\n            this.corners[1].el,\r\n            this.corners[2].el,\r\n            this.corners[3].el,\r\n            this.angleGrip.el,\r\n        ]);\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    getTransform (): IFreeTransform {\r\n        return copyTransform(this.transform);\r\n    }\r\n\r\n    setConstrained (b: boolean): void {\r\n        this.isConstrained = b;\r\n        if (b && this.transform.width !== 0 && this.transform.height !== 0) {\r\n            this.ratio = Math.abs(this.transform.width / this.transform.height);\r\n        }\r\n    }\r\n\r\n    setSnapping (s: boolean): void {\r\n        this.snappingEnabled = s;\r\n    }\r\n\r\n    setPos (p: IVector2D): void {\r\n        this.transform.x = p.x;\r\n        this.transform.y = p.y;\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    move (dX: number, dY: number): void {\r\n        this.transform.x += dX;\r\n        this.transform.y += dY;\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setSize (w: number, h: number): void {\r\n        this.transform.width = w;\r\n        this.transform.height = h;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n        }\r\n        this.updateCornerPositions();\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setAngleDeg (a: number): void {\r\n        this.transform.angleDeg = a;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n            this.updateCornerPositions();\r\n        }\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getRatio (): number {\r\n        return this.ratio;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.keyListener.destroy();\r\n        this.boundsPointerListener.destroy();\r\n        this.corners[0].pointerListener.destroy();\r\n        this.corners[1].pointerListener.destroy();\r\n        this.corners[2].pointerListener.destroy();\r\n        this.corners[3].pointerListener.destroy();\r\n        this.edges[0].pointerListener.destroy();\r\n        this.edges[1].pointerListener.destroy();\r\n        this.edges[2].pointerListener.destroy();\r\n        this.edges[3].pointerListener.destroy();\r\n        this.anglePointerListener.destroy();\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fcdZI\");","import {IVector2D} from '../../../bb/bb-types';\r\nimport {BB} from '../../../bb/bb';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\nexport interface IFreeTransform {\r\n    x: number; // center of transform region. image space\r\n    y: number;\r\n    width: number; // size of transform region. image space\r\n    height: number;\r\n    angleDeg: number; // angle of transform region. degrees\r\n}\r\n\r\n\r\nexport type TFreeTransformCorner = {\r\n    i: number; // index in corners array\r\n    el: HTMLElement; // draggable corner circle in DOM\r\n    x: number; // unscaled position (transform space)\r\n    y: number;\r\n    virtualPos: IVector2D; // unscaled temporary position (image space)\r\n    updateDOM: () => void; // update styling in DOM\r\n    pointerListener: PointerListener;\r\n};\r\n\r\nexport type TFreeTransformEdge = { // derive position from corners\r\n    el: HTMLElement;\r\n    updateDOM: () => void;\r\n    pointerListener: PointerListener;\r\n};\r\n\r\n/**\r\n * snap entire transform to pixel grid. changes transform\r\n *\r\n * for x y:\r\n * If a dimension has an even size, it be an integer.\r\n * If it's uneven, it's sits exactly half way between two pixels.\r\n *\r\n * @param transform\r\n */\r\nexport function snapToPixel (transform: IFreeTransform): void {\r\n    if (Math.abs(transform.angleDeg) % 90 !== 0) {\r\n        return;\r\n    }\r\n\r\n    transform.width = Math.round(transform.width);\r\n    transform.height = Math.round(transform.height);\r\n    // 0 is original orientation.\r\n    // At 90 and 270 width and height become swapped due to different orientation.\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    transform.x = ((whSwapped ? transform.height : transform.width) % 2 === 0) ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\r\n    transform.y = ((whSwapped ? transform.width : transform.height) % 2 === 0)  ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\r\n}\r\n\r\nexport function copyTransform (transform: IFreeTransform): IFreeTransform {\r\n    return {\r\n        x: transform.x,\r\n        y: transform.y,\r\n        width: transform.width,\r\n        height: transform.height,\r\n        angleDeg: transform.angleDeg,\r\n    };\r\n}\r\n\r\n/**\r\n * image space to transform space\r\n * - origin of transform space is at center of transform bounds.\r\n * - same scale as image space. -> one unit is x: 1/width, y: 1/height\r\n * - up is where transform points up\r\n * - x goes right\r\n * - y goes down\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nexport function toTransformSpace (x: number, y: number, transform: IFreeTransform): IVector2D {\r\n    let px, py;\r\n    px = x - transform.x;\r\n    py = y - transform.y;\r\n\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: px, y: py},\r\n        -transform.angleDeg);\r\n    px = rot.x;\r\n    py = rot.y;\r\n\r\n    return {\r\n        x: px,\r\n        y: py,\r\n    };\r\n}\r\n\r\n/**\r\n * transform space to image space\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nexport function toImageSpace (x: number, y: number, transform: IFreeTransform): IVector2D {\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: x, y: y},\r\n        transform.angleDeg);\r\n    return {\r\n        x: rot.x + transform.x,\r\n        y: rot.y + transform.y,\r\n    };\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {KlCanvasPreview} from '../../canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './free-transform';\r\nimport {IKlBasicLayer} from '../../kl-types';\r\nimport {IRect} from '../../../bb/bb-types';\r\n\r\n/**\r\n * a basic canvas where you can transform one layer(move around, rotate, scale)\r\n *\r\n * DOM Structure:\r\n * div\r\n *      innerWrapper\r\n *          klCanvasPreview\r\n *          transform.div\r\n *\r\n */\r\nexport class FreeTransformCanvas {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly freeTransform: FreeTransform;\r\n    private readonly layers: IKlBasicLayer[];\r\n    private readonly transformIndex: number;\r\n    private readonly imageWidth: number;\r\n    private readonly imageHeight: number;\r\n    private readonly initTransform: IRect;\r\n    private readonly scale: number;\r\n    private readonly previewLayerArr: IKlBasicLayer[];\r\n    private readonly klCanvasPreview: KlCanvasPreview;\r\n\r\n    private updatePreview (): void {\r\n        if (!this.freeTransform) {\r\n            return;\r\n        }\r\n\r\n        const transform = this.freeTransform.getTransform();\r\n        if (this.scale < 1) {\r\n            transform.x *= this.scale;\r\n            transform.y *= this.scale;\r\n            transform.width *= this.scale;\r\n            transform.height *= this.scale;\r\n        }\r\n\r\n        const destCanvas = this.previewLayerArr[this.transformIndex].image;\r\n        const ctx = BB.ctx((destCanvas as HTMLCanvasElement));\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, destCanvas.width, destCanvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            ctx,\r\n            this.layers[this.transformIndex].image,\r\n            transform,\r\n            undefined,\r\n            BB.testShouldPixelate(\r\n                transform,\r\n                transform.width / this.initTransform.width,\r\n                transform.height / this.initTransform.height\r\n            ),\r\n        );\r\n        ctx.restore();\r\n        this.klCanvasPreview.render();\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            elementWidth: number;\r\n            elementHeight: number;\r\n            imageWidth: number;\r\n            imageHeight: number;\r\n            layers: IKlBasicLayer[];\r\n            transformIndex: number;\r\n        }\r\n    ) {\r\n        this.imageWidth = p.imageWidth;\r\n        this.imageHeight = p.imageHeight;\r\n        const previewFit = BB.fitInto(\r\n            p.imageWidth,\r\n            this.imageHeight,\r\n            p.elementWidth - 20,\r\n            p.elementHeight - 60,\r\n            1\r\n        );\r\n        this.scale = previewFit.width / p.imageWidth;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: p.elementWidth + 'px',\r\n                height: p.elementHeight + 'px',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n        this.layers = p.layers;\r\n        this.transformIndex = p.transformIndex;\r\n\r\n\r\n        const innerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: previewFit.width + 'px',\r\n                height: previewFit.height + 'px',\r\n            },\r\n        });\r\n        this.rootEl.append(innerWrapper);\r\n\r\n        this.previewLayerArr = this.layers.map(item => {\r\n            return {\r\n                image: item.image,\r\n                mixModeStr: item.mixModeStr,\r\n                opacity: item.opacity,\r\n            };\r\n        });\r\n        this.previewLayerArr[this.previewLayerArr.length - 1].image = BB.canvas(\r\n            this.scale > 1 ? this.imageWidth : previewFit.width,\r\n            this.scale > 1 ? this.imageHeight : previewFit.height,\r\n        );\r\n        this.klCanvasPreview = new KlCanvasPreview({\r\n            width: previewFit.width,\r\n            height: previewFit.height,\r\n            layers: this.previewLayerArr,\r\n        });\r\n        innerWrapper.append(this.klCanvasPreview.getElement());\r\n\r\n        {\r\n            let transformSize = {\r\n                width: this.layers[this.transformIndex].image.width * this.scale,\r\n                height: this.layers[this.transformIndex].image.height * this.scale,\r\n            };\r\n            if (transformSize.width > previewFit.width || transformSize.height > previewFit.height) {\r\n                transformSize = BB.fitInto(\r\n                    this.layers[this.transformIndex].image.width,\r\n                    this.layers[this.transformIndex].image.height,\r\n                    previewFit.width,\r\n                    previewFit.height,\r\n                    1\r\n                );\r\n            }\r\n            this.initTransform = {\r\n                x: this.imageWidth / 2,\r\n                y: this.imageHeight / 2,\r\n                width: this.layers[this.transformIndex].image.width,\r\n                height: this.layers[this.transformIndex].image.height,\r\n            };\r\n            this.freeTransform = new FreeTransform({\r\n                x: this.initTransform.x,\r\n                y: this.initTransform.y,\r\n                width: this.initTransform.width,\r\n                height: this.initTransform.height,\r\n                angleDeg: 0,\r\n                isConstrained: true,\r\n                snapX: [0, this.imageWidth],\r\n                snapY: [0, this.imageHeight],\r\n                scale: this.scale,\r\n                callback: (transform) => {\r\n                    this.updatePreview();\r\n                },\r\n            });\r\n        }\r\n        BB.css(this.freeTransform.getElement(), {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n        });\r\n        innerWrapper.append(this.freeTransform.getElement());\r\n        setTimeout(() => this.updatePreview(), 0);\r\n    }\r\n\r\n\r\n    // ---- interface ----\r\n    move (dX: number, dY: number): void {\r\n        this.freeTransform.move(dX, dY);\r\n    }\r\n\r\n    reset (): void {\r\n        const w = this.layers[this.transformIndex].image.width;\r\n        const h = this.layers[this.transformIndex].image.height;\r\n\r\n        this.freeTransform.setSize(w, h);\r\n        this.freeTransform.setPos({x: w / 2, y: h / 2});\r\n        this.freeTransform.setAngleDeg(0);\r\n        this.updatePreview();\r\n    }\r\n\r\n    setTransformFit (): void {\r\n\r\n        const fit = BB.fitInto(\r\n            this.layers[this.transformIndex].image.width,\r\n            this.layers[this.transformIndex].image.height,\r\n            this.imageWidth,\r\n            this.imageHeight,\r\n            1\r\n        );\r\n\r\n        this.freeTransform.setSize(fit.width, fit.height);\r\n        this.freeTransform.setPos({x: fit.width / 2, y: fit.height / 2});\r\n        this.freeTransform.setAngleDeg(0);\r\n        this.updatePreview();\r\n    }\r\n\r\n    setTransformCenter (): void {\r\n        this.freeTransform.setPos({x: this.imageWidth / 2, y: this.imageHeight / 2});\r\n        this.freeTransform.setAngleDeg(0);\r\n        this.updatePreview();\r\n    }\r\n\r\n    /**\r\n     * gives you the transformation in the original scale\r\n     */\r\n    getTransformation (): any { // todo\r\n        if (!this.freeTransform) {\r\n            return false;\r\n        }\r\n        return this.freeTransform.getTransform();\r\n    }\r\n\r\n    getIsPixelated (): boolean {\r\n        const transform = this.freeTransform.getTransform();\r\n        return BB.testShouldPixelate(\r\n            transform,\r\n            transform.width / this.initTransform.width,\r\n            transform.height / this.initTransform.height\r\n        );\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.freeTransform.destroy();\r\n        this.klCanvasPreview.destroy();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IRect, IVector2D} from '../../../bb/bb-types';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n\r\ntype TUpdateElement = {\r\n    el: HTMLElement;\r\n    update: () => void;\r\n};\r\n\r\n/**\r\n * Interactive preview for crop filter. Corners and edges can be dragged.\r\n * the div that you append this to must be relative\r\n */\r\nexport class Cropper {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private x: number;\r\n    private y: number;\r\n    private width: number;\r\n    private height: number;\r\n    private scale: number;\r\n    private readonly grips: IVector2D[]; // aka corner coordinates\r\n    private readonly edges: TUpdateElement[];\r\n    private readonly cornerElArr: TUpdateElement[];\r\n    private readonly darken: TUpdateElement[];\r\n    private readonly outline: TUpdateElement;\r\n    private readonly thirdsHorizontal: TUpdateElement;\r\n    private readonly thirdsVertical: TUpdateElement;\r\n    private readonly keyListener: KeyListener;\r\n    private readonly pointerRemainder: IVector2D;\r\n\r\n    private readonly outlinePointerListener: PointerListener;\r\n\r\n    private readonly corner0PointerListener: PointerListener;\r\n    private readonly corner1PointerListener: PointerListener;\r\n    private readonly corner2PointerListener: PointerListener;\r\n    private readonly corner3PointerListener: PointerListener;\r\n\r\n    private readonly edge0PointerListener: PointerListener;\r\n    private readonly edge1PointerListener: PointerListener;\r\n    private readonly edge2PointerListener: PointerListener;\r\n    private readonly edge3PointerListener: PointerListener;\r\n\r\n    private readonly callback: (val: IRect) => void;\r\n\r\n    private update (): void {\r\n        this.edges[0].update();\r\n        this.edges[1].update();\r\n        this.edges[2].update();\r\n        this.edges[3].update();\r\n        this.cornerElArr[0].update();\r\n        this.cornerElArr[1].update();\r\n        this.cornerElArr[2].update();\r\n        this.cornerElArr[3].update();\r\n        this.darken[0].update();\r\n        this.darken[1].update();\r\n        this.darken[2].update();\r\n        this.darken[3].update();\r\n        this.outline.update();\r\n        this.thirdsHorizontal.update();\r\n        this.thirdsVertical.update();\r\n    }\r\n\r\n    private commit (): void {\r\n        this.pointerRemainder.x = 0;\r\n        this.pointerRemainder.y = 0;\r\n        this.callback(this.getTransform());\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        params: {\r\n            x: number; // int, pos in relation to image\r\n            y: number; // int\r\n            width: number; // int\r\n            height: number; // int\r\n            maxW: number;\r\n            maxH: number;\r\n            scale: number; // float, zoom\r\n            callback: (val: IRect) => void;\r\n        }\r\n    ) {\r\n\r\n        this.x = params.x;\r\n        this.y = params.y;\r\n        this.width = params.width;\r\n        this.height = params.height;\r\n        this.scale = params.scale;\r\n        this.callback = params.callback;\r\n\r\n        const maxW = params.maxW;\r\n        const maxH = params.maxW;\r\n        this.rootEl = BB.el();\r\n        const gripCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n\r\n        this.keyListener = new BB.KeyListener({});\r\n\r\n        BB.css(this.rootEl, {\r\n            position: 'absolute',\r\n            left: (this.x * this.scale) + 'px',\r\n            top: (this.y * this.scale) + 'px',\r\n        });\r\n\r\n        this.outline = {\r\n            el: BB.el({\r\n                css: {\r\n                    position: 'absolute',\r\n                    border: '1px dashed #fff',\r\n                    cursor: 'move',\r\n                },\r\n            }),\r\n            update: () => {\r\n                BB.css(this.outline.el, {\r\n                    left: (this.grips[0].x * this.scale - 1) + 'px',\r\n                    top: (this.grips[0].y * this.scale - 1) + 'px',\r\n                    width: ((this.grips[2].x - this.grips[0].x) * this.scale) + 'px',\r\n                    height: ((this.grips[2].y - this.grips[0].y) * this.scale) + 'px',\r\n                });\r\n            },\r\n        };\r\n\r\n        this.pointerRemainder = { // needs to be reset after dragging complete\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        this.outlinePointerListener = new BB.PointerListener({\r\n            target: this.outline.el,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n\r\n                    this.grips[0].x += dX;\r\n                    this.grips[0].y += dY;\r\n                    this.grips[1].x += dX;\r\n                    this.grips[1].y += dY;\r\n                    this.grips[2].x += dX;\r\n                    this.grips[2].y += dY;\r\n                    this.grips[3].x += dX;\r\n                    this.grips[3].y += dY;\r\n\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n\r\n        this.thirdsHorizontal = {\r\n            el: BB.el({\r\n                css: {\r\n                    position: 'absolute',\r\n                    borderTop: '1px solid #0ff',\r\n                    borderBottom: '1px solid #0ff',\r\n                },\r\n            }),\r\n            update: () => {\r\n                BB.css(this.thirdsHorizontal.el, {\r\n                    left: (this.grips[0].x * this.scale) + 'px',\r\n                    top: ((this.grips[0].y + (this.grips[2].y - this.grips[0].y) / 3) * this.scale) + 'px',\r\n                    width: ((this.grips[2].x - this.grips[0].x) * this.scale) + 'px',\r\n                    height: ((this.grips[2].y - this.grips[0].y) / 3 * this.scale) + 'px',\r\n                });\r\n            },\r\n        };\r\n\r\n        this.thirdsVertical = {\r\n            el: BB.el({\r\n                css: {\r\n                    position: 'absolute',\r\n                    borderLeft: '1px solid #0ff',\r\n                    borderRight: '1px solid #0ff',\r\n                },\r\n            }),\r\n            update: () => {\r\n                BB.css(this.thirdsVertical.el, {\r\n                    left: ((this.grips[0].x + (this.grips[2].x - this.grips[0].x) / 3) * this.scale) + 'px',\r\n                    top: (this.grips[0].y * this.scale) + 'px',\r\n                    width: ((this.grips[2].x - this.grips[0].x) / 3 * this.scale) + 'px',\r\n                    height: ((this.grips[2].y - this.grips[0].y) * this.scale) + 'px',\r\n                });\r\n            },\r\n        };\r\n\r\n        const gripSize = 40;\r\n        const gripOverlay = 10;\r\n\r\n        this.grips = [\r\n            {x: 0, y: 0}, // top left\r\n            {x: this.width, y: 0}, // top right\r\n            {x: this.width, y: this.height}, // bottom right\r\n            {x: 0, y: this.height}, //bottom left\r\n        ];\r\n\r\n        const transformTop = (dY: number) => {\r\n            this.grips[0].y += dY;\r\n            this.grips[0].y = BB.clamp(this.grips[0].y, this.grips[3].y - maxH, this.grips[3].y - 1);\r\n            this.grips[1].y = this.grips[0].y;\r\n        };\r\n        const transformRight = (dX: number) => {\r\n            this.grips[1].x += dX;\r\n            this.grips[1].x = BB.clamp(this.grips[1].x, this.grips[0].x + 1, this.grips[0].x + maxW);\r\n            this.grips[2].x = this.grips[1].x;\r\n        };\r\n        const transformBottom = (dY: number) => {\r\n            this.grips[2].y += dY;\r\n            this.grips[2].y = BB.clamp(this.grips[2].y, this.grips[1].y + 1, this.grips[1].y + maxH);\r\n            this.grips[3].y = this.grips[2].y;\r\n        };\r\n        const transformLeft = (dX: number) => {\r\n            this.grips[0].x += dX;\r\n            this.grips[0].x = BB.clamp(this.grips[0].x, this.grips[1].x - maxW, this.grips[1].x - 1);\r\n            this.grips[3].x = this.grips[0].x;\r\n        };\r\n\r\n\r\n\r\n\r\n        this.edges = [];\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n\r\n                const el = BB.el({\r\n                    css: {\r\n                        width: gripSize + 'px',\r\n                        height: gripSize + 'px',\r\n                        //background: '#0f0',\r\n                        position: 'absolute',\r\n                    },\r\n                });\r\n\r\n                const update = () => {\r\n                    if (i === 0) { //top\r\n                        BB.css(el, {\r\n                            left: (this.grips[0].x * this.scale + gripOverlay) + 'px',\r\n                            top: (this.grips[0].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            width: ((this.grips[1].x - this.grips[0].x) * this.scale - gripOverlay * 2) + 'px',\r\n                            height: (gripSize * 2) + 'px',\r\n                        });\r\n                    } else if (i === 1) { //right\r\n                        BB.css(el, {\r\n                            left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\r\n                            top: (this.grips[1].y * this.scale + gripOverlay) + 'px',\r\n                            width: (gripSize * 2) + 'px',\r\n                            height: ((this.grips[2].y - this.grips[1].y) * this.scale - gripOverlay * 2) + 'px',\r\n                        });\r\n                    } else if (i === 2) { //bottom\r\n                        BB.css(el, {\r\n                            left: (this.grips[3].x * this.scale + gripOverlay) + 'px',\r\n                            top: (this.grips[3].y * this.scale - gripOverlay) + 'px',\r\n                            width: ((this.grips[2].x - this.grips[3].x) * this.scale - gripOverlay * 2) + 'px',\r\n                            height: (gripSize * 2) + 'px',\r\n                        });\r\n                    } else if (i === 3) { //left\r\n                        BB.css(el, {\r\n                            left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            top: (this.grips[0].y * this.scale + gripOverlay) + 'px',\r\n                            width: (gripSize * 2) + 'px',\r\n                            height: ((this.grips[3].y - this.grips[0].y) * this.scale - gripOverlay * 2) + 'px',\r\n                        });\r\n                    }\r\n                    const angleOffset = i * 2 + 1;\r\n                    el.style.cursor = gripCursors[angleOffset] + '-resize';\r\n\r\n                };\r\n\r\n                this.edges[i] = {\r\n                    el,\r\n                    update,\r\n                };\r\n            })(i);\r\n        }\r\n\r\n        this.darken = [];\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                const g = BB.el({\r\n                    css: {\r\n                        position: 'absolute',\r\n                        background: '#000',\r\n                        opacity: '0.5',\r\n                    },\r\n                });\r\n                const update = () => {\r\n                    if (i === 0) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[0].x * this.scale) + 'px',\r\n                            top: (this.grips[0].y * this.scale - 8000) + 'px',\r\n                            width: ((this.grips[1].x - this.grips[0].x) * this.scale) + 'px',\r\n                            height: '8000px',\r\n                        });\r\n                    } else if (i === 1) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[1].x * this.scale) + 'px',\r\n                            top: (this.grips[1].y * this.scale - 8000) + 'px',\r\n                            width: '8000px',\r\n                            height: 16000 + 'px',\r\n                        });\r\n                    } else if (i === 2) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[3].x * this.scale) + 'px',\r\n                            top: (this.grips[3].y * this.scale) + 'px',\r\n                            width: ((this.grips[2].x - this.grips[3].x) * this.scale) + 'px',\r\n                            height: '8000px',\r\n                        });\r\n                    } else if (i === 3) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[0].x * this.scale - 8000) + 'px',\r\n                            top: (this.grips[0].y * this.scale - 8000) + 'px',\r\n                            width: '8000px',\r\n                            height: 16000 + 'px',\r\n                        });\r\n                    }\r\n\r\n                };\r\n\r\n                this.darken[i] = {\r\n                    el: g,\r\n                    update,\r\n                };\r\n            })(i);\r\n        }\r\n\r\n        this.edge0PointerListener = new BB.PointerListener({\r\n            target: this.edges[0].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformTop(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformBottom(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        this.edge1PointerListener = new BB.PointerListener({\r\n            target: this.edges[1].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformRight(dX);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformLeft(-dX);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        this.edge2PointerListener = new BB.PointerListener({\r\n            target: this.edges[2].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformBottom(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformTop(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        this.edge3PointerListener = new BB.PointerListener({\r\n            target: this.edges[3].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformLeft(dX);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformRight(-dX);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n        this.cornerElArr = [];\r\n        (() => {\r\n            for (let i = 0; i < 4; i++) {\r\n                ((i) => {\r\n                    const g = BB.el({\r\n                        css: {\r\n                            //background: '#f00',\r\n                            width: (gripSize * 2) + 'px',\r\n                            height: (gripSize * 2) + 'px',\r\n                            position: 'absolute',\r\n                            cursor: ['nwse-resize', 'nesw-resize'][i % 2],\r\n                        },\r\n                    });\r\n\r\n                    const update = () => {\r\n                        if (i === 0) { //top left\r\n                            BB.css(g, {\r\n                                left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                                top: (this.grips[0].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            });\r\n                        } else if (i === 1) { //top right\r\n                            BB.css(g, {\r\n                                left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\r\n                                top: (this.grips[1].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            });\r\n                        } else if (i === 2) { //bottom right\r\n                            BB.css(g, {\r\n                                left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\r\n                                top: (this.grips[2].y * this.scale - gripOverlay) + 'px',\r\n                            });\r\n                        } else if (i === 3) { //bottom left\r\n                            BB.css(g, {\r\n                                left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                                top: (this.grips[2].y * this.scale - gripOverlay) + 'px',\r\n                            });\r\n                        }\r\n                    };\r\n\r\n                    this.cornerElArr[i] = {\r\n                        el: g,\r\n                        update,\r\n                    };\r\n                })(i);\r\n            }\r\n        })();\r\n        //top left\r\n        this.corner0PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[0].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformLeft(dX);\r\n                    transformTop(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformRight(-dX);\r\n                        transformBottom(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        //top right\r\n        this.corner1PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[1].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformRight(dX);\r\n                    transformTop(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformLeft(-dX);\r\n                        transformBottom(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        //bottom right\r\n        this.corner2PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[2].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformRight(dX);\r\n                    transformBottom(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformLeft(-dX);\r\n                        transformTop(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        //bottom left\r\n        this.corner3PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[3].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformLeft(dX);\r\n                    transformBottom(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformRight(-dX);\r\n                        transformTop(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n        this.rootEl.append(\r\n            this.darken[1].el,\r\n            this.darken[0].el,\r\n            this.darken[2].el,\r\n            this.darken[3].el,\r\n            this.thirdsHorizontal.el,\r\n            this.thirdsVertical.el,\r\n            this.outline.el,\r\n\r\n            this.edges[1].el,\r\n            this.edges[0].el,\r\n            this.edges[2].el,\r\n            this.edges[3].el,\r\n\r\n            this.cornerElArr[0].el,\r\n            this.cornerElArr[1].el,\r\n            this.cornerElArr[2].el,\r\n            this.cornerElArr[3].el,\r\n        );\r\n\r\n        this.update();\r\n\r\n    }\r\n\r\n    // ---- interface ----\r\n    getTransform (): IRect {\r\n        this.grips[1].x -= this.grips[0].x;\r\n        this.grips[1].y -= this.grips[0].y;\r\n        this.grips[2].x -= this.grips[0].x;\r\n        this.grips[2].y -= this.grips[0].y;\r\n        this.grips[3].x -= this.grips[0].x;\r\n        this.grips[3].y -= this.grips[0].y;\r\n        this.x += this.grips[0].x;\r\n        this.y += this.grips[0].y;\r\n        this.grips[0].x = 0;\r\n        this.grips[0].y = 0;\r\n        return {\r\n            x: this.x,\r\n            y: this.y,\r\n            width: this.grips[1].x,\r\n            height: this.grips[2].y,\r\n        };\r\n    }\r\n\r\n    setTransform (p: IRect): void {\r\n        this.x = p.x;\r\n        this.y = p.y;\r\n        this.width = p.width;\r\n        this.height = p.height;\r\n\r\n        BB.css(this.rootEl, {\r\n            left: (this.x * this.scale) + 'px',\r\n            top: (this.y * this.scale) + 'px',\r\n        });\r\n\r\n        this.grips[0].x = 0;\r\n        this.grips[0].y = 0;\r\n        this.grips[1].x = this.width;\r\n        this.grips[1].y = 0;\r\n        this.grips[2].x = this.width;\r\n        this.grips[2].y = this.height;\r\n        this.grips[3].x = 0;\r\n        this.grips[3].y = this.height;\r\n\r\n        this.update();\r\n        this.commit();\r\n    }\r\n\r\n    setScale (s: number): void {\r\n        this.scale = s;\r\n        BB.css(this.rootEl, {\r\n            left: (this.x * this.scale) + 'px',\r\n            top: (this.y * this.scale) + 'px',\r\n        });\r\n        this.update();\r\n    }\r\n\r\n    showThirds (b: boolean): void {\r\n\r\n        this.thirdsHorizontal.el.style.display = b ? 'block' : 'none';\r\n        this.thirdsVertical.el.style.display = b ? 'block' : 'none';\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.keyListener.destroy();\r\n        this.outlinePointerListener.destroy();\r\n        this.corner0PointerListener.destroy();\r\n        this.corner1PointerListener.destroy();\r\n        this.corner2PointerListener.destroy();\r\n        this.corner3PointerListener.destroy();\r\n        this.edge0PointerListener.destroy();\r\n        this.edge1PointerListener.destroy();\r\n        this.edge2PointerListener.destroy();\r\n        this.edge3PointerListener.destroy();\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\nimport {TKlCanvasLayer, TUiLayout} from '../../kl-types';\r\nimport {ISize2D} from '../../../bb/bb-types';\r\nimport {theme} from '../../../theme/theme';\r\n\r\n\r\n/**\r\n * Previews currently active layer\r\n * thumbnail (hover shows bigger preview), layername, opacity\r\n *\r\n * internally listens to kl history. updates when there's a change.\r\n * but you need to update it when the active layer changed. (different canvas object)\r\n *\r\n * update visibility for performance\r\n */\r\nexport class LayerPreview {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly contentWrapperEl: HTMLElement;\r\n    private readonly height: number;\r\n    private layerObj: TKlCanvasLayer;\r\n    private isVisible: boolean;\r\n    private uiState: TUiLayout;\r\n\r\n    private readonly nameLabelEl: HTMLElement;\r\n    private readonly opacityEl: HTMLElement;\r\n    private lastDrawnSize: ISize2D;\r\n    private lastDrawnState: number; // from KlHistory\r\n\r\n    private readonly canvasSize: number;\r\n    private readonly canvas: HTMLCanvasElement;\r\n    private readonly canvasCtx: CanvasRenderingContext2D;\r\n\r\n    private animationCount: number; // >0 means it's animating\r\n    private readonly animationLength: number;\r\n\r\n    private readonly animationCanvas: HTMLCanvasElement;\r\n    private readonly animationCanvasCtx: CanvasRenderingContext2D;\r\n    private animationCanvasCheckerPattern: CanvasPattern;\r\n\r\n    private largeCanvasIsVisible: boolean;\r\n    private readonly largeCanvasWrapper: HTMLElement;\r\n    private readonly largeCanvasSize: number;\r\n    private readonly largeCanvas: HTMLCanvasElement;\r\n    private readonly largeCanvasCtx: CanvasRenderingContext2D;\r\n    private largeCanvasCheckerPattern: CanvasPattern;\r\n\r\n\r\n    private updateCheckerPatterns (): void {\r\n        const checker = BB.createCheckerCanvas(4, theme.isDark());\r\n        this.animationCanvasCheckerPattern = this.animationCanvasCtx.createPattern(checker, 'repeat');\r\n        this.largeCanvasCheckerPattern = this.canvasCtx.createPattern(checker, 'repeat');\r\n    }\r\n    \r\n    private animate (): void {\r\n        if (this.animationCount === 0) {\r\n            return;\r\n        }\r\n\r\n        this.animationCount--;\r\n\r\n        this.canvasCtx.save();\r\n        this.canvasCtx.globalAlpha = Math.pow((this.animationLength - this.animationCount) / this.animationLength, 2);\r\n        this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\r\n        this.canvasCtx.restore();\r\n\r\n        if (this.animationCount > 0) {\r\n            requestAnimationFrame(() => this.animate());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * is always instant\r\n     */\r\n    private drawLargeCanvas (): void {\r\n\r\n        if (!this.largeCanvasIsVisible || !this.layerObj) {\r\n            return;\r\n        }\r\n\r\n        const layerCanvas = this.layerObj.context.canvas;\r\n\r\n        const canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, this.largeCanvasSize, this.largeCanvasSize, 1);\r\n        this.largeCanvas.width = Math.round(canvasDimensions.width);\r\n        this.largeCanvas.height = Math.round(canvasDimensions.height);\r\n        this.largeCanvasCtx.save();\r\n        if (this.largeCanvas.width > layerCanvas.width) {\r\n            this.largeCanvasCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            this.largeCanvasCtx.imageSmoothingEnabled = true;\r\n            this.largeCanvasCtx.imageSmoothingQuality = 'high';\r\n        }\r\n        this.largeCanvasCtx.fillStyle = this.largeCanvasCheckerPattern;\r\n        this.largeCanvasCtx.fillRect(0, 0, this.largeCanvas.width, this.largeCanvas.height);\r\n        this.largeCanvasCtx.drawImage(layerCanvas, 0, 0, this.largeCanvas.width, this.largeCanvas.height);\r\n        this.largeCanvasCtx.restore();\r\n\r\n        const bounds = this.rootEl.getBoundingClientRect();\r\n        BB.css(this.largeCanvasWrapper, {\r\n            top: Math.max(10, (bounds.top + this.height / 2 - this.largeCanvas.height / 2)) + 'px',\r\n        });\r\n\r\n    }\r\n\r\n    private draw (isInstant: boolean): void {\r\n        if (!this.isVisible) {\r\n            return;\r\n        }\r\n\r\n        this.nameLabelEl.textContent = this.layerObj.name;\r\n        this.opacityEl.innerHTML = LANG('opacity') + '<br>' + Math.round(this.layerObj.opacity * 100) + '%';\r\n\r\n        const layerCanvas = this.layerObj.context.canvas;\r\n\r\n        if (layerCanvas.width !== this.lastDrawnSize.width || layerCanvas.height !== this.lastDrawnSize.height) {\r\n            const canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, this.canvasSize, this.canvasSize, 1);\r\n            this.canvas.width = Math.round(canvasDimensions.width);\r\n            this.canvas.height = Math.round(canvasDimensions.height);\r\n\r\n            isInstant = true;\r\n        }\r\n\r\n        this.animationCanvas.width = this.canvas.width;\r\n        this.animationCanvas.height = this.canvas.height;\r\n\r\n        this.animationCanvasCtx.save();\r\n        this.animationCanvasCtx.imageSmoothingEnabled = false;\r\n        this.animationCanvasCtx.fillStyle = this.animationCanvasCheckerPattern;\r\n        this.animationCanvasCtx.fillRect(0, 0, this.animationCanvas.width, this.animationCanvas.height);\r\n        this.animationCanvasCtx.drawImage(layerCanvas, 0, 0, this.animationCanvas.width, this.animationCanvas.height);\r\n        this.animationCanvasCtx.restore();\r\n\r\n        if (isInstant) {\r\n            this.animationCount = 0;\r\n            this.canvasCtx.save();\r\n            this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\r\n            this.canvasCtx.restore();\r\n\r\n        } else {\r\n            this.animationCount = this.animationLength;\r\n            this.animate();\r\n\r\n        }\r\n\r\n        this.drawLargeCanvas();\r\n\r\n        this.lastDrawnState = klHistory.getState();\r\n        this.lastDrawnSize.width = layerCanvas.width;\r\n        this.lastDrawnSize.height = layerCanvas.height;\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onClick: () => void; // when clicking on layer name\r\n            klRootEl: HTMLElement;\r\n            uiState: TUiLayout;\r\n        }\r\n    ) {\r\n        // internally redraws with in an interval. checks history is something changed\r\n        // this update will be animated\r\n        // it will not be animated if the resolution changed\r\n        // also redraws when you call updateLayer - not animated\r\n\r\n        // syncs via updateLayer, and internally updates layer opacity via a hack\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-layer-preview',\r\n        });\r\n        this.isVisible = true;\r\n        this.height = 40;\r\n        this.canvasSize = this.height - 10;\r\n        this.largeCanvasSize = 300;\r\n        this.lastDrawnState = -2;\r\n        this.lastDrawnSize = {\r\n            width: 0,\r\n            height: 0,\r\n        };\r\n        this.animationCanvas = BB.canvas(); // to help animate the transition\r\n        this.animationCanvasCtx = BB.ctx(this.animationCanvas);\r\n        this.animationLength = 30;\r\n        this.animationCount = 0;\r\n        this.largeCanvasIsVisible = false;\r\n        let largeCanvasAnimationTimeout: ReturnType<typeof setTimeout>;\r\n        const largeCanvasAnimationDurationMs = 300;\r\n        this.uiState = p.uiState;\r\n\r\n\r\n        // --- setup dom ---\r\n        this.contentWrapperEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                height: this.height + 'px',\r\n            },\r\n        });\r\n        const canvasWrapperEl = BB.el({\r\n            css: {\r\n                //background: '#f00',\r\n                minWidth: this.height + 'px',\r\n                height: this.height + 'px',\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        this.canvas = BB.canvas(this.canvasSize, this.canvasSize);\r\n        this.canvasCtx = BB.ctx(this.canvas);\r\n        this.canvas.title = LANG('layers-active-layer');\r\n        const nameWrapper = BB.el({\r\n            css: {\r\n                //background: '#ff0',\r\n                flexGrow: '1',\r\n                paddingLeft: '10px',\r\n                fontSize: '13px',\r\n                overflow: 'hidden',\r\n                position: 'relative',\r\n            },\r\n        });\r\n        this.nameLabelEl = BB.el({\r\n            content: '',\r\n            css: {\r\n                cssFloat: 'left',\r\n                whiteSpace: 'nowrap',\r\n            },\r\n        });\r\n        const clickableEl = BB.el({\r\n            css: {\r\n                //background: 'rgba(0,255,0,0.6)',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '0',\r\n                width: '90px',\r\n                height: '100%',\r\n            },\r\n        });\r\n        if (p.onClick) {\r\n            clickableEl.addEventListener('click', () => {\r\n                p.onClick();\r\n            });\r\n            this.canvas.addEventListener('click', () => {\r\n                p.onClick();\r\n            });\r\n        }\r\n        this.opacityEl = BB.el({\r\n            content: LANG('opacity') + '<br>100%',\r\n            css: {\r\n                minWidth: '60px',\r\n                fontSize: '12px',\r\n                textAlign: 'center',\r\n            },\r\n        });\r\n\r\n        this.largeCanvasWrapper = BB.el({\r\n            onClick: BB.handleClick,\r\n            css: {\r\n                pointerEvents: 'none',\r\n                background: '#fff',\r\n                position: 'absolute',\r\n                right: '280px',\r\n                top: '10px',\r\n                border: '1px solid #aaa',\r\n                boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\r\n                transition: 'opacity '+largeCanvasAnimationDurationMs+'ms ease-in-out',\r\n                userSelect: 'none',\r\n                display: 'block',\r\n                webkitTouchCallout: 'none',\r\n            },\r\n        });\r\n        this.largeCanvas = BB.canvas(this.largeCanvasSize, this.largeCanvasSize);\r\n        this.largeCanvasWrapper.append(this.largeCanvas);\r\n        this.largeCanvasCtx = BB.ctx(this.largeCanvas);\r\n        BB.css(this.largeCanvas, {\r\n            display: 'block',\r\n        });\r\n\r\n\r\n        canvasWrapperEl.append(this.canvas);\r\n        nameWrapper.append(this.nameLabelEl, clickableEl);\r\n        this.contentWrapperEl.append(canvasWrapperEl, nameWrapper, this.opacityEl);\r\n        this.rootEl.append(this.contentWrapperEl);\r\n\r\n\r\n        this.updateCheckerPatterns();\r\n        theme.addIsDarkListener(() => {\r\n            this.updateCheckerPatterns();\r\n            this.draw(true);\r\n        });\r\n\r\n\r\n\r\n        // --- update logic ---\r\n\r\n        // cross-fade done via 2 canvases (old and new state)\r\n        // both have checkerboard background drawn on them, both fully opaque\r\n        // -> no \"lighter\" is needed for accurate cross-fading\r\n\r\n        setInterval(() => {\r\n\r\n            if (!this.layerObj) {\r\n                return;\r\n            }\r\n\r\n            const currentState = klHistory.getState();\r\n            if (currentState === this.lastDrawnState) {\r\n                return;\r\n            }\r\n\r\n            //update opacity w hack\r\n            this.layerObj.opacity = this.layerObj.context.canvas.opacity;\r\n\r\n            this.draw(false);\r\n\r\n        }, 2000);\r\n        \r\n\r\n        const removeLargeCanvas = () => {\r\n            try {\r\n                p.klRootEl.removeChild(this.largeCanvasWrapper);\r\n            } catch(e) {\r\n\r\n            }\r\n        };\r\n\r\n        const showLargeCanvas = (b) => {\r\n            if (this.largeCanvasIsVisible === b) {\r\n                return;\r\n            }\r\n\r\n            clearTimeout(largeCanvasAnimationTimeout);\r\n            this.largeCanvasIsVisible = b;\r\n\r\n            if (b) {\r\n                largeCanvasAnimationTimeout = setTimeout(() => {\r\n                    this.drawLargeCanvas();\r\n                    this.largeCanvasWrapper.style.opacity = '0';\r\n                    p.klRootEl.append(this.largeCanvasWrapper);\r\n                    setTimeout(() => {\r\n                        this.largeCanvasWrapper.style.opacity = '1';\r\n                    }, 20);\r\n                }, 250);\r\n\r\n            } else {\r\n                this.largeCanvasWrapper.style.opacity = '0';\r\n                largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\r\n            }\r\n\r\n        };\r\n\r\n        const pointerListener = new BB.PointerListener({\r\n            target: this.canvas,\r\n            onEnterLeave: (b) => {\r\n                showLargeCanvas(b);\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (b: boolean): void {\r\n        if (this.isVisible === b) {\r\n            return;\r\n        }\r\n        this.isVisible = b;\r\n        this.contentWrapperEl.style.display = this.isVisible ? 'flex' : 'none';\r\n        this.rootEl.style.marginBottom = this.isVisible ? '' : '10px';\r\n\r\n        const currentState = klHistory.getState();\r\n        if (b && this.lastDrawnState !== currentState) {\r\n            this.draw(true);\r\n        }\r\n    }\r\n\r\n    //when the layer might have changed\r\n         setLayer (klCanvasLayerObj: TKlCanvasLayer): void {\r\n        this.layerObj = klCanvasLayerObj;\r\n        this.draw(true);\r\n    }\r\n\r\n    setUiState (stateStr: TUiLayout): void {\r\n        this.uiState = stateStr;\r\n\r\n        if (this.uiState === 'left') {\r\n            BB.css(this.largeCanvasWrapper, {\r\n                left: '280px',\r\n                right: '',\r\n            });\r\n        } else {\r\n            BB.css(this.largeCanvasWrapper, {\r\n                left: '',\r\n                right: '280px',\r\n            });\r\n        }\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {FreeTransformCanvas} from '../components/free-transform-canvas';\r\nimport {showModal} from './base/showModal';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {IKlBasicLayer} from '../../kl-types';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showImportAsLayerDialog (\r\n    params: {\r\n        target: HTMLElement;\r\n        klCanvas: KlCanvas;\r\n        importImage: HTMLImageElement | HTMLCanvasElement;\r\n        callback: (\r\n            p?: {x: number; y: number; width:number; height: number; angleDeg: number},\r\n            isPixelated?: boolean\r\n        ) => void;\r\n    }\r\n): void {\r\n\r\n    const div = document.createElement('div');\r\n    BB.appendTextDiv(div, LANG('import-as-layer-description'));\r\n    if (params.klCanvas.isLayerLimitReached()) {\r\n        const noteEl = BB.el({\r\n            content: LANG('import-as-layer-limit-reached'),\r\n            css: {\r\n                background: '#ff0',\r\n                padding: '10px',\r\n                marginTop: '5px',\r\n                marginBottom: '5px',\r\n                border: '1px solid #e7d321',\r\n                borderRadius: '5px',\r\n            },\r\n        });\r\n        div.append(noteEl);\r\n    }\r\n    const isSmall = window.innerWidth < 550;\r\n\r\n    const buttonRowEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n        },\r\n    });\r\n    const originalSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: '1:1',\r\n        css: {\r\n            marginRight: '10px',\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.reset();\r\n        },\r\n    });\r\n    const fitSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('import-as-layer-fit'),\r\n        css: {\r\n            marginRight: '10px',\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.setTransformFit();\r\n        },\r\n    });\r\n    const centerBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('center'),\r\n        css: {\r\n            marginRight: '10px',\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.setTransformCenter();\r\n        },\r\n    });\r\n    buttonRowEl.append(originalSizeBtn, fitSizeBtn, centerBtn);\r\n    div.append(buttonRowEl);\r\n\r\n\r\n\r\n    const layers: IKlBasicLayer[] = [];\r\n    {\r\n        const klCanvasLayerArr = params.klCanvas.getLayers();\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            layers.push({\r\n                image: klCanvasLayerArr[i].context.canvas,\r\n                opacity: klCanvasLayerArr[i].opacity,\r\n                mixModeStr: klCanvasLayerArr[i].mixModeStr,\r\n            });\r\n        }\r\n    }\r\n    layers.push({\r\n        image: params.importImage,\r\n        opacity: 1,\r\n        mixModeStr: 'source-over',\r\n    });\r\n\r\n\r\n    const freeTransformCanvas = new FreeTransformCanvas({\r\n        elementWidth: isSmall ? 340 : 540,\r\n        elementHeight: isSmall ? 280 : 350,\r\n        imageWidth: params.klCanvas.getLayerContext(0).canvas.width,\r\n        imageHeight: params.klCanvas.getLayerContext(0).canvas.height,\r\n        layers: layers,\r\n        transformIndex: layers.length - 1,\r\n    });\r\n    BB.css(freeTransformCanvas.getElement(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n    });\r\n    div.append(freeTransformCanvas.getElement());\r\n\r\n    function move (x: number, y: number): void {\r\n        freeTransformCanvas.move(x, y);\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr) {\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        },\r\n    });\r\n\r\n    showModal({\r\n        target: params.target,\r\n        message: `<b>${LANG('import-as-layer-title')}</b>`,\r\n        div: div,\r\n        style: isSmall ? undefined : {\r\n            width: '500px',\r\n        },\r\n        buttons: ['Ok', 'Cancel'],\r\n        clickOnEnter: 'Ok',\r\n        callback: function (buttonStr) {\r\n            keyListener.destroy();\r\n            freeTransformCanvas.destroy();\r\n            BB.destroyEl(originalSizeBtn);\r\n            BB.destroyEl(fitSizeBtn);\r\n            BB.destroyEl(centerBtn);\r\n            if (buttonStr === 'Ok') {\r\n                params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\r\n            } else {\r\n                params.callback();\r\n            }\r\n        },\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\ntype TDropOption = 'default' | 'layer' | 'image';\r\n\r\n/**\r\n * Not really generalized. UI when you drag/drop an image into window.\r\n * The moment you create it, it will listen.\r\n * */\r\nexport class KlImageDropper {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onDrop: (files: FileList, optionStr: TDropOption) => void;\r\n            target: HTMLElement;\r\n            enabledTest: () => boolean;\r\n        }\r\n    ) {\r\n        //set up DOM\r\n        this.rootEl = BB.el({\r\n            content: 'Drop to import',\r\n            css: {\r\n                paddingTop: '100px',\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                width: '100%',\r\n                height: '100%',\r\n                background: 'rgba(50, 50, 50, 0.7)',\r\n                color: '#fff',\r\n                textShadow: '2px 2px #000',\r\n                textAlign: 'center',\r\n                fontSize: '25px',\r\n            },\r\n        });\r\n        const wrapperEl = BB.el({\r\n            css: {\r\n                'marginTop': '50px',\r\n                'display': 'flex',\r\n                'justifyContent': 'center',\r\n            },\r\n        });\r\n        const optionStyle = {\r\n            width: '200px',\r\n            padding: '50px',\r\n            margin: '10px',\r\n            //opacity: 0.5,\r\n            borderRadius: '20px',\r\n            border: '1px dashed #fff',\r\n            background: '#00aefe',\r\n            fontWeight: 'bold',\r\n        };\r\n        const optionLayerEl = BB.el({\r\n            content: 'As Layer',\r\n            css: optionStyle,\r\n        });\r\n        const optionImageEl = BB.el({\r\n            content: 'As New Image',\r\n            css: optionStyle,\r\n        });\r\n\r\n        this.rootEl.append(wrapperEl);\r\n        wrapperEl.append(optionLayerEl, optionImageEl);\r\n\r\n\r\n        let rootCounter = 0;\r\n        let optionLayerCounter = 0;\r\n        let optionImageCounter = 0;\r\n\r\n        const destroy = () => {\r\n            rootCounter = 0;\r\n            optionLayerCounter = 0;\r\n            optionImageCounter = 0;\r\n            try {\r\n                p.target.removeChild(this.rootEl);\r\n            } catch (e) { }\r\n        };\r\n\r\n        /**\r\n         * check, can drop content be imported\r\n         */\r\n        const testAcceptType = (event: DragEvent): boolean => {\r\n            return !!event.dataTransfer && !event.dataTransfer.types.includes('text/plain');\r\n        };\r\n\r\n        const updateOptions = () => {\r\n            const boxShadow = '0 0 20px 4px #fff';\r\n            if (optionLayerCounter > 0) {\r\n                optionLayerEl.style.boxShadow = boxShadow;\r\n                optionImageEl.style.boxShadow = '';\r\n            } else if (optionImageCounter > 0) {\r\n                optionLayerEl.style.boxShadow = '';\r\n                optionImageEl.style.boxShadow = boxShadow;\r\n            } else {\r\n                optionLayerEl.style.boxShadow = '';\r\n                optionImageEl.style.boxShadow = '';\r\n            }\r\n        };\r\n\r\n        optionLayerEl.addEventListener('dragenter', () => {\r\n            optionLayerCounter++;\r\n            updateOptions();\r\n        });\r\n        optionLayerEl.addEventListener('dragleave', () => {\r\n            optionLayerCounter--;\r\n            updateOptions();\r\n        });\r\n        optionImageEl.addEventListener('dragenter', () => {\r\n            optionImageCounter++;\r\n            updateOptions();\r\n        });\r\n        optionImageEl.addEventListener('dragleave', () => {\r\n            optionImageCounter--;\r\n            updateOptions();\r\n        });\r\n\r\n\r\n        const rootDragOver = (event: DragEvent): void => {\r\n            if (!testAcceptType(event)) {\r\n                return;\r\n            }\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n        };\r\n\r\n        const rootDragEnter = (event: DragEvent): void => {\r\n            if (!p.enabledTest() || !testAcceptType(event)) {\r\n                return;\r\n            }\r\n            if (rootCounter === 0) {\r\n                p.target.append(this.rootEl);\r\n            }\r\n            rootCounter++;\r\n        };\r\n\r\n        const rootDragLeave = (event: DragEvent): void => {\r\n            if (!testAcceptType(event) || rootCounter === 0) {\r\n                return;\r\n            }\r\n            rootCounter = Math.max(0, rootCounter - 1);\r\n            if (rootCounter === 0) {\r\n                p.target.removeChild(this.rootEl);\r\n            }\r\n        };\r\n\r\n        const rootDrop = (event: DragEvent): void => {\r\n            if (!testAcceptType(event) || !event.dataTransfer || event.dataTransfer.files.length === 0) {\r\n                destroy();\r\n                return;\r\n            }\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n\r\n            let optionStr: TDropOption = 'default';\r\n            if (optionLayerCounter > 0) {\r\n                optionStr = 'layer';\r\n            } else if (optionImageCounter > 0) {\r\n                optionStr = 'image';\r\n            }\r\n\r\n            p.onDrop(event.dataTransfer.files, optionStr);\r\n\r\n\r\n            if (rootCounter > 0) {\r\n                p.target.removeChild(this.rootEl);\r\n            }\r\n            rootCounter = 0;\r\n            optionLayerCounter = 0;\r\n            optionImageCounter = 0;\r\n            updateOptions();\r\n        };\r\n\r\n        window.addEventListener('dragover', rootDragOver, false);\r\n        window.addEventListener('dragenter', rootDragEnter, false);\r\n        window.addEventListener('dragleave', rootDragLeave, false);\r\n        window.addEventListener('drop', rootDrop, false);\r\n\r\n        // if something goes wrong and you're stuck with overlay\r\n        this.rootEl.addEventListener('pointerdown', () => {\r\n            destroy();\r\n        });\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: (keyStr) => {\r\n                if (rootCounter > 0 && keyStr === 'esc') {\r\n                    destroy();\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {KlColorSliderSmall} from './kl-color-slider-small';\r\nimport {KlSlider} from './kl-slider';\r\nimport {BrushSettingService, TBrushSettingEmit} from '../../brushes-ui/brush-setting-service';\r\nimport {LANG} from '../../../language/language';\r\nimport {IRGB} from '../../kl-types';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\n\r\n/**\r\n * Compressed HUD toolspace. When you hold ctrl+alt.\r\n * small color picker, brush settings\r\n */\r\nexport class OverlayToolspace {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            brushSettingService: BrushSettingService; // to sync with outside\r\n            enabledTest: () => boolean; // calls to see if it's allowed to show\r\n        }\r\n    ) {\r\n        const sizeObj = {\r\n            width: 150,\r\n            svHeight: 90,\r\n            hHeight: 20,\r\n            sliderHeight: 25,\r\n        };\r\n\r\n        let isVisible = false;\r\n        this.rootEl = BB.el({\r\n            className: 'kl-overlay-toolspace',\r\n        });\r\n        const queuedObj: {\r\n            color: IRGB | null;\r\n            size: number | null;\r\n            opacity: number | null;\r\n        } = {\r\n            color: null,\r\n            size: null,\r\n            opacity: null,\r\n        };\r\n\r\n\r\n        // --- inputs ---\r\n\r\n        //color selection\r\n        const colorEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-overlay-toolspace__color',\r\n        });\r\n        const colorSlider = new KlColorSliderSmall({\r\n            width: sizeObj.width,\r\n            heightSV: sizeObj.svHeight,\r\n            heightH: sizeObj.hHeight,\r\n            color: p.brushSettingService.getColor(),\r\n            callback: (rgbObj: IRGB) => {\r\n                selectedColorEl.style.backgroundColor = 'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')';\r\n                p.brushSettingService.setColor(rgbObj, subscriptionFunc);\r\n            },\r\n        });\r\n        const selectedColorEl = BB.el({\r\n            css: {\r\n                width: sizeObj.width + 'px',\r\n                height: sizeObj.hHeight + 'px',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        {\r\n            const initialColor = p.brushSettingService.getColor();\r\n            selectedColorEl.style.backgroundColor = 'rgb(' + initialColor.r + ',' + initialColor.g + ',' + initialColor.b + ')';\r\n        }\r\n\r\n        colorEl.append(selectedColorEl, colorSlider.getElement());\r\n\r\n\r\n        const updateColor = (rgbObj: IRGB) => {\r\n            colorSlider.setColor(rgbObj);\r\n            selectedColorEl.style.backgroundColor = 'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')';\r\n        };\r\n\r\n\r\n\r\n        //brushsize slider\r\n\r\n        const sizeSlider = new KlSlider({\r\n            label: LANG('brush-size'),\r\n            width: sizeObj.width,\r\n            height: sizeObj.sliderHeight,\r\n            min: 0,\r\n            max: 500,\r\n            value: 50,\r\n            resolution: 225,\r\n            eventResMs: 1000 / 30,\r\n            toDisplayValue: (val) => val * 2,\r\n            toValue: (displayValue) => displayValue / 2,\r\n            onChange: (v) => {\r\n                p.brushSettingService.setSize(v);\r\n            },\r\n            formatFunc: (displayValue) => {\r\n                if (displayValue < 10) {\r\n                    return BB.round(displayValue, 1);\r\n                } else {\r\n                    return Math.round(displayValue);\r\n                }\r\n            },\r\n        });\r\n        BB.css(sizeSlider.getElement(), {\r\n            marginTop: '2px',\r\n        });\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: sizeObj.width,\r\n            height: sizeObj.sliderHeight,\r\n            min: 0,\r\n            max: 1,\r\n            value: 1,\r\n            resolution: 225,\r\n            eventResMs: 1000 / 30,\r\n            toDisplayValue: (val) => val * 100,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            onChange: (v) => {\r\n                p.brushSettingService.setOpacity(v);\r\n            },\r\n        });\r\n        BB.css(opacitySlider.getElement(), {\r\n            margin: '2px 0',\r\n        });\r\n        this.rootEl.append(sizeSlider.getElement(), opacitySlider.getElement());\r\n\r\n\r\n\r\n        // --- general setup ---\r\n\r\n        const subscriptionFunc = (event: TBrushSettingEmit) => {\r\n            if (event.type === 'color') {\r\n                if (!isVisible) {\r\n                    queuedObj.color = event.value;\r\n                } else {\r\n                    updateColor(event.value);\r\n                }\r\n            }\r\n            if (event.type === 'size') {\r\n                if (!isVisible) {\r\n                    queuedObj.size = event.value;\r\n                } else {\r\n                    sizeSlider.setValue(event.value);\r\n                }\r\n            }\r\n            if (event.type === 'opacity') {\r\n                if (!isVisible) {\r\n                    queuedObj.opacity = event.value;\r\n                } else {\r\n                    opacitySlider.setValue(event.value);\r\n                }\r\n            }\r\n            if (event.type === 'sliderConfig') {\r\n                sizeSlider.update(event.value.sizeSlider);\r\n                opacitySlider.update(event.value.opacitySlider);\r\n            }\r\n        };\r\n        p.brushSettingService.subscribe(subscriptionFunc);\r\n        {\r\n            const sliderConfig = p.brushSettingService.getSliderConfig();\r\n            sizeSlider.update(sliderConfig.sizeSlider);\r\n            opacitySlider.update(sliderConfig.opacitySlider);\r\n            sizeSlider.setValue(p.brushSettingService.getSize());\r\n            opacitySlider.setValue(p.brushSettingService.getOpacity());\r\n        }\r\n\r\n        const updateUI = () => {\r\n\r\n            // unfocus manual slider input\r\n            BB.unfocusAnyInput();\r\n\r\n            this.rootEl.style.display = isVisible ? 'block' : 'none';\r\n            if (isVisible && mousePos) {\r\n                BB.css(this.rootEl, {\r\n                    left: (mousePos.x - Math.round(sizeObj.width / 2)) + 'px',\r\n                    top: (mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2)) + 'px',\r\n                });\r\n            }\r\n        };\r\n\r\n        let mousePos: IVector2D | null = null;\r\n        document.addEventListener('pointermove', (event) => {\r\n            mousePos = {\r\n                x: event.pageX,\r\n                y: event.pageY,\r\n            };\r\n        });\r\n\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr, isRepeat) => {\r\n                if (isRepeat) {\r\n                    return;\r\n                }\r\n                if (isVisible) {\r\n                    isVisible = false;\r\n                    updateUI();\r\n                    return;\r\n                }\r\n\r\n                if (!p.enabledTest() || !mousePos) {\r\n                    return;\r\n                }\r\n\r\n                if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    isVisible = true;\r\n\r\n                    if (queuedObj.color !== null) {\r\n                        updateColor(queuedObj.color);\r\n                        queuedObj.color = null;\r\n                    }\r\n                    if (queuedObj.size !== null) {\r\n                        sizeSlider.setValue(queuedObj.size);\r\n                        queuedObj.size = null;\r\n                    }\r\n                    if (queuedObj.opacity !== null) {\r\n                        opacitySlider.setValue(queuedObj.opacity);\r\n                        queuedObj.opacity = null;\r\n                    }\r\n\r\n                    updateUI();\r\n                }\r\n\r\n            },\r\n            onUp: (keyStr, event, oldComboStr) => {\r\n                if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(oldComboStr) && isVisible) {\r\n                    isVisible = false;\r\n                    colorSlider.end();\r\n                    updateUI();\r\n                }\r\n            },\r\n            onBlur: () => {\r\n                if (isVisible) {\r\n                    isVisible = false;\r\n                    colorSlider.end();\r\n                    updateUI();\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport klecksLogoImg from '/src/app/img/klecks-logo.png';\r\nimport newImageImg from '/src/app/img/ui/new-image.svg';\r\nimport importImg from '/src/app/img/ui/import.svg';\r\nimport exportImg from '/src/app/img/ui/export.svg';\r\nimport shareImg from '/src/app/img/ui/share.svg';\r\nimport helpImg from '/src/app/img/ui/help.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n\r\n/**\r\n * Topmost row of buttons in toolspace (with the app logo)\r\n */\r\nexport class ToolspaceTopRow {\r\n    \r\n    private readonly rootEl: HTMLElement;\r\n    \r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            logoImg: string;\r\n            onLogo: () => void;\r\n            onNew: () => void;\r\n            onImport: () => void;\r\n            onSave: () => void;\r\n            onShare: () => void;\r\n            onHelp: () => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-toolspace-row',\r\n            css: {\r\n                height: '36px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        function createButton (\r\n            p: {\r\n                onClick: () => void;\r\n                title: string;\r\n                image: string;\r\n                contain: boolean;\r\n                extraPadding?: number;\r\n                darkInvert?: boolean;\r\n            }\r\n        ): {\r\n            el: HTMLElement;\r\n            pointerListener: PointerListener;\r\n        } {\r\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n            const el = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.contain ? padding + 'px 0' : '',\r\n                },\r\n            });\r\n            const im = BB.el({\r\n                className: p.darkInvert ? 'dark-invert' : undefined,\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundPosition: 'center',\r\n                    backgroundSize: p.contain ? 'contain' : '',\r\n                    //filter: 'grayscale(1)',\r\n                    height: '100%',\r\n                },\r\n            });\r\n            im.style.pointerEvents = 'none';\r\n            el.append(im);\r\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: el,\r\n                onEnterLeave: function (isOver) {\r\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\r\n                },\r\n            });\r\n            return {\r\n                el,\r\n                pointerListener,\r\n            };\r\n        }\r\n\r\n        const logoButton = createButton({\r\n            onClick: p.onLogo,\r\n            title: LANG('home'),\r\n            image: p.logoImg ? p.logoImg : klecksLogoImg,\r\n            contain: true,\r\n            darkInvert: true,\r\n        });\r\n        logoButton.el.classList.add('kl-tool-row-border-right');\r\n        BB.css(logoButton.el, {\r\n            width: '45px',\r\n        });\r\n        const newButton = createButton({\r\n            onClick: p.onNew,\r\n            title: LANG('file-new'),\r\n            image: newImageImg,\r\n            extraPadding: 1,\r\n            contain: true,\r\n        });\r\n        const importButton = createButton({\r\n            onClick: p.onImport,\r\n            title: LANG('file-import'),\r\n            image: importImg,\r\n            extraPadding: 1,\r\n            contain: true,\r\n        });\r\n        const saveButton = createButton({\r\n            onClick: p.onSave,\r\n            title: LANG('file-save'),\r\n            image: exportImg,\r\n            extraPadding: 1,\r\n            contain: true,\r\n        });\r\n\r\n        let shareButton = null;\r\n        if (BB.canShareFiles()) {\r\n            shareButton = createButton({\r\n                onClick: p.onShare,\r\n                title: LANG('file-share'),\r\n                image: shareImg,\r\n                contain: true,\r\n                darkInvert: true,\r\n            });\r\n        }\r\n        const helpButton = createButton({\r\n            onClick: p.onHelp,\r\n            title: LANG('help'),\r\n            image: helpImg,\r\n            contain: true,\r\n            darkInvert: true,\r\n        });\r\n\r\n        BB.append(this.rootEl, [\r\n            logoButton.el,\r\n            newButton.el,\r\n            importButton.el,\r\n            saveButton.el,\r\n            shareButton ? shareButton.el : undefined,\r\n            helpButton.el,\r\n        ]);\r\n    }\r\n    \r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6Sfz2\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eaJmh\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kV8IH\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"SROeX\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"lFrok\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cvYlU\");","import {BB} from '../../../bb/bb';\r\nimport {dialogCounter} from '../modals/modal-count';\r\nimport toolPaintImg from '/src/app/img/ui/tool-paint.svg';\r\nimport toolFillImg from '/src/app/img/ui/tool-fill.svg';\r\nimport toolGradientImg from '/src/app/img/ui/tool-gradient.svg';\r\nimport toolTextImg from '/src/app/img/ui/tool-text.svg';\r\nimport toolShapeImg from '/src/app/img/ui/tool-shape.svg';\r\nimport caretDownImg from '/src/app/img/ui/caret-down.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {TToolType} from '../../kl-types';\r\n\r\n\r\ntype TDropdownButton = {\r\n    wrapper: HTMLElement;\r\n    show: (b: boolean) => void;\r\n    setIsSmall: (b: boolean) => void;\r\n};\r\n\r\n/**\r\n * Toolrow Dropdown. The button where you select: brush, fill, select, transform, etc.\r\n */\r\nexport class ToolDropdown {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly activeButton: HTMLElement;\r\n    private readonly smallMargin: string = '6px 0';\r\n    private readonly optionArr: TToolType[] = ['draw', 'fill', 'gradient', 'text', 'shape'];\r\n    private readonly dropdownBtnArr: TDropdownButton[];\r\n    private readonly arrowButton: HTMLElement;\r\n    private isActive: boolean;\r\n    private currentActiveIndex: number;\r\n    private readonly titleArr: string[];\r\n    private activeButtonIm: HTMLElement;\r\n    private readonly imArr;\r\n\r\n    private updateButton () {\r\n        this.activeButton.title = this.titleArr[this.currentActiveIndex];\r\n        this.activeButtonIm.style.backgroundImage = 'url(\\'' + this.imArr[this.currentActiveIndex] + '\\')';\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onChange: (activeStr: TToolType) => void;\r\n        }\r\n    ) {\r\n        this.imArr = [\r\n            toolPaintImg,\r\n            toolFillImg,\r\n            toolGradientImg,\r\n            toolTextImg,\r\n            toolShapeImg,\r\n        ];\r\n        this.titleArr = [\r\n            `${LANG('tool-brush')} [B]`,\r\n            `${LANG('tool-paint-bucket')} [G]`,\r\n            `${LANG('tool-gradient')} [G]`,\r\n            `${LANG('tool-text')} [T]`,\r\n            `${LANG('tool-shape')} [U]`,\r\n        ];\r\n        this.currentActiveIndex = 0;\r\n        this.isActive = true;\r\n        let isOpen = false;\r\n\r\n        //preload images\r\n        setTimeout(() => {\r\n            for (let i = 1; i < this.imArr.length; i++) {\r\n                const im = new Image();\r\n                im.src = this.imArr[i];\r\n            }\r\n        }, 100);\r\n\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n\r\n        let openTimeout: ReturnType<typeof setTimeout>;\r\n        let isDragging = false;\r\n        let startX: number;\r\n        let startY: number;\r\n        let pointerListener;\r\n        if (BB.hasPointerEvents) {\r\n            pointerListener = new BB.PointerListener({\r\n                target: this.rootEl,\r\n                onPointer: (event) => {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (isOpen) {\r\n                            return;\r\n                        }\r\n\r\n                        openTimeout = setTimeout(() => {\r\n                            showDropdown();\r\n                        }, 400);\r\n                        isDragging = true;\r\n                        startX = event.pageX;\r\n                        startY = event.pageY;\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        if (isDragging && !isOpen && BB.dist(startX, startY, event.pageX, event.pageY) > 5) {\r\n                            clearTimeout(openTimeout);\r\n                            showDropdown();\r\n                        }\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        clearTimeout(openTimeout);\r\n                        if (isOpen && isDragging) {\r\n                            const target = document.elementFromPoint(event.pageX, event.pageY);\r\n                            for (let i = 0; i < this.dropdownBtnArr.length; i++) {\r\n                                if (target === this.dropdownBtnArr[i].wrapper) {\r\n                                    closeDropdown();\r\n                                    this.isActive = true;\r\n                                    this.currentActiveIndex = i;\r\n                                    this.updateButton();\r\n                                    p.onChange(this.optionArr[this.currentActiveIndex]);\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                        isDragging = false;\r\n                    }\r\n                },\r\n            });\r\n        }\r\n\r\n        this.activeButton = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'toolspace-row-button nohighlight toolspace-row-button-activated',\r\n            title: this.titleArr[this.currentActiveIndex],\r\n            onClick: (e) => {\r\n                if (this.isActive && !isOpen) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    showDropdown();\r\n                    return;\r\n                }\r\n\r\n                this.isActive = true;\r\n                p.onChange(this.optionArr[this.currentActiveIndex]);\r\n                if (isOpen) {\r\n                    closeDropdown();\r\n                }\r\n            },\r\n            css: {\r\n                padding: '10px 0',\r\n                pointerEvents: 'auto',\r\n                height: '100%',\r\n                boxSizing: 'border-box',\r\n            },\r\n        });\r\n\r\n        this.activeButtonIm = BB.el({\r\n            parent: this.activeButton,\r\n            className: 'dark-invert',\r\n            css: {\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: 'contain',\r\n                width: 'calc(100% - 7px)',\r\n                height: '100%',\r\n                pointerEvents: 'none',\r\n                opacity: '0.75',\r\n            },\r\n        });\r\n\r\n        this.arrowButton = BB.el({\r\n            parent: this.activeButton,\r\n            className: 'dark-invert',\r\n            css: {\r\n                position: 'absolute',\r\n                right: '1px',\r\n                bottom: '1px',\r\n                width: '18px',\r\n                height: '18px',\r\n                //background: '#aaa',\r\n                //borderRadius: '2px',\r\n                cursor: 'pointer',\r\n\r\n                backgroundImage: 'url(\\'' + caretDownImg + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: '60%',\r\n            },\r\n            title: 'More Tools',\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                showDropdown();\r\n            },\r\n        });\r\n\r\n\r\n        const overlay = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                //background: 'rgba(255,0,0,0.5)',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n            },\r\n        });\r\n        const overlayPointerListener = new BB.PointerListener({\r\n            target: overlay,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    e.eventPreventDefault();\r\n                    closeDropdown();\r\n                }\r\n            },\r\n        });\r\n\r\n        const dropdownWrapper = BB.el({\r\n            className: 'tool-dropdown-wrapper',\r\n            css: {\r\n                position: 'absolute',\r\n                width: '100%',\r\n                height: (100 * (this.optionArr.length - 1)) + '%',\r\n                top: '100%',\r\n                left: '0',\r\n                zIndex: '1',\r\n                boxSizing: 'border-box',\r\n                cursor: 'pointer',\r\n                transition: 'height 0.1s ease-in-out, opacity 0.1s ease-in-out',\r\n                borderBottomLeftRadius: '5px',\r\n                borderBottomRightRadius: '5px',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n        this.dropdownBtnArr = [];\r\n\r\n        const createDropdownButton = (\r\n            p: {\r\n                index: number;\r\n                id: TToolType;\r\n                image: string;\r\n                title: string;\r\n                onClick: (index: number) => void;\r\n            }\r\n        ): TDropdownButton => {\r\n            const wrapper = BB.el({\r\n                parent: dropdownWrapper,\r\n                className: 'tool-dropdown-button',\r\n                title: p.title,\r\n                css: {\r\n                    padding: '10px 0',\r\n                    height: (100 / (this.optionArr.length - 1)) + '%',\r\n                    boxSizing: 'border-box',\r\n                },\r\n                onClick: (e) => {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    p.onClick(p.index);\r\n                },\r\n            });\r\n\r\n            BB.el({\r\n                parent: wrapper,\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundPosition: 'center',\r\n                    backgroundSize: 'contain',\r\n                    height: '100%',\r\n                    pointerEvents: 'none',\r\n                    opacity: '0.75',\r\n                },\r\n            });\r\n\r\n            // --- interface ---\r\n            const show = (b: boolean) => {\r\n                wrapper.style.display = b ? 'block' : 'none';\r\n            };\r\n\r\n            const setIsSmall = (b: boolean) => {\r\n                wrapper.style.padding = b ? this.smallMargin : '10px 0';\r\n            };\r\n\r\n            return {\r\n                wrapper,\r\n                show,\r\n                setIsSmall,\r\n            };\r\n        };\r\n\r\n        const onClickDropdownBtn = (index: number) => {\r\n            closeDropdown();\r\n\r\n            this.isActive = true;\r\n            this.currentActiveIndex = index;\r\n\r\n            this.updateButton();\r\n\r\n            p.onChange(this.optionArr[this.currentActiveIndex]);\r\n        };\r\n\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            this.dropdownBtnArr.push(createDropdownButton({\r\n                index: i,\r\n                id: this.optionArr[i],\r\n                image: this.imArr[i],\r\n                title: this.titleArr[i],\r\n                onClick: onClickDropdownBtn,\r\n            }));\r\n        }\r\n\r\n        const showDropdown = () => {\r\n            dialogCounter.increase(0.5);\r\n            isOpen = true;\r\n\r\n            for (let i = 0; i < this.optionArr.length; i++) {\r\n                this.dropdownBtnArr[i].show(this.currentActiveIndex !== i);\r\n            }\r\n\r\n            this.arrowButton.style.display = 'none';\r\n            this.rootEl.style.zIndex = '1';\r\n            document.body.append(overlay);\r\n            this.rootEl.append(dropdownWrapper);\r\n        };\r\n\r\n        const closeDropdown = () => {\r\n            dialogCounter.decrease(0.5);\r\n            isOpen = false;\r\n            this.arrowButton.style.removeProperty('display');\r\n            this.rootEl.style.removeProperty('z-index');\r\n            document.body.removeChild(overlay);\r\n\r\n            this.rootEl.removeChild(dropdownWrapper);\r\n        };\r\n\r\n        this.updateButton();\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    setIsSmall (b: boolean): void {\r\n        this.activeButton.style.padding = b ? this.smallMargin : '10px 0';\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            this.dropdownBtnArr[i].setIsSmall(b);\r\n        }\r\n        if (b) {\r\n            this.arrowButton.style.width = '14px';\r\n            this.arrowButton.style.height = '14px';\r\n        } else {\r\n            this.arrowButton.style.width = '18px';\r\n            this.arrowButton.style.height = '18px';\r\n        }\r\n    }\r\n\r\n    setActive (activeStr: TToolType): void {\r\n        if (this.optionArr.includes(activeStr)) {\r\n            this.isActive = true;\r\n            for (let i = 0; i < this.optionArr.length; i++) {\r\n                if (this.optionArr[i] === activeStr) {\r\n                    this.currentActiveIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n            this.activeButton.classList.add('toolspace-row-button-activated');\r\n            this.updateButton();\r\n        } else {\r\n            this.isActive = false;\r\n            this.activeButton.classList.remove('toolspace-row-button-activated');\r\n        }\r\n    }\r\n\r\n    getActive (): TToolType {\r\n        return this.optionArr[this.currentActiveIndex];\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dW3eU\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fnumN\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6J8A8\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"da34V\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eStsa\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eW5wL\");","import {BB} from '../../../bb/bb';\r\nimport {ToolDropdown} from './tool-dropdown';\r\nimport toolHandImg from '/src/app/img/ui/tool-hand.svg';\r\nimport toolZoomInImg from '/src/app/img/ui/tool-zoom-in.svg';\r\nimport toolZoomOutImg from '/src/app/img/ui/tool-zoom-out.svg';\r\nimport toolUndoImg from '/src/app/img/ui/tool-undo.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {TToolType} from '../../kl-types';\r\n\r\n\r\ntype TBaseToolRowButton = {\r\n    el: HTMLElement;\r\n};\r\n\r\ntype TToolRowButton = TBaseToolRowButton & {\r\n    pointerListener: PointerListener;\r\n    setIsSmall: (b: boolean) => void;\r\n};\r\n\r\ntype TToolRowTriangleButton = TBaseToolRowButton & {\r\n    setIsEnabledLeft: (b: boolean) => void;\r\n    setIsEnabledRight: (b: boolean) => void;\r\n    leftPointerListener: PointerListener;\r\n    rightPointerListener: PointerListener;\r\n};\r\n\r\n/**\r\n * Row of buttons in toolspace. image-operations (draw, hand), zoom, undo/redo\r\n * Need to do syncing. So tool is correct, and zoom/undo/redo buttons are properly enabled/disabled\r\n * heights: 54px tall, 36px small -> via setIsSmall\r\n */\r\nexport class ToolspaceToolRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly toolDropdown: ToolDropdown;\r\n    private readonly handButton: TToolRowButton;\r\n    private readonly zoomInButton: TToolRowButton;\r\n    private readonly zoomOutButton: TToolRowButton;\r\n    private readonly undoButton: TToolRowButton;\r\n    private readonly redoButton: TToolRowButton;\r\n    private readonly zoomInNOutButton: TToolRowTriangleButton;\r\n    private readonly undoNRedoButton: TToolRowTriangleButton;\r\n    private currentActiveStr: TToolType;\r\n    private readonly onActivate: (activeStr: TToolType) => void;\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            onActivate: (activeStr: TToolType) => void; // clicking on tool button - activating it\r\n            onZoomIn: () => void;\r\n            onZoomOut: () => void;\r\n            onUndo: () => void;\r\n            onRedo: () => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el( {\r\n            className: 'kl-toolspace-row',\r\n            css: {\r\n                height: '54px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        this.onActivate = p.onActivate;\r\n        this.currentActiveStr = 'draw'; // 'draw' | 'hand' | 'fill'\r\n\r\n\r\n        const createButton = (p: {\r\n            onClick: () => void;\r\n            image: string;\r\n            contain: boolean;\r\n            doLighten?: boolean;\r\n            doMirror?: boolean;\r\n        }): TToolRowButton => {\r\n\r\n            const smallMargin = p.doLighten ? '6px 0' : '8px 0';\r\n\r\n            const el = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                //title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.contain ? '10px 0' : '',\r\n                },\r\n            });\r\n            const im = BB.el({\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundPosition: 'center',\r\n                    backgroundSize: p.contain ? 'contain' : '',\r\n                    //filter: 'grayscale(1)',\r\n                    height: '100%',\r\n                    transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                    pointerEvents: 'none',\r\n                    opacity: p.doLighten ? '0.75' : '1',\r\n                },\r\n            });\r\n            el.append(im);\r\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: el,\r\n                onEnterLeave: (isOver) => {\r\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\r\n                },\r\n            });\r\n            const setIsSmall = (b: boolean) => {\r\n                el.style.padding = p.contain ? (b ? smallMargin : '10px 0') : '';\r\n            };\r\n            return {\r\n                el,\r\n                pointerListener,\r\n                setIsSmall,\r\n            };\r\n        };\r\n\r\n\r\n        const createTriangleButton = (p: {\r\n            onLeft: () => void;\r\n            onRight: () => void;\r\n            leftImage: string;\r\n            rightImage: string | null;\r\n        }): TToolRowTriangleButton => { // because IE and Edge don't support clip path\r\n\r\n            const result = BB.el({\r\n                css: {\r\n                    flexGrow: '1',\r\n                    position: 'relative',\r\n                },\r\n            });\r\n\r\n            const svg = BB.createSvg({\r\n                elementType: 'svg',\r\n                width: '67px', // can't think of a way doing with percentage\r\n                height: '54px',\r\n                viewBox: '0 0 100 100',\r\n                preserveAspectRatio: 'none',\r\n            });\r\n            BB.css(svg, {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n            });\r\n\r\n            const blurRadius = 10;\r\n            const blurOffsetX = 2;\r\n            const blurOffsetY = 2;\r\n\r\n            const defs = BB.createSvg( { // inset shadow via svg\r\n                elementType: 'defs',\r\n                childrenArr: [\r\n                    {\r\n                        elementType: 'filter',\r\n                        id: 'innershadow',\r\n                        x0: '-50%',\r\n                        y0: '-50%',\r\n                        width: '200%',\r\n                        height: '200%',\r\n                        childrenArr: [\r\n                            {\r\n                                elementType: 'feGaussianBlur',\r\n                                in: 'SourceAlpha',\r\n                                stdDeviation: '' + blurRadius,\r\n                                result: 'blur',\r\n                            }, {\r\n                                elementType: 'feOffset',\r\n                                dx: '' + blurOffsetX,\r\n                                dy: '' + blurOffsetY,\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'SourceAlpha',\r\n                                operator: 'arithmetic',\r\n                                k2: '-1',\r\n                                k3: '1',\r\n                                result: 'shadowDiff',\r\n                            },\r\n\r\n                            {\r\n                                elementType: 'feFlood',\r\n                                'flood-color': '#000',\r\n                                'flood-opacity': '0.2',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'shadowDiff',\r\n                                operator: 'in',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'SourceGraphic',\r\n                                operator: 'over',\r\n                                result: 'firstfilter',\r\n                            },\r\n\r\n                            {\r\n                                elementType: 'feGaussianBlur',\r\n                                in: 'firstfilter',\r\n                                stdDeviation: '' + blurRadius,\r\n                                result: 'blur2',\r\n                            }, {\r\n                                elementType: 'feOffset',\r\n                                dx: '' + blurOffsetX,\r\n                                dy: '' + blurOffsetY,\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'firstfilter',\r\n                                operator: 'arithmetic',\r\n                                k2: '-1',\r\n                                k3: '1',\r\n                                result: 'shadowDiff',\r\n                            },\r\n\r\n                            {\r\n                                elementType: 'feFlood',\r\n                                'flood-color': '#000',\r\n                                'flood-opacity': '0.2',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'shadowDiff',\r\n                                operator: 'in',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'firstfilter',\r\n                                operator: 'over',\r\n                            },\r\n                        ],\r\n                    },\r\n                ],\r\n            });\r\n\r\n\r\n            const svgTriangleLeft = BB.createSvg({\r\n                elementType: 'path',\r\n                'vector-effect': 'non-scaling-stroke',\r\n                d: 'M0,0 L 100,0 0,100 z',\r\n                fill: 'rgba(0,0,0,0)',\r\n                class: 'toolspace-svg-triangle-button',\r\n            });\r\n            svgTriangleLeft.onclick = () => {\r\n                p.onLeft();\r\n                svgTriangleLeft.classList.remove('toolspace-svg-triangle-button-hover');\r\n            };\r\n\r\n            const svgTriangleRight = BB.createSvg({\r\n                elementType: 'path',\r\n                'vector-effect': 'non-scaling-stroke',\r\n                d: 'M100,100 L 100,0 0,100 z',\r\n                fill: 'rgba(0,0,0,0)',\r\n                class: 'toolspace-svg-triangle-button',\r\n            });\r\n            svgTriangleRight.onclick = () => {\r\n                p.onRight();\r\n                svgTriangleRight.classList.remove('toolspace-svg-triangle-button-hover');\r\n            };\r\n\r\n            // because :hover causes problems w touch\r\n            const leftPointerListener = new BB.PointerListener({\r\n                target: svgTriangleLeft,\r\n                onEnterLeave: (isOver) => {\r\n                    svgTriangleLeft.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n                },\r\n            });\r\n            const rightPointerListener = new BB.PointerListener({\r\n                target: svgTriangleRight,\r\n                onEnterLeave: (isOver) => {\r\n                    svgTriangleRight.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n                },\r\n            });\r\n\r\n\r\n            svg.append(defs, svgTriangleLeft, svgTriangleRight);\r\n            result.append(svg);\r\n\r\n\r\n            const leftIm = BB.el({\r\n                parent: result,\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundSize: 'contain',\r\n                    width: '20px',\r\n                    height: '20px',\r\n                    position: 'absolute',\r\n                    left: '10px',\r\n                    top: '8px',\r\n                    //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                    pointerEvents: 'none',\r\n                },\r\n            });\r\n            result.append(leftIm);\r\n\r\n\r\n            const rightIm = BB.el({\r\n                parent: result,\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundSize: 'contain',\r\n                    width: '20px',\r\n                    height: '20px',\r\n                    position: 'absolute',\r\n                    right: '10px',\r\n                    bottom: '8px',\r\n                    transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                    pointerEvents: 'none',\r\n                },\r\n            });\r\n\r\n\r\n\r\n\r\n\r\n            const setIsEnabledLeft = (b: boolean) => {\r\n                svgTriangleLeft.classList.toggle('toolspace-row-button-disabled', !b);\r\n                leftIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n            };\r\n\r\n            const setIsEnabledRight = (b: boolean) => {\r\n                svgTriangleRight.classList.toggle('toolspace-row-button-disabled', !b);\r\n                rightIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n            };\r\n\r\n            return {\r\n                el: result,\r\n                setIsEnabledLeft,\r\n                setIsEnabledRight,\r\n                leftPointerListener,\r\n                rightPointerListener,\r\n            };\r\n        };\r\n\r\n        this.toolDropdown = new ToolDropdown({\r\n            onChange: (activeStr) => {\r\n                this.setActive(activeStr, true);\r\n            },\r\n        });\r\n        this.rootEl.append(this.toolDropdown.getElement());\r\n\r\n        this.handButton = createButton({\r\n            onClick: () => {\r\n                this.setActive('hand', true);\r\n            },\r\n            image: toolHandImg,\r\n            contain: true,\r\n            doLighten: true,\r\n        });\r\n        this.handButton.el.classList.add('kl-tool-row-border-right');\r\n        this.handButton.el.title = LANG('tool-hand');\r\n        this.rootEl.append(this.handButton.el);\r\n\r\n        this.zoomInNOutButton = createTriangleButton({\r\n            onLeft: p.onZoomIn,\r\n            onRight: p.onZoomOut,\r\n            leftImage: toolZoomInImg,\r\n            rightImage: toolZoomOutImg,\r\n        });\r\n        this.zoomInNOutButton.el.title = LANG('tool-zoom');\r\n        this.rootEl.append(this.zoomInNOutButton.el);\r\n\r\n        this.zoomInButton = createButton({\r\n            onClick: p.onZoomIn,\r\n            image: toolZoomInImg,\r\n            contain: true,\r\n        });\r\n        this.zoomInButton.el.title = LANG('zoom-in');\r\n        this.rootEl.append(this.zoomInButton.el);\r\n\r\n        this.zoomOutButton = createButton({\r\n            onClick: p.onZoomOut,\r\n            image: toolZoomOutImg,\r\n            contain: true,\r\n        });\r\n        this.zoomOutButton.el.title = LANG('zoom-out');\r\n        this.rootEl.append(this.zoomOutButton.el);\r\n\r\n        this.undoNRedoButton = createTriangleButton({\r\n            onLeft: p.onUndo,\r\n            onRight: p.onRedo,\r\n            leftImage: toolUndoImg,\r\n            rightImage: null,\r\n        });\r\n        this.undoNRedoButton.el.title = LANG('undo') + '/' + LANG('redo');\r\n        this.undoNRedoButton.setIsEnabledLeft(false);\r\n        this.undoNRedoButton.setIsEnabledRight(false);\r\n        this.rootEl.append(this.undoNRedoButton.el);\r\n\r\n        this.undoButton = createButton({\r\n            onClick: p.onUndo,\r\n            image: toolUndoImg,\r\n            contain: true,\r\n        });\r\n        this.undoButton.el.title = LANG('undo');\r\n        this.undoButton.el.classList.add('toolspace-row-button-disabled');\r\n        this.rootEl.append(this.undoButton.el);\r\n\r\n        this.redoButton = createButton({\r\n            onClick: p.onRedo,\r\n            image: toolUndoImg,\r\n            contain: true,\r\n            doMirror: true,\r\n        });\r\n        this.redoButton.el.title = LANG('redo');\r\n        this.redoButton.el.classList.add('toolspace-row-button-disabled');\r\n        this.rootEl.append(this.redoButton.el);\r\n\r\n        this.zoomInButton.el.style.display = 'none';\r\n        this.zoomOutButton.el.style.display = 'none';\r\n        this.undoButton.el.style.display = 'none';\r\n        this.redoButton.el.style.display = 'none';\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsSmall (b: boolean): void {\r\n        BB.css(this.rootEl, {\r\n            height: b ? '36px' : '54px',\r\n        });\r\n\r\n        this.toolDropdown.setIsSmall(b);\r\n        this.handButton.setIsSmall(b);\r\n        this.zoomInButton.setIsSmall(b);\r\n        this.zoomOutButton.setIsSmall(b);\r\n        this.undoButton.setIsSmall(b);\r\n        this.redoButton.setIsSmall(b);\r\n\r\n        if (b) {\r\n            this.zoomInNOutButton.el.style.display = 'none';\r\n            this.undoNRedoButton.el.style.display = 'none';\r\n            this.zoomInButton.el.style.display = 'block';\r\n            this.zoomOutButton.el.style.display = 'block';\r\n            this.undoButton.el.style.display = 'block';\r\n            this.redoButton.el.style.display = 'block';\r\n        } else {\r\n            this.zoomInNOutButton.el.style.display = 'block';\r\n            this.undoNRedoButton.el.style.display = 'block';\r\n            this.zoomInButton.el.style.display = 'none';\r\n            this.zoomOutButton.el.style.display = 'none';\r\n            this.undoButton.el.style.display = 'none';\r\n            this.redoButton.el.style.display = 'none';\r\n        }\r\n\r\n    }\r\n\r\n    setEnableZoomIn (b: boolean): void {\r\n        this.zoomInButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.zoomInNOutButton.setIsEnabledLeft(b);\r\n    }\r\n\r\n    setEnableZoomOut (b: boolean): void {\r\n        this.zoomOutButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.zoomInNOutButton.setIsEnabledRight(b);\r\n    }\r\n\r\n    setEnableUndo (b: boolean): void {\r\n        this.undoButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.undoNRedoButton.setIsEnabledLeft(b);\r\n    }\r\n\r\n    setEnableRedo (b: boolean): void {\r\n        this.redoButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.undoNRedoButton.setIsEnabledRight(b);\r\n    }\r\n\r\n    setActive (activeStr: TToolType, doEmit?: boolean): void {\r\n        if (this.currentActiveStr === activeStr) {\r\n            return;\r\n        }\r\n\r\n        this.currentActiveStr = activeStr;\r\n\r\n        this.toolDropdown.setActive(this.currentActiveStr);\r\n        this.handButton.el.classList.toggle('toolspace-row-button-activated', this.currentActiveStr === 'hand');\r\n\r\n        if (doEmit) {\r\n            this.onActivate(this.currentActiveStr);\r\n        }\r\n    }\r\n\r\n    getActive (): TToolType {\r\n        return this.currentActiveStr;\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"b30IN\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"jYhj7\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"44EC1\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1YnIA\");","import {BB} from '../../../bb/bb';\r\nimport {Select} from './select';\r\nimport {LANG} from '../../../language/language';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n/**\r\n * Ui to select stabilizer level. 4 options. returned as 0-3\r\n */\r\nexport class ToolspaceStabilizerRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly pointerListener: PointerListener;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            smoothing: number; // initial level [0,3]\r\n            onSelect: (level: number) => void; // [0-3], when level changes\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            tagName: 'label',\r\n            className: 'kl-stabilizer',\r\n            content: LANG('stabilizer') + '&nbsp;',\r\n            title: LANG('stabilizer-title'),\r\n        });\r\n\r\n        const strengthSelect = new Select({\r\n            optionArr: [\r\n                ['0', '0'],\r\n                ['1', '1'],\r\n                ['2', '2'],\r\n                ['3', '3'],\r\n                ['4', '4'],\r\n                ['5', '5'],\r\n            ],\r\n            initValue: '' + p.smoothing,\r\n            onChange: function (val) {\r\n                p.onSelect(parseInt(val));\r\n            },\r\n        });\r\n        this.rootEl.append(strengthSelect.getElement());\r\n\r\n        this.pointerListener = new BB.PointerListener({\r\n            target: this.rootEl,\r\n            onWheel: function (e) {\r\n                strengthSelect.setDeltaValue(e.deltaY);\r\n            },\r\n        });\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport invertedBorderImg from '/src/app/img/ui/inverted-border.svg';\r\nimport {IKeyStringOptional} from '../../../bb/bb-types';\r\n\r\n\r\n// type all functions\r\n\r\n\r\ntype TTabInit = {\r\n    id: string; // e.g. 'draw',\r\n    label?: string;\r\n    image?: string; // background image\r\n    title?: string;\r\n    isVisible?: boolean; // default is true\r\n    onOpen: () => void;\r\n    onClose: () => void;\r\n    css?: IKeyStringOptional;\r\n};\r\n\r\ntype TTab = {\r\n    id: string;\r\n    isVisible: boolean;\r\n    onOpen: () => void;\r\n    onClose: () => void;\r\n    update: (activeTab: TTab) => void;\r\n    el: HTMLElement;\r\n};\r\n\r\n\r\n/**\r\n * row of tabs. uses css class .tabrow__tab\r\n */\r\nexport class TabRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly tabArr: TTab[];\r\n    private activeTab: TTab;\r\n    private readonly roundRight: HTMLElement;\r\n    private readonly roundLeft: HTMLElement;\r\n    \r\n    \r\n    // update\r\n    update (): void {\r\n        for (let i = 0; i < this.tabArr.length; i++) {\r\n            this.tabArr[i].update(this.activeTab);\r\n        }\r\n    }\r\n    \r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            initialId: string; // e.g. 'draw'\r\n            useAccent?: boolean;\r\n            tabArr: TTabInit[];\r\n        }\r\n    ) {\r\n        const height = 35;\r\n        this.rootEl = BB.el({\r\n            className: 'tabrow',\r\n            css: {\r\n                height: height + 'px',\r\n            },\r\n        });\r\n\r\n        this.tabArr = []; //creates its own internal arr\r\n\r\n        const roundSize = 10;\r\n        this.roundRight = BB.el({\r\n            css: {\r\n                width: roundSize + 'px',\r\n                height: roundSize + 'px',\r\n                backgroundImage: `url('${invertedBorderImg}')`,\r\n                backgroundSize: 'cover',\r\n                position: 'absolute',\r\n                right: -roundSize + 'px',\r\n                bottom: '0',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        this.roundLeft = BB.el({\r\n            css: {\r\n                width: roundSize + 'px',\r\n                height: roundSize + 'px',\r\n                backgroundImage: `url('${invertedBorderImg}')`,\r\n                backgroundSize: 'cover',\r\n                position: 'absolute',\r\n                left: -roundSize + 'px',\r\n                bottom: '0',\r\n                transform: 'scale(-1,1)',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n\r\n        const createTab = (pTabObj: TTabInit, initialId: string, useAccent: boolean): TTab => {\r\n            const isVisible = ('isVisible' in pTabObj && pTabObj.isVisible !== undefined) ? pTabObj.isVisible : true;\r\n            const result: TTab = {\r\n                id: pTabObj.id,\r\n                isVisible: isVisible,\r\n                onOpen: pTabObj.onOpen,\r\n                onClose: pTabObj.onClose,\r\n                update: (openedTabObj: TTab) => {\r\n                    result.el.className = openedTabObj === result ? (useAccent ? 'tabrow__tab tabrow__tab--opened-accented' : 'tabrow__tab tabrow__tab--opened') : 'tabrow__tab';\r\n                    result.el.style.display = result.isVisible ? 'block' : 'none';\r\n                },\r\n                el: BB.el({\r\n                    parent: this.rootEl,\r\n                    content: 'label' in pTabObj ? pTabObj.label : '',\r\n                    title: 'title' in pTabObj ? pTabObj.title : undefined,\r\n                    className: initialId === pTabObj.id ? (useAccent ? 'tabrow__tab tabrow__tab--opened-accented' : 'tabrow__tab tabrow__tab--opened') : 'tabrow__tab',\r\n                    css: {\r\n                        lineHeight: height + 'px',\r\n                        display: isVisible ? 'block' : 'none',\r\n                        zIndex: '0',\r\n                    },\r\n                    onClick: () => {\r\n                        if (this.activeTab === result) {\r\n                            return;\r\n                        }\r\n                        this.open(result.id);\r\n                    },\r\n                }),\r\n            };\r\n            if ('image' in pTabObj) {\r\n\r\n                BB.el({\r\n                    tagName: 'span',\r\n                    parent: result.el,\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        backgroundImage: `url(\"${pTabObj.image}\")`,\r\n                        backgroundSize: 'contain',\r\n                        backgroundPosition: 'center',\r\n                        backgroundRepeat: 'no-repeat',\r\n                        display: 'flex',\r\n                        height: (height - 7) + 'px',\r\n                        justifyContent: 'center',\r\n                        margin: '4px auto',\r\n                    },\r\n                });\r\n            }\r\n            if ('css' in pTabObj && pTabObj.css !== undefined) {\r\n                BB.css(result.el, pTabObj.css);\r\n            }\r\n\r\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: result.el,\r\n                onEnterLeave: (isOver) => {\r\n                    result.el.classList.toggle('tabrow__tab-hover', isOver);\r\n                },\r\n            });\r\n\r\n            if (initialId === result.id) {\r\n                result.onOpen();\r\n                result.el.append(this.roundRight, this.roundLeft);\r\n            } else {\r\n                result.onClose();\r\n            }\r\n\r\n            return result;\r\n        };\r\n\r\n        let initTabObj = null;\r\n        for (let i = 0; i < p.tabArr.length; i++) {\r\n            const tab = createTab(p.tabArr[i], p.initialId, p.useAccent || false);\r\n            if (tab.id === p.initialId) {\r\n                initTabObj = tab;\r\n            }\r\n            this.tabArr.push(tab);\r\n        }\r\n        if (!initTabObj) {\r\n            throw 'invalid initialId';\r\n        }\r\n        this.activeTab = initTabObj;\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    open (tabId: string): void {\r\n        for (let i = 0; i < this.tabArr.length; i++) {\r\n            if (this.tabArr[i].id === tabId) {\r\n                if (this.activeTab === this.tabArr[i]) { // already open\r\n                    return;\r\n                }\r\n                this.activeTab.onClose();\r\n                this.activeTab = this.tabArr[i];\r\n                this.activeTab.onOpen();\r\n                this.activeTab.el.append(this.roundRight, this.roundLeft);\r\n                this.update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.open - invalid tabId';\r\n    }\r\n\r\n    getOpenedTabId (): string {\r\n        return '' + this.activeTab.id;\r\n    }\r\n\r\n    setIsVisible (tabId: string, isVisible: string): void {\r\n        for (let i = 0; i < this.tabArr.length; i++) {\r\n            if (this.tabArr[i].id === tabId) {\r\n                this.tabArr[i].isVisible = !!isVisible;\r\n                this.update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.setIsVisible - invalid tabId';\r\n    }\r\n}\r\n\r\n\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6ae9h\");","import {BB} from '../../../bb/bb';\r\nimport angleImg from '/src/app/img/ui/angle.svg';\r\nimport rotateImg from '/src/app/img/ui/edit-rotate.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Ui, when hand tool tab is open.\r\n */\r\nexport class HandUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly onAngleChange: (angleDeg: number, isRelative?: boolean) => void;\r\n    private isVisible: boolean = true;\r\n    private scale: number;\r\n    private angleDeg: number;\r\n    private readonly scaleEl: HTMLElement;\r\n    private readonly angleEl: HTMLElement;\r\n    private readonly angleIm: HTMLImageElement;\r\n\r\n\r\n    private updateUi (): void {\r\n        this.scaleEl.innerHTML = Math.round(this.scale * 100) + '%';\r\n        this.angleEl.innerHTML =  Math.round(this.angleDeg) + '';\r\n\r\n        this.angleIm.style.transform = 'rotate(' + this.angleDeg + 'deg)';\r\n        if (this.angleDeg % 90 === 0) {\r\n            this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)';\r\n        } else {\r\n            this.angleIm.style.boxShadow = '';\r\n        }\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            scale: number; // initial value\r\n            angleDeg: number; // initial value\r\n            onReset: () => void;\r\n            onFit: () => void;\r\n            onAngleChange: (angleDeg: number, isRelative?: boolean) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.scale = p.scale;\r\n        this.angleDeg = p.angleDeg;\r\n        this.onAngleChange = p.onAngleChange;\r\n\r\n        const row1 = BB.el({\r\n            css: {\r\n                marginBottom: '10px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n        const row2 = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        const row3 = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n        this.rootEl.append(row1, row2, row3);\r\n\r\n\r\n        this.scaleEl = BB.el({\r\n            css: {\r\n                width: '55px',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        row1.append(this.scaleEl);\r\n\r\n        this.angleIm = new Image();\r\n        this.angleIm.src = angleImg;\r\n        BB.css(this.angleIm, {\r\n            verticalAlign: 'bottom',\r\n            width: '20px',\r\n            height: '20px',\r\n            marginRight: '5px',\r\n            borderRadius: '10px',\r\n            background: 'rgba(0,0,0,0.2)',\r\n            userSelect: 'none',\r\n        });\r\n        row1.append(this.angleIm);\r\n\r\n        this.angleEl = BB.el({\r\n            parent: row1,\r\n            css: {\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n\r\n        this.updateUi();\r\n\r\n\r\n        const resetButton = BB.el({\r\n            tagName: 'button',\r\n            content: LANG('hand-reset'),\r\n            onClick: p.onReset,\r\n        });\r\n        BB.makeUnfocusable(resetButton);\r\n\r\n        const fitButton = BB.el({\r\n            tagName: 'button',\r\n            content: LANG('hand-fit'),\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: p.onFit,\r\n        });\r\n        BB.makeUnfocusable(fitButton);\r\n        row2.append(resetButton, fitButton);\r\n\r\n        const leftRotateButton = BB.el({\r\n            tagName: 'button',\r\n            content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\r\n            onClick: function () {\r\n                p.onAngleChange(-15, true);\r\n            },\r\n        });\r\n        BB.makeUnfocusable(leftRotateButton);\r\n\r\n        const resetAngleButton = BB.el({\r\n            tagName: 'button',\r\n            content: '0',\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: function () {\r\n                p.onAngleChange(0);\r\n            },\r\n        });\r\n        BB.makeUnfocusable(resetAngleButton);\r\n\r\n        const rightRotateButton = BB.el({\r\n            tagName: 'button',\r\n            content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\"/>',\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: function () {\r\n                p.onAngleChange(15, true);\r\n            },\r\n        });\r\n        BB.makeUnfocusable(rightRotateButton);\r\n        row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.updateUi();\r\n        }\r\n    }\r\n\r\n    update (pScale: number, pAngleDeg: number): void {\r\n        this.scale = pScale;\r\n        this.angleDeg = pAngleDeg;\r\n        if (this.isVisible) {\r\n            this.updateUi();\r\n        }\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"8l03e\");","import {BB} from '../../../bb/bb';\r\nimport {KlSlider} from '../components/kl-slider';\r\nimport {Select} from '../components/select';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {LANG} from '../../../language/language';\r\nimport {TFillSampling} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n/**\r\n * Paint Bucket tab contents (color slider, opacity slider, etc)\r\n */\r\nexport class FillUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private isVisible: boolean;\r\n    private readonly colorDiv: HTMLElement;\r\n    private readonly colorSlider: KlColorSlider;\r\n    private readonly toleranceSlider: KlSlider;\r\n    private readonly opacitySlider: KlSlider;\r\n    private readonly modeSelect: Select;\r\n    private readonly growSelect: Select;\r\n    private isContiguous: boolean;\r\n    private readonly eraserToggle: Checkbox;\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.isVisible = true;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        this.colorSlider = p.colorSlider;\r\n\r\n        this.opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: 1,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n        });\r\n        this.rootEl.append(this.opacitySlider.getElement());\r\n\r\n        this.toleranceSlider = new KlSlider({\r\n            label: LANG('bucket-tolerance'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 0,\r\n            max: 255,\r\n            value: 20 * (255 / 100),\r\n            toValue: (displayValue) => displayValue * (255 / 100),\r\n            toDisplayValue: (value) => value / (255 / 100),\r\n        });\r\n        BB.css(this.toleranceSlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(this.toleranceSlider.getElement());\r\n\r\n        const selectRow = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const modeWrapper = BB.el({\r\n            content: LANG('bucket-sample') + '&nbsp;',\r\n            title: LANG('bucket-sample-title'),\r\n            css: {\r\n                fontSize: '15px',\r\n            },\r\n        });\r\n        this.modeSelect = new Select({\r\n            optionArr: [\r\n                ['all', LANG('bucket-sample-all')],\r\n                ['current', LANG('bucket-sample-active')],\r\n                ['above', LANG('bucket-sample-above')],\r\n            ],\r\n            initValue: 'all',\r\n        });\r\n        const modePointerListener = new BB.PointerListener({\r\n            target: this.modeSelect.getElement(),\r\n            onWheel: (e) => {\r\n                this.modeSelect.setDeltaValue(e.deltaY);\r\n            },\r\n        });\r\n        modeWrapper.append(this.modeSelect.getElement());\r\n        selectRow.append(modeWrapper);\r\n\r\n        const growWrapper = BB.el({\r\n            content: LANG('bucket-grow') + '&nbsp;',\r\n            title: LANG('bucket-grow-title'),\r\n            css: {\r\n                fontSize: '15px',\r\n                marginLeft: '10px',\r\n            },\r\n        });\r\n        this.growSelect = new Select({\r\n            optionArr: [\r\n                ['0', '0'],\r\n                ['1', '1'],\r\n                ['2', '2'],\r\n                ['3', '3'],\r\n                ['4', '4'],\r\n                ['5', '5'],\r\n                ['6', '6'],\r\n                ['7', '7'],\r\n            ],\r\n            initValue: '0',\r\n        });\r\n        const growPointerListener = new BB.PointerListener({\r\n            target: this.growSelect.getElement(),\r\n            onWheel: (e) => {\r\n                this.growSelect.setDeltaValue(e.deltaY);\r\n            },\r\n        });\r\n        growWrapper.append(this.growSelect.getElement());\r\n        selectRow.append(growWrapper);\r\n\r\n\r\n        this.isContiguous = true;\r\n        const contiguousToggle = new Checkbox({\r\n            init: true,\r\n            label: LANG('bucket-contiguous'),\r\n            title: LANG('bucket-contiguous-title'),\r\n            callback: (b) => {\r\n                this.isContiguous = b;\r\n            },\r\n            css: {\r\n                paddingRight: '5px',\r\n                display: 'inline-block',\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        this.eraserToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('eraser'),\r\n            css: {\r\n\r\n                paddingRight: '5px',\r\n                display: 'inline-block',\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        this.rootEl.append(BB.el({\r\n            content: [\r\n                contiguousToggle.getElement(),\r\n                this.eraserToggle.getElement(),\r\n            ],\r\n            css: {\r\n                display: 'flex',\r\n                marginTop: '10px',\r\n            },\r\n        }));\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * [0, 1]\r\n     */\r\n    getTolerance (): number {\r\n        return this.toleranceSlider.getValue();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacitySlider.getValue();\r\n    }\r\n\r\n    getSample (): TFillSampling {\r\n        return this.modeSelect.getValue() as TFillSampling;\r\n    }\r\n\r\n    getGrow (): number {\r\n        return parseInt(this.growSelect.getValue(), 10);\r\n    }\r\n\r\n    getContiguous (): boolean {\r\n        return this.isContiguous;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.eraserToggle.getValue();\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n/**\r\n * Text Tool tab contents (color slider)\r\n */\r\nexport class TextUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly colorDiv: HTMLElement;\r\n    private isVisible: boolean = true;\r\n    private readonly colorSlider: KlColorSlider;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.colorSlider = p.colorSlider;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        const hint = BB.el({\r\n            parent: this.rootEl,\r\n            content: LANG('text-instruction'),\r\n        });\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\r\n        }\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {Options} from '../components/options';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {KlSlider} from '../components/kl-slider';\r\nimport {LANG} from '../../../language/language';\r\nimport {TShapeToolMode, TShapeToolType} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n/**\r\n * Shape Tool tab contents\r\n */\r\nexport class ShapeUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private isVisible: boolean;\r\n    private readonly colorDiv: HTMLElement;\r\n    private readonly colorSlider: KlColorSlider;\r\n    private shape: TShapeToolType = 'rect';\r\n    private mode: TShapeToolMode = 'stroke';\r\n    private readonly eraserToggle: Checkbox;\r\n    private readonly opacitySlider: KlSlider;\r\n    private readonly lineWidthSlider: KlSlider;\r\n    private readonly outwardsToggle: Checkbox;\r\n    private readonly fixedToggle: Checkbox;\r\n    private readonly snapToggle:Checkbox;\r\n    private readonly lockAlphaToggle: Checkbox;\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.isVisible = true;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        this.colorSlider = p.colorSlider;\r\n\r\n        const previewSize = 35;\r\n        const previewPadding = 8;\r\n\r\n\r\n        const rectStrokeSvgRect = BB.createSvg({\r\n            elementType: 'rect',\r\n            x: '' + previewPadding,\r\n            width: '' + (previewSize - previewPadding * 2),\r\n        });\r\n        const rectStrokeSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        rectStrokeSvg.classList.add('dark-invert');\r\n        rectStrokeSvg.append(rectStrokeSvgRect);\r\n        BB.css(rectStrokeSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n        const rectFilledSvgRect = BB.createSvg({\r\n            elementType: 'rect',\r\n            x: '' + previewPadding,\r\n            width: '' + (previewSize - previewPadding * 2),\r\n        });\r\n        const rectFilledSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        rectFilledSvg.classList.add('dark-invert');\r\n        rectFilledSvg.append(rectFilledSvgRect);\r\n        BB.css(rectFilledSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n\r\n        const ellipseStrokeSvgEllipse = BB.createSvg({\r\n            elementType: 'ellipse',\r\n            cx: '' + (previewSize / 2),\r\n            cy: '' + (previewSize / 2),\r\n            rx: '' + (previewSize / 2 - previewPadding),\r\n        });\r\n        const ellipseStrokeSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        ellipseStrokeSvg.classList.add('dark-invert');\r\n        ellipseStrokeSvg.append(ellipseStrokeSvgEllipse);\r\n        BB.css(ellipseStrokeSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n        const ellipseFilledSvgEllipse = BB.createSvg({\r\n            elementType: 'ellipse',\r\n            cx: '' + (previewSize / 2),\r\n            cy: '' + (previewSize / 2),\r\n            rx: '' + (previewSize / 2 - previewPadding),\r\n        });\r\n        const ellipseFilledSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        ellipseFilledSvg.classList.add('dark-invert');\r\n        ellipseFilledSvg.append(ellipseFilledSvgEllipse);\r\n        BB.css(ellipseFilledSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n\r\n        const lineSvgLine = BB.createSvg({\r\n            elementType: 'line',\r\n            x1: '' + previewPadding,\r\n            x2: '' + (previewSize - previewPadding),\r\n        });\r\n        const lineSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        lineSvg.classList.add('dark-invert');\r\n        lineSvg.append(lineSvgLine);\r\n        BB.css(lineSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n        const updatePreviews = () => {\r\n            const strokeWidth = BB.clamp(Math.round(this.lineWidthSlider.getValue() / 10), 1, 10) + 'px';\r\n\r\n            const squish = 1.35;\r\n\r\n            BB.css(rectStrokeSvgRect, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n            BB.css(rectFilledSvgRect, { fill: 'black', stroke: 'none' });\r\n\r\n            BB.css(ellipseStrokeSvgEllipse, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n            BB.css(ellipseFilledSvgEllipse, { fill: 'black', stroke: 'none' });\r\n\r\n            BB.css(\r\n                lineSvgLine,\r\n                { fill: 'none', stroke: 'black', strokeWidth: strokeWidth }\r\n            );\r\n\r\n            if (this.fixedToggle.getValue()) {\r\n                rectStrokeSvgRect.setAttribute('y', '' + previewPadding);\r\n                rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n                rectFilledSvgRect.setAttribute('y', '' + previewPadding);\r\n                rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n\r\n                ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n                ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n            } else {\r\n                rectStrokeSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n                rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n                rectFilledSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n                rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n\r\n                ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n                ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n            }\r\n\r\n            if (this.snapToggle.getValue()) {\r\n                lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding));\r\n                lineSvgLine.setAttribute('y2', '' + previewPadding);\r\n            } else {\r\n                lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding * squish));\r\n                lineSvgLine.setAttribute('y2', '' + (previewPadding * squish));\r\n            }\r\n        };\r\n\r\n        const row1 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'start',\r\n            },\r\n        });\r\n\r\n        const shapeOptions = new Options({\r\n            optionArr: [\r\n                {\r\n                    id: 'rect-stroke',\r\n                    label: rectStrokeSvg,\r\n                    title: LANG('shape-rect') + ' ' + LANG('shape-stroke'),\r\n                },\r\n                {\r\n                    id: 'ellipse-stroke',\r\n                    label: ellipseStrokeSvg,\r\n                    title: LANG('shape-ellipse') + ' ' + LANG('shape-stroke'),\r\n                },\r\n                {\r\n                    id: 'line',\r\n                    label: lineSvg,\r\n                    title: LANG('shape-line'),\r\n                },\r\n                {\r\n                    id: 'rect-fill',\r\n                    label: rectFilledSvg,\r\n                    title: LANG('shape-rect') + ' ' + LANG('shape-fill'),\r\n                },\r\n                {\r\n                    id: 'ellipse-fill',\r\n                    label: ellipseFilledSvg,\r\n                    title: LANG('shape-ellipse') + ' ' + LANG('shape-fill'),\r\n                },\r\n            ],\r\n            initId: this.shape + ' ' + this.mode,\r\n            onChange: (id) => {\r\n                const split = id.split('-');\r\n                this.shape = split[0] as TShapeToolType;\r\n                this.mode = split[1] as TShapeToolMode;\r\n\r\n                BB.css(this.fixedToggle.getElement(), {\r\n                    display: this.shape === 'line' ? 'none' : '',\r\n                });\r\n                BB.css(this.snapToggle.getElement(), {\r\n                    display: this.shape === 'line' ? '' : 'none',\r\n                });\r\n                BB.css(this.lineWidthSlider.getElement(), {\r\n                    display: (this.shape !== 'line' && this.mode === 'fill') ? 'none' : '',\r\n                });\r\n            },\r\n            changeOnInit: true,\r\n        });\r\n        shapeOptions.getElement().style.width = '120px';\r\n        row1.append(shapeOptions.getElement());\r\n\r\n        this.eraserToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('eraser'),\r\n            callback: () => {\r\n                updatePreviews();\r\n            },\r\n        });\r\n\r\n        this.lockAlphaToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('lock-alpha'),\r\n            title: LANG('lock-alpha-title'),\r\n            doHighlight: true,\r\n        });\r\n        this.lockAlphaToggle.getElement().style.marginTop = '10px';\r\n\r\n        row1.append(BB.el({\r\n            content: [\r\n                this.eraserToggle.getElement(),\r\n                this.lockAlphaToggle.getElement(),\r\n            ],\r\n        }));\r\n\r\n        this.lineWidthSlider = new KlSlider({\r\n            label: LANG('shape-line-width'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1,\r\n            max: 200,\r\n            value: 4,\r\n            curve: 'quadratic',\r\n            onChange: () => {\r\n                updatePreviews();\r\n            },\r\n        });\r\n        BB.css(this.lineWidthSlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(this.lineWidthSlider.getElement());\r\n\r\n        this.opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: 1,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n        });\r\n        BB.css(this.opacitySlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(this.opacitySlider.getElement());\r\n\r\n        const row2 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        this.outwardsToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('shape-outwards'),\r\n            css: {\r\n                width: '50%',\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n        row2.append(this.outwardsToggle.getElement());\r\n\r\n        this.fixedToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('shape-fixed'),\r\n            callback: () => {\r\n                updatePreviews();\r\n            },\r\n            css: {\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n        row2.append(this.fixedToggle.getElement());\r\n\r\n        this.snapToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('angle-snap'),\r\n            title: LANG('angle-snap-title'),\r\n            callback: () => {\r\n                updatePreviews();\r\n            },\r\n            css: {\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n        row2.append(this.snapToggle.getElement());\r\n\r\n\r\n        updatePreviews();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement());\r\n            this.colorDiv.append(this.colorSlider.getOutputElement());\r\n            //update();\r\n        }\r\n    }\r\n\r\n    getShape (): TShapeToolType {\r\n        return this.shape;\r\n    }\r\n\r\n    getMode (): TShapeToolMode {\r\n        return this.mode;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.eraserToggle.getValue();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacitySlider.getValue();\r\n    }\r\n\r\n    getLineWidth (): number {\r\n        return this.lineWidthSlider.getValue();\r\n    }\r\n\r\n    getIsOutwards (): boolean {\r\n        return this.outwardsToggle.getValue();\r\n    }\r\n\r\n    getIsFixed (): boolean {\r\n        return this.fixedToggle.getValue();\r\n    }\r\n\r\n    getIsSnap (): boolean {\r\n        return this.snapToggle.getValue();\r\n    }\r\n\r\n    getDoLockAlpha (): boolean {\r\n        return this.lockAlphaToggle.getValue();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../components/select';\r\nimport {ColorOptions} from '../components/color-options';\r\nimport {showModal} from './base/showModal';\r\nimport {LANG} from '../../../language/language';\r\nimport {IRGB, IRGBA} from '../../kl-types';\r\nimport {ISize2D} from '../../../bb/bb-types';\r\nimport {table} from '../components/table';\r\nimport {ERASE_COLOR} from '../../brushes/erase-color';\r\nimport {theme} from '../../../theme/theme';\r\n\r\nexport function newImageDialog (\r\n    p: {\r\n        currentColor: IRGB; // current color\r\n        secondaryColor: IRGB;\r\n        maxCanvasSize: number;\r\n        canvasWidth: number; // current canvas size\r\n        canvasHeight: number; // current canvas size\r\n        workspaceWidth: number;\r\n        workspaceHeight: number;\r\n        onConfirm: (width: number, height: number, color: IRGBA) => void;\r\n        onCancel: () => void;\r\n    }\r\n): void {\r\n\r\n    const currentColor = p.currentColor;\r\n    const secondaryColor = p.secondaryColor;\r\n    const maxCanvasSize = p.maxCanvasSize;\r\n    const canvasWidth = p.canvasWidth;\r\n    const canvasHeight = p.canvasHeight;\r\n    const workspaceWidth = p.workspaceWidth;\r\n    const workspaceHeight = p.workspaceHeight;\r\n    const onConfirm = p.onConfirm;\r\n    const onCancel = p.onCancel;\r\n\r\n    function createRatioSize (ratioX: number, ratioY: number, width: number, height: number, padding: number): ISize2D {\r\n        return BB.fitInto(\r\n            ratioX,\r\n            ratioY,\r\n            Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding),\r\n            1\r\n        );\r\n    }\r\n\r\n    const newImDiv = BB.el();\r\n    const widthInput = BB.el({tagName: 'input'}) as HTMLInputElement;\r\n    const unitStyle = {\r\n        color: '#888',\r\n        fontSize: '12px',\r\n        marginLeft: '5px',\r\n    };\r\n    const widthUnit = BB.el({\r\n        textContent: LANG('new-px'),\r\n        css: unitStyle,\r\n    });\r\n    const heightInput = BB.el({tagName: 'input'}) as HTMLInputElement;\r\n    const heightUnit = BB.el({\r\n        textContent: LANG('new-px'),\r\n        css: unitStyle,\r\n    });\r\n\r\n    widthInput.setAttribute('data-ignore-focus', 'true');\r\n    heightInput.setAttribute('data-ignore-focus', 'true');\r\n\r\n    widthInput.type = 'number';\r\n    widthInput.min = '1';\r\n    widthInput.max = '' + maxCanvasSize;\r\n    BB.css(widthInput, {\r\n        width: '70px',\r\n    });\r\n\r\n    heightInput.type = 'number';\r\n    heightInput.min = '1';\r\n    heightInput.max = '' + maxCanvasSize;\r\n    heightInput.style.width = '70px';\r\n    widthInput.value = '' + canvasWidth;\r\n    heightInput.value = '' + canvasHeight;\r\n    widthInput.onclick = () => {\r\n        widthInput.focus();\r\n        updateRatio();\r\n    };\r\n    heightInput.onclick = () => {\r\n        heightInput.focus();\r\n        updateRatio();\r\n    };\r\n\r\n\r\n    const sizeTable = table([\r\n        [\r\n            LANG('width') + ':&nbsp;',\r\n            widthInput,\r\n            widthUnit,\r\n        ],\r\n        [\r\n            BB.el({css: {height: '5px'}}),\r\n            '',\r\n            '',\r\n        ],\r\n        [\r\n            LANG('height') + ':&nbsp;',\r\n            heightInput,\r\n            heightUnit,\r\n        ],\r\n    ]);\r\n    BB.css(sizeTable, {\r\n        marginBottom: '10px',\r\n    });\r\n\r\n\r\n    const ratioWrapper = BB.el({\r\n        css: {\r\n            marginTop: '5px',\r\n            color: '#888',\r\n        },\r\n    });\r\n\r\n    const templateWrapper = BB.el();\r\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\r\n    const presetFitBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n    templateWrapper.style.marginBottom = '10px';\r\n    const presetCurrentBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n    const presetSquareBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n    const presetLandscapeBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n    const presetPortraitBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n    const presetOversizeBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n\r\n    presetCurrentBtn.textContent = LANG('new-current');\r\n    presetFitBtn.textContent = LANG('new-fit');\r\n    presetOversizeBtn.textContent = LANG('new-oversize');\r\n    presetLandscapeBtn.textContent = LANG('new-landscape');\r\n    presetPortraitBtn.textContent = LANG('new-portrait');\r\n    presetSquareBtn.textContent = LANG('new-square');\r\n\r\n    presetCurrentBtn.style.marginRight = '5px';\r\n    presetFitBtn.style.marginRight = '5px';\r\n    presetOversizeBtn.style.marginRight = '5px';\r\n    presetLandscapeBtn.style.marginTop = '5px';\r\n    presetLandscapeBtn.style.marginRight = '5px';\r\n    presetPortraitBtn.style.marginTop = '5px';\r\n    presetPortraitBtn.style.marginRight = '5px';\r\n\r\n    templateWrapper.append(\r\n        presetCurrentBtn,\r\n        presetFitBtn,\r\n        presetOversizeBtn,\r\n        presetSquareBtn,\r\n        presetLandscapeBtn,\r\n        presetPortraitBtn\r\n    );\r\n\r\n    const templatePadding = 0;\r\n\r\n    presetCurrentBtn.onclick = function () {\r\n        widthInput.value = '' + canvasWidth;\r\n        heightInput.value = '' + canvasHeight;\r\n        updateRatio();\r\n    };\r\n    presetFitBtn.onclick = function () {\r\n        widthInput.value = '' + workspaceWidth;\r\n        heightInput.value = '' + workspaceHeight;\r\n        updateRatio();\r\n    };\r\n    presetOversizeBtn.onclick = function () {\r\n        widthInput.value = '' + (workspaceWidth + 500);\r\n        heightInput.value = '' + (workspaceHeight + 500);\r\n        updateRatio();\r\n    };\r\n    presetSquareBtn.onclick = function () {\r\n        const sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetLandscapeBtn.onclick = function () {\r\n        const sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetPortraitBtn.onclick = function () {\r\n        const sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n\r\n    const select = new Select({\r\n        isFocusable: true,\r\n        optionArr: [\r\n            ['screen', LANG('new-screen')],\r\n            ['16 9', LANG('new-video') + ' 16:9'],\r\n            ['3 2', '3:2'],\r\n            ['5 3', '5:3'],\r\n            ['2 1', '2:1'],\r\n            ['paper', LANG('new-din-paper') + ' 2:1'],\r\n            ['9 16', '9:16'],\r\n            ['2 3', '2:3'],\r\n            ['3 5', '3:5'],\r\n            ['1 2', '1:2'],\r\n            ['1 1.4142135623730951', '1:2'],\r\n        ],\r\n        onChange: function (val) {\r\n            if (val === 'screen') {\r\n                widthInput.value = '' + window.screen.width;\r\n                heightInput.value = '' + window.screen.height;\r\n            } else if (val === 'paper') {\r\n                const sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            } else {\r\n                const split = val.split(' ');\r\n                const sizeObj = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            }\r\n            updateRatio();\r\n            select.setValue(null);\r\n        },\r\n    });\r\n    setTimeout(() => {\r\n        // safari: not empty without also setting it to null via timeout\r\n        select.setValue(null);\r\n    }, 0);\r\n    BB.css(select.getElement(), {\r\n        width: '80px',\r\n    });\r\n    templateWrapper.append(select.getElement());\r\n\r\n\r\n\r\n    let backgroundRGBA = {r: 255, g: 255, b: 255, a: 1};\r\n\r\n    const colorOptionsArr = [\r\n        {r: 255, g: 255, b: 255, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 0},\r\n        {\r\n            r: currentColor.r,\r\n            g: currentColor.g,\r\n            b: currentColor.b,\r\n            a: 1,\r\n        },\r\n        {\r\n            r: secondaryColor.r,\r\n            g: secondaryColor.g,\r\n            b: secondaryColor.b,\r\n            a: 1,\r\n        },\r\n    ];\r\n    let initColorIndex = 0;\r\n    if (theme.isDark()) {\r\n        colorOptionsArr.forEach((item, index) => {\r\n            if (item.r === ERASE_COLOR && item.g === ERASE_COLOR && item.b === ERASE_COLOR) {\r\n                initColorIndex = index;\r\n                backgroundRGBA = item;\r\n            }\r\n        });\r\n    }\r\n\r\n    const colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        initialIndex: initColorIndex,\r\n        onChange: function (rgbaObj) {\r\n            backgroundRGBA = rgbaObj;\r\n            preview.style.backgroundColor = 'rgba(' + rgbaObj.r + ',' + rgbaObj.g + ',' + rgbaObj.b + ', ' + rgbaObj.a + ')';\r\n        },\r\n    });\r\n\r\n    const previewWrapper = BB.el({\r\n        className: 'kl-transparent-preview',\r\n        css: {\r\n            boxSizing: 'border-box',\r\n            width: '340px',\r\n            height: '140px',\r\n            display: 'table',\r\n            padding: '10px',\r\n            marginTop: '10px',\r\n            marginLeft: '-20px',\r\n        },\r\n    });\r\n    const preview = BB.el({\r\n        className: 'kl-transparent-preview__canvas',\r\n        css: {\r\n            width: 200 + 'px',\r\n            height: 100 + 'px',\r\n            backgroundColor: 'rgba(' + backgroundRGBA.r + ',' + backgroundRGBA.g + ',' + backgroundRGBA.b + ', ' + backgroundRGBA.a + ')',\r\n            marginLeft: 'auto',\r\n            marginRight: 'auto',\r\n            color: '#aaa',\r\n            fontSize: '16px',\r\n            fontWeight: 'bold',\r\n            textAlign: 'center',\r\n            verticalAlign: 'center',\r\n            display: 'table',\r\n            overflow: 'hidden',\r\n        },\r\n    });\r\n    const previewcell = BB.el({\r\n        parent: previewWrapper,\r\n        content: preview,\r\n        css: {\r\n            display: 'table-cell',\r\n            verticalAlign: 'middle',\r\n        },\r\n    });\r\n    const cell = BB.el({\r\n        parent: preview,\r\n        css: {\r\n            display: 'table-cell',\r\n            verticalAlign: 'middle',\r\n        },\r\n    });\r\n\r\n    function updateRatio () {\r\n        widthInput.value = '' + Math.min(maxCanvasSize, parseInt(widthInput.value));\r\n        heightInput.value = '' + Math.min(maxCanvasSize, parseInt(heightInput.value));\r\n\r\n        function hcf (u: number, v: number): number {\r\n            let U = u, V = v;\r\n            while (true) {\r\n                if (!(U %= V)) {\r\n                    return V;\r\n                }\r\n                if (!(V %= U)) {\r\n                    return U;\r\n                }\r\n            }\r\n        }\r\n\r\n        let w = parseInt(widthInput.value);\r\n        let h = parseInt(heightInput.value);\r\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\r\n            if (w > maxCanvasSize) {\r\n                w = maxCanvasSize;\r\n            } else if (h > maxCanvasSize) {\r\n                h = maxCanvasSize;\r\n            }\r\n\r\n            widthInput.value = '' + w;\r\n            heightInput.value = '' + h;\r\n        }\r\n\r\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\r\n        const commonRatios = [\r\n            [1, 2], [2, 1],\r\n            [2, 3], [3, 2],\r\n            [3, 4], [4, 3],\r\n            [4, 5], [5, 4],\r\n            [16, 9], [9, 16],\r\n            [3, 2], [2, 3],\r\n            [5, 3], [3, 5],\r\n            [2, 1], [1, 2],\r\n            [1.414, 1], [1, 1.414],\r\n        ];\r\n        const reducedArr = BB.reduce(w, h);\r\n        let closestRatio = null;\r\n        let closestDistance = null;\r\n        for (let i = 0; i < commonRatios.length; i++) {\r\n            if (i === 0 || Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\r\n                closestRatio = commonRatios[i];\r\n                closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\r\n            }\r\n        }\r\n        //display ratio\r\n        if (closestDistance > 0 && closestDistance < 0.005) {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ~' + closestRatio[0] + ':' + closestRatio[1];\r\n        } else {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ' + reducedArr[0] + ':' + reducedArr[1];\r\n        }\r\n\r\n        const realw = w;\r\n        const T = hcf(w, h);\r\n        w /= T;\r\n        h /= T;\r\n        w *= 260;\r\n        h *= 260;\r\n        if (w > 260) {\r\n            h = 260 / w * h;\r\n            w = 260;\r\n        }\r\n        if (h > 100) {\r\n            w = 100 / h * w;\r\n            h = 100;\r\n\r\n        }\r\n\r\n        preview.style.width = w + 'px';\r\n        preview.style.height = h + 'px';\r\n        BB.createCheckerDataUrl(parseInt('' + (30 * (w / realw))), function (url) {\r\n            previewWrapper.style.background = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n    }\r\n    theme.addIsDarkListener(updateRatio);\r\n\r\n    widthInput.onchange = function () {\r\n        if (widthInput.value === '' || parseInt(widthInput.value) < 0) {\r\n            widthInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    widthInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    heightInput.onchange = function () {\r\n        if (heightInput.value === '' || parseFloat(heightInput.value) < 0) {\r\n            heightInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    heightInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    updateRatio();\r\n\r\n    newImDiv.append(templateWrapper);\r\n    const secondRow = BB.el({\r\n        parent: newImDiv,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'flex-end',\r\n        },\r\n    });\r\n    const secondRowLeft = BB.el({\r\n        parent: secondRow,\r\n    });\r\n    secondRowLeft.append(sizeTable, ratioWrapper);\r\n    secondRow.append(colorOptions.getElement());\r\n\r\n    newImDiv.append(previewWrapper);\r\n\r\n    showModal({\r\n        target: document.body,\r\n        message: `<b>${LANG('new-title')}</b>`,\r\n        div: newImDiv,\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (result) {\r\n            widthInput.onclick = null;\r\n            heightInput.onclick = null;\r\n            presetCurrentBtn.onclick = null;\r\n            presetFitBtn.onclick = null;\r\n            presetOversizeBtn.onclick = null;\r\n            presetSquareBtn.onclick = null;\r\n            presetLandscapeBtn.onclick = null;\r\n            presetPortraitBtn.onclick = null;\r\n            widthInput.onchange = null;\r\n            widthInput.onkeyup = null;\r\n            heightInput.onchange = null;\r\n            heightInput.onkeyup = null;\r\n            select.destroy();\r\n            colorOptions.destroy();\r\n            theme.removeIsDarkListener(updateRatio);\r\n\r\n            if (\r\n                result === 'Cancel'\r\n                || parseInt(widthInput.value) <= 0\r\n                || parseInt(heightInput.value) <= 0\r\n                || isNaN(parseInt(widthInput.value))\r\n                || isNaN(parseInt(heightInput.value))\r\n            ) {\r\n                onCancel();\r\n                return;\r\n            }\r\n            onConfirm(\r\n                parseInt(widthInput.value),\r\n                parseInt(heightInput.value),\r\n                backgroundRGBA\r\n            );\r\n        },\r\n        clickOnEnter: 'Ok',\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nexport function table (\r\n    data: (HTMLElement | string)[][],\r\n    cellProps?: Record<string, {rowspan: number}>, // {'0.2': {...}} -> row 1, col 3\r\n): HTMLElement {\r\n    const result = BB.el({\r\n        tagName: 'table',\r\n        className: 'kl-table',\r\n    });\r\n    data.forEach((row, rowIndex) => {\r\n        const rowEl = BB.el({\r\n            tagName: 'tr',\r\n        });\r\n        rowEl.append(...row.map((el, colIndex) => {\r\n            const cellEl = BB.el({\r\n                tagName: 'td',\r\n                content: el,\r\n            }) as HTMLTableCellElement;\r\n\r\n            const key = rowIndex + '.' + colIndex;\r\n            if (cellProps !== undefined && key in cellProps) {\r\n                cellEl.rowSpan = cellProps[key].rowspan;\r\n            }\r\n\r\n            return cellEl;\r\n        }));\r\n        result.append(rowEl);\r\n    });\r\n    return result;\r\n}","import {BB} from '../../../bb/bb';\r\nimport collapseImg from '/src/app/img/ui/ui-collapse.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {TUiLayout} from '../../kl-types';\r\n\r\n/**\r\n * button that allows to collapse toolspace (for mobile)\r\n */\r\nexport class ToolspaceCollapser {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private directionStr: TUiLayout;\r\n    private readonly icon: HTMLElement;\r\n    private stateIsOpen: boolean;\r\n\r\n\r\n    private update (): void {\r\n        if (this.directionStr === 'left') {\r\n            this.icon.style.transform = this.stateIsOpen ? 'rotate(180deg)' : '';\r\n        } else {\r\n            this.icon.style.transform = this.stateIsOpen ? '' : 'rotate(180deg)';\r\n        }\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onChange: () => void;\r\n        }\r\n    ) {\r\n        this.stateIsOpen = true;\r\n        this.directionStr = 'right';\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-toolspace-toggle',\r\n            css: {\r\n                width: '36px',\r\n                height: '36px',\r\n                background: 'rgba(100, 100, 100, 0.9)',\r\n                color: '#fff',\r\n                position: 'absolute',\r\n                top: '0',\r\n                textAlign: 'center',\r\n                lineHeight: '36px',\r\n                cursor: 'pointer',\r\n                userSelect: 'none',\r\n                padding: '6px',\r\n                boxSizing: 'border-box',\r\n            },\r\n            title: LANG('toggle-show-tools'),\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                this.stateIsOpen = !this.stateIsOpen;\r\n                this.update();\r\n                p.onChange();\r\n            },\r\n        });\r\n\r\n        this.icon = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                backgroundImage: `url(${collapseImg})`,\r\n                width: '100%',\r\n                height: '100%',\r\n                backgroundSize: 'contain',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    isOpen (): boolean {\r\n        return this.stateIsOpen;\r\n    }\r\n\r\n    setDirection (dirStr: TUiLayout): void {\r\n        this.directionStr = dirStr;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"8K12o\");","import {BB} from '../../../bb/bb';\r\nimport {renderText} from '../../image-operations/render-text';\r\nimport {ColorOptions} from '../components/color-options';\r\nimport {Select} from '../components/select';\r\nimport {ImageRadioList} from '../components/image-radio-list';\r\nimport {ImageToggle} from '../components/image-toggle';\r\nimport {KlSlider} from '../components/kl-slider';\r\nimport {showModal} from './base/showModal';\r\nimport alignLeftImg from '/src/app/img/ui/align-left.svg';\r\nimport alignCenterImg from '/src/app/img/ui/align-center.svg';\r\nimport alignRightImg from '/src/app/img/ui/align-right.svg';\r\nimport typoItalicImg from '/src/app/img/ui/typo-italic.svg';\r\nimport typoBoldImg from '/src/app/img/ui/typo-bold.svg';\r\nimport toolZoomInImg from '/src/app/img/ui/tool-zoom-in.svg';\r\nimport toolZoomOutImg from '/src/app/img/ui/tool-zoom-out.svg';\r\nimport {IRGB} from '../../kl-types';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\nimport { throwIfNull} from '../../../bb/base/base';\r\nimport {theme} from '../../../theme/theme';\r\n\r\n\r\ntype TTextFormat = 'left' | 'center' | 'right';\r\ntype TTextFont = 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy';\r\n\r\nexport type TTextToolResult = {\r\n    x: number;\r\n    y: number;\r\n    textStr: string;\r\n    align: TTextFormat;\r\n    isItalic: boolean;\r\n    isBold: boolean;\r\n    color: IRGB;\r\n    size: number; // px\r\n    font: TTextFont;\r\n    opacity: number;\r\n};\r\n\r\n/**\r\n * Text Tool dialog\r\n */\r\nexport function textToolDialog (\r\n    p: {\r\n        klCanvas: KlCanvas;\r\n        layerIndex: number;\r\n        x: number;\r\n        y: number;\r\n        angleRad: number;\r\n        color: IRGB;\r\n        secondaryColor: IRGB;\r\n        size: number; // px\r\n        align: TTextFormat; // default 'left'\r\n        isBold: boolean; // default false\r\n        isItalic: boolean; // default false\r\n        font: TTextFont; // default sans-serif\r\n        opacity: number; // [0, 1] default 1\r\n        onConfirm: (confirmP: TTextToolResult) => void;\r\n    }\r\n): void {\r\n\r\n    const div = BB.el();\r\n\r\n    const isSmallWidth = window.innerWidth < 550;\r\n    const isSmallHeight = window.innerHeight < 630;\r\n\r\n    // --- preview ---\r\n    // Text drawn on klCanvas-sized canvas: textCanvas\r\n    // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\r\n    //      they are transformed. canvas size of final preview\r\n    // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\r\n    // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\r\n\r\n    const width = isSmallWidth ? 340 : 540;\r\n    const height = isSmallWidth ? (isSmallHeight ? 210 : 260) : (isSmallHeight ? 230 : 350);\r\n    let scale = 1;\r\n\r\n    const layerArr = p.klCanvas.getLayersFast();\r\n    const textCanvas = BB.canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\r\n    const textCtx = BB.ctx(textCanvas);\r\n    const targetCanvas = BB.canvas(width, height);\r\n    const targetCtx = BB.ctx(targetCanvas);\r\n    const layersCanvas = BB.canvas(width, height);\r\n    const layersCtx = BB.ctx(layersCanvas);\r\n    const previewCanvas = BB.canvas(width, height); // the one that is visible\r\n    const previewCtx = BB.ctx(previewCanvas);\r\n    BB.css(previewCanvas, {\r\n        display: 'block',\r\n    });\r\n    const previewWrapper = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'relative',\r\n            width: width + 'px',\r\n            marginLeft: '-20px',\r\n            cursor: 'move',\r\n            touchAction: 'none',\r\n        },\r\n        onClick: () => textInput.focus(),\r\n    });\r\n    BB.el({ // inset shadow on preview\r\n        parent: previewWrapper,\r\n        className: 'kl-text-preview-wrapper',\r\n    });\r\n    previewWrapper.append(previewCanvas);\r\n    let checkerPattern = throwIfNull(previewCtx.createPattern(BB.createCheckerCanvas(8, theme.isDark()), 'repeat'));\r\n    const emptyCanvas = BB.canvas(1, 1);\r\n    const emptyCanvasLight = BB.canvas(1, 1);\r\n    {\r\n        let ctx = BB.ctx(emptyCanvas);\r\n        ctx.fillRect(0, 0, 1, 1);\r\n\r\n        ctx = BB.ctx(emptyCanvasLight);\r\n        ctx.fillStyle = '#fff';\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    }\r\n\r\n    function updateCheckerboard (): void {\r\n        checkerPattern = throwIfNull(previewCtx.createPattern(BB.createCheckerCanvas(8, theme.isDark()), 'repeat'));\r\n        updatePreview();\r\n    }\r\n    theme.addIsDarkListener(updateCheckerboard);\r\n\r\n    function updatePreview (): void {\r\n\r\n        // try to draw very much like klCanvasWorkspace\r\n\r\n        // --- draw text ---\r\n        textCtx.clearRect(0, 0, textCanvas.width, textCanvas.height);\r\n        const colorRGBA = {\r\n            ...p.color,\r\n            a: opacitySlider.getValue(),\r\n        };\r\n        const bounds = renderText(textCanvas, {\r\n            x: p.x,\r\n            y: p.y,\r\n            textStr: textInput.value,\r\n            align: alignRadioList.getValue(),\r\n            isItalic: italicToggle.getValue(),\r\n            isBold: boldToggle.getValue(),\r\n            size: parseFloat(sizeInput.value),\r\n            font: fontSelect.getValue(),\r\n            color: BB.ColorConverter.toRgbaStr(colorRGBA),\r\n            angleRad: p.angleRad,\r\n        });\r\n\r\n\r\n        // --- determine transformation of viewport ---\r\n        // text should always be visible\r\n        bounds.width = Math.max(bounds.width, 1);\r\n        bounds.height = Math.max(bounds.height, 1);\r\n        const rotatedXY = BB.rotate(bounds.x, bounds.y, -p.angleRad / Math.PI * 180);\r\n        const rotatedWH = BB.rotate(bounds.width, bounds.height, -p.angleRad / Math.PI * 180);\r\n        const centerX = p.x + rotatedXY.x + rotatedWH.x / 2;\r\n        const centerY = p.y + rotatedXY.y + rotatedWH.y / 2;\r\n\r\n        const padding = 100;\r\n        const fitBounds = BB.fitInto(bounds.width, bounds.height, width - padding, height - padding);\r\n        scale = Math.min(1, fitBounds.width / bounds.width);\r\n        scale = Math.min(4, scale * Math.pow(2, zoomFac));\r\n\r\n\r\n        // --- compose text and target layer ---\r\n        targetCtx.save();\r\n\r\n        if (scale >= 4) {\r\n            targetCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            targetCtx.imageSmoothingEnabled = true;\r\n            targetCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n        }\r\n\r\n        targetCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        targetCtx.translate(width / 2, height / 2);\r\n        targetCtx.scale(scale, scale);\r\n        targetCtx.rotate(p.angleRad);\r\n        targetCtx.drawImage(layerArr[p.layerIndex].canvas, -centerX, -centerY);\r\n        targetCtx.drawImage(textCanvas, -centerX, -centerY);\r\n        targetCtx.restore();\r\n\r\n        const isDark = theme.isDark();\r\n\r\n        // --- layers ---\r\n        layersCtx.save();\r\n\r\n        layersCtx.fillStyle = isDark ? 'rgb(33,33,33)' : 'rgb(158,158,158)';\r\n        layersCtx.fillRect(0, 0, width, height);\r\n\r\n        { // bg\r\n            layersCtx.save();\r\n\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n\r\n            layersCtx.imageSmoothingEnabled = false;\r\n\r\n            //outline\r\n            const borderSize = 1 / scale;\r\n            layersCtx.globalAlpha = isDark ? 0.25 : 0.2;\r\n            layersCtx.drawImage(isDark ? emptyCanvasLight : emptyCanvas, -centerX - borderSize, -centerY - borderSize, textCanvas.width + borderSize * 2, textCanvas.height + borderSize * 2);\r\n            layersCtx.globalAlpha = 1;\r\n\r\n            //erase\r\n            layersCtx.globalCompositeOperation = 'destination-out';\r\n            layersCtx.drawImage(emptyCanvas, -centerX, -centerY, textCanvas.width, textCanvas.height);\r\n\r\n            layersCtx.restore();\r\n        }\r\n\r\n        { // individual layers\r\n\r\n            if (scale >= 4) {\r\n                layersCtx.imageSmoothingEnabled = false;\r\n            } else {\r\n                layersCtx.imageSmoothingEnabled = true;\r\n                layersCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n            }\r\n\r\n            // layers below\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (let i = 0; i < p.layerIndex; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n            // target layer\r\n            layersCtx.globalAlpha = layerArr[p.layerIndex].opacity;\r\n            layersCtx.globalCompositeOperation = layerArr[p.layerIndex].mixModeStr;\r\n            layersCtx.drawImage(targetCanvas, 0, 0);\r\n\r\n            // layers above\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (let i = p.layerIndex + 1; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n        }\r\n\r\n        layersCtx.restore();\r\n\r\n\r\n\r\n        // --- final composite ---\r\n        previewCtx.save();\r\n        previewCtx.fillStyle = checkerPattern;\r\n        previewCtx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        previewCtx.drawImage(layersCanvas, 0, 0);\r\n        previewCtx.restore();\r\n\r\n        // bounds\r\n        previewCtx.save();\r\n        previewCtx.globalCompositeOperation = 'difference';\r\n        previewCtx.strokeStyle = '#fff';\r\n        previewCtx.lineWidth = 1;\r\n        // centerX = p.x + bounds.x + bounds.width / 2;\r\n        // centerY = p.y + bounds.y + bounds.height / 2;\r\n        previewCtx.strokeRect(\r\n            Math.round(width / 2 - (bounds.width / 2) * scale),\r\n            Math.round(height / 2 - (bounds.height / 2) * scale),\r\n            Math.round(bounds.width * scale),\r\n            Math.round(bounds.height * scale)\r\n        );\r\n        previewCtx.restore();\r\n\r\n    }\r\n\r\n    theme.addIsDarkListener(updatePreview);\r\n\r\n    /**\r\n     * Move text by x y\r\n     */\r\n    function move (x: number, y: number): void {\r\n        const rotated = BB.rotate(x, y, -p.angleRad / Math.PI * 180);\r\n        p.x += rotated.x / scale;\r\n        p.y += rotated.y / scale;\r\n        updatePreview();\r\n    }\r\n\r\n    const previewPointerListener = new BB.PointerListener({\r\n        target: previewCanvas,\r\n        onPointer: (e) => {\r\n            if (e.type === 'pointermove' && e.button) {\r\n                e.eventPreventDefault();\r\n                move(-e.dX, -e.dY);\r\n            }\r\n        },\r\n        onWheel: (e) => {\r\n            changeZoomFac(-e.deltaY);\r\n        },\r\n    });\r\n\r\n    const wheelPrevent = (event: WheelEvent): void => event.preventDefault();\r\n    previewCanvas.addEventListener('wheel', wheelPrevent);\r\n\r\n\r\n\r\n    const row1 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            marginTop: '10px',\r\n        },\r\n    });\r\n    const row2n3Wrapper = BB.el({\r\n        parent: div,\r\n        css: isSmallWidth ? {} : {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n        },\r\n    });\r\n    const row2 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginTop: '5px',\r\n        },\r\n    });\r\n    const row3 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n            marginTop: '5px',\r\n            width: isSmallWidth ? '' : '300px',\r\n        },\r\n    });\r\n\r\n    // --- row 1 ---\r\n\r\n    // color\r\n    const colorOptionsArr = [\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 255, g: 255, b: 255, a: 1},\r\n    ];\r\n    colorOptionsArr.unshift({\r\n        r: p.secondaryColor.r,\r\n        g: p.secondaryColor.g,\r\n        b: p.secondaryColor.b,\r\n        a: 1,\r\n    });\r\n    colorOptionsArr.unshift({\r\n        r: p.color.r,\r\n        g: p.color.g,\r\n        b: p.color.b,\r\n        a: 1,\r\n    });\r\n\r\n    const colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        initialIndex: 0,\r\n        onChange: (rgbaObj) => {\r\n            p.color = rgbaObj;\r\n            updatePreview();\r\n        },\r\n    });\r\n    colorOptions.getElement().title = LANG('text-color');\r\n    colorOptions.getElement().style.marginLeft = '-5px';\r\n    row1.append(colorOptions.getElement());\r\n\r\n\r\n    let zoomFac = 0;\r\n\r\n    function changeZoomFac (d: number): void {\r\n        zoomFac = Math.min(2, Math.max(-2, zoomFac + d));\r\n        updatePreview();\r\n        zoomInBtn.disabled = !canZoom(1);\r\n        zoomOutBtn.disabled = !canZoom(-1);\r\n    }\r\n\r\n    function canZoom (d: number): boolean {\r\n        return zoomFac !== Math.min(2, Math.max(-2, zoomFac + d));\r\n    }\r\n\r\n    const zoomWrapper = BB.el({\r\n        parent: row1,\r\n    });\r\n\r\n    const zoomInBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomInImg}\">`,\r\n        title: LANG('zoom-in'),\r\n        tagName: 'button',\r\n        onClick: () => changeZoomFac(1),\r\n        css: {\r\n            fontWeight: 'bold',\r\n        },\r\n    }) as HTMLButtonElement;\r\n    const zoomOutBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomOutImg}\">`,\r\n        title: LANG('zoom-out'),\r\n        tagName: 'button',\r\n        onClick: () => changeZoomFac(-1),\r\n        css: {\r\n            fontWeight: 'bold',\r\n            marginLeft: '5px',\r\n        },\r\n    }) as HTMLButtonElement;\r\n\r\n\r\n\r\n    // --- row 2 ---\r\n    const sizeInput = BB.el({\r\n        parent: row2,\r\n        tagName: 'input',\r\n        title: LANG('text-size'),\r\n        custom: {\r\n            type: 'number',\r\n            min: 1,\r\n            max: 10000,\r\n            value: p.size,\r\n        },\r\n        css: {\r\n            width: '60px',\r\n        },\r\n        onChange: () => {\r\n            sizeInput.value = '' + Math.max(1, Math.min(10000, parseInt(sizeInput.value)));\r\n            updatePreview();\r\n        },\r\n    }) as HTMLInputElement;\r\n    const sizePointerListener = new BB.PointerListener({\r\n        target: sizeInput,\r\n        onWheel: (e) => {\r\n            sizeInput.value = '' + Math.max(1, Math.min(1000, parseInt(sizeInput.value) - e.deltaY));\r\n            updatePreview();\r\n        },\r\n    });\r\n\r\n\r\n    const modeWrapper = BB.el({\r\n        css: {\r\n            fontSize: '15px',\r\n            marginLeft: '10px',\r\n        },\r\n    });\r\n\r\n    const fontSelect = new Select<TTextFont>({\r\n        isFocusable: true,\r\n        optionArr: [\r\n            ['sans-serif', 'Sans-serif'],\r\n            ['serif', 'Serif'],\r\n            ['monospace', 'Monospace'],\r\n            ['cursive', 'Cursive'],\r\n            ['fantasy', 'Fantasy'],\r\n        ],\r\n        initValue: p.font,\r\n        onChange: () => updatePreview(),\r\n    });\r\n\r\n    modeWrapper.append(fontSelect.getElement());\r\n    row2.append(modeWrapper);\r\n\r\n    const fontPointerListener = new BB.PointerListener({\r\n        target: fontSelect.getElement(),\r\n        onWheel: (e) => fontSelect.setDeltaValue(e.deltaY),\r\n    });\r\n\r\n\r\n    // --- row 3 ---\r\n\r\n    const alignRadioList = new ImageRadioList<TTextFormat>({\r\n        optionArr: [\r\n            {\r\n                id: 'left',\r\n                title: LANG('text-left'),\r\n                image: alignLeftImg,\r\n                darkInvert: true,\r\n            },\r\n            {\r\n                id: 'center',\r\n                title: LANG('text-center'),\r\n                image: alignCenterImg,\r\n                darkInvert: true,\r\n            },\r\n            {\r\n                id: 'right',\r\n                title: LANG('text-right'),\r\n                image: alignRightImg,\r\n                darkInvert: true,\r\n            },\r\n        ],\r\n        initId: p.align,\r\n        onChange: () => updatePreview(),\r\n    });\r\n    row3.append(alignRadioList.getElement());\r\n\r\n    const italicToggle = new ImageToggle({\r\n        image: typoItalicImg,\r\n        title: LANG('text-italic'),\r\n        initValue: p.isItalic,\r\n        onChange: () => updatePreview(),\r\n        darkInvert: true,\r\n    });\r\n    row3.append(italicToggle.getElement());\r\n\r\n    const boldToggle = new ImageToggle({\r\n        image: typoBoldImg,\r\n        title: LANG('text-bold'),\r\n        initValue: p.isBold,\r\n        onChange: () => updatePreview(),\r\n        darkInvert: true,\r\n    });\r\n    row3.append(boldToggle.getElement());\r\n\r\n\r\n\r\n    const opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 150,\r\n        height: 30,\r\n        min: 1 / 100,\r\n        max: 1,\r\n        value: p.opacity,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        toValue: (displayValue) => displayValue / 100,\r\n        toDisplayValue: (value) => value * 100,\r\n        onChange: () => updatePreview(),\r\n    });\r\n    row3.append(opacitySlider.getElement());\r\n\r\n\r\n\r\n    const textInput = BB.el({\r\n        parent: div,\r\n        tagName: 'textarea',\r\n        custom: {\r\n            placeholder: LANG('text-placeholder'),\r\n            'data-ignore-focus': 'true',\r\n        },\r\n        css: {\r\n            whiteSpace: 'pre',\r\n            overflow: 'auto',\r\n            width: '100%',\r\n            height: '70px',\r\n            resize: 'vertical',\r\n            marginTop: '10px',\r\n        },\r\n        onChange: () => updatePreview(),\r\n    }) as HTMLTextAreaElement;\r\n    textInput.addEventListener('input', updatePreview);\r\n    setTimeout(() => {\r\n        textInput.focus();\r\n        textInput.select();\r\n    });\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: (keyStr) => {\r\n            if (BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        },\r\n    });\r\n\r\n    // prevent mobile keyboards scrolling page\r\n    function onScroll (): void {\r\n        window.scrollTo(0, 0);\r\n    }\r\n    window.addEventListener('scroll', onScroll);\r\n\r\n\r\n    showModal({\r\n        target: document.body,\r\n        message: `<b>${LANG('text-title')}</b>`,\r\n        div: div,\r\n        buttons: ['Ok', 'Cancel'],\r\n        style: isSmallWidth ? {} : {\r\n            width: '500px',\r\n        },\r\n        callback: (val) => {\r\n            const result: TTextToolResult = {\r\n                x: p.x,\r\n                y: p.y,\r\n                textStr: textInput.value,\r\n                align: alignRadioList.getValue(),\r\n                isItalic: italicToggle.getValue(),\r\n                isBold: boldToggle.getValue(),\r\n                color: p.color,\r\n                size: Number(sizeInput.value),\r\n                font: fontSelect.getValue(),\r\n                opacity: opacitySlider.getValue(),\r\n            };\r\n\r\n            theme.removeIsDarkListener(updatePreview);\r\n            window.removeEventListener('scroll', onScroll);\r\n            textInput.removeEventListener('input', updatePreview);\r\n            BB.destroyEl(textInput);\r\n            previewPointerListener.destroy();\r\n            sizePointerListener.destroy();\r\n            fontPointerListener.destroy();\r\n            previewCanvas.removeEventListener('wheel', wheelPrevent);\r\n            BB.destroyEl(previewWrapper);\r\n            BB.destroyEl(zoomInBtn);\r\n            BB.destroyEl(zoomOutBtn);\r\n            BB.destroyEl(sizeInput);\r\n            colorOptions.destroy();\r\n            fontSelect.destroy();\r\n            keyListener.destroy();\r\n            alignRadioList.destroy();\r\n            italicToggle.destroy();\r\n            boldToggle.destroy();\r\n            opacitySlider.destroy();\r\n            theme.removeIsDarkListener(updateCheckerboard);\r\n            if (val === 'Ok') {\r\n                p.onConfirm(result);\r\n            }\r\n        },\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        ignoreBackground: true,\r\n    });\r\n\r\n    updatePreview();\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2WSh2\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"lHK8L\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3kjmQ\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"g8nvA\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"axEKL\");","import {BB} from '../../../bb/bb';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {showModal} from './base/showModal';\r\nimport {LANG} from '../../../language/language';\r\nimport {IKeyString, IRect} from '../../../bb/bb-types';\r\nimport {IKlPsd, TKlPsdError} from '../../kl-types';\r\n\r\n/**\r\n * Shows first dialog when importing an image.\r\n * Where you can crop, and select import as layer or as image.\r\n */\r\nexport function showImportImageDialog (\r\n    p: {\r\n        image: IKlPsd | {\r\n            type: 'image';\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLImageElement | HTMLCanvasElement;\r\n        };\r\n        maxSize: number;\r\n        target: HTMLElement;\r\n        callback: (\r\n            val: {\r\n                type: 'as-image' | 'as-layer';\r\n                image: HTMLImageElement | HTMLCanvasElement;\r\n            } | {\r\n                type: 'as-image-psd';\r\n                image: IKlPsd;\r\n                cropObj: IRect;\r\n            } | {\r\n                type: 'cancel';\r\n            }\r\n        ) => void;\r\n    }\r\n): void {\r\n    const rootEl = BB.el();\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n    const style: IKeyString = isSmall ? {} : { width: '500px' };\r\n\r\n    const resolutionEl = BB.el({\r\n        css: {\r\n            marginTop: '10px',\r\n            textAlign: 'center',\r\n            color: '#888',\r\n            lineHeight: '20px',\r\n        },\r\n    });\r\n\r\n    const cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 400,\r\n        canvas: p.image.canvas,\r\n        isNotCopy: true,\r\n        onChange: (width, height): void => {\r\n            if (!resolutionEl) {\r\n                return;\r\n            }\r\n            updateResolution(width, height);\r\n        },\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginLeft: '-20px',\r\n    });\r\n    cropCopy.getEl().title = LANG('crop-drag-to-crop');\r\n\r\n    rootEl.append(cropCopy.getEl(), resolutionEl);\r\n\r\n    function updateResolution (w: number, h: number): void {\r\n        const fit = BB.fitInto(w, h, p.maxSize, p.maxSize);\r\n\r\n        if (fit.width < w) {\r\n            resolutionEl.innerHTML = `<span class=\"kl-text-error\">${w} X ${h}</span>  ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\r\n            resolutionEl.title = LANG('import-too-large');\r\n        } else {\r\n            resolutionEl.innerHTML = `${w} X ${h}`;\r\n            resolutionEl.title = '';\r\n        }\r\n    }\r\n    updateResolution(p.image.width, p.image.height);\r\n\r\n\r\n    let doFlatten = false;\r\n    function showWarnings (psdWarningArr: TKlPsdError[]): void {\r\n        const contentArr = [];\r\n        const warningMap = {\r\n            'mask': 'Masks not supported. Mask was applied.',\r\n            'clipping': 'Clipping not supported. Clipping layers were merged.',\r\n            'group': 'Groups not supported. Layers were ungrouped.',\r\n            'adjustment': 'Adjustment layers not supported.',\r\n            'layer-effect': 'Layer effects not supported.',\r\n            'smart-object': 'Smart objects not supported.',\r\n            'blend-mode': 'Unsupported layer blend mode.',\r\n            'bits-per-channel': 'Unsupported color depth. Only 8bit per channel supported.',\r\n        };\r\n        for (let i = 0; i < psdWarningArr.length; i++) {\r\n            contentArr.push('- ' + warningMap[psdWarningArr[i]]);\r\n        }\r\n        alert(contentArr.join('\\n'));\r\n    }\r\n\r\n    let flattenCheckbox: Checkbox;\r\n    let warningsEl: HTMLElement | undefined;\r\n    if (p.image.type === 'psd') {\r\n        if (p.image.layers) {\r\n            flattenCheckbox = new Checkbox({\r\n                init: doFlatten,\r\n                label: LANG('import-flatten'),\r\n                callback: (b): void => {\r\n                    doFlatten = b;\r\n                },\r\n            });\r\n            rootEl.append(flattenCheckbox.getElement());\r\n\r\n            if (p.image.warningArr) {\r\n                const noteEl = BB.el({\r\n                    className: 'kl-import-note',\r\n                    content: LANG('import-psd-limited-support'),\r\n                });\r\n                const warnings = p.image.warningArr;\r\n                warningsEl = BB.el({\r\n                    parent: noteEl,\r\n                    tagName: 'a',\r\n                    content: 'Details',\r\n                    css: { marginLeft: '5px'},\r\n                    onClick: () => showWarnings(warnings),\r\n                });\r\n                rootEl.append(noteEl);\r\n            }\r\n        } else {\r\n            const noteEl = BB.el({\r\n                className: 'kl-import-note',\r\n                content: LANG('import-psd-unsupported'),\r\n            });\r\n            rootEl.append(noteEl);\r\n        }\r\n    }\r\n\r\n    function callback (result: string): void {\r\n        const croppedImage = cropCopy.getCroppedImage();\r\n        const cropRect = cropCopy.getRect();\r\n        const isCropped = p.image.width !== cropRect.width && p.image.height !== cropRect.height;\r\n        cropCopy.destroy();\r\n        BB.destroyEl(warningsEl);\r\n        if (flattenCheckbox) {\r\n            flattenCheckbox.destroy();\r\n        }\r\n\r\n        if (result === LANG('import-btn-as-layer')) {\r\n            p.callback({\r\n                type: 'as-layer',\r\n                image: isCropped ? croppedImage : p.image.canvas,\r\n            });\r\n\r\n        } else if (result === LANG('import-btn-as-image')) {\r\n            if (p.image.type === 'psd') {\r\n                if (doFlatten) {\r\n                    delete p.image.layers;\r\n                }\r\n                p.callback({\r\n                    type: 'as-image-psd',\r\n                    image: p.image,\r\n                    cropObj: cropRect,\r\n                });\r\n            } else if (p.image.type === 'image') {\r\n                p.callback({\r\n                    type: 'as-image',\r\n                    image: croppedImage,\r\n                });\r\n            }\r\n        } else {\r\n            p.callback({\r\n                type: 'cancel',\r\n            });\r\n        }\r\n    }\r\n    showModal({\r\n        target: p.target,\r\n        message: `<b>${LANG('import-title')}</b>`,\r\n        div: rootEl,\r\n        style,\r\n        buttons: [LANG('import-btn-as-layer'), LANG('import-btn-as-image'), 'Cancel'],\r\n        primaries: [LANG('import-btn-as-layer'), LANG('import-btn-as-image')],\r\n        callback,\r\n        autoFocus: 'As Image',\r\n    });\r\n}","import {createCanvas} from '../../bb/base/create-canvas';\r\nimport {BlendMode, Layer, Psd} from 'ag-psd/dist/psd';\r\nimport {IKlProject, IKlPsd, TKlPsdError, TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {MAX_LAYERS} from '../canvas/kl-canvas';\r\nimport {BB} from '../../bb/bb';\r\n\r\nlet kl2PsdMap: Record<TMixMode, BlendMode>;\r\nlet psd2KlMap: Record<BlendMode, TMixMode>;\r\n\r\nfunction init (): void {\r\n    if (kl2PsdMap) {\r\n        return;\r\n    }\r\n    kl2PsdMap = {\r\n        'source-over': 'normal',\r\n\r\n        'darken': 'darken',\r\n        'multiply': 'multiply',\r\n        'color-burn': 'color burn',\r\n\r\n        'lighten': 'lighten',\r\n        'screen': 'screen',\r\n        'color-dodge': 'color dodge',\r\n\r\n        'overlay': 'overlay',\r\n        'soft-light': 'soft light',\r\n        'hard-light': 'hard light',\r\n\r\n        'difference': 'difference',\r\n        'exclusion': 'exclusion',\r\n\r\n        'hue': 'hue',\r\n        'saturation': 'saturation',\r\n        'color': 'color',\r\n        'luminosity': 'luminosity',\r\n    };\r\n    psd2KlMap = Object.fromEntries(Object.entries(kl2PsdMap).map(a => a.reverse()));\r\n}\r\n\r\nexport function blendPsdToKl (str: BlendMode): TMixMode {\r\n    init();\r\n    return psd2KlMap[str];\r\n}\r\n\r\nexport function blendKlToPsd (str: TMixMode): BlendMode {\r\n    init();\r\n    return kl2PsdMap[str];\r\n}\r\n\r\n\r\n/**\r\n * Converts ag-psd object into something that KlCanvas can represent\r\n * @param psdObj\r\n */\r\nexport function readPsd (psdObj: Psd): IKlPsd {\r\n    if (!psdObj.canvas) {\r\n        throw new Error('psdObj.canvas undefined');\r\n    }\r\n    const result: IKlPsd = {\r\n        type: 'psd',\r\n        canvas: psdObj.canvas,\r\n        width: psdObj.width,\r\n        height: psdObj.height,\r\n    };\r\n\r\n    function addWarning (warningStr: TKlPsdError): void {\r\n        if (!result.warningArr) {\r\n            result.warningArr = [];\r\n        }\r\n        if (result.warningArr.includes(warningStr)) {\r\n            return;\r\n        }\r\n        result.warningArr.push(warningStr);\r\n    }\r\n\r\n    function getMixModeStr (blendMode: BlendMode): TMixMode {\r\n        let mixModeStr: TMixMode = blendPsdToKl(blendMode);\r\n        if (!mixModeStr) {\r\n            addWarning('blend-mode');\r\n            mixModeStr = 'source-over';\r\n        }\r\n        return mixModeStr;\r\n    }\r\n\r\n    if (psdObj.bitsPerChannel !== 8) {\r\n        addWarning('bits-per-channel');\r\n    }\r\n\r\n    if (!psdObj.children) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    // count resulting layers\r\n    const maxLayers = MAX_LAYERS;\r\n    let layerCount = 0;\r\n    function countWithinGroup (groupObj: Layer): number {\r\n        let result = 0;\r\n        if (groupObj.blendMode) {\r\n            const mixModeStr = blendPsdToKl(groupObj.blendMode);\r\n            if (mixModeStr && mixModeStr !== 'source-over') {\r\n                return 1;\r\n            }\r\n        }\r\n        if (groupObj.children) {\r\n            for (let i = 0; i < groupObj.children.length; i++) {\r\n                const item = groupObj.children[i];\r\n                if (item.clipping || item.adjustment) {\r\n                    continue;\r\n                }\r\n\r\n                if (item.children) {\r\n                    addWarning('group');\r\n                    result += countWithinGroup(item);\r\n                } else {\r\n                    result++;\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    layerCount += countWithinGroup(psdObj);\r\n    if (layerCount > maxLayers) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    result.layers = [];\r\n\r\n    function prepareMask (maskCanvas: HTMLCanvasElement, defaultColor: number): void {\r\n        const groupMaskCtx = BB.ctx(maskCanvas);\r\n        const imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n        if (defaultColor === 0) {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = imData.data[i];\r\n            }\r\n        } else {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = 255 - imData.data[i];\r\n            }\r\n        }\r\n        groupMaskCtx.putImageData(imData, 0, 0);\r\n    }\r\n\r\n    function convertGroup (psdGroupObj: Layer): {\r\n        name: string;\r\n        mixModeStr: TMixMode;\r\n        opacity: number;\r\n        image: HTMLCanvasElement;\r\n    }[] {\r\n\r\n        let resultArr: {\r\n            name: string;\r\n            mixModeStr: TMixMode;\r\n            opacity: number;\r\n            image: HTMLCanvasElement;\r\n        }[] = [];\r\n        const groupOpacity = psdGroupObj.hidden ? 0 : psdGroupObj.opacity;\r\n        const groupMixModeStr = getMixModeStr(psdGroupObj.blendMode!);\r\n        let groupCanvas;\r\n        let groupCtx;\r\n        if (groupMixModeStr !== 'source-over') {\r\n            groupCanvas = createCanvas(result.width, result.height);\r\n            groupCtx = BB.ctx(groupCanvas);\r\n        }\r\n\r\n        // prepare group mask\r\n        if (psdGroupObj.mask) {\r\n            addWarning('mask');\r\n            prepareMask(psdGroupObj.mask.canvas!, psdGroupObj.mask.defaultColor!);\r\n        }\r\n\r\n        if (psdGroupObj.children) {\r\n            for (let i = 0; i < psdGroupObj.children.length; i++) {\r\n                const item = psdGroupObj.children[i];\r\n                if (item.clipping) {\r\n                    continue;\r\n                }\r\n                if (item.adjustment) {\r\n                    addWarning('adjustment');\r\n                    continue;\r\n                }\r\n\r\n                const hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\r\n                if (hasClipping) {\r\n                    addWarning('clipping');\r\n                }\r\n\r\n                if (item.children) {\r\n                    const innerArr = convertGroup(item);\r\n\r\n                    for (let e = 0; e < innerArr.length; e++) {\r\n                        const innerItem = innerArr[e];\r\n                        const innerCtx = BB.ctx(innerItem.image);\r\n\r\n                        // clipping\r\n                        if (hasClipping) {\r\n                            const clippingCanvas = createCanvas(result.width, result.height);\r\n                            const clippingCtx = BB.ctx(clippingCanvas);\r\n                            clippingCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                            for (let f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++) {\r\n                                const clippingItem = psdGroupObj.children[f];\r\n                                if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                                    continue;\r\n                                }\r\n                                if (clippingItem.blendMode === undefined) {\r\n                                    throw new Error('clippingItem.blendMode undefined');\r\n                                }\r\n                                if (clippingItem.opacity === undefined) {\r\n                                    throw new Error('clippingItem.opacity undefined');\r\n                                }\r\n                                if (clippingItem.canvas === undefined) {\r\n                                    throw new Error('clippingItem.canvas undefined');\r\n                                }\r\n                                if (clippingItem.left === undefined) {\r\n                                    throw new Error('clippingItem.left undefined');\r\n                                }\r\n                                if (clippingItem.top === undefined) {\r\n                                    throw new Error('clippingItem.top undefined');\r\n                                }\r\n                                clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                                clippingCtx.globalAlpha = clippingItem.opacity;\r\n                                clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\r\n                            }\r\n\r\n                            innerCtx.globalCompositeOperation = 'source-atop';\r\n                            innerCtx.drawImage(clippingCanvas, 0, 0);\r\n                        }\r\n\r\n\r\n\r\n                        // group mask\r\n                        if (psdGroupObj.mask) {\r\n                            innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                            if (psdGroupObj.mask.canvas === undefined) {\r\n                                throw new Error('psdGroupObj.mask.canvas undefined');\r\n                            }\r\n                            if (psdGroupObj.mask.left === undefined) {\r\n                                throw new Error('psdGroupObj.mask.left undefined');\r\n                            }\r\n                            if (psdGroupObj.mask.top === undefined) {\r\n                                throw new Error('psdGroupObj.mask.top undefined');\r\n                            }\r\n                            innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n                        }\r\n\r\n                        if (groupCanvas) {\r\n                            if (groupCtx === undefined) {\r\n                                throw new Error('groupCtx undefined');\r\n                            }\r\n                            groupCtx.globalCompositeOperation = innerItem.mixModeStr;\r\n                            groupCtx.globalAlpha = innerItem.opacity;\r\n                            groupCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                        } else {\r\n                            if (groupOpacity === undefined) {\r\n                                throw new Error('groupOpacity undefined');\r\n                            }\r\n                            innerItem.opacity = innerItem.opacity * groupOpacity;\r\n                            resultArr.push(innerItem);\r\n                        }\r\n                    }\r\n\r\n                    continue;\r\n                }\r\n\r\n                const canvas = createCanvas(result.width, result.height);\r\n                const ctx = BB.ctx(canvas);\r\n                if (item.canvas) { // if a layer is empty it has no canvas\r\n                    if (item.top === undefined) {\r\n                        throw new Error('item.top undefined');\r\n                    }\r\n                    if (item.left === undefined) {\r\n                        throw new Error('item.left undefined');\r\n                    }\r\n                    ctx.drawImage(item.canvas, item.left, item.top);\r\n                }\r\n\r\n                // effects\r\n                if (item.effects) {\r\n                    addWarning('layer-effect');\r\n                }\r\n\r\n                // mask\r\n                if (item.mask) {\r\n                    addWarning('mask');\r\n                    if (item.mask.canvas === undefined) {\r\n                        throw new Error('item.mask.canvas undefined');\r\n                    }\r\n                    if (item.mask.defaultColor === undefined) {\r\n                        throw new Error('item.mask.defaultColor undefined');\r\n                    }\r\n                    if (item.mask.left === undefined) {\r\n                        throw new Error('item.mask.left undefined');\r\n                    }\r\n                    if (item.mask.top === undefined) {\r\n                        throw new Error('item.mask.top undefined');\r\n                    }\r\n                    prepareMask(item.mask.canvas, item.mask.defaultColor);\r\n\r\n                    ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                    ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\r\n                }\r\n\r\n                // clipping\r\n                if (hasClipping) {\r\n                    if (item.right === undefined) {\r\n                        throw new Error('item.right undefined');\r\n                    }\r\n                    if (item.left === undefined) {\r\n                        throw new Error('item.left undefined');\r\n                    }\r\n                    if (item.bottom === undefined) {\r\n                        throw new Error('item.bottom undefined');\r\n                    }\r\n                    if (item.top === undefined) {\r\n                        throw new Error('item.top undefined');\r\n                    }\r\n                    if (item.canvas === undefined) {\r\n                        throw new Error('item.canvas undefined');\r\n                    }\r\n                    const clippingCanvas = createCanvas(item.right - item.left, item.bottom - item.top);\r\n                    const clippingCtx = BB.ctx(clippingCanvas);\r\n                    clippingCtx.drawImage(item.canvas, 0, 0);\r\n\r\n                    for (let e = i + 1; e < psdGroupObj.children.length && psdGroupObj.children[e].clipping; e++) {\r\n                        const clippingItem = psdGroupObj.children[e];\r\n                        if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                            continue;\r\n                        }\r\n                        if (clippingItem.blendMode === undefined) {\r\n                            throw new Error('clippingItem.blendMode undefined');\r\n                        }\r\n                        if (clippingItem.opacity === undefined) {\r\n                            throw new Error('clippingItem.opacity undefined');\r\n                        }\r\n                        if (clippingItem.canvas === undefined) {\r\n                            throw new Error('clippingItem.canvas undefined');\r\n                        }\r\n                        if (clippingItem.left === undefined) {\r\n                            throw new Error('clippingItem.left undefined');\r\n                        }\r\n                        if (clippingItem.top === undefined) {\r\n                            throw new Error('clippingItem.top undefined');\r\n                        }\r\n                        clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                        clippingCtx.globalAlpha = clippingItem.opacity;\r\n                        clippingCtx.drawImage(clippingItem.canvas, clippingItem.left - item.left, clippingItem.top - item.top);\r\n                    }\r\n\r\n                    ctx.globalCompositeOperation = 'source-atop';\r\n                    ctx.drawImage(clippingCanvas, item.left, item.top);\r\n                }\r\n\r\n                // group mask\r\n                if (psdGroupObj.mask) {\r\n                    ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                    if (psdGroupObj.mask.canvas === undefined) {\r\n                        throw new Error('psdGroupObj.mask.canvas undefined');\r\n                    }\r\n                    if (psdGroupObj.mask.left === undefined) {\r\n                        throw new Error('psdGroupObj.mask.left undefined');\r\n                    }\r\n                    if (psdGroupObj.mask.top === undefined) {\r\n                        throw new Error('psdGroupObj.mask.top undefined');\r\n                    }\r\n                    ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n                }\r\n\r\n                if (groupOpacity === undefined) {\r\n                    throw new Error('groupOpacity undefined');\r\n                }\r\n                if (item.blendMode === undefined) {\r\n                    throw new Error('item.blendMode undefined');\r\n                }\r\n                if (item.hidden  === undefined) {\r\n                    throw new Error('item.hidden  undefined');\r\n                }\r\n                if (item.opacity === undefined) {\r\n                    throw new Error('item.opacity undefined');\r\n                }\r\n\r\n                if (groupCanvas && groupCtx) {\r\n                    if (groupOpacity > 0) {\r\n                        groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\r\n                        groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\r\n                        groupCtx.drawImage(canvas, 0, 0);\r\n                    }\r\n\r\n                } else {\r\n                    if (item.name === undefined) {\r\n                        throw new Error('item.name undefined');\r\n                    }\r\n                    resultArr.push({\r\n                        name: item.name,\r\n                        opacity: (item.hidden ? 0 : item.opacity) * groupOpacity,\r\n                        mixModeStr: getMixModeStr(item.blendMode),\r\n                        image: canvas,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        if (groupCanvas) {\r\n            if (psdGroupObj.name === undefined) {\r\n                throw new Error('psdGroupObj.name undefined');\r\n            }\r\n            if (groupOpacity === undefined) {\r\n                throw new Error('groupOpacity undefined');\r\n            }\r\n            resultArr = [\r\n                {\r\n                    name: psdGroupObj.name,\r\n                    opacity: groupOpacity,\r\n                    mixModeStr: groupMixModeStr,\r\n                    image: groupCanvas,\r\n                },\r\n            ];\r\n        }\r\n\r\n        return resultArr;\r\n    }\r\n\r\n    result.layers = convertGroup({\r\n        name: 'root',\r\n        opacity: 1,\r\n        blendMode: 'normal',\r\n        children: psdObj.children,\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\nexport function klPsdToKlProject (klPsd: IKlPsd): IKlProject {\r\n    // only share references to Canvas elements\r\n    const result: IKlProject = {\r\n        width: klPsd.width,\r\n        height: klPsd.height,\r\n        layers: [],\r\n    };\r\n    if (klPsd.layers) {\r\n        result.layers = klPsd.layers.map(item => {\r\n            return {\r\n                name: item.name,\r\n                opacity: item.opacity,\r\n                mixModeStr: item.mixModeStr,\r\n                image: item.image,\r\n            };\r\n        });\r\n    } else {\r\n        // flattened\r\n        result.layers = [{\r\n            name: LANG('background'),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over',\r\n            image: klPsd.canvas,\r\n        }];\r\n    }\r\n    return result;\r\n}","import {IKlStorageProject} from '../kl-types';\r\n\r\nconst indexedDbIsSupported = !!window.indexedDB;\r\nlet dbNameStr = 'Klecks';\r\nconst storageNameStr = 'ProjectStore';\r\n\r\nexport function setDbName (name: string): void {\r\n    dbNameStr = '' + name;\r\n}\r\n\r\n/**\r\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\r\n * with index 'id'\r\n *\r\n * @param actionFunction what to execute during transaction\r\n * @param successCallback on successful transaction\r\n * @param errorCallback on error\r\n */\r\nfunction execIndexedDBTransaction (\r\n    actionFunction: (storeObj: IDBObjectStore) => void,\r\n    successCallback: () => void,\r\n    errorCallback: (errorStr: string) => void,\r\n): void {\r\n\r\n    let hasFinished = false;\r\n\r\n    function onSuccess (): void {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        successCallback();\r\n    }\r\n\r\n    function onError (errorStr: string): void {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        errorCallback(errorStr);\r\n    }\r\n\r\n    if (!indexedDbIsSupported) {\r\n        setTimeout(function () {\r\n            onError('no indexed db available');\r\n        }, 0);\r\n        return;\r\n    }\r\n    let requestObj: IDBOpenDBRequest;\r\n\r\n    try {\r\n        requestObj = window.indexedDB.open(dbNameStr, 1);\r\n    } catch (e) {\r\n        onError(e.message);\r\n        return;\r\n    }\r\n\r\n    requestObj.onupgradeneeded = function (): void {\r\n        try {\r\n            const db: IDBDatabase = requestObj.result;\r\n            const store = db.createObjectStore(storageNameStr, {keyPath: 'id'});\r\n            store.createIndex('id', 'id', {unique: true});\r\n        } catch (e) {\r\n            onError(e.message);\r\n        }\r\n    };\r\n    requestObj.onerror = function (): void {\r\n        onError('indexedDB.open failed, ' + requestObj.error);\r\n    };\r\n    requestObj.onsuccess = function (): void {\r\n        let databaseObj: IDBDatabase;\r\n        let transactionObj: IDBTransaction;\r\n        let storeObj: IDBObjectStore;\r\n\r\n        try {\r\n            databaseObj = requestObj.result;\r\n            if (!databaseObj.objectStoreNames.contains(storageNameStr)) {\r\n                //someone maybe messed with the db, or creation failed earlier\r\n                //it's broken -> destroy\r\n                window.indexedDB.deleteDatabase(dbNameStr);\r\n                onError('object store ' + storageNameStr + ' missing. destroying db');\r\n                return;\r\n            }\r\n            transactionObj = databaseObj.transaction(storageNameStr, 'readwrite');\r\n            storeObj = transactionObj.objectStore(storageNameStr);\r\n            storeObj.index('id');\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        databaseObj.onerror = function (e): void {\r\n            onError('database error, ' + databaseObj.error);\r\n        };\r\n\r\n        try {\r\n            actionFunction(storeObj);\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        transactionObj.oncomplete = function (): void {\r\n            onSuccess();\r\n            databaseObj.close();\r\n        };\r\n        transactionObj.onerror = function (): void {\r\n            onError('transaction error, ' + transactionObj.error);\r\n        };\r\n    };\r\n}\r\n\r\nexport function getKlProjectObj (\r\n    successCallback: (result: undefined | IKlStorageProject) => void,\r\n    errorCallback: (error: string) => void,\r\n): void {\r\n    if (indexedDbIsSupported) {\r\n        let query: IDBRequest<undefined | IKlStorageProject>;\r\n        execIndexedDBTransaction(function (storeObj) {\r\n            query = storeObj.get(1);\r\n        }, function () {\r\n            successCallback(query.result);\r\n        }, function (errorStr) {\r\n            errorCallback('execIndexedDBTransaction error, ' + errorStr);\r\n        });\r\n    } else {\r\n        successCallback(undefined);\r\n    }\r\n}\r\n\r\n/**\r\n * stores a project into id = 1 in database:dbNameStr > storage: storageNameStr\r\n */\r\nexport function storeKlProjectObj (\r\n    storageProject: IKlStorageProject,\r\n    successCallback: () => void,\r\n    errorCallback: (error: string) => void,\r\n): void {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.put(storageProject);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (errorStr) {\r\n        errorCallback(errorStr);\r\n    });\r\n\r\n}\r\n\r\n/**\r\n * deletes stored project, by removing id = 1 from database:dbNameStr > storage: storageNameStr\r\n */\r\nexport function clear (\r\n    successCallback: () => void,\r\n    errorCallback: (error: string) => void,\r\n): void {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.delete(1);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (error) {\r\n        errorCallback(error);\r\n    });\r\n\r\n}\r\n","import {IFilter} from '../kl-types';\r\nimport glBrightnessContrastImg from '/src/app/img/ui/edit-brightness-contrast.svg';\r\nimport cropExtendImg from '/src/app/img/ui/edit-crop.svg';\r\nimport glCurvesImg from '/src/app/img/ui/edit-curves.svg';\r\nimport flipImg from '/src/app/img/ui/edit-flip.svg';\r\nimport glHueSaturationImg from '/src/app/img/ui/edit-hue-saturation.svg';\r\nimport invertImg from '/src/app/img/ui/edit-invert.png';\r\nimport glPerspectiveImg from '/src/app/img/ui/edit-perspective.svg';\r\nimport resizeImg from '/src/app/img/ui/edit-resize.svg';\r\nimport rotateImg from '/src/app/img/ui/edit-rotate.svg';\r\nimport glTiltShiftImg from '/src/app/img/ui/edit-tilt-shift.png';\r\nimport toAlphaImg from '/src/app/img/ui/edit-to-alpha.svg';\r\nimport transformImg from '/src/app/img/ui/edit-transform.svg';\r\nimport glBlurImg from '/src/app/img/ui/edit-triangle-blur.png';\r\nimport glUnsharpMaskImg from '/src/app/img/ui/edit-unsharp-mask.png';\r\nimport gridImg from '/src/app/img/ui/edit-grid.svg';\r\nimport noiseImg from '/src/app/img/ui/edit-noise.svg';\r\nimport patternImg from '/src/app/img/ui/edit-pattern.svg';\r\nimport vanishPointImg from '/src/app/img/ui/edit-vanish-point.svg';\r\nimport distortImg from '/src/app/img/ui/edit-distort.svg';\r\nimport {THistoryEntryG} from '../history/kl-history';\r\n\r\nexport type TFilterHistoryEntry<Filter extends string, Input> = THistoryEntryG<['filter', Filter], 'apply', [{ input: Input }]>;\r\n\r\nexport const filterLibStatus = {\r\n    isLoaded: false,\r\n};\r\nexport const filterLib: {\r\n    [key:string]: IFilter;\r\n} = {\r\n    brightnessContrast: {\r\n        lang: {name: 'filter-bright-contrast-title', button: 'filter-bright-contrast'},\r\n        icon: glBrightnessContrastImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    cropExtend: {\r\n        lang: {name: 'filter-crop-title', button: 'filter-crop-extend'},\r\n        icon: cropExtendImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    curves: {\r\n        lang: {name: 'filter-curves-title', button: 'filter-curves'},\r\n        icon: glCurvesImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    distort: {\r\n        lang: {name: 'filter-distort', button: 'filter-distort'},\r\n        icon: distortImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    flip: {\r\n        lang: {name: 'filter-flip-title', button: 'filter-flip'},\r\n        icon: flipImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    hueSaturation: {\r\n        lang: {name: 'filter-hue-sat-title', button: 'filter-hue-sat'},\r\n        icon: glHueSaturationImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n    },\r\n    invert: {\r\n        lang: {name: 'filter-invert', button: 'filter-invert'},\r\n        icon: invertImg,\r\n        updatePos: false,\r\n        isInstant: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n    },\r\n    perspective: {\r\n        lang: {name: 'filter-perspective-title', button: 'filter-perspective'},\r\n        icon: glPerspectiveImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    resize: {\r\n        lang: {name: 'filter-resize-title', button: 'filter-resize'},\r\n        icon: resizeImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    rotate: {\r\n        lang: {name: 'filter-rotate-title', button: 'filter-rotate'},\r\n        icon: rotateImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    tiltShift: {\r\n        lang: {name: 'filter-tilt-shift-title', button: 'filter-tilt-shift'},\r\n        icon: glTiltShiftImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    toAlpha: {\r\n        lang: {name: 'filter-to-alpha-title', button: 'filter-to-alpha'},\r\n        icon: toAlphaImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n    },\r\n    transform: {\r\n        lang: {name: 'filter-transform-title', button: 'filter-transform'},\r\n        icon: transformImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    blur: {\r\n        lang: {name: 'filter-triangle-blur-title', button: 'filter-triangle-blur'},\r\n        icon: glBlurImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n    },\r\n    unsharpMask: {\r\n        lang: {name: 'filter-unsharp-mask-title', button: 'filter-unsharp-mask'},\r\n        icon: glUnsharpMaskImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n    },\r\n    grid: {\r\n        lang: {name: 'filter-grid', button: 'filter-grid'},\r\n        icon: gridImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    noise: {\r\n        lang: {name: 'filter-noise', button: 'filter-noise'},\r\n        icon: noiseImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    pattern: {\r\n        lang: {name: 'filter-pattern', button: 'filter-pattern'},\r\n        icon: patternImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    vanishPoint: {\r\n        lang: {name: 'filter-vanish-point-title', button: 'filter-vanish-point'},\r\n        icon: vanishPointImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n};\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7tOPd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fduLu\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ijSd4\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3lCpH\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hhylW\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kV0ed\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dNk9L\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"aj5Gc\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6D2tK\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7nesm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"leHUT\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3lP2j\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7G4sY\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7n1Rt\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ijwf0\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"18gIG\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"786LQ\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kcnOE\");","import {PenBrush} from './pen-brush';\r\nimport {BlendBrush} from './blend-brush';\r\nimport {SketchyBrush} from './sketchy-brush';\r\nimport {PixelBrush} from './pixel-brush';\r\nimport {EraserBrush} from './eraser-brush';\r\nimport {SmudgeBrush} from './smudge-brush';\r\nimport {ChemyBrush} from './chemy-brush';\r\n\r\nexport const brushes = {\r\n    PenBrush,\r\n    BlendBrush,\r\n    SketchyBrush,\r\n    PixelBrush,\r\n    ChemyBrush,\r\n    SmudgeBrush,\r\n    EraserBrush,\r\n};","import {BB} from '../../bb/bb';\r\nimport {alphaImArr} from './brushes-common';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB, TPressureInput} from '../kl-types';\r\nimport {BezierLine} from '../../bb/math/line';\r\n\r\nexport interface IPenBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'PenBrush'];\r\n    actions: THistoryInnerActions<PenBrush>[];\r\n}\r\n\r\nconst ALPHA_CIRCLE = 0;\r\nconst ALPHA_CHALK = 1;\r\nconst ALPHA_CAL = 2; // calligraphy\r\nconst ALPHA_SQUARE = 3;\r\n\r\nconst TWO_PI = 2 * Math.PI;\r\n\r\nexport class PenBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IPenBrushHistoryEntry | undefined;\r\n\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingHasSizePressure: boolean = true;\r\n    private settingSize: number = 2;\r\n    private settingSpacing: number = 0.8489;\r\n    private settingOpacity: number = 1;\r\n    private settingColor: IRGB;\r\n    private settingColorStr: string;\r\n    private settingAlphaId: number = ALPHA_CIRCLE;\r\n    private settingLockLayerAlpha: boolean = false;\r\n\r\n    private hasDrawnDot: boolean = false;\r\n    private lineToolLastDot: number;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private inputArr: TPressureInput[];\r\n    private inputIsDrawing: boolean = false;\r\n    private bezierLine: BezierLine | null = null;\r\n\r\n    // mipmapping\r\n    private readonly alphaCanvas128: HTMLCanvasElement = BB.canvas(128, 128);\r\n    private readonly alphaCanvas64: HTMLCanvasElement = BB.canvas(64, 64);\r\n    private readonly alphaCanvas32: HTMLCanvasElement = BB.canvas(32, 32);\r\n    private readonly alphaOpacityArr: number[] = [1, 0.9, 1, 1];\r\n\r\n\r\n    private updateAlphaCanvas () {\r\n        if (this.settingAlphaId === ALPHA_CIRCLE || this.settingAlphaId === ALPHA_SQUARE) {\r\n            return;\r\n        }\r\n\r\n        const instructionArr: [HTMLCanvasElement, number][] = [\r\n            [this.alphaCanvas128, 128],\r\n            [this.alphaCanvas64, 64],\r\n            [this.alphaCanvas32, 32],\r\n        ];\r\n\r\n        let ctx;\r\n\r\n        for (let i = 0; i < instructionArr.length; i++) {\r\n            ctx = BB.ctx((instructionArr[i][0] as any));\r\n\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.fillStyle = 'rgba(' + this.settingColor.r\r\n                + ', ' + this.settingColor.g\r\n                + ', ' + this.settingColor.b\r\n                + ', ' + this.alphaOpacityArr[this.settingAlphaId] + ')';\r\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.globalCompositeOperation = 'destination-in';\r\n            ctx.imageSmoothingQuality = 'high';\r\n            ctx.drawImage(alphaImArr[this.settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.restore();\r\n        }\r\n    }\r\n\r\n    private calcOpacity (pressure: number): number {\r\n        return this.settingOpacity * (this.settingHasOpacityPressure ? pressure * pressure : 1);\r\n    }\r\n\r\n    /**\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     * @param angle\r\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\r\n     */\r\n    private drawDot (\r\n        x: number,\r\n        y:number,\r\n        size: number,\r\n        opacity: number,\r\n        angle?: number,\r\n        before?: [number, number, number, number, (number | undefined)]\r\n    ): void {\r\n        if (size <= 0) {\r\n            return;\r\n        }\r\n\r\n        if (this.settingLockLayerAlpha) {\r\n            this.context.globalCompositeOperation = 'source-atop';\r\n        }\r\n\r\n        if (!before || before[3] !== opacity) {\r\n            this.context.globalAlpha = opacity;\r\n        }\r\n\r\n        if (!before && (this.settingAlphaId === ALPHA_CIRCLE || this.settingAlphaId === ALPHA_SQUARE)) {\r\n            this.context.fillStyle = this.settingColorStr;\r\n        }\r\n\r\n        if (this.settingAlphaId === ALPHA_CIRCLE) {\r\n            this.context.beginPath();\r\n            this.context.arc(x, y, size, 0, TWO_PI);\r\n            this.context.closePath();\r\n            this.context.fill();\r\n            this.hasDrawnDot = true;\r\n\r\n        } else if (this.settingAlphaId === ALPHA_SQUARE) {\r\n            if (angle !== undefined) {\r\n                this.context.save();\r\n                this.context.translate(x, y);\r\n                this.context.rotate(angle / 180 * Math.PI);\r\n                this.context.fillRect(-size, -size, size * 2, size * 2);\r\n                this.context.restore();\r\n                this.hasDrawnDot = true;\r\n            }\r\n\r\n        } else { // other brush alphas\r\n            this.context.save();\r\n            this.context.translate(x, y);\r\n            let targetMipmap = this.alphaCanvas128;\r\n            if (size <= 32 && size > 16) {\r\n                targetMipmap = this.alphaCanvas64;\r\n            } else if (size <= 16) {\r\n                targetMipmap = this.alphaCanvas32;\r\n            }\r\n            this.context.scale(size, size);\r\n            if (this.settingAlphaId === ALPHA_CHALK) {\r\n                this.context.rotate(((x + y) * 53123) % TWO_PI); // without mod it sometimes looks different\r\n            }\r\n            this.context.drawImage(targetMipmap, -1, -1, 2, 2);\r\n\r\n            this.context.restore();\r\n            this.hasDrawnDot = true;\r\n        }\r\n    }\r\n\r\n    // continueLine\r\n    private continueLine (\r\n        x: number | null,\r\n        y: number | null,\r\n        size: number,\r\n        pressure: number,\r\n    ): void {\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, () => {});\r\n        }\r\n\r\n        const drawArr: [number, number, number, number, (number | undefined)][] = []; //draw instructions. will be all drawn at once\r\n\r\n        const dotCallback = (val: {\r\n            x: number;\r\n            y: number;\r\n            t: number;\r\n            angle?: number;\r\n            dAngle: number;\r\n        }): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.calcOpacity(localPressure);\r\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        };\r\n\r\n        const localSpacing = size * this.settingSpacing;\r\n        if (x === null || y === null) {\r\n            this.bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        this.context.save();\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            const item = drawArr[i];\r\n            this.drawDot(item[0], item[1], item[2], item[3], item[4], before);\r\n            before = item;\r\n        }\r\n        this.context.restore();\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor () {}\r\n\r\n    // ---- interface ----\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'PenBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setAlpha',\r\n                    params: [this.settingAlphaId],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n            ],\r\n        };\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        const localOpacity = this.calcOpacity(p);\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.hasDrawnDot = false;\r\n\r\n        this.inputIsDrawing = true;\r\n        this.context.save();\r\n        this.drawDot(x, y, localSize, localOpacity);\r\n        this.context.restore();\r\n\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2.pressure = p;\r\n\r\n        this.inputArr = [{\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        }];\r\n\r\n        this.historyEntry.actions!.push({\r\n            action: 'startLine',\r\n            params: [x, y, p],\r\n        });\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.inputIsDrawing) {\r\n            return;\r\n        }\r\n        this.historyEntry!.actions!.push({\r\n            action: 'goLine',\r\n            params: [x, y, p],\r\n        });\r\n\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.context.save();\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n        /*context.fillStyle = 'red';\r\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\r\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/\r\n\r\n        this.context.restore();\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput2.pressure = this.lastInput.pressure;\r\n        this.lastInput.pressure = pressure;\r\n\r\n        this.inputArr.push({\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        });\r\n    }\r\n\r\n    endLine (x: number, y: number): void {\r\n\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.context.save();\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n        this.context.restore();\r\n\r\n        this.inputIsDrawing = false;\r\n\r\n        if (this.settingAlphaId === ALPHA_SQUARE && !this.hasDrawnDot) {\r\n            // find max pressure input, use that one\r\n            let maxInput = this.inputArr[0];\r\n            this.inputArr.forEach(item => {\r\n                if (item.pressure > maxInput.pressure) {\r\n                    maxInput = item;\r\n                }\r\n            });\r\n\r\n            this.context.save();\r\n            const p = BB.clamp(maxInput.pressure, 0, 1);\r\n            const localOpacity = this.calcOpacity(p);\r\n            this.drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\r\n            this.context.restore();\r\n        }\r\n\r\n        this.bezierLine = null;\r\n\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions!.push({\r\n                action: 'endLine',\r\n                params: [x, y],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n\r\n        this.hasDrawnDot = false;\r\n        this.inputArr = [];\r\n    }\r\n\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n        this.lastInput.pressure = 1;\r\n\r\n        if (this.inputIsDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        const bdist = this.settingSize * this.settingSpacing;\r\n        this.lineToolLastDot = this.settingSize * this.settingSpacing;\r\n        this.context.save();\r\n        for (loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity, angle);\r\n        }\r\n        this.context.restore();\r\n\r\n\r\n        const historyEntry: IPenBrushHistoryEntry = {\r\n            tool: ['brush', 'PenBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setAlpha',\r\n                    params: [this.settingAlphaId],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n    //IS\r\n    isDrawing (): boolean {\r\n        return this.inputIsDrawing;\r\n    }\r\n\r\n    //SET\r\n    setAlpha (a: number): void {\r\n        if (this.settingAlphaId === a) {\r\n            return;\r\n        }\r\n        this.settingAlphaId = a;\r\n        this.updateAlphaCanvas();\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor === c) {\r\n            return;\r\n        }\r\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\r\n        this.settingColorStr = 'rgb(' + this.settingColor.r + ',' + this.settingColor.g + ',' + this.settingColor.b + ')';\r\n        this.updateAlphaCanvas();\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSize (s: number, b?: string): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = b;\r\n    }\r\n\r\n    //GET\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n}\r\n\r\n","import {genBrushAlpha01, genBrushAlpha02} from './alphas/brush-alphas';\r\n\r\nexport const alphaImArr = []; //used by default brush\r\nalphaImArr[1] = genBrushAlpha01(128);\r\nalphaImArr[2] = genBrushAlpha02(128);","import {BB} from '../../../bb/bb';\r\nimport {noise} from '../../../bb/math/perlin';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\n\r\n// chalk\r\nexport function genBrushAlpha01 (w: number): HTMLCanvasElement {\r\n\r\n    const scaleFac = w / 500;\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    const ctx = BB.ctx(canvas);\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            const i = (y * w + x) * 4;\r\n\r\n            // base noise\r\n            const sFac2 = scaleFac + noise.simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\r\n            let noisePattern = 100 + (noise.simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\r\n            noisePattern -= (noise.simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\r\n\r\n            // fade out in circular shape\r\n            const centerDist = BB.dist(w / 2, h / 2, x, y);\r\n            const falloff = BB.clamp(\r\n                1 - ((centerDist - (w / 2.5)) / (w / 14) + noise.simplex2(x / 22 / sFac2, y / 22 / sFac2)),\r\n                0,\r\n                1);\r\n            noisePattern = noisePattern * falloff;\r\n\r\n            // make the middle darker\r\n            const falloff2 = BB.clamp(1 - centerDist / w, 0, 1) * 2;\r\n            noisePattern = noisePattern * falloff2;\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = BB.clamp(noisePattern, 0, 255);\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}\r\n\r\n// https://www.shadertoy.com/view/3tdSDj\r\nfunction udSegment ( p: IVector2D, a: IVector2D, b: IVector2D ) {\r\n    const ba = BB.Vec2.sub(b, a);\r\n    const pa = BB.Vec2.sub(p, a);\r\n    const h = BB.clamp( BB.Vec2.dot(pa,ba) / BB.Vec2.dot(ba,ba), 0.0, 1.0 );\r\n    return BB.Vec2.len(BB.Vec2.sub(pa, BB.Vec2.mul(ba, h)));\r\n}\r\n\r\n// calligraphy\r\nexport function genBrushAlpha02 (w: number): HTMLCanvasElement {\r\n\r\n    const pDist = 1 / 4;\r\n    let centerSize = 2 / 3;\r\n    let transitionSize = 1 / 3;\r\n    centerSize *= pDist;\r\n    transitionSize *= pDist;\r\n    const p1 = {x: pDist * w, y: w - (w * pDist)};\r\n    const p2 = {x: w - (w * pDist), y: pDist * w};\r\n\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    const ctx = BB.ctx(canvas);\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            const i = (y * w + x) * 4;\r\n\r\n            let col = udSegment({x: x, y: y}, p1, p2);\r\n\r\n            col = BB.clamp(\r\n                255 - ((col - (w * centerSize)) / (w * transitionSize) * 255),\r\n                0,\r\n                255\r\n            );\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = col;\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}","/*\r\n * A speed-improved perlin and simplex noise algorithms for 2D.\r\n *\r\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\n * Better rank ordering method by Stefan Gustavson in 2012.\r\n * Converted to Javascript by Joseph Gentle.\r\n *\r\n * Version 2012-03-09\r\n *\r\n * This code was placed in the public domain by its original author,\r\n * Stefan Gustavson. You may use it as you see fit, but\r\n * attribution is appreciated.\r\n *\r\n */\r\n\r\nconst myModule = {} as any;\r\n\r\nclass Grad {\r\n    constructor (public x: number, public y: number, public z:number) {}\r\n\r\n    dot2 (x: number, y: number): number {\r\n        return this.x*x + this.y*y;\r\n    }\r\n}\r\n/*\r\nGrad.prototype.dot3 = function(x, y, z) {\r\n    return this.x*x + this.y*y + this.z*z;\r\n};*/\r\n\r\nconst grad3 = [new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),\r\n    new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),\r\n    new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];\r\n\r\nconst p = [151,160,137,91,90,15,\r\n    131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,\r\n    190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,\r\n    88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,\r\n    77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,\r\n    102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,\r\n    135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,\r\n    5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,\r\n    223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,\r\n    129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,\r\n    251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,\r\n    49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,\r\n    138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\r\n// To remove the need for index wrapping, double the permutation table length\r\nconst perm = new Array(512);\r\nconst gradP = new Array(512);\r\n\r\n// This isn't a very good seeding function, but it works ok. It supports 2^16\r\n// different seed values. Write something better if you need more seeds.\r\nmyModule.seed = function (seed: number): void {\r\n    if (seed > 0 && seed < 1) {\r\n        // Scale the seed out\r\n        seed *= 65536;\r\n    }\r\n\r\n    seed = Math.floor(seed);\r\n    if (seed < 256) {\r\n        seed |= seed << 8;\r\n    }\r\n\r\n    for (let i = 0; i < 256; i++) {\r\n        let v;\r\n        if (i & 1) {\r\n            v = p[i] ^ (seed & 255);\r\n        } else {\r\n            v = p[i] ^ ((seed>>8) & 255);\r\n        }\r\n\r\n        perm[i] = perm[i + 256] = v;\r\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\r\n    }\r\n};\r\n\r\nmyModule.seed(0);\r\n\r\n/*\r\nfor (let i=0; i<256; i++) {\r\n  perm[i] = perm[i + 256] = p[i];\r\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\r\n}*/\r\n\r\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\r\nconst F2 = 0.5*(Math.sqrt(3)-1);\r\nconst G2 = (3-Math.sqrt(3))/6;\r\n\r\n/*let F3 = 1/3;\r\nlet G3 = 1/6;*/\r\n\r\n// 2D simplex noise\r\nmyModule.simplex2 = function (xin: number, yin: number): number {\r\n    let n0, n1, n2; // Noise contributions from the three corners\r\n    // Skew the input space to determine which simplex cell we're in\r\n    const s = (xin+yin)*F2; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    const t = (i+j)*G2;\r\n    const x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    const y0 = yin-j+t;\r\n    // For the 2D case, the simplex shape is an equilateral triangle.\r\n    // Determine which simplex we are in.\r\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n    if (x0>y0) { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n        i1=1; j1=0;\r\n    } else {    // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n        i1=0; j1=1;\r\n    }\r\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n    // c = (3-sqrt(3))/6\r\n    const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n    const y1 = y0 - j1 + G2;\r\n    const x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n    const y2 = y0 - 1 + 2 * G2;\r\n    // Work out the hashed gradient indices of the three simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    const gi0 = gradP[i+perm[j]];\r\n    const gi1 = gradP[i+i1+perm[j+j1]];\r\n    const gi2 = gradP[i+1+perm[j+1]];\r\n    // Calculate the contribution from the three corners\r\n    let t0 = 0.5 - x0*x0-y0*y0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot2(x0, y0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.5 - x1*x1-y1*y1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\r\n    }\r\n    let t2 = 0.5 - x2*x2-y2*y2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 70 * (n0 + n1 + n2);\r\n};\r\n/*\r\n// 3D simplex noise\r\nmyModule.simplex3 = function(xin, yin, zin) {\r\n    let n0, n1, n2, n3; // Noise contributions from the four corners\r\n\r\n    // Skew the input space to determine which simplex cell we're in\r\n    let s = (xin+yin+zin)*F3; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    let k = Math.floor(zin+s);\r\n\r\n    let t = (i+j+k)*G3;\r\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin-j+t;\r\n    let z0 = zin-k+t;\r\n\r\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n    // Determine which simplex we are in.\r\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n    if (x0 >= y0) {\r\n        if (y0 >= z0)      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; }\r\n        else if (x0 >= z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; }\r\n        else              { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; }\r\n    } else {\r\n        if (y0 < z0)      { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; }\r\n        else if (x0 < z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; }\r\n        else             { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; }\r\n    }\r\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n    // c = 1/6.\r\n    let x1 = x0 - i1 + G3; // Offsets for second corner\r\n    let y1 = y0 - j1 + G3;\r\n    let z1 = z0 - k1 + G3;\r\n\r\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\r\n    let y2 = y0 - j2 + 2 * G3;\r\n    let z2 = z0 - k2 + 2 * G3;\r\n\r\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\r\n    let y3 = y0 - 1 + 3 * G3;\r\n    let z3 = z0 - 1 + 3 * G3;\r\n\r\n    // Work out the hashed gradient indices of the four simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    k &= 255;\r\n    let gi0 = gradP[i+   perm[j+   perm[k   ]]];\r\n    let gi1 = gradP[i+i1+perm[j+j1+perm[k+k1]]];\r\n    let gi2 = gradP[i+i2+perm[j+j2+perm[k+k2]]];\r\n    let gi3 = gradP[i+ 1+perm[j+ 1+perm[k+ 1]]];\r\n\r\n    // Calculate the contribution from the four corners\r\n    let t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\r\n    }\r\n    let t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\r\n    }\r\n    let t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\r\n    if (t3<0) {\r\n        n3 = 0;\r\n    } else {\r\n        t3 *= t3;\r\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 32 * (n0 + n1 + n2 + n3);\r\n\r\n};\r\n*/\r\n// ##### Perlin noise stuff\r\n/*\r\nfunction fade(t) {\r\n    return t*t*t*(t*(t*6-15)+10);\r\n}\r\n\r\nfunction lerp(a, b, t) {\r\n    return (1-t)*a + t*b;\r\n}\r\n\r\n// 2D Perlin Noise\r\nmyModule.perlin2 = function(x, y) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y);\r\n    // Get relative xy coordinates of point within that cell\r\n    x = x - X; y = y - Y;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255;\r\n\r\n    // Calculate noise contributions from each of the four corners\r\n    let n00 = gradP[X+perm[Y]].dot2(x, y);\r\n    let n01 = gradP[X+perm[Y+1]].dot2(x, y-1);\r\n    let n10 = gradP[X+1+perm[Y]].dot2(x-1, y);\r\n    let n11 = gradP[X+1+perm[Y+1]].dot2(x-1, y-1);\r\n\r\n    // Compute the fade curve value for x\r\n    let u = fade(x);\r\n\r\n    // Interpolate the four results\r\n    return lerp(\r\n        lerp(n00, n10, u),\r\n        lerp(n01, n11, u),\r\n        fade(y));\r\n};*/\r\n/*\r\n// 3D Perlin Noise\r\nmyModule.perlin3 = function(x, y, z) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y), Z = Math.floor(z);\r\n    // Get relative xyz coordinates of point within that cell\r\n    x = x - X; y = y - Y; z = z - Z;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255; Z = Z & 255;\r\n\r\n    // Calculate noise contributions from each of the eight corners\r\n    let n000 = gradP[X+  perm[Y+  perm[Z  ]]].dot3(x,   y,     z);\r\n    let n001 = gradP[X+  perm[Y+  perm[Z+1]]].dot3(x,   y,   z-1);\r\n    let n010 = gradP[X+  perm[Y+1+perm[Z  ]]].dot3(x,   y-1,   z);\r\n    let n011 = gradP[X+  perm[Y+1+perm[Z+1]]].dot3(x,   y-1, z-1);\r\n    let n100 = gradP[X+1+perm[Y+  perm[Z  ]]].dot3(x-1,   y,   z);\r\n    let n101 = gradP[X+1+perm[Y+  perm[Z+1]]].dot3(x-1,   y, z-1);\r\n    let n110 = gradP[X+1+perm[Y+1+perm[Z  ]]].dot3(x-1, y-1,   z);\r\n    let n111 = gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1, y-1, z-1);\r\n\r\n    // Compute the fade curve value for x, y, z\r\n    let u = fade(x);\r\n    let v = fade(y);\r\n    let w = fade(z);\r\n\r\n    // Interpolate\r\n    return lerp(\r\n        lerp(\r\n            lerp(n000, n100, u),\r\n            lerp(n001, n101, u), w),\r\n        lerp(\r\n            lerp(n010, n110, u),\r\n            lerp(n011, n111, u), w),\r\n        v);\r\n};*/\r\n\r\nexport const noise = myModule;","import {BB} from '../../bb/bb';\r\nimport {IRGB, IRGBA} from '../kl-types';\r\nimport {IBounds, IPressureInput} from '../../bb/bb-types';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {clamp} from '../../bb/math/math';\r\n\r\nexport interface IBlendBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'BlendBrush'];\r\n    actions: THistoryInnerActions<BlendBrush>[];\r\n}\r\n\r\nconst cellSize = 256;\r\n\r\ninterface IDrawBufferItem {\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    opacity: number;\r\n    x1: number;\r\n    y1: number;\r\n    x2: number;\r\n    y2: number;\r\n    r: number;\r\n    g: number;\r\n    b: number;\r\n}\r\n\r\nexport class BlendBrush {\r\n\r\n    private isTesting: boolean = false; // testing mode - context only gets updated when line is finished\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private color: IRGB;\r\n    private size: number = 29; // radius - 0.5 - 99999\r\n    private opacity: number = 0.6; // 0-1\r\n    private blending: number = 0.65; // 0-1\r\n\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingSizePressure: boolean = true;\r\n    private settingOpacityPressure: boolean = false;\r\n\r\n    private blendCol: IRGBA = {r: 0, g: 0, b: 0, a: 1}; // todo docs\r\n    private blendMix: number = 0.45; // todo docs\r\n    private mixr: number; // todo docs\r\n    private mixg: number; // todo docs\r\n    private mixb: number; // todo docs\r\n    private localColOld: IRGBA; // todo docs\r\n\r\n    private isDrawing: boolean = false;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private bezierLine: any; // todo type\r\n\r\n    private history: KlHistoryInterface | null;\r\n    private historyEntry: IBlendBrushHistoryEntry;\r\n    private redrawBounds: IBounds;\r\n    private cells: (ImageData | null)[];\r\n    private drawBuffer: IDrawBufferItem[];\r\n\r\n    private updateRedrawBounds (bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    private getCellsWidth (): number {\r\n        return Math.ceil(this.context.canvas.width / cellSize);\r\n    }\r\n\r\n    /**\r\n     * draw changed cells (changed by brushstroke) onto context\r\n     * @private\r\n     */\r\n    private drawChangedCells (): void {\r\n        const cells = this.cells.map(item => null);\r\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\r\n        touchedCells.forEach((isTouched, index) => {\r\n            if (isTouched) {\r\n                cells[index] = this.cells[index];\r\n            }\r\n        });\r\n        this.drawCells(cells);\r\n        this.redrawBounds = null;\r\n    }\r\n\r\n    private getTouchedCells (bounds: IBounds): boolean[] {\r\n        const touchedCells = this.cells.map(item => false);\r\n        const cellsW = this.getCellsWidth();\r\n        bounds = {\r\n            x1: Math.floor(bounds.x1 / cellSize),\r\n            y1: Math.floor(bounds.y1 / cellSize),\r\n            x2: Math.floor(bounds.x2 / cellSize),\r\n            y2: Math.floor(bounds.y2 / cellSize),\r\n        };\r\n        for (let i = bounds.x1; i <= bounds.x2; i++) {\r\n            for (let e = bounds.y1; e <= bounds.y2; e++) {\r\n                touchedCells[e * cellsW + i] = true;\r\n            }\r\n        }\r\n        return touchedCells;\r\n    }\r\n\r\n    /**\r\n     * Slice up bounds accordings to cells\r\n     * @param bounds\r\n     * @private\r\n     */\r\n    private sliceBounds (bounds: IBounds): {index: number; bounds: IBounds}[] {\r\n        const cellsW = this.getCellsWidth();\r\n        const result: {index: number; bounds: IBounds}[] = [];\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n\r\n        touchedCells.forEach((cell, i) => {\r\n            if (!cell) {\r\n                return;\r\n            }\r\n\r\n            const cellOffsetX = (i % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(i / cellsW) * cellSize;\r\n            const cellWidth = this.cells[i].width;\r\n            const cellHeight = this.cells[i].height;\r\n\r\n            const inCellBounds = {\r\n                x1: Math.max(0, bounds.x1 - cellOffsetX),\r\n                y1: Math.max(0, bounds.y1 - cellOffsetY),\r\n                x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\r\n                y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY),\r\n            };\r\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) {\r\n                return;\r\n            }\r\n            result.push({\r\n                index: i,\r\n                bounds: inCellBounds,\r\n            });\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    private copyFromCanvas (bounds: IBounds) {\r\n        if (!bounds) {\r\n            return;\r\n        }\r\n\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n        const cellsW = this.getCellsWidth();\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.cells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * cellSize + cellSize, this.context.canvas.width) - 1) % cellSize + 1;\r\n            const h = (Math.min(y * cellSize + cellSize, this.context.canvas.height) - 1) % cellSize + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = BB.ctx(tmpCanvas);\r\n            tmpCtx.drawImage(this.context.canvas, -x * cellSize, -y * cellSize);\r\n\r\n            this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\r\n        });\r\n    }\r\n\r\n    private getAverage (x, y, size): IRGBA {\r\n\r\n        size = Math.max(0.5, size * 0.75);\r\n        const x1 = Math.max(0, Math.floor(x - size));\r\n        const y1 = Math.max(0, Math.floor(y - size));\r\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return {\r\n                r: 0,\r\n                g: 0,\r\n                b: 0,\r\n                a: 0,\r\n            };\r\n        }\r\n\r\n        let ar = 0, ag = 0, ab = 0, aa = 0, alpha;\r\n\r\n        const slicedBounds = this.sliceBounds({ x1, y1, x2, y2 });\r\n        slicedBounds.forEach(slice => {\r\n            const width = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n            const bounds = slice.bounds;\r\n\r\n            for (let i = bounds.y1; i <= bounds.y2; i += 4) {\r\n                for (let e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 4 * 4) {\r\n                    alpha = data[e2 + 3];\r\n                    ar += data[e2] * alpha;\r\n                    ag += data[e2 + 1] * alpha;\r\n                    ab += data[e2 + 2] * alpha;\r\n                    aa += alpha;\r\n                }\r\n            }\r\n        });\r\n\r\n        if (aa !== 0) {\r\n            ar /= aa;\r\n            ag /= aa;\r\n            ab /= aa;\r\n            aa = Math.min(1, aa);\r\n        }\r\n        return {\r\n            r: ar,\r\n            g: ag,\r\n            b: ab,\r\n            a: aa,\r\n        };\r\n    }\r\n\r\n    private prepDot (x: number, y: number, size: number): IBounds {\r\n        size = Math.max(0.5, size);\r\n        const x1 = Math.max(0, Math.floor(x - size));\r\n        const y1 = Math.max(0, Math.floor(y - size));\r\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return null;\r\n        }\r\n        return { x1, y1, x2, y2 };\r\n    }\r\n\r\n    private drawDot (params: IDrawBufferItem): void {\r\n        // array with random numbers. faster than Math.random()\r\n        let randI = 0;\r\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n        const randArr = [];\r\n        for (let i = 0; i < randLen; i++) {\r\n            randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n        }\r\n\r\n        // thin lines take more than just 1 sample\r\n        const sampleArr = [8,4,4,4,2,2,2,2,2,2]; // <0.5, 0.5, 1, 1.5, etc.\r\n        const samples = sampleArr[Math.floor(params.size * 2)];\r\n        const samplesSquared: number = samples ? samples * samples : 0;\r\n        const sampleOffsets = [];\r\n        if (samples) {\r\n            let i = 0;\r\n            for (let n = 0; n < samples; n++) {\r\n                for (let m = 0; m < samples; m++, i += 2) {\r\n                    sampleOffsets[i] = (n + 1) / samples; // x offset\r\n                    sampleOffsets[i + 1] = (m + 1) / samples; // y offset\r\n                }\r\n            }\r\n        }\r\n\r\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\r\n        // to optimize calculations\r\n        const invSharpness = 1 - sharpness;\r\n        const sharpnessSubtrahend = sharpness / invSharpness;\r\n        const sizeSquared = params.size * params.size;\r\n        const distDivisor = sizeSquared * invSharpness / params.opacity;\r\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\r\n\r\n\r\n        const slicedBounds = this.sliceBounds({\r\n            x1: params.x1,\r\n            y1: params.y1,\r\n            x2: params.x2,\r\n            y2: params.y2,\r\n        });\r\n\r\n        const cellsW = this.getCellsWidth();\r\n        slicedBounds.forEach(slice => {\r\n            const cellOffsetX = (slice.index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(slice.index / cellsW) * cellSize;\r\n            const cellWidth = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n\r\n            // i - y index within cell\r\n            // e - x index within cell\r\n\r\n            // e2 - index in image data\r\n\r\n            // ri - y index within image relative to dot-center\r\n            // re - x index within image relative to dot-center\r\n\r\n            for (let i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++) {\r\n                for (\r\n                    let e = slice.bounds.x1,\r\n                        e2 = i * cellWidth * 4 + slice.bounds.x1 * 4,\r\n                        re = e + cellOffsetX - params.x;\r\n                    e <= slice.bounds.x2;\r\n                    e++,\r\n                        e2 += 4,\r\n                        re++\r\n                ) {\r\n                    // O = over -> brush-dot\r\n                    // U = under -> image\r\n\r\n                    let alphaO = 0;\r\n                    if (samplesSquared) {\r\n                        for (let f = 0; f < sampleOffsets.length; f += 2) {\r\n                            const dist = BB.lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\r\n                            if (dist >= sizeSquared) {\r\n                                continue;\r\n                            }\r\n                            alphaO += clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                        }\r\n                        if (!alphaO) {\r\n                            continue;\r\n                        }\r\n                        alphaO /= samplesSquared;\r\n                    } else {\r\n                        // technically needs + 0.5 offset, but not noticeable with large brush\r\n                        const dist = Math.pow(re, 2) + Math.pow(ri, 2);\r\n                        if (dist >= sizeSquared) {\r\n                            continue;\r\n                        }\r\n                        alphaO = clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                    }\r\n\r\n                    const invAlphaO = 1 - alphaO;\r\n                    const alphaU =data[e2 + 3] / 255;\r\n\r\n                    if (this.settingLockLayerAlpha) {\r\n                        const underR = (params.r * alphaO) + ((data[e2]) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1]) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2]) * invAlphaO);\r\n                        if (alphaU) {\r\n                            data[e2] = Math.floor(underR + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB + randArr[randI]);\r\n                        }\r\n                    } else {\r\n                        const underR = (params.r * alphaO) + ((data[e2] * alphaU) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1] * alphaU) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2] * alphaU) * invAlphaO);\r\n\r\n                        const newAlpha = 1 - invAlphaO * (1 - alphaU);\r\n                        data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\r\n                        if (newAlpha) {\r\n                            data[e2] = Math.floor(underR / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB / (newAlpha) + randArr[randI]);\r\n                        }\r\n                    }\r\n                    randI = (randI + 1) % randLen;\r\n\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    private calcSpacing (size: number): number {\r\n        return BB.mix(\r\n            (size * 2) / 2, // until size 5.3\r\n            (size * 2) / 9, // at size 24\r\n            clamp((size - 2.7) / (12 - 2.7), 0, 1)\r\n        );\r\n    }\r\n\r\n    private continueLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n\r\n        this.drawBuffer = [];\r\n\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (this.settingSizePressure) ? Math.max(1, p * this.size) : Math.max(1, this.size);\r\n\r\n        const bdist = this.calcSpacing(localSize);\r\n\r\n        let avgX = x;\r\n        let avgY = y;\r\n        if (x === null) {\r\n            avgX = this.lastInput.x;\r\n            avgY = this.lastInput.y;\r\n        }\r\n\r\n        let localColNew;\r\n\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            let average;\r\n            if (isCoalesced) {\r\n                average = {r: this.localColOld.r, g: this.localColOld.g, b: this.localColOld.b, a: 0};\r\n            } else {\r\n                const avgParams = [avgX, avgY, ((this.settingSizePressure) ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size))];\r\n                const bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\r\n                this.copyFromCanvas(bounds);\r\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\r\n            }\r\n            localColNew = {r: 0, g: 0, b: 0, a: 0};\r\n\r\n            if (average.a > 0 && this.blendCol.a === 0) {\r\n                this.blendCol.r = average.r;\r\n                this.blendCol.g = average.g;\r\n                this.blendCol.b = average.b;\r\n                this.blendCol.a = average.a;\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n\r\n            } else {\r\n                if (average.a === 0) {\r\n                    average.r = this.color.r;\r\n                    average.g = this.color.g;\r\n                    average.b = this.color.b;\r\n                    average.a = 1 - this.blending;\r\n                }\r\n\r\n                this.blendCol.r = BB.mix(this.blendCol.r, BB.mix(this.blendCol.r, average.r, this.blendMix), average.a);\r\n                this.blendCol.g = BB.mix(this.blendCol.g, BB.mix(this.blendCol.g, average.g, this.blendMix), average.a);\r\n                this.blendCol.b = BB.mix(this.blendCol.b, BB.mix(this.blendCol.b, average.b, this.blendMix), average.a);\r\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n            }\r\n\r\n        }\r\n\r\n\r\n        const bezierCallback = (val) => {\r\n            if (this.blending >= 1 && this.blendCol.a <= 0) {\r\n                return;\r\n            }\r\n            const factor = val.t;\r\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (this.settingOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\r\n            localSize = (this.settingSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\r\n            if (this.blending != 0) {\r\n                this.mixr = BB.mix(this.localColOld.r, localColNew.r, factor);\r\n                this.mixg = BB.mix(this.localColOld.g, localColNew.g, factor);\r\n                this.mixb = BB.mix(this.localColOld.b, localColNew.b, factor);\r\n            }\r\n            if (this.blending === 1 && this.localColOld.a === 0) {\r\n                this.mixr = localColNew.r;\r\n                this.mixg = localColNew.g;\r\n                this.mixb = localColNew.b;\r\n            }\r\n            const bounds = this.prepDot(val.x, val.y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: val.x,\r\n                    y: val.y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                });\r\n            }\r\n        };\r\n\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.localColOld = localColNew;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.size;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.size = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.opacity = o;\r\n    }\r\n\r\n    getBlending (): number {\r\n        return this.blending;\r\n    }\r\n\r\n    setBlending (b: number) {\r\n        this.blending = b;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.color = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setSizePressure (b: boolean): void {\r\n        this.settingSizePressure = !!b;\r\n    }\r\n\r\n    setOpacityPressure (b: boolean): void {\r\n        this.settingOpacityPressure = !!b;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setIsTesting (b: boolean): void {\r\n        this.isTesting = !!b;\r\n    }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'BlendBrush'],\r\n            actions: [],\r\n        };\r\n\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n\r\n        this.isDrawing = true;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            this.copyFromCanvas(this.prepDot(x, y, localSize));\r\n\r\n            const average = this.getAverage(\r\n                x,\r\n                y,\r\n                ((this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size))\r\n            );\r\n            if (average.a === 0) {\r\n                this.blendCol = {\r\n                    r: this.color.r,\r\n                    g: this.color.g,\r\n                    b: this.color.b,\r\n                    a: 1 - this.blending,\r\n                };\r\n            } else {\r\n                this.blendCol = {\r\n                    r: average.r,\r\n                    g: average.g,\r\n                    b: average.b,\r\n                    a: average.a,\r\n                };\r\n            }\r\n\r\n            this.mixr = this.blendCol.r;\r\n            this.mixg = this.blendCol.g;\r\n            this.mixb = this.blendCol.b;\r\n        }\r\n\r\n        this.localColOld = {r: this.mixr, g: this.mixg, b: this.mixb, a: this.blendCol.a};\r\n\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        if (this.blending < 1 || this.blendCol.a > 0) {\r\n            const bounds = this.prepDot(x, y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x,\r\n                    y: y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                });\r\n            }\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.bezierLine = new BB.BezierLine();\r\n        this.bezierLine.add(x, y, 0, function () {\r\n        });\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    endLine (): void {\r\n        if (this.bezierLine) {\r\n            this.continueLine(null, null, this.lastInput.pressure, false);\r\n        }\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.drawChangedCells();\r\n        }\r\n\r\n        if (this.historyEntry && this.history && this.cells.find(item => !!item)) {\r\n            this.historyEntry.actions.push({\r\n                action: 'drawCells',\r\n                params: [this.cells],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n\r\n    /**\r\n     * draw cells onto context\r\n     * @param cells\r\n     */\r\n    drawCells (cells: (ImageData | null)[]): void {\r\n        const cellsW = this.getCellsWidth();\r\n        cells.forEach((imageData, index) => {\r\n            if (!imageData) {\r\n                return;\r\n            }\r\n            const cellOffsetX = (index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(index / cellsW) * cellSize;\r\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\r\n        });\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\r\n        const average = this.getAverage(x1, y1, Math.max(0.1, this.size));\r\n\r\n        if (average.a === 0) {\r\n            this.blendCol = {\r\n                r: this.color.r,\r\n                g: this.color.g,\r\n                b: this.color.b,\r\n                a: 1 - this.blending,\r\n            };\r\n        } else {\r\n            this.blendCol = {\r\n                r: average.r,\r\n                g: average.g,\r\n                b: average.b,\r\n                a: average.a,\r\n            };\r\n        }\r\n\r\n        this.mixr = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixg = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixb = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\r\n\r\n\r\n        const p = 1;\r\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        const bdist = this.calcSpacing(localSize);\r\n        for (let loopDist = 0; loopDist <= mouseDist; loopDist += bdist) {\r\n            const bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\r\n            if (bounds) {\r\n                this.copyFromCanvas(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x1 + eX * loopDist,\r\n                    y: y1 + eY * loopDist,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                });\r\n            }\r\n        }\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        if (this.history && this.cells.find(item => !!item)) {\r\n            this.drawCells(this.cells);\r\n            this.historyEntry = {\r\n                tool: ['brush', 'BlendBrush'],\r\n                actions: [{\r\n                    action: 'drawCells',\r\n                    params: [this.cells],\r\n                }],\r\n            };\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB, TPressureInput} from '../kl-types';\r\n\r\nexport interface ISketchyBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'SketchyBrush'];\r\n    actions: THistoryInnerActions<SketchyBrush>[];\r\n}\r\n\r\nconst sampleCanvas = BB.canvas(32, 32);\r\nconst sampleCtx = BB.ctx(sampleCanvas);\r\n\r\nexport class SketchyBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private settingColor: IRGB;\r\n    private settingSize: number = 1;\r\n    private settingOpacity: number = 0.2;\r\n    private settingBlending: number = 0.5;\r\n    private settingScale: number = 1;\r\n    private lastX: number = 0;\r\n    private lastY: number = 0;\r\n    private inputIsDrawing: boolean = false;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: ISketchyBrushHistoryEntry | undefined;\r\n    private sketchySeed: number = 0;\r\n    private points: [number, number][] = []; // x y\r\n    private count: number = 0;\r\n    private readonly mixmode = [\r\n        (c1: IRGB, c2: IRGB) => {\r\n            return c1;\r\n        },\r\n        (c1: IRGB, c2: IRGB) => { // why\r\n            const result = new BB.RGB(c1.r, c1.g, c1.b);\r\n            result.r *= c2.r / 255;\r\n            result.g *= c2.g / 255;\r\n            result.b *= c2.b / 255;\r\n            return result;\r\n        },\r\n    ];\r\n\r\n\r\n    private rand (): number {\r\n        this.sketchySeed++;\r\n        return Math.sin(6324634.2345 * Math.cos(this.sketchySeed * 5342.3423)) * 0.5 + 0.5;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor () {}\r\n\r\n    // ---- interface ----\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSeed (s: number): void {\r\n        this.sketchySeed = parseInt('' + s);\r\n    }\r\n\r\n    getSeed (): number {\r\n        return parseInt('' + this.sketchySeed);\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize / 2;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.settingColor = c;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    getBlending (): number {\r\n        return this.settingBlending;\r\n    }\r\n\r\n    setBlending (b: number): void {\r\n        this.settingBlending = b;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s * 2;\r\n    }\r\n\r\n    getScale (): number {\r\n        return this.settingScale;\r\n    }\r\n\r\n    setScale (s: number): void {\r\n        this.settingScale = s;\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    startLine (x: number, y: number, pressure: number, shift?: boolean): void {\r\n        if (shift && this.lastInput.x) {\r\n            this.inputIsDrawing = true;\r\n            this.endLine();\r\n        } else {\r\n            this.inputIsDrawing = true;\r\n            this.lastX = x;\r\n            this.lastY = y;\r\n            this.lastInput.x = x;\r\n            this.lastInput.y = y;\r\n            this.historyEntry = {\r\n                tool: ['brush', 'SketchyBrush'],\r\n                actions: [\r\n                    {\r\n                        action: 'setScale',\r\n                        params: [this.settingScale],\r\n                    },\r\n                    {\r\n                        action: 'setSize',\r\n                        params: [this.settingSize / 2],\r\n                    },\r\n                    {\r\n                        action: 'setOpacity',\r\n                        params: [this.settingOpacity],\r\n                    },\r\n                    {\r\n                        action: 'setColor',\r\n                        params: [this.settingColor],\r\n                    },\r\n                    {\r\n                        action: 'setBlending',\r\n                        params: [this.settingBlending],\r\n                    },\r\n                    {\r\n                        action: 'startLine',\r\n                        params: [x, y, pressure],\r\n                    },\r\n                ],\r\n            };\r\n        }\r\n\r\n    }\r\n\r\n    goLine (p_x: number, p_y: number, pressure: number, preMixedColor: IRGB): void {\r\n        if (!this.inputIsDrawing || (p_x === this.lastInput.x && p_y === this.lastInput.y)) {\r\n            return;\r\n        }\r\n\r\n        let e, b, a, g;\r\n        const x = parseInt('' + p_x);\r\n        const y = parseInt('' + p_y);\r\n        this.points.push([x, y]);\r\n\r\n        let mixr = this.settingColor.r;\r\n        let mixg = this.settingColor.g;\r\n        let mixb = this.settingColor.b;\r\n\r\n        if (preMixedColor !== null) {\r\n            mixr = preMixedColor.r;\r\n            mixg = preMixedColor.g;\r\n            mixb = preMixedColor.b;\r\n        } else {\r\n            if (this.settingBlending !== 0) {\r\n                if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < this.context.canvas.width - 1 && y - 5 < this.context.canvas.height - 1) {\r\n                    mixr = 0;\r\n                    mixg = 0;\r\n                    mixb = 0;\r\n                    const mixx = Math.min(this.context.canvas.width - 1, Math.max(0, x - 5));\r\n                    const mixy = Math.min(this.context.canvas.height - 1, Math.max(0, y - 5));\r\n                    let mixw = Math.min(this.context.canvas.width - 1, Math.max(0, x + 5));\r\n                    let mixh = Math.min(this.context.canvas.height - 1, Math.max(0, y + 5));\r\n                    mixw -= mixx;\r\n                    mixh -= mixy;\r\n\r\n                    if (mixw > 0 && mixh > 0) {\r\n                        const imdat = this.context.getImageData(mixx, mixy, mixw, mixh);\r\n                        let countmix = 0;\r\n                        for (let i = 0; i < imdat.data.length; i += 4) {\r\n                            mixr += imdat.data[i + 0];\r\n                            mixg += imdat.data[i + 1];\r\n                            mixb += imdat.data[i + 2];\r\n                            countmix++;\r\n                        }\r\n                        mixr /= countmix;\r\n                        mixg /= countmix;\r\n                        mixb /= countmix;\r\n                    }\r\n\r\n                    const mixed = this.mixmode[0](new BB.RGB(mixr, mixg, mixb), this.settingColor);\r\n                    mixr = parseInt('' + BB.mix(this.settingColor.r, mixed.r, this.settingBlending));\r\n                    mixg = parseInt('' + BB.mix(this.settingColor.g, mixed.g, this.settingBlending));\r\n                    mixb = parseInt('' + BB.mix(this.settingColor.b, mixed.b, this.settingBlending));\r\n                }\r\n            }\r\n        }\r\n\r\n        this.context.save();\r\n        this.context.strokeStyle = 'rgba(' + mixr + ', ' + mixg + ', ' + mixb + ', ' + this.settingOpacity + ')';\r\n        this.context.lineWidth = this.settingSize;\r\n\r\n        this.context.beginPath();\r\n        this.context.moveTo(this.lastX, this.lastY);\r\n        this.context.lineTo(x, y);\r\n\r\n        for (e = 0; e < this.points.length; e++) {\r\n            b = this.points[e][0] - this.points[this.count][0];\r\n            a = this.points[e][1] - this.points[this.count][1];\r\n            g = b * b + a * a;\r\n            if (g < 4000 * this.settingScale * this.settingScale && this.rand() > g / 2000 / this.settingScale / this.settingScale) {\r\n                this.context.moveTo(this.points[this.count][0] + (b * 0.3), this.points[this.count][1] + (a * 0.3));\r\n                this.context.lineTo(this.points[e][0] - (b * 0.3), this.points[e][1] - (a * 0.3));\r\n            }\r\n        }\r\n\r\n        this.context.stroke();\r\n        this.context.restore();\r\n\r\n\r\n        this.count++;\r\n        this.lastX = x;\r\n        this.lastY = y;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.historyEntry!.actions!.push({\r\n            action: 'goLine',\r\n            params: [p_x, p_y, pressure, {r: mixr, g: mixg, b: mixb}],\r\n        });\r\n    }\r\n\r\n    endLine (): void {\r\n        this.inputIsDrawing = false;\r\n        this.count = 0;\r\n        this.points = [];\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions!.push({\r\n                action: 'endLine',\r\n                params: [],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n    }\r\n    //cheap n' ugly\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.inputIsDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n\r\n        this.context.save();\r\n        this.context.lineWidth = this.settingSize;\r\n\r\n        let mixr = this.settingColor.r, mixg = this.settingColor.g, mixb = this.settingColor.b;\r\n        if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < this.context.canvas.width - 1 && y1 - 5 < this.context.canvas.height - 1) {\r\n            mixr = 0;\r\n            mixg = 0;\r\n            mixb = 0;\r\n            const mixx = Math.min(this.context.canvas.width - 1, Math.max(0, x1 - 5));\r\n            const mixy = Math.min(this.context.canvas.height - 1, Math.max(0, y1 - 5));\r\n            let mixw = Math.min(this.context.canvas.width - 1, Math.max(0, x1 + 5));\r\n            let mixh = Math.min(this.context.canvas.height - 1, Math.max(0, y1 + 5));\r\n            mixw -= mixx;\r\n            mixh -= mixy;\r\n            if (mixw > 0 && mixh > 0) {\r\n                const w = Math.min(sampleCanvas.width, mixw);\r\n                const h = Math.min(sampleCanvas.height, mixh);\r\n                sampleCtx.save();\r\n                sampleCtx.globalCompositeOperation = 'copy';\r\n                sampleCtx.drawImage(this.context.canvas, mixx, mixy, mixw, mixh, 0, 0, w, h);\r\n                sampleCtx.restore();\r\n\r\n                const imdat = sampleCtx.getImageData(mixx, mixy, mixw, mixh);\r\n                let countmix = 0;\r\n                for (let i = 0; i < imdat.data.length; i += 4) {\r\n                    mixr += imdat.data[i + 0];\r\n                    mixg += imdat.data[i + 1];\r\n                    mixb += imdat.data[i + 2];\r\n                    countmix++;\r\n                }\r\n                mixr /= countmix;\r\n                mixg /= countmix;\r\n                mixb /= countmix;\r\n            }\r\n        }\r\n        const mixed = this.mixmode[0](new BB.RGB(mixr, mixg, mixb), this.settingColor);\r\n        mixr = parseInt('' + (this.settingBlending * mixed.r + this.settingColor.r * (1 - this.settingBlending)));\r\n        mixg = parseInt('' + (this.settingBlending * mixed.g + this.settingColor.g * (1 - this.settingBlending)));\r\n        mixb = parseInt('' + (this.settingBlending * mixed.b + this.settingColor.b * (1 - this.settingBlending)));\r\n        this.context.strokeStyle = 'rgba(' + mixr + ', ' + mixg + ', ' + mixb + ', ' + this.settingOpacity + ')';\r\n        this.context.beginPath();\r\n        this.context.moveTo(x1, y1);\r\n        this.context.lineTo(x2, y2);\r\n        this.context.stroke();\r\n        this.context.strokeStyle = 'rgba(' + mixr + ', ' + mixg + ', ' + mixb + ', ' + this.settingOpacity + ')';\r\n        this.context.restore();\r\n\r\n        const historyEntry: ISketchyBrushHistoryEntry = {\r\n            tool: ['brush', 'SketchyBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'setScale',\r\n                    params: [this.settingScale],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize / 2],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setBlending',\r\n                    params: [this.settingBlending],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n\r\n    isDrawing (): boolean {\r\n        return this.inputIsDrawing;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB, TPressureInput} from '../kl-types';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {BezierLine} from '../../bb/math/line';\r\nimport {ERASE_COLOR} from './erase-color';\r\n\r\nexport interface IPixelBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'PixelBrush'];\r\n    actions: THistoryInnerActions<PixelBrush>[];\r\n}\r\n\r\n\r\nexport class PixelBrush {\r\n\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IPixelBrushHistoryEntry | undefined;\r\n    private context: CanvasRenderingContext2D;\r\n    private settingHasSizePressure: boolean = true;\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingSize: number = 0.5;\r\n    private settingSpacing: number = 0.9;\r\n    private settingOpacity: number = 1;\r\n    private settingColor: IRGB;\r\n    private settingColorStr: string;\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingIsEraser: boolean = false;\r\n    private settingUseDither: boolean = true;\r\n    private inputIsDrawing: boolean = false;\r\n    private lineToolLastDot: number;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private bezierLine: BezierLine | null = null;\r\n    private readonly ditherArr: [number, number][] = [\r\n        [3, 2],\r\n        [1, 0],\r\n        [3, 0],\r\n        [1, 2],\r\n        [2, 1],\r\n        [0, 3],\r\n        [0, 1],\r\n        [2, 3],\r\n\r\n        [2, 0],\r\n        [0, 2],\r\n        [0, 0],\r\n        [2, 2],\r\n        [1, 1],\r\n        [3, 3],\r\n        [3, 1],\r\n        [1, 3],\r\n    ];\r\n    private readonly ditherCanvas: HTMLCanvasElement;\r\n    private readonly ditherCtx: CanvasRenderingContext2D;\r\n    private ditherPattern: CanvasPattern;\r\n\r\n\r\n    private updateDither (): void {\r\n        this.ditherCtx.clearRect(0, 0, 4, 4);\r\n        this.ditherCtx.fillStyle = this.settingIsEraser ? `rgb(${ERASE_COLOR},${ERASE_COLOR},${ERASE_COLOR})` : this.settingColorStr;\r\n        for (let i = 0; i < Math.max(1, Math.round(this.settingOpacity * this.ditherArr.length)); i++) {\r\n            this.ditherCtx.fillRect(this.ditherArr[i][0], this.ditherArr[i][1], 1, 1);\r\n        }\r\n        this.ditherPattern = this.context.createPattern(this.ditherCanvas, 'repeat');\r\n    }\r\n\r\n    /**\r\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\r\n     */\r\n    private cubicCurveOverThreshold (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D, maxAngleRad: number): boolean {\r\n        const d = BB.Vec2.nor({\r\n            x: p4.x - p1.x,\r\n            y: p4.y - p1.y,\r\n        });\r\n        const d2 = BB.Vec2.nor({\r\n            x: p2.x - p1.x,\r\n            y: p2.y - p1.y,\r\n        });\r\n        const d3 = BB.Vec2.nor({\r\n            x: p4.x - p3.x,\r\n            y: p4.y - p3.y,\r\n        });\r\n        // const a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\r\n        // const a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\r\n\r\n        return Math.max(BB.Vec2.dist(d, d2), BB.Vec2.dist(d, d3)) > maxAngleRad;\r\n    }\r\n\r\n    private plotCubicBezierLine (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D): void {\r\n\r\n        const isOverThreshold = this.cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\r\n\r\n        p1.x = Math.floor(p1.x);\r\n        p1.y = Math.floor(p1.y);\r\n        p4.x = Math.floor(p4.x);\r\n        p4.y = Math.floor(p4.y);\r\n\r\n        const dist = BB.dist(p1.x, p1.y, p4.x, p4.y);\r\n        if (!isOverThreshold || dist < 7) {\r\n            this.plotLine(p1.x, p1.y, p4.x, p4.y, true);\r\n            return;\r\n        }\r\n\r\n        const n = Math.max(2, Math.round(dist / 4));\r\n        const pointArr = [];\r\n        for (let i = 0; i <= n; i++) {\r\n            const t = i / n;\r\n            const a = Math.pow(1 - t, 3);\r\n            const b = 3 * t * Math.pow(1 - t, 2);\r\n            const c = 3 * Math.pow(t, 2) * (1 - t);\r\n            const d = Math.pow(t, 3);\r\n            pointArr.push({\r\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\r\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y,\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            this.plotLine(\r\n                Math.round(pointArr[i].x),\r\n                Math.round(pointArr[i].y),\r\n                Math.round(pointArr[i + 1].x),\r\n                Math.round(pointArr[i + 1].y),\r\n                true\r\n            );\r\n        }\r\n    }\r\n\r\n    private drawDot (x: number, y: number, size: number, opacity: number): void {\r\n        this.context.save();\r\n        if (this.settingIsEraser) {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : '#fff';\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            }\r\n        } else {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        }\r\n        this.context.globalAlpha = this.settingUseDither ? 1 : opacity;\r\n        this.context.fillRect(\r\n            Math.round(x + -size),\r\n            Math.round(y + -size),\r\n            Math.round(size * 2),\r\n            Math.round(size * 2)\r\n        );\r\n        this.context.restore();\r\n    }\r\n\r\n    private continueLine (\r\n        x: number | null,\r\n        y: number | null,\r\n        size: number,\r\n        pressure: number\r\n    ): void {\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, () => {});\r\n        }\r\n\r\n        this.context.save();\r\n\r\n        const dotCallback = (\r\n            val: {\r\n                x: number;\r\n                y: number;\r\n                t: number;\r\n                angle?: number;\r\n                dAngle: number;\r\n            }\r\n        ): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            const localSize = Math.max(0.5, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            this.drawDot(val.x, val.y, localSize, localOpacity);\r\n        };\r\n\r\n        const controlCallback = (\r\n            controlObj: {\r\n                p1: IVector2D;\r\n                p2: IVector2D;\r\n                p3: IVector2D;\r\n                p4: IVector2D;\r\n            }\r\n        ): void => {\r\n            this.plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\r\n        };\r\n\r\n        if (Math.round(this.settingSize * 2) === 1) {\r\n            if (x === null || y === null) {\r\n                this.bezierLine.addFinal(4, undefined, controlCallback);\r\n            } else {\r\n                this.bezierLine.add(x, y, 4, undefined, controlCallback);\r\n            }\r\n\r\n        } else {\r\n            const localSpacing = size * this.settingSpacing;\r\n\r\n            if (x === null || y === null) {\r\n                this.bezierLine.addFinal(localSpacing, dotCallback);\r\n            } else {\r\n                this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n\r\n    /**\r\n     * bresenheim line drawing\r\n     */\r\n    private plotLine (x0: number, y0: number, x1: number, y1: number, skipFirst: boolean): void {\r\n        this.context.save();\r\n\r\n        if (this.settingIsEraser) {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : '#fff';\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            }\r\n        } else {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        }\r\n        this.context.globalAlpha = this.settingUseDither ? 1 : this.settingOpacity;\r\n\r\n        x0 = Math.floor(x0);\r\n        y0 = Math.floor(y0);\r\n        x1 = Math.floor(x1);\r\n        y1 = Math.floor(y1);\r\n\r\n        const dX = Math.abs(x1 - x0);\r\n        const sX = x0 < x1 ? 1 : -1;\r\n        const dY = -Math.abs(y1 - y0);\r\n        const sY = y0 < y1 ? 1 : -1;\r\n        let err = dX + dY;\r\n        while (true) {\r\n            if (skipFirst) {\r\n                skipFirst = false;\r\n            } else {\r\n                this.context.fillRect(x0, y0, 1, 1);\r\n            }\r\n            if (x0 === x1 && y0 === y1) {\r\n                break;\r\n            }\r\n            const e2 = 2 * err;\r\n            if (e2 >= dY) {\r\n                err += dY;\r\n                x0 += sX;\r\n            }\r\n            if (e2 <= dX) {\r\n                err += dX;\r\n                y0 += sY;\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n    constructor () {\r\n        this.ditherCanvas = BB.canvas(4, 4);\r\n        this.ditherCtx = BB.ctx(this.ditherCanvas);\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'PixelBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n                {\r\n                    action: 'setIsEraser',\r\n                    params: [this.settingIsEraser],\r\n                },\r\n                {\r\n                    action: 'setUseDither',\r\n                    params: [this.settingUseDither],\r\n                },\r\n            ],\r\n        };\r\n\r\n        if (this.settingUseDither) {\r\n            this.updateDither();\r\n        }\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.5, p * this.settingSize) : Math.max(0.5, this.settingSize);\r\n\r\n        this.inputIsDrawing = true;\r\n        this.drawDot(x, y, localSize, localOpacity);\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        this.historyEntry.actions!.push({\r\n            action: 'startLine',\r\n            params: [x, y, p],\r\n        });\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.inputIsDrawing) {\r\n            return;\r\n        }\r\n        this.historyEntry!.actions!.push({\r\n            action: 'goLine',\r\n            params: [x, y, p],\r\n        });\r\n\r\n        //debug\r\n        //drawDot(x, y, 1, 0.5);\r\n\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = pressure;\r\n    }\r\n\r\n    endLine (x: number, y: number): void {\r\n\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n\r\n        //debug\r\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\r\n        //drawDot(x, y, 10, 0.1);\r\n\r\n        this.inputIsDrawing = false;\r\n\r\n        this.bezierLine = null;\r\n\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions!.push({\r\n                action: 'endLine',\r\n                params: [x, y],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n    }\r\n\r\n    //cheap n' ugly\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n        this.lastInput.pressure = 1;\r\n\r\n        if (this.inputIsDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (this.settingUseDither) {\r\n            this.updateDither();\r\n        }\r\n\r\n        if (Math.round(this.settingSize * 2) === 1) {\r\n            this.plotLine(x1, y1, x2, y2, true);\r\n        } else {\r\n            // const angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\r\n            const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n            const eX = (x2 - x1) / mouseDist;\r\n            const eY = (y2 - y1) / mouseDist;\r\n            let loopDist;\r\n            const bdist = this.settingSize * this.settingSpacing;\r\n            this.lineToolLastDot = this.settingSize * this.settingSpacing;\r\n            for (loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n                this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity);\r\n            }\r\n        }\r\n\r\n        const historyEntry: IPixelBrushHistoryEntry = {\r\n            tool: ['brush', 'PixelBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n                {\r\n                    action: 'setIsEraser',\r\n                    params: [this.settingIsEraser],\r\n                },\r\n                {\r\n                    action: 'setUseDither',\r\n                    params: [this.settingUseDither],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n    //IS\r\n    isDrawing (): boolean {\r\n        return this.inputIsDrawing;\r\n    }\r\n\r\n    //SET\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor === c) {\r\n            return;\r\n        }\r\n        this.settingColor = c;\r\n        this.settingColorStr = 'rgb(' + this.settingColor.r + ',' + this.settingColor.g + ',' + this.settingColor.b + ')';\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = Math.round(s * 2) / 2;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = b;\r\n    }\r\n\r\n    setIsEraser (b: boolean): void {\r\n        this.settingIsEraser = !!b;\r\n    }\r\n\r\n    setUseDither (b: boolean): void {\r\n        this.settingUseDither = !!b;\r\n    }\r\n\r\n    //GET\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.settingIsEraser;\r\n    }\r\n\r\n    getUseDither (): boolean {\r\n        return this.settingUseDither;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {TPressureInput} from '../kl-types';\r\nimport {BezierLine} from '../../bb/math/line';\r\nimport {ERASE_COLOR} from './erase-color';\r\n\r\nexport interface IEraserBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'EraserBrush'];\r\n    actions: THistoryInnerActions<EraserBrush>[];\r\n}\r\n\r\ntype TIndexExtended2DContext = CanvasRenderingContext2D & { canvas: { index: number } };\r\n\r\nexport class EraserBrush {\r\n\r\n    private size: number = 30;\r\n    private spacing: number = 0.4;\r\n    private opacity: number = 1;\r\n    private useSizePressure: boolean = true;\r\n    private useOpacityPressure: boolean = false;\r\n    private isTransparentBG: boolean = false;\r\n\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IEraserBrushHistoryEntry | undefined;\r\n    private isBaseLayer: boolean = false;\r\n    private context: TIndexExtended2DContext;\r\n\r\n    private started: boolean = false;\r\n    private lastDot: number | undefined;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private bezierLine: BezierLine | undefined;\r\n\r\n\r\n    private drawDot (x: number, y: number, size: number, opacity: number): void {\r\n        this.context.save();\r\n        if (this.isBaseLayer) {\r\n            if (this.isTransparentBG) {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        } else {\r\n            this.context.globalCompositeOperation = 'destination-out';\r\n        }\r\n        const radgrad = this.context.createRadialGradient(size, size, 0, size, size, size);\r\n        let sharpness = Math.pow(opacity, 2);\r\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\r\n        const oFac = Math.max(0, Math.min(1, opacity));\r\n        const localOpacity = 2 * oFac - oFac * oFac;\r\n        radgrad.addColorStop(sharpness, `rgba(${ERASE_COLOR}, ${ERASE_COLOR}, ${ERASE_COLOR}, ` + localOpacity + ')');\r\n        radgrad.addColorStop(1, `rgba(${ERASE_COLOR}, ${ERASE_COLOR}, ${ERASE_COLOR}, 0)`);\r\n        this.context.fillStyle = radgrad;\r\n        this.context.translate(x - size, y - size);\r\n        this.context.fillRect(0, 0, size * 2, size * 2);\r\n        this.context.restore();\r\n    }\r\n\r\n    private continueLine (x: number | null, y: number | null, p: number): void {\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (this.useSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * localSize * this.spacing);\r\n\r\n        const bezierCallback = (val: {\r\n            x: number;\r\n            y: number;\r\n            t: number;\r\n            angle?: number;\r\n            dAngle: number;\r\n        }): void => {\r\n            const factor = val.t;\r\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (this.useOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\r\n            localSize = (this.useSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\r\n\r\n            this.drawDot(val.x, val.y, localSize, localOpacity);\r\n        };\r\n\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n    }\r\n\r\n    // ---- public -----\r\n    constructor () {}\r\n\r\n    // ---- interface ----\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'EraserBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.useOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.useSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.size],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.opacity],\r\n                },\r\n                {\r\n                    action: 'setTransparentBG',\r\n                    params: [this.isTransparentBG],\r\n                },\r\n                {\r\n                    action: 'startLine',\r\n                    params: [x, y, p],\r\n                },\r\n            ],\r\n        };\r\n\r\n        this.isBaseLayer = 0 === this.context.canvas.index;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        const localOpacity = (this.useOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.useSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n        this.started = true;\r\n        if (localSize > 1) {\r\n            this.drawDot(x, y, localSize, localOpacity);\r\n        }\r\n        this.lastDot = localSize * this.spacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        this.bezierLine = new BB.BezierLine();\r\n        this.bezierLine.add(x, y, 0, () => undefined);\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.started || !this.historyEntry) {\r\n            return;\r\n        }\r\n        this.historyEntry.actions?.push({\r\n            action: 'goLine',\r\n            params: [x, y, p],\r\n        });\r\n\r\n        this.continueLine(x, y, this.lastInput.pressure);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n    }\r\n\r\n    endLine (): void {\r\n\r\n        if (this.bezierLine) {\r\n            this.continueLine(null, null, this.lastInput.pressure);\r\n        }\r\n\r\n        this.started = false;\r\n        this.bezierLine = undefined;\r\n\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions?.push({\r\n                action: 'endLine',\r\n                params: [],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n\r\n        this.isBaseLayer = 0 === this.context.canvas.index;\r\n\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.started || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * this.size * this.spacing);\r\n        this.lastDot = 0;\r\n        for (loopDist = this.lastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.size, this.opacity);\r\n        }\r\n\r\n\r\n        const historyEntry: IEraserBrushHistoryEntry = {\r\n            tool: ['brush', 'EraserBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.useOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.useSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.size],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.opacity],\r\n                },\r\n                {\r\n                    action: 'setTransparentBG',\r\n                    params: [this.isTransparentBG],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n    //IS\r\n    isDrawing (): boolean {\r\n        return this.started;\r\n    }\r\n\r\n    //SET\r\n    setContext (c: TIndexExtended2DContext): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.size = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.opacity = o;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.useSizePressure = b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.useOpacityPressure = b;\r\n    }\r\n\r\n    setTransparentBG (b: boolean): void {\r\n        this.isTransparentBG = !!b;\r\n    }\r\n\r\n    //GET\r\n    getSize (): number {\r\n        return this.size;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacity;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb-types';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB} from '../kl-types';\r\nimport {clamp} from '../../bb/math/math';\r\n\r\nexport interface ISmudgeBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'SmudgeBrush'];\r\n    actions: THistoryInnerActions<SmudgeBrush>[];\r\n}\r\n\r\n// let statCount = 1;\r\n// let statAcc = 0;\r\n// stats on win10, chrome, size 100, opacity 80, smudge()\r\n// unoptimized: 1 ms\r\n// minimal: 0.09 ms\r\n// minimal + circle: 0.5ms\r\n// minimal + circle + ix, iy: 0.23ms\r\n// unoptimized + ix, iy: 0.64 ms\r\n// unoptimized + ix, iy + sans rounding: 0.61 ms\r\n// ix, iy + sans rounding + sans random: 0.32ms\r\n// ix, iy + sans rounding + fast random: 0.46 ms\r\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\r\n\r\nconst CELL_SIZE = 256;\r\n\r\ninterface ISmudgeParams {\r\n    aP: IVector2D;\r\n    bP: IVector2D;\r\n    size: {\r\n        w: number;\r\n        h: number;\r\n    };\r\n    brush: {\r\n        center: IVector2D;\r\n        size: number;\r\n        opacity: number;\r\n        alphaLock: boolean;\r\n    };\r\n}\r\n\r\n\r\n/**\r\n * determine bounds of smudge\r\n * @param imWidth\r\n * @param imHeight\r\n * @param aP\r\n * @param bP\r\n * @param size\r\n */\r\nfunction prepSmudge (\r\n    imWidth: number,\r\n    imHeight: number,\r\n    aP: IVector2D, // top left of source, integers\r\n    bP: IVector2D, // top left of dest, integers\r\n    size: {w: number; h: number}, // size of both rectangles, integers\r\n): ({\r\n    aP: IVector2D;\r\n    bP: IVector2D;\r\n    size: {w: number; h: number};\r\n} | null) {\r\n\r\n    if (aP.x === bP.x && aP.y === bP.y) {\r\n        return null;\r\n    }\r\n\r\n    aP = BB.copyObj(aP);\r\n    bP = BB.copyObj(bP);\r\n    size = BB.copyObj(size);\r\n\r\n    // corner behavior\r\n    // cut down rectangles, if a or b go outside\r\n    // i.e. if user drags partially or fully outside the canvas\r\n    {\r\n        let top = 0;\r\n        let right = 0;\r\n        let bottom = 0;\r\n        let left = 0;\r\n\r\n        if (aP.x < 0) {\r\n            left = -aP.x;\r\n        }\r\n        if (aP.y < 0) {\r\n            top = -aP.y;\r\n        }\r\n        if (bP.x < 0) {\r\n            left = Math.max(left, -bP.x);\r\n        }\r\n        if (bP.y < 0) {\r\n            top = Math.max(top, -bP.y);\r\n        }\r\n        if (aP.x + size.w > imWidth) {\r\n            right = aP.x + size.w - imWidth;\r\n        }\r\n        if (aP.y + size.h > imHeight) {\r\n            bottom = aP.y + size.h - imHeight;\r\n        }\r\n        if (bP.x + size.w > imWidth) {\r\n            right = Math.max(right, bP.x + size.w - imWidth);\r\n        }\r\n        if (bP.y + size.h > imHeight) {\r\n            bottom = Math.max(bottom, bP.y + size.h - imHeight);\r\n        }\r\n\r\n        aP.x += left;\r\n        bP.x += left;\r\n        aP.y += top;\r\n        bP.y += top;\r\n\r\n        size.w = size.w - left - right;\r\n        size.h = size.h - top - bottom;\r\n        if (size.w <= 0 || size.h <= 0) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    return {\r\n        aP: {\r\n            x: aP.x,\r\n            y: aP.y,\r\n        },\r\n        bP: {\r\n            x: bP.x,\r\n            y: bP.y,\r\n        },\r\n        size: {\r\n            w: size.w,\r\n            h: size.h,\r\n        },\r\n    };\r\n}\r\n\r\n/**\r\n * Pixel operations that do the smudging via ImageData\r\n * @param imageData\r\n * @param p\r\n */\r\nfunction smudge (imageData: ImageData, p : ISmudgeParams): void {\r\n\r\n    p = BB.copyObj(p);\r\n\r\n    const cSize = p.brush.size;\r\n    const cX = p.brush.center.x;\r\n    const cY = p.brush.center.y;\r\n\r\n    /*if (statCount % 1000 === 0) {\r\n        console.log(statAcc / 1000);\r\n        statAcc = 0;\r\n    }\r\n    let start = performance.now();*/\r\n\r\n\r\n    // determine offset\r\n    const aIndex = p.aP.y * imageData.width + p.aP.x;\r\n    const bIndex = p.bP.y * imageData.width + p.bP.x;\r\n    const offset = (bIndex - aIndex) * 4;\r\n\r\n    // array with random numbers. faster than Math.random()\r\n    let randI = 0;\r\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n    const randArr: number[] = [];\r\n    for (let i = 0; i < randLen; i++) {\r\n        randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n    }\r\n\r\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\r\n\r\n    const pixel = (ai: number, bi: number, ix: number, iy: number): void => {\r\n\r\n        const dist = BB.dist(cX, cY, ix, iy);\r\n        const fac = 1 - p.brush.opacity * (1 - clamp((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\r\n\r\n        if (fac === 1) {\r\n            return;\r\n        }\r\n\r\n        if (!imageData.data[ai + 3]) {\r\n\r\n        } else if (!imageData.data[bi + 3]) { // don't mix if target fully transparent. pixel might have a strange color.\r\n            imageData.data[bi] = imageData.data[ai + 0];\r\n            imageData.data[bi + 1] = imageData.data[ai + 1];\r\n            imageData.data[bi + 2] = imageData.data[ai + 2];\r\n        } else {\r\n\r\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\r\n            // not totally accurate. TODO same compositing as blend brush\r\n            let fac2;\r\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) {\r\n                fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\r\n            } else {\r\n                fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\r\n            }\r\n\r\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\r\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\r\n            // No +0.5, because it cancels out with rand.\r\n            imageData.data[bi] = Math.floor(BB.mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\r\n            imageData.data[bi + 1] = Math.floor(BB.mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\r\n            imageData.data[bi + 2] = Math.floor(BB.mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\r\n\r\n            randI = (randI + 1) % randLen;\r\n        }\r\n        // Always mix alpha. unless alpha lock\r\n        if (!p.brush.alphaLock) {\r\n            imageData.data[bi + 3] = Math.floor(BB.mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\r\n        }\r\n\r\n    };\r\n\r\n    const bx1 = p.bP.x * 4;\r\n    const bx2 = bx1 + (p.size.w - 1) * 4;\r\n\r\n    // transfer of pixels depends on direction of smudging if there is overlap\r\n    if (p.aP.y < p.bP.y) {\r\n        for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else if (p.aP.y > p.bP.y) {\r\n        for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else {\r\n        if (p.aP.x < p.bP.x) {\r\n            for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        } else {\r\n            for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x; x < bx2 + yStart; x += 4, x2 += 4, ix++) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //statCount++;\r\n    //statAcc += performance.now() - start;\r\n}\r\n\r\nexport class SmudgeBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: ISmudgeBrushHistoryEntry;\r\n\r\n    private settingColor: IRGB = {r: 0, g: 0, b: 0};\r\n    private settingSize: number = 35;\r\n    private settingSpacing: number = 0.20446882736951905;\r\n    private settingOpacity: number = 0.8;\r\n    private settingColorStr: string;\r\n    private settingHasSizePressure: boolean = false;\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingLockLayerAlpha: boolean = false;\r\n\r\n    private lineToolLastDot: number;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastDot: IVector2D;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private bezierLine: any = null; // todo type BezierLine\r\n\r\n    private redrawBounds: IBounds;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    private copyImageData: ImageData;\r\n\r\n    private drawBuffer: ISmudgeParams[] = [];\r\n\r\n    private copiedCells: boolean[];\r\n\r\n    private updateRedrawBounds (bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    private updateCompleteRedrawBounds (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.completeRedrawBounds = BB.updateBounds(\r\n            this.completeRedrawBounds,\r\n            { x1, y1, x2, y2 }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    copyFromCanvas (): void {\r\n\r\n        const touchedCells = this.copiedCells.map(item => false);\r\n\r\n        const bounds: IBounds[] = [];\r\n        const cellsW = Math.ceil(this.copyImageData.width / CELL_SIZE);\r\n\r\n        if (!this.redrawBounds) {\r\n            return;\r\n        }\r\n        bounds.push({\r\n            x1: Math.floor(this.redrawBounds.x1 / CELL_SIZE),\r\n            y1: Math.floor(this.redrawBounds.y1 / CELL_SIZE),\r\n            x2: Math.floor(this.redrawBounds.x2 / CELL_SIZE),\r\n            y2: Math.floor(this.redrawBounds.y2 / CELL_SIZE),\r\n        });\r\n        bounds.forEach(item => {\r\n            for (let i = item.x1; i <= item.x2; i++) {\r\n                for (let e = item.y1; e <= item.y2; e++) {\r\n                    touchedCells[e * cellsW + i] = true;\r\n                }\r\n            }\r\n        });\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.copiedCells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            this.copiedCells[i] = true;\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * CELL_SIZE + CELL_SIZE, this.copyImageData.width) - 1) % CELL_SIZE + 1;\r\n            const h = (Math.min(y * CELL_SIZE + CELL_SIZE, this.copyImageData.height) - 1) % CELL_SIZE + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = BB.ctx(tmpCanvas);\r\n            tmpCtx.drawImage(this.context.canvas, -x * CELL_SIZE, -y * CELL_SIZE);\r\n\r\n            const data = tmpCtx.getImageData(0, 0, w, h);\r\n\r\n            for (let i = 0; i < h; i++) {\r\n                for (let e = 0, e2 = i * w * 4, e3 = ((y * CELL_SIZE + i) * this.copyImageData.width + x * CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4) {\r\n                    this.copyImageData.data[e3] = data.data[e2];\r\n                    this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\r\n                    this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\r\n                    this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * fill drawBuffer with params about to be drawn\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     */\r\n    prepDot (x: number, y: number, size: number, opacity: number): void {\r\n        if (!this.lastDot) {\r\n            this.lastDot = {\r\n                x: x,\r\n                y: y,\r\n            };\r\n            return;\r\n        }\r\n\r\n        size = Math.round(size);\r\n\r\n\r\n        const w = Math.round(size * 2);\r\n        const h = Math.round(size * 2);\r\n\r\n        const bounds = prepSmudge(\r\n            this.copyImageData.width,\r\n            this.copyImageData.height,\r\n            {\r\n                x: Math.round(this.lastDot.x - size),\r\n                y: Math.round(this.lastDot.y - size),\r\n            },\r\n            {\r\n                x: Math.round(x - size),\r\n                y: Math.round(y - size),\r\n            },\r\n            {\r\n                w,\r\n                h,\r\n            },\r\n        );\r\n\r\n        if (bounds) {\r\n            const params: ISmudgeParams = {\r\n                aP: bounds.aP,\r\n                bP: bounds.bP,\r\n                size: bounds.size,\r\n                brush: {\r\n                    center: { x, y },\r\n                    size,\r\n                    opacity,\r\n                    alphaLock: this.settingLockLayerAlpha,\r\n                },\r\n            };\r\n            this.updateRedrawBounds({\r\n                x1: params.bP.x,\r\n                y1: params.bP.y,\r\n                x2: params.bP.x + params.brush.size * 2,\r\n                y2: params.bP.y + params.brush.size * 2,\r\n            });\r\n            this.drawBuffer.push(params);\r\n        }\r\n\r\n        this.lastDot = {\r\n            x: x,\r\n            y: y,\r\n        };\r\n    }\r\n\r\n    continueLine (x: number, y: number, size: number, pressure: number): void {\r\n        this.drawBuffer = [];\r\n\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function (){});\r\n        }\r\n\r\n        const drawArr = []; //draw instructions. will be all drawn at once\r\n\r\n        const dotCallback = (val): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        };\r\n\r\n        const localSpacing = size * this.settingSpacing / 3;\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            const item = drawArr[i];\r\n            this.prepDot(item[0], item[1], item[2], item[3]);\r\n            before = item;\r\n        }\r\n\r\n        this.copyFromCanvas();\r\n\r\n        for (let i = 0; i < this.drawBuffer.length; i++) {\r\n            smudge(this.copyImageData, this.drawBuffer[i]);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor () { }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'SmudgeBrush'],\r\n            actions: [],\r\n        };\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.lastDot = null;\r\n        this.isDrawing = true;\r\n\r\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\r\n        const totalCells = Math.ceil(this.context.canvas.width / CELL_SIZE) * Math.ceil(this.context.canvas.height / CELL_SIZE);\r\n        this.copiedCells = '0'.repeat(totalCells).split('').map(item => false);\r\n\r\n        this.prepDot(x, y, localSize, localOpacity);\r\n\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2.pressure = p;\r\n\r\n        this.completeRedrawBounds = null;\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        this.redrawBounds = null;\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput2.pressure = this.lastInput.pressure;\r\n        this.lastInput.pressure = pressure;\r\n    }\r\n\r\n    endLine (): void {\r\n        this.redrawBounds = null;\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.context.save();\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n        this.context.restore();\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        if (this.historyEntry && this.completeRedrawBounds) {\r\n            let historyIm: ImageData | HTMLCanvasElement = this.copyImageData;\r\n            if (!(\r\n                this.completeRedrawBounds.x1 === 0 &&\r\n                this.completeRedrawBounds.y1 === 0 &&\r\n                this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 &&\r\n                this.completeRedrawBounds.y2 >= this.context.canvas.height - 1\r\n            )) {\r\n\r\n                // temp canvas to prevent main canvas from getting slowed down in chrome\r\n                const tmpCanvas = BB.canvas(\r\n                    this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                    this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n                );\r\n                const tmpCtx = BB.ctx(tmpCanvas);\r\n                tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n                historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\r\n            }\r\n            this.historyEntry.actions.push({\r\n                action: 'drawImage',\r\n                params: [\r\n                    historyIm,\r\n                    this.completeRedrawBounds.x1,\r\n                    this.completeRedrawBounds.y1,\r\n                ],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n        this.copyImageData = null;\r\n    }\r\n\r\n    drawImage (im: ImageData | HTMLCanvasElement, x: number, y: number): void {\r\n        if (im instanceof ImageData) {\r\n            this.context.putImageData(im, x, y);\r\n        } else {\r\n            this.context.clearRect(x, y, im.width, im.height);\r\n            this.context.drawImage(im, x, y);\r\n        }\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        return;\r\n        /*\r\n        // todo\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = settingSize * settingSpacing;\r\n        lineToolLastDot = settingSize * settingSpacing;\r\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\r\n        }\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"SmudgeBrush\"],\r\n            actions: []\r\n        };\r\n        // todo\r\n        history.add(historyEntry);*/\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) {\r\n            return;\r\n        }\r\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\r\n        this.settingColorStr = BB.ColorConverter.toRgbStr(this.settingColor);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = !!b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = !!b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl-types';\r\nimport {IBounds} from '../../bb/bb-types';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {ERASE_COLOR} from './erase-color';\r\n\r\nexport interface IChemyBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'ChemyBrush'];\r\n    actions: THistoryInnerActions<ChemyBrush>[];\r\n}\r\n\r\ntype TChemyMode = 'fill' | 'stroke';\r\n\r\nexport class ChemyBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private settingColor: IRGB;\r\n    private settingSize: number = 0.25; // radius - 0.5 - 99999\r\n    private settingOpacity: number = 1; // 0-1\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingIsEraser: boolean = false;\r\n    private settingMode: TChemyMode = 'fill';\r\n    private settingDistort: number = 0; // 0 - 1\r\n    private settingXSymmetry: boolean = false;\r\n    private settingYSymmetry: boolean = false;\r\n    private settingGradient: boolean = false;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private history: KlHistoryInterface;\r\n\r\n    private copyCanvas: HTMLCanvasElement;\r\n    private path: {x: number; y: number}[];\r\n    private minY: number;\r\n    private maxY: number;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    private updateCompleteRedrawBounds (x: number, y: number): void {\r\n        let bounds = { x1: x, y1: y, x2: x, y2: y};\r\n        if (this.settingXSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: -x + this.copyCanvas.width,\r\n                    y1: y,\r\n                    x2: -x + this.copyCanvas.width,\r\n                    y2: y,\r\n                }\r\n                );\r\n        }\r\n        if (this.settingYSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: x,\r\n                    y1: -y + this.copyCanvas.height,\r\n                    x2: x,\r\n                    y2: -y + this.copyCanvas.height,\r\n                }\r\n            );\r\n        }\r\n        const buffer = this.settingMode === 'stroke' ? this.settingSize + 1 : 1;\r\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\r\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\r\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\r\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\r\n\r\n        this.completeRedrawBounds = BB.updateBounds(this.completeRedrawBounds, bounds);\r\n    }\r\n\r\n    private drawShape (): void {\r\n        this.context.save();\r\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\r\n        this.context.drawImage(this.copyCanvas, 0, 0);\r\n\r\n        const color = {...this.settingColor};\r\n        if (this.settingIsEraser) {\r\n            color.r = ERASE_COLOR;\r\n            color.g = ERASE_COLOR;\r\n            color.b = ERASE_COLOR;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            }\r\n        } else {\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        }\r\n\r\n        if (this.path) {\r\n\r\n            // path\r\n            const path = new Path2D();\r\n            this.path.forEach((item, index) => {\r\n                if (index === 0) {\r\n                    path.moveTo(item.x, item.y);\r\n                } else {\r\n                    path.lineTo(item.x, item.y);\r\n                }\r\n            });\r\n\r\n            let style: string | CanvasGradient = BB.ColorConverter.toRgbaStr({\r\n                r: color.r,\r\n                g: color.g,\r\n                b: color.b,\r\n                a: this.settingOpacity,\r\n            });\r\n            if (this.settingGradient) {\r\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\r\n                const gradient = this.context.createLinearGradient(\r\n                    0, startAtTop ? this.minY : this.maxY,\r\n                    0, startAtTop ? this.maxY : this.minY,\r\n                );\r\n                gradient.addColorStop(\r\n                    0,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: this.settingOpacity,\r\n                    })\r\n                );\r\n                gradient.addColorStop(\r\n                    1,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: 0,\r\n                    })\r\n                );\r\n                style = gradient;\r\n            }\r\n\r\n            // setup params\r\n            if (this.settingMode === 'fill') {\r\n                this.context.fillStyle = style;\r\n\r\n            } else {\r\n                this.context.lineWidth = this.settingSize * 2;\r\n                this.context.lineJoin = 'bevel';\r\n                this.context.strokeStyle = style;\r\n            }\r\n\r\n            // draw\r\n            const draw = () => {\r\n                if (this.settingMode === 'fill') {\r\n                    this.context.fill(path);\r\n                } else {\r\n                    this.context.stroke(path);\r\n                }\r\n            };\r\n\r\n            draw();\r\n            if (this.settingXSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(this.context.canvas.width / 2, 0);\r\n                this.context.scale(-1, 1);\r\n                this.context.translate(-this.context.canvas.width / 2, 0);\r\n                draw();\r\n                this.context.restore();\r\n            }\r\n            if (this.settingYSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(0, this.context.canvas.height / 2);\r\n                this.context.scale(1, -1);\r\n                this.context.translate(0, -this.context.canvas.height / 2);\r\n                draw();\r\n                this.context.restore();\r\n                if (this.settingXSymmetry) {\r\n                    this.context.save();\r\n                    this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\r\n                    this.context.scale(-1, -1);\r\n                    this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\r\n                    draw();\r\n                    this.context.restore();\r\n                }\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingMode === 'stroke' ? this.settingSize : 0;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.settingColor = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setMode (mode: TChemyMode): void {\r\n        this.settingMode = mode;\r\n    }\r\n\r\n    getMode (): TChemyMode {\r\n        return this.settingMode;\r\n    }\r\n\r\n    setDistort (distort: number): void {\r\n        this.settingDistort = BB.clamp(distort, 0, 1);\r\n    }\r\n\r\n    getDistort (): number {\r\n        return this.settingDistort;\r\n    }\r\n\r\n    setXSymmetry (b: boolean): void {\r\n        this.settingXSymmetry = !!b;\r\n    }\r\n\r\n    getXSymmetry (): boolean {\r\n        return this.settingXSymmetry;\r\n    }\r\n\r\n    setYSymmetry (b: boolean): void {\r\n        this.settingYSymmetry = !!b;\r\n    }\r\n\r\n    getYSymmetry (): boolean {\r\n        return this.settingYSymmetry;\r\n    }\r\n\r\n    setGradient (b: boolean): void {\r\n        this.settingGradient = !!b;\r\n    }\r\n\r\n    getGradient (): boolean {\r\n        return this.settingGradient;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.settingIsEraser;\r\n    }\r\n\r\n    setIsEraser (b: boolean): void {\r\n        this.settingIsEraser = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    startLine (x: number, y: number): void {\r\n        this.isDrawing = true;\r\n        this.path = [{x, y}];\r\n        this.minY = y;\r\n        this.maxY = y;\r\n        this.copyCanvas = BB.canvas(this.context.canvas.width, this.context.canvas.height);\r\n        BB.ctx(this.copyCanvas).drawImage(this.context.canvas, 0, 0);\r\n        this.completeRedrawBounds = null;\r\n        this.updateCompleteRedrawBounds(x, y);\r\n    }\r\n\r\n    goLine (x: number, y: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        const pos = { x, y };\r\n        if (this.settingDistort > 0) {\r\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\r\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\r\n        }\r\n\r\n        this.minY = Math.min(this.minY, pos.y);\r\n        this.maxY = Math.max(this.maxY, pos.y);\r\n        this.path.push(pos);\r\n        this.updateCompleteRedrawBounds(x, y);\r\n        this.drawShape();\r\n    }\r\n\r\n    endLine (): void {\r\n        this.isDrawing = false;\r\n        this.completeRedrawBounds = BB.boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\r\n        if (this.path.length > 1 && this.completeRedrawBounds) {\r\n            const historyCanvas = BB.canvas(\r\n                this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n            );\r\n            const historyCtx = BB.ctx(historyCanvas);\r\n            historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n            this.history.push({\r\n                tool: ['brush', 'ChemyBrush'],\r\n                actions: [\r\n                    {\r\n                        action: 'drawImage',\r\n                        params: [\r\n                            historyCanvas, // faster than getting image data (measured on 2018 lenovo chromebook)\r\n                            this.completeRedrawBounds.x1,\r\n                            this.completeRedrawBounds.y1,\r\n                        ],\r\n                    },\r\n                ],\r\n            } as IChemyBrushHistoryEntry);\r\n        }\r\n        this.path = null;\r\n        this.copyCanvas = null;\r\n    }\r\n\r\n    drawImage (im: HTMLCanvasElement, x: number, y: number): void {\r\n        this.context.save();\r\n        this.context.clearRect(x, y, im.width, im.height);\r\n        this.context.drawImage(im, x, y);\r\n        this.context.restore();\r\n    }\r\n\r\n    drawLineSegment (x1, y1, x2, y2): void {\r\n        // might make sense for stroke\r\n    }\r\n}\r\n","import {penBrushUi} from './pen-brush-ui';\r\nimport {blendBrushUi} from './blend-brush-ui';\r\nimport {sketchyBrushUi} from './sketchy-brush-ui';\r\nimport {pixelBrushUi} from './pixel-brush-ui';\r\nimport {eraserBrushUi} from './eraser-brush-ui';\r\nimport {smudgeBrushUi} from './smudge-brush-ui';\r\nimport {chemyBrushUi} from './chemy-brush-ui';\r\nimport {IBrushUi} from '../kl-types';\r\n\r\n/**\r\n * UI for brushes.\r\n * Each brush ui carries the brush with it.\r\n * So if you want to draw, you do it through the UI. should be changed sometime.\r\n */\r\n\r\nexport const brushesUI: {\r\n    [key: string]: IBrushUi;\r\n} = {\r\n    penBrush: penBrushUi,\r\n    blendBrush: blendBrushUi,\r\n    sketchyBrush: sketchyBrushUi,\r\n    pixelBrush: pixelBrushUi,\r\n    chemyBrush: chemyBrushUi,\r\n    smudgeBrush: smudgeBrushUi,\r\n    eraserBrush: eraserBrushUi,\r\n};\r\n","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport brushIconImg from '/src/app/img/ui/brush-pen.svg';\r\nimport {genBrushAlpha01, genBrushAlpha02} from '../brushes/alphas/brush-alphas';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {Options} from '../ui/components/options';\r\n\r\n\r\nexport const penBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pen'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1/100,\r\n            max: 1,\r\n            curve: [[0, 1/100], [0.5, 30/100], [1, 1]],\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    let alphaNames = [\r\n        LANG('brush-pen-circle'),\r\n        LANG('brush-pen-chalk'),\r\n        LANG('brush-pen-calligraphy'),\r\n        LANG('brush-pen-square'),\r\n    ];\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pen');\r\n        alphaNames = [\r\n            LANG('brush-pen-circle'),\r\n            LANG('brush-pen-chalk'),\r\n            LANG('brush-pen-calligraphy'),\r\n            LANG('brush-pen-square'),\r\n        ];\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.PenBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        const alphaOptions = new Options({\r\n            optionArr: [0, 1, 2, 3].map(id => {\r\n\r\n                const alpha = BB.el({\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        width: '31px',\r\n                        height: '31px',\r\n                        backgroundSize: 'contain',\r\n                        margin: '2px',\r\n                    },\r\n                });\r\n                const canvas = BB.canvas(70, 70);\r\n                const ctx = BB.ctx(canvas);\r\n                if (id === 0 || id === 3) {\r\n                    if (id === 0) {\r\n                        ctx.beginPath();\r\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\r\n                        ctx.closePath();\r\n                        ctx.fill();\r\n                    } else {\r\n                        ctx.fillRect(5, 5, 60, 60);\r\n                    }\r\n                } else if (id === 1) {\r\n                    ctx.drawImage(genBrushAlpha01(60), 5, 5);\r\n                } else if (id === 2) {\r\n                    ctx.drawImage(genBrushAlpha02(60), 5, 5);\r\n                }\r\n                alpha.style.backgroundImage = 'url(' + canvas.toDataURL('image/png') + ')';\r\n\r\n                return {\r\n                    id: id,\r\n                    label: alpha,\r\n                    title: alphaNames[id],\r\n                };\r\n            }),\r\n            initId: 0,\r\n            onChange: (id) => {\r\n                brush.setAlpha(id);\r\n            },\r\n        });\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n            css: {\r\n                display: 'inline-block',\r\n            },\r\n        });\r\n\r\n        const spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: alphaOptions.getElement(),\r\n                    css: {\r\n                        marginTop: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: lockAlphaToggle.getElement(),\r\n                    css: {\r\n                        marginTop: '10px',\r\n                    },\r\n                }),\r\n            );\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","\r\nexport const eventResMs = 20;","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6218s\");","import {BB} from '../../bb/bb';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport brushIconImg from '/src/app/img/ui/brush-blend.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const blendBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-blend'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-blend');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.BlendBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: 58,\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n            const blendingSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 225,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: brush.getBlending(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val);\r\n                },\r\n            });\r\n            blendingSlider.getElement().style.marginTop = '10px';\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.setSizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.setOpacityPressure(b);\r\n            });\r\n\r\n            const lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                    display: 'inline-block',\r\n                },\r\n            });\r\n\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                }),\r\n                blendingSlider.getElement(),\r\n                lockAlphaToggle.getElement()\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y, p, isCoalesced);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"50oCU\");","import {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport brushIconImg from '/src/app/img/ui/brush-sketchy.png';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {BB} from '../../bb/bb';\r\n\r\nexport const sketchyBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-sketchy'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 10,\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-sketchy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.SketchyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize() * 2,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: function (val) {\r\n                    brush.setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n            const blendSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: brush.getBlending(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val);\r\n                },\r\n            });\r\n            const scaleSlider = new KlSlider({\r\n                label: LANG('brush-sketchy-scale'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 1,\r\n                max: 20,\r\n                value: brush.getScale(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setScale(val);\r\n                },\r\n            });\r\n            opacitySlider.getElement().style.marginTop = '10px';\r\n            blendSlider.getElement().style.marginTop = '10px';\r\n            scaleSlider.getElement().style.marginTop = '10px';\r\n            div.append(\r\n                sizeSlider.getElement(),\r\n                opacitySlider.getElement(),\r\n                blendSlider.getElement(),\r\n                scaleSlider.getElement(),\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, pressure) {\r\n            brush.startLine(x, y, pressure);\r\n        };\r\n        this.goLine = function (x, y, pressure) {\r\n            brush.goLine(x, y, pressure, null);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getSeed = function () {\r\n            return parseInt(brush.getSeed());\r\n        };\r\n        this.setSeed = function (s) {\r\n            brush.setSeed(parseInt(s));\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"jDYzC\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport brushIconImg from '/src/app/img/ui/brush-pixel.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const pixelBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pixel'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]],\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pixel');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.PixelBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n            css: {\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n\r\n        const eraserToggle = new Checkbox({\r\n            init: brush.getIsEraser(),\r\n            label: LANG('eraser'),\r\n            callback: function (b) {\r\n                brush.setIsEraser(b);\r\n            },\r\n            css: {\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n\r\n        const ditherToggle = new Checkbox({\r\n            init: brush.getUseDither(),\r\n            label: LANG('brush-pixel-dither'),\r\n            callback: function (b) {\r\n                brush.setUseDither(b);\r\n            },\r\n        });\r\n\r\n        const spacingSpline = new BB.SplineInterpolator([[0.5, 0.45], [100, 4]]);\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                opacitySlider.getElement()\r\n            );\r\n\r\n            const toggleRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n\r\n            toggleRow.append(\r\n                lockAlphaToggle.getElement(),\r\n                eraserToggle.getElement(),\r\n                ditherToggle.getElement(),\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size * 2);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity * 100);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"j07R3\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport brushIconImg from '/src/app/img/ui/brush-eraser.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const eraserBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('eraser') + ' [E]',\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 200,\r\n            curve: BB.quadraticSplineInput(0.5, 200, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('eraser') + ' [E]';\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.EraserBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n        let isTransparentBg = false;\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: 30,\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                })\r\n            );\r\n\r\n            const transparencyToggle = new Checkbox({\r\n                init: false,\r\n                label: LANG('brush-eraser-transparent-bg'),\r\n                callback: function (b) {\r\n                    isTransparentBg = b;\r\n                    brush.setTransparentBG(b);\r\n                },\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            div.append(transparencyToggle.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        function drawDot (x, y) {\r\n            brush.drawDot(x, y);\r\n        }\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            //brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.getIsTransparentBg = function () {\r\n            return isTransparentBg;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fvqmo\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport brushIconImg from '/src/app/img/ui/brush-smudge.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const smudgeBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-smudge'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]],\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-smudge');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.SmudgeBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n        });\r\n\r\n        const spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(false, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                })\r\n            );\r\n\r\n            const bottomRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            bottomRow.append(lockAlphaToggle.getElement());\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"gNPk4\");","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport brushIconImg from '/src/app/img/ui/brush-chemy.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {Options} from '../ui/components/options';\r\nimport {BoxToggle} from '../ui/components/box-toggle';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const chemyBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-chemy'),\r\n        sizeSlider: {\r\n            min: 0.25,\r\n            max: 25,\r\n            curve: BB.quadraticSplineInput(0.25, 25, 0.1),\r\n            isDisabled: true,\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-chemy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.ChemyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider: KlSlider;\r\n        let opacitySlider: KlSlider;\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                isEnabled: brush.getMode() === 'stroke',\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 5) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            BB.css(opacitySlider.getElement(), {\r\n                marginTop: '10px',\r\n            });\r\n\r\n            const eraserToggle = new Checkbox({\r\n                init: brush.getIsEraser(),\r\n                label: LANG('eraser'),\r\n                callback: function (b) {\r\n                    brush.setIsEraser(b);\r\n                },\r\n                css: {\r\n                    marginTop: '10px',\r\n                    marginLeft: '10px',\r\n                },\r\n            });\r\n\r\n            const lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n\r\n            const toggleRow = BB.el({\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n\r\n            const iconSize = 35;\r\n            const padding = 8;\r\n            const actualIconSize = iconSize - padding * 2;\r\n            const halfSize = actualIconSize / 2;\r\n\r\n            const modeOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'fill',\r\n                        label: BB.createSvg({\r\n                            class: 'dark-invert',\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: '#000',\r\n                                    style: `transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-fill'),\r\n                    },\r\n                    {\r\n                        id: 'stroke',\r\n                        label: BB.createSvg({\r\n                            class: 'dark-invert',\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: 'none',\r\n                                    stroke: '#000',\r\n                                    style: `stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-stroke'),\r\n                    },\r\n                ],\r\n                initId: brush.getMode(),\r\n                onChange: (id: string): void => {\r\n                    brush.setMode(id as 'stroke' | 'fill');\r\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === 'fill';\r\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\r\n\r\n                    const brushSize = brush.getSize();\r\n                    sizeSlider.setValue(brushSize);\r\n                    p.onSizeChange(brushSize);\r\n                    p.onConfigChange();\r\n                },\r\n            });\r\n\r\n            const mirrorXToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    class: 'dark-invert',\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`,\r\n                        },\r\n                    ],\r\n                }),\r\n                title: LANG('brush-chemy-mirror-x'),\r\n                init: brush.getXSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setXSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const mirrorYToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    class: 'dark-invert',\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`,\r\n                        },\r\n                    ],\r\n                }),\r\n                title: LANG('brush-chemy-mirror-y'),\r\n                init: brush.getYSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setYSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const gradientToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    class: 'dark-invert',\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'defs',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'linearGradient',\r\n                                    id: 'gradient',\r\n                                    x1: '0',\r\n                                    y1: '0',\r\n                                    x2: '0',\r\n                                    y2: '1',\r\n                                    childrenArr: [\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '0%',\r\n                                            'stop-color': 'rgba(0,0,0,0)',\r\n                                        },\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '100%',\r\n                                            'stop-color': 'rgba(0,0,0,1)',\r\n                                        },\r\n                                    ],\r\n                                },\r\n                            ],\r\n                        },\r\n                        {\r\n                            elementType: 'rect',\r\n                            fill: \"url('#gradient')\",\r\n                            x: '' + padding,\r\n                            y: '' + padding,\r\n                            width: '' + actualIconSize,\r\n                            height: '' + actualIconSize,\r\n                        },\r\n                    ],\r\n                }),\r\n                title: LANG('brush-chemy-gradient'),\r\n                init: brush.getGradient(),\r\n                onChange: (b) => {\r\n                    brush.setGradient(b);\r\n                },\r\n            });\r\n\r\n            BB.css(mirrorXToggle.getElement(), {\r\n                marginLeft: '10px',\r\n            });\r\n            {\r\n                const margin = {\r\n                    marginLeft: '4px',\r\n                };\r\n                BB.css(mirrorYToggle.getElement(), margin);\r\n                BB.css(gradientToggle.getElement(), margin);\r\n            }\r\n\r\n            toggleRow.append(\r\n                modeOptions.getElement(),\r\n                mirrorXToggle.getElement(),\r\n                mirrorYToggle.getElement(),\r\n                gradientToggle.getElement(),\r\n            );\r\n\r\n            div.append(\r\n                sizeSlider.getElement(),\r\n                opacitySlider.getElement(),\r\n                toggleRow,\r\n                BB.el({\r\n                    content: [\r\n                        lockAlphaToggle.getElement(),\r\n                        eraserToggle.getElement(),\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                    },\r\n                })\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"371uF\");","import {BB} from '../../../bb/bb';\r\nimport {DynamicModal} from './base/dynamic-modal';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showIframeModal (\r\n    url: string,\r\n    isEmbed: boolean,\r\n) {\r\n\r\n    // window very small, modal might look bad\r\n    if (!isEmbed && (window.innerHeight < 500 || window.innerWidth < 700)) {\r\n        window.open(url);\r\n        return;\r\n    }\r\n\r\n    const iframe = BB.el({\r\n        tagName: 'iframe',\r\n        custom: {\r\n            src: url,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            height: '100%',\r\n            opacity: '0',\r\n        },\r\n    }) as HTMLIFrameElement;\r\n    setTimeout(() => {\r\n        iframe.style.opacity = ''; // fallback\r\n    }, 500);\r\n\r\n    const titleEl = BB.el();\r\n\r\n    let linkEl: HTMLElement | undefined;\r\n    if (!isEmbed) {\r\n        linkEl = BB.el({\r\n            tagName: 'a',\r\n            parent: titleEl,\r\n            content: LANG('modal-new-tab'),\r\n            custom: {\r\n                href: 'help',\r\n                target: '_blank',\r\n            },\r\n            onClick: function () {\r\n                popup.close();\r\n            },\r\n        }) as HTMLAnchorElement;\r\n        iframe.onload = () => {\r\n            if (linkEl && iframe.contentWindow) {\r\n                BB.setAttributes(linkEl, {\r\n                    href: '' + iframe.contentWindow.location,\r\n                });\r\n            }\r\n            iframe.style.opacity = '';\r\n        };\r\n    }\r\n\r\n\r\n    const popup = new DynamicModal({\r\n        title: titleEl,\r\n        content: iframe,\r\n        width: 880,\r\n        isMaxHeight: true,\r\n        onClose: () => {\r\n            if (linkEl) {\r\n                iframe.src = 'about:blank';\r\n                BB.destroyEl(linkEl);\r\n                linkEl = undefined;\r\n            }\r\n        },\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nexport class RadioList {\r\n\r\n    el: HTMLDivElement;\r\n    inputs: HTMLInputElement[] = [];\r\n\r\n    constructor ({name, init, items, ignoreFocus}: {\r\n        name: string;\r\n        init?: string;\r\n        items: {\r\n            label: string;\r\n            value: string;\r\n        }[];\r\n        ignoreFocus?: boolean; // default false\r\n    }) {\r\n        this.el = BB.el({\r\n            className: 'kl-radio',\r\n        }) as HTMLDivElement;\r\n\r\n        items.forEach(item => {\r\n            const label = BB.el({\r\n                tagName: 'label',\r\n            });\r\n            const input = BB.el({\r\n                tagName: 'input',\r\n                parent: label,\r\n                custom: {\r\n                    name: name,\r\n                    value: item.value,\r\n                    type: 'radio',\r\n                },\r\n            }) as HTMLInputElement;\r\n            if (ignoreFocus) {\r\n                input.setAttribute('data-ignore-focus', 'true');\r\n            }\r\n            if (init === item.value) {\r\n                input.checked = true;\r\n            }\r\n            label.append(item.label);\r\n            this.el.append(label);\r\n            this.inputs.push(input);\r\n        });\r\n    }\r\n\r\n\r\n    getValue (): string | null {\r\n        for (let i = 0; i < this.inputs.length; i++) {\r\n            if (this.inputs[i].checked) {\r\n                return this.inputs[i].value;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getElement () {\r\n        return this.el;\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\r\nimport {IKlProject} from '../../kl-types';\r\nimport {showIframeModal} from '../modals/show-iframe-modal';\r\nimport {SaveReminder} from './save-reminder';\r\nimport {IProjectStoreListener, ProjectStore} from '../../storage/project-store';\r\nimport {KL} from '../../kl';\r\nimport {LANG} from '../../../language/language';\r\nimport {theme} from '../../../theme/theme';\r\n\r\nexport class BrowserStorageUi {\r\n\r\n    private previewEl: HTMLDivElement;\r\n    private readonly infoEl: HTMLElement;\r\n    private readonly ageEl: HTMLElement;\r\n    private readonly storeButtonEl: HTMLButtonElement;\r\n    private readonly clearButtonEl: HTMLButtonElement;\r\n    private readonly storeListener: IProjectStoreListener;\r\n    private readonly updateCheckerboard: () => void;\r\n\r\n    private timestamp: number;\r\n    private thumbnail: HTMLImageElement | HTMLCanvasElement | undefined;\r\n\r\n    private updateAge () {\r\n        if (!this.timestamp) {\r\n            return;\r\n        }\r\n        let age = new Date().getTime() - this.timestamp;\r\n        let ageStr;\r\n        age = Math.floor(age / 1000 / 60);\r\n        ageStr = LANG('file-storage-min-ago').replace('{x}', '' + age);\r\n        if (age > 60) {\r\n            age = Math.floor(age / 60);\r\n            ageStr = LANG('file-storage-hours-ago').replace('{x}', '' + age);\r\n            if (age > 24) {\r\n                age = Math.floor(age / 24);\r\n                ageStr = LANG('file-storage-days-ago').replace('{x}', '' + age);\r\n                if (age > 31) {\r\n                    ageStr = LANG('file-storage-month-ago');\r\n                }\r\n            }\r\n        }\r\n        this.ageEl.textContent = ageStr;\r\n    }\r\n\r\n    private resetButtons () {\r\n        if (this.timestamp) {\r\n            this.storeButtonEl.textContent = LANG('file-storage-overwrite');\r\n            this.storeButtonEl.disabled = false;\r\n            this.clearButtonEl.disabled = false;\r\n        } else {\r\n            this.storeButtonEl.textContent = LANG('file-storage-store');\r\n            this.storeButtonEl.disabled = false;\r\n            this.clearButtonEl.disabled = true;\r\n        }\r\n    }\r\n\r\n    private updateThumb (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.timestamp = timestamp;\r\n        this.thumbnail = thumbnail;\r\n        if (this.timestamp && thumbnail) {\r\n            thumbnail.classList.add('kl-storage-preview__im');\r\n            this.previewEl.innerHTML = '';\r\n            this.updateAge();\r\n            this.previewEl.append(thumbnail, this.ageEl);\r\n        } else {\r\n            this.previewEl.innerHTML = LANG('file-storage-empty');\r\n        }\r\n        this.resetButtons();\r\n    }\r\n\r\n    private async store () {\r\n        this.storeButtonEl.textContent = LANG('file-storage-storing');\r\n        this.storeButtonEl.disabled = true;\r\n        this.clearButtonEl.disabled = true;\r\n        await new Promise((resolve) => {\r\n            setTimeout(() => resolve(null), 20);\r\n        });\r\n        try {\r\n            await this.projectStore.store(this.getProject());\r\n            this.saveReminder.reset();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: [\r\n                    `${LANG('file-storage-failed-1')}<ul>`,\r\n                    `<li>${LANG('file-storage-failed-2')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-3')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-4')}</li>`,\r\n                    '</ul>',\r\n                ].join(''),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to store browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    private async clear () {\r\n        this.storeButtonEl.disabled = true;\r\n        this.clearButtonEl.disabled = true;\r\n        try {\r\n            await this.projectStore.clear();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: LANG('file-storage-failed-clear'),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to clear browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    element: HTMLDivElement;\r\n\r\n    constructor (\r\n        private projectStore: ProjectStore,\r\n        private getProject: () => IKlProject,\r\n        private saveReminder: SaveReminder,\r\n        private klRootEl: HTMLElement,\r\n        private options?: { hideClearButton?: boolean; isFocusable?: boolean }, // isFocusable default = false\r\n    ) {\r\n        this.element = BB.el({\r\n            css: {\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 0fr',\r\n                gridTemplateRows: '0fr 0fr 0fr',\r\n                gap: '0 0',\r\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"',\r\n            },\r\n        }) as HTMLDivElement;\r\n\r\n\r\n        const title = BB.el({\r\n            parent: this.element,\r\n            content: LANG('file-storage'),\r\n            css: {\r\n                gridArea: 'title',\r\n                display: 'flex',\r\n                margin: '-5px 0',\r\n                //background: '#f00',\r\n            },\r\n        });\r\n\r\n        this.infoEl = BB.el({\r\n            parent: title,\r\n            content: '?',\r\n            className: 'kl-storage-about',\r\n            title: LANG('file-storage-about'),\r\n            onClick: () => {\r\n                showIframeModal('./help/#help-browser-storage', false);\r\n            },\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.projectStore.isBroken()) {\r\n            BB.el({\r\n                parent: this.element,\r\n                content: ' ' + LANG('file-storage-cant-access'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            return;\r\n        }\r\n\r\n        this.previewEl = BB.el({\r\n            parent: this.element,\r\n            title: LANG('file-storage-thumb-title'),\r\n            className: 'kl-storage-preview',\r\n        }) as HTMLDivElement;\r\n        this.ageEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                right: '1px',\r\n                bottom: '1px',\r\n                width: 'calc(100% - 2px)',\r\n                textAlign: 'center',\r\n                background: 'rgba(0,0,0,0.7)',\r\n                color: '#fff',\r\n                textSize: '13px',\r\n            },\r\n        }) as HTMLDivElement;\r\n        const btnCustom = options?.isFocusable ?  {} : {\r\n            tabIndex: -1,\r\n        };\r\n        this.storeButtonEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'grid-button',\r\n            content: LANG('file-storage-store'),\r\n            css: {\r\n                gridArea: 'store',\r\n                //background: '#00f',\r\n            },\r\n            custom: btnCustom,\r\n            onClick: () => this.store(),\r\n        }) as HTMLButtonElement;\r\n        this.clearButtonEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'grid-button',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/> ' + LANG('file-storage-clear'),\r\n            css: {\r\n                gridArea: 'clear',\r\n                //background: '#ff0',\r\n            },\r\n            custom: btnCustom,\r\n            onClick: () => this.clear(),\r\n        }) as HTMLButtonElement;\r\n\r\n        if (this.options?.hideClearButton) {\r\n            this.clearButtonEl.style.visibility = 'hidden';\r\n        }\r\n\r\n        this.storeListener = {\r\n            onUpdate: (timestamp, thumbnail) => {\r\n                this.updateThumb(timestamp, thumbnail);\r\n            },\r\n        };\r\n        this.projectStore.subscribe(this.storeListener);\r\n\r\n        this.updateCheckerboard = (): void => {\r\n            if (!this.thumbnail) {\r\n                return;\r\n            }\r\n            BB.css(this.thumbnail, {\r\n                background: \"url('\" + BB.createCheckerCanvas(4, theme.isDark()).toDataURL('image/png') + \"')\",\r\n            });\r\n        };\r\n        theme.addIsDarkListener(this.updateCheckerboard);\r\n\r\n        setInterval(() => this.updateAge(), 1000 * 60);\r\n\r\n        (async () => {\r\n            try {\r\n                const readResult = await this.projectStore.read();\r\n                if (readResult) {\r\n                    this.updateThumb(readResult.timestamp, readResult.thumbnail);\r\n                } else {\r\n                    this.updateThumb();\r\n                }\r\n            } catch (e) {\r\n                setTimeout(() => {\r\n                    throw new Error('storage-ui: failed initial read browser storage, ' + e);\r\n                }, 0);\r\n            }\r\n        })();\r\n    }\r\n\r\n\r\n    getElement () {\r\n        return this.element;\r\n    }\r\n\r\n    show () {\r\n        // todo\r\n    }\r\n\r\n    hide () {\r\n        // todo\r\n    }\r\n\r\n    destroy () {\r\n        BB.destroyEl(this.infoEl);\r\n        BB.destroyEl(this.storeButtonEl);\r\n        BB.destroyEl(this.clearButtonEl);\r\n        theme.removeIsDarkListener(this.updateCheckerboard);\r\n        this.projectStore.unsubscribe(this.storeListener);\r\n    }\r\n}","import {IKlProject, IKlStorageProject} from '../kl-types';\r\nimport {ProjectConverter, TReadStorageProjectResult} from './project-converter';\r\nimport {clear, getKlProjectObj, storeKlProjectObj} from './indexed-db';\r\nimport {LocalStorage} from '../../bb/base/local-storage';\r\n\r\n\r\nexport interface IProjectStoreListener {\r\n    onUpdate: (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) => void;\r\n}\r\n\r\nfunction makeAsync<T> (\r\n    nonAsyncFunc: (\r\n        resolveCallback: (value: T) => void,\r\n        rejectCallback: (reason?: any) => void\r\n    ) => void,\r\n): Promise<T> {\r\n    return new Promise<T>((resolve, reject) => {\r\n        nonAsyncFunc(resolve, reject);\r\n    });\r\n}\r\n\r\n/**\r\n * simplified interface for storing projects into browser storage\r\n */\r\nexport class ProjectStore {\r\n\r\n    private listeners: IProjectStoreListener[] = [];\r\n    private accessHasFailed: boolean = false;\r\n\r\n    async lowLevelStore (project: IKlStorageProject): Promise<void> {\r\n        await new Promise<void>((resolve, reject) => {\r\n            storeKlProjectObj(project, resolve, reject);\r\n        });\r\n    }\r\n\r\n    async lowLevelRead (): Promise<IKlStorageProject> {\r\n        return await makeAsync(getKlProjectObj) as IKlStorageProject;\r\n    }\r\n\r\n    async lowLevelClear (): Promise<void> {\r\n        await makeAsync<void>(clear);\r\n    }\r\n\r\n\r\n\r\n    private emit (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement): void {\r\n        this.listeners.forEach(item => {\r\n            item.onUpdate(timestamp, thumbnail);\r\n        });\r\n    }\r\n\r\n    private updateTimestamp (): void {\r\n        LocalStorage.setItem('indexedDbUpdatedAt', '' + new Date().getTime());\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== 'indexedDbUpdatedAt' || this.listeners.length === 0) {\r\n                return;\r\n            }\r\n            try {\r\n                ( async (): Promise<void> => {\r\n                    const readResult = await this.read();\r\n                    if (readResult) {\r\n                        this.emit(readResult.timestamp, readResult.thumbnail);\r\n                    } else {\r\n                        this.emit();\r\n                    }\r\n                })();\r\n            } catch (e) {\r\n                if (e.message.indexOf('db-error') === 0) {\r\n                    this.accessHasFailed = true;\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    async read (): Promise<{\r\n        project: IKlProject;\r\n        timestamp: number;\r\n        thumbnail: HTMLImageElement | HTMLCanvasElement;\r\n    } | undefined> {\r\n        let storageProject;\r\n        try {\r\n            storageProject = await this.lowLevelRead();\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        if (!storageProject) {\r\n            return undefined;\r\n        }\r\n        let result;\r\n        try {\r\n            result = await ProjectConverter.readStorageProject(storageProject);\r\n        } catch (e) {\r\n            throw new Error('format-error: ' + e);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    async store (project: IKlProject): Promise<void> {\r\n        try {\r\n            const storageProject = ProjectConverter.createStorageProject(project);\r\n            await this.lowLevelStore(storageProject);\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        {\r\n            // immediately test if it can be read\r\n            const storageProject = await this.lowLevelRead();\r\n            let readResult: TReadStorageProjectResult;\r\n            try {\r\n                readResult = await ProjectConverter.readStorageProject(storageProject);\r\n            } catch (e) {\r\n                await this.lowLevelClear();\r\n                this.updateTimestamp();\r\n                setTimeout(() => this.emit(), 0);\r\n                throw new Error('format-error: ' + e);\r\n            }\r\n            this.updateTimestamp();\r\n            setTimeout(() => this.emit(readResult.timestamp, readResult.thumbnail), 0);\r\n        }\r\n    }\r\n\r\n    async clear (): Promise<void> {\r\n        await this.lowLevelClear();\r\n        this.updateTimestamp();\r\n        setTimeout(() => this.emit(), 0);\r\n    }\r\n\r\n    subscribe (listener: IProjectStoreListener): void {\r\n        if (this.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        this.listeners.push(listener);\r\n    }\r\n\r\n    unsubscribe (listener: IProjectStoreListener): void {\r\n        for (let i = 0; i < this.listeners.length; i++) {\r\n            if (listener === this.listeners[i]) {\r\n                this.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    isBroken (): boolean {\r\n        return this.accessHasFailed;\r\n    }\r\n\r\n}","import {IKlProject, IKlStorageProject} from '../kl-types';\r\nimport {BB} from '../../bb/bb';\r\nimport {drawProject} from '../canvas/draw-project';\r\nimport {base64ToBlob} from './base-64-to-blob';\r\n\r\nexport type TReadStorageProjectResult = {\r\n    project: IKlProject;\r\n    timestamp: number;\r\n    thumbnail: HTMLImageElement | HTMLCanvasElement;\r\n};\r\n\r\nconst thumbSize = 240;\r\n\r\nfunction loadImage (blob: Blob): Promise<HTMLImageElement> {\r\n    return new Promise<HTMLImageElement>((resolve, reject) => {\r\n        const im = new Image();\r\n        try {\r\n            im.src = BB.imageBlobToUrl(blob);\r\n        } catch (e) {\r\n            reject('imageBlobToUrl, ' + e.message);\r\n            return;\r\n        }\r\n        im.onload = (): void => {\r\n            URL.revokeObjectURL(im.src);\r\n            resolve(im);\r\n        };\r\n        im.onabort = (): void => {\r\n            reject('layer image failed loading');\r\n        };\r\n        im.onerror = (): void => {\r\n            reject('layer image failed loading');\r\n        };\r\n    });\r\n}\r\n\r\n/**\r\n * for:\r\n * - preparing project to be stored in ProjectStore\r\n * - reading a project that came out of the ProjectStore\r\n */\r\nexport class ProjectConverter {\r\n\r\n    private static createThumbnail (project: IKlProject): HTMLCanvasElement {\r\n        const size = BB.fitInto(project.width, project.height, thumbSize, thumbSize);\r\n        const factor = size.width / project.width;\r\n        return drawProject(project, factor);\r\n    }\r\n\r\n    static createStorageProject (project: IKlProject): IKlStorageProject {\r\n        return {\r\n            id: 1,\r\n            timestamp: new Date().getTime(),\r\n            thumbnail: base64ToBlob(ProjectConverter.createThumbnail(project).toDataURL('image/png')),\r\n            width: project.width,\r\n            height: project.height,\r\n            layers: project.layers.map(item => {\r\n                let blob;\r\n                if (item.image instanceof HTMLCanvasElement) {\r\n                    blob = base64ToBlob((item.image as HTMLCanvasElement).toDataURL('image/png'));\r\n                } else {\r\n                    // todo image\r\n                    throw new Error('Not implemented');\r\n                }\r\n                return {\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                    blob,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    static async readStorageProject (storageProject: IKlStorageProject): Promise<TReadStorageProjectResult> {\r\n        if (\r\n            !storageProject.width || !storageProject.height ||\r\n            isNaN(storageProject.width) || isNaN(storageProject.height) ||\r\n            storageProject.width < 1 || storageProject.height < 1\r\n        ) {\r\n            throw new Error('readStorageProject invalid canvas size: ' + storageProject.width + ', ' + storageProject.height);\r\n        }\r\n        const project: IKlProject = {\r\n            width: storageProject.width,\r\n            height: storageProject.height,\r\n            layers: (await Promise.all(storageProject.layers.map(layer => loadImage(layer.blob))))\r\n                .map((image, i) => {\r\n                    return {\r\n                        name: storageProject.layers[i].name,\r\n                        opacity: storageProject.layers[i].opacity,\r\n                        mixModeStr: storageProject.layers[i].mixModeStr,\r\n                        image,\r\n                    };\r\n                }),\r\n        };\r\n\r\n        let thumbnail;\r\n        if (storageProject.thumbnail) {\r\n            thumbnail = await loadImage(storageProject.thumbnail);\r\n        } else {\r\n            thumbnail = ProjectConverter.createThumbnail(project);\r\n        }\r\n\r\n        return {\r\n            project: project,\r\n            timestamp: storageProject.timestamp,\r\n            thumbnail: thumbnail,\r\n        };\r\n    }\r\n\r\n}","\r\nexport function base64ToBlob (base64Str: string): Blob {\r\n    const parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n    const binStr = atob(parts[3]);\r\n    const buf = new ArrayBuffer(binStr.length);\r\n    const view = new Uint8Array(buf);\r\n    for (let i = 0; i < view.length; i++) {\r\n        view[i] = binStr.charCodeAt(i);\r\n    }\r\n    return new Blob([view], {'type': parts[1]});\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {BrowserStorageUi} from '../components/browser-storage-ui';\r\nimport {IKlProject, TDropOption, TExportType} from '../../kl-types';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {LANG} from '../../../language/language';\r\nimport newImageImg from '/src/app/img/ui/new-image.svg';\r\nimport exportImg from '/src/app/img/ui/export.svg';\r\nimport shareImg from '/src/app/img/ui/share.svg';\r\nimport uploadImg from '/src/app/img/ui/upload.svg';\r\nimport importImg from '/src/app/img/ui/import.svg';\r\nimport copyImg from '/src/app/img/ui/copy.svg';\r\n\r\nexport class FileTab {\r\n\r\n    private readonly rootEl: HTMLDivElement;\r\n    private importButton: undefined | HTMLInputElement;\r\n    private fileBrowserStorage: undefined | BrowserStorageUi;\r\n\r\n    constructor (\r\n        klRootEl: HTMLElement,\r\n        projectStore: ProjectStore,\r\n        getProject: () => IKlProject,\r\n        private exportType: TExportType,\r\n        onExportTypeChange: (type: TExportType) => void,\r\n        onFileSelect: (fileList: FileList, optionStr: TDropOption) => void,\r\n        onSaveImageToComputer: () => void,\r\n        onNewImage: () => void,\r\n        onShareImage: (callback: () => void) => void,\r\n        onUpload: () => void,\r\n        onCopyToClipboard: () => void,\r\n        saveReminder: SaveReminder,\r\n    ) {\r\n        this.rootEl = document.createElement('div');\r\n\r\n        const asyncCreation = (): void => {\r\n            const fileMenu = document.createElement('div');\r\n            const newButton = document.createElement('button');\r\n            const saveButton = document.createElement('button');\r\n            const shareButton = document.createElement('button');\r\n            const uploadImgurButton = document.createElement('button');\r\n            const clipboardButton = document.createElement('button');\r\n\r\n            newButton.style.cssFloat = 'left';\r\n            BB.css(saveButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n                flexGrow: '1',\r\n            });\r\n            BB.css(clipboardButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n            });\r\n\r\n            newButton.tabIndex = -1;\r\n            saveButton.tabIndex = -1;\r\n            shareButton.tabIndex = -1;\r\n            uploadImgurButton.tabIndex = -1;\r\n            clipboardButton.tabIndex = -1;\r\n\r\n            newButton.innerHTML = `<img class=\"dark-no-invert\" src='${newImageImg}' alt='icon' height='20'/>${LANG('file-new')}`;\r\n            saveButton.innerHTML = `<img src='${exportImg}' alt='icon' height='20'/>${LANG('file-save')}`;\r\n            shareButton.innerHTML = `<img src='${shareImg}' alt='icon' height='20'/>${LANG('file-share')}`;\r\n            uploadImgurButton.innerHTML = `<img style='float:left' src='${uploadImg}' height='20' alt='icon'/>${LANG('file-upload')}`;\r\n            clipboardButton.innerHTML = `<img src='${copyImg}' alt='icon' height='20'/>${LANG('file-copy')}`;\r\n            clipboardButton.title = LANG('file-copy-title');\r\n            newButton.className = 'grid-button';\r\n            saveButton.className = 'grid-button';\r\n            shareButton.className = 'grid-button';\r\n            uploadImgurButton.className = 'grid-button';\r\n            clipboardButton.className = 'grid-button';\r\n\r\n            const importWrapper = BB.el({\r\n                className: 'grid-button',\r\n                css: {\r\n                    position: 'relative',\r\n                    cursor: 'pointer',\r\n                    cssFloat: 'left',\r\n                },\r\n            });\r\n            const innerMask = BB.el({\r\n                parent: importWrapper,\r\n                css: {\r\n                    width: '120px',\r\n                    height: '28px',\r\n                    overflow: 'hidden',\r\n                    cursor: 'pointer',\r\n                    position: 'relative',\r\n                },\r\n            });\r\n            this.importButton = BB.el({\r\n                tagName: 'input',\r\n                parent: innerMask,\r\n                css: {\r\n                    display: 'none',\r\n                },\r\n            }) as HTMLInputElement;\r\n            this.importButton.tabIndex = -1;\r\n            this.importButton.type = 'file';\r\n            this.importButton.multiple = true;\r\n            this.importButton.accept = 'image';\r\n            this.importButton.size = 71;\r\n            this.importButton.onchange = () => {\r\n                if (!this.importButton) {\r\n                    return;\r\n                }\r\n                this.importButton.files && onFileSelect(this.importButton.files, 'default');\r\n                this.importButton.value = '';\r\n            };\r\n\r\n            const importFakeButton = BB.el({\r\n                tagName: 'button',\r\n                parent: importWrapper,\r\n                content: \"<img class=\\\"dark-no-invert\\\" style='float:left' height='20' src='\" + importImg + \"' alt='icon'/>\" + LANG('file-import'),\r\n                css: {\r\n                    width: '120px',\r\n                    display: 'box',\r\n                    position: 'absolute',\r\n                    left: '0',\r\n                    top: '0',\r\n                    cursor: 'pointer',\r\n                },\r\n            }) as HTMLButtonElement;\r\n            importFakeButton.tabIndex = -1;\r\n            importFakeButton.onclick = () => this.importButton && this.importButton.click();\r\n\r\n            // --- export filetype dropdown ---\r\n            const exportTypeSelect = new KL.Select({\r\n                optionArr: [\r\n                    ['png', 'PNG'],\r\n                    ['psd', 'PSD'],\r\n                    ['layers', LANG('layers') + ' (PNG)'],\r\n                ],\r\n                initValue: this.exportType,\r\n                onChange: (val) => {\r\n                    this.exportType = val as TExportType;\r\n                    onExportTypeChange(this.exportType);\r\n                    onSaveImageToComputer();\r\n                },\r\n                title: LANG('file-format'),\r\n            });\r\n            BB.css(exportTypeSelect.getElement(), {\r\n                width: '50%',\r\n                height: '30px',\r\n                marginTop: '10px',\r\n                marginLeft: '10px',\r\n            });\r\n\r\n\r\n\r\n            newButton.onclick = onNewImage;\r\n            saveButton.onclick = () => {\r\n                onSaveImageToComputer();\r\n            };\r\n            shareButton.onclick = () => {\r\n                shareButton.disabled = true;\r\n                onShareImage(() => {\r\n                    shareButton.disabled = false;\r\n                });\r\n            };\r\n            uploadImgurButton.onclick = () => onUpload();\r\n\r\n            clipboardButton.onclick = () => {\r\n                clipboardButton.blur();\r\n                onCopyToClipboard();\r\n            };\r\n\r\n            const saveNote = BB.el({\r\n                className: 'kl-toolspace-note',\r\n                textContent: LANG('file-no-autosave'),\r\n                css: {\r\n                    margin: '10px 10px 0 10px',\r\n                },\r\n            });\r\n\r\n            const createSpacer = () => {\r\n                const el = document.createElement('div');\r\n                const clearer = document.createElement('div');\r\n                const line = BB.el({\r\n                    className: 'grid-hr',\r\n                });\r\n                el.append(clearer, line);\r\n                BB.css(clearer, {\r\n                    clear: 'both',\r\n                });\r\n                return el;\r\n            };\r\n\r\n            this.fileBrowserStorage = new BrowserStorageUi(projectStore, getProject, saveReminder, klRootEl);\r\n            BB.css(this.fileBrowserStorage.getElement(), {\r\n                //background: 'red',\r\n                margin: '10px',\r\n            });\r\n\r\n            const saveRow = BB.el({\r\n                content: [saveButton, exportTypeSelect.getElement()],\r\n                className: 'kl-file-save-row',\r\n            });\r\n\r\n            //actual structure\r\n            BB.append(fileMenu, [\r\n                saveNote,\r\n                newButton,\r\n                importWrapper,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                saveRow,\r\n\r\n                clipboardButton,\r\n                BB.canShareFiles() ? shareButton : undefined,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                createSpacer(),\r\n                this.fileBrowserStorage.getElement(),\r\n                createSpacer(),\r\n                uploadImgurButton,\r\n            ]);\r\n\r\n            this.rootEl.append(fileMenu);\r\n        };\r\n\r\n        setTimeout(asyncCreation, 1);\r\n    }\r\n\r\n    refresh (): void {\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (isVisible: boolean): void {\r\n        if (isVisible) {\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    triggerImport (): void {\r\n        this.importButton && this.importButton.click();\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"gJzzT\");","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {IKeyString} from '../../../bb/bb-types';\r\nimport {StatusOverlay} from '../components/status-overlay';\r\nimport {KlCanvasWorkspace} from '../../canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\nimport {LayerManager} from './layer-manager/layer-manager';\r\nimport {HandUi} from './hand-ui';\r\nimport {RGB} from '../../../bb/color/color';\r\n\r\n\r\nexport class FilterTab {\r\n\r\n    private readonly rootEl: HTMLDivElement;\r\n    private isInit = false;\r\n\r\n    constructor (\r\n        private klRootEl: HTMLElement,\r\n        private klColorSlider: KlColorSlider,\r\n        private layerManager: LayerManager,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private handUi: HandUi,\r\n        private getCurrentColor: () => RGB,\r\n        private getKlMaxCanvasSize: () => number,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx: () => CanvasRenderingContext2D | null,\r\n        private isEmbed: boolean,\r\n        private statusOverlay: StatusOverlay,\r\n    ) {\r\n        this.rootEl = document.createElement('div');\r\n    }\r\n\r\n    private init (): void {\r\n        const filters = KL.filterLib;\r\n        const buttons = [];\r\n\r\n        if (!KL.filterLibStatus.isLoaded) {\r\n            throw new Error('filters not loaded');\r\n        }\r\n\r\n        const createButton = (filterKey: string): HTMLElement => {\r\n            const button = document.createElement('button');\r\n            const buttonLabel = LANG(filters[filterKey].lang.button);\r\n            const imClass = filters[filterKey].darkNoInvert ? 'class=\"dark-no-invert\"' : '';\r\n            const im = '<img ' + imClass + ' height=\"20\" width=\"18\" src=\"' + filters[filterKey].icon + '\" alt=\"icon\" />';\r\n            button.innerHTML = im + buttonLabel;\r\n            button.className = 'grid-button';\r\n            BB.css(button, {\r\n                lineHeight: '20px',\r\n                fontSize: '12px',\r\n            });\r\n            button.tabIndex = -1;\r\n\r\n            const filterName = LANG(filters[filterKey].lang.name);\r\n\r\n            button.onclick = () => {\r\n\r\n                const finishedDialog = (result, filterDialog): void => {\r\n                    if (result == 'Cancel') {\r\n                        if (filterDialog.destroy) {\r\n                            filterDialog.destroy();\r\n                        }\r\n                        return;\r\n                    }\r\n                    let input;\r\n                    try {\r\n                        input = filterDialog.getInput(); // also destroys\r\n                    } catch (e) {\r\n                        if (e.message.indexOf('.getInput is not a function') !== -1) {\r\n                            throw 'filterDialog.getInput is not a function, filter: ' + filterName;\r\n                        } else {\r\n                            throw e;\r\n                        }\r\n                    }\r\n                    applyFilter(input);\r\n                };\r\n\r\n                if (!('apply' in filters[filterKey])) {\r\n                    alert('Application not fully loaded');\r\n                    return;\r\n                }\r\n\r\n                const applyFilter = (input: any) => {\r\n                    const filterResult = filters[filterKey].apply({\r\n                        context: this.getCurrentLayerCtx(),\r\n                        klCanvas: this.getKlCanvas(),\r\n                        history: klHistory,\r\n                        input: input,\r\n                    } as IFilterApply);\r\n                    if (filterResult === false) {\r\n                        alert(\"Couldn't apply the edit action\");\r\n                    }\r\n                    if (filters[filterKey].updatePos === true) {\r\n                        this.klCanvasWorkspace.resetView();\r\n                        this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                    this.layerManager.update();\r\n                };\r\n\r\n                if (filters[filterKey].isInstant){\r\n                    button.blur();\r\n                    applyFilter(null);\r\n                    this.statusOverlay.out('\"' + filterName + '\" ' + LANG('filter-applied'), true);\r\n                } else {\r\n                    const secondaryColorRGB = this.klColorSlider.getSecondaryRGB();\r\n                    const filterDialog = filters[filterKey].getDialog({\r\n                        context: this.getCurrentLayerCtx(),\r\n                        klCanvas: this.getKlCanvas(),\r\n                        maxWidth: this.getKlMaxCanvasSize(),\r\n                        maxHeight: this.getKlMaxCanvasSize(),\r\n                        currentColorRgb: {r: this.getCurrentColor().r, g: this.getCurrentColor().g, b: this.getCurrentColor().b},\r\n                        secondaryColorRgb: {r: secondaryColorRGB.r, g: secondaryColorRGB.g, b: secondaryColorRGB.b},\r\n                    } as IFilterGetDialogParam) as IFilterGetDialogResult;\r\n\r\n                    if (!filterDialog) {\r\n                        return;\r\n                        //alert('Error: could not perform action');\r\n                        //throw('filter['+filterKey+'].getDialog returned '+filterDialog+'. ctx:' + currentLayerCtx + ' klCanvas:' + klCanvas);\r\n                    }\r\n\r\n                    let closeFunc: () => void;\r\n                    // Todo should move into getDialogParams\r\n                    filterDialog.errorCallback = (e) => {\r\n                        setTimeout(() => {\r\n                            alert('Error: could not perform action');\r\n                            throw e;\r\n                        }, 0);\r\n                        closeFunc();\r\n                    };\r\n\r\n\r\n                    const style: IKeyString = {};\r\n                    if ('width' in filterDialog) {\r\n                        style.width = filterDialog.width + 'px';\r\n                    }\r\n\r\n                    KL.popup({\r\n                        target: this.klRootEl,\r\n                        message: '<b>' + filterName + '</b>',\r\n                        div: filterDialog.element,\r\n                        style: style,\r\n                        buttons: ['Ok', 'Cancel'],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: (result) => {\r\n                            finishedDialog(result, filterDialog);\r\n                        },\r\n                        closeFunc: (func) => {\r\n                            closeFunc = func;\r\n                        },\r\n                    });\r\n                }\r\n            };\r\n            buttons[buttons.length] = button;\r\n            return button;\r\n        };\r\n\r\n        const addGroup = (groupArr: string[]): void => {\r\n            Object.entries(filters).forEach(([filterKey, filter]) => {\r\n                if (!groupArr.includes(filterKey)) {\r\n                    return;\r\n                }\r\n                if (this.isEmbed && !filter.inEmbed) {\r\n                    return;\r\n                }\r\n                this.rootEl.append(createButton(filterKey));\r\n            });\r\n        };\r\n\r\n        const groupA = [\r\n            'cropExtend',\r\n            'flip',\r\n            'perspective',\r\n            'resize',\r\n            'rotate',\r\n            'transform',\r\n        ];\r\n        const groupB = [\r\n            'brightnessContrast',\r\n            'curves',\r\n            'distort',\r\n            'hueSaturation',\r\n            'invert',\r\n            'tiltShift',\r\n            'toAlpha',\r\n            'blur',\r\n            'unsharpMask',\r\n        ];\r\n        const groupC = [\r\n            'grid',\r\n            'noise',\r\n            'pattern',\r\n            'vanishPoint',\r\n        ];\r\n\r\n        addGroup(groupA);\r\n        this.rootEl.append(BB.el({className: 'grid-hr'}));\r\n        addGroup(groupB);\r\n        this.rootEl.append(BB.el({className: 'grid-hr'}));\r\n        addGroup(groupC);\r\n\r\n        this.isInit = true;\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    show (): void {\r\n        if (!this.isInit) {\r\n            this.init();\r\n        }\r\n        this.rootEl.style.display = 'block';\r\n    }\r\n\r\n    hide (): void {\r\n        this.rootEl.style.display = 'none';\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {base64ToBlob} from '../../storage/base-64-to-blob';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\nimport loadingImg from '/src/app/img/ui/loading.gif';\r\n\r\ntype TImgurUploadResponse = {\r\n    // just a subset\r\n    id: string;\r\n    datetime: number;\r\n    type: string;\r\n    width: number;\r\n    height: number;\r\n    deletehash: string;\r\n    name: string;\r\n    link: string;\r\n};\r\n\r\n/**\r\n * uploads canvas, opens new tab with the upload progress & then opens the image page.\r\n */\r\nasync function upload (\r\n    canvas: HTMLCanvasElement,\r\n    title: string,\r\n    description: string,\r\n    type: 'png' | 'jpeg',\r\n    imgurKey: string,\r\n): Promise<TImgurUploadResponse> {\r\n    const img = base64ToBlob(canvas.toDataURL('image/' + type));\r\n\r\n    const w = window.open();\r\n\r\n    if (!w) {\r\n        throw new Error('could not create new tab');\r\n    }\r\n\r\n    const label = w.document.createElement('div');\r\n    const gif = w.document.createElement('img');\r\n    gif.src = loadingImg;\r\n    label.append(gif);\r\n    BB.css(gif, {\r\n        filter: 'invert(1)',\r\n    });\r\n    BB.css(w.document.body, {\r\n        backgroundColor: '#121211',\r\n        backgroundImage: 'linear-gradient(#2b2b2b 0%, #121211 50%)',\r\n        backgroundRepeat: 'no-repeat',\r\n    });\r\n    \r\n    const labelText = w.document.createElement('div');\r\n    labelText.style.marginTop = '10px';\r\n    label.append(labelText);\r\n    labelText.textContent = LANG('upload-uploading');\r\n\r\n    w.document.body.append(label);\r\n    BB.css(label, {\r\n        marginLeft: 'auto',\r\n        marginRight: 'auto',\r\n        marginTop: '100px',\r\n        fontFamily: 'Arial, sans-serif',\r\n        fontSize: '20px',\r\n        textAlign: 'center',\r\n        transition: 'opacity 0.3s ease-in-out',\r\n        opacity: '0',\r\n        color: '#ccc',\r\n    });\r\n    setTimeout(function () {\r\n        label.style.opacity = '1';\r\n    }, 20);\r\n\r\n    let response;\r\n    try {\r\n        const formData = new FormData();\r\n        formData.append('title', title);\r\n        formData.append('description', description);\r\n        formData.append('image', img);\r\n        response = await fetch('https://api.imgur.com/3/image',  {\r\n            method: 'POST',\r\n            headers: {\r\n                Authorization: 'Client-ID ' + imgurKey,\r\n            },\r\n            body: formData,\r\n        });\r\n\r\n    } catch (e) {\r\n        w.close();\r\n        throw new Error(e);\r\n    }\r\n    if (!response.ok) {\r\n        w.close();\r\n        throw new Error();\r\n    }\r\n    const data: TImgurUploadResponse = (await response.json()).data;\r\n\r\n    w.location.href = data.link.replace(/\\.(jpg|png)/, '');\r\n\r\n    return data;\r\n}\r\n\r\n\r\nexport function imgurUpload (\r\n    klCanvas: KlCanvas,\r\n    klRootEl: HTMLElement,\r\n    saveReminder: SaveReminder,\r\n    imgurKey: string, // API key\r\n): void {\r\n    if (!imgurKey) {\r\n        throw new Error('imgur key missing');\r\n    }\r\n\r\n    const inputTitle = BB.el({tagName: 'input'}) as HTMLInputElement;\r\n    inputTitle.type = 'text';\r\n    inputTitle.value = LANG('upload-title-untitled');\r\n    const inputDescription = BB.el({\r\n        tagName: 'textarea',\r\n        custom: {\r\n            rows: 2,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            maxWidth: '100%',\r\n        },\r\n    }) as HTMLTextAreaElement;\r\n\r\n    const labelTitle =  BB.el({\r\n        textContent: LANG('upload-name') + ':',\r\n    });\r\n    const labelDescription = BB.el({\r\n        textContent: LANG('upload-caption') + ':',\r\n        css: {\r\n            marginTop: '10px',\r\n        },\r\n    });\r\n\r\n    const tos = BB.el({\r\n        content: `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${LANG('terms-of-service')}</a>`,\r\n    });\r\n\r\n    const typeRadio = new KL.RadioList({\r\n        name: 'filetype',\r\n        init: 'jpeg',\r\n        items: [\r\n            { label: 'JPG', value: 'jpeg' },\r\n            { label: 'PNG', value: 'png' },\r\n        ],\r\n        ignoreFocus: true,\r\n    });\r\n    BB.css(typeRadio.getElement(), {\r\n        marginBottom: '10px',\r\n    });\r\n\r\n\r\n    const outDiv = BB.el();\r\n    const infoHint = BB.el({\r\n        className: 'info-hint',\r\n        textContent: LANG('upload-link-notice'),\r\n    });\r\n    outDiv.append(\r\n        infoHint,\r\n        typeRadio.getElement(),\r\n        labelTitle,\r\n        inputTitle,\r\n        labelDescription,\r\n        inputDescription,\r\n        tos\r\n    );\r\n    KL.popup({\r\n        target: klRootEl,\r\n        message: `<b>${LANG('upload-title')}</b>`,\r\n        type: 'upload',\r\n        div: outDiv,\r\n        buttons: [LANG('upload-submit'), 'Cancel'],\r\n        clickOnEnter: LANG('upload-submit'),\r\n        primaries: [LANG('upload-submit')],\r\n        autoFocus: LANG('upload-submit'),\r\n        callback: async function (val) {\r\n            if (val === LANG('upload-submit') || val === 'Yes' || val === 'Ok') {\r\n                try {\r\n                    const result = await upload(\r\n                        klCanvas.getCompleteCanvas(1),\r\n                        inputTitle.value,\r\n                        inputDescription.value,\r\n                        typeRadio.getValue() as 'png' | 'jpeg',\r\n                        imgurKey,\r\n                    );\r\n\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: 'ok',\r\n                        message: `<h3>${LANG('upload-success')}</h3><br>${LANG('upload-delete')}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/delete/${result.deletehash}</a><br><br>`,\r\n                        buttons: ['Ok'],\r\n                    });\r\n                    saveReminder.reset();\r\n\r\n                } catch(e) {\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: 'error',\r\n                        message: LANG('upload-failed'),\r\n                        buttons: ['Ok'],\r\n                    });\r\n                }\r\n            }\r\n        },\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"c3ZSC\");","import {KL} from '../../kl';\r\nimport {BB} from '../../../bb/bb';\r\nimport {KlHistoryInterface} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\nimport {BrowserStorageUi} from './browser-storage-ui';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {IKlProject} from '../../kl-types';\r\n\r\n\r\nconst reminderTimelimitMs = 1000 * 60 * 20; // 20 minutes\r\nconst unsavedActionsLimit = 100; // number of actions user did since last save\r\n\r\n\r\n/**\r\n * remind user of saving, keep user aware of save state\r\n */\r\nexport class SaveReminder {\r\n    private lastSavedActionNumber: number = null;\r\n    private lastSavedAt: number;\r\n\r\n    private lastReminderShownAt: number;\r\n    private unsavedInterval;\r\n    private closeFunc: () => void;\r\n\r\n    showPopup (): void {\r\n        if (!this.projectStore || !this.getProject) {\r\n            throw new Error('projectStore and getProject need to be set');\r\n        }\r\n\r\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\r\n\r\n        const contentEl = BB.el();\r\n\r\n        contentEl.append(\r\n            BB.el({\r\n                content: LANG(\r\n                    'save-reminder-text',\r\n                    {\r\n                        a: '<strong>' + min,\r\n                        b: '</strong>',\r\n                    }\r\n                ),\r\n                css: {\r\n                    marginBottom: '20px',\r\n                },\r\n            }),\r\n        );\r\n\r\n        const psdWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n            },\r\n        });\r\n        const storageWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n                paddingBottom: '0',\r\n            },\r\n        });\r\n        contentEl.append(psdWrapper, storageWrapper);\r\n\r\n\r\n        const psdBtn = BB.el({\r\n            tagName: 'button',\r\n            className: 'kl-button',\r\n            content: LANG('save-reminder-save-psd'),\r\n            onClick: () => this.onSaveAsPsd(),\r\n        });\r\n        psdWrapper.append(\r\n            psdBtn,\r\n            BB.el({\r\n                content: LANG('save-reminder-psd-layers'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            }),\r\n        );\r\n\r\n\r\n        const storageUi = new BrowserStorageUi(\r\n            this.projectStore,\r\n            this.getProject,\r\n            this,\r\n            document.body as any,\r\n            {\r\n                hideClearButton: true,\r\n                isFocusable: true,\r\n            }\r\n        );\r\n        storageWrapper.append(storageUi.getElement());\r\n\r\n\r\n        KL.popup({\r\n            target: document.body,\r\n            message: `<b>${LANG('save-reminder-title')}</b>`,\r\n            div: contentEl,\r\n            ignoreBackground: true,\r\n            callback: () => {\r\n                storageUi.destroy();\r\n                BB.destroyEl(psdBtn);\r\n                this.closeFunc = null;\r\n                this.lastReminderShownAt = performance.now();\r\n            },\r\n            closeFunc: (f) => {\r\n                this.closeFunc = f;\r\n            },\r\n        });\r\n        setTimeout(() => {\r\n            psdBtn.focus();\r\n        }, 40);\r\n    }\r\n\r\n    constructor (\r\n        private history: KlHistoryInterface,\r\n        private showReminder: boolean,\r\n        private changeTitle: boolean,\r\n        private onSaveAsPsd: () => void,\r\n        private isDrawing: () => boolean,\r\n        private projectStore: ProjectStore | null, // needed if showReminder\r\n        private getProject: (() => IKlProject) | null, // needed if showReminder\r\n        private title: string = 'Klecks',\r\n    ) { }\r\n\r\n    init (): void {\r\n        if (this.lastSavedActionNumber !== null) { // already initialized\r\n            return;\r\n        }\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n\r\n        if (this.showReminder) {\r\n            setInterval(() => {\r\n                if (document.visibilityState !== 'visible') {\r\n                    return;\r\n                }\r\n\r\n                const unsavedActions = Math.abs(this.history.getActionNumber() - this.lastSavedActionNumber);\r\n\r\n                if (\r\n                    KL.dialogCounter.get() === 0 &&\r\n                    !this.isDrawing() &&\r\n                    this.lastReminderShownAt + reminderTimelimitMs < performance.now() &&\r\n                    unsavedActions >= unsavedActionsLimit\r\n                ) {\r\n                    this.showPopup();\r\n                }\r\n            }, 1000 * 5);\r\n        }\r\n\r\n        // confirmation dialog when closing tab\r\n        function onBeforeUnload (e) {\r\n            e.preventDefault();\r\n            e.returnValue = '';\r\n        }\r\n\r\n        this.history.addListener(() => {\r\n            const actionNumber = this.history.getActionNumber();\r\n            if (this.lastSavedActionNumber !== actionNumber) {\r\n                window.onbeforeunload =  onBeforeUnload;\r\n            } else {\r\n                window.onbeforeunload = null;\r\n            }\r\n        });\r\n\r\n        if (this.changeTitle) {\r\n            document.addEventListener('visibilitychange', () => {\r\n                if (document.visibilityState === 'visible') {\r\n                    document.title = this.title;\r\n                    clearInterval(this.unsavedInterval);\r\n                } else {\r\n                    const actionNumber = this.history.getActionNumber();\r\n                    if (this.lastSavedActionNumber !== actionNumber) {\r\n                        document.title = LANG('unsaved') + ' - ' + this.title;\r\n                        let state = 0;\r\n                        this.unsavedInterval = setInterval(() => {\r\n                            state = (state + 1) % 2;\r\n                            if (state === 1) {\r\n                                document.title = LANG('unsaved') + '  ' + this.title;\r\n                            } else {\r\n                                document.title = LANG('unsaved') + ' - ' + this.title;\r\n                            }\r\n                        }, 1000 * 60 * 3);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    reset (): void {\r\n        if (this.lastSavedActionNumber === null) { // not initialized\r\n            return;\r\n        }\r\n\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n        window.onbeforeunload = null;\r\n\r\n        if (this.closeFunc) {\r\n            this.closeFunc();\r\n        }\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {KL} from '../kl';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {TExportType} from '../kl-types';\r\nimport {SaveReminder} from '../ui/components/save-reminder';\r\nimport {saveAs} from '../../bb/base/save-as';\r\n\r\nexport class SaveToComputer {\r\n\r\n    /**\r\n     * Using old code, because saving somehow doesn't work for ipad before ios 13,\r\n     * and it doesn't even throw an exception.\r\n     */\r\n    private saveImage (canvas: HTMLCanvasElement, filename: string, mimeType: string): void {\r\n        const parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n\r\n        if (!parts) {\r\n            throw new Error('saveImage: empty parts');\r\n        }\r\n\r\n        //assume base64 encoding\r\n        const binStr = atob(parts[3]);\r\n        //convert to binary in ArrayBuffer\r\n        const buf = new ArrayBuffer(binStr.length);\r\n        const view = new Uint8Array(buf);\r\n        for (let i = 0; i < view.length; i++) {\r\n            view[i] = binStr.charCodeAt(i);\r\n        }\r\n        const blob = new Blob([view], {'type': parts[1]});\r\n        saveAs(blob, filename);\r\n    }\r\n\r\n    constructor (\r\n        private saveReminder: SaveReminder,\r\n        private klRootEl: HTMLElement,\r\n        private getExportType: () => TExportType,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private filenameBase: string,\r\n    ) {}\r\n\r\n    save (format?: 'psd' | 'layers' | 'png') {\r\n        this.saveReminder.reset();\r\n\r\n        if (!format) {\r\n            format = this.getExportType();\r\n        }\r\n\r\n        if (format === 'png') {\r\n            const extension = 'png';\r\n            const mimeType = 'image/png';\r\n            const filename = BB.getDate() + this.filenameBase + '.' + extension;\r\n            const fullCanvas = this.getKlCanvas().getCompleteCanvas(1);\r\n            try {\r\n                this.saveImage(fullCanvas, filename, mimeType);\r\n            } catch (error) { //fallback for old browsers\r\n                alert('could not save');\r\n                throw new Error('failed png export');\r\n            }\r\n        } else if (format === 'layers') {\r\n            const extension = 'png';\r\n            const mimeType = 'image/png';\r\n            const fileBase = BB.getDate() + this.filenameBase;\r\n            const layerArr = this.getKlCanvas().getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                const item = layerArr[i];\r\n                const fnameArr = [\r\n                    fileBase,\r\n                    '_',\r\n                    ('' + (i + 1)).padStart(2, '0'),\r\n                    '_',\r\n                    item.name,\r\n                    '.',\r\n                    extension,\r\n                ];\r\n                this.saveImage(item.canvas, fnameArr.join(''), mimeType);\r\n            }\r\n        } else if (format === 'psd') {\r\n\r\n            const layerArr = this.getKlCanvas().getLayersFast();\r\n\r\n            const psdConfig: {\r\n                width: number;\r\n                height: number;\r\n                children: {\r\n                    name: string;\r\n                    opacity: number;\r\n                    canvas: HTMLCanvasElement;\r\n                    blendMode: string;\r\n                    left: number;\r\n                    top: number;\r\n                }[];\r\n                canvas: HTMLCanvasElement;\r\n            } = {\r\n                width: this.getKlCanvas().getWidth(),\r\n                height: this.getKlCanvas().getHeight(),\r\n                children: [],\r\n                canvas: this.getKlCanvas().getCompleteCanvas(1),\r\n            };\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                const item = layerArr[i];\r\n                psdConfig.children.push({\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    canvas: item.canvas,\r\n                    blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n                    left: 0,\r\n                    top: 0,\r\n                });\r\n            }\r\n\r\n            KL.loadAgPsd().then((agPsdLazy) => {\r\n                const buffer = agPsdLazy.writePsdBuffer(psdConfig);\r\n                const blob = new Blob([buffer], { type: 'application/octet-stream' });\r\n                saveAs(blob, BB.getDate() + this.filenameBase + '.psd');\r\n            }).catch(() => {\r\n                alert('Error: failed to load PSD library');\r\n            });\r\n\r\n        }\r\n\r\n    }\r\n\r\n}","// https://github.com/eligrey/FileSaver.js/issues/774\r\n// stripped down version of https://github.com/eligrey/FileSaver.js/blob/master/src/FileSaver.js#L81-L108\r\n\r\nexport function saveAs (blob: Blob, name: string): void {\r\n    // Namespace is used to prevent conflict w/ Chrome Poper Blocker extension (Issue https://github.com/eligrey/FileSaver.js/issues/561)\r\n    const a = document.createElementNS('http://www.w3.org/1999/xhtml', 'a') as HTMLAnchorElement;\r\n    a.download = name;\r\n    a.rel = 'noopener';\r\n    a.href = URL.createObjectURL(blob);\r\n\r\n    setTimeout(() => URL.revokeObjectURL(a.href), 40 /* sec */ * 1000);\r\n    setTimeout(() => a.click(), 0);\r\n}\r\n","import {KL} from '../kl';\r\nimport {IHistoryBroadcast, IHistoryEntry, klHistory} from './kl-history';\r\nimport {KlCanvasWorkspace} from '../canvas-ui/kl-canvas-workspace';\r\nimport {IFilterApply, IInitState} from '../kl-types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {LayerManager} from '../ui/tool-tabs/layer-manager/layer-manager';\r\nimport {LayerPreview} from '../ui/components/layer-preview';\r\nimport {HandUi} from '../ui/tool-tabs/hand-ui';\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\nfunction execHistoryEntry (\r\n    historyEntry: IHistoryEntry,\r\n    layerIndex: number,\r\n    klCanvas: KlCanvas,\r\n    brushes: any, // todo\r\n    setCurrentLayerCtx: (ctx: CanvasRenderingContext2D) => void,\r\n    getCurrentLayerCtx: () => CanvasRenderingContext2D,\r\n): number {\r\n    if (historyEntry.tool[0] === 'brush') {\r\n        const b = brushes[historyEntry.tool[1]];\r\n        historyEntry.actions.forEach(action => {\r\n            b[action.action].apply(b, action.params);\r\n        });\r\n\r\n    } else if (historyEntry.tool[0] === 'canvas') {\r\n        const p = historyEntry.params;\r\n        const id = klCanvas[historyEntry.action].apply(klCanvas, p);\r\n        if (typeof id === 'number') {\r\n            layerIndex = id;\r\n            const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex));\r\n            setCurrentLayerCtx(ctx);\r\n            Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\r\n        }\r\n\r\n    } else if (historyEntry.tool[0] === 'filter') {\r\n        const p = [{\r\n            context: getCurrentLayerCtx(),\r\n            klCanvas,\r\n            input: historyEntry.params[0].input,\r\n            history: new KL.DecoyKlHistory(),\r\n        } as IFilterApply];\r\n        KL.filterLib[historyEntry.tool[1]][historyEntry.action].apply(null, p);\r\n\r\n    } else if (historyEntry.tool[0] === 'misc' && historyEntry.action === 'focusLayer') {\r\n        layerIndex = historyEntry.params[0];\r\n        const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex));\r\n        setCurrentLayerCtx(ctx);\r\n        Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\r\n\r\n    } else if (historyEntry.tool[0] === 'misc' && historyEntry.action === 'importImage') {\r\n        const id = klCanvas.addLayer();\r\n        if (typeof id === 'number') {\r\n            layerIndex = id;\r\n            if (historyEntry.params[1]) {\r\n                klCanvas.renameLayer(layerIndex, historyEntry.params[1]);\r\n            }\r\n            const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex));\r\n            setCurrentLayerCtx(ctx);\r\n            Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\r\n        }\r\n        getCurrentLayerCtx().drawImage(historyEntry.params[0], 0, 0);\r\n    }\r\n    return layerIndex;\r\n}\r\n\r\nexport class UndoRedoCatchup {\r\n\r\n    private doIgnore = false;\r\n\r\n    /**\r\n     * Prevent multiple undo / redo getting triggered at once if UI is frozen.\r\n     * true -> ignore, don't undo / redo\r\n     */\r\n    private shouldIgnoreTest (): boolean {\r\n        if (this.doIgnore) {\r\n            return true;\r\n        }\r\n        this.doIgnore = true;\r\n        setTimeout(() => {\r\n            this.doIgnore = false;\r\n        }, 0);\r\n        return false;\r\n    }\r\n    \r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        private brushUiMap: any, // todo\r\n        private layerPreview: LayerPreview,\r\n        private layerManager: LayerManager,\r\n        private handUi: HandUi,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private getInitState: () => IInitState,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx: () => CanvasRenderingContext2D | null,\r\n        private setCurrentLayerCtx: (ctx: CanvasRenderingContext2D) => void,\r\n        private getCurrentBrush: () => any, // todo\r\n    ) { }\r\n\r\n    undo (): boolean {\r\n        if (this.shouldIgnoreTest() || !klHistory.canUndo()) {\r\n            return false;\r\n        }\r\n        const entries: IHistoryEntry[] = klHistory.undo();\r\n        const klCanvas = this.getKlCanvas();\r\n        klHistory.pause(true);\r\n        const initState: IInitState = this.getInitState();\r\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\r\n        klCanvas.copy(initState.canvas);\r\n        let layerIndex = initState.focus;\r\n        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\r\n        const brushes: any = {};\r\n        for (const b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\r\n        entries.forEach(entry => {\r\n            layerIndex = execHistoryEntry(\r\n                entry,\r\n                layerIndex,\r\n                klCanvas,\r\n                brushes,\r\n                (ctx) => this.setCurrentLayerCtx(ctx),\r\n                () => throwIfNull(this.getCurrentLayerCtx()),\r\n            );\r\n        });\r\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        this.layerManager.update(layerIndex);\r\n        this.layerPreview.setLayer(klCanvas.getLayer(layerIndex));\r\n        this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n\r\n        klHistory.pause(false);\r\n        return true;\r\n    }\r\n\r\n    redo (): boolean {\r\n        if (this.shouldIgnoreTest() || !klHistory.canRedo()) {\r\n            return false;\r\n        }\r\n        const entry = klHistory.redo();\r\n        if (!entry) {\r\n            setTimeout(() => {\r\n                throw new Error('redo failed. redo entry undefined');\r\n            });\r\n            return false;\r\n        }\r\n        const klCanvas = this.getKlCanvas();\r\n        klHistory.pause(true);\r\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\r\n        const brushes: any = {};\r\n        for (const b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(this.brushUiMap.sketchyBrush.getSeed());\r\n        execHistoryEntry(\r\n            entry,\r\n            0, // doesn't matter, because result not used\r\n            klCanvas,\r\n            brushes,\r\n            (ctx) => this.setCurrentLayerCtx(ctx),\r\n            () => throwIfNull(this.getCurrentLayerCtx()),\r\n        );\r\n\r\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        const currentLayerIndex = klCanvas.getLayerIndex(this.getCurrentLayerCtx().canvas);\r\n        this.layerManager.update(currentLayerIndex);\r\n        this.layerPreview.setLayer(klCanvas.getLayer(currentLayerIndex));\r\n        this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n        klHistory.pause(false);\r\n\r\n        return true;\r\n    }\r\n\r\n    catchup (logParam: IHistoryBroadcast | null): void {\r\n        // const start = performance.now();\r\n        //play catch up (the version that is a few steps behind)\r\n\r\n        if (!logParam || !logParam.bufferUpdate) {\r\n            return;\r\n        }\r\n\r\n        const initState: IInitState = this.getInitState();\r\n        let localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\r\n\r\n        initState.focus = execHistoryEntry(\r\n            logParam.bufferUpdate,\r\n            initState.focus,\r\n            initState.canvas,\r\n            initState.brushes,\r\n            (ctx) => {\r\n                localCurrentLayerCtx = ctx;\r\n            },\r\n            () => throwIfNull(localCurrentLayerCtx),\r\n        );\r\n\r\n        // console.log('catchup', performance.now() - start);\r\n    }\r\n\r\n\r\n}","import {IRGB, ISliderConfig} from '../kl-types';\r\n\r\nexport type TBrushSettingEmit = { type: 'color'; value: IRGB } |\r\n    { type: 'opacity'; value: number } |\r\n    { type: 'size'; value: number } |\r\n    { type: 'sliderConfig'; value: ISliderConfig };\r\n\r\nexport type TBrushSettingSubscriber = (p : TBrushSettingEmit) => void;\r\n\r\n/**\r\n * Central place to update brush settings, and to subscribe to changes.\r\n */\r\nexport class BrushSettingService {\r\n\r\n    private static instance: BrushSettingService;\r\n    subscriberArr: TBrushSettingSubscriber[] = [];\r\n\r\n    private emit (obj: TBrushSettingEmit, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (this.subscriberArr[i] === skipSubscriber) {\r\n                continue;\r\n            }\r\n            this.subscriberArr[i](obj);\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        private onSetColor: (rgb: IRGB) => void,\r\n        private onSetSize: (size: number) => void,\r\n        private onSetOpacity: (opacity: number) => void,\r\n        private onGetColor: () => IRGB,\r\n        private onGetSize: () => number,\r\n        private onGetOpacity: () => number,\r\n        private onGetSliderConfig: () => ISliderConfig,\r\n    ) {\r\n        if (BrushSettingService.instance) {\r\n            throw new Error('BrushSettingService already instantiated');\r\n        }\r\n        BrushSettingService.instance = this;\r\n    }\r\n\r\n    emitColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'color',\r\n                value: color,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSize (size: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'size',\r\n                value: size,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'opacity',\r\n                value: opacity,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSliderConfig (sliderConfig: ISliderConfig, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.emit(\r\n            {\r\n                type: 'sliderConfig',\r\n                value: sliderConfig,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    /**\r\n     * set current brush color\r\n     * @param color\r\n     * @param skipSubscriber\r\n     */\r\n    setColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetColor(color);\r\n        this.emitColor(color, skipSubscriber);\r\n    }\r\n\r\n    /**\r\n     * set current brush size\r\n     * @param size\r\n     * @param skipSubscriber\r\n     */\r\n    setSize (size: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetSize(size);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * set current opacity\r\n     * @param opacity\r\n     * @param skipSubscriber\r\n     */\r\n    setOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetOpacity(opacity);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * get current brush color\r\n     */\r\n    getColor (): IRGB {\r\n        return this.onGetColor();\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.onGetSize();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.onGetOpacity();\r\n    }\r\n\r\n    getSliderConfig (): ISliderConfig {\r\n        return this.onGetSliderConfig();\r\n    }\r\n\r\n    /**\r\n     * subscribe to changes\r\n     * @param func\r\n     */\r\n    subscribe (func: TBrushSettingSubscriber): void {\r\n        if (this.subscriberArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.subscriberArr.push(func);\r\n    }\r\n\r\n    unsubscribe (func: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (func === this.subscriberArr[i]) {\r\n                this.subscriberArr.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG, languageStrings, LS_LANGUAGE_KEY} from '../../../language/language';\r\nimport {KL} from '../../kl';\r\nimport {languages} from '../../../../languages/languages';\r\nimport {DynamicModal} from '../modals/base/dynamic-modal';\r\nimport bitbofLogoImg from '/src/app/img/bitbof-logo.svg';\r\nimport klecksLogoImg from '/src/app/img/klecks-logo.png';\r\nimport uiSwapImg from '/src/app/img/ui/ui-swap-lr.svg';\r\nimport {LocalStorage} from '../../../bb/base/local-storage';\r\nimport {theme, TTheme} from '../../../theme/theme';\r\nimport {addIsDarkListener} from '../../../bb/base/base';\r\n\r\nexport class SettingsTab {\r\n\r\n    private el: HTMLElement;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        onLeftRight: () => void,\r\n        customAbout?: HTMLElement,\r\n    ) {\r\n        this.el = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n\r\n        // ---- language ----\r\n        const autoLanguage = languageStrings.getAutoLanguage();\r\n\r\n        const langWrapper = BB.el({\r\n            parent: this.el,\r\n            content: BB.el({\r\n                content: LANG('settings-language') + ':',\r\n                css: {\r\n                    marginRight: '5px',\r\n                    marginBottom: '2px',\r\n                },\r\n            }),\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                flexWrap: 'wrap',\r\n            },\r\n        });\r\n\r\n        const options: [string, string][] = [\r\n            ['auto', LANG('auto') + `  ${autoLanguage.name} (${autoLanguage.code})`] as [string, string],\r\n            ...languages.map(item => {\r\n                return [item.code, item.name + ` (${item.code})`] as [string, string];\r\n            }),\r\n        ];\r\n        const languageSelect = new KL.Select({\r\n            initValue: LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto',\r\n            optionArr: options,\r\n            onChange: (val) => {\r\n                if (val === 'auto') {\r\n                    LocalStorage.removeItem(LS_LANGUAGE_KEY);\r\n                } else {\r\n                    LocalStorage.setItem(LS_LANGUAGE_KEY, val);\r\n                }\r\n                languageHint.style.display = 'block';\r\n            },\r\n        });\r\n        BB.css(languageSelect.getElement(), {\r\n            flexGrow: '1',\r\n        });\r\n        const languageHint = BB.el({\r\n            className: 'kl-toolspace-note',\r\n            content: LANG('settings-language-reload'),\r\n            css: {\r\n                display: 'none',\r\n                marginTop: '5px',\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n\r\n        langWrapper.append(\r\n            languageSelect.getElement(),\r\n            languageHint,\r\n        );\r\n\r\n\r\n        // ---- theme ----\r\n        function themeToLabel (theme: TTheme): string {\r\n            return theme === 'dark' ? ' ' + LANG('theme-dark') : ' ' + LANG('theme-light');\r\n        }\r\n        const themeSelect = new KL.Select({\r\n            optionArr: [\r\n                ['auto', LANG('auto') + '  ' + themeToLabel(theme.getMediaQueryTheme())],\r\n                ['light', themeToLabel('light')],\r\n                ['dark', themeToLabel('dark')],\r\n            ],\r\n            initValue: theme.getStoredTheme() || 'auto',\r\n            onChange: (val): void => {\r\n                theme.setStoredTheme(val === 'auto' ? undefined : val);\r\n            },\r\n        });\r\n        BB.css(themeSelect.getElement(), {\r\n            flexGrow: '1',\r\n        });\r\n        addIsDarkListener(() => {\r\n            themeSelect.updateLabel('auto', LANG('auto') + '  ' + themeToLabel(theme.getMediaQueryTheme()));\r\n        });\r\n        BB.el({\r\n            parent: this.el,\r\n            content: [\r\n                BB.el({\r\n                    content: LANG('settings-theme') + ':',\r\n                    css: {\r\n                        marginRight: '5px',\r\n                        marginBottom: '2px',\r\n                    },\r\n                }),\r\n                themeSelect.getElement(),\r\n            ],\r\n            css: {\r\n                marginTop: '15px',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                flexWrap: 'wrap',\r\n            },\r\n        });\r\n\r\n        // ---- flip ui ----\r\n        BB.el({\r\n            tagName: 'button',\r\n            parent: this.el,\r\n            content: '<img height=\"20\" width=\"18\" src=\"' + uiSwapImg + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + LANG('switch-ui-left-right'),\r\n            onClick: () => onLeftRight(),\r\n            css: {\r\n                marginTop: '15px',\r\n            },\r\n            custom: {\r\n                tabIndex: '-1',\r\n            },\r\n        });\r\n\r\n\r\n        // ---- about ----\r\n        this.el.append(BB.el({className: 'grid-hr', css: {margin: '10px 0'}}));\r\n\r\n        function makeLicenses () {\r\n            return BB.el({\r\n                tagName: 'a',\r\n                content: LANG('licenses'),\r\n                onClick: () => {\r\n                    import('./licenses').then(result => {\r\n                        new DynamicModal({\r\n                            title: BB.el({\r\n                                content: LANG('licenses'),\r\n                            }),\r\n                            content: BB.el({\r\n                                content: BB.el({\r\n                                    content: result.licenses.replace(/\\n/g, '<br>'),\r\n                                    css: {\r\n                                        padding: '20px',\r\n                                    },\r\n                                }),\r\n                                css: {\r\n                                    height: '100%',\r\n                                    overflowY: 'scroll',\r\n                                },\r\n                            }),\r\n                            width: 800,\r\n                            isMaxHeight: true,\r\n                        });\r\n                    });\r\n                },\r\n            });\r\n        }\r\n\r\n        if (customAbout) {\r\n            this.el.append(customAbout);\r\n            if (!customAbout.innerHTML) {\r\n                const minimalAbout = BB.el({\r\n                    parent: customAbout,\r\n                    css: {\r\n                       textAlign: 'center',\r\n                   },\r\n                });\r\n                minimalAbout.append(\r\n                    BB.el({\r\n                        content: `<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2023<br>`,\r\n                    }),\r\n                    makeLicenses(),\r\n                );\r\n            }\r\n        } else {\r\n            const versionEl = BB.el({\r\n                parent: this.el,\r\n                css: {\r\n                    textAlign: 'center',\r\n                },\r\n                content: `\r\n<img alt=\"Klecks\" class=\"dark-invert\" height=\"25\" src=\"${klecksLogoImg}\"><br>\r\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2023<br>`,\r\n            });\r\n\r\n            versionEl.append(\r\n                makeLicenses(),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('donate'),\r\n                    custom: {\r\n                        href: 'https://kleki.com/donate/',\r\n                        target: '_blank',\r\n                    },\r\n                }),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('source-code'),\r\n                    custom: {\r\n                        href: 'https://klecks.org',\r\n                        target: '_blank',\r\n                    },\r\n                }),\r\n            );\r\n\r\n\r\n        }\r\n\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== LS_LANGUAGE_KEY) {\r\n                return;\r\n            }\r\n            languageSelect.setValue(\r\n                LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'\r\n            );\r\n        });\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hTlU7\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hxlHN\");","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"79hnx\"))).then(() => parcelRequire('jNQF2'));","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n\r\n/**\r\n * Scroll buttons at the top and bottom of toolspace\r\n * Show up when window is very small.\r\n * Allow user to scroll up and down toolspace.\r\n */\r\nexport class ToolspaceScroller {\r\n\r\n    private readonly toolspace: HTMLElement;\r\n    private readonly upBtn: HTMLElement;\r\n    private readonly downBtn: HTMLElement;\r\n    private downInterval: any;\r\n    private upInterval: any;\r\n\r\n    private update (): void {\r\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) { // small buffer where it's not worth it\r\n            if (!this.upInterval) {\r\n                this.upBtn.style.display = this.toolspace.scrollTop === 0 ? 'none' : 'block';\r\n            }\r\n            if (!this.downInterval) {\r\n                this.downBtn.style.display = (\r\n                    this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ?\r\n                        'none' : 'block'\r\n                );\r\n            }\r\n        } else {\r\n            this.upBtn.style.display = 'none';\r\n            this.downBtn.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (p: {toolspace: HTMLElement; uiState: 'left' | 'right'}) {\r\n        this.toolspace = p.toolspace;\r\n        this.upBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                top: '0',\r\n                transform: 'rotate(180deg)',\r\n            },\r\n        });\r\n        this.downBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                bottom: '0',\r\n            },\r\n        });\r\n        this.updateUiState(p.uiState);\r\n\r\n        const upListener = new BB.PointerListener({\r\n            target: this.upBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.upInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, -13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.upInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.upInterval = null;\r\n                        this.update();\r\n                    }, 50);\r\n                }\r\n            },\r\n        });\r\n        const downListener = new BB.PointerListener({\r\n            target: this.downBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.downInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, 13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.downInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.downInterval = null;\r\n                        this.update();\r\n                    }, 50);\r\n                }\r\n            },\r\n        });\r\n\r\n        const wheelListener = (e: WheelEvent) => {\r\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\r\n            this.update();\r\n        };\r\n        this.upBtn.addEventListener('wheel', wheelListener);\r\n        this.downBtn.addEventListener('wheel', wheelListener);\r\n\r\n        this.update();\r\n\r\n        const observer = new MutationObserver(() => this.update());\r\n        observer.observe(\r\n            this.toolspace,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n        window.addEventListener('resize', () => this.update());\r\n\r\n        // hide if in dialog because that can have its own scrollbar\r\n        dialogCounter.subscribe((v) => {\r\n            // ignores the 0.5 by tool dropdown\r\n            this.upBtn.style.opacity = v >= 1 ? '0' : '';\r\n            this.downBtn.style.opacity = v >= 1 ? '0' : '';\r\n        });\r\n    }\r\n\r\n    updateUiState (uiState: 'left' | 'right'): void {\r\n        BB.css(this.upBtn, {\r\n            left: uiState === 'left' ? '0' : '',\r\n            right: uiState === 'right' ? '0' : '',\r\n        });\r\n        BB.css(this.downBtn, {\r\n            left: uiState === 'left' ? '0' : '',\r\n            right: uiState === 'right' ? '0' : '',\r\n        });\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KlSlider} from '../components/kl-slider';\r\nimport {LANG} from '../../../language/language';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {Options} from '../components/options';\r\nimport {TGradientType} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n\r\ninterface IGradientUiSettings {\r\n    opacity: number;\r\n    type: TGradientType;\r\n    doLockAlpha: boolean;\r\n    doSnap: boolean;\r\n    isReversed: boolean;\r\n    isEraser: boolean;\r\n}\r\n\r\n/**\r\n * Gradient Tool tab contents\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport class GradientUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private colorDiv: HTMLElement;\r\n    private colorSlider: KlColorSlider;\r\n    private isVisible: boolean;\r\n    private readonly iconArr: HTMLElement[];\r\n\r\n    private settings: IGradientUiSettings = {\r\n        opacity: 1,\r\n        type: 'linear',\r\n        doLockAlpha: false,\r\n        doSnap: false,\r\n        isReversed: false,\r\n        isEraser: false,\r\n    };\r\n\r\n    private updateIcons (): void {\r\n        const col1 = this.settings.isReversed ? '#0000' : '#000';\r\n        const col2 = this.settings.isReversed ? '#000' : '#0000';\r\n        this.iconArr[0].style.background = `linear-gradient(${col1}, ${col2})`;\r\n        this.iconArr[1].style.background = `linear-gradient(${col2}, ${col1}, ${col2})`;\r\n        this.iconArr[2].style.background = `radial-gradient(${col1}, ${col2})`;\r\n    }\r\n\r\n    // ----- public -------\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.colorSlider = p.colorSlider;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.isVisible = true;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        this.iconArr = [];\r\n        {\r\n            const size = 33;\r\n            [0, 1, 2].forEach(() => {\r\n                const el = BB.el({\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        width: size + 'px',\r\n                        height: size + 'px',\r\n                        borderRadius: '3px',\r\n                        margin: '1px',\r\n                    },\r\n                });\r\n                this.iconArr.push(el);\r\n            });\r\n        }\r\n        this.updateIcons();\r\n\r\n        const typeOptions = new Options<TGradientType>({\r\n            optionArr: [\r\n                {\r\n                    id: 'linear',\r\n                    label: this.iconArr[0],\r\n                    title: LANG('gradient-linear'),\r\n                },\r\n                {\r\n                    id: 'linear-mirror',\r\n                    label: this.iconArr[1],\r\n                    title: LANG('gradient-linear-mirror'),\r\n                },\r\n                {\r\n                    id: 'radial',\r\n                    label: this.iconArr[2],\r\n                    title: LANG('gradient-radial'),\r\n                },\r\n            ],\r\n            initId: 'linear',\r\n            onChange: (id) => {\r\n                this.settings.type = id;\r\n            },\r\n        });\r\n        this.rootEl.append(typeOptions.getElement());\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: this.settings.opacity,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n            onChange: (val) => {\r\n                this.settings.opacity = val;\r\n            },\r\n        });\r\n        BB.css(opacitySlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(opacitySlider.getElement());\r\n\r\n\r\n\r\n        const row1 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const reverseToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('reverse'),\r\n            callback: (b) => {\r\n                this.settings.isReversed = b;\r\n                this.updateIcons();\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        const doSnapToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('angle-snap'),\r\n            title: LANG('angle-snap-title'),\r\n            callback: (b) => {\r\n                this.settings.doSnap = b;\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        row1.append(\r\n            reverseToggle.getElement(),\r\n            doSnapToggle.getElement(),\r\n        );\r\n\r\n\r\n        const row2 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const eraserToggle = new Checkbox({\r\n            init: this.settings.isEraser,\r\n            label: LANG('eraser'),\r\n            callback: (b) => {\r\n                this.settings.isEraser = b;\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('lock-alpha'),\r\n            title: LANG('lock-alpha-title'),\r\n            callback: (b) => {\r\n                this.settings.doLockAlpha = b;\r\n            },\r\n            doHighlight: true,\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        row2.append(\r\n            eraserToggle.getElement(),\r\n            lockAlphaToggle.getElement(),\r\n        );\r\n\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (isVisible: boolean): void {\r\n        this.isVisible = !!isVisible;\r\n        this.rootEl.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\r\n        }\r\n    }\r\n\r\n    getSettings (): IGradientUiSettings {\r\n        return BB.copyObj(this.settings);\r\n    }\r\n\r\n}","import {BB} from '../bb/bb';\r\nimport uiSwapImg from '/src/app/img/ui/ui-swap-lr.svg';\r\nimport helpImg from '/src/app/img/ui/help.svg';\r\nimport {LANG} from '../language/language';\r\nimport {PointerListener} from '../bb/input/pointer-listener';\r\n\r\n/**\r\n * Topmost row of buttons in toolspace. (embed)\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport class EmbedToolspaceTopRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (p: {onSubmit: () => void; onLeftRight: () => void; onHelp: () => void}) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-toolspace-row',\r\n            css: {\r\n                height: '36px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        function createButton (p): {\r\n            el: HTMLElement;\r\n            pointerListener: PointerListener;\r\n        } {\r\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n            const el = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.content ? '' : (p.contain ? padding + 'px 0' : ''),\r\n                },\r\n            });\r\n            if (p.content) {\r\n                el.append(p.content);\r\n            } else {\r\n                const im = BB.el({\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                        backgroundRepeat: 'no-repeat',\r\n                        backgroundPosition: 'center',\r\n                        backgroundSize: p.contain ? 'contain' : '',\r\n                        //filter: 'grayscale(1)',\r\n                        height: '100%',\r\n                    },\r\n                });\r\n                im.style.pointerEvents = 'none';\r\n                el.append(im);\r\n            }\r\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: el,\r\n                onEnterLeave: function (isOver) {\r\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\r\n                },\r\n            });\r\n\r\n            return {\r\n                el,\r\n                pointerListener,\r\n            };\r\n        }\r\n\r\n        const submitButton = createButton({\r\n            onClick: p.onSubmit,\r\n            title: LANG('submit-title'),\r\n            content: BB.el({\r\n                content: LANG('submit'),\r\n                className: 'toolspace-row-button__submit',\r\n                css: {\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    width: '100%',\r\n                    height: '100%',\r\n                },\r\n            }),\r\n            contain: true,\r\n        });\r\n        submitButton.el.style.width = '45px';\r\n\r\n        const helpButton = createButton({\r\n            onClick: p.onHelp,\r\n            title: LANG('help'),\r\n            image: helpImg,\r\n            contain: true,\r\n        });\r\n\r\n        const leftRightButton = createButton({\r\n            onClick: p.onLeftRight,\r\n            title: LANG('switch-ui-left-right'),\r\n            image: uiSwapImg,\r\n            contain: true,\r\n        });\r\n\r\n        this.rootEl.append(submitButton.el, leftRightButton.el, helpButton.el);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n","import {filterLib, filterLibStatus} from './filters';\r\nimport {filterBrightnessContrast} from './filter-brightness-contrast';\r\nimport {filterCropExtend} from './filter-crop-extend';\r\nimport {filterCurves} from './filter-curves';\r\nimport {filterFlip} from './filter-flip';\r\nimport {filterHueSaturation} from './filter-hue-saturation';\r\nimport {filterInvert} from './filter-invert';\r\nimport {filterPerspective} from './filter-perspective';\r\nimport {filterResize} from './filter-resize';\r\nimport {filterRotate} from './filter-rotate';\r\nimport {filterTiltShift} from './filter-tilt-shift';\r\nimport {filterTransform} from './filter-transform';\r\nimport {filterBlur} from './filter-blur';\r\nimport {filterUnsharpMask} from './filter-unsharp-mask';\r\nimport {filterToAlpha} from './filter-to-alpha';\r\nimport {filterGrid} from './filter-grid';\r\nimport {filterNoise} from './filter-noise';\r\nimport {filterPattern} from './filter-pattern';\r\nimport {filterDistort} from './filter-distort';\r\nimport {filterVanishPoint} from './filter-vanish-point';\r\n\r\nfunction importFilter (libObj, moduleObj): void {\r\n    if (moduleObj.getDialog) {\r\n        libObj.getDialog = moduleObj.getDialog;\r\n    }\r\n    libObj.apply = moduleObj.apply;\r\n}\r\n\r\n\r\nexport function importFilters (): void {\r\n    if (filterLibStatus.isLoaded) {\r\n        return;\r\n    }\r\n    importFilter(filterLib.brightnessContrast, filterBrightnessContrast);\r\n    importFilter(filterLib.cropExtend, filterCropExtend);\r\n    importFilter(filterLib.curves, filterCurves);\r\n    importFilter(filterLib.flip, filterFlip);\r\n    importFilter(filterLib.hueSaturation, filterHueSaturation);\r\n    importFilter(filterLib.invert, filterInvert);\r\n    importFilter(filterLib.perspective, filterPerspective);\r\n    importFilter(filterLib.resize, filterResize);\r\n    importFilter(filterLib.rotate, filterRotate);\r\n    importFilter(filterLib.tiltShift, filterTiltShift);\r\n    importFilter(filterLib.transform, filterTransform);\r\n    importFilter(filterLib.blur, filterBlur);\r\n    importFilter(filterLib.unsharpMask, filterUnsharpMask);\r\n    importFilter(filterLib.toAlpha, filterToAlpha);\r\n    importFilter(filterLib.grid, filterGrid);\r\n    importFilter(filterLib.noise, filterNoise);\r\n    importFilter(filterLib.pattern, filterPattern);\r\n    importFilter(filterLib.distort, filterDistort);\r\n    importFilter(filterLib.vanishPoint, filterVanishPoint);\r\n\r\n    filterLibStatus.isLoaded = true;\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterBrightnessContrastInput = {\r\n    brightness: number;\r\n    contrast: number;\r\n}\r\n\r\nexport type TFilterBrightnessContrastHistoryEntry = TFilterHistoryEntry<\r\n    'brightnessContrast',\r\n    TFilterBrightnessContrastInput>;\r\n\r\nexport const filterBrightnessContrast = {\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterBrightnessContrastInput> = {\r\n            element: div,\r\n        };\r\n\r\n\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n\r\n        function finishInit (): void {\r\n\r\n            let brightness = 0, contrast = 0;\r\n            div.innerHTML = LANG('filter-bright-contrast-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const brightnessSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-brightness'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (brightness + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brightness = val / 50 - 1;\r\n                    fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            const contrastSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-contrast'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (contrast + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    contrast = val / 50 - 1;\r\n                    fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            brightnessSlider.getElement().style.marginBottom = '10px';\r\n            div.append(brightnessSlider.getElement(), contrastSlider.getElement());\r\n\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                brightnessSlider.destroy();\r\n                contrastSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterBrightnessContrastInput {\r\n                result.destroy();\r\n                return {\r\n                    brightness: brightness,\r\n                    contrast: contrast,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterBrightnessContrastInput>): boolean {\r\n        const context = params.context;\r\n        const brightness = params.input.brightness;\r\n        const contrast = params.input.contrast;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'brightnessContrast'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterBrightnessContrastHistoryEntry);\r\n\r\n        return true;\r\n    },\r\n};","\r\nexport const eventResMs = 60;","import {fxCanvas} from './fx-canvas';\r\nimport {TFxCanvas} from './fx-canvas-types';\r\n\r\nlet fx: TFxCanvas | null = null;\r\ntry {\r\n    fx = fxCanvas();\r\n} catch (e) {\r\n    setTimeout(() => {\r\n        throw e;\r\n    });\r\n}\r\n\r\nexport function getSharedFx (): TFxCanvas | null {\r\n    if (!fx || fx._.gl.isContextLost()) {\r\n        try {\r\n            fx = fxCanvas();\r\n        } catch (e) {\r\n            setTimeout(() => {\r\n                throw e;\r\n            });\r\n        }\r\n    }\r\n    return fx;\r\n}","import {brightnessContrast} from './filters/brightness-contrast';\r\nimport {FxShader} from './core/fx-shader';\r\nimport {gl, setGl} from './core/gl';\r\nimport {FxTexture} from './core/fx-texture';\r\nimport {curves} from './filters/curves';\r\nimport {hueSaturation} from './filters/hue-saturation';\r\nimport {noise} from './filters/noise';\r\nimport {triangleBlur} from './filters/triangle-blur';\r\nimport {tiltShift} from './filters/tilt-shift';\r\nimport {matrixWarp} from './filters/matrix-warp';\r\nimport {unsharpMask} from './filters/unsharp-mask';\r\nimport {toAlpha} from './filters/to-alpha';\r\nimport {invert} from './filters/invert';\r\nimport {perspective} from './filters/perspective';\r\nimport {unmultiplyAlpha} from './filters/unmultiply-alpha';\r\nimport {distort} from './filters/distort';\r\nimport {multiplyAlpha} from './filters/multiply-alpha';\r\nimport {TFxCanvas, TFxGl, TFxSupportedElements, TWrappedTexture} from './fx-canvas-types';\r\nimport {BB} from '../bb/bb';\r\n\r\n/*\r\n * based on glfx.js\r\n * https://github.com/evanw/glfx.js/\r\n * Copyright 2011 Evan Wallace\r\n * Released under the MIT license\r\n */\r\n\r\n/**\r\n * Before you can apply any filters you will need a canvas, which stores the result of the filters you apply.\r\n * Canvas creation is done through fxCanvas(), which creates and returns a new WebGL <canvas> tag with additional\r\n * methods specific to fxCanvas. This call will throw an error message if the browser doesn't support WebGL.\r\n *\r\n * This library provides realtime image effects using WebGL. There are three parts to it:\r\n * - texture - a raw source of image data (created from <img> <canvas> or <video>)\r\n * - filter - an image effect (represents one or more WebGL shaders)\r\n * - canvas - an image buffer that stores the results (a WebGL <canvas> tag)\r\n */\r\nexport const fxCanvas: (() => TFxCanvas) = (function () {\r\n\r\n    function wrapTexture (texture: FxTexture): TWrappedTexture {\r\n        return {\r\n            _: texture,\r\n            loadContentsOf: function (element) {\r\n                // Make sure that we're using the correct global WebGL context\r\n                setGl(this._.gl);\r\n                this._.loadContentsOf(element);\r\n            },\r\n            destroy: function () {\r\n                // Make sure that we're using the correct global WebGL context\r\n                setGl(this._.gl);\r\n                this._.destroy();\r\n            },\r\n        };\r\n    }\r\n\r\n    function texture (element: TFxSupportedElements) {\r\n        return wrapTexture(FxTexture.fromElement(element));\r\n    }\r\n\r\n    function getTextureType (): GLenum {\r\n        let textureType: GLenum = gl.UNSIGNED_BYTE;\r\n\r\n        // Go for floating point buffer textures if we can, it'll make the bokeh\r\n        // filter look a lot better. Note that on Windows, ANGLE does not let you\r\n        // render to a floating-point texture when linear filtering is enabled.\r\n        // See http://crbug.com/172278 for more information.\r\n        if (\r\n            gl.getExtension('WEBGL_color_buffer_float') && // firefox shows warning without this line\r\n            gl.getExtension('OES_texture_float') &&\r\n            gl.getExtension('OES_texture_float_linear')\r\n        ) {\r\n            const testTexture = new FxTexture(100, 100, gl.RGBA, gl.FLOAT);\r\n            try {\r\n                // Only use gl.FLOAT if we can render to it\r\n                testTexture.drawTo(function () {\r\n                    textureType = gl.FLOAT;\r\n                });\r\n            } catch (e) {\r\n            }\r\n            testTexture.destroy();\r\n        }\r\n        return textureType;\r\n    }\r\n\r\n    function initialize (this: TFxCanvas, width: number, height: number): void {\r\n        const textureType = getTextureType();\r\n        if (this._.texture) {\r\n            this._.texture.destroy();\r\n        }\r\n        if (this._.spareTexture) {\r\n            this._.spareTexture.destroy();\r\n        }\r\n        this.width = width;\r\n        this.height = height;\r\n        this._.texture = new FxTexture(width, height, gl.RGBA, textureType);\r\n        this._.spareTexture = new FxTexture(width, height, gl.RGBA, textureType);\r\n        this._.extraTexture = this._.extraTexture || new FxTexture(0, 0, gl.RGBA, textureType);\r\n        this._.flippedShader = this._.flippedShader || new FxShader(null, `\r\nuniform sampler2D texture;\r\nvarying vec2 texCoord;\r\nvoid main() {\r\n    gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\r\n}\r\n        `, 'flippedShader');\r\n        this._.isInitialized = true;\r\n    }\r\n\r\n    function draw (this: TFxCanvas, texture: TWrappedTexture, width?: number, height?: number): TFxCanvas {\r\n        if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\r\n            initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\r\n        }\r\n\r\n        texture._.use();\r\n        this._.texture.drawTo(function () {\r\n            FxShader.getDefaultShader().drawRect();\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    function update (this: TFxCanvas): TFxCanvas {\r\n        this._.texture.use();\r\n        this._.flippedShader.drawRect();\r\n        return this;\r\n    }\r\n\r\n    function contents (this: TFxCanvas): TWrappedTexture {\r\n        const texture = new FxTexture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\r\n        this._.texture.use();\r\n        texture.drawTo(function () {\r\n            FxShader.getDefaultShader().drawRect();\r\n        });\r\n        return wrapTexture(texture);\r\n    }\r\n\r\n    /*\r\n       Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\r\n       Length of the array will be width * height * 4.\r\n    */\r\n    function getPixelArray (this: TFxCanvas): Uint8Array {\r\n        const w = this._.texture.width;\r\n        const h = this._.texture.height;\r\n        const array = new Uint8Array(w * h * 4);\r\n        this._.texture.drawTo(function () {\r\n            gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\r\n        });\r\n        return array;\r\n    }\r\n\r\n    function wrap<F extends (...args: any[]) => unknown>(fn: F): F {\r\n        return <F>function (this: TFxCanvas, ...args: any[]) {\r\n            // Make sure that we're using the correct global WebGL context\r\n            setGl(this._.gl);\r\n            // Now that the context has been switched, we can call the wrapped function\r\n            return fn.apply(this, args);\r\n        };\r\n    }\r\n\r\n    const fxCanvas = function () {\r\n        const canvas: TFxCanvas = BB.canvas() as TFxCanvas;\r\n        try {\r\n            setGl(BB.throwIfNull(canvas.getContext('webgl', {premultipliedAlpha: false})) as TFxGl);\r\n        } catch (e) {\r\n            setGl(null);\r\n        }\r\n        if (!gl) {\r\n            throw 'This browser does not support WebGL';\r\n        }\r\n\r\n        canvas._ = {\r\n            gl: gl,\r\n            isInitialized: false,\r\n            texture: null,\r\n            spareTexture: null,\r\n            flippedShader: null,\r\n        };\r\n\r\n        // Core methods\r\n        canvas.texture = wrap(texture);\r\n        canvas.draw = wrap(draw);\r\n        canvas.update = wrap(update);\r\n        canvas.contents = wrap(contents);\r\n        canvas.getPixelArray = wrap(getPixelArray);\r\n\r\n        // Filter methods\r\n        canvas.brightnessContrast = wrap(brightnessContrast);\r\n        canvas.hueSaturation = wrap(hueSaturation);\r\n        canvas.triangleBlur = wrap(triangleBlur);\r\n        canvas.unsharpMask = wrap(unsharpMask);\r\n        canvas.perspective = wrap(perspective);\r\n        canvas.matrixWarp = wrap(matrixWarp);\r\n        canvas.tiltShift = wrap(tiltShift);\r\n        canvas.noise = wrap(noise);\r\n        canvas.curves = wrap(curves);\r\n        canvas.invert = wrap(invert);\r\n        canvas.multiplyAlpha = wrap(multiplyAlpha);\r\n        canvas.unmultiplyAlpha = wrap(unmultiplyAlpha);\r\n        canvas.toAlpha = wrap(toAlpha);\r\n        canvas.distort = wrap(distort);\r\n\r\n        return canvas as TFxCanvas;\r\n    };\r\n\r\n    return fxCanvas;\r\n})();","import {BB} from '../../bb/bb';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {gl} from '../core/gl';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * @type Brightness / Contrast\r\n * Provides additive brightness and multiplicative contrast control.\r\n * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\r\n * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n */\r\nexport type TFilterBrightnessContrast = (\r\n    this: TFxCanvas,\r\n    brightness: number,\r\n    contrast: number\r\n) => TFxCanvas;\r\n\r\nexport const brightnessContrast: TFilterBrightnessContrast = function (brightness, contrast) {\r\n    gl.brightnessContrast = gl.brightnessContrast || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float brightness;\\\r\n        uniform float contrast;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.rgb += brightness;\\\r\n            if (contrast > 0.0) {\\\r\n                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\r\n            } else {\\\r\n                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\r\n            }\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'brightnessContrast');\r\n\r\n    simpleShader.call(this, gl.brightnessContrast, {\r\n        brightness: BB.clamp(brightness, -1, 1),\r\n        contrast: BB.clamp(contrast, -1, 1),\r\n    });\r\n\r\n    return this;\r\n};","import {TFxCanvas, TUniforms} from '../fx-canvas-types';\r\nimport {FxTexture} from './fx-texture';\r\nimport {FxShader} from './fx-shader';\r\n\r\nexport function simpleShader (this: TFxCanvas, shader: FxShader, uniforms: TUniforms, textureIn?: FxTexture, textureOut?: FxTexture): void {\r\n    (textureIn || this._.texture).use();\r\n    this._.spareTexture.drawTo(function () {\r\n        shader.uniforms(uniforms).drawRect();\r\n    });\r\n    this._.spareTexture.swapWith(textureOut || this._.texture);\r\n}","import {gl} from './gl';\r\nimport {TUniforms} from '../fx-canvas-types';\r\nimport {BB} from '../../bb/bb';\r\n\r\n// VERTEX_SHADER | FRAGMENT_SHADER\r\ntype TShaderType = GLenum;\r\n\r\nconst defaultVertexSource = '\\\r\n    attribute vec2 vertex;\\\r\n    attribute vec2 _texCoord;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        texCoord = _texCoord;\\\r\n        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\r\n    }';\r\n\r\nconst defaultFragmentSource = '\\\r\n    uniform sampler2D texture;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        gl_FragColor = texture2D(texture, texCoord);\\\r\n    }';\r\n\r\nfunction isArray (obj: unknown): obj is unknown[] {\r\n    return Object.prototype.toString.call(obj) == '[object Array]';\r\n}\r\n\r\nfunction isNumber (obj: unknown): obj is number {\r\n    return Object.prototype.toString.call(obj) == '[object Number]';\r\n}\r\n\r\nlet floatPrecision: 'lowp' | 'mediump' | 'highp' | undefined;\r\n\r\nexport class FxShader {\r\n\r\n    // ---- static ----\r\n    static getDefaultShader (): FxShader {\r\n        gl.defaultShader = gl.defaultShader || new FxShader();\r\n        return gl.defaultShader;\r\n    }\r\n\r\n\r\n    // ---- private ----\r\n\r\n    private compileSource (type: TShaderType, source: string, nameStr: string): WebGLShader {\r\n        const shader = BB.throwIfNull(gl.createShader(type));\r\n        gl.shaderSource(shader, source.replace(/#define.*/, '')); // glslify adds a line add the beginning that breaks it\r\n        gl.compileShader(shader);\r\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n            throw 'compile error: ' + nameStr + ' - ' + gl.getShaderInfoLog(shader);\r\n        }\r\n        return shader;\r\n    }\r\n\r\n    /**\r\n     * HIGH_FLOAT | MEDIUM_FLOAT\r\n     */\r\n    private testPrecisionSupport (precisionType: GLenum): boolean {\r\n        const format = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, precisionType);\r\n        return format !== null && format.precision !== 0;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        vertexSource?: string | null,\r\n        fragmentSource?: string | null,\r\n        nameStr?: string,\r\n    ) {\r\n        this.vertexAttribute = null;\r\n        this.texCoordAttribute = null;\r\n        this.program = BB.throwIfNull(gl.createProgram());\r\n        vertexSource = vertexSource || defaultVertexSource;\r\n        fragmentSource = fragmentSource || defaultFragmentSource;\r\n        if (!floatPrecision) {\r\n            floatPrecision = this.testPrecisionSupport(gl.HIGH_FLOAT) ? 'highp' : (this.testPrecisionSupport(gl.MEDIUM_FLOAT) ? 'mediump' : 'lowp');\r\n        }\r\n        fragmentSource = 'precision ' + floatPrecision + ' float;' + fragmentSource; // annoying requirement is annoying\r\n        gl.attachShader(this.program, this.compileSource(gl.VERTEX_SHADER, vertexSource, nameStr + '(vertex)'));\r\n        gl.attachShader(this.program, this.compileSource(gl.FRAGMENT_SHADER, fragmentSource, nameStr + '(fragment)'));\r\n        gl.linkProgram(this.program);\r\n        if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\r\n            throw 'link error: ' + gl.getProgramInfoLog(this.program);\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n    \r\n    vertexAttribute: null | number;\r\n    texCoordAttribute: null | number;\r\n    program: WebGLProgram; // null = destroyed\r\n\r\n    destroy (): void {\r\n        gl.deleteProgram(this.program);\r\n        this.program = null;\r\n    }\r\n\r\n    uniforms (uniforms: TUniforms): FxShader {\r\n        gl.useProgram(this.program);\r\n        Object.entries(uniforms).forEach(([name, value]) => {\r\n\r\n            const location = gl.getUniformLocation(this.program, name);\r\n            if (location === null) {\r\n                // will be null if the uniform isn't used in the shader\r\n                return;\r\n            }\r\n\r\n            if (isArray(value)) {\r\n                switch (value.length) {\r\n                    case 1:\r\n                        gl.uniform1fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 2:\r\n                        gl.uniform2fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 3:\r\n                        gl.uniform3fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 4:\r\n                        gl.uniform4fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 9:\r\n                        gl.uniformMatrix3fv(location, false, new Float32Array(value));\r\n                        break;\r\n                    case 16:\r\n                        gl.uniformMatrix4fv(location, false, new Float32Array(value));\r\n                        break;\r\n                    default:\r\n                        throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\r\n                }\r\n            } else if (isNumber(value)) {\r\n                gl.uniform1f(location, value);\r\n            } else {\r\n                throw 'attempted to set uniform \"' + name + '\" to invalid value ' + (value || 'undefined').toString();\r\n            }\r\n        });\r\n        // allow chaining\r\n        return this;\r\n    }\r\n\r\n    //\r\n    /**\r\n     * textures are uniforms too but for some reason can't be specified by gl.uniform1f,\r\n     * even though floating point numbers represent the integers 0 through 7 exactly\r\n     */\r\n    textures (textures: Record<string, GLint>): FxShader {\r\n        gl.useProgram(this.program);\r\n\r\n        Object.entries(textures).forEach(([name, value]) => {\r\n            gl.uniform1i(gl.getUniformLocation(this.program, name), value);\r\n        });\r\n\r\n        // allow chaining\r\n        return this;\r\n    }\r\n\r\n   drawRect (left?: number, top?: number, right?: number, bottom?: number): void {\r\n        let undefined;\r\n        const viewport = gl.getParameter(gl.VIEWPORT);\r\n        top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\r\n        left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\r\n        right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\r\n        bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\r\n        if (gl.vertexBuffer === undefined || gl.vertexBuffer === null) {\r\n            gl.vertexBuffer = BB.throwIfNull(gl.createBuffer());\r\n        }\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([left, top, left, bottom, right, top, right, bottom]), gl.STATIC_DRAW);\r\n        if (gl.texCoordBuffer == null) {\r\n            gl.texCoordBuffer = BB.throwIfNull(gl.createBuffer());\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\r\n        }\r\n        if (this.vertexAttribute == null) {\r\n            this.vertexAttribute = gl.getAttribLocation(this.program, 'vertex');\r\n            gl.enableVertexAttribArray(this.vertexAttribute);\r\n        }\r\n        if (this.texCoordAttribute == null) {\r\n            this.texCoordAttribute = gl.getAttribLocation(this.program, '_texCoord');\r\n            gl.enableVertexAttribArray(this.texCoordAttribute);\r\n        }\r\n        gl.useProgram(this.program);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n        gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n        gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    }\r\n\r\n}","import {TFxGl} from '../fx-canvas-types';\r\n\r\nexport let gl: TFxGl;\r\n\r\nexport function setGl (newGl: TFxGl | null): void {\r\n    gl = newGl;\r\n}","import {gl} from './gl';\r\nimport {BB} from '../../bb/bb';\r\nimport {TFxGl, TFxSupportedElements} from '../fx-canvas-types';\r\n\r\n/**\r\n * Format           Type                    Channels    Bytes per pixel\r\n * RGBA             UNSIGNED_BYTE           4           4\r\n * RGB              UNSIGNED_BYTE           3           3\r\n * RGBA             UNSIGNED_SHORT_4_4_4_4  4           2\r\n * RGBA             UNSIGNED_SHORT_5_5_5_1  4           2\r\n * RGB              UNSIGNED_SHORT_5_6_5    3           2\r\n * LUMINANCE_ALPHA  UNSIGNED_BYTE           2           2\r\n * LUMINANCE        UNSIGNED_BYTE           1           1\r\n * ALPHA            UNSIGNED_BYTE           1           1\r\n *\r\n * https://webglfundamentals.org/webgl/lessons/webgl-data-textures.html\r\n */\r\nexport type TTextureFormat = GLenum;\r\nexport type TTextureType = GLenum;\r\n\r\n\r\nexport class FxTexture {\r\n    \r\n    // ---- static ----\r\n    static fromElement (element: TFxSupportedElements): FxTexture {\r\n        const texture = new FxTexture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\r\n        texture.loadContentsOf(element);\r\n        return texture;\r\n    }\r\n    \r\n    \r\n    // ---- private ----\r\n    private canvas: HTMLCanvasElement;\r\n    private type: TTextureType;\r\n\r\n    /*\r\n    // never seen this being used\r\n    private getCanvas(texture: Texture): CanvasRenderingContext2D {\r\n        if (this.canvas == null) {\r\n            this.canvas = BB.canvas(texture.width, texture.height);\r\n        }\r\n        this.canvas.width = texture.width;\r\n        this.canvas.height = texture.height;\r\n        const c = BB.ctx(this.canvas);\r\n        c.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        return c;\r\n    }*/\r\n\r\n    \r\n    // ---- public ----\r\n    constructor (\r\n        width: number,\r\n        height: number,\r\n        format: TTextureFormat,\r\n        type: TTextureType,\r\n    ) {\r\n        this.gl = gl;\r\n        this.id = BB.throwIfNull(gl.createTexture());\r\n        this.width = width;\r\n        this.height = height;\r\n        this.format = format;\r\n        this.type = type;\r\n        this.canvas = null;\r\n\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        if (width && height) {\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n        }\r\n    }\r\n    \r\n    // ---- interface ----\r\n\r\n    gl: TFxGl;\r\n    width: number;\r\n    height: number;\r\n    id: WebGLTexture; // null -> destroyed\r\n    format: TTextureFormat;\r\n    \r\n    loadContentsOf (element: TFxSupportedElements): void {\r\n        this.width = element.width || element.videoWidth;\r\n        this.height = element.height || element.videoHeight;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\r\n    }\r\n\r\n    initFromBytes (width: number, height: number, data: number[]): void {\r\n        this.width = width;\r\n        this.height = height;\r\n        this.format = gl.RGBA;\r\n        this.type = gl.UNSIGNED_BYTE;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\r\n    }\r\n\r\n    destroy (): void {\r\n        gl.deleteTexture(this.id);\r\n        this.id = null;\r\n    }\r\n\r\n    use (unit?: number): void {\r\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n    }\r\n\r\n    unuse (unit: number): void {\r\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n        gl.bindTexture(gl.TEXTURE_2D, null);\r\n    }\r\n\r\n    ensureFormat (width: number, height: number, format: TTextureFormat, type: TTextureType): void {\r\n        // change the format only if required\r\n        if (width != this.width || height != this.height || format != this.format || type != this.type) {\r\n            this.width = width;\r\n            this.height = height;\r\n            this.format = format;\r\n            this.type = type;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n        }\r\n    }\r\n\r\n    ensureFormatViaTexture (texture: FxTexture): void {\r\n        this.ensureFormat(texture.width, texture.height, texture.format, texture.type);\r\n    }\r\n\r\n    drawTo (callback: () => void): void {\r\n        // start rendering to this texture\r\n        gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\r\n        if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\r\n            throw new Error('incomplete framebuffer');\r\n        }\r\n        gl.viewport(0, 0, this.width, this.height);\r\n\r\n        // do the drawing\r\n        callback();\r\n\r\n        // stop rendering to this texture\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    }\r\n\r\n\r\n    /*\r\n    // never seen this being used\r\n    fillUsingCanvas (callback: (canvas: CanvasRenderingContext2D) => void): Texture {\r\n        callback(this.getCanvas(this));\r\n        this.format = gl.RGBA;\r\n        this.type = gl.UNSIGNED_BYTE;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.canvas);\r\n        return this;\r\n    }\r\n\r\n    // never seen this being used\r\n    toImage (image: HTMLImageElement): void {\r\n        this.use();\r\n        Shader.getDefaultShader().drawRect();\r\n        const size = this.width * this.height * 4;\r\n        const pixels = new Uint8Array(size);\r\n        const c = this.getCanvas(this);\r\n        const data = c.createImageData(this.width, this.height);\r\n        gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n        for (let i = 0; i < size; i++) {\r\n            data.data[i] = pixels[i];\r\n        }\r\n        c.putImageData(data, 0, 0);\r\n        image.src = this.canvas.toDataURL();\r\n    }\r\n     */\r\n\r\n    swapWith (other: FxTexture): void {\r\n        let temp;\r\n\r\n        temp = other.id;\r\n        other.id = this.id;\r\n        this.id = temp;\r\n\r\n        temp = other.width;\r\n        other.width = this.width;\r\n        this.width = temp;\r\n\r\n        temp = other.height;\r\n        other.height = this.height;\r\n        this.height = temp;\r\n\r\n        temp = other.format;\r\n        other.format = this.format;\r\n        this.format = temp;\r\n\r\n        // type?\r\n    }\r\n}\r\n","import {splineInterpolate} from '../math/spline-interpolate';\r\nimport {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Curves\r\n * @description A powerful mapping tool that transforms the colors in the image\r\n *              by an arbitrary function. The function is interpolated between\r\n *              a set of 2D points using splines. The curves filter can take\r\n *              either one or three arguments which will apply the mapping to\r\n *              either luminance or RGB values, respectively.\r\n * @param red   A list of points that define the function for the red channel.\r\n *              Each point is a list of two values: the value before the mapping\r\n *              and the value after the mapping, both in the range 0 to 1. For\r\n *              example, [[0,1], [1,0]] would invert the red channel while\r\n *              [[0,0], [1,1]] would leave the red channel unchanged.\r\n * @param green A list of points that define the function for the green\r\n *              channel (just like for red).\r\n * @param blue  list of points that define the function for the blue\r\n *              channel (just like for red).\r\n */\r\nexport type TFilterCurves = (\r\n    this: TFxCanvas,\r\n    red: [number, number][],\r\n    green: [number, number][],\r\n    blue: [number, number][],\r\n) => TFxCanvas;\r\n\r\nexport const curves: TFilterCurves = function (red, green, blue) {\r\n    // Create the ramp texture\r\n    const redRamp = splineInterpolate(red);\r\n    const greenRamp = splineInterpolate(green);\r\n    const blueRamp = splineInterpolate(blue);\r\n    const array: number[] = [];\r\n    for (let i = 0; i < 256; i++) {\r\n        array.splice(array.length, 0, redRamp[i], greenRamp[i], blueRamp[i], 255);\r\n    }\r\n    this._.extraTexture.initFromBytes(256, 1, array);\r\n    this._.extraTexture.use(1);\r\n\r\n    gl.curves = gl.curves || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform sampler2D map;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.r = texture2D(map, vec2(color.r)).r;\\\r\n            color.g = texture2D(map, vec2(color.g)).g;\\\r\n            color.b = texture2D(map, vec2(color.b)).b;\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'curves');\r\n\r\n    gl.curves.textures({\r\n        map: 1,\r\n    });\r\n    simpleShader.call(this, gl.curves, {});\r\n\r\n    return this;\r\n};","import {BB} from '../../bb/bb';\r\n\r\nexport function splineInterpolate (points: [number, number][]): number[] {\r\n    const interpolator = new BB.SplineInterpolator(points);\r\n    const array = [];\r\n    for (let i = 0; i < 256; i++) {\r\n        array.push(\r\n            BB.clamp(\r\n                Math.floor(interpolator.interpolate(i / 255) * 256),\r\n                0,\r\n                255\r\n            )\r\n        );\r\n    }\r\n    return array;\r\n}","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {BB} from '../../bb/bb';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Hue / Saturation\r\n * @description      Provides rotational hue and multiplicative saturation control. RGB color space\r\n *                   can be imagined as a cube where the axes are the red, green, and blue color\r\n *                   values. Hue changing works by rotating the color vector around the grayscale\r\n *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\r\n *                   Saturation is implemented by scaling all color channel values either toward\r\n *                   or away from the average color channel value.\r\n * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\r\n *                   and 1 is 180 degree rotation in the positive direction)\r\n * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n */\r\nexport type TFilterHueSaturation = (\r\n    this: TFxCanvas,\r\n    hue: number,\r\n    saturation: number,\r\n) => TFxCanvas;\r\n\r\nexport const hueSaturation: TFilterHueSaturation = function (hue, saturation) {\r\n    gl.hueSaturation = gl.hueSaturation || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float hue;\\\r\n        uniform float saturation;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\r\n            float angle = hue * 3.14159265;\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\r\n            float len = length(color.rgb);\\\r\n            color.rgb = vec3(\\\r\n                dot(color.rgb, weights.xyz),\\\r\n                dot(color.rgb, weights.zxy),\\\r\n                dot(color.rgb, weights.yzx)\\\r\n            );\\\r\n            \\\r\n            /* saturation adjustment */\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            if (saturation > 0.0) {\\\r\n                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\r\n            } else {\\\r\n                color.rgb += (average - color.rgb) * (-saturation);\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'hueSaturation');\r\n\r\n    simpleShader.call(this, gl.hueSaturation, {\r\n        hue: BB.clamp(hue, -1, 1),\r\n        saturation: BB.clamp(saturation, -1, 1),\r\n    });\r\n\r\n    return this;\r\n};\r\n","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport shaderNoise from '../shaders/shader-noise.glsl';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Noise\r\n * draws noise, completely replaces original image\r\n */\r\nexport type TFilterNoise = (\r\n    this: TFxCanvas,\r\n    seed: number, // float, any value okay\r\n    type: number, // 1 value, 2 simplex, 3 cellular\r\n    scale: [number, number], // float, small scale will show repeating patterns\r\n    offset: [number, number], // offset x, y - large offsets will show repeating patterns\r\n    octaves: number, // int 0 - 4\r\n    samples: number, // 1 | 4 | 8 -> super-sampling\r\n    peaks: number, // how often it will ramp *additionally* from 0 to 1\r\n    brightness: number, // range [-1, 1]\r\n    contrast: number, // range [-1, 1]\r\n    isReversed: boolean, // reverse 0-1 range\r\n    colA: {r: number; g: number; b: number}, // which color at 0, if rgb\r\n    colB: {r: number; g: number; b: number}, // which color at 1, if rgb\r\n    channels: 'rgb' | 'alpha', // which channel to target\r\n) => TFxCanvas;\r\n\r\nexport const noise: TFilterNoise = function (\r\n    seed,\r\n    type,\r\n    scale,\r\n    offset,\r\n    octaves,\r\n    samples,\r\n    peaks,\r\n    brightness,\r\n    contrast,\r\n    isReversed,\r\n    colA,\r\n    colB,\r\n    channels,\r\n) {\r\n    gl.noise = gl.noise || new FxShader(null, shaderNoise.replace(/#define.*/, ''), 'noise');\r\n    simpleShader.call(this, gl.noise, {\r\n        seed,\r\n        type,\r\n        scale: [scale[0], scale[1]],\r\n        offset,\r\n        octaves,\r\n        samples,\r\n        texSize: [this.width, this.height],\r\n        peaks,\r\n        brightness,\r\n        contrast,\r\n        isReversed: isReversed ? 1.0 : 0.0,\r\n        colA: colA ? [colA.r / 255, colA.g / 255, colA.b / 255] : [0, 0, 0],\r\n        colB: colB ? [colB.r / 255, colB.g / 255, colB.b / 255] : [1, 1, 1],\r\n        channels: channels === 'rgb' ? 0 : 1,\r\n    });\r\n\r\n    return this;\r\n};","uniform sampler2D texture;\r\nvarying vec2 texCoord;\r\nuniform vec2 texSize;\r\n\r\nuniform float seed;\r\nuniform float type;\r\nuniform vec2 scale;\r\nuniform vec2 offset;\r\nuniform float octaves;\r\nuniform float samples;\r\n\r\nuniform float peaks;\r\nuniform float contrast;\r\nuniform float brightness;\r\nuniform float isReversed;\r\n\r\nuniform vec3 colA;\r\nuniform vec3 colB;\r\n\r\nuniform float channels; // 0 - rgb, 1 - alpha\r\n\r\n// fbm, cellular_noise based on\r\n// https://github.com/Gonkee/Gonkees-Shaders\r\n// MIT, Copyright  Gonkee\r\n\r\n// hash & simplex based on\r\n// https://www.shadertoy.com/view/Msf3WH\r\n// MIT, Copyright  2013 Inigo Quilez\r\n// https://www.youtube.com/c/InigoQuilez\r\n// https://iquilezles.org\r\n\r\n\r\n\r\nfloat rand(vec2 co) {\r\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\r\n}\r\n\r\nfloat value_noise(vec2 coord){\r\n    return rand(floor(coord) / 100.0);\r\n}\r\n\r\nfloat cellular_noise(vec2 coord) {\r\n    vec2 i = floor(coord);\r\n    vec2 f = fract(coord);\r\n\r\n    float min_dist = 99999.0;\r\n    for (float x = -1.0; x <= 1.0; x++) {\r\n        for (float y = -1.0; y <= 1.0; y++) {\r\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\r\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\r\n            min_dist = min(min_dist, dist);\r\n        }\r\n    }\r\n    return min_dist;\r\n}\r\n\r\n// ---------- Simplex Alternative ---------------------\r\n\r\nvec3 hash(vec3 p)\r\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\r\n, dot(p, vec3(269.5, 183.3, 246.1))\r\n, dot(p, vec3(113.5, 271.9, 124.6)))\r\n;return fract(sin(p)*43758.5453123)*2.-1.; }\r\n\r\nmat3 hash(mat3 p)\r\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\r\n\r\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\r\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\r\n\r\n//return noiseGra13dx as .x, and its derivatives as .yzw\r\n// https://www.shadertoy.com/view/llByD1\r\nvec3 noiseGra13dx(in vec3 x) {\r\n    vec3 p=floor(x), w=fract(x)\r\n    #if 1\r\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\r\n    #else\r\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\r\n    #endif\r\n    //gradients\r\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\r\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\r\n    //projections\r\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\r\n    //interpolations\r\n    float g=dot(G, w), f=dot(F, w-vec3(1));\r\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\r\n    mat3 S=D-mat3(G, G, G), W=D-E;\r\n    a.x=(a.x+a.y+a.z)+f-g;\r\n    ;float b=u.x*u.y*u.z;\r\n\r\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\r\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\r\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\r\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\r\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\r\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\r\n    return 0.5 + 0.5 * result.xxx;\r\n}\r\n\r\nfloat fbm(vec2 coord) {\r\n    float normalize_factor = 0.0;\r\n    float value = 0.0;\r\n    float scale = 0.5;\r\n\r\n    for (float i = 0.0; i < 7.0; i++){\r\n        if (i < octaves) {\r\n            if (type == 0.0) {\r\n                value += value_noise(coord) * scale;\r\n            } else if (type == 1.0) {\r\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\r\n            } else if (type == 2.0) {\r\n                value += cellular_noise(coord) * scale;\r\n            }\r\n            normalize_factor += scale;\r\n            coord *= 2.0;\r\n            scale *= 0.5;\r\n        }\r\n    }\r\n    return value / normalize_factor;\r\n}\r\n\r\nfloat render (vec2 pos) {\r\n    float result = fbm(pos);\r\n    //\r\n\r\n    if (peaks > 0.0) {\r\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\r\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\r\n    }\r\n\r\n    result += brightness;\r\n    if (contrast > 0.0) {\r\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\r\n    } else if (contrast < 0.0) {\r\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\r\n    }\r\n\r\n    if (isReversed == 1.0) {\r\n        result = 1.0 - result;\r\n    }\r\n    return result;\r\n}\r\n\r\n\r\nvoid main() {\r\n    vec4 color;\r\n\r\n    vec2 seedOffset;\r\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\r\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\r\n\r\n    float val = 0.0;\r\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\r\n\r\n    if (samples == 1.0) {\r\n        val = render(basePos);\r\n\r\n    }/* else if (samples == 4.0) {\r\n        for (float i = 0.0; i < 2.0; i++) {\r\n            for (float e = 0.0; e < 2.0; e++) {\r\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\r\n            }\r\n        }\r\n        val /= 4.0;\r\n\r\n    }*/ else if (samples == 16.0) {\r\n        for (float i = 0.0; i < 4.0; i++) {\r\n            for (float e = 0.0; e < 4.0; e++) {\r\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\r\n            }\r\n        }\r\n        val /= 16.0;\r\n    }\r\n\r\n    if (channels == 0.0) {\r\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\r\n    } else {\r\n        gl_FragColor = vec4(vec3(1.0), val);\r\n    }\r\n}","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {randomShaderFunc} from '../shaders/random-shader-func';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Triangle Blur\r\n * @description  This is the most basic blur filter, which convolves the image with a\r\n *               pyramid filter. The pyramid filter is separable and is applied as two\r\n *               perpendicular triangle filters.\r\n * @param radius The radius of the pyramid convolved with the image.\r\n */\r\nexport type TFilterTriangleBlur = (\r\n    this: TFxCanvas,\r\n    radius: number,\r\n) => TFxCanvas;\r\n\r\n\r\nexport const triangleBlur: TFilterTriangleBlur = function (radius) {\r\n    gl.triangleBlur = gl.triangleBlur || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta * percent);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'triangleBlur');\r\n\r\n    simpleShader.call(this, gl.triangleBlur, {\r\n        delta: [radius / this.width, 0],\r\n    });\r\n    simpleShader.call(this, gl.triangleBlur, {\r\n        delta: [0, radius / this.height],\r\n    });\r\n\r\n    return this;\r\n};","// returns a random number between 0 and 1\r\nexport const randomShaderFunc = '\\\r\n    float random(vec3 scale, float seed) {\\\r\n        /* use the fragment position for a different seed per-pixel */\\\r\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\r\n    }\\\r\n';","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {randomShaderFunc} from '../shaders/random-shader-func';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Tilt Shift\r\n * @description          Simulates the shallow depth of field normally encountered in close-up\r\n *                       photography, which makes the scene seem much smaller than it actually\r\n *                       is. This filter assumes the scene is relatively planar, in which case\r\n *                       the part of the scene that is completely in focus can be described by\r\n *                       a line (the intersection of the focal plane and the scene). An example\r\n *                       of a planar scene might be looking at a road from above at a downward\r\n *                       angle. The image is then blurred with a blur radius that starts at zero\r\n *                       on the line and increases further from the line.\r\n * @param startX         The x coordinate of the start of the line segment.\r\n * @param startY         The y coordinate of the start of the line segment.\r\n * @param endX           The x coordinate of the end of the line segment.\r\n * @param endY           The y coordinate of the end of the line segment.\r\n * @param blurRadius     The maximum radius of the pyramid blur.\r\n * @param gradientRadius The distance from the line at which the maximum blur radius is reached.\r\n */\r\nexport type TFilterTiltShift = (\r\n    this: TFxCanvas,\r\n    startX: number,\r\n    startY: number,\r\n    endX: number,\r\n    endY: number,\r\n    blurRadius: number,\r\n    gradientRadius: number,\r\n) => TFxCanvas;\r\n\r\nexport const tiltShift: TFilterTiltShift = function (\r\n    startX,\r\n    startY,\r\n    endX,\r\n    endY,\r\n    blurRadius,\r\n    gradientRadius,\r\n) {\r\n    gl.tiltShift = gl.tiltShift || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float blurRadius;\\\r\n        uniform float gradientRadius;\\\r\n        uniform vec2 start;\\\r\n        uniform vec2 end;\\\r\n        uniform vec2 delta;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\\\r\n            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'tiltShift');\r\n\r\n    const dx = endX - startX;\r\n    const dy = endY - startY;\r\n    const d = Math.sqrt(dx * dx + dy * dy);\r\n    simpleShader.call(this, gl.tiltShift, {\r\n        blurRadius: blurRadius,\r\n        gradientRadius: gradientRadius,\r\n        start: [startX, startY],\r\n        end: [endX, endY],\r\n        delta: [dx / d, dy / d],\r\n        texSize: [this.width, this.height],\r\n    });\r\n    simpleShader.call(this, gl.tiltShift, {\r\n        blurRadius: blurRadius,\r\n        gradientRadius: gradientRadius,\r\n        start: [startX, startY],\r\n        end: [endX, endY],\r\n        delta: [-dy / d, dx / d],\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {warpShader} from '../shaders/warp-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {getInverse} from '../math/matrix';\r\nimport {TFxCanvas, TMat2x2, TMat3x3, TMatDeep3x3} from '../fx-canvas-types';\r\n\r\n/**\r\n * Matrix Warp\r\n * @description           Transforms an image by a 2x2 or 3x3 matrix. The coordinates used in\r\n *                        the transformation are (x, y) for a 2x2 matrix or (x, y, 1) for a\r\n *                        3x3 matrix, where x and y are in units of pixels.\r\n * @param matrix          A 2x2 or 3x3 matrix represented as either a list or a list of lists.\r\n *                        For example, the 3x3 matrix [[2,0,0],[0,3,0],[0,0,1]] can also be\r\n *                        represented as [2,0,0,0,3,0,0,0,1] or just [2,0,0,3].\r\n * @param inverse         A boolean value that, when true, applies the inverse transformation\r\n *                        instead. (optional, defaults to false)\r\n * @param useTextureSpace A boolean value that, when true, uses texture-space coordinates\r\n *                        instead of screen-space coordinates. Texture-space coordinates range\r\n *                        from -1 to 1 instead of 0 to width - 1 or height - 1, and are easier\r\n *                        to use for simple operations like flipping and rotating.\r\n */\r\nexport type TFilterMatrixWarp = (\r\n    this: TFxCanvas,\r\n    matrix: TMat2x2 | TMat3x3 | TMatDeep3x3,\r\n    inverse?: boolean,\r\n    useTextureSpace?: boolean,\r\n) => TFxCanvas;\r\n\r\n\r\nexport const matrixWarp: TFilterMatrixWarp = function (matrix, inverse, useTextureSpace) {\r\n    gl.matrixWarp = gl.matrixWarp || warpShader('\\\r\n        uniform mat3 matrix;\\\r\n        uniform bool useTextureSpace;\\\r\n    ', '\\\r\n        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;\\\r\n        vec3 warp = matrix * vec3(coord, 1.0);\\\r\n        coord = warp.xy / warp.z;\\\r\n        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;\\\r\n    ');\r\n\r\n    // Flatten all members of matrix into one big list\r\n    matrix = matrix.flat() as (TMat2x2 | TMat3x3);\r\n\r\n    // Extract a 3x3 matrix out of the arguments\r\n    if (matrix.length == 4) {\r\n        matrix = [\r\n            matrix[0], matrix[1], 0,\r\n            matrix[2], matrix[3], 0,\r\n            0, 0, 1,\r\n        ];\r\n    } else if (matrix.length != 9) {\r\n        throw 'can only warp with 2x2 or 3x3 matrix';\r\n    }\r\n\r\n    simpleShader.call(this, gl.matrixWarp, {\r\n        matrix: inverse ? getInverse(matrix) : matrix,\r\n        texSize: [this.width, this.height],\r\n        useTextureSpace: useTextureSpace ? 1 : 0,\r\n    });\r\n\r\n    return this;\r\n};","import {FxShader} from '../core/fx-shader';\r\n\r\nexport function warpShader (uniformsStr: string, warpStr: string): FxShader {\r\n    return new FxShader(null, uniformsStr + '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        vec2 coord = texCoord * texSize;\\\r\n        ' + warpStr + '\\\r\n        gl_FragColor = texture2D(texture, coord / texSize);\\\r\n        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\r\n        if (coord != clampedCoord) {\\\r\n            /* fade to transparent if we are outside the image */\\\r\n            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\r\n        }\\\r\n    }', 'warp');\r\n}","import {TMat3x3} from '../fx-canvas-types';\r\n\r\n// from javax.media.jai.PerspectiveTransform\r\n\r\n/**\r\n * Creates a PerspectiveTransform that maps the unit square onto an arbitrary quadrilateral.\r\n */\r\nexport function getSquareToQuad (\r\n    x0: number,\r\n    y0: number,\r\n    x1: number,\r\n    y1: number,\r\n    x2: number,\r\n    y2: number,\r\n    x3: number,\r\n    y3: number\r\n): TMat3x3 {\r\n    const dx1 = x1 - x2;\r\n    const dy1 = y1 - y2;\r\n    const dx2 = x3 - x2;\r\n    const dy2 = y3 - y2;\r\n    const dx3 = x0 - x1 + x2 - x3;\r\n    const dy3 = y0 - y1 + y2 - y3;\r\n    const det = dx1 * dy2 - dx2 * dy1;\r\n    const a = (dx3 * dy2 - dx2 * dy3) / det;\r\n    const b = (dx1 * dy3 - dx3 * dy1) / det;\r\n    return [\r\n        x1 - x0 + a * x1, y1 - y0 + a * y1, a,\r\n        x3 - x0 + b * x3, y3 - y0 + b * y3, b,\r\n        x0, y0, 1,\r\n    ];\r\n}\r\n\r\nexport function getInverse (m: TMat3x3): TMat3x3 {\r\n    const a = m[0], b = m[1], c = m[2];\r\n    const d = m[3], e = m[4], f = m[5];\r\n    const g = m[6], h = m[7], i = m[8];\r\n    const det = a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\r\n    return [\r\n        (e * i - f * h) / det, (c * h - b * i) / det, (b * f - c * e) / det,\r\n        (f * g - d * i) / det, (a * i - c * g) / det, (c * d - a * f) / det,\r\n        (d * h - e * g) / det, (b * g - a * h) / det, (a * e - b * d) / det,\r\n    ];\r\n}\r\n\r\nexport function multiply (a: TMat3x3, b: TMat3x3): TMat3x3 {\r\n    return [\r\n        a[0] * b[0] + a[1] * b[3] + a[2] * b[6],\r\n        a[0] * b[1] + a[1] * b[4] + a[2] * b[7],\r\n        a[0] * b[2] + a[1] * b[5] + a[2] * b[8],\r\n        a[3] * b[0] + a[4] * b[3] + a[5] * b[6],\r\n        a[3] * b[1] + a[4] * b[4] + a[5] * b[7],\r\n        a[3] * b[2] + a[4] * b[5] + a[5] * b[8],\r\n        a[6] * b[0] + a[7] * b[3] + a[8] * b[6],\r\n        a[6] * b[1] + a[7] * b[4] + a[8] * b[7],\r\n        a[6] * b[2] + a[7] * b[5] + a[8] * b[8],\r\n    ];\r\n}","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Unsharp Mask\r\n * @description    A form of image sharpening that amplifies high-frequencies in the image. It\r\n *                 is implemented by scaling pixels away from the average of their neighbors.\r\n * @param radius   The blur radius that calculates the average of the neighboring pixels.\r\n * @param strength A scale factor where 0 is no effect and higher values cause a stronger effect.\r\n */\r\nexport type TFilterUnsharpMask = (\r\n    this: TFxCanvas,\r\n    radius: number,\r\n    strength: number,\r\n) => TFxCanvas;\r\n\r\nexport const unsharpMask: TFilterUnsharpMask = function (radius, strength) {\r\n    gl.unsharpMask = gl.unsharpMask || new FxShader(null, '\\\r\n        uniform sampler2D blurredTexture;\\\r\n        uniform sampler2D originalTexture;\\\r\n        uniform float strength;\\\r\n        uniform float threshold;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 blurred = texture2D(blurredTexture, texCoord);\\\r\n            vec4 original = texture2D(originalTexture, texCoord);\\\r\n            gl_FragColor = mix(blurred, original, 1.0 + strength);\\\r\n        }\\\r\n    ', 'unsharpMask');\r\n\r\n    // Store a copy of the current texture in the second texture unit\r\n    this._.extraTexture.ensureFormatViaTexture(this._.texture);\r\n    this._.texture.use();\r\n    this._.extraTexture.drawTo(function () {\r\n        FxShader.getDefaultShader().drawRect();\r\n    });\r\n\r\n    // Blur the current texture, then use the stored texture to detect edges\r\n    this._.extraTexture.use(1);\r\n    this.triangleBlur(radius);\r\n    gl.unsharpMask.textures({\r\n        originalTexture: 1,\r\n    });\r\n    simpleShader.call(this, gl.unsharpMask, {\r\n        strength: strength,\r\n    });\r\n    this._.extraTexture.unuse(1);\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\nimport {IRGBA} from '../../klecks/kl-types';\r\n\r\n/**\r\n * To Alpha\r\n * @description   Generates alpha channel from luminance (r+g+b)\r\n * @param isInverted    boolean - invert luminance\r\n * @param replaceRGBA    rgba - color to replace rgb with. if a = 0 -> keep orig color\r\n */\r\nexport type TFilterToAlpha = (\r\n    this: TFxCanvas,\r\n    isInverted: boolean,\r\n    replaceRGBA: IRGBA,\r\n) => TFxCanvas;\r\n\r\nexport const toAlpha: TFilterToAlpha = function (isInverted, replaceRGBA) {\r\n    gl.toAlpha = gl.toAlpha || new FxShader(null, '\\\r\n    uniform bool isInverted;\\\r\n    uniform vec4 replace;\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        float alpha = (color.r + color.g + color.b) / 3.0;\\\r\n        if (isInverted) alpha = 1.0 - alpha;\\\r\n        alpha = min(color.a, alpha);\\\r\n        if (replace.a > 0.0) color = replace;\\\r\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha);\\\r\n    }\\\r\n', 'toAlpha');\r\n\r\n    simpleShader.call(this, gl.toAlpha, {\r\n        isInverted: isInverted ? 1 : 0,\r\n        replace: replaceRGBA ? [replaceRGBA.r / 255, replaceRGBA.g / 255, replaceRGBA.b / 255, replaceRGBA.a] : [0, 0, 0, 0],\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Invert\r\n * @description   Inverts color of each pixel\r\n */\r\nexport type TFilterInvert = (\r\n    this: TFxCanvas,\r\n) => TFxCanvas;\r\n\r\nexport const invert: TFilterInvert = function () {\r\n    gl.invert = gl.invert || new FxShader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        color.rgb = 1.0 - color.rgb;\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'invert');\r\n\r\n    simpleShader.call(this, gl.invert, {\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {getInverse, getSquareToQuad, multiply} from '../math/matrix';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\nexport type TRectanglePoints = [\r\n    number, number, // point a\r\n    number, number, // point b\r\n    number, number, // point c\r\n    number, number, // point d\r\n];\r\n\r\n/**\r\n * Perspective\r\n * @description  Warps one quadrangle to another with a perspective transform. This can be used to\r\n *               make a 2D image look 3D or to recover a 2D image captured in a 3D environment.\r\n * @param before The x and y coordinates of four points before the transform in a flat list. This\r\n *               would look like [ax, ay, bx, by, cx, cy, dx, dy] for four points (ax, ay), (bx, by),\r\n *               (cx, cy), and (dx, dy).\r\n * @param after  The x and y coordinates of four points after the transform in a flat list, just\r\n *               like the other argument.\r\n */\r\nexport type TFilterPerspective = (\r\n    this: TFxCanvas,\r\n    before: TRectanglePoints,\r\n    after: TRectanglePoints,\r\n) => TFxCanvas;\r\n\r\nexport const perspective: TFilterPerspective = function (before, after) {\r\n    const a = getSquareToQuad(...after);\r\n    const b = getSquareToQuad(...before);\r\n    const c = multiply(getInverse(a), b);\r\n    return this.matrixWarp(c);\r\n};\r\n","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * unmultiplyAlpha\r\n * reverses alpha multiply\r\n */\r\nexport type TFilterUnmultiplyAlpha = (\r\n    this: TFxCanvas,\r\n) => TFxCanvas;\r\n\r\nexport const unmultiplyAlpha: TFilterUnmultiplyAlpha = function () {\r\n    gl.unmultiplyAlpha = gl.unmultiplyAlpha || new FxShader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        if(color.a > 0.0) {\\\r\n            color.rgb /= color.a;\\\r\n        }\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'unmultiplyAlpha');\r\n\r\n    simpleShader.call(this, gl.unmultiplyAlpha, {\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {warpShader} from '../shaders/warp-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n\r\nexport type TFilterDistortSettings = {\r\n    stepSize: number; // [1, inf]\r\n    distortType: 0 | 1 | 2;\r\n    scale: { x: number; y: number };\r\n    strength: { x: number; y: number };\r\n    phase: { x: number; y: number };\r\n};\r\n\r\n/**\r\n * Distort\r\n * Distorts image (moves pixels around)\r\n */\r\nexport type TFilterDistort = (\r\n    this: TFxCanvas,\r\n    settings: TFilterDistortSettings,\r\n) => TFxCanvas;\r\n\r\n/**\r\n * @filter        Distort\r\n * @description   Distorts image (moves pixels around)\r\n */\r\nexport const distort: TFilterDistort = function (settings) {\r\n    gl.distort = gl.distort || warpShader('\\\r\n        uniform float stepSize;\\\r\n        uniform vec2 scale;\\\r\n        uniform vec2 strength;\\\r\n        uniform vec2 phase;\\\r\n        uniform float type;\\\r\n        ', '\\\r\n        const float PI = 3.14159265;\\\r\n        float x = coord.x;\\\r\n        float y = coord.y;\\\r\n        if (stepSize > 1.0) {\\\r\n            x = floor(x / stepSize) * stepSize;\\\r\n            y = floor(y / stepSize) * stepSize;\\\r\n        }\\\r\n        float distortX = sin((x/scale.x + phase.x) * PI * 2.0) * strength.x;\\\r\n        float distortY = sin((y/scale.y + phase.y) * PI * 2.0) * strength.y;\\\r\n        if (type == 0.0) {\\\r\n            coord.y += distortX;\\\r\n            coord.x += distortY;\\\r\n        } else if (type == 1.0) {\\\r\n            coord.x += distortX;\\\r\n            coord.y += distortY;\\\r\n        } else if (type == 2.0) {\\\r\n            gl_FragColor = texture2D(texture, vec2(x, y) / texSize);\\\r\n            coord.y += sin(gl_FragColor.r/scale.x*200.0 + phase.x * PI * 2.0) * strength.x;\\\r\n            coord.x += cos(gl_FragColor.g/scale.y*200.0 + phase.y * PI * 2.0) * strength.y;\\\r\n        }\\\r\n        coord.x = mod(coord.x, texSize.x);\\\r\n        coord.y = mod(coord.y, texSize.y);\\\r\n        \\\r\n        ');\r\n\r\n    simpleShader.call(this, gl.distort, {\r\n        stepSize: settings.stepSize,\r\n        type: settings.distortType,\r\n        scale: [settings.scale.x, settings.scale.y],\r\n        strength: [settings.strength.x, settings.strength.y],\r\n        phase: [settings.phase.x, settings.phase.y],\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};\r\n\r\n","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * multiplyAlpha\r\n * applies alpha multiply\r\n */\r\nexport type TFilterMultiplyAlpha = (\r\n    this: TFxCanvas,\r\n) => TFxCanvas;\r\n\r\nexport const multiplyAlpha: TFilterMultiplyAlpha = function () {\r\n    gl.multiplyAlpha = gl.multiplyAlpha || new FxShader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        color.rgb *= color.a;\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'multiplyAlpha');\r\n\r\n    simpleShader.call(this, gl.multiplyAlpha, {\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {BB} from '../../bb/bb';\r\nimport {input} from '../ui/components/input';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {Cropper} from '../ui/components/cropper';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IRGBA} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {theme} from '../../theme/theme';\r\n\r\nexport type TFilterCropExtendInput = {\r\n    left: number;\r\n    right: number;\r\n    top: number;\r\n    bottom: number;\r\n    fillColor?: IRGBA;\r\n};\r\n\r\nexport type TFilterCropExtendHistoryEntry = TFilterHistoryEntry<\r\n    'cropExtend',\r\n    TFilterCropExtendInput>;\r\n\r\nexport const filterCropExtend = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const klCanvas = params.klCanvas;\r\n        if (!klCanvas) {\r\n            return false;\r\n        }\r\n        const tempCanvas = BB.canvas();\r\n        {\r\n            const fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 560, 400, 1);\r\n            const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n            const previewFactor = w / klCanvas.getWidth();\r\n            tempCanvas.width = w;\r\n            tempCanvas.height = h;\r\n            tempCanvas.style.display = 'block';\r\n            BB.ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n        }\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterCropExtendInput> = {\r\n            element: div,\r\n        };\r\n        div.innerHTML = LANG('filter-crop-description') + '<br/><br/>';\r\n        let left = 0, right = 0, top = 0, bottom = 0;\r\n        let leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\r\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n        let scale;\r\n\r\n\r\n\r\n        // --- input elements ---\r\n\r\n        const lrWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'},\r\n        });\r\n        const tbWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'},\r\n        });\r\n        div.append(lrWrapper, tbWrapper);\r\n\r\n        const leftInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                leftChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n        const rightInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px'},\r\n            callback: function (v) {\r\n                rightChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n        const topInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                topChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n        const bottomInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px'},\r\n            callback: function (v) {\r\n                bottomChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            width: '60px',\r\n        };\r\n        lrWrapper.append(\r\n            BB.el({content: LANG('filter-crop-left') + ':', css: labelStyle}),\r\n            leftInput,\r\n            BB.el({content: LANG('filter-crop-right') + ':', css: labelStyle}),\r\n            rightInput\r\n        );\r\n        tbWrapper.append(\r\n            BB.el({content: LANG('filter-crop-top') + ':', css: labelStyle}),\r\n            topInput,\r\n            BB.el({content: LANG('filter-crop-bottom') + ':', css: labelStyle}),\r\n            bottomInput\r\n        );\r\n\r\n        function updateInput (): void {\r\n            left = parseInt(leftInput.value);\r\n            right = parseInt(rightInput.value);\r\n            top = parseInt(topInput.value);\r\n            bottom = parseInt(bottomInput.value);\r\n            let newWidth = klCanvas.getWidth() + left + right;\r\n            let newHeight = klCanvas.getHeight() + top + bottom;\r\n\r\n            if (newWidth <= 0) {\r\n                if (leftChanged) {\r\n                    left = -klCanvas.getWidth() - right + 1;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -klCanvas.getWidth() - left + 1;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = 1;\r\n            }\r\n            if (newWidth > maxWidth) {\r\n                if (leftChanged) {\r\n                    left = -klCanvas.getWidth() - right + maxWidth;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -klCanvas.getWidth() - left + maxWidth;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = maxWidth;\r\n            }\r\n            if (newHeight <= 0) {\r\n                if (topChanged) {\r\n                    top = -klCanvas.getHeight() - bottom + 1;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -klCanvas.getHeight() - top + 1;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = 1;\r\n            }\r\n            if (newHeight > maxHeight) {\r\n                if (topChanged) {\r\n                    top = -klCanvas.getHeight() - bottom + maxHeight;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -klCanvas.getHeight() - top + maxHeight;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = maxHeight;\r\n            }\r\n            cropper.setTransform({\r\n                x: -left,\r\n                y: -top,\r\n                width: newWidth,\r\n                height: newHeight,\r\n            });\r\n\r\n\r\n            leftChanged = false;\r\n            rightChanged = false;\r\n            topChanged = false;\r\n            bottomChanged = false;\r\n        }\r\n\r\n        let useRuleOfThirds = true;\r\n        const ruleOThirdsCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-crop-rule-thirds'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                useRuleOfThirds = b;\r\n                cropper.showThirds(useRuleOfThirds);\r\n            },\r\n        });\r\n        div.append(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n            },\r\n        }));\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 0};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 0},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('filter-crop-fill'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function (rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                updateBg();\r\n            },\r\n        });\r\n\r\n\r\n        const flexRow = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n        div.append(flexRow);\r\n        flexRow.append(ruleOThirdsCheckbox.getElement(), colorOptions.getElement());\r\n\r\n\r\n        // when input field changed, or dragging in preview finished\r\n        // adjusts the zoom\r\n        function update (transform): void {\r\n            const fit = BB.fitInto(transform.width, transform.height, 260, 180, 1);\r\n            scale = fit.width / transform.width;\r\n\r\n            const offset = BB.centerWithin(340, previewHeight, fit.width, fit.height);\r\n\r\n            tempCanvas.style.width = klCanvas.getWidth() * scale + 'px';\r\n            tempCanvas.style.height = klCanvas.getHeight() * scale + 'px';\r\n\r\n            offsetWrapper.style.left = (offset.x - transform.x * scale) + 'px';\r\n            offsetWrapper.style.top = (offset.y - transform.y * scale) + 'px';\r\n\r\n            left = parseInt('' + -transform.x);\r\n            top = parseInt('' + -transform.y);\r\n            right = parseInt('' + (transform.x + transform.width - klCanvas.getWidth()));\r\n            bottom = parseInt('' + (transform.y + transform.height - klCanvas.getHeight()));\r\n            leftInput.value = '' + left;\r\n            topInput.value = '' + top;\r\n            rightInput.value = '' + right;\r\n            bottomInput.value = '' + bottom;\r\n\r\n            BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                previewWrapper.style.background = 'url(' + url + ')';\r\n                if (selectedRgbaObj.a !== 0) {\r\n                    tempCanvas.style.background = 'url(' + url + ')';\r\n                }\r\n            }, theme.isDark());\r\n            previewWrapper.style.backgroundPosition = (offset.x) + 'px ' + (offset.y) + 'px';\r\n\r\n            cropper.setScale(scale);\r\n        }\r\n\r\n        const previewHeight = 218; // two less because of border\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-edit-crop-preview',\r\n            css: {\r\n                width: '340px',\r\n                marginTop: '10px',\r\n                marginLeft: '-20px',\r\n                height: previewHeight + 'px',\r\n                backgroundColor: '#9e9e9e',\r\n                position: 'relative',\r\n                borderTop: '1px solid rgb(144,144,144)',\r\n                borderBottom: '1px solid rgb(144,144,144)',\r\n                overflow: 'hidden',\r\n                userSelect: 'none',\r\n                touchAction: 'none',\r\n            },\r\n        });\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        const bgColorOverlay = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0',\r\n            },\r\n        });\r\n        previewWrapper.append(bgColorOverlay);\r\n\r\n        const offsetWrapper = document.createElement('div');\r\n        offsetWrapper.style.position = 'absolute';\r\n        offsetWrapper.style.left = '0px';\r\n        offsetWrapper.style.top = '0px';\r\n        previewWrapper.append(offsetWrapper);\r\n\r\n        const canvasWrapper = BB.el({\r\n            parent: offsetWrapper,\r\n            content: tempCanvas,\r\n            css: {\r\n                boxShadow: '0 0 0px 1px rgb(130,130,130)',\r\n                position: 'absolute',\r\n                left: '0px',\r\n                top: '0px',\r\n            },\r\n        });\r\n\r\n\r\n        div.append(previewWrapper);\r\n        const cropper = new Cropper({\r\n            x: 0,\r\n            y: 0,\r\n            width: klCanvas.getWidth(),\r\n            height: klCanvas.getHeight(),\r\n            scale: scale,\r\n            callback: update,\r\n            maxW: maxWidth,\r\n            maxH: maxHeight,\r\n        });\r\n        update(cropper.getTransform());\r\n        offsetWrapper.append(cropper.getElement());\r\n\r\n        function updateBg (): void {\r\n            if (selectedRgbaObj.a === 0) {\r\n                bgColorOverlay.style.background = '';\r\n                tempCanvas.style.background = '';\r\n            } else {\r\n                bgColorOverlay.style.background = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n\r\n                BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                    tempCanvas.style.background = 'url(' + url + ')';\r\n                }, theme.isDark());\r\n            }\r\n        }\r\n\r\n        function updateIsDark (): void {\r\n            updateInput();\r\n        }\r\n        theme.addIsDarkListener(updateIsDark);\r\n\r\n        result.destroy = (): void => {\r\n            cropper.destroy();\r\n            ruleOThirdsCheckbox.destroy();\r\n            theme.removeIsDarkListener(updateIsDark);\r\n            colorOptions.destroy();\r\n        };\r\n        result.getInput = function (): TFilterCropExtendInput {\r\n            result.destroy();\r\n            return {\r\n                left: left,\r\n                right: right,\r\n                top: top,\r\n                bottom: bottom,\r\n                fillColor: selectedRgbaObj.a === 0 ? undefined : selectedRgbaObj,\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterCropExtendInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (\r\n            !klCanvas ||\r\n            !history ||\r\n            isNaN(params.input.left) ||\r\n            isNaN(params.input.right) ||\r\n            isNaN(params.input.top) ||\r\n            isNaN(params.input.bottom)\r\n        ) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.resizeCanvas(params.input);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'cropExtend'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: BB.copyObj(params.input),\r\n            }],\r\n        } as TFilterCropExtendHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {CurvesInput, getDefaultCurvesInput, TCurvesInput} from './filter-curves/curves-input';\r\nimport {Options} from '../ui/components/options';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterCurvesInput = {\r\n    curves: TCurvesInput;\r\n};\r\n\r\nexport type TFilterCurvesHistoryEntry = TFilterHistoryEntry<\r\n    'curves',\r\n    TFilterCurvesInput>;\r\n\r\nexport const filterCurves = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        const div = BB.el();\r\n        const result: IFilterGetDialogResult<TFilterCurvesInput> = {\r\n            element: div,\r\n        };\r\n        let klCanvasPreview: KlCanvasPreview;\r\n\r\n        function finishInit (): void {\r\n\r\n            div.innerHTML = LANG('filter-curves-description') + '<br/><br/>';\r\n\r\n            let curves: TCurvesInput = getDefaultCurvesInput();\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            function update (): void {\r\n                try {\r\n                    fxCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n                    if (klCanvasPreview) {\r\n                        klCanvasPreview.render();\r\n                    }\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            const input = new CurvesInput({\r\n                curves,\r\n                callback: function (val) {\r\n                    curves = val;\r\n                    update();\r\n                },\r\n            });\r\n            const modeButtons: Options<string> = input.getModeButtons();\r\n\r\n\r\n            div.append(input.getElement());\r\n\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            result.destroy = (): void => {\r\n                input.destroy();\r\n                texture.destroy();\r\n                modeButtons.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterCurvesInput {\r\n                result.destroy();\r\n                return {\r\n                    curves: curves,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterCurvesInput>): boolean {\r\n        const context = params.context;\r\n        const curves = params.input.curves;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'curves'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterCurvesHistoryEntry);\r\n\r\n        return true;\r\n    },\r\n\r\n\r\n};","import {Options} from '../../ui/components/options';\r\nimport {LANG} from '../../../language/language';\r\nimport {BB} from '../../../bb/bb';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\ntype TCurvePoint = {\r\n    el: HTMLElement;\r\n    pointerListener: PointerListener;\r\n    setPos: (newX: number, newY: number) => void;\r\n};\r\n\r\nexport type TCurvesInput = {\r\n    r: [number, number][];\r\n    g: [number, number][];\r\n    b: [number, number][];\r\n}\r\n\r\nexport function getDefaultCurvesInput (): TCurvesInput {\r\n    return BB.copyObj({\r\n        r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n        g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n        b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n    });\r\n}\r\n\r\nexport class CurvesInput {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly p0: TCurvePoint;\r\n    private readonly p1: TCurvePoint;\r\n    private readonly p2: TCurvePoint;\r\n    private readonly p3: TCurvePoint;\r\n    private readonly modeButtons: Options<string>;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            curves: TCurvesInput;\r\n            callback: (val: TCurvesInput) => void;\r\n        },\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = () => false;\r\n        let mode = 'All';\r\n        let curves = p.curves;\r\n        this.modeButtons = new Options( {\r\n            optionArr: [\r\n                {\r\n                    id: 'All',\r\n                    label: LANG('filter-curves-all'),\r\n                },\r\n                {\r\n                    id: 'Red',\r\n                    label: LANG('red'),\r\n                },\r\n                {\r\n                    id: 'Green',\r\n                    label: LANG('green'),\r\n                },\r\n                {\r\n                    id: 'Blue',\r\n                    label: LANG('blue'),\r\n                },\r\n            ],\r\n            initId: 'All',\r\n            onChange: (id) => {\r\n                mode = id;\r\n                if (mode === 'All') {\r\n                    curves = getDefaultCurvesInput();\r\n                }\r\n                let curve = curves.r;\r\n                if (mode === 'Green') {\r\n                    curve = curves.g;\r\n                }\r\n                if (mode === 'Blue') {\r\n                    curve = curves.b;\r\n                }\r\n                this.p0.setPos(0, areaH - curve[0][1] * areaH);\r\n                this.p1.setPos(curve[1][0] * areaW, areaH - curve[1][1] * areaH);\r\n                this.p2.setPos(curve[2][0] * areaW, areaH - curve[2][1] * areaH);\r\n                this.p3.setPos(areaW, areaH - curve[3][1] * areaH);\r\n\r\n                update();\r\n            },\r\n        });\r\n        this.rootEl.append(this.modeButtons.getElement());\r\n\r\n        const curveArea = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-curves-graph',\r\n            css: {\r\n                position: 'relative',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const areaW = 300, areaH = 100;\r\n        const canvas = BB.canvas(areaW, areaH);\r\n        let ctx = BB.ctx(canvas);\r\n        curveArea.append(canvas);\r\n\r\n        const fit = (v: number): number => {\r\n            return Math.max(0, Math.min(1, v));\r\n        };\r\n\r\n        const createPoint = (\r\n            x: number,\r\n            y: number,\r\n            callback: (p: IVector2D) => void,\r\n            lock?: boolean,\r\n        ): TCurvePoint => {\r\n            const gripSize = 14;\r\n            let internalY = y, internalX = x;\r\n            const pointEl = BB.el({\r\n                className: 'kl-curves-graph__grip',\r\n                css: {\r\n                    left: (x - gripSize / 2) + 'px',\r\n                    top: (y - gripSize / 2) + 'px',\r\n                    width: gripSize + 'px',\r\n                    height: gripSize + 'px',\r\n                    borderRadius: gripSize + 'px',\r\n                },\r\n            });\r\n\r\n            const update = () => {\r\n                BB.css(pointEl, {\r\n                    left: (x - gripSize / 2) + 'px',\r\n                    top: (y - gripSize / 2) + 'px',\r\n                });\r\n            };\r\n\r\n            const pointerListener = new BB.PointerListener({\r\n                target: pointEl,\r\n                onPointer: (event) => {\r\n                    event.eventPreventDefault();\r\n                    if (event.type === 'pointerdown') {\r\n                        internalX = x;\r\n                        internalY = y;\r\n                    }\r\n                    if (event.button === 'left' && event.type === 'pointermove') {\r\n                        if (!lock) {\r\n                            internalX += event.dX;\r\n                        }\r\n                        x = Math.max(0, Math.min(areaW, internalX));\r\n                        internalY += event.dY;\r\n                        y = Math.max(0, Math.min(areaH, internalY));\r\n                        update();\r\n                        callback({\r\n                            x: x,\r\n                            y: y,\r\n                        });\r\n                    }\r\n                },\r\n            });\r\n\r\n            curveArea.append(pointEl);\r\n\r\n            const setPos = (newX: number, newY: number): void => {\r\n                x = newX;\r\n                y = newY;\r\n                internalY = y;\r\n                internalX = x;\r\n                BB.css(pointEl, {\r\n                    left: (x - gripSize / 2) + 'px',\r\n                    top: (y - gripSize / 2) + 'px',\r\n                });\r\n            };\r\n\r\n            return {\r\n                el: pointEl,\r\n                setPos,\r\n                pointerListener,\r\n            };\r\n        };\r\n\r\n        const updateControl = (i: number, x: number, y: number) => {\r\n            if (mode === 'All') {\r\n                curves.r[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n                curves.g[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n                curves.b[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n            if (mode === 'Red') {\r\n                curves.r[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n            if (mode === 'Green') {\r\n                curves.g[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n            if (mode === 'Blue') {\r\n                curves.b[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n        };\r\n\r\n        this.p0 = createPoint(0, areaH, (val: IVector2D) => {\r\n            updateControl(0, val.x, val.y);\r\n            update();\r\n        }, true);\r\n        this.p1 = createPoint(areaW / 3, areaH / 3 * 2, (val: IVector2D) => {\r\n            updateControl(1, val.x, val.y);\r\n            update();\r\n        });\r\n        this.p2 = createPoint(areaW / 3 * 2, areaH / 3, (val: IVector2D) => {\r\n            updateControl(2, val.x, val.y);\r\n            update();\r\n        });\r\n        this.p3 = createPoint(areaW, 0, (val: IVector2D) => {\r\n            updateControl(3, val.x, val.y);\r\n            update();\r\n        }, true);\r\n\r\n\r\n        const update = () => {\r\n            ctx = BB.ctx(canvas);\r\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n            const outCurves: TCurvesInput = {\r\n                r: [],\r\n                g: [],\r\n                b: [],\r\n            };\r\n            for (let i = 0; i < curves.r.length; i++) {\r\n                outCurves.r.push(curves.r[i]);\r\n                outCurves.g.push(curves.g[i]);\r\n                outCurves.b.push(curves.b[i]);\r\n            }\r\n\r\n            const drawCurve = (curve: [number, number][]) => {\r\n                ctx.beginPath();\r\n                const spline = new BB.SplineInterpolator(curve);\r\n                for (let i = 0; i < 100; i++) {\r\n                    let y = spline.interpolate(i / 100);\r\n                    y = Math.max(0, Math.min(1, y));\r\n\r\n                    if (i === 0) {\r\n                        ctx.moveTo(i / 100 * areaW, areaH - y * areaH);\r\n                    } else {\r\n                        ctx.lineTo(i / 100 * areaW, areaH - y * areaH);\r\n                    }\r\n                }\r\n                ctx.stroke();\r\n            };\r\n\r\n            ctx.save();\r\n            if (mode === 'All') {\r\n                ctx.strokeStyle = 'black';\r\n                drawCurve(outCurves.r);\r\n            } else {\r\n                ctx.globalAlpha = 0.5;\r\n                ctx.strokeStyle = 'red';\r\n                drawCurve(outCurves.r);\r\n                ctx.strokeStyle = 'green';\r\n                drawCurve(outCurves.g);\r\n                ctx.strokeStyle = 'blue';\r\n                drawCurve(outCurves.b);\r\n            }\r\n            ctx.restore();\r\n            p.callback(outCurves);\r\n        };\r\n\r\n        update();\r\n    }\r\n\r\n    // ---- interface ----\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.p0.pointerListener.destroy();\r\n        this.p1.pointerListener.destroy();\r\n        this.p2.pointerListener.destroy();\r\n        this.p3.pointerListener.destroy();\r\n    }\r\n\r\n    getModeButtons (): Options<string> {\r\n        return this.modeButtons;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {throwIfNull} from '../../bb/base/base';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {Options} from '../ui/components/options';\r\n\r\nexport type TFilterFlipInput = {\r\n    horizontal: boolean;\r\n    vertical: boolean;\r\n    flipCanvas: boolean;\r\n};\r\n\r\nexport type TFilterFlipHistoryEntry = TFilterHistoryEntry<\r\n    'flip',\r\n    TFilterFlipInput>;\r\n\r\nexport const filterFlip = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterFlipInput> = {\r\n            element: div,\r\n        };\r\n        let isHorizontal = true;\r\n        let isVertical = false;\r\n        let doFlipCanvas = true;\r\n        div.innerHTML = LANG('filter-flip-description') + '<br/><br/>';\r\n\r\n\r\n        const horizontalCheckbox = new Checkbox({\r\n            init: isHorizontal,\r\n            label: LANG('filter-flip-horizontal') + ' ',\r\n            allowTab: true,\r\n            callback: function (v) {\r\n                isHorizontal = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        const verticalCheckbox = new Checkbox({\r\n            init: isVertical,\r\n            label: LANG('filter-flip-vertical') + ' ',\r\n            allowTab: true,\r\n            callback: function (v) {\r\n                isVertical = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        div.append(horizontalCheckbox.getElement());\r\n        div.append(verticalCheckbox.getElement());\r\n\r\n        const targetOptions = new Options<boolean>({\r\n            optionArr: [\r\n                {\r\n                    id: true,\r\n                    label: LANG('filter-flip-image'),\r\n                },\r\n                {\r\n                    id: false,\r\n                    label: LANG('filter-flip-layer'),\r\n                },\r\n            ],\r\n            onChange: (val) => {\r\n                doFlipCanvas = val;\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        div.append(targetOptions.getElement());\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(Math.round(w), Math.round(h)),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over' as TMixMode,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: [previewLayer],\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\r\n\r\n            if (doFlipCanvas) {\r\n                if (isHorizontal) {\r\n                    ctx.translate(previewLayer.image.width, 0);\r\n                    ctx.scale(-1, 1);\r\n                }\r\n                if (isVertical) {\r\n                    ctx.translate(0, previewLayer.image.height);\r\n                    ctx.scale(1, -1);\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < layers.length; i++) {\r\n                ctx.save();\r\n                if (!doFlipCanvas && selectedLayerIndex === i) {\r\n                    if (isHorizontal) {\r\n                        ctx.translate(previewLayer.image.width, 0);\r\n                        ctx.scale(-1, 1);\r\n                    }\r\n                    if (isVertical) {\r\n                        ctx.translate(0, previewLayer.image.height);\r\n                        ctx.scale(1, -1);\r\n                    }\r\n                }\r\n                if (ctx.canvas.width > layers[i].context.canvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.globalAlpha = layers[i].opacity;\r\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\r\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\r\n                ctx.restore();\r\n            }\r\n            klCanvasPreview.render();\r\n            ctx.restore();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            horizontalCheckbox.destroy();\r\n            verticalCheckbox.destroy();\r\n            targetOptions.destroy();\r\n            klCanvasPreview.destroy();\r\n        };\r\n        result.getInput = function (): TFilterFlipInput {\r\n            result.destroy();\r\n            return {\r\n                horizontal: isHorizontal,\r\n                vertical: isVertical,\r\n                flipCanvas: doFlipCanvas,\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterFlipInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        const horizontal = params.input.horizontal;\r\n        const vertical = params.input.vertical;\r\n        const flipCanvas = params.input.flipCanvas;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        klCanvas.flip(\r\n            horizontal,\r\n            vertical,\r\n            flipCanvas ? undefined : throwIfNull(klCanvas.getLayerIndex(context.canvas)),\r\n        );\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['filter', 'flip'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterFlipHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterHueSaturationInput = {\r\n    hue: number;\r\n    saturation: number;\r\n};\r\n\r\nexport type TFilterHueSaturationHistoryEntry = TFilterHistoryEntry<\r\n    'hueSaturation',\r\n    TFilterHueSaturationInput>;\r\n\r\nexport const filterHueSaturation = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height,280, 200,  1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterHueSaturationInput> = {\r\n            element: div,\r\n        };\r\n\r\n        function finishInit (): void {\r\n            let hue = 0, saturation = 0;\r\n            div.innerHTML = LANG('filter-hue-sat-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const hueSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-hue'),\r\n                width: 300,\r\n                height: 30,\r\n                min: -100,\r\n                max: 100,\r\n                value: hue * 100,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    hue = val / 100;\r\n                    fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            const saturationSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-saturation'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (saturation + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    saturation = val / 50 - 1;\r\n                    fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            hueSlider.getElement().style.marginBottom = '10px';\r\n            div.append(hueSlider.getElement(), saturationSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = (): void => {\r\n                hueSlider.destroy();\r\n                saturationSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterHueSaturationInput {\r\n                result.destroy();\r\n                return {\r\n                    hue: hue,\r\n                    saturation: saturation,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterHueSaturationInput>): boolean {\r\n        const context = params.context;\r\n        const hue = params.input.hue;\r\n        const history = params.history;\r\n        const saturation = params.input.saturation;\r\n        if (!context || hue === null || saturation === null || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'hueSaturation'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterHueSaturationHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply} from '../kl-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterInvertInput = null;\r\n\r\nexport type TFilterInvertHistoryEntry = TFilterHistoryEntry<\r\n    'invert',\r\n    TFilterInvertInput>;\r\n\r\nexport const filterInvert = {\r\n\r\n    apply (params: IFilterApply<TFilterInvertInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false;\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).invert().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'invert'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterInvertHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TwoTabs} from '../ui/components/two-tabs';\r\nimport {TRectanglePoints} from '../../fx-canvas/filters/perspective';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterPerspectiveInput = {\r\n    before: TRectanglePoints;\r\n    after: TRectanglePoints;\r\n};\r\n\r\nexport type TFilterPerspectiveHistoryEntry = TFilterHistoryEntry<\r\n    'perspective',\r\n    TFilterPerspectiveInput>;\r\n\r\nexport const filterPerspective = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterPerspectiveInput> = {\r\n            element: div,\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n\r\n        const pointerListenerArr = [];\r\n\r\n        function finishInit (): void {\r\n            div.innerHTML = LANG('filter-perspective-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n            let ba, bb, bc, bd; //before\r\n            let aa, ab, ac, ad; //after\r\n            function update (): void {\r\n                try {\r\n                    fxCanvas.draw(texture).multiplyAlpha().perspective(\r\n                        [ba.x, ba.y, bb.x, bb.y, bc.x, bc.y, bd.x, bd.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        }),\r\n                        [aa.x, aa.y, ab.x, ab.y, ac.x, ac.y, ad.x, ad.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        })\r\n                    ).unmultiplyAlpha().update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob (x, y, callback?) {\r\n                const nobSize = 14;\r\n                const div = document.createElement('div');\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                BB.css(div, {\r\n                    width: nobSize + 'px',\r\n                    height: nobSize + 'px',\r\n                    backgroundColor: '#fff',\r\n                    boxShadow: 'inset 0 0 0 2px #000',\r\n                    borderRadius: nobSize + 'px',\r\n                    position: 'absolute',\r\n                    cursor: 'move',\r\n                    left: ((div as any).x - nobSize / 2) + 'px',\r\n                    top: ((div as any).y - nobSize / 2) + 'px',\r\n                    userSelect: 'none',\r\n                    touchAction: 'none',\r\n                });\r\n\r\n                const pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    onPointer: function (event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + 'px';\r\n                            div.style.top = ((div as any).y - nobSize / 2) + 'px';\r\n                            if (callback) {\r\n                                callback();\r\n                            }\r\n                            update();\r\n                        }\r\n                    },\r\n                });\r\n                (div as any).copy = function (p) {\r\n                    (div as any).x = p.x;\r\n                    (div as any).y = p.y;\r\n                    div.style.left = ((div as any).x - nobSize / 2) + 'px';\r\n                    div.style.top = ((div as any).y - nobSize / 2) + 'px';\r\n                };\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            function updateAfter () {\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            }\r\n\r\n            ba = nob(0, 0, updateAfter);\r\n            bb = nob(displayW, 0, updateAfter);\r\n            bc = nob(displayW, displayH, updateAfter);\r\n            bd = nob(0, displayH, updateAfter);\r\n            aa = nob(0, 0);\r\n            ab = nob(displayW, 0);\r\n            ac = nob(displayW, displayH);\r\n            ad = nob(0, displayH);\r\n\r\n            let before = false;\r\n\r\n            const beforeAfterTabs = new TwoTabs({\r\n                left: LANG('compare-before'),\r\n                right: LANG('compare-after'),\r\n                init: 1,\r\n                onChange: (val: number) => {\r\n                    before = val === 0;\r\n                    if (before) {\r\n                        aa.style.display = 'none';\r\n                        ab.style.display = 'none';\r\n                        ac.style.display = 'none';\r\n                        ad.style.display = 'none';\r\n\r\n                        ba.style.display = 'block';\r\n                        bb.style.display = 'block';\r\n                        bc.style.display = 'block';\r\n                        bd.style.display = 'block';\r\n                        ba.copy(aa);\r\n                        bb.copy(ab);\r\n                        bc.copy(ac);\r\n                        bd.copy(ad);\r\n                    } else {\r\n                        ba.style.display = 'none';\r\n                        bb.style.display = 'none';\r\n                        bc.style.display = 'none';\r\n                        bd.style.display = 'none';\r\n\r\n                        aa.style.display = 'block';\r\n                        ab.style.display = 'block';\r\n                        ac.style.display = 'block';\r\n                        ad.style.display = 'block';\r\n                        aa.copy(ba);\r\n                        ab.copy(bb);\r\n                        ac.copy(bc);\r\n                        ad.copy(bd);\r\n                    }\r\n                    update();\r\n                },\r\n            });\r\n            div.append(beforeAfterTabs.getElement());\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: isSmall ? '340px' : '540px',\r\n                    height: isSmall ? '260px' : '300px',\r\n                    marginTop: '0',\r\n                },\r\n            });\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    const canvas = i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas;\r\n                    previewLayerArr.push({\r\n                        image: canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.append(aa, ab, ac, ad);\r\n\r\n            ba.style.display = 'none';\r\n            bb.style.display = 'none';\r\n            bc.style.display = 'none';\r\n            bd.style.display = 'none';\r\n            previewInnerWrapper.append(ba, bb, bc, bd);\r\n\r\n\r\n            div.append(previewWrapper);\r\n            update();\r\n            result.destroy = (): void => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterPerspectiveInput {\r\n                result.destroy();\r\n                return {\r\n                    before: [\r\n                        ba.x / displayPreviewFactor,\r\n                        ba.y / displayPreviewFactor,\r\n\r\n                        bb.x / displayPreviewFactor,\r\n                        bb.y / displayPreviewFactor,\r\n\r\n                        bc.x / displayPreviewFactor,\r\n                        bc.y / displayPreviewFactor,\r\n\r\n                        bd.x / displayPreviewFactor,\r\n                        bd.y / displayPreviewFactor,\r\n                    ],\r\n                    after: [\r\n                        aa.x / displayPreviewFactor,\r\n                        aa.y / displayPreviewFactor,\r\n\r\n                        ab.x / displayPreviewFactor,\r\n                        ab.y / displayPreviewFactor,\r\n\r\n                        ac.x / displayPreviewFactor,\r\n                        ac.y / displayPreviewFactor,\r\n\r\n                        ad.x / displayPreviewFactor,\r\n                        ad.y / displayPreviewFactor,\r\n                    ],\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterPerspectiveInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const before = params.input.before;\r\n        const after = params.input.after;\r\n        if (!context || !before || !after || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).multiplyAlpha().perspective(before, after).unmultiplyAlpha().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'perspective'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterPerspectiveHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Two buttons next to each other, each representing a tab. one at a time can be active.\r\n */\r\nexport class TwoTabs {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly leftTab: HTMLElement;\r\n    private readonly rightTab: HTMLElement;\r\n    private value: number;\r\n\r\n    private update (): void {\r\n        this.leftTab.classList.toggle('kl-2-tabs--active', this.value === 0);\r\n        this.rightTab.classList.toggle('kl-2-tabs--active', this.value === 1);\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (params: {\r\n        left: string;\r\n        right: string;\r\n        init: number; //0, 1\r\n        onChange: (val: number) => void;\r\n    }) {\r\n        this.value = params.init;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-2-tabs',\r\n        });\r\n\r\n        this.leftTab = BB.el({\r\n            parent: this.rootEl,\r\n            content: params.left,\r\n            className: 'kl-2-tabs__left',\r\n        });\r\n        this.leftTab.onpointerdown = () => false;\r\n\r\n        this.rightTab = BB.el({\r\n            parent: this.rootEl,\r\n            content: params.right,\r\n            className: 'kl-2-tabs__right',\r\n        });\r\n        this.rightTab.onpointerdown = () => false;\r\n\r\n        this.update();\r\n\r\n        this.leftTab.onclick = () => {\r\n            if (this.value === 0) {\r\n                return;\r\n            }\r\n            this.value = 0;\r\n            this.update();\r\n            params.onChange(this.value);\r\n        };\r\n\r\n        this.rightTab.onclick = () => {\r\n            if (this.value === 1) {\r\n                return;\r\n            }\r\n            this.value = 1;\r\n            this.update();\r\n            params.onChange(this.value);\r\n        };\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {Select} from '../ui/components/select';\r\nimport constrainImg from '/src/app/img/ui/constrain.svg';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {table} from '../ui/components/table';\r\nimport {theme} from '../../theme/theme';\r\n\r\nexport type TFilterResizeInput = {\r\n    width: number;\r\n    height: number;\r\n    algorithm: 'smooth' | 'pixelated';\r\n};\r\n\r\nexport type TFilterResizeHistoryEntry = TFilterHistoryEntry<\r\n    'resize',\r\n    TFilterResizeInput>;\r\n\r\nexport const filterResize = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        //BB.centerWithin\r\n        const klCanvas = params.klCanvas;\r\n        if (!klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const fit = BB.fitInto( klCanvas.getWidth(), klCanvas.getHeight(), 280, 200,1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let previewFactor = w / klCanvas.getWidth();\r\n        const tempCanvas = klCanvas.getCompleteCanvas(1);\r\n\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterResizeInput> = {\r\n            element: div,\r\n        };\r\n        let newWidth = klCanvas.getWidth(), newHeight = klCanvas.getHeight();\r\n\r\n        div.innerHTML = LANG('filter-resize-description') + '<br/><br/>';\r\n\r\n\r\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n\r\n        const widthWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            },\r\n        });\r\n        const heightWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            },\r\n        });\r\n        const widthInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxWidth,\r\n                value: '' + klCanvas.getWidth(),\r\n            },\r\n        }) as HTMLInputElement;\r\n        const heightInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxHeight,\r\n                value: '' + klCanvas.getHeight(),\r\n            },\r\n        }) as HTMLInputElement;\r\n        widthInput.onclick = function () {\r\n            (this as any).focus();\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onclick = function () {\r\n            (this as any).focus();\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthInput.onchange = function () {\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onchange = function () {\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthWrapper.append(LANG('width') + ': ', widthInput);\r\n        heightWrapper.append(LANG('height') + ': ', heightInput);\r\n        const inputWrapper = BB.el({\r\n            css: {\r\n                background: 'url(' + constrainImg + ') no-repeat 140px 5px',\r\n                backgroundSize: '50px 52px',\r\n            },\r\n        });\r\n        inputWrapper.append(widthWrapper, heightWrapper);\r\n        const constrainIm = new Image();\r\n        constrainIm.src = constrainImg;\r\n        constrainIm.height = 40;\r\n\r\n        const sizeTable = table([\r\n            [\r\n                LANG('width') + ':&nbsp;',\r\n                widthInput,\r\n                constrainIm,\r\n            ],\r\n            [\r\n                BB.el({css: {height: '5px'}}),\r\n                '',\r\n                '',\r\n            ],\r\n            [\r\n                LANG('height') + ':&nbsp;',\r\n                heightInput,\r\n            ],\r\n        ], {\r\n            '0.2': {rowspan: 3},\r\n        });\r\n        BB.css(sizeTable, {\r\n            marginBottom: '10px',\r\n        });\r\n\r\n        div.append(sizeTable);\r\n\r\n        //contrain checkbox\r\n        let heightChanged = false, widthChanged = false;\r\n        const ratio = klCanvas.getWidth() / klCanvas.getHeight();\r\n\r\n        function updateConstrain (): void {\r\n            constrainIm.style.display = isConstrained ? '' : 'none';\r\n            if (isConstrained) {\r\n                widthInput.value = '' + klCanvas.getWidth();\r\n                heightInput.value = '' + klCanvas.getHeight();\r\n                update();\r\n            }\r\n        }\r\n\r\n        let isConstrained = true;\r\n        const constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                isConstrained = b;\r\n                updateConstrain();\r\n            },\r\n        });\r\n        div.append(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n            },\r\n        }));\r\n\r\n\r\n        const algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')],\r\n            ],\r\n            title: LANG('scaling-algorithm'),\r\n            initValue: 'smooth',\r\n            onChange: function () {\r\n                update();\r\n            },\r\n        });\r\n\r\n        const secondRowElement = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                'alignItems': 'center',\r\n            },\r\n        });\r\n        secondRowElement.append(constrainCheckbox.getElement(), algorithmSelect.getElement());\r\n\r\n        const previewCanvas = BB.canvas(w, h);\r\n        previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n\r\n        const previewCtx = BB.ctx(previewCanvas);\r\n\r\n\r\n        function draw (): void {\r\n            if (algorithmSelect.getValue() === 'smooth') {\r\n                previewCanvas.style.imageRendering = previewFactor > 1 ? 'pixelated' : '';\r\n\r\n                previewCanvas.width = klCanvas.getWidth();\r\n                previewCanvas.height = klCanvas.getHeight();\r\n\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingQuality = 'high';\r\n                previewCtx.drawImage(tempCanvas, 0, 0);\r\n                BB.resizeCanvas(previewCanvas, newWidth, newHeight);\r\n                previewCtx.restore();\r\n\r\n            } else {\r\n                previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n                previewCanvas.width = newWidth;\r\n                previewCanvas.height = newHeight;\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingEnabled = false;\r\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\r\n                previewCtx.restore();\r\n            }\r\n\r\n        }\r\n\r\n        function update (): void {\r\n            if ((widthInput.value.length === 0 && widthChanged) || (heightInput.value.length === 0 && heightChanged)) {\r\n                heightChanged = false;\r\n                widthChanged = false;\r\n                return;\r\n            }\r\n            widthInput.value = '' + Math.max(1, parseInt(widthInput.value));\r\n            heightInput.value = '' + Math.max(1, parseInt(heightInput.value));\r\n            if (isConstrained) {\r\n                if (heightChanged) {\r\n                    widthInput.value = '' + parseInt('' + (parseInt(heightInput.value) * ratio));\r\n                }\r\n                if (widthChanged) {\r\n                    heightInput.value = '' + parseInt('' + (parseInt(widthInput.value) / ratio));\r\n                }\r\n\r\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\r\n                    const fit = BB.fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\r\n                    widthInput.value = '' + parseInt('' + fit.width);\r\n                    heightInput.value = '' + parseInt('' + fit.height);\r\n                }\r\n            }\r\n\r\n            if (parseInt(widthInput.value) > maxWidth) {\r\n                widthInput.value = '' + maxWidth;\r\n            }\r\n            if (parseInt(heightInput.value) > maxHeight) {\r\n                heightInput.value = '' + maxHeight;\r\n            }\r\n\r\n            heightChanged = false;\r\n            widthChanged = false;\r\n\r\n            newWidth = parseInt(widthInput.value);\r\n            newHeight = parseInt(heightInput.value);\r\n\r\n            const preview = BB.fitInto(newWidth, newHeight, 280, 200, 1);\r\n            const previewW = parseInt('' + preview.width), previewH = parseInt('' + preview.height);\r\n            previewFactor = previewW / newWidth;\r\n\r\n            const offset = BB.centerWithin(340, 220, previewW, previewH);\r\n\r\n            draw();\r\n\r\n            previewCanvas.style.width = Math.max(1, previewW) + 'px';\r\n            previewCanvas.style.height = Math.max(1, previewH) + 'px';\r\n            canvasWrapper.style.left = offset.x + 'px';\r\n            canvasWrapper.style.top = offset.y + 'px';\r\n            canvasWrapper.style.width = Math.max(1, previewW) + 'px';\r\n            canvasWrapper.style.height = Math.max(1, previewH) + 'px';\r\n        }\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-transparent-preview',\r\n            css: {\r\n                width: '340px',\r\n                marginLeft: '-20px',\r\n                height: '220px',\r\n                display: 'table',\r\n                marginTop: '10px',\r\n                position: 'relative',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n\r\n        const canvasWrapper = BB.el({\r\n            parent: previewWrapper,\r\n            content: previewCanvas,\r\n            className: 'kl-transparent-preview__canvas',\r\n            css: {\r\n                width: w + 'px',\r\n                height: h + 'px',\r\n                position: 'absolute',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n        function updateCheckerboard (): void {\r\n            BB.createCheckerDataUrl(8, function (url) {\r\n                previewWrapper.style.background = 'url(' + url + ')';\r\n            }, theme.isDark());\r\n        }\r\n        theme.addIsDarkListener(updateCheckerboard);\r\n        updateCheckerboard();\r\n\r\n\r\n        div.append(previewWrapper);\r\n        update();\r\n\r\n        result.destroy = (): void => {\r\n            constrainCheckbox.destroy();\r\n            theme.removeIsDarkListener(updateCheckerboard);\r\n        };\r\n        result.getInput = function (): TFilterResizeInput {\r\n            result.destroy();\r\n            return {\r\n                width: newWidth,\r\n                height: newHeight,\r\n                algorithm: algorithmSelect.getValue(),\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterResizeInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        const width = params.input.width;\r\n        const height = params.input.height;\r\n        const algorithm = params.input.algorithm;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.resize(width, height, algorithm);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'resize'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterResizeHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"c92cL\");","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {theme} from '../../theme/theme';\r\n\r\nexport type TFilterRotateInput = {\r\n    deg: number;\r\n}\r\n\r\nexport type TFilterRotateHistoryEntry = TFilterHistoryEntry<\r\n    'rotate',\r\n    TFilterRotateInput>;\r\n\r\nexport const filterRotate = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const klCanvas = params.klCanvas;\r\n        if (!klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const previewFactor = w / klCanvas.getWidth();\r\n        const tempCanvas = BB.canvas(w, h);\r\n        tempCanvas.style.display = 'block';\r\n        BB.ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterRotateInput> = {\r\n            element: div,\r\n        };\r\n        let deg = 0;\r\n        div.innerHTML = LANG('filter-rotate-description') + '<br/><br/>';\r\n\r\n        function update (): void {\r\n            canvasWrapper.style.transform = 'rotate(' + deg + 'deg)';\r\n            if (Math.abs(deg % 180) === 90) {\r\n                //height has to fit width because of rotation\r\n                const fit = BB.fitInto(h, w, 280, 200, 1);\r\n                const scale = parseInt('' + fit.height) / w;\r\n                canvasWrapper.style.transform = 'rotate(' + deg + 'deg) scale(' + scale + ')';\r\n            }\r\n        }\r\n\r\n        const btnPlus = document.createElement('button');\r\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        const btnMinus = document.createElement('button');\r\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        btnMinus.style.marginRight = '5px';\r\n\r\n\r\n        btnPlus.onclick = function () {\r\n            deg += 90;\r\n            update();\r\n        };\r\n        btnMinus.onclick = function () {\r\n            deg -= 90;\r\n            update();\r\n        };\r\n\r\n        div.append(btnMinus, btnPlus);\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n                display: 'table',\r\n            },\r\n        });\r\n\r\n        const previewcell = BB.el({\r\n            parent: previewWrapper,\r\n            css: {\r\n                display: 'table-cell',\r\n                verticalAlign: 'middle',\r\n            },\r\n        });\r\n        const canvasWrapper = BB.el({\r\n            parent: previewcell,\r\n            content: tempCanvas,\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: w + 'px',\r\n                height: h + 'px',\r\n                marginLeft: 'auto',\r\n                marginRight: 'auto',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n\r\n        function updateCheckerboard (): void {\r\n            BB.createCheckerDataUrl(8, function (url) {\r\n                canvasWrapper.style.background = 'url(' + url + ')';\r\n            }, theme.isDark());\r\n        }\r\n        theme.addIsDarkListener(updateCheckerboard);\r\n        updateCheckerboard();\r\n\r\n        canvasWrapper.style.transition = 'all 0.2s ease-out';\r\n\r\n        div.append(previewWrapper);\r\n        update();\r\n\r\n        result.destroy = (): void => {\r\n            theme.removeIsDarkListener(updateCheckerboard);\r\n        };\r\n        result.getInput = function (): TFilterRotateInput {\r\n            result.destroy();\r\n            return {\r\n                deg: deg,\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterRotateInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.rotate(params.input.deg);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'rotate'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterRotateHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterTiltShiftInput = {\r\n    a: IVector2D;\r\n    b: IVector2D;\r\n    blur: number;\r\n    gradient: number;\r\n};\r\n\r\nexport type TFilterTiltShiftHistoryEntry = TFilterHistoryEntry<\r\n    'tiltShift',\r\n    TFilterTiltShiftInput>;\r\n\r\nexport const filterTiltShift = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const previewFactor = w / context.canvas.width;\r\n        const displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterTiltShiftInput> = {\r\n            element: div,\r\n        };\r\n\r\n        const pointerListenerArr = [];\r\n\r\n        function finishInit () {\r\n            let blur = 20, gradient = 200;\r\n            div.innerHTML = LANG('filter-tilt-shift-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n            let fa, fb; // focus line\r\n            function update () {\r\n                try {\r\n                    fxCanvas.draw(texture).tiltShift(\r\n                        fa.x / displayPreviewFactor * previewFactor,\r\n                        fa.y / displayPreviewFactor * previewFactor,\r\n                        fb.x / displayPreviewFactor * previewFactor,\r\n                        fb.y / displayPreviewFactor * previewFactor,\r\n                        blur * previewFactor,\r\n                        gradient * previewFactor\r\n                    ).update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob (x, y) {\r\n                const nobSize = 14;\r\n                const div = BB.el({\r\n                    css: {\r\n                        width: nobSize + 'px',\r\n                        height: nobSize + 'px',\r\n                        backgroundColor: '#fff',\r\n                        boxShadow: 'inset 0 0 0 2px #000',\r\n                        borderRadius: nobSize + 'px',\r\n                        position: 'absolute',\r\n                        cursor: 'move',\r\n                        left: (x - nobSize / 2) + 'px',\r\n                        top: (y - nobSize / 2) + 'px',\r\n                        userSelect: 'none',\r\n                        touchAction: 'none',\r\n                    },\r\n                });\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                const pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    onPointer: function (event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + 'px';\r\n                            div.style.top = ((div as any).y - nobSize / 2) + 'px';\r\n                            update();\r\n                        }\r\n                    },\r\n                });\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            fa = nob(parseInt('' + (displayW / 6)), parseInt('' + (displayH / 2)));\r\n            fb = nob(parseInt('' + (displayW - displayW / 6)), parseInt('' + (displayH - displayH / 3)));\r\n\r\n            const blurSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-blur'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                value: blur,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    blur = val;\r\n                    update();\r\n                },\r\n            });\r\n            blurSlider.getElement().style.marginBottom = '10px';\r\n            div.append(blurSlider.getElement());\r\n            const gradientSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-gradient'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1000,\r\n                value: gradient,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    gradient = val;\r\n                    update();\r\n                },\r\n            });\r\n            div.append(gradientSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.append(fa, fb);\r\n\r\n\r\n            div.append(previewWrapper);\r\n            update();\r\n            result.destroy = (): void => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                blurSlider.destroy();\r\n                gradientSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterTiltShiftInput {\r\n                result.destroy();\r\n                return {\r\n                    a: {x: fa.x / displayPreviewFactor, y: fa.y / displayPreviewFactor},\r\n                    b: {x: fb.x / displayPreviewFactor, y: fb.y / displayPreviewFactor},\r\n                    blur: blur,\r\n                    gradient: gradient,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterTiltShiftInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const a = params.input.a;\r\n        const b = params.input.b;\r\n        const blur = params.input.blur;\r\n        const gradient = params.input.gradient;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).tiltShift(a.x, a.y, b.x, b.y, blur, gradient).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'tiltShift'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterTiltShiftHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {FreeTransform} from '../ui/components/free-transform';\r\nimport {IFreeTransform} from '../ui/components/free-transform-utils';\r\nimport {Select} from '../ui/components/select';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {IRect} from '../../bb/bb-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterTransformInput = {\r\n    bounds: {x: number; y: number; width: number; height: number};\r\n    transform: IFreeTransform;\r\n    isPixelated: boolean;\r\n};\r\n\r\nexport type TFilterTransformHistoryEntry = TFilterHistoryEntry<\r\n    'transform',\r\n    TFilterTransformInput>;\r\n\r\nexport const filterTransform = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n        let freeTransform: FreeTransform;\r\n        const displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        // determine bounds and initial transformation\r\n        const boundsObj: IRect = BB.canvasBounds(context);\r\n        if (boundsObj === null) {\r\n            alert(LANG('filter-transform-empty'));\r\n            return false;\r\n        }\r\n        const initTransform = {\r\n            x: boundsObj.x + boundsObj.width / 2,\r\n            y: boundsObj.y + boundsObj.height / 2,\r\n            width: boundsObj.width,\r\n            height: boundsObj.height,\r\n            angleDeg: 0,\r\n        };\r\n\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterTransformInput> = {\r\n            element: div,\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        div.innerHTML = LANG('filter-transform-description');\r\n\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: function (keyStr) {\r\n                if (BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n\r\n                if (keyStr === 'left') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'right') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'up') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'down') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n            },\r\n\r\n        });\r\n\r\n        const leftWrapper = document.createElement('div');\r\n        const rightWrapper = document.createElement('div');\r\n        const rotWrapper = document.createElement('div');\r\n        const inputY = document.createElement('input');\r\n        const inputX = document.createElement('input');\r\n        const inputR = document.createElement('input');\r\n        leftWrapper.style.width = '100px';\r\n        leftWrapper.style.height = '30px';\r\n        rightWrapper.style.width = '100px';\r\n        rightWrapper.style.height = '30px';\r\n        rightWrapper.style.display = 'inline-block';\r\n        leftWrapper.style.display = 'inline-block';\r\n        rotWrapper.style.display = 'inline-block';\r\n        rotWrapper.style.width = '150px';\r\n        rotWrapper.style.height = '30px';\r\n        inputY.type = 'number';\r\n        inputX.type = 'number';\r\n        inputR.type = 'number';\r\n        inputX.style.width = 70 + 'px';\r\n        inputY.style.width = 70 + 'px';\r\n        inputR.style.width = 70 + 'px';\r\n        inputY.value = '0';\r\n        inputX.value = '0';\r\n        inputR.value = '0';\r\n        inputY.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputX.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputR.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputY.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputY.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        leftWrapper.append('X: ', inputX);\r\n        rightWrapper.append('Y: ', inputY);\r\n        rotWrapper.append(LANG('filter-transform-rotation') + ': ', inputR);\r\n        if (!isSmall) {\r\n            const inputRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\r\n        }\r\n\r\n        // buttons\r\n        const actionBtnCss = {\r\n            marginLeft: '10px',\r\n            marginTop: '10px',\r\n        };\r\n        const buttonRow = BB.el ({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginLeft: '-10px',\r\n            },\r\n        });\r\n        const flipXBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' X',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(-t.width, t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const flipYBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' Y',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(t.width, -t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotLeftBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '-90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg -= 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotRightBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '+90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg += 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleDoubleBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                if (constrainCheckbox.getValue()) {\r\n                    freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\r\n                } else {\r\n                    freeTransform.setSize(t.width * 2, t.height * 2);\r\n                }\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleHalfBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '1/2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const centerBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('center'),\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setPos({ x: context.canvas.width / 2, y: context.canvas.height / 2 });\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n\r\n\r\n\r\n\r\n\r\n        let isConstrained = true;\r\n        const constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-constrain'),\r\n            title: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                isConstrained = b;\r\n                freeTransform.setConstrained(isConstrained);\r\n            },\r\n            css: {\r\n                display: 'inline-block',\r\n            },\r\n        });\r\n        let isSnapping = false;\r\n        const snappingCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-snap'),\r\n            title: LANG('filter-transform-snap-title'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                isSnapping = b;\r\n                freeTransform.setSnapping(isSnapping);\r\n            },\r\n            css: {\r\n                display: 'inline-block',\r\n                marginLeft: '10px',\r\n            },\r\n        });\r\n        const checkboxWrapper = BB.el();\r\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\r\n\r\n        div.append(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n                height: '10px',\r\n            },\r\n        }));\r\n\r\n        const bottomRow = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n\r\n        const algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')],\r\n            ],\r\n            initValue: 'smooth',\r\n            title: LANG('scaling-algorithm'),\r\n            onChange: function () {\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                height: isSmall ? '260px' : '300px',\r\n            },\r\n        });\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n\r\n        const previewLayerArr: IKlBasicLayer[] = [];\r\n        {\r\n            for (let i = 0; i < layers.length; i++) {\r\n                let canvas;\r\n                if (i === selectedLayerIndex) {\r\n                    canvas = BB.canvas(parseInt('' + w), parseInt('' + h));\r\n                    const ctx = BB.ctx(canvas);\r\n                    ctx.drawImage(layers[i].context.canvas, 0, 0, canvas.width, canvas.height);\r\n                } else {\r\n                    canvas = layers[i].context.canvas;\r\n                }\r\n                previewLayerArr.push({\r\n                    image: canvas,\r\n                    opacity: layers[i].opacity,\r\n                    mixModeStr: layers[i].mixModeStr,\r\n                });\r\n            }\r\n        }\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: parseInt('' + displayW),\r\n            height: parseInt('' + displayH),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + displayW) + 'px',\r\n                height: parseInt('' + displayH) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        let lastDrawnTransformStr;\r\n        function updatePreview (doForce: boolean = false) {\r\n            if (!freeTransform) {\r\n                return;\r\n            }\r\n            const transform = freeTransform.getTransform();\r\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) {\r\n                return;\r\n            }\r\n            lastDrawnTransformStr = JSON.stringify(transform);\r\n            if (displayPreviewFactor < 1) {\r\n                transform.x *= displayPreviewFactor;\r\n                transform.y *= displayPreviewFactor;\r\n                transform.width *= displayPreviewFactor;\r\n                transform.height *= displayPreviewFactor;\r\n            }\r\n            const transformLayerCanvas = previewLayerArr[selectedLayerIndex].image as HTMLCanvasElement;\r\n            const ctx = BB.ctx(transformLayerCanvas);\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, transformLayerCanvas.width, transformLayerCanvas.height);\r\n            BB.drawTransformedImageWithBounds(\r\n                ctx,\r\n                layers[selectedLayerIndex].context.canvas,\r\n                transform,\r\n                boundsObj,\r\n                algorithmSelect.getValue() === 'pixelated' ||\r\n                BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            );\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: initTransform.angleDeg,\r\n            isConstrained: true,\r\n            snapX: [0, context.canvas.width],\r\n            snapY: [0, context.canvas.height],\r\n            callback: function (t) {\r\n                inputX.value = '' + Math.round(t.x - initTransform.x);\r\n                inputY.value = '' + Math.round(t.y - initTransform.y);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            scale: displayPreviewFactor,\r\n        });\r\n        BB.css(freeTransform.getElement(), {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n        });\r\n        previewInnerWrapper.append(freeTransform.getElement());\r\n\r\n        function onInputsChanged () {\r\n            freeTransform.setPos({\r\n                x: parseInt(inputX.value) + initTransform.x,\r\n                y: parseInt(inputY.value) + initTransform.y}\r\n            );\r\n            freeTransform.setAngleDeg(parseInt(inputR.value));\r\n            updatePreview();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            keyListener.destroy();\r\n            freeTransform.destroy();\r\n            constrainCheckbox.destroy();\r\n            snappingCheckbox.destroy();\r\n            BB.destroyEl(flipXBtn);\r\n            BB.destroyEl(flipYBtn);\r\n            BB.destroyEl(scaleRotLeftBtn);\r\n            BB.destroyEl(scaleRotRightBtn);\r\n            BB.destroyEl(scaleDoubleBtn);\r\n            BB.destroyEl(scaleHalfBtn);\r\n            BB.destroyEl(centerBtn);\r\n            klCanvasPreview.destroy();\r\n        };\r\n        result.getInput = function (): TFilterTransformInput {\r\n            const transform = freeTransform.getTransform();\r\n            const input: TFilterTransformInput = {\r\n                transform,\r\n                bounds: boundsObj,\r\n                isPixelated: algorithmSelect.getValue() === 'pixelated' ||\r\n                    BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            };\r\n            result.destroy();\r\n            return BB.copyObj(input);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterTransformInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const input = params.input;\r\n\r\n        const copyCanvas = BB.copyCanvas(context.canvas);\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            context,\r\n            copyCanvas,\r\n            input.transform,\r\n            input.bounds,\r\n            input.isPixelated,\r\n        );\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'transform'],\r\n            action: 'apply',\r\n            params: [{input}],\r\n        } as TFilterTransformHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterBlurInput = {\r\n    radius: number;\r\n}\r\n\r\nexport type TFilterBlurHistoryEntry = TFilterHistoryEntry<\r\n    'blur',\r\n    TFilterBlurInput>;\r\n\r\n\r\nexport const filterBlur = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const klCanvas = params.klCanvas;\r\n        const context = params.context;\r\n        if (!klCanvas || !context) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterBlurInput> = {\r\n            element: div,\r\n        };\r\n\r\n\r\n        function finishInit (): void {\r\n            let radius = 10;\r\n            div.innerHTML = LANG('filter-triangle-blur-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 1,\r\n                max: 200,\r\n                value: radius,\r\n                eventResMs: eventResMs,\r\n                onChange: (val): void => {\r\n                    radius = val;\r\n                    fxCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            div.append(radiusSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = (): void => {\r\n                texture.destroy();\r\n                radiusSlider.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterBlurInput {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterBlurInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const radius = params.input.radius;\r\n        if (!context || !radius || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).triangleBlur(radius).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'blur'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterBlurHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterUnsharpMaskInput = {\r\n    radius: number;\r\n    strength: number;\r\n};\r\n\r\nexport type TFilterUnsharpMaskHistoryEntry = TFilterHistoryEntry<\r\n    'unsharpMask',\r\n    TFilterUnsharpMaskInput>;\r\n\r\nexport const filterUnsharpMask = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterUnsharpMaskInput> = {\r\n            element: div,\r\n        };\r\n\r\n        function finishInit () {\r\n            let radius = 2, strength = 5.1 / 10;\r\n            div.innerHTML = LANG('filter-unsharp-mask-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                value: 2,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    radius = val;\r\n                    fxCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 50], [1, 200]],\r\n            });\r\n            const strengthSlider = new KlSlider({\r\n                label: LANG('filter-unsharp-mask-strength'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 50,\r\n                value: 5.1,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    strength = val / 10;\r\n                    fxCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 10], [1, 50]],\r\n            });\r\n            radiusSlider.getElement().style.marginBottom = '10px';\r\n            div.append(radiusSlider.getElement());\r\n            div.append(strengthSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                klCanvasPreview.render();\r\n            } catch (e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = (): void => {\r\n                radiusSlider.destroy();\r\n                strengthSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterUnsharpMaskInput {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius,\r\n                    strength: strength,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply (params: IFilterApply<TFilterUnsharpMaskInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const radius = params.input.radius;\r\n        const strength = params.input.strength;\r\n        if (!context || radius === null || strength === null || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).unsharpMask(radius, strength).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'unsharpMask'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterUnsharpMaskHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Options} from '../ui/components/options';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, IRGBA} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterToAlphaInput = {\r\n    sourceId: string;\r\n    selectedRgbaObj: IRGBA;\r\n};\r\n\r\nexport type TFilterToAlphaHistoryEntry = TFilterHistoryEntry<\r\n    'toAlpha',\r\n    TFilterToAlphaInput>;\r\n\r\nexport const filterToAlpha = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterToAlphaInput> = {\r\n            element: div,\r\n        };\r\n\r\n        function finishInit () {\r\n            const radius = 2, strength = 5.1 / 10;\r\n            div.append(BB.el({\r\n                content: LANG('filter-to-alpha-description'),\r\n                css: {\r\n                    marginBottom: '5px',\r\n                },\r\n            }));\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            function updatePreview () {\r\n                fxCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n                klCanvasPreview.render();\r\n            }\r\n\r\n            // source\r\n            let sourceId = 'inverted-luminance';\r\n            const sourceOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'inverted-luminance',\r\n                        label: LANG('filter-to-alpha-inverted-lum'),\r\n                    },\r\n                    {\r\n                        id: 'luminance',\r\n                        label: LANG('filter-to-alpha-lum'),\r\n                    },\r\n                ],\r\n                initId: sourceId,\r\n                onChange: function (id) {\r\n                    sourceId = id;\r\n                    updatePreview();\r\n                },\r\n            });\r\n            div.append(sourceOptions.getElement());\r\n\r\n            // color\r\n            let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n            const colorOptionsArr = [\r\n                null,\r\n                {r: 0, g: 0, b: 0, a: 1},\r\n                {r: 255, g: 255, b: 255, a: 1},\r\n            ];\r\n            colorOptionsArr.push({\r\n                r: params.currentColorRgb.r,\r\n                g: params.currentColorRgb.g,\r\n                b: params.currentColorRgb.b,\r\n                a: 1,\r\n            });\r\n            colorOptionsArr.push({\r\n                r: params.secondaryColorRgb.r,\r\n                g: params.secondaryColorRgb.g,\r\n                b: params.secondaryColorRgb.b,\r\n                a: 1,\r\n            });\r\n\r\n            const colorOptions = new ColorOptions({\r\n                label: LANG('filter-to-alpha-replace'),\r\n                colorArr: colorOptionsArr,\r\n                initialIndex: 1,\r\n                onChange: function (rgbaObj) {\r\n                    selectedRgbaObj = rgbaObj;\r\n                    updatePreview();\r\n                },\r\n            });\r\n            colorOptions.getElement().style.marginTop = '10px';\r\n            div.append(colorOptions.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            setTimeout(function () { //ie has a problem otherwise...\r\n                try {\r\n                    updatePreview();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }, 1);\r\n\r\n            result.destroy = (): void => {\r\n                texture.destroy();\r\n                sourceOptions.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterToAlphaInput {\r\n                result.destroy();\r\n                return {\r\n                    sourceId: sourceId,\r\n                    selectedRgbaObj: selectedRgbaObj,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply (params: IFilterApply<TFilterToAlphaInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const sourceId = params.input.sourceId;\r\n        const selectedRgbaObj = params.input.selectedRgbaObj;\r\n        if (!context || !sourceId || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'toAlpha'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterToAlphaHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {input} from '../ui/components/input';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {drawGrid} from '../image-operations/draw-grid';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterGridInput = {\r\n    x: number;\r\n    y: number;\r\n    thickness: number;\r\n    color: string;\r\n    opacity: number;\r\n};\r\n\r\nexport type TFilterGridHistoryEntry = TFilterHistoryEntry<\r\n    'grid',\r\n    TFilterGridInput>;\r\n\r\nexport const filterGrid = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterGridInput> = {\r\n            element: div,\r\n        };\r\n        div.innerHTML = LANG('filter-grid-description') + '<br/><br/>';\r\n\r\n        const settingsObj: TFilterGridInput = {\r\n            x: 2,\r\n            y: 2,\r\n            thickness: 2,\r\n            color: '#000',\r\n            opacity: 1,\r\n        };\r\n\r\n        const line1 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        const line2 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n        const xInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.x = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const yInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.y = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const thicknessInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.thickness = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n        settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('shape-stroke'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function (rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            marginRight: '5px',\r\n        };\r\n        line1.append(\r\n            BB.el({content: 'X:', css: labelStyle}),\r\n            xInput,\r\n            BB.el({content: 'Y:', css: labelStyle}),\r\n            yInput,\r\n        );\r\n        line2.append(\r\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\r\n            thicknessInput,\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorOptions.getElement(),\r\n        );\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            }),\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n            drawGrid(ctx, settingsObj.x, settingsObj.y, Math.max(settingsObj.thickness * renderFactor, 1), settingsObj.color, settingsObj.opacity);\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            klCanvasPreview.destroy();\r\n            colorOptions.destroy();\r\n        };\r\n        result.getInput = function (): TFilterGridInput {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterGridInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        drawGrid(\r\n            context,\r\n            params.input.x,\r\n            params.input.y,\r\n            params.input.thickness,\r\n            params.input.color,\r\n            params.input.opacity,\r\n        );\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['filter', 'grid'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterGridHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","\r\n// ideas: padding, gutter, other shapes\r\n\r\nexport function drawGrid (\r\n    ctx: CanvasRenderingContext2D,\r\n    cellsX: number,\r\n    cellsY: number,\r\n    thickness: number, // px\r\n    color: string,\r\n    opacity: number, // 0 - 1\r\n) {\r\n    ctx.save();\r\n    const w = ctx.canvas.width;\r\n    const h = ctx.canvas.height;\r\n    thickness = Math.round(thickness);\r\n    const thickIsRound = thickness % 2 === 0;\r\n\r\n    ctx.beginPath();\r\n    ctx.lineWidth = thickness;\r\n    ctx.strokeStyle = color;\r\n    ctx.globalAlpha = opacity;\r\n\r\n    for(let i = 0; i < cellsX - 1; i++) {\r\n        const cw = w / (cellsX);\r\n        let pos = cw * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n        ctx.moveTo(pos, 0);\r\n        ctx.lineTo(pos, h);\r\n\r\n    }\r\n    for(let i = 0; i < cellsY - 1; i++) {\r\n        const ch = h / (cellsY);\r\n        let pos = ch * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n\r\n        ctx.moveTo(0, pos);\r\n        ctx.lineTo(w, pos);\r\n    }\r\n\r\n    ctx.stroke();\r\n    ctx.restore();\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, IRGB, TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {Options} from '../ui/components/options';\r\nimport {eventResMs} from './filters-consts';\r\nimport {Select} from '../ui/components/select';\r\nimport {translateBlending} from '../canvas/translate-blending';\r\nimport {KL} from '../kl';\r\nimport {ColorConverter} from '../../bb/color/color';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {TFxCanvas} from '../../fx-canvas/fx-canvas-types';\r\nimport {TKlCanvasHistoryEntry} from '../canvas/kl-canvas';\r\n\r\n// see noise(...) in fx-canvas\r\ninterface INoisePreset {\r\n    type: number;\r\n    scaleX: number;\r\n    scaleY: number;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    octaves: number;\r\n    samples: number;\r\n    peaks: number;\r\n    brightness: number;\r\n    contrast: number;\r\n    isReversed: boolean;\r\n}\r\n\r\ntype TNoiseChannels = 'rgb' | 'alpha';\r\n\r\ninterface INoiseSettings extends INoisePreset {\r\n    seed: number;\r\n    colA: IRGB;\r\n    colB: IRGB;\r\n    channels: TNoiseChannels;\r\n}\r\n\r\nexport type TFilterNoiseInput = {\r\n    seed: number;\r\n    presetIndex: number; // which preset from presetArr\r\n    scale: number; // applies to both scaleX and scaleX\r\n    opacity: number; // aka strength\r\n    isReversed: boolean; // reverse direction of color gradient\r\n    channels: TNoiseChannels;\r\n\r\n    // only for channels = rgb\r\n    mixModeStr: GlobalCompositeOperation; // how mixed with image\r\n    colA: IRGB;\r\n    colB: IRGB;\r\n}\r\n\r\n/*export type TFilterNoiseHistoryEntry = TFilterHistoryEntry<\r\n    'replaceLayer',\r\n    TFilterNoiseInput>;*/\r\n\r\nconst presetArr: INoisePreset[] = [\r\n    // each pixel random value\r\n    {type: 0, scaleX: 1, scaleY: 1, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: true},\r\n\r\n    // cloud\r\n    {type: 1, scaleX: 166, scaleY: 164, offsetX: 105, offsetY: 30, octaves: 6, samples: 1, peaks: 0, brightness: 0.055, contrast: 0.23, isReversed: true},\r\n\r\n    // thin lines\r\n    {type: 1, scaleX: 235, scaleY: 190, offsetX: 3227, offsetY: 2156, octaves: 4, samples: 16, peaks: 22, brightness: -0.375, contrast: 1, isReversed: false},\r\n\r\n    // soft large simplex, only 1 octave\r\n    {type: 1, scaleX: 40, scaleY: 40, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: false},\r\n\r\n    // two value large pixels\r\n    {type: 0, scaleX: 26, scaleY: 26, offsetX: 557, offsetY: 365, octaves: 1, samples: 1, peaks: 0, brightness: 0.02, contrast: 1, isReversed: true},\r\n\r\n    // zebra\r\n    {type: 1, scaleX: 1500, scaleY: 1500, offsetX: 745, offsetY: 2871, octaves: 5, samples: 16, peaks: 156.02, brightness: 0.03, contrast: 1, isReversed: true},\r\n\r\n    // sparse dots / stars\r\n    {type: 1, scaleX: 11, scaleY: 11, offsetX: 2940, offsetY: 2045, octaves: 1, samples: 16, peaks: 1, brightness: -0.045, contrast: 1, isReversed: true},\r\n\r\n    // pseudo marble\r\n    {type: 2, scaleX: 74, scaleY: 74, offsetX: 4816, offsetY: 1304, octaves: 3, samples: 1, peaks: 2.78, brightness: 0, contrast: 0, isReversed: false},\r\n];\r\n\r\nfunction drawNoise (fxCanvas: TFxCanvas, settings: INoiseSettings): void {\r\n    fxCanvas.noise(\r\n        settings.seed  ? settings.seed : 0,\r\n        settings.type,\r\n        [settings.scaleX, settings.scaleY],\r\n        [fxCanvas.width / 2, fxCanvas.height / 2],\r\n        settings.octaves,\r\n        settings.samples,\r\n        settings.peaks,\r\n        settings.brightness,\r\n        settings.contrast,\r\n        settings.isReversed,\r\n        settings.colA,\r\n        settings.colB,\r\n        settings.channels ? settings.channels : 'rgb',\r\n    ).update();\r\n}\r\n\r\n\r\nexport const filterNoise = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return; // todo throw?\r\n        }\r\n        let texture;\r\n\r\n        const thumbImgArr = [];\r\n        const thumbSize = 32;\r\n        {\r\n            const canvas = BB.canvas(thumbSize, thumbSize);\r\n            const ctx = BB.ctx(canvas);\r\n            texture = fxCanvas.texture(canvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n            texture.destroy();\r\n\r\n            presetArr.forEach((preset, index) => {\r\n                const thumbImg = new Image();\r\n                const presetCopy = BB.copyObj(preset);\r\n                presetCopy.scaleX /= 10;\r\n                presetCopy.scaleY /= 10;\r\n                drawNoise(fxCanvas, presetCopy);\r\n                ctx.drawImage(fxCanvas, 0, 0);\r\n                thumbImg.src = canvas.toDataURL('image/png');\r\n                thumbImgArr.push(thumbImg);\r\n            });\r\n\r\n        }\r\n\r\n        let tempCanvas = BB.canvas(renderW, renderH);\r\n        texture = fxCanvas.texture(tempCanvas);\r\n        fxCanvas.draw(texture).update(); // update fxCanvas size\r\n        tempCanvas = null;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterNoiseInput> = {\r\n            element: div,\r\n        };\r\n\r\n        div.innerHTML = LANG('filter-noise-description') + '<br/><br/>';\r\n\r\n        const settingsObj: TFilterNoiseInput = {\r\n            seed: Math.random() * 300,\r\n            presetIndex: 0,\r\n            scale: 50,\r\n            opacity: 0.5,\r\n            isReversed: false,\r\n            channels: 'rgb',\r\n            mixModeStr: 'source-over' as GlobalCompositeOperation,\r\n            colA: {r: 0, g: 0, b: 0},\r\n            colB: {r: 255, g: 255, b: 255},\r\n        };\r\n\r\n\r\n        const presetOptions = new Options({\r\n            optionArr: thumbImgArr.map((img, index) => {\r\n                BB.css(img, {\r\n                    margin: '1px',\r\n                    borderRadius: '3px',\r\n                    transition: 'all 0.1s ease-in-out',\r\n                });\r\n                return {\r\n                    id: '' + index,\r\n                    label: img,\r\n                };\r\n            }),\r\n            initId: '0',\r\n            onChange: (id) => {\r\n                settingsObj.presetIndex = Number(id);\r\n                updatePreview();\r\n            },\r\n        });\r\n        presetOptions.getElement().style.marginBottom = '10px';\r\n        div.append(presetOptions.getElement());\r\n\r\n        const scaleSlider = new KlSlider({\r\n            label: LANG('filter-noise-scale'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1,\r\n            max: 1000,\r\n            value: settingsObj.scale,\r\n            eventResMs: eventResMs,\r\n            curve: BB.quadraticSplineInput(1, 1000, 0.1),\r\n            onChange: (value) => {\r\n                settingsObj.scale = value;\r\n                updatePreview();\r\n            },\r\n        });\r\n        scaleSlider.getElement().style.marginBottom = '10px';\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: settingsObj.opacity,\r\n            eventResMs: eventResMs,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n            onChange: (value) => {\r\n                settingsObj.opacity = value;\r\n                updatePreview();\r\n            },\r\n        });\r\n        opacitySlider.getElement().style.marginBottom = '10px';\r\n\r\n        const row1El = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        const row2El = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        const channelsOptions = new Options<TNoiseChannels>({\r\n            optionArr: [\r\n                {id: 'rgb', label: 'RGB'},\r\n                {id: 'alpha', label: LANG('filter-noise-alpha')},\r\n            ],\r\n            initId: 'rgb',\r\n            onChange: (id: TNoiseChannels) => {\r\n                settingsObj.channels = id;\r\n                if (id === 'rgb') {\r\n                    row2El.style.visibility = '';\r\n                } else {\r\n                    row2El.style.visibility = 'hidden';\r\n                }\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const reverseToggle = new Checkbox({\r\n            label: LANG('reverse'),\r\n            callback: (val) => {\r\n                settingsObj.isReversed = val;\r\n                updatePreview();\r\n            },\r\n            allowTab: true,\r\n        });\r\n\r\n        const blendSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                'source-over',\r\n                null,\r\n                'darken',\r\n                'multiply',\r\n                'color-burn',\r\n                null,\r\n                'lighten',\r\n                'screen',\r\n                'color-dodge',\r\n                null,\r\n                'overlay',\r\n                'soft-light',\r\n                'hard-light',\r\n                null,\r\n                'difference',\r\n                'exclusion',\r\n                null,\r\n                'hue',\r\n                'saturation',\r\n                'color',\r\n                'luminosity',\r\n            ].map((item: TMixMode) => {\r\n                return item ? [item, translateBlending(item)] : null;\r\n            }),\r\n            initValue: settingsObj.mixModeStr,\r\n            onChange: (val: GlobalCompositeOperation) => {\r\n                settingsObj.mixModeStr = val;\r\n                updatePreview();\r\n            },\r\n        });\r\n        blendSelect.getElement().title = LANG('layers-blending');\r\n\r\n        const colorWrapper = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        const colInputStyle = {\r\n            width: '34px',\r\n            height: '34px',\r\n            marginRight: '5px',\r\n        };\r\n        const colAInput = KL.input({\r\n            type: 'color',\r\n            init: '#' + ColorConverter.toHexString(settingsObj.colA),\r\n            callback: (val) => {\r\n                settingsObj.colA = ColorConverter.hexToRGB(val);\r\n                updatePreview();\r\n            },\r\n            css: colInputStyle,\r\n        });\r\n\r\n        const colBInput = KL.input({\r\n            type: 'color',\r\n            init: '#' + ColorConverter.toHexString(settingsObj.colB),\r\n            callback: (val) => {\r\n                settingsObj.colB = ColorConverter.hexToRGB(val);\r\n                updatePreview();\r\n            },\r\n            css: colInputStyle,\r\n        });\r\n\r\n        colorWrapper.append(\r\n            colAInput,\r\n            colBInput,\r\n        );\r\n\r\n\r\n        row1El.append(\r\n            channelsOptions.getElement(),\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            reverseToggle.getElement(),\r\n        );\r\n\r\n        row2El.append(\r\n            blendSelect.getElement(),\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorWrapper,\r\n        );\r\n\r\n        div.append(\r\n            scaleSlider.getElement(),\r\n            opacitySlider.getElement(),\r\n            row1El,\r\n            row2El,\r\n        );\r\n\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            }),\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n\r\n            ctx.globalAlpha = settingsObj.opacity;\r\n\r\n            const presetCopy = BB.copyObj(presetArr[settingsObj.presetIndex]);\r\n            presetCopy.seed = settingsObj.seed;\r\n            presetCopy.scaleX = presetCopy.scaleX  * settingsObj.scale / 50 * renderFactor;\r\n            presetCopy.scaleY = presetCopy.scaleY  * settingsObj.scale / 50 * renderFactor;\r\n            presetCopy.colA = settingsObj.colA;\r\n            presetCopy.colB = settingsObj.colB;\r\n            presetCopy.isReversed = settingsObj.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\r\n            presetCopy.channels  = settingsObj.channels;\r\n            drawNoise(fxCanvas, presetCopy);\r\n\r\n            if (settingsObj.channels === 'alpha') {\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n            } else {\r\n                ctx.globalCompositeOperation = settingsObj.mixModeStr;\r\n            }\r\n\r\n            ctx.drawImage(fxCanvas, 0, 0);\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            presetOptions.destroy();\r\n            scaleSlider.destroy();\r\n            opacitySlider.destroy();\r\n            reverseToggle.destroy();\r\n            channelsOptions.destroy();\r\n            texture.destroy();\r\n            blendSelect.destroy();\r\n            klCanvasPreview.destroy();\r\n        };\r\n        result.getInput = function (): TFilterNoiseInput {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterNoiseInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).update();\r\n        texture.destroy();\r\n\r\n        const input = params.input;\r\n\r\n        const presetCopy: INoiseSettings = BB.copyObj(presetArr[input.presetIndex]) as INoiseSettings;\r\n        presetCopy.seed = input.seed;\r\n        presetCopy.scaleX = presetCopy.scaleX  * input.scale / 50;\r\n        presetCopy.scaleY = presetCopy.scaleY  * input.scale / 50;\r\n        presetCopy.colA = input.colA;\r\n        presetCopy.colB = input.colB;\r\n        presetCopy.isReversed = input.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\r\n        presetCopy.channels  = input.channels;\r\n        drawNoise(fxCanvas, presetCopy);\r\n\r\n        context.save();\r\n        context.globalAlpha = input.opacity;\r\n        if (input.channels === 'alpha') {\r\n            context.globalCompositeOperation = 'destination-out';\r\n        } else {\r\n            context.globalCompositeOperation = input.mixModeStr;\r\n        }\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        context.restore();\r\n\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['canvas'],\r\n            action: 'replaceLayer',\r\n            params: [\r\n                klCanvas.getLayerIndex(context.canvas),\r\n                context.getImageData(0, 0, context.canvas.width, context.canvas.height),\r\n            ],\r\n        } as TKlCanvasHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {input} from '../ui/components/input';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {LANG} from '../../language/language';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {TwoTabs} from '../ui/components/two-tabs';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\n\r\nexport type TFilterPatternInput = {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n    blend?: number; // [0, 1] - 1 will blend linearly across whole length\r\n    offsetX: number;\r\n    offsetY: number;\r\n};\r\n\r\nexport type TFilterPatternHistoryEntry = TFilterHistoryEntry<\r\n    'pattern',\r\n    TFilterPatternInput>;\r\n\r\n/**\r\n * Draws pattern onto context. Pattern generated from context.\r\n * Can use blending for smoother transition. Will use area outside of bounds for blending.\r\n *\r\n * @param context\r\n * @param settings\r\n */\r\nfunction drawPattern (context: CanvasRenderingContext2D, settings: TFilterPatternInput): void {\r\n\r\n    // keep bounds in center via offset\r\n    // because blending done towards bottom right\r\n    const blendOffsetX = settings.blend ? Math.round(settings.blend * settings.width / 2) : 0;\r\n    const blendOffsetY = settings.blend ? Math.round(settings.blend * settings.height / 2) : 0;\r\n\r\n    const finalPatternCanvas = BB.canvas(settings.width, settings.height);\r\n\r\n    if (settings.blend) {\r\n        // construct pattern via linear blending\r\n\r\n        const blendCanvas = BB.canvas(settings.width * 2, settings.height * 2);\r\n        const blendCtx = BB.ctx(blendCanvas);\r\n        const colTransparent = '#0000';\r\n        const colOpaque = '#000';\r\n\r\n        // transfer source to blendCanvas\r\n        blendCtx.drawImage(\r\n            context.canvas,\r\n            -settings.x + blendOffsetX,\r\n            -settings.y + blendOffsetY,\r\n        );\r\n\r\n        // --- 1 cross-fade vertical ------------------------\r\n\r\n        // erase vertical gradient bottom half\r\n        blendCtx.save();\r\n        let blendGradient = blendCtx.createLinearGradient(0, settings.height, 0, settings.height * 2);\r\n        blendGradient.addColorStop(0, colOpaque);\r\n        blendGradient.addColorStop(settings.blend, colTransparent);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\r\n        blendCtx.restore();\r\n\r\n        // erase vertical gradient top half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(0, 0, 0, settings.height);\r\n        blendGradient.addColorStop(0, colTransparent);\r\n        blendGradient.addColorStop(settings.blend, colOpaque);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\r\n        blendCtx.restore();\r\n\r\n        // draw bottom half over top half\r\n        blendCtx.save();\r\n        // lighter needed for accurate cross-fade\r\n        blendCtx.globalCompositeOperation = 'lighter';\r\n        blendCtx.drawImage(blendCanvas, 0, -settings.height);\r\n        blendCtx.restore();\r\n\r\n\r\n\r\n        // --- 2 cross-fade horizontal ------------------------\r\n\r\n        // erase horizontal gradient right half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(settings.width, 0, settings.width * 2, 0);\r\n        blendGradient.addColorStop(0, colOpaque);\r\n        blendGradient.addColorStop(settings.blend, colTransparent);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\r\n        blendCtx.restore();\r\n\r\n        // erase horizontal gradient left half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(0, 0, settings.width, 0);\r\n        blendGradient.addColorStop(0, colTransparent);\r\n        blendGradient.addColorStop(settings.blend, colOpaque);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\r\n        blendCtx.restore();\r\n\r\n        // draw right half over left half\r\n        blendCtx.save();\r\n        // lighter needed for accurate cross-fade\r\n        blendCtx.globalCompositeOperation = 'lighter';\r\n        blendCtx.drawImage(blendCanvas, -settings.width, 0);\r\n        blendCtx.restore();\r\n\r\n        // transfer to pattern canvas\r\n        BB.ctx(finalPatternCanvas).drawImage(blendCanvas, 0, 0);\r\n\r\n    } else {\r\n        BB.ctx(finalPatternCanvas).drawImage(\r\n            context.canvas,\r\n            -settings.x,\r\n            -settings.y,\r\n        );\r\n    }\r\n\r\n    context.save();\r\n\r\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n    context.translate(settings.offsetX - blendOffsetX, settings.offsetY - blendOffsetY);\r\n    context.fillStyle = context.createPattern(finalPatternCanvas, 'repeat');\r\n    context.fillRect(-settings.offsetX + blendOffsetX, -settings.offsetY + blendOffsetY, context.canvas.width, context.canvas.height);\r\n\r\n    context.restore();\r\n}\r\n\r\n\r\nexport const filterPattern = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const maxSize = 1024;\r\n        const rootEl = BB.el({\r\n            content: LANG('filter-pattern-description') + '<br><br>',\r\n        });\r\n        const context = params.context;\r\n        const width = context.canvas.width;\r\n        const height = context.canvas.height;\r\n\r\n        let settings: TFilterPatternInput = {\r\n            x: 0,\r\n            y: 0,\r\n            width: width <= 250 ? Math.round(width / 4) : 200,\r\n            height: height <= 250 ? Math.round(height / 4) : 200,\r\n            blend: 0,\r\n            offsetX: 0,\r\n            offsetY: 0,\r\n        };\r\n        let lastDrawnSettings = null;\r\n\r\n        // determine bounds\r\n        const bounds = BB.canvasBounds(context);\r\n        // adjust settings according to bounds\r\n        if ( // use layer bounds if:\r\n            bounds &&\r\n            (bounds.width <= maxSize && bounds.height <= maxSize) && // don't exceed max size\r\n            (bounds.width < width * 0.75 || bounds.height < height * 0.75) // aren't too large (heuristic)\r\n        ) {\r\n            settings.x = bounds.x;\r\n            settings.y = bounds.y;\r\n            settings.width = bounds.width;\r\n            settings.height = bounds.height;\r\n        } else { // otherwise use default size in center\r\n            settings.x = Math.round(width / 2 - settings.width / 2);\r\n            settings.y = Math.round(height / 2 - settings.height / 2);\r\n        }\r\n\r\n        // ---- controls ----\r\n\r\n        const xInput = input({\r\n            init: settings.x,\r\n            type: 'number',\r\n            min: 0,\r\n            max: width,\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.x = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const yInput = input({\r\n            init: settings.y,\r\n            type: 'number',\r\n            min: 0,\r\n            max: height,\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.y = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const widthInput = input({\r\n            init: settings.width,\r\n            type: 'number',\r\n            min: 1,\r\n            max: Math.min(maxSize, width),\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.width = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const heightInput = input({\r\n            init: settings.height,\r\n            type: 'number',\r\n            min: 1,\r\n            max: Math.min(maxSize, height),\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.height = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const inputStyle = {\r\n            marginLeft: '5px',\r\n            flex: '1',\r\n        };\r\n        rootEl.append(\r\n            BB.el({\r\n               content: [\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           'X:',\r\n                           xInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           'Y:',\r\n                           yInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           LANG('width') + ':',\r\n                           widthInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           LANG('height') + ':',\r\n                           heightInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n               ],\r\n               css: {\r\n                   display: 'flex',\r\n                   marginLeft: '-5px',\r\n               },\r\n            }),\r\n        );\r\n\r\n\r\n        const blendSlider = new KlSlider({\r\n            label: LANG('brush-blending'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 0,\r\n            max: 1,\r\n            value: settings.blend,\r\n            eventResMs: eventResMs,\r\n            onChange: function (val) {\r\n                settings.blend = val;\r\n                updatePreview();\r\n            },\r\n            formatFunc: (val) => {\r\n                return BB.round(val, 2);\r\n            },\r\n            manualInputRoundDigits: 2,\r\n        });\r\n        BB.css(blendSlider.getElement(), {\r\n            margin: '10px 0',\r\n        });\r\n\r\n        rootEl.append(\r\n            blendSlider.getElement(),\r\n        );\r\n\r\n        // ---- preview tabs ----\r\n        let previewMode = 1; // 0 before, 1 after\r\n        const beforeAfterTabs = new TwoTabs({\r\n            left: LANG('compare-before'),\r\n            right: LANG('compare-after'),\r\n            init: previewMode,\r\n            onChange: (val) => {\r\n                previewMode = val;\r\n                overlayCanvas.style.display = val === 0 ? 'block' : 'none';\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        rootEl.append(beforeAfterTabs.getElement());\r\n\r\n        // ---- previews ----\r\n\r\n        const klCanvas = params.klCanvas;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                height: isSmall ? '260px' : '300px',\r\n                marginTop: '0',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const previewLayerArr = layers.map((item, i) => {\r\n            if (i === selectedLayerIndex) {\r\n                return previewLayer;\r\n            } else {\r\n                return {\r\n                    image: item.context.canvas,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                };\r\n            }\r\n        });\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const overlayCanvas = BB.canvas(w, h);\r\n        BB.css(overlayCanvas, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            mixBlendMode: 'difference',\r\n            imageRendering: 'pixelated',\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(\r\n            klCanvasPreview.getElement(),\r\n            overlayCanvas\r\n        );\r\n        previewWrapper.append(previewInnerWrapper);\r\n        rootEl.append(previewWrapper);\r\n\r\n\r\n        // ---- preview input processing ----\r\n        const inputs: {\r\n            start: IVector2D;\r\n            end: IVector2D;\r\n            oldSettings: TFilterPatternInput;\r\n            state: null | 'move' | 'select';\r\n        } = {\r\n            start: null,\r\n            end: null,\r\n            oldSettings: null,\r\n            state: null,\r\n        };\r\n\r\n        function syncInputs (): void {\r\n            xInput.value = '' + settings.x;\r\n            yInput.value = '' + settings.y;\r\n            widthInput.value = '' + settings.width;\r\n            heightInput.value = '' + settings.height;\r\n        }\r\n\r\n        const keyListener = new BB.KeyListener({\r\n        });\r\n\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        previewInnerWrapper.style.touchAction = 'none';\r\n        const pointerListener = new BB.PointerListener({\r\n            target: previewInnerWrapper,\r\n            onPointer: (event) => {\r\n                if (previewMode === 0) {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (!inputs.state) {\r\n                            inputs.oldSettings = BB.copyObj(settings);\r\n\r\n                            const x = event.relX / previewFactor;\r\n                            const y = event.relY / previewFactor;\r\n\r\n                            if (BB.isInsideRect(\r\n                                {x, y},\r\n                                {x: settings.x, y: settings.y, width: settings.width, height: settings.height},\r\n                            )) {\r\n                                inputs.state = 'move';\r\n                            } else {\r\n                                inputs.state = 'select';\r\n                            }\r\n                            inputs.start = {x, y};\r\n                        }\r\n                    } else if (event.type === 'pointermove') {\r\n\r\n                        const x = event.relX / previewFactor;\r\n                        const y = event.relY / previewFactor;\r\n\r\n                        if (inputs.state === 'select') {\r\n                            inputs.end = {x, y};\r\n\r\n                            const x1 = Math.max(0, Math.min(inputs.start.x, inputs.end.x));\r\n                            const y1 = Math.max(0, Math.min(inputs.start.y, inputs.end.y));\r\n                            const x2 = Math.min(width, Math.max(inputs.start.x, inputs.end.x));\r\n                            const y2 = Math.min(height, Math.max(inputs.start.y, inputs.end.y));\r\n\r\n                            settings.x = Math.floor(x1);\r\n                            settings.y = Math.floor(y1);\r\n                            settings.width = Math.min(maxSize, Math.ceil(x2 - settings.x));\r\n                            settings.height = Math.min(maxSize, Math.ceil(y2 - settings.y));\r\n\r\n                            if (keyListener.isPressed('shift')) {\r\n                                settings.width = Math.min(settings.width, settings.height);\r\n                                settings.height = Math.min(settings.width, settings.height);\r\n                            }\r\n\r\n                            if (settings.width === 0 || settings.height === 0) {\r\n                                settings = BB.copyObj(inputs.oldSettings);\r\n                            }\r\n\r\n                            syncInputs();\r\n                            updatePreview();\r\n                        } else if (inputs.state === 'move') {\r\n                            const dX = Math.round(x - inputs.start.x);\r\n                            const dY = Math.round(y - inputs.start.y);\r\n\r\n                            settings.x = BB.clamp(inputs.oldSettings.x + dX, 0, width - settings.width);\r\n                            settings.y = BB.clamp(inputs.oldSettings.y + dY, 0, height - settings.height);\r\n\r\n                            syncInputs();\r\n                            updatePreview();\r\n                        }\r\n                    } else if (event.type === 'pointerup') {\r\n                        if (inputs.state) {\r\n                            inputs.state = null;\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (!inputs.state) {\r\n                            inputs.state = 'move';\r\n                            inputs.oldSettings = BB.copyObj(settings);\r\n                            inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n                            inputs.end = null;\r\n                        }\r\n                    } else if (event.type === 'pointermove') {\r\n                        if (inputs.state) {\r\n                            inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n\r\n                            settings.offsetX = Math.round(inputs.end.x - inputs.start.x) + inputs.oldSettings.offsetX;\r\n                            settings.offsetY = Math.round(inputs.end.y - inputs.start.y) + inputs.oldSettings.offsetY;\r\n\r\n                            updatePreview();\r\n                        }\r\n                    } else if (event.type === 'pointerup') {\r\n                        if (inputs.state) {\r\n                            if (!inputs.end) {\r\n                                settings.offsetX = 0;\r\n                                settings.offsetY = 0;\r\n                                updatePreview();\r\n                            }\r\n                            inputs.state = null;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        // ---------- rendering ---------------------\r\n        const fullSizeCanvas = BB.canvas(width, height);\r\n        const fullSizeCtx = BB.ctx(fullSizeCanvas);\r\n\r\n        function sharpStrokeRect (\r\n            context: CanvasRenderingContext2D,\r\n            x: number,\r\n            y: number,\r\n            width: number,\r\n            height: number\r\n        ): void {\r\n            const drawX = Math.round(x + 0.5) - 0.5;\r\n            const drawY = Math.round(y + 0.5) - 0.5;\r\n            const drawWidth = Math.round(x + width - drawX);\r\n            const drawHeight = Math.round(y + height - drawY);\r\n            context.strokeRect(drawX, drawY, drawWidth, drawHeight);\r\n        }\r\n\r\n        function updatePreview (doForce?: boolean) {\r\n            if (!doForce && lastDrawnSettings && JSON.stringify(lastDrawnSettings) === JSON.stringify(settings)) {\r\n                return;\r\n            }\r\n\r\n            if (previewMode === 0) { // before\r\n                fullSizeCtx.clearRect(0, 0, width, height);\r\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\r\n\r\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\r\n                const previewCtx = BB.ctx(previewCanvas);\r\n                previewCtx.save();\r\n                previewCtx.clearRect(0, 0, renderW, renderH);\r\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\r\n                previewCtx.restore();\r\n\r\n                const pW = settings.width * previewFactor;\r\n                const pH = settings.height * previewFactor;\r\n\r\n                const overlayCtx = BB.ctx(overlayCanvas);\r\n                overlayCtx.save();\r\n                overlayCtx.clearRect(0, 0, w, h);\r\n                overlayCtx.strokeStyle = '#fff';\r\n                sharpStrokeRect(\r\n                    overlayCtx,\r\n                    settings.x * previewFactor,\r\n                    settings.y * previewFactor,\r\n                    pW,\r\n                    pH\r\n                );\r\n                if (settings.blend > 0.05) {\r\n                    overlayCtx.strokeStyle = '#f0f';\r\n                    sharpStrokeRect(\r\n                        overlayCtx,\r\n                        settings.x * previewFactor - pW / 2 * settings.blend,\r\n                        settings.y * previewFactor - pH / 2 * settings.blend,\r\n                        pW * (1 + settings.blend),\r\n                        pH * (1 + settings.blend),\r\n                    );\r\n                }\r\n                overlayCtx.restore();\r\n\r\n\r\n\r\n            } else { // after\r\n                fullSizeCtx.clearRect(0, 0, width, height);\r\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\r\n                drawPattern(fullSizeCtx, settings);\r\n\r\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\r\n                const previewCtx = BB.ctx(previewCanvas);\r\n                previewCtx.clearRect(0, 0, renderW, renderH);\r\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\r\n            }\r\n\r\n\r\n            klCanvasPreview.render();\r\n            lastDrawnSettings = BB.copyObj(settings);\r\n        }\r\n\r\n        updatePreview();\r\n\r\n\r\n        // ----- result -------------------\r\n        const result: IFilterGetDialogResult<TFilterPatternInput> = {\r\n            element: rootEl,\r\n            destroy: (): void => {\r\n                blendSlider.destroy();\r\n                keyListener.destroy();\r\n                pointerListener.destroy();\r\n                klCanvasPreview.destroy();\r\n            },\r\n            getInput: () => BB.copyObj(settings),\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterPatternInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const ctx = params.context;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        drawPattern(ctx, params.input);\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'pattern'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterPatternHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {LANG} from '../../language/language';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {Options} from '../ui/components/options';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\n\r\n// see fx-canvas distort\r\nexport type TFilterDistortInput = {\r\n    stepSize: number; // [0, inf]\r\n    distortType: 0 | 1 | 2;\r\n    scale: { x: number; y: number };\r\n    strength: { x: number; y: number };\r\n    phase: { x: number; y: number };\r\n};\r\n\r\nexport type TFilterDistortHistoryEntry = TFilterHistoryEntry<\r\n    'distort',\r\n    TFilterDistortInput>;\r\n\r\nexport const filterDistort = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const rootEl = BB.el({\r\n            content: LANG('filter-distort-description') + '<br><br>',\r\n        });\r\n        const context = params.context;\r\n\r\n        let isSynced = true;\r\n        const settings: TFilterDistortInput = {\r\n            distortType: 0,\r\n            scale: {x: 100, y: 100},\r\n            strength: {x: 20, y: 20},\r\n            phase: {x: 0, y: 0},\r\n            stepSize: 1,\r\n        };\r\n        // let lastDrawnSettings = null;\r\n\r\n        // ---- thumb -------\r\n        const thumbImgArr = [];\r\n        const thumbSize = 32;\r\n        {\r\n            const canvas = BB.canvas(thumbSize, thumbSize);\r\n            const ctx = BB.ctx(canvas);\r\n\r\n            ctx.beginPath();\r\n            ctx.arc(thumbSize / 2, thumbSize / 2, thumbSize / 2.5, 0, Math.PI * 2);\r\n            ctx.fill();\r\n\r\n            let gradient = ctx.createLinearGradient(0, 0, thumbSize, thumbSize);\r\n            gradient.addColorStop(0, '#00f');\r\n            gradient.addColorStop(0.5, '#f00');\r\n            gradient.addColorStop(1, '#fff');\r\n            ctx.fillStyle = gradient;\r\n            ctx.globalCompositeOperation = 'source-atop';\r\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\r\n\r\n            gradient = ctx.createLinearGradient(thumbSize, 0, 0, thumbSize);\r\n            gradient.addColorStop(0, '#000');\r\n            gradient.addColorStop(1, '#000');\r\n            ctx.fillStyle = gradient;\r\n            ctx.globalCompositeOperation = 'destination-atop';\r\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\r\n\r\n            const fxCanvas = getSharedFx();\r\n            const texture = fxCanvas.texture(canvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const scaleFactor = 20;\r\n\r\n            [0, 1, 2].forEach(item => {\r\n                const thumbImg = new Image();\r\n                const settingsCopy: TFilterDistortSettings = BB.copyObj(settings);\r\n                settingsCopy.distortType = item;\r\n                settingsCopy.scale.x /= scaleFactor;\r\n                settingsCopy.scale.y /= scaleFactor;\r\n                settingsCopy.strength.x /= scaleFactor;\r\n                settingsCopy.strength.y /= scaleFactor;\r\n                fxCanvas.draw(texture).multiplyAlpha().distort(settingsCopy).unmultiplyAlpha().update();\r\n                ctx.clearRect(0, 0, thumbSize, thumbSize);\r\n                ctx.drawImage(fxCanvas, 0, 0);\r\n                thumbImg.src = canvas.toDataURL('image/png');\r\n                thumbImgArr.push(thumbImg);\r\n            });\r\n\r\n            texture.destroy();\r\n        }\r\n\r\n\r\n        // ---- controls ----\r\n\r\n        const topRowEl = BB.el({\r\n            parent: rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n\r\n        const typeOptions = new Options({\r\n            optionArr: thumbImgArr.map((img, index) => {\r\n                BB.css(img, {\r\n                    margin: '1px',\r\n                    borderRadius: '3px',\r\n                    transition: 'all 0.1s ease-in-out',\r\n                });\r\n                return {\r\n                    id: '' + index,\r\n                    label: img,\r\n                };\r\n            }),\r\n            initId: '0',\r\n            onChange: (id) => {\r\n                settings.distortType = Number(id) as any;\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        function sync (from: 'x' | 'y') {\r\n            if (from === 'x') {\r\n                settings.scale.y = settings.scale.x;\r\n                settings.strength.y = settings.strength.x;\r\n                settings.phase.y = settings.phase.x;\r\n\r\n                sliderArr[3].setValue(settings.scale.y);\r\n                sliderArr[4].setValue(settings.strength.y);\r\n                sliderArr[5].setValue(settings.phase.y);\r\n            } else {\r\n                settings.scale.x = settings.scale.y;\r\n                settings.strength.x = settings.strength.y;\r\n                settings.phase.x = settings.phase.y;\r\n\r\n                sliderArr[0].setValue(settings.scale.x);\r\n                sliderArr[1].setValue(settings.strength.x);\r\n                sliderArr[2].setValue(settings.phase.x);\r\n            }\r\n            updatePreview();\r\n        }\r\n\r\n        const syncToggle = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-distort-sync-xy'),\r\n            callback: (val) => {\r\n                isSynced = val;\r\n                if (isSynced) {\r\n                    sync('x');\r\n                }\r\n            },\r\n        });\r\n\r\n        topRowEl.append(\r\n            typeOptions.getElement(),\r\n            BB.el({css: {flexGrow: '1'}}),\r\n            syncToggle.getElement(),\r\n        );\r\n\r\n        const xyRowEl = BB.el({\r\n            parent: rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n            },\r\n        });\r\n        const leftCol = BB.el({\r\n            parent: xyRowEl,\r\n            css: {\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n        const rightCol = BB.el({parent: xyRowEl});\r\n\r\n        const sliderWidth = isSmall ? 300 : 245;\r\n        const sliderArr: KlSlider[] = [];\r\n\r\n        ['x', 'y'].forEach((item, index) => {\r\n            const targetEl = index === 0 ? leftCol : rightCol;\r\n\r\n            const scaleSlider = new KlSlider({\r\n                label: LANG('filter-noise-scale') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 1,\r\n                max: 1000,\r\n                curve: 'quadratic',\r\n                value: settings.scale[item],\r\n                eventResMs: eventResMs,\r\n                onChange: (val) => {\r\n                    settings.scale[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item as any);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                },\r\n            });\r\n            scaleSlider.getElement().style.marginTop = '20px';\r\n            targetEl.append(scaleSlider.getElement());\r\n\r\n            const strengthSlider = new KlSlider({\r\n                label: LANG('filter-unsharp-mask-strength') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                curve: 'quadratic',\r\n                value: settings.strength[item],\r\n                eventResMs: eventResMs,\r\n                onChange: (val) => {\r\n                    settings.strength[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item as any);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                },\r\n            });\r\n            strengthSlider.getElement().style.marginTop = '10px';\r\n            targetEl.append(strengthSlider.getElement());\r\n\r\n            const phaseSlider = new KlSlider({\r\n                label: LANG('filter-distort-phase') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: settings.phase[item],\r\n                manualInputRoundDigits: 2,\r\n                eventResMs: eventResMs,\r\n                formatFunc: (val) => BB.round(val, 2),\r\n                onChange: (val) => {\r\n                    settings.phase[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item as any);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                },\r\n            });\r\n            phaseSlider.getElement().style.marginTop = '10px';\r\n            targetEl.append(phaseSlider.getElement());\r\n\r\n            sliderArr.push(scaleSlider);\r\n            sliderArr.push(strengthSlider);\r\n            sliderArr.push(phaseSlider);\r\n        });\r\n\r\n        const stepSlider = new KlSlider({\r\n            label: LANG('filter-distort-stepsize'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1,\r\n            max: 300,\r\n            curve: 'quadratic',\r\n            value: settings.stepSize,\r\n            eventResMs: eventResMs,\r\n            onChange: (val) => {\r\n                settings.stepSize = Math.round(val);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        stepSlider.getElement().style.marginTop = '20px';\r\n        rootEl.append(stepSlider.getElement());\r\n\r\n\r\n        // ---- preview ----\r\n\r\n        const klCanvas = params.klCanvas;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                height: isSmall ? '260px' : '300px',\r\n            },\r\n        });\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return; // todo throw?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: fxCanvas,\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const previewLayerArr = layers.map((item, i) => {\r\n            if (i === selectedLayerIndex) {\r\n                return previewLayer;\r\n            } else {\r\n                return {\r\n                    image: item.context.canvas,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                };\r\n            }\r\n        });\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n        rootEl.append(previewWrapper);\r\n\r\n        // ---------- rendering ---------------------\r\n\r\n        function updatePreview (): void {\r\n            fxCanvas.draw(texture).multiplyAlpha().distort(settings).unmultiplyAlpha().update();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n\r\n        // ----- result -------------------\r\n        const result: IFilterGetDialogResult<TFilterDistortInput> = {\r\n            element: rootEl,\r\n            destroy: () => {\r\n                typeOptions.destroy();\r\n                sliderArr.forEach(item => item.destroy());\r\n                stepSlider.destroy();\r\n                syncToggle.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            },\r\n            getInput: () => BB.copyObj(settings),\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterDistortInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).multiplyAlpha().distort(params.input).unmultiplyAlpha().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'distort'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterDistortHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, IRGB} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {input} from '../ui/components/input';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {drawVanishPoint} from '../image-operations/draw-vanish-point';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterVanishPointInput = {\r\n    x: number;\r\n    y: number;\r\n    lines: number;\r\n    thickness: number;\r\n    color: IRGB;\r\n    opacity: number;\r\n};\r\n\r\nexport type TFilterVanishPointHistoryEntry = TFilterHistoryEntry<\r\n    'vanishPoint',\r\n    TFilterVanishPointInput>;\r\n\r\nexport const filterVanishPoint = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterVanishPointInput> = {\r\n            element: div,\r\n        };\r\n        div.innerHTML = LANG('filter-vanish-point-description') + '<br/><br/>';\r\n\r\n        const settingsObj: TFilterVanishPointInput = {\r\n            x: context.canvas.width / 2,\r\n            y: context.canvas.height / 2,\r\n            lines: 8,\r\n            thickness: 2,\r\n            color: {r: 0, g: 0, b: 0},\r\n            opacity: 1,\r\n        };\r\n\r\n        const linesSlider = new KlSlider({\r\n            label: LANG('filter-vanish-point-lines'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 2,\r\n            max: 20,\r\n            value: settingsObj.lines,\r\n            curve: 'quadratic',\r\n            eventResMs: eventResMs,\r\n            onChange: function (val) {\r\n                settingsObj.lines = Math.round(val);\r\n                updatePreview();\r\n            },\r\n        });\r\n        linesSlider.getElement().style.marginBottom = '10px';\r\n        div.append(linesSlider.getElement());\r\n\r\n        const line1 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        const line2 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n        const xInput = input({\r\n            init: settingsObj.x,\r\n            type: 'number',\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.x = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const yInput = input({\r\n            init: settingsObj.y,\r\n            type: 'number',\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.y = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const thicknessInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.thickness = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n        settingsObj.color = BB.copyObj(selectedRgbaObj);\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('shape-stroke'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function (rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                settingsObj.color = BB.copyObj(selectedRgbaObj);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            marginRight: '5px',\r\n        };\r\n        line1.append(\r\n            BB.el({content: 'X:', css: labelStyle}),\r\n            xInput,\r\n            BB.el({content: 'Y:', css: labelStyle}),\r\n            yInput,\r\n        );\r\n        line2.append(\r\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\r\n            thicknessInput,\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorOptions.getElement(),\r\n        );\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            }),\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n                cursor: 'move',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n\r\n        // ---- preview input processing ----\r\n        const inputs: {\r\n            start: IVector2D;\r\n            end: IVector2D;\r\n            state: null | 'move';\r\n            oldSettings: any;\r\n        } = {\r\n            start: null,\r\n            end: null,\r\n            state: null,\r\n            oldSettings: null,\r\n        };\r\n        function syncInputs (): void {\r\n            xInput.value = '' + settingsObj.x;\r\n            yInput.value = '' + settingsObj.y;\r\n        }\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        previewInnerWrapper.style.touchAction = 'none';\r\n        const pointerListener = new BB.PointerListener({\r\n            target: previewInnerWrapper,\r\n            onPointer: (event) => {\r\n                if (event.type === 'pointerdown') {\r\n                    if (!inputs.state) {\r\n                        inputs.state = 'move';\r\n                        inputs.oldSettings = BB.copyObj(settingsObj);\r\n                        inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n                        inputs.end = null;\r\n                    }\r\n                } else if (event.type === 'pointermove') {\r\n                    if (inputs.state) {\r\n                        inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n\r\n                        settingsObj.x = Math.round(inputs.end.x - inputs.start.x + inputs.oldSettings.x);\r\n                        settingsObj.y = Math.round(inputs.end.y - inputs.start.y + inputs.oldSettings.y);\r\n\r\n                        syncInputs();\r\n                        updatePreview();\r\n                    }\r\n                } else if (event.type === 'pointerup') {\r\n                    if (inputs.state) {\r\n                        inputs.state = null;\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n            drawVanishPoint(\r\n                ctx,\r\n                settingsObj.x * renderFactor,\r\n                settingsObj.y * renderFactor,\r\n                settingsObj.lines,\r\n                Math.max(settingsObj.thickness * renderFactor, 1),\r\n                settingsObj.color,\r\n                settingsObj.opacity,\r\n            );\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = () => {\r\n            linesSlider.destroy();\r\n            pointerListener.destroy();\r\n            klCanvasPreview.destroy();\r\n            colorOptions.destroy();\r\n        };\r\n        result.getInput = function (): TFilterVanishPointInput {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterVanishPointInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        drawVanishPoint(\r\n            context,\r\n            params.input.x,\r\n            params.input.y,\r\n            params.input.lines,\r\n            params.input.thickness,\r\n            params.input.color,\r\n            params.input.opacity,\r\n        );\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['filter', 'vanishPoint'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterVanishPointHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {drawShape} from './shape-tool';\r\nimport {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl-types';\r\n\r\nexport function drawVanishPoint (\r\n    ctx: CanvasRenderingContext2D,\r\n    x: number,\r\n    y: number,\r\n    lines: number, // int, [2, inf]\r\n    thickness: number, // px\r\n    color: IRGB,\r\n    opacity: number, // 0 - 1\r\n): void {\r\n    ctx.save();\r\n\r\n    const degIncrement = 180 / lines;\r\n    for (let deg = 0; deg < 180; deg += degIncrement) {\r\n        const p2 = BB.rotateAround({x, y}, {x: x + 9999, y}, deg);\r\n        drawShape(\r\n            ctx,\r\n            {\r\n                type: 'line',\r\n                x1: x,\r\n                y1: y,\r\n                x2: p2.x,\r\n                y2: p2.y,\r\n                //angleRad: 0,\r\n                isOutwards: true,\r\n                opacity,\r\n                //isEraser: false,\r\n                strokeRgb: color,\r\n                lineWidth: thickness,\r\n                //doLockAlpha: false,\r\n            }\r\n        );\r\n    }\r\n\r\n    ctx.restore();\r\n}","import {KL} from '../kl';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {Psd} from 'ag-psd/dist/psd';\r\nimport {loadAgPsd} from './load-ag-psd';\r\n\r\nexport async function klCanvasToPsdBlob (klCanvas: KlCanvas): Promise<Blob> {\r\n    const layerArr = klCanvas.getLayersFast();\r\n\r\n    const psdConfig: Psd = {\r\n        width: klCanvas.getWidth(),\r\n        height: klCanvas.getHeight(),\r\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\r\n        children: layerArr.map(item => {\r\n            // todo - can be optimized if layer mostly empty\r\n            return {\r\n                name: item.name,\r\n                opacity: item.opacity,\r\n                canvas: item.canvas,\r\n                blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n                left: 0,\r\n                top: 0,\r\n            };\r\n        }),\r\n    };\r\n\r\n    const agPsd = await loadAgPsd();\r\n    const buffer = agPsd.writePsdBuffer(psdConfig);\r\n    return new Blob([buffer], { type: 'application/octet-stream' });\r\n}","import {BB} from '../../bb/bb';\r\nimport {IDrawMoveEvent, TDrawEvent} from '../kl-types';\r\n\r\n/**\r\n * Line smoothing. EventChain element. Smoothing via blending new position with old position.\r\n * for onDraw events from KlCanvasWorkspace.\r\n *\r\n * in some draw event\r\n * out some draw event\r\n *\r\n * type: 'line' Events are just passed through.\r\n */\r\nexport class LineSmoothing {\r\n\r\n    private chainOut: ((drawEvent: TDrawEvent) => void) | undefined;\r\n    private smoothing: number;\r\n    private lastMixedInput: {\r\n        x: number;\r\n        y: number;\r\n        pressure: number;\r\n    } | undefined;\r\n    private interval: ReturnType<typeof setInterval> | undefined;\r\n    private timeout: ReturnType<typeof setTimeout> | undefined;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            smoothing: number; // 0-1, 0: no smoothing, 1: 100% smoothing -> would never catch up\r\n        }\r\n    ) {\r\n        this.smoothing = BB.clamp(p.smoothing, 0, 1);\r\n    }\r\n\r\n    chainIn (event: TDrawEvent): TDrawEvent | null {\r\n        event = BB.copyObj(event);\r\n        this.timeout && clearTimeout(this.timeout);\r\n        this.interval && clearInterval(this.interval);\r\n\r\n        if (event.type === 'down') {\r\n            this.lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure,\r\n            };\r\n        }\r\n\r\n        if (event.type === 'move') {\r\n\r\n            const inputX = event.x;\r\n            const inputY = event.y;\r\n            const inputPressure = event.pressure;\r\n\r\n            event.x = BB.mix(event.x, this.lastMixedInput!.x, this.smoothing);\r\n            event.y = BB.mix(event.y, this.lastMixedInput!.y, this.smoothing);\r\n            event.pressure = BB.mix(event.pressure, this.lastMixedInput!.pressure, this.smoothing);\r\n            this.lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure,\r\n            };\r\n\r\n            if (this.smoothing > 0) {\r\n                this.timeout = setTimeout(() => {\r\n                    this.interval = setInterval(() => {\r\n                        event = JSON.parse(JSON.stringify(event)) as IDrawMoveEvent;\r\n\r\n                        event.x = BB.mix(inputX, this.lastMixedInput!.x, this.smoothing);\r\n                        event.y = BB.mix(inputY, this.lastMixedInput!.y, this.smoothing);\r\n                        event.pressure = BB.mix(inputPressure, this.lastMixedInput!.pressure, this.smoothing);\r\n                        this.lastMixedInput = {\r\n                            x: event.x,\r\n                            y: event.y,\r\n                            pressure: event.pressure,\r\n                        };\r\n\r\n                        this.chainOut && this.chainOut(event);\r\n                    }, 35);\r\n                }, 80);\r\n            }\r\n\r\n        }\r\n\r\n        return event;\r\n    }\r\n\r\n    setChainOut (func: (drawEvent: TDrawEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    setSmoothing (s: number): void {\r\n        this.smoothing = BB.clamp(s, 0, 1);\r\n    }\r\n}\r\n","import {TDrawEvent} from '../kl-types';\r\n\r\n/**\r\n * cleans up DrawEvents. More trustworthy events. EventChain element\r\n *\r\n * in some draw event?\r\n * out some draw event?\r\n *\r\n * that events can only go line this: down -> n x move -> up\r\n * so, sanitizes this: down, down, down. becomes only one down. the other downs are ignored/swallowed\r\n */\r\nexport class LineSanitizer {\r\n\r\n    private chainOut: ((drawEvent: TDrawEvent) => void) | undefined;\r\n    private isDrawing: boolean = false;\r\n\r\n    // --- public ---\r\n\r\n    chainIn (event: TDrawEvent): TDrawEvent | null {\r\n\r\n        if (event.type === 'down') {\r\n            if (this.isDrawing) {\r\n                //console.log('line sanitizer - down, but already drawing');\r\n                this.chainOut && this.chainOut({\r\n                    type: 'up',\r\n                    scale: event.scale,\r\n                    shiftIsPressed: event.shiftIsPressed,\r\n                    isCoalesced: false,\r\n                });\r\n            } else {\r\n                this.isDrawing = true;\r\n            }\r\n        }\r\n        if (!this.isDrawing && (event.type === 'move' || event.type === 'up')) {\r\n            //console.log('line sanitizer - ' + event.type + ' but not drawing');\r\n            return null;\r\n        }\r\n\r\n        if (event.type === 'up' && this.isDrawing) {\r\n            this.isDrawing = false;\r\n        }\r\n\r\n        return event;\r\n    }\r\n\r\n    setChainOut (func: (drawEvent: TDrawEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n}\r\n","/**\r\n * from stabilizer dropdown value to linesmoothing value\r\n * @param s\r\n */\r\nexport function translateSmoothing (s: number): number {\r\n    if (s == 1) {\r\n        return 1 - 0.5;\r\n    }\r\n    if (s == 2) {\r\n        return 1 - 0.16;\r\n    }\r\n    if (s == 3) {\r\n        return 1 - 0.035;\r\n    }\r\n    if (s == 4) {\r\n        return 1 - 0.0175;\r\n    }\r\n    if (s == 5) {\r\n        return 1 - 0.00875;\r\n    }\r\n    return s;\r\n}","import {IKlPsd, IRGB, TDropOption, TKlCanvasLayer} from '../klecks/kl-types';\r\nimport {KL} from '../klecks/kl';\r\nimport {LANG} from '../language/language';\r\nimport {BB} from '../bb/bb';\r\nimport {klHistory, TMiscImportImageHistoryEntry} from '../klecks/history/kl-history';\r\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\r\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\r\nimport {HandUi} from '../klecks/ui/tool-tabs/hand-ui';\r\nimport {LayerManager} from '../klecks/ui/tool-tabs/layer-manager/layer-manager';\r\nimport {IRect, ISize2D} from '../bb/bb-types';\r\n\r\n// todo later:\r\n// onImage: (project: IKlProject) => void\r\n// onLayer: (index: number, canvas: HMTLCanvasElement,layerName: string) => void\r\n\r\nexport class ImportHandler {\r\n\r\n    private readonly klRootEl: HTMLElement;\r\n    private readonly klMaxCanvasSize: number;\r\n    private readonly layerManager: LayerManager;\r\n    private readonly setCurrentLayer: (layer: TKlCanvasLayer) => void;\r\n    private readonly klCanvas: KlCanvas;\r\n    private readonly klCanvasWorkspace: KlCanvasWorkspace;\r\n    private readonly handUi: HandUi;\r\n\r\n    private readonly onColor: (rgb: IRGB) => void;\r\n\r\n\r\n    /**\r\n     *\r\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\r\n     * @param filename - string e.g. 'drawing.psd'\r\n     * @param optionStr? - 'default' | 'layer' | 'image'\r\n     */\r\n    private importFinishedLoading (\r\n        importedImage: IKlPsd | {\r\n            type: 'image';\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLCanvasElement | HTMLImageElement;\r\n        },\r\n        filename: string | undefined,\r\n        optionStr: 'default' | 'layer' | 'image',\r\n    ): void {\r\n        if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: LANG('import-broken-file'),\r\n                buttons: ['Ok'],\r\n            });\r\n            return;\r\n        }\r\n\r\n        const getResizedDimensions = (width: number, height: number): ISize2D => {\r\n            let w = parseInt('' + width);\r\n            let h = parseInt('' + height);\r\n            if (w > this.klMaxCanvasSize) {\r\n                h = this.klMaxCanvasSize / w * h;\r\n                w = this.klMaxCanvasSize;\r\n            }\r\n            if (h > this.klMaxCanvasSize) {\r\n                w = this.klMaxCanvasSize / h * w;\r\n                h = this.klMaxCanvasSize;\r\n            }\r\n            w = parseInt('' + w);\r\n            h = parseInt('' + h);\r\n            return {\r\n                width: w,\r\n                height: h,\r\n            };\r\n        };\r\n\r\n        const importAsImage = (canvas: HTMLCanvasElement | HTMLImageElement) => {\r\n            const resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\r\n\r\n            //resize first\r\n            const tempCanvas = BB.canvas(canvas.width, canvas.height);\r\n            const tempCanvasCtx = BB.ctx(tempCanvas);\r\n            tempCanvasCtx.drawImage(canvas, 0, 0);\r\n\r\n            BB.resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\r\n\r\n            this.klCanvas.reset({\r\n                width: resizedDimensions.width,\r\n                height: resizedDimensions.height,\r\n                image: tempCanvas,\r\n                layerName: filename,\r\n            });\r\n\r\n            this.layerManager.update(0);\r\n            this.setCurrentLayer(this.klCanvas.getLayer(0));\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        };\r\n\r\n        /**\r\n         *\r\n         * @param convertedPsdObj - if flattened then without layers\r\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\r\n         */\r\n        const importAsImagePsd = (convertedPsdObj: IKlPsd, cropObj?: IRect) => {\r\n\r\n            // crop\r\n            const crop = (\r\n                targetCanvas: HTMLCanvasElement,\r\n                cropCanvas: HTMLCanvasElement,\r\n                cropObj: IRect,\r\n            ): void => {\r\n                cropCanvas.width = cropCanvas.width;\r\n                BB.ctx(cropCanvas).drawImage(targetCanvas, -cropObj.x, -cropObj.y);\r\n                targetCanvas.width = cropObj.width;\r\n                targetCanvas.height = cropObj.height;\r\n                BB.ctx(targetCanvas).drawImage(cropCanvas, 0, 0);\r\n            };\r\n            if (cropObj && (cropObj.width !== convertedPsdObj.width ||cropObj.height !== convertedPsdObj.height)) {\r\n                const cropCanvas = BB.canvas(cropObj.width, cropObj.height);\r\n                convertedPsdObj.width = cropObj.width;\r\n                convertedPsdObj.height = cropObj.height;\r\n\r\n                if (!convertedPsdObj.layers) {\r\n                    crop(convertedPsdObj.canvas, cropCanvas, cropObj);\r\n                }\r\n                if (convertedPsdObj.layers) {\r\n                    for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                        const item = convertedPsdObj.layers[i];\r\n                        crop(item.image, cropCanvas, cropObj);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // resize\r\n            const resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\r\n            convertedPsdObj.width = resizedDimensions.width;\r\n            convertedPsdObj.height = resizedDimensions.height;\r\n            if (!convertedPsdObj.layers) {\r\n                BB.resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\r\n            }\r\n            if (convertedPsdObj.layers) {\r\n                for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                    const item = convertedPsdObj.layers[i];\r\n                    BB.resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\r\n                }\r\n            }\r\n\r\n            let layerIndex;\r\n            if (convertedPsdObj.layers) {\r\n                layerIndex = this.klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    layers: convertedPsdObj.layers,\r\n                });\r\n            } else {\r\n                layerIndex = this.klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    image: convertedPsdObj.canvas,\r\n                });\r\n            }\r\n            this.layerManager.update(layerIndex);\r\n            this.setCurrentLayer(this.klCanvas.getLayer(layerIndex));\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        };\r\n\r\n        const importAsLayer = (canvas: HTMLCanvasElement | HTMLImageElement) => {\r\n            KL.showImportAsLayerDialog({\r\n                target: this.klRootEl,\r\n                klCanvas: this.klCanvas,\r\n                importImage: canvas,\r\n                callback: (transformObj, isPixelated: boolean) => {\r\n                    if (!transformObj) {\r\n                        return;\r\n                    }\r\n\r\n                    klHistory.pause(true);\r\n                    this.klCanvas.addLayer();\r\n                    const layers = this.klCanvas.getLayers();\r\n                    const activeLayerIndex = layers.length - 1;\r\n                    if (filename) {\r\n                        this.klCanvas.renameLayer(activeLayerIndex, filename);\r\n                    }\r\n                    const activeLayerContext = this.klCanvas.getLayerContext(activeLayerIndex);\r\n                    BB.drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, null, isPixelated);\r\n                    this.setCurrentLayer(this.klCanvas.getLayer(activeLayerIndex));\r\n                    this.layerManager.update(activeLayerIndex);\r\n\r\n                    klHistory.pause(false);\r\n\r\n                    klHistory.push({\r\n                        tool: ['misc'],\r\n                        action: 'importImage',\r\n                        params: [BB.copyCanvas(activeLayerContext.canvas), filename],\r\n                    } as TMiscImportImageHistoryEntry);\r\n                },\r\n            });\r\n        };\r\n\r\n\r\n        if (optionStr === 'default' || !optionStr) {\r\n            KL.showImportImageDialog({\r\n                image: importedImage,\r\n                target: this.klRootEl,\r\n                maxSize: this.klMaxCanvasSize,\r\n                callback: (res) => {\r\n                    if (res.type === 'as-image') {\r\n                        importAsImage(res.image);\r\n                    } else if (res.type === 'as-image-psd') {\r\n                        importAsImagePsd(res.image, res.cropObj);\r\n                    } else if (res.type === 'as-layer') {\r\n                        importAsLayer(res.image);\r\n                    } else if (res.type === 'cancel') {\r\n                        // nothing to do\r\n                    }\r\n                },\r\n            });\r\n        }\r\n\r\n        if (optionStr === 'layer') {\r\n            importAsLayer(importedImage.canvas);\r\n        }\r\n        if (optionStr === 'image') {\r\n            if (importedImage.type === 'psd') {\r\n                importAsImagePsd(importedImage);\r\n            } else {\r\n                importAsImage(importedImage.canvas);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        input: {\r\n            klRootEl: HTMLElement;\r\n            klMaxCanvasSize: number;\r\n            layerManager: LayerManager;\r\n            setCurrentLayer: (layer: TKlCanvasLayer) => void;\r\n            klCanvas: KlCanvas;\r\n            klCanvasWorkspace: KlCanvasWorkspace;\r\n            handUi: HandUi;\r\n        },\r\n        callback: {\r\n            onColor: (rgb: IRGB) => void;\r\n        }\r\n    ) {\r\n        this.klRootEl = input.klRootEl;\r\n        this.klMaxCanvasSize = input.klMaxCanvasSize;\r\n        this.layerManager = input.layerManager;\r\n        this.setCurrentLayer = input.setCurrentLayer;\r\n        this.klCanvas = input.klCanvas;\r\n        this.klCanvasWorkspace = input.klCanvasWorkspace;\r\n        this.handUi = input.handUi;\r\n\r\n        this.onColor = callback.onColor;\r\n    }\r\n\r\n\r\n\r\n    // ---- interface ----\r\n\r\n    onPaste (e: ClipboardEvent): void{\r\n        if (KL.dialogCounter.get() > 0) {\r\n            return;\r\n        }\r\n\r\n        const retrieveImageFromClipboardAsBlob = (\r\n            items: DataTransferItemList,\r\n            callback: (file: File) => void,\r\n        ) => {\r\n            if (!items) {\r\n                return;\r\n            }\r\n            for (let i = 0; i < items.length; i++) {\r\n                if (items[i].type.indexOf('image') == -1) {\r\n                    continue;\r\n                }\r\n                const file = items[i].getAsFile();\r\n                file && callback(file);\r\n            }\r\n        };\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (!e.clipboardData) {\r\n            return;\r\n        }\r\n\r\n        if (e.clipboardData.files[0]) {\r\n            retrieveImageFromClipboardAsBlob(e.clipboardData.items, (imageBlob) => {\r\n                // If there's an image, display it in the canvas\r\n                const img = new Image();\r\n                img.onload = () => {\r\n                    URL.revokeObjectURL(img.src);\r\n                    this.importFinishedLoading({\r\n                        type: 'image',\r\n                        width: img.width,\r\n                        height: img.height,\r\n                        canvas: img,\r\n                    }, undefined, 'default');\r\n                };\r\n                const URLObj = window.URL || window.webkitURL;\r\n                img.src = URLObj.createObjectURL(imageBlob);\r\n            });\r\n        } else if (e.clipboardData.items[0]) {\r\n            e.clipboardData.items[0].getAsString((pasteStr) => {\r\n                pasteStr = pasteStr.trim();\r\n                if (pasteStr.match(/^https?/)) {\r\n                    // url\r\n                    const img = new Image();\r\n                    img.onload = () => {\r\n                        this.importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img,\r\n                        }, undefined, 'default');\r\n                    };\r\n                    img.onerror = (e) => {\r\n                        console.log('error loading', e);\r\n                    };\r\n                    img.crossOrigin = 'Anonymous';\r\n                    img.src = pasteStr;\r\n\r\n                } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\r\n                    // url\r\n                    const rgbObj = BB.ColorConverter.hexToRGB(pasteStr.replace('#', ''));\r\n                    rgbObj && this.onColor(rgbObj);\r\n                }\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    handleFileSelect (files: FileList, optionStr: TDropOption): void {\r\n\r\n        const showWarningPsdFlattened = () => {\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'warning',\r\n                message: LANG('import-psd-unsupported') + '<br /><br />',\r\n                buttons: ['Ok'],\r\n            });\r\n        };\r\n\r\n        let hasUnsupportedFile = false;\r\n        for (let i = 0, file; file = files[i]; i++) {\r\n            const nameSplit = file.name.split('.');\r\n            const extension = nameSplit[nameSplit.length - 1].toLowerCase();\r\n            if (extension === 'psd') {\r\n\r\n                ((f) => {\r\n                    const loaderSizeBytes = 1024 * 1024 * 25; // 25mb\r\n                    const maxSizeBytes = 1024 * 1024 * 1024; // 1gb\r\n                    const maxResolution = 4096;\r\n\r\n                    if (f.size >= maxSizeBytes) { // pretty likely to break stuff\r\n                        KL.popup({\r\n                            target: this.klRootEl,\r\n                            type: 'error',\r\n                            message: 'File too big. Unable to import.<br /><br />',\r\n                            buttons: ['Ok'],\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    const doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\r\n                    let loaderIsOpen = true;\r\n                    let closeLoader: (() => void) | null;\r\n\r\n                    if (doShowLoader) {\r\n                        KL.popup({\r\n                            target: this.klRootEl,\r\n                            message: LANG('import-opening'),\r\n                            callback: (result) => {\r\n                                loaderIsOpen = false;\r\n                                closeLoader = null;\r\n                            },\r\n                            closeFunc: (f) => {\r\n                                closeLoader = f;\r\n                            },\r\n                        });\r\n                    }\r\n\r\n\r\n                    const reader = new FileReader();\r\n                    reader.onload = (readerResult) => {\r\n\r\n                        KL.loadAgPsd().then((agPsdLazy) => {\r\n\r\n                            if (doShowLoader && !loaderIsOpen) {\r\n                                return;\r\n                            }\r\n\r\n                            try {\r\n                                let psd;\r\n\r\n                                // first pass, only read metadata\r\n                                psd = agPsdLazy.readPsd(\r\n                                    (readerResult.target.result as any),\r\n                                    {\r\n                                        skipLayerImageData: true,\r\n                                        skipThumbnail: true,\r\n                                        skipCompositeImageData: true,\r\n                                    });\r\n                                if (psd.width > maxResolution || psd.height > maxResolution) {\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    KL.popup({\r\n                                        target: this.klRootEl,\r\n                                        type: 'error',\r\n                                        message: LANG('import-psd-too-large').replace(/{x}/g, '' + maxResolution)\r\n                                            + '<br /><br />'\r\n                                            + LANG('import-psd-size') + ': ' + psd.width + ' x ' + psd.height + ' pixels'\r\n                                            + '<br /><br />'\r\n                                        ,\r\n                                        buttons: ['Ok'],\r\n                                    });\r\n                                    return;\r\n                                }\r\n\r\n\r\n                                // second pass, now load actual data.\r\n                                psd = null;\r\n\r\n                                try {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any));\r\n                                } catch (e) {\r\n                                    //console.log('failed regular psd import', e);\r\n                                }\r\n                                if (psd) {\r\n                                    //console.log('psd', psd);\r\n                                    const convertedPsd = KL.PSD.readPsd(psd);\r\n                                    //console.log('converted', convertedPsd);\r\n                                    if (optionStr === 'image' && convertedPsd.error) {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    this.importFinishedLoading(convertedPsd, f.name, optionStr);\r\n                                } else {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any), { skipLayerImageData: true, skipThumbnail: true });\r\n                                    if (optionStr === 'image') {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    this.importFinishedLoading({\r\n                                        type: 'psd',\r\n                                        width: psd.width,\r\n                                        height: psd.height,\r\n                                        canvas: psd.canvas,\r\n                                        error: true,\r\n                                    }, f.name, optionStr);\r\n                                }\r\n\r\n                            } catch (e) {\r\n                                closeLoader && closeLoader();\r\n                                KL.popup({\r\n                                    target: this.klRootEl,\r\n                                    type: 'error',\r\n                                    message: 'Failed to load PSD.<br /><br />',\r\n                                    buttons: ['Ok'],\r\n                                });\r\n                                console.log(e);\r\n                                setTimeout(() => {\r\n                                    throw new Error('psd load error');\r\n                                });\r\n                            }\r\n                        }).catch((e) => {\r\n                            closeLoader && closeLoader();\r\n                            alert('Error: failed to load PSD library');\r\n                        });\r\n\r\n                    };\r\n                    reader.readAsArrayBuffer(f);\r\n                })(file);\r\n\r\n            } else if (file.type.match('image.*')) {\r\n                ((f) => {\r\n                    window.URL = window.URL || window.webkitURL;\r\n                    const url = window.URL.createObjectURL(f);\r\n                    const im = new Image();\r\n                    im.src = url;\r\n                    BB.loadImage(im, () => {\r\n                        this.importFinishedLoading({\r\n                            type: 'image',\r\n                            width: im.width,\r\n                            height: im.height,\r\n                            canvas: im,\r\n                        }, f.name, optionStr);\r\n                    });\r\n                })(file);\r\n            } else {\r\n                hasUnsupportedFile = true;\r\n            }\r\n        }\r\n        if (hasUnsupportedFile) {\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                message: LANG('import-unsupported-file'),\r\n                type: 'error',\r\n                buttons: ['OK'],\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\n\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kycpJ\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"TzbtI\");","import {IVector2D} from '../bb/bb-types';\r\n\r\n\r\n\r\nexport type TConsoleApi = {\r\n    readonly draw: (path: IVector2D[]) => void;\r\n    readonly help: () => void;\r\n};\r\n\r\nexport function createConsoleApi (\r\n    p: {\r\n        onDraw: (path: IVector2D[]) => void;\r\n    }\r\n): TConsoleApi {\r\n\r\n    const output = ['Draw via the console! Learn more: %cKL.help()', 'background: #000; color: #0f0;'];\r\n    'info' in console ? console.info(...output) : console.log(...output);\r\n\r\n    return Object.freeze({\r\n        draw: (path: IVector2D[]): void => {\r\n            p.onDraw(path);\r\n        },\r\n        help: (): void => {\r\n            console.log(`KL.draw({x: number; y: number}[]) // draw a line\r\nKL.help() // print help\r\n`);\r\n        },\r\n    });\r\n}"],"names":["$3kC7t","parcelRequire","$d2fa9a947070c225$export$a84540bc8b694b2d","p","klApp","agPsd","onProjectReady","project","isInitialized","Error","saveReminder","$5ngYX","SaveReminder","$gWfkn","klHistory","isDrawing","$3C7jC","KlApp","bottomBar","aboutEl","embed","url","embedUrl","onSubmit","init","loadingScreenEl","parentNode","removeChild","loadingScreenTextEl","document","body","append","getEl","e","textContent","className","console","error","psdQueue","getElementById","$1mH1z","LANG","this","openProject","initError","getPNG","getPSD","default","_state","sent","readPSDs","psds","length","readItem","item","psd","readPsd","blob","$941rU","klPsdToKlProject","callback","forEach","$iVf04","loadAgPsd","shift","push","Element","prototype","Object","defineProperty","value","x","y","scrollLeft","scrollTop","Array","flat","configurable","depth","isNaN","arguments","Number","reduce","call","acc","cur","isArray","apply","slice","writable","window","getItem","setItem","removeItem","t","n","createDocumentFragment","Node","appendChild","createTextNode","String","Document","DocumentFragment","hasOwnProperty","enumerable","insertBefore","firstChild","padStart","repeat","findIndex","r","TypeError","o","i","$iUR3L","importFilters","$cf5d938ee512ebca$export$96f6458b62e4c2c","pProject","pOptions","_pOptions_app","$7U0Ew","$3WOmu","klCanvasToPsdBlob","_this1","klCanvas","klMaxCanvasSize","Math","min","max","screen","width","height","uiState","$6l0gQ","LocalStorage","filenameBase","app","projectStore","klRootEl","$eWjiX","BB","el","css","position","left","top","right","bottom","uiWidth","innerWidth","uiHeight","innerHeight","exportType","$hrnUX","KL","KlCanvas","projectObj","collapseThreshold","toolWidth","setHistory","mainTabRow","initState","reset","layers","layer","image","pause","addLayer","layerFill","$fohxs","ERASE_COLOR","g","b","canvas","copy","focus","getLayerCount","brushes","message","destroy","entries","param","_param","Brush","setContext","getLayerContext","currentBrushUi","currentBrushId","lastNonEraserBrushId","currentColor","RGB","currentLayerCtx","sizeWatcher","val","brushSettingService","emitSize","_this","klCanvasWorkspace","setCursorSize","BrushSettingService","color","klColorSlider","setColor","copyObj","size","setSize","opacity","setOpacity","getColor","brushUiMap","getSize","getOpacity","sizeSlider","brushesUI","opacitySlider","lineSmoothing","$iuTWx","LineSmoothing","smoothing","$aId1u","translateSmoothing","lineSanitizer","$57YJz","LineSanitizer","drawEventChain","EventChain","chainArr","setChainOut","event","type","toolspace","style","pointerEvents","startLine","pressure","requestFrame","goLine","isCoalesced","setLastDrawEvent","endLine","getBrush","drawLineSegment","x0","y0","x1","y1","textToolSettings","align","isBold","isItalic","font","KlCanvasWorkspace","onDraw","chainIn","onPick","rgbObj","isDragDone","pickingDone","setMode","toolspaceToolRow","getActive","onFill","canvasX","canvasY","layerIndex","getLayerIndex","floodFill","fillUi","getIsEraser","getTolerance","getSample","getGrow","getContiguous","onGradient","typeStr","angleRad","gradientTool","onDown","onMove","onUp","onText","dialogCounter","get","textToolDialog","secondaryColor","getSecondaryRGB","onConfirm","colorRGBA","a","text","textStr","ColorConverter","toRgbaStr","onShape","shapeTool","onViewChange","viewChangeObj","changed","includes","statusOverlay","out","scale","angleDeg","angle","PI","setEnableZoomIn","getMaxScale","setEnableZoomOut","getMinScale","handUi","update","onUndo","canUndo","undoRedoCatchup","undo","onRedo","canRedo","redo","overlayToolspace","toolspaceTopRow","updateMainTabVisibility","activeStr","oldTabId","getOpenedTabId","keysArr","keys","draw","hand","fill","gradient","shape","setIsVisible","open","keyListener","KeyListener","keyStr","comboStr","isInputFocused","getIsDrawing","zoomByStep","isPressed","fitView","resetView","preventDefault","sameKeys","saveToComputer","save","success","_$e","store","getProject","setTimeout","copyToClipboard","comboOnlyContains","translateView","setAngle","getScale","getAngleDeg","decreaseSize","increaseSize","eraserBrush","getIsTransparentBg","clearLayer","setActive","brushTabRow","prevMode","getMode","keyArr","filter","getNextBrushId","newMode","swapColors","ui","Ui","onSizeChange","onOpacityChange","emitOpacity","onConfigChange","emitSliderConfig","getElement","padding","StatusOverlay","overflow","userSelect","touchAction","toolspaceInner","parent","oncontextmenu","onclick","handleClick","toolspaceCollapser","ToolspaceCollapser","onChange","updateCollapse","OverlayToolspace","enabledTest","$jmL5A","EmbedToolspaceTopRow","onHelp","$h62LS","showIframeModal","popup","target","buttons","result","overlay","content","onLeftRight","updateUi","ToolspaceTopRow","logoImg","onLogo","onNew","showNewImageDialog","onImport","fileTab","triggerImport","onSave","onShare","shareImage","marginBottom","ToolspaceToolRow","onActivate","onZoomIn","onZoomOut","setIsSmall","addListener","setEnableUndo","setEnableRedo","KlColorSlider","svHeight","startValue","p_color","emitColor","setHeight","setPickCallback","doPick","setCurrentLayer","context","layerPreview","setLayer","brushDiv","colorDiv","margin","display","flexWrap","justifyContent","alignItems","toolspaceStabilizerRow","ToolspaceStabilizerRow","onSelect","v","setSmoothing","getOutputElement","TabRow","initialId","useAccent","tabArr","createTab","id","title","tooltip","onOpen","brushId","enable","onClose","concat","$4Ea8f","map","HandUi","onReset","onFit","onAngleChange","isRelative","FillUi","colorSlider","gradientUi","GradientUi","textUi","TextUi","shapeUi","ShapeUi","GradientTool","isDone","x2","y2","settings","getSettings","gradientObj","color1","isReversed","doLockAlpha","isEraser","doSnap","setComposite","drawGradient","ctx","ShapeTool","shapeObj","getShape","isOutwards","getIsOutwards","getDoLockAlpha","strokeRgb","lineWidth","getLineWidth","isAngleSnap","getIsSnap","isFixedRatio","getIsFixed","fillRgb","drawShape","layerManager","LayerManager","getLayer","tool","action","params","LayerPreview","onClick","filterTab","FilterTab","UndoRedoCatchup","catchup","newImageDialog","maxCanvasSize","canvasWidth","getWidth","canvasHeight","getHeight","workspaceWidth","workspaceHeight","onCancel","shareCanvas","getCompleteCanvas","fileName","getDate","SaveToComputer","showCrop","clipboardDialog","inputObj","filterLib","cropExtend","input","history","FileTab","files","optionsStr","importHandler","handleFileSelect","imgurUpload","imgurKey","settingsTab","SettingsTab","$parcel$interopDefault","$8dsYZ","minWidth","$4sBxW","isVisible","$6iPxE","$fZtJh","$eOZOu","$haxur","$i7SrA","label","show","hide","$fX22P","bottomBarWrapper","MutationObserver","updateBottomBar","observe","attributes","childList","subtree","undefined","toolspaceScroller","ToolspaceScroller","$qur3y","createConsoleApi","path","index","resize","$iG6pP","ImportHandler","onColor","rgb","KlImageDropper","onDrop","optionStr","addEventListener","onPaste","windowResizeWatcher","zIndex","ResizeObserver","prevent","key","setDirection","isOpen","setWide","scrollHeight","classList","toggle","setUiState","updateUiState","w","h","scrollY","scrollTo","msg","$2wCWz","base64ToBlob","toDataURL","$3wEFn","$1ac26b9c3b886816$export$2e2bcd8739ae039","arr","$8XIsj","$jBmMa","$hhqk6","$apgdg","$46241077d0115b39$export$2e2bcd8739ae039","$4deb7017c774789d$export$2e2bcd8739ae039","$9cbe98d1fb398012$export$6e4a713ddcda1e5e","$dAXbp","$3P46L","$7pyBK","$705qg","drawProject","$aSJRf","WorkspaceSvgOverlay","$7bo3M","$lV6Vy","KlCanvasPreview","$i5nyl","filterLibStatus","$kyVjY","$6rdi0","renderText","$h20yl","floodFillBits","$30Cml","$3ujzu","$7EG77","PSD","setDbName","$9BlwZ","indexedDb","ProjectStore","$6mTnI","$eyygR","calcSliderFalloffFactor","$11glk","Checkbox","$7bWhB","$dJPtW","Select","$eEL9N","ImageToggle","$1kyaA","ImageRadioList","$4nUqS","RadioList","$fRGIf","createPenPressureToggle","$lCF5N","KlSlider","$aP0jf","HexColorDialog","$lfHl9","$fg9Sv","KlColorSliderSmall","$gmji4","PointSlider","$j5jvd","ColorOptions","$43qNf","Options","$iFIyy","BoxToggle","$cmnov","$bmB93","CropCopy","$hRdOL","FreeTransform","$cNhNm","FreeTransformCanvas","$kEeSq","Cropper","$32CBv","$kqmpc","$13r5y","$9p4Zp","$8jqzp","ToolDropdown","$84zxV","$9Kxky","$1Ax5m","$e4sAN","$1uc3b","BrowserStorageUi","$9pcu9","$iVHpg","$i8UFO","$2MaaK","showModal","Popup","$dLlkc","DynamicModal","$isYih","showImportAsLayerDialog","$8ebuX","$76Qvv","$keKW3","showImportImageDialog","$kDGzx","showIframePopup","$5ENro","$khi8I","$dJXmR","$5Gc7M","$iS9xS","$9J17G","$eK8ID","$2umOB","$bIgqE","$jMW1P","DecoyKlHistory","$gFgFC","$b60fce38973759d6$var$historyInstance","$b60fce38973759d6$export$2a772a91f059c0f9","$b60fce38973759d6$export$28b6f4d98dde9845","KlHistory","state","listeners","pauseStack","maxState","actionNumber","l","newEntry","pop","lastEntry","maxBefore","broadcast","bufferUpdate","$7jh4K","throwIfNull","$c902829f68f42bce$export$d7e8d4d4450c819c","close","isClosed","clearSelection","unfocusAnyInput","rootRootEl","decrease","destroyEl","xButton","bgEl","rootEl","removeEventListener","wheelPrevent","btnElArr","splice","increase","scrollContent","minHeight","flexDirection","ignoreBackground","tagName","$6ToP3","titleHeight","lineHeight","background","boxShadow","boxClasses","boxEl","div","marginRight","join","flex","add","autoFocus","clickOnEnterBtn","stopPropagation","click","buttonRowEl","marginTop","marginLeft","buttonName","iconUrl","btnClasses","primaries","$d2FVM","iconImg","custom","src","btn","clickOnEnter","closeFunc","$dd0d395ff14a3e11$export$17eb8275e0c4cab8","DialogCounter","count","emit","listener","$05ec456c8871d48f$export$921068d8846a1559","eventUsesHighResTimeStamp","$6J2My","hasPointerEvents","hasWebGl","isCssMinMaxSupported","canShareFiles","insertAfter","loadImage","setAttributes","fitInto","centerWithin","gcd","decToFraction","imageBlobToUrl","dateDayDifference","createSvg","BbLog","$i0uIf","isDark","mix","$eg83P","dist","distSquared","lenSquared","pointsToAngleRad","pointsToAngleDeg","isInsideRect","clamp","rotate","rotateAround","Matrix","$kVHNC","Vec2","$4toIY","intDxy","roundEven","roundUneven","round","updateBounds","boundsInArea","projectPointOnLine","$af1iA","PointLine","BezierLine","SplineInterpolator","quadraticSplineInput","$eelgW","createCanvas","$eIcQa","copyCanvas","testShouldPixelate","drawTransformedImageWithBounds","drawTransformedImageOnCanvas","createCheckerCanvas","createCheckerDataUrl","resizeCanvas","convertToAlphaChannelCanvas","freeCanvas","canvasBounds","HSV","$dJ1E2","CMYK","testIsWhiteBestContrast","appendTextDiv","$72Jv0","makeUnfocusable","$idV3L","PointerListener","$04lDo","$gCzYB","DoubleTapper","$c1lmK","NFingerTapper","$2pgVs","PinchZoomer","$joplQ","CoalescedExploder","$jjWRi","OnePointerLimiter","$635F6","hasWebgl","test","$878b1f179a521546$export$b7d78993b74f766d","navigator","userAgent","toLowerCase","indexOf","$878b1f179a521546$export$4ec3bfbae69fbb50","Event","timeStamp","$878b1f179a521546$export$b7b64c480b083ae0","PointerEvent","$878b1f179a521546$export$9cbe517943afd6db","getContext","premultipliedAlpha","$878b1f179a521546$export$fe0a7220ab4eecad","createElement","offsetLeft","$878b1f179a521546$export$558f5e20caee48c2","$44dda2e48e48a872$export$cd3d1f114b139967","keyDown","keyUp","blur","keyStrToKeyObj","keyStrArr","isDownObj","keyToKeyStrObj","comboArr","codeIsDownObj","listenerArr","emitDown","emitUp","emitBlur","$74d1f29ad2137b2c$var$globalKey","code","oldComboStr","eventArr","space","alt","ctrl","cmd","enter","esc","backspace","delete","sqbr_open","sqbr_close","c","f","s","u","z","plus","minus","up","down","home","end","d","keyListenerRef","first","remove","last","getIsDown","getCombo","$74d1f29ad2137b2c$export$f17908c5de22d32e","onBlur","ref","$74d1f29ad2137b2c$export$e9f65b0175de4c03","comboAStr","comboBStr","split","sort","$893e90c2dcf687ac$var$pointerArr","$893e90c2dcf687ac$var$getButtonStr","$893e90c2dcf687ac$var$pressureNormalizer","$eIAon","PressureNormalizer","$893e90c2dcf687ac$var$timeStampOffset","performance","timing","navigationStart","$893e90c2dcf687ac$var$pointerDownEvt","$893e90c2dcf687ac$var$pointerMoveEvt","$893e90c2dcf687ac$var$pointerUpEvt","$893e90c2dcf687ac$var$pointerCancelEvt","$893e90c2dcf687ac$var$pointerLeaveEvt","$893e90c2dcf687ac$var$pointerEnterEvt","$893e90c2dcf687ac$var$correctPointerEvent","corrected","correctedObj","pointerId","pointerType","pageX","pageY","clientX","clientY","movementX","movementY","normalize","button","coalescedArr","eventPreventDefault","eventStopPropagation","customPressure","isFirefox","coalescedEventArr","getCoalescedEvents","pointerObj","$893e90c2dcf687ac$var$getPointer","lastPageX","lastPageY","$893e90c2dcf687ac$var$addPointer","totalLastX","totalLastY","eventItem","$893e90c2dcf687ac$export$9371bd96776f4e82","targetElement","onPointerCallback","onPointer","onWheelCallback","onWheel","onEnterLeaveCallback","onEnterLeave","maxPointers","wheelCleaner","$93oLo","WheelCleaner","cleanerEvent","isDestroyed","bounds","getBoundingClientRect","whlEvent","$a7ch7","$3Rl3W","relX","relY","onPointerMove","correctedEvent","tempLastPointerType","lastPointerType","dragPointerIdArr","didSkip","outEvent","createPointerOutEvent","onPointerDown","onSkipGlobal","dragObjArr","setupDocumentListeners","dragObj","downPageX","downPageY","lastTimeStamp","windowOnPointerMove","getDragObj","outEvent1","destroyDocumentListeners","removeDragObj","windowOnPointerUp","windowOnPointerLeave","touchToFakePointer","touch","touchEvent","isDown","identifier","handleTouch","changedTouches","fakePointer","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel","process","onPointerEnter","isOverCounter","onPointerLeave","fixScribble","onTouchMoveScribbleFix","removedDragObj","dX","dY","time","coalescedItem","$42238a223231ec71$export$c734b8535f2f8e38","knownUnitArr","sequenceLength","sequenceUnit","toEmitDelta","delta","deltaY","endSequenceTimeout","clearTimeout","endSequence","deltaMode","absDelta","abs","$e14d50e39929aa54$export$61f95f4b79132931","avgPressure","normalizeIsComplete","normalizeFactor","pow","$9a5bdb07e7a7c42f$export$2c9e8a9632a706b2","$9a5bdb07e7a7c42f$export$6c4a311cc157c764","ax","ay","bx","by","sqrt","$9a5bdb07e7a7c42f$export$499eb56409f6cbc2","$9a5bdb07e7a7c42f$export$a4f99f99d3e99cfa","$9a5bdb07e7a7c42f$export$627023b405ba5028","p1","p2","atan2","$9a5bdb07e7a7c42f$export$c03a8450eabc2532","$9a5bdb07e7a7c42f$export$151bd845d70e2099","rect","$9a5bdb07e7a7c42f$export$7d15b64cf5a3a4c4","num","$9a5bdb07e7a7c42f$export$bb628a54ab399bc9","deg","theta","cs","cos","sn","sin","$9a5bdb07e7a7c42f$export$95ec0760d3d00713","center","point","rot","$9a5bdb07e7a7c42f$export$bbf9af158036c5e9","remainder","fDx","fDy","$9a5bdb07e7a7c42f$export$94cce7adf2ec2d08","above","ceil","below","floor","$9a5bdb07e7a7c42f$export$f373b6a7b0c159a","$9a5bdb07e7a7c42f$export$2077e0241d6afd3c","digits","digitMult","$9a5bdb07e7a7c42f$export$f4467a4f41373bc7","$9a5bdb07e7a7c42f$export$bbb91bbc54e7d9ac","$3f0e2f35371c9852$export$dd0873c0fb3ccff6","resultCanvas","drawImage","$3f0e2f35371c9852$export$39f92e86d1722f3a","$3f0e2f35371c9852$export$1555f643cc9a976","transform","scaleX","scaleY","whSwapped","$3f0e2f35371c9852$export$ded2b43392504635","destCtx","transformImage","pixelated","imageSmoothingEnabled","imageSmoothingQuality","translate","restore","$3f0e2f35371c9852$export$425a419ef9fc761f","baseCanvas","transformObj","angleDegree","cache","$3f0e2f35371c9852$export$754559b36e94ea2f","fillStyle","fillRect","$3f0e2f35371c9852$export$42af33c76b681867","create","parseInt","modeStr","$3f0e2f35371c9852$export$59b33278b5b2fc8a","tmp1","tmp2","oldW","oldH","newW","newH","ew","eh","base2","oldWidthEx","log2","oldHeightEx","newWidthEx","newHeightEx","buffer1","buffer2","bufferCtx","globalCompositeOperation","currentWidth","currentHeight","newWidth","newHeight","tmp","canvasCtx","tmp1Ctx","$3f0e2f35371c9852$export$5a7576952c826b4f","imdat","getImageData","data","putImageData","$3f0e2f35371c9852$export$2384aff49c9b73c2","clearRect","$3f0e2f35371c9852$export$3db033c6ee0b8700","boundsObj","tempBounds","$e4df33b4b16105d5$var$multiplyMatrixAndPoint","matrix","$e4df33b4b16105d5$export$5b12bf1653c0dd85","freeze","getIdentity","multiplyMatrixAndPoint","multiplyMatrices","matrixA","matrixB","row0","row1","row2","row3","result0","result1","result2","result3","createTranslationMatrix","createRotationMatrix","createScaleMatrix","$531c9f41f98b7ec0$export$ac4bca90992eed1","sub","nor","len","mul","dot","aArr","bArr","m","$77ae015f37ebe4f1$export$b4c5b177db876445","lineStart","lineEnd","$77ae015f37ebe4f1$export$8b36a4a83269a640","segmentArr","points","getLength","fac","$77ae015f37ebe4f1$export$5379d955c16d4d43","pointArr","p3","p4","resolution","curvePoints","spacing","controlsCallback","lastPoint","dir","lastDot","lastSpacing","pointM1","pointM2","pointM3","pointLine","getBezierPoints","tempSpacing","getAtDist","lastCallbackPoint","dAngle","lastAngle","newP","$77ae015f37ebe4f1$export$80967b1eb9fd6eb4","xa","ya","wx","sig","ddydx","klo","khi","k","tempX","tempY","interpolate","tempDist","$77ae015f37ebe4f1$export$4551d4af86c1eb08","startVal","endVal","stepSize","dec","resultArr","$5e7aac2fa49b6b1f$export$d2edaecd208aed43","$5e7aac2fa49b6b1f$export$8f9ece5a47764b93","$5e7aac2fa49b6b1f$export$89d3f85304bf0767","$5e7aac2fa49b6b1f$export$fb7efcd2e153af6e","_RGBtoHSV","minVal","maxVal","del_R","del_G","del_B","_HSVtoRGB","var_h","var_i","var_1","var_2","var_3","var_r","var_g","var_b","_CMYKtoRGB","_RGBtoCMYK","toRGB","toHSV","toCMYK","toHexString","ha","toString","hb","hc","toRgbStr","rgbaObj","hexToRGB","hexStr","trim","replace","exec","$5e7aac2fa49b6b1f$export$5cf396345d1238ae","$cfe3aa45a75894cc$export$7868464f598ba79d","innerHTML","$cfe3aa45a75894cc$export$906dfdb7df31ccfc","_document_activeElement","getAll","activeElement","getAttribute","$cfe3aa45a75894cc$export$e05240ca9e0b8bd9","focusEl","select","$cfe3aa45a75894cc$export$a3d02541b0ebf605","getSelection","sel","empty","removeAllRanges","selection","preventFocus","$cfe3aa45a75894cc$export$6bd63bfceaafae0c","didFocusRelated","relatedTarget","currentTarget","setAttribute","$cfe3aa45a75894cc$var$els","$cfe3aa45a75894cc$export$c3da0dad1b44eea9","customKeyArr","$cfe3aa45a75894cc$export$b1da1db524e22115","$0d0e99c175410ac4$export$9860cd9e09e6f8ba","$9e5fd8359d8b22f2$export$19fffca37ef3e106","localStorage","$d2c9f6aa6c7498f1$export$fe11e0afe623a677","func","chainOut","eventCopy","$cc27951506e6ad28$export$510622b8aed00381","now","firstLastDownTimeout","tapTimeout","fingers","onTap","eventQueueArr","timeoutObj","fingerArr","timeoutStr","timeMS","diff","nowTime","failGesture","tempLastEventTime","lastEventTime","pointersDownIdArr","maxFirstLastFingerDownMs","downTimeMs","minSilenceBeforeDurationMs","firstDownTime","setupTimeout","maxTapMs","fingerObj","i1","maxPressedDistancePx","fingerObj1","i2","isUp","allAreUp","i3","processEvent","$670d2777518c365a$export$d62358ac2d82abb3","secondFingerTimeout","onPinch","gestureObj","doSwallow","fail","touchPointerArr","isInProgress","continuePinch","beginPinch","otherPointerIdArr","downRelX","downRelY","setupFailTimeout","untilSecondFingerDurationMs","endPinch","touchPointerObj","firstFingerMaxDistancePx","pincherArr","actionObj","startDist","distance","startAngle","$f607ef98ce9eccdc$export$db3963a21c01d803","maxUntilSecondDown","onDoubleTap","gestureFailed","sequenceArr","lastSequenceItem","targetFunc","allowedPointerTypeArr","lastUpTime","allowedButtonArr","maxInbetweenDistancePx","maxUntilSecondDownDurationMs","maxPressedDurationMs","maxUpToUpDurationMs","minSilenceAfterMs","$956c5ff01a38849f$export$71ff2f51bf1f4062","ignorePointerIdArr","downPointerId","$4fb7927cde0b2f75$export$649a211db9812745","continueChain","onscroll","module","exports","getBundleURL","resolve","$e59fbd08bcc1a36b$export$185108a9b725b68","animationName","animationDuration","animationTimingFunction","popupEl","borderRadius","updatePos","elW","offsetWidth","elH","offsetHeight","titleEl","paddingLeft","tabindex","contentEl","$365a915dfb503274$export$48513f6b9f8ce62d","doHighlight","element","innerEl","check","checked","allowTab","tabIndex","allowClick","onchange","$f18fe37a308c53fd$export$b7e3ae3d7c15e42e","$7a3263857aacf58f$export$ef9b1a59e592288f","selectEl","cursor","fontSize","isFocusable","optionArr","changeListener","getValue","initValue","option","option1","$8fa94d142febb502$export$b6d053cded550773","isActive","darkInvert","backgroundImage","isRadio","$8cb981a3c9e5b15b$export$7cc1012a658e6ad8","initialIndex","createOption","initId","radioEl","activeIndex","setValue","$a49c90053f8766a2$export$9da2e8821e6cbb57","isChecked","changeCallback","$8IsQq","backgroundSize","backgroundRepeat","$afe02cc26c765c2c$export$2358c75ad3c15b2d","$5c0625e6104e2c75$export$a1855b925e534de7","isEnabled","manualInputRoundDigits","useSpline","curve","elementWidth","elementHeight","toValue","toDisplayValue","displayValueToValue","displayValue","valueToDisplayValue","isChangeOnFinal","formatFunc","eventResMs","curveArr","splineInterpolator","sliderWrapperEl","labelFontSize","textEl","control","valueToSliderValue","controlInner","updateEnable","doubleTapper","showManualInput","setAllowedButtonArr","virtualVal","eventChain","pointerListenerTimeout","pointerListener","sliderValue","sliderValueToValue","updateLabel","deltaX","sliderValue1","findX","toLocaleString","languageStrings","getCode","isFinal","emitInterval","clearInterval","emitValue","setInterval","manualInput","setIsEnabled","$869o9","KlSliderManualInput","config","isDisabled","$16ee6d1163eaf409$export$f8e41e222e32615d","isRightButton","$068903cd1342554f$export$db3d4fde05db9a5e","roundDigits","currentValue","onblur","privateOnClose","scrollBefore","scrollX","lastValue","$dada52d673c8c4ac$export$cc42e119007cb939","createRgbInputRow","labelStr","attributeStr","rowEl","labelEl","inputEl","lastValidRgb","parseFloat","previewEl","hexInput","hexRowEl","hexLabel","rgbArr","copyButton","$bJupx","execCommand","resultStr","$0ebf4eb3a9343b24$export$4e5102252876c5d7","outputDiv","primaryColorRGB","primaryColorHSV","secondaryColorRGB","secondaryColorHSV","svWrapper","svSvg","DOMParser","parseFromString","documentElement","hueStop","querySelector","divH","divPreview","controlH","updateSVCanvas","SVContainer","pointerSV","updateSVPointer","borderLeft","virtualHSV","pickerButton","$6fV2b","backgroundPosition","isPicking","pickCallback","isOver","hexButton","setColPreview","targetEl","im","Image","cv","gradH","createLinearGradient","col","addColorStop","createHueBg","factor","secondaryColorBtn","updateSecondaryColor","hsv","backgroundColor","updatePrimaryHSV","$00f785a5ea9e210d$export$e4203cb02d5e5b28","theme","$3ce0af1e789f1ab4$export$66306bf21a9ff39e","heightSV","canvasSV","updateSV","canvasH","heightH","cssFloat","pointerH","borderRight","updateHPointer","svPointerId","svPointerListener","hPointerId","hPointerListener","clear","gradient1","colleft","colright","$5e81242a941997c7$export$ac00cea56cec3037","sliderPos","pointSize","sliderPoint","isFirst","imaginaryPos","redrawPoint","$4db8cbbb01889095$export$24ba9b81662d4366","selectedIndex","colorArr","buttonArr","checkerUrl","$1C8RU","found","sItem","colorButton","buttonSize","setIsSelected","updateCheckerboard","addIsDarkListener","removeIsDarkListener","$7960d0c50ff12b0d$export$c019608e5b5bb4cb","wrapperEl","selectedId","classArr","isSmall","optionObj","changeOnInit","getIndex","$c1a93a3cd82636c9$export$5ee0af1d5c87e856","removeProperty","isWide","angleIm","$gGQwz","verticalAlign","innerInnerEl","doPulse","animation","timeout3","timeout","timeout2","$01fcd0ed15aa4018$export$40175a5948a88a57","resetCrop","croppedCanvas","eventTarget","isNotCopy","croppedImage","updateCroppedCanvas","previewWrapper","thumbSize","thumbCanvas","imageRendering","scaleW","scaleH","thumbCtx","thumbX","thumbY","selectionRect","updateSelectionRect","startP","updateCropTimeout","toOriginalSpace","genCrop","topLeftP","bottomRightP","origTopLeftP","origBottomRightP","startCrop","isDragging","didMove","isReset","crop","doUpdate","shiftIsPressed","$ffd40240385bb9f9$export$32b89bc9bb92706a","fullCanvas","cropCallback","output","toClipboard","imgURL","cropCopy","getCroppedImage","err","fetch","clipboard","write","ClipboardItem","name","clipboardItemIsSupported","topWrapper","textAlign","KeyEvent","rectObj","getRect","$82406ffdc1235dbb$export$eff87c52915dd7fe","parentEl","layerElArr","layerHeight","layerSpacing","largeThumbDiv","border","transition","largeThumbCanvas","largeThumbInDocument","klCanvasLayerArr","getLayers","selectedSpotIndex","listDiv","layerListEl","addBtn","duplicateBtn","mergeBtn","removeBtn","modeWrapper","renameBtn","paddingRight","$hWVsV","$5Ycub","$jKBKm","$auzYC","$1Qqvs","MAX_LAYERS","disabled","createLayerList","duplicateLayer","removeLayer","$6NMo1","mergeLayerDialog","topCanvas","bottomCanvas","topOpacity","mixModeStr","mode","mergeLayers","renameLayer","modeSelect","$bBcC4","translateBlending","setMixMode","historyState","getState","oldHistoryState","spot","thumb","oldSpotIndex","newSpotIndex","posy","posY","moveLayer","newspot","lastpos","layerSpot","$jneUH","renameLayerDialog","newName","createLayerEntry","layerName","layercanvas","innerLayer","container1","container2","oldOpacity","thumbDimensions","thc","whiteSpace","ondblclick","opacityLabel","isLast","layerOpacity","onpointerover","largeThumbInTimeout","largeThumbTimeout","onpointerout","dragstart","freshSelection","isSelected","activateLayer","updateLayersVerticalPosition","posToSpot","newSpot","oldSpot","move","child","updateHeight","activeLayerSpotIndex","spotIndex","stateStr","$0621fc8724f6bfac$var$allowedMixModes","$0621fc8724f6bfac$export$9f4f73b1bd7c2f26","$0621fc8724f6bfac$export$4a819bde91671014","layerNrOffset","layerCanvasArr","pickCanvas","changeListenerArr","origLayers","updateIndices","toCopyCanvas","algorithm","layerCanvas","offX","offY","ctemp","layerCtx","fillColor","selected","isLayerLimitReached","doReturnNull","emitChange","temp","targetIndex","layerBottomIndex","layerTopIndex","globalAlpha","isHorizontal","isVertical","tempCtx","colorObj","compositeOperation","tolerance","sampleStr","grow","isContiguous","srcCtx","srcImageData","srcData","targetCtx","targetImageData","targetData","srcCanvas","srcIndex","imageData","canvasObj","imData","compositeObj","$7069db2f5e23d00f$var$fillRect","$7069db2f5e23d00f$var$mx","$7069db2f5e23d00f$var$my","$7069db2f5e23d00f$var$moveIndex","$7069db2f5e23d00f$var$testAndFill","srcArr","targetArr","initRgba","$7069db2f5e23d00f$export$13d50f258a8034f","rgbaArr","Uint8Array","ArrayBuffer","px","py","q","tl","tr","br","bl","$7069db2f5e23d00f$var$floodFill","$01d7180c5d1d0fdf$export$27550cc14d7ae85a","downX","downY","downAngleRad","$01d7180c5d1d0fdf$export$71b514a25c47df50","colorRGB","strokeStyle","r1","r2","pAngleDeg","pAngleDegSnapped","rotated","r11","r21","rx","ry","rdX","rdY","x1r","y1r","x2r","y2r","x1f","y1f","x2f","y2f","beginPath","moveTo","lineTo","stroke","x1f1","y1f1","x2f1","y2f1","strokeRect","ellipse","$fdc12d72a3df9be9$export$482c90f94eb9717c","outer","fontFamily","fontWeight","fontStyle","spanStr","children","offsetTop","el1","fillText","innerText","isDebug","$089586a542a12f27$export$5f63a7b18dc4503a","$5e45fa121ba5050f$export$74d12f09ff9f1956","$5e45fa121ba5050f$export$b1f70a113e3b5c1b","baseColor","color2","createRadialGradient","$2f1281ced73ab1dc$export$6e1bedb2a6cdff30","blendMode","codes","darken","multiply","lighten","difference","exclusion","hue","saturation","luminosity","$f3c4df6b644f6a61$export$28debfc111084e87","currentName","row","clearBtn","suggestions","suggestionBtns","$c8f65770493ffd93$export$ee79aceabae6bb8a","preview","options","spacer","alphaCanvas","next","previous","$d256278b259ca979$export$6b9252711ea5997f","rootElement","elementType","brushCircleOuter","brushCircleInner","pickerPreviewBorder","pickerPreviewCol","compassSize","compass","compassInner","compassBaseCircle","cx","cy","compassLineCircle","compassUpperTriangle","compassLowerTriangle","radius","borderColor","$d492af58f4721011$var$TMode","TMode","$d492af58f4721011$var$MIN_SCALE","$d492af58f4721011$var$MAX_SCALE","$d492af58f4721011$export$6eaf6f7c0cc177fc","renderTargetCanvas","renderTargetCtx","renderWidth","renderHeight","compositeCanvas","compositeCtx","doResizeCanvas","oldTransformObj","targetTransformObj","highResTransformObj","renderedTransformObj","cursorPos","usesCssCursor","bgVisible","transformIsDirty","doAnimateTranslate","svgOverlay","lastRenderedState","reqFrame","emptyCanvas","emptyLightCanvas","isRepeat","currentInputProcessor","onKeyDown","Draw","Pick","Fill","Gradient","Text","Shape","globalMode","inputProcessorObj","spaceHand","Hand","altPicker","zoom","onKeyUp","updateChangeListener","currentMode","renderTime","lastDrawEvent","linetoolProcessor","$dpBaO","LinetoolProcessor","getMatrix","art","getRenderedTransform","coords","pressure1","matrix1","coords1","pressure0","coords2","pointer","updateCursor","getComboStr","resetInputProcessor","coord","workspaceToCanvasCoord","HandGrabbing","Zoom","offsetX","offsetY","internalZoomByStep","picker","pickedColor","getColorAt","updateColorPreview","Rotating","Rotate","centerObj","startAngleRad","dAngleRad","minimizeAngleRad","origin","angleIsExtraSticky","pinchZoomer","snapAngleRad","mainDoubleTapper","middleDoubleTapper","twoFingerTap","threeFingerTap","pointerEventChain","wheelEvent","brushRadius","animationFrameRequested","lastRenderTime","requestAnimationFrame","updateLoop","addChangeListener","modeInt","doForce","oldMode","$eZ2aJ","$7QZIi","$bz6iQ","$kE5UF","oldIsHand","currentIsHand","setAllowedPointerTypeArr","stepNum","centerX","centerY","newStep","newScale","effectiveFactor","transformA","transformB","blendFactor","centerPosA","canvasToWorkspaceCoord","centerPosB","mixedPos","renderContext","workspacePointArr","borderSize","layerArr","getLayersFast","updateCompass","snapDegIncrement","maxDistDeg","modDeg","doRedrawCanvas","newState","doRender","elapsedFrames","checkChange","testBgVisible","mixTransformObj","start","render","klC","oldWidth","oldHeight","diameter","hideBrushCursorTimeout","doAnimate","newAngle","canvasPointsArr","boundsWidth","boundsHeight","newTargetTransformObj","oldAngleRad","tx","ty","$7752bf3fb7f240e9$export$d429e21f52463d17","downEvent","direction","eventQueue","$6faa9d948ec87f40$export$e258ade1648009b7","$0370167ee97a20d9$export$79a74567acf241b0","corners","isConstrained","snapX","snapY","snappingEnabled","ratio","transEl","boundsEl","pointerRemainder","isInverted","boundsStartP","boundsPointerListener","snap","iP","minSnapDist","distX","distY","$lt7cS","toImageSpace","j","projected","dist1","snapToPixel","updateCornerPositions","updateDOM","gripSize","virtualPos","offsetArr","tinyOffset","scaled","cornerCursors","constrainCorner","snapCorner","tP","toTransformSpace","indexes","updateTransformViaCorners","updateScaled","edges","edgeSize","angleOffset","tfD","ti","dimension","restoreRatio","angleGrip","$5cYet","anglePointerListener","offset","snapDeg","iX","iY","_snap_x","_snap_y","e1","cornerIndex","flip","widthChanged","heightChanged","angle90","newHeight1","skipCallback","transformOrigin","copyTransform","$6c5cb3001c773523$export$958c2bfe8d7142a9","$6c5cb3001c773523$export$234b1c16dfa57d6a","$6c5cb3001c773523$export$6a4549ec4168874a","$6c5cb3001c773523$export$3fba3b383c654cc6","$48f5d87739d28bf9$export$205c2dd29f8a66b5","imageWidth","imageHeight","previewFit","transformIndex","innerWrapper","previewLayerArr","klCanvasPreview","transformSize","initTransform","freeTransform","updatePreview","getTransform","destCanvas","setPos","setAngleDeg","fit","$de496a1759b04ed9$export$71ed2b85d4ca43d3","maxW","maxH","gripCursors","outline","grips","outlinePointerListener","_BB_intDxy","commit","thirdsHorizontal","borderTop","borderBottom","thirdsVertical","gripOverlay","transformTop","transformRight","transformBottom","transformLeft","edge0PointerListener","edge1PointerListener","edge2PointerListener","edge3PointerListener","cornerElArr","corner0PointerListener","corner1PointerListener","corner2PointerListener","corner3PointerListener","$18e69c7d4cb991e8$export$d25420b53e16716f","largeCanvasAnimationTimeout","canvasSize","largeCanvasSize","lastDrawnState","lastDrawnSize","animationCanvas","animationCanvasCtx","animationLength","animationCount","largeCanvasIsVisible","contentWrapperEl","canvasWrapperEl","nameWrapper","flexGrow","nameLabelEl","clickableEl","opacityEl","largeCanvasWrapper","webkitTouchCallout","largeCanvas","largeCanvasCtx","updateCheckerPatterns","layerObj","removeLargeCanvas","drawLargeCanvas","largeCanvasAnimationDurationMs","showLargeCanvas","checker","animationCanvasCheckerPattern","createPattern","largeCanvasCheckerPattern","animate","canvasDimensions","isInstant","currentState","klCanvasLayerObj","$e3dfa43019bc3f08$export$962af7e240721d88","freeTransformCanvas","noteEl","originalSizeBtn","fitSizeBtn","setTransformFit","centerBtn","setTransformCenter","importImage","buttonStr","getTransformation","getIsPixelated","$01cb8095758db224$export$e789742143ba5b1","paddingTop","textShadow","optionStyle","optionLayerEl","optionImageEl","rootCounter","optionLayerCounter","optionImageCounter","testAcceptType","dataTransfer","types","updateOptions","$d6fe881e8fc421ac$export$9f0da9b942594e99","sizeObj","queuedObj","colorEl","selectedColorEl","subscriptionFunc","initialColor","updateColor","subscribe","sliderConfig","getSliderConfig","updateUI","mousePos","$6003e73b8cbb69e2$export$665d2c76b1eb8459","createButton","extraPadding","contain","logoButton","$kX3t5","newButton","$frUlg","importButton","$7qUeg","saveButton","$g2tQ8","shareButton","$cmBTx","helpButton","$8pc1M","$18c597dee53260ff$export$a0a40f8a0b8fee15","imArr","titleArr","currentActiveIndex","openTimeout","startX","startY","showDropdown","elementFromPoint","dropdownBtnArr","wrapper","closeDropdown","updateButton","activeButton","boxSizing","activeButtonIm","arrowButton","$32WFC","dropdownWrapper","borderBottomLeftRadius","borderBottomRightRadius","createDropdownButton","smallMargin","onClickDropdownBtn","$a372d78c806cd0cc$export$c744a22bef9e0b97","currentActiveStr","doLighten","doMirror","createTriangleButton","svg","viewBox","preserveAspectRatio","defs","childrenArr","in","stdDeviation","dx","dy","in2","operator","k2","k3","svgTriangleLeft","class","onLeft","svgTriangleRight","onRight","leftPointerListener","rightPointerListener","leftIm","leftImage","rightIm","rightImage","setIsEnabledLeft","setIsEnabledRight","toolDropdown","handButton","zoomInNOutButton","$fORLP","$kRxRZ","zoomInButton","zoomOutButton","undoNRedoButton","$5ZTVn","undoButton","redoButton","doEmit","$90c04b5ac185bf3d$export$8162a66cd18867a7","strengthSelect","setDeltaValue","$d04d72b97d637d65$export$3c6d17ed0106bfb9","roundRight","roundSize","$fqSj0","roundLeft","pTabObj","openedTabObj","activeTab","initTabObj","tab","tabId","$9934467c988b088a$export$cf20160367bae46c","scaleEl","angleEl","resetButton","fitButton","leftRotateButton","$6Dvin","resetAngleButton","rightRotateButton","pIsVisible","pScale","$51d47356d698ffec$export$1e63e3b0645421a2","toleranceSlider","selectRow","growWrapper","growSelect","contiguousToggle","eraserToggle","$d06987f550ff485e$export$32a22540e4b2f123","$45c003c723de07b5$export$a9387b1d4260d39c","previewSize","rectStrokeSvgRect","rectStrokeSvg","rectFilledSvgRect","rectFilledSvg","ellipseStrokeSvgEllipse","ellipseStrokeSvg","ellipseFilledSvgEllipse","ellipseFilledSvg","lineSvgLine","lineSvg","updatePreviews","strokeWidth","lineWidthSlider","fixedToggle","previewPadding","snapToggle","shapeOptions","lockAlphaToggle","outwardsToggle","$4fb68589de8a8c9a$export$f77a89101d7d6586","createRatioSize","ratioX","ratioY","updateRatio","widthInput","heightInput","commonRatios","reducedArr","closestRatio","closestDistance","ratioWrapper","realw","T","U","V","hcf","newImDiv","unitStyle","widthUnit","heightUnit","sizeTable","$cNr8p","table","templateWrapper","presetFitBtn","presetCurrentBtn","presetSquareBtn","presetLandscapeBtn","presetPortraitBtn","presetOversizeBtn","sizeObj1","backgroundRGBA","colorOptionsArr","initColorIndex","colorOptions","onkeyup","secondRow","$96366ef7b36c82a7$export$9852986a3ec5f6a0","cellProps","rowIndex","_rowEl","colIndex","cellEl","rowSpan","rowspan","$3f73fb4b1b574d52$export$5b91f641162972fc","stateIsOpen","directionStr","icon","$9ecpQ","dirStr","$cd9e7df6e228ea45$export$e263e067d6140649","checkerPattern","previewCtx","textCtx","textCanvas","textInput","alignRadioList","italicToggle","boldToggle","sizeInput","fontSelect","rotatedXY","rotatedWH","fitBounds","zoomFac","previewCanvas","layersCtx","emptyCanvasLight","targetCanvas","layersCanvas","changeZoomFac","zoomInBtn","canZoom","zoomOutBtn","onScroll","isSmallWidth","isSmallHeight","previewPointerListener","row2n3Wrapper","unshift","zoomWrapper","sizePointerListener","fontPointerListener","$itzxn","$3RXBC","$dtB7M","$3qZsM","$68rzB","placeholder","$c8d2eb7d799b314c$export$1bf16d9bd59fd8f9","updateResolution","maxSize","resolutionEl","flattenCheckbox","warningsEl","doFlatten","warningArr","warnings","psdWarningArr","contentArr","warningMap","mask","clipping","group","adjustment","alert","showWarnings","noteEl1","cropRect","isCropped","cropObj","$4c230b0de5e1a470$var$kl2PsdMap","$4c230b0de5e1a470$var$psd2KlMap","$4c230b0de5e1a470$var$init","fromEntries","reverse","$4c230b0de5e1a470$export$6df36f0c42d2440f","str","$4c230b0de5e1a470$export$4e3b1f7d3ad623b4","$4c230b0de5e1a470$export$3d649861c4b13fa2","psdObj","addWarning","warningStr","getMixModeStr","prepareMask","maskCanvas","defaultColor","groupMaskCtx","bitsPerChannel","maxLayers","layerCount","countWithinGroup","groupObj","convertGroup","psdGroupObj","groupCanvas","groupCtx","groupOpacity","hidden","groupMixModeStr","hasClipping","innerArr","innerItem","innerCtx","clippingCanvas","clippingCtx","clippingItem","effects","clippingCanvas1","clippingCtx1","clippingItem1","$4c230b0de5e1a470$export$56493bf279c387b3","klPsd","$41164c8aeaf53227$var$indexedDbIsSupported","indexedDB","$41164c8aeaf53227$var$dbNameStr","$41164c8aeaf53227$var$storageNameStr","$41164c8aeaf53227$export$1347f8be1f25c479","$41164c8aeaf53227$var$execIndexedDBTransaction","actionFunction","successCallback","errorCallback","onError","errorStr","hasFinished","requestObj","onupgradeneeded","createObjectStore","keyPath","createIndex","unique","onerror","onsuccess","databaseObj","transactionObj","storeObj","objectStoreNames","contains","deleteDatabase","transaction","objectStore","oncomplete","$41164c8aeaf53227$export$1448a0dd0d3fde8e","query","$41164c8aeaf53227$export$21ade4eb935254aa","storageProject","put","$41164c8aeaf53227$export$42ffd38884aecdac","$fsSyS","$805be15a1e91c0ee$export$7a4e0b62a5d854bc","isLoaded","$805be15a1e91c0ee$export$395d33c8e06b92c9","brightnessContrast","lang","getDialog","inEmbed","$bBJjx","curves","$fb1QA","distort","$4w6gs","$5XYnt","hueSaturation","$hK7d4","darkNoInvert","invert","$bE89l","perspective","$anXZw","$gDMhw","tiltShift","$bNSoq","toAlpha","$dkVDV","$6aHfw","$kLbWO","unsharpMask","$bgekB","grid","$537C7","noise","$kHVZD","pattern","$bphza","vanishPoint","$tP4I2","$68QTJ","$42ac5b30ad65dabb$export$7d68cd8857639377","PenBrush","BlendBrush","$5PSXS","SketchyBrush","$ewgr9","PixelBrush","$kic4a","ChemyBrush","$6Nq1H","SmudgeBrush","$ltaBP","EraserBrush","$7cUpm","$3f0923cd3c55ea92$var$ALPHA_CIRCLE","$3f0923cd3c55ea92$var$TWO_PI","$3f0923cd3c55ea92$export$6f96c8f9e6ae7341","settingAlphaId","instructionArr","alphaCanvas128","alphaCanvas64","alphaCanvas32","settingColor","alphaOpacityArr","$5CF7D","alphaImArr","settingOpacity","settingHasOpacityPressure","before","settingLockLayerAlpha","settingColorStr","arc","closePath","hasDrawnDot","targetMipmap","bezierLine","lastInput","drawArr","dotCallback","localPressure","lastInput2","localOpacity","calcOpacity","localSize","settingSize","settingHasSizePressure","localSpacing","settingSpacing","addFinal","drawDot","historyEntry","actions","inputIsDrawing","lineToolLastDot","inputArr","continueLine","maxInput","loopDist","mouseDist","eX","eY","bdist","updateAlphaCanvas","$74D3O","$ff6c1f784f50f5d5$export$d116ae91f77f1f19","genBrushAlpha01","genBrushAlpha02","$f875015ce1aeb4d3$export$74a44bbc21d06a28","scaleFac","createImageData","sFac2","$gZSR2","simplex2","noisePattern","centerDist","$f875015ce1aeb4d3$var$udSegment","ba","pa","$f875015ce1aeb4d3$export$eaa218d5d17c8f1c","pDist","centerSize","transitionSize","$dfc47a34ad9bc378$var$myModule","$dfc47a34ad9bc378$var$Grad","Grad","$dfc47a34ad9bc378$var$grad3","$dfc47a34ad9bc378$var$p","$dfc47a34ad9bc378$var$perm","$dfc47a34ad9bc378$var$gradP","seed","$dfc47a34ad9bc378$var$F2","$dfc47a34ad9bc378$var$G2","xin","yin","j1","gi0","gi1","gi2","t0","t1","t2","dot2","$dfc47a34ad9bc378$export$d3022aad56692482","$02d77b8dd5755328$var$cellSize","$02d77b8dd5755328$export$9659db8d01dd5313","redrawBounds","cells","getTouchedCells","isTouched","drawCells","touchedCells","cellsW","getCellsWidth","cell","cellOffsetX","cellOffsetY","cellWidth","cellHeight","inCellBounds","tmpCanvas","tmpCtx","alpha","ar","ag","ab","aa","sliceBounds","e2","randI","randLen","randArr","random","samples","samplesSquared","sampleOffsets","sharpness","invSharpness","sharpnessSubtrahend","sizeSquared","distDivisor","alphaMinuend","slicedBounds","ri","re","alphaO","invAlphaO","alphaU","underR","underG","underB","underR1","underG1","underB1","newAlpha","drawBuffer","localColNew","settingSizePressure","calcSpacing","avgX","avgY","blending","mixr","mixg","mixb","average","localColOld","avgParams","prepDot","copyFromCanvas","getAverage","blendCol","blendMix","bezierCallback","settingOpacityPressure","updateRedrawBounds","isTesting","totalCells","drawChangedCells","find","$c214fbe9e4fc15b0$var$sampleCanvas","$c214fbe9e4fc15b0$var$sampleCtx","$c214fbe9e4fc15b0$export$566f9061f0f5ba33","c1","c2","sketchySeed","settingBlending","settingScale","lastX","lastY","p_x","p_y","preMixedColor","mixx","mixy","mixw","mixh","countmix","mixed","mixmode","rand","$58b45953679baa4a$export$4de5ef8eecde6f12","ditherCanvas","ditherCtx","settingIsEraser","ditherArr","ditherPattern","maxAngleRad","d2","d3","isOverThreshold","cubicCurveOverThreshold","plotLine","settingUseDither","controlCallback","controlObj","plotCubicBezierLine","skipFirst","sX","sY","updateDither","$fc1a683099fb2d61$export$fe52c90afd1cf5ba","isBaseLayer","isTransparentBG","radgrad","oFac","useSizePressure","useOpacityPressure","started","_this_historyEntry_actions","$78ad817c60f81b7c$var$CELL_SIZE","$78ad817c60f81b7c$var$smudge","cSize","brush","cX","cY","aIndex","aP","bP","softnessPx","pixel","ai","bi","ix","iy","fac2","alphaLock","bx1","bx2","yStart","iy1","yStart1","x21","ix1","iy2","yStart2","x3","x22","ix2","y3","iy3","yStart3","x4","x23","ix3","$78ad817c60f81b7c$export$c9f800961903deab","completeRedrawBounds","copiedCells","copyImageData","_$i","e3","imWidth","imHeight","$78ad817c60f81b7c$var$prepSmudge","ImageData","updateCompleteRedrawBounds","historyIm","$348fcce123898af9$export$38b08aa4ea8f61c6","settingXSymmetry","settingYSymmetry","buffer","settingMode","Path2D","settingGradient","startAtTop","minY","maxY","lineJoin","settingDistort","pos","historyCanvas","$cVFne","$7de2f0eab7a9ead7$export$f1561c72be54c6a7","penBrush","penBrushUi","blendBrush","$9mjXI","blendBrushUi","sketchyBrush","$iYbUv","sketchyBrushUi","pixelBrush","$brjBD","pixelBrushUi","chemyBrush","$vCnsd","chemyBrushUi","smudgeBrush","$dS2qM","smudgeBrushUi","$9rc5F","eraserBrushUi","brushInterface","alphaNames","$8b6ca25eb0830594$export$a0d4983f3b0b5c8e","$iEKHy","setSpacing","spacingSpline","alphaOptions","setAlpha","getLockAlpha","setLockAlpha","$7NTKy","pressureSizeToggle","sizePressure","pressureOpacityToggle","opacityPressure","changeSliderValue","$e8a5c017c49bb311$export$5ec472fd0ce20d84","$2e3c50106ba150d5$export$156bb4fe8f4bcb4b","$jxqXH","blendingSlider","getBlending","setBlending","setSizePressure","setOpacityPressure","$94537af75923b9e3$export$ffae56164d1bde68","$1SGPc","blendSlider","scaleSlider","setScale","getSeed","setSeed","$9519e739bc9666ee$export$d001f3406562d07","$1qfk4","setIsEraser","ditherToggle","getUseDither","setUseDither","$d6fc2ded7d9d56db$export$cf481ecf227135a8","$6kk87","isTransparentBg","transparencyToggle","setTransparentBG","$1045b9bae2ffbbb4$export$84831662ba707e7a","$1rnhH","$18456e8104a5a825$export$80819a93636ebb04","$5rmB7","toggleRow","actualIconSize","iconSize","modeOptions","brushSize","mirrorXToggle","halfSize","getXSymmetry","setXSymmetry","mirrorYToggle","getYSymmetry","setYSymmetry","gradientToggle","getGradient","setGradient","$2d47de6498e5a87c$export$35fa34e5af64bd4a","isEmbed","iframe","linkEl","href","onload","contentWindow","location","isMaxHeight","$de98bdc3369d2e4f$export$3dff5655255b5729","items","ignoreFocus","inputs","$0e681e75eb3cab30$export$9c72cf485ef46673","_this_options","gridTemplateColumns","gridTemplateRows","gap","gridTemplateAreas","gridArea","infoEl","isBroken","ageEl","textSize","btnCustom","storeButtonEl","clearButtonEl","hideClearButton","visibility","storeListener","onUpdate","timestamp","thumbnail","updateThumb","updateAge","readResult","read","ageStr","age","Date","getTime","resetButtons","Promise","unsubscribe","$14b343f2c12ca9c5$var$makeAsync","nonAsyncFunc","reject","$14b343f2c12ca9c5$export$93d91060b9af7e2a","accessHasFailed","storeKlProjectObj","getKlProjectObj","lowLevelRead","$3hwQ7","ProjectConverter","readStorageProject","storageProject1","createStorageProject","lowLevelStore","lowLevelClear","updateTimestamp","$3ee249752703e788$var$loadImage","URL","revokeObjectURL","onabort","$3ee249752703e788$export$f3c1ac6650038646","createThumbnail","HTMLCanvasElement","_tmp","all","$e3587a28373f51f9$export$b3fb17ae4345ac8f","base64Str","parts","match","binStr","atob","buf","view","charCodeAt","Blob","$01ce2e23a2667e77$export$a2647fbf5f056b0a","onExportTypeChange","onFileSelect","onSaveImageToComputer","onNewImage","onShareImage","onUpload","onCopyToClipboard","fileMenu","uploadImgurButton","clipboardButton","$fEvzb","importWrapper","innerMask","multiple","accept","importFakeButton","exportTypeSelect","saveNote","createSpacer","clearer","line","fileBrowserStorage","saveRow","refresh","$0d10046ca7f6fbd0$export$3f17d740ad471e50","getCurrentColor","getKlMaxCanvasSize","getKlCanvas","getCurrentLayerCtx","isInit","filters","filterKey","buttonLabel","filterName","applyFilter","filterDialog","maxWidth","maxHeight","currentColorRgb","secondaryColorRgb","getInput","finishedDialog","addGroup","groupArr","$6349b006a6604e1b$var$upload","description","$6349b006a6604e1b$var$_upload","img","gif","labelText","response","formData","$2lMgk","FormData","method","headers","Authorization","ok","json","link","$6349b006a6604e1b$export$b1dd62fa0b5f32f5","inputTitle","inputDescription","rows","labelTitle","labelDescription","tos","typeRadio","outDiv","infoHint","deletehash","$06e8423858d08972$export$befc6437ad34b28a","showReminder","changeTitle","onSaveAsPsd","lastSavedActionNumber","lastSavedAt","psdWrapper","storageWrapper","paddingBottom","psdBtn","storageUi","lastReminderShownAt","onBeforeUnload","returnValue","getActionNumber","visibilityState","unsavedActions","showPopup","onbeforeunload","unsavedInterval","$956d06d740fc5053$export$75e7b60500bb415b","getExportType","filename","mimeType","$6hBII","saveAs","format","saveImage","fileBase","fnameArr","layerArr1","psdConfig","item1","blendKlToPsd","then","agPsdLazy","writePsdBuffer","catch","$e1c6fbc08bfda4eb$export$2bc2a80e311129ac","createElementNS","download","rel","createObjectURL","$48534f13b7192dff$var$execHistoryEntry","setCurrentLayerCtx","ctx1","id1","ctx2","$48534f13b7192dff$export$5cebd3bb2d68229a","getInitState","getCurrentBrush","doIgnore","shouldIgnoreTest","oldSize","entry","currentLayerIndex","logParam","localCurrentLayerCtx","$53cc60fd413705d6$export$272bfd3ef9ef2f48","onSetColor","onSetSize","onSetOpacity","onGetColor","onGetSize","onGetOpacity","onGetSliderConfig","subscriberArr","instance","obj","skipSubscriber","$5562b5b6c391a7ca$export$5d396b237bd33221","customAbout","themeToLabel","makeLicenses","licenses","overflowY","autoLanguage","getAutoLanguage","langWrapper","$fgfvl","languages","languageSelect","LS_LANGUAGE_KEY","languageHint","themeSelect","getMediaQueryTheme","getStoredTheme","setStoredTheme","$741YV","$dd3r9","$951e508110f8a437$export$42a534af7eb650e8","upBtn","downBtn","upInterval","scrollBy","downInterval","wheelListener","$f244572c1923a3ac$export$7fa03d1ef9d3489e","iconArr","updateIcons","typeOptions","reverseToggle","doSnapToggle","col1","col2","$1eff19bee197987a$export$ce26cd3db18613a3","submitButton","leftRightButton","$4bb0d03ef02dc0c0$var$importFilter","libObj","moduleObj","$4bb0d03ef02dc0c0$export$4283b00eae4a6956","$iiVKq","filterBrightnessContrast","$lorQQ","filterCropExtend","$8Ri8I","filterCurves","$fADXF","filterFlip","$bIns5","filterHueSaturation","$30jcG","filterInvert","$cCks8","filterPerspective","$huXOx","filterResize","$dsRff","filterRotate","$lhchB","filterTiltShift","$lXpcU","filterTransform","$1CjeM","filterBlur","$dNWKZ","filterUnsharpMask","$94Tq7","filterToAlpha","$d8Fqy","filterGrid","$gtdB1","filterNoise","$lQzx7","filterPattern","$10iZP","filterDistort","$dteOZ","filterVanishPoint","$024aabab8b30bbfd$export$af433fb90aa90a38","selectedLayerIndex","tempCanvas","brightness","contrast","fxCanvas","$a5EFw","getSharedFx","texture","brightnessSlider","$cH2YE","contrastSlider","previewInnerWrapper","$fca35583bfaa35b6$export$5ec472fd0ce20d84","$6N0h0","$02a74dc72797630f$var$fx","$02a74dc72797630f$export$8c4423af32b21158","_","gl","isContextLost","wrapTexture","initialize","contents","getPixelArray","wrap","$76shC","$eeae469bfe7893fd$export$a04cfca62fd2892f","loadContentsOf","$7dEWP","setGl","$8dg54","FxTexture","fromElement","textureType","UNSIGNED_BYTE","getExtension","testTexture","RGBA","FLOAT","drawTo","getTextureType","spareTexture","extraTexture","flippedShader","$fvBHO","FxShader","use","getDefaultShader","drawRect","array","readPixels","fn","_len","args","_key","$h6IOH","triangleBlur","$e0olz","$kSoEy","$fkecp","matrixWarp","$44j8K","$2myDH","$9uhWc","$1Vq1u","$bJIp5","multiplyAlpha","$lwXVT","unmultiplyAlpha","$3u9Uu","$9WU1L","$6lIef","$c50d7229cf0a789e$export$6408eeb1703e74b8","$jrAes","simpleShader","$8501a2e1e79821a9$export$d731e22ecd0c25d3","shader","uniforms","textureIn","textureOut","swapWith","$e0143068cd462268$var$floatPrecision","$e0143068cd462268$var$defaultVertexSource","$e0143068cd462268$var$defaultFragmentSource","$e0143068cd462268$export$7d9b0d118d0c4108","vertexSource","fragmentSource","nameStr","vertexAttribute","texCoordAttribute","program","createProgram","testPrecisionSupport","HIGH_FLOAT","MEDIUM_FLOAT","attachShader","compileSource","VERTEX_SHADER","FRAGMENT_SHADER","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","source","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","precisionType","getShaderPrecisionFormat","precision","deleteProgram","useProgram","getUniformLocation","uniform1fv","Float32Array","uniform2fv","uniform3fv","uniform4fv","uniformMatrix3fv","uniformMatrix4fv","$e0143068cd462268$var$isNumber","uniform1f","textures","uniform1i","viewport","getParameter","VIEWPORT","vertexBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","texCoordBuffer","getAttribLocation","enableVertexAttribArray","vertexAttribPointer","drawArrays","TRIANGLE_STRIP","defaultShader","$deb6b884ba4ae312$export$5822a9d0880a5d82","$deb6b884ba4ae312$export$b59c6427db8463f4","newGl","$80392da2a95619fd$export$7e6fd232cff50dd1","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","videoWidth","videoHeight","deleteTexture","unit","activeTexture","TEXTURE0","ensureFormat","framebuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","other","$fRyi0","$7480e3ce85bc65db$export$6894093bf294bea5","red","green","blue","redRamp","splineInterpolate","greenRamp","blueRamp","initFromBytes","$d747444e26286abc$export$4f237735eca1f248","interpolator","$6dd7d8fac84d64b7$export$ef28bbbd731e79bf","$dd5d88e299e80db3$export$d3022aad56692482","octaves","peaks","colA","colB","channels","$3TO8L","texSize","$b01b186720ebdc8e$export$6e852234f1597a14","$4urfK","randomShaderFunc","$904e6ba1142f7a16$export$af69f7ca07da04c9","$1ec92859a97056c3$export$4545acb2b6bb8f22","endX","endY","blurRadius","gradientRadius","$5b33fb39bf5722a9$export$a93b0222aeadc54b","inverse","useTextureSpace","$gDZ5A","warpShader","$5taNf","getInverse","$1d7339974b05a229$export$820b3a44cb7b2b21","uniformsStr","warpStr","$303d8d4ec53c4881$export$1c447127d27d7be4","dx1","dy1","dx2","dy2","dx3","dy3","det","$303d8d4ec53c4881$export$68b3343017e80691","$303d8d4ec53c4881$export$2060d2db72cce88f","$c6e0992c38eb55ab$export$915fb7313c578ba2","strength","ensureFormatViaTexture","originalTexture","unuse","$164716f3bce9dcdb$export$be1ee5ea42904fdc","replaceRGBA","$6fb892cfa80f1621$export$6897c284b6f9f4dc","$4d16a2f492bd5d16$export$541149539f3a4684","after","getSquareToQuad","$34a2490457ff8aab$export$b324c80262feb891","$55618926ab99fefa$export$7c9b924528782480","distortType","phase","$f157b4bc2111ecb8$export$57b05c961ff98d6a","$2680b5781517cb67$export$e5937df51b9e1d86","updateInput","leftInput","rightInput","topInput","bottomInput","leftChanged","rightChanged","topChanged","bottomChanged","cropper","setTransform","previewHeight","offsetWrapper","selectedRgbaObj","updateIsDark","previewFactor","lrWrapper","tbWrapper","labelStyle","useRuleOfThirds","ruleOThirdsCheckbox","showThirds","bgColorOverlay","flexRow","$4c948640eb8ef791$export$309483fcb6d5c7ca","$hRvnE","getDefaultCurvesInput","CurvesInput","modeButtons","getModeButtons","$81ac57466912ccc9$export$4300cf0a0df418a6","$81ac57466912ccc9$export$1c43bf66c2a2e4da","p0","areaH","areaW","curveArea","createPoint","lock","internalY","internalX","pointEl","newX","newY","updateControl","outCurves","drawCurve","spline","$6b01e1931d168e01$export$9b1b7b3985b9625a","previewLayer","doFlipCanvas","horizontalCheckbox","verticalCheckbox","targetOptions","horizontal","vertical","flipCanvas","$041c656037c77a96$export$2aa46bd5587f0eb","hueSlider","saturationSlider","$82b3d1ba61b3412f$export$b7ebcfbdc840ef76","$460859cbeb601dec$export$a76d798fa7d85e4e","displayW","displayH","displayPreviewFactor","pointerListenerArr","bb","bc","bd","ac","ad","nob","updateAfter","beforeAfterTabs","$5vheV","TwoTabs","nobSize","$8b4f5ae4fe73ff76$export$b1241e74876d9bbe","leftTab","onpointerdown","rightTab","$63d62a20f3ba2c7d$export$5705240d31427a82","previewW","previewH","algorithmSelect","canvasWrapper","widthWrapper","heightWrapper","$bNBIp","constrainIm","constrainCheckbox","$878715182dcd377b$export$ac7e9efc751d5791","btnPlus","btnMinus","previewcell","$aa97ed406a9700f0$export$1b8796b18b7c19ed","fa","fb","blurSlider","gradientSlider","$31a0dd41d7428d32$export$dc15474d94cdc2b3","JSON","stringify","lastDrawnTransformStr","transformLayerCanvas","onInputsChanged","inputX","inputY","inputR","leftWrapper","rightWrapper","rotWrapper","actionBtnCss","buttonRow","flipXBtn","flipYBtn","scaleRotLeftBtn","scaleRotRightBtn","scaleDoubleBtn","getRatio","scaleHalfBtn","setConstrained","isSnapping","snappingCheckbox","setSnapping","checkboxWrapper","bottomRow","isPixelated","$95b95646154e8218$export$55e7eb2ebd0db869","radiusSlider","$82f12ab116cea855$export$62ac74a5ea43bd5c","strengthSlider","$a535e7a374deb8f5$export$6158ed2b22ebf4d9","sourceId","sourceOptions","$bad33651972f8d2c$export$50020de79e1bc23","renderW","renderH","$1xi6g","drawGrid","settingsObj","thickness","renderFactor","line1","line2","xInput","yInput","thicknessInput","$74df8e8cd35bce4e$export$20d2db9c68afeac","cellsX","cellsY","thickIsRound","pos1","$595c9469b8f94062$var$presetArr","$595c9469b8f94062$var$drawNoise","$595c9469b8f94062$export$1dab0536099042f5","presetCopy","presetIndex","thumbImgArr","preset","thumbImg","presetOptions","row1El","row2El","channelsOptions","blendSelect","colorWrapper","colInputStyle","colAInput","colBInput","$ebbf7e5d844153e5$var$drawPattern","blendOffsetX","blend","blendOffsetY","finalPatternCanvas","blendCanvas","blendCtx","colTransparent","colOpaque","blendGradient","$ebbf7e5d844153e5$export$5b48b77a483d9b33","syncInputs","sharpStrokeRect","drawX","drawY","drawWidth","drawHeight","lastDrawnSettings","previewMode","fullSizeCtx","fullSizeCanvas","pW","pH","overlayCtx","overlayCanvas","previewCanvas1","previewCtx1","inputStyle","mixBlendMode","oldSettings","x11","y11","$67bee9819cf9d9ba$export$77c344cc65ad0ed2","sync","from","sliderArr","fxCanvas1","texture1","isSynced","settingsCopy","topRowEl","syncToggle","xyRowEl","leftCol","rightCol","sliderWidth","toUpperCase","phaseSlider","stepSlider","$9939d5f20537fa4b$export$a77e8ecd2a7fa9a5","$jsIPR","drawVanishPoint","lines","linesSlider","$cd59789add31bb97$export$8f57d6bdbceb36d0","degIncrement","$40b8cea12adf584e$export$92433b641be3f7a","$40b8cea12adf584e$var$_klCanvasToPsdBlob","$3adbeb1f050c09d3$export$c57e2ed65bcf4d6a","interval","lastMixedInput","inputPressure","parse","$73298182992a8985$export$91dcf4209534d21f","$7aa12ecc06c22770$export$bcd109042a2e4bb5","$504c8450f977b764$export$4ccbb8938b9d5723","importedImage","getResizedDimensions","importAsImage","resizedDimensions","importAsImagePsd","convertedPsdObj","cropCanvas","importAsLayer","activeLayerIndex","activeLayerContext","res","clipboardData","file","getAsFile","retrieveImageFromClipboardAsBlob","imageBlob","importFinishedLoading","URLObj","webkitURL","getAsString","pasteStr","log","crossOrigin","showWarningPsdFlattened","hasUnsupportedFile","nameSplit","maxResolution","closeLoader","doShowLoader","loaderIsOpen","reader","FileReader","readerResult","skipLayerImageData","skipThumbnail","skipCompositeImageData","convertedPsd","readAsArrayBuffer","$a8abbf3a9def9692$export$982e7602957287fa","_console","_console1","info","help"],"version":3,"file":"main-embed.1a961264.js.map"}