{"mappings":"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","sources":["src/app/script/main-embed.ts","src/app/script/polyfills/polyfills.ts","src/app/script/polyfills/polyfills-nomodule.ts","node_modules/mdn-polyfills/Node.prototype.append.js","node_modules/mdn-polyfills/Node.prototype.prepend.js","node_modules/mdn-polyfills/String.prototype.padStart.js","node_modules/mdn-polyfills/Array.prototype.findIndex.js","src/app/script/app/kl-app.ts","<<jsx-config-pragma.js>>","node_modules/@swc/helpers/src/_to_consumable_array.mjs","node_modules/@swc/helpers/src/_array_without_holes.mjs","node_modules/@swc/helpers/src/_non_iterable_spread.mjs","src/app/script/klecks/kl.ts","src/app/script/klecks/history/kl-history.ts","src/app/script/klecks/ui/modals/base/showModal.ts","src/app/script/klecks/ui/modals/modal-count.ts","src/app/script/bb/bb.ts","src/app/script/bb/base/browser.ts","src/app/script/bb/base/create-canvas.ts","src/app/script/bb/input/key-listener.ts","src/app/script/bb/input/pointer-listener.ts","src/app/script/bb/input/wheel-cleaner.ts","src/app/script/bb/input/pressure-normalizer.ts","src/app/script/bb/math/math.ts","src/app/script/bb/base/canvas.ts","src/app/script/bb/math/matrix.ts","src/app/script/bb/math/vec2.ts","src/app/script/bb/math/line.ts","src/app/script/bb/color/color.ts","src/app/script/bb/base/ui.ts","src/app/script/bb/base/bb-log.ts","src/app/script/bb/base/local-storage.ts","src/app/script/bb/input/event-chain/coalesced-exploder.ts","src/app/script/bb/input/event-chain/n-finger-tapper.ts","src/app/script/bb/input/event-chain/pinch-zoomer.ts","src/app/script/bb/input/event-chain/double-tapper.ts","src/app/script/bb/input/event-chain/one-pointer-limiter.ts","src/app/script/bb/input/event-chain/event-chain.ts","src/app/script/klecks/ui/modals/base/scroll-fix.ts","node_modules/@parcel/runtime-js/lib/runtime-ac5a13e6ed7d1c32.js","node_modules/@parcel/runtime-js/lib/runtime-287f00094a316f99.js","src/app/script/klecks/ui/modals/base/dynamic-modal.ts","src/app/script/klecks/ui/components/checkbox.ts","src/app/script/klecks/ui/components/input.ts","src/app/script/klecks/ui/components/select.ts","src/app/script/klecks/ui/components/image-toggle.ts","src/app/script/klecks/ui/components/image-radio-list.ts","src/app/script/klecks/ui/components/create-pen-pressure-toggle.ts","node_modules/@parcel/runtime-js/lib/runtime-5d5af97961b0b866.js","src/app/script/klecks/ui/components/box-toggle.ts","src/app/script/klecks/ui/components/kl-slider.ts","src/app/script/klecks/ui/components/slider-falloff.ts","src/app/script/klecks/ui/components/kl-slider-manual-input.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-343023b05f023704.js","src/app/script/klecks/ui/components/kl-color-slider.ts","node_modules/@parcel/runtime-js/lib/runtime-e949988766af13d3.js","src/app/script/klecks/brushes/erase-color.ts","src/app/script/klecks/ui/components/kl-color-slider-small.ts","src/app/script/klecks/ui/components/point-slider.ts","src/app/script/klecks/ui/components/color-options.ts","src/app/script/klecks/ui/components/options.ts","src/app/script/klecks/ui/components/status-overlay.ts","node_modules/@parcel/runtime-js/lib/runtime-e99dce5763a53828.js","src/app/script/klecks/ui/components/crop-copy.ts","src/app/script/klecks/ui/modals/clipboard-dialog.ts","src/app/script/klecks/ui/tool-tabs/layer-manager/layer-manager.ts","src/app/script/klecks/canvas/kl-canvas.ts","src/app/script/klecks/image-operations/flood-fill.ts","src/app/script/klecks/image-operations/shape-tool.ts","src/app/script/klecks/image-operations/render-text.ts","src/app/script/klecks/canvas/draw-project.ts","src/app/script/klecks/image-operations/gradient-tool.ts","src/app/script/klecks/canvas/translate-blending.ts","src/app/script/klecks/ui/tool-tabs/layer-manager/rename-layer-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-b31ab580fe87ed91.js","src/app/script/klecks/ui/tool-tabs/layer-manager/merge-layer-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-9d4db9a16894fc5d.js","node_modules/@parcel/runtime-js/lib/runtime-8689d3bdc90716d5.js","node_modules/@parcel/runtime-js/lib/runtime-67c3e5d0b4ea898f.js","node_modules/@parcel/runtime-js/lib/runtime-6f5bf53dff43e557.js","src/app/script/klecks/canvas-ui/workspace-svg-overlay.ts","src/app/script/klecks/canvas-ui/kl-canvas-workspace.ts","node_modules/@parcel/runtime-js/lib/runtime-d3176d0a84b6cab2.js","node_modules/@parcel/runtime-js/lib/runtime-fae9a2679085aa34.js","node_modules/@parcel/runtime-js/lib/runtime-313dd5ffb9b9f520.js","node_modules/@parcel/runtime-js/lib/runtime-2a18e2880edd0998.js","src/app/script/klecks/events/linetool-processor.ts","src/app/script/klecks/canvas-ui/canvas-preview.ts","src/app/script/klecks/ui/components/free-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-719757e47171233d.js","src/app/script/klecks/ui/components/free-transform-utils.ts","src/app/script/klecks/ui/components/free-transform-canvas.ts","src/app/script/klecks/ui/components/cropper.ts","src/app/script/klecks/ui/components/layer-preview.ts","src/app/script/klecks/ui/modals/show-import-as-layer-dialog.ts","src/app/script/klecks/ui/components/kl-image-dropper.ts","src/app/script/klecks/ui/components/overlay-toolspace.ts","src/app/script/klecks/ui/components/toolspace-top-row.ts","node_modules/@parcel/runtime-js/lib/runtime-7df504581c8b86ae.js","node_modules/@parcel/runtime-js/lib/runtime-051039d7aa46660a.js","node_modules/@parcel/runtime-js/lib/runtime-c3ac4661b4a56a9b.js","node_modules/@parcel/runtime-js/lib/runtime-b17cc4a4601be3c4.js","node_modules/@parcel/runtime-js/lib/runtime-ba29718ea135d20f.js","node_modules/@parcel/runtime-js/lib/runtime-4ecaac3815a70635.js","src/app/script/klecks/ui/components/tool-dropdown.ts","node_modules/@parcel/runtime-js/lib/runtime-8bdb8bdd8828f06e.js","node_modules/@parcel/runtime-js/lib/runtime-0b39f3111ea9252b.js","node_modules/@parcel/runtime-js/lib/runtime-48932223f89234d1.js","node_modules/@parcel/runtime-js/lib/runtime-7d10910deba19d0d.js","node_modules/@parcel/runtime-js/lib/runtime-88790bdf968aa944.js","node_modules/@parcel/runtime-js/lib/runtime-19a2d39e17cbc785.js","src/app/script/klecks/ui/components/toolspace-tool-row.ts","node_modules/@parcel/runtime-js/lib/runtime-41c7a6bdeb9cc3fc.js","node_modules/@parcel/runtime-js/lib/runtime-c4a854cd9c2e49c9.js","node_modules/@parcel/runtime-js/lib/runtime-71bc2704037e4034.js","node_modules/@parcel/runtime-js/lib/runtime-1efd7f94627b6b51.js","src/app/script/klecks/ui/components/toolspace-stabilizer-row.ts","src/app/script/klecks/ui/components/tab-row.ts","node_modules/@parcel/runtime-js/lib/runtime-16dea92aa233c3d8.js","src/app/script/klecks/ui/tool-tabs/hand-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-144f3179c6c3fe3c.js","src/app/script/klecks/ui/tool-tabs/fill-ui.ts","src/app/script/klecks/ui/tool-tabs/text-ui.ts","src/app/script/klecks/ui/tool-tabs/shape-ui.ts","src/app/script/klecks/ui/modals/new-image-dialog.ts","src/app/script/klecks/ui/components/table.ts","src/app/script/klecks/ui/components/toolspace-collapser.ts","node_modules/@parcel/runtime-js/lib/runtime-61134bbd82dc83a9.js","src/app/script/klecks/ui/modals/text-tool-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-4b94518680a7ea9a.js","node_modules/@parcel/runtime-js/lib/runtime-27c12d26a5335a1c.js","node_modules/@parcel/runtime-js/lib/runtime-a2156221f02ea6ff.js","node_modules/@parcel/runtime-js/lib/runtime-095fd25bc9573bb4.js","node_modules/@parcel/runtime-js/lib/runtime-91916a44e9213781.js","src/app/script/klecks/ui/modals/show-import-image-dialog.ts","src/app/script/klecks/storage/psd.ts","src/app/script/klecks/storage/indexed-db.ts","src/app/script/klecks/filters/filters.ts","node_modules/@parcel/runtime-js/lib/runtime-acf4a19a71cb937a.js","node_modules/@parcel/runtime-js/lib/runtime-d67887a6c0fb147f.js","node_modules/@parcel/runtime-js/lib/runtime-1951d0f45b837ff9.js","node_modules/@parcel/runtime-js/lib/runtime-bb176b3b6425aaaa.js","node_modules/@parcel/runtime-js/lib/runtime-dbc18e2745ca65c5.js","node_modules/@parcel/runtime-js/lib/runtime-80911ed486f33545.js","node_modules/@parcel/runtime-js/lib/runtime-eead2608d2fa5bd2.js","node_modules/@parcel/runtime-js/lib/runtime-9a1e033a88e16096.js","node_modules/@parcel/runtime-js/lib/runtime-c9bd458795fed0ba.js","node_modules/@parcel/runtime-js/lib/runtime-5626aa10019711dd.js","node_modules/@parcel/runtime-js/lib/runtime-2044b7aa526106e6.js","node_modules/@parcel/runtime-js/lib/runtime-21795bc53efbcb17.js","node_modules/@parcel/runtime-js/lib/runtime-d5912d6d1ba72424.js","node_modules/@parcel/runtime-js/lib/runtime-d72562b990dee7d8.js","node_modules/@parcel/runtime-js/lib/runtime-0b2b4c30952b5c7d.js","node_modules/@parcel/runtime-js/lib/runtime-64c83be280987e8f.js","node_modules/@parcel/runtime-js/lib/runtime-ca97bf89fb66f180.js","node_modules/@parcel/runtime-js/lib/runtime-9fe1796050e673a2.js","src/app/script/klecks/brushes/brushes.ts","src/app/script/klecks/brushes/pen-brush.ts","src/app/script/klecks/brushes/brushes-common.ts","src/app/script/klecks/brushes/alphas/brush-alphas.ts","src/app/script/bb/math/perlin.ts","src/app/script/klecks/brushes/blend-brush.ts","src/app/script/klecks/brushes/sketchy-brush.ts","src/app/script/klecks/brushes/pixel-brush.ts","src/app/script/klecks/brushes/eraser-brush.ts","src/app/script/klecks/brushes/smudge-brush.ts","src/app/script/klecks/brushes/chemy-brush.ts","src/app/script/klecks/brushes-ui/brushes-ui.ts","src/app/script/klecks/brushes-ui/pen-brush-ui.ts","src/app/script/klecks/brushes-ui/brushes-consts.ts","node_modules/@parcel/runtime-js/lib/runtime-317d41dd30e22153.js","src/app/script/klecks/brushes-ui/blend-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-fb4dfe91dd51f3ab.js","src/app/script/klecks/brushes-ui/sketchy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-9c55c239f6725590.js","src/app/script/klecks/brushes-ui/pixel-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-7deb3a76132d4783.js","src/app/script/klecks/brushes-ui/eraser-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-64ee3a6e15622cad.js","src/app/script/klecks/brushes-ui/smudge-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-69a46bfcd4b52be6.js","src/app/script/klecks/brushes-ui/chemy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-67968a5afa6a1356.js","src/app/script/klecks/ui/modals/show-iframe-modal.ts","src/app/script/klecks/ui/components/radio-list.ts","src/app/script/klecks/ui/components/browser-storage-ui.ts","src/app/script/klecks/storage/project-store.ts","src/app/script/klecks/storage/project-converter.ts","src/app/script/klecks/storage/base-64-to-blob.ts","src/app/script/klecks/ui/tool-tabs/file-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-237dc2978439233a.js","src/app/script/klecks/ui/tool-tabs/filter-tab.ts","src/app/script/klecks/ui/modals/imgur-upload.ts","node_modules/@parcel/runtime-js/lib/runtime-5b3a6227e48c006a.js","src/app/script/klecks/storage/ag-psd-wrapper.ts","node_modules/@parcel/runtime-js/lib/runtime-5ea32053680ef652.js","src/app/script/klecks/ui/components/save-reminder.ts","src/app/script/klecks/storage/save-to-computer.ts","src/app/script/bb/base/save-as.ts","src/app/script/klecks/history/undo-redo-catchup.ts","src/app/script/klecks/brushes-ui/brush-setting-service.ts","src/app/script/klecks/ui/tool-tabs/settings-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-476b50212be070a0.js","node_modules/@parcel/runtime-js/lib/runtime-f5c56ad551a77e9a.js","node_modules/@parcel/runtime-js/lib/runtime-4135c6b241ed0f39.js","src/app/script/klecks/ui/components/toolspace-scroller.ts","src/app/script/klecks/ui/tool-tabs/gradient-ui.ts","src/app/script/embed/embed-toolspace-top-row.ts","src/app/script/klecks/filters/filters-lazy.ts","src/app/script/klecks/filters/filter-brightness-contrast.ts","src/app/script/klecks/filters/filters-consts.ts","src/app/script/fx-canvas/shared-fx.ts","src/app/script/fx-canvas/fx-canvas.ts","src/app/script/fx-canvas/filters/brightness-contrast.ts","src/app/script/fx-canvas/core/simple-shader.ts","src/app/script/fx-canvas/core/fx-shader.ts","src/app/script/fx-canvas/core/gl.ts","src/app/script/fx-canvas/core/fx-texture.ts","src/app/script/fx-canvas/filters/curves.ts","src/app/script/fx-canvas/math/spline-interpolate.ts","src/app/script/fx-canvas/filters/hue-saturation.ts","src/app/script/fx-canvas/filters/noise.ts","src/app/script/fx-canvas/shaders/shader-noise.glsl","src/app/script/fx-canvas/filters/triangle-blur.ts","src/app/script/fx-canvas/shaders/random-shader-func.ts","src/app/script/fx-canvas/filters/tilt-shift.ts","src/app/script/fx-canvas/filters/matrix-warp.ts","src/app/script/fx-canvas/shaders/warp-shader.ts","src/app/script/fx-canvas/math/matrix.ts","src/app/script/fx-canvas/filters/unsharp-mask.ts","src/app/script/fx-canvas/filters/to-alpha.ts","src/app/script/fx-canvas/filters/invert.ts","src/app/script/fx-canvas/filters/perspective.ts","src/app/script/fx-canvas/filters/unmultiply-alpha.ts","src/app/script/fx-canvas/filters/distort.ts","src/app/script/fx-canvas/filters/multiply-alpha.ts","src/app/script/klecks/filters/filter-crop-extend.ts","src/app/script/klecks/filters/filter-curves.ts","src/app/script/klecks/filters/filter-curves/curves-input.ts","src/app/script/klecks/filters/filter-flip.ts","src/app/script/klecks/filters/filter-hue-saturation.ts","src/app/script/klecks/filters/filter-invert.ts","src/app/script/klecks/filters/filter-perspective.ts","src/app/script/klecks/ui/components/two-tabs.ts","src/app/script/klecks/filters/filter-resize.ts","node_modules/@parcel/runtime-js/lib/runtime-cd2cbb52134a8268.js","src/app/script/klecks/filters/filter-rotate.ts","src/app/script/klecks/filters/filter-tilt-shift.ts","src/app/script/klecks/filters/filter-transform.ts","src/app/script/klecks/filters/filter-blur.ts","src/app/script/klecks/filters/filter-unsharp-mask.ts","src/app/script/klecks/filters/filter-to-alpha.ts","src/app/script/klecks/filters/filter-grid.ts","src/app/script/klecks/image-operations/draw-grid.ts","src/app/script/klecks/filters/filter-noise.ts","src/app/script/klecks/filters/filter-pattern.ts","src/app/script/klecks/filters/filter-distort.ts","src/app/script/klecks/filters/filter-vanish-point.ts","src/app/script/klecks/image-operations/draw-vanish-point.ts","src/app/script/klecks/storage/kl-canvas-to-psd-blob.ts","src/app/script/klecks/events/line-smoothing.ts","src/app/script/klecks/events/line-sanitizer.ts","src/app/script/klecks/utils/translate-smoothing.ts","src/app/script/app/import-handler.ts","node_modules/@parcel/runtime-js/lib/runtime-6ea03b887069337c.js","node_modules/@parcel/runtime-js/lib/runtime-a1a8750389ec178d.js","src/app/script/app/console-api.ts"],"sourcesContent":["import './polyfills/polyfills';\r\nimport {KlApp} from './app/kl-app';\r\nimport {IKlProject} from './klecks/kl-types';\r\nimport {SaveReminder} from './klecks/ui/components/save-reminder';\r\nimport {klHistory} from './klecks/history/kl-history';\r\nimport {klPsdToKlProject, readPsd} from './klecks/storage/psd';\r\nimport {LANG} from './language/language';\r\n\r\nexport interface IEmbedParams {\r\n    project?: IKlProject;\r\n    psdBlob?: Blob;\r\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    embedUrl: string;\r\n    logoImg?: any;\r\n    bottomBar?: HTMLElement;\r\n    aboutEl?: HTMLElement;\r\n}\r\n\r\nexport interface IReadPSD {\r\n    blob: Blob;\r\n    callback: (k: IKlProject) => void;\r\n}\r\n\r\nexport function Embed (p: IEmbedParams) {\r\n\r\n    let isInitialized: boolean = false;\r\n    let klApp;\r\n    const psdQueue: IReadPSD[] = []; // queue of psds waiting while ag-psd is loading\r\n    let agPsd: any | 'error';\r\n\r\n    let loadingScreenEl = document.getElementById('loading-screen');\r\n    let loadingScreenTextEl = document.getElementById('loading-screen-text');\r\n    if (loadingScreenTextEl) {\r\n        loadingScreenTextEl.textContent = LANG('embed-init-waiting');\r\n    }\r\n\r\n    function onProjectReady (project: IKlProject) {\r\n        try {\r\n            if (isInitialized) {\r\n                throw new Error('Already called openProject');\r\n            }\r\n            isInitialized = true;\r\n\r\n            const saveReminder = new SaveReminder(\r\n                klHistory,\r\n                false,\r\n                false,\r\n                () => {},\r\n                () => klApp ? klApp.isDrawing() : false,\r\n                null,\r\n                null,\r\n            );\r\n            klApp = new KlApp(\r\n                project,\r\n                {\r\n                    saveReminder,\r\n                    bottomBar: p.bottomBar,\r\n                    aboutEl: p.aboutEl,\r\n                    embed: {\r\n                        url: p.embedUrl,\r\n                        onSubmit: p.onSubmit,\r\n                    },\r\n                }\r\n            );\r\n            saveReminder.init();\r\n\r\n            if (loadingScreenEl && loadingScreenEl.parentNode) {\r\n                loadingScreenEl.parentNode.removeChild(loadingScreenEl);\r\n            }\r\n            loadingScreenEl = null;\r\n            loadingScreenTextEl = null;\r\n\r\n            document.body.append(klApp.getEl());\r\n        } catch (e) {\r\n            if (loadingScreenTextEl) {\r\n                loadingScreenTextEl.textContent = ' ' + e;\r\n            }\r\n            if (loadingScreenEl) {\r\n                loadingScreenEl.className += 'loading-screen-error';\r\n            }\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    if (p.project) {\r\n        onProjectReady(p.project);\r\n    }\r\n    this.openProject = onProjectReady;\r\n    this.initError = (error: string) => {\r\n        if (loadingScreenTextEl) {\r\n            loadingScreenTextEl.textContent = ' ' + error;\r\n        }\r\n        if (loadingScreenEl) {\r\n            loadingScreenEl.className += 'loading-screen-error';\r\n        }\r\n    };\r\n    this.getPNG = (): Blob => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return klApp.getPNG();\r\n    };\r\n    this.getPSD = async (): Promise<Blob> => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return await klApp.getPSD();\r\n    };\r\n    this.readPSDs = (psds: IReadPSD[]) => {\r\n        if (psds.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const readItem = (item: IReadPSD) => {\r\n            try {\r\n                const psd = agPsd.readPsd(item.blob);\r\n                const project = klPsdToKlProject(readPsd(psd));\r\n                item.callback(project);\r\n            } catch (e) {\r\n                console.error('failed to read psd', e);\r\n                item.callback(null);\r\n            }\r\n        };\r\n\r\n        if (!agPsd) {\r\n            if (psdQueue.length === 0) {\r\n                // load ag-psd\r\n                (async () => {\r\n                    try {\r\n                        agPsd = await import('ag-psd');\r\n                    } catch (e) {\r\n                        agPsd = 'error';\r\n                    }\r\n                    while (psdQueue.length) {\r\n                        readItem(psdQueue.shift());\r\n                    }\r\n                })();\r\n            }\r\n            psds.forEach(item => {\r\n                psdQueue.push(item);\r\n            });\r\n        } else {\r\n            psds.forEach(readItem);\r\n        }\r\n    };\r\n}","import './polyfills-nomodule';\r\n\r\n/*\r\n * ---- Below ----------------------\r\n * features that didn't have support until *after* browsers supported the modules script tag:\r\n * chrome 61\r\n * edge 16\r\n * safari 11\r\n * firefox 60\r\n * https://caniuse.com/es6-module\r\n */\r\n\r\n// chrome 61, edge 79, safari 16, firefox 107\r\nif (!('scrollTo' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollTo', {\r\n        value: function (x: number, y: number) {\r\n            this.scrollLeft = x;\r\n            this.scrollTop = y;\r\n        },\r\n    });\r\n}\r\n\r\n// chrome 61, edge 79, safari 16, firefox 107\r\nif (!('scrollBy' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollBy', {\r\n        value: function (x: number, y: number) {\r\n            this.scrollLeft += x;\r\n            this.scrollTop += y;\r\n        },\r\n    });\r\n}\r\n\r\n// chrome 69, edge 79, safari 12, firefox 62\r\nif (!Array.prototype.flat) {\r\n    Object.defineProperty(Array.prototype, 'flat', {\r\n        configurable: true,\r\n        value: function flat () {\r\n            const depth = isNaN(arguments[0]) ? 1 : Number(arguments[0]);\r\n\r\n            return depth ? Array.prototype.reduce.call(this, function (acc, cur) {\r\n                if (Array.isArray(cur)) {\r\n                    acc.push.apply(acc, flat.call(cur, depth - 1));\r\n                } else {\r\n                    acc.push(cur);\r\n                }\r\n\r\n                return acc;\r\n            }, []) : Array.prototype.slice.call(this);\r\n        },\r\n        writable: true,\r\n    });\r\n}\r\n\r\n// sometimes Android WebView has no localStorage\r\nif (!('localStorage' in window)) {\r\n    try {\r\n        window['localStorage'] = {\r\n            getItem: () => null,\r\n            setItem: () => {},\r\n            removeItem: () => {},\r\n        } as any;\r\n    } catch (e) {\r\n        // maybe it fails?\r\n    }\r\n}\r\n","/**\r\n * features that were available before module script tags:\r\n * chrome 61\r\n * edge 16\r\n * safari 11\r\n * firefox 60\r\n * https://caniuse.com/es6-module\r\n */\r\n\r\nimport 'mdn-polyfills/Node.prototype.append';\r\nimport 'mdn-polyfills/Node.prototype.prepend'; // edge 17 (one version after module)\r\nimport 'mdn-polyfills/String.prototype.padStart';\r\nimport 'mdn-polyfills/Array.prototype.findIndex';","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"append\")||Object.defineProperty(e,\"append\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(n,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"prepend\")||Object.defineProperty(e,\"prepend\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","String.prototype.padStart||(String.prototype.padStart=function(t,n){return t>>=0,n=String(n||\" \"),this.length>t?String(this):((t-=this.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(this))});\n","Array.prototype.findIndex||Object.defineProperty(Array.prototype,\"findIndex\",{value:function(r){if(null==this)throw new TypeError('\"this\" is null or not defined');var e=Object(this),t=e.length>>>0;if(\"function\"!=typeof r)throw new TypeError(\"predicate must be a function\");for(var n=arguments[1],o=0;o<t;){var i=e[o];if(r.call(n,i,o,e))return o;o++}return-1}});\n","import {KL} from '../klecks/kl';\r\nimport {klHistory, TMiscFocusLayerHistoryEntry} from '../klecks/history/kl-history';\r\nimport {BB} from '../bb/bb';\r\nimport {showIframeModal} from '../klecks/ui/modals/show-iframe-modal';\r\nimport {EmbedToolspaceTopRow} from '../embed/embed-toolspace-top-row';\r\nimport {\r\n    IGradient,\r\n    IInitState,\r\n    IKlProject,\r\n    TDrawEvent,\r\n    TExportType,\r\n    TKlCanvasLayer,\r\n    TUiLayout,\r\n} from '../klecks/kl-types';\r\nimport {importFilters} from '../klecks/filters/filters-lazy';\r\nimport {base64ToBlob} from '../klecks/storage/base-64-to-blob';\r\nimport {klCanvasToPsdBlob} from '../klecks/storage/kl-canvas-to-psd-blob';\r\nimport {ProjectStore} from '../klecks/storage/project-store';\r\nimport {SaveReminder} from '../klecks/ui/components/save-reminder';\r\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\r\nimport {LANG} from '../language/language';\r\nimport {LocalStorage} from '../bb/base/local-storage';\r\nimport {LineSmoothing} from '../klecks/events/line-smoothing';\r\nimport {LineSanitizer} from '../klecks/events/line-sanitizer';\r\nimport {TabRow} from '../klecks/ui/components/tab-row';\r\nimport {LayerPreview} from '../klecks/ui/components/layer-preview';\r\nimport {KlColorSlider} from '../klecks/ui/components/kl-color-slider';\r\nimport {ToolspaceToolRow} from '../klecks/ui/components/toolspace-tool-row';\r\nimport {StatusOverlay} from '../klecks/ui/components/status-overlay';\r\nimport {SaveToComputer} from '../klecks/storage/save-to-computer';\r\nimport {ToolspaceCollapser} from '../klecks/ui/components/toolspace-collapser';\r\nimport {ToolspaceScroller} from '../klecks/ui/components/toolspace-scroller';\r\nimport {translateSmoothing} from '../klecks/utils/translate-smoothing';\r\nimport {ImportHandler} from './import-handler';\r\n\r\nimport toolPaintImg from '/src/app/img/ui/tool-paint.svg';\r\nimport toolHandImg from '/src/app/img/ui/tool-hand.svg';\r\nimport toolFillImg from '/src/app/img/ui/tool-fill.svg';\r\nimport toolGradientImg from '/src/app/img/ui/tool-gradient.svg';\r\nimport toolTextImg from '/src/app/img/ui/tool-text.svg';\r\nimport toolShapeImg from '/src/app/img/ui/tool-shape.svg';\r\nimport tabSettingsImg from '/src/app/img/ui/tab-settings.svg';\r\nimport tabLayersImg from '/src/app/img/ui/tab-layers.svg';\r\nimport {LayerManager} from '../klecks/ui/tool-tabs/layer-manager/layer-manager';\r\nimport {IVector2D} from '../bb/bb-types';\r\nimport {createConsoleApi} from './console-api';\r\nimport {ERASE_COLOR} from '../klecks/brushes/erase-color';\r\n\r\ntype KlAppOptionsEmbed = {\r\n    url: string;\r\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n};\r\n\r\ninterface IKlAppOptions {\r\n    saveReminder?: SaveReminder;\r\n    projectStore?: ProjectStore;\r\n    logoImg?: string; // app logo\r\n    bottomBar?: HTMLElement; // row at bottom of toolspace\r\n    embed?: KlAppOptionsEmbed;\r\n    app?: {\r\n        filenameBase?: string; // part of filename when downloading drawing\r\n        imgurKey?: string; // for imgur uploads\r\n    };\r\n    aboutEl?: HTMLElement; // replaces info about Klecks in settings tab\r\n}\r\n\r\nimportFilters();\r\n\r\nexport class KlApp {\r\n\r\n    private readonly klRootEl: HTMLElement;\r\n    private uiWidth: number;\r\n    private uiHeight: number;\r\n    private readonly layerPreview: LayerPreview;\r\n    private readonly klColorSlider: KlColorSlider;\r\n    private readonly toolspaceToolRow: ToolspaceToolRow;\r\n    private readonly statusOverlay: StatusOverlay;\r\n    private readonly klCanvas: KlCanvas;\r\n    private uiState: TUiLayout;\r\n    private readonly embed: undefined | KlAppOptionsEmbed;\r\n    private readonly saveToComputer: SaveToComputer;\r\n    private readonly lineSanitizer: LineSanitizer;\r\n    private readonly klCanvasWorkspace: KlCanvasWorkspace;\r\n    private readonly collapseThreshold: number = 820;\r\n    private readonly toolspaceCollapser: ToolspaceCollapser;\r\n    private readonly toolspace: HTMLElement;\r\n    private readonly toolspaceInner: HTMLElement;\r\n    private readonly toolWidth: number = 271;\r\n    private readonly bottomBar: HTMLElement | undefined;\r\n    private readonly layerManager: LayerManager;\r\n    private readonly toolspaceScroller: ToolspaceScroller;\r\n    private readonly bottomBarWrapper: HTMLElement;\r\n\r\n    private updateCollapse (): void {\r\n\r\n        //collapser\r\n        if (this.uiWidth < this.collapseThreshold) {\r\n            this.toolspaceCollapser.getElement().style.display = 'block';\r\n\r\n            this.toolspaceCollapser.setDirection(this.uiState);\r\n            if (this.toolspaceCollapser.isOpen()) {\r\n                if (this.uiState === 'left') {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '271px',\r\n                        right: '',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '271px',\r\n                    });\r\n                } else {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '271px',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '0',\r\n                    });\r\n                }\r\n                this.toolspace.style.display = 'block';\r\n                this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\r\n                this.statusOverlay.setWide(false);\r\n\r\n            } else {\r\n                if (this.uiState === 'left') {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '0',\r\n                        right: '',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '0',\r\n                    });\r\n                } else {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '0',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '0',\r\n                    });\r\n                }\r\n                this.toolspace.style.display = 'none';\r\n                this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth), this.uiHeight);\r\n                this.statusOverlay.setWide(true);\r\n\r\n            }\r\n\r\n        } else {\r\n            this.toolspaceCollapser.getElement().style.display = 'none';\r\n            if (this.uiState === 'left') {\r\n                BB.css(this.klCanvasWorkspace.getElement(), {\r\n                    left: '271px',\r\n                });\r\n            } else {\r\n                BB.css(this.klCanvasWorkspace.getElement(), {\r\n                    left: '0',\r\n                });\r\n            }\r\n            this.toolspace.style.display = 'block';\r\n            this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\r\n            this.statusOverlay.setWide(false);\r\n        }\r\n    }\r\n\r\n    private updateBottomBar (): void {\r\n        if (!this.bottomBar) {\r\n            return;\r\n        }\r\n        const isVisible = (this.toolspaceInner.scrollHeight + 40 < window.innerHeight);\r\n        this.bottomBarWrapper.style.display = isVisible ? '' : 'none';\r\n    }\r\n\r\n    private updateUi (): void {\r\n        this.toolspace.classList.toggle('kl-toolspace--left', this.uiState === 'left');\r\n        this.toolspace.classList.toggle('kl-toolspace--right', this.uiState === 'right');\r\n        if (this.uiState === 'left') {\r\n            BB.css(this.toolspace, {\r\n                left: '0',\r\n                right: '',\r\n            });\r\n            BB.css(this.klCanvasWorkspace.getElement(), {\r\n                left: '271px',\r\n            });\r\n        } else {\r\n            BB.css(this.toolspace, {\r\n                left: '',\r\n                right: '0',\r\n            });\r\n            BB.css(this.klCanvasWorkspace.getElement(), {\r\n                left: '0',\r\n            });\r\n        }\r\n        this.statusOverlay.setUiState(this.uiState);\r\n        this.layerPreview.setUiState(this.uiState);\r\n        this.layerManager.setUiState(this.uiState);\r\n        this.updateCollapse();\r\n        this.toolspaceScroller.updateUiState(this.uiState);\r\n    }\r\n\r\n    // -------- public --------\r\n    constructor (\r\n        pProject: IKlProject | null,\r\n        pOptions: IKlAppOptions,\r\n    ) {\r\n        this.embed = pOptions.embed;\r\n        // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\r\n        // but not larger than 4096 - a fairly arbitrary decision\r\n        const klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\r\n        this.uiState = (this.embed ? 'left' : (LocalStorage.getItem('uiState') ? LocalStorage.getItem('uiState') : 'right')) as TUiLayout;\r\n        const filenameBase = pOptions.app?.filenameBase ? pOptions.app.filenameBase : 'Klecks';\r\n        const projectStore = pOptions.projectStore;\r\n        this.klRootEl = BB.el({\r\n            className: 'g-root',\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n            },\r\n        });\r\n        this.uiWidth = Math.max(0, window.innerWidth);\r\n        this.uiHeight = Math.max(0, window.innerHeight);\r\n        let exportType: TExportType = 'png';\r\n        this.klCanvas = new KL.KlCanvas(\r\n            pProject ? {\r\n                projectObj: pProject,\r\n            } : {\r\n                width: Math.max(10, Math.min(klMaxCanvasSize, window.innerWidth < this.collapseThreshold ? this.uiWidth : this.uiWidth - this.toolWidth)),\r\n                height: Math.max(10, Math.min(klMaxCanvasSize, this.uiHeight)),\r\n            }, this.embed ? -1 : 0);\r\n        this.klCanvas.setHistory(klHistory);\r\n        let initState: IInitState | null = null;\r\n        let mainTabRow: TabRow | undefined;\r\n\r\n        if (!pOptions.saveReminder) {\r\n            pOptions.saveReminder = {init: () => {}, reset: () => {}} as SaveReminder;\r\n        }\r\n\r\n        if (pProject) {\r\n            pProject.layers.forEach(layer => {\r\n                layer.image = null;\r\n            });\r\n            pProject = null;\r\n        } else {\r\n            klHistory.pause(true);\r\n            this.klCanvas.addLayer();\r\n            this.klCanvas.layerFill(0, {r: ERASE_COLOR, g: ERASE_COLOR, b: ERASE_COLOR});\r\n            klHistory.pause(false);\r\n        }\r\n        try {\r\n            initState = {\r\n                canvas: new KL.KlCanvas({copy: this.klCanvas}, this.embed ? -1 : 0),\r\n                focus: this.klCanvas.getLayerCount() - 1,\r\n                brushes: {},\r\n            };\r\n        } catch (e) {\r\n            if (e.message === 'kl-create-canvas-error') {\r\n                this.klCanvas.destroy();\r\n            }\r\n            throw e;\r\n        }\r\n        Object.entries(KL.brushes).forEach(([b, Brush]) => {\r\n            initState.brushes[b] = new Brush();\r\n            if (initState.canvas) {\r\n                initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\r\n            }\r\n        });\r\n\r\n\r\n        let currentColor = new BB.RGB(0, 0, 0);\r\n        let currentBrushUi;\r\n        let currentBrushId: string;\r\n        let lastNonEraserBrushId: string;\r\n        let currentLayerCtx = this.klCanvas.getLayerContext(this.klCanvas.getLayerCount() - 1);\r\n\r\n        // when cycling through brushes you need to know the next non-eraser brush\r\n        const getNextBrushId = (): string => {\r\n            if (currentBrushId === 'eraserBrush') {\r\n                return lastNonEraserBrushId;\r\n            }\r\n            const keyArr = Object.keys(brushUiMap).filter(item => item !== 'eraserBrush');\r\n            const i = keyArr.findIndex(item => item === currentBrushId);\r\n            return keyArr[(i + 1) % keyArr.length];\r\n        };\r\n\r\n        const sizeWatcher = (val) => {\r\n            brushSettingService.emitSize(val);\r\n            if (this.klCanvasWorkspace) {\r\n                this.klCanvasWorkspace.setCursorSize(val * 2);\r\n            }\r\n        };\r\n\r\n        const brushSettingService = new KL.BrushSettingService(\r\n            (color) => {\r\n                this.klColorSlider.setColor(color);\r\n                currentBrushUi.setColor(color);\r\n                currentColor = BB.copyObj(color);\r\n            },\r\n            (size) => {\r\n                currentBrushUi.setSize(size);\r\n                this.klCanvasWorkspace.setCursorSize(size * 2);\r\n            },\r\n            (opacity) => {\r\n                currentBrushUi.setOpacity(opacity);\r\n            },\r\n            () => this.klColorSlider.getColor(),\r\n            () => brushUiMap[currentBrushId].getSize(),\r\n            () => brushUiMap[currentBrushId].getOpacity(),\r\n            () => {\r\n                return {\r\n                    sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                    opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\r\n                };\r\n            }\r\n        );\r\n\r\n        const lineSmoothing = new LineSmoothing({\r\n            smoothing: translateSmoothing(1),\r\n        });\r\n        this.lineSanitizer = new LineSanitizer();\r\n\r\n        const drawEventChain = new BB.EventChain({\r\n            chainArr: [\r\n                this.lineSanitizer,\r\n                lineSmoothing,\r\n            ],\r\n        });\r\n\r\n        drawEventChain.setChainOut((event: TDrawEvent) => {\r\n            if (event.type === 'down') {\r\n                this.toolspace.style.pointerEvents = 'none';\r\n                currentBrushUi.startLine(event.x, event.y, event.pressure);\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n            if (event.type === 'move') {\r\n                currentBrushUi.goLine(event.x, event.y, event.pressure, false, event.isCoalesced);\r\n                this.klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n            if (event.type === 'up') {\r\n                this.toolspace.style.pointerEvents = '';\r\n                currentBrushUi.endLine();\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n            if (event.type === 'line') {\r\n                currentBrushUi.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n        });\r\n\r\n        const textToolSettings = {\r\n            size: 20,\r\n            align: 'left' as ('left' | 'center' | 'right'),\r\n            isBold: false,\r\n            isItalic: false,\r\n            font: 'sans-serif' as ('serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'),\r\n            opacity: 1,\r\n        };\r\n\r\n        this.klCanvasWorkspace = new KL.KlCanvasWorkspace({\r\n            klCanvas: this.klCanvas,\r\n            width: Math.max(0, this.uiWidth - this.toolWidth),\r\n            height: this.uiHeight,\r\n            onDraw: (e) => drawEventChain.chainIn(e),\r\n            onPick: (rgbObj, isDragDone) => {\r\n                brushSettingService.setColor(rgbObj);\r\n                if (isDragDone) {\r\n                    this.klColorSlider.pickingDone();\r\n                    this.klCanvasWorkspace.setMode(this.toolspaceToolRow.getActive());\r\n                }\r\n            },\r\n            onFill: (canvasX, canvasY) => {\r\n                const layerIndex = this.klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                this.klCanvas.floodFill(\r\n                    layerIndex,\r\n                    canvasX,\r\n                    canvasY,\r\n                    fillUi.getIsEraser() ? null : this.klColorSlider.getColor(),\r\n                    fillUi.getOpacity(),\r\n                    fillUi.getTolerance(),\r\n                    fillUi.getSample(),\r\n                    fillUi.getGrow(),\r\n                    fillUi.getContiguous()\r\n                );\r\n                this.klCanvasWorkspace.requestFrame();\r\n            },\r\n            onGradient: (typeStr, canvasX, canvasY, angleRad) => {\r\n                if (typeStr === 'down') {\r\n                    gradientTool.onDown(canvasX, canvasY, angleRad);\r\n                }\r\n                if (typeStr === 'move') {\r\n                    gradientTool.onMove(canvasX, canvasY);\r\n                }\r\n                if (typeStr === 'up') {\r\n                    gradientTool.onUp(canvasX, canvasY);\r\n                }\r\n            },\r\n            onText: (canvasX, canvasY, angleRad) => {\r\n                if (KL.dialogCounter.get() > 0) {\r\n                    return;\r\n                }\r\n\r\n                KL.textToolDialog({\r\n                    klCanvas: this.klCanvas,\r\n                    layerIndex: this.klCanvas.getLayerIndex(currentLayerCtx.canvas),\r\n                    x: canvasX,\r\n                    y: canvasY,\r\n                    angleRad: angleRad,\r\n                    color: this.klColorSlider.getColor(),\r\n                    secondaryColor: this.klColorSlider.getSecondaryRGB(),\r\n                    size: textToolSettings.size,\r\n                    align: textToolSettings.align,\r\n                    isBold: textToolSettings.isBold,\r\n                    isItalic: textToolSettings.isItalic,\r\n                    font: textToolSettings.font,\r\n                    opacity: textToolSettings.opacity,\r\n                    onConfirm: (val) => {\r\n\r\n                        const colorRGBA = val.color;\r\n                        colorRGBA.a = val.opacity;\r\n\r\n                        textToolSettings.size = val.size;\r\n                        textToolSettings.align = val.align;\r\n                        textToolSettings.isBold = val.isBold;\r\n                        textToolSettings.isItalic = val.isItalic;\r\n                        textToolSettings.font = val.font;\r\n                        textToolSettings.opacity = val.opacity;\r\n\r\n                        const layerIndex = this.klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                        this.klCanvas.text(layerIndex, {\r\n                            textStr: val.textStr,\r\n                            x: val.x,\r\n                            y: val.y,\r\n                            size: val.size,\r\n                            font: val.font,\r\n                            align: val.align,\r\n                            isBold: val.isBold,\r\n                            isItalic: val.isItalic,\r\n                            angleRad: angleRad,\r\n                            color: BB.ColorConverter.toRgbaStr(colorRGBA),\r\n                        });\r\n                        this.klCanvasWorkspace.requestFrame();\r\n                    },\r\n                });\r\n\r\n            },\r\n            onShape: (typeStr, canvasX, canvasY, angleRad) => {\r\n                if (typeStr === 'down') {\r\n                    shapeTool.onDown(canvasX, canvasY, angleRad);\r\n                }\r\n                if (typeStr === 'move') {\r\n                    shapeTool.onMove(canvasX, canvasY);\r\n                }\r\n                if (typeStr === 'up') {\r\n                    shapeTool.onUp(canvasX, canvasY);\r\n                }\r\n            },\r\n\r\n            onViewChange: (viewChangeObj) => {\r\n\r\n                if (viewChangeObj.changed.includes('scale')) {\r\n                    this.statusOverlay.out({\r\n                        type: 'transform',\r\n                        scale: viewChangeObj.scale,\r\n                        angleDeg: viewChangeObj.angle * 180 / Math.PI,\r\n                    });\r\n                }\r\n\r\n                this.toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== this.klCanvasWorkspace.getMaxScale());\r\n                this.toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== this.klCanvasWorkspace.getMinScale());\r\n\r\n                handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\r\n            },\r\n            onUndo: () => {\r\n                if (klHistory.canUndo()) {\r\n                    if (undoRedoCatchup.undo()) {\r\n                        this.statusOverlay.out(LANG('undo'), true);\r\n                    }\r\n                }\r\n            },\r\n            onRedo: () => {\r\n                if (klHistory.canRedo()) {\r\n                    if (undoRedoCatchup.redo()) {\r\n                        this.statusOverlay.out(LANG('redo'), true);\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        const updateMainTabVisibility = () => {\r\n            if (!mainTabRow) {\r\n                return;\r\n            }\r\n\r\n            const toolObj = {\r\n                'draw': {},\r\n                'hand': {},\r\n                'fill': {},\r\n                'gradient': {},\r\n                'text': {},\r\n                'shape': {},\r\n            };\r\n\r\n            const activeStr = this.toolspaceToolRow.getActive();\r\n            const oldTabId = mainTabRow.getOpenedTabId();\r\n\r\n            const keysArr = Object.keys(toolObj);\r\n            for (let i = 0; i < keysArr.length; i++) {\r\n                if (activeStr === keysArr[i]) {\r\n                    mainTabRow.setIsVisible(keysArr[i], true);\r\n                } else {\r\n                    mainTabRow.setIsVisible(keysArr[i], false);\r\n                    if (oldTabId === keysArr[i]) {\r\n                        mainTabRow.open(activeStr);\r\n                    }\r\n                }\r\n            }\r\n\r\n        };\r\n\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr) => {\r\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n\r\n                const isDrawing = this.lineSanitizer.getIsDrawing() || this.klCanvasWorkspace.getIsDrawing();\r\n                if (isDrawing) {\r\n                    return;\r\n                }\r\n\r\n                if (comboStr === 'plus') {\r\n                    this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n                }\r\n                if (comboStr === 'minus') {\r\n                    this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n                }\r\n                if (comboStr === 'home') {\r\n                    this.klCanvasWorkspace.fitView();\r\n                }\r\n                if (comboStr === 'end') {\r\n                    this.klCanvasWorkspace.resetView(true);\r\n                }\r\n                if (['ctrl+z', 'cmd+z'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    undoRedoCatchup.undo();\r\n                }\r\n                if (\r\n                    ['ctrl+y', 'cmd+y'].includes(comboStr) ||\r\n                    (\r\n                        (\r\n                            BB.sameKeys('ctrl+shift+z', comboStr) ||\r\n                            BB.sameKeys('cmd+shift+z', comboStr)\r\n                        ) && keyStr === 'z'\r\n                    )\r\n                ) {\r\n                    event.preventDefault();\r\n                    undoRedoCatchup.redo();\r\n                }\r\n                if (!this.embed) {\r\n                    if (['ctrl+s', 'cmd+s'].includes(comboStr)) {\r\n                        event.preventDefault();\r\n                        this.saveToComputer.save();\r\n                    }\r\n                    if (['ctrl+shift+s', 'cmd+shift+s'].includes(comboStr)) {\r\n                        event.preventDefault();\r\n\r\n                        (async () => {\r\n                            let success = true;\r\n                            try {\r\n                                await projectStore.store(this.klCanvas.getProject());\r\n                            } catch (e) {\r\n                                success = false;\r\n                                setTimeout(() => {\r\n                                    throw new Error('keyboard-shortcut: failed to store browser storage, ' + e);\r\n                                }, 0);\r\n                                this.statusOverlay.out(' ' + LANG('file-storage-failed'), true);\r\n                            }\r\n                            if (success) {\r\n                                pOptions.saveReminder.reset();\r\n                                this.statusOverlay.out(LANG('file-storage-stored'), true);\r\n                            }\r\n                        })();\r\n                    }\r\n                    if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\r\n                        event.preventDefault();\r\n                        copyToClipboard(true);\r\n                    }\r\n                }\r\n                if (['ctrl+a', 'cmd+a'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                }\r\n\r\n\r\n                if (keyListener.comboOnlyContains(['left', 'right', 'up', 'down'])) {\r\n                    if (keyStr === 'left') {\r\n                        this.klCanvasWorkspace.translateView(1, 0);\r\n                    }\r\n                    if (keyStr === 'right') {\r\n                        this.klCanvasWorkspace.translateView(-1, 0);\r\n                    }\r\n                    if (keyStr === 'up') {\r\n                        this.klCanvasWorkspace.translateView(0, 1);\r\n                    }\r\n                    if (keyStr === 'down') {\r\n                        this.klCanvasWorkspace.translateView(0, -1);\r\n                    }\r\n                }\r\n\r\n\r\n                if (['r+left','r+right'].includes(comboStr)) {\r\n                    if (keyStr === 'left') {\r\n                        this.klCanvasWorkspace.setAngle(-15, true);\r\n                        handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                    if (keyStr === 'right') {\r\n                        this.klCanvasWorkspace.setAngle(15, true);\r\n                        handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                }\r\n                if (['r+up'].includes(comboStr)) {\r\n                    this.klCanvasWorkspace.setAngle(0);\r\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                }\r\n\r\n\r\n                if (comboStr === 'sqbr_open') {\r\n                    currentBrushUi.decreaseSize(0.03 / this.klCanvasWorkspace.getScale());\r\n                }\r\n                if (comboStr === 'sqbr_close') {\r\n                    currentBrushUi.increaseSize(0.03 / this.klCanvasWorkspace.getScale());\r\n                }\r\n                if (comboStr === 'enter') {\r\n                    this.klCanvas.layerFill(this.klCanvas.getLayerIndex(currentLayerCtx.canvas), this.klColorSlider.getColor());\r\n                    this.statusOverlay.out(LANG('filled'), true);\r\n                }\r\n                if (['delete', 'backspace'].includes(comboStr)) {\r\n                    const layerIndex = this.klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                    if (layerIndex === 0 && !brushUiMap.eraserBrush.getIsTransparentBg()) {\r\n                        this.klCanvas.layerFill(layerIndex, {r: 255, g: 255, b: 255}, 'source-in');\r\n                    } else {\r\n                        this.klCanvas.clearLayer(layerIndex);\r\n                    }\r\n                    this.statusOverlay.out(LANG('cleared-layer'), true);\r\n                }\r\n                if (comboStr === 'e') {\r\n                    event.preventDefault();\r\n                    this.klCanvasWorkspace.setMode('draw');\r\n                    this.toolspaceToolRow.setActive('draw');\r\n                    mainTabRow && mainTabRow.open('draw');\r\n                    updateMainTabVisibility();\r\n                    brushTabRow.open('eraserBrush');\r\n                }\r\n                if (comboStr === 'b') {\r\n                    event.preventDefault();\r\n                    const prevMode = this.klCanvasWorkspace.getMode();\r\n                    this.klCanvasWorkspace.setMode('draw');\r\n                    this.toolspaceToolRow.setActive('draw');\r\n                    mainTabRow && mainTabRow.open('draw');\r\n                    updateMainTabVisibility();\r\n                    brushTabRow.open(prevMode === 'draw' ? getNextBrushId() : currentBrushId);\r\n                }\r\n                if (comboStr === 'g') {\r\n                    event.preventDefault();\r\n                    const newMode = this.klCanvasWorkspace.getMode() === 'fill' ? 'gradient' : 'fill';\r\n                    this.klCanvasWorkspace.setMode(newMode);\r\n                    this.toolspaceToolRow.setActive(newMode);\r\n                    mainTabRow && mainTabRow.open(newMode);\r\n                    updateMainTabVisibility();\r\n                }\r\n                if (comboStr === 't') {\r\n                    event.preventDefault();\r\n                    this.klCanvasWorkspace.setMode('text');\r\n                    this.toolspaceToolRow.setActive('text');\r\n                    mainTabRow && mainTabRow.open('text');\r\n                    updateMainTabVisibility();\r\n                }\r\n                if (comboStr === 'u') {\r\n                    event.preventDefault();\r\n                    this.klCanvasWorkspace.setMode('shape');\r\n                    this.toolspaceToolRow.setActive('shape');\r\n                    mainTabRow && mainTabRow.open('shape');\r\n                    updateMainTabVisibility();\r\n                }\r\n                if (comboStr === 'x') {\r\n                    event.preventDefault();\r\n                    this.klColorSlider.swapColors();\r\n                }\r\n\r\n\r\n            },\r\n            onUp: (keyStr, event) => {\r\n            },\r\n        });\r\n\r\n        const brushUiMap = {};\r\n        // create brush UIs\r\n        Object.entries(KL.brushesUI).forEach(([b, brushUi]) => {\r\n            const ui = new brushUi.Ui({\r\n                onSizeChange: sizeWatcher,\r\n                onOpacityChange: (opacity) => {\r\n                    brushSettingService.emitOpacity(opacity);\r\n                },\r\n                onConfigChange: () => {\r\n                    brushSettingService.emitSliderConfig({\r\n                        sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                        opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\r\n                    });\r\n                },\r\n            });\r\n            brushUiMap[b] = ui;\r\n            ui.getElement().style.padding = 10 + 'px';\r\n        });\r\n\r\n        this.statusOverlay = new KL.StatusOverlay();\r\n\r\n        this.toolspace = BB.el({\r\n            className: 'kl-toolspace',\r\n            css: {\r\n                position: 'absolute',\r\n                right: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                width: (this.toolWidth - 1) + 'px',\r\n                overflow: 'hidden',\r\n                userSelect: 'none',\r\n                touchAction: 'none',\r\n            },\r\n        });\r\n        this.toolspaceInner = BB.el({\r\n            parent: this.toolspace,\r\n        });\r\n        this.toolspace.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n        this.toolspace.onclick = BB.handleClick;\r\n\r\n\r\n        this.toolspaceCollapser = new KL.ToolspaceCollapser({\r\n            onChange: () => {\r\n                this.updateCollapse();\r\n            },\r\n        });\r\n\r\n        this.updateCollapse();\r\n\r\n\r\n\r\n\r\n\r\n        let overlayToolspace;\r\n        setTimeout(() => {\r\n            overlayToolspace = new KL.OverlayToolspace({\r\n                enabledTest: () => {\r\n                    return KL.dialogCounter.get() === 0 && !this.lineSanitizer.getIsDrawing();\r\n                },\r\n                brushSettingService,\r\n            });\r\n            this.klRootEl.append(overlayToolspace.getElement());\r\n        }, 0);\r\n\r\n        BB.append(\r\n            this.klRootEl,\r\n            [\r\n                this.klCanvasWorkspace.getElement(),\r\n                this.toolspace,\r\n                this.toolspaceCollapser.getElement(),\r\n            ]\r\n        );\r\n\r\n        let toolspaceTopRow;\r\n        if (this.embed) {\r\n            toolspaceTopRow = new EmbedToolspaceTopRow({\r\n                onHelp: () => {\r\n                    showIframeModal(this.embed.url + '/help.html', !!this.embed);\r\n                },\r\n                onSubmit: () => {\r\n                    KL.popup({\r\n                        target: this.klRootEl,\r\n                        message: LANG('submit-prompt'),\r\n                        buttons: [LANG('submit'), 'Cancel'],\r\n                        callback: async (result) => {\r\n                            if (result !== LANG('submit')) {\r\n                                return;\r\n                            }\r\n\r\n                            const overlay = BB.el({\r\n                                parent: this.klRootEl,\r\n                                className: 'upload-overlay',\r\n                                content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\r\n                            });\r\n\r\n                            this.embed.onSubmit(\r\n                                () => {\r\n                                    pOptions.saveReminder.reset();\r\n                                    this.klRootEl.removeChild(overlay);\r\n                                },\r\n                                () => {\r\n                                    this.klRootEl.removeChild(overlay);\r\n                                });\r\n                        },\r\n                    });\r\n                },\r\n                onLeftRight: () => {\r\n                    this.uiState = this.uiState === 'left' ? 'right' : 'left';\r\n                    this.updateUi();\r\n                },\r\n            });\r\n        } else {\r\n            toolspaceTopRow = new KL.ToolspaceTopRow({\r\n                logoImg: pOptions.logoImg,\r\n                onLogo: () => {\r\n                    showIframeModal('./home/', !!this.embed);\r\n                },\r\n                onNew: () => {\r\n                    showNewImageDialog();\r\n                },\r\n                onImport: () => {\r\n                    fileTab.triggerImport();\r\n                },\r\n                onSave: () => {\r\n                    this.saveToComputer.save();\r\n                },\r\n                onShare: () => {\r\n                    shareImage();\r\n                },\r\n                onHelp: () => {\r\n                    showIframeModal('./help/', !!this.embed);\r\n                },\r\n            });\r\n        }\r\n        toolspaceTopRow.getElement().style.marginBottom = '10px';\r\n        this.toolspaceInner.append(toolspaceTopRow.getElement());\r\n\r\n        this.toolspaceToolRow = new KL.ToolspaceToolRow({\r\n            onActivate: (activeStr) => {\r\n                if (activeStr === 'draw') {\r\n                    this.klCanvasWorkspace.setMode('draw');\r\n                } else if (activeStr === 'hand') {\r\n                    this.klCanvasWorkspace.setMode('hand');\r\n                } else if (activeStr === 'fill') {\r\n                    this.klCanvasWorkspace.setMode('fill');\r\n                } else if (activeStr === 'gradient') {\r\n                    this.klCanvasWorkspace.setMode('gradient');\r\n                } else if (activeStr === 'text') {\r\n                    this.klCanvasWorkspace.setMode('text');\r\n                } else if (activeStr === 'shape') {\r\n                    this.klCanvasWorkspace.setMode('shape');\r\n                } else {\r\n                    throw new Error('unknown activeStr');\r\n                }\r\n                mainTabRow && mainTabRow.open(activeStr);\r\n                updateMainTabVisibility();\r\n                this.klColorSlider.pickingDone();\r\n            },\r\n            onZoomIn: () => {\r\n                this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n            },\r\n            onZoomOut: () => {\r\n                this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n            },\r\n            onUndo: () => {\r\n                undoRedoCatchup.undo();\r\n            },\r\n            onRedo: () => {\r\n                undoRedoCatchup.redo();\r\n            },\r\n        });\r\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\r\n        klHistory.addListener(() => {\r\n            this.toolspaceToolRow.setEnableUndo(klHistory.canUndo());\r\n            this.toolspaceToolRow.setEnableRedo(klHistory.canRedo());\r\n        });\r\n        this.toolspaceInner.append(this.toolspaceToolRow.getElement());\r\n\r\n        const setBrushColor = (p_color) => {\r\n            currentColor = p_color;\r\n            currentBrushUi.setColor(p_color);\r\n            brushSettingService.emitColor(p_color);\r\n            this.klColorSlider.pickingDone();\r\n        };\r\n\r\n        this.klColorSlider = new KL.KlColorSlider({\r\n            width: 250,\r\n            height: 30,\r\n            svHeight: 100,\r\n            startValue: new BB.RGB(0, 0, 0),\r\n            onPick: setBrushColor,\r\n        });\r\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\r\n        this.klColorSlider.setPickCallback((doPick) => {\r\n\r\n            if (doPick) {\r\n                this.klCanvasWorkspace.setMode('pick');\r\n            } else {\r\n                this.klCanvasWorkspace.setMode(this.toolspaceToolRow.getActive());\r\n                updateMainTabVisibility();\r\n            }\r\n\r\n        });\r\n\r\n        const setCurrentBrush = (brushId) => {\r\n            if (brushId !== 'eraserBrush') {\r\n                lastNonEraserBrushId = brushId;\r\n            }\r\n\r\n            if (this.klColorSlider) {\r\n                if (brushId === 'eraserBrush') {\r\n                    this.klColorSlider.enable(false);\r\n                } else {\r\n                    this.klColorSlider.enable(true);\r\n                }\r\n            }\r\n\r\n            currentBrushId = brushId;\r\n            currentBrushUi = brushUiMap[brushId];\r\n            currentBrushUi.setColor(currentColor);\r\n            currentBrushUi.setContext(currentLayerCtx);\r\n            this.klCanvasWorkspace.setMode('draw');\r\n            this.toolspaceToolRow.setActive('draw');\r\n            updateMainTabVisibility();\r\n        };\r\n\r\n        const setCurrentLayer = (layer: TKlCanvasLayer) => { //BrushContext(p_context) {\r\n            currentLayerCtx = layer.context;\r\n            currentBrushUi.setContext(layer.context);\r\n            this.layerPreview.setLayer(layer);\r\n        };\r\n\r\n        const brushDiv = BB.el();\r\n        const colorDiv = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'flex-end',\r\n            },\r\n        });\r\n        const toolspaceStabilizerRow = new KL.ToolspaceStabilizerRow({\r\n            smoothing: 1,\r\n            onSelect: (v) => {\r\n                lineSmoothing.setSmoothing(translateSmoothing(v));\r\n            },\r\n        });\r\n\r\n\r\n        brushDiv.append(colorDiv);\r\n        BB.append(\r\n            colorDiv,\r\n            [this.klColorSlider.getElement(), this.klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n        );\r\n\r\n        const brushTabRow = new KL.TabRow({\r\n            initialId: 'penBrush',\r\n            useAccent: true,\r\n            tabArr: (() => {\r\n                const result = [];\r\n\r\n                const createTab = (keyStr) => {\r\n                    return {\r\n                        id: keyStr,\r\n                        image: KL.brushesUI[keyStr].image,\r\n                        title: KL.brushesUI[keyStr].tooltip,\r\n                        onOpen: () => {\r\n                            brushUiMap[keyStr].getElement().style.display = 'block';\r\n                            setCurrentBrush(keyStr);\r\n                            this.klColorSlider.pickingDone();\r\n                            brushSettingService.emitSliderConfig({\r\n                                sizeSlider: KL.brushesUI[keyStr].sizeSlider,\r\n                                opacitySlider: KL.brushesUI[keyStr].opacitySlider,\r\n                            });\r\n                            sizeWatcher(brushUiMap[keyStr].getSize());\r\n                            brushSettingService.emitOpacity(brushUiMap[keyStr].getOpacity());\r\n                        },\r\n                        onClose: () => {\r\n                            brushUiMap[keyStr].getElement().style.display = 'none';\r\n                        },\r\n                    };\r\n                };\r\n\r\n                const keyArr = Object.keys(brushUiMap);\r\n                for (let i = 0; i < keyArr.length; i++) {\r\n                    result.push(createTab(keyArr[i]));\r\n                }\r\n                return result;\r\n            })(),\r\n        });\r\n        BB.append(brushDiv, [\r\n            brushTabRow.getElement(),\r\n            ...Object.entries(KL.brushesUI).map(([b]) => brushUiMap[b].getElement()),\r\n        ]);\r\n\r\n        const handUi = new KL.HandUi({\r\n            scale: 1,\r\n            angleDeg: 0,\r\n            onReset: () => {\r\n                this.klCanvasWorkspace.resetView(true);\r\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n            },\r\n            onFit: () => {\r\n                this.klCanvasWorkspace.fitView();\r\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n            },\r\n            onAngleChange: (angleDeg, isRelative) => {\r\n                this.klCanvasWorkspace.setAngle(angleDeg, isRelative);\r\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n            },\r\n        });\r\n\r\n        const fillUi = new KL.FillUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const gradientUi = new KL.GradientUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const textUi = new KL.TextUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const shapeUi = new KL.ShapeUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const gradientTool = new KL.GradientTool({\r\n            onGradient: (isDone, x1, y1, x2, y2, angleRad) => {\r\n                const layerIndex = this.klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                const settings = gradientUi.getSettings();\r\n                const gradientObj: IGradient = {\r\n                    type: settings.type,\r\n                    color1: this.klColorSlider.getColor(),\r\n                    isReversed: settings.isReversed,\r\n                    opacity: settings.opacity,\r\n                    doLockAlpha: settings.doLockAlpha,\r\n                    isEraser: settings.isEraser,\r\n                    doSnap: keyListener.isPressed('shift') || settings.doSnap,\r\n                    x1,\r\n                    y1,\r\n                    x2,\r\n                    y2,\r\n                    angleRad,\r\n                };\r\n\r\n                if (isDone) {\r\n                    this.klCanvas.setComposite(layerIndex, null);\r\n                    this.klCanvas.drawGradient(layerIndex, gradientObj);\r\n                } else {\r\n                    this.klCanvas.setComposite(layerIndex, {\r\n                        draw: (ctx) => {\r\n                            KL.drawGradient(ctx, gradientObj);\r\n                        },\r\n                    });\r\n                }\r\n                this.klCanvasWorkspace.requestFrame();\r\n            },\r\n        });\r\n\r\n        const shapeTool = new KL.ShapeTool({\r\n            onShape: (isDone, x1, y1, x2, y2, angleRad) => {\r\n\r\n                const layerIndex = this.klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n\r\n                const shapeObj: any = {\r\n                    type: shapeUi.getShape(),\r\n                    x1: x1,\r\n                    y1: y1,\r\n                    x2: x2,\r\n                    y2: y2,\r\n                    angleRad: angleRad,\r\n                    isOutwards: shapeUi.getIsOutwards(),\r\n                    opacity: shapeUi.getOpacity(),\r\n                    isEraser: shapeUi.getIsEraser(),\r\n                    doLockAlpha: shapeUi.getDoLockAlpha(),\r\n                };\r\n                if (shapeUi.getShape() === 'line') {\r\n                    shapeObj.strokeRgb = this.klColorSlider.getColor();\r\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                    shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed('shift');\r\n                } else {\r\n                    shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed('shift');\r\n                    if (shapeUi.getMode() === 'stroke') {\r\n                        shapeObj.strokeRgb = this.klColorSlider.getColor();\r\n                        shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                    } else {\r\n                        shapeObj.fillRgb = this.klColorSlider.getColor();\r\n                    }\r\n                }\r\n\r\n                if (isDone) {\r\n                    this.klCanvas.setComposite(layerIndex, null);\r\n                    this.klCanvas.drawShape(layerIndex, shapeObj);\r\n                } else {\r\n                    this.klCanvas.setComposite(layerIndex, {\r\n                        draw: (ctx) => {\r\n                            KL.drawShape(ctx, shapeObj);\r\n                        },\r\n                    });\r\n                }\r\n                this.klCanvasWorkspace.requestFrame();\r\n\r\n            },\r\n        });\r\n\r\n        this.layerManager = new KL.LayerManager(\r\n            this.klCanvas,\r\n            (val) => {\r\n                setCurrentLayer(this.klCanvas.getLayer(val));\r\n                klHistory.push({\r\n                    tool: ['misc'],\r\n                    action: 'focusLayer',\r\n                    params: [val],\r\n                } as TMiscFocusLayerHistoryEntry);\r\n            },\r\n            this.klRootEl,\r\n            this.uiState,\r\n        );\r\n        this.layerPreview = new KL.LayerPreview({\r\n            klRootEl: this.klRootEl,\r\n            onClick: () => {\r\n                mainTabRow && mainTabRow.open('layers');\r\n            },\r\n            uiState: this.uiState,\r\n        });\r\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\r\n        this.layerPreview.setLayer(this.klCanvas.getLayer(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)));\r\n\r\n        const filterTab = new KL.FilterTab(\r\n            this.klRootEl,\r\n            this.klColorSlider,\r\n            this.layerManager,\r\n            this.klCanvasWorkspace,\r\n            handUi,\r\n            () => currentColor,\r\n            () => klMaxCanvasSize,\r\n            () => this.klCanvas,\r\n            () => currentLayerCtx,\r\n            !!this.embed,\r\n            this.statusOverlay,\r\n        );\r\n\r\n        const undoRedoCatchup = new KL.UndoRedoCatchup(\r\n            brushUiMap,\r\n            this.layerPreview,\r\n            this.layerManager,\r\n            handUi,\r\n            this.klCanvasWorkspace,\r\n            () => {\r\n                if (!initState) {\r\n                    throw new Error('initState not initialized');\r\n                }\r\n                return initState;\r\n            },\r\n            () => this.klCanvas,\r\n            () => currentLayerCtx,\r\n            (ctx) => {\r\n                currentLayerCtx = ctx;\r\n            },\r\n            () => currentBrushUi,\r\n        );\r\n        klHistory.addListener((p) => {\r\n            undoRedoCatchup.catchup(p);\r\n        });\r\n\r\n        const showNewImageDialog = () => {\r\n            KL.newImageDialog({\r\n                currentColor: currentColor,\r\n                secondaryColor: this.klColorSlider.getSecondaryRGB(),\r\n                maxCanvasSize: klMaxCanvasSize,\r\n                canvasWidth: this.klCanvas.getWidth(),\r\n                canvasHeight: this.klCanvas.getHeight(),\r\n                workspaceWidth: window.innerWidth < this.collapseThreshold ? this.uiWidth : this.uiWidth - this.toolWidth,\r\n                workspaceHeight: this.uiHeight,\r\n                onConfirm: (width, height, color) => {\r\n                    this.klCanvas.reset({\r\n                        width: width,\r\n                        height: height,\r\n                        color: color.a === 1 ? color : null,\r\n                    });\r\n\r\n                    this.layerManager.update(0);\r\n                    setCurrentLayer(this.klCanvas.getLayer(0));\r\n                    this.klCanvasWorkspace.resetView();\r\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                },\r\n                onCancel: () => {},\r\n            });\r\n        };\r\n\r\n        const shareImage = (callback?: () => void) => {\r\n            BB.shareCanvas({\r\n                canvas: this.klCanvas.getCompleteCanvas(1),\r\n                fileName: BB.getDate() + filenameBase + '.png',\r\n                title: BB.getDate() + filenameBase + '.png',\r\n                callback: callback ? callback : () => {},\r\n            });\r\n        };\r\n\r\n        this.saveToComputer = new KL.SaveToComputer(\r\n            pOptions.saveReminder,\r\n            this.klRootEl,\r\n            () => exportType,\r\n            () => this.klCanvas,\r\n            filenameBase,\r\n        );\r\n\r\n        const copyToClipboard = (showCrop?: boolean) => {\r\n            KL.clipboardDialog(\r\n                this.klRootEl,\r\n                this.klCanvas.getCompleteCanvas(1),\r\n                (inputObj) => {\r\n                    if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) {\r\n                        return;\r\n                    }\r\n                    //do a crop\r\n                    KL.filterLib.cropExtend.apply({\r\n                        context: currentLayerCtx,\r\n                        klCanvas: this.klCanvas,\r\n                        input: inputObj,\r\n                        history: klHistory,\r\n                    });\r\n                    this.layerManager.update();\r\n                    this.klCanvasWorkspace.resetView();\r\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                },\r\n                this.statusOverlay,\r\n                showCrop || false,\r\n            );\r\n        };\r\n\r\n        const fileTab = this.embed ? null : new KL.FileTab(\r\n            this.klRootEl,\r\n            projectStore,\r\n            () => this.klCanvas.getProject(),\r\n            exportType,\r\n            (type) => {\r\n                exportType = type;\r\n            },\r\n            (files, optionsStr) => importHandler.handleFileSelect(files, optionsStr),\r\n            () => this.saveToComputer.save(),\r\n            showNewImageDialog,\r\n            shareImage,\r\n            () => { // on upload\r\n                KL.imgurUpload(\r\n                    this.klCanvas,\r\n                    this.klRootEl,\r\n                    pOptions.saveReminder,\r\n                    pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : null,\r\n                );\r\n            },\r\n            copyToClipboard,\r\n            pOptions.saveReminder,\r\n        );\r\n\r\n        const settingsTab = new KL.SettingsTab(\r\n            () => {\r\n                this.uiState = this.uiState === 'left' ? 'right' : 'left';\r\n                this.updateUi();\r\n                if (!this.embed) {\r\n                    LocalStorage.setItem('uiState', this.uiState);\r\n                }\r\n            },\r\n            pOptions.aboutEl\r\n        );\r\n\r\n        mainTabRow = new KL.TabRow({\r\n            initialId: 'draw',\r\n            tabArr: [\r\n                {\r\n                    id: 'draw',\r\n                    title: LANG('tool-brush'),\r\n                    image: toolPaintImg,\r\n                    onOpen: () => {\r\n                        if (currentBrushId === 'eraserBrush') {\r\n                            this.klColorSlider.enable(false);\r\n                        }\r\n                        BB.append(\r\n                            colorDiv,\r\n                            [this.klColorSlider.getElement(), this.klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n                        );\r\n                        brushDiv.style.display = 'block';\r\n                    },\r\n                    onClose: () => {\r\n                        brushDiv.style.display = 'none';\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'hand',\r\n                    title: LANG('tool-hand'),\r\n                    image: toolHandImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        handUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        handUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'fill',\r\n                    title: LANG('tool-paint-bucket'),\r\n                    image: toolFillImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        fillUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        fillUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'gradient',\r\n                    title: LANG('tool-gradient'),\r\n                    image: toolGradientImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        gradientUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        gradientUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'text',\r\n                    title: LANG('tool-text'),\r\n                    image: toolTextImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        textUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        textUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'shape',\r\n                    title: LANG('tool-shape'),\r\n                    image: toolShapeImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        shapeUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        shapeUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'layers',\r\n                    title: LANG('layers'),\r\n                    image: tabLayersImg,\r\n                    onOpen: () => {\r\n                        this.layerManager.update();\r\n                        this.layerManager.getElement().style.display = 'block';\r\n                    },\r\n                    onClose: () => {\r\n                        this.layerManager.getElement().style.display = 'none';\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'edit',\r\n                    label: LANG('tab-edit'),\r\n                    onOpen: () => {\r\n                        filterTab.show();\r\n                    },\r\n                    onClose: () => {\r\n                        filterTab.hide();\r\n                    },\r\n                    css: {\r\n                        padding: '0 7px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'file',\r\n                    label: LANG('tab-file'),\r\n                    isVisible: !!fileTab,\r\n                    onOpen: () => {\r\n                        if (!fileTab) {\r\n                            return;\r\n                        }\r\n                        fileTab.getElement().style.display = 'block';\r\n                        fileTab.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        if (!fileTab) {\r\n                            return;\r\n                        }\r\n                        fileTab.getElement().style.display = 'none';\r\n                        fileTab.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        padding: '0 7px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'settings',\r\n                    title: LANG('tab-settings'),\r\n                    image: tabSettingsImg,\r\n                    onOpen: () => {\r\n                        settingsTab.getElement().style.display = 'block';\r\n                        // settingsTab.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        settingsTab.getElement().style.display = 'none';\r\n                        // settingsTab.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n            ],\r\n        });\r\n\r\n        this.bottomBarWrapper = BB.el({\r\n            css: {\r\n                width: '270px',\r\n                position: 'absolute',\r\n                bottom: '0',\r\n                left: '0',\r\n            },\r\n        });\r\n        if (pOptions.bottomBar) {\r\n            this.bottomBar = pOptions.bottomBar;\r\n            this.bottomBarWrapper.append(this.bottomBar);\r\n            const observer = new MutationObserver(() => this.updateBottomBar());\r\n            observer.observe(\r\n                this.toolspaceInner,\r\n                {\r\n                    attributes: true,\r\n                    childList: true,\r\n                    subtree: true,\r\n                }\r\n            );\r\n        }\r\n\r\n\r\n\r\n\r\n        BB.append(this.toolspaceInner, [\r\n            this.layerPreview.getElement(),\r\n            mainTabRow.getElement(),\r\n            brushDiv,\r\n            handUi.getElement(),\r\n            fillUi.getElement(),\r\n            gradientUi.getElement(),\r\n            textUi.getElement(),\r\n            shapeUi.getElement(),\r\n            this.layerManager.getElement(),\r\n            filterTab.getElement(),\r\n            fileTab ? fileTab.getElement() : undefined,\r\n            settingsTab.getElement(),\r\n            BB.el({\r\n                css: {\r\n                    height: '10px', // a bit of spacing at the bottom\r\n                },\r\n            }),\r\n            this.bottomBarWrapper ? this.bottomBarWrapper : undefined,\r\n        ]);\r\n\r\n        this.toolspaceScroller = new KL.ToolspaceScroller({\r\n            toolspace: this.toolspace,\r\n            uiState: this.uiState,\r\n        });\r\n\r\n        if (!this.embed) {\r\n            Object.defineProperty(window, 'KL', {\r\n                value: createConsoleApi({\r\n                    onDraw: (path: IVector2D[]): void => {\r\n                        if (!path || path.length === 0) {\r\n                            return;\r\n                        }\r\n                        path.forEach((p, index) => {\r\n                            if (index === 0) {\r\n                                currentBrushUi.startLine(p.x, p.y, 1);\r\n                            } else {\r\n                                currentBrushUi.goLine(p.x, p.y, 1);\r\n                            }\r\n                        });\r\n                        currentBrushUi.endLine();\r\n                        this.klCanvasWorkspace.requestFrame();\r\n                    },\r\n                }),\r\n                writable: false,\r\n            });\r\n        }\r\n\r\n        this.resize(this.uiWidth, this.uiHeight);\r\n        this.updateUi();\r\n\r\n        const importHandler = new ImportHandler({\r\n            klRootEl: this.klRootEl,\r\n            klMaxCanvasSize,\r\n            layerManager: this.layerManager,\r\n            setCurrentLayer,\r\n            klCanvas: this.klCanvas,\r\n            klCanvasWorkspace: this.klCanvasWorkspace,\r\n            handUi,\r\n        }, {\r\n            onColor: (rgb) => brushSettingService.setColor(rgb),\r\n        });\r\n\r\n        if (!this.embed) {\r\n            new KL.KlImageDropper({\r\n                target: document.body,\r\n                onDrop: (files, optionStr) => {\r\n                    if (KL.dialogCounter.get() > 0) {\r\n                        return;\r\n                    }\r\n                    importHandler.handleFileSelect(files, optionStr);\r\n                },\r\n                enabledTest: () => {\r\n                    return KL.dialogCounter.get() === 0;\r\n                },\r\n            });\r\n\r\n            window.addEventListener('paste', (e) => importHandler.onPaste(e), false);\r\n        }\r\n\r\n        {\r\n            window.addEventListener('resize', () => {\r\n                this.resize(window.innerWidth, window.innerHeight);\r\n            });\r\n            window.addEventListener('orientationchange', () => {\r\n                this.resize(window.innerWidth, window.innerHeight);\r\n            });\r\n\r\n            // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\r\n            // Workaround: place a div in the body that fills the window, and use a ResizeObserver\r\n            const windowResizeWatcher = BB.el({\r\n                parent: document.body,\r\n                css: {\r\n                    position: 'fixed',\r\n                    left: '0',\r\n                    top: '0',\r\n                    right: '0',\r\n                    bottom: '0',\r\n                    pointerEvents: 'none',\r\n                    zIndex: '-1',\r\n                    userSelect: 'none',\r\n                },\r\n            });\r\n            try {\r\n                // Not all browsers support ResizeObserver. Not critical though.\r\n                const observer = new ResizeObserver(() => this.resize(window.innerWidth, window.innerHeight));\r\n                observer.observe(windowResizeWatcher);\r\n            } catch (e) {\r\n                windowResizeWatcher.parentNode.removeChild(windowResizeWatcher);\r\n            }\r\n\r\n            // prevent ctrl scroll -> zooming page\r\n            this.klRootEl.addEventListener('wheel', (event) => {\r\n                if (keyListener.isPressed('ctrl')) {\r\n                    event.preventDefault();\r\n                }\r\n            });\r\n            //maybe prevent zooming on safari mac os - todo still needed?\r\n            const prevent = (e) => {\r\n                e.preventDefault();\r\n            };\r\n            window.addEventListener('gesturestart', prevent);\r\n            window.addEventListener('gesturechange', prevent);\r\n            window.addEventListener('gestureend', prevent);\r\n        }\r\n    }\r\n\r\n    // -------- interface --------\r\n\r\n    getEl (): HTMLElement {\r\n        return this.klRootEl;\r\n    }\r\n\r\n    resize (w: number, h: number): void {\r\n\r\n        // iPad scrolls down when increasing text zoom\r\n        if (window.scrollY > 0) {\r\n            window.scrollTo(0, 0);\r\n        }\r\n\r\n        if (this.uiWidth === Math.max(0, w) && this.uiHeight === Math.max(0, h)) {\r\n            return;\r\n        }\r\n\r\n        this.uiWidth = Math.max(0, w);\r\n        this.uiHeight = Math.max(0, h);\r\n\r\n        this.updateCollapse();\r\n        this.updateBottomBar();\r\n\r\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\r\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\r\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\r\n    }\r\n\r\n    out (msg: string): void {\r\n        this.statusOverlay.out(msg);\r\n    }\r\n\r\n    getPNG (): Blob {\r\n        return base64ToBlob(this.klCanvas.getCompleteCanvas(1).toDataURL('image/png'));\r\n    }\r\n\r\n    getPSD = async ():  Promise<Blob> => {\r\n        return await klCanvasToPsdBlob(this.klCanvas);\r\n    };\r\n\r\n    getProject (): IKlProject {\r\n        return this.klCanvas.getProject();\r\n    }\r\n\r\n    swapUiLeftRight (): void {\r\n        this.uiState = this.uiState === 'left' ? 'right' : 'left';\r\n        if (!this.embed) {\r\n            LocalStorage.setItem('uiState', this.uiState);\r\n        }\r\n        this.updateUi();\r\n    }\r\n\r\n    saveAsPsd (): void {\r\n        this.saveToComputer.save('psd');\r\n    }\r\n\r\n    isDrawing (): boolean {\r\n        return this.lineSanitizer.getIsDrawing() || this.klCanvasWorkspace.getIsDrawing();\r\n    }\r\n}\r\n",null,"import arrayWithoutHoles from './_array_without_holes.mjs';\nimport iterableToArray from './_iterable_to_array.mjs';\nimport nonIterableSpread from './_non_iterable_spread.mjs';\nimport unsupportedIterableToArray from './_unsupported_iterable_to_array.mjs';\n\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}\n","import _arrayLikeToArray from './_array_like_to_array.mjs';\n\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n","import {DecoyKlHistory, klHistory} from './history/kl-history';\r\nimport {showModal} from './ui/modals/base/showModal';\r\nimport {DynamicModal} from './ui/modals/base/dynamic-modal';\r\nimport {dialogCounter} from './ui/modals/modal-count';\r\nimport {Checkbox} from './ui/components/checkbox';\r\nimport {input} from './ui/components/input';\r\nimport {Select} from './ui/components/select';\r\nimport {ImageToggle} from './ui/components/image-toggle';\r\nimport {ImageRadioList} from './ui/components/image-radio-list';\r\nimport {createPenPressureToggle} from './ui/components/create-pen-pressure-toggle';\r\nimport {KlSlider} from './ui/components/kl-slider';\r\nimport {calcSliderFalloffFactor} from './ui/components/slider-falloff';\r\nimport {HexColorDialog} from './ui/modals/color-slider-hex-dialog';\r\nimport {KlColorSlider} from './ui/components/kl-color-slider';\r\nimport {KlColorSliderSmall} from './ui/components/kl-color-slider-small';\r\nimport {PointSlider} from './ui/components/point-slider';\r\nimport {ColorOptions} from './ui/components/color-options';\r\nimport {Options} from './ui/components/options';\r\nimport {StatusOverlay} from './ui/components/status-overlay';\r\nimport {CropCopy} from './ui/components/crop-copy';\r\nimport {clipboardDialog} from './ui/modals/clipboard-dialog';\r\nimport {LayerManager} from './ui/tool-tabs/layer-manager/layer-manager';\r\nimport {WorkspaceSvgOverlay} from './canvas-ui/workspace-svg-overlay';\r\nimport {KlCanvasWorkspace} from './canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvasPreview} from './canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './ui/components/free-transform';\r\nimport {FreeTransformCanvas} from './ui/components/free-transform-canvas';\r\nimport {Cropper} from './ui/components/cropper';\r\nimport {LayerPreview} from './ui/components/layer-preview';\r\nimport {showImportAsLayerDialog} from './ui/modals/show-import-as-layer-dialog';\r\nimport {KlImageDropper} from './ui/components/kl-image-dropper';\r\nimport {OverlayToolspace} from './ui/components/overlay-toolspace';\r\nimport {ToolspaceTopRow} from './ui/components/toolspace-top-row';\r\nimport {ToolDropdown} from './ui/components/tool-dropdown';\r\nimport {ToolspaceToolRow} from './ui/components/toolspace-tool-row';\r\nimport {ToolspaceStabilizerRow} from './ui/components/toolspace-stabilizer-row';\r\nimport {TabRow} from './ui/components/tab-row';\r\nimport {HandUi} from './ui/tool-tabs/hand-ui';\r\nimport {FillUi} from './ui/tool-tabs/fill-ui';\r\nimport {TextUi} from './ui/tool-tabs/text-ui';\r\nimport {ShapeUi} from './ui/tool-tabs/shape-ui';\r\nimport {newImageDialog} from './ui/modals/new-image-dialog';\r\nimport {ToolspaceCollapser} from './ui/components/toolspace-collapser';\r\nimport {renderText} from './image-operations/render-text';\r\nimport {textToolDialog} from './ui/modals/text-tool-dialog';\r\nimport {showImportImageDialog} from './ui/modals/show-import-image-dialog';\r\nimport {floodFillBits} from './image-operations/flood-fill';\r\nimport * as PSD from './storage/psd';\r\nimport {drawShape, ShapeTool} from './image-operations/shape-tool';\r\nimport {KlCanvas} from './canvas/kl-canvas';\r\nimport * as indexedDb from './storage/indexed-db';\r\nimport {setDbName} from './storage/indexed-db';\r\nimport {filterLib, filterLibStatus} from './filters/filters';\r\nimport {brushes} from './brushes/brushes';\r\nimport {brushesUI} from './brushes-ui/brushes-ui';\r\nimport {showIframeModal} from './ui/modals/show-iframe-modal';\r\nimport {RadioList} from './ui/components/radio-list';\r\nimport {BrowserStorageUi} from './ui/components/browser-storage-ui';\r\nimport {drawProject} from './canvas/draw-project';\r\nimport {ProjectStore} from './storage/project-store';\r\nimport {FileTab} from './ui/tool-tabs/file-tab';\r\nimport {FilterTab} from './ui/tool-tabs/filter-tab';\r\nimport {imgurUpload} from './ui/modals/imgur-upload';\r\nimport {loadAgPsd} from './storage/ag-psd-wrapper';\r\nimport {SaveReminder} from './ui/components/save-reminder';\r\nimport {SaveToComputer} from './storage/save-to-computer';\r\nimport {UndoRedoCatchup} from './history/undo-redo-catchup';\r\nimport {BrushSettingService} from './brushes-ui/brush-setting-service';\r\nimport {BoxToggle} from './ui/components/box-toggle';\r\nimport {SettingsTab} from './ui/tool-tabs/settings-tab';\r\nimport {ToolspaceScroller} from './ui/components/toolspace-scroller';\r\nimport {GradientUi} from './ui/tool-tabs/gradient-ui';\r\nimport {drawGradient, GradientTool} from './image-operations/gradient-tool';\r\n\r\n/**\r\n * paint tool functionality\r\n */\r\nexport const KL = {\r\n\r\n    // --- brushes ---\r\n    brushes,\r\n    brushesUI,\r\n    BrushSettingService,\r\n\r\n    // --- canvas ---\r\n    KlCanvas,\r\n    drawProject,\r\n\r\n    // --- canvas ui ---\r\n    WorkspaceSvgOverlay,\r\n    KlCanvasWorkspace,\r\n    KlCanvasPreview,\r\n\r\n    // --- filters ---\r\n    filterLibStatus,\r\n    filterLib,\r\n\r\n    // --- history ---\r\n    UndoRedoCatchup,\r\n\r\n    // --- image operations ---\r\n    renderText,\r\n    floodFillBits,\r\n    ShapeTool,\r\n    drawShape,\r\n    GradientTool,\r\n    drawGradient,\r\n\r\n    // --- storage ---\r\n    PSD,\r\n    setDbName,\r\n    indexedDb,\r\n    ProjectStore,\r\n    loadAgPsd,\r\n    SaveToComputer,\r\n    \r\n    // --- ui - components ---\r\n    calcSliderFalloffFactor,\r\n    Checkbox,\r\n    input,\r\n    Select,\r\n    ImageToggle,\r\n    ImageRadioList,\r\n    RadioList,\r\n    createPenPressureToggle,\r\n    KlSlider,\r\n    HexColorDialog,\r\n    KlColorSlider,\r\n    KlColorSliderSmall,\r\n    PointSlider,\r\n    ColorOptions,\r\n    Options,\r\n    BoxToggle,\r\n    StatusOverlay,\r\n    CropCopy,\r\n    FreeTransform,\r\n    FreeTransformCanvas,\r\n    Cropper,\r\n    LayerPreview,\r\n    KlImageDropper,\r\n    OverlayToolspace,\r\n    ToolspaceTopRow,\r\n    ToolDropdown,\r\n    ToolspaceToolRow,\r\n    ToolspaceStabilizerRow,\r\n    TabRow,\r\n    ToolspaceCollapser,\r\n    BrowserStorageUi,\r\n    SaveReminder,\r\n    ToolspaceScroller,\r\n\r\n    // --- ui - modals ---\r\n    dialogCounter,\r\n    popup: showModal,\r\n    Popup: DynamicModal,\r\n    clipboardDialog,\r\n    showImportAsLayerDialog,\r\n    newImageDialog,\r\n    textToolDialog,\r\n    showImportImageDialog,\r\n    showIframePopup: showIframeModal,\r\n    imgurUpload,\r\n\r\n    // --- ui - tool tabs ---\r\n    HandUi,\r\n    FillUi,\r\n    GradientUi,\r\n    TextUi,\r\n    ShapeUi,\r\n    FileTab,\r\n    FilterTab,\r\n    SettingsTab,\r\n    LayerManager,\r\n\r\n    klHistory,\r\n    DecoyKlHistory,\r\n};","\r\n\r\n// --------- history entry types ------------------------------\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\nexport interface IHistoryAction {\r\n    action: string;\r\n    params: any[];\r\n}\r\n\r\nexport interface IHistoryEntry {\r\n    tool: string[];\r\n    action?: string;\r\n    params?: any[];\r\n    actions?: IHistoryAction[];\r\n}\r\n\r\ntype THistoryActionParams<T> = T extends (...args: infer A) => void ? A : never;\r\nexport type THistoryActions<ToolName, T> = {\r\n    [K in keyof T]: {\r\n        tool: [ToolName];\r\n        action: K;\r\n        params: THistoryActionParams<T[K]>;\r\n    }\r\n}[keyof T];\r\n\r\nexport type THistoryInnerActions<T> = {\r\n    [K in keyof T]: {\r\n        action: K;\r\n        params: THistoryActionParams<T[K]>;\r\n    }\r\n}[keyof T];\r\n\r\nexport type THistoryEntryG<Tool extends string[], Action extends string, Params extends unknown[]> = {\r\n    tool: Tool;\r\n    action: Action;\r\n    params: Params;\r\n}\r\n\r\nexport type TMiscImportImageHistoryEntry = THistoryEntryG<\r\n    ['misc'],\r\n    'importImage',\r\n    [HTMLCanvasElement, string | undefined]>;\r\n\r\nexport type TMiscFocusLayerHistoryEntry = THistoryEntryG<\r\n    ['misc'],\r\n    'focusLayer',\r\n    [number]>;\r\n\r\n// --------- classes etc ------------------------------\r\n\r\nexport interface IHistoryBroadcast {\r\n    bufferUpdate: IHistoryEntry;\r\n}\r\n\r\nlet historyInstance: boolean = false;\r\n\r\nexport type IHistoryListener = (p: IHistoryBroadcast | null) => void;\r\n\r\nexport interface KlHistoryInterface {\r\n    pause (b: boolean): void;\r\n    addListener (l: IHistoryListener): void;\r\n    push (e: IHistoryEntry): void;\r\n    undo (): IHistoryEntry[];\r\n    redo (): IHistoryEntry | undefined;\r\n    getAll (): (IHistoryEntry | null)[];\r\n    canRedo (): boolean;\r\n    canUndo (): boolean;\r\n    getState (): number;\r\n    getActionNumber (): number;\r\n}\r\n\r\nexport class DecoyKlHistory implements KlHistoryInterface {\r\n    pause (): void {}\r\n    addListener (): void {}\r\n    push (): void {}\r\n    undo (): IHistoryEntry[] { return []; }\r\n    redo (): (IHistoryEntry | undefined) { return undefined; }\r\n    getAll (): (IHistoryEntry | null)[] { return []; }\r\n    canRedo (): boolean { return false; }\r\n    canUndo (): boolean { return false; }\r\n    getState (): number { return 0; }\r\n    getActionNumber (): number { return 0; }\r\n}\r\n\r\nconst DO_DELETE_OLD = true;\r\n\r\nexport class KlHistory implements KlHistoryInterface {\r\n\r\n    private state: number; // on .push state increments by one\r\n    private readonly entries: (IHistoryEntry | null)[]; // null if beyond max undo to trigger garbage collection\r\n    private readonly listeners: IHistoryListener[];\r\n    private pauseStack: number; // how often paused without unpause\r\n    private readonly max: number = 20; // max number undo steps\r\n    private maxState: number; // can't go backwards -> max state is the buffer image(klCanvas)\r\n    private actionNumber: number; // current action the user is on. untouched document = -1 because dataArr.length is 0\r\n    \r\n    private broadcast (p: IHistoryBroadcast | null): void {\r\n        setTimeout(() => {\r\n            for (let i = 0; i < this.listeners.length; i++) {\r\n                this.listeners[i](p);\r\n            }\r\n            this.state++;\r\n        }, 1);\r\n    }\r\n    \r\n    // ---- public ----\r\n    \r\n    constructor () {\r\n        if (historyInstance) {\r\n            throw new Error('klHistory already instantiated');\r\n        }\r\n        historyInstance = true;\r\n        this.state = 0;\r\n        this.entries = [];\r\n        this.listeners = [];\r\n        this.pauseStack = 0;\r\n        this.maxState = -1;\r\n        this.actionNumber = -1;\r\n    }\r\n\r\n    /**\r\n     * Needed, because sometimes there are actions that would cause other undo steps.\r\n     * For example a filter that does something with two layers and then merges them.\r\n     * That should be a single undo step, and prevent merging from creating its own undo step.\r\n     * Pause prevents creation of unintended undo steps.\r\n     */\r\n    pause (b: boolean): void {\r\n        if (b) {\r\n            this.pauseStack++;\r\n        } else {\r\n            this.pauseStack = Math.max(0, this.pauseStack - 1);\r\n        }\r\n    }\r\n\r\n    addListener (l: IHistoryListener): void {\r\n        this.listeners.push(l);\r\n    }\r\n\r\n    push (newEntry: IHistoryEntry): void {\r\n        if (this.pauseStack > 0) {\r\n            return;\r\n        }\r\n        while (this.actionNumber < this.entries.length - 1) {\r\n            this.entries.pop();\r\n        }\r\n\r\n        //taking care of actions that shouldn't cause a new undo step\r\n        const lastEntry = this.entries[this.entries.length - 1];\r\n        if (\r\n            lastEntry && newEntry.tool[0] === 'canvas' && lastEntry.tool[0] === 'canvas' &&\r\n            newEntry.action === 'layerOpacity' && lastEntry.action === 'layerOpacity' &&\r\n            lastEntry.params[0] === newEntry.params[0]\r\n        ) {\r\n            this.entries[this.entries.length - 1] = newEntry;\r\n            this.state++; //still needs to increment because something changed\r\n            return;\r\n        }\r\n        if (newEntry.action === 'focusLayer' && lastEntry && lastEntry.action === 'focusLayer') {\r\n            this.entries[this.entries.length - 1] = newEntry;\r\n            this.state++;\r\n            return;\r\n        }\r\n\r\n        this.entries[this.entries.length] = newEntry;\r\n        this.actionNumber = this.entries.length - 1;\r\n        const maxBefore = this.maxState;\r\n        this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\r\n        if (maxBefore < this.maxState) {\r\n            const item = this.entries[this.maxState];\r\n            if (!item) {\r\n                throw new Error('this.dataArr[this.maxState] null');\r\n            }\r\n            this.broadcast({bufferUpdate: item});\r\n        } else {\r\n            this.broadcast(null);\r\n        }\r\n        if (DO_DELETE_OLD && this.maxState >= 0) {\r\n            this.entries[this.maxState] = null; //to free some memory...imported images take a lot of space\r\n        }\r\n    }\r\n\r\n    /**\r\n     * lowers action number, returns all entries that need to be executed\r\n     * on trailing snapshot to represent the canvas one undo step back.\r\n     * Empty array if can't undo\r\n     */\r\n    undo (): IHistoryEntry[] {\r\n        const result: IHistoryEntry[] = [];\r\n        if (!this.canUndo()) {\r\n            return result;\r\n        }\r\n        for (let i = this.maxState + 1; i < this.actionNumber; i++) {\r\n            result.push(throwIfNull(this.entries[i]));\r\n        }\r\n        this.actionNumber--;\r\n        this.broadcast(null);\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * raises action number, returns the action to be redone\r\n     */\r\n    redo (): (IHistoryEntry | undefined) {\r\n        if (!this.canRedo()) {\r\n            return undefined;\r\n        }\r\n        this.actionNumber++;\r\n        this.broadcast(null);\r\n        return throwIfNull(this.entries[this.actionNumber]);\r\n    }\r\n\r\n    getAll (): (IHistoryEntry | null)[] {\r\n        return [...this.entries];\r\n    }\r\n\r\n    canRedo (): boolean {\r\n        return this.actionNumber < this.entries.length - 1;\r\n    }\r\n\r\n    canUndo (): boolean {\r\n        return this.actionNumber > this.maxState;\r\n    }\r\n\r\n    getState (): number {\r\n        return this.state;\r\n    }\r\n\r\n    /**\r\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\r\n     */\r\n    getActionNumber (): number {\r\n        return (this.actionNumber + 1);\r\n    }\r\n    \r\n}\r\n\r\nexport const klHistory = new KlHistory();\r\n","import {IKeyString} from '../../../../bb/bb-types';\r\nimport {dialogCounter} from '../modal-count';\r\nimport {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport './scroll-fix';\r\nimport cancelImg from '/src/app/img/ui/cancel.svg';\r\nimport checkImg from '/src/app/img/ui/check.svg';\r\n\r\nexport function showModal (\r\n    p: {\r\n        target: HTMLElement;\r\n        div?: HTMLElement; // node with content\r\n        message: string; // can be html\r\n        callback?: (result: string) => void;\r\n        buttons?: string[]; // \"Ok\", and \"Cancel\" will be automatically translated\r\n        primaries?: string[];\r\n        type?: 'error' | 'warning' | 'upload' | 'ok'; // todo\r\n        closeFunc?: (f: () => void) => void; // returns a function you can call to close (Cancel) the dialog\r\n        style?: IKeyString;\r\n        clickOnEnter?: string; // name of button - will be clicked if enter key pressed\r\n        autoFocus?: false | string; // name of  to automatically focus - default 'Ok' - false -> none\r\n        ignoreBackground?: boolean; // deafult false; if true clicking on background doesn't close\r\n    }\r\n): void {\r\n    dialogCounter.increase();\r\n    let isClosed = false;\r\n\r\n\r\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\r\n    const rootRootEl = BB.el({\r\n        parent: document.body,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            overflow: 'hidden',\r\n        },\r\n    });\r\n    const rootEl = BB.el({\r\n        parent: rootRootEl,\r\n        className: 'kl-popup',\r\n    });\r\n\r\n    const scrollContent = BB.el({\r\n        parent: rootEl,\r\n        css: {\r\n            width: '100%',\r\n            minHeight: '100%',\r\n            // padding: '10px 0',\r\n            position: 'relative',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n        },\r\n    });\r\n\r\n    const bgEl = BB.el({\r\n        parent: scrollContent,\r\n        onClick: () => {\r\n            if (p.ignoreBackground) {\r\n                return;\r\n            }\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            zIndex: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n        },\r\n    });\r\n\r\n    const titleHeight = 40;\r\n    const xButton = BB.el({\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: () => {\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            position: 'absolute',\r\n            right: '0',\r\n            top: '0',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        },\r\n    });\r\n\r\n    const boxClasses = ['kl-popup-box'];\r\n    boxClasses.push('kl-popup-box--sm');\r\n    const boxEl = BB.el({\r\n        content: [\r\n            xButton,\r\n            BB.el({\r\n                content:p.message,\r\n                css: {\r\n                    marginBottom: p.div ? '10px' : undefined,\r\n                    marginRight: '15px',\r\n                },\r\n            }),\r\n            p.div,\r\n        ],\r\n        className: boxClasses.join(' '),\r\n        css: p.style ? p.style : undefined,\r\n    });\r\n\r\n    scrollContent.append(\r\n        BB.el({\r\n            css: {\r\n                flex: '0.5',\r\n            },\r\n        }),\r\n        boxEl,\r\n        BB.el({\r\n            css: {\r\n                flex: '1',\r\n            },\r\n        })\r\n    );\r\n\r\n    if (p.type === 'error') {\r\n        boxEl.classList.add('poperror');\r\n    }\r\n    if (p.type === 'ok') {\r\n        boxEl.classList.add('popok');\r\n    }\r\n    if (p.type === 'warning') {\r\n        boxEl.classList.add('popwarning');\r\n    }\r\n    if (p.type === 'upload') {\r\n        boxEl.classList.add('popupload');\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, e, comboStr) {\r\n            if (isClosed) {\r\n                return;\r\n            }\r\n            if (clickOnEnterBtn && comboStr === 'enter' && !BB.isInputFocused()) {\r\n                e.stopPropagation();\r\n                setTimeout(() => {\r\n                    clickOnEnterBtn && clickOnEnterBtn.click();\r\n                }, 10);\r\n            }\r\n            if (comboStr === 'esc') {\r\n                e.stopPropagation();\r\n                close('Cancel');\r\n            }\r\n        },\r\n    });\r\n    // prevent ctrl scroll -> zooming page\r\n    const wheelPrevent = (event: WheelEvent): void => {\r\n        if (keyListener.isPressed('ctrl')) {\r\n            event.preventDefault();\r\n        }\r\n    };\r\n    rootEl.addEventListener('wheel', wheelPrevent);\r\n    rootEl.onclick = BB.handleClick;\r\n\r\n    let autoFocus: string | undefined;\r\n    if (p.autoFocus) {\r\n        autoFocus = p.autoFocus;\r\n    } else if (p.autoFocus === false) {\r\n        autoFocus = undefined;\r\n    } else {\r\n        autoFocus = 'Ok';\r\n    }\r\n\r\n    const buttonRowEl = p.buttons && p.buttons.length > 0 ? BB.el({\r\n        parent: boxEl,\r\n        css: {\r\n            display: 'flex',\r\n            flexWrap: 'wrap',\r\n            justifyContent: 'flex-end',\r\n            marginTop: '12px', // 8px already via buttons\r\n            marginLeft: '-8px',\r\n        },\r\n    }) : null;\r\n    let clickOnEnterBtn: HTMLButtonElement | undefined;\r\n    const btnElArr: HTMLButtonElement[] = [];\r\n    if (p.buttons) {\r\n        p.buttons.forEach(buttonName => {\r\n            const btnClasses = ['kl-popup__btn'];\r\n            if (buttonName === 'Ok' || (p.primaries && p.primaries.includes(buttonName))) {\r\n                btnClasses.push('kl-button-primary');\r\n            }\r\n            let iconUrl;\r\n            let label = buttonName;\r\n            if (buttonName === 'Ok') {\r\n                label = LANG('modal-ok');\r\n                iconUrl = checkImg;\r\n            }\r\n            if (buttonName === 'Cancel') {\r\n                label = LANG('modal-cancel');\r\n                iconUrl = cancelImg;\r\n                btnClasses.push('kl-button-cancel');\r\n            }\r\n            let iconImg = null;\r\n            if (iconUrl) {\r\n                iconImg = BB.el({\r\n                    tagName: 'img',\r\n                    custom: {\r\n                        src: iconUrl,\r\n                        height: '17',\r\n                    },\r\n                });\r\n            }\r\n            const btn = BB.el({\r\n                parent: buttonRowEl || undefined,\r\n                tagName: 'button',\r\n                className: btnClasses.join(' '),\r\n                content: [\r\n                    iconImg || undefined,\r\n                    BB.el({\r\n                        className: 'kl-popup__btn__text',\r\n                        content: label,\r\n                    }),\r\n                ],\r\n                onClick: () => {\r\n                    close(buttonName);\r\n                },\r\n            }) as HTMLButtonElement;\r\n            btnElArr.push(btn);\r\n            if (autoFocus === buttonName) {\r\n                setTimeout(() => {\r\n                    btn.focus();\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 10);\r\n                setTimeout(() => {\r\n                    // safari needs a separate timeout\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 20);\r\n            }\r\n            if (buttonName === p.clickOnEnter) {\r\n                clickOnEnterBtn = btn;\r\n            }\r\n        });\r\n    }\r\n\r\n    function close (value: string) {\r\n        if (isClosed) {\r\n            return;\r\n        }\r\n\r\n        isClosed = true;\r\n        BB.clearSelection();\r\n        BB.unfocusAnyInput();\r\n        document.body.removeChild(rootRootEl);\r\n        dialogCounter.decrease();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        keyListener.destroy();\r\n        rootEl.removeEventListener('wheel', wheelPrevent);\r\n        rootEl.onclick = null;\r\n        btnElArr.forEach(item => BB.destroyEl(item));\r\n        btnElArr.splice(0, btnElArr.length);\r\n\r\n        if (p.callback) {\r\n            p.callback(value);\r\n        }\r\n    }\r\n\r\n    if (p.closeFunc) {\r\n        p.closeFunc(function () {\r\n            close('Cancel');\r\n        });\r\n    }\r\n\r\n}","\r\n// not the best\r\n\r\n/**\r\n * how many modals are open\r\n */\r\n\r\nexport class DialogCounter {\r\n    private listeners: ((v: number) => void)[] = [];\r\n    private count = 0;\r\n\r\n    private emit (): void {\r\n        this.listeners.forEach(item => {\r\n            item(this.count);\r\n        });\r\n    }\r\n\r\n    increase (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count += v;\r\n        } else {\r\n            this.count++;\r\n        }\r\n        this.emit();\r\n    }\r\n    decrease (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count -= v;\r\n        } else {\r\n            this.count--;\r\n        }\r\n        this.emit();\r\n    }\r\n    get (): number {\r\n        return this.count;\r\n    }\r\n    subscribe (listener: (v: number) => void): void {\r\n        this.listeners.push(listener);\r\n    }\r\n}\r\n\r\nexport const dialogCounter = new DialogCounter();\r\n","import {\r\n    append,\r\n    centerWithin,\r\n    copyObj,\r\n    createSvg,\r\n    css,\r\n    dateDayDifference,\r\n    decToFraction,\r\n    fitInto,\r\n    gcd,\r\n    getDate,\r\n    handleClick,\r\n    imageBlobToUrl,\r\n    insertAfter, isDark,\r\n    loadImage,\r\n    reduce,\r\n    setAttributes,\r\n    shareCanvas,\r\n    throwIfNull,\r\n} from './base/base';\r\nimport {\r\n    canShareFiles,\r\n    eventUsesHighResTimeStamp,\r\n    hasPointerEvents,\r\n    hasWebGl,\r\n    isCssMinMaxSupported,\r\n} from './base/browser';\r\nimport {KeyListener, sameKeys} from './input/key-listener';\r\nimport {PointerListener} from './input/pointer-listener';\r\nimport {\r\n    canvasBounds,\r\n    convertToAlphaChannelCanvas,\r\n    copyCanvas,\r\n    createCheckerCanvas,\r\n    createCheckerDataUrl,\r\n    ctx,\r\n    drawTransformedImageOnCanvas,\r\n    drawTransformedImageWithBounds,\r\n    freeCanvas,\r\n    resizeCanvas,\r\n    testShouldPixelate,\r\n} from './base/canvas';\r\nimport {Matrix} from './math/matrix';\r\nimport {Vec2} from './math/vec2';\r\nimport {BezierLine, PointLine, projectPointOnLine, quadraticSplineInput, SplineInterpolator} from './math/line';\r\nimport {CMYK, ColorConverter, HSV, RGB, testIsWhiteBestContrast} from './color/color';\r\nimport {\r\n    appendTextDiv,\r\n    clearSelection,\r\n    destroyEl,\r\n    el,\r\n    isInputFocused,\r\n    makeUnfocusable,\r\n    unfocusAnyInput,\r\n} from './base/ui';\r\nimport {\r\n    boundsInArea,\r\n    clamp,\r\n    dist,\r\n    distSquared,\r\n    intDxy,\r\n    isInsideRect,\r\n    lenSquared,\r\n    mix,\r\n    pointsToAngleDeg,\r\n    pointsToAngleRad,\r\n    rotate,\r\n    rotateAround,\r\n    round,\r\n    roundEven,\r\n    roundUneven,\r\n    updateBounds,\r\n} from './math/math';\r\nimport {createCanvas} from './base/create-canvas';\r\nimport {BbLog} from './base/bb-log';\r\nimport {LocalStorage} from './base/local-storage';\r\nimport {CoalescedExploder} from './input/event-chain/coalesced-exploder';\r\nimport {NFingerTapper} from './input/event-chain/n-finger-tapper';\r\nimport {PinchZoomer} from './input/event-chain/pinch-zoomer';\r\nimport {DoubleTapper} from './input/event-chain/double-tapper';\r\nimport {OnePointerLimiter} from './input/event-chain/one-pointer-limiter';\r\nimport {EventChain} from './input/event-chain/event-chain';\r\n\r\nexport const BB = {\r\n\r\n    // ---- browser ----\r\n    eventUsesHighResTimeStamp,\r\n    hasPointerEvents,\r\n    hasWebGl,\r\n    isCssMinMaxSupported,\r\n    canShareFiles,\r\n\r\n    // ---- base ----\r\n    insertAfter,\r\n    loadImage,\r\n    css,\r\n    setAttributes,\r\n    append,\r\n    fitInto,\r\n    centerWithin,\r\n    getDate,\r\n    gcd,\r\n    reduce,\r\n    decToFraction,\r\n    imageBlobToUrl,\r\n    dateDayDifference,\r\n    copyObj,\r\n    shareCanvas,\r\n    handleClick,\r\n    createSvg,\r\n    BbLog,\r\n    LocalStorage,\r\n    throwIfNull,\r\n    isDark,\r\n\r\n    // ---- math ----\r\n    mix,\r\n    dist,\r\n    distSquared,\r\n    lenSquared,\r\n    pointsToAngleRad,\r\n    pointsToAngleDeg,\r\n    isInsideRect,\r\n    clamp,\r\n    rotate,\r\n    rotateAround,\r\n    Matrix,\r\n    Vec2,\r\n    intDxy,\r\n    roundEven,\r\n    roundUneven,\r\n    round,\r\n    updateBounds,\r\n    boundsInArea,\r\n\r\n    // ---- line ----\r\n    projectPointOnLine,\r\n    PointLine,\r\n    BezierLine,\r\n    SplineInterpolator,\r\n    quadraticSplineInput,\r\n\r\n    // ---- canvas ----\r\n    canvas: createCanvas,\r\n    ctx,\r\n    copyCanvas,\r\n    testShouldPixelate,\r\n    drawTransformedImageWithBounds,\r\n    drawTransformedImageOnCanvas,\r\n    createCheckerCanvas,\r\n    createCheckerDataUrl,\r\n    resizeCanvas,\r\n    convertToAlphaChannelCanvas,\r\n    freeCanvas,\r\n    canvasBounds,\r\n\r\n    // ---- color ----\r\n    HSV,\r\n    RGB,\r\n    CMYK,\r\n    ColorConverter,\r\n    testIsWhiteBestContrast,\r\n\r\n    // ---- UI ----\r\n    appendTextDiv,\r\n    clearSelection,\r\n    makeUnfocusable,\r\n    el,\r\n    destroyEl,\r\n    isInputFocused,\r\n    unfocusAnyInput,\r\n\r\n\r\n    // ---- events / input ----\r\n\r\n    KeyListener,\r\n    PointerListener,\r\n    sameKeys,\r\n\r\n    EventChain,\r\n    DoubleTapper,\r\n    NFingerTapper,\r\n    PinchZoomer,\r\n    CoalescedExploder,\r\n    OnePointerLimiter,\r\n};\r\n","import {createCanvas} from './create-canvas';\r\n\r\nexport const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\r\n\r\nexport const eventUsesHighResTimeStamp = (function () {\r\n    const eventUsesHighResTimeStamp: boolean = new Event('').timeStamp < 1000 * 60 * 60;\r\n    return function (): boolean {\r\n        return eventUsesHighResTimeStamp;\r\n    };\r\n})();\r\n\r\nexport const hasPointerEvents = !!window.PointerEvent;\r\n\r\nexport const hasWebGl = (function () {\r\n\r\n    const hasWebgl = (function () {\r\n        const canvas = createCanvas();\r\n        try {\r\n            canvas.getContext('experimental-webgl', { premultipliedAlpha: false });\r\n            return true;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    })();\r\n\r\n    return function () {\r\n        return hasWebgl;\r\n    };\r\n})();\r\n\r\nexport const isCssMinMaxSupported = (function () {\r\n    let result: boolean | null = null;\r\n\r\n    function test () {\r\n        const div = document.createElement('div');\r\n        div.style.position = 'absolute';\r\n        div.style.top = '0';\r\n        div.style.left = 'max(0px, 25px)';\r\n        document.body.append(div);\r\n        setTimeout(function () {\r\n            result = div.offsetLeft === 25;\r\n            document.body.removeChild(div);\r\n        }, 25);\r\n    }\r\n\r\n    if (document.body) {\r\n        test();\r\n    } else {\r\n        window.addEventListener('DOMContentLoaded', function () {\r\n            test();\r\n        });\r\n    }\r\n\r\n    return function (): boolean {\r\n        if (result === null) {\r\n            throw new Error('isCssMinMaxSupported not initialized');\r\n        }\r\n        return result;\r\n    };\r\n})();\r\n\r\nexport const canShareFiles = function (): boolean {\r\n    return 'share' in navigator && 'canShare' in navigator;\r\n};","/*window['canvases'] = [];\r\n\r\nwindow['printCanvases'] = () => {\r\n    let total = 0;\r\n\r\n    console.log(window['canvases'].map(item => {\r\n        total += item.width * item.height;\r\n        return {w: item.width, h: item.height};\r\n    }));\r\n\r\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\r\n};*/\r\n\r\nexport function createCanvas (w?: number, h?: number): HTMLCanvasElement {\r\n    const result = document.createElement('canvas');\r\n    if (w && h) {\r\n        result.width = w;\r\n        result.height = h;\r\n    }\r\n    // window['canvases'].push(result);\r\n    return result;\r\n}","import {IKeyString} from '../bb-types';\r\n\r\ntype TGlobalKey = {\r\n    add: (keyListenerRef: TKeyListenerRef) => void;\r\n    remove: (keyListenerRef: TKeyListenerRef) => void;\r\n    getIsDown: () => TIsDown;\r\n    getCombo: () => string[];\r\n}\r\n\r\ntype TIsDown = {\r\n    [key: string]: boolean;\r\n};\r\n\r\ntype TOnDown = (keyStr: string, e: KeyboardEvent, comboStr: string, isRepeat?: boolean) => void;\r\ntype TOnUp = (keyStr: string, e: KeyboardEvent, oldComboStr: string) => void;\r\ntype TOnBlur = () => void;\r\ntype TKeyListenerRef = [\r\n    TOnDown | undefined,\r\n    TOnUp | undefined,\r\n    TOnBlur | undefined,\r\n];\r\n\r\n\r\nconst globalKey = ((): TGlobalKey => {\r\n\r\n    // keyStr - our key naming system\r\n    // key - KeyboardEvent.key\r\n    // code - KeyboardEvent.code\r\n\r\n    const keyStrToKeyObj = { // keyStr not to contain a '+', because that's used for the comboStr\r\n        'space': [' ', 'Spacebar'], // Spacebar in IE\r\n        'alt': ['Alt', 'AltGraph'],\r\n        'shift': 'Shift',\r\n        'ctrl': 'Control',\r\n        'cmd': ['Meta', 'MetaLeft', 'MetaRight'],\r\n        'enter': 'Enter',\r\n        'esc': 'Escape',\r\n        'backspace': 'Backspace',\r\n        'delete': 'Delete',\r\n        'sqbr_open': '[',\r\n        'sqbr_close': ']',\r\n        'a': ['a', 'A'],\r\n        'b': ['b', 'B'],\r\n        'c': ['c', 'C'],\r\n        'e': ['e', 'E'],\r\n        'f': ['f', 'F'],\r\n        'g': ['g', 'G'],\r\n        'r': ['r', 'R'], // when holding shift\r\n        's': ['s', 'S'],\r\n        't': ['t', 'T'],\r\n        'u': ['u', 'U'],\r\n        'x': ['x', 'X'],\r\n        'y': ['y', 'Y'],\r\n        'z': ['z', 'Z'],\r\n        'plus': '+',\r\n        'minus': '-',\r\n        'left': 'ArrowLeft',\r\n        'right': 'ArrowRight',\r\n        'up': 'ArrowUp',\r\n        'down': 'ArrowDown',\r\n        'home': 'Home',\r\n        'end': 'End',\r\n    };\r\n\r\n    // ['space', 'alt', ... ]\r\n    const keyStrArr = Object.keys(keyStrToKeyObj);\r\n\r\n    // { space: false, ... }\r\n    const isDownObj: TIsDown = Object.entries(keyStrToKeyObj).reduce((acc, [key]) => {\r\n        acc[key] = false;\r\n        return acc;\r\n    }, {} as TIsDown);\r\n\r\n    // event.key to keyStr\r\n    // { ArrowLeft: 'left', ... }\r\n    const keyToKeyStrObj = Object.entries(keyStrToKeyObj).reduce((acc, [key, code]) => {\r\n        if (typeof code === 'string') {\r\n            acc[code] = key;\r\n        } else {\r\n            code.forEach(item => {\r\n                acc[item] = key;\r\n            });\r\n        }\r\n        return acc;\r\n    }, {} as IKeyString);\r\n\r\n    let comboArr: string[] = [];\r\n\r\n    // a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\r\n    // { KeyE: 'e', KeyF: undefined } - undefined - not down, string - the associated keyStr\r\n    let codeIsDownObj: {\r\n        [key: string]: string | undefined;\r\n    } = {};\r\n    const listenerArr: TKeyListenerRef[] = [];\r\n\r\n\r\n    const emitDown: TOnDown = function (a, b, c, d?): void {\r\n        listenerArr.forEach(item => {\r\n            if (!item[0]) {\r\n                return;\r\n            }\r\n            item[0](a, b, c, d);\r\n        });\r\n    };\r\n\r\n    const emitUp: TOnUp = function (a, b, c): void {\r\n        listenerArr.forEach(item => {\r\n            if (!item[1]) {\r\n                return;\r\n            }\r\n            item[1](a, b, c);\r\n        });\r\n    };\r\n\r\n    const emitBlur: TOnBlur = function (): void {\r\n        listenerArr.forEach(item => {\r\n            if (!item[2]) {\r\n                return;\r\n            }\r\n            item[2]();\r\n        });\r\n    };\r\n\r\n    function keyDown (e: KeyboardEvent): void {\r\n        const key = e.key;\r\n        const code = e.code;\r\n\r\n        if (key in keyToKeyStrObj) {\r\n            const keyStr = keyToKeyStrObj[key];\r\n            if (isDownObj[keyStr]) {\r\n                emitDown(keyStr, e, comboArr.join('+'), true);\r\n                return;\r\n            }\r\n            isDownObj[keyStr] = true;\r\n            codeIsDownObj[code] = keyStr;\r\n\r\n            //add to combo\r\n            comboArr.push(keyStr);\r\n\r\n            emitDown(keyStr, e, comboArr.join('+'));\r\n        }\r\n    }\r\n\r\n\r\n    function keyUp (e: KeyboardEvent): void {\r\n        const code = e.code;\r\n        const oldComboStr = comboArr.join('+');\r\n\r\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\r\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\r\n        if ([\r\n            'Meta', 'MetaLeft', 'MetaRight',\r\n            'OSLeft', 'OSRight', // Firefox\r\n        ].includes(code)) {\r\n            blur();\r\n            return;\r\n        }\r\n\r\n        const keyStr = codeIsDownObj[code];\r\n        if (keyStr !== undefined) {\r\n            isDownObj[keyStr] = false;\r\n            codeIsDownObj[code] = undefined;\r\n\r\n            // remove from combo\r\n            for (let i = 0; i < comboArr.length; i++) {\r\n                if (comboArr[i] == keyStr) {\r\n                    comboArr.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n\r\n            emitUp(keyStr, e, oldComboStr);\r\n        }\r\n    }\r\n\r\n    function blur (): void {\r\n        const oldComboStr = comboArr.join('+');\r\n        comboArr = [];\r\n        codeIsDownObj = {};\r\n\r\n        const eventArr: string[] = [];\r\n        keyStrArr.forEach(keyStr => {\r\n            if (isDownObj[keyStr]) {\r\n                isDownObj[keyStr] = false;\r\n                eventArr.push(keyStr);\r\n            }\r\n        });\r\n        for (let i = 0; i < eventArr.length; i++) {\r\n            emitUp(\r\n                eventArr[i],\r\n                {\r\n                    preventDefault: function () {},\r\n                    stopPropagation: function () {},\r\n                } as KeyboardEvent,\r\n                oldComboStr,\r\n            );\r\n        }\r\n        emitBlur();\r\n    }\r\n\r\n\r\n\r\n    return {\r\n        add: (keyListenerRef: TKeyListenerRef): void => {\r\n            if (listenerArr.includes(keyListenerRef)) {\r\n                return;\r\n            }\r\n            const first = listenerArr.length === 0;\r\n            listenerArr.push(keyListenerRef);\r\n\r\n            if (first) {\r\n                document.addEventListener('keydown', keyDown);\r\n                document.addEventListener('keyup', keyUp);\r\n                window.addEventListener('blur', blur);\r\n            }\r\n        },\r\n        remove: (keyListenerRef: TKeyListenerRef): void => {\r\n            if (!listenerArr.includes(keyListenerRef)) {\r\n                return;\r\n            }\r\n            const last = listenerArr.length === 1;\r\n            for (let i = 0; i < listenerArr.length; i++) {\r\n                if (listenerArr[i] === keyListenerRef) {\r\n                    listenerArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n            if (last) {\r\n                document.removeEventListener('keydown', keyDown);\r\n                document.removeEventListener('keyup', keyUp);\r\n                window.removeEventListener('blur', blur);\r\n            }\r\n        },\r\n        getIsDown: (): TIsDown => isDownObj,\r\n        getCombo: (): string[] => comboArr,\r\n    };\r\n})();\r\n\r\n\r\n\r\n/**\r\n * Listens to key events in window. Makes combos easier - e.g. ctrl + z\r\n *\r\n * keyStr - see in implementation - my representation of a key. e.g. 'r' can be 'r' and 'R'\r\n * comboStr - string joins currently pressed keyStr with a +\r\n *              e.g. 'ctrl+z'\r\n *\r\n */\r\nexport class KeyListener {\r\n\r\n    private readonly onDown: TOnDown | undefined;\r\n    private readonly onUp: TOnUp | undefined;\r\n    private readonly onBlur: TOnBlur | undefined;\r\n    private readonly ref: TKeyListenerRef;\r\n\r\n    constructor (\r\n        p: {\r\n            onDown?: TOnDown;\r\n            onUp?: TOnUp;\r\n            onBlur?: TOnBlur;\r\n        },\r\n    ) {\r\n        this.onDown = p.onDown;\r\n        this.onUp = p.onUp;\r\n        this.onBlur = p.onBlur;\r\n        this.ref = [this.onDown, this.onUp, this.onBlur];\r\n        globalKey.add(this.ref);\r\n    }\r\n\r\n    isPressed (keyStr: string): boolean {\r\n        if (!(keyStr in globalKey.getIsDown())) {\r\n            throw 'key \"' + keyStr + '\" not found';\r\n        }\r\n        return globalKey.getIsDown()[keyStr];\r\n    }\r\n\r\n    getComboStr (): string {\r\n        return globalKey.getCombo().join('+');\r\n    }\r\n\r\n    comboOnlyContains (keyStrArr: string[]): boolean {\r\n        for (let i = 0; i < globalKey.getCombo().length; i++) {\r\n            if (!keyStrArr.includes(globalKey.getCombo()[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    destroy (): void {\r\n        globalKey.remove(this.ref);\r\n    }\r\n}\r\n\r\n/**\r\n * Test, are the same keys pressed. Order does not matter.\r\n */\r\nexport function sameKeys (comboAStr: string, comboBStr: string): boolean {\r\n    return comboAStr.split('+').sort().join('+') === comboBStr.split('+').sort().join('+');\r\n}","import {eventUsesHighResTimeStamp, hasPointerEvents, isFirefox} from '../base/browser';\r\nimport {WheelCleaner} from './wheel-cleaner';\r\nimport {IPointerEvent, IWheelEvent, TPointerButton, TPointerEventType, TPointerType} from './event.types';\r\nimport {PressureNormalizer} from './pressure-normalizer';\r\n\r\nexport interface IPointerListenerParams {\r\n    target: HTMLElement | SVGElement;\r\n    onPointer?: (pointerEvent: IPointerEvent) => void;\r\n    onWheel?: (wheelEvent: IWheelEvent) => void;\r\n    onEnterLeave?: (isOver: boolean) => void; // optional\r\n    maxPointers?: number; // int [1,n] default is 1 - how many concurrent pointers to pay attention to\r\n    fixScribble?: boolean; // fix ipad scribble issue - TODO remove, fixed start of 2022 -> https://bugs.webkit.org/show_bug.cgi?id=217430#c2\r\n}\r\n\r\ninterface IPointer {\r\n    pointerId: number;\r\n    lastPageX: number | null;\r\n    lastPageY: number | null;\r\n}\r\n\r\ninterface IDragObj {\r\n    pointerId: number; // long\r\n    pointerType?: TPointerType;\r\n    downPageX: number; //where was pointer when down-event occurred\r\n    downPageY: number;\r\n    buttons: number; // long\r\n    lastPageX: number; //pageX in previous event - only for touch events, because they don't have movementX/Y\r\n    lastPageY: number;\r\n    lastTimeStamp?: number;\r\n}\r\n\r\ninterface ICoalescedPointerEvent {\r\n    pageX: number;\r\n    pageY: number;\r\n    clientX: number;\r\n    clientY: number;\r\n    movementX: number;\r\n    movementY: number;\r\n    timeStamp: number;\r\n    pressure: number;\r\n}\r\n\r\ninterface ICorrectedPointerEvent {\r\n    pointerId: number;\r\n    pointerType: string;\r\n    pageX: number;\r\n    pageY: number;\r\n    clientX: number;\r\n    clientY: number;\r\n    movementX: number;\r\n    movementY: number;\r\n    timeStamp: number;\r\n    pressure: number; // normalized\r\n    buttons: number;\r\n    button: number;\r\n    coalescedArr: ICoalescedPointerEvent[];\r\n    eventPreventDefault: () => void;\r\n    eventStopPropagation: () => void;\r\n}\r\n\r\ninterface TExtendedDOMPointerEvent extends PointerEvent {\r\n    corrected: ICorrectedPointerEvent;\r\n}\r\n\r\n\r\n// keeping track of pointers for movement fallback\r\nconst pointerArr: IPointer[] = [];\r\n\r\nfunction addPointer (event: ICorrectedPointerEvent): IPointer {\r\n    const pointerObj: IPointer = {\r\n        pointerId: event.pointerId,\r\n        lastPageX: null,\r\n        lastPageY: null,\r\n    };\r\n    pointerArr.push(pointerObj);\r\n\r\n    if (pointerArr.length > 15) {\r\n        pointerArr.shift();\r\n    }\r\n\r\n    return pointerObj;\r\n}\r\n\r\nfunction getPointer (event: ICorrectedPointerEvent): IPointer | null {\r\n    for (let i = pointerArr.length - 1; i >= 0; i--) {\r\n        if (event.pointerId === pointerArr[i].pointerId) {\r\n            return pointerArr[i];\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction getButtonStr (buttons: number): TPointerButton | undefined {\r\n    switch (buttons) {\r\n        case 1:\r\n            return 'left';\r\n        case 2:\r\n            return 'right';\r\n        case 4:\r\n            return 'middle';\r\n        default:\r\n            return undefined;\r\n    }\r\n}\r\n\r\nconst pressureNormalizer = new PressureNormalizer();\r\nconst timeStampOffset = eventUsesHighResTimeStamp() ? 0 : -performance.timing.navigationStart;\r\n\r\n\r\nconst pointerDownEvt = hasPointerEvents ? 'pointerdown' : 'mousedown';\r\nconst pointerMoveEvt = hasPointerEvents ? 'pointermove' : 'mousemove';\r\nconst pointerUpEvt = hasPointerEvents ? 'pointerup' : 'mouseup';\r\nconst pointerCancelEvt = hasPointerEvents ? 'pointercancel' : 'mousecancel';\r\nconst pointerLeaveEvt = hasPointerEvents ? 'pointerleave' : 'mouseleave';\r\nconst pointerEnterEvt = hasPointerEvents ? 'pointerenter' : 'mouseenter';\r\n\r\n\r\n/**\r\n * More trustworthy pointer attributes. that behave the same across browsers.\r\n * returns a new object. Also attaches itself to the orig event. -> event.corrected\r\n */\r\nfunction correctPointerEvent (event: PointerEvent | TExtendedDOMPointerEvent): ICorrectedPointerEvent {\r\n    if ('corrected' in event) {\r\n        return event.corrected;\r\n    }\r\n\r\n    function determineButtons (): number {\r\n        if (event.buttons !== undefined) {\r\n            return event.buttons;\r\n        }\r\n        /*\r\n                button -> buttons\r\n        none:\tundefined -> 0\r\n        left:\t0 -> 1\r\n        middle:\t1 -> 4\r\n        right:\t2 -> 2\r\n        fourth:\t3 -> 8\r\n        fifth:\t4 -> 16\r\n         */\r\n        if (event.button !== undefined) { // old safari on mac has no buttons. remove eventually.\r\n            return [1,4,2,8,16][event.button];\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    const correctedObj: ICorrectedPointerEvent = {\r\n        pointerId: event.pointerId,\r\n        pointerType: event.pointerType,\r\n        pageX: event.pageX,\r\n        pageY: event.pageY,\r\n        clientX: event.clientX,\r\n        clientY: event.clientY,\r\n        movementX: event.movementX,\r\n        movementY: event.movementY,\r\n        timeStamp: event.timeStamp + timeStampOffset,\r\n        pressure: pressureNormalizer.normalize(event.pressure),\r\n        buttons: determineButtons(),\r\n        button: event.button,\r\n        coalescedArr: [],\r\n        eventPreventDefault: () => event.preventDefault(),\r\n        eventStopPropagation: () => event.stopPropagation(),\r\n    };\r\n    (event as TExtendedDOMPointerEvent).corrected = correctedObj;\r\n\r\n    let customPressure = null;\r\n    if ('pointerId' in event) {\r\n        if ('pressure' in event && event.buttons !== 0 && (['mouse'].includes(event.pointerType) || (event.pointerType === 'touch' && event.pressure === 0))) {\r\n            correctedObj.pressure = 1;\r\n            customPressure = 1;\r\n        }\r\n    } else {\r\n        correctedObj.pointerId = 0;\r\n        correctedObj.pointerType = 'mouse';\r\n        correctedObj.pressure = (event as PointerEvent).buttons !== 0 ? 1 : 0;\r\n        customPressure = correctedObj.pressure;\r\n    }\r\n\r\n    if (isFirefox && event.pointerType != 'mouse' && event.type === 'pointermove' && event.buttons === 0) { // once again firefox\r\n        correctedObj.buttons = 1; // todo wrong if no buttons actually pressed\r\n    }\r\n\r\n    let coalescedEventArr: PointerEvent[] = [];\r\n    if ('getCoalescedEvents' in event) {\r\n        coalescedEventArr = event.getCoalescedEvents();\r\n    }\r\n\r\n    // chrome somehow movementX not same scale as pageX. todo: only chrome?\r\n    // so make my own\r\n\r\n    const pointerObj: IPointer = getPointer(correctedObj) || addPointer(correctedObj);\r\n\r\n    const totalLastX = pointerObj.lastPageX;\r\n    const totalLastY = pointerObj.lastPageY;\r\n\r\n    for (let i = 0; i < coalescedEventArr.length; i++) {\r\n        const eventItem = coalescedEventArr[i];\r\n\r\n        correctedObj.coalescedArr.push({\r\n            pageX: eventItem.pageX,\r\n            pageY: eventItem.pageY,\r\n            clientX: eventItem.clientX,\r\n            clientY: eventItem.clientY,\r\n            movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\r\n            movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\r\n            timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : (eventItem.timeStamp + timeStampOffset), // 0 in firefox\r\n            pressure: customPressure === null ? pressureNormalizer.normalize(eventItem.pressure) : customPressure,\r\n        });\r\n\r\n        pointerObj.lastPageX = eventItem.pageX;\r\n        pointerObj.lastPageY = eventItem.pageY;\r\n    }\r\n\r\n    pointerObj.lastPageX = correctedObj.pageX;\r\n    pointerObj.lastPageY = correctedObj.pageY;\r\n    correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\r\n    correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\r\n\r\n    return correctedObj;\r\n}\r\n\r\n/**\r\n * PointerListener - for pointer events, wheel events. uses fallbacks. ideally consistent behavior across browsers.\r\n * Has some workarounds for browser specific bugs. As browsers evolve this constructor should get smaller.\r\n */\r\nexport class PointerListener {\r\n\r\n    private isDestroyed: boolean = false;\r\n\r\n    private readonly targetElement: HTMLElement | SVGElement;\r\n    private readonly onPointerCallback: undefined | ((pointerEvent: IPointerEvent) => void);\r\n    private readonly onWheelCallback: undefined | ((wheelEvent: IWheelEvent) => void);\r\n    private readonly onEnterLeaveCallback: undefined | ((isOver: boolean) => void);\r\n    private readonly maxPointers: number;\r\n    private readonly wheelCleaner: WheelCleaner;\r\n    private isOverCounter: number = 0;\r\n\r\n    // pointers that are pressing a button\r\n    private dragObjArr: IDragObj[] = [];\r\n    private dragPointerIdArr: number[] = [];\r\n\r\n    // chrome input glitch workaround\r\n    private lastPointerType: TPointerType | null = null;\r\n    private didSkip: boolean = false;\r\n\r\n    // listeners\r\n    private readonly onPointerEnter: (() => void) | undefined;\r\n    private readonly onPointerLeave: (() => void) | undefined;\r\n    private readonly onPointerMove: ((event: PointerEvent) => void) | undefined;\r\n    private readonly onPointerDown: ((event: PointerEvent, skipGlobal?: boolean) => void) | undefined;\r\n    private readonly onWheel: ((e: WheelEvent) => void) | undefined;\r\n    private readonly onTouchMoveScribbleFix: ((e: TouchEvent) => void) | undefined;\r\n    private readonly windowOnPointerMove: ((event: PointerEvent) => void) | undefined;\r\n    private readonly windowOnPointerUp: ((event: PointerEvent) => void) | undefined;\r\n    private readonly windowOnPointerLeave: ((event: PointerEvent) => void) | undefined;\r\n    // fallback pre pointer events (iOS < 13, as of 2023-02, still 4.4% of iOS users)\r\n    private readonly onTouchStart: ((e: TouchEvent) => void) | undefined;\r\n    private readonly onTouchMove: ((e: TouchEvent) => void) | undefined;\r\n    private readonly onTouchEnd: ((e: TouchEvent) => void) | undefined;\r\n    private readonly onTouchCancel: ((e: TouchEvent) => void) | undefined;\r\n\r\n\r\n    private getDragObj (pointerId: number): IDragObj | null {\r\n        for (let i = 0; i < this.dragObjArr.length; i++) {\r\n            if (pointerId === this.dragObjArr[i].pointerId) {\r\n                return this.dragObjArr[i];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private removeDragObj (pointerId: number): IDragObj | null {\r\n        let removedDragObj: IDragObj | null = null;\r\n        for (let i = 0; i < this.dragPointerIdArr.length; i++) {\r\n            if (this.dragPointerIdArr[i] === pointerId) {\r\n                removedDragObj = this.dragObjArr[i];\r\n                this.dragObjArr.splice(i, 1);\r\n                this.dragPointerIdArr.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n        return removedDragObj;\r\n    }\r\n\r\n    /**\r\n     * Creates a value for onPointer, from a pointer event handler.\r\n     */\r\n    private createPointerOutEvent (\r\n        typeStr: TPointerEventType,\r\n        correctedEvent: ICorrectedPointerEvent,\r\n        custom?: Partial<IPointerEvent>,\r\n    ): IPointerEvent {\r\n\r\n        const bounds: DOMRect = this.targetElement.getBoundingClientRect();\r\n        const result: IPointerEvent = {\r\n            type: typeStr,\r\n            pointerId: correctedEvent.pointerId,\r\n            pointerType: correctedEvent.pointerType as TPointerType,\r\n            pageX: correctedEvent.pageX,\r\n            pageY: correctedEvent.pageY,\r\n            clientX: correctedEvent.clientX,\r\n            clientY: correctedEvent.clientY,\r\n            relX: correctedEvent.clientX - bounds.left + this.targetElement.scrollLeft,\r\n            relY: correctedEvent.clientY - bounds.top + this.targetElement.scrollTop,\r\n            dX: correctedEvent.movementX,\r\n            dY: correctedEvent.movementY,\r\n            time: correctedEvent.timeStamp,\r\n            eventPreventDefault: correctedEvent.eventPreventDefault,\r\n            eventStopPropagation: correctedEvent.eventStopPropagation,\r\n            ...custom,\r\n        };\r\n\r\n        if (typeStr === 'pointermove') {\r\n            result.coalescedArr = [];\r\n            if (correctedEvent.coalescedArr.length > 1) {\r\n                let coalescedItem;\r\n                for (let i = 0; i < correctedEvent.coalescedArr.length; i++) {\r\n                    coalescedItem = correctedEvent.coalescedArr[i];\r\n                    result.coalescedArr.push({\r\n                        pageX: coalescedItem.pageX,\r\n                        pageY: coalescedItem.pageY,\r\n                        clientX: coalescedItem.clientX,\r\n                        clientY: coalescedItem.clientY,\r\n                        relX: coalescedItem.clientX - bounds.left + this.targetElement.scrollLeft,\r\n                        relY: coalescedItem.clientY - bounds.top + this.targetElement.scrollTop,\r\n                        dX: coalescedItem.movementX,\r\n                        dY: coalescedItem.movementY,\r\n                        time: coalescedItem.timeStamp,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private setupDocumentListeners () {\r\n        this.windowOnPointerMove && document.addEventListener(pointerMoveEvt, this.windowOnPointerMove);\r\n        this.windowOnPointerUp && document.addEventListener(pointerUpEvt, this.windowOnPointerUp);\r\n        this.windowOnPointerLeave && document.addEventListener(pointerCancelEvt, this.windowOnPointerLeave);\r\n        this.windowOnPointerLeave && document.addEventListener(pointerLeaveEvt, this.windowOnPointerLeave);\r\n    }\r\n\r\n    private destroyDocumentListeners () {\r\n        this.windowOnPointerMove && document.removeEventListener(pointerMoveEvt, this.windowOnPointerMove);\r\n        this.windowOnPointerUp && document.removeEventListener(pointerUpEvt, this.windowOnPointerUp);\r\n        this.windowOnPointerLeave && document.removeEventListener(pointerCancelEvt, this.windowOnPointerLeave);\r\n        this.windowOnPointerLeave && document.removeEventListener(pointerLeaveEvt, this.windowOnPointerLeave);\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (p: IPointerListenerParams) {\r\n        this.targetElement = p.target;\r\n        this.onPointerCallback = p.onPointer;\r\n        this.onWheelCallback = p.onWheel;\r\n        this.onEnterLeaveCallback = p.onEnterLeave;\r\n        this.maxPointers = Math.max(1, p.maxPointers || 1);\r\n\r\n\r\n        this.wheelCleaner = new WheelCleaner((cleanerEvent) => {\r\n            if (this.isDestroyed || !this.onWheelCallback) {\r\n                return;\r\n            }\r\n            const bounds = this.targetElement.getBoundingClientRect();\r\n            const whlEvent = {\r\n                ...cleanerEvent,\r\n                relX: cleanerEvent.clientX - bounds.left + this.targetElement.scrollLeft,\r\n                relY: cleanerEvent.clientY - bounds.top + this.targetElement.scrollTop,\r\n            };\r\n            this.onWheelCallback(whlEvent);\r\n        });\r\n\r\n        if (this.onPointerCallback) {\r\n            this.onPointerMove = (event: PointerEvent) => {\r\n                const correctedEvent = correctPointerEvent(event);\r\n\r\n                const tempLastPointerType = this.lastPointerType;\r\n                this.lastPointerType = correctedEvent.pointerType as TPointerType;\r\n\r\n                if (\r\n                    this.dragPointerIdArr.includes(correctedEvent.pointerId) ||\r\n                    this.dragPointerIdArr.length === this.maxPointers ||\r\n                    correctedEvent.pointerType === 'touch'\r\n                ) {\r\n                    this.didSkip = false;\r\n                    return;\r\n                }\r\n\r\n                // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\r\n                if (!this.didSkip && correctedEvent.pointerType === 'mouse' && tempLastPointerType === 'pen') {\r\n                    this.didSkip = true;\r\n                    return;\r\n                }\r\n                this.didSkip = false;\r\n\r\n                const outEvent = this.createPointerOutEvent('pointermove', correctedEvent);\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.onPointerDown = (event: PointerEvent, onSkipGlobal? : boolean) => {\r\n\r\n                //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' pointerdown');\r\n                if (this.dragPointerIdArr.includes(correctedEvent.pointerId) || this.dragPointerIdArr.length === this.maxPointers || ![1, 2, 4].includes(correctedEvent.buttons)) {\r\n                    //BB.throwOut('pointerdown ignored');\r\n                    return;\r\n                }\r\n\r\n                //set up global listeners\r\n                if (this.dragObjArr.length === 0 && !onSkipGlobal) {\r\n                    this.setupDocumentListeners();\r\n                }\r\n                const dragObj: IDragObj = {\r\n                    pointerId: correctedEvent.pointerId,\r\n                    pointerType: correctedEvent.pointerType as TPointerType,\r\n                    downPageX: correctedEvent.pageX,\r\n                    downPageY: correctedEvent.pageY,\r\n                    buttons: correctedEvent.buttons,\r\n                    lastPageX: correctedEvent.pageX,\r\n                    lastPageY: correctedEvent.pageY,\r\n                    lastTimeStamp: correctedEvent.timeStamp,\r\n                };\r\n                this.dragObjArr.push(dragObj);\r\n                this.dragPointerIdArr.push(correctedEvent.pointerId);\r\n\r\n                const outEvent: IPointerEvent = this.createPointerOutEvent('pointerdown', correctedEvent, {\r\n                    downPageX: correctedEvent.pageX,\r\n                    downPageY: correctedEvent.pageY,\r\n                    button: getButtonStr(correctedEvent.buttons),\r\n                    pressure: correctedEvent.pressure,\r\n                });\r\n\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.windowOnPointerMove = (event: PointerEvent) => {\r\n                //BB.throwOut('pointermove ' + event.pointerId);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\r\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) {\r\n                    return;\r\n                }\r\n\r\n                const dragObj = this.getDragObj(correctedEvent.pointerId);\r\n\r\n                if (!dragObj) {\r\n                    // todo need to handle this!\r\n                    return;\r\n                }\r\n\r\n                //if pointer changes button its pressing -> turn into pointerup\r\n                if (correctedEvent.buttons !== dragObj.buttons) {\r\n                    //pointer up\r\n\r\n                    //remove listener\r\n                    if (this.dragObjArr.length === 1) {\r\n                        this.destroyDocumentListeners();\r\n                    }\r\n                    this.removeDragObj(correctedEvent.pointerId);\r\n\r\n                    const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\r\n                        downPageX: dragObj.downPageX,\r\n                        downPageY: dragObj.downPageY,\r\n                    });\r\n                    this.onPointerCallback && this.onPointerCallback(outEvent);\r\n                    return;\r\n                }\r\n\r\n                // ipad likes to do this\r\n                if (\r\n                    correctedEvent.pointerType === 'pen' &&\r\n                    correctedEvent.pageX === dragObj.lastPageX &&\r\n                    correctedEvent.pageY === dragObj.lastPageY &&\r\n                    correctedEvent.timeStamp === dragObj.lastTimeStamp\r\n                ) {\r\n                    //ignore\r\n                    return;\r\n                }\r\n\r\n                const outEvent = this.createPointerOutEvent('pointermove', correctedEvent, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY,\r\n                    button: getButtonStr(correctedEvent.buttons),\r\n                    pressure: correctedEvent.pressure,\r\n                });\r\n\r\n                dragObj.lastPageX = correctedEvent.pageX;\r\n                dragObj.lastPageY = correctedEvent.pageY;\r\n                dragObj.lastTimeStamp = correctedEvent.timeStamp;\r\n\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.windowOnPointerUp = (event: PointerEvent) => {\r\n                //BB.throwOut('pointerup ' + event.pointerId);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\r\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) {\r\n                    return;\r\n                }\r\n\r\n                //remove listener\r\n                if (this.dragObjArr.length === 1) {\r\n                    this.destroyDocumentListeners();\r\n                }\r\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\r\n                if (!dragObj) {\r\n                    // todo need to handle this!\r\n                    return;\r\n                }\r\n\r\n                const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY,\r\n                });\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n\r\n            };\r\n\r\n            this.windowOnPointerLeave = (event: PointerEvent) => {\r\n                //BB.throwOut('pointerleave ' + event.pointerId);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\r\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) { //} || event.target !== document) {\r\n                    return;\r\n                }\r\n\r\n                //remove listener\r\n                if (this.dragObjArr.length === 1) {\r\n                    this.destroyDocumentListeners();\r\n                }\r\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\r\n                if (!dragObj) {\r\n                    // todo need to handle this!\r\n                    return;\r\n                }\r\n\r\n                const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY,\r\n                });\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.targetElement.addEventListener(pointerMoveEvt, this.onPointerMove);\r\n            this.targetElement.addEventListener(pointerDownEvt, this.onPointerDown);\r\n\r\n            if (!hasPointerEvents) {\r\n                const touchToFakePointer = (touch: Touch, touchEvent: TouchEvent, isDown: boolean) => {\r\n                    return {\r\n                        pointerId: touch.identifier,\r\n                        pointerType: 'touch',\r\n                        pageX: touch.pageX,\r\n                        pageY: touch.pageY,\r\n                        clientX: touch.clientX,\r\n                        clientY: touch.clientY,\r\n                        button: isDown ? 0 : undefined,\r\n                        buttons: isDown ? 1 : 0,\r\n                        timeStamp: touchEvent.timeStamp,\r\n                        target: touchEvent.target,\r\n                        pressure: isDown ? 1 : 0,\r\n                        preventDefault: () => touchEvent.preventDefault(),\r\n                        stopPropagation: () => touchEvent.stopPropagation(),\r\n                    };\r\n                };\r\n\r\n                const handleTouch = (e: TouchEvent, type: 'start' | 'move' | 'end' | 'cancel'): void => {\r\n                    for (let i = 0; i < e.changedTouches.length; i++) {\r\n                        const touch = e.changedTouches[i];\r\n                        const fakePointer = touchToFakePointer(touch, e, ['start', 'move'].includes(type));\r\n                        if (type === 'start') {\r\n                            this.onPointerDown(fakePointer, false);\r\n                        } else if (type === 'move') {\r\n                            this.windowOnPointerMove(fakePointer);\r\n                        } else if (type === 'end') {\r\n                            this.windowOnPointerUp(fakePointer);\r\n                        } else {\r\n                            this.windowOnPointerLeave(fakePointer);\r\n                        }\r\n                    }\r\n                };\r\n\r\n                this.onTouchStart = (e: TouchEvent): void => {\r\n                    e.preventDefault();\r\n                    handleTouch(e, 'start');\r\n                };\r\n                this.onTouchMove = (e: TouchEvent): void => {\r\n                    handleTouch(e, 'move');\r\n                };\r\n                this.onTouchEnd = (e: TouchEvent): void => {\r\n                    handleTouch(e, 'end');\r\n                };\r\n                this.onTouchCancel = (e: TouchEvent): void => {\r\n                    handleTouch(e, 'cancel');\r\n                };\r\n\r\n                this.targetElement.addEventListener('touchstart', this.onTouchStart);\r\n                this.targetElement.addEventListener('touchmove', this.onTouchMove);\r\n                this.targetElement.addEventListener('touchend', this.onTouchEnd);\r\n                this.targetElement.addEventListener('touchcancel', this.onTouchCancel);\r\n            }\r\n        }\r\n        if (this.onWheelCallback) {\r\n            this.onWheel = (e: WheelEvent) => {\r\n                this.wheelCleaner.process(e);\r\n            };\r\n            this.targetElement.addEventListener('wheel', this.onWheel);\r\n        }\r\n        if (this.onEnterLeaveCallback) {\r\n            this.onPointerEnter = () => {\r\n                this.isOverCounter++;\r\n                this.onEnterLeaveCallback && this.onEnterLeaveCallback(true);\r\n            };\r\n\r\n            this.onPointerLeave = () => {\r\n                this.isOverCounter--;\r\n                this.onEnterLeaveCallback && this.onEnterLeaveCallback(false);\r\n            };\r\n\r\n            this.targetElement.addEventListener(pointerEnterEvt, this.onPointerEnter);\r\n            this.targetElement.addEventListener(pointerLeaveEvt, this.onPointerLeave);\r\n        }\r\n\r\n        if (p.fixScribble) {\r\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\r\n            this.onTouchMoveScribbleFix = (e: TouchEvent) => e.preventDefault();\r\n            this.targetElement.addEventListener('touchmove', this.onTouchMoveScribbleFix);\r\n        }\r\n    }\r\n\r\n    destroy (): void {\r\n        if (this.isDestroyed) {\r\n            return;\r\n        }\r\n        this.isDestroyed = true;\r\n        this.onPointerEnter && this.targetElement.removeEventListener(pointerEnterEvt, this.onPointerEnter);\r\n        this.onPointerLeave && this.targetElement.removeEventListener(pointerLeaveEvt, this.onPointerLeave);\r\n        this.onPointerMove && this.targetElement.removeEventListener(pointerMoveEvt, this.onPointerMove);\r\n        this.onPointerDown && this.targetElement.removeEventListener(pointerDownEvt, this.onPointerDown);\r\n        this.onWheel && this.targetElement.removeEventListener('wheel', this.onWheel);\r\n        this.destroyDocumentListeners();\r\n        this.onTouchMoveScribbleFix && document.removeEventListener('touchmove', this.onTouchMoveScribbleFix);\r\n\r\n        this.onTouchStart && this.targetElement.removeEventListener('touchstart', this.onTouchStart);\r\n        this.onTouchMove && this.targetElement.removeEventListener('touchmove', this.onTouchMove);\r\n        this.onTouchEnd && this.targetElement.removeEventListener('touchend', this.onTouchEnd);\r\n        this.onTouchCancel && this.targetElement.removeEventListener('touchcancel', this.onTouchCancel);\r\n    }\r\n\r\n}\r\n\r\n","export interface IWheelCleanerEvent {\r\n    deltaY: number;\r\n    pageX: number;\r\n    pageY: number;\r\n    clientX: number;\r\n    clientY: number;\r\n}\r\n\r\nconst SEQUENCE_TIMEOUT_MS = 200;\r\n\r\n/**\r\n * Filters wheel events. removes swipe scrolling and pinch scrolling that trackpads do. (as best as it can)\r\n * Normalizes regular scrolls.\r\n *\r\n * Why:\r\n * - trackpad scrolling is different from old school mouse scrolling\r\n * - but there is no way to learn from the browser if it's trackpad scrolling\r\n * - browsers don't even give access to the raw swiping or pinching movement, but some abstraction on top, making the scrolling\r\n *      continue an arbitrary amount, at an arbitrary scale\r\n * - each browser does this differently. So you can't offer a consistent/controlled experience\r\n *\r\n * - also trackpads are painful to draw with. So supporting a trackpad-based workflow makes not much sense.\r\n */\r\nexport class WheelCleaner {\r\n\r\n    private readonly knownUnitArr: number[] = [100];\r\n    private sequenceLength: number = 0;\r\n    private sequenceUnit: null | number = null;\r\n    private endSequenceTimeout: undefined | ReturnType<typeof setTimeout>;\r\n    private toEmitDelta: null | number = null;\r\n    private position: null | {\r\n        pageX: number;\r\n        pageY: number;\r\n        clientX: number;\r\n        clientY: number;\r\n    } = null;\r\n\r\n\r\n    private emit (delta: number): void {\r\n        if (this.position === null || this.sequenceUnit === null) {\r\n            return;\r\n        }\r\n        this.callback({\r\n            deltaY: Math.round(delta / this.sequenceUnit),\r\n            pageX: this.position.pageX,\r\n            pageY: this.position.pageY,\r\n            clientX: this.position.clientX,\r\n            clientY: this.position.clientY,\r\n        });\r\n    }\r\n\r\n    private endSequence (): void {\r\n        if (this.toEmitDelta !== null) {\r\n            this.emit(this.toEmitDelta);\r\n            this.toEmitDelta = null;\r\n        }\r\n        if (this.sequenceUnit !== null && !(this.knownUnitArr.includes(this.sequenceUnit))) {\r\n            this.knownUnitArr.push(this.sequenceUnit);\r\n        }\r\n        this.sequenceLength = 0;\r\n        this.sequenceUnit = null;\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (private callback: (p: IWheelCleanerEvent) => void) {}\r\n\r\n    process (event: WheelEvent): void {\r\n        this.position = {\r\n            pageX: event.pageX,\r\n            pageY: event.pageY,\r\n            clientX: event.clientX,\r\n            clientY: event.clientY,\r\n        };\r\n\r\n        if (this.endSequenceTimeout) {\r\n            clearTimeout(this.endSequenceTimeout);\r\n        }\r\n        this.endSequenceTimeout = setTimeout(() => this.endSequence(), SEQUENCE_TIMEOUT_MS);\r\n\r\n        //prep delta\r\n        let delta = event.deltaY;\r\n        if ('deltaMode' in event && event.deltaMode === 1) {\r\n            delta *= 100 / 3;\r\n        }\r\n        const absDelta = Math.abs(delta);\r\n\r\n        //sequence begins\r\n        if (this.sequenceLength === 0) {\r\n            this.sequenceLength++;\r\n            if (absDelta < 50) {\r\n                //dirty - probably a swipe scroll or pinch scroll on trackpad\r\n                return;\r\n            }\r\n\r\n            this.sequenceUnit = absDelta;\r\n            if (this.knownUnitArr.includes(this.sequenceUnit)) {\r\n                //we know this unit - emit right away\r\n                this.emit(delta);\r\n            } else {\r\n                //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\r\n                this.toEmitDelta = delta;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (this.sequenceUnit === null) {\r\n            //previously determined dirty sequence\r\n            this.toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n        //sequence continues\r\n        if (absDelta === 0) {\r\n            //ignore zero scroll\r\n            return;\r\n        }\r\n        if (\r\n            absDelta === this.sequenceUnit ||\r\n            (absDelta / this.sequenceUnit) % 1 < 0.0001// a multiple\r\n        ) {\r\n            //fine\r\n        } else if ((this.sequenceUnit / absDelta) % 1 < 0.0001) {\r\n            //unit was actually a multiple - update it\r\n            this.sequenceUnit = absDelta;\r\n\r\n        } else if (absDelta !== this.sequenceUnit) {\r\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\r\n            this.sequenceUnit = null;\r\n            this.toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n\r\n        if (this.toEmitDelta !== null) {\r\n            this.emit(this.toEmitDelta);\r\n            this.toEmitDelta = null;\r\n        }\r\n        this.emit(delta);\r\n    }\r\n\r\n}\r\n","import {mix} from '../math/math';\r\n\r\n/**\r\n * different devices/browsers have different pressure curves\r\n * pressure normalize attempts to achieve similar mapping\r\n *\r\n * pressure range [0, 1]\r\n */\r\nexport class PressureNormalizer {\r\n    \r\n    private count: number = 0;\r\n    private avgPressure: number = 0; // float [0, 1]\r\n    private normalizeIsComplete: boolean = false;\r\n    private normalizeFactor: number = 1;\r\n    \r\n    // ---- public ----\r\n    normalize (pressure: number): number {\r\n        if (pressure === 0 || pressure === 1) {\r\n            return pressure;\r\n        }\r\n\r\n        if (this.count < 60) {\r\n            if (this.count === 0 || this.count === null) {\r\n                this.avgPressure = pressure;\r\n            } else {\r\n                this.avgPressure = mix(pressure, this.avgPressure, 0.95);\r\n            }\r\n            this.count++;\r\n        } else if (!this.normalizeIsComplete) {\r\n            this.normalizeIsComplete = true;\r\n            //BB.throwOut('avg pressure decision!' + this.avgPressure);\r\n            if (this.avgPressure < 0.13) { // absurd pressure needed\r\n                this.normalizeFactor = 2.3;\r\n            }\r\n        }\r\n\r\n        return Math.pow(pressure, 1 / this.normalizeFactor);\r\n    }\r\n    \r\n}","import {IBounds, IRect, IVector2D} from '../bb-types';\r\n\r\nexport function mix (a: number, b: number, f: number): number {\r\n    return a * (1 - f) + b * f;\r\n}\r\n\r\nexport function dist (ax: number, ay: number, bx: number, by: number): number {\r\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\r\n}\r\n\r\nexport function distSquared (ax: number, ay: number, bx: number, by: number): number {\r\n    // faster because no square-root\r\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\r\n}\r\n\r\nexport function lenSquared (x: number, y: number): number {\r\n    // faster because no square-root\r\n    return x * x + y * y;\r\n}\r\n\r\nexport function pointsToAngleRad (p1: IVector2D, p2: IVector2D): number {\r\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n}\r\n\r\nexport function pointsToAngleDeg (p1: IVector2D, p2: IVector2D): number {\r\n    return pointsToAngleRad(p1, p2) * 180 / Math.PI;\r\n}\r\n\r\nexport function isInsideRect (p: IVector2D, rect: IRect): boolean {\r\n    return rect.x <= p.x && p.x <= rect.x + rect.width &&\r\n        rect.y <= p.y && p.y <= rect.y + rect.height;\r\n}\r\n\r\nexport function clamp (num: number, min: number, max: number): number {\r\n    return num < min\r\n        ? min\r\n        : num > max\r\n            ? max\r\n            : num;\r\n}\r\n\r\nexport function rotate (x: number, y: number, deg: number): IVector2D {\r\n    const theta = deg * (Math.PI / 180);\r\n    const cs = Math.cos(theta);\r\n    const sn = Math.sin(theta);\r\n\r\n    return {\r\n        x: x * cs - y * sn,\r\n        y: x * sn + y * cs,\r\n    };\r\n}\r\n\r\nexport function rotateAround (center: IVector2D, point: IVector2D, deg: number): IVector2D {\r\n    const rot = rotate(point.x - center.x, point.y - center.y, deg);\r\n    rot.x += center.x;\r\n    rot.y += center.y;\r\n    return rot;\r\n}\r\n\r\nexport function intDxy (remainder: IVector2D, fDx: number, fDy: number) {\r\n    remainder.x += fDx;\r\n    remainder.y += fDy;\r\n    const dX = Math.round(remainder.x);\r\n    const dY = Math.round(remainder.y);\r\n    remainder.x -= dX;\r\n    remainder.y -= dY;\r\n    return {\r\n        dX,\r\n        dY,\r\n    };\r\n}\r\n\r\n/**\r\n * return closest even number\r\n * @param f\r\n */\r\nexport function roundEven (f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f;\r\n        }\r\n        return f + 1;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 0) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * return closest uneven number\r\n * @param f\r\n */\r\nexport function roundUneven (f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f + 1;\r\n        }\r\n        return f;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 1) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * round number to certain precision.\r\n * round(1.2345, 2) = 1.23\r\n * round(1.2345, 0) = 0\r\n * round(123, -1) = 120\r\n *\r\n * @param f\r\n * @param digits\r\n */\r\nexport function round (f: number, digits: number): number {\r\n    const digitMult = Math.pow(10, digits);\r\n    return Math.round((f/* + Number.EPSILON*/) * digitMult) / digitMult;\r\n}\r\n\r\n/**\r\n * update target so it includes bounds\r\n * @param target\r\n * @param bounds\r\n */\r\nexport function updateBounds (target: IBounds, bounds: IBounds): IBounds {\r\n    if (!bounds) {\r\n        return target;\r\n    }\r\n    if (!target) {\r\n        target = { x1: bounds.x1, y1: bounds.y1, x2: bounds.x2, y2: bounds.y2 };\r\n    } else {\r\n        target.x1 = Math.min(target.x1, bounds.x1);\r\n        target.y1 = Math.min(target.y1, bounds.y1);\r\n        target.x2 = Math.max(target.x2, bounds.x2);\r\n        target.y2 = Math.max(target.y2, bounds.y2);\r\n    }\r\n    return target;\r\n}\r\n\r\n/**\r\n * determine overlap of bounds with width&height\r\n */\r\nexport function boundsInArea (bounds: IBounds, width: number, height: number): IBounds | null {\r\n    const x1 = Math.max(0, bounds.x1);\r\n    const y1 = Math.max(0, bounds.y1);\r\n    const x2 = Math.min(width - 1, bounds.x2);\r\n    const y2 = Math.min(height - 1, bounds.y2);\r\n    if (x1 > x2 || y1 > y2) {\r\n        return null;\r\n    }\r\n    return { x1, y1, x2, y2 };\r\n}","import {IBounds, IKeyString, IRect, TNullable} from '../bb-types';\r\nimport {createCanvas} from './create-canvas';\r\nimport {copyObj} from './base';\r\n\r\nexport function copyCanvas (canvas: HTMLCanvasElement): HTMLCanvasElement {\r\n    const resultCanvas = createCanvas(canvas.width, canvas.height);\r\n    const ctx = resultCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.drawImage(canvas, 0, 0);\r\n    return resultCanvas;\r\n}\r\n\r\nexport function ctx (canvas: HTMLCanvasElement): CanvasRenderingContext2D {\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error(\"couldn't get 2d context\");\r\n    }\r\n    return ctx;\r\n}\r\n\r\n/**\r\n * Determine if should disable imageSmoothing for transformation.\r\n * ImageSmoothing can make images blurry even when they're in the original scale and aligned with the pixelgrid.\r\n */\r\nexport function testShouldPixelate (\r\n    transform: {x: number; y: number; width:number; height: number; angleDeg: number},\r\n    scaleX: number,\r\n    scaleY: number,\r\n): boolean {\r\n    if (\r\n        ![1, -1].includes(scaleX) || ![1, -1].includes(scaleY) ||\r\n        transform.width % 1 !== 0 || transform.height % 1 !== 0 ||\r\n        Math.abs(transform.angleDeg) % 90 !== 0\r\n    ) {\r\n        return false;\r\n    }\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    const width = whSwapped ? transform.height : transform.width;\r\n    const height = whSwapped ? transform.width : transform.height;\r\n    return (\r\n            (Math.abs(width) % 2 === 0 && transform.x % 1 === 0) ||\r\n            (Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5)\r\n        ) &&\r\n        (\r\n            (Math.abs(height) % 2 === 0 && transform.y % 1 === 0) ||\r\n            (Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5)\r\n        );\r\n}\r\n\r\n\r\n/**\r\n * @param destCtx - the canvas that will be drawn on\r\n * @param transformImage - image that will be drawn on canvas\r\n * @param transform - {x, y, width, height, angle} - x and y are center of transformImage\r\n * @param bounds object - optional {x, y, width, height} - crop of transformImage in transformImage image space\r\n * @param pixelated\r\n */\r\nexport function drawTransformedImageWithBounds (\r\n    destCtx: CanvasRenderingContext2D,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transform: {x: number; y: number; width:number; height: number; angleDeg: number},\r\n    bounds?: {x: number; y: number; width: number; height: number},\r\n    pixelated?: boolean,\r\n): void {\r\n    if (!bounds) {\r\n        bounds = {\r\n            x: 0,\r\n            y: 0,\r\n            width: transformImage.width,\r\n            height: transformImage.height,\r\n        };\r\n    }\r\n\r\n    destCtx.save();\r\n    if (pixelated) {\r\n        destCtx.imageSmoothingEnabled = false;\r\n    } else {\r\n        destCtx.imageSmoothingEnabled = true;\r\n        destCtx.imageSmoothingQuality = 'high';\r\n    }\r\n\r\n    destCtx.translate(transform.x, transform.y);\r\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\r\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\r\n    destCtx.drawImage(\r\n        transformImage,\r\n        bounds.x, bounds.y, bounds.width, bounds.height,\r\n        -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\r\n\r\n    destCtx.restore();\r\n}\r\n\r\n/**\r\n * all transformations are optional\r\n * center is the point around which will be scaled and rotated\r\n *\r\n * @param baseCanvas canvas - the canvas that will be drawn on\r\n * @param transformImage image|canvas - image that will be drawn on canvas\r\n * @param transformObj {center: {x, y}, scale: {x, y}, translate: {x, y}, angleDegree}\r\n */\r\nexport function drawTransformedImageOnCanvas (\r\n    baseCanvas: HTMLCanvasElement,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transformObj: {\r\n        center: {x: number; y: number};\r\n        scale: {x: number; y: number};\r\n        translate: {x: number; y: number};\r\n        angleDegree: number;\r\n    },\r\n): void {\r\n    transformObj = copyObj(transformObj);\r\n    if (!transformObj.center) {\r\n        transformObj.center = {\r\n            x: transformImage.width / 2,\r\n            y: transformImage.height / 2,\r\n        };\r\n    }\r\n    if (!transformObj.scale) {\r\n        transformObj.scale = {\r\n            x: 1,\r\n            y: 1,\r\n        };\r\n    }\r\n    if (!transformObj.angleDegree) {\r\n        transformObj.angleDegree = 0;\r\n    }\r\n    if (!transformObj.translate) {\r\n        transformObj.translate = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n    }\r\n\r\n    const ctx = baseCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.save();\r\n    if (\r\n        Math.abs(transformObj.scale.x - 1) >  0.000001 ||\r\n        Math.abs(transformObj.scale.y - 1) > 0.000001 ||\r\n        Math.abs(transformObj.angleDegree % 90) > 0.000001\r\n    ) {\r\n        ctx.imageSmoothingEnabled = true;\r\n        ctx.imageSmoothingQuality = 'high';\r\n    } else {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n\r\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\r\n    ctx.translate(transformObj.center.x, transformObj.center.y);\r\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\r\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\r\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\r\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\r\n\r\n    ctx.restore();\r\n}\r\n\r\nexport const createCheckerCanvas = function (size: number, isDark?: boolean): HTMLCanvasElement {\r\n    const canvas = createCanvas();\r\n    let ctx;\r\n    if (size < 1) {\r\n        canvas.width = 1;\r\n        canvas.height = 1;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = 'rgb(128, 128, 128)';\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    } else if (size > 200) {\r\n        canvas.width = 401;\r\n        canvas.height = 401;\r\n    } else {\r\n        canvas.width = size * 2;\r\n        canvas.height = size * 2;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = isDark ? 'rgb(90, 90, 90)' : 'rgb(255, 255, 255)';\r\n        ctx.fillRect(0, 0, size * 2, size * 2);\r\n        ctx.fillStyle = isDark ? 'rgb(63, 63, 63)': 'rgb(200, 200, 200)';\r\n        ctx.fillRect(0, 0, size, size);\r\n        ctx.fillRect(size, size, size * 2, size * 2);\r\n    }\r\n    return canvas;\r\n};\r\n\r\nexport const createCheckerDataUrl = (function () {\r\n    const cache: IKeyString = { // previously created dataUrls\r\n        '8l': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC',\r\n        '4l': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC',\r\n    };\r\n\r\n    return function (size: number, callback?: (s: string) => void, isDark?: boolean) {\r\n        const modeStr = isDark ? 'd' : 'l';\r\n\r\n        function create (size: number): string {\r\n            size = parseInt('' + size);\r\n            if (cache['' + size + modeStr]) {\r\n                return cache['' + size + modeStr];\r\n            }\r\n            const canvas = createCheckerCanvas(size, isDark);\r\n            const result = canvas.toDataURL('image/png');\r\n            cache['' + size + modeStr] = result;\r\n            return result;\r\n        }\r\n\r\n        if (callback) { //async\r\n            setTimeout(function () {\r\n                callback(create(size));\r\n            }, 1);\r\n        } else { //sync\r\n            return create(size);\r\n        }\r\n    };\r\n})();\r\n\r\n/**\r\n * smooth resize image\r\n * @param canvas canvas - will be resized (modified)\r\n * @param w\r\n * @param h\r\n * @param tmp1 canvas - optional, provide to save resources\r\n * @param tmp2 canvas - optional, provide to save resources\r\n */\r\nexport function resizeCanvas (\r\n    canvas: HTMLCanvasElement,\r\n    w: number,\r\n    h: number,\r\n    tmp1?: HTMLCanvasElement,\r\n    tmp2?: HTMLCanvasElement,\r\n): void {\r\n\r\n    //determine base 2 exponents of old and new size\r\n    function getBase2Obj (oldW: number, oldH: number, newW: number, newH: number) {\r\n        const result = {\r\n            oldWidthEx: Math.round(Math.log2(oldW)),\r\n            oldHeightEx: Math.round(Math.log2(oldH)),\r\n            newWidthEx: Math.ceil(Math.log2(newW)),\r\n            newHeightEx: Math.ceil(Math.log2(newH)),\r\n        };\r\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\r\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\r\n        return result;\r\n    }\r\n\r\n    if (!w || !h || (w === canvas.width && h === canvas.height)) {\r\n        return;\r\n    }\r\n    w = Math.max(w, 1);\r\n    h = Math.max(h, 1);\r\n    if (w <= canvas.width && h <= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp2 = !tmp2 ? createCanvas() : tmp2;\r\n\r\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\r\n\r\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\r\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\r\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\r\n        tmp1.getContext('2d')!.save();\r\n        tmp2.getContext('2d')!.save();\r\n\r\n        let ew, eh;\r\n        let buffer1 = tmp1, buffer2 = tmp2;\r\n\r\n        ew = base2.oldWidthEx;\r\n        eh = base2.oldHeightEx;\r\n\r\n        let bufferCtx = buffer2.getContext('2d')!;\r\n        bufferCtx.imageSmoothingEnabled = true;\r\n        bufferCtx.imageSmoothingQuality  = 'high';\r\n        bufferCtx.globalCompositeOperation  = 'copy';\r\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\r\n\r\n        let currentWidth = buffer2.width;\r\n        let currentHeight = buffer2.height;\r\n\r\n        //stepwise half the size\r\n        for (; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--) {\r\n            bufferCtx = buffer1.getContext('2d')!;\r\n            bufferCtx.imageSmoothingEnabled = true;\r\n            bufferCtx.imageSmoothingQuality  = 'high';\r\n            bufferCtx.globalCompositeOperation  = 'copy';\r\n\r\n            const newWidth = (ew > base2.newWidthEx) ? currentWidth / 2 : currentWidth;\r\n            const newHeight = (eh > base2.newHeightEx) ? currentHeight / 2 : currentHeight;\r\n\r\n            //buffer also needs to be properly sized, unfortunately\r\n            buffer1.width = newWidth;\r\n            buffer1.height = newHeight;\r\n\r\n            bufferCtx.drawImage(\r\n                buffer2,\r\n                0, 0,\r\n                currentWidth, currentHeight,\r\n                0, 0,\r\n                newWidth, newHeight\r\n            );\r\n            currentWidth = newWidth;\r\n            currentHeight = newHeight;\r\n\r\n            //swap\r\n            const tmp = buffer1;\r\n            buffer1 = buffer2;\r\n            buffer2 = tmp;\r\n        }\r\n\r\n        //when no longer can be halved, bring to target size\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        const canvasCtx = canvas.getContext('2d')!;\r\n        canvasCtx.save();\r\n        canvasCtx.imageSmoothingEnabled = true;\r\n        canvasCtx.imageSmoothingQuality  = 'high';\r\n        canvasCtx.drawImage(\r\n            buffer2,\r\n            0, 0,\r\n            currentWidth, currentHeight,\r\n            0, 0,\r\n            w, h\r\n        );\r\n        canvasCtx.restore();\r\n        tmp1.getContext('2d')!.restore();\r\n        tmp2.getContext('2d')!.restore();\r\n\r\n    } else if (w >= canvas.width && h >= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp1.width = w;\r\n        tmp1.height = h;\r\n        const tmp1Ctx = tmp1.getContext('2d')!;\r\n        tmp1Ctx.save();\r\n        tmp1Ctx.imageSmoothingEnabled = true;\r\n        tmp1Ctx.imageSmoothingQuality  = 'high';\r\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\r\n        tmp1Ctx.restore();\r\n\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        canvas.getContext('2d')!.drawImage(tmp1, 0, 0);\r\n\r\n    } else {\r\n        resizeCanvas(canvas, w, canvas.height, tmp1, tmp2);\r\n        resizeCanvas(canvas, w, h, tmp1, tmp2);\r\n    }\r\n}\r\n\r\n/**\r\n * puts naive greyscale version of image into alpha channel.\r\n * only writes a, doesn't write rgb\r\n * @param canvas\r\n */\r\nexport function convertToAlphaChannelCanvas (canvas: HTMLCanvasElement): void {\r\n    const imdat = canvas.getContext('2d')!.getImageData(0, 0, canvas.width, canvas.height);\r\n    for (let i = 0; i < imdat.data.length; i += 4) {\r\n        if (imdat.data[i + 3] === 0) {\r\n            continue;\r\n        }\r\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\r\n    }\r\n    canvas.getContext('2d')!.putImageData(imdat, 0, 0);\r\n}\r\n\r\n/**\r\n * Sometimes garbage collection is too slow, and canvases use up too much memory,\r\n * or there is a hard to fix memory leak.\r\n * This function manually makes the canvas use as little memory as possible.\r\n */\r\nexport function freeCanvas (canvas: HTMLCanvasElement): void {\r\n    canvas.width = 1;\r\n    canvas.height = 1;\r\n    const ctx = canvas.getContext('2d');\r\n    ctx && ctx.clearRect(0, 0, 1, 1);\r\n}\r\n\r\n/**\r\n * Determine bounding box that describes all pixels which are not fully transparent.\r\n * Returns null if empty.\r\n *\r\n * @param context\r\n */\r\nexport function canvasBounds (context: CanvasRenderingContext2D): IRect | null {\r\n    const boundsObj: {\r\n        x: number;\r\n        y: number;\r\n        width: number;\r\n        height: number;\r\n    } = { x: 0, y: 0, width: 0, height: 0 };\r\n    {\r\n        const tempBounds: TNullable<IBounds> = {\r\n            x1: null,\r\n            y1: null,\r\n            x2: null,\r\n            y2: null,\r\n        };\r\n        const imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\r\n\r\n        if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\r\n            tempBounds.x1 = 0;\r\n            tempBounds.y1 = 0;\r\n            tempBounds.x2 = context.canvas.width - 1;\r\n            tempBounds.y2 = context.canvas.height - 1;\r\n        } else {\r\n            for (let i = 3; i < imdat.data.length; i += 4) {\r\n                if (imdat.data[i] > 0 ) {\r\n                    const x = ((i - 3) / 4) %  context.canvas.width;\r\n                    const y = Math.floor((i - 3) / 4 / context.canvas.width);\r\n                    if (tempBounds.x1 === null || tempBounds.x1 > x) {\r\n                        tempBounds.x1 = x;\r\n                    }\r\n                    if (tempBounds.y1 === null) {\r\n                        tempBounds.y1 = y;\r\n                    }\r\n                    if (tempBounds.x2 === null || tempBounds.x2 < x) {\r\n                        tempBounds.x2 = x;\r\n                    }\r\n                    if (tempBounds.y2 === null || tempBounds.y2 < y) {\r\n                        tempBounds.y2 = y;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (tempBounds.x1 === null || tempBounds.y1 === null || tempBounds.x2 === null || tempBounds.y2 === null) {\r\n            return null;\r\n        }\r\n        boundsObj.x = tempBounds.x1;\r\n        boundsObj.y = tempBounds.y1;\r\n        boundsObj.width = tempBounds.x2! - tempBounds.x1 + 1;\r\n        boundsObj.height = tempBounds.y2! - tempBounds.y1 + 1;\r\n    }\r\n    return boundsObj;\r\n}","\r\n// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\r\n// not optimized\r\n\r\ntype TMatrix4x4 = [\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n];\r\n\r\ntype TVec4 = [number, number, number, number];\r\n\r\nfunction getIdentity (): TMatrix4x4 {\r\n    return [\r\n        1, 0, 0, 0,\r\n        0, 1, 0, 0,\r\n        0, 0, 1, 0,\r\n        0, 0, 0, 1,\r\n    ];\r\n}\r\n\r\n// point  matrix\r\nfunction multiplyMatrixAndPoint (matrix: TMatrix4x4, point: TVec4): TVec4 {\r\n    return [\r\n        (point[0] * matrix[0]) + (point[1] * matrix[4]) + (point[2] * matrix[8]) + (point[3] * matrix[12]), // x\r\n        (point[0] * matrix[1]) + (point[1] * matrix[5]) + (point[2] * matrix[9]) + (point[3] * matrix[13]), // y\r\n        (point[0] * matrix[2]) + (point[1] * matrix[6]) + (point[2] * matrix[10]) + (point[3] * matrix[14]), // z\r\n        (point[0] * matrix[3]) + (point[1] * matrix[7]) + (point[2] * matrix[11]) + (point[3] * matrix[15]), // w\r\n    ];\r\n}\r\n\r\n//matrixB  matrixA\r\nfunction multiplyMatrices (matrixA: TMatrix4x4, matrixB: TMatrix4x4): TMatrix4x4 {\r\n\r\n    // Slice the second matrix up into rows\r\n    const row0: TVec4 = [matrixB[0], matrixB[1], matrixB[2], matrixB[3]];\r\n    const row1: TVec4 = [matrixB[4], matrixB[5], matrixB[6], matrixB[7]];\r\n    const row2: TVec4 = [matrixB[8], matrixB[9], matrixB[10], matrixB[11]];\r\n    const row3: TVec4 = [matrixB[12], matrixB[13], matrixB[14], matrixB[15]];\r\n\r\n    // Multiply each row by matrixA\r\n    const result0 = multiplyMatrixAndPoint(matrixA, row0);\r\n    const result1 = multiplyMatrixAndPoint(matrixA, row1);\r\n    const result2 = multiplyMatrixAndPoint(matrixA, row2);\r\n    const result3 = multiplyMatrixAndPoint(matrixA, row3);\r\n\r\n    // Turn the result rows back into a single matrix\r\n    return [\r\n        result0[0], result0[1], result0[2], result0[3],\r\n        result1[0], result1[1], result1[2], result1[3],\r\n        result2[0], result2[1], result2[2], result2[3],\r\n        result3[0], result3[1], result3[2], result3[3],\r\n    ];\r\n}\r\n\r\nfunction createTranslationMatrix (x: number, y: number): TMatrix4x4 {\r\n    return [\r\n        1, 0, 0, 0,\r\n        0, 1, 0, 0,\r\n        0, 0, 1, 0,\r\n        x, y, 0, 1,\r\n    ];\r\n}\r\n\r\nfunction createRotationMatrix (angleRad: number): TMatrix4x4 {\r\n    //let angleRad = angleDeg / 360 * 2 * Math.PI;\r\n    return [\r\n        Math.cos(-angleRad), -Math.sin(-angleRad), 0, 0,\r\n        Math.sin(-angleRad), Math.cos(-angleRad), 0, 0,\r\n        0, 0, 1, 0,\r\n        0, 0, 0, 1,\r\n    ];\r\n}\r\n\r\nfunction createScaleMatrix (f: number): TMatrix4x4 {\r\n    return [\r\n        f, 0, 0, 0,\r\n        0, f, 0, 0,\r\n        0, 0, 1, 0,\r\n        0, 0, 0, 1,\r\n    ];\r\n}\r\n\r\nexport const Matrix = Object.freeze({\r\n    getIdentity,\r\n    multiplyMatrixAndPoint,\r\n    multiplyMatrices,\r\n    createTranslationMatrix,\r\n    createRotationMatrix,\r\n    createScaleMatrix,\r\n});\r\n","import {IVector2D} from '../bb-types';\r\n\r\nexport const Vec2 = {\r\n    add: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x + p2.x, y: p1.y + p2.y};\r\n    },\r\n    sub: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x - p2.x, y: p1.y - p2.y};\r\n    },\r\n    nor: function (p: IVector2D): IVector2D {\r\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n        return {x: p.x / len, y: p.y / len};\r\n    },\r\n    len: function (p: IVector2D): number {\r\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n    },\r\n    dist: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Vec2.len(Vec2.sub(p1, p2));\r\n    },\r\n    mul: function (p: IVector2D, s: number): IVector2D {\r\n        return {x: p.x * s, y: p.y * s};\r\n    },\r\n    angle: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n    },\r\n    dot: function (a: IVector2D, b: IVector2D): number {\r\n        const aArr = [a.x, a.y];\r\n        const bArr = [b.x, b.y];\r\n        return aArr.map((x, i) => aArr[i] * bArr[i]).reduce((m, n) => m + n);\r\n    },\r\n};","import {Vec2} from './vec2';\r\nimport {clamp, dist, mix, pointsToAngleDeg} from './math';\r\nimport {IVector2D} from '../bb-types';\r\nimport {copyObj} from '../base/base';\r\n\r\n/**\r\n * project p onto line\r\n * @param lineStart\r\n * @param lineEnd\r\n * @param p\r\n */\r\nexport const projectPointOnLine = function (lineStart: IVector2D, lineEnd: IVector2D, p: IVector2D): IVector2D {\r\n    let x, y;\r\n    if (lineStart.x === lineEnd.x) {\r\n        x = lineStart.x;\r\n        y = p.y;\r\n\r\n        return {\r\n            x: x,\r\n            y: y,\r\n        };\r\n    }\r\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\r\n    const b = lineStart.y - (m * lineStart.x);\r\n\r\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\r\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\r\n\r\n    return {\r\n        x: x,\r\n        y: y,\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * Operations on a line made up of points\r\n */\r\nexport class PointLine {\r\n\r\n    private readonly segmentArr: {\r\n        x: number;\r\n        y: number;\r\n        length: number; // last is 0\r\n    }[];\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            points: IVector2D[];\r\n        }\r\n    ) {\r\n        this.segmentArr = [];\r\n\r\n        for (let i = 0; i < p.points.length; i++) {\r\n            ((i) => {\r\n                let length = 0;\r\n                if (i < p.points.length - 1) {\r\n                    length = dist(p.points[i].x, p.points[i].y, p.points[i + 1].x, p.points[i + 1].y);\r\n                }\r\n                this.segmentArr[i] = {\r\n                    x: p.points[i].x,\r\n                    y: p.points[i].y,\r\n                    length: length,\r\n                };\r\n            })(i);\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    /**\r\n     * returns point when traveling *dist* along the line, > 0\r\n     * @param dist\r\n     */\r\n    getAtDist (dist: number): IVector2D {\r\n        let remainder = Math.min(this.getLength(), dist);\r\n        let i = 0;\r\n\r\n        for (; remainder > this.segmentArr[i].length && i < this.segmentArr.length - 2; i++) {\r\n            remainder -= this.segmentArr[i].length;\r\n        }\r\n\r\n        const fac = Math.min(1, Math.max(0, remainder / this.segmentArr[i].length));\r\n\r\n        return {\r\n            x: (this.segmentArr[i].x * (1 - fac) + this.segmentArr[i + 1].x * fac),\r\n            y: (this.segmentArr[i].y * (1 - fac) + this.segmentArr[i + 1].y * fac),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * total length of line\r\n     */\r\n    getLength (): number {\r\n        let result = 0;\r\n        for (let i = 0; i < this.segmentArr.length - 1; i++) {\r\n            result += this.segmentArr[i].length;\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\ntype TBezierLineCallback = (\r\n    v: {\r\n        x: number;\r\n        y: number;\r\n        t: number; // [0, 1] - how far along\r\n        angle?: number;\r\n        dAngle: number;\r\n    }\r\n) => void;\r\ntype TBezierLineControlsCallback = (\r\n    v: {\r\n        p1: IVector2D;\r\n        p2: IVector2D;\r\n        p3: IVector2D;\r\n        p4: IVector2D;\r\n    }\r\n) => void;\r\n\r\n/**\r\n * Each instance is one line made up of bezier interpolated segments.\r\n * You feed it points. It calculates control points on its own, and the resulting curve.\r\n */\r\nexport class BezierLine {\r\n\r\n    private readonly pointArr: {\r\n        x: number;\r\n        y: number;\r\n        spacing: number;\r\n        dir: IVector2D;\r\n    }[];\r\n    private lastDot: number = 0;\r\n    private lastPoint: IVector2D | undefined;\r\n    private lastCallbackPoint: IVector2D | undefined;\r\n    private lastAngle: number | undefined;\r\n    private lastSpacing: number | null = null;\r\n\r\n    /**\r\n     * creates bezier curve from control points\r\n     * @param p1 - control point 1 {x: float, y: float}\r\n     * @param p2 - control point 2 {x: float, y: float}\r\n     * @param p3 - control point 3 {x: float, y: float}\r\n     * @param p4 - control point 4 {x: float, y: float}\r\n     * @param resolution - int\r\n     * @returns bezier curve made up of points {x: float, y: float}\r\n     */\r\n    private getBezierPoints (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D, resolution: number): IVector2D[] {\r\n        const curvePoints = [];\r\n        let t;\r\n        for (let i = 0; i <= resolution; i++) {\r\n            t = i / resolution;\r\n            curvePoints[curvePoints.length] = {\r\n                x: Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x,\r\n                y: Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y,\r\n            };\r\n        }\r\n        return curvePoints;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor () {\r\n        this.pointArr = [];\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    /**\r\n     * Add new point to line. \"Drawn\" line will go until the previous point.\r\n     *\r\n     * @param x - coord of new point\r\n     * @param y\r\n     * @param spacing - space between each step\r\n     * @param callback - calls for each step\r\n     * @param controlsCallback - calls that callback with the bezier control points\r\n     */\r\n    add (\r\n        x: number,\r\n        y: number,\r\n        spacing: number,\r\n        callback?: TBezierLineCallback,\r\n        controlsCallback?: TBezierLineControlsCallback,\r\n    ): void {\r\n        if (this.lastPoint && x === this.lastPoint.x && y === this.lastPoint.y) {\r\n            return;\r\n        }\r\n        this.lastPoint = {x, y};\r\n        this.pointArr[this.pointArr.length] = {\r\n            x,\r\n            y,\r\n            spacing,\r\n        };\r\n\r\n        //calculate directions\r\n        if (this.pointArr.length === 1) {\r\n            this.lastSpacing = spacing;\r\n            return;\r\n        } else if (this.pointArr.length === 2) {\r\n            this.pointArr[0].dir = Vec2.nor(Vec2.sub(this.pointArr[1], this.pointArr[0]));\r\n            this.lastDot = spacing;\r\n            this.lastSpacing = spacing;\r\n            return;\r\n        } else {\r\n            const pointM1 = this.pointArr[this.pointArr.length - 1];\r\n            const pointM2 = this.pointArr[this.pointArr.length - 2];\r\n            const pointM3 = this.pointArr[this.pointArr.length - 3];\r\n            pointM2.dir = Vec2.nor(Vec2.sub(pointM1, pointM3));\r\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) {\r\n                //when xy -3 == -1\r\n                pointM2.dir = copyObj(pointM3.dir);\r\n            }\r\n        }\r\n\r\n        //get bezier curve\r\n        const a = this.pointArr[this.pointArr.length - 3];\r\n        const b = this.pointArr[this.pointArr.length - 2];\r\n        const p1 = a;\r\n        const p2 = Vec2.add(a, Vec2.mul(a.dir, Vec2.dist(a, b) / 4));\r\n        const p3 = Vec2.sub(b, Vec2.mul(b.dir, Vec2.dist(a, b) / 4));\r\n        const p4 = b;\r\n\r\n\r\n        let pointLine: PointLine;\r\n        if (callback) {\r\n            const curvePoints = this.getBezierPoints(p1, p2, p3, p4, 20);\r\n            pointLine = new PointLine({points: curvePoints});\r\n        } else {\r\n            pointLine = new PointLine({points: [p1, p4]});\r\n        }\r\n\r\n        //iterate over curve with spacing and callback\r\n        const len = pointLine.getLength();\r\n        let tempSpacing = mix(this.lastSpacing!, spacing, clamp(this.lastDot / len, 0, 1));\r\n        let d = this.lastDot;\r\n        for (; d <= len; d += tempSpacing) {\r\n            tempSpacing = mix(this.lastSpacing!, spacing, clamp(d / len, 0, 1));\r\n            const point = pointLine.getAtDist(d);\r\n            const angle = this.lastCallbackPoint ? pointsToAngleDeg(this.lastCallbackPoint, point) : undefined;\r\n            if (callback) {\r\n                callback({\r\n                    x: point.x,\r\n                    y: point.y,\r\n                    t: d / len,\r\n                    angle: angle,\r\n                    dAngle: this.lastCallbackPoint ? angle! - this.lastAngle! : 0,\r\n                });\r\n            }\r\n            this.lastCallbackPoint = point;\r\n            this.lastAngle = angle;\r\n        }\r\n\r\n        if (callback) {\r\n            this.lastDot = d - len;\r\n        } else {\r\n            this.lastDot = 0;\r\n            controlsCallback && controlsCallback({p1: p1, p2: p2, p3: p3, p4: p4});\r\n        }\r\n\r\n        this.lastSpacing = spacing;\r\n    }\r\n\r\n    addFinal (\r\n        spacing: number,\r\n        callback?: TBezierLineCallback,\r\n        controlsCallback?: TBezierLineControlsCallback,\r\n    ): void {\r\n        if (this.pointArr.length < 2) {\r\n            return;\r\n        }\r\n\r\n        const p1 = this.pointArr[this.pointArr.length - 2];\r\n        const p2 = this.pointArr[this.pointArr.length - 1];\r\n\r\n        const newP = Vec2.add(p2, Vec2.sub(p2, p1));\r\n\r\n        this.add(newP.x, newP.y, spacing, callback, controlsCallback);\r\n    }\r\n}\r\n\r\n/**\r\n * from SplineInterpolator.cs in the Paint.NET source code\r\n */\r\nexport class SplineInterpolator {\r\n\r\n    private readonly xa: number[];\r\n    private readonly ya: number[];\r\n    private readonly u: number[];\r\n    private readonly y2: number[];\r\n    private readonly first: number;\r\n    private readonly last: number;\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        points: [number, number][],\r\n    ) {\r\n        const n = points.length;\r\n        this.xa = [];\r\n        this.ya = [];\r\n        this.u = [];\r\n        this.y2 = [];\r\n        let i;\r\n\r\n        this.first = points[0][0];\r\n        this.last = points[points.length - 1][0];\r\n\r\n        points.sort(function (a, b) {\r\n            return a[0] - b[0];\r\n        });\r\n        for (i = 0; i < n; i++) {\r\n            this.xa.push(points[i][0]);\r\n            this.ya.push(points[i][1]);\r\n        }\r\n\r\n        this.u[0] = 0;\r\n        this.y2[0] = 0;\r\n\r\n        for (i = 1; i < n - 1; ++i) {\r\n            // This is the decomposition loop of the tridiagonal algorithm.\r\n            // y2 and u are used for temporary storage of the decomposed factors.\r\n            const wx = this.xa[i + 1] - this.xa[i - 1];\r\n            const sig = (this.xa[i] - this.xa[i - 1]) / wx;\r\n            const p = sig * this.y2[i - 1] + 2.0;\r\n\r\n            this.y2[i] = (sig - 1.0) / p;\r\n\r\n            const ddydx =\r\n                (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\r\n                (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\r\n\r\n            this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\r\n        }\r\n\r\n        this.y2[n - 1] = 0;\r\n\r\n        // This is the backsubstitution loop of the tridiagonal algorithm\r\n        for (i = n - 2; i >= 0; --i) {\r\n            this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getFirstX (): number {\r\n        return this.first;\r\n    }\r\n\r\n    getLastX (): number {\r\n        return this.last;\r\n    }\r\n\r\n    interpolate (x: number): number {\r\n        const n = this.ya.length;\r\n        let klo = 0;\r\n        let khi = n - 1;\r\n\r\n        // We will find the right place in the table by means of\r\n        // bisection. This is optimal if sequential calls to this\r\n        // routine are at random values of x. If sequential calls\r\n        // are in order, and closely spaced, one would do better\r\n        // to store previous values of klo and khi.\r\n        while (khi - klo > 1) {\r\n            const k = (khi + klo) >> 1;\r\n\r\n            if (this.xa[k] > x) {\r\n                khi = k;\r\n            } else {\r\n                klo = k;\r\n            }\r\n        }\r\n\r\n        const h = this.xa[khi] - this.xa[klo];\r\n        const a = (this.xa[khi] - x) / h;\r\n        const b = (x - this.xa[klo]) / h;\r\n\r\n        // Cubic spline polynomial is now evaluated.\r\n        return a * this.ya[klo] + b * this.ya[khi] +\r\n            ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\r\n    }\r\n\r\n    /**\r\n     * find x to y. simply by stepping through. suboptimal, so don't call often.\r\n     * searches in x 0-1 range\r\n     */\r\n    findX (y: number, resolution: number): number | null {\r\n        let x = null;\r\n        let dist = null;\r\n        for (let i = 0; i <= resolution; i++) {\r\n            const tempX = i / resolution;\r\n            const tempY = this.interpolate(tempX);\r\n            if (x === null) {\r\n                x = tempX;\r\n                dist = Math.abs(tempY - y);\r\n                continue;\r\n            }\r\n\r\n            const tempDist = Math.abs(tempY - y);\r\n\r\n            if (tempDist < dist) {\r\n                x = tempX;\r\n                dist = tempDist;\r\n            } else {\r\n                //distance increasing\r\n                break;\r\n            }\r\n        }\r\n        return x;\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * input for a spline, following curve of quadratic function x^2 [0 - 1]\r\n * returns [[0, startVal], ..., [1, endVal]]\r\n * @param startVal\r\n * @param endVal\r\n * @param stepSize\r\n */\r\nexport function quadraticSplineInput (\r\n    startVal: number,\r\n    endVal: number,\r\n    stepSize: number,\r\n): [number, number][] {\r\n    function round (v: number, dec: number): number {\r\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\r\n    }\r\n\r\n    const resultArr: [number, number][] = [];\r\n    for (let i = 0; i <= 1; i += stepSize) {\r\n        resultArr.push([round(i, 4), round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)]);\r\n    }\r\n    return resultArr;\r\n}","\r\n\r\n\r\n// based on js color conversion http://www.webtoolkit.info/\r\n\r\n\r\nexport class HSV {\r\n    h: number;\r\n    s: number;\r\n    v: number;\r\n    constructor (h: number, s: number, v: number) {\r\n        this.h = Math.max(0, Math.min(360, h));\r\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\r\n        this.v = Math.max(0, Math.min(100, v));\r\n    }\r\n}\r\n\r\nexport class RGB {\r\n    r : number;\r\n    g: number;\r\n    b: number;\r\n    constructor (r: number, g: number, b: number) {\r\n        this.r = Math.max(0, Math.min(255, r));\r\n        this.g = Math.max(0, Math.min(255, g));\r\n        this.b = Math.max(0, Math.min(255, b));\r\n    }\r\n}\r\n\r\nexport class CMYK {\r\n    c: number;\r\n    m: number;\r\n    y: number;\r\n    k: number;\r\n    constructor (c: number, m: number, y: number, k: number) {\r\n        this.c = Math.max(0, Math.min(100, c));\r\n        this.m = Math.max(0, Math.min(100, m));\r\n        this.y = Math.max(0, Math.min(100, y));\r\n        this.k = Math.max(0, Math.min(100, k));\r\n    }\r\n}\r\n\r\nexport const ColorConverter = {\r\n\r\n    _RGBtoHSV: function (RGB: RGB): HSV {\r\n        const result = new HSV(0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        const minVal = Math.min(r, g, b);\r\n        const maxVal = Math.max(r, g, b);\r\n        const delta = maxVal - minVal;\r\n\r\n        result.v = maxVal;\r\n\r\n        if (delta == 0) {\r\n            result.h = 0;\r\n            result.s = 0;\r\n        } else {\r\n            result.s = delta / maxVal;\r\n            const del_R = (((maxVal - r) / 6) + (delta / 2)) / delta;\r\n            const del_G = (((maxVal - g) / 6) + (delta / 2)) / delta;\r\n            const del_B = (((maxVal - b) / 6) + (delta / 2)) / delta;\r\n\r\n            if (r == maxVal) {\r\n                result.h = del_B - del_G;\r\n            } else if (g == maxVal) {\r\n                result.h = (1 / 3) + del_R - del_B;\r\n            } else if (b == maxVal) {\r\n                result.h = (2 / 3) + del_G - del_R;\r\n            }\r\n\r\n            if (result.h < 0) {\r\n                result.h += 1;\r\n            }\r\n            if (result.h > 1) {\r\n                result.h -= 1;\r\n            }\r\n        }\r\n\r\n        result.h = Math.round(result.h * 360);\r\n        result.s = Math.round(result.s * 100);\r\n        result.v = Math.round(result.v * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    _HSVtoRGB: function (HSV: HSV): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\r\n\r\n        const h = (HSV.h / 360) % 1;\r\n        const s = HSV.s / 100;\r\n        const v = HSV.v / 100;\r\n\r\n        if (s == 0) {\r\n            result.r = v * 255;\r\n            result.g = v * 255;\r\n            result.b = v * 255;\r\n        } else {\r\n            var_h = h * 6;\r\n            var_i = Math.floor(var_h);\r\n            var_1 = v * (1 - s);\r\n            var_2 = v * (1 - s * (var_h - var_i));\r\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\r\n\r\n            if (var_i == 0) {\r\n                var_r = v;\r\n                var_g = var_3;\r\n                var_b = var_1;\r\n            } else if (var_i == 1) {\r\n                var_r = var_2;\r\n                var_g = v;\r\n                var_b = var_1;\r\n            } else if (var_i == 2) {\r\n                var_r = var_1;\r\n                var_g = v;\r\n                var_b = var_3;\r\n            } else if (var_i == 3) {\r\n                var_r = var_1;\r\n                var_g = var_2;\r\n                var_b = v;\r\n            } else if (var_i == 4) {\r\n                var_r = var_3;\r\n                var_g = var_1;\r\n                var_b = v;\r\n            } else {\r\n                var_r = v;\r\n                var_g = var_1;\r\n                var_b = var_2;\r\n            }\r\n\r\n            result.r = var_r * 255;\r\n            result.g = var_g * 255;\r\n            result.b = var_b * 255;\r\n\r\n            result.r = Math.round(result.r);\r\n            result.g = Math.round(result.g);\r\n            result.b = Math.round(result.b);\r\n        }\r\n\r\n        return result;\r\n    },\r\n\r\n    _CMYKtoRGB: function (CMYK: CMYK): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        const c = CMYK.c / 100;\r\n        const m = CMYK.m / 100;\r\n        const y = CMYK.y / 100;\r\n        const k = CMYK.k / 100;\r\n\r\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\r\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\r\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\r\n\r\n        result.r = Math.round(result.r * 255);\r\n        result.g = Math.round(result.g * 255);\r\n        result.b = Math.round(result.b * 255);\r\n\r\n        return result;\r\n    },\r\n\r\n    _RGBtoCMYK: function (RGB: RGB): CMYK {\r\n        const result = new CMYK(0, 0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\r\n        result.c = (1 - r - result.k) / (1 - result.k);\r\n        result.m = (1 - g - result.k) / (1 - result.k);\r\n        result.y = (1 - b - result.k) / (1 - result.k);\r\n\r\n        result.c = Math.round(result.c * 100);\r\n        result.m = Math.round(result.m * 100);\r\n        result.y = Math.round(result.y * 100);\r\n        result.k = Math.round(result.k * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    toRGB: function (o: RGB | HSV | CMYK): RGB {\r\n        if (o instanceof RGB) {\r\n            return o;\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._HSVtoRGB(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._CMYKtoRGB(o);\r\n        }\r\n    },\r\n\r\n    toHSV: function (o: RGB | HSV | CMYK): HSV {\r\n        if (o instanceof HSV) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoHSV(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._RGBtoHSV(this._CMYKtoRGB(o));\r\n        }\r\n    },\r\n\r\n    toCMYK: function (o: RGB | HSV | CMYK): CMYK {\r\n        if (o instanceof CMYK) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoCMYK(o);\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._RGBtoCMYK(this._HSVtoRGB(o));\r\n        }\r\n    },\r\n    toHexString: function (o: RGB): string {\r\n        if (o instanceof RGB || ('r' in o && 'g' in o && 'b' in o)) {\r\n            let ha = (parseInt('' + o.r)).toString(16);\r\n            let hb = (parseInt('' + o.g)).toString(16);\r\n            let hc = (parseInt('' + o.b)).toString(16);\r\n            if (ha.length == 1) {\r\n                ha = '0' + ha;\r\n            }\r\n            if (hb.length == 1) {\r\n                hb = '0' + hb;\r\n            }\r\n            if (hc.length == 1) {\r\n                hc = '0' + hc;\r\n            }\r\n            return ha + hb + hc;\r\n        }\r\n    },\r\n    toRgbStr: function (rgbObj: {r: number; g: number; b: number}): string {\r\n        return 'rgb(' + Math.round(rgbObj.r) + ', ' + Math.round(rgbObj.g) + ', ' + Math.round(rgbObj.b) + ')';\r\n    },\r\n    toRgbaStr: function (rgbaObj: {r: number; g: number; b: number; a: number}): string {\r\n        return 'rgba(' + Math.round(rgbaObj.r) + ', ' + Math.round(rgbaObj.g) + ', ' + Math.round(rgbaObj.b) + ', ' + rgbaObj.a + ')';\r\n    },\r\n    hexToRGB: function (hexStr: string): RGB | null {\r\n        hexStr = hexStr.trim();\r\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\r\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n        hexStr = hexStr.replace(shorthandRegex, function (m, r, g, b) {\r\n            return r + r + g + g + b + b;\r\n        });\r\n\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\r\n        return result ? new RGB(\r\n            parseInt(result[1], 16),\r\n            parseInt(result[2], 16),\r\n            parseInt(result[3], 16)\r\n        ) : null;\r\n    },\r\n\r\n};\r\n\r\nexport function testIsWhiteBestContrast (rgbObj: {r: number; g: number; b: number}): boolean {\r\n    return (rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114) < 125;\r\n}","import {css} from './base';\r\nimport {BB} from '../bb';\r\nimport {IKeyStringOptional} from '../bb-types';\r\n\r\n\r\nexport function appendTextDiv (target: HTMLElement, text: string): HTMLDivElement {\r\n    const div = document.createElement('div');\r\n    div.innerHTML = text;\r\n    target.append(div);\r\n    return div;\r\n}\r\n\r\n/**\r\n * Is an input element focused.\r\n * Set attribute \"data-ignore-focus\" to \"true\" if its focus should be ignored.\r\n *\r\n * @param getAll - check all, even those with \"data-ignore-focus\" = \"true\"\r\n */\r\nexport function isInputFocused (getAll: boolean = false): boolean {\r\n    const result = !!(document.activeElement && ['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName));\r\n    if (getAll) {\r\n        return result;\r\n    } else {\r\n        return result && !document.activeElement?.getAttribute('data-ignore-focus');\r\n    }\r\n}\r\n\r\nexport function unfocusAnyInput (): void {\r\n    if (isInputFocused(true)) {\r\n        /*\r\n            Unfocus anything that is focused.\r\n\r\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\r\n            that isn't its direct parent, then Firefox will keep anything attached to this\r\n            Input in memory. It will not be garbage collected until a new Input is focused.\r\n\r\n            Workaround: Temporarily create an input, focus it, detach it.\r\n             */\r\n        const focusEl = BB.el({\r\n            parent: document.body,\r\n            tagName: 'input',\r\n            css: {\r\n                opacity: '0',\r\n                width: '0',\r\n                height: '0',\r\n            },\r\n        }) as HTMLInputElement;\r\n        setTimeout(() => {\r\n            focusEl.select();\r\n            focusEl.focus();\r\n            focusEl.parentNode.removeChild(focusEl);\r\n        }, 10);\r\n    }\r\n}\r\n\r\n/**\r\n * clears text selection in window\r\n */\r\nexport function clearSelection (): void {\r\n    if (window.getSelection) {\r\n        const sel = window.getSelection();\r\n        if (sel) {\r\n            if (sel.empty) {\r\n                sel.empty();\r\n            } else if (sel.removeAllRanges) {\r\n                sel.removeAllRanges();\r\n            }\r\n        }\r\n    } else if ('selection' in document) {\r\n        (document as any).selection.empty();\r\n    }\r\n}\r\n\r\n/**\r\n * prevents being able to focus element.\r\n * warning: it creates a listener\r\n *\r\n * @param el - dom element\r\n */\r\nexport const makeUnfocusable = (function () {\r\n\r\n    function preventFocus (event: MouseEvent) {\r\n        event.preventDefault();\r\n        let didFocusRelated = false;\r\n        if (event.relatedTarget) {\r\n            try {\r\n                (event.relatedTarget as HTMLElement).focus();\r\n                didFocusRelated = true;\r\n            } catch(e) {\r\n                console.error('failed to focus');\r\n            }\r\n        }\r\n        if (!didFocusRelated) {\r\n            (event.currentTarget as HTMLElement).blur();\r\n        }\r\n    }\r\n\r\n    return function (el) {\r\n        el.setAttribute('tabindex', '-1');\r\n        el.addEventListener('focus', preventFocus);\r\n    };\r\n})();\r\n\r\n\r\nconst els: {\r\n    el: HTMLElement;\r\n    listeners: [string, any][];\r\n}[] = [];\r\n// window['els'] = els;\r\n\r\n/**\r\n *\r\n * Create DOM element - div by default\r\n * params = {\r\n * \t    parent: someOtherDiv,\r\n * \t    css: {\r\n * \t\t    width: \"500px\",\r\n * \t\t    backgroundColor: \"#fff\"\r\n * \t    },\r\n * \t    content: \"test\", //or  content: [divA, divB, divC]   or content: someDiv\r\n * \t    className: \"bla\",\r\n *      id: \"bla\"\r\n * }\r\n *\r\n *  If onClick or onChange is used, then BB.destroyEl MUST be called\r\n *  to prevent a memory leak.\r\n *\r\n * @param params\r\n */\r\nexport function el (\r\n    params?: {\r\n        parent?: HTMLElement;\r\n        css?: IKeyStringOptional;\r\n        custom?: { [key: string]: any };\r\n        content?: string | (HTMLElement | string | undefined)[] | Element;\r\n        textContent?: string;\r\n        className?: string;\r\n        title?: string;\r\n        id?: string;\r\n        tagName?: string;\r\n        onClick?: (e: MouseEvent) => void;\r\n        onChange?: (e: Event) => void;\r\n    }\r\n): HTMLElement {\r\n    if (!params) {\r\n        return document.createElement('div');\r\n    }\r\n    const div = document.createElement(params.tagName ? params.tagName : 'div');\r\n    params.css && css(div, params.css);\r\n\r\n    if (params.content) {\r\n        if (typeof params.content === typeof 'aa') {\r\n            div.innerHTML = params.content as string;\r\n\r\n        } else if (Array.isArray(params.content)) {\r\n            BB.append(div, params.content);\r\n\r\n        } else {\r\n            div.append(params.content as HTMLElement);\r\n\r\n        }\r\n    }\r\n    if (params.textContent) {\r\n        div.textContent = params.textContent;\r\n    }\r\n    if (params.className) {\r\n        div.className = params.className;\r\n    }\r\n    if (params.id) {\r\n        div.id = params.id;\r\n    }\r\n    if (params.parent) {\r\n        params.parent.append(div);\r\n    }\r\n    if ('title' in params && params.title !== undefined) {\r\n        div.title = params.title;\r\n    }\r\n    const listeners = [];\r\n    if ('onClick' in params) {\r\n        div.addEventListener('click', params.onClick);\r\n        listeners.push(['click', params.onClick]);\r\n    }\r\n    if ('onChange' in params) {\r\n        div.addEventListener('change', params.onChange);\r\n        listeners.push(['change', params.onChange]);\r\n    }\r\n    if (listeners.length > 0) {\r\n        els.push({\r\n            el: div,\r\n            listeners,\r\n        });\r\n        /*div.style.backgroundColor = '#ff0';\r\n        div.style.border = '1px solid #ff0';*/\r\n    }\r\n    if ('custom' in params && params.custom) {\r\n        const customKeyArr = Object.keys(params.custom);\r\n        for (let i = 0; i < customKeyArr.length; i++) {\r\n            div.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\r\n        }\r\n    }\r\n    return div;\r\n}\r\n\r\n/**\r\n * removes event listeners for Elements created via el()\r\n * @param el\r\n */\r\nexport function destroyEl (el?: HTMLElement) {\r\n    if (!el) {\r\n        return;\r\n    }\r\n    for (let i = 0; i < els.length; i++) {\r\n        const item = els[i];\r\n        if (item.el === el) {\r\n            item.listeners.forEach(item => {\r\n                el.removeEventListener(item[0], item[1]);\r\n            });\r\n            els.splice(i, 1);\r\n            return;\r\n        }\r\n    }\r\n    // not found\r\n    return;\r\n}\r\n","\r\ntype TLogListener = (msg: any) => void;\r\n\r\nexport class BbLog {\r\n\r\n    private static listeners: TLogListener[] = [];\r\n\r\n    constructor () {\r\n    }\r\n\r\n    static subscribe (listener: TLogListener): void {\r\n        if (BbLog.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        BbLog.listeners.push(listener);\r\n    }\r\n\r\n    static unsubscribe (listener: TLogListener): void {\r\n        for (let i = 0; i < BbLog.listeners.length; i++) {\r\n            if (listener === BbLog.listeners[i]) {\r\n                BbLog.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    static emit (msg: any): void {\r\n        BbLog.listeners.forEach(item => {\r\n            item(msg);\r\n        });\r\n    }\r\n}","/**\r\n * LocalStorage wrapper that does not throw exceptions.\r\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\r\n */\r\nexport class LocalStorage {\r\n\r\n    private static error;\r\n\r\n    static getItem (key: string): string {\r\n        let result = null;\r\n        try {\r\n            result = localStorage.getItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static setItem (key: string, value: string): void {\r\n        try {\r\n            localStorage.setItem(key, value);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static removeItem (key: string): void {\r\n        try {\r\n            localStorage.removeItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static getError (): any {\r\n        return this.error;\r\n    }\r\n}","import {IPointerEvent} from '../event.types';\r\nimport {copyObj} from '../../base/base';\r\n\r\nexport interface ICoalescedPointerEvent extends IPointerEvent {\r\n    isCoalesced?: true;\r\n}\r\n\r\n/**\r\n * A ChainElement. Splits up coalesced events into their own pointermove events. Otherwise regular pass through.\r\n *\r\n * in: IPointerEvent\r\n * out: IPointerEvent with property isCoalesced: boolean\r\n *\r\n * todo: eventPreventDefault and eventStopPropagation are broken events w coalesced events. (because of json parse json stringify)\r\n * but how could that even work?\r\n */\r\nexport class CoalescedExploder {\r\n\r\n    private chainOut: ((e: ICoalescedPointerEvent) => void) | undefined;\r\n\r\n    // ---- public ----\r\n\r\n    setChainOut (func: (e: ICoalescedPointerEvent) => void) {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (event.coalescedArr && event.coalescedArr.length > 0) {\r\n                for (let i = 0; i < event.coalescedArr.length; i++) {\r\n                    const eventCopy: ICoalescedPointerEvent = copyObj(event);\r\n                    if (i === 0) {\r\n                        eventCopy.coalescedArr = [];\r\n                    }\r\n                    const coalescedItem = event.coalescedArr[i];\r\n\r\n                    eventCopy.pageX = coalescedItem.pageX;\r\n                    eventCopy.pageY = coalescedItem.pageY;\r\n                    eventCopy.relX = coalescedItem.relX;\r\n                    eventCopy.relY = coalescedItem.relY;\r\n                    eventCopy.dX = coalescedItem.dX;\r\n                    eventCopy.dY = coalescedItem.dY;\r\n                    eventCopy.time = coalescedItem.time;\r\n                    if (i < event.coalescedArr.length - 1) {\r\n                        eventCopy.isCoalesced = true;\r\n                    }\r\n\r\n                    this.chainOut && this.chainOut(eventCopy);\r\n                }\r\n\r\n            } else {\r\n                return event;\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n}\r\n","import {dist} from '../../math/math';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\n/**\r\n * A ChainElement. Detects a single tap with N 'touch' pointers\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class NFingerTapper {\r\n\r\n    private readonly minSilenceBeforeDurationMs = 50;\r\n    private readonly maxTapMs = 500;\r\n    private readonly maxFirstLastFingerDownMs = 250;\r\n    private readonly maxPressedDistancePx = 12; //5 + fingers * 5;\r\n\r\n    private chainOut: ((e: IPointerEvent) => void) | undefined;\r\n    private fingerArr: {\r\n        pointerId: number;\r\n        downTimeMs: number;\r\n        downPageX: number;\r\n        downPageY: number;\r\n        isUp?: boolean;\r\n    }[] = [];\r\n    private eventQueueArr: IPointerEvent[] = [];\r\n    private firstDownTime: number = 0;\r\n    private lastEventTime: number = 0;\r\n    private nowTime: number = performance.now();\r\n    private readonly pointersDownIdArr: number[] = [];\r\n    private readonly fingers: number;\r\n    private readonly onTap: () => void;\r\n    private readonly timeoutObj: {\r\n        firstLastDownTimeout: ReturnType<typeof setTimeout> | null;\r\n        tapTimeout: ReturnType<typeof setTimeout> | null;\r\n    } = {\r\n        firstLastDownTimeout: null,\r\n        tapTimeout: null,\r\n    };\r\n\r\n    private failGesture (): void {\r\n        if (this.eventQueueArr.length === 0) {\r\n            return;\r\n        }\r\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\r\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\r\n        for (let i = 0; i < this.eventQueueArr.length; i++) {\r\n            this.chainOut && this.chainOut(this.eventQueueArr[i]);\r\n        }\r\n        this.eventQueueArr = [];\r\n        this.fingerArr = [];\r\n    }\r\n\r\n    private success (): void {\r\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\r\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\r\n        this.eventQueueArr = []; // events get swallowed\r\n        this.fingerArr = [];\r\n        this.onTap();\r\n    }\r\n\r\n    private setupTimeout (timeoutStr: 'firstLastDownTimeout' | 'tapTimeout', timeMS: number): boolean {\r\n        const diff = timeMS - this.nowTime;\r\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        this.timeoutObj[timeoutStr] = setTimeout(() => this.failGesture(), diff);\r\n        return true;\r\n    }\r\n\r\n    private processEvent (event: IPointerEvent): true | void {\r\n\r\n        const tempLastEventTime = this.lastEventTime;\r\n        this.lastEventTime = event.time;\r\n\r\n        if (event.type === 'pointerdown') {\r\n            this.pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\r\n                if (this.pointersDownIdArr[i] === event.pointerId) {\r\n                    this.pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (event.pointerType !== 'touch') {\r\n            if (this.fingerArr.length > 0) { // already in gesture -> fail\r\n                this.failGesture();\r\n            }\r\n            return;\r\n        }\r\n\r\n        this.nowTime = performance.now();\r\n\r\n        if (event.type === 'pointerdown') {\r\n            //console.log('down');\r\n            if (this.fingerArr.length + 1 !== this.pointersDownIdArr.length) { // failed before, and some fingers are still down -> fail\r\n                this.failGesture();\r\n                return;\r\n            }\r\n            if (this.fingerArr.length === this.fingers) { // too many fingers down -> fail\r\n                //console.log(fingers + ': too many fingers down -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n            if (this.fingerArr.length > 0 && event.time - this.maxFirstLastFingerDownMs > this.fingerArr[0].downTimeMs) { // took too long to touch with all fingers -> fail\r\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n            if (this.fingerArr.length === 0 && event.time - this.minSilenceBeforeDurationMs < tempLastEventTime) { // not enough silence before -> fail\r\n                //console.log(fingers + ': not enough silence before -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            if (this.fingerArr.length === 0) {\r\n                this.firstDownTime = event.time;\r\n\r\n                if (!this.setupTimeout('firstLastDownTimeout', event.time + this.maxFirstLastFingerDownMs) || !this.setupTimeout('tapTimeout', event.time + this.maxTapMs)) { // timeouts already up -> fail\r\n                    this.failGesture();\r\n                    return;\r\n                }\r\n\r\n            }\r\n            this.fingerArr.push({\r\n                pointerId: event.pointerId,\r\n                downTimeMs: event.time,\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY,\r\n            });\r\n            return;\r\n\r\n        }\r\n\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (this.fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            for (let i = 0; i < this.fingerArr.length; i++) {\r\n                if (this.fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = this.fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) { // finger not part of the tap is on screen -> fail\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            if (event.time - this.maxTapMs > this.firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > this.maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'pointerup') {\r\n\r\n            if (this.fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            //console.log('up', event.pageX, event.pageY);\r\n            if (this.fingerArr.length !== this.fingers) { // not enough fingers -> fail\r\n                //console.log(fingers + ': not enough fingers -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            let i = 0;\r\n            for (; i < this.fingerArr.length; i++) {\r\n                if (this.fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = this.fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) {\r\n                //do nothing\r\n                return;\r\n            }\r\n\r\n            if (event.time - this.maxTapMs > this.firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > this.maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\r\n                //console.log(fingerArr);\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            fingerObj.isUp = true;\r\n\r\n            let allAreUp = true;\r\n            for (let i = 0; i < this.fingerArr.length; i++) {\r\n                if (!this.fingerArr[i].isUp) {\r\n                    allAreUp = false;\r\n                    break;\r\n                }\r\n            }\r\n            //console.log('fingerArr', fingerArr);\r\n\r\n            if (allAreUp) { // success\r\n                this.success();\r\n                return true;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            fingers: number;\r\n            onTap: () => void;\r\n        }\r\n    ) {\r\n        this.fingers = p.fingers;\r\n        this.onTap = p.onTap;\r\n    }\r\n\r\n\r\n    chainIn (event: IPointerEvent): (IPointerEvent | null) {\r\n\r\n        const result = this.processEvent(event);\r\n\r\n        //console.log(fingerArr.length);\r\n\r\n        if (result === true) {\r\n            //tap success -> event gets swallowed\r\n            return null;\r\n        }\r\n        if (this.fingerArr.length === 0) {\r\n            return event;\r\n        } else {\r\n            this.eventQueueArr.push(event);\r\n        }\r\n\r\n        return null;\r\n\r\n    }\r\n\r\n    setChainOut (func: (e: IPointerEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n\r\n}\r\n","import {dist, pointsToAngleRad} from '../../math/math';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\nexport type TPinchZoomerEvent = { type: 'end' } | {\r\n    type: 'move';\r\n\r\n    downRelX: number;\r\n    downRelY: number;\r\n    relX: number;\r\n    relY: number;\r\n\r\n    angleRad: number;\r\n    scale: number;\r\n};\r\n\r\ntype TTouchPointer =  {\r\n    pointerId: number;\r\n    relX: number;\r\n    relY: number;\r\n    downRelX?: number; // only for first\r\n    downRelY?: number;\r\n};\r\n\r\ntype TPinchGesture = {\r\n    touchPointerArr: TTouchPointer[];\r\n    otherPointerIdArr: number[];\r\n    isInProgress: boolean;\r\n};\r\n\r\n/**\r\n * A ChainElement. Detects a pinch zooming (2 touch pointers). If one finger lifts, then will use the remaining.\r\n * Further pointers are ignored, but their events get swallowed during the pinching.\r\n * pinching ends when ALL pointers are lifted.\r\n * Events passed through if no pinching.\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class PinchZoomer {\r\n\r\n    private readonly firstFingerMaxDistancePx = 10;\r\n    private readonly untilSecondFingerDurationMs = 250;\r\n\r\n\r\n    private chainOut: ((e: IPointerEvent) => void) | undefined;\r\n    private readonly pointersDownIdArr: number[] = [];\r\n    private gestureObj: null | TPinchGesture = null;\r\n    private eventQueueArr: IPointerEvent[] = [];\r\n    private nowTime: number = performance.now();\r\n    private readonly timeoutObj: {\r\n        secondFingerTimeout: ReturnType<typeof setTimeout> | null;\r\n    } = {\r\n        secondFingerTimeout: null,\r\n    };\r\n    private pincherArr: {\r\n        pointerId: number;\r\n        relX: number;\r\n        relY: number;\r\n        downRelX: number;\r\n        downRelY: number;\r\n    }[] = [];\r\n    private readonly onPinch: (e: TPinchZoomerEvent) => void;\r\n\r\n\r\n    private end (): void {\r\n        this.gestureObj = null;\r\n        this.eventQueueArr = [];\r\n    }\r\n\r\n    private fail (doSwallow?: boolean): void {\r\n        if (!this.gestureObj) { // no gesture happening -> ignore\r\n            return;\r\n        }\r\n\r\n        this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\r\n        if (!doSwallow) {\r\n            for (let i = 0; i < this.eventQueueArr.length; i++) {\r\n                this.chainOut && this.chainOut(this.eventQueueArr[i]);\r\n            }\r\n        }\r\n        this.end();\r\n    }\r\n\r\n    private setupFailTimeout (timeMS: number): boolean {\r\n        const diff = timeMS - this.nowTime;\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        this.timeoutObj.secondFingerTimeout = setTimeout(() => this.fail(), diff);\r\n        return true;\r\n    }\r\n\r\n    private processEvent (event: IPointerEvent): void {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            this.pointersDownIdArr.push(event.pointerId);\r\n\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\r\n                if (this.pointersDownIdArr[i] === event.pointerId) {\r\n                    this.pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        //pass through scenarios\r\n        if (\r\n            !this.gestureObj && (\r\n                event.pointerType !== 'touch' || // wrong pointer type\r\n                (event.type === 'pointermove' && this.pointersDownIdArr.length > 0) || // failed before\r\n                this.pointersDownIdArr.length > 1 || // failed before\r\n                event.type === 'pointerup' // failed before\r\n            )\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        this.nowTime = performance.now();\r\n\r\n\r\n        //pointer down\r\n        if (event.type === 'pointerdown') {\r\n\r\n            if (this.gestureObj) {\r\n                if (event.pointerType === 'touch') { // touch finger down - as nth pointer\r\n\r\n                    this.gestureObj.touchPointerArr.push({\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY,\r\n                    });\r\n\r\n                    if (this.gestureObj.isInProgress) {\r\n                        this.continuePinch(this.gestureObj, {\r\n                            type: 'down',\r\n                            index: this.gestureObj.touchPointerArr.length - 1,\r\n                        });\r\n                    } else {\r\n                        this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\r\n                        this.gestureObj.isInProgress = true;\r\n                        this.beginPinch(this.gestureObj);\r\n                    }\r\n                    return;\r\n\r\n                } else { // non-touch finger down - as nth pointer\r\n\r\n                    if (this.gestureObj.isInProgress) {\r\n                        this.gestureObj.otherPointerIdArr.push(event.pointerId);\r\n                    } else { // second pointer wrong type -> fail\r\n                        this.fail();\r\n                    }\r\n                    return;\r\n                }\r\n\r\n\r\n            } else {\r\n                // first finger down - can only be touch if no gestureObj\r\n                this.gestureObj = {\r\n                    touchPointerArr: [{\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY,\r\n                        downRelX: event.relX,\r\n                        downRelY: event.relY,\r\n                    }],\r\n                    otherPointerIdArr: [],\r\n                    isInProgress: false,\r\n                };\r\n                if (!this.setupFailTimeout(event.time + this.untilSecondFingerDurationMs)) { // time ran out -> fail\r\n                    this.fail();\r\n                    return;\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        // should not happen. something went wrong\r\n        if (!this.gestureObj) {\r\n            // throw? would make it less robust\r\n            this.fail();\r\n            return;\r\n        }\r\n\r\n        //pointer move\r\n        if (event.type === 'pointermove' && event.pointerType === 'touch') {\r\n            //gesture object should always exist here\r\n\r\n            let touchPointerObj: TTouchPointer | null = null;\r\n            let i = 0;\r\n            for (; i < this.gestureObj.touchPointerArr.length; i++) {\r\n                if (event.pointerId === this.gestureObj.touchPointerArr[i].pointerId) {\r\n                    touchPointerObj = this.gestureObj.touchPointerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n\r\n            //null should not be possible. something went wrong\r\n            if (!touchPointerObj) {\r\n                // throw? would make it less robust\r\n                this.fail();\r\n                return;\r\n            }\r\n\r\n            touchPointerObj.relX = event.relX;\r\n            touchPointerObj.relY = event.relY;\r\n\r\n            if (!this.gestureObj.isInProgress) { // only one finger down & pinching hasn't started\r\n\r\n                // should not happen. something went wrong\r\n                if (\r\n                    !('downRelX' in touchPointerObj && touchPointerObj.downRelX !== undefined) ||\r\n                    !('downRelY' in touchPointerObj && touchPointerObj.downRelY !== undefined)\r\n                ) {\r\n                    this.fail();\r\n                    return;\r\n                }\r\n\r\n                const distance = dist(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\r\n                if (distance > this.firstFingerMaxDistancePx) { // moved too much -> fail\r\n                    this.fail();\r\n                    return;\r\n                }\r\n\r\n            } else {\r\n                if (i < 2) { // only first two touches can affect pinching\r\n                    this.continuePinch(this.gestureObj, {\r\n                        type: 'move',\r\n                        index: i,\r\n                    });\r\n                }\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n\r\n        //pointer up\r\n        if (event.type === 'pointerup') {\r\n            //gesture object should always exist here\r\n\r\n            if (event.pointerType === 'touch') {\r\n                let i = 0;\r\n                for (; i < this.gestureObj.touchPointerArr.length; i++) {\r\n                    if (this.gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\r\n                        this.gestureObj.touchPointerArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n                if (this.gestureObj.touchPointerArr.length > 0) {\r\n                    this.continuePinch(this.gestureObj, {\r\n                        type: 'up',\r\n                        index: i,\r\n                    });\r\n                }\r\n\r\n            } else { // non-touch\r\n                for (let i = 0; i < this.gestureObj.otherPointerIdArr.length; i++) {\r\n                    if (this.gestureObj.otherPointerIdArr[i] === event.pointerId) {\r\n                        this.gestureObj.otherPointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            //all fingers lifted?\r\n            if (this.gestureObj.touchPointerArr.length === 0 && this.gestureObj.otherPointerIdArr.length === 0) {\r\n                if (this.gestureObj.isInProgress) { // lifted last finger -> end of pinching\r\n                    this.end();\r\n                    this.endPinch();\r\n                } else { // lifted finger again before pinching started -> fail\r\n                    this.fail();\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    private beginPinch (gestureObj: TPinchGesture): void {\r\n\r\n        for (let i = 0; i < gestureObj.touchPointerArr.length; i++) {\r\n            const pointerObj = gestureObj.touchPointerArr[i];\r\n            this.pincherArr.push({\r\n                pointerId: pointerObj.pointerId,\r\n                relX: pointerObj.relX,\r\n                relY: pointerObj.relY,\r\n                downRelX: pointerObj.relX,\r\n                downRelY: pointerObj.relY,\r\n            });\r\n        }\r\n\r\n        const event: TPinchZoomerEvent = {\r\n            type: 'move',\r\n\r\n            // temp\r\n            downRelX: 0,\r\n            downRelY: 0,\r\n            relX: 0,\r\n            relY: 0,\r\n\r\n            angleRad: 0,\r\n            scale: 1,\r\n        };\r\n\r\n        if (this.pincherArr.length === 1) {\r\n            event.relX = this.pincherArr[0].downRelX;\r\n            event.relY = this.pincherArr[0].downRelY;\r\n        } else {\r\n            event.relX = 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX);\r\n            event.relY = 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY);\r\n        }\r\n        event.downRelX = event.relX;\r\n        event.downRelY = event.relY;\r\n\r\n        this.onPinch(event);\r\n\r\n    }\r\n\r\n    //actionObj = {type: 'down'|'move'|'up', index: number}\r\n    private continuePinch (\r\n        gestureObj: TPinchGesture,\r\n        actionObj: {\r\n            type: 'down' | 'move' | 'up';\r\n            index: number;\r\n        }\r\n    ): void {\r\n\r\n        if (actionObj.index > 1) { // only first two pointers matter\r\n            return;\r\n        }\r\n\r\n        if (actionObj.type === 'move') {\r\n\r\n            let event: TPinchZoomerEvent;\r\n            this.pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\r\n            this.pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\r\n\r\n            if (this.pincherArr.length === 1) {\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: this.pincherArr[0].downRelX,\r\n                    downRelY: this.pincherArr[0].downRelY,\r\n                    relX: this.pincherArr[0].relX,\r\n                    relY: this.pincherArr[0].relY,\r\n                    angleRad: 0,\r\n                    scale: 1,\r\n                };\r\n\r\n            } else {\r\n\r\n                const startDist = dist(this.pincherArr[0].downRelX, this.pincherArr[0].downRelY, this.pincherArr[1].downRelX, this.pincherArr[1].downRelY);\r\n                const distance = dist(this.pincherArr[0].relX, this.pincherArr[0].relY, this.pincherArr[1].relX, this.pincherArr[1].relY);\r\n\r\n                const startAngle = pointsToAngleRad({\r\n                    x: this.pincherArr[0].downRelX,\r\n                    y: this.pincherArr[0].downRelY,\r\n                }, {x: this.pincherArr[1].downRelX, y: this.pincherArr[1].downRelY});\r\n                const angle = pointsToAngleRad({\r\n                    x: this.pincherArr[0].relX,\r\n                    y: this.pincherArr[0].relY,\r\n                }, {x: this.pincherArr[1].relX, y: this.pincherArr[1].relY});\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX),\r\n                    downRelY: 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY),\r\n                    relX: 0.5 * (this.pincherArr[0].relX + this.pincherArr[1].relX),\r\n                    relY: 0.5 * (this.pincherArr[0].relY + this.pincherArr[1].relY),\r\n                    angleRad: angle - startAngle,\r\n                    scale: distance / startDist,\r\n                };\r\n\r\n            }\r\n\r\n            this.onPinch(event);\r\n\r\n        } else if (actionObj.type === 'down' || actionObj.type === 'up') {\r\n            this.endPinch();\r\n            this.beginPinch(gestureObj);\r\n        }\r\n\r\n    }\r\n\r\n    private endPinch (): void {\r\n        this.pincherArr = [];\r\n        this.onPinch({\r\n            type: 'end',\r\n        });\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onPinch: (e: TPinchZoomerEvent) => void;\r\n        }\r\n    ) {\r\n        this.onPinch = p.onPinch;\r\n    }\r\n\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n        this.processEvent(event);\r\n        if (this.gestureObj) {\r\n            if (!this.gestureObj.isInProgress) { // might still fail -> into queue\r\n                this.eventQueueArr.push(event);\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    setChainOut (func: (e: IPointerEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n}\r\n","import {TChainOutFunc} from './event-chain.types';\r\nimport {dist} from '../../math/math';\r\nimport {IPointerEvent, TPointerButton, TPointerType} from '../event.types';\r\n\r\n\r\ninterface IDoubleTapperEvent {\r\n    pageX: number;\r\n    pageY: number;\r\n    relX: number;\r\n    relY: number;\r\n}\r\n\r\ntype TDoubleTapperTimeoutType = 'fail' | 'maxUntilSecondDown' | 'success';\r\n\r\n/**\r\n * A ChainElement. Detects double taps.\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class DoubleTapper {\r\n\r\n    private readonly onDoubleTap: (e: IDoubleTapperEvent) => void;\r\n    private chainOut: TChainOutFunc | undefined;\r\n    private allowedPointerTypeArr: TPointerType[] = ['touch', 'mouse', 'pen'];\r\n    private allowedButtonArr: TPointerButton[] = ['left'];\r\n    private minSilenceBeforeDurationMs: number = 400;\r\n    private maxPressedDurationMs: number = 300;\r\n    private maxPressedDistancePx: number = 10;\r\n    private maxInbetweenDistancePx: number = 19;\r\n    private maxUpToUpDurationMs: number = 500;\r\n    private maxUntilSecondDownDurationMs: number = 300;\r\n    private minSilenceAfterMs: number = 250;\r\n    private sequenceArr: (\r\n        {\r\n            isDown: boolean;\r\n            time: number;\r\n            position: [number, number];\r\n            pointerId: number;\r\n        } |\r\n        {\r\n            isUp: boolean;\r\n            time: number;\r\n            position: [number, number];\r\n        } |\r\n        {\r\n            pageX: number;\r\n            pageY: number;\r\n            relX: number;\r\n            relY: number;\r\n        }\r\n        )[] = [];\r\n    private pointersDownIdArr: number[] = [];\r\n    private lastUpTime: number = 0;\r\n    private nowTime: number = 0;\r\n    private eventQueueArr: IPointerEvent[] = [];\r\n    private timeoutObj: {\r\n        [K in TDoubleTapperTimeoutType]: ReturnType<typeof setTimeout> | null;\r\n    } = {\r\n        fail: null,\r\n        maxUntilSecondDown: null,\r\n        success: null,\r\n    };\r\n    private readonly gestureFailed: () => void;\r\n\r\n    // double tap achieved\r\n    private success (): void {\r\n        this.timeoutObj.fail = null;\r\n        this.timeoutObj.success = null;\r\n        this.eventQueueArr = []; // events get swallowed\r\n        const lastSequenceItem = this.sequenceArr[this.sequenceArr.length - 1];\r\n        this.sequenceArr = [];\r\n        if ('pageX' in lastSequenceItem) {\r\n            this.onDoubleTap({\r\n                pageX: lastSequenceItem.pageX,\r\n                pageY: lastSequenceItem.pageY,\r\n                relX: lastSequenceItem.relX,\r\n                relY: lastSequenceItem.relY,\r\n            });\r\n        }\r\n    }\r\n\r\n    // returns false if time already up. otherwise sets up timeout\r\n    private setupTimeout (timeoutStr: TDoubleTapperTimeoutType, targetFunc: () => void, timeMS: number): boolean {\r\n        const diff = timeMS - this.nowTime;\r\n        // console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        this.timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @param event object - a pointer event from BB.PointerListener\r\n     */\r\n    private processEvent (event: IPointerEvent): void {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            this.pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\r\n                if (this.pointersDownIdArr[i] === event.pointerId) {\r\n                    this.pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!this.allowedPointerTypeArr.includes(event.pointerType)) { //wrong input type -> fail\r\n            //console.log('wrong input type -> fail');\r\n            this.gestureFailed();\r\n            return;\r\n        }\r\n\r\n        this.nowTime = performance.now();\r\n        const lastSequenceItem = this.sequenceArr.length > 0 ? this.sequenceArr[this.sequenceArr.length - 1] : null;\r\n        if (event.type === 'pointerup') {\r\n            this.lastUpTime = event.time;\r\n        }\r\n\r\n        if (event.type === 'pointerdown') {\r\n            if (this.pointersDownIdArr.length > 1) { // more than one pointer down -> fail\r\n                //console.log('more than one pointer down -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (this.timeoutObj.success !== null) { // silence-after not achieved -> fail\r\n                //console.log('silence-after not achieved -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (this.sequenceArr.length === 0 && this.nowTime - this.lastUpTime < this.minSilenceBeforeDurationMs) { // silence before not achieved -> fail\r\n                //console.log('silence before not achieved -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (event.button && !this.allowedButtonArr.includes(event.button)) { // wrong button -> fail\r\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if ((lastSequenceItem && 'isDown' in lastSequenceItem && lastSequenceItem.isDown) || this.sequenceArr.length > 2) { // jumbled -> fail\r\n                //console.log('jumbled -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (lastSequenceItem && 'position' in lastSequenceItem) {\r\n                const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n                if (distance > this.maxInbetweenDistancePx) { //moved too much -> reset\r\n                    //console.log('maxInbetweenDistancePx -> reset');\r\n                    this.gestureFailed();\r\n\r\n\r\n                    if ('time' in lastSequenceItem && this.nowTime - lastSequenceItem.time < this.minSilenceBeforeDurationMs) { //silence before not achieved -> fail\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            this.sequenceArr.push({\r\n                isDown: true,\r\n                time: this.nowTime,\r\n                position: [event.pageX, event.pageY],\r\n                pointerId: event.pointerId,\r\n            });\r\n            //maxUntilSecondDown\r\n\r\n            if (this.sequenceArr.length > 1) {\r\n                this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\r\n            } else if (!this.setupTimeout('maxUntilSecondDown', () => this.gestureFailed(), event.time + this.maxUntilSecondDownDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n\r\n\r\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\r\n            if (!this.setupTimeout('fail', () => this.gestureFailed(), event.time + this.maxPressedDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointermove' && 'pointerId' in lastSequenceItem && lastSequenceItem.pointerId === event.pointerId) {\r\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                console.log('another pointer mixing in -> fail');\r\n                this.fail();\r\n                return;\r\n            }*/\r\n            const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n            if (distance > this.maxPressedDistancePx) { //moved too much -> fail\r\n                //console.log('maxPressedDistancePx -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointerup') {\r\n            if ('pointerId' in lastSequenceItem && lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if ('time' in lastSequenceItem && this.nowTime >= lastSequenceItem.time + this.maxPressedDurationMs) { //pressed too long -> fail\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\r\n\r\n            if (this.sequenceArr.length < 3) {\r\n                if (!this.setupTimeout('fail', () => this.gestureFailed(), event.time + this.maxUpToUpDurationMs)) {\r\n                    this.gestureFailed();\r\n                    return;\r\n                }\r\n\r\n                this.sequenceArr = [\r\n                    lastSequenceItem,\r\n                    {\r\n                        isUp: true,\r\n                        time: this.nowTime,\r\n                        position: [event.pageX, event.pageY],\r\n                    },\r\n                ];\r\n                return;\r\n            }\r\n\r\n            if ('time' in this.sequenceArr[1] && this.nowTime < this.sequenceArr[1].time + this.maxUpToUpDurationMs) {\r\n                // double tap almost success\r\n                // only needs silence\r\n                this.sequenceArr.push({\r\n                    pageX: event.pageX,\r\n                    pageY: event.pageY,\r\n                    relX: event.relX,\r\n                    relY: event.relY,\r\n                });\r\n                if (!this.setupTimeout('success', () => this.success(), event.time + this.minSilenceAfterMs)) {\r\n                    this.gestureFailed();\r\n                }\r\n            } else { // time up -> fail\r\n                this.gestureFailed();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onDoubleTap: (e: IDoubleTapperEvent) => void; // fires when double tap occurs\r\n        }\r\n    ) {\r\n        this.onDoubleTap = p.onDoubleTap;\r\n        this.gestureFailed = () => {\r\n            if (this.sequenceArr.length === 0) { // no gesture started -> can be ignored\r\n                return;\r\n            }\r\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\r\n            this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\r\n            this.timeoutObj.success && clearTimeout(this.timeoutObj.success);\r\n            this.timeoutObj.fail = null;\r\n            this.timeoutObj.maxUntilSecondDown = null;\r\n            this.timeoutObj.success = null;\r\n\r\n            if (this.chainOut) {\r\n                for (let i = 0; i < this.eventQueueArr.length; i++) {\r\n                    this.chainOut(this.eventQueueArr[i]);\r\n                }\r\n            }\r\n\r\n            this.eventQueueArr = [];\r\n            this.sequenceArr = [];\r\n        };\r\n    }\r\n\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n\r\n        this.processEvent(event);\r\n\r\n        if (this.sequenceArr.length === 0) { //existing events can not become a double tap\r\n            this.gestureFailed();\r\n            return event;\r\n        }\r\n        // events might become a double tap -> queue\r\n        this.eventQueueArr.push(event);\r\n        return null;\r\n    }\r\n\r\n    setChainOut (func: TChainOutFunc): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    setAllowedPointerTypeArr (arr: TPointerType[]): void {\r\n        this.allowedPointerTypeArr = [...arr];\r\n    }\r\n\r\n    setAllowedButtonArr (arr: TPointerButton[]): void {\r\n        this.allowedButtonArr = [...arr];\r\n    }\r\n\r\n}\r\n","import {TChainOutFunc} from './event-chain.types';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\n/**\r\n * only lets through events from one pointer at a time.\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class OnePointerLimiter {\r\n\r\n    private chainOut: TChainOutFunc | undefined;\r\n    private downPointerId: number | null = null;\r\n    private readonly ignorePointerIdArr: number[] = [];\r\n\r\n    // ---- public ----\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n\r\n        if (this.ignorePointerIdArr.includes(event.pointerId)) {\r\n            if (event.type === 'pointerup') {\r\n                for (let i = 0; i < this.ignorePointerIdArr.length; i++) {\r\n                    if (this.ignorePointerIdArr[i] === event.pointerId) {\r\n                        this.ignorePointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        if (this.downPointerId === null) {\r\n            if (event.type === 'pointerdown') {\r\n                this.downPointerId = event.pointerId;\r\n            }\r\n            return event;\r\n\r\n        } else {\r\n            if (event.pointerId !== this.downPointerId) {\r\n                if (event.type === 'pointerdown') {\r\n                    this.ignorePointerIdArr.push(event.pointerId);\r\n                }\r\n                return null;\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                this.downPointerId = null;\r\n            }\r\n            return event;\r\n        }\r\n    }\r\n\r\n    setChainOut (func: TChainOutFunc): void {\r\n        this.chainOut = func;\r\n    }\r\n}","import {IChainElement, TChainOutFunc} from './event-chain.types';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\n/**\r\n * for chaining event processing. useful for gestures (double tap, pinch zoom, max pointer filter).\r\n * each element in the chain might hold back the events, swallow them, transform them, or create new ones\r\n */\r\nexport class EventChain {\r\n    private readonly chainArr: IChainElement[];\r\n    private chainOut: TChainOutFunc | undefined;\r\n\r\n    private continueChain (i: number, event: IPointerEvent): null {\r\n        for (; i < this.chainArr.length; i++) {\r\n            event = this.chainArr[i].chainIn(event);\r\n            if (event === null) {\r\n                return null;\r\n            }\r\n        }\r\n        this.chainOut && this.chainOut(event);\r\n        return null;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            chainArr: IChainElement[];\r\n        }\r\n    ) {\r\n        this.chainArr = p.chainArr;\r\n\r\n        for (let i = 0; i < this.chainArr.length; i++) {\r\n            ( (i) => {\r\n                this.chainArr[i].setChainOut((event: IPointerEvent) => {\r\n                    this.continueChain(i + 1, event);\r\n                });\r\n            })(i);\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * feed an event into the chain\r\n     */\r\n    chainIn (event: IPointerEvent): null {\r\n        return this.continueChain(0, event);\r\n    }\r\n\r\n    /**\r\n     * func will be called when event has passed through the chain\r\n     */\r\n    setChainOut (func: TChainOutFunc): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n}\r\n","window.onscroll = (e) => {\r\n    e.preventDefault();\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hWwEP\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"83Fnk\");","import {KeyListener} from '../../../../bb/input/key-listener';\r\nimport {dialogCounter} from '../modal-count';\r\nimport {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport './scroll-fix';\r\nimport cancelImg from '/src/app/img/ui/cancel.svg';\r\n\r\n/**\r\n * popup that fill whole height, with some padding.\r\n * currently only used for iframe popups.\r\n */\r\nexport class DynamicModal {\r\n\r\n    private readonly parent: HTMLElement;\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly updatePos: () => void;\r\n    private readonly keyListener: KeyListener;\r\n    private readonly xButton: HTMLElement;\r\n    private readonly bgEl: HTMLElement;\r\n    private readonly onClose: ((result?: string) => void) | undefined;\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            title?: HTMLElement;\r\n            content?: HTMLElement;\r\n            buttonArr?: string[];\r\n            autoFocus?: string | false; // todo - not implemented\r\n            clickOnEnter?: string; // button name - todo not implemented\r\n            onClose?: (result?: string) => void;\r\n\r\n            //size and position\r\n            width: number;\r\n            isMaxHeight: boolean; // todo - not implemented\r\n        }\r\n    ) {\r\n        dialogCounter.increase();\r\n        this.onClose = p.onClose;\r\n        this.parent = document.body;\r\n        this.rootEl = BB.el({\r\n            parent: this.parent,\r\n            className: 'g-root kl-d-modal-root',\r\n            css: {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0',\r\n                overflow: 'auto',\r\n                animationName: 'consoleIn',\r\n                animationDuration: '0.3s',\r\n                animationTimingFunction: 'ease-out',\r\n            },\r\n            onClick: BB.handleClick,\r\n        });\r\n\r\n        //background element registering clicks\r\n        this.bgEl = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0',\r\n            },\r\n            onClick: () => this.close(),\r\n        });\r\n\r\n        //the actual popup box\r\n        const popupEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-d-modal',\r\n            css: {\r\n                position: 'absolute',\r\n                width: (BB.isCssMinMaxSupported() ?\r\n                    'min(calc(100% - 40px), ' + (p.width ? p.width : 400) + 'px)' :\r\n                    (p.width ? p.width : 400) + 'px'),\r\n                height: 'calc(100% - 40px)',\r\n                borderRadius: '10px',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n        //x and y position via script. flex not powerful enough imo\r\n        this.updatePos = () => {\r\n            const elW = popupEl.offsetWidth;\r\n            const elH = popupEl.offsetHeight;\r\n\r\n            BB.css(popupEl, {\r\n                left: Math.max(0, (window.innerWidth - elW) / 2) + 'px',\r\n                top: Math.max(20, (window.innerHeight - elH) / 2 - (elH * 0.20)) + 'px',\r\n            });\r\n        };\r\n\r\n        this.updatePos();\r\n        window.addEventListener('resize', this.updatePos);\r\n\r\n        //title row in popup\r\n        const titleHeight = 40;\r\n        const titleEl = BB.el({\r\n            parent: popupEl,\r\n            css: {\r\n                height: titleHeight + 'px',\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center',\r\n                paddingLeft: (titleHeight / 2) + 'px',\r\n            },\r\n        });\r\n        if (p.title) {\r\n            titleEl.append(p.title);\r\n        }\r\n        this.xButton = BB.el({\r\n            parent: titleEl,\r\n            tagName: 'button',\r\n            className: 'popup-x',\r\n            content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n            title: LANG('modal-close'),\r\n            onClick: () => this.close(),\r\n            css: {\r\n                width: titleHeight + 'px',\r\n                height: titleHeight + 'px',\r\n                lineHeight: titleHeight + 'px',\r\n                background: 'none',\r\n                boxShadow: 'none',\r\n            },\r\n            custom: {\r\n                tabindex: '0',\r\n            },\r\n        });\r\n\r\n        const contentEl = BB.el({\r\n            parent: popupEl,\r\n            css: {\r\n                height: 'calc(100% - ' + titleHeight + 'px)',\r\n            },\r\n        });\r\n        if (p.content) {\r\n            contentEl.append(p.content);\r\n        }\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, e) => {\r\n                if (keyStr === 'esc') {\r\n                    e.stopPropagation();\r\n                    this.close();\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n    close (): void {\r\n        dialogCounter.decrease();\r\n        BB.destroyEl(this.rootEl);\r\n        this.parent.removeChild(this.rootEl);\r\n        window.removeEventListener('resize', this.updatePos);\r\n        this.keyListener.destroy();\r\n        BB.destroyEl(this.xButton);\r\n        BB.destroyEl(this.bgEl);\r\n        this.onClose && this.onClose();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IKeyStringOptional} from '../../../bb/bb-types';\r\n\r\n/**\r\n * Checkbox - with label\r\n */\r\nexport class Checkbox {\r\n\r\n    private readonly element: HTMLElement;\r\n    private check: HTMLInputElement;\r\n    private readonly doHighlight: boolean;\r\n\r\n    // --- public ---\r\n\r\n    constructor (params: {\r\n        init?: boolean; // default false\r\n        label: string;\r\n        callback?: (b: boolean) => void;\r\n        allowTab?: boolean; // default false\r\n        title?: string;\r\n        doHighlight?: boolean; // default false\r\n        css?: IKeyStringOptional;\r\n    }) {\r\n        this.doHighlight = !!params.doHighlight;\r\n\r\n        this.element = BB.el({\r\n            className: 'kl-checkbox',\r\n        });\r\n\r\n        const innerEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'label',\r\n            className: 'kl-checkbox__inner',\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        this.check = BB.el({\r\n            parent: innerEl,\r\n            tagName: 'input',\r\n            css: {\r\n                margin: '0 5px 0 0',\r\n            },\r\n            custom: {\r\n                type: 'checkbox',\r\n            },\r\n        }) as HTMLInputElement;\r\n\r\n        this.check.checked = !!params.init;\r\n        if (this.doHighlight && this.check.checked) {\r\n            this.element.classList.add('kl-checkbox--highlight');\r\n        }\r\n        if (!params.allowTab) {\r\n            this.check.tabIndex = -1;\r\n        }\r\n\r\n        if (params.title) {\r\n            innerEl.title = params.title;\r\n        }\r\n\r\n        const label = BB.el({\r\n            parent: innerEl,\r\n            content: params.label,\r\n            css: {},\r\n        });\r\n        (label as any).allowClick = true;\r\n\r\n        this.check.onchange = () => {\r\n            if (this.doHighlight) {\r\n                this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\r\n            }\r\n            params.callback && params.callback(this.check.checked);\r\n            setTimeout(() => {\r\n                this.check.blur();\r\n            }, 0);\r\n        };\r\n        if (params.css) {\r\n            BB.css(this.element, params.css);\r\n        }\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.check.checked;\r\n    }\r\n\r\n    setValue (b: boolean): void {\r\n        this.check.checked = !!b;\r\n        if (this.doHighlight) {\r\n            this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.element;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.check.onchange = null;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb-types';\r\n\r\nexport const input = function (params: {\r\n    type?: 'button' | 'checkbox' | 'number' | 'text' | 'color'; // default text\r\n    min?: number;\r\n    max?: number;\r\n    callback: (val: string) => void;\r\n    init: string | number;\r\n    css?: IKeyString;\r\n}) {\r\n    const result = document.createElement('input');\r\n    if (params.type) {\r\n        try {\r\n            result.type = params.type;\r\n        } catch(e) {} // ie can't deal with number\r\n    } else {\r\n        result.type = 'text';\r\n    }\r\n    if (params.min !== undefined) {\r\n        result.min = '' + params.min;\r\n    }\r\n    if (params.max !== undefined) {\r\n        result.max = '' + params.max;\r\n    }\r\n    result.value = '' + params.init;\r\n    if (params.callback) {\r\n        result.onchange = function () {\r\n            params.callback(result.value);\r\n        };\r\n    }\r\n    if (params.css) {\r\n        BB.css(result, params.css);\r\n    }\r\n\r\n    return result;\r\n};","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb-types';\r\n\r\n/**\r\n * A select dropdown\r\n */\r\nexport class Select<ValueType extends string> {\r\n\r\n    private readonly selectEl: HTMLSelectElement;\r\n    private readonly optionArr: {\r\n        item: ([ValueType, string] | null); // [value, label]\r\n        el?: HTMLOptionElement;\r\n    }[];\r\n    private readonly changeListener: () => void;\r\n    private readonly onChange: ((val: ValueType) => void) | undefined;\r\n\r\n    \r\n    // --- public ---\r\n    constructor (p: {\r\n        isFocusable?: boolean; // default false\r\n        optionArr: ([ValueType, string] | null)[]; // [value, label]\r\n        initValue?: ValueType; // default null\r\n        onChange?: (val: ValueType) => void;\r\n        css?: IKeyString;\r\n        title?: string;\r\n    }) {\r\n        this.selectEl = BB.el({\r\n            tagName: 'select',\r\n            title: p.title,\r\n            className: 'kl-select',\r\n            css: {\r\n                cursor: 'pointer',\r\n                fontSize: '15px',\r\n                padding: '3px',\r\n            },\r\n        }) as HTMLSelectElement;\r\n        if (p.css) {\r\n            BB.css(this.selectEl, p.css);\r\n        }\r\n\r\n        const isFocusable = p.isFocusable;\r\n        if (!isFocusable) {\r\n            this.selectEl.tabIndex = -1;\r\n        }\r\n        this.optionArr = [];\r\n        for (let i = 0; i < p.optionArr.length; i++) {\r\n            const item = p.optionArr[i];\r\n            if (item === null) {\r\n                this.optionArr.push({item});\r\n                continue;\r\n            }\r\n            const el = document.createElement('option');\r\n            el.value = item[0];\r\n            el.textContent = item[1];\r\n            this.optionArr.push({\r\n                item,\r\n                el,\r\n            });\r\n            this.selectEl.append(el);\r\n        }\r\n        if (p.onChange) {\r\n            this.onChange = p.onChange;\r\n        }\r\n        this.changeListener = () => {\r\n            if (!isFocusable) {\r\n                this.selectEl.blur();\r\n            }\r\n            this.onChange && this.onChange(this.getValue());\r\n        };\r\n        this.selectEl.addEventListener('change', this.changeListener);\r\n        this.selectEl.value = ('initValue' in p && p.initValue !== undefined) ? p.initValue : '';\r\n    }\r\n\r\n    setValue (val: ValueType): void {\r\n        this.selectEl.value = val;\r\n    }\r\n\r\n    getValue (): ValueType {\r\n        return this.selectEl.value as ValueType;\r\n    }\r\n\r\n    setDeltaValue (delta: number): void {\r\n        let index = 0;\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            const option = this.optionArr[i];\r\n            if (option.item && '' + option.item[0] === this.selectEl.value) {\r\n                index = i;\r\n                break;\r\n            }\r\n        }\r\n        index = Math.max(0, Math.min(this.optionArr.length -1, index + delta));\r\n        const option = this.optionArr[index];\r\n        this.selectEl.value = option.item ? option.item[0] : '';\r\n        this.onChange && this.onChange(this.getValue());\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.selectEl;\r\n    }\r\n\r\n    updateLabel (id: ValueType, label: string): void {\r\n        this.optionArr.forEach(option => {\r\n            if (option.item && option.item[0] === id && option.el) {\r\n                option.item[1] = label;\r\n                option.el.textContent = option.item[1];\r\n            }\r\n        });\r\n    }\r\n\r\n    destroy (): void {\r\n        this.selectEl.removeEventListener('change', this.changeListener);\r\n    }\r\n    \r\n}\r\n","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Toggle button with an image\r\n */\r\nexport class ImageToggle {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private isActive: boolean;\r\n\r\n    private update (): void {\r\n        this.rootEl.classList.toggle('image-toggle-active', this.isActive);\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            initValue: boolean;\r\n            title: string;\r\n            isRadio?: boolean; // if true, can't click when active\r\n            onChange: (b: boolean) => void;\r\n            image: string;\r\n            darkInvert?: boolean;\r\n        }\r\n    ) {\r\n        this.isActive = !!p.initValue;\r\n        this.rootEl = BB.el({\r\n            className: 'image-toggle',\r\n            title: p.title,\r\n            content: BB.el({\r\n                className: 'image-toggle__im' + (p.darkInvert ? ' dark-invert' : ''),\r\n                css: {\r\n                    backgroundImage: \"url('\" + p.image + \"')\",\r\n                },\r\n            }),\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                if (p.isRadio && this.isActive) {\r\n                    return;\r\n                }\r\n                this.isActive = !this.isActive;\r\n                this.update();\r\n                p.onChange(this.isActive);\r\n            },\r\n        });\r\n\r\n\r\n        this.update();\r\n    }\r\n\r\n    // --- interface ---\r\n    setValue (b: boolean): void {\r\n        this.isActive = !!b;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.isActive;\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.rootEl);\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {ImageToggle} from './image-toggle';\r\n\r\ntype TOptionItem<IdType> = {\r\n    id: IdType;\r\n    title: string;\r\n    image: string;\r\n    darkInvert?: boolean;\r\n};\r\n\r\n/**\r\n * Radio input group. each one has an image\r\n */\r\nexport class ImageRadioList<IdType> {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private activeIndex: number;\r\n    private readonly optionArr: {\r\n        id: IdType;\r\n        radioEl: ImageToggle;\r\n    }[];\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            optionArr: TOptionItem<IdType>[];\r\n            initId: string;\r\n            onChange: (id: IdType) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'image-radio-wrapper',\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        this.optionArr = [];\r\n\r\n        const select = (index: number, id: IdType): void => {\r\n            this.activeIndex = index;\r\n            for (let i = 0; i < this.optionArr.length; i++) {\r\n                this.optionArr[i].radioEl.setValue(i === this.activeIndex);\r\n            }\r\n            p.onChange(id);\r\n        };\r\n\r\n        let initialIndex;\r\n        const createOption = (index: number, o: TOptionItem<IdType>): {\r\n            id: IdType;\r\n            radioEl: ImageToggle;\r\n        } => {\r\n            if (o.id === p.initId) {\r\n                initialIndex = index;\r\n            }\r\n            const radioEl = new ImageToggle({\r\n                image: o.image,\r\n                title: o.title,\r\n                initValue: o.id === p.initId,\r\n                isRadio: true,\r\n                onChange: () => {\r\n                    select(index, o.id);\r\n                },\r\n                darkInvert: o.darkInvert,\r\n            });\r\n            this.rootEl.append(radioEl.getElement());\r\n\r\n            return {\r\n                id: o.id,\r\n                radioEl,\r\n            };\r\n        };\r\n\r\n        for (let i = 0; i < p.optionArr.length; i++) {\r\n            this.optionArr.push(createOption(i, p.optionArr[i]));\r\n        }\r\n\r\n        if (initialIndex === undefined) {\r\n            throw new Error('initId not in optionArr');\r\n        }\r\n        this.activeIndex = initialIndex;\r\n    }\r\n\r\n    // --- interface ---\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValue (): IdType {\r\n        return this.optionArr[this.activeIndex].id;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.optionArr.forEach(item => {\r\n            item.radioEl.destroy();\r\n        });\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\nimport iconImg from '/src/app/img/ui/brush-pressure.svg';\r\nimport {BoxToggle} from './box-toggle';\r\n\r\n/**\r\n * small toggle button with a pen icon - representing toggling pressure sensitivity\r\n * @param isChecked initial value\r\n * @param changeCallback called on change\r\n */\r\nexport const createPenPressureToggle = function (\r\n    isChecked: boolean,\r\n    changeCallback: (b: boolean) => void,\r\n): HTMLElement {\r\n\r\n    const toggleEl = new BoxToggle({\r\n        label: BB.el({\r\n            className: 'dark-invert',\r\n            css: {\r\n                width: '17px',\r\n                height: '17px',\r\n                backgroundImage: 'url(\"' + iconImg + '\")',\r\n                backgroundSize: 'contain',\r\n                backgroundRepeat: 'no-repeat',\r\n                margin: '1px',\r\n                borderRadius: '3px',\r\n            },\r\n        }),\r\n        title: LANG('brush-toggle-pressure'),\r\n        init: isChecked,\r\n        onChange: (b) => {\r\n            changeCallback(b);\r\n        },\r\n    });\r\n\r\n\r\n    return toggleEl.getElement();\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h8ubb\");","import {BB} from '../../../bb/bb';\r\n\r\nexport class BoxToggle {\r\n    el: HTMLElement;\r\n    value: boolean;\r\n\r\n    update (): void {\r\n        this.el.classList.toggle('kl-box-toggle--active', this.value);\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            label: string | HTMLElement | SVGElement;\r\n            title?: string;\r\n            init?: boolean;\r\n            onChange: (b: boolean) => void;\r\n        }\r\n    ) {\r\n        this.value = !!p.init;\r\n        this.el = BB.el({\r\n            content: p.label,\r\n            title: p.title,\r\n            className: (typeof p.label === 'string') ? 'kl-box-toggle' : 'kl-box-toggle kl-box-toggle--custom-el',\r\n            onClick: () => {\r\n                this.value = !this.value;\r\n                this.update();\r\n                p.onChange(this.value);\r\n            },\r\n            css: {\r\n                cursor: 'pointer',\r\n            },\r\n        });\r\n        if (typeof p.label !== 'string') {\r\n            BB.css(p.label, {\r\n                display: 'block',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n        this.update();\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.value;\r\n    }\r\n\r\n    setValue (b: boolean): void {\r\n        this.value = !!b;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.el);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport {IKlSliderConfig} from '../../kl-types';\r\nimport {languageStrings} from '../../../language/language';\r\nimport {KlSliderManualInput} from './kl-slider-manual-input';\r\nimport {SplineInterpolator} from '../../../bb/math/line';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {IPointerEvent} from '../../../bb/input/event.types';\r\n\r\n/**\r\n * Horizontal slider, can be changed by dragging anywhere on it. Has a label & value.\r\n * e.g. used for brush size\r\n *\r\n * left mouse button - set absolute value\r\n * right mouse button - change relative value\r\n * drag mouse vertically away - precision mode\r\n * double-click/tap slider - manual input mode\r\n *\r\n * Values can be spline interpolated\r\n * On change callback can be debounced\r\n *\r\n */\r\nexport class KlSlider {\r\n\r\n    /*\r\n    Three types of values\r\n    - value - the actual value, when using setValue(), getValue(), and what is emitted\r\n    - displayValue - the number that the user sees on the slider and in the manual input field\r\n        - might be further formatted with formatFunc\r\n        - also might be the same as value, if no toDisplayValue function provided\r\n    - sliderValue - the draggable position of the slider, 0 - 1\r\n     */\r\n\r\n    private value: number;\r\n\r\n    private readonly elementWidth: number;\r\n    private readonly elementHeight: number;\r\n    private isEnabled: boolean;\r\n\r\n    private min: number; // min value\r\n    private max: number; // max value\r\n    private useSpline: boolean;\r\n    private splineInterpolator: undefined | SplineInterpolator;\r\n    private readonly resolution: number;\r\n\r\n    private readonly isChangeOnFinal: boolean;\r\n    private readonly formatFunc: undefined | ((val: number) => number);\r\n\r\n    private readonly onChange: (val: number) => void;\r\n    private readonly valueToDisplayValue: (value: number) => number;\r\n    private readonly displayValueToValue: (displayValue: number) => number;\r\n\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly sliderWrapperEl: HTMLElement;\r\n    private readonly textEl: HTMLElement; // displays label, displayValue\r\n    private readonly label: string;\r\n    private readonly control: HTMLElement;\r\n    private manualInput: undefined | KlSliderManualInput;\r\n    private readonly manualInputRoundDigits: number | undefined;\r\n\r\n    private pointerListener: PointerListener | undefined;\r\n    private readonly pointerListenerTimeout: ReturnType<typeof setTimeout>;\r\n\r\n    private readonly eventResMs: undefined | number;\r\n    private emitValue: undefined | number; // next value for interval\r\n    private emitInterval: (ReturnType<typeof setTimeout> | undefined); // interval of eventResMs which calls onChange()\r\n\r\n    private valueToSliderValue (value: number): number {\r\n        if (this.useSpline && this.splineInterpolator) {\r\n            return this.splineInterpolator.findX(value, Math.floor(this.resolution)) || 0;\r\n        }\r\n        return (value - this.min) / (this.max - this.min);\r\n    }\r\n\r\n    private sliderValueToValue (sliderValue: number): number {\r\n        let result = this.min + sliderValue * (this.max - this.min);\r\n        if (this.useSpline && this.splineInterpolator) {\r\n            result = this.splineInterpolator.interpolate(sliderValue) || 0;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private updateLabel (): void {\r\n        let displayValue: number | string = this.valueToDisplayValue(this.value);\r\n        displayValue = this.formatFunc ? this.formatFunc(displayValue) : Math.round(displayValue);\r\n        displayValue = displayValue.toLocaleString(languageStrings.getCode());\r\n        this.textEl.innerHTML = this.label + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + displayValue + '</span>';\r\n\r\n        const sliderValue = this.valueToSliderValue(this.value);\r\n        this.control.style.width = (sliderValue * this.elementWidth) + 'px';\r\n    }\r\n\r\n    private emit (isFinal: boolean): void {\r\n        if (!isFinal && this.isChangeOnFinal) {\r\n            return;\r\n        }\r\n\r\n        if (isFinal || !this.eventResMs) {\r\n            this.onChange(this.value);\r\n            if (this.emitInterval) {\r\n                clearInterval(this.emitInterval);\r\n                this.emitInterval = undefined;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (this.emitInterval) {\r\n            this.emitValue = this.value;\r\n\r\n        } else {\r\n            this.onChange(this.value);\r\n\r\n            this.emitInterval = setInterval(() => {\r\n                if (this.emitValue === undefined) {\r\n                    clearInterval(this.emitInterval);\r\n                    this.emitInterval = undefined;\r\n                } else {\r\n                    this.onChange(this.emitValue);\r\n                    this.emitValue = undefined;\r\n                }\r\n            }, this.eventResMs);\r\n        }\r\n    }\r\n\r\n    private updateEnable (): void {\r\n        this.sliderWrapperEl.classList.toggle('slider-wrapper--disabled', !this.isEnabled);\r\n        BB.css(this.sliderWrapperEl, {\r\n            opacity: this.isEnabled ? '' : '0.5',\r\n            pointerEvents: this.isEnabled ? '' : 'none',\r\n        });\r\n        if (this.manualInput) {\r\n            this.manualInput.setIsEnabled(this.isEnabled);\r\n        }\r\n    }\r\n\r\n    private showManualInput (): void {\r\n\r\n        this.manualInput = new KlSliderManualInput(\r\n            this.valueToDisplayValue(this.value),\r\n            this.valueToDisplayValue(this.min),\r\n            this.valueToDisplayValue(this.max),\r\n            this.sliderWrapperEl.getBoundingClientRect(),\r\n            (val) => {\r\n                val = this.displayValueToValue(val);\r\n                this.setValue(BB.clamp(val, this.min, this.max));\r\n                this.onChange(this.value);\r\n            },\r\n            () => {\r\n                BB.css(this.sliderWrapperEl, {\r\n                    display: '',\r\n                });\r\n                if (this.manualInput) {\r\n                    this.rootEl.removeChild(this.manualInput.getElement());\r\n                    this.manualInput.destroy();\r\n                }\r\n                this.manualInput = undefined;\r\n            },\r\n            (this.manualInputRoundDigits && this.manualInputRoundDigits > 0) ? this.manualInputRoundDigits : 0,\r\n        );\r\n        this.rootEl.append(this.manualInput.getElement());\r\n        setTimeout(() => {\r\n            this.manualInput && this.manualInput.focus();\r\n        });\r\n        BB.css(this.sliderWrapperEl, {\r\n            display: 'none',\r\n        });\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        p: {\r\n            label: string;\r\n            width: number; // px\r\n            height: number; // px\r\n            min: number; // min value\r\n            max: number;\r\n            value: number;\r\n            resolution?: number; // int, if you want spline.findX() to use a custom resolution\r\n            curve?: 'quadratic' | [number, number][]; // optional. array is BB.SplineInterpolator points. 0-1\r\n            formatFunc?: (val: number) => number; // function to display a different number than value\r\n            onChange?: (val: number) => void;\r\n            isChangeOnFinal?: boolean; // only fire onChange on pointerUp\r\n            eventResMs?: number; // frequency of change events\r\n            isEnabled?: boolean; // default = true\r\n            manualInputRoundDigits?: number; // default 0, how value should be rounded for manual input\r\n            toDisplayValue?: (value: number) => number;\r\n            toValue?: (displayValue: number) => number;\r\n        }\r\n    ) {\r\n        this.isEnabled = p.isEnabled !== false;\r\n        this.manualInputRoundDigits = p.manualInputRoundDigits;\r\n        this.useSpline = !!p.curve;\r\n\r\n        if (!p.label) {\r\n            throw new Error('KlSlider missing params');\r\n        }\r\n        if (p.min != 0 && p.max != 0 && p.value != 0) {\r\n            if (!p.min || !p.max || !p.value) {\r\n                throw new Error('KlSlider broken params');\r\n            }\r\n        }\r\n        if (p.min >= p.max) {\r\n            throw new Error('KlSlider broken params');\r\n        }\r\n\r\n        this.min = p.min;\r\n        this.max = p.max;\r\n        this.value = BB.clamp(p.value, this.min, this.max);\r\n        this.elementWidth = p.width;\r\n        this.elementHeight = p.height;\r\n        this.resolution = p.resolution ? p.resolution : this.elementWidth * 2;\r\n\r\n        this.onChange = p.onChange ? p.onChange : () => {};\r\n        if (!p.toValue !== !p.toDisplayValue) {\r\n            throw new Error('both or neither have to be set, toValue and toDisplayValue');\r\n        }\r\n        this.displayValueToValue = p.toValue ? p.toValue : (displayValue) => displayValue;\r\n        this.valueToDisplayValue = p.toDisplayValue ? p.toDisplayValue : (value) => value;\r\n        this.isChangeOnFinal = !!p.isChangeOnFinal;\r\n        this.formatFunc = p.formatFunc;\r\n        this.eventResMs = p.eventResMs;\r\n\r\n        if (this.useSpline) {\r\n            if (!p.curve) {\r\n                throw new Error('curve needs to be set if useSpline true');\r\n            }\r\n            const curveArr: [number, number][] = p.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : p.curve;\r\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        }\r\n\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n        this.sliderWrapperEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'slider-wrapper',\r\n            css: {\r\n                overflow: 'hidden',\r\n                position: 'relative',\r\n                width: this.elementWidth + 'px',\r\n                height: this.elementHeight + 'px',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        this.label = p.label;\r\n        const labelFontSize = this.elementHeight - 14;\r\n        this.textEl = BB.el({\r\n            content: this.label,\r\n            css: {\r\n                position: 'absolute',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginLeft: '7px',\r\n                height: '100%',\r\n                fontSize: labelFontSize + 'px',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        this.control = BB.el({\r\n            className: 'slider-inner',\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                width: (this.valueToSliderValue(this.value) * this.elementWidth) + 'px',\r\n                height: this.elementHeight + 'px',\r\n            },\r\n        });\r\n        const controlInner = document.createElement('div');\r\n\r\n        this.sliderWrapperEl.append(this.control, this.textEl);\r\n        this.control.append(controlInner);\r\n\r\n        this.updateEnable();\r\n\r\n\r\n        const doubleTapper = new BB.DoubleTapper({\r\n            onDoubleTap: () => {\r\n                this.showManualInput();\r\n            },\r\n        });\r\n        doubleTapper.setAllowedButtonArr(['left', 'right']);\r\n        const eventChain = new BB.EventChain({\r\n            chainArr: [\r\n                doubleTapper,\r\n            ],\r\n        });\r\n\r\n        let virtualVal: number;\r\n        const onPointer = (event: IPointerEvent) => {\r\n            event.eventPreventDefault();\r\n\r\n            if (!this.isEnabled) {\r\n                return;\r\n            }\r\n\r\n            if (event.type === 'pointerdown') {\r\n\r\n                // unfocus manual slider input\r\n                BB.unfocusAnyInput();\r\n\r\n                this.sliderWrapperEl.className = 'slider-wrapper slider-wrapper--active';\r\n\r\n                if (event.button === 'left') {\r\n                    let sliderValue = event.relX / this.elementWidth;\r\n                    sliderValue = Math.max(0, Math.min(1, sliderValue));\r\n                    this.value = this.sliderValueToValue(sliderValue);\r\n                    this.updateLabel();\r\n                    this.emit(false);\r\n                }\r\n                virtualVal = this.valueToSliderValue(this.value);\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button || '')) {\r\n\r\n                let deltaX = event.dX;\r\n                const deltaY = Math.abs(event.pageY - (event.downPageY || 0));\r\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n                deltaX *= factor;\r\n                deltaX /= this.elementWidth;\r\n\r\n                virtualVal += deltaX;\r\n\r\n                const sliderValue = Math.max(0, Math.min(1, virtualVal));\r\n                this.value = this.sliderValueToValue(sliderValue);\r\n                this.updateLabel();\r\n                this.emit(false);\r\n            }\r\n\r\n            if (event.type === 'pointerup') {\r\n                this.sliderWrapperEl.className = 'slider-wrapper';\r\n                this.emit(true);\r\n            }\r\n\r\n        };\r\n\r\n        this.pointerListenerTimeout = setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.sliderWrapperEl,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    onPointer(e);\r\n                    eventChain.chainIn(e);\r\n                },\r\n                onWheel: (event) => {\r\n                    let sliderValue = this.valueToSliderValue(this.value);\r\n                    sliderValue = BB.clamp(sliderValue - event.deltaY / 40, 0, 1);\r\n                    this.value = this.sliderValueToValue(sliderValue);\r\n                    this.updateLabel();\r\n                    this.onChange(this.value);\r\n                },\r\n            });\r\n            this.updateLabel();\r\n        }, 1);\r\n    }\r\n\r\n    changeSliderValue (f: number): void {\r\n        if (!this.isEnabled) {\r\n            return;\r\n        }\r\n        let sliderValue = this.valueToSliderValue(this.value);\r\n        sliderValue = BB.clamp(sliderValue + f, 0, 1);\r\n        this.value = this.sliderValueToValue(sliderValue);\r\n        this.updateLabel();\r\n        this.onChange(this.value);\r\n    }\r\n\r\n    setValue (v: number): void {\r\n        this.value = BB.clamp(v, this.min, this.max);\r\n        this.updateLabel();\r\n    }\r\n\r\n    getValue (): number {\r\n        return this.value;\r\n    }\r\n\r\n    update (config: IKlSliderConfig): void {\r\n        this.min = config.min;\r\n        this.max = config.max;\r\n        this.useSpline = !!config.curve;\r\n        if (this.useSpline) {\r\n            if (!config.curve) {\r\n                throw new Error('curve needs to be set if useSpline true');\r\n            }\r\n            const curveArr = config.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : config.curve;\r\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        } else {\r\n            this.splineInterpolator = undefined;\r\n        }\r\n        this.setIsEnabled(!config.isDisabled);\r\n    }\r\n\r\n    setIsEnabled (e: boolean): void {\r\n        this.isEnabled = !!e;\r\n        this.updateEnable();\r\n    }\r\n\r\n    destroy (): void {\r\n        clearTimeout(this.pointerListenerTimeout);\r\n        this.pointerListener && this.pointerListener.destroy();\r\n        if (this.manualInput) {\r\n            this.manualInput.destroy();\r\n        }\r\n        if (this.emitInterval) {\r\n            clearInterval(this.emitInterval);\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n}\r\n","/**\r\n * To make sliders more fine-grained. The falloff when moving cursor away from cursor.\r\n * Returns the factor [0,1]\r\n *  0 -> infinite movement required for change of 1\r\n *  1 -> 1px movement for change of 1\r\n *\r\n * @param deltaY vertical distance from pointerdown\r\n * @param isRightButton\r\n */\r\nexport function calcSliderFalloffFactor (deltaY: number, isRightButton: boolean): number {\r\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\r\n    if (isRightButton) {\r\n        result *= 2;\r\n    }\r\n    return 1 / result;\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {input} from './input';\r\n\r\n/**\r\n * Used by KlSlider. Allows user to type in value in input (type=number) field, instead of dragging with mouse.\r\n * Input goes away when losing focus, or when pressing Enter/Escape.\r\n */\r\nexport class KlSliderManualInput {\r\n\r\n    private readonly input: HTMLInputElement;\r\n    private isEnabled: boolean;\r\n    private scrollBefore: { x: number; y: number }; // window scroll position on creation\r\n    private lastValue: number; // last emitted value\r\n    private isClosed: boolean = false;\r\n\r\n    private emit (): void {\r\n        if (this.lastValue !== Number(this.input.value)) {\r\n            this.onChange(Number(this.input.value));\r\n            this.lastValue = Number(this.input.value);\r\n        }\r\n    }\r\n\r\n    private privateOnClose (): void {\r\n        if (this.isClosed) {\r\n            return;\r\n        }\r\n        this.isClosed = true;\r\n\r\n        this.emit();\r\n        this.onClose();\r\n        setTimeout(() => {\r\n            // because iPad keyboard changes the scroll position\r\n            window.scrollTo(this.scrollBefore.x, this.scrollBefore.y);\r\n            this.scrollBefore = null;\r\n        });\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        value: number, // initial value (displayValue)\r\n        min: number,\r\n        max: number,\r\n        rect: DOMRect, // size of input field\r\n        private onChange: (displayValue: number) => void,\r\n        private onClose: () => void,\r\n        roundDigits?: number,\r\n    ) {\r\n\r\n        this.input = input({\r\n            type: 'number',\r\n            init: value,\r\n            min,\r\n            max,\r\n            callback: (val) => {\r\n                this.emit();\r\n            },\r\n        });\r\n        if (roundDigits !== 0) {\r\n            this.input.setAttribute('step', 'any');\r\n        }\r\n        this.input.onblur = () => {\r\n            this.privateOnClose();\r\n        };\r\n        this.input.addEventListener('keyup', (e) => {\r\n            if (['Enter', 'Escape'].includes(e.key)) {\r\n                this.privateOnClose();\r\n            } else {\r\n                this.emit();\r\n            }\r\n        });\r\n        this.input.addEventListener('wheel', () => this.emit());\r\n\r\n        this.scrollBefore = {\r\n            x: window.scrollX,\r\n            y: window.scrollY,\r\n        };\r\n\r\n        let currentValue;\r\n        if (roundDigits || roundDigits === 0) {\r\n            currentValue = BB.round(value, roundDigits);\r\n        } else {\r\n            currentValue = value;\r\n        }\r\n        this.lastValue = currentValue;\r\n        this.input.value = '' + currentValue;\r\n\r\n        BB.css(this.input, {\r\n            width: rect.width + 'px',\r\n            height: rect.height + 'px',\r\n        });\r\n    }\r\n\r\n    getElement () {\r\n        return this.input;\r\n    }\r\n\r\n    setIsEnabled (b: boolean): void {\r\n        this.isEnabled = !!b;\r\n    }\r\n\r\n    focus (): void {\r\n        this.input.focus();\r\n        this.input.select();\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.input);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {input} from '../components/input';\r\nimport {showModal} from './base/showModal';\r\nimport {LANG} from '../../../language/language';\r\nimport copyImg from '/src/app/img/ui/copy.svg';\r\nimport {IRGB} from '../../kl-types';\r\nimport {RGB} from '../../../bb/color/color';\r\n\r\n\r\ntype TInputRow = {\r\n    update: () => void;\r\n    destroy: () => void;\r\n};\r\n\r\n/**\r\n * dialog for manually inputting the color\r\n */\r\nexport class HexColorDialog {\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            color: IRGB;\r\n            onClose: (rgb: IRGB | null) => void;\r\n        }\r\n    ) {\r\n        let lastValidRgb: RGB = new BB.RGB(p.color.r, p.color.g, p.color.b);\r\n\r\n        const div = BB.el();\r\n\r\n        const previewEl = BB.el({\r\n            css: {\r\n                width: '20px',\r\n                height: '20px',\r\n                marginBottom: '10px',\r\n                boxShadow: 'inset 0 0 0 1px #fff, 0 0 0 1px #000',\r\n                background: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n            },\r\n        });\r\n        div.append(previewEl);\r\n\r\n\r\n        // --- Hex ---\r\n        const hexRowEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginBottom: '15px',\r\n            },\r\n        });\r\n        const hexLabel = BB.el({\r\n            content: LANG('mci-hex'),\r\n            css: {\r\n                width: '60px',\r\n            },\r\n        });\r\n        const hexInput = input({\r\n            init: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n            css: {\r\n                width: '80px',\r\n            },\r\n            callback: function () {\r\n                let rgbObj = BB.ColorConverter.hexToRGB(hexInput.value);\r\n                if (rgbObj === null) {\r\n                    rgbObj = lastValidRgb;\r\n                    hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                } else {\r\n                    lastValidRgb = rgbObj;\r\n                }\r\n                previewEl.style.background = '#' + BB.ColorConverter.toHexString(rgbObj);\r\n\r\n                for (let i = 0; i < rgbArr.length; i++) {\r\n                    rgbArr[i].update();\r\n                }\r\n            },\r\n        });\r\n        const copyButton = BB.el({\r\n            tagName: 'button',\r\n            content: '<img src=\"' + copyImg + '\" height=\"20\"/>',\r\n            title: LANG('mci-copy'),\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: function () {\r\n                hexInput.select();\r\n                document.execCommand('copy');\r\n            },\r\n        });\r\n        hexRowEl.append(hexLabel, hexInput, copyButton);\r\n        div.append(hexRowEl);\r\n        setTimeout(function () {\r\n            hexInput.focus();\r\n            hexInput.select();\r\n        }, 0);\r\n\r\n\r\n        // --- R G B ---\r\n        function createRgbInputRow (labelStr: string, attributeStr: 'r' | 'g' | 'b'): TInputRow {\r\n\r\n            const rowEl = BB.el({\r\n                css: {\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    marginTop: '5px',\r\n                },\r\n            });\r\n            const labelEl = BB.el({\r\n                content: labelStr,\r\n                css: {\r\n                    width: '60px',\r\n                },\r\n            });\r\n\r\n            const inputEl = input({\r\n                init: lastValidRgb[attributeStr],\r\n                min: 0,\r\n                max: 255,\r\n                type: 'number',\r\n                css: {\r\n                    width: '80px',\r\n                },\r\n                callback: function () {\r\n                    if (inputEl.value === '' || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\r\n                        result.update();\r\n                        return;\r\n                    }\r\n                    inputEl.value = '' + Math.round(parseFloat(inputEl.value));\r\n                    lastValidRgb[attributeStr] = Number(inputEl.value);\r\n                    previewEl.style.background = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                    hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                },\r\n            });\r\n\r\n            rowEl.append(labelEl, inputEl);\r\n            div.append(rowEl);\r\n\r\n            const result = {\r\n                update: () => {\r\n                    inputEl.value = '' + lastValidRgb[attributeStr];\r\n                },\r\n                destroy: () => {\r\n                    inputEl.onchange = null;\r\n                },\r\n            };\r\n            return result;\r\n        }\r\n        const rgbArr: TInputRow[] = [];\r\n        rgbArr.push(createRgbInputRow(LANG('red'), 'r'));\r\n        rgbArr.push(createRgbInputRow(LANG('green'), 'g'));\r\n        rgbArr.push(createRgbInputRow(LANG('blue'), 'b'));\r\n\r\n\r\n        showModal({\r\n            target: document.body,\r\n            message: `<b>${LANG('manual-color-input')}</b>`,\r\n            div: div,\r\n            autoFocus: false,\r\n            clickOnEnter: 'Ok',\r\n            buttons: ['Ok', 'Cancel'],\r\n            callback: function (resultStr) {\r\n                BB.destroyEl(copyButton);\r\n                rgbArr.forEach(item => item.destroy());\r\n                rgbArr.splice(0, rgbArr.length);\r\n\r\n                p.onClose(resultStr === 'Ok' ? BB.ColorConverter.hexToRGB(hexInput.value) : null);\r\n            },\r\n        });\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"htADd\");","import {BB} from '../../../bb/bb';\r\nimport {HexColorDialog} from '../modals/color-slider-hex-dialog';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport eyedropperImg from '/src/app/img/ui/tool-picker.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {IRGB} from '../../kl-types';\r\nimport {HSV, RGB} from '../../../bb/color/color';\r\nimport {ERASE_COLOR} from '../../brushes/erase-color';\r\n\r\n/**\r\n * big main HS+V color slider\r\n * 2 elements: slider, and colorpreview(output) + eyedropper\r\n */\r\nexport class KlColorSlider {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly outputDiv: HTMLElement;\r\n    private readonly divPreview: HTMLElement;\r\n    private readonly hexButton: HTMLElement;\r\n    private readonly secondaryColorBtn: HTMLElement;\r\n    private primaryColorRGB: RGB;\r\n    private primaryColorHSV: HSV;\r\n    private secondaryColorRGB: RGB;\r\n    private secondaryColorHSV: HSV;\r\n    private readonly controlH: HTMLElement;\r\n    private pickCallback: undefined | ((b: boolean) => void);\r\n    private isPicking: boolean;\r\n    private readonly pickerButton: HTMLElement;\r\n    private readonly width: number;\r\n    private readonly height: number; // hue slider and output height\r\n    private readonly hueStop: Element;\r\n\r\n    private readonly SVContainer: HTMLElement;\r\n    private readonly pointerSV: HTMLElement;\r\n    private svHeight: number;\r\n    private readonly svSvg: HTMLElement;\r\n\r\n    private readonly emitColor: (rgb: RGB) => void;\r\n\r\n\r\n\r\n    private updatePrimaryHSV (hsv: HSV): void {\r\n        if (hsv.s === 0) {\r\n            this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, hsv.s, hsv.v);\r\n        } else {\r\n            this.primaryColorHSV = new BB.HSV(hsv.h, hsv.s, hsv.v);\r\n        }\r\n    }\r\n\r\n    private updateSVCanvas (): void {\r\n        const rgb = BB.ColorConverter.toRGB(new BB.HSV(this.primaryColorHSV.h, 100, 100));\r\n        BB.setAttributes(this.hueStop, {\r\n            'stop-color': '#' + BB.ColorConverter.toHexString(rgb),\r\n        });\r\n    }\r\n\r\n    private updateSVPointer (): void {\r\n        const left = this.primaryColorHSV.s / 100 * this.width - 7;\r\n        const top = (1 - this.primaryColorHSV.v / 100) * this.svHeight - 6;\r\n        BB.css(this.pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px',\r\n        });\r\n    }\r\n\r\n    private setColPreview (): void {\r\n        this.divPreview.style.backgroundColor = 'rgb(' + this.primaryColorRGB.r + ',' + this.primaryColorRGB.g + ',' + this.primaryColorRGB.b + ')';\r\n\r\n        if (BB.testIsWhiteBestContrast(this.primaryColorRGB)) {\r\n            BB.css(this.pickerButton, {\r\n                filter: 'invert(1)',\r\n            });\r\n            BB.css(this.hexButton, {\r\n                filter: 'invert(1)',\r\n            });\r\n        } else{\r\n            BB.css(this.pickerButton, {\r\n                filter: '',\r\n            });\r\n            BB.css(this.hexButton, {\r\n                filter: '',\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    private updateSecondaryColor (): void {\r\n        this.secondaryColorBtn.style.backgroundColor = BB.ColorConverter.toRgbStr(this.secondaryColorRGB);\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number; // hue slider and output height\r\n            svHeight: number;\r\n            startValue: IRGB; // 0-255\r\n            onPick: (rgb: IRGB) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-color-picker',\r\n            css: {\r\n                position: 'relative',\r\n            },\r\n        });\r\n        this.outputDiv = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        this.width = p.width;\r\n        this.svHeight = p.svHeight;\r\n        this.height = p.height;\r\n        this.emitColor = p.onPick;\r\n\r\n        this.primaryColorRGB = {\r\n            r: parseInt('' + p.startValue.r),\r\n            g: parseInt('' + p.startValue.g),\r\n            b: parseInt('' + p.startValue.b),\r\n        };\r\n        this.primaryColorHSV = BB.ColorConverter.toHSV(p.startValue); // BB.HSV\r\n        this.secondaryColorRGB = {r: ERASE_COLOR, g: ERASE_COLOR, b: ERASE_COLOR};\r\n        this.secondaryColorHSV = BB.ColorConverter._RGBtoHSV(this.secondaryColorRGB); // BB.HSV\r\n\r\n        const svWrapper = BB.el();\r\n        this.svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"><defs><linearGradient id=\"value\" gradientTransform=\"rotate(90)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop offset=\"100%\" stop-color=\"#000\"/></linearGradient><linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/></linearGradient></defs><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\" style=\"mix-blend-mode: multiply\"/></svg>', 'image/svg+xml').documentElement;\r\n        {\r\n            const hueStop = this.svSvg.querySelector('#hue-stop');\r\n            if (!hueStop) {\r\n                throw Error('#hue-stop not found in svSvg');\r\n            }\r\n            this.hueStop = hueStop;\r\n        }\r\n        BB.setAttributes(this.hueStop, {\r\n            'stop-color': '#f0f',\r\n        });\r\n        BB.css(this.svSvg, {\r\n            width: this.width + 'px',\r\n            height: this.svHeight + 'px',\r\n        });\r\n        svWrapper.append(this.svSvg);\r\n\r\n        const divH = BB.el({\r\n            className: 'kl-color-picker__h',\r\n            css: {\r\n                overflow: 'hidden',\r\n                position: 'relative',\r\n                width: this.width + 'px',\r\n                height: this.height + 'px',\r\n                cursor: 'ew-resize',\r\n                marginTop: '1px',\r\n                marginBottom: '1px',\r\n            },\r\n        });\r\n        this.divPreview = BB.el({\r\n            className: 'kl-color-picker__preview',\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                width: (this.height * 2.5) + 'px',\r\n                height: this.height + 'px',\r\n            },\r\n        });\r\n        this.controlH = BB.el();\r\n\r\n\r\n\r\n        const createHueBg = (targetEl: HTMLElement) => {\r\n            const im = new Image();\r\n            BB.css(im, {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                display: 'none',\r\n                pointerEvents: 'none',\r\n            });\r\n            const cv = BB.canvas(this.width, this.height);\r\n            const ctx = BB.ctx(cv);\r\n            const gradH = ctx.createLinearGradient(0, 0, this.width, 0);\r\n            for (let i = 0; i < 1; i += 0.01) {\r\n                const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n                let ha = (parseInt('' + col.r)).toString(16);\r\n                let hb = (parseInt('' + col.g)).toString(16);\r\n                let hc = (parseInt('' + col.b)).toString(16);\r\n                if (ha.length === 1) {\r\n                    ha = '0' + ha;\r\n                }\r\n                if (hb.length === 1) {\r\n                    hb = '0' + hb;\r\n                }\r\n                if (hc.length === 1) {\r\n                    hc = '0' + hc;\r\n                }\r\n                gradH.addColorStop(i, '#' + ha + hb + hc);\r\n            }\r\n            ctx.fillStyle = gradH;\r\n            ctx.fillRect(0, 0, this.width, this.height);\r\n\r\n            targetEl.append(im);\r\n            im.alt = 'hue';\r\n            im.src = cv.toDataURL('image/png');\r\n            im.style.display = 'block';\r\n        };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        this.updateSVCanvas();\r\n        this.rootEl.style.width = this.width + 'px';\r\n        this.rootEl.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n\r\n        this.SVContainer = BB.el({\r\n            className: 'kl-color-picker__sv',\r\n            css: {\r\n                width: this.width + 'px',\r\n                height: this.svHeight + 'px',\r\n                overflow: 'hidden',\r\n                display: 'block',\r\n                position: 'relative',\r\n                cursor: 'crosshair',\r\n            },\r\n        });\r\n\r\n        this.pointerSV = BB.el({\r\n           css: {\r\n               width: '12px',\r\n               height: '12px',\r\n               borderRadius: '6px',\r\n               position: 'absolute',\r\n               pointerEvents: 'none',\r\n               boxShadow: '0px 0px 0 1px #000, inset 0px 0px 0 1px #fff',\r\n           },\r\n        });\r\n\r\n        this.SVContainer.append(svWrapper, this.pointerSV);\r\n        this.updateSVPointer();\r\n        this.rootEl.append(this.SVContainer, divH);\r\n        this.outputDiv.append(this.divPreview);\r\n\r\n        //divH.className = \"svSlider\";\r\n        BB.css(this.controlH, {\r\n            width: '1px',\r\n            height: this.height + 'px',\r\n            background: '#000',\r\n            borderLeft: '1px solid #fff',\r\n            position: 'absolute',\r\n            top: '0',\r\n            left: parseInt('' + (this.primaryColorHSV.h / 360 * this.width - 1)) + 'px',\r\n        });\r\n\r\n\r\n        const virtualHSV = {\r\n            h: 0,\r\n            s: 0,\r\n            v: 0,\r\n        };\r\n\r\n\r\n        this.pickerButton = BB.el({\r\n            title: LANG('eyedropper') + ' [Alt]',\r\n            className: 'color-picker-preview-button',\r\n            css: {\r\n                width: '30px',\r\n                height: '30px',\r\n                backgroundImage: 'url(' + eyedropperImg + ')',\r\n                backgroundRepeat:  'no-repeat',\r\n                backgroundSize: '70%',\r\n                backgroundPosition: 'center',\r\n            },\r\n            onClick: () => {\r\n                if (this.isPicking) {\r\n                    this.pickCallback && this.pickCallback(false);\r\n                    this.pickingDone();\r\n                } else {\r\n                    this.pickerButton.classList.remove('color-picker-preview-button-hover');\r\n                    this.pickerButton.classList.add('color-picker-preview-button-active');\r\n                    this.isPicking = true;\r\n                    this.pickCallback && this.pickCallback(true);\r\n                }\r\n            },\r\n        });\r\n        this.isPicking = false;\r\n\r\n        const pickerButtonPointerListener = new BB.PointerListener({\r\n            target: this.pickerButton,\r\n            onEnterLeave: (isOver) => {\r\n                if (this.isPicking) {\r\n                    return;\r\n                }\r\n                this.pickerButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n            },\r\n        });\r\n        this.divPreview.append(this.pickerButton);\r\n\r\n\r\n        this.hexButton = BB.el({\r\n            content: '#',\r\n            className: 'color-picker-preview-button',\r\n            title: LANG('manual-color-input'),\r\n            css: {\r\n                height: '100%',\r\n                width: this.height + 'px',\r\n                lineHeight: this.height + 'px',\r\n                fontSize: (this.height * 0.65) + 'px',\r\n            },\r\n            onClick: () => {\r\n                new HexColorDialog({\r\n                    color: new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b),\r\n                    onClose: (rgbObj) => {\r\n                        if (!rgbObj) {\r\n                            return;\r\n                        }\r\n                        this.setColor(rgbObj);\r\n                        this.emitColor(new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b));\r\n                    },\r\n                });\r\n            },\r\n        });\r\n        const hexButtonPointerListener = new BB.PointerListener({\r\n            target: this.hexButton,\r\n            onEnterLeave: (isOver) => {\r\n                this.hexButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n            },\r\n        });\r\n        this.divPreview.append(this.hexButton);\r\n\r\n        this.setColPreview();\r\n\r\n\r\n        setTimeout(() => {\r\n            createHueBg(divH);\r\n            divH.append(this.controlH);\r\n            const svPointerListener = new BB.PointerListener({\r\n                target: svWrapper,\r\n                fixScribble: true,\r\n                onPointer: (event) => {\r\n                    if (event.type === 'pointerdown') {\r\n\r\n                        // prevent manual slider input keeping focus on iPad\r\n                        BB.unfocusAnyInput();\r\n\r\n                        this.SVContainer.classList.toggle('kl-color-picker--active', true);\r\n\r\n                        if (event.button === 'left') {\r\n\r\n                            virtualHSV.s = event.relX / this.width * 100;\r\n                            virtualHSV.v = 100 - event.relY / this.svHeight * 100;\r\n\r\n                            this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                            this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n\r\n                            this.updateSVPointer();\r\n                            this.setColPreview();\r\n                            this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n                        } else {\r\n                            virtualHSV.s = this.primaryColorHSV.s;\r\n                            virtualHSV.v = this.primaryColorHSV.v;\r\n                        }\r\n                    }\r\n\r\n                    if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                        let factor = 1;\r\n                        if (event.button === 'right') {\r\n                            factor = 0.5;\r\n                        }\r\n\r\n                        virtualHSV.s += event.dX / this.width * 100 * factor;\r\n                        virtualHSV.v -= event.dY / this.svHeight * 100 * factor;\r\n\r\n                        this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                        this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n                        this.updateSVPointer();\r\n                        this.setColPreview();\r\n                        this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n\r\n                    }\r\n\r\n                    if (event.type === 'pointerup') {\r\n                        this.SVContainer.classList.toggle('kl-color-picker--active', false);\r\n                    }\r\n\r\n                },\r\n            });\r\n            const hPointerListener = new BB.PointerListener({\r\n                target: divH,\r\n                fixScribble: true,\r\n                onPointer: (event) => {\r\n\r\n                    if (event.type === 'pointerdown') {\r\n\r\n                        // prevent manual slider input keeping focus on iPad\r\n                        BB.unfocusAnyInput();\r\n\r\n                        divH.classList.toggle('kl-color-picker--active', true);\r\n\r\n                        if (event.button === 'left') {\r\n\r\n                            virtualHSV.h = event.relX / this.width * 359.99;\r\n\r\n                            this.primaryColorHSV = new BB.HSV(virtualHSV.h, this.primaryColorHSV.s, this.primaryColorHSV.v);\r\n                            this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n                            this.controlH.style.left = (Math.round(this.primaryColorHSV.h / 359.99 * this.width) - 1) + 'px';\r\n                            this.updateSVCanvas();\r\n                            this.setColPreview();\r\n                            this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n                        } else {\r\n                            virtualHSV.h = this.primaryColorHSV.h;\r\n                        }\r\n                    }\r\n\r\n                    if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                        const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                        const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                        virtualHSV.h += event.dX / this.width * 359.99 * factor;\r\n\r\n                        if (event.button === 'right') {\r\n                            virtualHSV.h = virtualHSV.h % 359.99;\r\n                            if (virtualHSV.h < 0) {\r\n                                virtualHSV.h += 359.99;\r\n                            }\r\n                        }\r\n                        virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                        this.primaryColorHSV = new BB.HSV(virtualHSV.h, this.primaryColorHSV.s, this.primaryColorHSV.v);\r\n                        this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n                        this.controlH.style.left = (Math.round(this.primaryColorHSV.h / 359.99 * this.width) - 1) + 'px';\r\n                        this.updateSVCanvas();\r\n                        this.setColPreview();\r\n                        this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n\r\n                    }\r\n\r\n                    if (event.type === 'pointerup') {\r\n                        divH.classList.toggle('kl-color-picker--active', false);\r\n                    }\r\n                },\r\n            });\r\n        }, 1);\r\n\r\n\r\n        // --- secondary color ---\r\n\r\n        this.secondaryColorBtn = BB.el({\r\n            parent: this.outputDiv,\r\n            title: LANG('secondary-color') + ' [X]',\r\n            className: 'kl-color-picker__secondary',\r\n            css: {\r\n                cursor: 'pointer',\r\n                marginLeft: '5px',\r\n                width: '22px',\r\n                height: '22px',\r\n            },\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                this.swapColors();\r\n            },\r\n        });\r\n        this.updateSecondaryColor();\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.primaryColorRGB = {r: parseInt('' + c.r), g: parseInt('' + c.g), b: parseInt('' + c.b)};\r\n        this.updatePrimaryHSV(BB.ColorConverter.toHSV(c));\r\n        this.controlH.style.left = parseInt('' + (this.primaryColorHSV.h / 359 * this.width - 1)) + 'px';\r\n        this.updateSVCanvas();\r\n        this.updateSVPointer();\r\n        this.setColPreview();\r\n    }\r\n\r\n    getColor (): RGB {\r\n        return new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b);\r\n    }\r\n\r\n    getSecondaryRGB (): RGB {\r\n        return new BB.RGB(this.secondaryColorRGB.r, this.secondaryColorRGB.g, this.secondaryColorRGB.b);\r\n    }\r\n\r\n    setPickCallback (func: (b: boolean) => void): void {\r\n        this.pickCallback = func;\r\n    }\r\n\r\n    pickingDone (): void {\r\n        if (!this.isPicking) {\r\n            return;\r\n        }\r\n        this.isPicking = false;\r\n        this.pickerButton.classList.remove('color-picker-preview-button-active');\r\n    }\r\n\r\n    enable (e: boolean): void {\r\n        if (e) {\r\n            this.rootEl.style.pointerEvents = '';\r\n            this.rootEl.style.opacity = '1';\r\n            this.outputDiv.style.pointerEvents = '';\r\n            this.outputDiv.style.opacity = '1';\r\n        } else {\r\n            this.rootEl.style.pointerEvents = 'none';\r\n            this.rootEl.style.opacity = '0.5';\r\n            this.outputDiv.style.pointerEvents = 'none';\r\n            this.outputDiv.style.opacity = '0.5';\r\n        }\r\n    }\r\n\r\n    setHeight (h: number): void {\r\n        h = parseInt('' +(h - this.height * 2 - 3), 10);\r\n        if (h === this.svHeight) {\r\n            return;\r\n        }\r\n        this.svHeight = h;\r\n        BB.css(this.svSvg, {\r\n            width: this.width + 'px',\r\n            height: this.svHeight + 'px',\r\n        });\r\n        this.SVContainer.style.height = this.svHeight + 'px';\r\n        this.updateSVPointer();\r\n    }\r\n\r\n    swapColors (): void {\r\n        // swap hsv\r\n        let tmp: RGB | HSV = this.secondaryColorHSV;\r\n        this.secondaryColorHSV = this.primaryColorHSV;\r\n        this.updatePrimaryHSV(tmp);\r\n        // swap rgb\r\n        tmp = this.secondaryColorRGB;\r\n        this.secondaryColorRGB = this.primaryColorRGB;\r\n        this.primaryColorRGB = tmp;\r\n\r\n        this.controlH.style.left = parseInt('' + (this.primaryColorHSV.h / 359 * this.width - 1)) + 'px';\r\n        this.updateSVCanvas();\r\n        this.updateSVPointer();\r\n        this.setColPreview();\r\n        this.updateSecondaryColor();\r\n\r\n        this.emitColor(new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b));\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getOutputElement (): HTMLElement {\r\n        return this.outputDiv;\r\n    }\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ffKNP\");","import {theme} from '../../theme/theme';\r\n\r\nexport const ERASE_COLOR = theme.isDark() ? 180 : 255;","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport {IRGB} from '../../kl-types';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {HSV} from '../../../bb/color/color';\r\n\r\n/**\r\n * a small color slider\r\n */\r\nexport class KlColorSliderSmall {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private color: HSV;\r\n    private readonly svPointerListener: PointerListener;\r\n    private readonly hPointerListener: PointerListener;\r\n    private svPointerId: number | null;\r\n    private hPointerId: number | null;\r\n    private readonly width: number;\r\n    private readonly heightSV: number;\r\n    private readonly pointerSV: HTMLElement;\r\n    private readonly pointerH: HTMLElement;\r\n    private readonly canvasSV: HTMLCanvasElement;\r\n\r\n\r\n    private updateSV (): void {\r\n        const ctx = BB.ctx(this.canvasSV);\r\n        if(!ctx) {\r\n            throw new Error('couldnt create canvas');\r\n        }\r\n        for (let i = 0; i < this.canvasSV.height; i += 1) {\r\n            const gradient1 = ctx.createLinearGradient(0, 0, this.canvasSV.width, 0);\r\n\r\n            const colleft = BB.ColorConverter.toRGB(new BB.HSV(this.color.h, 1, 100 - (i / this.canvasSV.height * 100.0)));\r\n            const colright = BB.ColorConverter.toRGB(new BB.HSV(this.color.h, 100, 100 - (i / this.canvasSV.height * 100.0)));\r\n            gradient1.addColorStop(0, '#' + BB.ColorConverter.toHexString(colleft));\r\n            gradient1.addColorStop(1, '#' + BB.ColorConverter.toHexString(colright));\r\n            ctx.fillStyle = '#ff0000'; //needed for chrome...otherwise alpha problem\r\n            ctx.fillStyle = gradient1;\r\n            ctx.fillRect(0, i, this.canvasSV.width, 1);\r\n        }\r\n    }\r\n\r\n    private updateSVPointer (): void {\r\n        const left = this.color.s / 100 * this.width - 4;\r\n        const top = (1 - this.color.v / 100) * this.heightSV - 4;\r\n        BB.css(this.pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px',\r\n        });\r\n    }\r\n\r\n    private updateHPointer (): void {\r\n        this.pointerH.style.left = (this.color.h / 359.999 * this.width - 1) + 'px';\r\n    }\r\n\r\n\r\n\r\n\r\n    // ----- public ----\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            heightSV: number; // height of saturation/value\r\n            heightH: number; // height of hue\r\n            color: IRGB;\r\n            callback: (c: IRGB) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                width: p.width + 'px',\r\n                position: 'relative',\r\n                overflow: 'hidden',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = (e) => {\r\n            e.preventDefault();\r\n        };\r\n        this.color = BB.ColorConverter.toHSV(new BB.RGB(p.color.r, p.color.g, p.color.b));\r\n        this.width = p.width;\r\n        this.heightSV = p.heightSV;\r\n\r\n        this.canvasSV = BB.canvas(10, 10);\r\n        BB.css(this.canvasSV, {\r\n            width: this.width + 'px',\r\n            height: this.heightSV + 'px',\r\n            cursor: 'crosshair',\r\n        });\r\n\r\n\r\n        this.updateSV();\r\n\r\n        const canvasH = BB.canvas(p.width, p.heightH);\r\n        canvasH.style.cursor = 'ew-resize';\r\n        (() => {\r\n            const ctx = BB.ctx(canvasH);\r\n\r\n            const gradH = ctx.createLinearGradient(0, 0, p.width, 0);\r\n            for (let i = 0; i < 1; i += 0.01) {\r\n                const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n                gradH.addColorStop(i, 'rgba(' + parseInt('' + col.r) + ', ' + parseInt('' + col.g) + ', ' + parseInt('' + col.b) + ', 1)');\r\n            }\r\n            ctx.fillStyle = gradH;\r\n            ctx.fillRect(0, 0, p.width, p.heightH);\r\n\r\n        })();\r\n        BB.css(this.canvasSV, {\r\n            width: p.width + 'px',\r\n            height: p.heightSV + 'px',\r\n            overflow: 'hidden',\r\n            position: 'relative',\r\n        });\r\n        this.canvasSV.style.cssFloat = 'left';\r\n        canvasH.style.cssFloat = 'left';\r\n\r\n        this.rootEl.append(this.canvasSV, canvasH);\r\n\r\n        this.pointerSV = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                width: '8px',\r\n                height: '8px',\r\n                borderRadius: '8px',\r\n                position: 'absolute',\r\n                pointerEvents: 'none',\r\n                boxShadow: '0 0 0 1px #000, inset 0 0 0 1px #fff',\r\n            },\r\n        });\r\n\r\n        this.pointerH = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                width: '0',\r\n                height: p.heightH + 'px',\r\n                borderLeft: '1px solid #fff',\r\n                borderRight: '1px solid #000',\r\n                position: 'absolute',\r\n                top: p.heightSV + 'px',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n\r\n        this.updateSVPointer();\r\n        this.updateHPointer();\r\n\r\n        const virtualHSV = {\r\n            h: 0,\r\n            s: 0,\r\n            v: 0,\r\n        };\r\n\r\n        this.svPointerId = null;\r\n        this.svPointerListener = new BB.PointerListener({\r\n            target: this.canvasSV,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n\r\n                if (event.type === 'pointerdown') {\r\n\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    BB.unfocusAnyInput();\r\n\r\n                    this.svPointerId = event.pointerId;\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.s = event.relX / p.width * 100;\r\n                        virtualHSV.v = 100 - event.relY / p.heightSV * 100;\r\n\r\n                        this.color = new BB.HSV(this.color.h, virtualHSV.s, virtualHSV.v);\r\n\r\n                        this.updateSVPointer();\r\n                        p.callback(BB.ColorConverter.toRGB(this.color));\r\n                    } else {\r\n                        virtualHSV.s = this.color.s;\r\n                        virtualHSV.v = this.color.v;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes('' + event.button) && this.svPointerId === event.pointerId) {\r\n\r\n                    let factor = 1;\r\n                    if (event.button === 'right') {\r\n                        factor = 0.5;\r\n                    }\r\n\r\n                    virtualHSV.s += event.dX / p.width * 100 * factor;\r\n                    virtualHSV.v -= event.dY / p.heightSV * 100 * factor;\r\n\r\n                    this.color = new BB.HSV(this.color.h, virtualHSV.s, virtualHSV.v);\r\n                    this.updateSVPointer();\r\n                    p.callback(BB.ColorConverter.toRGB(this.color));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.svPointerId = null;\r\n                }\r\n\r\n            },\r\n        });\r\n\r\n        this.hPointerId = null;\r\n        this.hPointerListener = new BB.PointerListener({\r\n            target: canvasH,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n\r\n                if (event.type === 'pointerdown') {\r\n                    this.hPointerId = event.pointerId;\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.h = event.relX / p.width * 359.99;\r\n\r\n                        this.color = new BB.HSV(virtualHSV.h, this.color.s, this.color.v);\r\n                        this.updateSV();\r\n                        this.updateHPointer();\r\n                        p.callback(BB.ColorConverter.toRGB(this.color));\r\n                    } else {\r\n                        virtualHSV.h = this.color.h;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes('' + event.button) && this.hPointerId === event.pointerId) {\r\n\r\n                    const deltaY = Math.abs(event.pageY - event.downPageY!);\r\n                    const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                    virtualHSV.h += event.dX / p.width * 359.99 * factor;\r\n\r\n                    if (event.button === 'right') {\r\n                        virtualHSV.h = virtualHSV.h % 359.99;\r\n                        if (virtualHSV.h < 0) {\r\n                            virtualHSV.h += 359.99;\r\n                        }\r\n                    }\r\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                    this.color = new BB.HSV(virtualHSV.h, this.color.s, this.color.v);\r\n                    this.updateSV();\r\n                    this.updateHPointer();\r\n                    p.callback(BB.ColorConverter.toRGB(this.color));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.hPointerId = null;\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n        const cleardiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                clear: 'both',\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n    setColor (c: IRGB): void {\r\n        this.color = BB.ColorConverter.toHSV(new BB.RGB(c.r, c.g, c.b));\r\n        this.updateSV();\r\n        this.updateSVPointer();\r\n        this.updateHPointer();\r\n    }\r\n\r\n    getColor (): IRGB {\r\n        return BB.ColorConverter.toRGB(this.color);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.svPointerListener.destroy();\r\n        this.hPointerListener.destroy();\r\n    }\r\n\r\n    end (): void {\r\n        this.svPointerId = null;\r\n        this.hPointerId = null;\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n/**\r\n * A slider that looks like this\r\n * ------O----\r\n */\r\nexport class PointSlider {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly sliderPoint: HTMLElement;\r\n    private readonly pointerListener: PointerListener;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            init: number;\r\n            width: number;\r\n            pointSize: number;\r\n            callback: (value: number, isFirst: boolean, isLast: boolean) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n            },\r\n        });\r\n        const sliderLine = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-point-slider__line',\r\n            css: {\r\n                marginTop: parseInt('' + (p.pointSize / 2 - 1)) + 'px',\r\n                width: p.width + 'px',\r\n            },\r\n        });\r\n        this.sliderPoint = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-point-slider__point',\r\n        });\r\n        let sliderPos: number;\r\n        let isDragging = false;\r\n\r\n        //sliderPoint\r\n        const touchAreaEl = BB.el({ // expand clickable area\r\n            parent: this.sliderPoint,\r\n            css: {\r\n                // background: 'rgba(255,0,0,0.4)',\r\n                margin: '-7px 0 0 -7px',\r\n                width: 'calc(100% + 14px)',\r\n                height: 'calc(100% + 7px)',\r\n            },\r\n        });\r\n\r\n        const redrawPoint = () => {\r\n            BB.css(this.sliderPoint, {\r\n                left: sliderPos + 'px',\r\n            });\r\n        };\r\n        const getValue = () => {\r\n            return sliderPos /  (p.width - p.pointSize);\r\n        };\r\n\r\n        {\r\n            let isFirst: boolean;\r\n            sliderPos = BB.clamp(p.init * (p.width - p.pointSize), 0, p.width - p.pointSize);\r\n            BB.css(this.sliderPoint, {\r\n                width: p.pointSize + 'px',\r\n                height: p.pointSize + 'px',\r\n                borderRadius: p.pointSize + 'px',\r\n            });\r\n            redrawPoint();\r\n            let imaginaryPos: number;\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.sliderPoint,\r\n                fixScribble: true,\r\n                onPointer: (event): void => {\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        isFirst = true;\r\n                        isDragging = true;\r\n                        imaginaryPos = sliderPos;\r\n                        redrawPoint();\r\n                        event.eventStopPropagation();\r\n                    } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                        event.eventStopPropagation();\r\n                        imaginaryPos = imaginaryPos + event.dX;\r\n                        sliderPos = parseInt('' + BB.clamp(imaginaryPos, 0, p.width - p.pointSize));\r\n                        redrawPoint();\r\n                        p.callback(getValue(), isFirst, false);\r\n                        isFirst = false;\r\n                    }\r\n                    if (event.type === 'pointerup') {\r\n                        event.eventStopPropagation();\r\n                        isDragging = false;\r\n                        redrawPoint();\r\n                        p.callback(getValue(), false, true);\r\n                    }\r\n                },\r\n            });\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getEl (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setActive (isActive: boolean): void {\r\n        this.sliderPoint.style.backgroundColor = isActive ? '#fff' : '#eaeaea';\r\n    }\r\n\r\n    destroy (): void {\r\n        this.pointerListener.destroy();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IRGBA} from '../../kl-types';\r\nimport {theme} from '../../../theme/theme';\r\n\r\n/**\r\n * UI to pick between colors in colorArr. can display full transparent (checkerboard).\r\n * Can't deal with 0.5 alpha.\r\n * Rectangular buttons.\r\n */\r\nexport class ColorOptions {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly buttonArr: {\r\n        el: HTMLElement;\r\n        setIsSelected: (b: boolean) => void;\r\n    }[];\r\n\r\n    private readonly updateCheckerboard: () => void;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            colorArr: IRGBA[]; // duplicates will be removed\r\n            onChange: (rgbaObj: IRGBA) => void;\r\n            label?: string;\r\n            initialIndex?: number; // index before duplicates were removed\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            content: p.label ? p.label : '',\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n\r\n        let selectedIndex = 0;\r\n        const colorArr: IRGBA[] = [];\r\n        this.buttonArr = [];\r\n        const buttonSize = 22;\r\n        const checkerUrl = BB.createCheckerDataUrl(5, undefined, theme.isDark());\r\n\r\n        // build colorArr while removing duplicates\r\n        for (let i = 0; i < p.colorArr.length; i++) {\r\n            const item = p.colorArr[i];\r\n            let found = false;\r\n            for (let e = 0; e < colorArr.length; e++) {\r\n                const sItem = colorArr[e];\r\n                if (sItem === null || item === null) {\r\n                    continue;\r\n                }\r\n                if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\r\n                    found = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (found) {\r\n                continue;\r\n            }\r\n            colorArr.push(item);\r\n            if ('initialIndex' in p && p.initialIndex === i) {\r\n                selectedIndex = colorArr.length - 1;\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < colorArr.length; i++) {\r\n            ((i) => {\r\n\r\n                const colorButton = BB.el({\r\n                    parent: this.rootEl,\r\n                    content: colorArr[i] ? '' : 'X',\r\n                    className: 'kl-color-option',\r\n                    css: {\r\n                        width: buttonSize + 'px',\r\n                        height: buttonSize + 'px',\r\n                        backgroundColor: colorArr[i] ? BB.ColorConverter.toRgbaStr(colorArr[i]) : 'transparent',\r\n                        lineHeight: (buttonSize + 1) + 'px',\r\n                    },\r\n                    onClick: (e) => {\r\n                        e.preventDefault();\r\n                        selectedIndex = i;\r\n                        update();\r\n                        p.onChange(colorArr[i]);\r\n                    },\r\n                });\r\n                if (colorArr[i] && colorArr[i].a === 0) {\r\n                    colorButton.style.backgroundImage = 'url(' + checkerUrl + ')';\r\n                }\r\n\r\n                const setIsSelected = (b: boolean): void => {\r\n                    colorButton.classList.toggle('kl-color-option--active', b);\r\n                };\r\n\r\n                this.buttonArr.push({\r\n                    el: colorButton,\r\n                    setIsSelected,\r\n                });\r\n            })(i);\r\n        }\r\n\r\n\r\n        const update = () => {\r\n            for (let i = 0; i < this.buttonArr.length; i++) {\r\n                this.buttonArr[i].setIsSelected(i === selectedIndex);\r\n            }\r\n        };\r\n        update();\r\n\r\n        this.updateCheckerboard = (): void => {\r\n            const checkerUrl = BB.createCheckerDataUrl(5, undefined, theme.isDark());\r\n            this.buttonArr.forEach((button, i) => {\r\n                if (colorArr[i] && colorArr[i].a === 0) {\r\n                    button.el.style.backgroundImage = 'url(' + checkerUrl + ')';\r\n                }\r\n            });\r\n        };\r\n        theme.addIsDarkListener(this.updateCheckerboard);\r\n    }\r\n\r\n    // ---- interface ----\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.buttonArr.forEach(item => {\r\n            BB.destroyEl(item.el);\r\n        });\r\n        this.buttonArr.splice(0, this.buttonArr.length);\r\n        theme.removeIsDarkListener(this.updateCheckerboard);\r\n    }\r\n\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * selectable options\r\n */\r\nexport class Options<IdType> {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private selectedId: IdType;\r\n    private readonly optionArr: {\r\n        id: IdType;\r\n        el: HTMLElement;\r\n    }[];\r\n    private readonly onChange: ((id: IdType) => void) | undefined;\r\n\r\n    private getIndex (): number {\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            if (this.optionArr[i].id === this.selectedId) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    private update (): void {\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            this.optionArr[i].el.classList.toggle(\r\n                'kl-option-selected',\r\n                this.optionArr[i].id === this.selectedId\r\n            );\r\n        }\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            optionArr: {\r\n                id: IdType;\r\n                label: string | HTMLElement | SVGElement;\r\n                title?: string;\r\n            }[];\r\n            initId?: IdType;\r\n            onChange?: (id: IdType) => void;\r\n            changeOnInit?: boolean; // trigger change on creation\r\n            isSmall? :boolean;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el();\r\n\r\n        const wrapperEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-option-wrapper',\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        if (p.onChange) {\r\n            this.onChange = p.onChange;\r\n        }\r\n        this.optionArr = [];\r\n        this.selectedId = ('initialId' in p && p.initId !== undefined) ? p.initId : p.optionArr[0].id;\r\n\r\n        const createOption = (o: {\r\n            id: IdType;\r\n            label: string | HTMLElement | SVGElement;\r\n            title?: string;\r\n        }) => {\r\n\r\n            const classArr = ['kl-option'];\r\n            if (p.isSmall) {\r\n                classArr.push('kl-option--small');\r\n            }\r\n            if (typeof o.label !== 'string') {\r\n                classArr.push('kl-option--custom-el');\r\n                BB.css(o.label, {\r\n                    display: 'block',\r\n                    pointerEvents: 'none',\r\n                });\r\n            }\r\n\r\n            const optionObj = {\r\n                id: o.id,\r\n                el: BB.el({\r\n                    parent: wrapperEl,\r\n                    content: o.label,\r\n                    className: classArr.join(' '),\r\n                    onClick: () => {\r\n                        if (this.selectedId !== optionObj.id) {\r\n                            this.selectedId = optionObj.id;\r\n                            this.update();\r\n                            this.onChange && this.onChange(this.selectedId);\r\n                        }\r\n                    },\r\n                }),\r\n            };\r\n\r\n            if (o.title) {\r\n                optionObj.el.title = o.title;\r\n            }\r\n\r\n            this.optionArr.push(optionObj);\r\n        };\r\n\r\n        for (let i = 0; i < p.optionArr.length; i++) {\r\n            createOption(p.optionArr[i]);\r\n        }\r\n\r\n        this.update();\r\n\r\n        if (p.changeOnInit) {\r\n            setTimeout(() => {\r\n                this.onChange && this.onChange(this.selectedId);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValue (): IdType {\r\n        return this.selectedId;\r\n    }\r\n\r\n    next (): void {\r\n        this.selectedId = this.optionArr[(this.getIndex() + 1) % this.optionArr.length].id;\r\n        this.update();\r\n        this.onChange && this.onChange(this.selectedId);\r\n    }\r\n\r\n    previous (): void {\r\n        this.selectedId = this.optionArr[(this.optionArr.length + this.getIndex() - 1) % this.optionArr.length].id;\r\n        this.update();\r\n        this.onChange && this.onChange(this.selectedId);\r\n    }\r\n\r\n    destroy (): void {\r\n        this.optionArr.forEach(item => {\r\n            BB.destroyEl(item.el);\r\n        });\r\n        this.optionArr.splice(0, this.optionArr.length);\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport angleSvg from '/src/app/img/ui/angle.svg';\r\n\r\n\r\ntype TUiState = 'left' | 'right';\r\n\r\n/**\r\n * display little messages at the top of KlWorkspace\r\n */\r\nexport class StatusOverlay {\r\n\r\n    private el: HTMLDivElement;\r\n    private innerEl: HTMLDivElement;\r\n    private angleIm: HTMLImageElement;\r\n    private innerInnerEl: HTMLDivElement;\r\n    private isWide: boolean;\r\n    private uiState: TUiState;\r\n\r\n    private timeout: number;\r\n    private timeout2: number;\r\n    private timeout3: number;\r\n\r\n    private updateUiState () {\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n        setTimeout(()=>{}, 100);\r\n        if (this.uiState === 'left') {\r\n            this.el.style.left = '271px';\r\n        } else {\r\n            this.el.style.removeProperty('left');\r\n        }\r\n    }\r\n\r\n    private init () {\r\n        this.el = BB.el({\r\n            className: 'top-overlay g-root',\r\n            onClick: BB.handleClick,\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n        }\r\n\r\n        this.updateUiState();\r\n\r\n        this.innerEl = BB.el({\r\n            className: 'top-overlay--inner',\r\n        }) as HTMLDivElement;\r\n\r\n\r\n        this.angleIm = new Image();\r\n        this.angleIm.src = angleSvg;\r\n        BB.css(this.angleIm, {\r\n            verticalAlign: 'bottom',\r\n            width: '20px',\r\n            height: '20px',\r\n            marginLeft: '5px',\r\n            borderRadius: '10px',\r\n        });\r\n\r\n        this.innerInnerEl = document.createElement('div');\r\n        this.innerInnerEl.style.display = 'inline-block';\r\n\r\n        this.innerEl.append(this.innerInnerEl, this.angleIm);\r\n        this.el.append(this.innerEl);\r\n        document.body.append(this.el);\r\n        this.el.style.display = 'none';\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        this.init();\r\n    }\r\n\r\n    setWide (b: boolean) {\r\n        this.isWide = !!b;\r\n\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n            this.el.style.left = '';\r\n        } else {\r\n            this.el.style.removeProperty('width');\r\n            this.el.style.left = this.uiState === 'left' ? '271px' : '';\r\n        }\r\n    }\r\n\r\n    setUiState (state: TUiState) {\r\n        this.uiState = state;\r\n        this.updateUiState();\r\n    }\r\n\r\n    out (msg: string | {type: 'transform'; angleDeg: number; scale: number}, doPulse?: boolean) {\r\n\r\n        if (msg && typeof msg === 'object') {\r\n\r\n            if (msg.type === 'transform') {\r\n                this.angleIm.style.display = 'inline-block';\r\n                this.angleIm.style.transform = 'rotate(' + msg.angleDeg + 'deg)';\r\n\r\n                if (msg.angleDeg % 90 === 0) {\r\n                    this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255, 255, 255, 0.7)';\r\n                } else {\r\n                    this.angleIm.style.boxShadow = '';\r\n                }\r\n\r\n                this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + '%';\r\n\r\n\r\n            } else {\r\n                this.angleIm.style.display = 'none';\r\n            }\r\n\r\n\r\n\r\n        } else if (typeof msg === 'string') {\r\n            this.angleIm.style.display = 'none';\r\n            this.innerInnerEl.innerHTML = msg;\r\n        }\r\n\r\n        if (doPulse) {\r\n            this.innerEl.style.animation = '';\r\n            setTimeout(\r\n                () => this.innerEl.style.animation = 'topOverlayPulse 0.5s ease-out',\r\n                20\r\n            );\r\n            if (this.timeout3) {\r\n                clearTimeout(this.timeout3);\r\n            }\r\n            this.timeout3 = window.setTimeout(\r\n                () => this.innerEl.style.animation = '',\r\n                520\r\n            );\r\n        }\r\n\r\n\r\n\r\n        if (this.timeout) {\r\n            clearTimeout(this.timeout);\r\n        }\r\n        if (this.timeout2) {\r\n            clearTimeout(this.timeout2);\r\n        }\r\n        this.el.style.animationName = doPulse ? 'consoleInFast' : 'consoleIn';\r\n        this.el.style.opacity = '1';\r\n        this.timeout = window.setTimeout(() => {\r\n            this.el.style.opacity = '0';\r\n            this.el.style.animationName = 'consoleOut';\r\n            this.timeout2 = window.setTimeout(() => {\r\n                this.el.style.display = 'none';\r\n                this.timeout2 = 0;\r\n            }, 450);\r\n            this.timeout = 0;\r\n        }, 1200);\r\n        this.el.style.display = 'flex';\r\n    }\r\n\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iqIgb\");","import {BB} from '../../../bb/bb';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {IRect, IVector2D} from '../../../bb/bb-types';\r\nimport {theme} from '../../../theme/theme';\r\n\r\n/**\r\n * element that lets you crop an image and copy it via right click\r\n */\r\nexport class CropCopy {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly eventTarget: HTMLElement;\r\n    private crop: IRect = {x: 0, y: 0, width: 0, height: 0};\r\n    private readonly croppedCanvas: HTMLCanvasElement;\r\n    private readonly keyListener: KeyListener;\r\n    private readonly pointerListener: PointerListener;\r\n    private readonly canvas: HTMLImageElement | HTMLCanvasElement;\r\n    private readonly onChange: undefined | ((width: number, height: number) => void);\r\n    private readonly selectionRect: HTMLElement;\r\n    private readonly thumbX: number;\r\n    private readonly thumbY: number;\r\n    private readonly scaleW: number;\r\n    private readonly scaleH: number;\r\n    private readonly croppedImage: undefined | HTMLImageElement;\r\n\r\n\r\n    private resetCrop (): void {\r\n        this.crop = {\r\n            x: 0,\r\n            y: 0,\r\n            width: this.canvas.width,\r\n            height: this.canvas.height,\r\n        };\r\n    }\r\n    private updateCroppedCanvas (): void {\r\n        this.croppedCanvas.width = Math.round(this.crop.width);\r\n        this.croppedCanvas.height = Math.round(this.crop.height);\r\n        const ctx = BB.ctx(this.croppedCanvas);\r\n        ctx.drawImage(this.canvas, Math.round(-this.crop.x), Math.round(-this.crop.y));\r\n        if (this.croppedImage) {\r\n            this.croppedImage.src = this.croppedCanvas.toDataURL('image/png');\r\n        }\r\n\r\n        this.onChange && this.onChange(this.croppedCanvas.width, this.croppedCanvas.height);\r\n    }\r\n    private updateSelectionRect (): void {\r\n        BB.css(this.selectionRect, {\r\n            left: (this.thumbX + this.crop.x * this.scaleW) + 'px',\r\n            top: (this.thumbY + this.crop.y * this.scaleH) + 'px',\r\n            width: (this.crop.width * this.scaleW) + 'px',\r\n            height: (this.crop.height * this.scaleH) + 'px',\r\n        });\r\n        this.onChange && this.onChange(Math.round(this.crop.width), Math.round(this.crop.height));\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        param: {\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLImageElement | HTMLCanvasElement;\r\n            isNotCopy: boolean;\r\n            onChange?: (width: number, height: number) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-edit-crop-preview',\r\n            css: {\r\n                position: 'relative',\r\n                height: param.height + 'px',\r\n                width: param.width + 'px',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n        if (param.onChange) {\r\n            this.onChange = param.onChange;\r\n        }\r\n        this.canvas = param.canvas;\r\n\r\n        this.resetCrop();\r\n\r\n\r\n\r\n\r\n        const isInsideSelectionRect = (p: IVector2D): boolean => {\r\n            const rect = {\r\n                x: Math.round(this.thumbX + this.crop.x * this.scaleW),\r\n                y: Math.round(this.thumbY + this.crop.y * this.scaleH),\r\n                width: Math.round(this.crop.width * this.scaleW),\r\n                height: Math.round(this.crop.height * this.scaleH),\r\n            };\r\n            return BB.isInsideRect(p, rect);\r\n        };\r\n\r\n        this.croppedCanvas = BB.canvas();\r\n        this.eventTarget = this.croppedCanvas;\r\n        if (!param.isNotCopy) {\r\n            this.croppedImage = new Image();\r\n            this.eventTarget = this.croppedImage;\r\n        }\r\n        BB.css(this.eventTarget, {\r\n            height: param.height + 'px',\r\n            width: param.width + 'px',\r\n        });\r\n        this.rootEl.append(this.eventTarget);\r\n        this.updateCroppedCanvas();\r\n\r\n        const padding = 20;\r\n        const previewWrapper = BB.el({\r\n            css: {\r\n                width: param.width + 'px',\r\n                height: param.height + 'px',\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        this.rootEl.append(previewWrapper);\r\n        BB.createCheckerDataUrl(4, (v) => {\r\n            previewWrapper.style.backgroundImage = 'url('+v+')';\r\n        }, theme.isDark());\r\n\r\n        const thumbSize = BB.fitInto(this.canvas.width, this.canvas.height, param.width - padding * 2, param.height - padding * 2, 1);\r\n        const thumbCanvas = BB.canvas(Math.round(thumbSize.width), Math.round(thumbSize.height));\r\n        thumbCanvas.style.imageRendering = 'pixelated';\r\n        this.scaleW = thumbCanvas.width / this.canvas.width;\r\n        this.scaleH = thumbCanvas.height / this.canvas.height;\r\n        const thumbCtx = BB.ctx(thumbCanvas);\r\n        thumbCtx.imageSmoothingEnabled = false;\r\n        thumbCtx.drawImage(this.canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);\r\n        previewWrapper.append(thumbCanvas);\r\n        this.thumbX = parseInt('' + ((param.width - thumbCanvas.width) / 2));\r\n        this.thumbY = parseInt('' + ((param.height - thumbCanvas.height) / 2));\r\n        BB.css(thumbCanvas, {\r\n            position: 'absolute',\r\n            left: this.thumbX + 'px',\r\n            top: this.thumbY + 'px',\r\n        });\r\n\r\n        this.selectionRect = BB.el({\r\n            parent: previewWrapper,\r\n            className: 'kl-edit-crop-preview__sel',\r\n        });\r\n        this.updateSelectionRect();\r\n\r\n\r\n        const toOriginalSpace = (p: IVector2D): IVector2D => {\r\n            return {\r\n                x: BB.clamp((p.x - this.thumbX) / this.scaleW, 0, this.canvas.width),\r\n                y: BB.clamp((p.y - this.thumbY) / this.scaleH, 0, this.canvas.height),\r\n            };\r\n        };\r\n        //gen crop from thumb-space points\r\n        const genCrop = (p1: IVector2D, p2: IVector2D): IRect => {\r\n            const topLeftP = {\r\n                x: Math.min(p1.x, p2.x),\r\n                y: Math.min(p1.y, p2.y),\r\n            };\r\n            const bottomRightP = {\r\n                x: Math.max(p1.x, p2.x),\r\n                y: Math.max(p1.y, p2.y),\r\n            };\r\n            const origTopLeftP = toOriginalSpace(topLeftP);\r\n            const origBottomRightP = toOriginalSpace(bottomRightP);\r\n            origTopLeftP.x = Math.floor(origTopLeftP.x);\r\n            origTopLeftP.y = Math.floor(origTopLeftP.y);\r\n            origBottomRightP.x = Math.ceil(origBottomRightP.x);\r\n            origBottomRightP.y = Math.ceil(origBottomRightP.y);\r\n            return {\r\n                x: origTopLeftP.x,\r\n                y: origTopLeftP.y,\r\n                width: origBottomRightP.x - origTopLeftP.x,\r\n                height: origBottomRightP.y - origTopLeftP.y,\r\n            };\r\n        };\r\n\r\n\r\n\r\n        let startP: IVector2D | null;\r\n        let startCrop: IRect | null = null;\r\n        let isDragging = false;\r\n        let didMove = false;\r\n        let updateCropTimeout: ReturnType<typeof setTimeout>;\r\n        this.pointerListener = new BB.PointerListener({\r\n            target: this.eventTarget,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    event.eventPreventDefault();\r\n                    isDragging = true;\r\n                    startP = {\r\n                        x: event.relX,\r\n                        y: event.relY,\r\n                    };\r\n                    if (!this.isReset() && isInsideSelectionRect(startP)) {\r\n                        startCrop = {\r\n                            x: this.crop.x,\r\n                            y: this.crop.y,\r\n                            width: this.crop.width,\r\n                            height: this.crop.height,\r\n                        };\r\n                    } else {\r\n                        this.crop = genCrop(startP, startP);\r\n                    }\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                    event.eventPreventDefault();\r\n                    didMove = true;\r\n                    if (startCrop) {\r\n                        this.crop.x = startCrop.x + Math.round((event.relX - startP!.x) / this.scaleW);\r\n                        this.crop.y = startCrop.y + Math.round((event.relY - startP!.y) / this.scaleH);\r\n                        this.crop.x = BB.clamp(this.crop.x, 0, this.canvas.width - this.crop.width);\r\n                        this.crop.y = BB.clamp(this.crop.y, 0, this.canvas.height - this.crop.height);\r\n                    } else {\r\n                        this.crop = genCrop(startP!, {x: event.relX, y: event.relY});\r\n                    }\r\n                    this.updateSelectionRect();\r\n                } else if (event.type === 'pointerup' && startP) {\r\n                    event.eventPreventDefault();\r\n                    isDragging = false;\r\n                    startCrop = null;\r\n                    startP = null;\r\n                    if (this.crop.width === 0 || this.crop.height === 0 || !didMove) {\r\n                        this.resetCrop();\r\n                        this.updateSelectionRect();\r\n                    }\r\n                    didMove = false;\r\n                    updateCropTimeout = setTimeout(() => this.updateCroppedCanvas(), 1);\r\n                }\r\n            },\r\n        });\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, e, comboStr) => {\r\n                if (isDragging) {\r\n                    return;\r\n                }\r\n                let doUpdate = false;\r\n\r\n                const stepSize = Math.max(1, 1 / this.scaleW);\r\n                const shiftIsPressed = this.keyListener.isPressed('shift');\r\n\r\n                if (keyStr === 'left') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.width = BB.clamp(this.crop.width - stepSize, 1, this.canvas.width - this.crop.x);\r\n                    } else {\r\n                        this.crop.x = BB.clamp(this.crop.x - stepSize, 0, this.canvas.width - this.crop.width);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n                if (keyStr === 'right') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.width = BB.clamp(this.crop.width + stepSize, 1, this.canvas.width - this.crop.x);\r\n                    } else {\r\n                        this.crop.x = BB.clamp(this.crop.x + stepSize, 0, this.canvas.width - this.crop.width);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n                if (keyStr === 'up') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.height = BB.clamp(this.crop.height - stepSize, 1, this.canvas.height - this.crop.y);\r\n                    } else {\r\n                        this.crop.y = BB.clamp(this.crop.y - stepSize, 0, this.canvas.height - this.crop.height);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n                if (keyStr === 'down') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.height = BB.clamp(this.crop.height + stepSize, 1, this.canvas.height - this.crop.y);\r\n                    } else {\r\n                        this.crop.y = BB.clamp(this.crop.y + stepSize, 0, this.canvas.height - this.crop.height);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n\r\n                if (doUpdate) {\r\n                    e.preventDefault();\r\n                    this.updateSelectionRect();\r\n                    clearTimeout(updateCropTimeout);\r\n                    updateCropTimeout = setTimeout(() => this.updateCroppedCanvas(), 100);\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getEl (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n    reset (): void {\r\n        this.resetCrop();\r\n        this.updateCroppedCanvas();\r\n        this.updateSelectionRect();\r\n    }\r\n    destroy (): void {\r\n        this.eventTarget.style.removeProperty('width');\r\n        this.eventTarget.style.removeProperty('height');\r\n        this.keyListener.destroy();\r\n        this.pointerListener.destroy();\r\n    }\r\n    isReset (): boolean {\r\n        return this.crop.x === 0 && this.crop.y === 0 && this.crop.width === this.canvas.width && this.crop.height === this.canvas.height;\r\n    }\r\n    getRect (): IRect {\r\n        return BB.copyObj(this.crop);\r\n    }\r\n    getCroppedImage (): HTMLCanvasElement {\r\n        return this.croppedCanvas;\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {showModal} from './base/showModal';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {LANG} from '../../../language/language';\r\nimport {StatusOverlay} from '../components/status-overlay';\r\nimport {ICropRect} from '../../../bb/bb-types';\r\n\r\nexport function clipboardDialog (\r\n    parent: HTMLElement,\r\n    fullCanvas: HTMLCanvasElement,\r\n    cropCallback: (crop: ICropRect) => void,\r\n    output: StatusOverlay,\r\n    showCrop: boolean, // show crop button\r\n): void {\r\n\r\n    let clipboardItemIsSupported: boolean = false;\r\n    try {\r\n        clipboardItemIsSupported = !!ClipboardItem;\r\n    } catch (e) {}\r\n\r\n    const div = document.createElement('div');\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n\r\n    const topWrapper = BB.el({\r\n        content: LANG('crop-drag-to-crop') + (clipboardItemIsSupported ? '' : '<br>' + LANG('cropcopy-click-hold')),\r\n        css: {\r\n            textAlign: 'center',\r\n        },\r\n    });\r\n    div.append(topWrapper);\r\n\r\n\r\n    const cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 350,\r\n        canvas: fullCanvas,\r\n        isNotCopy: false,\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n    });\r\n    div.append(cropCopy.getEl());\r\n\r\n    function toClipboard () {\r\n        const imgURL = cropCopy.getCroppedImage().toDataURL('image/png');\r\n        setTimeout(async function () {\r\n            try {\r\n                const data = await fetch(imgURL);\r\n                const blob = await data.blob();\r\n                await (navigator.clipboard as any).write([\r\n                    new ClipboardItem({\r\n                        [blob.type]: blob,\r\n                    } as any), // todo check is possible?\r\n                ]);\r\n                setTimeout(function () {\r\n                    output.out(LANG('cropcopy-copied'), true);\r\n                }, 200);\r\n            } catch (err) {\r\n                console.error(err.name, err.message);\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, KeyEvent, comboStr) {\r\n            if (comboStr === 'ctrl+c') {\r\n                toClipboard();\r\n                closeFunc && closeFunc();\r\n            }\r\n        },\r\n    });\r\n\r\n    let closeFunc: () => void;\r\n    function blur () {\r\n        closeFunc && closeFunc();\r\n    }\r\n    window.addEventListener('blur', blur);\r\n\r\n    const buttonArr = [];\r\n    if (clipboardItemIsSupported) {\r\n        buttonArr.push(LANG('cropcopy-btn-copy'));\r\n    }\r\n    if (showCrop) {\r\n        buttonArr.push(LANG('cropcopy-btn-crop'));\r\n    }\r\n    buttonArr.push('Cancel');\r\n\r\n    showModal({\r\n        target: parent,\r\n        message: '<b>' + (showCrop ? `${LANG('cropcopy-title-copy')} / ${LANG('cropcopy-title-crop')}` : `${LANG('cropcopy-title-copy')}`) + '</b>',\r\n        div: div,\r\n        style: isSmall ? {} : {\r\n            width: '500px',\r\n        },\r\n        buttons: buttonArr,\r\n        primaries: [LANG('cropcopy-btn-copy')],\r\n        callback: function (result) {\r\n            if (result === LANG('cropcopy-btn-copy')) {\r\n                toClipboard();\r\n            } else if (result === LANG('cropcopy-btn-crop')) {\r\n                const rectObj = cropCopy.getRect();\r\n                cropCallback({\r\n                    left: Math.round(-rectObj.x),\r\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\r\n                    top: Math.round(-rectObj.y),\r\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height),\r\n                });\r\n            }\r\n            window.removeEventListener('blur', blur);\r\n            cropCopy.destroy();\r\n            keyListener.destroy();\r\n        },\r\n        clickOnEnter: LANG('cropcopy-btn-copy'),\r\n        closeFunc: function (func) {\r\n            closeFunc = func;\r\n        },\r\n    });\r\n}","import {BB} from '../../../../bb/bb';\r\nimport {klHistory} from '../../../history/kl-history';\r\nimport {Select} from '../../components/select';\r\nimport {PointSlider} from '../../components/point-slider';\r\nimport {KlCanvas, MAX_LAYERS} from '../../../canvas/kl-canvas';\r\nimport {TMixMode, TUiLayout} from '../../../kl-types';\r\nimport {LANG} from '../../../../language/language';\r\nimport {translateBlending} from '../../../canvas/translate-blending';\r\nimport {PointerListener} from '../../../../bb/input/pointer-listener';\r\nimport {IPointerEvent} from '../../../../bb/input/event.types';\r\nimport {renameLayerDialog} from './rename-layer-dialog';\r\nimport {mergeLayerDialog} from './merge-layer-dialog';\r\nimport addLayerImg from '/src/app/img/ui/add-layer.svg';\r\nimport duplicateLayerImg from '/src/app/img/ui/duplicate-layer.svg';\r\nimport mergeLayerImg from '/src/app/img/ui/merge-layers.svg';\r\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\r\nimport renameLayerImg from '/src/app/img/ui/rename-layer.svg';\r\nimport {theme} from '../../../../theme/theme';\r\n\r\ntype TLayerEl = HTMLElement & {\r\n    label: HTMLElement;\r\n    opacityLabel: HTMLElement;\r\n    thumb: HTMLCanvasElement;\r\n\r\n    spot: number;\r\n    posY: number;\r\n    layerName: string;\r\n    opacity: number;\r\n    pointerListener: PointerListener;\r\n    opacitySlider: PointSlider;\r\n    isSelected: boolean;\r\n};\r\n\r\nexport class LayerManager {\r\n\r\n    private readonly parentEl: HTMLElement;\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly klCanvas: KlCanvas;\r\n    private klCanvasLayerArr: {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: TMixMode;\r\n    }[];\r\n    private readonly layerListEl: HTMLElement;\r\n    private layerElArr: TLayerEl[];\r\n    private selectedSpotIndex: number;\r\n    private readonly removeBtn: HTMLButtonElement;\r\n    private readonly addBtn: HTMLButtonElement;\r\n    private readonly duplicateBtn: HTMLButtonElement;\r\n    private readonly mergeBtn: HTMLButtonElement;\r\n    private readonly modeSelect: Select;\r\n    private uiState: TUiLayout;\r\n    private readonly largeThumbDiv: HTMLElement;\r\n    private oldHistoryState: number | undefined;\r\n\r\n    private readonly largeThumbCanvas: HTMLCanvasElement;\r\n    private largeThumbInDocument: boolean;\r\n    private largeThumbInTimeout: undefined | ReturnType<typeof setTimeout>;\r\n    private largeThumbTimeout: undefined | ReturnType<typeof setTimeout>;\r\n    private lastpos: number = 0;\r\n\r\n    private readonly onSelect: (layerIndex: number) => void;\r\n    private readonly layerHeight: number = 35;\r\n    private readonly layerSpacing: number = 0;\r\n\r\n    private move (oldSpotIndex: number, newSpotIndex: number): void {\r\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) {\r\n            throw 'layermanager - invalid move';\r\n        }\r\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\r\n            ((i) => {\r\n                let posy = this.layerElArr[i].spot; // <- here\r\n                if (this.layerElArr[i].spot === oldSpotIndex) {\r\n                    posy = newSpotIndex;\r\n                } else {\r\n                    if (this.layerElArr[i].spot > oldSpotIndex) {\r\n                        posy--;\r\n                    }\r\n                    if (posy >= newSpotIndex) {\r\n                        posy++;\r\n                    }\r\n                }\r\n                this.layerElArr[i].spot = posy;\r\n                this.layerElArr[i].posY = (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\r\n                this.layerElArr[i].style.top = this.layerElArr[i].posY + 'px';\r\n            })(i);\r\n        }\r\n        if (oldSpotIndex === newSpotIndex) {\r\n            return;\r\n        }\r\n        this.klCanvas.moveLayer(this.selectedSpotIndex, newSpotIndex - oldSpotIndex);\r\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n        this.selectedSpotIndex = newSpotIndex;\r\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\r\n    }\r\n\r\n    private posToSpot (p: number): number {\r\n        let result = parseInt('' + (p / (this.layerHeight + this.layerSpacing) + 0.5));\r\n        result = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, result));\r\n        result = this.klCanvasLayerArr.length - result - 1;\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * update css position of all layers that are not being dragged, while dragging\r\n     */\r\n    private updateLayersVerticalPosition (id: number, newspot: number): void {\r\n        newspot = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, newspot));\r\n        if (newspot === this.lastpos) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\r\n            if (this.layerElArr[i].spot === id) { // <- here\r\n                continue;\r\n            }\r\n            let posy = this.layerElArr[i].spot;\r\n            if (this.layerElArr[i].spot > id) {\r\n                posy--;\r\n            }\r\n            if (posy >= newspot) {\r\n                posy++;\r\n            }\r\n            this.layerElArr[i].posY = (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\r\n            this.layerElArr[i].style.top = this.layerElArr[i].posY + 'px';\r\n        }\r\n        this.lastpos = newspot;\r\n    }\r\n\r\n    private renameLayer (layerSpot: number): void {\r\n\r\n        renameLayerDialog(\r\n            this.parentEl,\r\n            this.klCanvas.getLayer(layerSpot).name,\r\n            (newName) => {\r\n                if (newName === undefined || newName === this.klCanvas.getLayer(layerSpot).name) {\r\n                    return;\r\n                }\r\n                this.klCanvas.renameLayer(layerSpot, newName);\r\n                this.createLayerList();\r\n                klHistory.pause(true);\r\n                this.onSelect(layerSpot);\r\n                klHistory.pause(false);\r\n            }\r\n        );\r\n    }\r\n\r\n    private updateHeight (): void {\r\n        this.layerListEl.style.height = (this.layerElArr.length * 35) + 'px';\r\n    }\r\n\r\n    private createLayerList (): void {\r\n        this.oldHistoryState = klHistory.getState();\r\n        const createLayerEntry = (index: number): void => {\r\n            const layerName = this.klCanvas.getLayer(index).name;\r\n            const opacity = this.klCanvasLayerArr[index].opacity;\r\n            const layercanvas = this.klCanvasLayerArr[index].context.canvas;\r\n\r\n            const layer: TLayerEl = BB.el() as TLayerEl;\r\n            layer.className = 'kl-layer';\r\n            this.layerElArr[index] = layer;\r\n            layer.posY = ((this.klCanvasLayerArr.length - 1) * 35 - index * 35);\r\n            BB.css(layer, {\r\n                top: layer.posY + 'px',\r\n            });\r\n            const innerLayer = BB.el();\r\n            BB.css(innerLayer, {\r\n                position: 'relative',\r\n            });\r\n\r\n            const container1 = BB.el();\r\n            BB.css(container1, {\r\n                width: '250px',\r\n                height: '34px',\r\n            });\r\n            const container2 = BB.el();\r\n            layer.append(innerLayer);\r\n            innerLayer.append(container1, container2);\r\n\r\n            layer.spot = index;\r\n\r\n            //thumb\r\n            {\r\n                const thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\r\n                const thumb = layer.thumb = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n\r\n                const thc = BB.ctx(thumb);\r\n                thc.save();\r\n                if (thumb.width > layercanvas.width) {\r\n                    thc.imageSmoothingEnabled = false;\r\n                }\r\n                thc.drawImage(layercanvas, 0, 0, thumb.width, thumb.height);\r\n                thc.restore();\r\n                BB.css(layer.thumb, {\r\n                    position: 'absolute',\r\n                    left: ((32 - layer.thumb.width) / 2) + 'px',\r\n                    top: ((32 - layer.thumb.height) / 2) + 'px',\r\n                });\r\n                BB.createCheckerDataUrl(4, (url) => {\r\n                    thumb.style.backgroundImage = 'url(' + url + ')';\r\n                }, theme.isDark());\r\n            }\r\n\r\n            //layerlabel\r\n            {\r\n                layer.label = BB.el({\r\n                    className: 'kl-layer__label',\r\n                });\r\n                layer.layerName = layerName;\r\n                layer.label.append(layer.layerName);\r\n\r\n                BB.css(layer.label, {\r\n                    position: 'absolute',\r\n                    left: (1 + 32 + 5) + 'px',\r\n                    top: 1 + 'px',\r\n                    fontSize: '13px',\r\n                    width: '170px',\r\n                    height: '20px',\r\n                    overflow: 'hidden',\r\n                    whiteSpace: 'nowrap',\r\n                });\r\n\r\n                layer.label.ondblclick = () => {\r\n                    this.renameLayer(layer.spot);\r\n                };\r\n            }\r\n            //layerlabel\r\n            {\r\n                layer.opacityLabel = BB.el({\r\n                    className: 'kl-layer__opacity-label',\r\n                });\r\n                layer.opacity = opacity;\r\n                layer.opacityLabel.append(parseInt('' + (layer.opacity * 100)) + '%');\r\n\r\n                BB.css(layer.opacityLabel, {\r\n                    position: 'absolute',\r\n                    left: (250 - 1 - 5 - 50) + 'px',\r\n                    top: 1 + 'px',\r\n                    fontSize: '13px',\r\n                    textAlign: 'right',\r\n                    width: '50px',\r\n                    transition: 'color 0.2s ease-in-out',\r\n                });\r\n            }\r\n\r\n            let oldOpacity: number;\r\n            const opacitySlider = new PointSlider({\r\n                init: layer.opacity,\r\n                width: 204,\r\n                pointSize: 14,\r\n                callback: (sliderValue, isFirst, isLast) => {\r\n                    if (isFirst) {\r\n                        oldOpacity = this.klCanvas.getLayer(layer.spot).opacity;\r\n                        klHistory.pause(true);\r\n                        return;\r\n                    }\r\n                    if (isLast) {\r\n                        klHistory.pause(false);\r\n                        if (oldOpacity !== sliderValue) {\r\n                            this.klCanvas.layerOpacity(layer.spot, sliderValue);\r\n                        }\r\n                        return;\r\n                    }\r\n                    layer.opacityLabel.innerHTML = Math.round(sliderValue * 100) + '%';\r\n                    this.klCanvas.layerOpacity(layer.spot, sliderValue);\r\n                },\r\n            });\r\n            BB.css(opacitySlider.getEl(), {\r\n                position: 'absolute',\r\n                left: '39px',\r\n                top: '17px',\r\n            });\r\n            layer.opacitySlider = opacitySlider;\r\n\r\n            //larger layer preview - hover\r\n            layer.thumb.onpointerover = (e) => {\r\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== 'touch')) { //shouldn't show while dragging\r\n                    return;\r\n                }\r\n\r\n                const thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\r\n\r\n                if (this.largeThumbCanvas.width !== thumbDimensions.width || this.largeThumbCanvas.height !== thumbDimensions.height) {\r\n                    this.largeThumbCanvas.width = thumbDimensions.width;\r\n                    this.largeThumbCanvas.height = thumbDimensions.height;\r\n                }\r\n                const ctx = BB.ctx(this.largeThumbCanvas);\r\n                ctx.save();\r\n                if (this.largeThumbCanvas.width > layercanvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.imageSmoothingQuality = 'high';\r\n                ctx.clearRect(0, 0, this.largeThumbCanvas.width, this.largeThumbCanvas.height);\r\n                ctx.drawImage(layercanvas, 0, 0, this.largeThumbCanvas.width, this.largeThumbCanvas.height);\r\n                ctx.restore();\r\n                BB.css(this.largeThumbDiv, {\r\n                    top: (e.clientY - this.largeThumbCanvas.height / 2) + 'px',\r\n                    opacity: '0',\r\n                });\r\n                if (!this.largeThumbInDocument) {\r\n                    document.body.append(this.largeThumbDiv);\r\n                    this.largeThumbInDocument = true;\r\n                }\r\n                clearTimeout(this.largeThumbInTimeout);\r\n                this.largeThumbInTimeout = setTimeout(() => {\r\n                    BB.css(this.largeThumbDiv, {\r\n                        opacity: '1',\r\n                    });\r\n                }, 20);\r\n                clearTimeout(this.largeThumbTimeout);\r\n            };\r\n            layer.thumb.onpointerout = () => {\r\n                clearTimeout(this.largeThumbInTimeout);\r\n                BB.css(this.largeThumbDiv, {\r\n                    opacity: '0',\r\n                });\r\n                clearTimeout(this.largeThumbTimeout);\r\n                this.largeThumbTimeout = setTimeout(() => {\r\n                    if (!this.largeThumbInDocument) {\r\n                        return;\r\n                    }\r\n                    document.body.removeChild(this.largeThumbDiv);\r\n                    this.largeThumbInDocument = false;\r\n                }, 300);\r\n            };\r\n\r\n            container1.append(layer.thumb, layer.label, layer.opacityLabel, opacitySlider.getEl());\r\n            let dragstart = false;\r\n            let freshSelection = false;\r\n\r\n            //events for moving layers up and down\r\n            const dragEventHandler = (event: IPointerEvent) => {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    BB.css(layer, {\r\n                        transition: 'box-shadow 0.3s ease-in-out',\r\n                    });\r\n                    layer.style.zIndex = '1';\r\n                    this.lastpos = layer.spot;\r\n                    freshSelection = false;\r\n                    if (!layer.isSelected) {\r\n                        freshSelection = true;\r\n                        this.activateLayer(layer.spot);\r\n                    }\r\n                    dragstart = true;\r\n\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    if (dragstart) {\r\n                        dragstart = false;\r\n                        BB.css(layer, {\r\n                            boxShadow: '1px 3px 5px rgba(0,0,0,0.4)',\r\n                        });\r\n                    }\r\n                    layer.posY += event.dY;\r\n                    const corrected = Math.max(0, Math.min((this.klCanvasLayerArr.length - 1) * (35), layer.posY));\r\n                    layer.style.top = corrected + 'px';\r\n                    this.updateLayersVerticalPosition(layer.spot, this.posToSpot(layer.posY));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(layer, {\r\n                        transition: 'all 0.1s linear',\r\n                    });\r\n                    setTimeout(() => {\r\n                        BB.css(layer, {\r\n                            boxShadow: '',\r\n                        });\r\n                    }, 20);\r\n                    layer.posY = Math.max(0, Math.min((this.klCanvasLayerArr.length - 1) * (35), layer.posY));\r\n                    layer.style.zIndex = '';\r\n                    const newSpot = this.posToSpot(layer.posY);\r\n                    const oldSpot = layer.spot;\r\n                    this.move(layer.spot, newSpot);\r\n                    if (oldSpot != newSpot) {\r\n                        klHistory.pause(true);\r\n                        this.onSelect(this.selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                    if (oldSpot === newSpot && freshSelection) {\r\n                        this.onSelect(this.selectedSpotIndex);\r\n                    }\r\n                    freshSelection = false;\r\n                }\r\n            };\r\n\r\n            layer.pointerListener = new BB.PointerListener({\r\n                target: container1,\r\n                onPointer: dragEventHandler,\r\n            });\r\n\r\n            this.layerListEl.append(layer);\r\n        };\r\n        this.layerElArr = [];\r\n        while (this.layerListEl.firstChild) {\r\n            const child = this.layerListEl.firstChild as TLayerEl;\r\n            child.pointerListener.destroy();\r\n            child.opacitySlider.destroy();\r\n            this.layerListEl.removeChild(child);\r\n        }\r\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\r\n            createLayerEntry(i);\r\n        }\r\n        this.activateLayer(this.selectedSpotIndex);\r\n        this.updateHeight();\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        klCanvas: KlCanvas,\r\n        onSelect: (layerIndex: number) => void,\r\n        parentEl: HTMLElement,\r\n        uiState: TUiLayout,\r\n    ) {\r\n        this.parentEl = parentEl;\r\n        this.klCanvas = klCanvas;\r\n        this.layerElArr = [];\r\n        this.layerHeight = 35;\r\n        this.layerSpacing = 0;\r\n        const width = 250;\r\n        this.onSelect = onSelect;\r\n        this.uiState = uiState;\r\n\r\n        this.largeThumbDiv = BB.el({\r\n            onClick: BB.handleClick,\r\n            css: {\r\n                position: 'absolute',\r\n                top: '500px',\r\n                background: '#aaa',\r\n                boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\r\n                pointerEvents: 'none',\r\n                padding: '0',\r\n                border: '1px solid #aaa',\r\n                transition: 'opacity 0.3s ease-out',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.setUiState(uiState);\r\n        BB.createCheckerDataUrl(4, (url) => {\r\n            this.largeThumbDiv.style.backgroundImage = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n        this.largeThumbCanvas = BB.canvas(200, 200);\r\n        this.largeThumbCanvas.style.display = 'block';\r\n        this.largeThumbDiv.append(this.largeThumbCanvas);\r\n        this.largeThumbInDocument = false;\r\n\r\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n        this.selectedSpotIndex = this.klCanvasLayerArr.length - 1;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                marginRight: '10px',\r\n                marginBottom: '10px',\r\n                marginLeft: '10px',\r\n                marginTop: '10px',\r\n                cursor: 'default',\r\n            },\r\n        });\r\n\r\n        const listDiv = BB.el({\r\n            css: {\r\n                width: width + 'px',\r\n                position: 'relative',\r\n            },\r\n        });\r\n\r\n        this.layerListEl = BB.el();\r\n\r\n        this.addBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n        this.duplicateBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n        this.mergeBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n        this.removeBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n        const renameBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n\r\n        const createButtons = () => {\r\n            const div = BB.el();\r\n            const async = () => {\r\n                BB.makeUnfocusable(this.addBtn);\r\n                BB.makeUnfocusable(this.duplicateBtn);\r\n                BB.makeUnfocusable(this.mergeBtn);\r\n                BB.makeUnfocusable(this.removeBtn);\r\n                BB.makeUnfocusable(renameBtn);\r\n\r\n                this.addBtn.style.cssFloat = 'left';\r\n                this.duplicateBtn.style.cssFloat = 'left';\r\n                this.mergeBtn.style.cssFloat = 'left';\r\n                this.removeBtn.style.cssFloat = 'left';\r\n                renameBtn.style.cssFloat = 'left';\r\n\r\n                this.addBtn.title = LANG('layers-new');\r\n                this.duplicateBtn.title = LANG('layers-duplicate');\r\n                this.removeBtn.title = LANG('layers-remove');\r\n                this.mergeBtn.title = LANG('layers-merge');\r\n                renameBtn.title = LANG('layers-rename-title');\r\n\r\n                this.addBtn.style.paddingLeft = '5px';\r\n                this.addBtn.style.paddingRight = '3px';\r\n\r\n                this.removeBtn.style.paddingLeft = '5px';\r\n                this.removeBtn.style.paddingRight = '3px';\r\n\r\n                this.duplicateBtn.style.paddingLeft = '5px';\r\n                this.duplicateBtn.style.paddingRight = '3px';\r\n\r\n                this.mergeBtn.style.paddingLeft = '5px';\r\n                this.mergeBtn.style.paddingRight = '3px';\r\n\r\n                renameBtn.style.height = '30px';\r\n                renameBtn.style.lineHeight = '20px';\r\n\r\n                this.addBtn.innerHTML = \"<img src='\" + addLayerImg + \"' height='20'/>\";\r\n                this.duplicateBtn.innerHTML = \"<img src='\" + duplicateLayerImg + \"' height='20'/>\";\r\n                this.mergeBtn.innerHTML = \"<img src='\" + mergeLayerImg + \"' height='20'/>\";\r\n                this.removeBtn.innerHTML = \"<img src='\" + removeLayerImg + \"' height='20'/>\";\r\n                renameBtn.innerHTML = \"<img src='\" + renameLayerImg + \"' height='20'/>\";\r\n                this.addBtn.style.marginRight = '5px';\r\n                this.removeBtn.style.marginRight = '5px';\r\n                this.duplicateBtn.style.marginRight = '5px';\r\n                this.mergeBtn.style.marginRight = '5px';\r\n                div.append(\r\n                    this.addBtn,\r\n                    this.removeBtn,\r\n                    this.duplicateBtn,\r\n                    this.mergeBtn,\r\n                    renameBtn,\r\n                    BB.el({\r\n                        css: {\r\n                            clear: 'both',\r\n                            height: '10px',\r\n                        },\r\n                    }),\r\n                );\r\n\r\n                this.addBtn.onclick = () => {\r\n                    if (this.klCanvas.addLayer(this.selectedSpotIndex) === false) {\r\n                        return;\r\n                    }\r\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n\r\n                    if (this.klCanvasLayerArr.length === MAX_LAYERS) {\r\n                        this.addBtn.disabled = true;\r\n                        this.duplicateBtn.disabled = true;\r\n                    }\r\n                    this.removeBtn.disabled = false;\r\n                    this.selectedSpotIndex = this.selectedSpotIndex + 1;\r\n                    this.createLayerList();\r\n                    klHistory.pause(true);\r\n                    this.onSelect(this.selectedSpotIndex);\r\n                    klHistory.pause(false);\r\n                };\r\n                this.duplicateBtn.onclick = () => {\r\n                    if (this.klCanvas.duplicateLayer(this.selectedSpotIndex) === false) {\r\n                        return;\r\n                    }\r\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n                    if (this.klCanvasLayerArr.length === MAX_LAYERS) {\r\n                        this.addBtn.disabled = true;\r\n                        this.duplicateBtn.disabled = true;\r\n                    }\r\n                    this.removeBtn.disabled = false;\r\n                    this.selectedSpotIndex++;\r\n                    this.createLayerList();\r\n                    klHistory.pause(true);\r\n                    this.onSelect(this.selectedSpotIndex);\r\n                    klHistory.pause(false);\r\n                };\r\n                this.removeBtn.onclick = () => {\r\n                    if (this.layerElArr.length <= 1) {\r\n                        return;\r\n                    }\r\n\r\n                    this.klCanvas.removeLayer(this.selectedSpotIndex);\r\n                    if (this.selectedSpotIndex > 0) {\r\n                        this.selectedSpotIndex--;\r\n                    }\r\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n                    this.createLayerList();\r\n                    klHistory.pause(true);\r\n                    this.onSelect(this.selectedSpotIndex);\r\n                    klHistory.pause(false);\r\n                    if (this.klCanvasLayerArr.length === 1) {\r\n                        this.removeBtn.disabled = true;\r\n                    }\r\n                    if (this.klCanvasLayerArr.length < MAX_LAYERS) {\r\n                        this.addBtn.disabled = false;\r\n                        this.duplicateBtn.disabled = false;\r\n                    }\r\n                };\r\n                this.mergeBtn.onclick = () => {\r\n                    if (this.selectedSpotIndex <= 0) {\r\n                        return;\r\n                    }\r\n                    mergeLayerDialog(this.parentEl, {\r\n                        topCanvas: this.klCanvasLayerArr[this.selectedSpotIndex].context.canvas,\r\n                        bottomCanvas: this.klCanvasLayerArr[this.selectedSpotIndex - 1].context.canvas,\r\n                        topOpacity: this.klCanvas.getLayer(this.selectedSpotIndex).opacity,\r\n                        mixModeStr: this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr,\r\n                        callback: (mode) => {\r\n                            this.klCanvas.mergeLayers(this.selectedSpotIndex, this.selectedSpotIndex - 1, mode);\r\n                            this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n                            this.selectedSpotIndex--;\r\n                            if (this.klCanvasLayerArr.length === 1) {\r\n                                this.removeBtn.disabled = true;\r\n                            }\r\n                            if (this.klCanvasLayerArr.length < MAX_LAYERS) {\r\n                                this.addBtn.disabled = false;\r\n                                this.duplicateBtn.disabled = false;\r\n                            }\r\n                            this.createLayerList();\r\n                            klHistory.pause(true);\r\n                            this.onSelect(this.selectedSpotIndex);\r\n                            klHistory.pause(false);\r\n                        },\r\n                    });\r\n                };\r\n\r\n                renameBtn.onclick = () => {\r\n                    this.renameLayer(this.selectedSpotIndex);\r\n                };\r\n            };\r\n            setTimeout(async, 1);\r\n            return div;\r\n        };\r\n        this.rootEl.append(createButtons());\r\n\r\n        let modeWrapper;\r\n        {\r\n            modeWrapper = BB.el({\r\n                content: LANG('layers-blending') + '&nbsp;',\r\n                css: {\r\n                    fontSize: '15px',\r\n                },\r\n            });\r\n\r\n            this.modeSelect = new Select({\r\n                optionArr: [\r\n                    'source-over',\r\n                    null,\r\n                    'darken',\r\n                    'multiply',\r\n                    'color-burn',\r\n                    null,\r\n                    'lighten',\r\n                    'screen',\r\n                    'color-dodge',\r\n                    null,\r\n                    'overlay',\r\n                    'soft-light',\r\n                    'hard-light',\r\n                    null,\r\n                    'difference',\r\n                    'exclusion',\r\n                    null,\r\n                    'hue',\r\n                    'saturation',\r\n                    'color',\r\n                    'luminosity',\r\n                ].map((item: TMixMode) => {\r\n                    return item ? [item, translateBlending(item)] : null;\r\n                }),\r\n                onChange: (val) => {\r\n                    this.klCanvas.setMixMode(this.selectedSpotIndex, val as TMixMode);\r\n                    this.update(this.selectedSpotIndex);\r\n                },\r\n                css: {\r\n                    marginBottom: '10px',\r\n                },\r\n            });\r\n\r\n            modeWrapper.append(this.modeSelect.getElement());\r\n            this.rootEl.append(modeWrapper);\r\n\r\n        }\r\n\r\n\r\n        listDiv.append(this.layerListEl);\r\n        this.rootEl.append(listDiv);\r\n\r\n        //updating the thumbs in interval\r\n        //don't update when: manager not visible || layer didn't change || is drawing\r\n        setInterval(() => {\r\n            if (this.rootEl.style.display !== 'block') {\r\n                return;\r\n            }\r\n\r\n            const historyState = klHistory.getState();\r\n            if (historyState === this.oldHistoryState) {\r\n                return;\r\n            }\r\n            this.oldHistoryState = historyState;\r\n\r\n            for (let i = 0; i < this.layerElArr.length; i++) {\r\n                if (this.selectedSpotIndex === this.layerElArr[i].spot && this.klCanvasLayerArr[this.layerElArr[i].spot]) { // second check, because might be out of date\r\n                    const ctx = BB.ctx(this.layerElArr[i].thumb);\r\n                    ctx.save();\r\n                    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n                    if (this.klCanvasLayerArr[this.layerElArr[i].spot].context.canvas.width < this.layerElArr[i].thumb.width) {\r\n                        ctx.imageSmoothingEnabled = false;\r\n                    }\r\n                    ctx.drawImage(this.klCanvasLayerArr[this.layerElArr[i].spot].context.canvas, 0, 0, this.layerElArr[i].thumb.width, this.layerElArr[i].thumb.height);\r\n                    ctx.restore();\r\n                }\r\n            }\r\n\r\n        }, 1);\r\n\r\n        theme.addIsDarkListener(() => {\r\n            this.createLayerList();\r\n        });\r\n\r\n        this.createLayerList();\r\n    }\r\n\r\n    // ---- interface ----\r\n    update (activeLayerSpotIndex?: number): void {\r\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) {\r\n            this.selectedSpotIndex = activeLayerSpotIndex;\r\n        }\r\n        this.removeBtn.disabled = this.klCanvasLayerArr.length === 1;\r\n        if (this.klCanvasLayerArr.length === MAX_LAYERS) {\r\n            this.addBtn.disabled = true;\r\n            this.duplicateBtn.disabled = true;\r\n        } else {\r\n            this.addBtn.disabled = false;\r\n            this.duplicateBtn.disabled = false;\r\n        }\r\n        setTimeout(() => this.createLayerList(), 1);\r\n    }\r\n\r\n    getSelected (): number {\r\n        return this.selectedSpotIndex;\r\n    }\r\n\r\n    activateLayer (spotIndex: number): void {\r\n        if (spotIndex < 0 || spotIndex > this.layerElArr.length - 1) {\r\n            throw 'invalid spotIndex ' + spotIndex + ', layerElArr.length ' + this.layerElArr.length;\r\n        }\r\n        this.selectedSpotIndex = spotIndex;\r\n        this.modeSelect.setValue(this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr);\r\n        for (let i = 0; i < this.layerElArr.length; i++) {\r\n            const layer = this.layerElArr[i];\r\n            const isSelected = this.selectedSpotIndex === layer.spot;\r\n\r\n            BB.css(layer, {\r\n                boxShadow: '',\r\n            });\r\n            layer.classList.toggle('kl-layer--selected', isSelected);\r\n            layer.opacitySlider.setActive(isSelected);\r\n            layer.isSelected = isSelected;\r\n        }\r\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\r\n    }\r\n\r\n    setUiState (stateStr: TUiLayout): void {\r\n        this.uiState = stateStr;\r\n\r\n        if (this.uiState === 'left') {\r\n            BB.css(this.largeThumbDiv, {\r\n                left: '280px',\r\n                right: '',\r\n            });\r\n        } else {\r\n            BB.css(this.largeThumbDiv, {\r\n                left: '',\r\n                right: '280px',\r\n            });\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {floodFillBits} from '../image-operations/flood-fill';\r\nimport {drawShape} from '../image-operations/shape-tool';\r\nimport {IRenderTextParam, renderText} from '../image-operations/render-text';\r\nimport {IGradient, IKlProject, IRGB, IShapeToolObject, TFillSampling, TKlCanvasLayer, TMixMode} from '../kl-types';\r\nimport {DecoyKlHistory, KlHistoryInterface, THistoryActions} from '../history/kl-history';\r\nimport {drawProject} from './draw-project';\r\nimport {LANG} from '../../language/language';\r\nimport {drawGradient} from '../image-operations/gradient-tool';\r\n\r\nexport type TKlCanvasHistoryEntry = THistoryActions<'canvas', KlCanvas>;\r\n\r\nconst allowedMixModes = [\r\n    'source-over',\r\n    'darken',\r\n    'multiply',\r\n    'color-burn',\r\n    'lighten',\r\n    'screen',\r\n    'color-dodge',\r\n    'overlay',\r\n    'soft-light',\r\n    'hard-light',\r\n    'difference',\r\n    'exclusion',\r\n    'hue',\r\n    'saturation',\r\n    'color',\r\n    'luminosity',\r\n];\r\n\r\nexport const MAX_LAYERS = 16;\r\n\r\ninterface KlCanvasLayer extends HTMLCanvasElement {\r\n    name: string;\r\n    mixModeStr: TMixMode;\r\n    opacity: number;\r\n    compositeObj?: {\r\n        draw: (ctx: CanvasRenderingContext2D) => void;\r\n    };\r\n    index: number; // certain brushes need to know\r\n}\r\n\r\n/**\r\n * The image/canvas that the user paints on\r\n * Has layers. layers have names and opacity.\r\n *\r\n * Interacts with the history you specify (for undo/redo)\r\n */\r\nexport class KlCanvas {\r\n\r\n    // todo changeListener consistent concept\r\n    // todo history interaction, consistent concept - currently have to look at code to know if something pushes on history\r\n\r\n    private width: number;\r\n    private height: number;\r\n    private layerCanvasArr: KlCanvasLayer[];\r\n    private pickCanvas: HTMLCanvasElement; // canvas to draw into for color picker\r\n    private history: KlHistoryInterface;\r\n    private changeListenerArr:  (() => void)[]; // subscribers get notified when opacity changes\r\n\r\n\r\n    private init (w: number, h: number): void {\r\n        if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            throw new Error('init - invalid canvas size: ' + w + ', ' + h);\r\n        }\r\n        this.width = w;\r\n        this.height = h;\r\n    }\r\n\r\n    private emitChange (): void {\r\n        // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\r\n        this.changeListenerArr.forEach(item => item());\r\n    }\r\n\r\n    private updateIndices (): void {\r\n        this.layerCanvasArr.forEach((item, index) => {\r\n            item.index = index;\r\n        });\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        params: {\r\n            projectObj: {\r\n                width: number;\r\n                height: number;\r\n                layers: {\r\n                    name: string;\r\n                    opacity: number;\r\n                    image: HTMLImageElement | HTMLCanvasElement; // already loaded!\r\n                }[];\r\n            };\r\n        } | {\r\n            // creates blank KlCanvas, 0 layers\r\n            width: number;\r\n            height: number;\r\n        } | {\r\n            copy: KlCanvas;\r\n        },\r\n        private layerNrOffset: number = 0,\r\n    ) {\r\n        this.layerCanvasArr = [];\r\n        this.pickCanvas = BB.canvas(1, 1);\r\n        this.history = new DecoyKlHistory();\r\n        if ('copy' in params) {\r\n            this.width = 1;\r\n            this.height = 1;\r\n        } else {\r\n            if ('width' in params && 'height' in params) {\r\n                this.width = params.width;\r\n                this.height = params.height;\r\n            } else {\r\n                this.width = 1;\r\n                this.height = 1;\r\n            }\r\n        }\r\n        this.init(this.width, this.height);\r\n\r\n        this.changeListenerArr = [];\r\n\r\n        if ('copy' in params) {\r\n            try {\r\n                this.copy(params.copy);\r\n            } catch (e) {\r\n                this.destroy();\r\n                throw e;\r\n            }\r\n        } else if ('projectObj' in params) {\r\n            const origLayers = [...params.projectObj.layers];\r\n            this.init(params.projectObj.width, params.projectObj.height);\r\n\r\n            if (!origLayers.length) {\r\n                throw new Error('project.layers needs at least 1 layer');\r\n            }\r\n\r\n            for (let i = 0; i < origLayers.length; i++) {\r\n                if (origLayers[i].mixModeStr && !allowedMixModes.includes(origLayers[i].mixModeStr)) {\r\n                    throw new Error('unknown mixModeStr ' + origLayers[i].mixModeStr);\r\n                }\r\n\r\n                this.addLayer();\r\n                this.layerOpacity(i, origLayers[i].opacity);\r\n                this.layerCanvasArr[i].name = origLayers[i].name;\r\n                this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr ? origLayers[i].mixModeStr : 'source-over';\r\n                BB.ctx(this.layerCanvasArr[i]).drawImage(origLayers[i].image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    /**\r\n     * Resets canvas -> 1 layer, 100% opacity,\r\n     * unless layers provided.\r\n     * @param p\r\n     */\r\n    reset (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n            color?: IRGB; // optional - fill color\r\n            image?: HTMLImageElement | HTMLCanvasElement; // image drawn on layer\r\n            layerName?: string; // if via image\r\n            layers?: {\r\n                name: string;\r\n                opacity: number;\r\n                mixModeStr: TMixMode;\r\n                image: HTMLCanvasElement;\r\n            }[];\r\n        }\r\n    ): void | number {\r\n        if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height) ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        this.history.pause(true);\r\n\r\n        this.width = p.width;\r\n        this.height = p.height;\r\n\r\n        this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\r\n\r\n        if (p.layers) {\r\n            for (let i = 0; i < p.layers.length; i++) {\r\n                const item = p.layers[i];\r\n                if (!this.layerCanvasArr[i]) {\r\n                    this.addLayer();\r\n                }\r\n                this.layerCanvasArr[i].name = item.name;\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n                this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : 'source-over';\r\n                BB.ctx(this.layerCanvasArr[i]).drawImage(item.image, 0, 0);\r\n                this.layerOpacity(i, item.opacity);\r\n            }\r\n        } else {\r\n            this.layerCanvasArr[0].name = p.layerName ? p.layerName : LANG('layers-layer') + ' 1';\r\n            this.layerCanvasArr[0].width = this.width;\r\n            this.layerCanvasArr[0].height = this.height;\r\n            this.layerCanvasArr[0].mixModeStr = 'source-over';\r\n            this.layerOpacity(0, 1);\r\n            if (p.color) {\r\n                this.layerFill(0, p.color);\r\n            } else if (p.image) {\r\n                BB.ctx(this.layerCanvasArr[0]).drawImage(p.image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n\r\n        this.history.pause(false);\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'reset',\r\n            params: [p], // don't modify with p\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return this.layerCanvasArr.length - 1;\r\n    }\r\n\r\n    isLayerLimitReached (): boolean {\r\n        return this.layerCanvasArr.length >= MAX_LAYERS;\r\n    }\r\n\r\n    getWidth (): number {\r\n        return this.width;\r\n    }\r\n\r\n    getHeight (): number {\r\n        return this.height;\r\n    }\r\n\r\n    copy (toCopyCanvas: KlCanvas): void {\r\n        if (\r\n            toCopyCanvas.getWidth() < 1 ||\r\n            toCopyCanvas.getHeight() < 1 ||\r\n            isNaN(toCopyCanvas.getWidth()) ||\r\n            isNaN(toCopyCanvas.getHeight())\r\n        ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        // keep existing canvases\r\n\r\n        const origLayers = toCopyCanvas.getLayers();\r\n\r\n        while (this.layerCanvasArr.length > origLayers.length) {\r\n            this.removeLayer(this.layerCanvasArr.length - 1);\r\n        }\r\n\r\n        if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) {\r\n            this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\r\n        }\r\n        for (let i = 0; i < origLayers.length; i++) {\r\n            if (i >= this.layerCanvasArr.length) {\r\n                this.addLayer();\r\n            } else {\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n            }\r\n            this.layerOpacity(i, origLayers[i].opacity);\r\n            this.layerCanvasArr[i].name = origLayers[i].name;\r\n            this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\r\n            BB.ctx(this.layerCanvasArr[i]).drawImage(origLayers[i].context.canvas, 0, 0);\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    getLayerCount (): number {\r\n        return this.layerCanvasArr.length;\r\n    }\r\n\r\n    resize (w: number, h: number, algorithm: 'smooth' | 'pixelated' = 'smooth'): boolean {\r\n        if (!w || !h || (w === this.width && h === this.height) || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            return false;\r\n        }\r\n        w = Math.max(w, 1);\r\n        h = Math.max(h, 1);\r\n\r\n        let tmp1, tmp2;\r\n\r\n        if (algorithm === 'pixelated') {\r\n            tmp1 = BB.canvas(w, h);\r\n            const tmp1Ctx = BB.ctx(tmp1);\r\n            tmp1Ctx.imageSmoothingEnabled = false;\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                if (i > 0) {\r\n                    tmp1Ctx.clearRect(0, 0, w, h);\r\n                }\r\n                const layerCanvas = this.layerCanvasArr[i];\r\n                tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\r\n                layerCanvas.width = w;\r\n                layerCanvas.height = h;\r\n                const layerContext = BB.ctx(layerCanvas);\r\n                layerContext.drawImage(tmp1, 0, 0);\r\n            }\r\n\r\n        } else if (algorithm === 'smooth') {\r\n            tmp1 = BB.canvas();\r\n            tmp2 = BB.canvas();\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                BB.resizeCanvas(this.layerCanvasArr[i], w, h, tmp1, tmp2);\r\n            }\r\n        } else {\r\n            throw new Error('unknown resize algorithm');\r\n        }\r\n\r\n        this.width = w;\r\n        this.height = h;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * crop / extend\r\n     * @param p\r\n     */\r\n    resizeCanvas (p: {\r\n        left: number;\r\n        top: number;\r\n        right: number;\r\n        bottom: number;\r\n        fillColor?: IRGB;\r\n    }): void {\r\n\r\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\r\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\r\n        const offX = Math.round(p.left);\r\n        const offY = Math.round(p.top);\r\n\r\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) {\r\n            throw new Error('KlCanvas.resizeCanvas - invalid canvas size');\r\n        }\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            const ctemp = BB.canvas(this.width, this.height);\r\n            const layerCanvas = this.layerCanvasArr[i];\r\n            const layerCtx = BB.ctx(this.layerCanvasArr[i]);\r\n            BB.ctx(ctemp).drawImage(layerCanvas, 0, 0);\r\n\r\n            this.layerCanvasArr[i].width = newW;\r\n            this.layerCanvasArr[i].height = newH;\r\n\r\n            layerCtx.save();\r\n            if (i === 0 && p.fillColor) {\r\n                layerCtx.fillStyle = BB.ColorConverter.toRgbStr(p.fillColor);\r\n                layerCtx.fillRect(0, 0, newW, newH);\r\n                layerCtx.clearRect(offX, offY, this.width, this.height);\r\n            }\r\n            layerCtx.drawImage(ctemp, offX, offY);\r\n            layerCtx.restore();\r\n        }\r\n        this.width = newW;\r\n        this.height = newH;\r\n    }\r\n\r\n    /**\r\n     * will be inserted on top of selected\r\n     * @param selected\r\n     */\r\n    addLayer (selected?: number): false | number {\r\n        if (this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        const canvas = BB.canvas(this.width, this.height);\r\n        if (!canvas.getContext('2d')) {\r\n            throw new Error('kl-create-canvas-error');\r\n        }\r\n\r\n        (canvas as any).mixModeStr = 'source-over';\r\n\r\n        if (selected === undefined) {\r\n            this.layerCanvasArr[this.layerCanvasArr.length] = canvas as any;\r\n            selected = Math.max(0, this.layerCanvasArr.length - 1);\r\n        } else {\r\n            this.layerCanvasArr.splice(selected + 1, 0, canvas as any);\r\n            selected++;\r\n        }\r\n\r\n        (canvas as any).name = LANG('layers-layer') + ' ' + (this.layerCanvasArr.length + this.layerNrOffset);\r\n        this.history.pause(true);\r\n        this.layerOpacity(selected, 1);\r\n        this.history.pause(false);\r\n        this.updateIndices();\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'addLayer',\r\n            params: [selected - 1],\r\n        } as TKlCanvasHistoryEntry);\r\n        return selected;\r\n    }\r\n\r\n    duplicateLayer (i: number): false | number {\r\n        if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        const canvas = BB.canvas(this.width, this.height);\r\n        this.layerCanvasArr.splice(i + 1, 0, canvas as any);\r\n\r\n        (canvas as any).name = this.layerCanvasArr[i].name + ' ' + LANG('layers-copy');\r\n        (canvas as any).mixModeStr = this.layerCanvasArr[i].mixModeStr;\r\n        BB.ctx(canvas).drawImage(this.layerCanvasArr[i], 0, 0);\r\n        this.history.pause(true);\r\n        this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\r\n        this.history.pause(false);\r\n\r\n        this.updateIndices();\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'duplicateLayer',\r\n            params: [i],\r\n        } as TKlCanvasHistoryEntry);\r\n        return i + 1;\r\n    }\r\n\r\n    getLayerContext (i: number, doReturnNull?: boolean): CanvasRenderingContext2D | null {\r\n        if (this.layerCanvasArr[i]) {\r\n            return BB.ctx(this.layerCanvasArr[i]);\r\n        }\r\n        if (doReturnNull) {\r\n            return null;\r\n        }\r\n        throw new Error('layer of index ' + i + ' not found (in ' + this.layerCanvasArr.length + ' layers)');\r\n    }\r\n\r\n    removeLayer (i: number): false | number {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr.splice(i, 1);\r\n            this.updateIndices();\r\n        } else {\r\n            return false;\r\n        }\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'removeLayer',\r\n            params: [i],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return Math.max(0, i - 1);\r\n    }\r\n\r\n    renameLayer (i: number, name: string): boolean {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr[i].name = name;\r\n        } else {\r\n            return false;\r\n        }\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'renameLayer',\r\n            params: [i, name],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return true;\r\n    }\r\n\r\n    layerOpacity (i: number, o: number): void {\r\n        if (!this.layerCanvasArr[i]) {\r\n            return;\r\n        }\r\n        o = Math.max(0, Math.min(1, o));\r\n        this.layerCanvasArr[i].opacity = o;\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'layerOpacity',\r\n            params: [i, o],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        this.emitChange();\r\n    }\r\n\r\n    moveLayer (i: number, d: number): void | number {\r\n        if (d === 0) {\r\n            return;\r\n        }\r\n        if (this.layerCanvasArr[i]) {\r\n            const temp = this.layerCanvasArr[i];\r\n            this.layerCanvasArr.splice(i, 1);\r\n            const targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\r\n            this.layerCanvasArr.splice(targetIndex, 0, temp);\r\n            this.updateIndices();\r\n            this.history.push({\r\n                tool: ['canvas'],\r\n                action: 'moveLayer',\r\n                params: [i, d],\r\n            } as TKlCanvasHistoryEntry);\r\n            return targetIndex;\r\n        }\r\n    }\r\n\r\n    mergeLayers (layerBottomIndex: number, layerTopIndex: number, mixModeStr: TMixMode | 'as-alpha'): void | number {\r\n        if (\r\n            !this.layerCanvasArr[layerBottomIndex] ||\r\n            !this.layerCanvasArr[layerTopIndex] ||\r\n            layerBottomIndex === layerTopIndex\r\n        ) {\r\n            return;\r\n        }\r\n        //order messed up\r\n        if (layerBottomIndex > layerTopIndex) {\r\n            const temp = layerBottomIndex;\r\n            layerBottomIndex = layerTopIndex;\r\n            layerTopIndex = temp;\r\n        }\r\n\r\n        const topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\r\n        if (topOpacity !== 0 && topOpacity) {\r\n            const ctx = BB.ctx(this.layerCanvasArr[layerBottomIndex]);\r\n            ctx.save();\r\n\r\n            if (mixModeStr === 'as-alpha') { // todo remove this?\r\n\r\n                BB.convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\r\n                ctx.globalCompositeOperation = 'destination-in';\r\n                ctx.globalAlpha = topOpacity;\r\n                BB.ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            } else {\r\n\r\n                if (mixModeStr) {\r\n                    ctx.globalCompositeOperation = mixModeStr;\r\n                }\r\n                ctx.globalAlpha = topOpacity;\r\n                BB.ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            }\r\n\r\n            ctx.restore();\r\n\r\n            // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n            // TODO remove if chrome updated\r\n            if (mixModeStr) {\r\n                ctx.save();\r\n                ctx.fillStyle = 'rgba(0,0,0,0.01)';\r\n                ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n                ctx.restore();\r\n            }\r\n        }\r\n        this.updateIndices();\r\n        this.history.pause(true);\r\n        this.removeLayer(layerTopIndex);\r\n        this.history.pause(false);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'mergeLayers',\r\n            params: [layerBottomIndex, layerTopIndex, mixModeStr],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return layerBottomIndex;\r\n    }\r\n\r\n    rotate (deg: number): void {\r\n        while (deg < 0) {\r\n            deg += 360;\r\n        }\r\n        deg %= 360;\r\n        if (deg % 90 != 0 || deg === 0) {\r\n            return;\r\n        }\r\n        const temp = BB.canvas();\r\n        if (deg === 0 || deg === 180) {\r\n            temp.width = this.width;\r\n            temp.height = this.height;\r\n        } else if (deg === 90 || deg === 270) {\r\n            temp.width = this.height;\r\n            temp.height = this.width;\r\n        }\r\n        const ctx = BB.ctx(temp);\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.clearRect(0, 0, temp.width, temp.height);\r\n            ctx.save();\r\n            ctx.translate(temp.width / 2, temp.height / 2);\r\n            ctx.rotate(deg * Math.PI / 180);\r\n            if (deg === 180) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            } else if (deg === 90 || deg === 270) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\r\n            }\r\n            this.layerCanvasArr[i].width = temp.width;\r\n            this.layerCanvasArr[i].height = temp.height;\r\n            BB.ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            BB.ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\r\n            ctx.restore();\r\n        }\r\n        this.width = temp.width;\r\n        this.height = temp.height;\r\n    }\r\n\r\n    flip (isHorizontal: boolean, isVertical: boolean, layerIndex?: number): void {\r\n        if (!isHorizontal && !isVertical) {\r\n            return;\r\n        }\r\n\r\n        const temp = BB.canvas(this.width, this.height);\r\n        temp.width = this.width;\r\n        temp.height = this.height;\r\n        const tempCtx = BB.ctx(temp);\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n\r\n            if ( (layerIndex || layerIndex === 0) && i !== layerIndex) {\r\n                continue;\r\n            }\r\n\r\n            tempCtx.save();\r\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\r\n            tempCtx.translate(temp.width / 2, temp.height / 2);\r\n            tempCtx.scale((isHorizontal ? -1 : 1), (isVertical ? -1 : 1));\r\n            tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            tempCtx.restore();\r\n\r\n            BB.ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            BB.ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\r\n        }\r\n    }\r\n\r\n    layerFill (layerIndex: number, colorObj: IRGB, compositeOperation?: string): void {\r\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n        ctx.save();\r\n        if (compositeOperation) {\r\n            ctx.globalCompositeOperation = compositeOperation as GlobalCompositeOperation;\r\n        }\r\n        ctx.fillStyle = 'rgba(' + colorObj.r + ',' + colorObj.g + ',' + colorObj.b + ',1)';\r\n        ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n        // TODO remove if chrome updated\r\n        ctx.save();\r\n        ctx.fillStyle = 'rgba(0,0,0,0.01)';\r\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n        ctx.restore();\r\n\r\n        /*if (!document.getElementById('testocanvas')) {\r\n            layerCanvasArr[layerIndex].id = 'testocanvas';\r\n            document.body.append(layerCanvasArr[layerIndex]);\r\n            BB.css(layerCanvasArr[layerIndex], {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }\r\n        if (!document.getElementById('testocanvas')) {\r\n            let c = document.createElement('canvas');\r\n            c.width = 1000;\r\n            c.height = 1000;\r\n            let ctx2 = c.getContext('2d');\r\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\r\n            c.id = 'testocanvas';\r\n            document.body.append(c);\r\n            BB.css(c, {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }*/\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'layerFill',\r\n            params: [layerIndex, colorObj, compositeOperation],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    floodFill (\r\n        layerIndex: number, // index of layer to be filled\r\n        x: number, // starting point\r\n        y: number,\r\n        rgb: IRGB | null, // fill color, if null -> erase\r\n        opacity: number,\r\n        tolerance: number,\r\n        sampleStr: TFillSampling,\r\n        grow: number, // int >= 0 - radius around filled area that is to be filled too\r\n        isContiguous: boolean,\r\n    ): void {\r\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) {\r\n            return;\r\n        }\r\n        tolerance = Math.round(tolerance);\r\n\r\n        if (!(['above', 'current', 'all'].includes(sampleStr))) {\r\n            throw new Error('invalid sampleStr');\r\n        }\r\n\r\n        let result;\r\n\r\n        let srcCtx;\r\n        let srcImageData;\r\n        let srcData;\r\n\r\n        let targetCtx;\r\n        let targetImageData;\r\n        let targetData;\r\n\r\n\r\n        if (sampleStr === 'all') {\r\n\r\n            let srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\r\n            srcCtx = BB.ctx(srcCanvas);\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            srcCanvas = null;\r\n            srcCtx = null;\r\n            srcImageData = null;\r\n            srcData = null;\r\n\r\n            targetCtx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        } else {\r\n            const srcIndex = sampleStr === 'above' ? layerIndex + 1 : layerIndex;\r\n\r\n            if (srcIndex >= this.layerCanvasArr.length) {\r\n                return;\r\n            }\r\n\r\n            srcCtx = BB.ctx(this.layerCanvasArr[srcIndex]);\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            if (layerIndex !== srcIndex) {\r\n                srcCtx = null;\r\n                srcImageData = null;\r\n                srcData = null;\r\n            }\r\n\r\n            targetCtx = layerIndex === srcIndex ? srcCtx : BB.ctx(this.layerCanvasArr[layerIndex]);\r\n            targetImageData = layerIndex === srcIndex ? srcImageData : targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        }\r\n\r\n        targetData = targetImageData.data;\r\n        if (rgb) {\r\n            if (opacity === 1) {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4] = rgb.r;\r\n                        targetData[i * 4 + 1] = rgb.g;\r\n                        targetData[i * 4 + 2] = rgb.b;\r\n                        targetData[i * 4 + 3] = 255;\r\n                    }\r\n                }\r\n            } else {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4] = BB.mix(targetData[i * 4], rgb.r, opacity);\r\n                        targetData[i * 4 + 1] = BB.mix(targetData[i * 4 + 1], rgb.g, opacity);\r\n                        targetData[i * 4 + 2] = BB.mix(targetData[i * 4 + 2], rgb.b, opacity);\r\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 255, opacity);\r\n                    }\r\n                }\r\n            }\r\n        } else { // erase\r\n            if (opacity === 1) {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4 + 3] = 0;\r\n                    }\r\n                }\r\n            } else {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 0, opacity);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        targetCtx.putImageData(targetImageData, 0, 0);\r\n\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'replaceLayer',\r\n            params: [layerIndex, targetImageData],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    /**\r\n     * draw shape via BB.drawShape\r\n     * @param layerIndex\r\n     * @param shapeObj\r\n     */\r\n    drawShape (layerIndex: number, shapeObj: IShapeToolObject): void {\r\n        if (shapeObj.x1 === shapeObj.x2 && shapeObj.y1 === shapeObj.y2) {\r\n            return;\r\n        }\r\n        drawShape(BB.ctx(this.layerCanvasArr[layerIndex]), shapeObj);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'drawShape',\r\n            params: [layerIndex, BB.copyObj(shapeObj)],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    drawGradient (layerIndex: number, gradientObj: IGradient): void {\r\n        drawGradient(BB.ctx(this.layerCanvasArr[layerIndex]), gradientObj);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'drawGradient',\r\n            params: [layerIndex, BB.copyObj(gradientObj)],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    text (layerIndex: number, p: IRenderTextParam): void {\r\n        renderText(this.layerCanvasArr[layerIndex], BB.copyObj(p));\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'text',\r\n            params: [layerIndex, BB.copyObj(p)],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    replaceLayer (layerIndex: number, imageData: ImageData): void {\r\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n        ctx.putImageData(imageData, 0, 0);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'replaceLayer',\r\n            params: [layerIndex, imageData],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    clearLayer (layerIndex: number): void {\r\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'clearLayer',\r\n            params: [layerIndex],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    getLayers (): {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: TMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                context: BB.ctx(item),\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayersFast (): {\r\n        canvas: KlCanvasLayer;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: TMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                canvas: item,\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayerIndex (canvasObj: HTMLCanvasElement, doReturnNull?: boolean): null | number {\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            if (this.layerCanvasArr[i] === canvasObj) {\r\n                return i;\r\n            }\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error('layer not found (in ' + this.layerCanvasArr.length + ' layers)');\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getLayer (index: number, doReturnNull?: boolean): null | TKlCanvasLayer {\r\n        if (this.layerCanvasArr[index]) {\r\n            return {\r\n                context: BB.ctx(this.layerCanvasArr[index]),\r\n                opacity: this.layerCanvasArr[index].opacity,\r\n                name: this.layerCanvasArr[index].name,\r\n                id: index,\r\n            };\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error('layer of index ' + index + ' not found (in ' + this.layerCanvasArr.length + ' layers)');\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getColorAt (x: number, y: number): IRGB {\r\n        x = Math.floor(x);\r\n        y = Math.floor(y);\r\n        const ctx = BB.ctx(this.pickCanvas);\r\n        ctx.save();\r\n        ctx.imageSmoothingEnabled = false;\r\n        ctx.clearRect(0, 0, 1, 1);\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.globalAlpha = this.layerCanvasArr[i].opacity;\r\n            ctx.globalCompositeOperation = this.layerCanvasArr[i].mixModeStr;\r\n            ctx.drawImage(this.layerCanvasArr[i], -x, -y);\r\n        }\r\n        ctx.restore();\r\n        const imData = ctx.getImageData(0, 0, 1, 1);\r\n        return new BB.RGB(imData.data[0], imData.data[1], imData.data[2]);\r\n    }\r\n\r\n    getCompleteCanvas (factor: number): HTMLCanvasElement {\r\n        return drawProject(this.getProject(), factor);\r\n    }\r\n\r\n    getProject (): IKlProject {\r\n        return {\r\n            width: this.width,\r\n            height: this.height,\r\n            layers: this.layerCanvasArr.map(layer => {\r\n                return {\r\n                    name: layer.name,\r\n                    opacity: layer.opacity,\r\n                    mixModeStr: layer.mixModeStr,\r\n                    image: layer,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    addChangeListener (func: () => void): void {\r\n        if (this.changeListenerArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.changeListenerArr.push(func);\r\n    }\r\n\r\n    removeChangeListener (func: () => void): void {\r\n        for (let i = 0; i < this.changeListenerArr.length; i++) {\r\n            if (this.changeListenerArr[i] === func) {\r\n                this.changeListenerArr.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    setMixMode (layerIndex: number, mixModeStr: TMixMode): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'setMixMode',\r\n            params: [layerIndex, '' + mixModeStr],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    /**\r\n     * Set composite drawing step for KlCanvasWorkspace.\r\n     * To apply temporary manipulations to a layer.\r\n     *\r\n     * @param layerIndex\r\n     * @param compositeObj\r\n     */\r\n    setComposite (\r\n        layerIndex: number,\r\n        compositeObj: null | {\r\n            draw: (ctx: CanvasRenderingContext2D) => void;\r\n        }\r\n    ): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].compositeObj = compositeObj;\r\n    }\r\n\r\n    destroy (): void {\r\n        if (this.layerCanvasArr === null) {\r\n            return;\r\n        }\r\n        this.layerCanvasArr.forEach(canvas => {\r\n            BB.freeCanvas(canvas);\r\n        });\r\n        this.layerCanvasArr = null;\r\n    }\r\n\r\n}\r\n","\r\n/**\r\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/, but it implemented tolerance wrong, and had bugs.\r\n * So, my own implementation. can handle tolerance, grow, opacity.\r\n * Needs to be optimized.\r\n */\r\n\r\n/**\r\n * Set values in data within rect to 254, unless they're 255\r\n *\r\n * @param data Uint8Array\r\n * @param width int\r\n * @param x0 int\r\n * @param y0 int\r\n * @param x1 int >x0\r\n * @param y1 int >y0\r\n */\r\nfunction fillRect (data: Uint8Array, width: number, x0: number, y0: number, x1: number, y1: number): void {\r\n    for (let x = x0; x <= x1; x++) {\r\n        for (let y = y0; y <= y1; y++) {\r\n            if (data[y * width + x] === 255) {\r\n                continue;\r\n            }\r\n            data[y * width + x] = 254;\r\n        }\r\n    }\r\n}\r\n\r\nlet mx, my;\r\n\r\n/**\r\n * Get index i moved by dX, dY. in array with dimensions width height.\r\n * Returns null if outside bounds.\r\n *\r\n * @param width int\r\n * @param height int\r\n * @param i int\r\n * @param dX int\r\n * @param dY int\r\n */\r\nfunction moveIndex (width: number, height: number, i: number, dX: number, dY: number): (undefined | number) {\r\n    mx = i % width + dX;\r\n    my = Math.floor(i / width) + dY;\r\n\r\n    if (mx < 0 || my < 0 || mx >= width || my >= height) {\r\n        return undefined;\r\n    }\r\n\r\n    return my * width + mx;\r\n}\r\n\r\n/**\r\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\r\n * returns false if already filled, or i is null\r\n *\r\n * @param srcArr Uint8ClampedArray rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param initRgba rgba\r\n * @param tolerance int 0 - 255\r\n * @param i int - srcArr index\r\n * @returns {boolean}\r\n */\r\nfunction testAndFill (\r\n    srcArr: Uint8ClampedArray,\r\n    targetArr: Uint8Array,\r\n    width: number,\r\n    height: number,\r\n    initRgba: [number, number, number, number],\r\n    tolerance: number,\r\n    i: number | undefined,\r\n): boolean {\r\n    if (i === undefined || targetArr[i] === 255) {\r\n        return false;\r\n    }\r\n\r\n    if (\r\n        srcArr[i * 4] === initRgba[0] &&\r\n        srcArr[i * 4 + 1] === initRgba[1] &&\r\n        srcArr[i * 4 + 2] === initRgba[2] &&\r\n        srcArr[i * 4 + 3] === initRgba[3]\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    if (\r\n        tolerance > 0 &&\r\n        Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n\r\n/**\r\n *\r\n * @param srcArr Uint8ClampedArray rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param px int\r\n * @param py int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n */\r\nfunction floodFill (\r\n    srcArr: Uint8ClampedArray,\r\n    targetArr: Uint8Array,\r\n    width: number,\r\n    height: number,\r\n    px: number,\r\n    py: number,\r\n    tolerance: number,\r\n    grow: number,\r\n    isContiguous: boolean,\r\n): void {\r\n\r\n    const initRgba: [number, number, number, number] = [\r\n        srcArr[(py * width + px) * 4],\r\n        srcArr[(py * width + px) * 4 + 1],\r\n        srcArr[(py * width + px) * 4 + 2],\r\n        srcArr[(py * width + px) * 4 + 3],\r\n    ];\r\n\r\n    if (isContiguous) {\r\n        const q: number[] = [];\r\n        q.push(py * width + px);\r\n        targetArr[py * width + px] = 255;\r\n\r\n        let i: number, e: number | undefined;\r\n        while (q.length) {\r\n            i = q.pop() as number; // a test would slow down the code\r\n\r\n            // queue up unfilled neighbors\r\n            e = moveIndex(width, height, i, -1, 0); // left\r\n            // test will return false if e is undefined -> only numbers will be pushed to q\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n\r\n            e = moveIndex(width, height, i, 1, 0); // right\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n\r\n            e = moveIndex(width, height, i, 0, -1); // up\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n\r\n            e = moveIndex(width, height, i, 0, 1); // bottom\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n        }\r\n    } else {\r\n        for (let i = 0; i < width * height; i++) {\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i);\r\n        }\r\n    }\r\n\r\n    // grow\r\n    if (grow === 0) {\r\n        return;\r\n    }\r\n\r\n    // how does it grow? it finds all pixel at the edge.\r\n    // then depending on what kind of edge it is, it draws a rectangle into target\r\n    // the rectangle has the value 254, or else it will mess it all up.\r\n    // after it's all done, replaces it with 255\r\n    let x0, x1, y0, y1;\r\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\r\n    for (let x = 0; x < width; x++) {\r\n        for (let y = 0; y < height; y++) {\r\n            if (targetArr[y * width + x] !== 255) {\r\n                continue;\r\n            }\r\n\r\n            // bounds of rectangle\r\n            x0 = x;\r\n            x1 = x;\r\n            y0 = y;\r\n            y1 = y;\r\n\r\n            l = targetArr[(y) * width + x - 1] !== 255;\r\n            tl = targetArr[(y - 1) * width + x - 1] !== 255;\r\n            t = targetArr[(y - 1) * width + x] !== 255;\r\n            tr = targetArr[(y - 1) * width + x + 1] !== 255;\r\n            r = targetArr[(y) * width + x + 1] !== 255;\r\n            br = targetArr[(y + 1) * width + x + 1] !== 255;\r\n            b = targetArr[(y + 1) * width + x] !== 255;\r\n            bl = targetArr[(y + 1) * width + x - 1] !== 255;\r\n\r\n            if (l) { // left\r\n                x0 = x - grow;\r\n            }\r\n            if (l && tl && t) { // top left\r\n                x0 = x - grow;\r\n                y0 = y - grow;\r\n            }\r\n            if (t) { // top\r\n                y0 = Math.min(y0, y - grow);\r\n            }\r\n            if (t && tr && r) { // top right\r\n                y0 = Math.min(y0, y - grow);\r\n                x1 = x + grow;\r\n            }\r\n            if (r) { // right\r\n                x1 = Math.max(x1, x + grow);\r\n            }\r\n            if (r && br && b) { // bottom right\r\n                x1 = Math.max(x1, x + grow);\r\n                y1 = Math.max(y1, y + grow);\r\n            }\r\n            if (b) { // bottom\r\n                y1 = Math.max(y1, y + grow);\r\n            }\r\n            if (b && bl && l) { // bottom left\r\n                x0 = Math.min(x0, x - grow);\r\n                y1 = Math.max(y1, y + grow);\r\n            }\r\n\r\n            if (!l && !tl && !t && !tr && !r && !br && !b && !bl) {\r\n                continue;\r\n            }\r\n\r\n            fillRect(\r\n                targetArr,\r\n                width,\r\n                Math.max(0, x0),\r\n                Math.max(0, y0),\r\n                Math.min(width - 1, x1),\r\n                Math.min(height - 1, y1)\r\n            );\r\n        }\r\n    }\r\n    for (let i = 0; i < width * height; i++) {\r\n        if (targetArr[i] === 254) {\r\n            targetArr[i] = 255;\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * Does flood fill, and returns that. an array - 0 not filled. 255 filled\r\n\r\n * @param rgbaArr Uint8ClampedArray rgba\r\n * @param width int\r\n * @param height int\r\n * @param x int\r\n * @param y int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n */\r\nexport function floodFillBits (\r\n    rgbaArr: Uint8ClampedArray,\r\n    width: number,\r\n    height: number,\r\n    x: number,\r\n    y: number,\r\n    tolerance: number,\r\n    grow: number,\r\n    isContiguous: boolean,\r\n): {\r\n    data: Uint8Array;\r\n} {\r\n    x = Math.round(x);\r\n    y = Math.round(y);\r\n\r\n    const resultArr = new Uint8Array(new ArrayBuffer(width * height));\r\n\r\n    floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\r\n\r\n    return {\r\n        data: resultArr,\r\n    };\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB, IShapeToolObject} from '../kl-types';\r\n\r\n/**\r\n * Input processor for shape tool.\r\n * Coordinates are in canvas space.\r\n * angleRad is the angle of the canvas.\r\n */\r\nexport class ShapeTool {\r\n\r\n    private readonly onShape: (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\r\n    private downX: number = 0;\r\n    private downY: number = 0;\r\n    private downAngleRad: number = 0;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onShape: (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\r\n        }\r\n    ) {\r\n        this.onShape = p.onShape;\r\n    }\r\n\r\n    onDown (x: number, y: number, angleRad: number): void {\r\n        this.downX = x;\r\n        this.downY = y;\r\n        this.downAngleRad = angleRad;\r\n    }\r\n\r\n    onMove (x: number, y: number): void {\r\n        this.onShape(false, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n\r\n    onUp (x: number, y: number): void {\r\n        this.onShape(true, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n}\r\n\r\n/**\r\n * Draw a shape (rectangle, ellipse, line)\r\n */\r\nexport function drawShape (\r\n    ctx: CanvasRenderingContext2D,\r\n    shapeObj: IShapeToolObject,\r\n): void {\r\n    shapeObj = {\r\n        // defaults\r\n        angleRad: 0,\r\n        isOutwards: false,\r\n        opacity: 1,\r\n        isEraser: false,\r\n        doLockAlpha: false,\r\n\r\n        ...BB.copyObj(shapeObj),\r\n    };\r\n\r\n    if (['rect', 'ellipse', 'line'].includes(shapeObj.type)) {\r\n        if (shapeObj.angleRad === undefined) {\r\n            throw new Error('angleRad undefined');\r\n        }\r\n\r\n        const lineWidth = shapeObj.lineWidth === undefined ? -1 : Math.round(shapeObj.lineWidth);\r\n        const angleDeg = shapeObj.angleRad * 180 / Math.PI;\r\n\r\n        // --- prep color ---\r\n        if (!shapeObj.isEraser && shapeObj.fillRgb === undefined && shapeObj.strokeRgb === undefined) {\r\n            throw new Error('fillRgb and strokeRgb undefined');\r\n        }\r\n        const colorRGB: IRGB = shapeObj.isEraser ? {r: 255, g: 255, b: 255} : (shapeObj.fillRgb ? shapeObj.fillRgb : shapeObj.strokeRgb!);\r\n\r\n\r\n        // --- prep canvas ---\r\n        ctx.save();\r\n        if (shapeObj.opacity) {\r\n            ctx.globalAlpha = shapeObj.opacity;\r\n        }\r\n        if (shapeObj.isEraser) {\r\n            ctx.globalCompositeOperation = 'destination-out';\r\n        }\r\n        if (shapeObj.doLockAlpha) {\r\n            ctx.globalCompositeOperation = 'source-atop';\r\n        }\r\n        ctx.rotate(-shapeObj.angleRad);\r\n        if (shapeObj.fillRgb) {\r\n            ctx.fillStyle = BB.ColorConverter.toRgbStr(colorRGB);\r\n        } else if (shapeObj.strokeRgb) {\r\n            ctx.strokeStyle = BB.ColorConverter.toRgbStr(colorRGB);\r\n            ctx.lineWidth = lineWidth;\r\n        }\r\n\r\n        let x1 = shapeObj.x1;\r\n        let y1 = shapeObj.y1;\r\n        let x2 = shapeObj.x2;\r\n        let y2 = shapeObj.y2;\r\n\r\n        // --- angle snapping ---\r\n        if (shapeObj.isAngleSnap) {\r\n            const r1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            const r2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            const pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\r\n            const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\r\n            const rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\r\n            x2 = rotated.x;\r\n            y2 = rotated.y;\r\n\r\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\r\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\r\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\r\n                    x2 = x1;\r\n                } else { // left or right\r\n                    y2 = y1;\r\n                }\r\n            }\r\n        }\r\n\r\n        let x = x1;\r\n        let y = y1;\r\n        let dX = x2 - x1;\r\n        let dY = y2 - y1;\r\n\r\n        // --- 1:1 ratio ---\r\n        if (shapeObj.type !== 'line' && shapeObj.isFixedRatio) {\r\n            let r1 = BB.rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\r\n            let r2 = BB.rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            const rx = r1.x;\r\n            const ry = r1.y;\r\n            let rdX = r2.x - r1.x;\r\n            let rdY = r2.y - r1.y;\r\n\r\n            if (Math.abs(rdX) < Math.abs(rdY)) {\r\n                rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\r\n            } else {\r\n                rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\r\n            }\r\n            r2.x = rx + rdX;\r\n            r2.y = ry + rdY;\r\n\r\n            r1 = BB.rotate(r1.x, r1.y, -shapeObj.angleRad / Math.PI * 180);\r\n            r2 = BB.rotate(r2.x, r2.y, -shapeObj.angleRad / Math.PI * 180);\r\n\r\n            x1 = r1.x;\r\n            y1 = r1.y;\r\n            x2 = r2.x;\r\n            y2 = r2.y;\r\n\r\n            x = x1;\r\n            y = y1;\r\n            dX = x2 - x1;\r\n            dY = y2 - y1;\r\n        }\r\n\r\n        // outwards modifier\r\n        if (shapeObj.isOutwards) {\r\n            x -= dX;\r\n            y -= dY;\r\n            dX *= 2;\r\n            dY *= 2;\r\n\r\n            x1 = x;\r\n            y1 = y;\r\n            x2 = x + dX;\r\n            y2 = y + dY;\r\n        }\r\n\r\n        let p1;\r\n        let p2;\r\n        if (shapeObj.type === 'line') { // --- line ---\r\n\r\n            // rounded\r\n            const x1r = Math.round(x1);\r\n            const y1r = Math.round(y1);\r\n            const x2r = Math.round(x2);\r\n            const y2r = Math.round(y2);\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (lineWidth % 2 === 0) {\r\n\r\n                if (y1r === y2r) {\r\n                    p1 = {\r\n                        x: x1f,\r\n                        y: y1r,\r\n                    };\r\n                    p2 = {\r\n                        x: x2f,\r\n                        y: y2r,\r\n                    };\r\n\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                } else if (x1r === x2r) {\r\n                    p1 = {\r\n                        x: x1r,\r\n                        y: y1f,\r\n                    };\r\n                    p2 = {\r\n                        x: x2r,\r\n                        y: y2f,\r\n                    };\r\n\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                } else {\r\n                    p1 = {\r\n                        x: x1,\r\n                        y: y1,\r\n                    };\r\n                    p2 = {\r\n                        x: x2,\r\n                        y: y2,\r\n                    };\r\n                }\r\n\r\n            } else {\r\n                p1 = {\r\n                    x: x1f,\r\n                    y: y1f,\r\n                };\r\n                p2 = {\r\n                    x: x2f,\r\n                    y: y2f,\r\n                };\r\n                if (y1f === y2f) {\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                    p1.y += 0.5;\r\n                    p2.y += 0.5;\r\n                } else if (x1f === x2f) {\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                    p1.x += 0.5;\r\n                    p2.x += 0.5;\r\n                } else {\r\n                    p1.x = x1;\r\n                    p1.y = y1;\r\n                    p2.x = x2;\r\n                    p2.y = y2;\r\n                }\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            ctx.beginPath();\r\n            ctx.moveTo(p1.x, p1.y);\r\n            ctx.lineTo(p2.x, p2.y);\r\n            ctx.stroke();\r\n\r\n        } else if (shapeObj.type === 'rect') { // --- rect ---\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (angleDeg % 90 === 0) {\r\n                if (shapeObj.fillRgb) {\r\n                    if (x1 % 1 === 0) {\r\n                        x1 += 1;\r\n                    }\r\n                    if (y1 % 1 === 0) {\r\n                        y1 += 1;\r\n                    }\r\n                    if (x2 % 1 === 0) {\r\n                        x2 += 1;\r\n                    }\r\n                    if (y2 % 1 === 0) {\r\n                        y2 += 1;\r\n                    }\r\n\r\n                    p1 = {\r\n                        x: x1 < x2 ? x1f : x2f,\r\n                        y: y1 < y2 ? y1f : y2f,\r\n                    };\r\n                    p2 = {\r\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\r\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y),\r\n                    };\r\n                    p2.x = p1.x + p2.x;\r\n                    p2.y = p1.y + p2.y;\r\n\r\n                } else {\r\n                    if (lineWidth % 2 === 0) {\r\n                        p1 = {\r\n                            x: x1f,\r\n                            y: y1f,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f,\r\n                            y: y2f,\r\n                        };\r\n                    } else {\r\n                        p1 = {\r\n                            x: x1f + 0.5,\r\n                            y: y1f + 0.5,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f + 0.5,\r\n                            y: y2f + 0.5,\r\n                        };\r\n                    }\r\n                }\r\n            } else {\r\n                p1 = {\r\n                    x: x1,\r\n                    y: y1,\r\n                };\r\n                p2 = {\r\n                    x: x2,\r\n                    y: y2,\r\n                };\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2.x = p2.x - p1.x;\r\n            p2.y = p2.y - p1.y;\r\n\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\r\n            } else {\r\n                ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\r\n            }\r\n\r\n        } else {  // --- circle ---\r\n            p1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n            x = p1.x;\r\n            y = p1.y;\r\n            dX = p2.x - p1.x;\r\n            dY = p2.y - p1.y;\r\n\r\n            ctx.beginPath();\r\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fill();\r\n            } else {\r\n                ctx.stroke();\r\n            }\r\n        }\r\n\r\n\r\n        ctx.restore();\r\n\r\n    } else {\r\n        throw new Error('unknown shape');\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {IRect} from '../../bb/bb-types';\r\n\r\nexport interface IRenderTextParam {\r\n    textStr: string; // text to be drawn. can contain newlines\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\r\n    align: 'left' | 'center' | 'right'; // default 'left'\r\n    isBold: boolean; // default false\r\n    isItalic: boolean; // default false\r\n    angleRad: number; // default 0 - rotates around x y\r\n    lineHeight?: number; // pixels\r\n    color: string;\r\n    isDebug?: boolean;\r\n}\r\n\r\n\r\n/**\r\n * Draw text on a canvas.\r\n *\r\n * @param canvas\r\n * @param p\r\n * @returns - bounds. coords relative to p.x p.y\r\n */\r\nexport function renderText (canvas: HTMLCanvasElement, p: IRenderTextParam): IRect {\r\n\r\n    // always at least a space. so bounds aren't just a dot\r\n    const textStr = p.textStr === '' ? ' ' : p.textStr;\r\n\r\n    // --- create el ---\r\n    // create an actual dom element. figure out where exactly each letter is positioned.\r\n    // that way multiline is feasible. canvas can't do multiline or text-align\r\n    const outer = BB.el({\r\n        css: {\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            width: '100000px',\r\n            fontSize: p.size + 'px',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n        },\r\n    });\r\n    const div = BB.el({\r\n        parent: outer,\r\n        css: {\r\n            display: 'inline-block',\r\n            textAlign: p.align ? p.align : 'left',\r\n            fontFamily: p.font ? p.font : 'sans-serif',\r\n            fontSize: p.size + 'px',\r\n            fontWeight: p.isBold ? 'bold' : 'normal',\r\n            fontStyle: p.isItalic ? 'italic' : 'normal',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n\r\n\r\n            opacity: '0',\r\n            pointerEvents: 'none',\r\n        },\r\n    });\r\n    let spanStr = '';\r\n    const replaceObj = {\r\n        '\\n': '<br>',\r\n        ' ': '&nbsp;',\r\n        '\t': '&nbsp;&nbsp;&nbsp;&nbsp;',\r\n    };\r\n    for (let i = 0; i < textStr.length; i++) {\r\n        if (textStr[i] === '\\n') {\r\n            BB.el({\r\n                parent: div,\r\n                tagName: 'span',\r\n                textContent: spanStr,\r\n                css: {\r\n                    whiteSpace: 'pre',\r\n                },\r\n            });\r\n            spanStr = '';\r\n            div.append(BB.el({\r\n                tagName: 'br',\r\n            }));\r\n            continue;\r\n        }\r\n        spanStr += textStr[i].replace('\\t', '    ');\r\n    }\r\n    BB.el({\r\n        parent: div,\r\n        tagName: 'span',\r\n        textContent: spanStr,\r\n        css: {\r\n            whiteSpace: 'pre',\r\n        },\r\n    });\r\n    document.body.append(outer);\r\n\r\n\r\n    // --- determine bounds ---\r\n    const bounds = {\r\n        x0: 99999999,\r\n        y0: 99999999,\r\n        x1: 0,\r\n        y1: 0,\r\n    };\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        const el = div.children[i] as HTMLElement;\r\n        bounds.x0 = Math.min(bounds.x0, el.offsetLeft);\r\n        bounds.y0 = Math.min(bounds.y0, el.offsetTop);\r\n        bounds.x1 = Math.max(bounds.x1, el.offsetLeft + el.offsetWidth);\r\n        bounds.y1 = Math.max(bounds.y1, el.offsetTop + el.offsetHeight);\r\n    }\r\n\r\n    // --- draw ---\r\n    const ctx = BB.ctx(canvas);\r\n    ctx.save();\r\n\r\n    const font = [];\r\n    if (p.isItalic) {\r\n        font.push('italic');\r\n    }\r\n    if (p.isBold) {\r\n        font.push('bold');\r\n    }\r\n    font.push(p.size + 'px ' + (p.font ? p.font : 'sans-serif'));\r\n    ctx.font = font.join(' ');\r\n    ctx.fillStyle = p.color ? p.color : '#000';\r\n\r\n    let x = p.x;\r\n    const y = p.y;\r\n    if (p.align === 'right') {\r\n        x += -bounds.x1 + bounds.x0;\r\n    }\r\n    if (p.align === 'center') {\r\n        x += (-bounds.x1 + bounds.x0) / 2;\r\n    }\r\n    ctx.translate(p.x, p.y);\r\n    ctx.rotate(p.angleRad ? -p.angleRad : 0);\r\n    ctx.translate(-p.x, -p.y);\r\n    ctx.translate(x, y);\r\n\r\n    // fill\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        const el = div.children[i] as HTMLElement;\r\n\r\n        //ctx.fillText(el.innerText, 0, 0);\r\n        ctx.fillText(el.innerText, el.offsetLeft, el.offsetTop);\r\n    }\r\n\r\n    if (p.isDebug) {\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeRect(0, -p.size * 0.85, bounds.x1, bounds.y1);\r\n        ctx.restore();\r\n        ctx.fillRect(p.x - 1, p.y - 1, 2, 2);\r\n    } else {\r\n        ctx.restore();\r\n    }\r\n\r\n    document.body.removeChild(outer);\r\n\r\n    return {\r\n        x: x - p.x,\r\n        y: y - p.y -p.size * 0.85,\r\n        width: bounds.x1 - bounds.x0,\r\n        height: bounds.y1 - bounds.y0,\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IKlProject} from '../kl-types';\r\n\r\nexport function drawProject (project: IKlProject, factor: number): HTMLCanvasElement {\r\n    const resultCanvas = BB.canvas(\r\n        Math.max(1, Math.round(project.width * factor)),\r\n        Math.max(1, Math.round(project.height * factor))\r\n    );\r\n    const ctx = BB.ctx(resultCanvas);\r\n    ctx.save();\r\n    if (factor > 1) {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n    for (let i = 0; i < project.layers.length; i++) {\r\n        if (project.layers[i].opacity === 0) {\r\n            continue;\r\n        }\r\n        ctx.globalAlpha = project.layers[i].opacity;\r\n        const mixModeStr = project.layers[i].mixModeStr;\r\n        ctx.globalCompositeOperation = mixModeStr !== undefined ? mixModeStr : 'source-over';\r\n        ctx.drawImage(project.layers[i].image, 0, 0, resultCanvas.width, resultCanvas.height);\r\n    }\r\n    ctx.restore();\r\n    return resultCanvas;\r\n}","import {IGradient} from '../kl-types';\r\nimport {BB} from '../../bb/bb';\r\n\r\n\r\ntype TOnGradient = (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\r\n\r\n/**\r\n * Input processor for gradient tool.\r\n * Coordinates are in canvas space.\r\n * angleRad is the angle of the canvas.\r\n */\r\nexport class GradientTool {\r\n    private downX: number;\r\n    private downY: number;\r\n    private downAngleRad: number;\r\n    private readonly onGradient: TOnGradient;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onGradient: TOnGradient;\r\n        }\r\n    ) {\r\n        this.onGradient = p.onGradient;\r\n    }\r\n\r\n    onDown (x: number, y: number, angleRad: number): void {\r\n        this.downX = x;\r\n        this.downY = y;\r\n        this.downAngleRad = angleRad;\r\n    }\r\n\r\n    onMove (x: number, y: number): void {\r\n        this.onGradient(false, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n\r\n    onUp (x: number, y: number): void {\r\n        this.onGradient(true, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n}\r\n\r\nexport function drawGradient (\r\n    ctx: CanvasRenderingContext2D,\r\n    gradientObj: IGradient,\r\n): void {\r\n    ctx.save();\r\n\r\n    const x1 = gradientObj.x1;\r\n    const y1 = gradientObj.y1;\r\n    let x2 = gradientObj.x2;\r\n    let y2 = gradientObj.y2;\r\n\r\n    if (gradientObj.doSnap) {\r\n        const angleDeg = gradientObj.angleRad * 180 / Math.PI;\r\n\r\n        const r1 = BB.rotate(x1, y1, gradientObj.angleRad / Math.PI * 180);\r\n        const r2 = BB.rotate(x2, y2, gradientObj.angleRad / Math.PI * 180);\r\n\r\n        const pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\r\n        const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\r\n        const rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\r\n        x2 = rotated.x;\r\n        y2 = rotated.y;\r\n\r\n        // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\r\n        if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\r\n            if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\r\n                x2 = x1;\r\n            } else { // left or right\r\n                y2 = y1;\r\n            }\r\n        }\r\n    }\r\n\r\n    let baseColor = gradientObj.color1;\r\n    if (gradientObj.isEraser && gradientObj.doLockAlpha) {\r\n        baseColor = {r: 255, g: 255, b: 255};\r\n    }\r\n    let color1 = BB.copyObj(baseColor);\r\n    color1.a = gradientObj.opacity;\r\n    let color2 = BB.copyObj(baseColor);\r\n    color2.a = 0;\r\n    if (gradientObj.isReversed) {\r\n        const temp = color1;\r\n        color1 = color2;\r\n        color2 = temp;\r\n    }\r\n\r\n    let gradient: CanvasGradient;\r\n    if (gradientObj.type === 'linear') {\r\n        gradient = ctx.createLinearGradient(x1, y1, x2, y2);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n\r\n    } else if (gradientObj.type === 'linear-mirror') {\r\n        const d = {\r\n            x: x2 - x1,\r\n            y: y2 - y1,\r\n        };\r\n        gradient = ctx.createLinearGradient(x1 - d.x,y1 - d.y, x2, y2);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color2));\r\n        gradient.addColorStop(0.5, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n\r\n    } else if (gradientObj.type === 'radial') {\r\n        const r = BB.Vec2.dist(\r\n            {x: x1, y: y1},\r\n            {x: x2, y: y2},\r\n        );\r\n        gradient = ctx.createRadialGradient(x1, y1, 0, x1, y1, r);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n    }\r\n\r\n    ctx.fillStyle = gradient!;\r\n    if (gradientObj.isEraser) {\r\n        ctx.globalCompositeOperation = 'destination-out';\r\n    }\r\n    if (gradientObj.doLockAlpha) {\r\n        ctx.globalCompositeOperation = 'source-atop';\r\n    }\r\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n\r\n    ctx.restore();\r\n}","import {TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TTranslationCode} from '../../../languages/languages';\r\n\r\nexport function translateBlending (blendMode?: TMixMode): string {\r\n    if (!blendMode) {\r\n        return LANG('layers-blend-normal');\r\n    }\r\n\r\n    const codes: {\r\n        [key: string]: TTranslationCode;\r\n    } = {\r\n        'source-over': 'layers-blend-normal',\r\n        'darken': 'layers-blend-darken',\r\n        'multiply': 'layers-blend-multiply',\r\n        'color-burn': 'layers-blend-color-burn',\r\n        'lighten': 'layers-blend-lighten',\r\n        'screen': 'layers-blend-screen',\r\n        'color-dodge': 'layers-blend-color-dodge',\r\n        'overlay': 'layers-blend-overlay',\r\n        'soft-light': 'layers-blend-soft-light',\r\n        'hard-light': 'layers-blend-hard-light',\r\n        'difference': 'layers-blend-difference',\r\n        'exclusion': 'layers-blend-exclusion',\r\n        'hue': 'layers-blend-hue',\r\n        'saturation': 'layers-blend-saturation',\r\n        'color': 'layers-blend-color',\r\n        'luminosity': 'layers-blend-luminosity',\r\n    };\r\n\r\n    if (!(blendMode in codes)) {\r\n        throw new Error('unknown blend mode');\r\n    }\r\n    return LANG(codes[blendMode]);\r\n}","import {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport {showModal} from '../../modals/base/showModal';\r\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\r\n\r\n\r\nexport function renameLayerDialog (\r\n    parentEl: HTMLElement,\r\n    currentName: string,\r\n    callback: (newName: string | undefined) => void\r\n): void {\r\n    const div = BB.el();\r\n\r\n    const label = BB.el({\r\n        content: LANG('layers-rename-name') + ':',\r\n        css: {\r\n            marginRight: '5px',\r\n        },\r\n    });\r\n\r\n    const row = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n        },\r\n    });\r\n    const input = BB.el({tagName: 'input'}) as HTMLInputElement;\r\n    input.value = currentName;\r\n    input.setAttribute('data-ignore-focus', 'true');\r\n    const clearBtn = BB.el({\r\n        tagName: 'Button',\r\n        content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/>',\r\n        title: LANG('layers-rename-clear'),\r\n        css: {\r\n            marginLeft: '10px',\r\n        },\r\n        onClick: () => {\r\n            input.value = '';\r\n            input.focus();\r\n        },\r\n    });\r\n    const suggestions = [\r\n        LANG('layers-rename-sketch'),\r\n        LANG('layers-rename-colors'),\r\n        LANG('layers-rename-shading'),\r\n        LANG('layers-rename-lines'),\r\n        LANG('layers-rename-effects'),\r\n        LANG('background'),\r\n        LANG('layers-rename-foreground'),\r\n    ];\r\n    const suggestionBtns: HTMLButtonElement[] = [];\r\n    const row2 = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            flexWrap: 'wrap',\r\n            marginTop: '5px',\r\n            marginLeft: '-5px',\r\n        },\r\n    }) as HTMLDivElement;\r\n    suggestions.forEach(item => {\r\n        const btn = BB.el({\r\n            parent: row2,\r\n            tagName: 'Button',\r\n            content: item,\r\n            onClick: () => {\r\n                input.value = '' + btn.textContent;\r\n            },\r\n            css: {\r\n                margin: '5px 0 0 5px',\r\n            },\r\n        }) as HTMLButtonElement;\r\n        suggestionBtns.push(btn);\r\n    });\r\n\r\n    div.append(label);\r\n    label.append(row, row2);\r\n    row.append(input, clearBtn);\r\n\r\n    setTimeout(() => {\r\n        input.focus();\r\n        input.select();\r\n    }, 10);\r\n\r\n    showModal({\r\n        target: parentEl,\r\n        message: `<b>${LANG('layers-rename-title')}</b>`,\r\n        div: div,\r\n        buttons: [LANG('layers-rename'), 'Cancel'],\r\n        primaries: [LANG('layers-rename')],\r\n        callback: (val) => {\r\n            BB.destroyEl(clearBtn);\r\n            suggestionBtns.forEach(item => {\r\n                BB.destroyEl(item);\r\n            });\r\n            suggestionBtns.splice(0, suggestionBtns.length);\r\n            if (val === LANG('layers-rename')) {\r\n                callback(input.value);\r\n            } else {\r\n                callback(undefined);\r\n            }\r\n        },\r\n        clickOnEnter: LANG('layers-rename'),\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1twgF\");","import {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport {Options} from '../../components/options';\r\nimport {translateBlending} from '../../../canvas/translate-blending';\r\nimport {showModal} from '../../modals/base/showModal';\r\nimport {TMixMode} from '../../../kl-types';\r\nimport {theme} from '../../../../theme/theme';\r\n\r\nexport function mergeLayerDialog (\r\n    parentEl: HTMLElement,\r\n    p: {\r\n        topCanvas: HTMLCanvasElement;\r\n        bottomCanvas: HTMLCanvasElement;\r\n        topOpacity: number;\r\n        mixModeStr: TMixMode;\r\n        callback: (mode?: string) => void;\r\n    }\r\n): void {\r\n    const div = BB.el();\r\n    div.innerHTML = LANG('layers-merge-description');\r\n\r\n    const options = new Options({\r\n        optionArr: [\r\n            {id: p.mixModeStr, label: translateBlending(p.mixModeStr)},\r\n            {id: 'source-in', label: 'source-in'},\r\n            {id: 'source-out', label: 'source-out'},\r\n            {id: 'source-atop', label: 'source-atop'},\r\n            {id: 'destination-in', label: 'destination-in'},\r\n            {id: 'destination-out', label: 'destination-out'},\r\n            {id: 'destination-atop', label: 'destination-atop'},\r\n            {id: 'xor', label: 'xor'},\r\n        ],\r\n        initId: p.mixModeStr,\r\n        onChange: () => {\r\n            update();\r\n        },\r\n        isSmall: true,\r\n    });\r\n    options.getElement().style.marginTop = '5px';\r\n    div.append(options.getElement());\r\n\r\n    const thumbDimensions = BB.fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\r\n    const preview = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n    preview.title = LANG('preview');\r\n    preview.className = 'kl-merge-preview';\r\n    const spacer = BB.el({\r\n        content: '<br/>',\r\n        css: {\r\n            clear: 'both',\r\n        },\r\n    });\r\n    div.append(spacer, preview);\r\n\r\n    function updateCheckerboard (): void {\r\n        BB.createCheckerDataUrl(4, (url) => {\r\n            preview.style.backgroundImage = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n    }\r\n    updateCheckerboard();\r\n    theme.addIsDarkListener(updateCheckerboard);\r\n\r\n    const alphaCanvas = BB.copyCanvas(preview);\r\n    BB.ctx(alphaCanvas).drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\r\n    BB.convertToAlphaChannelCanvas(alphaCanvas);\r\n\r\n    const update = () => {\r\n        const ctx = BB.ctx(preview);\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, preview.width, preview.height);\r\n        if (preview.width > p.topCanvas.width) {\r\n            ctx.imageSmoothingEnabled = false;\r\n        }\r\n        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\r\n\r\n        if (options.getValue() === 'as-alpha') {\r\n            ctx.globalCompositeOperation = 'destination-in';\r\n            ctx.globalAlpha = p.topOpacity;\r\n            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\r\n        } else {\r\n            ctx.globalCompositeOperation = options.getValue();\r\n            ctx.globalAlpha = p.topOpacity;\r\n            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\r\n        }\r\n        ctx.restore();\r\n    };\r\n\r\n    update();\r\n\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: (keyStr: string) => {\r\n            if (keyStr === 'right') {\r\n                options.next();\r\n            }\r\n            if (keyStr === 'left') {\r\n                options.previous();\r\n            }\r\n        },\r\n    });\r\n\r\n    showModal({\r\n        target: parentEl,\r\n        message: `<b>${LANG('layers-merge-modal-title')}</b>`,\r\n        div: div,\r\n        buttons: ['Ok', 'Cancel'],\r\n        clickOnEnter: 'Ok',\r\n        callback: (val) => {\r\n            keyListener.destroy();\r\n            options.destroy();\r\n            theme.removeIsDarkListener(updateCheckerboard);\r\n            if (val === 'Ok') {\r\n                p.callback(options.getValue());\r\n            }\r\n        },\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"70WHw\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3huo1\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1AvFX\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ftA1L\");","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl-types';\r\n\r\n/**\r\n * Overlay for KlCanvasWorkspace.\r\n * - brush circle\r\n * - eyedropper circle\r\n * - compass needle (rotation hud)\r\n */\r\nexport class WorkspaceSvgOverlay {\r\n    private readonly rootElement: SVGElement;\r\n    private readonly brushCircleOuter: SVGElement;\r\n    private readonly brushCircleInner: SVGElement;\r\n    private readonly pickerPreviewBorder: SVGElement;\r\n    private readonly pickerPreviewCol: SVGElement;\r\n    private readonly compassSize: number;\r\n    private readonly compass: SVGElement;\r\n    private readonly compassInner: SVGElement;\r\n    private readonly compassBaseCircle: SVGElement;\r\n    private readonly compassLineCircle: SVGElement;\r\n    private readonly compassUpperTriangle: SVGElement;\r\n    private readonly compassLowerTriangle: SVGElement;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n        }\r\n    ) {\r\n        this.rootElement = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + p.width,\r\n            height: '' + p.height,\r\n        });\r\n        BB.css(this.rootElement, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            pointerEvents: 'none',\r\n            userSelect: 'none',\r\n        });\r\n\r\n        //brush circles\r\n        this.brushCircleOuter = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '10',\r\n            stroke: 'rgba(0,0,0,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.brushCircleInner = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '9',\r\n            stroke: 'rgba(255,255,255,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\r\n\r\n        //color picker preview circle\r\n        this.pickerPreviewBorder = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '22',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewBorder.style.opacity = '0';\r\n        this.pickerPreviewCol = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '20',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewCol.style.opacity = '0';\r\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\r\n\r\n\r\n        //rotation compass\r\n        this.compassSize = 30;\r\n        this.compass = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'translate(' + (p.width/2) + ', ' + (p.height/2) + ')',\r\n        });\r\n        BB.css(this.compass, {\r\n            transition: 'opacity 0.25s ease-in-out',\r\n            opacity: '0',\r\n        });\r\n        this.compassInner = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'rotate(45)',\r\n        });\r\n        this.compassBaseCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'rgba(0,0,0,0.9)',\r\n            stroke: 'none',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + this.compassSize,\r\n        });\r\n        this.compassLineCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'none',\r\n            stroke: 'rgba(255,255,255,0.75)',\r\n            'stroke-width': '1',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + (this.compassSize * 0.9),\r\n        });\r\n        this.compassUpperTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#f00',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,-'+(this.compassSize * 0.9)+' z',\r\n        });\r\n        this.compassLowerTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#fff',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,'+(this.compassSize * 0.9)+' z',\r\n        });\r\n\r\n        this.compassInner.append(\r\n            this.compassBaseCircle,\r\n            this.compassLineCircle,\r\n            this.compassUpperTriangle,\r\n            this.compassLowerTriangle\r\n        );\r\n        this.compass.append(this.compassInner);\r\n        this.rootElement.append(this.compass);\r\n    }\r\n\r\n    getElement (): SVGElement {\r\n        return this.rootElement;\r\n    }\r\n\r\n    setSize (width: number, height: number): void {\r\n        this.rootElement.setAttribute('width', '' + width);\r\n        this.rootElement.setAttribute('height', '' + height);\r\n        this.compass.setAttribute('transform', 'translate(' + (width/2) + ', ' + (height/2) + ')');\r\n    }\r\n\r\n    updateCursor (p: {\r\n        x?: number;\r\n        y?: number;\r\n        radius?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if (p.x !== undefined) {\r\n            this.brushCircleOuter.setAttribute('cx', '' + p.x);\r\n            this.brushCircleInner.setAttribute('cx', '' + p.x);\r\n        }\r\n        if (p.y !== undefined) {\r\n            this.brushCircleOuter.setAttribute('cy', '' + p.y);\r\n            this.brushCircleInner.setAttribute('cy', '' + p.y);\r\n        }\r\n        if (p.radius !== undefined) {\r\n            this.brushCircleOuter.setAttribute('r', '' + Math.max(0, p.radius));\r\n            this.brushCircleInner.setAttribute('r', '' + Math.max(0, p.radius - 1));\r\n        }\r\n        if (p.isVisible !== undefined) {\r\n            this.brushCircleOuter.style.opacity = p.isVisible ? '1' : '0';\r\n            this.brushCircleInner.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateColorPreview (p: {\r\n        x?: number;\r\n        y?: number;\r\n        color?: IRGB;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if (p.x !== undefined) {\r\n            this.pickerPreviewCol.setAttribute('cx', '' + p.x);\r\n            this.pickerPreviewBorder.setAttribute('cx', '' + p.x);\r\n        }\r\n        if (p.y !== undefined) {\r\n            this.pickerPreviewCol.setAttribute('cy', '' + p.y);\r\n            this.pickerPreviewBorder.setAttribute('cy', '' + p.y);\r\n        }\r\n        if (p.color) {\r\n            this.pickerPreviewCol.setAttribute('stroke', BB.ColorConverter.toRgbStr(p.color));\r\n            const borderColor = BB.testIsWhiteBestContrast(p.color) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)';\r\n            this.pickerPreviewBorder.setAttribute('stroke', borderColor);\r\n        }\r\n        if (p.isVisible !== undefined) {\r\n            this.pickerPreviewCol.style.opacity = p.isVisible ? '1' : '0';\r\n            this.pickerPreviewBorder.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateCompass (p: {\r\n        angleDeg?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if (p.angleDeg !== undefined) {\r\n            this.compassInner.setAttribute('transform', 'rotate(' + p.angleDeg + ')');\r\n            this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? '1' : '0';\r\n        }\r\n        if (p.isVisible !== undefined) {\r\n            this.compass.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB, ITransform, TDrawEvent} from '../kl-types';\r\nimport {WorkspaceSvgOverlay} from './workspace-svg-overlay';\r\nimport {klHistory} from '../history/kl-history';\r\nimport pickerImg from '/src/app/img/ui/cursor-picker.png';\r\nimport zoomEwImg from '/src/app/img/ui/cursor-zoom-ew.png';\r\nimport fillImg from '/src/app/img/ui/cursor-fill.png';\r\nimport textImg from '/src/app/img/ui/cursor-text.png';\r\nimport {IPressureInput, IVector2D} from '../../bb/bb-types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {KeyListener} from '../../bb/input/key-listener';\r\nimport {KL} from '../kl';\r\nimport {IPointerEvent} from '../../bb/input/event.types';\r\nimport {LinetoolProcessor} from '../events/linetool-processor';\r\nimport {PinchZoomer} from '../../bb/input/event-chain/pinch-zoomer';\r\nimport {DoubleTapper} from '../../bb/input/event-chain/double-tapper';\r\nimport {NFingerTapper} from '../../bb/input/event-chain/n-finger-tapper';\r\nimport {EventChain} from '../../bb/input/event-chain/event-chain';\r\nimport {PointerListener} from '../../bb/input/pointer-listener';\r\nimport {theme} from '../../theme/theme';\r\n\r\nexport interface IViewChangeEvent {\r\n    changed: ('scale' | 'angle')[];\r\n    angle: number;\r\n    scale: number;\r\n}\r\n\r\ntype TModeStr = 'draw' | 'pick' | 'hand' | 'shape' | 'fill' | 'gradient' | 'text'; // | 'transform' | 'select'\r\n\r\nconst MIN_SCALE = 1 / 16;\r\nconst MAX_SCALE = 64;\r\nenum TMode {\r\n    Draw,\r\n    Hand,\r\n    HandGrabbing,\r\n    Pick,\r\n    Zoom,\r\n    Rotate,\r\n    Rotating,\r\n    Fill,\r\n    Gradient,\r\n    Text,\r\n    Shape,\r\n}\r\nconst ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\r\n\r\n/**\r\n * Work area that displays the KlCanvas.\r\n * - pan, zoom, rotate (also via multi-touch)\r\n * - input modes: drawing, hand, pick, fill, text // transform, select\r\n * - drawing input events\r\n * - view change events\r\n * - eyedropper input events (pick)\r\n * - draws cursor, eyedropper overlay\r\n *\r\n * subscribes to klCanvas changes\r\n * listens to kl history for changes\r\n * and you can manually trigger redraw\r\n */\r\nexport class KlCanvasWorkspace {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private klCanvas: KlCanvas;\r\n    private readonly renderTargetCanvas: HTMLCanvasElement;\r\n    private readonly renderTargetCtx: CanvasRenderingContext2D;\r\n    private renderWidth: number;\r\n    private renderHeight: number;\r\n    private readonly compositeCanvas: HTMLCanvasElement; // for drawing klcanvas layer composite\r\n    private readonly compositeCtx: CanvasRenderingContext2D;\r\n    private doResizeCanvas: boolean;\r\n    private oldTransformObj: ITransform;\r\n    private targetTransformObj: ITransform; // animation target\r\n    private highResTransformObj: ITransform; // animated, internal high res\r\n    private readonly renderedTransformObj: ITransform; // same as highRes, but rounded - what's actually displayed\r\n    private cursorPos: IVector2D;\r\n    private readonly usesCssCursor: boolean;\r\n    private bgVisible: boolean;\r\n    private transformIsDirty: boolean;\r\n    private doAnimateTranslate: boolean;\r\n    private svgOverlay: WorkspaceSvgOverlay;\r\n    private readonly emptyCanvas: HTMLCanvasElement;\r\n    private readonly emptyLightCanvas: HTMLCanvasElement;\r\n    private keyListener: KeyListener;\r\n    private currentMode: TMode;\r\n    private globalMode: TMode;\r\n    private renderTime: number; // for debugging - average ms per render()\r\n    private lastDrawEvent: IPressureInput | null; // previous drawing input\r\n    private linetoolProcessor: LinetoolProcessor;\r\n    private pointer: IVector2D | null; // position of cursor\r\n    private isDrawing: boolean;\r\n    private inputProcessorObj: any; // todo type\r\n    private currentInputProcessor: any; // todo type\r\n    private angleIsExtraSticky: boolean;\r\n    private readonly pinchZoomer: PinchZoomer;\r\n    private readonly mainDoubleTapper: DoubleTapper;\r\n    private readonly middleDoubleTapper: DoubleTapper;\r\n    private readonly twoFingerTap: NFingerTapper;\r\n    private readonly threeFingerTap: NFingerTapper;\r\n    private pointerEventChain: EventChain;\r\n    private pointerListener: PointerListener | undefined;\r\n    private brushRadius: number;\r\n    private animationFrameRequested: boolean;\r\n    private lastRenderedState: number; // KlHistory state - to detect if there are changes to draw\r\n    private lastRenderTime: number; // ms from performance.now()\r\n    private hideBrushCursorTimeout: (ReturnType<typeof setTimeout>) | undefined;\r\n    private readonly onViewChange: (e:  IViewChangeEvent) => void;\r\n\r\n    private getRenderedTransform (): ITransform {\r\n        // rounded x & y so canvas is less blurry.\r\n        const result = this.renderedTransformObj;\r\n        result.x = this.highResTransformObj.x;\r\n        result.y = this.highResTransformObj.y;\r\n        result.scale = this.highResTransformObj.scale;\r\n        result.angle = this.highResTransformObj.angle;\r\n\r\n        if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\r\n            result.x = Math.round(result.x);\r\n            result.y = Math.round(result.y);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private updateChangeListener (): void {\r\n        this.klCanvas.addChangeListener(() => {\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n        });\r\n    }\r\n\r\n    private updateCursor (modeInt: TMode, doForce?: boolean): void {\r\n        if (modeInt === this.currentMode && !doForce) {\r\n            return;\r\n        }\r\n        const oldMode = this.currentMode;\r\n        this.currentMode = modeInt;\r\n        this.lastRenderedState = -1;\r\n        if (this.currentMode === TMode.Draw) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        } else if (this.currentMode === TMode.Hand) {\r\n            this.rootEl.style.cursor = 'grab';\r\n        } else if (this.currentMode === TMode.HandGrabbing) {\r\n            this.rootEl.style.cursor = 'grabbing';\r\n        } else if (this.currentMode === TMode.Pick) {\r\n            this.rootEl.style.cursor = \"url('\" + pickerImg + \"') 0 15, crosshair\";\r\n        } else if (this.currentMode === TMode.Zoom) {\r\n            this.rootEl.style.cursor = \"url('\" + zoomEwImg + \"') 7 7, zoom-in\";\r\n        } else if (this.currentMode === TMode.Rotate) {\r\n            this.rootEl.style.cursor = 'grab';\r\n        } else if (this.currentMode === TMode.Rotating) {\r\n            this.rootEl.style.cursor = 'grabbing';\r\n        } else if (this.currentMode === TMode.Fill) {\r\n            this.rootEl.style.cursor = \"url('\" + fillImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Gradient) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        } else if (this.currentMode === TMode.Text) {\r\n            this.rootEl.style.cursor = \"url('\" + textImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Shape) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        }\r\n\r\n        if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode)) {\r\n            const oldIsHand = [TMode.Hand, TMode.HandGrabbing].includes(oldMode);\r\n            const currentIsHand = [TMode.Hand, TMode.HandGrabbing].includes(this.currentMode);\r\n            if (!oldIsHand && currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n            }\r\n            if (oldIsHand && !currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n            }\r\n        }\r\n\r\n        if (this.currentMode !== TMode.Pick) {\r\n            this.svgOverlay.updateColorPreview({isVisible: false});\r\n        }\r\n    }\r\n\r\n    /**\r\n     * returns false if no change of zoom\r\n     * @param stepNum\r\n     * @param centerX\r\n     * @param centerY\r\n     * @private\r\n     */\r\n    private internalZoomByStep (stepNum: number, centerX: number, centerY: number): boolean {\r\n        const step = Math.log2(this.targetTransformObj.scale);\r\n\r\n        let newStep = step / Math.abs(stepNum);\r\n        newStep += stepNum > 0 ? 1 : -1;\r\n        newStep = Math.round(newStep);\r\n        newStep *= Math.abs(stepNum);\r\n        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, Math.pow(2, newStep)));\r\n\r\n        //has zoomed?\r\n        if (newScale === this.targetTransformObj.scale) {\r\n            return false;\r\n        }\r\n\r\n\r\n        const effectiveFactor = newScale / this.targetTransformObj.scale;\r\n        this.targetTransformObj.scale = newScale;\r\n\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerX, centerY));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerX, -centerY));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.transformIsDirty = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * mixes two transform objects. modifies A\r\n     * @param transformA\r\n     * @param transformB\r\n     * @param blendFactor 0 -> A, 1 -> B\r\n     * @private\r\n     */\r\n    private mixTransformObj (transformA: ITransform, transformB: ITransform, blendFactor: number): void {\r\n        if (transformA.angle === transformB.angle) {\r\n            transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n            transformA.x = BB.mix(transformA.x, transformB.x, blendFactor);\r\n            transformA.y = BB.mix(transformA.y, transformB.y, blendFactor);\r\n            transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n            return;\r\n        }\r\n\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        // --- determine centerPosA, centerPosB ---\r\n        const centerPosA = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2,\r\n        }, transformA);\r\n        const centerPosB = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2,\r\n        }, transformB);\r\n\r\n        // --- centerPosMixed ---\r\n        transformA.x = BB.mix(centerPosA.x , centerPosB.x, blendFactor);\r\n        transformA.y = BB.mix(centerPosA.y , centerPosB.y, blendFactor);\r\n\r\n        // --- scale and angle ---\r\n        transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n        transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n\r\n        // --- x and y ---\r\n        const mixedPos = this.canvasToWorkspaceCoord({\r\n            x: -w / 2,\r\n            y: -h / 2,\r\n        }, transformA);\r\n        transformA.x = mixedPos.x;\r\n        transformA.y = mixedPos.y;\r\n    }\r\n\r\n    private render (): void {\r\n        if (this.doResizeCanvas) {\r\n            this.doResizeCanvas = false;\r\n            this.renderTargetCanvas.width = this.renderWidth;\r\n            this.renderTargetCanvas.height = this.renderHeight;\r\n        }\r\n        this.renderContext(this.renderTargetCtx);\r\n    }\r\n\r\n    /**\r\n     * is the gray background that surrounds canvas visible?\r\n     * @private\r\n     */\r\n    private testBgVisible (): boolean {\r\n        //bring workspace points (corners of workspace) into canvas coordinate system\r\n        //then check if any corner point is outside of the canvas -> that means the bg is visible\r\n\r\n        const workspacePointArr = [\r\n            [0, 0], // top left\r\n            [this.renderWidth, 0], // top right\r\n            [this.renderWidth, this.renderHeight], // bottom right\r\n            [0, this.renderHeight], // bottom left\r\n        ];\r\n\r\n        const art = this.getRenderedTransform();\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        //transform points, then test if outside of canvas\r\n        for (let i = 0; i < workspacePointArr.length; i++) {\r\n            let coords = [workspacePointArr[i][0], workspacePointArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n            if (\r\n                !(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() &&\r\n                    0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())\r\n            ){\r\n                //if not inside -> bg visible\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private renderContext (ctx: CanvasRenderingContext2D): void {\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        const art = this.getRenderedTransform();\r\n        const isDark = theme.isDark();\r\n\r\n        if (art.scale >= 4 || (art.scale === 1 && art.angle === 0)) {\r\n            ctx.imageSmoothingEnabled = false;\r\n        } else {\r\n            ctx.imageSmoothingEnabled = true;\r\n            ctx.imageSmoothingQuality  = 'low'; // art.scale >= 1 ? 'low' : 'medium';\r\n        }\r\n        //ctx.imageSmoothingEnabled = false;\r\n        //renderTargetCtx.globalCompositeOperation  = 'multiply';\r\n\r\n\r\n\r\n        ctx.save();\r\n        {\r\n            if (this.bgVisible) {\r\n                ctx.fillStyle = isDark ? 'rgb(33, 33, 33)' : 'rgb(158,158,158)'; // 'rgb(185,185,185)';\r\n                ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\r\n            } else {\r\n                ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\r\n            }\r\n\r\n\r\n\r\n            if (this.bgVisible) {\r\n                ctx.save();\r\n\r\n                ctx.translate(art.x, art.y);\r\n                ctx.scale(art.scale, art.scale);\r\n                ctx.rotate(art.angle);\r\n\r\n                ctx.imageSmoothingEnabled = false;\r\n\r\n                //outline\r\n                const borderSize = 1;\r\n                ctx.globalAlpha = isDark ? 0.25 : 0.2;\r\n                ctx.drawImage(\r\n                    isDark ? this.emptyLightCanvas : this.emptyCanvas,\r\n                    -borderSize / art.scale,\r\n                    -borderSize / art.scale,\r\n                    w + borderSize * 2 / art.scale,\r\n                    h + borderSize * 2 / art.scale\r\n                );\r\n                ctx.globalAlpha = 1;\r\n\r\n                //erase\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n                ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\r\n\r\n                ctx.restore();\r\n            }\r\n\r\n            /*const region = new Path2D();\r\n            region.rect(80, 10, 20, 130);\r\n            ctx.clip(region);*/\r\n\r\n            ctx.translate(art.x, art.y);\r\n            ctx.scale(art.scale, art.scale);\r\n            ctx.rotate(art.angle);\r\n\r\n            const layerArr = this.klCanvas.getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    ctx.globalAlpha = layerArr[i].opacity;\r\n                    ctx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n\r\n                    if (layerArr[i].canvas.compositeObj) {\r\n                        if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\r\n                            this.compositeCanvas.width = layerArr[i].canvas.width;\r\n                            this.compositeCanvas.height = layerArr[i].canvas.height;\r\n                        } else {\r\n                            this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\r\n                        }\r\n                        this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\r\n                        layerArr[i].canvas.compositeObj.draw(this.compositeCtx);\r\n                        ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\r\n                    } else {\r\n                        ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\r\n                    }\r\n                }\r\n            }\r\n            ctx.globalAlpha = 1;\r\n\r\n\r\n\r\n        }\r\n        ctx.restore();\r\n\r\n        // rotation hud\r\n        if (TMode.Rotate === this.currentMode || TMode.Rotating === this.currentMode) {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: true,\r\n                angleDeg: art.angle / Math.PI * 180,\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: false,\r\n            });\r\n        }\r\n    }\r\n\r\n    private workspaceToCanvasCoord (p: IVector2D): IVector2D {\r\n        const art = this.getRenderedTransform();\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private canvasToWorkspaceCoord (p: IVector2D, transformObj: ITransform): IVector2D {\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(transformObj.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(transformObj.scale));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private snapAngleRad (angleRad: number, snapDegIncrement: number, maxDistDeg: number): number {\r\n        let angleDeg = angleRad * 180 / Math.PI;\r\n        const modDeg = Math.abs(angleDeg % snapDegIncrement);\r\n        const dist = Math.min(modDeg, snapDegIncrement - modDeg);\r\n\r\n        if (dist <= maxDistDeg) {\r\n            angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\r\n        }\r\n\r\n        return angleDeg / 180 * Math.PI;\r\n    }\r\n\r\n    /**\r\n     * angle always in range [-PI, PI]\r\n     * @param angleRad\r\n     * @private\r\n     */\r\n    private minimizeAngleRad (angleRad: number): number {\r\n        angleRad = angleRad % (2 * Math.PI);\r\n        if (angleRad > Math.PI) {\r\n            angleRad -= 2 * Math.PI;\r\n        } else if (angleRad < -Math.PI) {\r\n            angleRad += 2 * Math.PI;\r\n        }\r\n        return angleRad;\r\n    }\r\n\r\n    private resetInputProcessor (): void {\r\n        this.currentInputProcessor = null;\r\n        this.updateCursor(this.globalMode);\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    private reqFrame (doRedrawCanvas?: boolean): void {\r\n        this.animationFrameRequested = true;\r\n        if (doRedrawCanvas) {\r\n            this.lastRenderedState = -1;\r\n        }\r\n    }\r\n\r\n    private updateLoop (): void {\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState;\r\n\r\n        //handle variable framerate\r\n        const nowTime = performance.now();\r\n        const elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\r\n        this.lastRenderTime = nowTime;\r\n\r\n        if (this.animationFrameRequested || doRender) {\r\n            this.animationFrameRequested = false;\r\n            this.checkChange(elapsedFrames);\r\n        }\r\n    }\r\n\r\n    private checkChange (elapsedFrames: number): void {\r\n\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState ||\r\n            this.highResTransformObj.scale !== this.targetTransformObj.scale ||\r\n            this.highResTransformObj.x !== this.targetTransformObj.x ||\r\n            this.highResTransformObj.y !== this.targetTransformObj.y;\r\n\r\n        //update transform\r\n        if (\r\n            !this.doAnimateTranslate &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else if (\r\n            (this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) &&\r\n            (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            this. doAnimateTranslate = false;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else {\r\n            this.reqFrame(); //probably needs another frame\r\n            const blendFactor = Math.min(1, ANIMATION_SPEED * elapsedFrames);\r\n            this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\r\n            this.bgVisible = true; // spare yourself the calculation\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        }\r\n\r\n        if (this.pointer && this.currentMode == TMode.Draw && !this.usesCssCursor) {\r\n            this.svgOverlay.updateCursor({\r\n                x: this.pointer.x,\r\n                y: this.pointer.y,\r\n                isVisible: true,\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCursor({isVisible: false});\r\n        }\r\n\r\n\r\n        if (doRender) {\r\n            //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\r\n            this.lastRenderedState = newState;\r\n            const start = performance.now();\r\n            this.render();\r\n            this.renderTime = BB.mix(this.renderTime, performance.now() - start, 0.05);\r\n        }\r\n        //setTimeout(this.checkChange, 100);\r\n\r\n\r\n\r\n        if (doRender) {\r\n\r\n            //console.log('rendertime ms: ', this.renderTime);\r\n        }\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            klCanvas: any; // todo\r\n            width: number;\r\n            height: number;\r\n            onDraw: (val: TDrawEvent) => void; // todo\r\n            onPick: (rgb: IRGB, isPointerup: boolean) => void;\r\n            onFill: (canvasX: number, canvasY: number) => void;\r\n            onGradient: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onText: (canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onShape: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onViewChange: (e:  IViewChangeEvent) => void;\r\n            onUndo: () => void;\r\n            onRedo: () => void;\r\n        }\r\n    ) {\r\n        const _this = this;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                right: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                cursor: 'crosshair',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.klCanvas = p.klCanvas;\r\n        this.onViewChange = p.onViewChange;\r\n        this.renderTargetCanvas = BB.canvas(p.width, p.height);\r\n        this.renderTargetCtx = BB.ctx(this.renderTargetCanvas);\r\n        this.renderWidth = p.width;\r\n        this.renderHeight = p.height;\r\n        this.compositeCanvas = BB.canvas(1, 1); // for drawing klcanvas layer composite\r\n        this.compositeCtx = BB.ctx(this.compositeCanvas);\r\n        this.doResizeCanvas = false;\r\n        this.oldTransformObj = null;\r\n        this.targetTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0,\r\n        };\r\n        this.highResTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0,\r\n        };\r\n        this.renderedTransformObj = {\r\n            x: null,\r\n            y: null,\r\n            scale: null,\r\n            angle: null,\r\n        };\r\n        this.cursorPos = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        this.usesCssCursor = false;\r\n        this.bgVisible = true;\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n\r\n        this.svgOverlay = new WorkspaceSvgOverlay({\r\n            width: p.width,\r\n            height: p.height,\r\n        });\r\n\r\n        BB.css(this.renderTargetCanvas, {\r\n            userSelect: 'none',\r\n            pointerEvents: 'none',\r\n        });\r\n        BB.createCheckerDataUrl(8, (url) => {\r\n            this.renderTargetCanvas.style.background = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n\r\n        theme.addIsDarkListener(() => {\r\n            this.renderTargetCanvas.style.background = 'url(' + BB.createCheckerDataUrl(8, undefined, theme.isDark()) + ')';\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n        });\r\n\r\n        this.rootEl.append(this.renderTargetCanvas, this.svgOverlay.getElement());\r\n        this.rootEl.addEventListener( 'touchend', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        this.rootEl.addEventListener('contextmenu', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        this.rootEl.addEventListener('dragstart', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n\r\n        this.emptyCanvas = BB.canvas(1, 1);\r\n        this.emptyLightCanvas = BB.canvas(1, 1);\r\n        {\r\n            let ctx = BB.ctx(this.emptyCanvas);\r\n            ctx.fillRect(0, 0, 1, 1);\r\n            ctx = BB.ctx(this.emptyLightCanvas);\r\n            ctx.fillStyle = '#fff';\r\n            ctx.fillRect(0, 0, 1, 1);\r\n        }\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n                if (isRepeat) {\r\n                    return;\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n\r\n                } else {\r\n\r\n                    if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'space') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.spaceHand;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ([TMode.Draw, TMode.Hand, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'alt') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.altPicker;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if (['r', 'shift+r'].includes(comboStr)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.rotate;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ('z' === comboStr) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.zoom;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                }\r\n\r\n            },\r\n            onUp: (keyStr, event, oldComboStr) => {\r\n                // prevent menu bar in Firefox\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\r\n                }\r\n            },\r\n        });\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.currentMode = TMode.Draw;\r\n        this.globalMode = TMode.Draw;\r\n\r\n        this.renderTime = 0;\r\n\r\n        this.lastDrawEvent = null;\r\n\r\n        this.linetoolProcessor = new LinetoolProcessor({\r\n            onDraw: (event) => {\r\n                const getMatrix = () => {\r\n                    const art = this.getRenderedTransform();\r\n                    let matrix = BB.Matrix.getIdentity();\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n                    return matrix;\r\n                };\r\n\r\n                if (event.type === 'line' && !this.lastDrawEvent) {\r\n                    const matrix = getMatrix();\r\n                    let coords = [event.x1, event.y1, 0, 1];\r\n                    coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                    this.lastDrawEvent = {\r\n                        x: coords[0],\r\n                        y: coords[1],\r\n                        pressure: event.pressure1,\r\n                    };\r\n                    return;\r\n                }\r\n\r\n                if ('x' in event || 'x0' in event) {\r\n\r\n                    const matrix = getMatrix();\r\n\r\n                    if ('x' in event) { //down or move\r\n                        let coords = [event.x, event.y, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x = coords[0];\r\n                        event.y = coords[1];\r\n                    }\r\n                    if ('x0' in event) { //line\r\n                        event.x0 = this.lastDrawEvent.x;\r\n                        event.y0 = this.lastDrawEvent.y;\r\n                        event.pressure0 = this.lastDrawEvent.pressure;\r\n                        let coords = [event.x1, event.y1, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x1 = coords[0];\r\n                        event.y1 = coords[1];\r\n\r\n                        this.lastDrawEvent = {\r\n                            x: event.x1,\r\n                            y: event.y1,\r\n                            pressure: event.pressure1,\r\n                        };\r\n                    }\r\n                }\r\n\r\n\r\n                if (event.type === 'down' || event.type === 'move') {\r\n                    this.lastDrawEvent = {\r\n                        x: event.x,\r\n                        y: event.y,\r\n                        pressure: event.pressure,\r\n                    };\r\n                }\r\n                p.onDraw(event);\r\n            },\r\n        });\r\n\r\n        this.pointer = null;\r\n        this.isDrawing = false;\r\n\r\n\r\n        this.inputProcessorObj = {\r\n            draw: {\r\n                onPointer: (val) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Draw);\r\n\r\n                    const comboStr = this.keyListener.getComboStr();\r\n\r\n                    const event: any = {\r\n                        scale: this.highResTransformObj.scale,\r\n                    };\r\n                    event.shiftIsPressed = comboStr === 'shift';\r\n                    event.pressure = val.pressure;\r\n                    event.isCoalesced = !!val.isCoalesced;\r\n\r\n                    if (val.type === 'pointerdown') {\r\n\r\n                        this.isDrawing = true;\r\n                        event.type = 'down';\r\n\r\n                    } else if (val.button) {\r\n                        event.type = 'move';\r\n\r\n                    } else if (val.type === 'pointerup') {\r\n\r\n                        this.isDrawing = false;\r\n                        event.type = 'up';\r\n\r\n                        this.linetoolProcessor.process(event);\r\n                        this.resetInputProcessor();\r\n                        return;\r\n                    } else {\r\n                        return;\r\n                    }\r\n\r\n                    event.x = val.relX;\r\n                    event.y = val.relY;\r\n\r\n                    this.linetoolProcessor.process(event);\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            fill: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Fill);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            gradient: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Gradient);\r\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        this.isDrawing = true;\r\n                        p.onGradient('down', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        p.onGradient('move', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.isDrawing = false;\r\n                        p.onGradient('up', coord.x, coord.y, this.renderedTransformObj.angle);\r\n                        this.resetInputProcessor();\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            text: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Text);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            shape: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Shape);\r\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        this.isDrawing = true;\r\n                        p.onShape('down', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        p.onShape('move', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.isDrawing = false;\r\n                        p.onShape('up', coord.x, coord.y, this.renderedTransformObj.angle);\r\n                        this.resetInputProcessor();\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            hand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            spaceHand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'space') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                },\r\n            },\r\n            zoom: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Zoom);\r\n\r\n                    if (event.button === 'left' && !event.isCoalesced && event.dX != 0) {\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n\r\n                        this.internalZoomByStep(event.dX / 175, event.downPageX - offsetX, event.downPageY - offsetY);\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale,\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'z') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Zoom);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                },\r\n            },\r\n            picker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup',\r\n                        });\r\n\r\n                        if (event.type === 'pointerup') {\r\n                            this.resetInputProcessor();\r\n                        }\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            altPicker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup',\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'alt') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                },\r\n            },\r\n            rotate: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(event.button === 'left' ? TMode.Rotating : TMode.Rotate);\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.oldTransformObj = BB.copyObj(this.targetTransformObj);\r\n                    } else if (event.button === 'left' && !event.isCoalesced && this.oldTransformObj) {\r\n\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n                        //rotation done around center\r\n                        const centerObj = {\r\n                            x: this.renderWidth / 2,\r\n                            y: this.renderHeight / 2,\r\n                        };\r\n\r\n                        const startAngleRad = BB.Vec2.angle(centerObj, {x: event.downPageX - offsetX, y: event.downPageY - offsetY});\r\n                        const angleRad = BB.Vec2.angle(centerObj, {x: event.pageX - offsetX, y: event.pageY - offsetY});\r\n                        let dAngleRad = angleRad - startAngleRad;\r\n\r\n                        //apply angle\r\n                        this.targetTransformObj = BB.copyObj(this.oldTransformObj);\r\n                        this.targetTransformObj.angle += dAngleRad;\r\n\r\n                        if (this.keyListener.isPressed('shift')) {\r\n                            this.targetTransformObj.angle = Math.round(this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\r\n                            dAngleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n                        }\r\n\r\n                        this.targetTransformObj.angle = this.minimizeAngleRad(this.targetTransformObj.angle);\r\n\r\n                        //rotate transform.xy\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(dAngleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n\r\n                        this.transformIsDirty = true;\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['angle'],\r\n                            scale: this.targetTransformObj.scale,\r\n                            angle: this.targetTransformObj.angle,\r\n                        });\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    const comboStr = this.keyListener.getComboStr();\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n            },\r\n        };\r\n        this.currentInputProcessor = null;\r\n\r\n\r\n        this.angleIsExtraSticky = false;\r\n        this.pinchZoomer = new BB.PinchZoomer({\r\n            onPinch: (event) => {\r\n\r\n                if (event.type === 'move') {\r\n\r\n                    if (!this.oldTransformObj) {\r\n                        this.oldTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.angleIsExtraSticky = this.targetTransformObj.angle % (Math.PI / 2) === 0;\r\n                    }\r\n\r\n                    this.targetTransformObj = BB.copyObj(this.oldTransformObj);\r\n\r\n                    event.scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, this.targetTransformObj.scale * event.scale)) / this.targetTransformObj.scale;\r\n\r\n                    this.targetTransformObj.scale *= event.scale;\r\n                    this.targetTransformObj.angle += event.angleRad;\r\n                    this.targetTransformObj.angle = this.minimizeAngleRad(\r\n                        this.snapAngleRad(\r\n                            this.targetTransformObj.angle,\r\n                            90,\r\n                            this.angleIsExtraSticky ? 12 : 4\r\n                        )\r\n                    );\r\n                    if (this.targetTransformObj.angle % (Math.PI / 2) !== 0) {\r\n                        this.angleIsExtraSticky = false;\r\n                    }\r\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\r\n                    event.angleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n\r\n                    //calc translation\r\n                    {\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX, event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(event.scale));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(event.angleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-event.relX, -event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\r\n\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                    }\r\n\r\n                    this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n\r\n                    //if (event.scale !== 1) {\r\n                    this.onViewChange({\r\n                        changed: ['scale', 'angle'],\r\n                        scale: this.targetTransformObj.scale,\r\n                        angle: this.targetTransformObj.angle,\r\n                    });\r\n                    //}\r\n                    this.reqFrame();\r\n                    this.transformIsDirty = true;\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                } else if (event.type === 'end') {\r\n                    this.oldTransformObj = null;\r\n                }\r\n\r\n\r\n            },\r\n        });\r\n\r\n        const onDoubleTap = (event) => {\r\n            if (_this.fitView()) {\r\n                this.lastRenderedState = -1;\r\n                this.reqFrame();\r\n            } else {\r\n                // zoom 2 steps further\r\n\r\n                const didZoom = this.internalZoomByStep(\r\n                    2,\r\n                    event.relX,\r\n                    event.relY,\r\n                );\r\n                if (didZoom) {\r\n                    this.onViewChange({\r\n                        changed: ['scale'],\r\n                        angle: this.targetTransformObj.angle,\r\n                        scale: this.targetTransformObj.scale,\r\n                    });\r\n                }\r\n\r\n                //updateCursor(TMode.Draw, true);\r\n                this.lastRenderedState = -1;\r\n            }\r\n        };\r\n\r\n        this.mainDoubleTapper = new BB.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper = new BB.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper.setAllowedButtonArr(['middle']);\r\n\r\n\r\n        this.twoFingerTap = new BB.NFingerTapper({\r\n            fingers: 2,\r\n            onTap: () => {\r\n                p.onUndo();\r\n            },\r\n        });\r\n        this.threeFingerTap = new BB.NFingerTapper({\r\n            fingers: 3,\r\n            onTap: () => {\r\n                p.onRedo();\r\n            },\r\n        });\r\n\r\n\r\n        this.pointerEventChain = new BB.EventChain({\r\n            chainArr: [\r\n                this.twoFingerTap,\r\n                this.threeFingerTap,\r\n                this.mainDoubleTapper,\r\n                this.middleDoubleTapper,\r\n                this.pinchZoomer,\r\n                new BB.OnePointerLimiter(),\r\n                new BB.CoalescedExploder(),\r\n            ],\r\n        });\r\n        this.pointerEventChain.setChainOut((event: IPointerEvent) => {\r\n\r\n            this.cursorPos.x = event.relX;\r\n            this.cursorPos.y = event.relY;\r\n            if (event.type === 'pointerup' && event.pointerType === 'touch') {\r\n                this.pointer = null;\r\n                this.lastRenderedState = -1;\r\n                this.reqFrame();\r\n            } else {\r\n                if (!this.pointer) {\r\n                    this.pointer = { x: 0, y: 0 };\r\n                }\r\n                this.pointer.x = event.relX;\r\n                this.pointer.y = event.relY;\r\n            }\r\n\r\n            if (this.currentInputProcessor) {\r\n                this.currentInputProcessor.onPointer(event);\r\n\r\n            } else {\r\n\r\n                const comboStr = this.keyListener.getComboStr();\r\n\r\n                if (this.globalMode === TMode.Draw) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.draw;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Draw);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Hand) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'middle'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Pick) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'right'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Fill) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.fill;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Fill);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Gradient) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.gradient;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Gradient);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Text) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.text;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Text);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Shape) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.shape;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Shape);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n        });\r\n\r\n        //prevent ctrl scroll -> zooming page\r\n        this.rootEl.addEventListener('wheel', (event) => {\r\n            event.preventDefault();\r\n        });\r\n\r\n\r\n        setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.rootEl,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    if (e.type === 'pointerdown' && e.button === 'middle') {\r\n                        try {\r\n                            e.eventPreventDefault();\r\n                        } catch (e) {}\r\n                    }\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    if (e.type === 'pointerdown') {\r\n                        BB.unfocusAnyInput();\r\n                    }\r\n                    /*if (e.type === 'pointermove') {\r\n                        BB.throwOut(JSON.stringify(e));\r\n                    }*/\r\n\r\n                    this.pointerEventChain.chainIn(e);\r\n                },\r\n                onWheel: (wheelEvent) => {\r\n\r\n                    if (this.isDrawing) {\r\n                        return;\r\n                    }\r\n\r\n                    this.reqFrame();\r\n                    const didZoom = this.internalZoomByStep(\r\n                        -wheelEvent.deltaY / (this.keyListener.isPressed('shift') ? 8 : 2),\r\n                        wheelEvent.relX,\r\n                        wheelEvent.relY\r\n                    );\r\n                    if (didZoom) {\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale,\r\n                        });\r\n                    }\r\n\r\n                    //updateCursor(TMode.Draw, true);\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                },\r\n                onEnterLeave: (isOver) => {\r\n                    if (!isOver) {\r\n                        if (!this.isDrawing) {\r\n                            this.pointer = null;\r\n                            this.lastRenderedState = -1;\r\n                        }\r\n                    }\r\n                },\r\n                maxPointers: 4,\r\n            });\r\n        }, 1);\r\n\r\n        this.brushRadius = 1;\r\n\r\n        this.animationFrameRequested = false;\r\n\r\n\r\n\r\n\r\n        //setup rendering\r\n        this.lastRenderedState = -2;\r\n        this.lastRenderTime = performance.now();\r\n\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n\r\n        this.resetView();\r\n    }\r\n\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setCanvas (klC: KlCanvas): void {\r\n        this.klCanvas = klC;\r\n        this.lastDrawEvent = null;\r\n        this.resetView();\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    /**\r\n     * set size of workspace area in pixels\r\n     * @param width\r\n     * @param height\r\n     */\r\n    setSize (width: number, height: number): void {\r\n        const oldWidth = this.renderWidth;\r\n        const oldHeight = this.renderHeight;\r\n\r\n        if (width === oldWidth && height === oldHeight) {\r\n            return;\r\n        }\r\n\r\n        this.doResizeCanvas = true;\r\n        this.renderWidth = width;\r\n        this.renderHeight = height;\r\n\r\n        this.svgOverlay.setSize(width, height);\r\n\r\n        this.targetTransformObj.x += (width - oldWidth) / 2;\r\n        this.targetTransformObj.y += (height - oldHeight) / 2;\r\n\r\n        this.highResTransformObj.x = this.targetTransformObj.x;\r\n        this.highResTransformObj.y = this.targetTransformObj.y;\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setMode (modeStr: TModeStr): void {\r\n        //only sets the base mode\r\n        if (modeStr === 'draw') {\r\n            this.globalMode = TMode.Draw;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'fill') {\r\n            this.globalMode = TMode.Fill;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'gradient') {\r\n            this.globalMode = TMode.Gradient;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'text') {\r\n            this.globalMode = TMode.Text;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'shape') {\r\n            this.globalMode = TMode.Shape;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'hand') {\r\n            this.globalMode = TMode.Hand;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n        }\r\n        if (modeStr === 'pick') {\r\n            this.globalMode = TMode.Pick;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n    }\r\n\r\n    getMode (): TModeStr {\r\n        if (this.globalMode === TMode.Draw) {\r\n            return 'draw';\r\n        }\r\n        if (this.globalMode === TMode.Fill) {\r\n            return 'fill';\r\n        }\r\n        if (this.globalMode === TMode.Gradient) {\r\n            return 'gradient';\r\n        }\r\n        if (this.globalMode === TMode.Text) {\r\n            return 'text';\r\n        }\r\n        if (this.globalMode === TMode.Shape) {\r\n            return 'shape';\r\n        }\r\n        if (this.globalMode === TMode.Hand) {\r\n            return 'hand';\r\n        }\r\n        if (this.globalMode === TMode.Pick) {\r\n            return 'pick';\r\n        }\r\n    }\r\n\r\n    setEnabled (b: boolean): void {\r\n        // todo\r\n    }\r\n\r\n    setCursorSize (diameter: number): void {\r\n        this.brushRadius = diameter / 2;\r\n\r\n        this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n\r\n        if (this.pointer === null) {\r\n            this.hideBrushCursorTimeout && clearTimeout(this.hideBrushCursorTimeout);\r\n\r\n            this.svgOverlay.updateCursor({\r\n                x: this.renderWidth / 2,\r\n                y: this.renderHeight / 2,\r\n                isVisible: true,\r\n            });\r\n\r\n            this.hideBrushCursorTimeout = setTimeout(() => {\r\n                if (this.pointer !== null) {\r\n                    return;\r\n                }\r\n                this.svgOverlay.updateCursor({isVisible: false});\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n    zoomByStep (stepNum: number): void {\r\n        if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) {\r\n            return;\r\n        }\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale'],\r\n            angle: this.targetTransformObj.angle,\r\n            scale: this.targetTransformObj.scale,\r\n        });\r\n    }\r\n\r\n    resetView (doAnimate?: boolean): void {\r\n        this.targetTransformObj.scale = 1;\r\n        this.targetTransformObj.angle = 0;\r\n\r\n        this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\r\n        this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\r\n\r\n        if (!doAnimate) {\r\n            this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n        } else {\r\n            this.doAnimateTranslate = true;\r\n            this.transformIsDirty = true;\r\n        }\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n        this.reqFrame();\r\n\r\n        if (doAnimate) {\r\n            this.onViewChange({\r\n                changed: ['scale', 'angle'],\r\n                scale: this.targetTransformObj.scale,\r\n                angle: this.targetTransformObj.angle,\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * fit into view. center. snap angle. padding\r\n     * returns true if transform changes\r\n     */\r\n    fitView (): boolean {\r\n        // determine new transform\r\n        const newAngle = this.snapAngleRad(this.targetTransformObj.angle, 90, 90);\r\n\r\n        //calc width and height of bounds\r\n        const canvasPointsArr = [\r\n            [0, 0], // top left\r\n            [this.klCanvas.getWidth(), 0], // top right\r\n            [this.klCanvas.getWidth(), this.klCanvas.getHeight()], // bottom right\r\n            [0, this.klCanvas.getHeight()], // bottom left\r\n            [this.klCanvas.getWidth() / 2, this.klCanvas.getHeight() / 2], // center\r\n        ];\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(newAngle));\r\n\r\n        //rotate points\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            let coords = [canvasPointsArr[i][0], canvasPointsArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n            canvasPointsArr[i][0] = coords[0];\r\n            canvasPointsArr[i][1] = coords[1];\r\n        }\r\n\r\n        const boundsObj = {\r\n            x0: null,\r\n            y0: null,\r\n            x1: null,\r\n            y1: null,\r\n        };\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            if (boundsObj.x0 === null || canvasPointsArr[i][0] < boundsObj.x0) {\r\n                boundsObj.x0 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y0 === null || canvasPointsArr[i][1] < boundsObj.y0) {\r\n                boundsObj.y0 = canvasPointsArr[i][1];\r\n            }\r\n            if (boundsObj.x1 === null || canvasPointsArr[i][0] > boundsObj.x1) {\r\n                boundsObj.x1 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y1 === null || canvasPointsArr[i][1] > boundsObj.y1) {\r\n                boundsObj.y1 = canvasPointsArr[i][1];\r\n            }\r\n        }\r\n        const boundsWidth = boundsObj.x1 - boundsObj.x0;\r\n        const boundsHeight = boundsObj.y1 - boundsObj.y0;\r\n\r\n        //fit bounds\r\n        const padding = 0;\r\n        const { width: fitWidth } = BB.fitInto(\r\n            boundsWidth,\r\n            boundsHeight, \r\n            this.renderWidth - padding, \r\n            this.renderHeight - padding, \r\n            1\r\n        );\r\n\r\n        //determine scale\r\n        const factor = fitWidth / boundsWidth;\r\n\r\n        const newTargetTransformObj = {\r\n            angle: newAngle,\r\n            x: (this.renderWidth / 2) - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor,\r\n            y: (this.renderHeight / 2) - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor,\r\n            scale: factor,\r\n        };\r\n\r\n        if (\r\n            newTargetTransformObj.angle === this.targetTransformObj.angle &&\r\n            Math.abs(newTargetTransformObj.x - this.targetTransformObj.x) < 0.0000000001 &&\r\n            Math.abs(newTargetTransformObj.y - this.targetTransformObj.y) < 0.0000000001 &&\r\n            newTargetTransformObj.scale === this.targetTransformObj.scale\r\n        ) {\r\n            return false;\r\n        }\r\n        this.targetTransformObj = newTargetTransformObj;\r\n\r\n        this.doAnimateTranslate = true;\r\n        this.transformIsDirty = true;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale', 'angle'],\r\n            scale: this.targetTransformObj.scale,\r\n            angle: this.targetTransformObj.angle,\r\n        });\r\n        return true;\r\n    }\r\n\r\n    setAngle (angleDeg: number, isRelative?: boolean): void {\r\n        //rotation done around center\r\n        const centerObj = {\r\n            x: this.renderWidth / 2,\r\n            y: this.renderHeight / 2,\r\n        };\r\n\r\n        const oldAngleRad = this.targetTransformObj.angle;\r\n        const angleRad = angleDeg / 180 * Math.PI;\r\n\r\n        if (isRelative) {\r\n            this.targetTransformObj.angle += angleRad;\r\n        } else {\r\n            this.targetTransformObj.angle = angleRad;\r\n        }\r\n\r\n        this.targetTransformObj.angle = this.minimizeAngleRad(\r\n            this.snapAngleRad(\r\n                this.targetTransformObj.angle,\r\n                90,\r\n                4\r\n            )\r\n        );\r\n\r\n        //rotate transform.xy\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n        this.transformIsDirty = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    /**\r\n     * translate canvas by viewport pixels\r\n     * @param tx\r\n     * @param ty\r\n     */\r\n    translateView (tx: number, ty: number): void {\r\n        const scale = 40;\r\n\r\n        this.targetTransformObj.x += tx * scale;\r\n        this.targetTransformObj.y += ty * scale;\r\n\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    getScale (): number {\r\n        return this.targetTransformObj.scale;\r\n    }\r\n\r\n    getAngleDeg (): number {\r\n        return this.targetTransformObj.angle * 180 / Math.PI;\r\n    }\r\n\r\n    getMaxScale (): number {\r\n        return MAX_SCALE;\r\n    }\r\n\r\n    getMinScale (): number {\r\n        return MIN_SCALE;\r\n    }\r\n\r\n    requestFrame (): void {\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setLastDrawEvent (x: number | null, y?: number, pressure?: number): void {\r\n        if (x === null) {\r\n            this.lastDrawEvent = null;\r\n            return;\r\n        }\r\n\r\n        if (!this.lastDrawEvent) {\r\n            this.lastDrawEvent = {x: 0, y: 0, pressure: 0};\r\n        }\r\n        this.lastDrawEvent.x = x;\r\n        this.lastDrawEvent.y = y;\r\n        this.lastDrawEvent.pressure = pressure;\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ayl5b\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"8Sx0P\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ixtEz\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3iHbP\");","import {IDrawDownEvent, IDrawMoveEvent, IDrawUpEvent, TDrawEvent} from '../kl-types';\r\nimport {BB} from '../../bb/bb';\r\n\r\nconst DIR_X = 0;\r\nconst DIR_Y = 1;\r\n\r\n/**\r\n * Not really and event chain element. but pretty similar.\r\n *\r\n * Processes draw input events. When shift held -> linetool\r\n * line events - what KlCanvasWorkspace passes onDraw(e)\r\n *\r\n * pass input in with process(drawEvent)\r\n *\r\n * modifies draw event to include such events:\r\n * {\r\n *     type: 'line',\r\n *     x0: null, // you have to fill that in\r\n *     y0: null, // you have to fill that in\r\n *     pressure0: null, // you have to fill that in\r\n *     x1: number,\r\n *     y1: number,\r\n *     pressure1: number\r\n * }\r\n */\r\nexport class LinetoolProcessor {\r\n\r\n    private readonly onDraw: (drawEvent: TDrawEvent) => void;\r\n    private downEvent: IDrawDownEvent | null = null;\r\n    private eventQueue: (IDrawDownEvent | IDrawMoveEvent | IDrawUpEvent)[] = [];\r\n    private direction: 0 | 1 | null = null;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p : {\r\n            onDraw: (drawEvent: TDrawEvent) => void;\r\n        }\r\n    ) {\r\n        this.onDraw = p.onDraw;\r\n    }\r\n\r\n    process (event: IDrawDownEvent | IDrawMoveEvent | IDrawUpEvent): void {\r\n        if (event.type === 'down') {\r\n            this.downEvent = event;\r\n            this.direction = null;\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                this.onDraw({\r\n                    type: 'line',\r\n                    x0: null,\r\n                    y0: null,\r\n                    pressure0: null,\r\n                    x1: event.x,\r\n                    y1: event.y,\r\n                    pressure1: event.pressure,\r\n                });\r\n\r\n                this.eventQueue.push(event);\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'move' && this.downEvent) {\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                if (this.direction === null) {\r\n                    const dX = Math.abs(event.x - this.downEvent.x);\r\n                    const dY = Math.abs(event.y - this.downEvent.y);\r\n\r\n                    if (dX > 5 || dY > 5) {\r\n                        this.direction = dX > dY ? DIR_X : DIR_Y;\r\n\r\n                        for (let i = 0; i < this.eventQueue.length; i++) {\r\n                            const e = this.eventQueue[i];\r\n                            if (e.type !== 'up') {\r\n                                if (this.direction === DIR_X) {\r\n                                    e.y = this.downEvent.y;\r\n                                } else {\r\n                                    e.x = this.downEvent.x;\r\n                                }\r\n                            }\r\n                            this.onDraw(BB.copyObj(e));\r\n                        }\r\n                        this.eventQueue = [];\r\n                    }\r\n                }\r\n\r\n                if (this.direction === null) {\r\n                    this.eventQueue.push(event);\r\n                    return;\r\n                }\r\n\r\n                if (this.direction === DIR_X) {\r\n                    event.y = this.downEvent.y;\r\n                } else {\r\n                    event.x = this.downEvent.x;\r\n                }\r\n\r\n            } else {\r\n                if (this.eventQueue.length > 0) {\r\n                    for (let i = 0; i < this.eventQueue.length; i++) {\r\n                        this.onDraw(BB.copyObj(this.eventQueue[i]));\r\n                    }\r\n                    this.eventQueue = [];\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'up') {\r\n            this.eventQueue = [];\r\n            this.downEvent = null;\r\n        }\r\n\r\n        this.onDraw(BB.copyObj(event));\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IKlBasicLayer} from '../kl-types';\r\nimport {theme} from '../../theme/theme';\r\n\r\n/**\r\n * preview of image with layers. can do mix modes and opacity.\r\n * creates a canvas.\r\n */\r\nexport class KlCanvasPreview {\r\n\r\n    private readonly canvas: HTMLCanvasElement;\r\n    private readonly ctx: CanvasRenderingContext2D | null;\r\n    private readonly layers: IKlBasicLayer[];\r\n    private readonly updateCheckerboard: () => void;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n            layers: IKlBasicLayer[]; // items can be changed after the fact - but not the object\r\n        }\r\n    ) {\r\n        this.layers = p.layers;\r\n\r\n        const scale = p.width / p.layers[0].image.width;\r\n        const width = scale > 1 ? p.layers[0].image.width : p.width;\r\n        const height = scale > 1 ? p.layers[0].image.height : p.height;\r\n\r\n        this.canvas = BB.canvas(width, height);\r\n        this.updateCheckerboard = () => {\r\n            this.canvas.style.backgroundImage = 'url(' + BB.createCheckerDataUrl(8, undefined, theme.isDark()) + ')';\r\n        };\r\n        this.updateCheckerboard();\r\n        this.ctx = BB.ctx(this.canvas);\r\n\r\n        BB.css(this.canvas, {\r\n            width: '100%',\r\n            height: '100%',\r\n            imageRendering: scale > 1 ? 'pixelated' : undefined,\r\n        });\r\n\r\n        setTimeout(() => this.render(), 0);\r\n        theme.addIsDarkListener(this.updateCheckerboard);\r\n    }\r\n\r\n    getElement (): HTMLCanvasElement {\r\n        return this.canvas;\r\n    }\r\n\r\n    render (): void {\r\n        if (!this.ctx) {\r\n            return;\r\n        }\r\n\r\n        this.ctx.save();\r\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        for (let i = 0; i < this.layers.length; i++) {\r\n            this.ctx.globalAlpha = this.layers[i].opacity;\r\n            this.ctx.globalCompositeOperation = this.layers[i].mixModeStr as GlobalCompositeOperation;\r\n            if (this.canvas.width > this.layers[i].image.width) {\r\n                this.ctx.imageSmoothingEnabled = false;\r\n            }\r\n            this.ctx.drawImage(this.layers[i].image, 0, 0, this.canvas.width, this.canvas.height);\r\n        }\r\n        this.ctx.restore();\r\n    }\r\n\r\n    destroy (): void {\r\n        theme.removeIsDarkListener(this.updateCheckerboard);\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport rotateImg from '/src/app/img/ui/cursor-rotate.png';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {\r\n    copyTransform,\r\n    IFreeTransform,\r\n    snapToPixel,\r\n    TFreeTransformCorner,\r\n    TFreeTransformEdge,\r\n    toImageSpace,\r\n    toTransformSpace,\r\n} from './free-transform-utils';\r\n\r\n/**\r\n * Free Transform UI\r\n * rotate, scale, translate\r\n *\r\n * - if rotation is multiple of 90 it will snap to pixels, to be more useful for pixel art\r\n * - when rotation goes from non-multiple of 90 to a multiple, it will snap position and width height to pixels\r\n * - transform.x, transform.y can sit between pixels (by 0.5) if width or height is odd number.\r\n *      - this is what complicates things\r\n * - if transform region small, corner grips move out of the way\r\n *\r\n * iX iY, iP.x, iP.y - i indicates image space\r\n * tX tY, tP.x, tP.y - t indicates transform space\r\n *\r\n * Not sure if it can be used for navigable canvas. (especially if canvas rotates view)\r\n * Probably can't be extended for distort. Needs a different approach.\r\n *\r\n * --- DOM structure ---\r\n * rootEl {\r\n * \ttransEl [\r\n * \t\tboundsEl\r\n * \t\tedges[]\r\n * \t\tcorners[] - round grips in the corner of transform region\r\n * \t\tangleGrip\r\n * \t]\r\n * }\r\n *\r\n */\r\nexport class FreeTransform {\r\n\r\n    // --- private ---\r\n    private readonly transform: IFreeTransform; // coordinates and dimensions of transformation\r\n    private isConstrained: boolean;\r\n    private ratio: number; // aspect ratio of transform\r\n    private readonly scale: number;\r\n    private readonly scaled = { // scaled coordinates and dimensions for screenspace\r\n        x: 0,\r\n        y: 0,\r\n        width: 0,\r\n        height: 0,\r\n        corners: [{x: 0, y: 0}], // in transform space\r\n    };\r\n    private readonly minSnapDist = 7; // minimal snapping distance in px screenspace\r\n    private snappingEnabled: boolean;\r\n    private readonly snapX: number[];\r\n    private readonly snapY: number[];\r\n    private readonly callback: (transform: IFreeTransform) => void;\r\n\r\n\r\n    private readonly cornerCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n    private readonly gripSize = 14;\r\n    private readonly edgeSize = 10;\r\n\r\n    private readonly rootEl: HTMLElement; // sits at origin of image\r\n    private readonly transEl: HTMLElement; // at middle of transform. rotates\r\n    private readonly boundsEl: HTMLElement; // draggable bounds rectangle with outline\r\n    private readonly corners: TFreeTransformCorner[] = [];\r\n    private keyListener: KeyListener;\r\n    private boundsPointerListener: PointerListener; // BB.PointerListener\r\n    private anglePointerListener: PointerListener; // BB.PointerListener\r\n    private readonly edges: TFreeTransformEdge[] = [];\r\n    private readonly angleGrip: {\r\n        el: HTMLElement;\r\n        x: number; // transform space\r\n        y: number;\r\n        snap: boolean;\r\n        updateDOM: () => void;\r\n    };\r\n\r\n    private updateScaled (): void {\r\n        this.scaled.x = this.transform.x * this.scale;\r\n        this.scaled.y = this.transform.y * this.scale;\r\n        this.scaled.width = this.transform.width * this.scale;\r\n        this.scaled.height = this.transform.height * this.scale;\r\n        this.scaled.corners = this.corners.map((item) => {\r\n            return {x: item.x * this.scale, y: item.y * this.scale};\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\r\n     * both in image space\r\n     *\r\n     * @param iX - image space\r\n     * @param iY - image space\r\n     * @private\r\n     */\r\n    private snapCorner (iX: number, iY: number): IVector2D {\r\n        if (!this.snappingEnabled) {\r\n            return {x: iX, y: iY};\r\n        }\r\n        let dist: number;\r\n        const snap: {\r\n            x?: number;\r\n            y?: number;\r\n            dist: {\r\n                x?: number;\r\n                y?: number;\r\n            };\r\n        } = {\r\n            x: undefined,\r\n            y: undefined,\r\n            dist: {\r\n                x: undefined,\r\n                y: undefined,\r\n            },\r\n        };\r\n        for (let e = 0; e < this.snapX.length; e++) {\r\n            dist = Math.abs(iX - this.snapX[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.x === undefined || dist < snap.dist.x) {\r\n                    snap.x = this.snapX[e];\r\n                    snap.dist.x = dist;\r\n                }\r\n            }\r\n        }\r\n        for (let e = 0; e < this.snapY.length; e++) {\r\n            dist = Math.abs(iY - this.snapY[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.y === undefined || dist < snap.dist.y) {\r\n                    snap.y = this.snapY[e];\r\n                    snap.dist.y = dist;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (snap.x === undefined && snap.y === undefined) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        return {\r\n            x: snap.x ?? iX,\r\n            y: snap.y ?? iY,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * If constrained return nearest corner pos that fits aspect ratio\r\n     *\r\n     * @param cornerIndex\r\n     * @param iX\r\n     * @param iY\r\n     * @private\r\n     */\r\n    private constrainCorner (cornerIndex: number, iX: number, iY: number): IVector2D {\r\n        if (!this.isConstrained) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        const flip = this.transform.width * this.transform.height < 0 ? -1 : 1;\r\n        return BB.projectPointOnLine(\r\n            {x: this.transform.x, y: this.transform.y},\r\n            toImageSpace(this.ratio, flip * ([0, 2].includes(cornerIndex) ? 1 : -1), this.transform),\r\n            {x: iX, y: iY}\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Update corners according to width height.\r\n     * Not their DOM.\r\n     */\r\n    private updateCornerPositions (): void {\r\n        this.corners[0].x = (-this.transform.width / 2); // top left\r\n        this.corners[0].y = (-this.transform.height / 2);\r\n\r\n        this.corners[1].x = (this.transform.width / 2); // top right\r\n        this.corners[1].y = (-this.transform.height / 2);\r\n\r\n        this.corners[2].x = (this.transform.width / 2); // bottom right\r\n        this.corners[2].y = (this.transform.height / 2);\r\n\r\n        this.corners[3].x = (-this.transform.width / 2); // bottom left\r\n        this.corners[3].y = (this.transform.height / 2);\r\n    }\r\n\r\n    /**\r\n     * If constrained and dragging an edge, restore aspect ratio\r\n     * Updates corner positions.\r\n     *\r\n     * @param widthChanged\r\n     * @param heightChanged\r\n     * @private\r\n     */\r\n    private restoreRatio (widthChanged: boolean, heightChanged: boolean): void {\r\n        if (!this.isConstrained) {\r\n            return;\r\n        }\r\n        const angle90 = Math.abs(this.transform.angleDeg) % 90 === 0;\r\n        const whSwapped = Math.abs(this.transform.angleDeg - 90) % 180 === 0;\r\n        if (heightChanged && !widthChanged) {\r\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\r\n            let newWidth = this.ratio * newHeight;\r\n            if (angle90) {\r\n                newWidth = (whSwapped ? this.transform.y % 1 : this.transform.x % 1) === 0 ?\r\n                    BB.roundEven(newWidth) : BB.roundUneven(newWidth);\r\n            }\r\n            if (this.corners[1].x - this.corners[0].x < 0) {\r\n                newWidth *= -1;\r\n            }\r\n            this.corners[0].x = -newWidth / 2;\r\n            this.corners[3].x = -newWidth / 2;\r\n            this.corners[1].x = newWidth / 2;\r\n            this.corners[2].x = newWidth / 2;\r\n        }\r\n        if (!heightChanged && widthChanged) {\r\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\r\n            let newHeight = newWidth / this.ratio;\r\n            if (angle90) {\r\n                newHeight = (whSwapped ? this.transform.x % 1 : this.transform.y % 1) === 0  ?\r\n                    BB.roundEven(newHeight) : BB.roundUneven(newHeight);\r\n            }\r\n            if (this.corners[3].y - this.corners[0].y < 0) {\r\n                newHeight *= -1;\r\n            }\r\n            this.corners[0].y = -newHeight / 2;\r\n            this.corners[1].y = -newHeight / 2;\r\n            this.corners[2].y = newHeight / 2;\r\n            this.corners[3].y = newHeight / 2;\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * update transform based on corners\r\n     * @private\r\n     */\r\n    private updateTransformViaCorners (): void {\r\n\r\n        // calc transform center in image space\r\n        const rot = BB.rotateAround(\r\n            {x: 0, y: 0},\r\n            {\r\n                x: (this.corners[0].x + this.corners[1].x) / 2,\r\n                y: (this.corners[0].y + this.corners[3].y) / 2,\r\n            },\r\n            this.transform.angleDeg\r\n        );\r\n        this.transform.x = rot.x + this.transform.x;\r\n        this.transform.y = rot.y + this.transform.y;\r\n\r\n        // update size\r\n        this.transform.width = this.corners[1].x - this.corners[0].x;\r\n        this.transform.height = this.corners[3].y - this.corners[0].y;\r\n\r\n        // new center means corners changed their position\r\n        this.updateCornerPositions();\r\n\r\n        this.updateDOM();\r\n    }\r\n\r\n    /**\r\n     * updates DOM according to transform\r\n     * @param skipCallback\r\n     */\r\n    private updateDOM (skipCallback?: boolean): void {\r\n        this.updateScaled();\r\n\r\n        BB.css(this.transEl, {\r\n            left: this.scaled.x + 'px',\r\n            top: this.scaled.y + 'px',\r\n            transformOrigin: '0 0',\r\n            transform: 'rotate(' + this.transform.angleDeg + 'deg)',\r\n        });\r\n\r\n        BB.css(this.boundsEl, {\r\n            width: Math.abs(this.scaled.width) + 'px',\r\n            height: Math.abs(this.scaled.height) + 'px',\r\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\r\n        });\r\n\r\n        this.corners[0].updateDOM();\r\n        this.corners[1].updateDOM();\r\n        this.corners[2].updateDOM();\r\n        this.corners[3].updateDOM();\r\n\r\n        this.edges[0].updateDOM();\r\n        this.edges[1].updateDOM();\r\n        this.edges[2].updateDOM();\r\n        this.edges[3].updateDOM();\r\n\r\n\r\n        this.angleGrip.x = 0;\r\n        this.angleGrip.y = (-Math.abs(this.transform.height * this.scale) / 2) - 20;\r\n        this.angleGrip.updateDOM();\r\n        if (!skipCallback) {\r\n            if (this.callback) { // why should updateDOM trigger the callback?\r\n                this.callback(copyTransform(this.transform));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // --- public ---\r\n    constructor (\r\n        params: {\r\n            x: number; // center of transform region. image space\r\n            y: number;\r\n            width: number; // size of transform region. image space\r\n            height: number;\r\n            angleDeg: number; // angle of transform region. degrees\r\n\r\n            isConstrained: boolean; // proportions constrained\r\n            snapX: number[]; // where snapping along X axis. image space\r\n            snapY: number[]; // where snapping along X axis. image space\r\n            scale: number; // ratio of screen-space / image-space\r\n            callback: (transform: IFreeTransform) => void;\r\n        }\r\n    ) {\r\n        this.transform = { // coordinates and dimensions of transformation\r\n            x: params.x,\r\n            y: params.y,\r\n            width: params.width,\r\n            height: params.height,\r\n            angleDeg: params.angleDeg,\r\n        };\r\n\r\n        this.isConstrained = params.isConstrained;\r\n\r\n        this.snapX = params.snapX;\r\n        this.snapY = params.snapY;\r\n        this.callback = params.callback;\r\n        this.scale = params.scale;\r\n        this.snappingEnabled = true;\r\n        this.ratio = this.transform.width / this.transform.height;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-free-transform',\r\n            css: {\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.transEl = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                position: 'absolute',\r\n            },\r\n        });\r\n\r\n        this.boundsEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                cursor: 'move',\r\n                boxShadow: 'rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px',\r\n            },\r\n        });\r\n\r\n        const pointerRemainder = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        function resetRemainder (): void {\r\n            pointerRemainder.x = 0;\r\n            pointerRemainder.y = 0;\r\n        }\r\n        this.keyListener = new BB.KeyListener({});\r\n\r\n        let boundsStartP = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        this.boundsPointerListener = new BB.PointerListener({\r\n            target: this.boundsEl,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointerdown') {\r\n                    boundsStartP = {x: this.transform.x, y: this.transform.y};\r\n                }\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    this.transform.x = boundsStartP.x + (event.pageX - event.downPageX) / this.scale;\r\n                    this.transform.y = boundsStartP.y + (event.pageY - event.downPageY) / this.scale;\r\n\r\n\r\n                    let dist: number;\r\n                    let snap: {\r\n                        x?: number;\r\n                        y?: number;\r\n                        distX?: number;\r\n                        distY?: number;\r\n                    } = {};\r\n                    if (this.snappingEnabled) {\r\n                        let i;\r\n                        for (i = 0; i < this.snapX.length; i++) {\r\n                            dist = Math.abs(this.transform.x - this.snapX[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.x || dist < snap.distX) {\r\n                                    snap.x = this.snapX[i];\r\n                                    snap.distX = dist;\r\n                                }\r\n                            }\r\n                        }\r\n                        for (i = 0; i < this.snapY.length; i++) {\r\n                            dist = Math.abs(this.transform.y - this.snapY[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.y || dist < snap.distY) {\r\n                                    snap.y = this.snapY[i];\r\n                                    snap.distY = dist;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        let iP;\r\n                        for (i = 0; i < 4; i++) {\r\n                            iP = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n                            let j;\r\n                            for (j = 0; j < this.snapX.length; j++) {\r\n                                dist = Math.abs(iP.x - this.snapX[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.x || dist < snap.distX) {\r\n                                        snap.x = this.snapX[j] - (iP.x - this.transform.x);\r\n                                        snap.distX = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                            for (j = 0; j < this.snapY.length; j++) {\r\n                                dist = Math.abs(iP.y - this.snapY[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.y || dist < snap.distY) {\r\n                                        snap.y = this.snapY[j] - (iP.y - this.transform.y);\r\n                                        snap.distY = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        let projected = BB.projectPointOnLine(\r\n                            {x: 0, y: boundsStartP.y},\r\n                            {x: 10, y: boundsStartP.y},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        let dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        snap = {\r\n                            x: projected.x,\r\n                            y: projected.y,\r\n                            distX: dist,\r\n                            distY: dist,\r\n                        };\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: 0},\r\n                            {x: boundsStartP.x, y: 10},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap = {\r\n                                x: projected.x,\r\n                                y: projected.y,\r\n                                distX: dist,\r\n                                distY: dist,\r\n                            };\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y + 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap = {\r\n                                x: projected.x,\r\n                                y: projected.y,\r\n                                distX: dist,\r\n                                distY: dist,\r\n                            };\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y - 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap = {\r\n                                x: projected.x,\r\n                                y: projected.y,\r\n                                distX: dist,\r\n                                distY: dist,\r\n                            };\r\n                        }\r\n                    }\r\n                    if (snap.x != undefined) {\r\n                        this.transform.x = snap.x;\r\n                    }\r\n                    if (snap.y != undefined) {\r\n                        this.transform.y = snap.y;\r\n                    }\r\n\r\n                    // snap to pixels\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                    }\r\n\r\n                    this.updateDOM();\r\n                }\r\n            },\r\n        });\r\n\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                const g = this.corners[i] = {\r\n                    i: i,\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.gripSize + 'px',\r\n                            height: this.gripSize + 'px',\r\n                            background: '#fff',\r\n                            /*background: [\r\n                                '#ff0000',\r\n                                '#00ff00',\r\n                                '#0000ff',\r\n                                '#ff00ff',\r\n                            ][i],*/\r\n                            borderRadius: this.gripSize + 'px',\r\n                            position: 'absolute',\r\n                            boxShadow: 'inset 0 0 0 2px #000',\r\n                        },\r\n                    }),\r\n                    x: 0,\r\n                    y: 0,\r\n                    virtualPos: {\r\n                        x: 0,\r\n                        y: 0,\r\n                    },\r\n                } as TFreeTransformCorner;\r\n                g.updateDOM = (): void => {\r\n\r\n                    // grip position\r\n                    // if gets small, offset grips, so easier to handle\r\n                    const offsetArr = [[-1, -1], [1, -1], [1, 1], [-1, 1]].map(item => {\r\n                        item[0] *= this.transform.width > 0 ? 1 : -1;\r\n                        item[1] *= this.transform.height > 0 ? 1 : -1;\r\n                        return item;\r\n                    });\r\n                    const tinyOffset = Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20 ? 10 : 0;\r\n\r\n                    BB.css(g.el, {\r\n                        left: (this.scaled.corners[g.i].x - this.gripSize / 2 + offsetArr[i][0] * tinyOffset) + 'px',\r\n                        top: (this.scaled.corners[g.i].y - this.gripSize / 2 + offsetArr[i][1] * tinyOffset) + 'px',\r\n                    });\r\n\r\n\r\n                    // cursor\r\n                    let angle = BB.pointsToAngleDeg(\r\n                        {\r\n                            x: this.transform.x,\r\n                            y: this.transform.y,\r\n                        },\r\n                        toImageSpace(g.x, g.y, this.transform),\r\n                    ) + 135; // offset so nw is 0\r\n                    while (angle < 0) {\r\n                        angle += 360;\r\n                    }\r\n                    const index = Math.round(angle / 45) % this.cornerCursors.length;\r\n                    BB.css(g.el, {\r\n                        cursor: this.cornerCursors[index] + '-resize',\r\n                    });\r\n                };\r\n\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.corners[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            this.corners[i].virtualPos = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n\r\n                        } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                            this.corners[i].virtualPos.x += event.dX / this.scale;\r\n                            this.corners[i].virtualPos.y += event.dY / this.scale;\r\n\r\n                            let iP = {\r\n                                x: this.corners[i].virtualPos.x,\r\n                                y: this.corners[i].virtualPos.y,\r\n                            };\r\n                            iP = this.constrainCorner(i, iP.x, iP.y);\r\n                            if (!this.isConstrained) {\r\n                                iP = this.snapCorner(iP.x, iP.y);\r\n                            }\r\n\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                iP.x = Math.round(iP.x);\r\n                                iP.y = Math.round(iP.y);\r\n                            }\r\n\r\n                            const tP = toTransformSpace(iP.x, iP.y, this.transform);\r\n\r\n                            const dX = tP.x - this.corners[i].x;\r\n                            const dY = tP.y - this.corners[i].y;\r\n                            this.corners[i].x = tP.x;\r\n                            this.corners[i].y = tP.y;\r\n\r\n                            let indexes: number[] = [];\r\n                            if (i === 0) { // top left\r\n                                indexes = [3, 1, 2];\r\n                            } else if (i === 1) { // top right\r\n                                indexes = [2, 0, 3];\r\n                            } else if (i === 2) { // bottom right\r\n                                indexes = [1, 3, 0];\r\n                            } else if (i === 3) { // bottom left\r\n                                indexes = [0, 2, 1];\r\n                            }\r\n\r\n                            this.corners[indexes[0]].x = this.corners[i].x;\r\n                            this.corners[indexes[1]].y = this.corners[i].y;\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                this.corners[indexes[2]].x -= dX;\r\n                                this.corners[indexes[2]].y -= dY;\r\n                                this.corners[indexes[1]].x = this.corners[indexes[2]].x;\r\n                                this.corners[indexes[0]].y = this.corners[indexes[2]].y;\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    },\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.updateCornerPositions();\r\n        this.updateScaled();\r\n\r\n        let isInverted: boolean;\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i): void => {\r\n                this.edges[i] = {\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.edgeSize + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                            /*background: [\r\n                                '#ff000044',\r\n                                '#00ff0044',\r\n                                '#0000ff44',\r\n                                '#ff00ff44',\r\n                            ][i],*/\r\n                            position: 'absolute',\r\n                        },\r\n                    }),\r\n                } as TFreeTransformEdge;\r\n                const g = this.edges[i];\r\n                g.updateDOM = () => {\r\n                    if (i === 0) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: (Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) - this.edgeSize) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 1) {\r\n                        BB.css(g.el, {\r\n                            left: Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    } else if (i === 2) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + 'px',\r\n                            top: Math.max(this.scaled.corners[0].y,this.scaled.corners[3].y) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 3) {\r\n                        BB.css(g.el, {\r\n                            left: (Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) - this.edgeSize) + 'px',\r\n                            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    }\r\n                    let angleOffset = Math.round(this.transform.angleDeg / 45);\r\n                    while (angleOffset < 0) {\r\n                        angleOffset += 8;\r\n                    }\r\n                    angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\r\n                    g.el.style.cursor = this.cornerCursors[angleOffset] + '-resize';\r\n\r\n                };\r\n\r\n                const isVertical = [0, 2].includes(i);\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.edges[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            if (isVertical) { // top bottom\r\n                                isInverted = this.corners[0].y >= this.corners[3].y;\r\n                            } else { // left right\r\n                                isInverted = this.corners[0].x >= this.corners[1].x;\r\n                            }\r\n                            resetRemainder();\r\n                        }\r\n                        if (event.type === 'pointermove' && event.button === 'left') {\r\n                            const tfD = BB.rotateAround({x: 0, y: 0},\r\n                                {x: event.dX / this.scale, y: event.dY / this.scale},\r\n                                -this.transform.angleDeg);\r\n                            let ti = {\r\n                                dX: tfD.x,\r\n                                dY: tfD.y,\r\n                            };\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                ti = BB.intDxy(pointerRemainder, tfD.x, tfD.y);\r\n                            }\r\n\r\n                            let indexes: number[] = [];\r\n                            if (i === 0) { // top\r\n                                indexes = [2, 3, 0, 1];\r\n                            } else if (i === 1) { // right\r\n                                indexes = [0, 3, 1, 2];\r\n                            } else if (i === 2) { // bottom\r\n                                indexes = [0, 1, 2, 3];\r\n                            } else if (i === 3) { // left\r\n                                indexes = [1, 2, 0, 3];\r\n                            }\r\n\r\n                            const dimension = isVertical ? 'y' : 'x';\r\n                            const d = isVertical ? ti.dY : ti.dX;\r\n\r\n                            if (isInverted) {\r\n                                this.corners[indexes[0]][dimension] += d;\r\n                                this.corners[indexes[1]][dimension] += d;\r\n                            } else {\r\n                                this.corners[indexes[2]][dimension] += d;\r\n                                this.corners[indexes[3]][dimension] += d;\r\n                            }\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                if (isInverted) {\r\n                                    this.corners[indexes[2]][dimension] -= d;\r\n                                    this.corners[indexes[3]][dimension] -= d;\r\n                                } else {\r\n                                    this.corners[indexes[0]][dimension] -= d;\r\n                                    this.corners[indexes[1]][dimension] -= d;\r\n                                }\r\n                            }\r\n\r\n                            if (isVertical) { // top bottom\r\n                                this.restoreRatio(false, true);\r\n                            } else { // left right\r\n                                this.restoreRatio(true, false);\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    },\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.angleGrip = {\r\n            el: BB.el({\r\n                css: {\r\n                    cursor: 'url(' + rotateImg + ') 10 10, move',\r\n                    width: this.gripSize + 'px',\r\n                    height: this.gripSize + 'px',\r\n                    background: '#0ff',\r\n                    borderRadius: this.gripSize + 'px',\r\n                    position: 'absolute',\r\n                    boxShadow: 'inset 0 0 0 2px #000',\r\n                },\r\n            }),\r\n            x: 0,\r\n            y: 0,\r\n            snap: false,\r\n            updateDOM: () => {\r\n                BB.css(this.angleGrip.el, {\r\n                    left: (this.angleGrip.x - this.gripSize / 2) + 'px',\r\n                    top: (this.angleGrip.y - this.gripSize / 2) + 'px',\r\n                });\r\n            },\r\n        };\r\n        BB.el({\r\n            parent: this.angleGrip.el,\r\n            css: {\r\n                width: '2px',\r\n                height: '13px',\r\n                left: (this.gripSize / 2 - 1) + 'px',\r\n                top: this.gripSize + 'px',\r\n                background: '#0ff',\r\n                position: 'absolute',\r\n            },\r\n        });\r\n\r\n        this.anglePointerListener = new BB.PointerListener({\r\n            target: this.angleGrip.el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    const bounds = this.rootEl.getBoundingClientRect();\r\n                    const offset = {\r\n                        x: bounds.left - this.rootEl.scrollLeft,\r\n                        y: bounds.top - this.rootEl.scrollTop,\r\n                    };\r\n                    const iP = {x: (event.clientX - offset.x) / this.scale, y: (event.clientY - offset.y) / this.scale};\r\n\r\n                    const a = BB.pointsToAngleDeg({x: this.transform.x, y: this.transform.y}, iP) + 90;\r\n                    this.transform.angleDeg = a;\r\n                    const snapDeg = Math.round(a / 360 * 8) * 45;\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    } else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    }\r\n                    this.updateDOM();\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                        this.updateDOM();\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        snapToPixel(this.transform);\r\n        this.updateDOM(true);\r\n        BB.append(this.transEl, [\r\n            this.boundsEl,\r\n            this.edges[0].el,\r\n            this.edges[1].el,\r\n            this.edges[2].el,\r\n            this.edges[3].el,\r\n            this.corners[0].el,\r\n            this.corners[1].el,\r\n            this.corners[2].el,\r\n            this.corners[3].el,\r\n            this.angleGrip.el,\r\n        ]);\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    getTransform (): IFreeTransform {\r\n        return copyTransform(this.transform);\r\n    }\r\n\r\n    setConstrained (b: boolean): void {\r\n        this.isConstrained = b;\r\n        if (b && this.transform.width !== 0 && this.transform.height !== 0) {\r\n            this.ratio = Math.abs(this.transform.width / this.transform.height);\r\n        }\r\n    }\r\n\r\n    setSnapping (s: boolean): void {\r\n        this.snappingEnabled = s;\r\n    }\r\n\r\n    setPos (p: IVector2D): void {\r\n        this.transform.x = p.x;\r\n        this.transform.y = p.y;\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    move (dX: number, dY: number): void {\r\n        this.transform.x += dX;\r\n        this.transform.y += dY;\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setSize (w: number, h: number): void {\r\n        this.transform.width = w;\r\n        this.transform.height = h;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n        }\r\n        this.updateCornerPositions();\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setAngleDeg (a: number): void {\r\n        this.transform.angleDeg = a;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n            this.updateCornerPositions();\r\n        }\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getRatio (): number {\r\n        return this.ratio;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.keyListener.destroy();\r\n        this.boundsPointerListener.destroy();\r\n        this.corners[0].pointerListener.destroy();\r\n        this.corners[1].pointerListener.destroy();\r\n        this.corners[2].pointerListener.destroy();\r\n        this.corners[3].pointerListener.destroy();\r\n        this.edges[0].pointerListener.destroy();\r\n        this.edges[1].pointerListener.destroy();\r\n        this.edges[2].pointerListener.destroy();\r\n        this.edges[3].pointerListener.destroy();\r\n        this.anglePointerListener.destroy();\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fcdZI\");","import {IVector2D} from '../../../bb/bb-types';\r\nimport {BB} from '../../../bb/bb';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\nexport interface IFreeTransform {\r\n    x: number; // center of transform region. image space\r\n    y: number;\r\n    width: number; // size of transform region. image space\r\n    height: number;\r\n    angleDeg: number; // angle of transform region. degrees\r\n}\r\n\r\n\r\nexport type TFreeTransformCorner = {\r\n    i: number; // index in corners array\r\n    el: HTMLElement; // draggable corner circle in DOM\r\n    x: number; // unscaled position (transform space)\r\n    y: number;\r\n    virtualPos: IVector2D; // unscaled temporary position (image space)\r\n    updateDOM: () => void; // update styling in DOM\r\n    pointerListener: PointerListener;\r\n};\r\n\r\nexport type TFreeTransformEdge = { // derive position from corners\r\n    el: HTMLElement;\r\n    updateDOM: () => void;\r\n    pointerListener: PointerListener;\r\n};\r\n\r\n/**\r\n * snap entire transform to pixel grid. changes transform\r\n *\r\n * for x y:\r\n * If a dimension has an even size, it be an integer.\r\n * If it's uneven, it's sits exactly half way between two pixels.\r\n *\r\n * @param transform\r\n */\r\nexport function snapToPixel (transform: IFreeTransform): void {\r\n    if (Math.abs(transform.angleDeg) % 90 !== 0) {\r\n        return;\r\n    }\r\n\r\n    transform.width = Math.round(transform.width);\r\n    transform.height = Math.round(transform.height);\r\n    // 0 is original orientation.\r\n    // At 90 and 270 width and height become swapped due to different orientation.\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    transform.x = ((whSwapped ? transform.height : transform.width) % 2 === 0) ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\r\n    transform.y = ((whSwapped ? transform.width : transform.height) % 2 === 0)  ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\r\n}\r\n\r\nexport function copyTransform (transform: IFreeTransform): IFreeTransform {\r\n    return {\r\n        x: transform.x,\r\n        y: transform.y,\r\n        width: transform.width,\r\n        height: transform.height,\r\n        angleDeg: transform.angleDeg,\r\n    };\r\n}\r\n\r\n/**\r\n * image space to transform space\r\n * - origin of transform space is at center of transform bounds.\r\n * - same scale as image space. -> one unit is x: 1/width, y: 1/height\r\n * - up is where transform points up\r\n * - x goes right\r\n * - y goes down\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nexport function toTransformSpace (x: number, y: number, transform: IFreeTransform): IVector2D {\r\n    let px, py;\r\n    px = x - transform.x;\r\n    py = y - transform.y;\r\n\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: px, y: py},\r\n        -transform.angleDeg);\r\n    px = rot.x;\r\n    py = rot.y;\r\n\r\n    return {\r\n        x: px,\r\n        y: py,\r\n    };\r\n}\r\n\r\n/**\r\n * transform space to image space\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nexport function toImageSpace (x: number, y: number, transform: IFreeTransform): IVector2D {\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: x, y: y},\r\n        transform.angleDeg);\r\n    return {\r\n        x: rot.x + transform.x,\r\n        y: rot.y + transform.y,\r\n    };\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {KlCanvasPreview} from '../../canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './free-transform';\r\nimport {IKlBasicLayer} from '../../kl-types';\r\nimport {IRect} from '../../../bb/bb-types';\r\n\r\n/**\r\n * a basic canvas where you can transform one layer(move around, rotate, scale)\r\n *\r\n * DOM Structure:\r\n * div\r\n *      innerWrapper\r\n *          klCanvasPreview\r\n *          transform.div\r\n *\r\n */\r\nexport class FreeTransformCanvas {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly freeTransform: FreeTransform;\r\n    private readonly layers: IKlBasicLayer[];\r\n    private readonly transformIndex: number;\r\n    private readonly imageWidth: number;\r\n    private readonly imageHeight: number;\r\n    private readonly initTransform: IRect;\r\n    private readonly scale: number;\r\n    private readonly previewLayerArr: IKlBasicLayer[];\r\n    private readonly klCanvasPreview: KlCanvasPreview;\r\n\r\n    private updatePreview (): void {\r\n        if (!this.freeTransform) {\r\n            return;\r\n        }\r\n\r\n        const transform = this.freeTransform.getTransform();\r\n        if (this.scale < 1) {\r\n            transform.x *= this.scale;\r\n            transform.y *= this.scale;\r\n            transform.width *= this.scale;\r\n            transform.height *= this.scale;\r\n        }\r\n\r\n        const destCanvas = this.previewLayerArr[this.transformIndex].image;\r\n        const ctx = BB.ctx((destCanvas as HTMLCanvasElement));\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, destCanvas.width, destCanvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            ctx,\r\n            this.layers[this.transformIndex].image,\r\n            transform,\r\n            undefined,\r\n            BB.testShouldPixelate(\r\n                transform,\r\n                transform.width / this.initTransform.width,\r\n                transform.height / this.initTransform.height\r\n            ),\r\n        );\r\n        ctx.restore();\r\n        this.klCanvasPreview.render();\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            elementWidth: number;\r\n            elementHeight: number;\r\n            imageWidth: number;\r\n            imageHeight: number;\r\n            layers: IKlBasicLayer[];\r\n            transformIndex: number;\r\n        }\r\n    ) {\r\n        this.imageWidth = p.imageWidth;\r\n        this.imageHeight = p.imageHeight;\r\n        const previewFit = BB.fitInto(\r\n            p.imageWidth,\r\n            this.imageHeight,\r\n            p.elementWidth - 20,\r\n            p.elementHeight - 60,\r\n            1\r\n        );\r\n        this.scale = previewFit.width / p.imageWidth;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: p.elementWidth + 'px',\r\n                height: p.elementHeight + 'px',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n        this.layers = p.layers;\r\n        this.transformIndex = p.transformIndex;\r\n\r\n\r\n        const innerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: previewFit.width + 'px',\r\n                height: previewFit.height + 'px',\r\n            },\r\n        });\r\n        this.rootEl.append(innerWrapper);\r\n\r\n        this.previewLayerArr = this.layers.map(item => {\r\n            return {\r\n                image: item.image,\r\n                mixModeStr: item.mixModeStr,\r\n                opacity: item.opacity,\r\n            };\r\n        });\r\n        this.previewLayerArr[this.previewLayerArr.length - 1].image = BB.canvas(\r\n            this.scale > 1 ? this.imageWidth : previewFit.width,\r\n            this.scale > 1 ? this.imageHeight : previewFit.height,\r\n        );\r\n        this.klCanvasPreview = new KlCanvasPreview({\r\n            width: previewFit.width,\r\n            height: previewFit.height,\r\n            layers: this.previewLayerArr,\r\n        });\r\n        innerWrapper.append(this.klCanvasPreview.getElement());\r\n\r\n        {\r\n            let transformSize = {\r\n                width: this.layers[this.transformIndex].image.width * this.scale,\r\n                height: this.layers[this.transformIndex].image.height * this.scale,\r\n            };\r\n            if (transformSize.width > previewFit.width || transformSize.height > previewFit.height) {\r\n                transformSize = BB.fitInto(\r\n                    this.layers[this.transformIndex].image.width,\r\n                    this.layers[this.transformIndex].image.height,\r\n                    previewFit.width,\r\n                    previewFit.height,\r\n                    1\r\n                );\r\n            }\r\n            this.initTransform = {\r\n                x: this.imageWidth / 2,\r\n                y: this.imageHeight / 2,\r\n                width: this.layers[this.transformIndex].image.width,\r\n                height: this.layers[this.transformIndex].image.height,\r\n            };\r\n            this.freeTransform = new FreeTransform({\r\n                x: this.initTransform.x,\r\n                y: this.initTransform.y,\r\n                width: this.initTransform.width,\r\n                height: this.initTransform.height,\r\n                angleDeg: 0,\r\n                isConstrained: true,\r\n                snapX: [0, this.imageWidth],\r\n                snapY: [0, this.imageHeight],\r\n                scale: this.scale,\r\n                callback: (transform) => {\r\n                    this.updatePreview();\r\n                },\r\n            });\r\n        }\r\n        BB.css(this.freeTransform.getElement(), {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n        });\r\n        innerWrapper.append(this.freeTransform.getElement());\r\n        setTimeout(() => this.updatePreview(), 0);\r\n    }\r\n\r\n\r\n    // ---- interface ----\r\n    move (dX: number, dY: number): void {\r\n        this.freeTransform.move(dX, dY);\r\n    }\r\n\r\n    reset (): void {\r\n        const w = this.layers[this.transformIndex].image.width;\r\n        const h = this.layers[this.transformIndex].image.height;\r\n\r\n        this.freeTransform.setSize(w, h);\r\n        this.freeTransform.setPos({x: w / 2, y: h / 2});\r\n        this.freeTransform.setAngleDeg(0);\r\n        this.updatePreview();\r\n    }\r\n\r\n    setTransformFit (): void {\r\n\r\n        const fit = BB.fitInto(\r\n            this.layers[this.transformIndex].image.width,\r\n            this.layers[this.transformIndex].image.height,\r\n            this.imageWidth,\r\n            this.imageHeight,\r\n            1\r\n        );\r\n\r\n        this.freeTransform.setSize(fit.width, fit.height);\r\n        this.freeTransform.setPos({x: fit.width / 2, y: fit.height / 2});\r\n        this.freeTransform.setAngleDeg(0);\r\n        this.updatePreview();\r\n    }\r\n\r\n    setTransformCenter (): void {\r\n        this.freeTransform.setPos({x: this.imageWidth / 2, y: this.imageHeight / 2});\r\n        this.freeTransform.setAngleDeg(0);\r\n        this.updatePreview();\r\n    }\r\n\r\n    /**\r\n     * gives you the transformation in the original scale\r\n     */\r\n    getTransformation (): any { // todo\r\n        if (!this.freeTransform) {\r\n            return false;\r\n        }\r\n        return this.freeTransform.getTransform();\r\n    }\r\n\r\n    getIsPixelated (): boolean {\r\n        const transform = this.freeTransform.getTransform();\r\n        return BB.testShouldPixelate(\r\n            transform,\r\n            transform.width / this.initTransform.width,\r\n            transform.height / this.initTransform.height\r\n        );\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.freeTransform.destroy();\r\n        this.klCanvasPreview.destroy();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IRect, IVector2D} from '../../../bb/bb-types';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n\r\ntype TUpdateElement = {\r\n    el: HTMLElement;\r\n    update: () => void;\r\n};\r\n\r\n/**\r\n * Interactive preview for crop filter. Corners and edges can be dragged.\r\n * the div that you append this to must be relative\r\n */\r\nexport class Cropper {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private x: number;\r\n    private y: number;\r\n    private width: number;\r\n    private height: number;\r\n    private scale: number;\r\n    private readonly grips: IVector2D[]; // aka corner coordinates\r\n    private readonly edges: TUpdateElement[];\r\n    private readonly cornerElArr: TUpdateElement[];\r\n    private readonly darken: TUpdateElement[];\r\n    private readonly outline: TUpdateElement;\r\n    private readonly thirdsHorizontal: TUpdateElement;\r\n    private readonly thirdsVertical: TUpdateElement;\r\n    private readonly keyListener: KeyListener;\r\n    private readonly pointerRemainder: IVector2D;\r\n\r\n    private readonly outlinePointerListener: PointerListener;\r\n\r\n    private readonly corner0PointerListener: PointerListener;\r\n    private readonly corner1PointerListener: PointerListener;\r\n    private readonly corner2PointerListener: PointerListener;\r\n    private readonly corner3PointerListener: PointerListener;\r\n\r\n    private readonly edge0PointerListener: PointerListener;\r\n    private readonly edge1PointerListener: PointerListener;\r\n    private readonly edge2PointerListener: PointerListener;\r\n    private readonly edge3PointerListener: PointerListener;\r\n\r\n    private readonly callback: (val: IRect) => void;\r\n\r\n    private update (): void {\r\n        this.edges[0].update();\r\n        this.edges[1].update();\r\n        this.edges[2].update();\r\n        this.edges[3].update();\r\n        this.cornerElArr[0].update();\r\n        this.cornerElArr[1].update();\r\n        this.cornerElArr[2].update();\r\n        this.cornerElArr[3].update();\r\n        this.darken[0].update();\r\n        this.darken[1].update();\r\n        this.darken[2].update();\r\n        this.darken[3].update();\r\n        this.outline.update();\r\n        this.thirdsHorizontal.update();\r\n        this.thirdsVertical.update();\r\n    }\r\n\r\n    private commit (): void {\r\n        this.pointerRemainder.x = 0;\r\n        this.pointerRemainder.y = 0;\r\n        this.callback(this.getTransform());\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        params: {\r\n            x: number; // int, pos in relation to image\r\n            y: number; // int\r\n            width: number; // int\r\n            height: number; // int\r\n            maxW: number;\r\n            maxH: number;\r\n            scale: number; // float, zoom\r\n            callback: (val: IRect) => void;\r\n        }\r\n    ) {\r\n\r\n        this.x = params.x;\r\n        this.y = params.y;\r\n        this.width = params.width;\r\n        this.height = params.height;\r\n        this.scale = params.scale;\r\n        this.callback = params.callback;\r\n\r\n        const maxW = params.maxW;\r\n        const maxH = params.maxW;\r\n        this.rootEl = BB.el();\r\n        const gripCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n\r\n        this.keyListener = new BB.KeyListener({});\r\n\r\n        BB.css(this.rootEl, {\r\n            position: 'absolute',\r\n            left: (this.x * this.scale) + 'px',\r\n            top: (this.y * this.scale) + 'px',\r\n        });\r\n\r\n        this.outline = {\r\n            el: BB.el({\r\n                css: {\r\n                    position: 'absolute',\r\n                    border: '1px dashed #fff',\r\n                    cursor: 'move',\r\n                },\r\n            }),\r\n            update: () => {\r\n                BB.css(this.outline.el, {\r\n                    left: (this.grips[0].x * this.scale - 1) + 'px',\r\n                    top: (this.grips[0].y * this.scale - 1) + 'px',\r\n                    width: ((this.grips[2].x - this.grips[0].x) * this.scale) + 'px',\r\n                    height: ((this.grips[2].y - this.grips[0].y) * this.scale) + 'px',\r\n                });\r\n            },\r\n        };\r\n\r\n        this.pointerRemainder = { // needs to be reset after dragging complete\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        this.outlinePointerListener = new BB.PointerListener({\r\n            target: this.outline.el,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n\r\n                    this.grips[0].x += dX;\r\n                    this.grips[0].y += dY;\r\n                    this.grips[1].x += dX;\r\n                    this.grips[1].y += dY;\r\n                    this.grips[2].x += dX;\r\n                    this.grips[2].y += dY;\r\n                    this.grips[3].x += dX;\r\n                    this.grips[3].y += dY;\r\n\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n\r\n        this.thirdsHorizontal = {\r\n            el: BB.el({\r\n                css: {\r\n                    position: 'absolute',\r\n                    borderTop: '1px solid #0ff',\r\n                    borderBottom: '1px solid #0ff',\r\n                },\r\n            }),\r\n            update: () => {\r\n                BB.css(this.thirdsHorizontal.el, {\r\n                    left: (this.grips[0].x * this.scale) + 'px',\r\n                    top: ((this.grips[0].y + (this.grips[2].y - this.grips[0].y) / 3) * this.scale) + 'px',\r\n                    width: ((this.grips[2].x - this.grips[0].x) * this.scale) + 'px',\r\n                    height: ((this.grips[2].y - this.grips[0].y) / 3 * this.scale) + 'px',\r\n                });\r\n            },\r\n        };\r\n\r\n        this.thirdsVertical = {\r\n            el: BB.el({\r\n                css: {\r\n                    position: 'absolute',\r\n                    borderLeft: '1px solid #0ff',\r\n                    borderRight: '1px solid #0ff',\r\n                },\r\n            }),\r\n            update: () => {\r\n                BB.css(this.thirdsVertical.el, {\r\n                    left: ((this.grips[0].x + (this.grips[2].x - this.grips[0].x) / 3) * this.scale) + 'px',\r\n                    top: (this.grips[0].y * this.scale) + 'px',\r\n                    width: ((this.grips[2].x - this.grips[0].x) / 3 * this.scale) + 'px',\r\n                    height: ((this.grips[2].y - this.grips[0].y) * this.scale) + 'px',\r\n                });\r\n            },\r\n        };\r\n\r\n        const gripSize = 40;\r\n        const gripOverlay = 10;\r\n\r\n        this.grips = [\r\n            {x: 0, y: 0}, // top left\r\n            {x: this.width, y: 0}, // top right\r\n            {x: this.width, y: this.height}, // bottom right\r\n            {x: 0, y: this.height}, //bottom left\r\n        ];\r\n\r\n        const transformTop = (dY: number) => {\r\n            this.grips[0].y += dY;\r\n            this.grips[0].y = BB.clamp(this.grips[0].y, this.grips[3].y - maxH, this.grips[3].y - 1);\r\n            this.grips[1].y = this.grips[0].y;\r\n        };\r\n        const transformRight = (dX: number) => {\r\n            this.grips[1].x += dX;\r\n            this.grips[1].x = BB.clamp(this.grips[1].x, this.grips[0].x + 1, this.grips[0].x + maxW);\r\n            this.grips[2].x = this.grips[1].x;\r\n        };\r\n        const transformBottom = (dY: number) => {\r\n            this.grips[2].y += dY;\r\n            this.grips[2].y = BB.clamp(this.grips[2].y, this.grips[1].y + 1, this.grips[1].y + maxH);\r\n            this.grips[3].y = this.grips[2].y;\r\n        };\r\n        const transformLeft = (dX: number) => {\r\n            this.grips[0].x += dX;\r\n            this.grips[0].x = BB.clamp(this.grips[0].x, this.grips[1].x - maxW, this.grips[1].x - 1);\r\n            this.grips[3].x = this.grips[0].x;\r\n        };\r\n\r\n\r\n\r\n\r\n        this.edges = [];\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n\r\n                const el = BB.el({\r\n                    css: {\r\n                        width: gripSize + 'px',\r\n                        height: gripSize + 'px',\r\n                        //background: '#0f0',\r\n                        position: 'absolute',\r\n                    },\r\n                });\r\n\r\n                const update = () => {\r\n                    if (i === 0) { //top\r\n                        BB.css(el, {\r\n                            left: (this.grips[0].x * this.scale + gripOverlay) + 'px',\r\n                            top: (this.grips[0].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            width: ((this.grips[1].x - this.grips[0].x) * this.scale - gripOverlay * 2) + 'px',\r\n                            height: (gripSize * 2) + 'px',\r\n                        });\r\n                    } else if (i === 1) { //right\r\n                        BB.css(el, {\r\n                            left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\r\n                            top: (this.grips[1].y * this.scale + gripOverlay) + 'px',\r\n                            width: (gripSize * 2) + 'px',\r\n                            height: ((this.grips[2].y - this.grips[1].y) * this.scale - gripOverlay * 2) + 'px',\r\n                        });\r\n                    } else if (i === 2) { //bottom\r\n                        BB.css(el, {\r\n                            left: (this.grips[3].x * this.scale + gripOverlay) + 'px',\r\n                            top: (this.grips[3].y * this.scale - gripOverlay) + 'px',\r\n                            width: ((this.grips[2].x - this.grips[3].x) * this.scale - gripOverlay * 2) + 'px',\r\n                            height: (gripSize * 2) + 'px',\r\n                        });\r\n                    } else if (i === 3) { //left\r\n                        BB.css(el, {\r\n                            left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            top: (this.grips[0].y * this.scale + gripOverlay) + 'px',\r\n                            width: (gripSize * 2) + 'px',\r\n                            height: ((this.grips[3].y - this.grips[0].y) * this.scale - gripOverlay * 2) + 'px',\r\n                        });\r\n                    }\r\n                    const angleOffset = i * 2 + 1;\r\n                    el.style.cursor = gripCursors[angleOffset] + '-resize';\r\n\r\n                };\r\n\r\n                this.edges[i] = {\r\n                    el,\r\n                    update,\r\n                };\r\n            })(i);\r\n        }\r\n\r\n        this.darken = [];\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                const g = BB.el({\r\n                    css: {\r\n                        position: 'absolute',\r\n                        background: '#000',\r\n                        opacity: '0.5',\r\n                    },\r\n                });\r\n                const update = () => {\r\n                    if (i === 0) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[0].x * this.scale) + 'px',\r\n                            top: (this.grips[0].y * this.scale - 8000) + 'px',\r\n                            width: ((this.grips[1].x - this.grips[0].x) * this.scale) + 'px',\r\n                            height: '8000px',\r\n                        });\r\n                    } else if (i === 1) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[1].x * this.scale) + 'px',\r\n                            top: (this.grips[1].y * this.scale - 8000) + 'px',\r\n                            width: '8000px',\r\n                            height: 16000 + 'px',\r\n                        });\r\n                    } else if (i === 2) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[3].x * this.scale) + 'px',\r\n                            top: (this.grips[3].y * this.scale) + 'px',\r\n                            width: ((this.grips[2].x - this.grips[3].x) * this.scale) + 'px',\r\n                            height: '8000px',\r\n                        });\r\n                    } else if (i === 3) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[0].x * this.scale - 8000) + 'px',\r\n                            top: (this.grips[0].y * this.scale - 8000) + 'px',\r\n                            width: '8000px',\r\n                            height: 16000 + 'px',\r\n                        });\r\n                    }\r\n\r\n                };\r\n\r\n                this.darken[i] = {\r\n                    el: g,\r\n                    update,\r\n                };\r\n            })(i);\r\n        }\r\n\r\n        this.edge0PointerListener = new BB.PointerListener({\r\n            target: this.edges[0].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformTop(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformBottom(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        this.edge1PointerListener = new BB.PointerListener({\r\n            target: this.edges[1].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformRight(dX);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformLeft(-dX);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        this.edge2PointerListener = new BB.PointerListener({\r\n            target: this.edges[2].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformBottom(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformTop(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        this.edge3PointerListener = new BB.PointerListener({\r\n            target: this.edges[3].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformLeft(dX);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformRight(-dX);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n        this.cornerElArr = [];\r\n        (() => {\r\n            for (let i = 0; i < 4; i++) {\r\n                ((i) => {\r\n                    const g = BB.el({\r\n                        css: {\r\n                            //background: '#f00',\r\n                            width: (gripSize * 2) + 'px',\r\n                            height: (gripSize * 2) + 'px',\r\n                            position: 'absolute',\r\n                            cursor: ['nwse-resize', 'nesw-resize'][i % 2],\r\n                        },\r\n                    });\r\n\r\n                    const update = () => {\r\n                        if (i === 0) { //top left\r\n                            BB.css(g, {\r\n                                left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                                top: (this.grips[0].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            });\r\n                        } else if (i === 1) { //top right\r\n                            BB.css(g, {\r\n                                left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\r\n                                top: (this.grips[1].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            });\r\n                        } else if (i === 2) { //bottom right\r\n                            BB.css(g, {\r\n                                left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\r\n                                top: (this.grips[2].y * this.scale - gripOverlay) + 'px',\r\n                            });\r\n                        } else if (i === 3) { //bottom left\r\n                            BB.css(g, {\r\n                                left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                                top: (this.grips[2].y * this.scale - gripOverlay) + 'px',\r\n                            });\r\n                        }\r\n                    };\r\n\r\n                    this.cornerElArr[i] = {\r\n                        el: g,\r\n                        update,\r\n                    };\r\n                })(i);\r\n            }\r\n        })();\r\n        //top left\r\n        this.corner0PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[0].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformLeft(dX);\r\n                    transformTop(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformRight(-dX);\r\n                        transformBottom(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        //top right\r\n        this.corner1PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[1].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformRight(dX);\r\n                    transformTop(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformLeft(-dX);\r\n                        transformBottom(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        //bottom right\r\n        this.corner2PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[2].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformRight(dX);\r\n                    transformBottom(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformLeft(-dX);\r\n                        transformTop(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        //bottom left\r\n        this.corner3PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[3].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformLeft(dX);\r\n                    transformBottom(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformRight(-dX);\r\n                        transformTop(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n        this.rootEl.append(\r\n            this.darken[1].el,\r\n            this.darken[0].el,\r\n            this.darken[2].el,\r\n            this.darken[3].el,\r\n            this.thirdsHorizontal.el,\r\n            this.thirdsVertical.el,\r\n            this.outline.el,\r\n\r\n            this.edges[1].el,\r\n            this.edges[0].el,\r\n            this.edges[2].el,\r\n            this.edges[3].el,\r\n\r\n            this.cornerElArr[0].el,\r\n            this.cornerElArr[1].el,\r\n            this.cornerElArr[2].el,\r\n            this.cornerElArr[3].el,\r\n        );\r\n\r\n        this.update();\r\n\r\n    }\r\n\r\n    // ---- interface ----\r\n    getTransform (): IRect {\r\n        this.grips[1].x -= this.grips[0].x;\r\n        this.grips[1].y -= this.grips[0].y;\r\n        this.grips[2].x -= this.grips[0].x;\r\n        this.grips[2].y -= this.grips[0].y;\r\n        this.grips[3].x -= this.grips[0].x;\r\n        this.grips[3].y -= this.grips[0].y;\r\n        this.x += this.grips[0].x;\r\n        this.y += this.grips[0].y;\r\n        this.grips[0].x = 0;\r\n        this.grips[0].y = 0;\r\n        return {\r\n            x: this.x,\r\n            y: this.y,\r\n            width: this.grips[1].x,\r\n            height: this.grips[2].y,\r\n        };\r\n    }\r\n\r\n    setTransform (p: IRect): void {\r\n        this.x = p.x;\r\n        this.y = p.y;\r\n        this.width = p.width;\r\n        this.height = p.height;\r\n\r\n        BB.css(this.rootEl, {\r\n            left: (this.x * this.scale) + 'px',\r\n            top: (this.y * this.scale) + 'px',\r\n        });\r\n\r\n        this.grips[0].x = 0;\r\n        this.grips[0].y = 0;\r\n        this.grips[1].x = this.width;\r\n        this.grips[1].y = 0;\r\n        this.grips[2].x = this.width;\r\n        this.grips[2].y = this.height;\r\n        this.grips[3].x = 0;\r\n        this.grips[3].y = this.height;\r\n\r\n        this.update();\r\n        this.commit();\r\n    }\r\n\r\n    setScale (s: number): void {\r\n        this.scale = s;\r\n        BB.css(this.rootEl, {\r\n            left: (this.x * this.scale) + 'px',\r\n            top: (this.y * this.scale) + 'px',\r\n        });\r\n        this.update();\r\n    }\r\n\r\n    showThirds (b: boolean): void {\r\n\r\n        this.thirdsHorizontal.el.style.display = b ? 'block' : 'none';\r\n        this.thirdsVertical.el.style.display = b ? 'block' : 'none';\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.keyListener.destroy();\r\n        this.outlinePointerListener.destroy();\r\n        this.corner0PointerListener.destroy();\r\n        this.corner1PointerListener.destroy();\r\n        this.corner2PointerListener.destroy();\r\n        this.corner3PointerListener.destroy();\r\n        this.edge0PointerListener.destroy();\r\n        this.edge1PointerListener.destroy();\r\n        this.edge2PointerListener.destroy();\r\n        this.edge3PointerListener.destroy();\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\nimport {TKlCanvasLayer, TUiLayout} from '../../kl-types';\r\nimport {ISize2D} from '../../../bb/bb-types';\r\nimport {theme} from '../../../theme/theme';\r\n\r\n\r\n/**\r\n * Previews currently active layer\r\n * thumbnail (hover shows bigger preview), layername, opacity\r\n *\r\n * internally listens to kl history. updates when there's a change.\r\n * but you need to update it when the active layer changed. (different canvas object)\r\n *\r\n * update visibility for performance\r\n */\r\nexport class LayerPreview {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly contentWrapperEl: HTMLElement;\r\n    private readonly height: number;\r\n    private layerObj: TKlCanvasLayer;\r\n    private isVisible: boolean;\r\n    private uiState: TUiLayout;\r\n\r\n    private readonly nameLabelEl: HTMLElement;\r\n    private readonly opacityEl: HTMLElement;\r\n    private lastDrawnSize: ISize2D;\r\n    private lastDrawnState: number; // from KlHistory\r\n\r\n    private readonly canvasSize: number;\r\n    private readonly canvas: HTMLCanvasElement;\r\n    private readonly canvasCtx: CanvasRenderingContext2D;\r\n\r\n    private animationCount: number; // >0 means it's animating\r\n    private readonly animationLength: number;\r\n\r\n    private readonly animationCanvas: HTMLCanvasElement;\r\n    private readonly animationCanvasCtx: CanvasRenderingContext2D;\r\n    private animationCanvasCheckerPattern: CanvasPattern;\r\n\r\n    private largeCanvasIsVisible: boolean;\r\n    private readonly largeCanvasWrapper: HTMLElement;\r\n    private readonly largeCanvasSize: number;\r\n    private readonly largeCanvas: HTMLCanvasElement;\r\n    private readonly largeCanvasCtx: CanvasRenderingContext2D;\r\n    private largeCanvasCheckerPattern: CanvasPattern;\r\n\r\n\r\n    private updateCheckerPatterns (): void {\r\n        const checker = BB.createCheckerCanvas(4, theme.isDark());\r\n        this.animationCanvasCheckerPattern = this.animationCanvasCtx.createPattern(checker, 'repeat');\r\n        this.largeCanvasCheckerPattern = this.canvasCtx.createPattern(checker, 'repeat');\r\n    }\r\n    \r\n    private animate (): void {\r\n        if (this.animationCount === 0) {\r\n            return;\r\n        }\r\n\r\n        this.animationCount--;\r\n\r\n        this.canvasCtx.save();\r\n        this.canvasCtx.globalAlpha = Math.pow((this.animationLength - this.animationCount) / this.animationLength, 2);\r\n        this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\r\n        this.canvasCtx.restore();\r\n\r\n        if (this.animationCount > 0) {\r\n            requestAnimationFrame(() => this.animate());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * is always instant\r\n     */\r\n    private drawLargeCanvas (): void {\r\n\r\n        if (!this.largeCanvasIsVisible || !this.layerObj) {\r\n            return;\r\n        }\r\n\r\n        const layerCanvas = this.layerObj.context.canvas;\r\n\r\n        const canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, this.largeCanvasSize, this.largeCanvasSize, 1);\r\n        this.largeCanvas.width = Math.round(canvasDimensions.width);\r\n        this.largeCanvas.height = Math.round(canvasDimensions.height);\r\n        this.largeCanvasCtx.save();\r\n        if (this.largeCanvas.width > layerCanvas.width) {\r\n            this.largeCanvasCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            this.largeCanvasCtx.imageSmoothingEnabled = true;\r\n            this.largeCanvasCtx.imageSmoothingQuality = 'high';\r\n        }\r\n        this.largeCanvasCtx.fillStyle = this.largeCanvasCheckerPattern;\r\n        this.largeCanvasCtx.fillRect(0, 0, this.largeCanvas.width, this.largeCanvas.height);\r\n        this.largeCanvasCtx.drawImage(layerCanvas, 0, 0, this.largeCanvas.width, this.largeCanvas.height);\r\n        this.largeCanvasCtx.restore();\r\n\r\n        const bounds = this.rootEl.getBoundingClientRect();\r\n        BB.css(this.largeCanvasWrapper, {\r\n            top: Math.max(10, (bounds.top + this.height / 2 - this.largeCanvas.height / 2)) + 'px',\r\n        });\r\n\r\n    }\r\n\r\n    private draw (isInstant: boolean): void {\r\n        if (!this.isVisible) {\r\n            return;\r\n        }\r\n\r\n        this.nameLabelEl.textContent = this.layerObj.name;\r\n        this.opacityEl.innerHTML = LANG('opacity') + '<br>' + Math.round(this.layerObj.opacity * 100) + '%';\r\n\r\n        const layerCanvas = this.layerObj.context.canvas;\r\n\r\n        if (layerCanvas.width !== this.lastDrawnSize.width || layerCanvas.height !== this.lastDrawnSize.height) {\r\n            const canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, this.canvasSize, this.canvasSize, 1);\r\n            this.canvas.width = Math.round(canvasDimensions.width);\r\n            this.canvas.height = Math.round(canvasDimensions.height);\r\n\r\n            isInstant = true;\r\n        }\r\n\r\n        this.animationCanvas.width = this.canvas.width;\r\n        this.animationCanvas.height = this.canvas.height;\r\n\r\n        this.animationCanvasCtx.save();\r\n        this.animationCanvasCtx.imageSmoothingEnabled = false;\r\n        this.animationCanvasCtx.fillStyle = this.animationCanvasCheckerPattern;\r\n        this.animationCanvasCtx.fillRect(0, 0, this.animationCanvas.width, this.animationCanvas.height);\r\n        this.animationCanvasCtx.drawImage(layerCanvas, 0, 0, this.animationCanvas.width, this.animationCanvas.height);\r\n        this.animationCanvasCtx.restore();\r\n\r\n        if (isInstant) {\r\n            this.animationCount = 0;\r\n            this.canvasCtx.save();\r\n            this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\r\n            this.canvasCtx.restore();\r\n\r\n        } else {\r\n            this.animationCount = this.animationLength;\r\n            this.animate();\r\n\r\n        }\r\n\r\n        this.drawLargeCanvas();\r\n\r\n        this.lastDrawnState = klHistory.getState();\r\n        this.lastDrawnSize.width = layerCanvas.width;\r\n        this.lastDrawnSize.height = layerCanvas.height;\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onClick: () => void; // when clicking on layer name\r\n            klRootEl: HTMLElement;\r\n            uiState: TUiLayout;\r\n        }\r\n    ) {\r\n        // internally redraws with in an interval. checks history is something changed\r\n        // this update will be animated\r\n        // it will not be animated if the resolution changed\r\n        // also redraws when you call updateLayer - not animated\r\n\r\n        // syncs via updateLayer, and internally updates layer opacity via a hack\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-layer-preview',\r\n        });\r\n        this.isVisible = true;\r\n        this.height = 40;\r\n        this.canvasSize = this.height - 10;\r\n        this.largeCanvasSize = 300;\r\n        this.lastDrawnState = -2;\r\n        this.lastDrawnSize = {\r\n            width: 0,\r\n            height: 0,\r\n        };\r\n        this.animationCanvas = BB.canvas(); // to help animate the transition\r\n        this.animationCanvasCtx = BB.ctx(this.animationCanvas);\r\n        this.animationLength = 30;\r\n        this.animationCount = 0;\r\n        this.largeCanvasIsVisible = false;\r\n        let largeCanvasAnimationTimeout: ReturnType<typeof setTimeout>;\r\n        const largeCanvasAnimationDurationMs = 300;\r\n        this.uiState = p.uiState;\r\n\r\n\r\n        // --- setup dom ---\r\n        this.contentWrapperEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                height: this.height + 'px',\r\n            },\r\n        });\r\n        const canvasWrapperEl = BB.el({\r\n            css: {\r\n                //background: '#f00',\r\n                minWidth: this.height + 'px',\r\n                height: this.height + 'px',\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        this.canvas = BB.canvas(this.canvasSize, this.canvasSize);\r\n        this.canvasCtx = BB.ctx(this.canvas);\r\n        this.canvas.title = LANG('layers-active-layer');\r\n        const nameWrapper = BB.el({\r\n            css: {\r\n                //background: '#ff0',\r\n                flexGrow: '1',\r\n                paddingLeft: '10px',\r\n                fontSize: '13px',\r\n                overflow: 'hidden',\r\n                position: 'relative',\r\n            },\r\n        });\r\n        this.nameLabelEl = BB.el({\r\n            content: '',\r\n            css: {\r\n                cssFloat: 'left',\r\n                whiteSpace: 'nowrap',\r\n            },\r\n        });\r\n        const clickableEl = BB.el({\r\n            css: {\r\n                //background: 'rgba(0,255,0,0.6)',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '0',\r\n                width: '90px',\r\n                height: '100%',\r\n            },\r\n        });\r\n        if (p.onClick) {\r\n            clickableEl.addEventListener('click', () => {\r\n                p.onClick();\r\n            });\r\n            this.canvas.addEventListener('click', () => {\r\n                p.onClick();\r\n            });\r\n        }\r\n        this.opacityEl = BB.el({\r\n            content: LANG('opacity') + '<br>100%',\r\n            css: {\r\n                minWidth: '60px',\r\n                fontSize: '12px',\r\n                textAlign: 'center',\r\n            },\r\n        });\r\n\r\n        this.largeCanvasWrapper = BB.el({\r\n            onClick: BB.handleClick,\r\n            css: {\r\n                pointerEvents: 'none',\r\n                background: '#fff',\r\n                position: 'absolute',\r\n                right: '280px',\r\n                top: '10px',\r\n                border: '1px solid #aaa',\r\n                boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\r\n                transition: 'opacity '+largeCanvasAnimationDurationMs+'ms ease-in-out',\r\n                userSelect: 'none',\r\n                display: 'block',\r\n                webkitTouchCallout: 'none',\r\n            },\r\n        });\r\n        this.largeCanvas = BB.canvas(this.largeCanvasSize, this.largeCanvasSize);\r\n        this.largeCanvasWrapper.append(this.largeCanvas);\r\n        this.largeCanvasCtx = BB.ctx(this.largeCanvas);\r\n        BB.css(this.largeCanvas, {\r\n            display: 'block',\r\n        });\r\n\r\n\r\n        canvasWrapperEl.append(this.canvas);\r\n        nameWrapper.append(this.nameLabelEl, clickableEl);\r\n        this.contentWrapperEl.append(canvasWrapperEl, nameWrapper, this.opacityEl);\r\n        this.rootEl.append(this.contentWrapperEl);\r\n\r\n\r\n        this.updateCheckerPatterns();\r\n        theme.addIsDarkListener(() => {\r\n            this.updateCheckerPatterns();\r\n            this.draw(true);\r\n        });\r\n\r\n\r\n\r\n        // --- update logic ---\r\n\r\n        // cross-fade done via 2 canvases (old and new state)\r\n        // both have checkerboard background drawn on them, both fully opaque\r\n        // -> no \"lighter\" is needed for accurate cross-fading\r\n\r\n        setInterval(() => {\r\n\r\n            if (!this.layerObj) {\r\n                return;\r\n            }\r\n\r\n            const currentState = klHistory.getState();\r\n            if (currentState === this.lastDrawnState) {\r\n                return;\r\n            }\r\n\r\n            //update opacity w hack\r\n            this.layerObj.opacity = this.layerObj.context.canvas.opacity;\r\n\r\n            this.draw(false);\r\n\r\n        }, 2000);\r\n        \r\n\r\n        const removeLargeCanvas = () => {\r\n            try {\r\n                p.klRootEl.removeChild(this.largeCanvasWrapper);\r\n            } catch(e) {\r\n\r\n            }\r\n        };\r\n\r\n        const showLargeCanvas = (b) => {\r\n            if (this.largeCanvasIsVisible === b) {\r\n                return;\r\n            }\r\n\r\n            clearTimeout(largeCanvasAnimationTimeout);\r\n            this.largeCanvasIsVisible = b;\r\n\r\n            if (b) {\r\n                largeCanvasAnimationTimeout = setTimeout(() => {\r\n                    this.drawLargeCanvas();\r\n                    this.largeCanvasWrapper.style.opacity = '0';\r\n                    p.klRootEl.append(this.largeCanvasWrapper);\r\n                    setTimeout(() => {\r\n                        this.largeCanvasWrapper.style.opacity = '1';\r\n                    }, 20);\r\n                }, 250);\r\n\r\n            } else {\r\n                this.largeCanvasWrapper.style.opacity = '0';\r\n                largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\r\n            }\r\n\r\n        };\r\n\r\n        const pointerListener = new BB.PointerListener({\r\n            target: this.canvas,\r\n            onEnterLeave: (b) => {\r\n                showLargeCanvas(b);\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (b: boolean): void {\r\n        if (this.isVisible === b) {\r\n            return;\r\n        }\r\n        this.isVisible = b;\r\n        this.contentWrapperEl.style.display = this.isVisible ? 'flex' : 'none';\r\n        this.rootEl.style.marginBottom = this.isVisible ? '' : '10px';\r\n\r\n        const currentState = klHistory.getState();\r\n        if (b && this.lastDrawnState !== currentState) {\r\n            this.draw(true);\r\n        }\r\n    }\r\n\r\n    //when the layer might have changed\r\n         setLayer (klCanvasLayerObj: TKlCanvasLayer): void {\r\n        this.layerObj = klCanvasLayerObj;\r\n        this.draw(true);\r\n    }\r\n\r\n    setUiState (stateStr: TUiLayout): void {\r\n        this.uiState = stateStr;\r\n\r\n        if (this.uiState === 'left') {\r\n            BB.css(this.largeCanvasWrapper, {\r\n                left: '280px',\r\n                right: '',\r\n            });\r\n        } else {\r\n            BB.css(this.largeCanvasWrapper, {\r\n                left: '',\r\n                right: '280px',\r\n            });\r\n        }\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {FreeTransformCanvas} from '../components/free-transform-canvas';\r\nimport {showModal} from './base/showModal';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {IKlBasicLayer} from '../../kl-types';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showImportAsLayerDialog (\r\n    params: {\r\n        target: HTMLElement;\r\n        klCanvas: KlCanvas;\r\n        importImage: HTMLImageElement | HTMLCanvasElement;\r\n        callback: (\r\n            p?: {x: number; y: number; width:number; height: number; angleDeg: number},\r\n            isPixelated?: boolean\r\n        ) => void;\r\n    }\r\n): void {\r\n\r\n    const div = document.createElement('div');\r\n    BB.appendTextDiv(div, LANG('import-as-layer-description'));\r\n    if (params.klCanvas.isLayerLimitReached()) {\r\n        const noteEl = BB.el({\r\n            content: LANG('import-as-layer-limit-reached'),\r\n            css: {\r\n                background: '#ff0',\r\n                padding: '10px',\r\n                marginTop: '5px',\r\n                marginBottom: '5px',\r\n                border: '1px solid #e7d321',\r\n                borderRadius: '5px',\r\n            },\r\n        });\r\n        div.append(noteEl);\r\n    }\r\n    const isSmall = window.innerWidth < 550;\r\n\r\n    const buttonRowEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n        },\r\n    });\r\n    const originalSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: '1:1',\r\n        css: {\r\n            marginRight: '10px',\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.reset();\r\n        },\r\n    });\r\n    const fitSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('import-as-layer-fit'),\r\n        css: {\r\n            marginRight: '10px',\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.setTransformFit();\r\n        },\r\n    });\r\n    const centerBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('center'),\r\n        css: {\r\n            marginRight: '10px',\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.setTransformCenter();\r\n        },\r\n    });\r\n    buttonRowEl.append(originalSizeBtn, fitSizeBtn, centerBtn);\r\n    div.append(buttonRowEl);\r\n\r\n\r\n\r\n    const layers: IKlBasicLayer[] = [];\r\n    {\r\n        const klCanvasLayerArr = params.klCanvas.getLayers();\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            layers.push({\r\n                image: klCanvasLayerArr[i].context.canvas,\r\n                opacity: klCanvasLayerArr[i].opacity,\r\n                mixModeStr: klCanvasLayerArr[i].mixModeStr,\r\n            });\r\n        }\r\n    }\r\n    layers.push({\r\n        image: params.importImage,\r\n        opacity: 1,\r\n        mixModeStr: 'source-over',\r\n    });\r\n\r\n\r\n    const freeTransformCanvas = new FreeTransformCanvas({\r\n        elementWidth: isSmall ? 340 : 540,\r\n        elementHeight: isSmall ? 280 : 350,\r\n        imageWidth: params.klCanvas.getLayerContext(0).canvas.width,\r\n        imageHeight: params.klCanvas.getLayerContext(0).canvas.height,\r\n        layers: layers,\r\n        transformIndex: layers.length - 1,\r\n    });\r\n    BB.css(freeTransformCanvas.getElement(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n    });\r\n    div.append(freeTransformCanvas.getElement());\r\n\r\n    function move (x: number, y: number): void {\r\n        freeTransformCanvas.move(x, y);\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr) {\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        },\r\n    });\r\n\r\n    showModal({\r\n        target: params.target,\r\n        message: `<b>${LANG('import-as-layer-title')}</b>`,\r\n        div: div,\r\n        style: isSmall ? undefined : {\r\n            width: '500px',\r\n        },\r\n        buttons: ['Ok', 'Cancel'],\r\n        clickOnEnter: 'Ok',\r\n        callback: function (buttonStr) {\r\n            keyListener.destroy();\r\n            freeTransformCanvas.destroy();\r\n            BB.destroyEl(originalSizeBtn);\r\n            BB.destroyEl(fitSizeBtn);\r\n            BB.destroyEl(centerBtn);\r\n            if (buttonStr === 'Ok') {\r\n                params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\r\n            } else {\r\n                params.callback();\r\n            }\r\n        },\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\ntype TDropOption = 'default' | 'layer' | 'image';\r\n\r\n/**\r\n * Not really generalized. UI when you drag/drop an image into window.\r\n * The moment you create it, it will listen.\r\n * */\r\nexport class KlImageDropper {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onDrop: (files: FileList, optionStr: TDropOption) => void;\r\n            target: HTMLElement;\r\n            enabledTest: () => boolean;\r\n        }\r\n    ) {\r\n        //set up DOM\r\n        this.rootEl = BB.el({\r\n            content: 'Drop to import',\r\n            css: {\r\n                paddingTop: '100px',\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                width: '100%',\r\n                height: '100%',\r\n                background: 'rgba(50, 50, 50, 0.7)',\r\n                color: '#fff',\r\n                textShadow: '2px 2px #000',\r\n                textAlign: 'center',\r\n                fontSize: '25px',\r\n            },\r\n        });\r\n        const wrapperEl = BB.el({\r\n            css: {\r\n                'marginTop': '50px',\r\n                'display': 'flex',\r\n                'justifyContent': 'center',\r\n            },\r\n        });\r\n        const optionStyle = {\r\n            width: '200px',\r\n            padding: '50px',\r\n            margin: '10px',\r\n            //opacity: 0.5,\r\n            borderRadius: '20px',\r\n            border: '1px dashed #fff',\r\n            background: '#00aefe',\r\n            fontWeight: 'bold',\r\n        };\r\n        const optionLayerEl = BB.el({\r\n            content: 'As Layer',\r\n            css: optionStyle,\r\n        });\r\n        const optionImageEl = BB.el({\r\n            content: 'As New Image',\r\n            css: optionStyle,\r\n        });\r\n\r\n        this.rootEl.append(wrapperEl);\r\n        wrapperEl.append(optionLayerEl, optionImageEl);\r\n\r\n\r\n        let rootCounter = 0;\r\n        let optionLayerCounter = 0;\r\n        let optionImageCounter = 0;\r\n\r\n        const destroy = () => {\r\n            rootCounter = 0;\r\n            optionLayerCounter = 0;\r\n            optionImageCounter = 0;\r\n            try {\r\n                p.target.removeChild(this.rootEl);\r\n            } catch (e) { }\r\n        };\r\n\r\n        /**\r\n         * check, can drop content be imported\r\n         */\r\n        const testAcceptType = (event: DragEvent): boolean => {\r\n            return !!event.dataTransfer && !event.dataTransfer.types.includes('text/plain');\r\n        };\r\n\r\n        const updateOptions = () => {\r\n            const boxShadow = '0 0 20px 4px #fff';\r\n            if (optionLayerCounter > 0) {\r\n                optionLayerEl.style.boxShadow = boxShadow;\r\n                optionImageEl.style.boxShadow = '';\r\n            } else if (optionImageCounter > 0) {\r\n                optionLayerEl.style.boxShadow = '';\r\n                optionImageEl.style.boxShadow = boxShadow;\r\n            } else {\r\n                optionLayerEl.style.boxShadow = '';\r\n                optionImageEl.style.boxShadow = '';\r\n            }\r\n        };\r\n\r\n        optionLayerEl.addEventListener('dragenter', () => {\r\n            optionLayerCounter++;\r\n            updateOptions();\r\n        });\r\n        optionLayerEl.addEventListener('dragleave', () => {\r\n            optionLayerCounter--;\r\n            updateOptions();\r\n        });\r\n        optionImageEl.addEventListener('dragenter', () => {\r\n            optionImageCounter++;\r\n            updateOptions();\r\n        });\r\n        optionImageEl.addEventListener('dragleave', () => {\r\n            optionImageCounter--;\r\n            updateOptions();\r\n        });\r\n\r\n\r\n        const rootDragOver = (event: DragEvent): void => {\r\n            if (!testAcceptType(event)) {\r\n                return;\r\n            }\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n        };\r\n\r\n        const rootDragEnter = (event: DragEvent): void => {\r\n            if (!p.enabledTest() || !testAcceptType(event)) {\r\n                return;\r\n            }\r\n            if (rootCounter === 0) {\r\n                p.target.append(this.rootEl);\r\n            }\r\n            rootCounter++;\r\n        };\r\n\r\n        const rootDragLeave = (event: DragEvent): void => {\r\n            if (!testAcceptType(event) || rootCounter === 0) {\r\n                return;\r\n            }\r\n            rootCounter = Math.max(0, rootCounter - 1);\r\n            if (rootCounter === 0) {\r\n                p.target.removeChild(this.rootEl);\r\n            }\r\n        };\r\n\r\n        const rootDrop = (event: DragEvent): void => {\r\n            if (!testAcceptType(event) || !event.dataTransfer || event.dataTransfer.files.length === 0) {\r\n                destroy();\r\n                return;\r\n            }\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n\r\n            let optionStr: TDropOption = 'default';\r\n            if (optionLayerCounter > 0) {\r\n                optionStr = 'layer';\r\n            } else if (optionImageCounter > 0) {\r\n                optionStr = 'image';\r\n            }\r\n\r\n            p.onDrop(event.dataTransfer.files, optionStr);\r\n\r\n\r\n            if (rootCounter > 0) {\r\n                p.target.removeChild(this.rootEl);\r\n            }\r\n            rootCounter = 0;\r\n            optionLayerCounter = 0;\r\n            optionImageCounter = 0;\r\n            updateOptions();\r\n        };\r\n\r\n        window.addEventListener('dragover', rootDragOver, false);\r\n        window.addEventListener('dragenter', rootDragEnter, false);\r\n        window.addEventListener('dragleave', rootDragLeave, false);\r\n        window.addEventListener('drop', rootDrop, false);\r\n\r\n        // if something goes wrong and you're stuck with overlay\r\n        this.rootEl.addEventListener('pointerdown', () => {\r\n            destroy();\r\n        });\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: (keyStr) => {\r\n                if (rootCounter > 0 && keyStr === 'esc') {\r\n                    destroy();\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {KlColorSliderSmall} from './kl-color-slider-small';\r\nimport {KlSlider} from './kl-slider';\r\nimport {BrushSettingService, TBrushSettingEmit} from '../../brushes-ui/brush-setting-service';\r\nimport {LANG} from '../../../language/language';\r\nimport {IRGB} from '../../kl-types';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\n\r\n/**\r\n * Compressed HUD toolspace. When you hold ctrl+alt.\r\n * small color picker, brush settings\r\n */\r\nexport class OverlayToolspace {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            brushSettingService: BrushSettingService; // to sync with outside\r\n            enabledTest: () => boolean; // calls to see if it's allowed to show\r\n        }\r\n    ) {\r\n        const sizeObj = {\r\n            width: 150,\r\n            svHeight: 90,\r\n            hHeight: 20,\r\n            sliderHeight: 25,\r\n        };\r\n\r\n        let isVisible = false;\r\n        this.rootEl = BB.el({\r\n            className: 'kl-overlay-toolspace',\r\n        });\r\n        const queuedObj: {\r\n            color: IRGB | null;\r\n            size: number | null;\r\n            opacity: number | null;\r\n        } = {\r\n            color: null,\r\n            size: null,\r\n            opacity: null,\r\n        };\r\n\r\n\r\n        // --- inputs ---\r\n\r\n        //color selection\r\n        const colorEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-overlay-toolspace__color',\r\n        });\r\n        const colorSlider = new KlColorSliderSmall({\r\n            width: sizeObj.width,\r\n            heightSV: sizeObj.svHeight,\r\n            heightH: sizeObj.hHeight,\r\n            color: p.brushSettingService.getColor(),\r\n            callback: (rgbObj: IRGB) => {\r\n                selectedColorEl.style.backgroundColor = 'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')';\r\n                p.brushSettingService.setColor(rgbObj, subscriptionFunc);\r\n            },\r\n        });\r\n        const selectedColorEl = BB.el({\r\n            css: {\r\n                width: sizeObj.width + 'px',\r\n                height: sizeObj.hHeight + 'px',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        {\r\n            const initialColor = p.brushSettingService.getColor();\r\n            selectedColorEl.style.backgroundColor = 'rgb(' + initialColor.r + ',' + initialColor.g + ',' + initialColor.b + ')';\r\n        }\r\n\r\n        colorEl.append(selectedColorEl, colorSlider.getElement());\r\n\r\n\r\n        const updateColor = (rgbObj: IRGB) => {\r\n            colorSlider.setColor(rgbObj);\r\n            selectedColorEl.style.backgroundColor = 'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')';\r\n        };\r\n\r\n\r\n\r\n        //brushsize slider\r\n\r\n        const sizeSlider = new KlSlider({\r\n            label: LANG('brush-size'),\r\n            width: sizeObj.width,\r\n            height: sizeObj.sliderHeight,\r\n            min: 0,\r\n            max: 500,\r\n            value: 50,\r\n            resolution: 225,\r\n            eventResMs: 1000 / 30,\r\n            toDisplayValue: (val) => val * 2,\r\n            toValue: (displayValue) => displayValue / 2,\r\n            onChange: (v) => {\r\n                p.brushSettingService.setSize(v);\r\n            },\r\n            formatFunc: (displayValue) => {\r\n                if (displayValue < 10) {\r\n                    return BB.round(displayValue, 1);\r\n                } else {\r\n                    return Math.round(displayValue);\r\n                }\r\n            },\r\n        });\r\n        BB.css(sizeSlider.getElement(), {\r\n            marginTop: '2px',\r\n        });\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: sizeObj.width,\r\n            height: sizeObj.sliderHeight,\r\n            min: 0,\r\n            max: 1,\r\n            value: 1,\r\n            resolution: 225,\r\n            eventResMs: 1000 / 30,\r\n            toDisplayValue: (val) => val * 100,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            onChange: (v) => {\r\n                p.brushSettingService.setOpacity(v);\r\n            },\r\n        });\r\n        BB.css(opacitySlider.getElement(), {\r\n            margin: '2px 0',\r\n        });\r\n        this.rootEl.append(sizeSlider.getElement(), opacitySlider.getElement());\r\n\r\n\r\n\r\n        // --- general setup ---\r\n\r\n        const subscriptionFunc = (event: TBrushSettingEmit) => {\r\n            if (event.type === 'color') {\r\n                if (!isVisible) {\r\n                    queuedObj.color = event.value;\r\n                } else {\r\n                    updateColor(event.value);\r\n                }\r\n            }\r\n            if (event.type === 'size') {\r\n                if (!isVisible) {\r\n                    queuedObj.size = event.value;\r\n                } else {\r\n                    sizeSlider.setValue(event.value);\r\n                }\r\n            }\r\n            if (event.type === 'opacity') {\r\n                if (!isVisible) {\r\n                    queuedObj.opacity = event.value;\r\n                } else {\r\n                    opacitySlider.setValue(event.value);\r\n                }\r\n            }\r\n            if (event.type === 'sliderConfig') {\r\n                sizeSlider.update(event.value.sizeSlider);\r\n                opacitySlider.update(event.value.opacitySlider);\r\n            }\r\n        };\r\n        p.brushSettingService.subscribe(subscriptionFunc);\r\n        {\r\n            const sliderConfig = p.brushSettingService.getSliderConfig();\r\n            sizeSlider.update(sliderConfig.sizeSlider);\r\n            opacitySlider.update(sliderConfig.opacitySlider);\r\n            sizeSlider.setValue(p.brushSettingService.getSize());\r\n            opacitySlider.setValue(p.brushSettingService.getOpacity());\r\n        }\r\n\r\n        const updateUI = () => {\r\n\r\n            // unfocus manual slider input\r\n            BB.unfocusAnyInput();\r\n\r\n            this.rootEl.style.display = isVisible ? 'block' : 'none';\r\n            if (isVisible && mousePos) {\r\n                BB.css(this.rootEl, {\r\n                    left: (mousePos.x - Math.round(sizeObj.width / 2)) + 'px',\r\n                    top: (mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2)) + 'px',\r\n                });\r\n            }\r\n        };\r\n\r\n        let mousePos: IVector2D | null = null;\r\n        document.addEventListener('pointermove', (event) => {\r\n            mousePos = {\r\n                x: event.pageX,\r\n                y: event.pageY,\r\n            };\r\n        });\r\n\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr, isRepeat) => {\r\n                if (isRepeat) {\r\n                    return;\r\n                }\r\n                if (isVisible) {\r\n                    isVisible = false;\r\n                    updateUI();\r\n                    return;\r\n                }\r\n\r\n                if (!p.enabledTest() || !mousePos) {\r\n                    return;\r\n                }\r\n\r\n                if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    isVisible = true;\r\n\r\n                    if (queuedObj.color !== null) {\r\n                        updateColor(queuedObj.color);\r\n                        queuedObj.color = null;\r\n                    }\r\n                    if (queuedObj.size !== null) {\r\n                        sizeSlider.setValue(queuedObj.size);\r\n                        queuedObj.size = null;\r\n                    }\r\n                    if (queuedObj.opacity !== null) {\r\n                        opacitySlider.setValue(queuedObj.opacity);\r\n                        queuedObj.opacity = null;\r\n                    }\r\n\r\n                    updateUI();\r\n                }\r\n\r\n            },\r\n            onUp: (keyStr, event, oldComboStr) => {\r\n                if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(oldComboStr) && isVisible) {\r\n                    isVisible = false;\r\n                    colorSlider.end();\r\n                    updateUI();\r\n                }\r\n            },\r\n            onBlur: () => {\r\n                if (isVisible) {\r\n                    isVisible = false;\r\n                    colorSlider.end();\r\n                    updateUI();\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport klecksLogoImg from '/src/app/img/klecks-logo.png';\r\nimport newImageImg from '/src/app/img/ui/new-image.svg';\r\nimport importImg from '/src/app/img/ui/import.svg';\r\nimport exportImg from '/src/app/img/ui/export.svg';\r\nimport shareImg from '/src/app/img/ui/share.svg';\r\nimport helpImg from '/src/app/img/ui/help.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n\r\n/**\r\n * Topmost row of buttons in toolspace (with the app logo)\r\n */\r\nexport class ToolspaceTopRow {\r\n    \r\n    private readonly rootEl: HTMLElement;\r\n    \r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            logoImg: string;\r\n            onLogo: () => void;\r\n            onNew: () => void;\r\n            onImport: () => void;\r\n            onSave: () => void;\r\n            onShare: () => void;\r\n            onHelp: () => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-toolspace-row',\r\n            css: {\r\n                height: '36px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        function createButton (\r\n            p: {\r\n                onClick: () => void;\r\n                title: string;\r\n                image: string;\r\n                contain: boolean;\r\n                extraPadding?: number;\r\n                darkInvert?: boolean;\r\n            }\r\n        ): {\r\n            el: HTMLElement;\r\n            pointerListener: PointerListener;\r\n        } {\r\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n            const el = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.contain ? padding + 'px 0' : '',\r\n                },\r\n            });\r\n            const im = BB.el({\r\n                className: p.darkInvert ? 'dark-invert' : undefined,\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundPosition: 'center',\r\n                    backgroundSize: p.contain ? 'contain' : '',\r\n                    //filter: 'grayscale(1)',\r\n                    height: '100%',\r\n                },\r\n            });\r\n            im.style.pointerEvents = 'none';\r\n            el.append(im);\r\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: el,\r\n                onEnterLeave: function (isOver) {\r\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\r\n                },\r\n            });\r\n            return {\r\n                el,\r\n                pointerListener,\r\n            };\r\n        }\r\n\r\n        const logoButton = createButton({\r\n            onClick: p.onLogo,\r\n            title: LANG('home'),\r\n            image: p.logoImg ? p.logoImg : klecksLogoImg,\r\n            contain: true,\r\n            darkInvert: true,\r\n        });\r\n        logoButton.el.classList.add('kl-tool-row-border-right');\r\n        BB.css(logoButton.el, {\r\n            width: '45px',\r\n        });\r\n        const newButton = createButton({\r\n            onClick: p.onNew,\r\n            title: LANG('file-new'),\r\n            image: newImageImg,\r\n            extraPadding: 1,\r\n            contain: true,\r\n        });\r\n        const importButton = createButton({\r\n            onClick: p.onImport,\r\n            title: LANG('file-import'),\r\n            image: importImg,\r\n            extraPadding: 1,\r\n            contain: true,\r\n        });\r\n        const saveButton = createButton({\r\n            onClick: p.onSave,\r\n            title: LANG('file-save'),\r\n            image: exportImg,\r\n            extraPadding: 1,\r\n            contain: true,\r\n        });\r\n\r\n        let shareButton = null;\r\n        if (BB.canShareFiles()) {\r\n            shareButton = createButton({\r\n                onClick: p.onShare,\r\n                title: LANG('file-share'),\r\n                image: shareImg,\r\n                contain: true,\r\n                darkInvert: true,\r\n            });\r\n        }\r\n        const helpButton = createButton({\r\n            onClick: p.onHelp,\r\n            title: LANG('help'),\r\n            image: helpImg,\r\n            contain: true,\r\n            darkInvert: true,\r\n        });\r\n\r\n        BB.append(this.rootEl, [\r\n            logoButton.el,\r\n            newButton.el,\r\n            importButton.el,\r\n            saveButton.el,\r\n            shareButton ? shareButton.el : undefined,\r\n            helpButton.el,\r\n        ]);\r\n    }\r\n    \r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6Sfz2\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eaJmh\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kV8IH\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"SROeX\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"lFrok\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cvYlU\");","import {BB} from '../../../bb/bb';\r\nimport {dialogCounter} from '../modals/modal-count';\r\nimport toolPaintImg from '/src/app/img/ui/tool-paint.svg';\r\nimport toolFillImg from '/src/app/img/ui/tool-fill.svg';\r\nimport toolGradientImg from '/src/app/img/ui/tool-gradient.svg';\r\nimport toolTextImg from '/src/app/img/ui/tool-text.svg';\r\nimport toolShapeImg from '/src/app/img/ui/tool-shape.svg';\r\nimport caretDownImg from '/src/app/img/ui/caret-down.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {TToolType} from '../../kl-types';\r\n\r\n\r\ntype TDropdownButton = {\r\n    wrapper: HTMLElement;\r\n    show: (b: boolean) => void;\r\n    setIsSmall: (b: boolean) => void;\r\n};\r\n\r\n/**\r\n * Toolrow Dropdown. The button where you select: brush, fill, select, transform, etc.\r\n */\r\nexport class ToolDropdown {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly activeButton: HTMLElement;\r\n    private readonly smallMargin: string = '6px 0';\r\n    private readonly optionArr: TToolType[] = ['draw', 'fill', 'gradient', 'text', 'shape'];\r\n    private readonly dropdownBtnArr: TDropdownButton[];\r\n    private readonly arrowButton: HTMLElement;\r\n    private isActive: boolean;\r\n    private currentActiveIndex: number;\r\n    private readonly titleArr: string[];\r\n    private activeButtonIm: HTMLElement;\r\n    private readonly imArr;\r\n\r\n    private updateButton () {\r\n        this.activeButton.title = this.titleArr[this.currentActiveIndex];\r\n        this.activeButtonIm.style.backgroundImage = 'url(\\'' + this.imArr[this.currentActiveIndex] + '\\')';\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onChange: (activeStr: TToolType) => void;\r\n        }\r\n    ) {\r\n        this.imArr = [\r\n            toolPaintImg,\r\n            toolFillImg,\r\n            toolGradientImg,\r\n            toolTextImg,\r\n            toolShapeImg,\r\n        ];\r\n        this.titleArr = [\r\n            `${LANG('tool-brush')} [B]`,\r\n            `${LANG('tool-paint-bucket')} [G]`,\r\n            `${LANG('tool-gradient')} [G]`,\r\n            `${LANG('tool-text')} [T]`,\r\n            `${LANG('tool-shape')} [U]`,\r\n        ];\r\n        this.currentActiveIndex = 0;\r\n        this.isActive = true;\r\n        let isOpen = false;\r\n\r\n        //preload images\r\n        setTimeout(() => {\r\n            for (let i = 1; i < this.imArr.length; i++) {\r\n                const im = new Image();\r\n                im.src = this.imArr[i];\r\n            }\r\n        }, 100);\r\n\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n\r\n        let openTimeout: ReturnType<typeof setTimeout>;\r\n        let isDragging = false;\r\n        let startX: number;\r\n        let startY: number;\r\n        let pointerListener;\r\n        if (BB.hasPointerEvents) {\r\n            pointerListener = new BB.PointerListener({\r\n                target: this.rootEl,\r\n                onPointer: (event) => {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (isOpen) {\r\n                            return;\r\n                        }\r\n\r\n                        openTimeout = setTimeout(() => {\r\n                            showDropdown();\r\n                        }, 400);\r\n                        isDragging = true;\r\n                        startX = event.pageX;\r\n                        startY = event.pageY;\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        if (isDragging && !isOpen && BB.dist(startX, startY, event.pageX, event.pageY) > 5) {\r\n                            clearTimeout(openTimeout);\r\n                            showDropdown();\r\n                        }\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        clearTimeout(openTimeout);\r\n                        if (isOpen && isDragging) {\r\n                            const target = document.elementFromPoint(event.pageX, event.pageY);\r\n                            for (let i = 0; i < this.dropdownBtnArr.length; i++) {\r\n                                if (target === this.dropdownBtnArr[i].wrapper) {\r\n                                    closeDropdown();\r\n                                    this.isActive = true;\r\n                                    this.currentActiveIndex = i;\r\n                                    this.updateButton();\r\n                                    p.onChange(this.optionArr[this.currentActiveIndex]);\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                        isDragging = false;\r\n                    }\r\n                },\r\n            });\r\n        }\r\n\r\n        this.activeButton = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'toolspace-row-button nohighlight toolspace-row-button-activated',\r\n            title: this.titleArr[this.currentActiveIndex],\r\n            onClick: (e) => {\r\n                if (this.isActive && !isOpen) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    showDropdown();\r\n                    return;\r\n                }\r\n\r\n                this.isActive = true;\r\n                p.onChange(this.optionArr[this.currentActiveIndex]);\r\n                if (isOpen) {\r\n                    closeDropdown();\r\n                }\r\n            },\r\n            css: {\r\n                padding: '10px 0',\r\n                pointerEvents: 'auto',\r\n                height: '100%',\r\n                boxSizing: 'border-box',\r\n            },\r\n        });\r\n\r\n        this.activeButtonIm = BB.el({\r\n            parent: this.activeButton,\r\n            className: 'dark-invert',\r\n            css: {\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: 'contain',\r\n                width: 'calc(100% - 7px)',\r\n                height: '100%',\r\n                pointerEvents: 'none',\r\n                opacity: '0.75',\r\n            },\r\n        });\r\n\r\n        this.arrowButton = BB.el({\r\n            parent: this.activeButton,\r\n            className: 'dark-invert',\r\n            css: {\r\n                position: 'absolute',\r\n                right: '1px',\r\n                bottom: '1px',\r\n                width: '18px',\r\n                height: '18px',\r\n                //background: '#aaa',\r\n                //borderRadius: '2px',\r\n                cursor: 'pointer',\r\n\r\n                backgroundImage: 'url(\\'' + caretDownImg + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: '60%',\r\n            },\r\n            title: 'More Tools',\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                showDropdown();\r\n            },\r\n        });\r\n\r\n\r\n        const overlay = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                //background: 'rgba(255,0,0,0.5)',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n            },\r\n        });\r\n        const overlayPointerListener = new BB.PointerListener({\r\n            target: overlay,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    e.eventPreventDefault();\r\n                    closeDropdown();\r\n                }\r\n            },\r\n        });\r\n\r\n        const dropdownWrapper = BB.el({\r\n            className: 'tool-dropdown-wrapper',\r\n            css: {\r\n                position: 'absolute',\r\n                width: '100%',\r\n                height: (100 * (this.optionArr.length - 1)) + '%',\r\n                top: '100%',\r\n                left: '0',\r\n                zIndex: '1',\r\n                boxSizing: 'border-box',\r\n                cursor: 'pointer',\r\n                transition: 'height 0.1s ease-in-out, opacity 0.1s ease-in-out',\r\n                borderBottomLeftRadius: '5px',\r\n                borderBottomRightRadius: '5px',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n        this.dropdownBtnArr = [];\r\n\r\n        const createDropdownButton = (\r\n            p: {\r\n                index: number;\r\n                id: TToolType;\r\n                image: string;\r\n                title: string;\r\n                onClick: (index: number) => void;\r\n            }\r\n        ): TDropdownButton => {\r\n            const wrapper = BB.el({\r\n                parent: dropdownWrapper,\r\n                className: 'tool-dropdown-button',\r\n                title: p.title,\r\n                css: {\r\n                    padding: '10px 0',\r\n                    height: (100 / (this.optionArr.length - 1)) + '%',\r\n                    boxSizing: 'border-box',\r\n                },\r\n                onClick: (e) => {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    p.onClick(p.index);\r\n                },\r\n            });\r\n\r\n            BB.el({\r\n                parent: wrapper,\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundPosition: 'center',\r\n                    backgroundSize: 'contain',\r\n                    height: '100%',\r\n                    pointerEvents: 'none',\r\n                    opacity: '0.75',\r\n                },\r\n            });\r\n\r\n            // --- interface ---\r\n            const show = (b: boolean) => {\r\n                wrapper.style.display = b ? 'block' : 'none';\r\n            };\r\n\r\n            const setIsSmall = (b: boolean) => {\r\n                wrapper.style.padding = b ? this.smallMargin : '10px 0';\r\n            };\r\n\r\n            return {\r\n                wrapper,\r\n                show,\r\n                setIsSmall,\r\n            };\r\n        };\r\n\r\n        const onClickDropdownBtn = (index: number) => {\r\n            closeDropdown();\r\n\r\n            this.isActive = true;\r\n            this.currentActiveIndex = index;\r\n\r\n            this.updateButton();\r\n\r\n            p.onChange(this.optionArr[this.currentActiveIndex]);\r\n        };\r\n\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            this.dropdownBtnArr.push(createDropdownButton({\r\n                index: i,\r\n                id: this.optionArr[i],\r\n                image: this.imArr[i],\r\n                title: this.titleArr[i],\r\n                onClick: onClickDropdownBtn,\r\n            }));\r\n        }\r\n\r\n        const showDropdown = () => {\r\n            dialogCounter.increase(0.5);\r\n            isOpen = true;\r\n\r\n            for (let i = 0; i < this.optionArr.length; i++) {\r\n                this.dropdownBtnArr[i].show(this.currentActiveIndex !== i);\r\n            }\r\n\r\n            this.arrowButton.style.display = 'none';\r\n            this.rootEl.style.zIndex = '1';\r\n            document.body.append(overlay);\r\n            this.rootEl.append(dropdownWrapper);\r\n        };\r\n\r\n        const closeDropdown = () => {\r\n            dialogCounter.decrease(0.5);\r\n            isOpen = false;\r\n            this.arrowButton.style.removeProperty('display');\r\n            this.rootEl.style.removeProperty('z-index');\r\n            document.body.removeChild(overlay);\r\n\r\n            this.rootEl.removeChild(dropdownWrapper);\r\n        };\r\n\r\n        this.updateButton();\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    setIsSmall (b: boolean): void {\r\n        this.activeButton.style.padding = b ? this.smallMargin : '10px 0';\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            this.dropdownBtnArr[i].setIsSmall(b);\r\n        }\r\n        if (b) {\r\n            this.arrowButton.style.width = '14px';\r\n            this.arrowButton.style.height = '14px';\r\n        } else {\r\n            this.arrowButton.style.width = '18px';\r\n            this.arrowButton.style.height = '18px';\r\n        }\r\n    }\r\n\r\n    setActive (activeStr: TToolType): void {\r\n        if (this.optionArr.includes(activeStr)) {\r\n            this.isActive = true;\r\n            for (let i = 0; i < this.optionArr.length; i++) {\r\n                if (this.optionArr[i] === activeStr) {\r\n                    this.currentActiveIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n            this.activeButton.classList.add('toolspace-row-button-activated');\r\n            this.updateButton();\r\n        } else {\r\n            this.isActive = false;\r\n            this.activeButton.classList.remove('toolspace-row-button-activated');\r\n        }\r\n    }\r\n\r\n    getActive (): TToolType {\r\n        return this.optionArr[this.currentActiveIndex];\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dW3eU\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fnumN\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6J8A8\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"da34V\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eStsa\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eW5wL\");","import {BB} from '../../../bb/bb';\r\nimport {ToolDropdown} from './tool-dropdown';\r\nimport toolHandImg from '/src/app/img/ui/tool-hand.svg';\r\nimport toolZoomInImg from '/src/app/img/ui/tool-zoom-in.svg';\r\nimport toolZoomOutImg from '/src/app/img/ui/tool-zoom-out.svg';\r\nimport toolUndoImg from '/src/app/img/ui/tool-undo.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {TToolType} from '../../kl-types';\r\n\r\n\r\ntype TBaseToolRowButton = {\r\n    el: HTMLElement;\r\n};\r\n\r\ntype TToolRowButton = TBaseToolRowButton & {\r\n    pointerListener: PointerListener;\r\n    setIsSmall: (b: boolean) => void;\r\n};\r\n\r\ntype TToolRowTriangleButton = TBaseToolRowButton & {\r\n    setIsEnabledLeft: (b: boolean) => void;\r\n    setIsEnabledRight: (b: boolean) => void;\r\n    leftPointerListener: PointerListener;\r\n    rightPointerListener: PointerListener;\r\n};\r\n\r\n/**\r\n * Row of buttons in toolspace. image-operations (draw, hand), zoom, undo/redo\r\n * Need to do syncing. So tool is correct, and zoom/undo/redo buttons are properly enabled/disabled\r\n * heights: 54px tall, 36px small -> via setIsSmall\r\n */\r\nexport class ToolspaceToolRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly toolDropdown: ToolDropdown;\r\n    private readonly handButton: TToolRowButton;\r\n    private readonly zoomInButton: TToolRowButton;\r\n    private readonly zoomOutButton: TToolRowButton;\r\n    private readonly undoButton: TToolRowButton;\r\n    private readonly redoButton: TToolRowButton;\r\n    private readonly zoomInNOutButton: TToolRowTriangleButton;\r\n    private readonly undoNRedoButton: TToolRowTriangleButton;\r\n    private currentActiveStr: TToolType;\r\n    private readonly onActivate: (activeStr: TToolType) => void;\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            onActivate: (activeStr: TToolType) => void; // clicking on tool button - activating it\r\n            onZoomIn: () => void;\r\n            onZoomOut: () => void;\r\n            onUndo: () => void;\r\n            onRedo: () => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el( {\r\n            className: 'kl-toolspace-row',\r\n            css: {\r\n                height: '54px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        this.onActivate = p.onActivate;\r\n        this.currentActiveStr = 'draw'; // 'draw' | 'hand' | 'fill'\r\n\r\n\r\n        const createButton = (p: {\r\n            onClick: () => void;\r\n            image: string;\r\n            contain: boolean;\r\n            doLighten?: boolean;\r\n            doMirror?: boolean;\r\n        }): TToolRowButton => {\r\n\r\n            const smallMargin = p.doLighten ? '6px 0' : '8px 0';\r\n\r\n            const el = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                //title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.contain ? '10px 0' : '',\r\n                },\r\n            });\r\n            const im = BB.el({\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundPosition: 'center',\r\n                    backgroundSize: p.contain ? 'contain' : '',\r\n                    //filter: 'grayscale(1)',\r\n                    height: '100%',\r\n                    transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                    pointerEvents: 'none',\r\n                    opacity: p.doLighten ? '0.75' : '1',\r\n                },\r\n            });\r\n            el.append(im);\r\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: el,\r\n                onEnterLeave: (isOver) => {\r\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\r\n                },\r\n            });\r\n            const setIsSmall = (b: boolean) => {\r\n                el.style.padding = p.contain ? (b ? smallMargin : '10px 0') : '';\r\n            };\r\n            return {\r\n                el,\r\n                pointerListener,\r\n                setIsSmall,\r\n            };\r\n        };\r\n\r\n\r\n        const createTriangleButton = (p: {\r\n            onLeft: () => void;\r\n            onRight: () => void;\r\n            leftImage: string;\r\n            rightImage: string | null;\r\n        }): TToolRowTriangleButton => { // because IE and Edge don't support clip path\r\n\r\n            const result = BB.el({\r\n                css: {\r\n                    flexGrow: '1',\r\n                    position: 'relative',\r\n                },\r\n            });\r\n\r\n            const svg = BB.createSvg({\r\n                elementType: 'svg',\r\n                width: '67px', // can't think of a way doing with percentage\r\n                height: '54px',\r\n                viewBox: '0 0 100 100',\r\n                preserveAspectRatio: 'none',\r\n            });\r\n            BB.css(svg, {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n            });\r\n\r\n            const blurRadius = 10;\r\n            const blurOffsetX = 2;\r\n            const blurOffsetY = 2;\r\n\r\n            const defs = BB.createSvg( { // inset shadow via svg\r\n                elementType: 'defs',\r\n                childrenArr: [\r\n                    {\r\n                        elementType: 'filter',\r\n                        id: 'innershadow',\r\n                        x0: '-50%',\r\n                        y0: '-50%',\r\n                        width: '200%',\r\n                        height: '200%',\r\n                        childrenArr: [\r\n                            {\r\n                                elementType: 'feGaussianBlur',\r\n                                in: 'SourceAlpha',\r\n                                stdDeviation: '' + blurRadius,\r\n                                result: 'blur',\r\n                            }, {\r\n                                elementType: 'feOffset',\r\n                                dx: '' + blurOffsetX,\r\n                                dy: '' + blurOffsetY,\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'SourceAlpha',\r\n                                operator: 'arithmetic',\r\n                                k2: '-1',\r\n                                k3: '1',\r\n                                result: 'shadowDiff',\r\n                            },\r\n\r\n                            {\r\n                                elementType: 'feFlood',\r\n                                'flood-color': '#000',\r\n                                'flood-opacity': '0.2',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'shadowDiff',\r\n                                operator: 'in',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'SourceGraphic',\r\n                                operator: 'over',\r\n                                result: 'firstfilter',\r\n                            },\r\n\r\n                            {\r\n                                elementType: 'feGaussianBlur',\r\n                                in: 'firstfilter',\r\n                                stdDeviation: '' + blurRadius,\r\n                                result: 'blur2',\r\n                            }, {\r\n                                elementType: 'feOffset',\r\n                                dx: '' + blurOffsetX,\r\n                                dy: '' + blurOffsetY,\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'firstfilter',\r\n                                operator: 'arithmetic',\r\n                                k2: '-1',\r\n                                k3: '1',\r\n                                result: 'shadowDiff',\r\n                            },\r\n\r\n                            {\r\n                                elementType: 'feFlood',\r\n                                'flood-color': '#000',\r\n                                'flood-opacity': '0.2',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'shadowDiff',\r\n                                operator: 'in',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'firstfilter',\r\n                                operator: 'over',\r\n                            },\r\n                        ],\r\n                    },\r\n                ],\r\n            });\r\n\r\n\r\n            const svgTriangleLeft = BB.createSvg({\r\n                elementType: 'path',\r\n                'vector-effect': 'non-scaling-stroke',\r\n                d: 'M0,0 L 100,0 0,100 z',\r\n                fill: 'rgba(0,0,0,0)',\r\n                class: 'toolspace-svg-triangle-button',\r\n            });\r\n            svgTriangleLeft.onclick = () => {\r\n                p.onLeft();\r\n                svgTriangleLeft.classList.remove('toolspace-svg-triangle-button-hover');\r\n            };\r\n\r\n            const svgTriangleRight = BB.createSvg({\r\n                elementType: 'path',\r\n                'vector-effect': 'non-scaling-stroke',\r\n                d: 'M100,100 L 100,0 0,100 z',\r\n                fill: 'rgba(0,0,0,0)',\r\n                class: 'toolspace-svg-triangle-button',\r\n            });\r\n            svgTriangleRight.onclick = () => {\r\n                p.onRight();\r\n                svgTriangleRight.classList.remove('toolspace-svg-triangle-button-hover');\r\n            };\r\n\r\n            // because :hover causes problems w touch\r\n            const leftPointerListener = new BB.PointerListener({\r\n                target: svgTriangleLeft,\r\n                onEnterLeave: (isOver) => {\r\n                    svgTriangleLeft.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n                },\r\n            });\r\n            const rightPointerListener = new BB.PointerListener({\r\n                target: svgTriangleRight,\r\n                onEnterLeave: (isOver) => {\r\n                    svgTriangleRight.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n                },\r\n            });\r\n\r\n\r\n            svg.append(defs, svgTriangleLeft, svgTriangleRight);\r\n            result.append(svg);\r\n\r\n\r\n            const leftIm = BB.el({\r\n                parent: result,\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundSize: 'contain',\r\n                    width: '20px',\r\n                    height: '20px',\r\n                    position: 'absolute',\r\n                    left: '10px',\r\n                    top: '8px',\r\n                    //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                    pointerEvents: 'none',\r\n                },\r\n            });\r\n            result.append(leftIm);\r\n\r\n\r\n            const rightIm = BB.el({\r\n                parent: result,\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundSize: 'contain',\r\n                    width: '20px',\r\n                    height: '20px',\r\n                    position: 'absolute',\r\n                    right: '10px',\r\n                    bottom: '8px',\r\n                    transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                    pointerEvents: 'none',\r\n                },\r\n            });\r\n\r\n\r\n\r\n\r\n\r\n            const setIsEnabledLeft = (b: boolean) => {\r\n                svgTriangleLeft.classList.toggle('toolspace-row-button-disabled', !b);\r\n                leftIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n            };\r\n\r\n            const setIsEnabledRight = (b: boolean) => {\r\n                svgTriangleRight.classList.toggle('toolspace-row-button-disabled', !b);\r\n                rightIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n            };\r\n\r\n            return {\r\n                el: result,\r\n                setIsEnabledLeft,\r\n                setIsEnabledRight,\r\n                leftPointerListener,\r\n                rightPointerListener,\r\n            };\r\n        };\r\n\r\n        this.toolDropdown = new ToolDropdown({\r\n            onChange: (activeStr) => {\r\n                this.setActive(activeStr, true);\r\n            },\r\n        });\r\n        this.rootEl.append(this.toolDropdown.getElement());\r\n\r\n        this.handButton = createButton({\r\n            onClick: () => {\r\n                this.setActive('hand', true);\r\n            },\r\n            image: toolHandImg,\r\n            contain: true,\r\n            doLighten: true,\r\n        });\r\n        this.handButton.el.classList.add('kl-tool-row-border-right');\r\n        this.handButton.el.title = LANG('tool-hand');\r\n        this.rootEl.append(this.handButton.el);\r\n\r\n        this.zoomInNOutButton = createTriangleButton({\r\n            onLeft: p.onZoomIn,\r\n            onRight: p.onZoomOut,\r\n            leftImage: toolZoomInImg,\r\n            rightImage: toolZoomOutImg,\r\n        });\r\n        this.zoomInNOutButton.el.title = LANG('tool-zoom');\r\n        this.rootEl.append(this.zoomInNOutButton.el);\r\n\r\n        this.zoomInButton = createButton({\r\n            onClick: p.onZoomIn,\r\n            image: toolZoomInImg,\r\n            contain: true,\r\n        });\r\n        this.zoomInButton.el.title = LANG('zoom-in');\r\n        this.rootEl.append(this.zoomInButton.el);\r\n\r\n        this.zoomOutButton = createButton({\r\n            onClick: p.onZoomOut,\r\n            image: toolZoomOutImg,\r\n            contain: true,\r\n        });\r\n        this.zoomOutButton.el.title = LANG('zoom-out');\r\n        this.rootEl.append(this.zoomOutButton.el);\r\n\r\n        this.undoNRedoButton = createTriangleButton({\r\n            onLeft: p.onUndo,\r\n            onRight: p.onRedo,\r\n            leftImage: toolUndoImg,\r\n            rightImage: null,\r\n        });\r\n        this.undoNRedoButton.el.title = LANG('undo') + '/' + LANG('redo');\r\n        this.undoNRedoButton.setIsEnabledLeft(false);\r\n        this.undoNRedoButton.setIsEnabledRight(false);\r\n        this.rootEl.append(this.undoNRedoButton.el);\r\n\r\n        this.undoButton = createButton({\r\n            onClick: p.onUndo,\r\n            image: toolUndoImg,\r\n            contain: true,\r\n        });\r\n        this.undoButton.el.title = LANG('undo');\r\n        this.undoButton.el.classList.add('toolspace-row-button-disabled');\r\n        this.rootEl.append(this.undoButton.el);\r\n\r\n        this.redoButton = createButton({\r\n            onClick: p.onRedo,\r\n            image: toolUndoImg,\r\n            contain: true,\r\n            doMirror: true,\r\n        });\r\n        this.redoButton.el.title = LANG('redo');\r\n        this.redoButton.el.classList.add('toolspace-row-button-disabled');\r\n        this.rootEl.append(this.redoButton.el);\r\n\r\n        this.zoomInButton.el.style.display = 'none';\r\n        this.zoomOutButton.el.style.display = 'none';\r\n        this.undoButton.el.style.display = 'none';\r\n        this.redoButton.el.style.display = 'none';\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsSmall (b: boolean): void {\r\n        BB.css(this.rootEl, {\r\n            height: b ? '36px' : '54px',\r\n        });\r\n\r\n        this.toolDropdown.setIsSmall(b);\r\n        this.handButton.setIsSmall(b);\r\n        this.zoomInButton.setIsSmall(b);\r\n        this.zoomOutButton.setIsSmall(b);\r\n        this.undoButton.setIsSmall(b);\r\n        this.redoButton.setIsSmall(b);\r\n\r\n        if (b) {\r\n            this.zoomInNOutButton.el.style.display = 'none';\r\n            this.undoNRedoButton.el.style.display = 'none';\r\n            this.zoomInButton.el.style.display = 'block';\r\n            this.zoomOutButton.el.style.display = 'block';\r\n            this.undoButton.el.style.display = 'block';\r\n            this.redoButton.el.style.display = 'block';\r\n        } else {\r\n            this.zoomInNOutButton.el.style.display = 'block';\r\n            this.undoNRedoButton.el.style.display = 'block';\r\n            this.zoomInButton.el.style.display = 'none';\r\n            this.zoomOutButton.el.style.display = 'none';\r\n            this.undoButton.el.style.display = 'none';\r\n            this.redoButton.el.style.display = 'none';\r\n        }\r\n\r\n    }\r\n\r\n    setEnableZoomIn (b: boolean): void {\r\n        this.zoomInButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.zoomInNOutButton.setIsEnabledLeft(b);\r\n    }\r\n\r\n    setEnableZoomOut (b: boolean): void {\r\n        this.zoomOutButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.zoomInNOutButton.setIsEnabledRight(b);\r\n    }\r\n\r\n    setEnableUndo (b: boolean): void {\r\n        this.undoButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.undoNRedoButton.setIsEnabledLeft(b);\r\n    }\r\n\r\n    setEnableRedo (b: boolean): void {\r\n        this.redoButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.undoNRedoButton.setIsEnabledRight(b);\r\n    }\r\n\r\n    setActive (activeStr: TToolType, doEmit?: boolean): void {\r\n        if (this.currentActiveStr === activeStr) {\r\n            return;\r\n        }\r\n\r\n        this.currentActiveStr = activeStr;\r\n\r\n        this.toolDropdown.setActive(this.currentActiveStr);\r\n        this.handButton.el.classList.toggle('toolspace-row-button-activated', this.currentActiveStr === 'hand');\r\n\r\n        if (doEmit) {\r\n            this.onActivate(this.currentActiveStr);\r\n        }\r\n    }\r\n\r\n    getActive (): TToolType {\r\n        return this.currentActiveStr;\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"b30IN\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"jYhj7\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"44EC1\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1YnIA\");","import {BB} from '../../../bb/bb';\r\nimport {Select} from './select';\r\nimport {LANG} from '../../../language/language';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n/**\r\n * Ui to select stabilizer level. 4 options. returned as 0-3\r\n */\r\nexport class ToolspaceStabilizerRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly pointerListener: PointerListener;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            smoothing: number; // initial level [0,3]\r\n            onSelect: (level: number) => void; // [0-3], when level changes\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            tagName: 'label',\r\n            className: 'kl-stabilizer',\r\n            content: LANG('stabilizer') + '&nbsp;',\r\n            title: LANG('stabilizer-title'),\r\n        });\r\n\r\n        const strengthSelect = new Select({\r\n            optionArr: [\r\n                ['0', '0'],\r\n                ['1', '1'],\r\n                ['2', '2'],\r\n                ['3', '3'],\r\n                ['4', '4'],\r\n                ['5', '5'],\r\n            ],\r\n            initValue: '' + p.smoothing,\r\n            onChange: function (val) {\r\n                p.onSelect(parseInt(val));\r\n            },\r\n        });\r\n        this.rootEl.append(strengthSelect.getElement());\r\n\r\n        this.pointerListener = new BB.PointerListener({\r\n            target: this.rootEl,\r\n            onWheel: function (e) {\r\n                strengthSelect.setDeltaValue(e.deltaY);\r\n            },\r\n        });\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport invertedBorderImg from '/src/app/img/ui/inverted-border.svg';\r\nimport {IKeyStringOptional} from '../../../bb/bb-types';\r\n\r\n\r\n// type all functions\r\n\r\n\r\ntype TTabInit = {\r\n    id: string; // e.g. 'draw',\r\n    label?: string;\r\n    image?: string; // background image\r\n    title?: string;\r\n    isVisible?: boolean; // default is true\r\n    onOpen: () => void;\r\n    onClose: () => void;\r\n    css?: IKeyStringOptional;\r\n};\r\n\r\ntype TTab = {\r\n    id: string;\r\n    isVisible: boolean;\r\n    onOpen: () => void;\r\n    onClose: () => void;\r\n    update: (activeTab: TTab) => void;\r\n    el: HTMLElement;\r\n};\r\n\r\n\r\n/**\r\n * row of tabs. uses css class .tabrow__tab\r\n */\r\nexport class TabRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly tabArr: TTab[];\r\n    private activeTab: TTab;\r\n    private readonly roundRight: HTMLElement;\r\n    private readonly roundLeft: HTMLElement;\r\n    \r\n    \r\n    // update\r\n    update (): void {\r\n        for (let i = 0; i < this.tabArr.length; i++) {\r\n            this.tabArr[i].update(this.activeTab);\r\n        }\r\n    }\r\n    \r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            initialId: string; // e.g. 'draw'\r\n            useAccent?: boolean;\r\n            tabArr: TTabInit[];\r\n        }\r\n    ) {\r\n        const height = 35;\r\n        this.rootEl = BB.el({\r\n            className: 'tabrow',\r\n            css: {\r\n                height: height + 'px',\r\n            },\r\n        });\r\n\r\n        this.tabArr = []; //creates its own internal arr\r\n\r\n        const roundSize = 10;\r\n        this.roundRight = BB.el({\r\n            css: {\r\n                width: roundSize + 'px',\r\n                height: roundSize + 'px',\r\n                backgroundImage: `url('${invertedBorderImg}')`,\r\n                backgroundSize: 'cover',\r\n                position: 'absolute',\r\n                right: -roundSize + 'px',\r\n                bottom: '0',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        this.roundLeft = BB.el({\r\n            css: {\r\n                width: roundSize + 'px',\r\n                height: roundSize + 'px',\r\n                backgroundImage: `url('${invertedBorderImg}')`,\r\n                backgroundSize: 'cover',\r\n                position: 'absolute',\r\n                left: -roundSize + 'px',\r\n                bottom: '0',\r\n                transform: 'scale(-1,1)',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n\r\n        const createTab = (pTabObj: TTabInit, initialId: string, useAccent: boolean): TTab => {\r\n            const isVisible = ('isVisible' in pTabObj && pTabObj.isVisible !== undefined) ? pTabObj.isVisible : true;\r\n            const result: TTab = {\r\n                id: pTabObj.id,\r\n                isVisible: isVisible,\r\n                onOpen: pTabObj.onOpen,\r\n                onClose: pTabObj.onClose,\r\n                update: (openedTabObj: TTab) => {\r\n                    result.el.className = openedTabObj === result ? (useAccent ? 'tabrow__tab tabrow__tab--opened-accented' : 'tabrow__tab tabrow__tab--opened') : 'tabrow__tab';\r\n                    result.el.style.display = result.isVisible ? 'block' : 'none';\r\n                },\r\n                el: BB.el({\r\n                    parent: this.rootEl,\r\n                    content: 'label' in pTabObj ? pTabObj.label : '',\r\n                    title: 'title' in pTabObj ? pTabObj.title : undefined,\r\n                    className: initialId === pTabObj.id ? (useAccent ? 'tabrow__tab tabrow__tab--opened-accented' : 'tabrow__tab tabrow__tab--opened') : 'tabrow__tab',\r\n                    css: {\r\n                        lineHeight: height + 'px',\r\n                        display: isVisible ? 'block' : 'none',\r\n                        zIndex: '0',\r\n                    },\r\n                    onClick: () => {\r\n                        if (this.activeTab === result) {\r\n                            return;\r\n                        }\r\n                        this.open(result.id);\r\n                    },\r\n                }),\r\n            };\r\n            if ('image' in pTabObj) {\r\n\r\n                BB.el({\r\n                    tagName: 'span',\r\n                    parent: result.el,\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        backgroundImage: `url(\"${pTabObj.image}\")`,\r\n                        backgroundSize: 'contain',\r\n                        backgroundPosition: 'center',\r\n                        backgroundRepeat: 'no-repeat',\r\n                        display: 'flex',\r\n                        height: (height - 7) + 'px',\r\n                        justifyContent: 'center',\r\n                        margin: '4px auto',\r\n                    },\r\n                });\r\n            }\r\n            if ('css' in pTabObj && pTabObj.css !== undefined) {\r\n                BB.css(result.el, pTabObj.css);\r\n            }\r\n\r\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: result.el,\r\n                onEnterLeave: (isOver) => {\r\n                    result.el.classList.toggle('tabrow__tab-hover', isOver);\r\n                },\r\n            });\r\n\r\n            if (initialId === result.id) {\r\n                result.onOpen();\r\n                result.el.append(this.roundRight, this.roundLeft);\r\n            } else {\r\n                result.onClose();\r\n            }\r\n\r\n            return result;\r\n        };\r\n\r\n        let initTabObj = null;\r\n        for (let i = 0; i < p.tabArr.length; i++) {\r\n            const tab = createTab(p.tabArr[i], p.initialId, p.useAccent || false);\r\n            if (tab.id === p.initialId) {\r\n                initTabObj = tab;\r\n            }\r\n            this.tabArr.push(tab);\r\n        }\r\n        if (!initTabObj) {\r\n            throw 'invalid initialId';\r\n        }\r\n        this.activeTab = initTabObj;\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    open (tabId: string): void {\r\n        for (let i = 0; i < this.tabArr.length; i++) {\r\n            if (this.tabArr[i].id === tabId) {\r\n                if (this.activeTab === this.tabArr[i]) { // already open\r\n                    return;\r\n                }\r\n                this.activeTab.onClose();\r\n                this.activeTab = this.tabArr[i];\r\n                this.activeTab.onOpen();\r\n                this.activeTab.el.append(this.roundRight, this.roundLeft);\r\n                this.update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.open - invalid tabId';\r\n    }\r\n\r\n    getOpenedTabId (): string {\r\n        return '' + this.activeTab.id;\r\n    }\r\n\r\n    setIsVisible (tabId: string, isVisible: string): void {\r\n        for (let i = 0; i < this.tabArr.length; i++) {\r\n            if (this.tabArr[i].id === tabId) {\r\n                this.tabArr[i].isVisible = !!isVisible;\r\n                this.update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.setIsVisible - invalid tabId';\r\n    }\r\n}\r\n\r\n\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6ae9h\");","import {BB} from '../../../bb/bb';\r\nimport angleImg from '/src/app/img/ui/angle.svg';\r\nimport rotateImg from '/src/app/img/ui/edit-rotate.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Ui, when hand tool tab is open.\r\n */\r\nexport class HandUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly onAngleChange: (angleDeg: number, isRelative?: boolean) => void;\r\n    private isVisible: boolean = true;\r\n    private scale: number;\r\n    private angleDeg: number;\r\n    private readonly scaleEl: HTMLElement;\r\n    private readonly angleEl: HTMLElement;\r\n    private readonly angleIm: HTMLImageElement;\r\n\r\n\r\n    private updateUi (): void {\r\n        this.scaleEl.innerHTML = Math.round(this.scale * 100) + '%';\r\n        this.angleEl.innerHTML =  Math.round(this.angleDeg) + '';\r\n\r\n        this.angleIm.style.transform = 'rotate(' + this.angleDeg + 'deg)';\r\n        if (this.angleDeg % 90 === 0) {\r\n            this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)';\r\n        } else {\r\n            this.angleIm.style.boxShadow = '';\r\n        }\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            scale: number; // initial value\r\n            angleDeg: number; // initial value\r\n            onReset: () => void;\r\n            onFit: () => void;\r\n            onAngleChange: (angleDeg: number, isRelative?: boolean) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.scale = p.scale;\r\n        this.angleDeg = p.angleDeg;\r\n        this.onAngleChange = p.onAngleChange;\r\n\r\n        const row1 = BB.el({\r\n            css: {\r\n                marginBottom: '10px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n        const row2 = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        const row3 = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n        this.rootEl.append(row1, row2, row3);\r\n\r\n\r\n        this.scaleEl = BB.el({\r\n            css: {\r\n                width: '55px',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        row1.append(this.scaleEl);\r\n\r\n        this.angleIm = new Image();\r\n        this.angleIm.src = angleImg;\r\n        BB.css(this.angleIm, {\r\n            verticalAlign: 'bottom',\r\n            width: '20px',\r\n            height: '20px',\r\n            marginRight: '5px',\r\n            borderRadius: '10px',\r\n            background: 'rgba(0,0,0,0.2)',\r\n            userSelect: 'none',\r\n        });\r\n        row1.append(this.angleIm);\r\n\r\n        this.angleEl = BB.el({\r\n            parent: row1,\r\n            css: {\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n\r\n        this.updateUi();\r\n\r\n\r\n        const resetButton = BB.el({\r\n            tagName: 'button',\r\n            content: LANG('hand-reset'),\r\n            onClick: p.onReset,\r\n        });\r\n        BB.makeUnfocusable(resetButton);\r\n\r\n        const fitButton = BB.el({\r\n            tagName: 'button',\r\n            content: LANG('hand-fit'),\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: p.onFit,\r\n        });\r\n        BB.makeUnfocusable(fitButton);\r\n        row2.append(resetButton, fitButton);\r\n\r\n        const leftRotateButton = BB.el({\r\n            tagName: 'button',\r\n            content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\r\n            onClick: function () {\r\n                p.onAngleChange(-15, true);\r\n            },\r\n        });\r\n        BB.makeUnfocusable(leftRotateButton);\r\n\r\n        const resetAngleButton = BB.el({\r\n            tagName: 'button',\r\n            content: '0',\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: function () {\r\n                p.onAngleChange(0);\r\n            },\r\n        });\r\n        BB.makeUnfocusable(resetAngleButton);\r\n\r\n        const rightRotateButton = BB.el({\r\n            tagName: 'button',\r\n            content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\"/>',\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: function () {\r\n                p.onAngleChange(15, true);\r\n            },\r\n        });\r\n        BB.makeUnfocusable(rightRotateButton);\r\n        row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.updateUi();\r\n        }\r\n    }\r\n\r\n    update (pScale: number, pAngleDeg: number): void {\r\n        this.scale = pScale;\r\n        this.angleDeg = pAngleDeg;\r\n        if (this.isVisible) {\r\n            this.updateUi();\r\n        }\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"8l03e\");","import {BB} from '../../../bb/bb';\r\nimport {KlSlider} from '../components/kl-slider';\r\nimport {Select} from '../components/select';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {LANG} from '../../../language/language';\r\nimport {TFillSampling} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n/**\r\n * Paint Bucket tab contents (color slider, opacity slider, etc)\r\n */\r\nexport class FillUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private isVisible: boolean;\r\n    private readonly colorDiv: HTMLElement;\r\n    private readonly colorSlider: KlColorSlider;\r\n    private readonly toleranceSlider: KlSlider;\r\n    private readonly opacitySlider: KlSlider;\r\n    private readonly modeSelect: Select;\r\n    private readonly growSelect: Select;\r\n    private isContiguous: boolean;\r\n    private readonly eraserToggle: Checkbox;\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.isVisible = true;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        this.colorSlider = p.colorSlider;\r\n\r\n        this.opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: 1,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n        });\r\n        this.rootEl.append(this.opacitySlider.getElement());\r\n\r\n        this.toleranceSlider = new KlSlider({\r\n            label: LANG('bucket-tolerance'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 0,\r\n            max: 255,\r\n            value: 20 * (255 / 100),\r\n            toValue: (displayValue) => displayValue * (255 / 100),\r\n            toDisplayValue: (value) => value / (255 / 100),\r\n        });\r\n        BB.css(this.toleranceSlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(this.toleranceSlider.getElement());\r\n\r\n        const selectRow = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const modeWrapper = BB.el({\r\n            content: LANG('bucket-sample') + '&nbsp;',\r\n            title: LANG('bucket-sample-title'),\r\n            css: {\r\n                fontSize: '15px',\r\n            },\r\n        });\r\n        this.modeSelect = new Select({\r\n            optionArr: [\r\n                ['all', LANG('bucket-sample-all')],\r\n                ['current', LANG('bucket-sample-active')],\r\n                ['above', LANG('bucket-sample-above')],\r\n            ],\r\n            initValue: 'all',\r\n        });\r\n        const modePointerListener = new BB.PointerListener({\r\n            target: this.modeSelect.getElement(),\r\n            onWheel: (e) => {\r\n                this.modeSelect.setDeltaValue(e.deltaY);\r\n            },\r\n        });\r\n        modeWrapper.append(this.modeSelect.getElement());\r\n        selectRow.append(modeWrapper);\r\n\r\n        const growWrapper = BB.el({\r\n            content: LANG('bucket-grow') + '&nbsp;',\r\n            title: LANG('bucket-grow-title'),\r\n            css: {\r\n                fontSize: '15px',\r\n                marginLeft: '10px',\r\n            },\r\n        });\r\n        this.growSelect = new Select({\r\n            optionArr: [\r\n                ['0', '0'],\r\n                ['1', '1'],\r\n                ['2', '2'],\r\n                ['3', '3'],\r\n                ['4', '4'],\r\n                ['5', '5'],\r\n                ['6', '6'],\r\n                ['7', '7'],\r\n            ],\r\n            initValue: '0',\r\n        });\r\n        const growPointerListener = new BB.PointerListener({\r\n            target: this.growSelect.getElement(),\r\n            onWheel: (e) => {\r\n                this.growSelect.setDeltaValue(e.deltaY);\r\n            },\r\n        });\r\n        growWrapper.append(this.growSelect.getElement());\r\n        selectRow.append(growWrapper);\r\n\r\n\r\n        this.isContiguous = true;\r\n        const contiguousToggle = new Checkbox({\r\n            init: true,\r\n            label: LANG('bucket-contiguous'),\r\n            title: LANG('bucket-contiguous-title'),\r\n            callback: (b) => {\r\n                this.isContiguous = b;\r\n            },\r\n            css: {\r\n                paddingRight: '5px',\r\n                display: 'inline-block',\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        this.eraserToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('eraser'),\r\n            css: {\r\n\r\n                paddingRight: '5px',\r\n                display: 'inline-block',\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        this.rootEl.append(BB.el({\r\n            content: [\r\n                contiguousToggle.getElement(),\r\n                this.eraserToggle.getElement(),\r\n            ],\r\n            css: {\r\n                display: 'flex',\r\n                marginTop: '10px',\r\n            },\r\n        }));\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * [0, 1]\r\n     */\r\n    getTolerance (): number {\r\n        return this.toleranceSlider.getValue();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacitySlider.getValue();\r\n    }\r\n\r\n    getSample (): TFillSampling {\r\n        return this.modeSelect.getValue() as TFillSampling;\r\n    }\r\n\r\n    getGrow (): number {\r\n        return parseInt(this.growSelect.getValue(), 10);\r\n    }\r\n\r\n    getContiguous (): boolean {\r\n        return this.isContiguous;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.eraserToggle.getValue();\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n/**\r\n * Text Tool tab contents (color slider)\r\n */\r\nexport class TextUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly colorDiv: HTMLElement;\r\n    private isVisible: boolean = true;\r\n    private readonly colorSlider: KlColorSlider;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.colorSlider = p.colorSlider;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        const hint = BB.el({\r\n            parent: this.rootEl,\r\n            content: LANG('text-instruction'),\r\n        });\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\r\n        }\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {Options} from '../components/options';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {KlSlider} from '../components/kl-slider';\r\nimport {LANG} from '../../../language/language';\r\nimport {TShapeToolMode, TShapeToolType} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n/**\r\n * Shape Tool tab contents\r\n */\r\nexport class ShapeUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private isVisible: boolean;\r\n    private readonly colorDiv: HTMLElement;\r\n    private readonly colorSlider: KlColorSlider;\r\n    private shape: TShapeToolType = 'rect';\r\n    private mode: TShapeToolMode = 'stroke';\r\n    private readonly eraserToggle: Checkbox;\r\n    private readonly opacitySlider: KlSlider;\r\n    private readonly lineWidthSlider: KlSlider;\r\n    private readonly outwardsToggle: Checkbox;\r\n    private readonly fixedToggle: Checkbox;\r\n    private readonly snapToggle:Checkbox;\r\n    private readonly lockAlphaToggle: Checkbox;\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.isVisible = true;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        this.colorSlider = p.colorSlider;\r\n\r\n        const previewSize = 35;\r\n        const previewPadding = 8;\r\n\r\n\r\n        const rectStrokeSvgRect = BB.createSvg({\r\n            elementType: 'rect',\r\n            x: '' + previewPadding,\r\n            width: '' + (previewSize - previewPadding * 2),\r\n        });\r\n        const rectStrokeSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        rectStrokeSvg.classList.add('dark-invert');\r\n        rectStrokeSvg.append(rectStrokeSvgRect);\r\n        BB.css(rectStrokeSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n        const rectFilledSvgRect = BB.createSvg({\r\n            elementType: 'rect',\r\n            x: '' + previewPadding,\r\n            width: '' + (previewSize - previewPadding * 2),\r\n        });\r\n        const rectFilledSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        rectFilledSvg.classList.add('dark-invert');\r\n        rectFilledSvg.append(rectFilledSvgRect);\r\n        BB.css(rectFilledSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n\r\n        const ellipseStrokeSvgEllipse = BB.createSvg({\r\n            elementType: 'ellipse',\r\n            cx: '' + (previewSize / 2),\r\n            cy: '' + (previewSize / 2),\r\n            rx: '' + (previewSize / 2 - previewPadding),\r\n        });\r\n        const ellipseStrokeSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        ellipseStrokeSvg.classList.add('dark-invert');\r\n        ellipseStrokeSvg.append(ellipseStrokeSvgEllipse);\r\n        BB.css(ellipseStrokeSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n        const ellipseFilledSvgEllipse = BB.createSvg({\r\n            elementType: 'ellipse',\r\n            cx: '' + (previewSize / 2),\r\n            cy: '' + (previewSize / 2),\r\n            rx: '' + (previewSize / 2 - previewPadding),\r\n        });\r\n        const ellipseFilledSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        ellipseFilledSvg.classList.add('dark-invert');\r\n        ellipseFilledSvg.append(ellipseFilledSvgEllipse);\r\n        BB.css(ellipseFilledSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n\r\n        const lineSvgLine = BB.createSvg({\r\n            elementType: 'line',\r\n            x1: '' + previewPadding,\r\n            x2: '' + (previewSize - previewPadding),\r\n        });\r\n        const lineSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        lineSvg.classList.add('dark-invert');\r\n        lineSvg.append(lineSvgLine);\r\n        BB.css(lineSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n        const updatePreviews = () => {\r\n            const strokeWidth = BB.clamp(Math.round(this.lineWidthSlider.getValue() / 10), 1, 10) + 'px';\r\n\r\n            const squish = 1.35;\r\n\r\n            BB.css(rectStrokeSvgRect, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n            BB.css(rectFilledSvgRect, { fill: 'black', stroke: 'none' });\r\n\r\n            BB.css(ellipseStrokeSvgEllipse, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n            BB.css(ellipseFilledSvgEllipse, { fill: 'black', stroke: 'none' });\r\n\r\n            BB.css(\r\n                lineSvgLine,\r\n                { fill: 'none', stroke: 'black', strokeWidth: strokeWidth }\r\n            );\r\n\r\n            if (this.fixedToggle.getValue()) {\r\n                rectStrokeSvgRect.setAttribute('y', '' + previewPadding);\r\n                rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n                rectFilledSvgRect.setAttribute('y', '' + previewPadding);\r\n                rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n\r\n                ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n                ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n            } else {\r\n                rectStrokeSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n                rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n                rectFilledSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n                rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n\r\n                ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n                ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n            }\r\n\r\n            if (this.snapToggle.getValue()) {\r\n                lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding));\r\n                lineSvgLine.setAttribute('y2', '' + previewPadding);\r\n            } else {\r\n                lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding * squish));\r\n                lineSvgLine.setAttribute('y2', '' + (previewPadding * squish));\r\n            }\r\n        };\r\n\r\n        const row1 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'start',\r\n            },\r\n        });\r\n\r\n        const shapeOptions = new Options({\r\n            optionArr: [\r\n                {\r\n                    id: 'rect-stroke',\r\n                    label: rectStrokeSvg,\r\n                    title: LANG('shape-rect') + ' ' + LANG('shape-stroke'),\r\n                },\r\n                {\r\n                    id: 'ellipse-stroke',\r\n                    label: ellipseStrokeSvg,\r\n                    title: LANG('shape-ellipse') + ' ' + LANG('shape-stroke'),\r\n                },\r\n                {\r\n                    id: 'line',\r\n                    label: lineSvg,\r\n                    title: LANG('shape-line'),\r\n                },\r\n                {\r\n                    id: 'rect-fill',\r\n                    label: rectFilledSvg,\r\n                    title: LANG('shape-rect') + ' ' + LANG('shape-fill'),\r\n                },\r\n                {\r\n                    id: 'ellipse-fill',\r\n                    label: ellipseFilledSvg,\r\n                    title: LANG('shape-ellipse') + ' ' + LANG('shape-fill'),\r\n                },\r\n            ],\r\n            initId: this.shape + ' ' + this.mode,\r\n            onChange: (id) => {\r\n                const split = id.split('-');\r\n                this.shape = split[0] as TShapeToolType;\r\n                this.mode = split[1] as TShapeToolMode;\r\n\r\n                BB.css(this.fixedToggle.getElement(), {\r\n                    display: this.shape === 'line' ? 'none' : '',\r\n                });\r\n                BB.css(this.snapToggle.getElement(), {\r\n                    display: this.shape === 'line' ? '' : 'none',\r\n                });\r\n                BB.css(this.lineWidthSlider.getElement(), {\r\n                    display: (this.shape !== 'line' && this.mode === 'fill') ? 'none' : '',\r\n                });\r\n            },\r\n            changeOnInit: true,\r\n        });\r\n        shapeOptions.getElement().style.width = '120px';\r\n        row1.append(shapeOptions.getElement());\r\n\r\n        this.eraserToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('eraser'),\r\n            callback: () => {\r\n                updatePreviews();\r\n            },\r\n        });\r\n\r\n        this.lockAlphaToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('lock-alpha'),\r\n            title: LANG('lock-alpha-title'),\r\n            doHighlight: true,\r\n        });\r\n        this.lockAlphaToggle.getElement().style.marginTop = '10px';\r\n\r\n        row1.append(BB.el({\r\n            content: [\r\n                this.eraserToggle.getElement(),\r\n                this.lockAlphaToggle.getElement(),\r\n            ],\r\n        }));\r\n\r\n        this.lineWidthSlider = new KlSlider({\r\n            label: LANG('shape-line-width'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1,\r\n            max: 200,\r\n            value: 4,\r\n            curve: 'quadratic',\r\n            onChange: () => {\r\n                updatePreviews();\r\n            },\r\n        });\r\n        BB.css(this.lineWidthSlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(this.lineWidthSlider.getElement());\r\n\r\n        this.opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: 1,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n        });\r\n        BB.css(this.opacitySlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(this.opacitySlider.getElement());\r\n\r\n        const row2 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        this.outwardsToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('shape-outwards'),\r\n            css: {\r\n                width: '50%',\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n        row2.append(this.outwardsToggle.getElement());\r\n\r\n        this.fixedToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('shape-fixed'),\r\n            callback: () => {\r\n                updatePreviews();\r\n            },\r\n            css: {\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n        row2.append(this.fixedToggle.getElement());\r\n\r\n        this.snapToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('angle-snap'),\r\n            title: LANG('angle-snap-title'),\r\n            callback: () => {\r\n                updatePreviews();\r\n            },\r\n            css: {\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n        row2.append(this.snapToggle.getElement());\r\n\r\n\r\n        updatePreviews();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement());\r\n            this.colorDiv.append(this.colorSlider.getOutputElement());\r\n            //update();\r\n        }\r\n    }\r\n\r\n    getShape (): TShapeToolType {\r\n        return this.shape;\r\n    }\r\n\r\n    getMode (): TShapeToolMode {\r\n        return this.mode;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.eraserToggle.getValue();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacitySlider.getValue();\r\n    }\r\n\r\n    getLineWidth (): number {\r\n        return this.lineWidthSlider.getValue();\r\n    }\r\n\r\n    getIsOutwards (): boolean {\r\n        return this.outwardsToggle.getValue();\r\n    }\r\n\r\n    getIsFixed (): boolean {\r\n        return this.fixedToggle.getValue();\r\n    }\r\n\r\n    getIsSnap (): boolean {\r\n        return this.snapToggle.getValue();\r\n    }\r\n\r\n    getDoLockAlpha (): boolean {\r\n        return this.lockAlphaToggle.getValue();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../components/select';\r\nimport {ColorOptions} from '../components/color-options';\r\nimport {showModal} from './base/showModal';\r\nimport {LANG} from '../../../language/language';\r\nimport {IRGB, IRGBA} from '../../kl-types';\r\nimport {ISize2D} from '../../../bb/bb-types';\r\nimport {table} from '../components/table';\r\nimport {ERASE_COLOR} from '../../brushes/erase-color';\r\nimport {theme} from '../../../theme/theme';\r\n\r\nexport function newImageDialog (\r\n    p: {\r\n        currentColor: IRGB; // current color\r\n        secondaryColor: IRGB;\r\n        maxCanvasSize: number;\r\n        canvasWidth: number; // current canvas size\r\n        canvasHeight: number; // current canvas size\r\n        workspaceWidth: number;\r\n        workspaceHeight: number;\r\n        onConfirm: (width: number, height: number, color: IRGBA) => void;\r\n        onCancel: () => void;\r\n    }\r\n): void {\r\n\r\n    const currentColor = p.currentColor;\r\n    const secondaryColor = p.secondaryColor;\r\n    const maxCanvasSize = p.maxCanvasSize;\r\n    const canvasWidth = p.canvasWidth;\r\n    const canvasHeight = p.canvasHeight;\r\n    const workspaceWidth = p.workspaceWidth;\r\n    const workspaceHeight = p.workspaceHeight;\r\n    const onConfirm = p.onConfirm;\r\n    const onCancel = p.onCancel;\r\n\r\n    function createRatioSize (ratioX: number, ratioY: number, width: number, height: number, padding: number): ISize2D {\r\n        return BB.fitInto(\r\n            ratioX,\r\n            ratioY,\r\n            Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding),\r\n            1\r\n        );\r\n    }\r\n\r\n    const newImDiv = BB.el();\r\n    const widthInput = BB.el({tagName: 'input'}) as HTMLInputElement;\r\n    const unitStyle = {\r\n        color: '#888',\r\n        fontSize: '12px',\r\n        marginLeft: '5px',\r\n    };\r\n    const widthUnit = BB.el({\r\n        textContent: LANG('new-px'),\r\n        css: unitStyle,\r\n    });\r\n    const heightInput = BB.el({tagName: 'input'}) as HTMLInputElement;\r\n    const heightUnit = BB.el({\r\n        textContent: LANG('new-px'),\r\n        css: unitStyle,\r\n    });\r\n\r\n    widthInput.setAttribute('data-ignore-focus', 'true');\r\n    heightInput.setAttribute('data-ignore-focus', 'true');\r\n\r\n    widthInput.type = 'number';\r\n    widthInput.min = '1';\r\n    widthInput.max = '' + maxCanvasSize;\r\n    BB.css(widthInput, {\r\n        width: '70px',\r\n    });\r\n\r\n    heightInput.type = 'number';\r\n    heightInput.min = '1';\r\n    heightInput.max = '' + maxCanvasSize;\r\n    heightInput.style.width = '70px';\r\n    widthInput.value = '' + canvasWidth;\r\n    heightInput.value = '' + canvasHeight;\r\n    widthInput.onclick = () => {\r\n        widthInput.focus();\r\n        updateRatio();\r\n    };\r\n    heightInput.onclick = () => {\r\n        heightInput.focus();\r\n        updateRatio();\r\n    };\r\n\r\n\r\n    const sizeTable = table([\r\n        [\r\n            LANG('width') + ':&nbsp;',\r\n            widthInput,\r\n            widthUnit,\r\n        ],\r\n        [\r\n            BB.el({css: {height: '5px'}}),\r\n            '',\r\n            '',\r\n        ],\r\n        [\r\n            LANG('height') + ':&nbsp;',\r\n            heightInput,\r\n            heightUnit,\r\n        ],\r\n    ]);\r\n    BB.css(sizeTable, {\r\n        marginBottom: '10px',\r\n    });\r\n\r\n\r\n    const ratioWrapper = BB.el({\r\n        css: {\r\n            marginTop: '5px',\r\n            color: '#888',\r\n        },\r\n    });\r\n\r\n    const templateWrapper = BB.el();\r\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\r\n    const presetFitBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n    templateWrapper.style.marginBottom = '10px';\r\n    const presetCurrentBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n    const presetSquareBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n    const presetLandscapeBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n    const presetPortraitBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n    const presetOversizeBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n\r\n    presetCurrentBtn.textContent = LANG('new-current');\r\n    presetFitBtn.textContent = LANG('new-fit');\r\n    presetOversizeBtn.textContent = LANG('new-oversize');\r\n    presetLandscapeBtn.textContent = LANG('new-landscape');\r\n    presetPortraitBtn.textContent = LANG('new-portrait');\r\n    presetSquareBtn.textContent = LANG('new-square');\r\n\r\n    presetCurrentBtn.style.marginRight = '5px';\r\n    presetFitBtn.style.marginRight = '5px';\r\n    presetOversizeBtn.style.marginRight = '5px';\r\n    presetLandscapeBtn.style.marginTop = '5px';\r\n    presetLandscapeBtn.style.marginRight = '5px';\r\n    presetPortraitBtn.style.marginTop = '5px';\r\n    presetPortraitBtn.style.marginRight = '5px';\r\n\r\n    templateWrapper.append(\r\n        presetCurrentBtn,\r\n        presetFitBtn,\r\n        presetOversizeBtn,\r\n        presetSquareBtn,\r\n        presetLandscapeBtn,\r\n        presetPortraitBtn\r\n    );\r\n\r\n    const templatePadding = 0;\r\n\r\n    presetCurrentBtn.onclick = function () {\r\n        widthInput.value = '' + canvasWidth;\r\n        heightInput.value = '' + canvasHeight;\r\n        updateRatio();\r\n    };\r\n    presetFitBtn.onclick = function () {\r\n        widthInput.value = '' + workspaceWidth;\r\n        heightInput.value = '' + workspaceHeight;\r\n        updateRatio();\r\n    };\r\n    presetOversizeBtn.onclick = function () {\r\n        widthInput.value = '' + (workspaceWidth + 500);\r\n        heightInput.value = '' + (workspaceHeight + 500);\r\n        updateRatio();\r\n    };\r\n    presetSquareBtn.onclick = function () {\r\n        const sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetLandscapeBtn.onclick = function () {\r\n        const sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetPortraitBtn.onclick = function () {\r\n        const sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n\r\n    const select = new Select({\r\n        isFocusable: true,\r\n        optionArr: [\r\n            ['screen', LANG('new-screen')],\r\n            ['16 9', LANG('new-video') + ' 16:9'],\r\n            ['3 2', '3:2'],\r\n            ['5 3', '5:3'],\r\n            ['2 1', '2:1'],\r\n            ['paper', LANG('new-din-paper') + ' 2:1'],\r\n            ['9 16', '9:16'],\r\n            ['2 3', '2:3'],\r\n            ['3 5', '3:5'],\r\n            ['1 2', '1:2'],\r\n            ['1 1.4142135623730951', '1:2'],\r\n        ],\r\n        onChange: function (val) {\r\n            if (val === 'screen') {\r\n                widthInput.value = '' + window.screen.width;\r\n                heightInput.value = '' + window.screen.height;\r\n            } else if (val === 'paper') {\r\n                const sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            } else {\r\n                const split = val.split(' ');\r\n                const sizeObj = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            }\r\n            updateRatio();\r\n            select.setValue(null);\r\n        },\r\n    });\r\n    setTimeout(() => {\r\n        // safari: not empty without also setting it to null via timeout\r\n        select.setValue(null);\r\n    }, 0);\r\n    BB.css(select.getElement(), {\r\n        width: '80px',\r\n    });\r\n    templateWrapper.append(select.getElement());\r\n\r\n\r\n\r\n    let backgroundRGBA = {r: 255, g: 255, b: 255, a: 1};\r\n\r\n    const colorOptionsArr = [\r\n        {r: 255, g: 255, b: 255, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 0},\r\n        {\r\n            r: currentColor.r,\r\n            g: currentColor.g,\r\n            b: currentColor.b,\r\n            a: 1,\r\n        },\r\n        {\r\n            r: secondaryColor.r,\r\n            g: secondaryColor.g,\r\n            b: secondaryColor.b,\r\n            a: 1,\r\n        },\r\n    ];\r\n    let initColorIndex = 0;\r\n    if (theme.isDark()) {\r\n        colorOptionsArr.forEach((item, index) => {\r\n            if (item.r === ERASE_COLOR && item.g === ERASE_COLOR && item.b === ERASE_COLOR) {\r\n                initColorIndex = index;\r\n                backgroundRGBA = item;\r\n            }\r\n        });\r\n    }\r\n\r\n    const colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        initialIndex: initColorIndex,\r\n        onChange: function (rgbaObj) {\r\n            backgroundRGBA = rgbaObj;\r\n            preview.style.backgroundColor = 'rgba(' + rgbaObj.r + ',' + rgbaObj.g + ',' + rgbaObj.b + ', ' + rgbaObj.a + ')';\r\n        },\r\n    });\r\n\r\n    const previewWrapper = BB.el({\r\n        className: 'kl-transparent-preview',\r\n        css: {\r\n            boxSizing: 'border-box',\r\n            width: '340px',\r\n            height: '140px',\r\n            display: 'table',\r\n            padding: '10px',\r\n            marginTop: '10px',\r\n            marginLeft: '-20px',\r\n        },\r\n    });\r\n    const preview = BB.el({\r\n        className: 'kl-transparent-preview__canvas',\r\n        css: {\r\n            width: 200 + 'px',\r\n            height: 100 + 'px',\r\n            backgroundColor: 'rgba(' + backgroundRGBA.r + ',' + backgroundRGBA.g + ',' + backgroundRGBA.b + ', ' + backgroundRGBA.a + ')',\r\n            marginLeft: 'auto',\r\n            marginRight: 'auto',\r\n            color: '#aaa',\r\n            fontSize: '16px',\r\n            fontWeight: 'bold',\r\n            textAlign: 'center',\r\n            verticalAlign: 'center',\r\n            display: 'table',\r\n            overflow: 'hidden',\r\n        },\r\n    });\r\n    const previewcell = BB.el({\r\n        parent: previewWrapper,\r\n        content: preview,\r\n        css: {\r\n            display: 'table-cell',\r\n            verticalAlign: 'middle',\r\n        },\r\n    });\r\n    const cell = BB.el({\r\n        parent: preview,\r\n        css: {\r\n            display: 'table-cell',\r\n            verticalAlign: 'middle',\r\n        },\r\n    });\r\n\r\n    function updateRatio () {\r\n        widthInput.value = '' + Math.min(maxCanvasSize, parseInt(widthInput.value));\r\n        heightInput.value = '' + Math.min(maxCanvasSize, parseInt(heightInput.value));\r\n\r\n        function hcf (u: number, v: number): number {\r\n            let U = u, V = v;\r\n            while (true) {\r\n                if (!(U %= V)) {\r\n                    return V;\r\n                }\r\n                if (!(V %= U)) {\r\n                    return U;\r\n                }\r\n            }\r\n        }\r\n\r\n        let w = parseInt(widthInput.value);\r\n        let h = parseInt(heightInput.value);\r\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\r\n            if (w > maxCanvasSize) {\r\n                w = maxCanvasSize;\r\n            } else if (h > maxCanvasSize) {\r\n                h = maxCanvasSize;\r\n            }\r\n\r\n            widthInput.value = '' + w;\r\n            heightInput.value = '' + h;\r\n        }\r\n\r\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\r\n        const commonRatios = [\r\n            [1, 2], [2, 1],\r\n            [2, 3], [3, 2],\r\n            [3, 4], [4, 3],\r\n            [4, 5], [5, 4],\r\n            [16, 9], [9, 16],\r\n            [3, 2], [2, 3],\r\n            [5, 3], [3, 5],\r\n            [2, 1], [1, 2],\r\n            [1.414, 1], [1, 1.414],\r\n        ];\r\n        const reducedArr = BB.reduce(w, h);\r\n        let closestRatio = null;\r\n        let closestDistance = null;\r\n        for (let i = 0; i < commonRatios.length; i++) {\r\n            if (i === 0 || Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\r\n                closestRatio = commonRatios[i];\r\n                closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\r\n            }\r\n        }\r\n        //display ratio\r\n        if (closestDistance > 0 && closestDistance < 0.005) {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ~' + closestRatio[0] + ':' + closestRatio[1];\r\n        } else {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ' + reducedArr[0] + ':' + reducedArr[1];\r\n        }\r\n\r\n        const realw = w;\r\n        const T = hcf(w, h);\r\n        w /= T;\r\n        h /= T;\r\n        w *= 260;\r\n        h *= 260;\r\n        if (w > 260) {\r\n            h = 260 / w * h;\r\n            w = 260;\r\n        }\r\n        if (h > 100) {\r\n            w = 100 / h * w;\r\n            h = 100;\r\n\r\n        }\r\n\r\n        preview.style.width = w + 'px';\r\n        preview.style.height = h + 'px';\r\n        BB.createCheckerDataUrl(parseInt('' + (30 * (w / realw))), function (url) {\r\n            previewWrapper.style.background = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n    }\r\n    theme.addIsDarkListener(updateRatio);\r\n\r\n    widthInput.onchange = function () {\r\n        if (widthInput.value === '' || parseInt(widthInput.value) < 0) {\r\n            widthInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    widthInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    heightInput.onchange = function () {\r\n        if (heightInput.value === '' || parseFloat(heightInput.value) < 0) {\r\n            heightInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    heightInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    updateRatio();\r\n\r\n    newImDiv.append(templateWrapper);\r\n    const secondRow = BB.el({\r\n        parent: newImDiv,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'flex-end',\r\n        },\r\n    });\r\n    const secondRowLeft = BB.el({\r\n        parent: secondRow,\r\n    });\r\n    secondRowLeft.append(sizeTable, ratioWrapper);\r\n    secondRow.append(colorOptions.getElement());\r\n\r\n    newImDiv.append(previewWrapper);\r\n\r\n    showModal({\r\n        target: document.body,\r\n        message: `<b>${LANG('new-title')}</b>`,\r\n        div: newImDiv,\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (result) {\r\n            widthInput.onclick = null;\r\n            heightInput.onclick = null;\r\n            presetCurrentBtn.onclick = null;\r\n            presetFitBtn.onclick = null;\r\n            presetOversizeBtn.onclick = null;\r\n            presetSquareBtn.onclick = null;\r\n            presetLandscapeBtn.onclick = null;\r\n            presetPortraitBtn.onclick = null;\r\n            widthInput.onchange = null;\r\n            widthInput.onkeyup = null;\r\n            heightInput.onchange = null;\r\n            heightInput.onkeyup = null;\r\n            select.destroy();\r\n            colorOptions.destroy();\r\n            theme.removeIsDarkListener(updateRatio);\r\n\r\n            if (\r\n                result === 'Cancel'\r\n                || parseInt(widthInput.value) <= 0\r\n                || parseInt(heightInput.value) <= 0\r\n                || isNaN(parseInt(widthInput.value))\r\n                || isNaN(parseInt(heightInput.value))\r\n            ) {\r\n                onCancel();\r\n                return;\r\n            }\r\n            onConfirm(\r\n                parseInt(widthInput.value),\r\n                parseInt(heightInput.value),\r\n                backgroundRGBA\r\n            );\r\n        },\r\n        clickOnEnter: 'Ok',\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nexport function table (\r\n    data: (HTMLElement | string)[][],\r\n    cellProps?: Record<string, {rowspan: number}>, // {'0.2': {...}} -> row 1, col 3\r\n): HTMLElement {\r\n    const result = BB.el({\r\n        tagName: 'table',\r\n        className: 'kl-table',\r\n    });\r\n    data.forEach((row, rowIndex) => {\r\n        const rowEl = BB.el({\r\n            tagName: 'tr',\r\n        });\r\n        rowEl.append(...row.map((el, colIndex) => {\r\n            const cellEl = BB.el({\r\n                tagName: 'td',\r\n                content: el,\r\n            }) as HTMLTableCellElement;\r\n\r\n            const key = rowIndex + '.' + colIndex;\r\n            if (cellProps !== undefined && key in cellProps) {\r\n                cellEl.rowSpan = cellProps[key].rowspan;\r\n            }\r\n\r\n            return cellEl;\r\n        }));\r\n        result.append(rowEl);\r\n    });\r\n    return result;\r\n}","import {BB} from '../../../bb/bb';\r\nimport collapseImg from '/src/app/img/ui/ui-collapse.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {TUiLayout} from '../../kl-types';\r\n\r\n/**\r\n * button that allows to collapse toolspace (for mobile)\r\n */\r\nexport class ToolspaceCollapser {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private directionStr: TUiLayout;\r\n    private readonly icon: HTMLElement;\r\n    private stateIsOpen: boolean;\r\n\r\n\r\n    private update (): void {\r\n        if (this.directionStr === 'left') {\r\n            this.icon.style.transform = this.stateIsOpen ? 'rotate(180deg)' : '';\r\n        } else {\r\n            this.icon.style.transform = this.stateIsOpen ? '' : 'rotate(180deg)';\r\n        }\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onChange: () => void;\r\n        }\r\n    ) {\r\n        this.stateIsOpen = true;\r\n        this.directionStr = 'right';\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-toolspace-toggle',\r\n            css: {\r\n                width: '36px',\r\n                height: '36px',\r\n                background: 'rgba(100, 100, 100, 0.9)',\r\n                color: '#fff',\r\n                position: 'absolute',\r\n                top: '0',\r\n                textAlign: 'center',\r\n                lineHeight: '36px',\r\n                cursor: 'pointer',\r\n                userSelect: 'none',\r\n                padding: '6px',\r\n                boxSizing: 'border-box',\r\n            },\r\n            title: LANG('toggle-show-tools'),\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                this.stateIsOpen = !this.stateIsOpen;\r\n                this.update();\r\n                p.onChange();\r\n            },\r\n        });\r\n\r\n        this.icon = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                backgroundImage: `url(${collapseImg})`,\r\n                width: '100%',\r\n                height: '100%',\r\n                backgroundSize: 'contain',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    isOpen (): boolean {\r\n        return this.stateIsOpen;\r\n    }\r\n\r\n    setDirection (dirStr: TUiLayout): void {\r\n        this.directionStr = dirStr;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"8K12o\");","import {BB} from '../../../bb/bb';\r\nimport {renderText} from '../../image-operations/render-text';\r\nimport {ColorOptions} from '../components/color-options';\r\nimport {Select} from '../components/select';\r\nimport {ImageRadioList} from '../components/image-radio-list';\r\nimport {ImageToggle} from '../components/image-toggle';\r\nimport {KlSlider} from '../components/kl-slider';\r\nimport {showModal} from './base/showModal';\r\nimport alignLeftImg from '/src/app/img/ui/align-left.svg';\r\nimport alignCenterImg from '/src/app/img/ui/align-center.svg';\r\nimport alignRightImg from '/src/app/img/ui/align-right.svg';\r\nimport typoItalicImg from '/src/app/img/ui/typo-italic.svg';\r\nimport typoBoldImg from '/src/app/img/ui/typo-bold.svg';\r\nimport toolZoomInImg from '/src/app/img/ui/tool-zoom-in.svg';\r\nimport toolZoomOutImg from '/src/app/img/ui/tool-zoom-out.svg';\r\nimport {IRGB} from '../../kl-types';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\nimport { throwIfNull} from '../../../bb/base/base';\r\nimport {theme} from '../../../theme/theme';\r\n\r\n\r\ntype TTextFormat = 'left' | 'center' | 'right';\r\ntype TTextFont = 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy';\r\n\r\nexport type TTextToolResult = {\r\n    x: number;\r\n    y: number;\r\n    textStr: string;\r\n    align: TTextFormat;\r\n    isItalic: boolean;\r\n    isBold: boolean;\r\n    color: IRGB;\r\n    size: number; // px\r\n    font: TTextFont;\r\n    opacity: number;\r\n};\r\n\r\n/**\r\n * Text Tool dialog\r\n */\r\nexport function textToolDialog (\r\n    p: {\r\n        klCanvas: KlCanvas;\r\n        layerIndex: number;\r\n        x: number;\r\n        y: number;\r\n        angleRad: number;\r\n        color: IRGB;\r\n        secondaryColor: IRGB;\r\n        size: number; // px\r\n        align: TTextFormat; // default 'left'\r\n        isBold: boolean; // default false\r\n        isItalic: boolean; // default false\r\n        font: TTextFont; // default sans-serif\r\n        opacity: number; // [0, 1] default 1\r\n        onConfirm: (confirmP: TTextToolResult) => void;\r\n    }\r\n): void {\r\n\r\n    const div = BB.el();\r\n\r\n    const isSmallWidth = window.innerWidth < 550;\r\n    const isSmallHeight = window.innerHeight < 630;\r\n\r\n    // --- preview ---\r\n    // Text drawn on klCanvas-sized canvas: textCanvas\r\n    // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\r\n    //      they are transformed. canvas size of final preview\r\n    // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\r\n    // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\r\n\r\n    const width = isSmallWidth ? 340 : 540;\r\n    const height = isSmallWidth ? (isSmallHeight ? 210 : 260) : (isSmallHeight ? 230 : 350);\r\n    let scale = 1;\r\n\r\n    const layerArr = p.klCanvas.getLayersFast();\r\n    const textCanvas = BB.canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\r\n    const textCtx = BB.ctx(textCanvas);\r\n    const targetCanvas = BB.canvas(width, height);\r\n    const targetCtx = BB.ctx(targetCanvas);\r\n    const layersCanvas = BB.canvas(width, height);\r\n    const layersCtx = BB.ctx(layersCanvas);\r\n    const previewCanvas = BB.canvas(width, height); // the one that is visible\r\n    const previewCtx = BB.ctx(previewCanvas);\r\n    BB.css(previewCanvas, {\r\n        display: 'block',\r\n    });\r\n    const previewWrapper = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'relative',\r\n            width: width + 'px',\r\n            marginLeft: '-20px',\r\n            cursor: 'move',\r\n            touchAction: 'none',\r\n        },\r\n        onClick: () => textInput.focus(),\r\n    });\r\n    BB.el({ // inset shadow on preview\r\n        parent: previewWrapper,\r\n        className: 'kl-text-preview-wrapper',\r\n    });\r\n    previewWrapper.append(previewCanvas);\r\n    let checkerPattern = throwIfNull(previewCtx.createPattern(BB.createCheckerCanvas(8, theme.isDark()), 'repeat'));\r\n    const emptyCanvas = BB.canvas(1, 1);\r\n    const emptyCanvasLight = BB.canvas(1, 1);\r\n    {\r\n        let ctx = BB.ctx(emptyCanvas);\r\n        ctx.fillRect(0, 0, 1, 1);\r\n\r\n        ctx = BB.ctx(emptyCanvasLight);\r\n        ctx.fillStyle = '#fff';\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    }\r\n\r\n    function updateCheckerboard (): void {\r\n        checkerPattern = throwIfNull(previewCtx.createPattern(BB.createCheckerCanvas(8, theme.isDark()), 'repeat'));\r\n        updatePreview();\r\n    }\r\n    theme.addIsDarkListener(updateCheckerboard);\r\n\r\n    function updatePreview (): void {\r\n\r\n        // try to draw very much like klCanvasWorkspace\r\n\r\n        // --- draw text ---\r\n        textCtx.clearRect(0, 0, textCanvas.width, textCanvas.height);\r\n        const colorRGBA = {\r\n            ...p.color,\r\n            a: opacitySlider.getValue(),\r\n        };\r\n        const bounds = renderText(textCanvas, {\r\n            x: p.x,\r\n            y: p.y,\r\n            textStr: textInput.value,\r\n            align: alignRadioList.getValue(),\r\n            isItalic: italicToggle.getValue(),\r\n            isBold: boldToggle.getValue(),\r\n            size: parseFloat(sizeInput.value),\r\n            font: fontSelect.getValue(),\r\n            color: BB.ColorConverter.toRgbaStr(colorRGBA),\r\n            angleRad: p.angleRad,\r\n        });\r\n\r\n\r\n        // --- determine transformation of viewport ---\r\n        // text should always be visible\r\n        bounds.width = Math.max(bounds.width, 1);\r\n        bounds.height = Math.max(bounds.height, 1);\r\n        const rotatedXY = BB.rotate(bounds.x, bounds.y, -p.angleRad / Math.PI * 180);\r\n        const rotatedWH = BB.rotate(bounds.width, bounds.height, -p.angleRad / Math.PI * 180);\r\n        const centerX = p.x + rotatedXY.x + rotatedWH.x / 2;\r\n        const centerY = p.y + rotatedXY.y + rotatedWH.y / 2;\r\n\r\n        const padding = 100;\r\n        const fitBounds = BB.fitInto(bounds.width, bounds.height, width - padding, height - padding);\r\n        scale = Math.min(1, fitBounds.width / bounds.width);\r\n        scale = Math.min(4, scale * Math.pow(2, zoomFac));\r\n\r\n\r\n        // --- compose text and target layer ---\r\n        targetCtx.save();\r\n\r\n        if (scale >= 4) {\r\n            targetCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            targetCtx.imageSmoothingEnabled = true;\r\n            targetCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n        }\r\n\r\n        targetCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        targetCtx.translate(width / 2, height / 2);\r\n        targetCtx.scale(scale, scale);\r\n        targetCtx.rotate(p.angleRad);\r\n        targetCtx.drawImage(layerArr[p.layerIndex].canvas, -centerX, -centerY);\r\n        targetCtx.drawImage(textCanvas, -centerX, -centerY);\r\n        targetCtx.restore();\r\n\r\n        const isDark = theme.isDark();\r\n\r\n        // --- layers ---\r\n        layersCtx.save();\r\n\r\n        layersCtx.fillStyle = isDark ? 'rgb(33,33,33)' : 'rgb(158,158,158)';\r\n        layersCtx.fillRect(0, 0, width, height);\r\n\r\n        { // bg\r\n            layersCtx.save();\r\n\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n\r\n            layersCtx.imageSmoothingEnabled = false;\r\n\r\n            //outline\r\n            const borderSize = 1 / scale;\r\n            layersCtx.globalAlpha = isDark ? 0.25 : 0.2;\r\n            layersCtx.drawImage(isDark ? emptyCanvasLight : emptyCanvas, -centerX - borderSize, -centerY - borderSize, textCanvas.width + borderSize * 2, textCanvas.height + borderSize * 2);\r\n            layersCtx.globalAlpha = 1;\r\n\r\n            //erase\r\n            layersCtx.globalCompositeOperation = 'destination-out';\r\n            layersCtx.drawImage(emptyCanvas, -centerX, -centerY, textCanvas.width, textCanvas.height);\r\n\r\n            layersCtx.restore();\r\n        }\r\n\r\n        { // individual layers\r\n\r\n            if (scale >= 4) {\r\n                layersCtx.imageSmoothingEnabled = false;\r\n            } else {\r\n                layersCtx.imageSmoothingEnabled = true;\r\n                layersCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n            }\r\n\r\n            // layers below\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (let i = 0; i < p.layerIndex; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n            // target layer\r\n            layersCtx.globalAlpha = layerArr[p.layerIndex].opacity;\r\n            layersCtx.globalCompositeOperation = layerArr[p.layerIndex].mixModeStr;\r\n            layersCtx.drawImage(targetCanvas, 0, 0);\r\n\r\n            // layers above\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (let i = p.layerIndex + 1; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n        }\r\n\r\n        layersCtx.restore();\r\n\r\n\r\n\r\n        // --- final composite ---\r\n        previewCtx.save();\r\n        previewCtx.fillStyle = checkerPattern;\r\n        previewCtx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        previewCtx.drawImage(layersCanvas, 0, 0);\r\n        previewCtx.restore();\r\n\r\n        // bounds\r\n        previewCtx.save();\r\n        previewCtx.globalCompositeOperation = 'difference';\r\n        previewCtx.strokeStyle = '#fff';\r\n        previewCtx.lineWidth = 1;\r\n        // centerX = p.x + bounds.x + bounds.width / 2;\r\n        // centerY = p.y + bounds.y + bounds.height / 2;\r\n        previewCtx.strokeRect(\r\n            Math.round(width / 2 - (bounds.width / 2) * scale),\r\n            Math.round(height / 2 - (bounds.height / 2) * scale),\r\n            Math.round(bounds.width * scale),\r\n            Math.round(bounds.height * scale)\r\n        );\r\n        previewCtx.restore();\r\n\r\n    }\r\n\r\n    theme.addIsDarkListener(updatePreview);\r\n\r\n    /**\r\n     * Move text by x y\r\n     */\r\n    function move (x: number, y: number): void {\r\n        const rotated = BB.rotate(x, y, -p.angleRad / Math.PI * 180);\r\n        p.x += rotated.x / scale;\r\n        p.y += rotated.y / scale;\r\n        updatePreview();\r\n    }\r\n\r\n    const previewPointerListener = new BB.PointerListener({\r\n        target: previewCanvas,\r\n        onPointer: (e) => {\r\n            if (e.type === 'pointermove' && e.button) {\r\n                e.eventPreventDefault();\r\n                move(-e.dX, -e.dY);\r\n            }\r\n        },\r\n        onWheel: (e) => {\r\n            changeZoomFac(-e.deltaY);\r\n        },\r\n    });\r\n\r\n    const wheelPrevent = (event: WheelEvent): void => event.preventDefault();\r\n    previewCanvas.addEventListener('wheel', wheelPrevent);\r\n\r\n\r\n\r\n    const row1 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            marginTop: '10px',\r\n        },\r\n    });\r\n    const row2n3Wrapper = BB.el({\r\n        parent: div,\r\n        css: isSmallWidth ? {} : {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n        },\r\n    });\r\n    const row2 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginTop: '5px',\r\n        },\r\n    });\r\n    const row3 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n            marginTop: '5px',\r\n            width: isSmallWidth ? '' : '300px',\r\n        },\r\n    });\r\n\r\n    // --- row 1 ---\r\n\r\n    // color\r\n    const colorOptionsArr = [\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 255, g: 255, b: 255, a: 1},\r\n    ];\r\n    colorOptionsArr.unshift({\r\n        r: p.secondaryColor.r,\r\n        g: p.secondaryColor.g,\r\n        b: p.secondaryColor.b,\r\n        a: 1,\r\n    });\r\n    colorOptionsArr.unshift({\r\n        r: p.color.r,\r\n        g: p.color.g,\r\n        b: p.color.b,\r\n        a: 1,\r\n    });\r\n\r\n    const colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        initialIndex: 0,\r\n        onChange: (rgbaObj) => {\r\n            p.color = rgbaObj;\r\n            updatePreview();\r\n        },\r\n    });\r\n    colorOptions.getElement().title = LANG('text-color');\r\n    colorOptions.getElement().style.marginLeft = '-5px';\r\n    row1.append(colorOptions.getElement());\r\n\r\n\r\n    let zoomFac = 0;\r\n\r\n    function changeZoomFac (d: number): void {\r\n        zoomFac = Math.min(2, Math.max(-2, zoomFac + d));\r\n        updatePreview();\r\n        zoomInBtn.disabled = !canZoom(1);\r\n        zoomOutBtn.disabled = !canZoom(-1);\r\n    }\r\n\r\n    function canZoom (d: number): boolean {\r\n        return zoomFac !== Math.min(2, Math.max(-2, zoomFac + d));\r\n    }\r\n\r\n    const zoomWrapper = BB.el({\r\n        parent: row1,\r\n    });\r\n\r\n    const zoomInBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomInImg}\">`,\r\n        title: LANG('zoom-in'),\r\n        tagName: 'button',\r\n        onClick: () => changeZoomFac(1),\r\n        css: {\r\n            fontWeight: 'bold',\r\n        },\r\n    }) as HTMLButtonElement;\r\n    const zoomOutBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomOutImg}\">`,\r\n        title: LANG('zoom-out'),\r\n        tagName: 'button',\r\n        onClick: () => changeZoomFac(-1),\r\n        css: {\r\n            fontWeight: 'bold',\r\n            marginLeft: '5px',\r\n        },\r\n    }) as HTMLButtonElement;\r\n\r\n\r\n\r\n    // --- row 2 ---\r\n    const sizeInput = BB.el({\r\n        parent: row2,\r\n        tagName: 'input',\r\n        title: LANG('text-size'),\r\n        custom: {\r\n            type: 'number',\r\n            min: 1,\r\n            max: 10000,\r\n            value: p.size,\r\n        },\r\n        css: {\r\n            width: '60px',\r\n        },\r\n        onChange: () => {\r\n            sizeInput.value = '' + Math.max(1, Math.min(10000, parseInt(sizeInput.value)));\r\n            updatePreview();\r\n        },\r\n    }) as HTMLInputElement;\r\n    const sizePointerListener = new BB.PointerListener({\r\n        target: sizeInput,\r\n        onWheel: (e) => {\r\n            sizeInput.value = '' + Math.max(1, Math.min(1000, parseInt(sizeInput.value) - e.deltaY));\r\n            updatePreview();\r\n        },\r\n    });\r\n\r\n\r\n    const modeWrapper = BB.el({\r\n        css: {\r\n            fontSize: '15px',\r\n            marginLeft: '10px',\r\n        },\r\n    });\r\n\r\n    const fontSelect = new Select<TTextFont>({\r\n        isFocusable: true,\r\n        optionArr: [\r\n            ['sans-serif', 'Sans-serif'],\r\n            ['serif', 'Serif'],\r\n            ['monospace', 'Monospace'],\r\n            ['cursive', 'Cursive'],\r\n            ['fantasy', 'Fantasy'],\r\n        ],\r\n        initValue: p.font,\r\n        onChange: () => updatePreview(),\r\n    });\r\n\r\n    modeWrapper.append(fontSelect.getElement());\r\n    row2.append(modeWrapper);\r\n\r\n    const fontPointerListener = new BB.PointerListener({\r\n        target: fontSelect.getElement(),\r\n        onWheel: (e) => fontSelect.setDeltaValue(e.deltaY),\r\n    });\r\n\r\n\r\n    // --- row 3 ---\r\n\r\n    const alignRadioList = new ImageRadioList<TTextFormat>({\r\n        optionArr: [\r\n            {\r\n                id: 'left',\r\n                title: LANG('text-left'),\r\n                image: alignLeftImg,\r\n                darkInvert: true,\r\n            },\r\n            {\r\n                id: 'center',\r\n                title: LANG('text-center'),\r\n                image: alignCenterImg,\r\n                darkInvert: true,\r\n            },\r\n            {\r\n                id: 'right',\r\n                title: LANG('text-right'),\r\n                image: alignRightImg,\r\n                darkInvert: true,\r\n            },\r\n        ],\r\n        initId: p.align,\r\n        onChange: () => updatePreview(),\r\n    });\r\n    row3.append(alignRadioList.getElement());\r\n\r\n    const italicToggle = new ImageToggle({\r\n        image: typoItalicImg,\r\n        title: LANG('text-italic'),\r\n        initValue: p.isItalic,\r\n        onChange: () => updatePreview(),\r\n        darkInvert: true,\r\n    });\r\n    row3.append(italicToggle.getElement());\r\n\r\n    const boldToggle = new ImageToggle({\r\n        image: typoBoldImg,\r\n        title: LANG('text-bold'),\r\n        initValue: p.isBold,\r\n        onChange: () => updatePreview(),\r\n        darkInvert: true,\r\n    });\r\n    row3.append(boldToggle.getElement());\r\n\r\n\r\n\r\n    const opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 150,\r\n        height: 30,\r\n        min: 1 / 100,\r\n        max: 1,\r\n        value: p.opacity,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        toValue: (displayValue) => displayValue / 100,\r\n        toDisplayValue: (value) => value * 100,\r\n        onChange: () => updatePreview(),\r\n    });\r\n    row3.append(opacitySlider.getElement());\r\n\r\n\r\n\r\n    const textInput = BB.el({\r\n        parent: div,\r\n        tagName: 'textarea',\r\n        custom: {\r\n            placeholder: LANG('text-placeholder'),\r\n            'data-ignore-focus': 'true',\r\n        },\r\n        css: {\r\n            whiteSpace: 'pre',\r\n            overflow: 'auto',\r\n            width: '100%',\r\n            height: '70px',\r\n            resize: 'vertical',\r\n            marginTop: '10px',\r\n        },\r\n        onChange: () => updatePreview(),\r\n    }) as HTMLTextAreaElement;\r\n    textInput.addEventListener('input', updatePreview);\r\n    setTimeout(() => {\r\n        textInput.focus();\r\n        textInput.select();\r\n    });\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: (keyStr) => {\r\n            if (BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        },\r\n    });\r\n\r\n    // prevent mobile keyboards scrolling page\r\n    function onScroll (): void {\r\n        window.scrollTo(0, 0);\r\n    }\r\n    window.addEventListener('scroll', onScroll);\r\n\r\n\r\n    showModal({\r\n        target: document.body,\r\n        message: `<b>${LANG('text-title')}</b>`,\r\n        div: div,\r\n        buttons: ['Ok', 'Cancel'],\r\n        style: isSmallWidth ? {} : {\r\n            width: '500px',\r\n        },\r\n        callback: (val) => {\r\n            const result: TTextToolResult = {\r\n                x: p.x,\r\n                y: p.y,\r\n                textStr: textInput.value,\r\n                align: alignRadioList.getValue(),\r\n                isItalic: italicToggle.getValue(),\r\n                isBold: boldToggle.getValue(),\r\n                color: p.color,\r\n                size: Number(sizeInput.value),\r\n                font: fontSelect.getValue(),\r\n                opacity: opacitySlider.getValue(),\r\n            };\r\n\r\n            theme.removeIsDarkListener(updatePreview);\r\n            window.removeEventListener('scroll', onScroll);\r\n            textInput.removeEventListener('input', updatePreview);\r\n            BB.destroyEl(textInput);\r\n            previewPointerListener.destroy();\r\n            sizePointerListener.destroy();\r\n            fontPointerListener.destroy();\r\n            previewCanvas.removeEventListener('wheel', wheelPrevent);\r\n            BB.destroyEl(previewWrapper);\r\n            BB.destroyEl(zoomInBtn);\r\n            BB.destroyEl(zoomOutBtn);\r\n            BB.destroyEl(sizeInput);\r\n            colorOptions.destroy();\r\n            fontSelect.destroy();\r\n            keyListener.destroy();\r\n            alignRadioList.destroy();\r\n            italicToggle.destroy();\r\n            boldToggle.destroy();\r\n            opacitySlider.destroy();\r\n            theme.removeIsDarkListener(updateCheckerboard);\r\n            if (val === 'Ok') {\r\n                p.onConfirm(result);\r\n            }\r\n        },\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        ignoreBackground: true,\r\n    });\r\n\r\n    updatePreview();\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2WSh2\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"lHK8L\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3kjmQ\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"g8nvA\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"axEKL\");","import {BB} from '../../../bb/bb';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {showModal} from './base/showModal';\r\nimport {LANG} from '../../../language/language';\r\nimport {IKeyString, IRect} from '../../../bb/bb-types';\r\nimport {IKlPsd, TKlPsdError} from '../../kl-types';\r\n\r\n/**\r\n * Shows first dialog when importing an image.\r\n * Where you can crop, and select import as layer or as image.\r\n */\r\nexport function showImportImageDialog (\r\n    p: {\r\n        image: IKlPsd | {\r\n            type: 'image';\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLImageElement | HTMLCanvasElement;\r\n        };\r\n        maxSize: number;\r\n        target: HTMLElement;\r\n        callback: (\r\n            val: {\r\n                type: 'as-image' | 'as-layer';\r\n                image: HTMLImageElement | HTMLCanvasElement;\r\n            } | {\r\n                type: 'as-image-psd';\r\n                image: IKlPsd;\r\n                cropObj: IRect;\r\n            } | {\r\n                type: 'cancel';\r\n            }\r\n        ) => void;\r\n    }\r\n): void {\r\n    const rootEl = BB.el();\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n    const style: IKeyString = isSmall ? {} : { width: '500px' };\r\n\r\n    const resolutionEl = BB.el({\r\n        css: {\r\n            marginTop: '10px',\r\n            textAlign: 'center',\r\n            color: '#888',\r\n            lineHeight: '20px',\r\n        },\r\n    });\r\n\r\n    const cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 400,\r\n        canvas: p.image.canvas,\r\n        isNotCopy: true,\r\n        onChange: (width, height): void => {\r\n            if (!resolutionEl) {\r\n                return;\r\n            }\r\n            updateResolution(width, height);\r\n        },\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginLeft: '-20px',\r\n    });\r\n    cropCopy.getEl().title = LANG('crop-drag-to-crop');\r\n\r\n    rootEl.append(cropCopy.getEl(), resolutionEl);\r\n\r\n    function updateResolution (w: number, h: number): void {\r\n        const fit = BB.fitInto(w, h, p.maxSize, p.maxSize);\r\n\r\n        if (fit.width < w) {\r\n            resolutionEl.innerHTML = `<span class=\"kl-text-error\">${w} X ${h}</span>  ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\r\n            resolutionEl.title = LANG('import-too-large');\r\n        } else {\r\n            resolutionEl.innerHTML = `${w} X ${h}`;\r\n            resolutionEl.title = '';\r\n        }\r\n    }\r\n    updateResolution(p.image.width, p.image.height);\r\n\r\n\r\n    let doFlatten = false;\r\n    function showWarnings (psdWarningArr: TKlPsdError[]): void {\r\n        const contentArr = [];\r\n        const warningMap = {\r\n            'mask': 'Masks not supported. Mask was applied.',\r\n            'clipping': 'Clipping not supported. Clipping layers were merged.',\r\n            'group': 'Groups not supported. Layers were ungrouped.',\r\n            'adjustment': 'Adjustment layers not supported.',\r\n            'layer-effect': 'Layer effects not supported.',\r\n            'smart-object': 'Smart objects not supported.',\r\n            'blend-mode': 'Unsupported layer blend mode.',\r\n            'bits-per-channel': 'Unsupported color depth. Only 8bit per channel supported.',\r\n        };\r\n        for (let i = 0; i < psdWarningArr.length; i++) {\r\n            contentArr.push('- ' + warningMap[psdWarningArr[i]]);\r\n        }\r\n        alert(contentArr.join('\\n'));\r\n    }\r\n\r\n    let flattenCheckbox: Checkbox;\r\n    let warningsEl: HTMLElement | undefined;\r\n    if (p.image.type === 'psd') {\r\n        if (p.image.layers) {\r\n            flattenCheckbox = new Checkbox({\r\n                init: doFlatten,\r\n                label: LANG('import-flatten'),\r\n                callback: (b): void => {\r\n                    doFlatten = b;\r\n                },\r\n            });\r\n            rootEl.append(flattenCheckbox.getElement());\r\n\r\n            if (p.image.warningArr) {\r\n                const noteEl = BB.el({\r\n                    className: 'kl-import-note',\r\n                    content: LANG('import-psd-limited-support'),\r\n                });\r\n                const warnings = p.image.warningArr;\r\n                warningsEl = BB.el({\r\n                    parent: noteEl,\r\n                    tagName: 'a',\r\n                    content: 'Details',\r\n                    css: { marginLeft: '5px'},\r\n                    onClick: () => showWarnings(warnings),\r\n                });\r\n                rootEl.append(noteEl);\r\n            }\r\n        } else {\r\n            const noteEl = BB.el({\r\n                className: 'kl-import-note',\r\n                content: LANG('import-psd-unsupported'),\r\n            });\r\n            rootEl.append(noteEl);\r\n        }\r\n    }\r\n\r\n    function callback (result: string): void {\r\n        const croppedImage = cropCopy.getCroppedImage();\r\n        const cropRect = cropCopy.getRect();\r\n        const isCropped = p.image.width !== cropRect.width && p.image.height !== cropRect.height;\r\n        cropCopy.destroy();\r\n        BB.destroyEl(warningsEl);\r\n        if (flattenCheckbox) {\r\n            flattenCheckbox.destroy();\r\n        }\r\n\r\n        if (result === LANG('import-btn-as-layer')) {\r\n            p.callback({\r\n                type: 'as-layer',\r\n                image: isCropped ? croppedImage : p.image.canvas,\r\n            });\r\n\r\n        } else if (result === LANG('import-btn-as-image')) {\r\n            if (p.image.type === 'psd') {\r\n                if (doFlatten) {\r\n                    delete p.image.layers;\r\n                }\r\n                p.callback({\r\n                    type: 'as-image-psd',\r\n                    image: p.image,\r\n                    cropObj: cropRect,\r\n                });\r\n            } else if (p.image.type === 'image') {\r\n                p.callback({\r\n                    type: 'as-image',\r\n                    image: croppedImage,\r\n                });\r\n            }\r\n        } else {\r\n            p.callback({\r\n                type: 'cancel',\r\n            });\r\n        }\r\n    }\r\n    showModal({\r\n        target: p.target,\r\n        message: `<b>${LANG('import-title')}</b>`,\r\n        div: rootEl,\r\n        style,\r\n        buttons: [LANG('import-btn-as-layer'), LANG('import-btn-as-image'), 'Cancel'],\r\n        primaries: [LANG('import-btn-as-layer'), LANG('import-btn-as-image')],\r\n        callback,\r\n        autoFocus: 'As Image',\r\n    });\r\n}","import {createCanvas} from '../../bb/base/create-canvas';\r\nimport {BlendMode, Layer, Psd} from 'ag-psd/dist/psd';\r\nimport {IKlProject, IKlPsd, TKlPsdError, TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {MAX_LAYERS} from '../canvas/kl-canvas';\r\nimport {BB} from '../../bb/bb';\r\n\r\nlet kl2PsdMap: Record<TMixMode, BlendMode>;\r\nlet psd2KlMap: Record<BlendMode, TMixMode>;\r\n\r\nfunction init (): void {\r\n    if (kl2PsdMap) {\r\n        return;\r\n    }\r\n    kl2PsdMap = {\r\n        'source-over': 'normal',\r\n\r\n        'darken': 'darken',\r\n        'multiply': 'multiply',\r\n        'color-burn': 'color burn',\r\n\r\n        'lighten': 'lighten',\r\n        'screen': 'screen',\r\n        'color-dodge': 'color dodge',\r\n\r\n        'overlay': 'overlay',\r\n        'soft-light': 'soft light',\r\n        'hard-light': 'hard light',\r\n\r\n        'difference': 'difference',\r\n        'exclusion': 'exclusion',\r\n\r\n        'hue': 'hue',\r\n        'saturation': 'saturation',\r\n        'color': 'color',\r\n        'luminosity': 'luminosity',\r\n    };\r\n    psd2KlMap = Object.fromEntries(Object.entries(kl2PsdMap).map(a => a.reverse()));\r\n}\r\n\r\nexport function blendPsdToKl (str: BlendMode): TMixMode {\r\n    init();\r\n    return psd2KlMap[str];\r\n}\r\n\r\nexport function blendKlToPsd (str: TMixMode): BlendMode {\r\n    init();\r\n    return kl2PsdMap[str];\r\n}\r\n\r\n\r\n/**\r\n * Converts ag-psd object into something that KlCanvas can represent\r\n * @param psdObj\r\n */\r\nexport function readPsd (psdObj: Psd): IKlPsd {\r\n    if (!psdObj.canvas) {\r\n        throw new Error('psdObj.canvas undefined');\r\n    }\r\n    const result: IKlPsd = {\r\n        type: 'psd',\r\n        canvas: psdObj.canvas,\r\n        width: psdObj.width,\r\n        height: psdObj.height,\r\n    };\r\n\r\n    function addWarning (warningStr: TKlPsdError): void {\r\n        if (!result.warningArr) {\r\n            result.warningArr = [];\r\n        }\r\n        if (result.warningArr.includes(warningStr)) {\r\n            return;\r\n        }\r\n        result.warningArr.push(warningStr);\r\n    }\r\n\r\n    function getMixModeStr (blendMode: BlendMode): TMixMode {\r\n        let mixModeStr: TMixMode = blendPsdToKl(blendMode);\r\n        if (!mixModeStr) {\r\n            addWarning('blend-mode');\r\n            mixModeStr = 'source-over';\r\n        }\r\n        return mixModeStr;\r\n    }\r\n\r\n    if (psdObj.bitsPerChannel !== 8) {\r\n        addWarning('bits-per-channel');\r\n    }\r\n\r\n    if (!psdObj.children) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    // count resulting layers\r\n    const maxLayers = MAX_LAYERS;\r\n    let layerCount = 0;\r\n    function countWithinGroup (groupObj: Layer): number {\r\n        let result = 0;\r\n        if (groupObj.blendMode) {\r\n            const mixModeStr = blendPsdToKl(groupObj.blendMode);\r\n            if (mixModeStr && mixModeStr !== 'source-over') {\r\n                return 1;\r\n            }\r\n        }\r\n        if (groupObj.children) {\r\n            for (let i = 0; i < groupObj.children.length; i++) {\r\n                const item = groupObj.children[i];\r\n                if (item.clipping || item.adjustment) {\r\n                    continue;\r\n                }\r\n\r\n                if (item.children) {\r\n                    addWarning('group');\r\n                    result += countWithinGroup(item);\r\n                } else {\r\n                    result++;\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    layerCount += countWithinGroup(psdObj);\r\n    if (layerCount > maxLayers) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    result.layers = [];\r\n\r\n    function prepareMask (maskCanvas: HTMLCanvasElement, defaultColor: number): void {\r\n        const groupMaskCtx = BB.ctx(maskCanvas);\r\n        const imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n        if (defaultColor === 0) {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = imData.data[i];\r\n            }\r\n        } else {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = 255 - imData.data[i];\r\n            }\r\n        }\r\n        groupMaskCtx.putImageData(imData, 0, 0);\r\n    }\r\n\r\n    function convertGroup (psdGroupObj: Layer): {\r\n        name: string;\r\n        mixModeStr: TMixMode;\r\n        opacity: number;\r\n        image: HTMLCanvasElement;\r\n    }[] {\r\n\r\n        let resultArr: {\r\n            name: string;\r\n            mixModeStr: TMixMode;\r\n            opacity: number;\r\n            image: HTMLCanvasElement;\r\n        }[] = [];\r\n        const groupOpacity = psdGroupObj.hidden ? 0 : psdGroupObj.opacity;\r\n        const groupMixModeStr = getMixModeStr(psdGroupObj.blendMode!);\r\n        let groupCanvas;\r\n        let groupCtx;\r\n        if (groupMixModeStr !== 'source-over') {\r\n            groupCanvas = createCanvas(result.width, result.height);\r\n            groupCtx = BB.ctx(groupCanvas);\r\n        }\r\n\r\n        // prepare group mask\r\n        if (psdGroupObj.mask) {\r\n            addWarning('mask');\r\n            prepareMask(psdGroupObj.mask.canvas!, psdGroupObj.mask.defaultColor!);\r\n        }\r\n\r\n        if (psdGroupObj.children) {\r\n            for (let i = 0; i < psdGroupObj.children.length; i++) {\r\n                const item = psdGroupObj.children[i];\r\n                if (item.clipping) {\r\n                    continue;\r\n                }\r\n                if (item.adjustment) {\r\n                    addWarning('adjustment');\r\n                    continue;\r\n                }\r\n\r\n                const hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\r\n                if (hasClipping) {\r\n                    addWarning('clipping');\r\n                }\r\n\r\n                if (item.children) {\r\n                    const innerArr = convertGroup(item);\r\n\r\n                    for (let e = 0; e < innerArr.length; e++) {\r\n                        const innerItem = innerArr[e];\r\n                        const innerCtx = BB.ctx(innerItem.image);\r\n\r\n                        // clipping\r\n                        if (hasClipping) {\r\n                            const clippingCanvas = createCanvas(result.width, result.height);\r\n                            const clippingCtx = BB.ctx(clippingCanvas);\r\n                            clippingCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                            for (let f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++) {\r\n                                const clippingItem = psdGroupObj.children[f];\r\n                                if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                                    continue;\r\n                                }\r\n                                if (clippingItem.blendMode === undefined) {\r\n                                    throw new Error('clippingItem.blendMode undefined');\r\n                                }\r\n                                if (clippingItem.opacity === undefined) {\r\n                                    throw new Error('clippingItem.opacity undefined');\r\n                                }\r\n                                if (clippingItem.canvas === undefined) {\r\n                                    throw new Error('clippingItem.canvas undefined');\r\n                                }\r\n                                if (clippingItem.left === undefined) {\r\n                                    throw new Error('clippingItem.left undefined');\r\n                                }\r\n                                if (clippingItem.top === undefined) {\r\n                                    throw new Error('clippingItem.top undefined');\r\n                                }\r\n                                clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                                clippingCtx.globalAlpha = clippingItem.opacity;\r\n                                clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\r\n                            }\r\n\r\n                            innerCtx.globalCompositeOperation = 'source-atop';\r\n                            innerCtx.drawImage(clippingCanvas, 0, 0);\r\n                        }\r\n\r\n\r\n\r\n                        // group mask\r\n                        if (psdGroupObj.mask) {\r\n                            innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                            if (psdGroupObj.mask.canvas === undefined) {\r\n                                throw new Error('psdGroupObj.mask.canvas undefined');\r\n                            }\r\n                            if (psdGroupObj.mask.left === undefined) {\r\n                                throw new Error('psdGroupObj.mask.left undefined');\r\n                            }\r\n                            if (psdGroupObj.mask.top === undefined) {\r\n                                throw new Error('psdGroupObj.mask.top undefined');\r\n                            }\r\n                            innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n                        }\r\n\r\n                        if (groupCanvas) {\r\n                            if (groupCtx === undefined) {\r\n                                throw new Error('groupCtx undefined');\r\n                            }\r\n                            groupCtx.globalCompositeOperation = innerItem.mixModeStr;\r\n                            groupCtx.globalAlpha = innerItem.opacity;\r\n                            groupCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                        } else {\r\n                            if (groupOpacity === undefined) {\r\n                                throw new Error('groupOpacity undefined');\r\n                            }\r\n                            innerItem.opacity = innerItem.opacity * groupOpacity;\r\n                            resultArr.push(innerItem);\r\n                        }\r\n                    }\r\n\r\n                    continue;\r\n                }\r\n\r\n                const canvas = createCanvas(result.width, result.height);\r\n                const ctx = BB.ctx(canvas);\r\n                if (item.canvas) { // if a layer is empty it has no canvas\r\n                    if (item.top === undefined) {\r\n                        throw new Error('item.top undefined');\r\n                    }\r\n                    if (item.left === undefined) {\r\n                        throw new Error('item.left undefined');\r\n                    }\r\n                    ctx.drawImage(item.canvas, item.left, item.top);\r\n                }\r\n\r\n                // effects\r\n                if (item.effects) {\r\n                    addWarning('layer-effect');\r\n                }\r\n\r\n                // mask\r\n                if (item.mask) {\r\n                    addWarning('mask');\r\n                    if (item.mask.canvas === undefined) {\r\n                        throw new Error('item.mask.canvas undefined');\r\n                    }\r\n                    if (item.mask.defaultColor === undefined) {\r\n                        throw new Error('item.mask.defaultColor undefined');\r\n                    }\r\n                    if (item.mask.left === undefined) {\r\n                        throw new Error('item.mask.left undefined');\r\n                    }\r\n                    if (item.mask.top === undefined) {\r\n                        throw new Error('item.mask.top undefined');\r\n                    }\r\n                    prepareMask(item.mask.canvas, item.mask.defaultColor);\r\n\r\n                    ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                    ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\r\n                }\r\n\r\n                // clipping\r\n                if (hasClipping) {\r\n                    if (item.right === undefined) {\r\n                        throw new Error('item.right undefined');\r\n                    }\r\n                    if (item.left === undefined) {\r\n                        throw new Error('item.left undefined');\r\n                    }\r\n                    if (item.bottom === undefined) {\r\n                        throw new Error('item.bottom undefined');\r\n                    }\r\n                    if (item.top === undefined) {\r\n                        throw new Error('item.top undefined');\r\n                    }\r\n                    if (item.canvas === undefined) {\r\n                        throw new Error('item.canvas undefined');\r\n                    }\r\n                    const clippingCanvas = createCanvas(item.right - item.left, item.bottom - item.top);\r\n                    const clippingCtx = BB.ctx(clippingCanvas);\r\n                    clippingCtx.drawImage(item.canvas, 0, 0);\r\n\r\n                    for (let e = i + 1; e < psdGroupObj.children.length && psdGroupObj.children[e].clipping; e++) {\r\n                        const clippingItem = psdGroupObj.children[e];\r\n                        if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                            continue;\r\n                        }\r\n                        if (clippingItem.blendMode === undefined) {\r\n                            throw new Error('clippingItem.blendMode undefined');\r\n                        }\r\n                        if (clippingItem.opacity === undefined) {\r\n                            throw new Error('clippingItem.opacity undefined');\r\n                        }\r\n                        if (clippingItem.canvas === undefined) {\r\n                            throw new Error('clippingItem.canvas undefined');\r\n                        }\r\n                        if (clippingItem.left === undefined) {\r\n                            throw new Error('clippingItem.left undefined');\r\n                        }\r\n                        if (clippingItem.top === undefined) {\r\n                            throw new Error('clippingItem.top undefined');\r\n                        }\r\n                        clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                        clippingCtx.globalAlpha = clippingItem.opacity;\r\n                        clippingCtx.drawImage(clippingItem.canvas, clippingItem.left - item.left, clippingItem.top - item.top);\r\n                    }\r\n\r\n                    ctx.globalCompositeOperation = 'source-atop';\r\n                    ctx.drawImage(clippingCanvas, item.left, item.top);\r\n                }\r\n\r\n                // group mask\r\n                if (psdGroupObj.mask) {\r\n                    ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                    if (psdGroupObj.mask.canvas === undefined) {\r\n                        throw new Error('psdGroupObj.mask.canvas undefined');\r\n                    }\r\n                    if (psdGroupObj.mask.left === undefined) {\r\n                        throw new Error('psdGroupObj.mask.left undefined');\r\n                    }\r\n                    if (psdGroupObj.mask.top === undefined) {\r\n                        throw new Error('psdGroupObj.mask.top undefined');\r\n                    }\r\n                    ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n                }\r\n\r\n                if (groupOpacity === undefined) {\r\n                    throw new Error('groupOpacity undefined');\r\n                }\r\n                if (item.blendMode === undefined) {\r\n                    throw new Error('item.blendMode undefined');\r\n                }\r\n                if (item.hidden  === undefined) {\r\n                    throw new Error('item.hidden  undefined');\r\n                }\r\n                if (item.opacity === undefined) {\r\n                    throw new Error('item.opacity undefined');\r\n                }\r\n\r\n                if (groupCanvas && groupCtx) {\r\n                    if (groupOpacity > 0) {\r\n                        groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\r\n                        groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\r\n                        groupCtx.drawImage(canvas, 0, 0);\r\n                    }\r\n\r\n                } else {\r\n                    if (item.name === undefined) {\r\n                        throw new Error('item.name undefined');\r\n                    }\r\n                    resultArr.push({\r\n                        name: item.name,\r\n                        opacity: (item.hidden ? 0 : item.opacity) * groupOpacity,\r\n                        mixModeStr: getMixModeStr(item.blendMode),\r\n                        image: canvas,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        if (groupCanvas) {\r\n            if (psdGroupObj.name === undefined) {\r\n                throw new Error('psdGroupObj.name undefined');\r\n            }\r\n            if (groupOpacity === undefined) {\r\n                throw new Error('groupOpacity undefined');\r\n            }\r\n            resultArr = [\r\n                {\r\n                    name: psdGroupObj.name,\r\n                    opacity: groupOpacity,\r\n                    mixModeStr: groupMixModeStr,\r\n                    image: groupCanvas,\r\n                },\r\n            ];\r\n        }\r\n\r\n        return resultArr;\r\n    }\r\n\r\n    result.layers = convertGroup({\r\n        name: 'root',\r\n        opacity: 1,\r\n        blendMode: 'normal',\r\n        children: psdObj.children,\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\nexport function klPsdToKlProject (klPsd: IKlPsd): IKlProject {\r\n    // only share references to Canvas elements\r\n    const result: IKlProject = {\r\n        width: klPsd.width,\r\n        height: klPsd.height,\r\n        layers: [],\r\n    };\r\n    if (klPsd.layers) {\r\n        result.layers = klPsd.layers.map(item => {\r\n            return {\r\n                name: item.name,\r\n                opacity: item.opacity,\r\n                mixModeStr: item.mixModeStr,\r\n                image: item.image,\r\n            };\r\n        });\r\n    } else {\r\n        // flattened\r\n        result.layers = [{\r\n            name: LANG('background'),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over',\r\n            image: klPsd.canvas,\r\n        }];\r\n    }\r\n    return result;\r\n}","import {IKlStorageProject} from '../kl-types';\r\n\r\nconst indexedDbIsSupported = !!window.indexedDB;\r\nlet dbNameStr = 'Klecks';\r\nconst storageNameStr = 'ProjectStore';\r\n\r\nexport function setDbName (name: string): void {\r\n    dbNameStr = '' + name;\r\n}\r\n\r\n/**\r\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\r\n * with index 'id'\r\n *\r\n * @param actionFunction what to execute during transaction\r\n * @param successCallback on successful transaction\r\n * @param errorCallback on error\r\n */\r\nfunction execIndexedDBTransaction (\r\n    actionFunction: (storeObj: IDBObjectStore) => void,\r\n    successCallback: () => void,\r\n    errorCallback: (errorStr: string) => void,\r\n): void {\r\n\r\n    let hasFinished = false;\r\n\r\n    function onSuccess (): void {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        successCallback();\r\n    }\r\n\r\n    function onError (errorStr: string): void {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        errorCallback(errorStr);\r\n    }\r\n\r\n    if (!indexedDbIsSupported) {\r\n        setTimeout(function () {\r\n            onError('no indexed db available');\r\n        }, 0);\r\n        return;\r\n    }\r\n    let requestObj: IDBOpenDBRequest;\r\n\r\n    try {\r\n        requestObj = window.indexedDB.open(dbNameStr, 1);\r\n    } catch (e) {\r\n        onError(e.message);\r\n        return;\r\n    }\r\n\r\n    requestObj.onupgradeneeded = function (): void {\r\n        try {\r\n            const db: IDBDatabase = requestObj.result;\r\n            const store = db.createObjectStore(storageNameStr, {keyPath: 'id'});\r\n            store.createIndex('id', 'id', {unique: true});\r\n        } catch (e) {\r\n            onError(e.message);\r\n        }\r\n    };\r\n    requestObj.onerror = function (): void {\r\n        onError('indexedDB.open failed, ' + requestObj.error);\r\n    };\r\n    requestObj.onsuccess = function (): void {\r\n        let databaseObj: IDBDatabase;\r\n        let transactionObj: IDBTransaction;\r\n        let storeObj: IDBObjectStore;\r\n\r\n        try {\r\n            databaseObj = requestObj.result;\r\n            if (!databaseObj.objectStoreNames.contains(storageNameStr)) {\r\n                //someone maybe messed with the db, or creation failed earlier\r\n                //it's broken -> destroy\r\n                window.indexedDB.deleteDatabase(dbNameStr);\r\n                onError('object store ' + storageNameStr + ' missing. destroying db');\r\n                return;\r\n            }\r\n            transactionObj = databaseObj.transaction(storageNameStr, 'readwrite');\r\n            storeObj = transactionObj.objectStore(storageNameStr);\r\n            storeObj.index('id');\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        databaseObj.onerror = function (e): void {\r\n            onError('database error, ' + databaseObj.error);\r\n        };\r\n\r\n        try {\r\n            actionFunction(storeObj);\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        transactionObj.oncomplete = function (): void {\r\n            onSuccess();\r\n            databaseObj.close();\r\n        };\r\n        transactionObj.onerror = function (): void {\r\n            onError('transaction error, ' + transactionObj.error);\r\n        };\r\n    };\r\n}\r\n\r\nexport function getKlProjectObj (\r\n    successCallback: (result: undefined | IKlStorageProject) => void,\r\n    errorCallback: (error: string) => void,\r\n): void {\r\n    if (indexedDbIsSupported) {\r\n        let query: IDBRequest<undefined | IKlStorageProject>;\r\n        execIndexedDBTransaction(function (storeObj) {\r\n            query = storeObj.get(1);\r\n        }, function () {\r\n            successCallback(query.result);\r\n        }, function (errorStr) {\r\n            errorCallback('execIndexedDBTransaction error, ' + errorStr);\r\n        });\r\n    } else {\r\n        successCallback(undefined);\r\n    }\r\n}\r\n\r\n/**\r\n * stores a project into id = 1 in database:dbNameStr > storage: storageNameStr\r\n */\r\nexport function storeKlProjectObj (\r\n    storageProject: IKlStorageProject,\r\n    successCallback: () => void,\r\n    errorCallback: (error: string) => void,\r\n): void {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.put(storageProject);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (errorStr) {\r\n        errorCallback(errorStr);\r\n    });\r\n\r\n}\r\n\r\n/**\r\n * deletes stored project, by removing id = 1 from database:dbNameStr > storage: storageNameStr\r\n */\r\nexport function clear (\r\n    successCallback: () => void,\r\n    errorCallback: (error: string) => void,\r\n): void {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.delete(1);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (error) {\r\n        errorCallback(error);\r\n    });\r\n\r\n}\r\n","import {IFilter} from '../kl-types';\r\nimport glBrightnessContrastImg from '/src/app/img/ui/edit-brightness-contrast.svg';\r\nimport cropExtendImg from '/src/app/img/ui/edit-crop.svg';\r\nimport glCurvesImg from '/src/app/img/ui/edit-curves.svg';\r\nimport flipImg from '/src/app/img/ui/edit-flip.svg';\r\nimport glHueSaturationImg from '/src/app/img/ui/edit-hue-saturation.svg';\r\nimport invertImg from '/src/app/img/ui/edit-invert.png';\r\nimport glPerspectiveImg from '/src/app/img/ui/edit-perspective.svg';\r\nimport resizeImg from '/src/app/img/ui/edit-resize.svg';\r\nimport rotateImg from '/src/app/img/ui/edit-rotate.svg';\r\nimport glTiltShiftImg from '/src/app/img/ui/edit-tilt-shift.png';\r\nimport toAlphaImg from '/src/app/img/ui/edit-to-alpha.svg';\r\nimport transformImg from '/src/app/img/ui/edit-transform.svg';\r\nimport glBlurImg from '/src/app/img/ui/edit-triangle-blur.png';\r\nimport glUnsharpMaskImg from '/src/app/img/ui/edit-unsharp-mask.png';\r\nimport gridImg from '/src/app/img/ui/edit-grid.svg';\r\nimport noiseImg from '/src/app/img/ui/edit-noise.svg';\r\nimport patternImg from '/src/app/img/ui/edit-pattern.svg';\r\nimport vanishPointImg from '/src/app/img/ui/edit-vanish-point.svg';\r\nimport distortImg from '/src/app/img/ui/edit-distort.svg';\r\nimport {THistoryEntryG} from '../history/kl-history';\r\n\r\nexport type TFilterHistoryEntry<Filter extends string, Input> = THistoryEntryG<['filter', Filter], 'apply', [{ input: Input }]>;\r\n\r\nexport const filterLibStatus = {\r\n    isLoaded: false,\r\n};\r\nexport const filterLib: {\r\n    [key:string]: IFilter;\r\n} = {\r\n    brightnessContrast: {\r\n        lang: {name: 'filter-bright-contrast-title', button: 'filter-bright-contrast'},\r\n        icon: glBrightnessContrastImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    cropExtend: {\r\n        lang: {name: 'filter-crop-title', button: 'filter-crop-extend'},\r\n        icon: cropExtendImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    curves: {\r\n        lang: {name: 'filter-curves-title', button: 'filter-curves'},\r\n        icon: glCurvesImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    distort: {\r\n        lang: {name: 'filter-distort', button: 'filter-distort'},\r\n        icon: distortImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    flip: {\r\n        lang: {name: 'filter-flip-title', button: 'filter-flip'},\r\n        icon: flipImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    hueSaturation: {\r\n        lang: {name: 'filter-hue-sat-title', button: 'filter-hue-sat'},\r\n        icon: glHueSaturationImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n    },\r\n    invert: {\r\n        lang: {name: 'filter-invert', button: 'filter-invert'},\r\n        icon: invertImg,\r\n        updatePos: false,\r\n        isInstant: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n    },\r\n    perspective: {\r\n        lang: {name: 'filter-perspective-title', button: 'filter-perspective'},\r\n        icon: glPerspectiveImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    resize: {\r\n        lang: {name: 'filter-resize-title', button: 'filter-resize'},\r\n        icon: resizeImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    rotate: {\r\n        lang: {name: 'filter-rotate-title', button: 'filter-rotate'},\r\n        icon: rotateImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    tiltShift: {\r\n        lang: {name: 'filter-tilt-shift-title', button: 'filter-tilt-shift'},\r\n        icon: glTiltShiftImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    toAlpha: {\r\n        lang: {name: 'filter-to-alpha-title', button: 'filter-to-alpha'},\r\n        icon: toAlphaImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n    },\r\n    transform: {\r\n        lang: {name: 'filter-transform-title', button: 'filter-transform'},\r\n        icon: transformImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    blur: {\r\n        lang: {name: 'filter-triangle-blur-title', button: 'filter-triangle-blur'},\r\n        icon: glBlurImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n    },\r\n    unsharpMask: {\r\n        lang: {name: 'filter-unsharp-mask-title', button: 'filter-unsharp-mask'},\r\n        icon: glUnsharpMaskImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n    },\r\n    grid: {\r\n        lang: {name: 'filter-grid', button: 'filter-grid'},\r\n        icon: gridImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    noise: {\r\n        lang: {name: 'filter-noise', button: 'filter-noise'},\r\n        icon: noiseImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    pattern: {\r\n        lang: {name: 'filter-pattern', button: 'filter-pattern'},\r\n        icon: patternImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    vanishPoint: {\r\n        lang: {name: 'filter-vanish-point-title', button: 'filter-vanish-point'},\r\n        icon: vanishPointImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n};\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7tOPd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fduLu\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ijSd4\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3lCpH\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hhylW\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kV0ed\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dNk9L\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"aj5Gc\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6D2tK\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7nesm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"leHUT\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3lP2j\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7G4sY\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7n1Rt\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ijwf0\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"18gIG\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"786LQ\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kcnOE\");","import {PenBrush} from './pen-brush';\r\nimport {BlendBrush} from './blend-brush';\r\nimport {SketchyBrush} from './sketchy-brush';\r\nimport {PixelBrush} from './pixel-brush';\r\nimport {EraserBrush} from './eraser-brush';\r\nimport {SmudgeBrush} from './smudge-brush';\r\nimport {ChemyBrush} from './chemy-brush';\r\n\r\nexport const brushes = {\r\n    PenBrush,\r\n    BlendBrush,\r\n    SketchyBrush,\r\n    PixelBrush,\r\n    ChemyBrush,\r\n    SmudgeBrush,\r\n    EraserBrush,\r\n};","import {BB} from '../../bb/bb';\r\nimport {alphaImArr} from './brushes-common';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB, TPressureInput} from '../kl-types';\r\nimport {BezierLine} from '../../bb/math/line';\r\n\r\nexport interface IPenBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'PenBrush'];\r\n    actions: THistoryInnerActions<PenBrush>[];\r\n}\r\n\r\nconst ALPHA_CIRCLE = 0;\r\nconst ALPHA_CHALK = 1;\r\nconst ALPHA_CAL = 2; // calligraphy\r\nconst ALPHA_SQUARE = 3;\r\n\r\nconst TWO_PI = 2 * Math.PI;\r\n\r\nexport class PenBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IPenBrushHistoryEntry | undefined;\r\n\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingHasSizePressure: boolean = true;\r\n    private settingSize: number = 2;\r\n    private settingSpacing: number = 0.8489;\r\n    private settingOpacity: number = 1;\r\n    private settingColor: IRGB;\r\n    private settingColorStr: string;\r\n    private settingAlphaId: number = ALPHA_CIRCLE;\r\n    private settingLockLayerAlpha: boolean = false;\r\n\r\n    private hasDrawnDot: boolean = false;\r\n    private lineToolLastDot: number;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private inputArr: TPressureInput[];\r\n    private inputIsDrawing: boolean = false;\r\n    private bezierLine: BezierLine | null = null;\r\n\r\n    // mipmapping\r\n    private readonly alphaCanvas128: HTMLCanvasElement = BB.canvas(128, 128);\r\n    private readonly alphaCanvas64: HTMLCanvasElement = BB.canvas(64, 64);\r\n    private readonly alphaCanvas32: HTMLCanvasElement = BB.canvas(32, 32);\r\n    private readonly alphaOpacityArr: number[] = [1, 0.9, 1, 1];\r\n\r\n\r\n    private updateAlphaCanvas () {\r\n        if (this.settingAlphaId === ALPHA_CIRCLE || this.settingAlphaId === ALPHA_SQUARE) {\r\n            return;\r\n        }\r\n\r\n        const instructionArr: [HTMLCanvasElement, number][] = [\r\n            [this.alphaCanvas128, 128],\r\n            [this.alphaCanvas64, 64],\r\n            [this.alphaCanvas32, 32],\r\n        ];\r\n\r\n        let ctx;\r\n\r\n        for (let i = 0; i < instructionArr.length; i++) {\r\n            ctx = BB.ctx((instructionArr[i][0] as any));\r\n\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.fillStyle = 'rgba(' + this.settingColor.r\r\n                + ', ' + this.settingColor.g\r\n                + ', ' + this.settingColor.b\r\n                + ', ' + this.alphaOpacityArr[this.settingAlphaId] + ')';\r\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.globalCompositeOperation = 'destination-in';\r\n            ctx.imageSmoothingQuality = 'high';\r\n            ctx.drawImage(alphaImArr[this.settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.restore();\r\n        }\r\n    }\r\n\r\n    private calcOpacity (pressure: number): number {\r\n        return this.settingOpacity * (this.settingHasOpacityPressure ? pressure * pressure : 1);\r\n    }\r\n\r\n    /**\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     * @param angle\r\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\r\n     */\r\n    private drawDot (\r\n        x: number,\r\n        y:number,\r\n        size: number,\r\n        opacity: number,\r\n        angle?: number,\r\n        before?: [number, number, number, number, (number | undefined)]\r\n    ): void {\r\n        if (size <= 0) {\r\n            return;\r\n        }\r\n\r\n        if (this.settingLockLayerAlpha) {\r\n            this.context.globalCompositeOperation = 'source-atop';\r\n        }\r\n\r\n        if (!before || before[3] !== opacity) {\r\n            this.context.globalAlpha = opacity;\r\n        }\r\n\r\n        if (!before && (this.settingAlphaId === ALPHA_CIRCLE || this.settingAlphaId === ALPHA_SQUARE)) {\r\n            this.context.fillStyle = this.settingColorStr;\r\n        }\r\n\r\n        if (this.settingAlphaId === ALPHA_CIRCLE) {\r\n            this.context.beginPath();\r\n            this.context.arc(x, y, size, 0, TWO_PI);\r\n            this.context.closePath();\r\n            this.context.fill();\r\n            this.hasDrawnDot = true;\r\n\r\n        } else if (this.settingAlphaId === ALPHA_SQUARE) {\r\n            if (angle !== undefined) {\r\n                this.context.save();\r\n                this.context.translate(x, y);\r\n                this.context.rotate(angle / 180 * Math.PI);\r\n                this.context.fillRect(-size, -size, size * 2, size * 2);\r\n                this.context.restore();\r\n                this.hasDrawnDot = true;\r\n            }\r\n\r\n        } else { // other brush alphas\r\n            this.context.save();\r\n            this.context.translate(x, y);\r\n            let targetMipmap = this.alphaCanvas128;\r\n            if (size <= 32 && size > 16) {\r\n                targetMipmap = this.alphaCanvas64;\r\n            } else if (size <= 16) {\r\n                targetMipmap = this.alphaCanvas32;\r\n            }\r\n            this.context.scale(size, size);\r\n            if (this.settingAlphaId === ALPHA_CHALK) {\r\n                this.context.rotate(((x + y) * 53123) % TWO_PI); // without mod it sometimes looks different\r\n            }\r\n            this.context.drawImage(targetMipmap, -1, -1, 2, 2);\r\n\r\n            this.context.restore();\r\n            this.hasDrawnDot = true;\r\n        }\r\n    }\r\n\r\n    // continueLine\r\n    private continueLine (\r\n        x: number | null,\r\n        y: number | null,\r\n        size: number,\r\n        pressure: number,\r\n    ): void {\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, () => {});\r\n        }\r\n\r\n        const drawArr: [number, number, number, number, (number | undefined)][] = []; //draw instructions. will be all drawn at once\r\n\r\n        const dotCallback = (val: {\r\n            x: number;\r\n            y: number;\r\n            t: number;\r\n            angle?: number;\r\n            dAngle: number;\r\n        }): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.calcOpacity(localPressure);\r\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        };\r\n\r\n        const localSpacing = size * this.settingSpacing;\r\n        if (x === null || y === null) {\r\n            this.bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        this.context.save();\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            const item = drawArr[i];\r\n            this.drawDot(item[0], item[1], item[2], item[3], item[4], before);\r\n            before = item;\r\n        }\r\n        this.context.restore();\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor () {}\r\n\r\n    // ---- interface ----\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'PenBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setAlpha',\r\n                    params: [this.settingAlphaId],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n            ],\r\n        };\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        const localOpacity = this.calcOpacity(p);\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.hasDrawnDot = false;\r\n\r\n        this.inputIsDrawing = true;\r\n        this.context.save();\r\n        this.drawDot(x, y, localSize, localOpacity);\r\n        this.context.restore();\r\n\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2.pressure = p;\r\n\r\n        this.inputArr = [{\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        }];\r\n\r\n        this.historyEntry.actions!.push({\r\n            action: 'startLine',\r\n            params: [x, y, p],\r\n        });\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.inputIsDrawing) {\r\n            return;\r\n        }\r\n        this.historyEntry!.actions!.push({\r\n            action: 'goLine',\r\n            params: [x, y, p],\r\n        });\r\n\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.context.save();\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n        /*context.fillStyle = 'red';\r\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\r\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/\r\n\r\n        this.context.restore();\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput2.pressure = this.lastInput.pressure;\r\n        this.lastInput.pressure = pressure;\r\n\r\n        this.inputArr.push({\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        });\r\n    }\r\n\r\n    endLine (x: number, y: number): void {\r\n\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.context.save();\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n        this.context.restore();\r\n\r\n        this.inputIsDrawing = false;\r\n\r\n        if (this.settingAlphaId === ALPHA_SQUARE && !this.hasDrawnDot) {\r\n            // find max pressure input, use that one\r\n            let maxInput = this.inputArr[0];\r\n            this.inputArr.forEach(item => {\r\n                if (item.pressure > maxInput.pressure) {\r\n                    maxInput = item;\r\n                }\r\n            });\r\n\r\n            this.context.save();\r\n            const p = BB.clamp(maxInput.pressure, 0, 1);\r\n            const localOpacity = this.calcOpacity(p);\r\n            this.drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\r\n            this.context.restore();\r\n        }\r\n\r\n        this.bezierLine = null;\r\n\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions!.push({\r\n                action: 'endLine',\r\n                params: [x, y],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n\r\n        this.hasDrawnDot = false;\r\n        this.inputArr = [];\r\n    }\r\n\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n        this.lastInput.pressure = 1;\r\n\r\n        if (this.inputIsDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        const bdist = this.settingSize * this.settingSpacing;\r\n        this.lineToolLastDot = this.settingSize * this.settingSpacing;\r\n        this.context.save();\r\n        for (loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity, angle);\r\n        }\r\n        this.context.restore();\r\n\r\n\r\n        const historyEntry: IPenBrushHistoryEntry = {\r\n            tool: ['brush', 'PenBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setAlpha',\r\n                    params: [this.settingAlphaId],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n    //IS\r\n    isDrawing (): boolean {\r\n        return this.inputIsDrawing;\r\n    }\r\n\r\n    //SET\r\n    setAlpha (a: number): void {\r\n        if (this.settingAlphaId === a) {\r\n            return;\r\n        }\r\n        this.settingAlphaId = a;\r\n        this.updateAlphaCanvas();\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor === c) {\r\n            return;\r\n        }\r\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\r\n        this.settingColorStr = 'rgb(' + this.settingColor.r + ',' + this.settingColor.g + ',' + this.settingColor.b + ')';\r\n        this.updateAlphaCanvas();\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSize (s: number, b?: string): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = b;\r\n    }\r\n\r\n    //GET\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n}\r\n\r\n","import {genBrushAlpha01, genBrushAlpha02} from './alphas/brush-alphas';\r\n\r\nexport const alphaImArr = []; //used by default brush\r\nalphaImArr[1] = genBrushAlpha01(128);\r\nalphaImArr[2] = genBrushAlpha02(128);","import {BB} from '../../../bb/bb';\r\nimport {noise} from '../../../bb/math/perlin';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\n\r\n// chalk\r\nexport function genBrushAlpha01 (w: number): HTMLCanvasElement {\r\n\r\n    const scaleFac = w / 500;\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    const ctx = BB.ctx(canvas);\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            const i = (y * w + x) * 4;\r\n\r\n            // base noise\r\n            const sFac2 = scaleFac + noise.simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\r\n            let noisePattern = 100 + (noise.simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\r\n            noisePattern -= (noise.simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\r\n\r\n            // fade out in circular shape\r\n            const centerDist = BB.dist(w / 2, h / 2, x, y);\r\n            const falloff = BB.clamp(\r\n                1 - ((centerDist - (w / 2.5)) / (w / 14) + noise.simplex2(x / 22 / sFac2, y / 22 / sFac2)),\r\n                0,\r\n                1);\r\n            noisePattern = noisePattern * falloff;\r\n\r\n            // make the middle darker\r\n            const falloff2 = BB.clamp(1 - centerDist / w, 0, 1) * 2;\r\n            noisePattern = noisePattern * falloff2;\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = BB.clamp(noisePattern, 0, 255);\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}\r\n\r\n// https://www.shadertoy.com/view/3tdSDj\r\nfunction udSegment ( p: IVector2D, a: IVector2D, b: IVector2D ) {\r\n    const ba = BB.Vec2.sub(b, a);\r\n    const pa = BB.Vec2.sub(p, a);\r\n    const h = BB.clamp( BB.Vec2.dot(pa,ba) / BB.Vec2.dot(ba,ba), 0.0, 1.0 );\r\n    return BB.Vec2.len(BB.Vec2.sub(pa, BB.Vec2.mul(ba, h)));\r\n}\r\n\r\n// calligraphy\r\nexport function genBrushAlpha02 (w: number): HTMLCanvasElement {\r\n\r\n    const pDist = 1 / 4;\r\n    let centerSize = 2 / 3;\r\n    let transitionSize = 1 / 3;\r\n    centerSize *= pDist;\r\n    transitionSize *= pDist;\r\n    const p1 = {x: pDist * w, y: w - (w * pDist)};\r\n    const p2 = {x: w - (w * pDist), y: pDist * w};\r\n\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    const ctx = BB.ctx(canvas);\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            const i = (y * w + x) * 4;\r\n\r\n            let col = udSegment({x: x, y: y}, p1, p2);\r\n\r\n            col = BB.clamp(\r\n                255 - ((col - (w * centerSize)) / (w * transitionSize) * 255),\r\n                0,\r\n                255\r\n            );\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = col;\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}","/*\r\n * A speed-improved perlin and simplex noise algorithms for 2D.\r\n *\r\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\n * Better rank ordering method by Stefan Gustavson in 2012.\r\n * Converted to Javascript by Joseph Gentle.\r\n *\r\n * Version 2012-03-09\r\n *\r\n * This code was placed in the public domain by its original author,\r\n * Stefan Gustavson. You may use it as you see fit, but\r\n * attribution is appreciated.\r\n *\r\n */\r\n\r\nconst myModule = {} as any;\r\n\r\nclass Grad {\r\n    constructor (public x: number, public y: number, public z:number) {}\r\n\r\n    dot2 (x: number, y: number): number {\r\n        return this.x*x + this.y*y;\r\n    }\r\n}\r\n/*\r\nGrad.prototype.dot3 = function(x, y, z) {\r\n    return this.x*x + this.y*y + this.z*z;\r\n};*/\r\n\r\nconst grad3 = [new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),\r\n    new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),\r\n    new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];\r\n\r\nconst p = [151,160,137,91,90,15,\r\n    131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,\r\n    190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,\r\n    88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,\r\n    77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,\r\n    102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,\r\n    135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,\r\n    5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,\r\n    223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,\r\n    129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,\r\n    251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,\r\n    49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,\r\n    138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\r\n// To remove the need for index wrapping, double the permutation table length\r\nconst perm = new Array(512);\r\nconst gradP = new Array(512);\r\n\r\n// This isn't a very good seeding function, but it works ok. It supports 2^16\r\n// different seed values. Write something better if you need more seeds.\r\nmyModule.seed = function (seed: number): void {\r\n    if (seed > 0 && seed < 1) {\r\n        // Scale the seed out\r\n        seed *= 65536;\r\n    }\r\n\r\n    seed = Math.floor(seed);\r\n    if (seed < 256) {\r\n        seed |= seed << 8;\r\n    }\r\n\r\n    for (let i = 0; i < 256; i++) {\r\n        let v;\r\n        if (i & 1) {\r\n            v = p[i] ^ (seed & 255);\r\n        } else {\r\n            v = p[i] ^ ((seed>>8) & 255);\r\n        }\r\n\r\n        perm[i] = perm[i + 256] = v;\r\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\r\n    }\r\n};\r\n\r\nmyModule.seed(0);\r\n\r\n/*\r\nfor (let i=0; i<256; i++) {\r\n  perm[i] = perm[i + 256] = p[i];\r\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\r\n}*/\r\n\r\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\r\nconst F2 = 0.5*(Math.sqrt(3)-1);\r\nconst G2 = (3-Math.sqrt(3))/6;\r\n\r\n/*let F3 = 1/3;\r\nlet G3 = 1/6;*/\r\n\r\n// 2D simplex noise\r\nmyModule.simplex2 = function (xin: number, yin: number): number {\r\n    let n0, n1, n2; // Noise contributions from the three corners\r\n    // Skew the input space to determine which simplex cell we're in\r\n    const s = (xin+yin)*F2; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    const t = (i+j)*G2;\r\n    const x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    const y0 = yin-j+t;\r\n    // For the 2D case, the simplex shape is an equilateral triangle.\r\n    // Determine which simplex we are in.\r\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n    if (x0>y0) { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n        i1=1; j1=0;\r\n    } else {    // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n        i1=0; j1=1;\r\n    }\r\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n    // c = (3-sqrt(3))/6\r\n    const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n    const y1 = y0 - j1 + G2;\r\n    const x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n    const y2 = y0 - 1 + 2 * G2;\r\n    // Work out the hashed gradient indices of the three simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    const gi0 = gradP[i+perm[j]];\r\n    const gi1 = gradP[i+i1+perm[j+j1]];\r\n    const gi2 = gradP[i+1+perm[j+1]];\r\n    // Calculate the contribution from the three corners\r\n    let t0 = 0.5 - x0*x0-y0*y0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot2(x0, y0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.5 - x1*x1-y1*y1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\r\n    }\r\n    let t2 = 0.5 - x2*x2-y2*y2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 70 * (n0 + n1 + n2);\r\n};\r\n/*\r\n// 3D simplex noise\r\nmyModule.simplex3 = function(xin, yin, zin) {\r\n    let n0, n1, n2, n3; // Noise contributions from the four corners\r\n\r\n    // Skew the input space to determine which simplex cell we're in\r\n    let s = (xin+yin+zin)*F3; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    let k = Math.floor(zin+s);\r\n\r\n    let t = (i+j+k)*G3;\r\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin-j+t;\r\n    let z0 = zin-k+t;\r\n\r\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n    // Determine which simplex we are in.\r\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n    if (x0 >= y0) {\r\n        if (y0 >= z0)      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; }\r\n        else if (x0 >= z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; }\r\n        else              { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; }\r\n    } else {\r\n        if (y0 < z0)      { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; }\r\n        else if (x0 < z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; }\r\n        else             { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; }\r\n    }\r\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n    // c = 1/6.\r\n    let x1 = x0 - i1 + G3; // Offsets for second corner\r\n    let y1 = y0 - j1 + G3;\r\n    let z1 = z0 - k1 + G3;\r\n\r\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\r\n    let y2 = y0 - j2 + 2 * G3;\r\n    let z2 = z0 - k2 + 2 * G3;\r\n\r\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\r\n    let y3 = y0 - 1 + 3 * G3;\r\n    let z3 = z0 - 1 + 3 * G3;\r\n\r\n    // Work out the hashed gradient indices of the four simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    k &= 255;\r\n    let gi0 = gradP[i+   perm[j+   perm[k   ]]];\r\n    let gi1 = gradP[i+i1+perm[j+j1+perm[k+k1]]];\r\n    let gi2 = gradP[i+i2+perm[j+j2+perm[k+k2]]];\r\n    let gi3 = gradP[i+ 1+perm[j+ 1+perm[k+ 1]]];\r\n\r\n    // Calculate the contribution from the four corners\r\n    let t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\r\n    }\r\n    let t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\r\n    }\r\n    let t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\r\n    if (t3<0) {\r\n        n3 = 0;\r\n    } else {\r\n        t3 *= t3;\r\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 32 * (n0 + n1 + n2 + n3);\r\n\r\n};\r\n*/\r\n// ##### Perlin noise stuff\r\n/*\r\nfunction fade(t) {\r\n    return t*t*t*(t*(t*6-15)+10);\r\n}\r\n\r\nfunction lerp(a, b, t) {\r\n    return (1-t)*a + t*b;\r\n}\r\n\r\n// 2D Perlin Noise\r\nmyModule.perlin2 = function(x, y) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y);\r\n    // Get relative xy coordinates of point within that cell\r\n    x = x - X; y = y - Y;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255;\r\n\r\n    // Calculate noise contributions from each of the four corners\r\n    let n00 = gradP[X+perm[Y]].dot2(x, y);\r\n    let n01 = gradP[X+perm[Y+1]].dot2(x, y-1);\r\n    let n10 = gradP[X+1+perm[Y]].dot2(x-1, y);\r\n    let n11 = gradP[X+1+perm[Y+1]].dot2(x-1, y-1);\r\n\r\n    // Compute the fade curve value for x\r\n    let u = fade(x);\r\n\r\n    // Interpolate the four results\r\n    return lerp(\r\n        lerp(n00, n10, u),\r\n        lerp(n01, n11, u),\r\n        fade(y));\r\n};*/\r\n/*\r\n// 3D Perlin Noise\r\nmyModule.perlin3 = function(x, y, z) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y), Z = Math.floor(z);\r\n    // Get relative xyz coordinates of point within that cell\r\n    x = x - X; y = y - Y; z = z - Z;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255; Z = Z & 255;\r\n\r\n    // Calculate noise contributions from each of the eight corners\r\n    let n000 = gradP[X+  perm[Y+  perm[Z  ]]].dot3(x,   y,     z);\r\n    let n001 = gradP[X+  perm[Y+  perm[Z+1]]].dot3(x,   y,   z-1);\r\n    let n010 = gradP[X+  perm[Y+1+perm[Z  ]]].dot3(x,   y-1,   z);\r\n    let n011 = gradP[X+  perm[Y+1+perm[Z+1]]].dot3(x,   y-1, z-1);\r\n    let n100 = gradP[X+1+perm[Y+  perm[Z  ]]].dot3(x-1,   y,   z);\r\n    let n101 = gradP[X+1+perm[Y+  perm[Z+1]]].dot3(x-1,   y, z-1);\r\n    let n110 = gradP[X+1+perm[Y+1+perm[Z  ]]].dot3(x-1, y-1,   z);\r\n    let n111 = gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1, y-1, z-1);\r\n\r\n    // Compute the fade curve value for x, y, z\r\n    let u = fade(x);\r\n    let v = fade(y);\r\n    let w = fade(z);\r\n\r\n    // Interpolate\r\n    return lerp(\r\n        lerp(\r\n            lerp(n000, n100, u),\r\n            lerp(n001, n101, u), w),\r\n        lerp(\r\n            lerp(n010, n110, u),\r\n            lerp(n011, n111, u), w),\r\n        v);\r\n};*/\r\n\r\nexport const noise = myModule;","import {BB} from '../../bb/bb';\r\nimport {IRGB, IRGBA} from '../kl-types';\r\nimport {IBounds, IPressureInput} from '../../bb/bb-types';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {clamp} from '../../bb/math/math';\r\n\r\nexport interface IBlendBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'BlendBrush'];\r\n    actions: THistoryInnerActions<BlendBrush>[];\r\n}\r\n\r\nconst cellSize = 256;\r\n\r\ninterface IDrawBufferItem {\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    opacity: number;\r\n    x1: number;\r\n    y1: number;\r\n    x2: number;\r\n    y2: number;\r\n    r: number;\r\n    g: number;\r\n    b: number;\r\n}\r\n\r\nexport class BlendBrush {\r\n\r\n    private isTesting: boolean = false; // testing mode - context only gets updated when line is finished\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private color: IRGB;\r\n    private size: number = 29; // radius - 0.5 - 99999\r\n    private opacity: number = 0.6; // 0-1\r\n    private blending: number = 0.65; // 0-1\r\n\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingSizePressure: boolean = true;\r\n    private settingOpacityPressure: boolean = false;\r\n\r\n    private blendCol: IRGBA = {r: 0, g: 0, b: 0, a: 1}; // todo docs\r\n    private blendMix: number = 0.45; // todo docs\r\n    private mixr: number; // todo docs\r\n    private mixg: number; // todo docs\r\n    private mixb: number; // todo docs\r\n    private localColOld: IRGBA; // todo docs\r\n\r\n    private isDrawing: boolean = false;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private bezierLine: any; // todo type\r\n\r\n    private history: KlHistoryInterface | null;\r\n    private historyEntry: IBlendBrushHistoryEntry;\r\n    private redrawBounds: IBounds;\r\n    private cells: (ImageData | null)[];\r\n    private drawBuffer: IDrawBufferItem[];\r\n\r\n    private updateRedrawBounds (bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    private getCellsWidth (): number {\r\n        return Math.ceil(this.context.canvas.width / cellSize);\r\n    }\r\n\r\n    /**\r\n     * draw changed cells (changed by brushstroke) onto context\r\n     * @private\r\n     */\r\n    private drawChangedCells (): void {\r\n        const cells = this.cells.map(item => null);\r\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\r\n        touchedCells.forEach((isTouched, index) => {\r\n            if (isTouched) {\r\n                cells[index] = this.cells[index];\r\n            }\r\n        });\r\n        this.drawCells(cells);\r\n        this.redrawBounds = null;\r\n    }\r\n\r\n    private getTouchedCells (bounds: IBounds): boolean[] {\r\n        const touchedCells = this.cells.map(item => false);\r\n        const cellsW = this.getCellsWidth();\r\n        bounds = {\r\n            x1: Math.floor(bounds.x1 / cellSize),\r\n            y1: Math.floor(bounds.y1 / cellSize),\r\n            x2: Math.floor(bounds.x2 / cellSize),\r\n            y2: Math.floor(bounds.y2 / cellSize),\r\n        };\r\n        for (let i = bounds.x1; i <= bounds.x2; i++) {\r\n            for (let e = bounds.y1; e <= bounds.y2; e++) {\r\n                touchedCells[e * cellsW + i] = true;\r\n            }\r\n        }\r\n        return touchedCells;\r\n    }\r\n\r\n    /**\r\n     * Slice up bounds accordings to cells\r\n     * @param bounds\r\n     * @private\r\n     */\r\n    private sliceBounds (bounds: IBounds): {index: number; bounds: IBounds}[] {\r\n        const cellsW = this.getCellsWidth();\r\n        const result: {index: number; bounds: IBounds}[] = [];\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n\r\n        touchedCells.forEach((cell, i) => {\r\n            if (!cell) {\r\n                return;\r\n            }\r\n\r\n            const cellOffsetX = (i % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(i / cellsW) * cellSize;\r\n            const cellWidth = this.cells[i].width;\r\n            const cellHeight = this.cells[i].height;\r\n\r\n            const inCellBounds = {\r\n                x1: Math.max(0, bounds.x1 - cellOffsetX),\r\n                y1: Math.max(0, bounds.y1 - cellOffsetY),\r\n                x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\r\n                y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY),\r\n            };\r\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) {\r\n                return;\r\n            }\r\n            result.push({\r\n                index: i,\r\n                bounds: inCellBounds,\r\n            });\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    private copyFromCanvas (bounds: IBounds) {\r\n        if (!bounds) {\r\n            return;\r\n        }\r\n\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n        const cellsW = this.getCellsWidth();\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.cells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * cellSize + cellSize, this.context.canvas.width) - 1) % cellSize + 1;\r\n            const h = (Math.min(y * cellSize + cellSize, this.context.canvas.height) - 1) % cellSize + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = BB.ctx(tmpCanvas);\r\n            tmpCtx.drawImage(this.context.canvas, -x * cellSize, -y * cellSize);\r\n\r\n            this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\r\n        });\r\n    }\r\n\r\n    private getAverage (x, y, size): IRGBA {\r\n\r\n        size = Math.max(0.5, size * 0.75);\r\n        const x1 = Math.max(0, Math.floor(x - size));\r\n        const y1 = Math.max(0, Math.floor(y - size));\r\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return {\r\n                r: 0,\r\n                g: 0,\r\n                b: 0,\r\n                a: 0,\r\n            };\r\n        }\r\n\r\n        let ar = 0, ag = 0, ab = 0, aa = 0, alpha;\r\n\r\n        const slicedBounds = this.sliceBounds({ x1, y1, x2, y2 });\r\n        slicedBounds.forEach(slice => {\r\n            const width = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n            const bounds = slice.bounds;\r\n\r\n            for (let i = bounds.y1; i <= bounds.y2; i += 4) {\r\n                for (let e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 4 * 4) {\r\n                    alpha = data[e2 + 3];\r\n                    ar += data[e2] * alpha;\r\n                    ag += data[e2 + 1] * alpha;\r\n                    ab += data[e2 + 2] * alpha;\r\n                    aa += alpha;\r\n                }\r\n            }\r\n        });\r\n\r\n        if (aa !== 0) {\r\n            ar /= aa;\r\n            ag /= aa;\r\n            ab /= aa;\r\n            aa = Math.min(1, aa);\r\n        }\r\n        return {\r\n            r: ar,\r\n            g: ag,\r\n            b: ab,\r\n            a: aa,\r\n        };\r\n    }\r\n\r\n    private prepDot (x: number, y: number, size: number): IBounds {\r\n        size = Math.max(0.5, size);\r\n        const x1 = Math.max(0, Math.floor(x - size));\r\n        const y1 = Math.max(0, Math.floor(y - size));\r\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return null;\r\n        }\r\n        return { x1, y1, x2, y2 };\r\n    }\r\n\r\n    private drawDot (params: IDrawBufferItem): void {\r\n        // array with random numbers. faster than Math.random()\r\n        let randI = 0;\r\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n        const randArr = [];\r\n        for (let i = 0; i < randLen; i++) {\r\n            randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n        }\r\n\r\n        // thin lines take more than just 1 sample\r\n        const sampleArr = [8,4,4,4,2,2,2,2,2,2]; // <0.5, 0.5, 1, 1.5, etc.\r\n        const samples = sampleArr[Math.floor(params.size * 2)];\r\n        const samplesSquared: number = samples ? samples * samples : 0;\r\n        const sampleOffsets = [];\r\n        if (samples) {\r\n            let i = 0;\r\n            for (let n = 0; n < samples; n++) {\r\n                for (let m = 0; m < samples; m++, i += 2) {\r\n                    sampleOffsets[i] = (n + 1) / samples; // x offset\r\n                    sampleOffsets[i + 1] = (m + 1) / samples; // y offset\r\n                }\r\n            }\r\n        }\r\n\r\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\r\n        // to optimize calculations\r\n        const invSharpness = 1 - sharpness;\r\n        const sharpnessSubtrahend = sharpness / invSharpness;\r\n        const sizeSquared = params.size * params.size;\r\n        const distDivisor = sizeSquared * invSharpness / params.opacity;\r\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\r\n\r\n\r\n        const slicedBounds = this.sliceBounds({\r\n            x1: params.x1,\r\n            y1: params.y1,\r\n            x2: params.x2,\r\n            y2: params.y2,\r\n        });\r\n\r\n        const cellsW = this.getCellsWidth();\r\n        slicedBounds.forEach(slice => {\r\n            const cellOffsetX = (slice.index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(slice.index / cellsW) * cellSize;\r\n            const cellWidth = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n\r\n            // i - y index within cell\r\n            // e - x index within cell\r\n\r\n            // e2 - index in image data\r\n\r\n            // ri - y index within image relative to dot-center\r\n            // re - x index within image relative to dot-center\r\n\r\n            for (let i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++) {\r\n                for (\r\n                    let e = slice.bounds.x1,\r\n                        e2 = i * cellWidth * 4 + slice.bounds.x1 * 4,\r\n                        re = e + cellOffsetX - params.x;\r\n                    e <= slice.bounds.x2;\r\n                    e++,\r\n                        e2 += 4,\r\n                        re++\r\n                ) {\r\n                    // O = over -> brush-dot\r\n                    // U = under -> image\r\n\r\n                    let alphaO = 0;\r\n                    if (samplesSquared) {\r\n                        for (let f = 0; f < sampleOffsets.length; f += 2) {\r\n                            const dist = BB.lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\r\n                            if (dist >= sizeSquared) {\r\n                                continue;\r\n                            }\r\n                            alphaO += clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                        }\r\n                        if (!alphaO) {\r\n                            continue;\r\n                        }\r\n                        alphaO /= samplesSquared;\r\n                    } else {\r\n                        // technically needs + 0.5 offset, but not noticeable with large brush\r\n                        const dist = Math.pow(re, 2) + Math.pow(ri, 2);\r\n                        if (dist >= sizeSquared) {\r\n                            continue;\r\n                        }\r\n                        alphaO = clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                    }\r\n\r\n                    const invAlphaO = 1 - alphaO;\r\n                    const alphaU =data[e2 + 3] / 255;\r\n\r\n                    if (this.settingLockLayerAlpha) {\r\n                        const underR = (params.r * alphaO) + ((data[e2]) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1]) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2]) * invAlphaO);\r\n                        if (alphaU) {\r\n                            data[e2] = Math.floor(underR + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB + randArr[randI]);\r\n                        }\r\n                    } else {\r\n                        const underR = (params.r * alphaO) + ((data[e2] * alphaU) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1] * alphaU) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2] * alphaU) * invAlphaO);\r\n\r\n                        const newAlpha = 1 - invAlphaO * (1 - alphaU);\r\n                        data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\r\n                        if (newAlpha) {\r\n                            data[e2] = Math.floor(underR / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB / (newAlpha) + randArr[randI]);\r\n                        }\r\n                    }\r\n                    randI = (randI + 1) % randLen;\r\n\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    private calcSpacing (size: number): number {\r\n        return BB.mix(\r\n            (size * 2) / 2, // until size 5.3\r\n            (size * 2) / 9, // at size 24\r\n            clamp((size - 2.7) / (12 - 2.7), 0, 1)\r\n        );\r\n    }\r\n\r\n    private continueLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n\r\n        this.drawBuffer = [];\r\n\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (this.settingSizePressure) ? Math.max(1, p * this.size) : Math.max(1, this.size);\r\n\r\n        const bdist = this.calcSpacing(localSize);\r\n\r\n        let avgX = x;\r\n        let avgY = y;\r\n        if (x === null) {\r\n            avgX = this.lastInput.x;\r\n            avgY = this.lastInput.y;\r\n        }\r\n\r\n        let localColNew;\r\n\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            let average;\r\n            if (isCoalesced) {\r\n                average = {r: this.localColOld.r, g: this.localColOld.g, b: this.localColOld.b, a: 0};\r\n            } else {\r\n                const avgParams = [avgX, avgY, ((this.settingSizePressure) ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size))];\r\n                const bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\r\n                this.copyFromCanvas(bounds);\r\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\r\n            }\r\n            localColNew = {r: 0, g: 0, b: 0, a: 0};\r\n\r\n            if (average.a > 0 && this.blendCol.a === 0) {\r\n                this.blendCol.r = average.r;\r\n                this.blendCol.g = average.g;\r\n                this.blendCol.b = average.b;\r\n                this.blendCol.a = average.a;\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n\r\n            } else {\r\n                if (average.a === 0) {\r\n                    average.r = this.color.r;\r\n                    average.g = this.color.g;\r\n                    average.b = this.color.b;\r\n                    average.a = 1 - this.blending;\r\n                }\r\n\r\n                this.blendCol.r = BB.mix(this.blendCol.r, BB.mix(this.blendCol.r, average.r, this.blendMix), average.a);\r\n                this.blendCol.g = BB.mix(this.blendCol.g, BB.mix(this.blendCol.g, average.g, this.blendMix), average.a);\r\n                this.blendCol.b = BB.mix(this.blendCol.b, BB.mix(this.blendCol.b, average.b, this.blendMix), average.a);\r\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n            }\r\n\r\n        }\r\n\r\n\r\n        const bezierCallback = (val) => {\r\n            if (this.blending >= 1 && this.blendCol.a <= 0) {\r\n                return;\r\n            }\r\n            const factor = val.t;\r\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (this.settingOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\r\n            localSize = (this.settingSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\r\n            if (this.blending != 0) {\r\n                this.mixr = BB.mix(this.localColOld.r, localColNew.r, factor);\r\n                this.mixg = BB.mix(this.localColOld.g, localColNew.g, factor);\r\n                this.mixb = BB.mix(this.localColOld.b, localColNew.b, factor);\r\n            }\r\n            if (this.blending === 1 && this.localColOld.a === 0) {\r\n                this.mixr = localColNew.r;\r\n                this.mixg = localColNew.g;\r\n                this.mixb = localColNew.b;\r\n            }\r\n            const bounds = this.prepDot(val.x, val.y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: val.x,\r\n                    y: val.y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                });\r\n            }\r\n        };\r\n\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.localColOld = localColNew;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.size;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.size = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.opacity = o;\r\n    }\r\n\r\n    getBlending (): number {\r\n        return this.blending;\r\n    }\r\n\r\n    setBlending (b: number) {\r\n        this.blending = b;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.color = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setSizePressure (b: boolean): void {\r\n        this.settingSizePressure = !!b;\r\n    }\r\n\r\n    setOpacityPressure (b: boolean): void {\r\n        this.settingOpacityPressure = !!b;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setIsTesting (b: boolean): void {\r\n        this.isTesting = !!b;\r\n    }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'BlendBrush'],\r\n            actions: [],\r\n        };\r\n\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n\r\n        this.isDrawing = true;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            this.copyFromCanvas(this.prepDot(x, y, localSize));\r\n\r\n            const average = this.getAverage(\r\n                x,\r\n                y,\r\n                ((this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size))\r\n            );\r\n            if (average.a === 0) {\r\n                this.blendCol = {\r\n                    r: this.color.r,\r\n                    g: this.color.g,\r\n                    b: this.color.b,\r\n                    a: 1 - this.blending,\r\n                };\r\n            } else {\r\n                this.blendCol = {\r\n                    r: average.r,\r\n                    g: average.g,\r\n                    b: average.b,\r\n                    a: average.a,\r\n                };\r\n            }\r\n\r\n            this.mixr = this.blendCol.r;\r\n            this.mixg = this.blendCol.g;\r\n            this.mixb = this.blendCol.b;\r\n        }\r\n\r\n        this.localColOld = {r: this.mixr, g: this.mixg, b: this.mixb, a: this.blendCol.a};\r\n\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        if (this.blending < 1 || this.blendCol.a > 0) {\r\n            const bounds = this.prepDot(x, y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x,\r\n                    y: y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                });\r\n            }\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.bezierLine = new BB.BezierLine();\r\n        this.bezierLine.add(x, y, 0, function () {\r\n        });\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    endLine (): void {\r\n        if (this.bezierLine) {\r\n            this.continueLine(null, null, this.lastInput.pressure, false);\r\n        }\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.drawChangedCells();\r\n        }\r\n\r\n        if (this.historyEntry && this.history && this.cells.find(item => !!item)) {\r\n            this.historyEntry.actions.push({\r\n                action: 'drawCells',\r\n                params: [this.cells],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n\r\n    /**\r\n     * draw cells onto context\r\n     * @param cells\r\n     */\r\n    drawCells (cells: (ImageData | null)[]): void {\r\n        const cellsW = this.getCellsWidth();\r\n        cells.forEach((imageData, index) => {\r\n            if (!imageData) {\r\n                return;\r\n            }\r\n            const cellOffsetX = (index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(index / cellsW) * cellSize;\r\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\r\n        });\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\r\n        const average = this.getAverage(x1, y1, Math.max(0.1, this.size));\r\n\r\n        if (average.a === 0) {\r\n            this.blendCol = {\r\n                r: this.color.r,\r\n                g: this.color.g,\r\n                b: this.color.b,\r\n                a: 1 - this.blending,\r\n            };\r\n        } else {\r\n            this.blendCol = {\r\n                r: average.r,\r\n                g: average.g,\r\n                b: average.b,\r\n                a: average.a,\r\n            };\r\n        }\r\n\r\n        this.mixr = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixg = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixb = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\r\n\r\n\r\n        const p = 1;\r\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        const bdist = this.calcSpacing(localSize);\r\n        for (let loopDist = 0; loopDist <= mouseDist; loopDist += bdist) {\r\n            const bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\r\n            if (bounds) {\r\n                this.copyFromCanvas(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x1 + eX * loopDist,\r\n                    y: y1 + eY * loopDist,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                });\r\n            }\r\n        }\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        if (this.history && this.cells.find(item => !!item)) {\r\n            this.drawCells(this.cells);\r\n            this.historyEntry = {\r\n                tool: ['brush', 'BlendBrush'],\r\n                actions: [{\r\n                    action: 'drawCells',\r\n                    params: [this.cells],\r\n                }],\r\n            };\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB, TPressureInput} from '../kl-types';\r\n\r\nexport interface ISketchyBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'SketchyBrush'];\r\n    actions: THistoryInnerActions<SketchyBrush>[];\r\n}\r\n\r\nconst sampleCanvas = BB.canvas(32, 32);\r\nconst sampleCtx = BB.ctx(sampleCanvas);\r\n\r\nexport class SketchyBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private settingColor: IRGB;\r\n    private settingSize: number = 1;\r\n    private settingOpacity: number = 0.2;\r\n    private settingBlending: number = 0.5;\r\n    private settingScale: number = 1;\r\n    private lastX: number = 0;\r\n    private lastY: number = 0;\r\n    private inputIsDrawing: boolean = false;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: ISketchyBrushHistoryEntry | undefined;\r\n    private sketchySeed: number = 0;\r\n    private points: [number, number][] = []; // x y\r\n    private count: number = 0;\r\n    private readonly mixmode = [\r\n        (c1: IRGB, c2: IRGB) => {\r\n            return c1;\r\n        },\r\n        (c1: IRGB, c2: IRGB) => { // why\r\n            const result = new BB.RGB(c1.r, c1.g, c1.b);\r\n            result.r *= c2.r / 255;\r\n            result.g *= c2.g / 255;\r\n            result.b *= c2.b / 255;\r\n            return result;\r\n        },\r\n    ];\r\n\r\n\r\n    private rand (): number {\r\n        this.sketchySeed++;\r\n        return Math.sin(6324634.2345 * Math.cos(this.sketchySeed * 5342.3423)) * 0.5 + 0.5;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor () {}\r\n\r\n    // ---- interface ----\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSeed (s: number): void {\r\n        this.sketchySeed = parseInt('' + s);\r\n    }\r\n\r\n    getSeed (): number {\r\n        return parseInt('' + this.sketchySeed);\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize / 2;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.settingColor = c;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    getBlending (): number {\r\n        return this.settingBlending;\r\n    }\r\n\r\n    setBlending (b: number): void {\r\n        this.settingBlending = b;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s * 2;\r\n    }\r\n\r\n    getScale (): number {\r\n        return this.settingScale;\r\n    }\r\n\r\n    setScale (s: number): void {\r\n        this.settingScale = s;\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    startLine (x: number, y: number, pressure: number, shift?: boolean): void {\r\n        if (shift && this.lastInput.x) {\r\n            this.inputIsDrawing = true;\r\n            this.endLine();\r\n        } else {\r\n            this.inputIsDrawing = true;\r\n            this.lastX = x;\r\n            this.lastY = y;\r\n            this.lastInput.x = x;\r\n            this.lastInput.y = y;\r\n            this.historyEntry = {\r\n                tool: ['brush', 'SketchyBrush'],\r\n                actions: [\r\n                    {\r\n                        action: 'setScale',\r\n                        params: [this.settingScale],\r\n                    },\r\n                    {\r\n                        action: 'setSize',\r\n                        params: [this.settingSize / 2],\r\n                    },\r\n                    {\r\n                        action: 'setOpacity',\r\n                        params: [this.settingOpacity],\r\n                    },\r\n                    {\r\n                        action: 'setColor',\r\n                        params: [this.settingColor],\r\n                    },\r\n                    {\r\n                        action: 'setBlending',\r\n                        params: [this.settingBlending],\r\n                    },\r\n                    {\r\n                        action: 'startLine',\r\n                        params: [x, y, pressure],\r\n                    },\r\n                ],\r\n            };\r\n        }\r\n\r\n    }\r\n\r\n    goLine (p_x: number, p_y: number, pressure: number, preMixedColor: IRGB): void {\r\n        if (!this.inputIsDrawing || (p_x === this.lastInput.x && p_y === this.lastInput.y)) {\r\n            return;\r\n        }\r\n\r\n        let e, b, a, g;\r\n        const x = parseInt('' + p_x);\r\n        const y = parseInt('' + p_y);\r\n        this.points.push([x, y]);\r\n\r\n        let mixr = this.settingColor.r;\r\n        let mixg = this.settingColor.g;\r\n        let mixb = this.settingColor.b;\r\n\r\n        if (preMixedColor !== null) {\r\n            mixr = preMixedColor.r;\r\n            mixg = preMixedColor.g;\r\n            mixb = preMixedColor.b;\r\n        } else {\r\n            if (this.settingBlending !== 0) {\r\n                if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < this.context.canvas.width - 1 && y - 5 < this.context.canvas.height - 1) {\r\n                    mixr = 0;\r\n                    mixg = 0;\r\n                    mixb = 0;\r\n                    const mixx = Math.min(this.context.canvas.width - 1, Math.max(0, x - 5));\r\n                    const mixy = Math.min(this.context.canvas.height - 1, Math.max(0, y - 5));\r\n                    let mixw = Math.min(this.context.canvas.width - 1, Math.max(0, x + 5));\r\n                    let mixh = Math.min(this.context.canvas.height - 1, Math.max(0, y + 5));\r\n                    mixw -= mixx;\r\n                    mixh -= mixy;\r\n\r\n                    if (mixw > 0 && mixh > 0) {\r\n                        const imdat = this.context.getImageData(mixx, mixy, mixw, mixh);\r\n                        let countmix = 0;\r\n                        for (let i = 0; i < imdat.data.length; i += 4) {\r\n                            mixr += imdat.data[i + 0];\r\n                            mixg += imdat.data[i + 1];\r\n                            mixb += imdat.data[i + 2];\r\n                            countmix++;\r\n                        }\r\n                        mixr /= countmix;\r\n                        mixg /= countmix;\r\n                        mixb /= countmix;\r\n                    }\r\n\r\n                    const mixed = this.mixmode[0](new BB.RGB(mixr, mixg, mixb), this.settingColor);\r\n                    mixr = parseInt('' + BB.mix(this.settingColor.r, mixed.r, this.settingBlending));\r\n                    mixg = parseInt('' + BB.mix(this.settingColor.g, mixed.g, this.settingBlending));\r\n                    mixb = parseInt('' + BB.mix(this.settingColor.b, mixed.b, this.settingBlending));\r\n                }\r\n            }\r\n        }\r\n\r\n        this.context.save();\r\n        this.context.strokeStyle = 'rgba(' + mixr + ', ' + mixg + ', ' + mixb + ', ' + this.settingOpacity + ')';\r\n        this.context.lineWidth = this.settingSize;\r\n\r\n        this.context.beginPath();\r\n        this.context.moveTo(this.lastX, this.lastY);\r\n        this.context.lineTo(x, y);\r\n\r\n        for (e = 0; e < this.points.length; e++) {\r\n            b = this.points[e][0] - this.points[this.count][0];\r\n            a = this.points[e][1] - this.points[this.count][1];\r\n            g = b * b + a * a;\r\n            if (g < 4000 * this.settingScale * this.settingScale && this.rand() > g / 2000 / this.settingScale / this.settingScale) {\r\n                this.context.moveTo(this.points[this.count][0] + (b * 0.3), this.points[this.count][1] + (a * 0.3));\r\n                this.context.lineTo(this.points[e][0] - (b * 0.3), this.points[e][1] - (a * 0.3));\r\n            }\r\n        }\r\n\r\n        this.context.stroke();\r\n        this.context.restore();\r\n\r\n\r\n        this.count++;\r\n        this.lastX = x;\r\n        this.lastY = y;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.historyEntry!.actions!.push({\r\n            action: 'goLine',\r\n            params: [p_x, p_y, pressure, {r: mixr, g: mixg, b: mixb}],\r\n        });\r\n    }\r\n\r\n    endLine (): void {\r\n        this.inputIsDrawing = false;\r\n        this.count = 0;\r\n        this.points = [];\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions!.push({\r\n                action: 'endLine',\r\n                params: [],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n    }\r\n    //cheap n' ugly\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.inputIsDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n\r\n        this.context.save();\r\n        this.context.lineWidth = this.settingSize;\r\n\r\n        let mixr = this.settingColor.r, mixg = this.settingColor.g, mixb = this.settingColor.b;\r\n        if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < this.context.canvas.width - 1 && y1 - 5 < this.context.canvas.height - 1) {\r\n            mixr = 0;\r\n            mixg = 0;\r\n            mixb = 0;\r\n            const mixx = Math.min(this.context.canvas.width - 1, Math.max(0, x1 - 5));\r\n            const mixy = Math.min(this.context.canvas.height - 1, Math.max(0, y1 - 5));\r\n            let mixw = Math.min(this.context.canvas.width - 1, Math.max(0, x1 + 5));\r\n            let mixh = Math.min(this.context.canvas.height - 1, Math.max(0, y1 + 5));\r\n            mixw -= mixx;\r\n            mixh -= mixy;\r\n            if (mixw > 0 && mixh > 0) {\r\n                const w = Math.min(sampleCanvas.width, mixw);\r\n                const h = Math.min(sampleCanvas.height, mixh);\r\n                sampleCtx.save();\r\n                sampleCtx.globalCompositeOperation = 'copy';\r\n                sampleCtx.drawImage(this.context.canvas, mixx, mixy, mixw, mixh, 0, 0, w, h);\r\n                sampleCtx.restore();\r\n\r\n                const imdat = sampleCtx.getImageData(mixx, mixy, mixw, mixh);\r\n                let countmix = 0;\r\n                for (let i = 0; i < imdat.data.length; i += 4) {\r\n                    mixr += imdat.data[i + 0];\r\n                    mixg += imdat.data[i + 1];\r\n                    mixb += imdat.data[i + 2];\r\n                    countmix++;\r\n                }\r\n                mixr /= countmix;\r\n                mixg /= countmix;\r\n                mixb /= countmix;\r\n            }\r\n        }\r\n        const mixed = this.mixmode[0](new BB.RGB(mixr, mixg, mixb), this.settingColor);\r\n        mixr = parseInt('' + (this.settingBlending * mixed.r + this.settingColor.r * (1 - this.settingBlending)));\r\n        mixg = parseInt('' + (this.settingBlending * mixed.g + this.settingColor.g * (1 - this.settingBlending)));\r\n        mixb = parseInt('' + (this.settingBlending * mixed.b + this.settingColor.b * (1 - this.settingBlending)));\r\n        this.context.strokeStyle = 'rgba(' + mixr + ', ' + mixg + ', ' + mixb + ', ' + this.settingOpacity + ')';\r\n        this.context.beginPath();\r\n        this.context.moveTo(x1, y1);\r\n        this.context.lineTo(x2, y2);\r\n        this.context.stroke();\r\n        this.context.strokeStyle = 'rgba(' + mixr + ', ' + mixg + ', ' + mixb + ', ' + this.settingOpacity + ')';\r\n        this.context.restore();\r\n\r\n        const historyEntry: ISketchyBrushHistoryEntry = {\r\n            tool: ['brush', 'SketchyBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'setScale',\r\n                    params: [this.settingScale],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize / 2],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setBlending',\r\n                    params: [this.settingBlending],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n\r\n    isDrawing (): boolean {\r\n        return this.inputIsDrawing;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB, TPressureInput} from '../kl-types';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {BezierLine} from '../../bb/math/line';\r\nimport {ERASE_COLOR} from './erase-color';\r\n\r\nexport interface IPixelBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'PixelBrush'];\r\n    actions: THistoryInnerActions<PixelBrush>[];\r\n}\r\n\r\n\r\nexport class PixelBrush {\r\n\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IPixelBrushHistoryEntry | undefined;\r\n    private context: CanvasRenderingContext2D;\r\n    private settingHasSizePressure: boolean = true;\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingSize: number = 0.5;\r\n    private settingSpacing: number = 0.9;\r\n    private settingOpacity: number = 1;\r\n    private settingColor: IRGB;\r\n    private settingColorStr: string;\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingIsEraser: boolean = false;\r\n    private settingUseDither: boolean = true;\r\n    private inputIsDrawing: boolean = false;\r\n    private lineToolLastDot: number;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private bezierLine: BezierLine | null = null;\r\n    private readonly ditherArr: [number, number][] = [\r\n        [3, 2],\r\n        [1, 0],\r\n        [3, 0],\r\n        [1, 2],\r\n        [2, 1],\r\n        [0, 3],\r\n        [0, 1],\r\n        [2, 3],\r\n\r\n        [2, 0],\r\n        [0, 2],\r\n        [0, 0],\r\n        [2, 2],\r\n        [1, 1],\r\n        [3, 3],\r\n        [3, 1],\r\n        [1, 3],\r\n    ];\r\n    private readonly ditherCanvas: HTMLCanvasElement;\r\n    private readonly ditherCtx: CanvasRenderingContext2D;\r\n    private ditherPattern: CanvasPattern;\r\n\r\n\r\n    private updateDither (): void {\r\n        this.ditherCtx.clearRect(0, 0, 4, 4);\r\n        this.ditherCtx.fillStyle = this.settingIsEraser ? `rgb(${ERASE_COLOR},${ERASE_COLOR},${ERASE_COLOR})` : this.settingColorStr;\r\n        for (let i = 0; i < Math.max(1, Math.round(this.settingOpacity * this.ditherArr.length)); i++) {\r\n            this.ditherCtx.fillRect(this.ditherArr[i][0], this.ditherArr[i][1], 1, 1);\r\n        }\r\n        this.ditherPattern = this.context.createPattern(this.ditherCanvas, 'repeat');\r\n    }\r\n\r\n    /**\r\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\r\n     */\r\n    private cubicCurveOverThreshold (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D, maxAngleRad: number): boolean {\r\n        const d = BB.Vec2.nor({\r\n            x: p4.x - p1.x,\r\n            y: p4.y - p1.y,\r\n        });\r\n        const d2 = BB.Vec2.nor({\r\n            x: p2.x - p1.x,\r\n            y: p2.y - p1.y,\r\n        });\r\n        const d3 = BB.Vec2.nor({\r\n            x: p4.x - p3.x,\r\n            y: p4.y - p3.y,\r\n        });\r\n        // const a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\r\n        // const a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\r\n\r\n        return Math.max(BB.Vec2.dist(d, d2), BB.Vec2.dist(d, d3)) > maxAngleRad;\r\n    }\r\n\r\n    private plotCubicBezierLine (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D): void {\r\n\r\n        const isOverThreshold = this.cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\r\n\r\n        p1.x = Math.floor(p1.x);\r\n        p1.y = Math.floor(p1.y);\r\n        p4.x = Math.floor(p4.x);\r\n        p4.y = Math.floor(p4.y);\r\n\r\n        const dist = BB.dist(p1.x, p1.y, p4.x, p4.y);\r\n        if (!isOverThreshold || dist < 7) {\r\n            this.plotLine(p1.x, p1.y, p4.x, p4.y, true);\r\n            return;\r\n        }\r\n\r\n        const n = Math.max(2, Math.round(dist / 4));\r\n        const pointArr = [];\r\n        for (let i = 0; i <= n; i++) {\r\n            const t = i / n;\r\n            const a = Math.pow(1 - t, 3);\r\n            const b = 3 * t * Math.pow(1 - t, 2);\r\n            const c = 3 * Math.pow(t, 2) * (1 - t);\r\n            const d = Math.pow(t, 3);\r\n            pointArr.push({\r\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\r\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y,\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            this.plotLine(\r\n                Math.round(pointArr[i].x),\r\n                Math.round(pointArr[i].y),\r\n                Math.round(pointArr[i + 1].x),\r\n                Math.round(pointArr[i + 1].y),\r\n                true\r\n            );\r\n        }\r\n    }\r\n\r\n    private drawDot (x: number, y: number, size: number, opacity: number): void {\r\n        this.context.save();\r\n        if (this.settingIsEraser) {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : '#fff';\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            }\r\n        } else {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        }\r\n        this.context.globalAlpha = this.settingUseDither ? 1 : opacity;\r\n        this.context.fillRect(\r\n            Math.round(x + -size),\r\n            Math.round(y + -size),\r\n            Math.round(size * 2),\r\n            Math.round(size * 2)\r\n        );\r\n        this.context.restore();\r\n    }\r\n\r\n    private continueLine (\r\n        x: number | null,\r\n        y: number | null,\r\n        size: number,\r\n        pressure: number\r\n    ): void {\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, () => {});\r\n        }\r\n\r\n        this.context.save();\r\n\r\n        const dotCallback = (\r\n            val: {\r\n                x: number;\r\n                y: number;\r\n                t: number;\r\n                angle?: number;\r\n                dAngle: number;\r\n            }\r\n        ): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            const localSize = Math.max(0.5, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            this.drawDot(val.x, val.y, localSize, localOpacity);\r\n        };\r\n\r\n        const controlCallback = (\r\n            controlObj: {\r\n                p1: IVector2D;\r\n                p2: IVector2D;\r\n                p3: IVector2D;\r\n                p4: IVector2D;\r\n            }\r\n        ): void => {\r\n            this.plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\r\n        };\r\n\r\n        if (Math.round(this.settingSize * 2) === 1) {\r\n            if (x === null || y === null) {\r\n                this.bezierLine.addFinal(4, undefined, controlCallback);\r\n            } else {\r\n                this.bezierLine.add(x, y, 4, undefined, controlCallback);\r\n            }\r\n\r\n        } else {\r\n            const localSpacing = size * this.settingSpacing;\r\n\r\n            if (x === null || y === null) {\r\n                this.bezierLine.addFinal(localSpacing, dotCallback);\r\n            } else {\r\n                this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n\r\n    /**\r\n     * bresenheim line drawing\r\n     */\r\n    private plotLine (x0: number, y0: number, x1: number, y1: number, skipFirst: boolean): void {\r\n        this.context.save();\r\n\r\n        if (this.settingIsEraser) {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : '#fff';\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            }\r\n        } else {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        }\r\n        this.context.globalAlpha = this.settingUseDither ? 1 : this.settingOpacity;\r\n\r\n        x0 = Math.floor(x0);\r\n        y0 = Math.floor(y0);\r\n        x1 = Math.floor(x1);\r\n        y1 = Math.floor(y1);\r\n\r\n        const dX = Math.abs(x1 - x0);\r\n        const sX = x0 < x1 ? 1 : -1;\r\n        const dY = -Math.abs(y1 - y0);\r\n        const sY = y0 < y1 ? 1 : -1;\r\n        let err = dX + dY;\r\n        while (true) {\r\n            if (skipFirst) {\r\n                skipFirst = false;\r\n            } else {\r\n                this.context.fillRect(x0, y0, 1, 1);\r\n            }\r\n            if (x0 === x1 && y0 === y1) {\r\n                break;\r\n            }\r\n            const e2 = 2 * err;\r\n            if (e2 >= dY) {\r\n                err += dY;\r\n                x0 += sX;\r\n            }\r\n            if (e2 <= dX) {\r\n                err += dX;\r\n                y0 += sY;\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n    constructor () {\r\n        this.ditherCanvas = BB.canvas(4, 4);\r\n        this.ditherCtx = BB.ctx(this.ditherCanvas);\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'PixelBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n                {\r\n                    action: 'setIsEraser',\r\n                    params: [this.settingIsEraser],\r\n                },\r\n                {\r\n                    action: 'setUseDither',\r\n                    params: [this.settingUseDither],\r\n                },\r\n            ],\r\n        };\r\n\r\n        if (this.settingUseDither) {\r\n            this.updateDither();\r\n        }\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.5, p * this.settingSize) : Math.max(0.5, this.settingSize);\r\n\r\n        this.inputIsDrawing = true;\r\n        this.drawDot(x, y, localSize, localOpacity);\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        this.historyEntry.actions!.push({\r\n            action: 'startLine',\r\n            params: [x, y, p],\r\n        });\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.inputIsDrawing) {\r\n            return;\r\n        }\r\n        this.historyEntry!.actions!.push({\r\n            action: 'goLine',\r\n            params: [x, y, p],\r\n        });\r\n\r\n        //debug\r\n        //drawDot(x, y, 1, 0.5);\r\n\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = pressure;\r\n    }\r\n\r\n    endLine (x: number, y: number): void {\r\n\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n\r\n        //debug\r\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\r\n        //drawDot(x, y, 10, 0.1);\r\n\r\n        this.inputIsDrawing = false;\r\n\r\n        this.bezierLine = null;\r\n\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions!.push({\r\n                action: 'endLine',\r\n                params: [x, y],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n    }\r\n\r\n    //cheap n' ugly\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n        this.lastInput.pressure = 1;\r\n\r\n        if (this.inputIsDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (this.settingUseDither) {\r\n            this.updateDither();\r\n        }\r\n\r\n        if (Math.round(this.settingSize * 2) === 1) {\r\n            this.plotLine(x1, y1, x2, y2, true);\r\n        } else {\r\n            // const angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\r\n            const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n            const eX = (x2 - x1) / mouseDist;\r\n            const eY = (y2 - y1) / mouseDist;\r\n            let loopDist;\r\n            const bdist = this.settingSize * this.settingSpacing;\r\n            this.lineToolLastDot = this.settingSize * this.settingSpacing;\r\n            for (loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n                this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity);\r\n            }\r\n        }\r\n\r\n        const historyEntry: IPixelBrushHistoryEntry = {\r\n            tool: ['brush', 'PixelBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n                {\r\n                    action: 'setIsEraser',\r\n                    params: [this.settingIsEraser],\r\n                },\r\n                {\r\n                    action: 'setUseDither',\r\n                    params: [this.settingUseDither],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n    //IS\r\n    isDrawing (): boolean {\r\n        return this.inputIsDrawing;\r\n    }\r\n\r\n    //SET\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor === c) {\r\n            return;\r\n        }\r\n        this.settingColor = c;\r\n        this.settingColorStr = 'rgb(' + this.settingColor.r + ',' + this.settingColor.g + ',' + this.settingColor.b + ')';\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = Math.round(s * 2) / 2;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = b;\r\n    }\r\n\r\n    setIsEraser (b: boolean): void {\r\n        this.settingIsEraser = !!b;\r\n    }\r\n\r\n    setUseDither (b: boolean): void {\r\n        this.settingUseDither = !!b;\r\n    }\r\n\r\n    //GET\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.settingIsEraser;\r\n    }\r\n\r\n    getUseDither (): boolean {\r\n        return this.settingUseDither;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {TPressureInput} from '../kl-types';\r\nimport {BezierLine} from '../../bb/math/line';\r\nimport {ERASE_COLOR} from './erase-color';\r\n\r\nexport interface IEraserBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'EraserBrush'];\r\n    actions: THistoryInnerActions<EraserBrush>[];\r\n}\r\n\r\ntype TIndexExtended2DContext = CanvasRenderingContext2D & { canvas: { index: number } };\r\n\r\nexport class EraserBrush {\r\n\r\n    private size: number = 30;\r\n    private spacing: number = 0.4;\r\n    private opacity: number = 1;\r\n    private useSizePressure: boolean = true;\r\n    private useOpacityPressure: boolean = false;\r\n    private isTransparentBG: boolean = false;\r\n\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IEraserBrushHistoryEntry | undefined;\r\n    private isBaseLayer: boolean = false;\r\n    private context: TIndexExtended2DContext;\r\n\r\n    private started: boolean = false;\r\n    private lastDot: number | undefined;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private bezierLine: BezierLine | undefined;\r\n\r\n\r\n    private drawDot (x: number, y: number, size: number, opacity: number): void {\r\n        this.context.save();\r\n        if (this.isBaseLayer) {\r\n            if (this.isTransparentBG) {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        } else {\r\n            this.context.globalCompositeOperation = 'destination-out';\r\n        }\r\n        const radgrad = this.context.createRadialGradient(size, size, 0, size, size, size);\r\n        let sharpness = Math.pow(opacity, 2);\r\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\r\n        const oFac = Math.max(0, Math.min(1, opacity));\r\n        const localOpacity = 2 * oFac - oFac * oFac;\r\n        radgrad.addColorStop(sharpness, `rgba(${ERASE_COLOR}, ${ERASE_COLOR}, ${ERASE_COLOR}, ` + localOpacity + ')');\r\n        radgrad.addColorStop(1, `rgba(${ERASE_COLOR}, ${ERASE_COLOR}, ${ERASE_COLOR}, 0)`);\r\n        this.context.fillStyle = radgrad;\r\n        this.context.translate(x - size, y - size);\r\n        this.context.fillRect(0, 0, size * 2, size * 2);\r\n        this.context.restore();\r\n    }\r\n\r\n    private continueLine (x: number | null, y: number | null, p: number): void {\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (this.useSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * localSize * this.spacing);\r\n\r\n        const bezierCallback = (val: {\r\n            x: number;\r\n            y: number;\r\n            t: number;\r\n            angle?: number;\r\n            dAngle: number;\r\n        }): void => {\r\n            const factor = val.t;\r\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (this.useOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\r\n            localSize = (this.useSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\r\n\r\n            this.drawDot(val.x, val.y, localSize, localOpacity);\r\n        };\r\n\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n    }\r\n\r\n    // ---- public -----\r\n    constructor () {}\r\n\r\n    // ---- interface ----\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'EraserBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.useOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.useSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.size],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.opacity],\r\n                },\r\n                {\r\n                    action: 'setTransparentBG',\r\n                    params: [this.isTransparentBG],\r\n                },\r\n                {\r\n                    action: 'startLine',\r\n                    params: [x, y, p],\r\n                },\r\n            ],\r\n        };\r\n\r\n        this.isBaseLayer = 0 === this.context.canvas.index;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        const localOpacity = (this.useOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.useSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n        this.started = true;\r\n        if (localSize > 1) {\r\n            this.drawDot(x, y, localSize, localOpacity);\r\n        }\r\n        this.lastDot = localSize * this.spacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        this.bezierLine = new BB.BezierLine();\r\n        this.bezierLine.add(x, y, 0, () => undefined);\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.started || !this.historyEntry) {\r\n            return;\r\n        }\r\n        this.historyEntry.actions?.push({\r\n            action: 'goLine',\r\n            params: [x, y, p],\r\n        });\r\n\r\n        this.continueLine(x, y, this.lastInput.pressure);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n    }\r\n\r\n    endLine (): void {\r\n\r\n        if (this.bezierLine) {\r\n            this.continueLine(null, null, this.lastInput.pressure);\r\n        }\r\n\r\n        this.started = false;\r\n        this.bezierLine = undefined;\r\n\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions?.push({\r\n                action: 'endLine',\r\n                params: [],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n\r\n        this.isBaseLayer = 0 === this.context.canvas.index;\r\n\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.started || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * this.size * this.spacing);\r\n        this.lastDot = 0;\r\n        for (loopDist = this.lastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.size, this.opacity);\r\n        }\r\n\r\n\r\n        const historyEntry: IEraserBrushHistoryEntry = {\r\n            tool: ['brush', 'EraserBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.useOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.useSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.size],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.opacity],\r\n                },\r\n                {\r\n                    action: 'setTransparentBG',\r\n                    params: [this.isTransparentBG],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n    //IS\r\n    isDrawing (): boolean {\r\n        return this.started;\r\n    }\r\n\r\n    //SET\r\n    setContext (c: TIndexExtended2DContext): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.size = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.opacity = o;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.useSizePressure = b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.useOpacityPressure = b;\r\n    }\r\n\r\n    setTransparentBG (b: boolean): void {\r\n        this.isTransparentBG = !!b;\r\n    }\r\n\r\n    //GET\r\n    getSize (): number {\r\n        return this.size;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacity;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb-types';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB} from '../kl-types';\r\nimport {clamp} from '../../bb/math/math';\r\n\r\nexport interface ISmudgeBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'SmudgeBrush'];\r\n    actions: THistoryInnerActions<SmudgeBrush>[];\r\n}\r\n\r\n// let statCount = 1;\r\n// let statAcc = 0;\r\n// stats on win10, chrome, size 100, opacity 80, smudge()\r\n// unoptimized: 1 ms\r\n// minimal: 0.09 ms\r\n// minimal + circle: 0.5ms\r\n// minimal + circle + ix, iy: 0.23ms\r\n// unoptimized + ix, iy: 0.64 ms\r\n// unoptimized + ix, iy + sans rounding: 0.61 ms\r\n// ix, iy + sans rounding + sans random: 0.32ms\r\n// ix, iy + sans rounding + fast random: 0.46 ms\r\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\r\n\r\nconst CELL_SIZE = 256;\r\n\r\ninterface ISmudgeParams {\r\n    aP: IVector2D;\r\n    bP: IVector2D;\r\n    size: {\r\n        w: number;\r\n        h: number;\r\n    };\r\n    brush: {\r\n        center: IVector2D;\r\n        size: number;\r\n        opacity: number;\r\n        alphaLock: boolean;\r\n    };\r\n}\r\n\r\n\r\n/**\r\n * determine bounds of smudge\r\n * @param imWidth\r\n * @param imHeight\r\n * @param aP\r\n * @param bP\r\n * @param size\r\n */\r\nfunction prepSmudge (\r\n    imWidth: number,\r\n    imHeight: number,\r\n    aP: IVector2D, // top left of source, integers\r\n    bP: IVector2D, // top left of dest, integers\r\n    size: {w: number; h: number}, // size of both rectangles, integers\r\n): ({\r\n    aP: IVector2D;\r\n    bP: IVector2D;\r\n    size: {w: number; h: number};\r\n} | null) {\r\n\r\n    if (aP.x === bP.x && aP.y === bP.y) {\r\n        return null;\r\n    }\r\n\r\n    aP = BB.copyObj(aP);\r\n    bP = BB.copyObj(bP);\r\n    size = BB.copyObj(size);\r\n\r\n    // corner behavior\r\n    // cut down rectangles, if a or b go outside\r\n    // i.e. if user drags partially or fully outside the canvas\r\n    {\r\n        let top = 0;\r\n        let right = 0;\r\n        let bottom = 0;\r\n        let left = 0;\r\n\r\n        if (aP.x < 0) {\r\n            left = -aP.x;\r\n        }\r\n        if (aP.y < 0) {\r\n            top = -aP.y;\r\n        }\r\n        if (bP.x < 0) {\r\n            left = Math.max(left, -bP.x);\r\n        }\r\n        if (bP.y < 0) {\r\n            top = Math.max(top, -bP.y);\r\n        }\r\n        if (aP.x + size.w > imWidth) {\r\n            right = aP.x + size.w - imWidth;\r\n        }\r\n        if (aP.y + size.h > imHeight) {\r\n            bottom = aP.y + size.h - imHeight;\r\n        }\r\n        if (bP.x + size.w > imWidth) {\r\n            right = Math.max(right, bP.x + size.w - imWidth);\r\n        }\r\n        if (bP.y + size.h > imHeight) {\r\n            bottom = Math.max(bottom, bP.y + size.h - imHeight);\r\n        }\r\n\r\n        aP.x += left;\r\n        bP.x += left;\r\n        aP.y += top;\r\n        bP.y += top;\r\n\r\n        size.w = size.w - left - right;\r\n        size.h = size.h - top - bottom;\r\n        if (size.w <= 0 || size.h <= 0) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    return {\r\n        aP: {\r\n            x: aP.x,\r\n            y: aP.y,\r\n        },\r\n        bP: {\r\n            x: bP.x,\r\n            y: bP.y,\r\n        },\r\n        size: {\r\n            w: size.w,\r\n            h: size.h,\r\n        },\r\n    };\r\n}\r\n\r\n/**\r\n * Pixel operations that do the smudging via ImageData\r\n * @param imageData\r\n * @param p\r\n */\r\nfunction smudge (imageData: ImageData, p : ISmudgeParams): void {\r\n\r\n    p = BB.copyObj(p);\r\n\r\n    const cSize = p.brush.size;\r\n    const cX = p.brush.center.x;\r\n    const cY = p.brush.center.y;\r\n\r\n    /*if (statCount % 1000 === 0) {\r\n        console.log(statAcc / 1000);\r\n        statAcc = 0;\r\n    }\r\n    let start = performance.now();*/\r\n\r\n\r\n    // determine offset\r\n    const aIndex = p.aP.y * imageData.width + p.aP.x;\r\n    const bIndex = p.bP.y * imageData.width + p.bP.x;\r\n    const offset = (bIndex - aIndex) * 4;\r\n\r\n    // array with random numbers. faster than Math.random()\r\n    let randI = 0;\r\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n    const randArr: number[] = [];\r\n    for (let i = 0; i < randLen; i++) {\r\n        randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n    }\r\n\r\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\r\n\r\n    const pixel = (ai: number, bi: number, ix: number, iy: number): void => {\r\n\r\n        const dist = BB.dist(cX, cY, ix, iy);\r\n        const fac = 1 - p.brush.opacity * (1 - clamp((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\r\n\r\n        if (fac === 1) {\r\n            return;\r\n        }\r\n\r\n        if (!imageData.data[ai + 3]) {\r\n\r\n        } else if (!imageData.data[bi + 3]) { // don't mix if target fully transparent. pixel might have a strange color.\r\n            imageData.data[bi] = imageData.data[ai + 0];\r\n            imageData.data[bi + 1] = imageData.data[ai + 1];\r\n            imageData.data[bi + 2] = imageData.data[ai + 2];\r\n        } else {\r\n\r\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\r\n            // not totally accurate. TODO same compositing as blend brush\r\n            let fac2;\r\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) {\r\n                fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\r\n            } else {\r\n                fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\r\n            }\r\n\r\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\r\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\r\n            // No +0.5, because it cancels out with rand.\r\n            imageData.data[bi] = Math.floor(BB.mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\r\n            imageData.data[bi + 1] = Math.floor(BB.mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\r\n            imageData.data[bi + 2] = Math.floor(BB.mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\r\n\r\n            randI = (randI + 1) % randLen;\r\n        }\r\n        // Always mix alpha. unless alpha lock\r\n        if (!p.brush.alphaLock) {\r\n            imageData.data[bi + 3] = Math.floor(BB.mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\r\n        }\r\n\r\n    };\r\n\r\n    const bx1 = p.bP.x * 4;\r\n    const bx2 = bx1 + (p.size.w - 1) * 4;\r\n\r\n    // transfer of pixels depends on direction of smudging if there is overlap\r\n    if (p.aP.y < p.bP.y) {\r\n        for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else if (p.aP.y > p.bP.y) {\r\n        for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else {\r\n        if (p.aP.x < p.bP.x) {\r\n            for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        } else {\r\n            for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x; x < bx2 + yStart; x += 4, x2 += 4, ix++) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //statCount++;\r\n    //statAcc += performance.now() - start;\r\n}\r\n\r\nexport class SmudgeBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: ISmudgeBrushHistoryEntry;\r\n\r\n    private settingColor: IRGB = {r: 0, g: 0, b: 0};\r\n    private settingSize: number = 35;\r\n    private settingSpacing: number = 0.20446882736951905;\r\n    private settingOpacity: number = 0.8;\r\n    private settingColorStr: string;\r\n    private settingHasSizePressure: boolean = false;\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingLockLayerAlpha: boolean = false;\r\n\r\n    private lineToolLastDot: number;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastDot: IVector2D;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private bezierLine: any = null; // todo type BezierLine\r\n\r\n    private redrawBounds: IBounds;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    private copyImageData: ImageData;\r\n\r\n    private drawBuffer: ISmudgeParams[] = [];\r\n\r\n    private copiedCells: boolean[];\r\n\r\n    private updateRedrawBounds (bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    private updateCompleteRedrawBounds (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.completeRedrawBounds = BB.updateBounds(\r\n            this.completeRedrawBounds,\r\n            { x1, y1, x2, y2 }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    copyFromCanvas (): void {\r\n\r\n        const touchedCells = this.copiedCells.map(item => false);\r\n\r\n        const bounds: IBounds[] = [];\r\n        const cellsW = Math.ceil(this.copyImageData.width / CELL_SIZE);\r\n\r\n        if (!this.redrawBounds) {\r\n            return;\r\n        }\r\n        bounds.push({\r\n            x1: Math.floor(this.redrawBounds.x1 / CELL_SIZE),\r\n            y1: Math.floor(this.redrawBounds.y1 / CELL_SIZE),\r\n            x2: Math.floor(this.redrawBounds.x2 / CELL_SIZE),\r\n            y2: Math.floor(this.redrawBounds.y2 / CELL_SIZE),\r\n        });\r\n        bounds.forEach(item => {\r\n            for (let i = item.x1; i <= item.x2; i++) {\r\n                for (let e = item.y1; e <= item.y2; e++) {\r\n                    touchedCells[e * cellsW + i] = true;\r\n                }\r\n            }\r\n        });\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.copiedCells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            this.copiedCells[i] = true;\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * CELL_SIZE + CELL_SIZE, this.copyImageData.width) - 1) % CELL_SIZE + 1;\r\n            const h = (Math.min(y * CELL_SIZE + CELL_SIZE, this.copyImageData.height) - 1) % CELL_SIZE + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = BB.ctx(tmpCanvas);\r\n            tmpCtx.drawImage(this.context.canvas, -x * CELL_SIZE, -y * CELL_SIZE);\r\n\r\n            const data = tmpCtx.getImageData(0, 0, w, h);\r\n\r\n            for (let i = 0; i < h; i++) {\r\n                for (let e = 0, e2 = i * w * 4, e3 = ((y * CELL_SIZE + i) * this.copyImageData.width + x * CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4) {\r\n                    this.copyImageData.data[e3] = data.data[e2];\r\n                    this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\r\n                    this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\r\n                    this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * fill drawBuffer with params about to be drawn\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     */\r\n    prepDot (x: number, y: number, size: number, opacity: number): void {\r\n        if (!this.lastDot) {\r\n            this.lastDot = {\r\n                x: x,\r\n                y: y,\r\n            };\r\n            return;\r\n        }\r\n\r\n        size = Math.round(size);\r\n\r\n\r\n        const w = Math.round(size * 2);\r\n        const h = Math.round(size * 2);\r\n\r\n        const bounds = prepSmudge(\r\n            this.copyImageData.width,\r\n            this.copyImageData.height,\r\n            {\r\n                x: Math.round(this.lastDot.x - size),\r\n                y: Math.round(this.lastDot.y - size),\r\n            },\r\n            {\r\n                x: Math.round(x - size),\r\n                y: Math.round(y - size),\r\n            },\r\n            {\r\n                w,\r\n                h,\r\n            },\r\n        );\r\n\r\n        if (bounds) {\r\n            const params: ISmudgeParams = {\r\n                aP: bounds.aP,\r\n                bP: bounds.bP,\r\n                size: bounds.size,\r\n                brush: {\r\n                    center: { x, y },\r\n                    size,\r\n                    opacity,\r\n                    alphaLock: this.settingLockLayerAlpha,\r\n                },\r\n            };\r\n            this.updateRedrawBounds({\r\n                x1: params.bP.x,\r\n                y1: params.bP.y,\r\n                x2: params.bP.x + params.brush.size * 2,\r\n                y2: params.bP.y + params.brush.size * 2,\r\n            });\r\n            this.drawBuffer.push(params);\r\n        }\r\n\r\n        this.lastDot = {\r\n            x: x,\r\n            y: y,\r\n        };\r\n    }\r\n\r\n    continueLine (x: number, y: number, size: number, pressure: number): void {\r\n        this.drawBuffer = [];\r\n\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function (){});\r\n        }\r\n\r\n        const drawArr = []; //draw instructions. will be all drawn at once\r\n\r\n        const dotCallback = (val): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        };\r\n\r\n        const localSpacing = size * this.settingSpacing / 3;\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            const item = drawArr[i];\r\n            this.prepDot(item[0], item[1], item[2], item[3]);\r\n            before = item;\r\n        }\r\n\r\n        this.copyFromCanvas();\r\n\r\n        for (let i = 0; i < this.drawBuffer.length; i++) {\r\n            smudge(this.copyImageData, this.drawBuffer[i]);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor () { }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'SmudgeBrush'],\r\n            actions: [],\r\n        };\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.lastDot = null;\r\n        this.isDrawing = true;\r\n\r\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\r\n        const totalCells = Math.ceil(this.context.canvas.width / CELL_SIZE) * Math.ceil(this.context.canvas.height / CELL_SIZE);\r\n        this.copiedCells = '0'.repeat(totalCells).split('').map(item => false);\r\n\r\n        this.prepDot(x, y, localSize, localOpacity);\r\n\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2.pressure = p;\r\n\r\n        this.completeRedrawBounds = null;\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        this.redrawBounds = null;\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput2.pressure = this.lastInput.pressure;\r\n        this.lastInput.pressure = pressure;\r\n    }\r\n\r\n    endLine (): void {\r\n        this.redrawBounds = null;\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.context.save();\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n        this.context.restore();\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        if (this.historyEntry && this.completeRedrawBounds) {\r\n            let historyIm: ImageData | HTMLCanvasElement = this.copyImageData;\r\n            if (!(\r\n                this.completeRedrawBounds.x1 === 0 &&\r\n                this.completeRedrawBounds.y1 === 0 &&\r\n                this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 &&\r\n                this.completeRedrawBounds.y2 >= this.context.canvas.height - 1\r\n            )) {\r\n\r\n                // temp canvas to prevent main canvas from getting slowed down in chrome\r\n                const tmpCanvas = BB.canvas(\r\n                    this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                    this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n                );\r\n                const tmpCtx = BB.ctx(tmpCanvas);\r\n                tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n                historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\r\n            }\r\n            this.historyEntry.actions.push({\r\n                action: 'drawImage',\r\n                params: [\r\n                    historyIm,\r\n                    this.completeRedrawBounds.x1,\r\n                    this.completeRedrawBounds.y1,\r\n                ],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n        this.copyImageData = null;\r\n    }\r\n\r\n    drawImage (im: ImageData | HTMLCanvasElement, x: number, y: number): void {\r\n        if (im instanceof ImageData) {\r\n            this.context.putImageData(im, x, y);\r\n        } else {\r\n            this.context.clearRect(x, y, im.width, im.height);\r\n            this.context.drawImage(im, x, y);\r\n        }\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        return;\r\n        /*\r\n        // todo\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = settingSize * settingSpacing;\r\n        lineToolLastDot = settingSize * settingSpacing;\r\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\r\n        }\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"SmudgeBrush\"],\r\n            actions: []\r\n        };\r\n        // todo\r\n        history.add(historyEntry);*/\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) {\r\n            return;\r\n        }\r\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\r\n        this.settingColorStr = BB.ColorConverter.toRgbStr(this.settingColor);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = !!b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = !!b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl-types';\r\nimport {IBounds} from '../../bb/bb-types';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {ERASE_COLOR} from './erase-color';\r\n\r\nexport interface IChemyBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'ChemyBrush'];\r\n    actions: THistoryInnerActions<ChemyBrush>[];\r\n}\r\n\r\ntype TChemyMode = 'fill' | 'stroke';\r\n\r\nexport class ChemyBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private settingColor: IRGB;\r\n    private settingSize: number = 0.25; // radius - 0.5 - 99999\r\n    private settingOpacity: number = 1; // 0-1\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingIsEraser: boolean = false;\r\n    private settingMode: TChemyMode = 'fill';\r\n    private settingDistort: number = 0; // 0 - 1\r\n    private settingXSymmetry: boolean = false;\r\n    private settingYSymmetry: boolean = false;\r\n    private settingGradient: boolean = false;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private history: KlHistoryInterface;\r\n\r\n    private copyCanvas: HTMLCanvasElement;\r\n    private path: {x: number; y: number}[];\r\n    private minY: number;\r\n    private maxY: number;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    private updateCompleteRedrawBounds (x: number, y: number): void {\r\n        let bounds = { x1: x, y1: y, x2: x, y2: y};\r\n        if (this.settingXSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: -x + this.copyCanvas.width,\r\n                    y1: y,\r\n                    x2: -x + this.copyCanvas.width,\r\n                    y2: y,\r\n                }\r\n                );\r\n        }\r\n        if (this.settingYSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: x,\r\n                    y1: -y + this.copyCanvas.height,\r\n                    x2: x,\r\n                    y2: -y + this.copyCanvas.height,\r\n                }\r\n            );\r\n        }\r\n        const buffer = this.settingMode === 'stroke' ? this.settingSize + 1 : 1;\r\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\r\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\r\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\r\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\r\n\r\n        this.completeRedrawBounds = BB.updateBounds(this.completeRedrawBounds, bounds);\r\n    }\r\n\r\n    private drawShape (): void {\r\n        this.context.save();\r\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\r\n        this.context.drawImage(this.copyCanvas, 0, 0);\r\n\r\n        const color = {...this.settingColor};\r\n        if (this.settingIsEraser) {\r\n            color.r = ERASE_COLOR;\r\n            color.g = ERASE_COLOR;\r\n            color.b = ERASE_COLOR;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            }\r\n        } else {\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        }\r\n\r\n        if (this.path) {\r\n\r\n            // path\r\n            const path = new Path2D();\r\n            this.path.forEach((item, index) => {\r\n                if (index === 0) {\r\n                    path.moveTo(item.x, item.y);\r\n                } else {\r\n                    path.lineTo(item.x, item.y);\r\n                }\r\n            });\r\n\r\n            let style: string | CanvasGradient = BB.ColorConverter.toRgbaStr({\r\n                r: color.r,\r\n                g: color.g,\r\n                b: color.b,\r\n                a: this.settingOpacity,\r\n            });\r\n            if (this.settingGradient) {\r\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\r\n                const gradient = this.context.createLinearGradient(\r\n                    0, startAtTop ? this.minY : this.maxY,\r\n                    0, startAtTop ? this.maxY : this.minY,\r\n                );\r\n                gradient.addColorStop(\r\n                    0,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: this.settingOpacity,\r\n                    })\r\n                );\r\n                gradient.addColorStop(\r\n                    1,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: 0,\r\n                    })\r\n                );\r\n                style = gradient;\r\n            }\r\n\r\n            // setup params\r\n            if (this.settingMode === 'fill') {\r\n                this.context.fillStyle = style;\r\n\r\n            } else {\r\n                this.context.lineWidth = this.settingSize * 2;\r\n                this.context.lineJoin = 'bevel';\r\n                this.context.strokeStyle = style;\r\n            }\r\n\r\n            // draw\r\n            const draw = () => {\r\n                if (this.settingMode === 'fill') {\r\n                    this.context.fill(path);\r\n                } else {\r\n                    this.context.stroke(path);\r\n                }\r\n            };\r\n\r\n            draw();\r\n            if (this.settingXSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(this.context.canvas.width / 2, 0);\r\n                this.context.scale(-1, 1);\r\n                this.context.translate(-this.context.canvas.width / 2, 0);\r\n                draw();\r\n                this.context.restore();\r\n            }\r\n            if (this.settingYSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(0, this.context.canvas.height / 2);\r\n                this.context.scale(1, -1);\r\n                this.context.translate(0, -this.context.canvas.height / 2);\r\n                draw();\r\n                this.context.restore();\r\n                if (this.settingXSymmetry) {\r\n                    this.context.save();\r\n                    this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\r\n                    this.context.scale(-1, -1);\r\n                    this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\r\n                    draw();\r\n                    this.context.restore();\r\n                }\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingMode === 'stroke' ? this.settingSize : 0;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.settingColor = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setMode (mode: TChemyMode): void {\r\n        this.settingMode = mode;\r\n    }\r\n\r\n    getMode (): TChemyMode {\r\n        return this.settingMode;\r\n    }\r\n\r\n    setDistort (distort: number): void {\r\n        this.settingDistort = BB.clamp(distort, 0, 1);\r\n    }\r\n\r\n    getDistort (): number {\r\n        return this.settingDistort;\r\n    }\r\n\r\n    setXSymmetry (b: boolean): void {\r\n        this.settingXSymmetry = !!b;\r\n    }\r\n\r\n    getXSymmetry (): boolean {\r\n        return this.settingXSymmetry;\r\n    }\r\n\r\n    setYSymmetry (b: boolean): void {\r\n        this.settingYSymmetry = !!b;\r\n    }\r\n\r\n    getYSymmetry (): boolean {\r\n        return this.settingYSymmetry;\r\n    }\r\n\r\n    setGradient (b: boolean): void {\r\n        this.settingGradient = !!b;\r\n    }\r\n\r\n    getGradient (): boolean {\r\n        return this.settingGradient;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.settingIsEraser;\r\n    }\r\n\r\n    setIsEraser (b: boolean): void {\r\n        this.settingIsEraser = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    startLine (x: number, y: number): void {\r\n        this.isDrawing = true;\r\n        this.path = [{x, y}];\r\n        this.minY = y;\r\n        this.maxY = y;\r\n        this.copyCanvas = BB.canvas(this.context.canvas.width, this.context.canvas.height);\r\n        BB.ctx(this.copyCanvas).drawImage(this.context.canvas, 0, 0);\r\n        this.completeRedrawBounds = null;\r\n        this.updateCompleteRedrawBounds(x, y);\r\n    }\r\n\r\n    goLine (x: number, y: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        const pos = { x, y };\r\n        if (this.settingDistort > 0) {\r\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\r\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\r\n        }\r\n\r\n        this.minY = Math.min(this.minY, pos.y);\r\n        this.maxY = Math.max(this.maxY, pos.y);\r\n        this.path.push(pos);\r\n        this.updateCompleteRedrawBounds(x, y);\r\n        this.drawShape();\r\n    }\r\n\r\n    endLine (): void {\r\n        this.isDrawing = false;\r\n        this.completeRedrawBounds = BB.boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\r\n        if (this.path.length > 1 && this.completeRedrawBounds) {\r\n            const historyCanvas = BB.canvas(\r\n                this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n            );\r\n            const historyCtx = BB.ctx(historyCanvas);\r\n            historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n            this.history.push({\r\n                tool: ['brush', 'ChemyBrush'],\r\n                actions: [\r\n                    {\r\n                        action: 'drawImage',\r\n                        params: [\r\n                            historyCanvas, // faster than getting image data (measured on 2018 lenovo chromebook)\r\n                            this.completeRedrawBounds.x1,\r\n                            this.completeRedrawBounds.y1,\r\n                        ],\r\n                    },\r\n                ],\r\n            } as IChemyBrushHistoryEntry);\r\n        }\r\n        this.path = null;\r\n        this.copyCanvas = null;\r\n    }\r\n\r\n    drawImage (im: HTMLCanvasElement, x: number, y: number): void {\r\n        this.context.save();\r\n        this.context.clearRect(x, y, im.width, im.height);\r\n        this.context.drawImage(im, x, y);\r\n        this.context.restore();\r\n    }\r\n\r\n    drawLineSegment (x1, y1, x2, y2): void {\r\n        // might make sense for stroke\r\n    }\r\n}\r\n","import {penBrushUi} from './pen-brush-ui';\r\nimport {blendBrushUi} from './blend-brush-ui';\r\nimport {sketchyBrushUi} from './sketchy-brush-ui';\r\nimport {pixelBrushUi} from './pixel-brush-ui';\r\nimport {eraserBrushUi} from './eraser-brush-ui';\r\nimport {smudgeBrushUi} from './smudge-brush-ui';\r\nimport {chemyBrushUi} from './chemy-brush-ui';\r\nimport {IBrushUi} from '../kl-types';\r\n\r\n/**\r\n * UI for brushes.\r\n * Each brush ui carries the brush with it.\r\n * So if you want to draw, you do it through the UI. should be changed sometime.\r\n */\r\n\r\nexport const brushesUI: {\r\n    [key: string]: IBrushUi;\r\n} = {\r\n    penBrush: penBrushUi,\r\n    blendBrush: blendBrushUi,\r\n    sketchyBrush: sketchyBrushUi,\r\n    pixelBrush: pixelBrushUi,\r\n    chemyBrush: chemyBrushUi,\r\n    smudgeBrush: smudgeBrushUi,\r\n    eraserBrush: eraserBrushUi,\r\n};\r\n","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport brushIconImg from '/src/app/img/ui/brush-pen.svg';\r\nimport {genBrushAlpha01, genBrushAlpha02} from '../brushes/alphas/brush-alphas';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {Options} from '../ui/components/options';\r\n\r\n\r\nexport const penBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pen'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1/100,\r\n            max: 1,\r\n            curve: [[0, 1/100], [0.5, 30/100], [1, 1]],\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    let alphaNames = [\r\n        LANG('brush-pen-circle'),\r\n        LANG('brush-pen-chalk'),\r\n        LANG('brush-pen-calligraphy'),\r\n        LANG('brush-pen-square'),\r\n    ];\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pen');\r\n        alphaNames = [\r\n            LANG('brush-pen-circle'),\r\n            LANG('brush-pen-chalk'),\r\n            LANG('brush-pen-calligraphy'),\r\n            LANG('brush-pen-square'),\r\n        ];\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.PenBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        const alphaOptions = new Options({\r\n            optionArr: [0, 1, 2, 3].map(id => {\r\n\r\n                const alpha = BB.el({\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        width: '31px',\r\n                        height: '31px',\r\n                        backgroundSize: 'contain',\r\n                        margin: '2px',\r\n                    },\r\n                });\r\n                const canvas = BB.canvas(70, 70);\r\n                const ctx = BB.ctx(canvas);\r\n                if (id === 0 || id === 3) {\r\n                    if (id === 0) {\r\n                        ctx.beginPath();\r\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\r\n                        ctx.closePath();\r\n                        ctx.fill();\r\n                    } else {\r\n                        ctx.fillRect(5, 5, 60, 60);\r\n                    }\r\n                } else if (id === 1) {\r\n                    ctx.drawImage(genBrushAlpha01(60), 5, 5);\r\n                } else if (id === 2) {\r\n                    ctx.drawImage(genBrushAlpha02(60), 5, 5);\r\n                }\r\n                alpha.style.backgroundImage = 'url(' + canvas.toDataURL('image/png') + ')';\r\n\r\n                return {\r\n                    id: id,\r\n                    label: alpha,\r\n                    title: alphaNames[id],\r\n                };\r\n            }),\r\n            initId: 0,\r\n            onChange: (id) => {\r\n                brush.setAlpha(id);\r\n            },\r\n        });\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n            css: {\r\n                display: 'inline-block',\r\n            },\r\n        });\r\n\r\n        const spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: alphaOptions.getElement(),\r\n                    css: {\r\n                        marginTop: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: lockAlphaToggle.getElement(),\r\n                    css: {\r\n                        marginTop: '10px',\r\n                    },\r\n                }),\r\n            );\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","\r\nexport const eventResMs = 20;","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6218s\");","import {BB} from '../../bb/bb';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport brushIconImg from '/src/app/img/ui/brush-blend.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const blendBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-blend'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-blend');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.BlendBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: 58,\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n            const blendingSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 225,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: brush.getBlending(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val);\r\n                },\r\n            });\r\n            blendingSlider.getElement().style.marginTop = '10px';\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.setSizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.setOpacityPressure(b);\r\n            });\r\n\r\n            const lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                    display: 'inline-block',\r\n                },\r\n            });\r\n\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                }),\r\n                blendingSlider.getElement(),\r\n                lockAlphaToggle.getElement()\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y, p, isCoalesced);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"50oCU\");","import {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport brushIconImg from '/src/app/img/ui/brush-sketchy.png';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {BB} from '../../bb/bb';\r\n\r\nexport const sketchyBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-sketchy'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 10,\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-sketchy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.SketchyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize() * 2,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: function (val) {\r\n                    brush.setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n            const blendSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: brush.getBlending(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val);\r\n                },\r\n            });\r\n            const scaleSlider = new KlSlider({\r\n                label: LANG('brush-sketchy-scale'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 1,\r\n                max: 20,\r\n                value: brush.getScale(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setScale(val);\r\n                },\r\n            });\r\n            opacitySlider.getElement().style.marginTop = '10px';\r\n            blendSlider.getElement().style.marginTop = '10px';\r\n            scaleSlider.getElement().style.marginTop = '10px';\r\n            div.append(\r\n                sizeSlider.getElement(),\r\n                opacitySlider.getElement(),\r\n                blendSlider.getElement(),\r\n                scaleSlider.getElement(),\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, pressure) {\r\n            brush.startLine(x, y, pressure);\r\n        };\r\n        this.goLine = function (x, y, pressure) {\r\n            brush.goLine(x, y, pressure, null);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getSeed = function () {\r\n            return parseInt(brush.getSeed());\r\n        };\r\n        this.setSeed = function (s) {\r\n            brush.setSeed(parseInt(s));\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"jDYzC\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport brushIconImg from '/src/app/img/ui/brush-pixel.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const pixelBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pixel'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]],\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pixel');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.PixelBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n            css: {\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n\r\n        const eraserToggle = new Checkbox({\r\n            init: brush.getIsEraser(),\r\n            label: LANG('eraser'),\r\n            callback: function (b) {\r\n                brush.setIsEraser(b);\r\n            },\r\n            css: {\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n\r\n        const ditherToggle = new Checkbox({\r\n            init: brush.getUseDither(),\r\n            label: LANG('brush-pixel-dither'),\r\n            callback: function (b) {\r\n                brush.setUseDither(b);\r\n            },\r\n        });\r\n\r\n        const spacingSpline = new BB.SplineInterpolator([[0.5, 0.45], [100, 4]]);\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                opacitySlider.getElement()\r\n            );\r\n\r\n            const toggleRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n\r\n            toggleRow.append(\r\n                lockAlphaToggle.getElement(),\r\n                eraserToggle.getElement(),\r\n                ditherToggle.getElement(),\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size * 2);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity * 100);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"j07R3\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport brushIconImg from '/src/app/img/ui/brush-eraser.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const eraserBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('eraser') + ' [E]',\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 200,\r\n            curve: BB.quadraticSplineInput(0.5, 200, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('eraser') + ' [E]';\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.EraserBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n        let isTransparentBg = false;\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: 30,\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                })\r\n            );\r\n\r\n            const transparencyToggle = new Checkbox({\r\n                init: false,\r\n                label: LANG('brush-eraser-transparent-bg'),\r\n                callback: function (b) {\r\n                    isTransparentBg = b;\r\n                    brush.setTransparentBG(b);\r\n                },\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            div.append(transparencyToggle.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        function drawDot (x, y) {\r\n            brush.drawDot(x, y);\r\n        }\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            //brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.getIsTransparentBg = function () {\r\n            return isTransparentBg;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fvqmo\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport brushIconImg from '/src/app/img/ui/brush-smudge.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const smudgeBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-smudge'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]],\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-smudge');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.SmudgeBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n        });\r\n\r\n        const spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(false, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                })\r\n            );\r\n\r\n            const bottomRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            bottomRow.append(lockAlphaToggle.getElement());\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"gNPk4\");","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport brushIconImg from '/src/app/img/ui/brush-chemy.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {Options} from '../ui/components/options';\r\nimport {BoxToggle} from '../ui/components/box-toggle';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const chemyBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-chemy'),\r\n        sizeSlider: {\r\n            min: 0.25,\r\n            max: 25,\r\n            curve: BB.quadraticSplineInput(0.25, 25, 0.1),\r\n            isDisabled: true,\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-chemy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.ChemyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider: KlSlider;\r\n        let opacitySlider: KlSlider;\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                isEnabled: brush.getMode() === 'stroke',\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 5) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            BB.css(opacitySlider.getElement(), {\r\n                marginTop: '10px',\r\n            });\r\n\r\n            const eraserToggle = new Checkbox({\r\n                init: brush.getIsEraser(),\r\n                label: LANG('eraser'),\r\n                callback: function (b) {\r\n                    brush.setIsEraser(b);\r\n                },\r\n                css: {\r\n                    marginTop: '10px',\r\n                    marginLeft: '10px',\r\n                },\r\n            });\r\n\r\n            const lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n\r\n            const toggleRow = BB.el({\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n\r\n            const iconSize = 35;\r\n            const padding = 8;\r\n            const actualIconSize = iconSize - padding * 2;\r\n            const halfSize = actualIconSize / 2;\r\n\r\n            const modeOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'fill',\r\n                        label: BB.createSvg({\r\n                            class: 'dark-invert',\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: '#000',\r\n                                    style: `transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-fill'),\r\n                    },\r\n                    {\r\n                        id: 'stroke',\r\n                        label: BB.createSvg({\r\n                            class: 'dark-invert',\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: 'none',\r\n                                    stroke: '#000',\r\n                                    style: `stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-stroke'),\r\n                    },\r\n                ],\r\n                initId: brush.getMode(),\r\n                onChange: (id: string): void => {\r\n                    brush.setMode(id as 'stroke' | 'fill');\r\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === 'fill';\r\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\r\n\r\n                    const brushSize = brush.getSize();\r\n                    sizeSlider.setValue(brushSize);\r\n                    p.onSizeChange(brushSize);\r\n                    p.onConfigChange();\r\n                },\r\n            });\r\n\r\n            const mirrorXToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    class: 'dark-invert',\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`,\r\n                        },\r\n                    ],\r\n                }),\r\n                title: LANG('brush-chemy-mirror-x'),\r\n                init: brush.getXSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setXSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const mirrorYToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    class: 'dark-invert',\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`,\r\n                        },\r\n                    ],\r\n                }),\r\n                title: LANG('brush-chemy-mirror-y'),\r\n                init: brush.getYSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setYSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const gradientToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    class: 'dark-invert',\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'defs',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'linearGradient',\r\n                                    id: 'gradient',\r\n                                    x1: '0',\r\n                                    y1: '0',\r\n                                    x2: '0',\r\n                                    y2: '1',\r\n                                    childrenArr: [\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '0%',\r\n                                            'stop-color': 'rgba(0,0,0,0)',\r\n                                        },\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '100%',\r\n                                            'stop-color': 'rgba(0,0,0,1)',\r\n                                        },\r\n                                    ],\r\n                                },\r\n                            ],\r\n                        },\r\n                        {\r\n                            elementType: 'rect',\r\n                            fill: \"url('#gradient')\",\r\n                            x: '' + padding,\r\n                            y: '' + padding,\r\n                            width: '' + actualIconSize,\r\n                            height: '' + actualIconSize,\r\n                        },\r\n                    ],\r\n                }),\r\n                title: LANG('brush-chemy-gradient'),\r\n                init: brush.getGradient(),\r\n                onChange: (b) => {\r\n                    brush.setGradient(b);\r\n                },\r\n            });\r\n\r\n            BB.css(mirrorXToggle.getElement(), {\r\n                marginLeft: '10px',\r\n            });\r\n            {\r\n                const margin = {\r\n                    marginLeft: '4px',\r\n                };\r\n                BB.css(mirrorYToggle.getElement(), margin);\r\n                BB.css(gradientToggle.getElement(), margin);\r\n            }\r\n\r\n            toggleRow.append(\r\n                modeOptions.getElement(),\r\n                mirrorXToggle.getElement(),\r\n                mirrorYToggle.getElement(),\r\n                gradientToggle.getElement(),\r\n            );\r\n\r\n            div.append(\r\n                sizeSlider.getElement(),\r\n                opacitySlider.getElement(),\r\n                toggleRow,\r\n                BB.el({\r\n                    content: [\r\n                        lockAlphaToggle.getElement(),\r\n                        eraserToggle.getElement(),\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                    },\r\n                })\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"371uF\");","import {BB} from '../../../bb/bb';\r\nimport {DynamicModal} from './base/dynamic-modal';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showIframeModal (\r\n    url: string,\r\n    isEmbed: boolean,\r\n) {\r\n\r\n    // window very small, modal might look bad\r\n    if (!isEmbed && (window.innerHeight < 500 || window.innerWidth < 700)) {\r\n        window.open(url);\r\n        return;\r\n    }\r\n\r\n    const iframe = BB.el({\r\n        tagName: 'iframe',\r\n        custom: {\r\n            src: url,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            height: '100%',\r\n            opacity: '0',\r\n        },\r\n    }) as HTMLIFrameElement;\r\n    setTimeout(() => {\r\n        iframe.style.opacity = ''; // fallback\r\n    }, 500);\r\n\r\n    const titleEl = BB.el();\r\n\r\n    let linkEl: HTMLElement | undefined;\r\n    if (!isEmbed) {\r\n        linkEl = BB.el({\r\n            tagName: 'a',\r\n            parent: titleEl,\r\n            content: LANG('modal-new-tab'),\r\n            custom: {\r\n                href: 'help',\r\n                target: '_blank',\r\n            },\r\n            onClick: function () {\r\n                popup.close();\r\n            },\r\n        }) as HTMLAnchorElement;\r\n        iframe.onload = () => {\r\n            if (linkEl && iframe.contentWindow) {\r\n                BB.setAttributes(linkEl, {\r\n                    href: '' + iframe.contentWindow.location,\r\n                });\r\n            }\r\n            iframe.style.opacity = '';\r\n        };\r\n    }\r\n\r\n\r\n    const popup = new DynamicModal({\r\n        title: titleEl,\r\n        content: iframe,\r\n        width: 880,\r\n        isMaxHeight: true,\r\n        onClose: () => {\r\n            if (linkEl) {\r\n                iframe.src = 'about:blank';\r\n                BB.destroyEl(linkEl);\r\n                linkEl = undefined;\r\n            }\r\n        },\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nexport class RadioList {\r\n\r\n    el: HTMLDivElement;\r\n    inputs: HTMLInputElement[] = [];\r\n\r\n    constructor ({name, init, items, ignoreFocus}: {\r\n        name: string;\r\n        init?: string;\r\n        items: {\r\n            label: string;\r\n            value: string;\r\n        }[];\r\n        ignoreFocus?: boolean; // default false\r\n    }) {\r\n        this.el = BB.el({\r\n            className: 'kl-radio',\r\n        }) as HTMLDivElement;\r\n\r\n        items.forEach(item => {\r\n            const label = BB.el({\r\n                tagName: 'label',\r\n            });\r\n            const input = BB.el({\r\n                tagName: 'input',\r\n                parent: label,\r\n                custom: {\r\n                    name: name,\r\n                    value: item.value,\r\n                    type: 'radio',\r\n                },\r\n            }) as HTMLInputElement;\r\n            if (ignoreFocus) {\r\n                input.setAttribute('data-ignore-focus', 'true');\r\n            }\r\n            if (init === item.value) {\r\n                input.checked = true;\r\n            }\r\n            label.append(item.label);\r\n            this.el.append(label);\r\n            this.inputs.push(input);\r\n        });\r\n    }\r\n\r\n\r\n    getValue (): string | null {\r\n        for (let i = 0; i < this.inputs.length; i++) {\r\n            if (this.inputs[i].checked) {\r\n                return this.inputs[i].value;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getElement () {\r\n        return this.el;\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\r\nimport {IKlProject} from '../../kl-types';\r\nimport {showIframeModal} from '../modals/show-iframe-modal';\r\nimport {SaveReminder} from './save-reminder';\r\nimport {IProjectStoreListener, ProjectStore} from '../../storage/project-store';\r\nimport {KL} from '../../kl';\r\nimport {LANG} from '../../../language/language';\r\nimport {theme} from '../../../theme/theme';\r\n\r\nexport class BrowserStorageUi {\r\n\r\n    private previewEl: HTMLDivElement;\r\n    private readonly infoEl: HTMLElement;\r\n    private readonly ageEl: HTMLElement;\r\n    private readonly storeButtonEl: HTMLButtonElement;\r\n    private readonly clearButtonEl: HTMLButtonElement;\r\n    private readonly storeListener: IProjectStoreListener;\r\n    private readonly updateCheckerboard: () => void;\r\n\r\n    private timestamp: number;\r\n    private thumbnail: HTMLImageElement | HTMLCanvasElement | undefined;\r\n\r\n    private updateAge () {\r\n        if (!this.timestamp) {\r\n            return;\r\n        }\r\n        let age = new Date().getTime() - this.timestamp;\r\n        let ageStr;\r\n        age = Math.floor(age / 1000 / 60);\r\n        ageStr = LANG('file-storage-min-ago').replace('{x}', '' + age);\r\n        if (age > 60) {\r\n            age = Math.floor(age / 60);\r\n            ageStr = LANG('file-storage-hours-ago').replace('{x}', '' + age);\r\n            if (age > 24) {\r\n                age = Math.floor(age / 24);\r\n                ageStr = LANG('file-storage-days-ago').replace('{x}', '' + age);\r\n                if (age > 31) {\r\n                    ageStr = LANG('file-storage-month-ago');\r\n                }\r\n            }\r\n        }\r\n        this.ageEl.textContent = ageStr;\r\n    }\r\n\r\n    private resetButtons () {\r\n        if (this.timestamp) {\r\n            this.storeButtonEl.textContent = LANG('file-storage-overwrite');\r\n            this.storeButtonEl.disabled = false;\r\n            this.clearButtonEl.disabled = false;\r\n        } else {\r\n            this.storeButtonEl.textContent = LANG('file-storage-store');\r\n            this.storeButtonEl.disabled = false;\r\n            this.clearButtonEl.disabled = true;\r\n        }\r\n    }\r\n\r\n    private updateThumb (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.timestamp = timestamp;\r\n        this.thumbnail = thumbnail;\r\n        if (this.timestamp && thumbnail) {\r\n            thumbnail.classList.add('kl-storage-preview__im');\r\n            this.previewEl.innerHTML = '';\r\n            this.updateAge();\r\n            this.previewEl.append(thumbnail, this.ageEl);\r\n        } else {\r\n            this.previewEl.innerHTML = LANG('file-storage-empty');\r\n        }\r\n        this.resetButtons();\r\n    }\r\n\r\n    private async store () {\r\n        this.storeButtonEl.textContent = LANG('file-storage-storing');\r\n        this.storeButtonEl.disabled = true;\r\n        this.clearButtonEl.disabled = true;\r\n        await new Promise((resolve) => {\r\n            setTimeout(() => resolve(null), 20);\r\n        });\r\n        try {\r\n            await this.projectStore.store(this.getProject());\r\n            this.saveReminder.reset();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: [\r\n                    `${LANG('file-storage-failed-1')}<ul>`,\r\n                    `<li>${LANG('file-storage-failed-2')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-3')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-4')}</li>`,\r\n                    '</ul>',\r\n                ].join(''),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to store browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    private async clear () {\r\n        this.storeButtonEl.disabled = true;\r\n        this.clearButtonEl.disabled = true;\r\n        try {\r\n            await this.projectStore.clear();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: LANG('file-storage-failed-clear'),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to clear browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    element: HTMLDivElement;\r\n\r\n    constructor (\r\n        private projectStore: ProjectStore,\r\n        private getProject: () => IKlProject,\r\n        private saveReminder: SaveReminder,\r\n        private klRootEl: HTMLElement,\r\n        private options?: { hideClearButton?: boolean; isFocusable?: boolean }, // isFocusable default = false\r\n    ) {\r\n        this.element = BB.el({\r\n            css: {\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 0fr',\r\n                gridTemplateRows: '0fr 0fr 0fr',\r\n                gap: '0 0',\r\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"',\r\n            },\r\n        }) as HTMLDivElement;\r\n\r\n\r\n        const title = BB.el({\r\n            parent: this.element,\r\n            content: LANG('file-storage'),\r\n            css: {\r\n                gridArea: 'title',\r\n                display: 'flex',\r\n                margin: '-5px 0',\r\n                //background: '#f00',\r\n            },\r\n        });\r\n\r\n        this.infoEl = BB.el({\r\n            parent: title,\r\n            content: '?',\r\n            className: 'kl-storage-about',\r\n            title: LANG('file-storage-about'),\r\n            onClick: () => {\r\n                showIframeModal('./help/#help-browser-storage', false);\r\n            },\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.projectStore.isBroken()) {\r\n            BB.el({\r\n                parent: this.element,\r\n                content: ' ' + LANG('file-storage-cant-access'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            return;\r\n        }\r\n\r\n        this.previewEl = BB.el({\r\n            parent: this.element,\r\n            title: LANG('file-storage-thumb-title'),\r\n            className: 'kl-storage-preview',\r\n        }) as HTMLDivElement;\r\n        this.ageEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                right: '1px',\r\n                bottom: '1px',\r\n                width: 'calc(100% - 2px)',\r\n                textAlign: 'center',\r\n                background: 'rgba(0,0,0,0.7)',\r\n                color: '#fff',\r\n                textSize: '13px',\r\n            },\r\n        }) as HTMLDivElement;\r\n        const btnCustom = options?.isFocusable ?  {} : {\r\n            tabIndex: -1,\r\n        };\r\n        this.storeButtonEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'grid-button',\r\n            content: LANG('file-storage-store'),\r\n            css: {\r\n                gridArea: 'store',\r\n                //background: '#00f',\r\n            },\r\n            custom: btnCustom,\r\n            onClick: () => this.store(),\r\n        }) as HTMLButtonElement;\r\n        this.clearButtonEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'grid-button',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/> ' + LANG('file-storage-clear'),\r\n            css: {\r\n                gridArea: 'clear',\r\n                //background: '#ff0',\r\n            },\r\n            custom: btnCustom,\r\n            onClick: () => this.clear(),\r\n        }) as HTMLButtonElement;\r\n\r\n        if (this.options?.hideClearButton) {\r\n            this.clearButtonEl.style.visibility = 'hidden';\r\n        }\r\n\r\n        this.storeListener = {\r\n            onUpdate: (timestamp, thumbnail) => {\r\n                this.updateThumb(timestamp, thumbnail);\r\n            },\r\n        };\r\n        this.projectStore.subscribe(this.storeListener);\r\n\r\n        this.updateCheckerboard = (): void => {\r\n            if (!this.thumbnail) {\r\n                return;\r\n            }\r\n            BB.css(this.thumbnail, {\r\n                background: \"url('\" + BB.createCheckerCanvas(4, theme.isDark()).toDataURL('image/png') + \"')\",\r\n            });\r\n        };\r\n        theme.addIsDarkListener(this.updateCheckerboard);\r\n\r\n        setInterval(() => this.updateAge(), 1000 * 60);\r\n\r\n        (async () => {\r\n            try {\r\n                const readResult = await this.projectStore.read();\r\n                if (readResult) {\r\n                    this.updateThumb(readResult.timestamp, readResult.thumbnail);\r\n                } else {\r\n                    this.updateThumb();\r\n                }\r\n            } catch (e) {\r\n                setTimeout(() => {\r\n                    throw new Error('storage-ui: failed initial read browser storage, ' + e);\r\n                }, 0);\r\n            }\r\n        })();\r\n    }\r\n\r\n\r\n    getElement () {\r\n        return this.element;\r\n    }\r\n\r\n    show () {\r\n        // todo\r\n    }\r\n\r\n    hide () {\r\n        // todo\r\n    }\r\n\r\n    destroy () {\r\n        BB.destroyEl(this.infoEl);\r\n        BB.destroyEl(this.storeButtonEl);\r\n        BB.destroyEl(this.clearButtonEl);\r\n        theme.removeIsDarkListener(this.updateCheckerboard);\r\n        this.projectStore.unsubscribe(this.storeListener);\r\n    }\r\n}","import {IKlProject, IKlStorageProject} from '../kl-types';\r\nimport {ProjectConverter, TReadStorageProjectResult} from './project-converter';\r\nimport {clear, getKlProjectObj, storeKlProjectObj} from './indexed-db';\r\nimport {LocalStorage} from '../../bb/base/local-storage';\r\n\r\n\r\nexport interface IProjectStoreListener {\r\n    onUpdate: (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) => void;\r\n}\r\n\r\nfunction makeAsync<T> (\r\n    nonAsyncFunc: (\r\n        resolveCallback: (value: T) => void,\r\n        rejectCallback: (reason?: any) => void\r\n    ) => void,\r\n): Promise<T> {\r\n    return new Promise<T>((resolve, reject) => {\r\n        nonAsyncFunc(resolve, reject);\r\n    });\r\n}\r\n\r\n/**\r\n * simplified interface for storing projects into browser storage\r\n */\r\nexport class ProjectStore {\r\n\r\n    private listeners: IProjectStoreListener[] = [];\r\n    private accessHasFailed: boolean = false;\r\n\r\n    async lowLevelStore (project: IKlStorageProject): Promise<void> {\r\n        await new Promise<void>((resolve, reject) => {\r\n            storeKlProjectObj(project, resolve, reject);\r\n        });\r\n    }\r\n\r\n    async lowLevelRead (): Promise<IKlStorageProject> {\r\n        return await makeAsync(getKlProjectObj) as IKlStorageProject;\r\n    }\r\n\r\n    async lowLevelClear (): Promise<void> {\r\n        await makeAsync<void>(clear);\r\n    }\r\n\r\n\r\n\r\n    private emit (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement): void {\r\n        this.listeners.forEach(item => {\r\n            item.onUpdate(timestamp, thumbnail);\r\n        });\r\n    }\r\n\r\n    private updateTimestamp (): void {\r\n        LocalStorage.setItem('indexedDbUpdatedAt', '' + new Date().getTime());\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== 'indexedDbUpdatedAt' || this.listeners.length === 0) {\r\n                return;\r\n            }\r\n            try {\r\n                ( async (): Promise<void> => {\r\n                    const readResult = await this.read();\r\n                    if (readResult) {\r\n                        this.emit(readResult.timestamp, readResult.thumbnail);\r\n                    } else {\r\n                        this.emit();\r\n                    }\r\n                })();\r\n            } catch (e) {\r\n                if (e.message.indexOf('db-error') === 0) {\r\n                    this.accessHasFailed = true;\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    async read (): Promise<{\r\n        project: IKlProject;\r\n        timestamp: number;\r\n        thumbnail: HTMLImageElement | HTMLCanvasElement;\r\n    } | undefined> {\r\n        let storageProject;\r\n        try {\r\n            storageProject = await this.lowLevelRead();\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        if (!storageProject) {\r\n            return undefined;\r\n        }\r\n        let result;\r\n        try {\r\n            result = await ProjectConverter.readStorageProject(storageProject);\r\n        } catch (e) {\r\n            throw new Error('format-error: ' + e);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    async store (project: IKlProject): Promise<void> {\r\n        try {\r\n            const storageProject = ProjectConverter.createStorageProject(project);\r\n            await this.lowLevelStore(storageProject);\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        {\r\n            // immediately test if it can be read\r\n            const storageProject = await this.lowLevelRead();\r\n            let readResult: TReadStorageProjectResult;\r\n            try {\r\n                readResult = await ProjectConverter.readStorageProject(storageProject);\r\n            } catch (e) {\r\n                await this.lowLevelClear();\r\n                this.updateTimestamp();\r\n                setTimeout(() => this.emit(), 0);\r\n                throw new Error('format-error: ' + e);\r\n            }\r\n            this.updateTimestamp();\r\n            setTimeout(() => this.emit(readResult.timestamp, readResult.thumbnail), 0);\r\n        }\r\n    }\r\n\r\n    async clear (): Promise<void> {\r\n        await this.lowLevelClear();\r\n        this.updateTimestamp();\r\n        setTimeout(() => this.emit(), 0);\r\n    }\r\n\r\n    subscribe (listener: IProjectStoreListener): void {\r\n        if (this.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        this.listeners.push(listener);\r\n    }\r\n\r\n    unsubscribe (listener: IProjectStoreListener): void {\r\n        for (let i = 0; i < this.listeners.length; i++) {\r\n            if (listener === this.listeners[i]) {\r\n                this.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    isBroken (): boolean {\r\n        return this.accessHasFailed;\r\n    }\r\n\r\n}","import {IKlProject, IKlStorageProject} from '../kl-types';\r\nimport {BB} from '../../bb/bb';\r\nimport {drawProject} from '../canvas/draw-project';\r\nimport {base64ToBlob} from './base-64-to-blob';\r\n\r\nexport type TReadStorageProjectResult = {\r\n    project: IKlProject;\r\n    timestamp: number;\r\n    thumbnail: HTMLImageElement | HTMLCanvasElement;\r\n};\r\n\r\nconst thumbSize = 240;\r\n\r\nfunction loadImage (blob: Blob): Promise<HTMLImageElement> {\r\n    return new Promise<HTMLImageElement>((resolve, reject) => {\r\n        const im = new Image();\r\n        try {\r\n            im.src = BB.imageBlobToUrl(blob);\r\n        } catch (e) {\r\n            reject('imageBlobToUrl, ' + e.message);\r\n            return;\r\n        }\r\n        im.onload = (): void => {\r\n            URL.revokeObjectURL(im.src);\r\n            resolve(im);\r\n        };\r\n        im.onabort = (): void => {\r\n            reject('layer image failed loading');\r\n        };\r\n        im.onerror = (): void => {\r\n            reject('layer image failed loading');\r\n        };\r\n    });\r\n}\r\n\r\n/**\r\n * for:\r\n * - preparing project to be stored in ProjectStore\r\n * - reading a project that came out of the ProjectStore\r\n */\r\nexport class ProjectConverter {\r\n\r\n    private static createThumbnail (project: IKlProject): HTMLCanvasElement {\r\n        const size = BB.fitInto(project.width, project.height, thumbSize, thumbSize);\r\n        const factor = size.width / project.width;\r\n        return drawProject(project, factor);\r\n    }\r\n\r\n    static createStorageProject (project: IKlProject): IKlStorageProject {\r\n        return {\r\n            id: 1,\r\n            timestamp: new Date().getTime(),\r\n            thumbnail: base64ToBlob(ProjectConverter.createThumbnail(project).toDataURL('image/png')),\r\n            width: project.width,\r\n            height: project.height,\r\n            layers: project.layers.map(item => {\r\n                let blob;\r\n                if (item.image instanceof HTMLCanvasElement) {\r\n                    blob = base64ToBlob((item.image as HTMLCanvasElement).toDataURL('image/png'));\r\n                } else {\r\n                    // todo image\r\n                    throw new Error('Not implemented');\r\n                }\r\n                return {\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                    blob,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    static async readStorageProject (storageProject: IKlStorageProject): Promise<TReadStorageProjectResult> {\r\n        if (\r\n            !storageProject.width || !storageProject.height ||\r\n            isNaN(storageProject.width) || isNaN(storageProject.height) ||\r\n            storageProject.width < 1 || storageProject.height < 1\r\n        ) {\r\n            throw new Error('readStorageProject invalid canvas size: ' + storageProject.width + ', ' + storageProject.height);\r\n        }\r\n        const project: IKlProject = {\r\n            width: storageProject.width,\r\n            height: storageProject.height,\r\n            layers: (await Promise.all(storageProject.layers.map(layer => loadImage(layer.blob))))\r\n                .map((image, i) => {\r\n                    return {\r\n                        name: storageProject.layers[i].name,\r\n                        opacity: storageProject.layers[i].opacity,\r\n                        mixModeStr: storageProject.layers[i].mixModeStr,\r\n                        image,\r\n                    };\r\n                }),\r\n        };\r\n\r\n        let thumbnail;\r\n        if (storageProject.thumbnail) {\r\n            thumbnail = await loadImage(storageProject.thumbnail);\r\n        } else {\r\n            thumbnail = ProjectConverter.createThumbnail(project);\r\n        }\r\n\r\n        return {\r\n            project: project,\r\n            timestamp: storageProject.timestamp,\r\n            thumbnail: thumbnail,\r\n        };\r\n    }\r\n\r\n}","\r\nexport function base64ToBlob (base64Str: string): Blob {\r\n    const parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n    const binStr = atob(parts[3]);\r\n    const buf = new ArrayBuffer(binStr.length);\r\n    const view = new Uint8Array(buf);\r\n    for (let i = 0; i < view.length; i++) {\r\n        view[i] = binStr.charCodeAt(i);\r\n    }\r\n    return new Blob([view], {'type': parts[1]});\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {BrowserStorageUi} from '../components/browser-storage-ui';\r\nimport {IKlProject, TDropOption, TExportType} from '../../kl-types';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {LANG} from '../../../language/language';\r\nimport newImageImg from '/src/app/img/ui/new-image.svg';\r\nimport exportImg from '/src/app/img/ui/export.svg';\r\nimport shareImg from '/src/app/img/ui/share.svg';\r\nimport uploadImg from '/src/app/img/ui/upload.svg';\r\nimport importImg from '/src/app/img/ui/import.svg';\r\nimport copyImg from '/src/app/img/ui/copy.svg';\r\n\r\nexport class FileTab {\r\n\r\n    private readonly rootEl: HTMLDivElement;\r\n    private importButton: undefined | HTMLInputElement;\r\n    private fileBrowserStorage: undefined | BrowserStorageUi;\r\n\r\n    constructor (\r\n        klRootEl: HTMLElement,\r\n        projectStore: ProjectStore,\r\n        getProject: () => IKlProject,\r\n        private exportType: TExportType,\r\n        onExportTypeChange: (type: TExportType) => void,\r\n        onFileSelect: (fileList: FileList, optionStr: TDropOption) => void,\r\n        onSaveImageToComputer: () => void,\r\n        onNewImage: () => void,\r\n        onShareImage: (callback: () => void) => void,\r\n        onUpload: () => void,\r\n        onCopyToClipboard: () => void,\r\n        saveReminder: SaveReminder,\r\n    ) {\r\n        this.rootEl = document.createElement('div');\r\n\r\n        const asyncCreation = (): void => {\r\n            const fileMenu = document.createElement('div');\r\n            const newButton = document.createElement('button');\r\n            const saveButton = document.createElement('button');\r\n            const shareButton = document.createElement('button');\r\n            const uploadImgurButton = document.createElement('button');\r\n            const clipboardButton = document.createElement('button');\r\n\r\n            newButton.style.cssFloat = 'left';\r\n            BB.css(saveButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n                flexGrow: '1',\r\n            });\r\n            BB.css(clipboardButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n            });\r\n\r\n            newButton.tabIndex = -1;\r\n            saveButton.tabIndex = -1;\r\n            shareButton.tabIndex = -1;\r\n            uploadImgurButton.tabIndex = -1;\r\n            clipboardButton.tabIndex = -1;\r\n\r\n            newButton.innerHTML = `<img class=\"dark-no-invert\" src='${newImageImg}' alt='icon' height='20'/>${LANG('file-new')}`;\r\n            saveButton.innerHTML = `<img src='${exportImg}' alt='icon' height='20'/>${LANG('file-save')}`;\r\n            shareButton.innerHTML = `<img src='${shareImg}' alt='icon' height='20'/>${LANG('file-share')}`;\r\n            uploadImgurButton.innerHTML = `<img style='float:left' src='${uploadImg}' height='20' alt='icon'/>${LANG('file-upload')}`;\r\n            clipboardButton.innerHTML = `<img src='${copyImg}' alt='icon' height='20'/>${LANG('file-copy')}`;\r\n            clipboardButton.title = LANG('file-copy-title');\r\n            newButton.className = 'grid-button';\r\n            saveButton.className = 'grid-button';\r\n            shareButton.className = 'grid-button';\r\n            uploadImgurButton.className = 'grid-button';\r\n            clipboardButton.className = 'grid-button';\r\n\r\n            const importWrapper = BB.el({\r\n                className: 'grid-button',\r\n                css: {\r\n                    position: 'relative',\r\n                    cursor: 'pointer',\r\n                    cssFloat: 'left',\r\n                },\r\n            });\r\n            const innerMask = BB.el({\r\n                parent: importWrapper,\r\n                css: {\r\n                    width: '120px',\r\n                    height: '28px',\r\n                    overflow: 'hidden',\r\n                    cursor: 'pointer',\r\n                    position: 'relative',\r\n                },\r\n            });\r\n            this.importButton = BB.el({\r\n                tagName: 'input',\r\n                parent: innerMask,\r\n                css: {\r\n                    display: 'none',\r\n                },\r\n            }) as HTMLInputElement;\r\n            this.importButton.tabIndex = -1;\r\n            this.importButton.type = 'file';\r\n            this.importButton.multiple = true;\r\n            this.importButton.accept = 'image';\r\n            this.importButton.size = 71;\r\n            this.importButton.onchange = () => {\r\n                if (!this.importButton) {\r\n                    return;\r\n                }\r\n                this.importButton.files && onFileSelect(this.importButton.files, 'default');\r\n                this.importButton.value = '';\r\n            };\r\n\r\n            const importFakeButton = BB.el({\r\n                tagName: 'button',\r\n                parent: importWrapper,\r\n                content: \"<img class=\\\"dark-no-invert\\\" style='float:left' height='20' src='\" + importImg + \"' alt='icon'/>\" + LANG('file-import'),\r\n                css: {\r\n                    width: '120px',\r\n                    display: 'box',\r\n                    position: 'absolute',\r\n                    left: '0',\r\n                    top: '0',\r\n                    cursor: 'pointer',\r\n                },\r\n            }) as HTMLButtonElement;\r\n            importFakeButton.tabIndex = -1;\r\n            importFakeButton.onclick = () => this.importButton && this.importButton.click();\r\n\r\n            // --- export filetype dropdown ---\r\n            const exportTypeSelect = new KL.Select({\r\n                optionArr: [\r\n                    ['png', 'PNG'],\r\n                    ['psd', 'PSD'],\r\n                    ['layers', LANG('layers') + ' (PNG)'],\r\n                ],\r\n                initValue: this.exportType,\r\n                onChange: (val) => {\r\n                    this.exportType = val as TExportType;\r\n                    onExportTypeChange(this.exportType);\r\n                    onSaveImageToComputer();\r\n                },\r\n                title: LANG('file-format'),\r\n            });\r\n            BB.css(exportTypeSelect.getElement(), {\r\n                width: '50%',\r\n                height: '30px',\r\n                marginTop: '10px',\r\n                marginLeft: '10px',\r\n            });\r\n\r\n\r\n\r\n            newButton.onclick = onNewImage;\r\n            saveButton.onclick = () => {\r\n                onSaveImageToComputer();\r\n            };\r\n            shareButton.onclick = () => {\r\n                shareButton.disabled = true;\r\n                onShareImage(() => {\r\n                    shareButton.disabled = false;\r\n                });\r\n            };\r\n            uploadImgurButton.onclick = () => onUpload();\r\n\r\n            clipboardButton.onclick = () => {\r\n                clipboardButton.blur();\r\n                onCopyToClipboard();\r\n            };\r\n\r\n            const saveNote = BB.el({\r\n                className: 'kl-toolspace-note',\r\n                textContent: LANG('file-no-autosave'),\r\n                css: {\r\n                    margin: '10px 10px 0 10px',\r\n                },\r\n            });\r\n\r\n            const createSpacer = () => {\r\n                const el = document.createElement('div');\r\n                const clearer = document.createElement('div');\r\n                const line = BB.el({\r\n                    className: 'grid-hr',\r\n                });\r\n                el.append(clearer, line);\r\n                BB.css(clearer, {\r\n                    clear: 'both',\r\n                });\r\n                return el;\r\n            };\r\n\r\n            this.fileBrowserStorage = new BrowserStorageUi(projectStore, getProject, saveReminder, klRootEl);\r\n            BB.css(this.fileBrowserStorage.getElement(), {\r\n                //background: 'red',\r\n                margin: '10px',\r\n            });\r\n\r\n            const saveRow = BB.el({\r\n                content: [saveButton, exportTypeSelect.getElement()],\r\n                className: 'kl-file-save-row',\r\n            });\r\n\r\n            //actual structure\r\n            BB.append(fileMenu, [\r\n                saveNote,\r\n                newButton,\r\n                importWrapper,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                saveRow,\r\n\r\n                clipboardButton,\r\n                BB.canShareFiles() ? shareButton : undefined,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                createSpacer(),\r\n                this.fileBrowserStorage.getElement(),\r\n                createSpacer(),\r\n                uploadImgurButton,\r\n            ]);\r\n\r\n            this.rootEl.append(fileMenu);\r\n        };\r\n\r\n        setTimeout(asyncCreation, 1);\r\n    }\r\n\r\n    refresh (): void {\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (isVisible: boolean): void {\r\n        if (isVisible) {\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    triggerImport (): void {\r\n        this.importButton && this.importButton.click();\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"gJzzT\");","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {IKeyString} from '../../../bb/bb-types';\r\nimport {StatusOverlay} from '../components/status-overlay';\r\nimport {KlCanvasWorkspace} from '../../canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\nimport {LayerManager} from './layer-manager/layer-manager';\r\nimport {HandUi} from './hand-ui';\r\nimport {RGB} from '../../../bb/color/color';\r\n\r\n\r\nexport class FilterTab {\r\n\r\n    private readonly rootEl: HTMLDivElement;\r\n    private isInit = false;\r\n\r\n    constructor (\r\n        private klRootEl: HTMLElement,\r\n        private klColorSlider: KlColorSlider,\r\n        private layerManager: LayerManager,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private handUi: HandUi,\r\n        private getCurrentColor: () => RGB,\r\n        private getKlMaxCanvasSize: () => number,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx: () => CanvasRenderingContext2D | null,\r\n        private isEmbed: boolean,\r\n        private statusOverlay: StatusOverlay,\r\n    ) {\r\n        this.rootEl = document.createElement('div');\r\n    }\r\n\r\n    private init (): void {\r\n        const filters = KL.filterLib;\r\n        const buttons = [];\r\n\r\n        if (!KL.filterLibStatus.isLoaded) {\r\n            throw new Error('filters not loaded');\r\n        }\r\n\r\n        const createButton = (filterKey: string): HTMLElement => {\r\n            const button = document.createElement('button');\r\n            const buttonLabel = LANG(filters[filterKey].lang.button);\r\n            const imClass = filters[filterKey].darkNoInvert ? 'class=\"dark-no-invert\"' : '';\r\n            const im = '<img ' + imClass + ' height=\"20\" width=\"18\" src=\"' + filters[filterKey].icon + '\" alt=\"icon\" />';\r\n            button.innerHTML = im + buttonLabel;\r\n            button.className = 'grid-button';\r\n            BB.css(button, {\r\n                lineHeight: '20px',\r\n                fontSize: '12px',\r\n            });\r\n            button.tabIndex = -1;\r\n\r\n            const filterName = LANG(filters[filterKey].lang.name);\r\n\r\n            button.onclick = () => {\r\n\r\n                const finishedDialog = (result, filterDialog): void => {\r\n                    if (result == 'Cancel') {\r\n                        if (filterDialog.destroy) {\r\n                            filterDialog.destroy();\r\n                        }\r\n                        return;\r\n                    }\r\n                    let input;\r\n                    try {\r\n                        input = filterDialog.getInput(); // also destroys\r\n                    } catch (e) {\r\n                        if (e.message.indexOf('.getInput is not a function') !== -1) {\r\n                            throw 'filterDialog.getInput is not a function, filter: ' + filterName;\r\n                        } else {\r\n                            throw e;\r\n                        }\r\n                    }\r\n                    applyFilter(input);\r\n                };\r\n\r\n                if (!('apply' in filters[filterKey])) {\r\n                    alert('Application not fully loaded');\r\n                    return;\r\n                }\r\n\r\n                const applyFilter = (input: any) => {\r\n                    const filterResult = filters[filterKey].apply({\r\n                        context: this.getCurrentLayerCtx(),\r\n                        klCanvas: this.getKlCanvas(),\r\n                        history: klHistory,\r\n                        input: input,\r\n                    } as IFilterApply);\r\n                    if (filterResult === false) {\r\n                        alert(\"Couldn't apply the edit action\");\r\n                    }\r\n                    if (filters[filterKey].updatePos === true) {\r\n                        this.klCanvasWorkspace.resetView();\r\n                        this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                    this.layerManager.update();\r\n                };\r\n\r\n                if (filters[filterKey].isInstant){\r\n                    button.blur();\r\n                    applyFilter(null);\r\n                    this.statusOverlay.out('\"' + filterName + '\" ' + LANG('filter-applied'), true);\r\n                } else {\r\n                    const secondaryColorRGB = this.klColorSlider.getSecondaryRGB();\r\n                    const filterDialog = filters[filterKey].getDialog({\r\n                        context: this.getCurrentLayerCtx(),\r\n                        klCanvas: this.getKlCanvas(),\r\n                        maxWidth: this.getKlMaxCanvasSize(),\r\n                        maxHeight: this.getKlMaxCanvasSize(),\r\n                        currentColorRgb: {r: this.getCurrentColor().r, g: this.getCurrentColor().g, b: this.getCurrentColor().b},\r\n                        secondaryColorRgb: {r: secondaryColorRGB.r, g: secondaryColorRGB.g, b: secondaryColorRGB.b},\r\n                    } as IFilterGetDialogParam) as IFilterGetDialogResult;\r\n\r\n                    if (!filterDialog) {\r\n                        return;\r\n                        //alert('Error: could not perform action');\r\n                        //throw('filter['+filterKey+'].getDialog returned '+filterDialog+'. ctx:' + currentLayerCtx + ' klCanvas:' + klCanvas);\r\n                    }\r\n\r\n                    let closeFunc: () => void;\r\n                    // Todo should move into getDialogParams\r\n                    filterDialog.errorCallback = (e) => {\r\n                        setTimeout(() => {\r\n                            alert('Error: could not perform action');\r\n                            throw e;\r\n                        }, 0);\r\n                        closeFunc();\r\n                    };\r\n\r\n\r\n                    const style: IKeyString = {};\r\n                    if ('width' in filterDialog) {\r\n                        style.width = filterDialog.width + 'px';\r\n                    }\r\n\r\n                    KL.popup({\r\n                        target: this.klRootEl,\r\n                        message: '<b>' + filterName + '</b>',\r\n                        div: filterDialog.element,\r\n                        style: style,\r\n                        buttons: ['Ok', 'Cancel'],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: (result) => {\r\n                            finishedDialog(result, filterDialog);\r\n                        },\r\n                        closeFunc: (func) => {\r\n                            closeFunc = func;\r\n                        },\r\n                    });\r\n                }\r\n            };\r\n            buttons[buttons.length] = button;\r\n            return button;\r\n        };\r\n\r\n        const addGroup = (groupArr: string[]): void => {\r\n            Object.entries(filters).forEach(([filterKey, filter]) => {\r\n                if (!groupArr.includes(filterKey)) {\r\n                    return;\r\n                }\r\n                if (this.isEmbed && !filter.inEmbed) {\r\n                    return;\r\n                }\r\n                this.rootEl.append(createButton(filterKey));\r\n            });\r\n        };\r\n\r\n        const groupA = [\r\n            'cropExtend',\r\n            'flip',\r\n            'perspective',\r\n            'resize',\r\n            'rotate',\r\n            'transform',\r\n        ];\r\n        const groupB = [\r\n            'brightnessContrast',\r\n            'curves',\r\n            'distort',\r\n            'hueSaturation',\r\n            'invert',\r\n            'tiltShift',\r\n            'toAlpha',\r\n            'blur',\r\n            'unsharpMask',\r\n        ];\r\n        const groupC = [\r\n            'grid',\r\n            'noise',\r\n            'pattern',\r\n            'vanishPoint',\r\n        ];\r\n\r\n        addGroup(groupA);\r\n        this.rootEl.append(BB.el({className: 'grid-hr'}));\r\n        addGroup(groupB);\r\n        this.rootEl.append(BB.el({className: 'grid-hr'}));\r\n        addGroup(groupC);\r\n\r\n        this.isInit = true;\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    show (): void {\r\n        if (!this.isInit) {\r\n            this.init();\r\n        }\r\n        this.rootEl.style.display = 'block';\r\n    }\r\n\r\n    hide (): void {\r\n        this.rootEl.style.display = 'none';\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {base64ToBlob} from '../../storage/base-64-to-blob';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\nimport loadingImg from '/src/app/img/ui/loading.gif';\r\n\r\ntype TImgurUploadResponse = {\r\n    // just a subset\r\n    id: string;\r\n    datetime: number;\r\n    type: string;\r\n    width: number;\r\n    height: number;\r\n    deletehash: string;\r\n    name: string;\r\n    link: string;\r\n};\r\n\r\n/**\r\n * uploads canvas, opens new tab with the upload progress & then opens the image page.\r\n */\r\nasync function upload (\r\n    canvas: HTMLCanvasElement,\r\n    title: string,\r\n    description: string,\r\n    type: 'png' | 'jpeg',\r\n    imgurKey: string,\r\n): Promise<TImgurUploadResponse> {\r\n    const img = base64ToBlob(canvas.toDataURL('image/' + type));\r\n\r\n    const w = window.open();\r\n\r\n    if (!w) {\r\n        throw new Error('could not create new tab');\r\n    }\r\n\r\n    const label = w.document.createElement('div');\r\n    const gif = w.document.createElement('img');\r\n    gif.src = loadingImg;\r\n    label.append(gif);\r\n    BB.css(gif, {\r\n        filter: 'invert(1)',\r\n    });\r\n    BB.css(w.document.body, {\r\n        backgroundColor: '#121211',\r\n        backgroundImage: 'linear-gradient(#2b2b2b 0%, #121211 50%)',\r\n        backgroundRepeat: 'no-repeat',\r\n    });\r\n    \r\n    const labelText = w.document.createElement('div');\r\n    labelText.style.marginTop = '10px';\r\n    label.append(labelText);\r\n    labelText.textContent = LANG('upload-uploading');\r\n\r\n    w.document.body.append(label);\r\n    BB.css(label, {\r\n        marginLeft: 'auto',\r\n        marginRight: 'auto',\r\n        marginTop: '100px',\r\n        fontFamily: 'Arial, sans-serif',\r\n        fontSize: '20px',\r\n        textAlign: 'center',\r\n        transition: 'opacity 0.3s ease-in-out',\r\n        opacity: '0',\r\n        color: '#ccc',\r\n    });\r\n    setTimeout(function () {\r\n        label.style.opacity = '1';\r\n    }, 20);\r\n\r\n    let response;\r\n    try {\r\n        const formData = new FormData();\r\n        formData.append('title', title);\r\n        formData.append('description', description);\r\n        formData.append('image', img);\r\n        response = await fetch('https://api.imgur.com/3/image',  {\r\n            method: 'POST',\r\n            headers: {\r\n                Authorization: 'Client-ID ' + imgurKey,\r\n            },\r\n            body: formData,\r\n        });\r\n\r\n    } catch (e) {\r\n        w.close();\r\n        throw new Error(e);\r\n    }\r\n    if (!response.ok) {\r\n        w.close();\r\n        throw new Error();\r\n    }\r\n    const data: TImgurUploadResponse = (await response.json()).data;\r\n\r\n    w.location.href = data.link.replace(/\\.(jpg|png)/, '');\r\n\r\n    return data;\r\n}\r\n\r\n\r\nexport function imgurUpload (\r\n    klCanvas: KlCanvas,\r\n    klRootEl: HTMLElement,\r\n    saveReminder: SaveReminder,\r\n    imgurKey: string, // API key\r\n): void {\r\n    if (!imgurKey) {\r\n        throw new Error('imgur key missing');\r\n    }\r\n\r\n    const inputTitle = BB.el({tagName: 'input'}) as HTMLInputElement;\r\n    inputTitle.type = 'text';\r\n    inputTitle.value = LANG('upload-title-untitled');\r\n    const inputDescription = BB.el({\r\n        tagName: 'textarea',\r\n        custom: {\r\n            rows: 2,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            maxWidth: '100%',\r\n        },\r\n    }) as HTMLTextAreaElement;\r\n\r\n    const labelTitle =  BB.el({\r\n        textContent: LANG('upload-name') + ':',\r\n    });\r\n    const labelDescription = BB.el({\r\n        textContent: LANG('upload-caption') + ':',\r\n        css: {\r\n            marginTop: '10px',\r\n        },\r\n    });\r\n\r\n    const tos = BB.el({\r\n        content: `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${LANG('terms-of-service')}</a>`,\r\n    });\r\n\r\n    const typeRadio = new KL.RadioList({\r\n        name: 'filetype',\r\n        init: 'jpeg',\r\n        items: [\r\n            { label: 'JPG', value: 'jpeg' },\r\n            { label: 'PNG', value: 'png' },\r\n        ],\r\n        ignoreFocus: true,\r\n    });\r\n    BB.css(typeRadio.getElement(), {\r\n        marginBottom: '10px',\r\n    });\r\n\r\n\r\n    const outDiv = BB.el();\r\n    const infoHint = BB.el({\r\n        className: 'info-hint',\r\n        textContent: LANG('upload-link-notice'),\r\n    });\r\n    outDiv.append(\r\n        infoHint,\r\n        typeRadio.getElement(),\r\n        labelTitle,\r\n        inputTitle,\r\n        labelDescription,\r\n        inputDescription,\r\n        tos\r\n    );\r\n    KL.popup({\r\n        target: klRootEl,\r\n        message: `<b>${LANG('upload-title')}</b>`,\r\n        type: 'upload',\r\n        div: outDiv,\r\n        buttons: [LANG('upload-submit'), 'Cancel'],\r\n        clickOnEnter: LANG('upload-submit'),\r\n        primaries: [LANG('upload-submit')],\r\n        autoFocus: LANG('upload-submit'),\r\n        callback: async function (val) {\r\n            if (val === LANG('upload-submit') || val === 'Yes' || val === 'Ok') {\r\n                try {\r\n                    const result = await upload(\r\n                        klCanvas.getCompleteCanvas(1),\r\n                        inputTitle.value,\r\n                        inputDescription.value,\r\n                        typeRadio.getValue() as 'png' | 'jpeg',\r\n                        imgurKey,\r\n                    );\r\n\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: 'ok',\r\n                        message: `<h3>${LANG('upload-success')}</h3><br>${LANG('upload-delete')}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/delete/${result.deletehash}</a><br><br>`,\r\n                        buttons: ['Ok'],\r\n                    });\r\n                    saveReminder.reset();\r\n\r\n                } catch(e) {\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: 'error',\r\n                        message: LANG('upload-failed'),\r\n                        buttons: ['Ok'],\r\n                    });\r\n                }\r\n            }\r\n        },\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"c3ZSC\");","\r\nlet agPsdLazy;\r\nexport async function loadAgPsd () {\r\n    if (!agPsdLazy) {\r\n        agPsdLazy = await import('ag-psd');\r\n    }\r\n    return agPsdLazy;\r\n}","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kNYzr\"))).then(() => parcelRequire('2m2jt'));","import {KL} from '../../kl';\r\nimport {BB} from '../../../bb/bb';\r\nimport {KlHistoryInterface} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\nimport {BrowserStorageUi} from './browser-storage-ui';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {IKlProject} from '../../kl-types';\r\n\r\n\r\nconst reminderTimelimitMs = 1000 * 60 * 20; // 20 minutes\r\nconst unsavedActionsLimit = 100; // number of actions user did since last save\r\n\r\n\r\n/**\r\n * remind user of saving, keep user aware of save state\r\n */\r\nexport class SaveReminder {\r\n    private lastSavedActionNumber: number = null;\r\n    private lastSavedAt: number;\r\n\r\n    private lastReminderShownAt: number;\r\n    private unsavedInterval;\r\n    private closeFunc: () => void;\r\n\r\n    showPopup (): void {\r\n        if (!this.projectStore || !this.getProject) {\r\n            throw new Error('projectStore and getProject need to be set');\r\n        }\r\n\r\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\r\n\r\n        const contentEl = BB.el();\r\n\r\n        contentEl.append(\r\n            BB.el({\r\n                content: LANG(\r\n                    'save-reminder-text',\r\n                    {\r\n                        a: '<strong>' + min,\r\n                        b: '</strong>',\r\n                    }\r\n                ),\r\n                css: {\r\n                    marginBottom: '20px',\r\n                },\r\n            }),\r\n        );\r\n\r\n        const psdWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n            },\r\n        });\r\n        const storageWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n                paddingBottom: '0',\r\n            },\r\n        });\r\n        contentEl.append(psdWrapper, storageWrapper);\r\n\r\n\r\n        const psdBtn = BB.el({\r\n            tagName: 'button',\r\n            className: 'kl-button',\r\n            content: LANG('save-reminder-save-psd'),\r\n            onClick: () => this.onSaveAsPsd(),\r\n        });\r\n        psdWrapper.append(\r\n            psdBtn,\r\n            BB.el({\r\n                content: LANG('save-reminder-psd-layers'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            }),\r\n        );\r\n\r\n\r\n        const storageUi = new BrowserStorageUi(\r\n            this.projectStore,\r\n            this.getProject,\r\n            this,\r\n            document.body as any,\r\n            {\r\n                hideClearButton: true,\r\n                isFocusable: true,\r\n            }\r\n        );\r\n        storageWrapper.append(storageUi.getElement());\r\n\r\n\r\n        KL.popup({\r\n            target: document.body,\r\n            message: `<b>${LANG('save-reminder-title')}</b>`,\r\n            div: contentEl,\r\n            ignoreBackground: true,\r\n            callback: () => {\r\n                storageUi.destroy();\r\n                BB.destroyEl(psdBtn);\r\n                this.closeFunc = null;\r\n                this.lastReminderShownAt = performance.now();\r\n            },\r\n            closeFunc: (f) => {\r\n                this.closeFunc = f;\r\n            },\r\n        });\r\n        setTimeout(() => {\r\n            psdBtn.focus();\r\n        }, 40);\r\n    }\r\n\r\n    constructor (\r\n        private history: KlHistoryInterface,\r\n        private showReminder: boolean,\r\n        private changeTitle: boolean,\r\n        private onSaveAsPsd: () => void,\r\n        private isDrawing: () => boolean,\r\n        private projectStore: ProjectStore | null, // needed if showReminder\r\n        private getProject: (() => IKlProject) | null, // needed if showReminder\r\n        private title: string = 'Klecks',\r\n    ) { }\r\n\r\n    init (): void {\r\n        if (this.lastSavedActionNumber !== null) { // already initialized\r\n            return;\r\n        }\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n\r\n        if (this.showReminder) {\r\n            setInterval(() => {\r\n                if (document.visibilityState !== 'visible') {\r\n                    return;\r\n                }\r\n\r\n                const unsavedActions = Math.abs(this.history.getActionNumber() - this.lastSavedActionNumber);\r\n\r\n                if (\r\n                    KL.dialogCounter.get() === 0 &&\r\n                    !this.isDrawing() &&\r\n                    this.lastReminderShownAt + reminderTimelimitMs < performance.now() &&\r\n                    unsavedActions >= unsavedActionsLimit\r\n                ) {\r\n                    this.showPopup();\r\n                }\r\n            }, 1000 * 5);\r\n        }\r\n\r\n        // confirmation dialog when closing tab\r\n        function onBeforeUnload (e) {\r\n            e.preventDefault();\r\n            e.returnValue = '';\r\n        }\r\n\r\n        this.history.addListener(() => {\r\n            const actionNumber = this.history.getActionNumber();\r\n            if (this.lastSavedActionNumber !== actionNumber) {\r\n                window.onbeforeunload =  onBeforeUnload;\r\n            } else {\r\n                window.onbeforeunload = null;\r\n            }\r\n        });\r\n\r\n        if (this.changeTitle) {\r\n            document.addEventListener('visibilitychange', () => {\r\n                if (document.visibilityState === 'visible') {\r\n                    document.title = this.title;\r\n                    clearInterval(this.unsavedInterval);\r\n                } else {\r\n                    const actionNumber = this.history.getActionNumber();\r\n                    if (this.lastSavedActionNumber !== actionNumber) {\r\n                        document.title = LANG('unsaved') + ' - ' + this.title;\r\n                        let state = 0;\r\n                        this.unsavedInterval = setInterval(() => {\r\n                            state = (state + 1) % 2;\r\n                            if (state === 1) {\r\n                                document.title = LANG('unsaved') + '  ' + this.title;\r\n                            } else {\r\n                                document.title = LANG('unsaved') + ' - ' + this.title;\r\n                            }\r\n                        }, 1000 * 60 * 3);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    reset (): void {\r\n        if (this.lastSavedActionNumber === null) { // not initialized\r\n            return;\r\n        }\r\n\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n        window.onbeforeunload = null;\r\n\r\n        if (this.closeFunc) {\r\n            this.closeFunc();\r\n        }\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {KL} from '../kl';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {TExportType} from '../kl-types';\r\nimport {SaveReminder} from '../ui/components/save-reminder';\r\nimport {saveAs} from '../../bb/base/save-as';\r\n\r\nexport class SaveToComputer {\r\n\r\n    /**\r\n     * Using old code, because saving somehow doesn't work for ipad before ios 13,\r\n     * and it doesn't even throw an exception.\r\n     */\r\n    private saveImage (canvas: HTMLCanvasElement, filename: string, mimeType: string): void {\r\n        const parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n\r\n        if (!parts) {\r\n            throw new Error('saveImage: empty parts');\r\n        }\r\n\r\n        //assume base64 encoding\r\n        const binStr = atob(parts[3]);\r\n        //convert to binary in ArrayBuffer\r\n        const buf = new ArrayBuffer(binStr.length);\r\n        const view = new Uint8Array(buf);\r\n        for (let i = 0; i < view.length; i++) {\r\n            view[i] = binStr.charCodeAt(i);\r\n        }\r\n        const blob = new Blob([view], {'type': parts[1]});\r\n        saveAs(blob, filename);\r\n    }\r\n\r\n    constructor (\r\n        private saveReminder: SaveReminder,\r\n        private klRootEl: HTMLElement,\r\n        private getExportType: () => TExportType,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private filenameBase: string,\r\n    ) {}\r\n\r\n    save (format?: 'psd' | 'layers' | 'png') {\r\n        this.saveReminder.reset();\r\n\r\n        if (!format) {\r\n            format = this.getExportType();\r\n        }\r\n\r\n        if (format === 'png') {\r\n            const extension = 'png';\r\n            const mimeType = 'image/png';\r\n            const filename = BB.getDate() + this.filenameBase + '.' + extension;\r\n            const fullCanvas = this.getKlCanvas().getCompleteCanvas(1);\r\n            try {\r\n                this.saveImage(fullCanvas, filename, mimeType);\r\n            } catch (error) { //fallback for old browsers\r\n                alert('could not save');\r\n                throw new Error('failed png export');\r\n            }\r\n        } else if (format === 'layers') {\r\n            const extension = 'png';\r\n            const mimeType = 'image/png';\r\n            const fileBase = BB.getDate() + this.filenameBase;\r\n            const layerArr = this.getKlCanvas().getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                const item = layerArr[i];\r\n                const fnameArr = [\r\n                    fileBase,\r\n                    '_',\r\n                    ('' + (i + 1)).padStart(2, '0'),\r\n                    '_',\r\n                    item.name,\r\n                    '.',\r\n                    extension,\r\n                ];\r\n                this.saveImage(item.canvas, fnameArr.join(''), mimeType);\r\n            }\r\n        } else if (format === 'psd') {\r\n\r\n            const layerArr = this.getKlCanvas().getLayersFast();\r\n\r\n            const psdConfig: {\r\n                width: number;\r\n                height: number;\r\n                children: {\r\n                    name: string;\r\n                    opacity: number;\r\n                    canvas: HTMLCanvasElement;\r\n                    blendMode: string;\r\n                    left: number;\r\n                    top: number;\r\n                }[];\r\n                canvas: HTMLCanvasElement;\r\n            } = {\r\n                width: this.getKlCanvas().getWidth(),\r\n                height: this.getKlCanvas().getHeight(),\r\n                children: [],\r\n                canvas: this.getKlCanvas().getCompleteCanvas(1),\r\n            };\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                const item = layerArr[i];\r\n                psdConfig.children.push({\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    canvas: item.canvas,\r\n                    blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n                    left: 0,\r\n                    top: 0,\r\n                });\r\n            }\r\n\r\n            KL.loadAgPsd().then((agPsdLazy) => {\r\n                const buffer = agPsdLazy.writePsdBuffer(psdConfig);\r\n                const blob = new Blob([buffer], { type: 'application/octet-stream' });\r\n                saveAs(blob, BB.getDate() + this.filenameBase + '.psd');\r\n            }).catch(() => {\r\n                alert('Error: failed to load PSD library');\r\n            });\r\n\r\n        }\r\n\r\n    }\r\n\r\n}","// https://github.com/eligrey/FileSaver.js/issues/774\r\n// stripped down version of https://github.com/eligrey/FileSaver.js/blob/master/src/FileSaver.js#L81-L108\r\n\r\nexport function saveAs (blob: Blob, name: string): void {\r\n    // Namespace is used to prevent conflict w/ Chrome Poper Blocker extension (Issue https://github.com/eligrey/FileSaver.js/issues/561)\r\n    const a = document.createElementNS('http://www.w3.org/1999/xhtml', 'a') as HTMLAnchorElement;\r\n    a.download = name;\r\n    a.rel = 'noopener';\r\n    a.href = URL.createObjectURL(blob);\r\n\r\n    setTimeout(() => URL.revokeObjectURL(a.href), 40 /* sec */ * 1000);\r\n    setTimeout(() => a.click(), 0);\r\n}\r\n","import {KL} from '../kl';\r\nimport {IHistoryBroadcast, IHistoryEntry, klHistory} from './kl-history';\r\nimport {KlCanvasWorkspace} from '../canvas-ui/kl-canvas-workspace';\r\nimport {IFilterApply, IInitState} from '../kl-types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {LayerManager} from '../ui/tool-tabs/layer-manager/layer-manager';\r\nimport {LayerPreview} from '../ui/components/layer-preview';\r\nimport {HandUi} from '../ui/tool-tabs/hand-ui';\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\nfunction execHistoryEntry (\r\n    historyEntry: IHistoryEntry,\r\n    layerIndex: number,\r\n    klCanvas: KlCanvas,\r\n    brushes: any, // todo\r\n    setCurrentLayerCtx: (ctx: CanvasRenderingContext2D) => void,\r\n    getCurrentLayerCtx: () => CanvasRenderingContext2D,\r\n): number {\r\n    if (historyEntry.tool[0] === 'brush') {\r\n        const b = brushes[historyEntry.tool[1]];\r\n        historyEntry.actions.forEach(action => {\r\n            b[action.action].apply(b, action.params);\r\n        });\r\n\r\n    } else if (historyEntry.tool[0] === 'canvas') {\r\n        const p = historyEntry.params;\r\n        const id = klCanvas[historyEntry.action].apply(klCanvas, p);\r\n        if (typeof id === 'number') {\r\n            layerIndex = id;\r\n            const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex));\r\n            setCurrentLayerCtx(ctx);\r\n            Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\r\n        }\r\n\r\n    } else if (historyEntry.tool[0] === 'filter') {\r\n        const p = [{\r\n            context: getCurrentLayerCtx(),\r\n            klCanvas,\r\n            input: historyEntry.params[0].input,\r\n            history: new KL.DecoyKlHistory(),\r\n        } as IFilterApply];\r\n        KL.filterLib[historyEntry.tool[1]][historyEntry.action].apply(null, p);\r\n\r\n    } else if (historyEntry.tool[0] === 'misc' && historyEntry.action === 'focusLayer') {\r\n        layerIndex = historyEntry.params[0];\r\n        const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex));\r\n        setCurrentLayerCtx(ctx);\r\n        Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\r\n\r\n    } else if (historyEntry.tool[0] === 'misc' && historyEntry.action === 'importImage') {\r\n        const id = klCanvas.addLayer();\r\n        if (typeof id === 'number') {\r\n            layerIndex = id;\r\n            if (historyEntry.params[1]) {\r\n                klCanvas.renameLayer(layerIndex, historyEntry.params[1]);\r\n            }\r\n            const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex));\r\n            setCurrentLayerCtx(ctx);\r\n            Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\r\n        }\r\n        getCurrentLayerCtx().drawImage(historyEntry.params[0], 0, 0);\r\n    }\r\n    return layerIndex;\r\n}\r\n\r\nexport class UndoRedoCatchup {\r\n\r\n    private doIgnore = false;\r\n\r\n    /**\r\n     * Prevent multiple undo / redo getting triggered at once if UI is frozen.\r\n     * true -> ignore, don't undo / redo\r\n     */\r\n    private shouldIgnoreTest (): boolean {\r\n        if (this.doIgnore) {\r\n            return true;\r\n        }\r\n        this.doIgnore = true;\r\n        setTimeout(() => {\r\n            this.doIgnore = false;\r\n        }, 0);\r\n        return false;\r\n    }\r\n    \r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        private brushUiMap: any, // todo\r\n        private layerPreview: LayerPreview,\r\n        private layerManager: LayerManager,\r\n        private handUi: HandUi,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private getInitState: () => IInitState,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx: () => CanvasRenderingContext2D | null,\r\n        private setCurrentLayerCtx: (ctx: CanvasRenderingContext2D) => void,\r\n        private getCurrentBrush: () => any, // todo\r\n    ) { }\r\n\r\n    undo (): boolean {\r\n        if (this.shouldIgnoreTest() || !klHistory.canUndo()) {\r\n            return false;\r\n        }\r\n        const entries: IHistoryEntry[] = klHistory.undo();\r\n        const klCanvas = this.getKlCanvas();\r\n        klHistory.pause(true);\r\n        const initState: IInitState = this.getInitState();\r\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\r\n        klCanvas.copy(initState.canvas);\r\n        let layerIndex = initState.focus;\r\n        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\r\n        const brushes: any = {};\r\n        for (const b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\r\n        entries.forEach(entry => {\r\n            layerIndex = execHistoryEntry(\r\n                entry,\r\n                layerIndex,\r\n                klCanvas,\r\n                brushes,\r\n                (ctx) => this.setCurrentLayerCtx(ctx),\r\n                () => throwIfNull(this.getCurrentLayerCtx()),\r\n            );\r\n        });\r\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        this.layerManager.update(layerIndex);\r\n        this.layerPreview.setLayer(klCanvas.getLayer(layerIndex));\r\n        this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n\r\n        klHistory.pause(false);\r\n        return true;\r\n    }\r\n\r\n    redo (): boolean {\r\n        if (this.shouldIgnoreTest() || !klHistory.canRedo()) {\r\n            return false;\r\n        }\r\n        const entry = klHistory.redo();\r\n        if (!entry) {\r\n            setTimeout(() => {\r\n                throw new Error('redo failed. redo entry undefined');\r\n            });\r\n            return false;\r\n        }\r\n        const klCanvas = this.getKlCanvas();\r\n        klHistory.pause(true);\r\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\r\n        const brushes: any = {};\r\n        for (const b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(this.brushUiMap.sketchyBrush.getSeed());\r\n        execHistoryEntry(\r\n            entry,\r\n            0, // doesn't matter, because result not used\r\n            klCanvas,\r\n            brushes,\r\n            (ctx) => this.setCurrentLayerCtx(ctx),\r\n            () => throwIfNull(this.getCurrentLayerCtx()),\r\n        );\r\n\r\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        const currentLayerIndex = klCanvas.getLayerIndex(this.getCurrentLayerCtx().canvas);\r\n        this.layerManager.update(currentLayerIndex);\r\n        this.layerPreview.setLayer(klCanvas.getLayer(currentLayerIndex));\r\n        this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n        klHistory.pause(false);\r\n\r\n        return true;\r\n    }\r\n\r\n    catchup (logParam: IHistoryBroadcast | null): void {\r\n        // const start = performance.now();\r\n        //play catch up (the version that is a few steps behind)\r\n\r\n        if (!logParam || !logParam.bufferUpdate) {\r\n            return;\r\n        }\r\n\r\n        const initState: IInitState = this.getInitState();\r\n        let localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\r\n\r\n        initState.focus = execHistoryEntry(\r\n            logParam.bufferUpdate,\r\n            initState.focus,\r\n            initState.canvas,\r\n            initState.brushes,\r\n            (ctx) => {\r\n                localCurrentLayerCtx = ctx;\r\n            },\r\n            () => throwIfNull(localCurrentLayerCtx),\r\n        );\r\n\r\n        // console.log('catchup', performance.now() - start);\r\n    }\r\n\r\n\r\n}","import {IRGB, ISliderConfig} from '../kl-types';\r\n\r\nexport type TBrushSettingEmit = { type: 'color'; value: IRGB } |\r\n    { type: 'opacity'; value: number } |\r\n    { type: 'size'; value: number } |\r\n    { type: 'sliderConfig'; value: ISliderConfig };\r\n\r\nexport type TBrushSettingSubscriber = (p : TBrushSettingEmit) => void;\r\n\r\n/**\r\n * Central place to update brush settings, and to subscribe to changes.\r\n */\r\nexport class BrushSettingService {\r\n\r\n    private static instance: BrushSettingService;\r\n    subscriberArr: TBrushSettingSubscriber[] = [];\r\n\r\n    private emit (obj: TBrushSettingEmit, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (this.subscriberArr[i] === skipSubscriber) {\r\n                continue;\r\n            }\r\n            this.subscriberArr[i](obj);\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        private onSetColor: (rgb: IRGB) => void,\r\n        private onSetSize: (size: number) => void,\r\n        private onSetOpacity: (opacity: number) => void,\r\n        private onGetColor: () => IRGB,\r\n        private onGetSize: () => number,\r\n        private onGetOpacity: () => number,\r\n        private onGetSliderConfig: () => ISliderConfig,\r\n    ) {\r\n        if (BrushSettingService.instance) {\r\n            throw new Error('BrushSettingService already instantiated');\r\n        }\r\n        BrushSettingService.instance = this;\r\n    }\r\n\r\n    emitColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'color',\r\n                value: color,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSize (size: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'size',\r\n                value: size,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'opacity',\r\n                value: opacity,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSliderConfig (sliderConfig: ISliderConfig, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.emit(\r\n            {\r\n                type: 'sliderConfig',\r\n                value: sliderConfig,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    /**\r\n     * set current brush color\r\n     * @param color\r\n     * @param skipSubscriber\r\n     */\r\n    setColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetColor(color);\r\n        this.emitColor(color, skipSubscriber);\r\n    }\r\n\r\n    /**\r\n     * set current brush size\r\n     * @param size\r\n     * @param skipSubscriber\r\n     */\r\n    setSize (size: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetSize(size);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * set current opacity\r\n     * @param opacity\r\n     * @param skipSubscriber\r\n     */\r\n    setOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetOpacity(opacity);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * get current brush color\r\n     */\r\n    getColor (): IRGB {\r\n        return this.onGetColor();\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.onGetSize();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.onGetOpacity();\r\n    }\r\n\r\n    getSliderConfig (): ISliderConfig {\r\n        return this.onGetSliderConfig();\r\n    }\r\n\r\n    /**\r\n     * subscribe to changes\r\n     * @param func\r\n     */\r\n    subscribe (func: TBrushSettingSubscriber): void {\r\n        if (this.subscriberArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.subscriberArr.push(func);\r\n    }\r\n\r\n    unsubscribe (func: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (func === this.subscriberArr[i]) {\r\n                this.subscriberArr.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG, languageStrings, LS_LANGUAGE_KEY} from '../../../language/language';\r\nimport {KL} from '../../kl';\r\nimport {languages} from '../../../../languages/languages';\r\nimport {DynamicModal} from '../modals/base/dynamic-modal';\r\nimport bitbofLogoImg from '/src/app/img/bitbof-logo.svg';\r\nimport klecksLogoImg from '/src/app/img/klecks-logo.png';\r\nimport uiSwapImg from '/src/app/img/ui/ui-swap-lr.svg';\r\nimport {LocalStorage} from '../../../bb/base/local-storage';\r\nimport {theme, TTheme} from '../../../theme/theme';\r\nimport {addIsDarkListener} from '../../../bb/base/base';\r\n\r\nexport class SettingsTab {\r\n\r\n    private el: HTMLElement;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        onLeftRight: () => void,\r\n        customAbout?: HTMLElement,\r\n    ) {\r\n        this.el = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n\r\n        // ---- language ----\r\n        const autoLanguage = languageStrings.getAutoLanguage();\r\n\r\n        const langWrapper = BB.el({\r\n            parent: this.el,\r\n            content: BB.el({\r\n                content: LANG('settings-language') + ':',\r\n                css: {\r\n                    marginRight: '5px',\r\n                    marginBottom: '2px',\r\n                },\r\n            }),\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                flexWrap: 'wrap',\r\n            },\r\n        });\r\n\r\n        const options: [string, string][] = [\r\n            ['auto', LANG('auto') + `  ${autoLanguage.name} (${autoLanguage.code})`] as [string, string],\r\n            ...languages.map(item => {\r\n                return [item.code, item.name + ` (${item.code})`] as [string, string];\r\n            }),\r\n        ];\r\n        const languageSelect = new KL.Select({\r\n            initValue: LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto',\r\n            optionArr: options,\r\n            onChange: (val) => {\r\n                if (val === 'auto') {\r\n                    LocalStorage.removeItem(LS_LANGUAGE_KEY);\r\n                } else {\r\n                    LocalStorage.setItem(LS_LANGUAGE_KEY, val);\r\n                }\r\n                languageHint.style.display = 'block';\r\n            },\r\n        });\r\n        BB.css(languageSelect.getElement(), {\r\n            flexGrow: '1',\r\n        });\r\n        const languageHint = BB.el({\r\n            className: 'kl-toolspace-note',\r\n            content: LANG('settings-language-reload'),\r\n            css: {\r\n                display: 'none',\r\n                marginTop: '5px',\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n\r\n        langWrapper.append(\r\n            languageSelect.getElement(),\r\n            languageHint,\r\n        );\r\n\r\n\r\n        // ---- theme ----\r\n        function themeToLabel (theme: TTheme): string {\r\n            return theme === 'dark' ? ' ' + LANG('theme-dark') : ' ' + LANG('theme-light');\r\n        }\r\n        const themeSelect = new KL.Select({\r\n            optionArr: [\r\n                ['auto', LANG('auto') + '  ' + themeToLabel(theme.getMediaQueryTheme())],\r\n                ['light', themeToLabel('light')],\r\n                ['dark', themeToLabel('dark')],\r\n            ],\r\n            initValue: theme.getStoredTheme() || 'auto',\r\n            onChange: (val): void => {\r\n                theme.setStoredTheme(val === 'auto' ? undefined : val);\r\n            },\r\n        });\r\n        BB.css(themeSelect.getElement(), {\r\n            flexGrow: '1',\r\n        });\r\n        addIsDarkListener(() => {\r\n            themeSelect.updateLabel('auto', LANG('auto') + '  ' + themeToLabel(theme.getMediaQueryTheme()));\r\n        });\r\n        BB.el({\r\n            parent: this.el,\r\n            content: [\r\n                BB.el({\r\n                    content: LANG('settings-theme') + ':',\r\n                    css: {\r\n                        marginRight: '5px',\r\n                        marginBottom: '2px',\r\n                    },\r\n                }),\r\n                themeSelect.getElement(),\r\n            ],\r\n            css: {\r\n                marginTop: '15px',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                flexWrap: 'wrap',\r\n            },\r\n        });\r\n\r\n        // ---- flip ui ----\r\n        BB.el({\r\n            tagName: 'button',\r\n            parent: this.el,\r\n            content: '<img height=\"20\" width=\"18\" src=\"' + uiSwapImg + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + LANG('switch-ui-left-right'),\r\n            onClick: () => onLeftRight(),\r\n            css: {\r\n                marginTop: '15px',\r\n            },\r\n            custom: {\r\n                tabIndex: '-1',\r\n            },\r\n        });\r\n\r\n\r\n        // ---- about ----\r\n        this.el.append(BB.el({className: 'grid-hr', css: {margin: '10px 0'}}));\r\n\r\n        function makeLicenses () {\r\n            return BB.el({\r\n                tagName: 'a',\r\n                content: LANG('licenses'),\r\n                onClick: () => {\r\n                    import('./licenses').then(result => {\r\n                        new DynamicModal({\r\n                            title: BB.el({\r\n                                content: LANG('licenses'),\r\n                            }),\r\n                            content: BB.el({\r\n                                content: BB.el({\r\n                                    content: result.licenses.replace(/\\n/g, '<br>'),\r\n                                    css: {\r\n                                        padding: '20px',\r\n                                    },\r\n                                }),\r\n                                css: {\r\n                                    height: '100%',\r\n                                    overflowY: 'scroll',\r\n                                },\r\n                            }),\r\n                            width: 800,\r\n                            isMaxHeight: true,\r\n                        });\r\n                    });\r\n                },\r\n            });\r\n        }\r\n\r\n        if (customAbout) {\r\n            this.el.append(customAbout);\r\n            if (!customAbout.innerHTML) {\r\n                const minimalAbout = BB.el({\r\n                    parent: customAbout,\r\n                    css: {\r\n                       textAlign: 'center',\r\n                   },\r\n                });\r\n                minimalAbout.append(\r\n                    BB.el({\r\n                        content: `<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2023<br>`,\r\n                    }),\r\n                    makeLicenses(),\r\n                );\r\n            }\r\n        } else {\r\n            const versionEl = BB.el({\r\n                parent: this.el,\r\n                css: {\r\n                    textAlign: 'center',\r\n                },\r\n                content: `\r\n<img alt=\"Klecks\" class=\"dark-invert\" height=\"25\" src=\"${klecksLogoImg}\"><br>\r\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2023<br>`,\r\n            });\r\n\r\n            versionEl.append(\r\n                makeLicenses(),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('donate'),\r\n                    custom: {\r\n                        href: 'https://kleki.com/donate/',\r\n                        target: '_blank',\r\n                    },\r\n                }),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('source-code'),\r\n                    custom: {\r\n                        href: 'https://klecks.org',\r\n                        target: '_blank',\r\n                    },\r\n                }),\r\n            );\r\n\r\n\r\n        }\r\n\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== LS_LANGUAGE_KEY) {\r\n                return;\r\n            }\r\n            languageSelect.setValue(\r\n                LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'\r\n            );\r\n        });\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hTlU7\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hxlHN\");","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"79hnx\"))).then(() => parcelRequire('jNQF2'));","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n\r\n/**\r\n * Scroll buttons at the top and bottom of toolspace\r\n * Show up when window is very small.\r\n * Allow user to scroll up and down toolspace.\r\n */\r\nexport class ToolspaceScroller {\r\n\r\n    private readonly toolspace: HTMLElement;\r\n    private readonly upBtn: HTMLElement;\r\n    private readonly downBtn: HTMLElement;\r\n    private downInterval: any;\r\n    private upInterval: any;\r\n\r\n    private update (): void {\r\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) { // small buffer where it's not worth it\r\n            if (!this.upInterval) {\r\n                this.upBtn.style.display = this.toolspace.scrollTop === 0 ? 'none' : 'block';\r\n            }\r\n            if (!this.downInterval) {\r\n                this.downBtn.style.display = (\r\n                    this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ?\r\n                        'none' : 'block'\r\n                );\r\n            }\r\n        } else {\r\n            this.upBtn.style.display = 'none';\r\n            this.downBtn.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (p: {toolspace: HTMLElement; uiState: 'left' | 'right'}) {\r\n        this.toolspace = p.toolspace;\r\n        this.upBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                top: '0',\r\n                transform: 'rotate(180deg)',\r\n            },\r\n        });\r\n        this.downBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                bottom: '0',\r\n            },\r\n        });\r\n        this.updateUiState(p.uiState);\r\n\r\n        const upListener = new BB.PointerListener({\r\n            target: this.upBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.upInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, -13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.upInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.upInterval = null;\r\n                        this.update();\r\n                    }, 50);\r\n                }\r\n            },\r\n        });\r\n        const downListener = new BB.PointerListener({\r\n            target: this.downBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.downInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, 13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.downInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.downInterval = null;\r\n                        this.update();\r\n                    }, 50);\r\n                }\r\n            },\r\n        });\r\n\r\n        const wheelListener = (e: WheelEvent) => {\r\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\r\n            this.update();\r\n        };\r\n        this.upBtn.addEventListener('wheel', wheelListener);\r\n        this.downBtn.addEventListener('wheel', wheelListener);\r\n\r\n        this.update();\r\n\r\n        const observer = new MutationObserver(() => this.update());\r\n        observer.observe(\r\n            this.toolspace,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n        window.addEventListener('resize', () => this.update());\r\n\r\n        // hide if in dialog because that can have its own scrollbar\r\n        dialogCounter.subscribe((v) => {\r\n            // ignores the 0.5 by tool dropdown\r\n            this.upBtn.style.opacity = v >= 1 ? '0' : '';\r\n            this.downBtn.style.opacity = v >= 1 ? '0' : '';\r\n        });\r\n    }\r\n\r\n    updateUiState (uiState: 'left' | 'right'): void {\r\n        BB.css(this.upBtn, {\r\n            left: uiState === 'left' ? '0' : '',\r\n            right: uiState === 'right' ? '0' : '',\r\n        });\r\n        BB.css(this.downBtn, {\r\n            left: uiState === 'left' ? '0' : '',\r\n            right: uiState === 'right' ? '0' : '',\r\n        });\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KlSlider} from '../components/kl-slider';\r\nimport {LANG} from '../../../language/language';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {Options} from '../components/options';\r\nimport {TGradientType} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n\r\ninterface IGradientUiSettings {\r\n    opacity: number;\r\n    type: TGradientType;\r\n    doLockAlpha: boolean;\r\n    doSnap: boolean;\r\n    isReversed: boolean;\r\n    isEraser: boolean;\r\n}\r\n\r\n/**\r\n * Gradient Tool tab contents\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport class GradientUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private colorDiv: HTMLElement;\r\n    private colorSlider: KlColorSlider;\r\n    private isVisible: boolean;\r\n    private readonly iconArr: HTMLElement[];\r\n\r\n    private settings: IGradientUiSettings = {\r\n        opacity: 1,\r\n        type: 'linear',\r\n        doLockAlpha: false,\r\n        doSnap: false,\r\n        isReversed: false,\r\n        isEraser: false,\r\n    };\r\n\r\n    private updateIcons (): void {\r\n        const col1 = this.settings.isReversed ? '#0000' : '#000';\r\n        const col2 = this.settings.isReversed ? '#000' : '#0000';\r\n        this.iconArr[0].style.background = `linear-gradient(${col1}, ${col2})`;\r\n        this.iconArr[1].style.background = `linear-gradient(${col2}, ${col1}, ${col2})`;\r\n        this.iconArr[2].style.background = `radial-gradient(${col1}, ${col2})`;\r\n    }\r\n\r\n    // ----- public -------\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.colorSlider = p.colorSlider;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.isVisible = true;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        this.iconArr = [];\r\n        {\r\n            const size = 33;\r\n            [0, 1, 2].forEach(() => {\r\n                const el = BB.el({\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        width: size + 'px',\r\n                        height: size + 'px',\r\n                        borderRadius: '3px',\r\n                        margin: '1px',\r\n                    },\r\n                });\r\n                this.iconArr.push(el);\r\n            });\r\n        }\r\n        this.updateIcons();\r\n\r\n        const typeOptions = new Options<TGradientType>({\r\n            optionArr: [\r\n                {\r\n                    id: 'linear',\r\n                    label: this.iconArr[0],\r\n                    title: LANG('gradient-linear'),\r\n                },\r\n                {\r\n                    id: 'linear-mirror',\r\n                    label: this.iconArr[1],\r\n                    title: LANG('gradient-linear-mirror'),\r\n                },\r\n                {\r\n                    id: 'radial',\r\n                    label: this.iconArr[2],\r\n                    title: LANG('gradient-radial'),\r\n                },\r\n            ],\r\n            initId: 'linear',\r\n            onChange: (id) => {\r\n                this.settings.type = id;\r\n            },\r\n        });\r\n        this.rootEl.append(typeOptions.getElement());\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: this.settings.opacity,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n            onChange: (val) => {\r\n                this.settings.opacity = val;\r\n            },\r\n        });\r\n        BB.css(opacitySlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(opacitySlider.getElement());\r\n\r\n\r\n\r\n        const row1 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const reverseToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('reverse'),\r\n            callback: (b) => {\r\n                this.settings.isReversed = b;\r\n                this.updateIcons();\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        const doSnapToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('angle-snap'),\r\n            title: LANG('angle-snap-title'),\r\n            callback: (b) => {\r\n                this.settings.doSnap = b;\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        row1.append(\r\n            reverseToggle.getElement(),\r\n            doSnapToggle.getElement(),\r\n        );\r\n\r\n\r\n        const row2 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const eraserToggle = new Checkbox({\r\n            init: this.settings.isEraser,\r\n            label: LANG('eraser'),\r\n            callback: (b) => {\r\n                this.settings.isEraser = b;\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('lock-alpha'),\r\n            title: LANG('lock-alpha-title'),\r\n            callback: (b) => {\r\n                this.settings.doLockAlpha = b;\r\n            },\r\n            doHighlight: true,\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        row2.append(\r\n            eraserToggle.getElement(),\r\n            lockAlphaToggle.getElement(),\r\n        );\r\n\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (isVisible: boolean): void {\r\n        this.isVisible = !!isVisible;\r\n        this.rootEl.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\r\n        }\r\n    }\r\n\r\n    getSettings (): IGradientUiSettings {\r\n        return BB.copyObj(this.settings);\r\n    }\r\n\r\n}","import {BB} from '../bb/bb';\r\nimport uiSwapImg from '/src/app/img/ui/ui-swap-lr.svg';\r\nimport helpImg from '/src/app/img/ui/help.svg';\r\nimport {LANG} from '../language/language';\r\nimport {PointerListener} from '../bb/input/pointer-listener';\r\n\r\n/**\r\n * Topmost row of buttons in toolspace. (embed)\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport class EmbedToolspaceTopRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (p: {onSubmit: () => void; onLeftRight: () => void; onHelp: () => void}) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-toolspace-row',\r\n            css: {\r\n                height: '36px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        function createButton (p): {\r\n            el: HTMLElement;\r\n            pointerListener: PointerListener;\r\n        } {\r\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n            const el = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.content ? '' : (p.contain ? padding + 'px 0' : ''),\r\n                },\r\n            });\r\n            if (p.content) {\r\n                el.append(p.content);\r\n            } else {\r\n                const im = BB.el({\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                        backgroundRepeat: 'no-repeat',\r\n                        backgroundPosition: 'center',\r\n                        backgroundSize: p.contain ? 'contain' : '',\r\n                        //filter: 'grayscale(1)',\r\n                        height: '100%',\r\n                    },\r\n                });\r\n                im.style.pointerEvents = 'none';\r\n                el.append(im);\r\n            }\r\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: el,\r\n                onEnterLeave: function (isOver) {\r\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\r\n                },\r\n            });\r\n\r\n            return {\r\n                el,\r\n                pointerListener,\r\n            };\r\n        }\r\n\r\n        const submitButton = createButton({\r\n            onClick: p.onSubmit,\r\n            title: LANG('submit-title'),\r\n            content: BB.el({\r\n                content: LANG('submit'),\r\n                className: 'toolspace-row-button__submit',\r\n                css: {\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    width: '100%',\r\n                    height: '100%',\r\n                },\r\n            }),\r\n            contain: true,\r\n        });\r\n        submitButton.el.style.width = '45px';\r\n\r\n        const helpButton = createButton({\r\n            onClick: p.onHelp,\r\n            title: LANG('help'),\r\n            image: helpImg,\r\n            contain: true,\r\n        });\r\n\r\n        const leftRightButton = createButton({\r\n            onClick: p.onLeftRight,\r\n            title: LANG('switch-ui-left-right'),\r\n            image: uiSwapImg,\r\n            contain: true,\r\n        });\r\n\r\n        this.rootEl.append(submitButton.el, leftRightButton.el, helpButton.el);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n","import {filterLib, filterLibStatus} from './filters';\r\nimport {filterBrightnessContrast} from './filter-brightness-contrast';\r\nimport {filterCropExtend} from './filter-crop-extend';\r\nimport {filterCurves} from './filter-curves';\r\nimport {filterFlip} from './filter-flip';\r\nimport {filterHueSaturation} from './filter-hue-saturation';\r\nimport {filterInvert} from './filter-invert';\r\nimport {filterPerspective} from './filter-perspective';\r\nimport {filterResize} from './filter-resize';\r\nimport {filterRotate} from './filter-rotate';\r\nimport {filterTiltShift} from './filter-tilt-shift';\r\nimport {filterTransform} from './filter-transform';\r\nimport {filterBlur} from './filter-blur';\r\nimport {filterUnsharpMask} from './filter-unsharp-mask';\r\nimport {filterToAlpha} from './filter-to-alpha';\r\nimport {filterGrid} from './filter-grid';\r\nimport {filterNoise} from './filter-noise';\r\nimport {filterPattern} from './filter-pattern';\r\nimport {filterDistort} from './filter-distort';\r\nimport {filterVanishPoint} from './filter-vanish-point';\r\n\r\nfunction importFilter (libObj, moduleObj): void {\r\n    if (moduleObj.getDialog) {\r\n        libObj.getDialog = moduleObj.getDialog;\r\n    }\r\n    libObj.apply = moduleObj.apply;\r\n}\r\n\r\n\r\nexport function importFilters (): void {\r\n    if (filterLibStatus.isLoaded) {\r\n        return;\r\n    }\r\n    importFilter(filterLib.brightnessContrast, filterBrightnessContrast);\r\n    importFilter(filterLib.cropExtend, filterCropExtend);\r\n    importFilter(filterLib.curves, filterCurves);\r\n    importFilter(filterLib.flip, filterFlip);\r\n    importFilter(filterLib.hueSaturation, filterHueSaturation);\r\n    importFilter(filterLib.invert, filterInvert);\r\n    importFilter(filterLib.perspective, filterPerspective);\r\n    importFilter(filterLib.resize, filterResize);\r\n    importFilter(filterLib.rotate, filterRotate);\r\n    importFilter(filterLib.tiltShift, filterTiltShift);\r\n    importFilter(filterLib.transform, filterTransform);\r\n    importFilter(filterLib.blur, filterBlur);\r\n    importFilter(filterLib.unsharpMask, filterUnsharpMask);\r\n    importFilter(filterLib.toAlpha, filterToAlpha);\r\n    importFilter(filterLib.grid, filterGrid);\r\n    importFilter(filterLib.noise, filterNoise);\r\n    importFilter(filterLib.pattern, filterPattern);\r\n    importFilter(filterLib.distort, filterDistort);\r\n    importFilter(filterLib.vanishPoint, filterVanishPoint);\r\n\r\n    filterLibStatus.isLoaded = true;\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterBrightnessContrastInput = {\r\n    brightness: number;\r\n    contrast: number;\r\n}\r\n\r\nexport type TFilterBrightnessContrastHistoryEntry = TFilterHistoryEntry<\r\n    'brightnessContrast',\r\n    TFilterBrightnessContrastInput>;\r\n\r\nexport const filterBrightnessContrast = {\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterBrightnessContrastInput> = {\r\n            element: div,\r\n        };\r\n\r\n\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n\r\n        function finishInit (): void {\r\n\r\n            let brightness = 0, contrast = 0;\r\n            div.innerHTML = LANG('filter-bright-contrast-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const brightnessSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-brightness'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (brightness + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brightness = val / 50 - 1;\r\n                    fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            const contrastSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-contrast'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (contrast + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    contrast = val / 50 - 1;\r\n                    fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            brightnessSlider.getElement().style.marginBottom = '10px';\r\n            div.append(brightnessSlider.getElement(), contrastSlider.getElement());\r\n\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                brightnessSlider.destroy();\r\n                contrastSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterBrightnessContrastInput {\r\n                result.destroy();\r\n                return {\r\n                    brightness: brightness,\r\n                    contrast: contrast,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterBrightnessContrastInput>): boolean {\r\n        const context = params.context;\r\n        const brightness = params.input.brightness;\r\n        const contrast = params.input.contrast;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'brightnessContrast'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterBrightnessContrastHistoryEntry);\r\n\r\n        return true;\r\n    },\r\n};","\r\nexport const eventResMs = 60;","import {fxCanvas} from './fx-canvas';\r\nimport {TFxCanvas} from './fx-canvas-types';\r\n\r\nlet fx: TFxCanvas | null = null;\r\ntry {\r\n    fx = fxCanvas();\r\n} catch (e) {\r\n}\r\n\r\nexport function getSharedFx (): TFxCanvas | null {\r\n    if (!fx || fx._.gl.isContextLost()) {\r\n        try {\r\n            fx = fxCanvas();\r\n        } catch (e) {\r\n            // console.log(e);\r\n        }\r\n    }\r\n    return fx;\r\n}","import {brightnessContrast} from './filters/brightness-contrast';\r\nimport {FxShader} from './core/fx-shader';\r\nimport {gl, setGl} from './core/gl';\r\nimport {FxTexture} from './core/fx-texture';\r\nimport {curves} from './filters/curves';\r\nimport {hueSaturation} from './filters/hue-saturation';\r\nimport {noise} from './filters/noise';\r\nimport {triangleBlur} from './filters/triangle-blur';\r\nimport {tiltShift} from './filters/tilt-shift';\r\nimport {matrixWarp} from './filters/matrix-warp';\r\nimport {unsharpMask} from './filters/unsharp-mask';\r\nimport {toAlpha} from './filters/to-alpha';\r\nimport {invert} from './filters/invert';\r\nimport {perspective} from './filters/perspective';\r\nimport {unmultiplyAlpha} from './filters/unmultiply-alpha';\r\nimport {distort} from './filters/distort';\r\nimport {multiplyAlpha} from './filters/multiply-alpha';\r\nimport {TFxCanvas, TFxGl, TFxSupportedElements, TWrappedTexture} from './fx-canvas-types';\r\nimport {BB} from '../bb/bb';\r\n\r\n/*\r\n * based on glfx.js\r\n * https://github.com/evanw/glfx.js/\r\n * Copyright 2011 Evan Wallace\r\n * Released under the MIT license\r\n */\r\n\r\n/**\r\n * Before you can apply any filters you will need a canvas, which stores the result of the filters you apply.\r\n * Canvas creation is done through fxCanvas(), which creates and returns a new WebGL <canvas> tag with additional\r\n * methods specific to fxCanvas. This call will throw an error message if the browser doesn't support WebGL.\r\n *\r\n * This library provides realtime image effects using WebGL. There are three parts to it:\r\n * - texture - a raw source of image data (created from <img> <canvas> or <video>)\r\n * - filter - an image effect (represents one or more WebGL shaders)\r\n * - canvas - an image buffer that stores the results (a WebGL <canvas> tag)\r\n */\r\nexport const fxCanvas: (() => TFxCanvas) = (function () {\r\n\r\n    function wrapTexture (texture: FxTexture): TWrappedTexture {\r\n        return {\r\n            _: texture,\r\n            loadContentsOf: function (element) {\r\n                // Make sure that we're using the correct global WebGL context\r\n                setGl(this._.gl);\r\n                this._.loadContentsOf(element);\r\n            },\r\n            destroy: function () {\r\n                // Make sure that we're using the correct global WebGL context\r\n                setGl(this._.gl);\r\n                this._.destroy();\r\n            },\r\n        };\r\n    }\r\n\r\n    function texture (element: TFxSupportedElements) {\r\n        return wrapTexture(FxTexture.fromElement(element));\r\n    }\r\n\r\n    function getTextureType (): GLenum {\r\n        let textureType: GLenum = gl.UNSIGNED_BYTE;\r\n\r\n        // Go for floating point buffer textures if we can, it'll make the bokeh\r\n        // filter look a lot better. Note that on Windows, ANGLE does not let you\r\n        // render to a floating-point texture when linear filtering is enabled.\r\n        // See http://crbug.com/172278 for more information.\r\n        if (\r\n            gl.getExtension('WEBGL_color_buffer_float') && // firefox shows warning without this line\r\n            gl.getExtension('OES_texture_float') &&\r\n            gl.getExtension('OES_texture_float_linear')\r\n        ) {\r\n            const testTexture = new FxTexture(100, 100, gl.RGBA, gl.FLOAT);\r\n            try {\r\n                // Only use gl.FLOAT if we can render to it\r\n                testTexture.drawTo(function () {\r\n                    textureType = gl.FLOAT;\r\n                });\r\n            } catch (e) {\r\n            }\r\n            testTexture.destroy();\r\n        }\r\n        return textureType;\r\n    }\r\n\r\n    function initialize (this: TFxCanvas, width: number, height: number): void {\r\n        const textureType = getTextureType();\r\n        if (this._.texture) {\r\n            this._.texture.destroy();\r\n        }\r\n        if (this._.spareTexture) {\r\n            this._.spareTexture.destroy();\r\n        }\r\n        this.width = width;\r\n        this.height = height;\r\n        this._.texture = new FxTexture(width, height, gl.RGBA, textureType);\r\n        this._.spareTexture = new FxTexture(width, height, gl.RGBA, textureType);\r\n        this._.extraTexture = this._.extraTexture || new FxTexture(0, 0, gl.RGBA, textureType);\r\n        this._.flippedShader = this._.flippedShader || new FxShader(null, `\r\nuniform sampler2D texture;\r\nvarying vec2 texCoord;\r\nvoid main() {\r\n    gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\r\n}\r\n        `, 'flippedShader');\r\n        this._.isInitialized = true;\r\n    }\r\n\r\n    function draw (this: TFxCanvas, texture: TWrappedTexture, width?: number, height?: number): TFxCanvas {\r\n        if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\r\n            initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\r\n        }\r\n\r\n        texture._.use();\r\n        this._.texture.drawTo(function () {\r\n            FxShader.getDefaultShader().drawRect();\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    function update (this: TFxCanvas): TFxCanvas {\r\n        this._.texture.use();\r\n        this._.flippedShader.drawRect();\r\n        return this;\r\n    }\r\n\r\n    function contents (this: TFxCanvas) {\r\n        const texture = new FxTexture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\r\n        this._.texture.use();\r\n        texture.drawTo(function () {\r\n            FxShader.getDefaultShader().drawRect();\r\n        });\r\n        return wrapTexture(texture);\r\n    }\r\n\r\n    /*\r\n       Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\r\n       Length of the array will be width * height * 4.\r\n    */\r\n    function getPixelArray (this: TFxCanvas): Uint8Array {\r\n        const w = this._.texture.width;\r\n        const h = this._.texture.height;\r\n        const array = new Uint8Array(w * h * 4);\r\n        this._.texture.drawTo(function () {\r\n            gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\r\n        });\r\n        return array;\r\n    }\r\n\r\n    function wrap<F extends (...args: any[]) => unknown>(fn: F): F {\r\n        return <F>function (this: TFxCanvas, ...args: any[]) {\r\n            // Make sure that we're using the correct global WebGL context\r\n            setGl(this._.gl);\r\n            // Now that the context has been switched, we can call the wrapped function\r\n            return fn.apply(this, args);\r\n        };\r\n    }\r\n\r\n    const fxCanvas = function () {\r\n        const canvas: TFxCanvas = BB.canvas() as TFxCanvas;\r\n        try {\r\n            setGl(BB.throwIfNull(canvas.getContext('experimental-webgl', {premultipliedAlpha: false})) as TFxGl);\r\n        } catch (e) {\r\n            setGl(null);\r\n        }\r\n        if (!gl) {\r\n            throw 'This browser does not support WebGL';\r\n        }\r\n\r\n        canvas._ = {\r\n            gl: gl,\r\n            isInitialized: false,\r\n            texture: null,\r\n            spareTexture: null,\r\n            flippedShader: null,\r\n        };\r\n\r\n        // Core methods\r\n        canvas.texture = wrap(texture);\r\n        canvas.draw = wrap(draw);\r\n        canvas.update = wrap(update);\r\n        canvas.contents = wrap(contents);\r\n        canvas.getPixelArray = wrap(getPixelArray);\r\n\r\n        // Filter methods\r\n        canvas.brightnessContrast = wrap(brightnessContrast);\r\n        canvas.hueSaturation = wrap(hueSaturation);\r\n        canvas.triangleBlur = wrap(triangleBlur);\r\n        canvas.unsharpMask = wrap(unsharpMask);\r\n        canvas.perspective = wrap(perspective);\r\n        canvas.matrixWarp = wrap(matrixWarp);\r\n        canvas.tiltShift = wrap(tiltShift);\r\n        canvas.noise = wrap(noise);\r\n        canvas.curves = wrap(curves);\r\n        canvas.invert = wrap(invert);\r\n        canvas.multiplyAlpha = wrap(multiplyAlpha);\r\n        canvas.unmultiplyAlpha = wrap(unmultiplyAlpha);\r\n        canvas.toAlpha = wrap(toAlpha);\r\n        canvas.distort = wrap(distort);\r\n\r\n        return canvas as TFxCanvas;\r\n    };\r\n\r\n    return fxCanvas;\r\n})();","import {BB} from '../../bb/bb';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {gl} from '../core/gl';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * @type Brightness / Contrast\r\n * Provides additive brightness and multiplicative contrast control.\r\n * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\r\n * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n */\r\nexport type TFilterBrightnessContrast = (\r\n    this: TFxCanvas,\r\n    brightness: number,\r\n    contrast: number\r\n) => TFxCanvas;\r\n\r\nexport const brightnessContrast: TFilterBrightnessContrast = function (brightness, contrast) {\r\n    gl.brightnessContrast = gl.brightnessContrast || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float brightness;\\\r\n        uniform float contrast;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.rgb += brightness;\\\r\n            if (contrast > 0.0) {\\\r\n                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\r\n            } else {\\\r\n                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\r\n            }\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'brightnessContrast');\r\n\r\n    simpleShader.call(this, gl.brightnessContrast, {\r\n        brightness: BB.clamp(brightness, -1, 1),\r\n        contrast: BB.clamp(contrast, -1, 1),\r\n    });\r\n\r\n    return this;\r\n};","import {TFxCanvas, TUniforms} from '../fx-canvas-types';\r\nimport {FxTexture} from './fx-texture';\r\nimport {FxShader} from './fx-shader';\r\n\r\nexport function simpleShader (this: TFxCanvas, shader: FxShader, uniforms: TUniforms, textureIn?: FxTexture, textureOut?: FxTexture): void {\r\n    (textureIn || this._.texture).use();\r\n    this._.spareTexture.drawTo(function () {\r\n        shader.uniforms(uniforms).drawRect();\r\n    });\r\n    this._.spareTexture.swapWith(textureOut || this._.texture);\r\n}","import {gl} from './gl';\r\nimport {TUniforms} from '../fx-canvas-types';\r\nimport {BB} from '../../bb/bb';\r\n\r\n// VERTEX_SHADER | FRAGMENT_SHADER\r\ntype TShaderType = GLenum;\r\n\r\nconst defaultVertexSource = '\\\r\n    attribute vec2 vertex;\\\r\n    attribute vec2 _texCoord;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        texCoord = _texCoord;\\\r\n        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\r\n    }';\r\n\r\nconst defaultFragmentSource = '\\\r\n    uniform sampler2D texture;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        gl_FragColor = texture2D(texture, texCoord);\\\r\n    }';\r\n\r\nfunction isArray (obj: unknown): obj is unknown[] {\r\n    return Object.prototype.toString.call(obj) == '[object Array]';\r\n}\r\n\r\nfunction isNumber (obj: unknown): obj is number {\r\n    return Object.prototype.toString.call(obj) == '[object Number]';\r\n}\r\n\r\nlet floatPrecision: 'lowp' | 'mediump' | 'highp' | undefined;\r\n\r\nexport class FxShader {\r\n\r\n    // ---- static ----\r\n    static getDefaultShader (): FxShader {\r\n        gl.defaultShader = gl.defaultShader || new FxShader();\r\n        return gl.defaultShader;\r\n    }\r\n\r\n\r\n    // ---- private ----\r\n\r\n    private compileSource (type: TShaderType, source: string, nameStr: string): WebGLShader {\r\n        const shader = BB.throwIfNull(gl.createShader(type));\r\n        gl.shaderSource(shader, source.replace(/#define.*/, '')); // glslify adds a line add the beginning that breaks it\r\n        gl.compileShader(shader);\r\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n            throw 'compile error: ' + nameStr + ' - ' + gl.getShaderInfoLog(shader);\r\n        }\r\n        return shader;\r\n    }\r\n\r\n    /**\r\n     * HIGH_FLOAT | MEDIUM_FLOAT\r\n     */\r\n    private testPrecisionSupport (precisionType: GLenum): boolean {\r\n        const format = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, precisionType);\r\n        return format !== null && format.precision !== 0;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        vertexSource?: string | null,\r\n        fragmentSource?: string | null,\r\n        nameStr?: string,\r\n    ) {\r\n        this.vertexAttribute = null;\r\n        this.texCoordAttribute = null;\r\n        this.program = BB.throwIfNull(gl.createProgram());\r\n        vertexSource = vertexSource || defaultVertexSource;\r\n        fragmentSource = fragmentSource || defaultFragmentSource;\r\n        if (!floatPrecision) {\r\n            floatPrecision = this.testPrecisionSupport(gl.HIGH_FLOAT) ? 'highp' : (this.testPrecisionSupport(gl.MEDIUM_FLOAT) ? 'mediump' : 'lowp');\r\n        }\r\n        fragmentSource = 'precision ' + floatPrecision + ' float;' + fragmentSource; // annoying requirement is annoying\r\n        gl.attachShader(this.program, this.compileSource(gl.VERTEX_SHADER, vertexSource, nameStr + '(vertex)'));\r\n        gl.attachShader(this.program, this.compileSource(gl.FRAGMENT_SHADER, fragmentSource, nameStr + '(fragment)'));\r\n        gl.linkProgram(this.program);\r\n        if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\r\n            throw 'link error: ' + gl.getProgramInfoLog(this.program);\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n    \r\n    vertexAttribute: null | number;\r\n    texCoordAttribute: null | number;\r\n    program: WebGLProgram; // null = destroyed\r\n\r\n    destroy (): void {\r\n        gl.deleteProgram(this.program);\r\n        this.program = null;\r\n    }\r\n\r\n    uniforms (uniforms: TUniforms): FxShader {\r\n        gl.useProgram(this.program);\r\n        Object.entries(uniforms).forEach(([name, value]) => {\r\n\r\n            const location = gl.getUniformLocation(this.program, name);\r\n            if (location === null) {\r\n                // will be null if the uniform isn't used in the shader\r\n                return;\r\n            }\r\n\r\n            if (isArray(value)) {\r\n                switch (value.length) {\r\n                    case 1:\r\n                        gl.uniform1fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 2:\r\n                        gl.uniform2fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 3:\r\n                        gl.uniform3fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 4:\r\n                        gl.uniform4fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 9:\r\n                        gl.uniformMatrix3fv(location, false, new Float32Array(value));\r\n                        break;\r\n                    case 16:\r\n                        gl.uniformMatrix4fv(location, false, new Float32Array(value));\r\n                        break;\r\n                    default:\r\n                        throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\r\n                }\r\n            } else if (isNumber(value)) {\r\n                gl.uniform1f(location, value);\r\n            } else {\r\n                throw 'attempted to set uniform \"' + name + '\" to invalid value ' + (value || 'undefined').toString();\r\n            }\r\n        });\r\n        // allow chaining\r\n        return this;\r\n    }\r\n\r\n    //\r\n    /**\r\n     * textures are uniforms too but for some reason can't be specified by gl.uniform1f,\r\n     * even though floating point numbers represent the integers 0 through 7 exactly\r\n     */\r\n    textures (textures: Record<string, GLint>): FxShader {\r\n        gl.useProgram(this.program);\r\n\r\n        Object.entries(textures).forEach(([name, value]) => {\r\n            gl.uniform1i(gl.getUniformLocation(this.program, name), value);\r\n        });\r\n\r\n        // allow chaining\r\n        return this;\r\n    }\r\n\r\n   drawRect (left?: number, top?: number, right?: number, bottom?: number): void {\r\n        let undefined;\r\n        const viewport = gl.getParameter(gl.VIEWPORT);\r\n        top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\r\n        left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\r\n        right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\r\n        bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\r\n        if (gl.vertexBuffer === undefined || gl.vertexBuffer === null) {\r\n            gl.vertexBuffer = BB.throwIfNull(gl.createBuffer());\r\n        }\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([left, top, left, bottom, right, top, right, bottom]), gl.STATIC_DRAW);\r\n        if (gl.texCoordBuffer == null) {\r\n            gl.texCoordBuffer = BB.throwIfNull(gl.createBuffer());\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\r\n        }\r\n        if (this.vertexAttribute == null) {\r\n            this.vertexAttribute = gl.getAttribLocation(this.program, 'vertex');\r\n            gl.enableVertexAttribArray(this.vertexAttribute);\r\n        }\r\n        if (this.texCoordAttribute == null) {\r\n            this.texCoordAttribute = gl.getAttribLocation(this.program, '_texCoord');\r\n            gl.enableVertexAttribArray(this.texCoordAttribute);\r\n        }\r\n        gl.useProgram(this.program);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n        gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n        gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    }\r\n\r\n}","import {TFxGl} from '../fx-canvas-types';\r\n\r\nexport let gl: TFxGl;\r\n\r\nexport function setGl (newGl: TFxGl | null): void {\r\n    gl = newGl;\r\n}","import {gl} from './gl';\r\nimport {BB} from '../../bb/bb';\r\nimport {TFxGl, TFxSupportedElements} from '../fx-canvas-types';\r\n\r\n/**\r\n * Format           Type                    Channels    Bytes per pixel\r\n * RGBA             UNSIGNED_BYTE           4           4\r\n * RGB              UNSIGNED_BYTE           3           3\r\n * RGBA             UNSIGNED_SHORT_4_4_4_4  4           2\r\n * RGBA             UNSIGNED_SHORT_5_5_5_1  4           2\r\n * RGB              UNSIGNED_SHORT_5_6_5    3           2\r\n * LUMINANCE_ALPHA  UNSIGNED_BYTE           2           2\r\n * LUMINANCE        UNSIGNED_BYTE           1           1\r\n * ALPHA            UNSIGNED_BYTE           1           1\r\n *\r\n * https://webglfundamentals.org/webgl/lessons/webgl-data-textures.html\r\n */\r\nexport type TTextureFormat = GLenum;\r\nexport type TTextureType = GLenum;\r\n\r\n\r\nexport class FxTexture {\r\n    \r\n    // ---- static ----\r\n    static fromElement (element: TFxSupportedElements): FxTexture {\r\n        const texture = new FxTexture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\r\n        texture.loadContentsOf(element);\r\n        return texture;\r\n    }\r\n    \r\n    \r\n    // ---- private ----\r\n    private canvas: HTMLCanvasElement;\r\n    private type: TTextureType;\r\n\r\n    /*\r\n    // never seen this being used\r\n    private getCanvas(texture: Texture): CanvasRenderingContext2D {\r\n        if (this.canvas == null) {\r\n            this.canvas = BB.canvas(texture.width, texture.height);\r\n        }\r\n        this.canvas.width = texture.width;\r\n        this.canvas.height = texture.height;\r\n        const c = BB.ctx(this.canvas);\r\n        c.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        return c;\r\n    }*/\r\n\r\n    \r\n    // ---- public ----\r\n    constructor (\r\n        width: number,\r\n        height: number,\r\n        format: TTextureFormat,\r\n        type: TTextureType,\r\n    ) {\r\n        this.gl = gl;\r\n        this.id = BB.throwIfNull(gl.createTexture());\r\n        this.width = width;\r\n        this.height = height;\r\n        this.format = format;\r\n        this.type = type;\r\n        this.canvas = null;\r\n\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        if (width && height) {\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n        }\r\n    }\r\n    \r\n    // ---- interface ----\r\n\r\n    gl: TFxGl;\r\n    width: number;\r\n    height: number;\r\n    id: WebGLTexture; // null -> destroyed\r\n    format: TTextureFormat;\r\n    \r\n    loadContentsOf (element: TFxSupportedElements): void {\r\n        this.width = element.width || element.videoWidth;\r\n        this.height = element.height || element.videoHeight;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\r\n    }\r\n\r\n    initFromBytes (width: number, height: number, data: number[]): void {\r\n        this.width = width;\r\n        this.height = height;\r\n        this.format = gl.RGBA;\r\n        this.type = gl.UNSIGNED_BYTE;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\r\n    }\r\n\r\n    destroy (): void {\r\n        gl.deleteTexture(this.id);\r\n        this.id = null;\r\n    }\r\n\r\n    use (unit?: number): void {\r\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n    }\r\n\r\n    unuse (unit: number): void {\r\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n        gl.bindTexture(gl.TEXTURE_2D, null);\r\n    }\r\n\r\n    ensureFormat (width: number, height: number, format: TTextureFormat, type: TTextureType): void {\r\n        // change the format only if required\r\n        if (width != this.width || height != this.height || format != this.format || type != this.type) {\r\n            this.width = width;\r\n            this.height = height;\r\n            this.format = format;\r\n            this.type = type;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n        }\r\n    }\r\n\r\n    ensureFormatViaTexture (texture: FxTexture): void {\r\n        this.ensureFormat(texture.width, texture.height, texture.format, texture.type);\r\n    }\r\n\r\n    drawTo (callback: () => void): void {\r\n        // start rendering to this texture\r\n        gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\r\n        if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\r\n            throw new Error('incomplete framebuffer');\r\n        }\r\n        gl.viewport(0, 0, this.width, this.height);\r\n\r\n        // do the drawing\r\n        callback();\r\n\r\n        // stop rendering to this texture\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    }\r\n\r\n\r\n    /*\r\n    // never seen this being used\r\n    fillUsingCanvas (callback: (canvas: CanvasRenderingContext2D) => void): Texture {\r\n        callback(this.getCanvas(this));\r\n        this.format = gl.RGBA;\r\n        this.type = gl.UNSIGNED_BYTE;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.canvas);\r\n        return this;\r\n    }\r\n\r\n    // never seen this being used\r\n    toImage (image: HTMLImageElement): void {\r\n        this.use();\r\n        Shader.getDefaultShader().drawRect();\r\n        const size = this.width * this.height * 4;\r\n        const pixels = new Uint8Array(size);\r\n        const c = this.getCanvas(this);\r\n        const data = c.createImageData(this.width, this.height);\r\n        gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n        for (let i = 0; i < size; i++) {\r\n            data.data[i] = pixels[i];\r\n        }\r\n        c.putImageData(data, 0, 0);\r\n        image.src = this.canvas.toDataURL();\r\n    }\r\n     */\r\n\r\n    swapWith (other: FxTexture): void {\r\n        let temp;\r\n\r\n        temp = other.id;\r\n        other.id = this.id;\r\n        this.id = temp;\r\n\r\n        temp = other.width;\r\n        other.width = this.width;\r\n        this.width = temp;\r\n\r\n        temp = other.height;\r\n        other.height = this.height;\r\n        this.height = temp;\r\n\r\n        temp = other.format;\r\n        other.format = this.format;\r\n        this.format = temp;\r\n\r\n        // type?\r\n    }\r\n}\r\n","import {splineInterpolate} from '../math/spline-interpolate';\r\nimport {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Curves\r\n * @description A powerful mapping tool that transforms the colors in the image\r\n *              by an arbitrary function. The function is interpolated between\r\n *              a set of 2D points using splines. The curves filter can take\r\n *              either one or three arguments which will apply the mapping to\r\n *              either luminance or RGB values, respectively.\r\n * @param red   A list of points that define the function for the red channel.\r\n *              Each point is a list of two values: the value before the mapping\r\n *              and the value after the mapping, both in the range 0 to 1. For\r\n *              example, [[0,1], [1,0]] would invert the red channel while\r\n *              [[0,0], [1,1]] would leave the red channel unchanged.\r\n * @param green A list of points that define the function for the green\r\n *              channel (just like for red).\r\n * @param blue  list of points that define the function for the blue\r\n *              channel (just like for red).\r\n */\r\nexport type TFilterCurves = (\r\n    this: TFxCanvas,\r\n    red: [number, number][],\r\n    green: [number, number][],\r\n    blue: [number, number][],\r\n) => TFxCanvas;\r\n\r\nexport const curves: TFilterCurves = function (red, green, blue) {\r\n    // Create the ramp texture\r\n    const redRamp = splineInterpolate(red);\r\n    const greenRamp = splineInterpolate(green);\r\n    const blueRamp = splineInterpolate(blue);\r\n    const array: number[] = [];\r\n    for (let i = 0; i < 256; i++) {\r\n        array.splice(array.length, 0, redRamp[i], greenRamp[i], blueRamp[i], 255);\r\n    }\r\n    this._.extraTexture.initFromBytes(256, 1, array);\r\n    this._.extraTexture.use(1);\r\n\r\n    gl.curves = gl.curves || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform sampler2D map;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.r = texture2D(map, vec2(color.r)).r;\\\r\n            color.g = texture2D(map, vec2(color.g)).g;\\\r\n            color.b = texture2D(map, vec2(color.b)).b;\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'curves');\r\n\r\n    gl.curves.textures({\r\n        map: 1,\r\n    });\r\n    simpleShader.call(this, gl.curves, {});\r\n\r\n    return this;\r\n};","import {BB} from '../../bb/bb';\r\n\r\nexport function splineInterpolate (points: [number, number][]): number[] {\r\n    const interpolator = new BB.SplineInterpolator(points);\r\n    const array = [];\r\n    for (let i = 0; i < 256; i++) {\r\n        array.push(\r\n            BB.clamp(\r\n                Math.floor(interpolator.interpolate(i / 255) * 256),\r\n                0,\r\n                255\r\n            )\r\n        );\r\n    }\r\n    return array;\r\n}","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {BB} from '../../bb/bb';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Hue / Saturation\r\n * @description      Provides rotational hue and multiplicative saturation control. RGB color space\r\n *                   can be imagined as a cube where the axes are the red, green, and blue color\r\n *                   values. Hue changing works by rotating the color vector around the grayscale\r\n *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\r\n *                   Saturation is implemented by scaling all color channel values either toward\r\n *                   or away from the average color channel value.\r\n * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\r\n *                   and 1 is 180 degree rotation in the positive direction)\r\n * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n */\r\nexport type TFilterHueSaturation = (\r\n    this: TFxCanvas,\r\n    hue: number,\r\n    saturation: number,\r\n) => TFxCanvas;\r\n\r\nexport const hueSaturation: TFilterHueSaturation = function (hue, saturation) {\r\n    gl.hueSaturation = gl.hueSaturation || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float hue;\\\r\n        uniform float saturation;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\r\n            float angle = hue * 3.14159265;\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\r\n            float len = length(color.rgb);\\\r\n            color.rgb = vec3(\\\r\n                dot(color.rgb, weights.xyz),\\\r\n                dot(color.rgb, weights.zxy),\\\r\n                dot(color.rgb, weights.yzx)\\\r\n            );\\\r\n            \\\r\n            /* saturation adjustment */\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            if (saturation > 0.0) {\\\r\n                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\r\n            } else {\\\r\n                color.rgb += (average - color.rgb) * (-saturation);\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'hueSaturation');\r\n\r\n    simpleShader.call(this, gl.hueSaturation, {\r\n        hue: BB.clamp(hue, -1, 1),\r\n        saturation: BB.clamp(saturation, -1, 1),\r\n    });\r\n\r\n    return this;\r\n};\r\n","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport shaderNoise from '../shaders/shader-noise.glsl';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Noise\r\n * draws noise, completely replaces original image\r\n */\r\nexport type TFilterNoise = (\r\n    this: TFxCanvas,\r\n    seed: number, // float, any value okay\r\n    type: number, // 1 value, 2 simplex, 3 cellular\r\n    scale: [number, number], // float, small scale will show repeating patterns\r\n    offset: [number, number], // offset x, y - large offsets will show repeating patterns\r\n    octaves: number, // int 0 - 4\r\n    samples: number, // 1 | 4 | 8 -> super-sampling\r\n    peaks: number, // how often it will ramp *additionally* from 0 to 1\r\n    brightness: number, // range [-1, 1]\r\n    contrast: number, // range [-1, 1]\r\n    isReversed: boolean, // reverse 0-1 range\r\n    colA: {r: number; g: number; b: number}, // which color at 0, if rgb\r\n    colB: {r: number; g: number; b: number}, // which color at 1, if rgb\r\n    channels: 'rgb' | 'alpha', // which channel to target\r\n) => TFxCanvas;\r\n\r\nexport const noise: TFilterNoise = function (\r\n    seed,\r\n    type,\r\n    scale,\r\n    offset,\r\n    octaves,\r\n    samples,\r\n    peaks,\r\n    brightness,\r\n    contrast,\r\n    isReversed,\r\n    colA,\r\n    colB,\r\n    channels,\r\n) {\r\n    gl.noise = gl.noise || new FxShader(null, shaderNoise.replace(/#define.*/, ''), 'noise');\r\n    simpleShader.call(this, gl.noise, {\r\n        seed,\r\n        type,\r\n        scale: [scale[0], scale[1]],\r\n        offset,\r\n        octaves,\r\n        samples,\r\n        texSize: [this.width, this.height],\r\n        peaks,\r\n        brightness,\r\n        contrast,\r\n        isReversed: isReversed ? 1.0 : 0.0,\r\n        colA: colA ? [colA.r / 255, colA.g / 255, colA.b / 255] : [0, 0, 0],\r\n        colB: colB ? [colB.r / 255, colB.g / 255, colB.b / 255] : [1, 1, 1],\r\n        channels: channels === 'rgb' ? 0 : 1,\r\n    });\r\n\r\n    return this;\r\n};","uniform sampler2D texture;\r\nvarying vec2 texCoord;\r\nuniform vec2 texSize;\r\n\r\nuniform float seed;\r\nuniform float type;\r\nuniform vec2 scale;\r\nuniform vec2 offset;\r\nuniform float octaves;\r\nuniform float samples;\r\n\r\nuniform float peaks;\r\nuniform float contrast;\r\nuniform float brightness;\r\nuniform float isReversed;\r\n\r\nuniform vec3 colA;\r\nuniform vec3 colB;\r\n\r\nuniform float channels; // 0 - rgb, 1 - alpha\r\n\r\n// fbm, cellular_noise based on\r\n// https://github.com/Gonkee/Gonkees-Shaders\r\n// MIT, Copyright  Gonkee\r\n\r\n// hash & simplex based on\r\n// https://www.shadertoy.com/view/Msf3WH\r\n// MIT, Copyright  2013 Inigo Quilez\r\n// https://www.youtube.com/c/InigoQuilez\r\n// https://iquilezles.org\r\n\r\n\r\n\r\nfloat rand(vec2 co) {\r\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\r\n}\r\n\r\nfloat value_noise(vec2 coord){\r\n    return rand(floor(coord) / 100.0);\r\n}\r\n\r\nfloat cellular_noise(vec2 coord) {\r\n    vec2 i = floor(coord);\r\n    vec2 f = fract(coord);\r\n\r\n    float min_dist = 99999.0;\r\n    for (float x = -1.0; x <= 1.0; x++) {\r\n        for (float y = -1.0; y <= 1.0; y++) {\r\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\r\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\r\n            min_dist = min(min_dist, dist);\r\n        }\r\n    }\r\n    return min_dist;\r\n}\r\n\r\n// ---------- Simplex Alternative ---------------------\r\n\r\nvec3 hash(vec3 p)\r\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\r\n, dot(p, vec3(269.5, 183.3, 246.1))\r\n, dot(p, vec3(113.5, 271.9, 124.6)))\r\n;return fract(sin(p)*43758.5453123)*2.-1.; }\r\n\r\nmat3 hash(mat3 p)\r\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\r\n\r\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\r\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\r\n\r\n//return noiseGra13dx as .x, and its derivatives as .yzw\r\n// https://www.shadertoy.com/view/llByD1\r\nvec3 noiseGra13dx(in vec3 x) {\r\n    vec3 p=floor(x), w=fract(x)\r\n    #if 1\r\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\r\n    #else\r\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\r\n    #endif\r\n    //gradients\r\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\r\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\r\n    //projections\r\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\r\n    //interpolations\r\n    float g=dot(G, w), f=dot(F, w-vec3(1));\r\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\r\n    mat3 S=D-mat3(G, G, G), W=D-E;\r\n    a.x=(a.x+a.y+a.z)+f-g;\r\n    ;float b=u.x*u.y*u.z;\r\n\r\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\r\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\r\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\r\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\r\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\r\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\r\n    return 0.5 + 0.5 * result.xxx;\r\n}\r\n\r\nfloat fbm(vec2 coord) {\r\n    float normalize_factor = 0.0;\r\n    float value = 0.0;\r\n    float scale = 0.5;\r\n\r\n    for (float i = 0.0; i < 7.0; i++){\r\n        if (i < octaves) {\r\n            if (type == 0.0) {\r\n                value += value_noise(coord) * scale;\r\n            } else if (type == 1.0) {\r\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\r\n            } else if (type == 2.0) {\r\n                value += cellular_noise(coord) * scale;\r\n            }\r\n            normalize_factor += scale;\r\n            coord *= 2.0;\r\n            scale *= 0.5;\r\n        }\r\n    }\r\n    return value / normalize_factor;\r\n}\r\n\r\nfloat render (vec2 pos) {\r\n    float result = fbm(pos);\r\n    //\r\n\r\n    if (peaks > 0.0) {\r\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\r\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\r\n    }\r\n\r\n    result += brightness;\r\n    if (contrast > 0.0) {\r\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\r\n    } else if (contrast < 0.0) {\r\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\r\n    }\r\n\r\n    if (isReversed == 1.0) {\r\n        result = 1.0 - result;\r\n    }\r\n    return result;\r\n}\r\n\r\n\r\nvoid main() {\r\n    vec4 color;\r\n\r\n    vec2 seedOffset;\r\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\r\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\r\n\r\n    float val = 0.0;\r\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\r\n\r\n    if (samples == 1.0) {\r\n        val = render(basePos);\r\n\r\n    }/* else if (samples == 4.0) {\r\n        for (float i = 0.0; i < 2.0; i++) {\r\n            for (float e = 0.0; e < 2.0; e++) {\r\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\r\n            }\r\n        }\r\n        val /= 4.0;\r\n\r\n    }*/ else if (samples == 16.0) {\r\n        for (float i = 0.0; i < 4.0; i++) {\r\n            for (float e = 0.0; e < 4.0; e++) {\r\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\r\n            }\r\n        }\r\n        val /= 16.0;\r\n    }\r\n\r\n    if (channels == 0.0) {\r\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\r\n    } else {\r\n        gl_FragColor = vec4(vec3(1.0), val);\r\n    }\r\n}","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {randomShaderFunc} from '../shaders/random-shader-func';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Triangle Blur\r\n * @description  This is the most basic blur filter, which convolves the image with a\r\n *               pyramid filter. The pyramid filter is separable and is applied as two\r\n *               perpendicular triangle filters.\r\n * @param radius The radius of the pyramid convolved with the image.\r\n */\r\nexport type TFilterTriangleBlur = (\r\n    this: TFxCanvas,\r\n    radius: number,\r\n) => TFxCanvas;\r\n\r\n\r\nexport const triangleBlur: TFilterTriangleBlur = function (radius) {\r\n    gl.triangleBlur = gl.triangleBlur || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta * percent);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'triangleBlur');\r\n\r\n    simpleShader.call(this, gl.triangleBlur, {\r\n        delta: [radius / this.width, 0],\r\n    });\r\n    simpleShader.call(this, gl.triangleBlur, {\r\n        delta: [0, radius / this.height],\r\n    });\r\n\r\n    return this;\r\n};","// returns a random number between 0 and 1\r\nexport const randomShaderFunc = '\\\r\n    float random(vec3 scale, float seed) {\\\r\n        /* use the fragment position for a different seed per-pixel */\\\r\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\r\n    }\\\r\n';","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {randomShaderFunc} from '../shaders/random-shader-func';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Tilt Shift\r\n * @description          Simulates the shallow depth of field normally encountered in close-up\r\n *                       photography, which makes the scene seem much smaller than it actually\r\n *                       is. This filter assumes the scene is relatively planar, in which case\r\n *                       the part of the scene that is completely in focus can be described by\r\n *                       a line (the intersection of the focal plane and the scene). An example\r\n *                       of a planar scene might be looking at a road from above at a downward\r\n *                       angle. The image is then blurred with a blur radius that starts at zero\r\n *                       on the line and increases further from the line.\r\n * @param startX         The x coordinate of the start of the line segment.\r\n * @param startY         The y coordinate of the start of the line segment.\r\n * @param endX           The x coordinate of the end of the line segment.\r\n * @param endY           The y coordinate of the end of the line segment.\r\n * @param blurRadius     The maximum radius of the pyramid blur.\r\n * @param gradientRadius The distance from the line at which the maximum blur radius is reached.\r\n */\r\nexport type TFilterTiltShift = (\r\n    this: TFxCanvas,\r\n    startX: number,\r\n    startY: number,\r\n    endX: number,\r\n    endY: number,\r\n    blurRadius: number,\r\n    gradientRadius: number,\r\n) => TFxCanvas;\r\n\r\nexport const tiltShift: TFilterTiltShift = function (\r\n    startX,\r\n    startY,\r\n    endX,\r\n    endY,\r\n    blurRadius,\r\n    gradientRadius,\r\n) {\r\n    gl.tiltShift = gl.tiltShift || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float blurRadius;\\\r\n        uniform float gradientRadius;\\\r\n        uniform vec2 start;\\\r\n        uniform vec2 end;\\\r\n        uniform vec2 delta;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\\\r\n            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'tiltShift');\r\n\r\n    const dx = endX - startX;\r\n    const dy = endY - startY;\r\n    const d = Math.sqrt(dx * dx + dy * dy);\r\n    simpleShader.call(this, gl.tiltShift, {\r\n        blurRadius: blurRadius,\r\n        gradientRadius: gradientRadius,\r\n        start: [startX, startY],\r\n        end: [endX, endY],\r\n        delta: [dx / d, dy / d],\r\n        texSize: [this.width, this.height],\r\n    });\r\n    simpleShader.call(this, gl.tiltShift, {\r\n        blurRadius: blurRadius,\r\n        gradientRadius: gradientRadius,\r\n        start: [startX, startY],\r\n        end: [endX, endY],\r\n        delta: [-dy / d, dx / d],\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {warpShader} from '../shaders/warp-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {getInverse} from '../math/matrix';\r\nimport {TFxCanvas, TMat2x2, TMat3x3, TMatDeep3x3} from '../fx-canvas-types';\r\n\r\n/**\r\n * Matrix Warp\r\n * @description           Transforms an image by a 2x2 or 3x3 matrix. The coordinates used in\r\n *                        the transformation are (x, y) for a 2x2 matrix or (x, y, 1) for a\r\n *                        3x3 matrix, where x and y are in units of pixels.\r\n * @param matrix          A 2x2 or 3x3 matrix represented as either a list or a list of lists.\r\n *                        For example, the 3x3 matrix [[2,0,0],[0,3,0],[0,0,1]] can also be\r\n *                        represented as [2,0,0,0,3,0,0,0,1] or just [2,0,0,3].\r\n * @param inverse         A boolean value that, when true, applies the inverse transformation\r\n *                        instead. (optional, defaults to false)\r\n * @param useTextureSpace A boolean value that, when true, uses texture-space coordinates\r\n *                        instead of screen-space coordinates. Texture-space coordinates range\r\n *                        from -1 to 1 instead of 0 to width - 1 or height - 1, and are easier\r\n *                        to use for simple operations like flipping and rotating.\r\n */\r\nexport type TFilterMatrixWarp = (\r\n    this: TFxCanvas,\r\n    matrix: TMat2x2 | TMat3x3 | TMatDeep3x3,\r\n    inverse?: boolean,\r\n    useTextureSpace?: boolean,\r\n) => TFxCanvas;\r\n\r\n\r\nexport const matrixWarp: TFilterMatrixWarp = function (matrix, inverse, useTextureSpace) {\r\n    gl.matrixWarp = gl.matrixWarp || warpShader('\\\r\n        uniform mat3 matrix;\\\r\n        uniform bool useTextureSpace;\\\r\n    ', '\\\r\n        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;\\\r\n        vec3 warp = matrix * vec3(coord, 1.0);\\\r\n        coord = warp.xy / warp.z;\\\r\n        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;\\\r\n    ');\r\n\r\n    // Flatten all members of matrix into one big list\r\n    matrix = matrix.flat() as (TMat2x2 | TMat3x3);\r\n\r\n    // Extract a 3x3 matrix out of the arguments\r\n    if (matrix.length == 4) {\r\n        matrix = [\r\n            matrix[0], matrix[1], 0,\r\n            matrix[2], matrix[3], 0,\r\n            0, 0, 1,\r\n        ];\r\n    } else if (matrix.length != 9) {\r\n        throw 'can only warp with 2x2 or 3x3 matrix';\r\n    }\r\n\r\n    simpleShader.call(this, gl.matrixWarp, {\r\n        matrix: inverse ? getInverse(matrix) : matrix,\r\n        texSize: [this.width, this.height],\r\n        useTextureSpace: useTextureSpace ? 1 : 0,\r\n    });\r\n\r\n    return this;\r\n};","import {FxShader} from '../core/fx-shader';\r\n\r\nexport function warpShader (uniformsStr: string, warpStr: string): FxShader {\r\n    return new FxShader(null, uniformsStr + '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        vec2 coord = texCoord * texSize;\\\r\n        ' + warpStr + '\\\r\n        gl_FragColor = texture2D(texture, coord / texSize);\\\r\n        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\r\n        if (coord != clampedCoord) {\\\r\n            /* fade to transparent if we are outside the image */\\\r\n            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\r\n        }\\\r\n    }', 'warp');\r\n}","import {TMat3x3} from '../fx-canvas-types';\r\n\r\n// from javax.media.jai.PerspectiveTransform\r\n\r\n/**\r\n * Creates a PerspectiveTransform that maps the unit square onto an arbitrary quadrilateral.\r\n */\r\nexport function getSquareToQuad (\r\n    x0: number,\r\n    y0: number,\r\n    x1: number,\r\n    y1: number,\r\n    x2: number,\r\n    y2: number,\r\n    x3: number,\r\n    y3: number\r\n): TMat3x3 {\r\n    const dx1 = x1 - x2;\r\n    const dy1 = y1 - y2;\r\n    const dx2 = x3 - x2;\r\n    const dy2 = y3 - y2;\r\n    const dx3 = x0 - x1 + x2 - x3;\r\n    const dy3 = y0 - y1 + y2 - y3;\r\n    const det = dx1 * dy2 - dx2 * dy1;\r\n    const a = (dx3 * dy2 - dx2 * dy3) / det;\r\n    const b = (dx1 * dy3 - dx3 * dy1) / det;\r\n    return [\r\n        x1 - x0 + a * x1, y1 - y0 + a * y1, a,\r\n        x3 - x0 + b * x3, y3 - y0 + b * y3, b,\r\n        x0, y0, 1,\r\n    ];\r\n}\r\n\r\nexport function getInverse (m: TMat3x3): TMat3x3 {\r\n    const a = m[0], b = m[1], c = m[2];\r\n    const d = m[3], e = m[4], f = m[5];\r\n    const g = m[6], h = m[7], i = m[8];\r\n    const det = a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\r\n    return [\r\n        (e * i - f * h) / det, (c * h - b * i) / det, (b * f - c * e) / det,\r\n        (f * g - d * i) / det, (a * i - c * g) / det, (c * d - a * f) / det,\r\n        (d * h - e * g) / det, (b * g - a * h) / det, (a * e - b * d) / det,\r\n    ];\r\n}\r\n\r\nexport function multiply (a: TMat3x3, b: TMat3x3): TMat3x3 {\r\n    return [\r\n        a[0] * b[0] + a[1] * b[3] + a[2] * b[6],\r\n        a[0] * b[1] + a[1] * b[4] + a[2] * b[7],\r\n        a[0] * b[2] + a[1] * b[5] + a[2] * b[8],\r\n        a[3] * b[0] + a[4] * b[3] + a[5] * b[6],\r\n        a[3] * b[1] + a[4] * b[4] + a[5] * b[7],\r\n        a[3] * b[2] + a[4] * b[5] + a[5] * b[8],\r\n        a[6] * b[0] + a[7] * b[3] + a[8] * b[6],\r\n        a[6] * b[1] + a[7] * b[4] + a[8] * b[7],\r\n        a[6] * b[2] + a[7] * b[5] + a[8] * b[8],\r\n    ];\r\n}","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Unsharp Mask\r\n * @description    A form of image sharpening that amplifies high-frequencies in the image. It\r\n *                 is implemented by scaling pixels away from the average of their neighbors.\r\n * @param radius   The blur radius that calculates the average of the neighboring pixels.\r\n * @param strength A scale factor where 0 is no effect and higher values cause a stronger effect.\r\n */\r\nexport type TFilterUnsharpMask = (\r\n    this: TFxCanvas,\r\n    radius: number,\r\n    strength: number,\r\n) => TFxCanvas;\r\n\r\nexport const unsharpMask: TFilterUnsharpMask = function (radius, strength) {\r\n    gl.unsharpMask = gl.unsharpMask || new FxShader(null, '\\\r\n        uniform sampler2D blurredTexture;\\\r\n        uniform sampler2D originalTexture;\\\r\n        uniform float strength;\\\r\n        uniform float threshold;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 blurred = texture2D(blurredTexture, texCoord);\\\r\n            vec4 original = texture2D(originalTexture, texCoord);\\\r\n            gl_FragColor = mix(blurred, original, 1.0 + strength);\\\r\n        }\\\r\n    ', 'unsharpMask');\r\n\r\n    // Store a copy of the current texture in the second texture unit\r\n    this._.extraTexture.ensureFormatViaTexture(this._.texture);\r\n    this._.texture.use();\r\n    this._.extraTexture.drawTo(function () {\r\n        FxShader.getDefaultShader().drawRect();\r\n    });\r\n\r\n    // Blur the current texture, then use the stored texture to detect edges\r\n    this._.extraTexture.use(1);\r\n    this.triangleBlur(radius);\r\n    gl.unsharpMask.textures({\r\n        originalTexture: 1,\r\n    });\r\n    simpleShader.call(this, gl.unsharpMask, {\r\n        strength: strength,\r\n    });\r\n    this._.extraTexture.unuse(1);\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\nimport {IRGBA} from '../../klecks/kl-types';\r\n\r\n/**\r\n * To Alpha\r\n * @description   Generates alpha channel from luminance (r+g+b)\r\n * @param isInverted    boolean - invert luminance\r\n * @param replaceRGBA    rgba - color to replace rgb with. if a = 0 -> keep orig color\r\n */\r\nexport type TFilterToAlpha = (\r\n    this: TFxCanvas,\r\n    isInverted: boolean,\r\n    replaceRGBA: IRGBA,\r\n) => TFxCanvas;\r\n\r\nexport const toAlpha: TFilterToAlpha = function (isInverted, replaceRGBA) {\r\n    gl.toAlpha = gl.toAlpha || new FxShader(null, '\\\r\n    uniform bool isInverted;\\\r\n    uniform vec4 replace;\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        float alpha = (color.r + color.g + color.b) / 3.0;\\\r\n        if (isInverted) alpha = 1.0 - alpha;\\\r\n        alpha = min(color.a, alpha);\\\r\n        if (replace.a > 0.0) color = replace;\\\r\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha);\\\r\n    }\\\r\n', 'toAlpha');\r\n\r\n    simpleShader.call(this, gl.toAlpha, {\r\n        isInverted: isInverted ? 1 : 0,\r\n        replace: replaceRGBA ? [replaceRGBA.r / 255, replaceRGBA.g / 255, replaceRGBA.b / 255, replaceRGBA.a] : [0, 0, 0, 0],\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Invert\r\n * @description   Inverts color of each pixel\r\n */\r\nexport type TFilterInvert = (\r\n    this: TFxCanvas,\r\n) => TFxCanvas;\r\n\r\nexport const invert: TFilterInvert = function () {\r\n    gl.invert = gl.invert || new FxShader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        color.rgb = 1.0 - color.rgb;\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'invert');\r\n\r\n    simpleShader.call(this, gl.invert, {\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {getInverse, getSquareToQuad, multiply} from '../math/matrix';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\nexport type TRectanglePoints = [\r\n    number, number, // point a\r\n    number, number, // point b\r\n    number, number, // point c\r\n    number, number, // point d\r\n];\r\n\r\n/**\r\n * Perspective\r\n * @description  Warps one quadrangle to another with a perspective transform. This can be used to\r\n *               make a 2D image look 3D or to recover a 2D image captured in a 3D environment.\r\n * @param before The x and y coordinates of four points before the transform in a flat list. This\r\n *               would look like [ax, ay, bx, by, cx, cy, dx, dy] for four points (ax, ay), (bx, by),\r\n *               (cx, cy), and (dx, dy).\r\n * @param after  The x and y coordinates of four points after the transform in a flat list, just\r\n *               like the other argument.\r\n */\r\nexport type TFilterPerspective = (\r\n    this: TFxCanvas,\r\n    before: TRectanglePoints,\r\n    after: TRectanglePoints,\r\n) => TFxCanvas;\r\n\r\nexport const perspective: TFilterPerspective = function (before, after) {\r\n    const a = getSquareToQuad(...after);\r\n    const b = getSquareToQuad(...before);\r\n    const c = multiply(getInverse(a), b);\r\n    return this.matrixWarp(c);\r\n};\r\n","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * unmultiplyAlpha\r\n * reverses alpha multiply\r\n */\r\nexport type TFilterUnmultiplyAlpha = (\r\n    this: TFxCanvas,\r\n) => TFxCanvas;\r\n\r\nexport const unmultiplyAlpha: TFilterUnmultiplyAlpha = function () {\r\n    gl.unmultiplyAlpha = gl.unmultiplyAlpha || new FxShader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        if(color.a > 0.0) {\\\r\n            color.rgb /= color.a;\\\r\n        }\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'unmultiplyAlpha');\r\n\r\n    simpleShader.call(this, gl.unmultiplyAlpha, {\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {warpShader} from '../shaders/warp-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n\r\nexport type TFilterDistortSettings = {\r\n    stepSize: number; // [1, inf]\r\n    distortType: 0 | 1 | 2;\r\n    scale: { x: number; y: number };\r\n    strength: { x: number; y: number };\r\n    phase: { x: number; y: number };\r\n};\r\n\r\n/**\r\n * Distort\r\n * Distorts image (moves pixels around)\r\n */\r\nexport type TFilterDistort = (\r\n    this: TFxCanvas,\r\n    settings: TFilterDistortSettings,\r\n) => TFxCanvas;\r\n\r\n/**\r\n * @filter        Distort\r\n * @description   Distorts image (moves pixels around)\r\n */\r\nexport const distort: TFilterDistort = function (settings) {\r\n    gl.distort = gl.distort || warpShader('\\\r\n        uniform float stepSize;\\\r\n        uniform vec2 scale;\\\r\n        uniform vec2 strength;\\\r\n        uniform vec2 phase;\\\r\n        uniform float type;\\\r\n        ', '\\\r\n        const float PI = 3.14159265;\\\r\n        float x = coord.x;\\\r\n        float y = coord.y;\\\r\n        if (stepSize > 1.0) {\\\r\n            x = floor(x / stepSize) * stepSize;\\\r\n            y = floor(y / stepSize) * stepSize;\\\r\n        }\\\r\n        float distortX = sin((x/scale.x + phase.x) * PI * 2.0) * strength.x;\\\r\n        float distortY = sin((y/scale.y + phase.y) * PI * 2.0) * strength.y;\\\r\n        if (type == 0.0) {\\\r\n            coord.y += distortX;\\\r\n            coord.x += distortY;\\\r\n        } else if (type == 1.0) {\\\r\n            coord.x += distortX;\\\r\n            coord.y += distortY;\\\r\n        } else if (type == 2.0) {\\\r\n            gl_FragColor = texture2D(texture, vec2(x, y) / texSize);\\\r\n            coord.y += sin(gl_FragColor.r/scale.x*200.0 + phase.x * PI * 2.0) * strength.x;\\\r\n            coord.x += cos(gl_FragColor.g/scale.y*200.0 + phase.y * PI * 2.0) * strength.y;\\\r\n        }\\\r\n        coord.x = mod(coord.x, texSize.x);\\\r\n        coord.y = mod(coord.y, texSize.y);\\\r\n        \\\r\n        ');\r\n\r\n    simpleShader.call(this, gl.distort, {\r\n        stepSize: settings.stepSize,\r\n        type: settings.distortType,\r\n        scale: [settings.scale.x, settings.scale.y],\r\n        strength: [settings.strength.x, settings.strength.y],\r\n        phase: [settings.phase.x, settings.phase.y],\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};\r\n\r\n","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * multiplyAlpha\r\n * applies alpha multiply\r\n */\r\nexport type TFilterMultiplyAlpha = (\r\n    this: TFxCanvas,\r\n) => TFxCanvas;\r\n\r\nexport const multiplyAlpha: TFilterMultiplyAlpha = function () {\r\n    gl.multiplyAlpha = gl.multiplyAlpha || new FxShader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        color.rgb *= color.a;\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'multiplyAlpha');\r\n\r\n    simpleShader.call(this, gl.multiplyAlpha, {\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {BB} from '../../bb/bb';\r\nimport {input} from '../ui/components/input';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {Cropper} from '../ui/components/cropper';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IRGBA} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {theme} from '../../theme/theme';\r\n\r\nexport type TFilterCropExtendInput = {\r\n    left: number;\r\n    right: number;\r\n    top: number;\r\n    bottom: number;\r\n    fillColor?: IRGBA;\r\n};\r\n\r\nexport type TFilterCropExtendHistoryEntry = TFilterHistoryEntry<\r\n    'cropExtend',\r\n    TFilterCropExtendInput>;\r\n\r\nexport const filterCropExtend = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const klCanvas = params.klCanvas;\r\n        if (!klCanvas) {\r\n            return false;\r\n        }\r\n        const tempCanvas = BB.canvas();\r\n        {\r\n            const fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 560, 400, 1);\r\n            const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n            const previewFactor = w / klCanvas.getWidth();\r\n            tempCanvas.width = w;\r\n            tempCanvas.height = h;\r\n            tempCanvas.style.display = 'block';\r\n            BB.ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n        }\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterCropExtendInput> = {\r\n            element: div,\r\n        };\r\n        div.innerHTML = LANG('filter-crop-description') + '<br/><br/>';\r\n        let left = 0, right = 0, top = 0, bottom = 0;\r\n        let leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\r\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n        let scale;\r\n\r\n\r\n\r\n        // --- input elements ---\r\n\r\n        const lrWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'},\r\n        });\r\n        const tbWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'},\r\n        });\r\n        div.append(lrWrapper, tbWrapper);\r\n\r\n        const leftInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                leftChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n        const rightInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px'},\r\n            callback: function (v) {\r\n                rightChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n        const topInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                topChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n        const bottomInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px'},\r\n            callback: function (v) {\r\n                bottomChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            width: '60px',\r\n        };\r\n        lrWrapper.append(\r\n            BB.el({content: LANG('filter-crop-left') + ':', css: labelStyle}),\r\n            leftInput,\r\n            BB.el({content: LANG('filter-crop-right') + ':', css: labelStyle}),\r\n            rightInput\r\n        );\r\n        tbWrapper.append(\r\n            BB.el({content: LANG('filter-crop-top') + ':', css: labelStyle}),\r\n            topInput,\r\n            BB.el({content: LANG('filter-crop-bottom') + ':', css: labelStyle}),\r\n            bottomInput\r\n        );\r\n\r\n        function updateInput (): void {\r\n            left = parseInt(leftInput.value);\r\n            right = parseInt(rightInput.value);\r\n            top = parseInt(topInput.value);\r\n            bottom = parseInt(bottomInput.value);\r\n            let newWidth = klCanvas.getWidth() + left + right;\r\n            let newHeight = klCanvas.getHeight() + top + bottom;\r\n\r\n            if (newWidth <= 0) {\r\n                if (leftChanged) {\r\n                    left = -klCanvas.getWidth() - right + 1;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -klCanvas.getWidth() - left + 1;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = 1;\r\n            }\r\n            if (newWidth > maxWidth) {\r\n                if (leftChanged) {\r\n                    left = -klCanvas.getWidth() - right + maxWidth;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -klCanvas.getWidth() - left + maxWidth;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = maxWidth;\r\n            }\r\n            if (newHeight <= 0) {\r\n                if (topChanged) {\r\n                    top = -klCanvas.getHeight() - bottom + 1;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -klCanvas.getHeight() - top + 1;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = 1;\r\n            }\r\n            if (newHeight > maxHeight) {\r\n                if (topChanged) {\r\n                    top = -klCanvas.getHeight() - bottom + maxHeight;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -klCanvas.getHeight() - top + maxHeight;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = maxHeight;\r\n            }\r\n            cropper.setTransform({\r\n                x: -left,\r\n                y: -top,\r\n                width: newWidth,\r\n                height: newHeight,\r\n            });\r\n\r\n\r\n            leftChanged = false;\r\n            rightChanged = false;\r\n            topChanged = false;\r\n            bottomChanged = false;\r\n        }\r\n\r\n        let useRuleOfThirds = true;\r\n        const ruleOThirdsCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-crop-rule-thirds'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                useRuleOfThirds = b;\r\n                cropper.showThirds(useRuleOfThirds);\r\n            },\r\n        });\r\n        div.append(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n            },\r\n        }));\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 0};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 0},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('filter-crop-fill'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function (rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                updateBg();\r\n            },\r\n        });\r\n\r\n\r\n        const flexRow = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n        div.append(flexRow);\r\n        flexRow.append(ruleOThirdsCheckbox.getElement(), colorOptions.getElement());\r\n\r\n\r\n        // when input field changed, or dragging in preview finished\r\n        // adjusts the zoom\r\n        function update (transform): void {\r\n            const fit = BB.fitInto(transform.width, transform.height, 260, 180, 1);\r\n            scale = fit.width / transform.width;\r\n\r\n            const offset = BB.centerWithin(340, previewHeight, fit.width, fit.height);\r\n\r\n            tempCanvas.style.width = klCanvas.getWidth() * scale + 'px';\r\n            tempCanvas.style.height = klCanvas.getHeight() * scale + 'px';\r\n\r\n            offsetWrapper.style.left = (offset.x - transform.x * scale) + 'px';\r\n            offsetWrapper.style.top = (offset.y - transform.y * scale) + 'px';\r\n\r\n            left = parseInt('' + -transform.x);\r\n            top = parseInt('' + -transform.y);\r\n            right = parseInt('' + (transform.x + transform.width - klCanvas.getWidth()));\r\n            bottom = parseInt('' + (transform.y + transform.height - klCanvas.getHeight()));\r\n            leftInput.value = '' + left;\r\n            topInput.value = '' + top;\r\n            rightInput.value = '' + right;\r\n            bottomInput.value = '' + bottom;\r\n\r\n            BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                previewWrapper.style.background = 'url(' + url + ')';\r\n                if (selectedRgbaObj.a !== 0) {\r\n                    tempCanvas.style.background = 'url(' + url + ')';\r\n                }\r\n            }, theme.isDark());\r\n            previewWrapper.style.backgroundPosition = (offset.x) + 'px ' + (offset.y) + 'px';\r\n\r\n            cropper.setScale(scale);\r\n        }\r\n\r\n        const previewHeight = 218; // two less because of border\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-edit-crop-preview',\r\n            css: {\r\n                width: '340px',\r\n                marginTop: '10px',\r\n                marginLeft: '-20px',\r\n                height: previewHeight + 'px',\r\n                backgroundColor: '#9e9e9e',\r\n                position: 'relative',\r\n                borderTop: '1px solid rgb(144,144,144)',\r\n                borderBottom: '1px solid rgb(144,144,144)',\r\n                overflow: 'hidden',\r\n                userSelect: 'none',\r\n                touchAction: 'none',\r\n            },\r\n        });\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        const bgColorOverlay = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0',\r\n            },\r\n        });\r\n        previewWrapper.append(bgColorOverlay);\r\n\r\n        const offsetWrapper = document.createElement('div');\r\n        offsetWrapper.style.position = 'absolute';\r\n        offsetWrapper.style.left = '0px';\r\n        offsetWrapper.style.top = '0px';\r\n        previewWrapper.append(offsetWrapper);\r\n\r\n        const canvasWrapper = BB.el({\r\n            parent: offsetWrapper,\r\n            content: tempCanvas,\r\n            css: {\r\n                boxShadow: '0 0 0px 1px rgb(130,130,130)',\r\n                position: 'absolute',\r\n                left: '0px',\r\n                top: '0px',\r\n            },\r\n        });\r\n\r\n\r\n        div.append(previewWrapper);\r\n        const cropper = new Cropper({\r\n            x: 0,\r\n            y: 0,\r\n            width: klCanvas.getWidth(),\r\n            height: klCanvas.getHeight(),\r\n            scale: scale,\r\n            callback: update,\r\n            maxW: maxWidth,\r\n            maxH: maxHeight,\r\n        });\r\n        update(cropper.getTransform());\r\n        offsetWrapper.append(cropper.getElement());\r\n\r\n        function updateBg (): void {\r\n            if (selectedRgbaObj.a === 0) {\r\n                bgColorOverlay.style.background = '';\r\n                tempCanvas.style.background = '';\r\n            } else {\r\n                bgColorOverlay.style.background = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n\r\n                BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                    tempCanvas.style.background = 'url(' + url + ')';\r\n                }, theme.isDark());\r\n            }\r\n        }\r\n\r\n        function updateIsDark (): void {\r\n            updateInput();\r\n        }\r\n        theme.addIsDarkListener(updateIsDark);\r\n\r\n        result.destroy = (): void => {\r\n            cropper.destroy();\r\n            ruleOThirdsCheckbox.destroy();\r\n            theme.removeIsDarkListener(updateIsDark);\r\n            colorOptions.destroy();\r\n        };\r\n        result.getInput = function (): TFilterCropExtendInput {\r\n            result.destroy();\r\n            return {\r\n                left: left,\r\n                right: right,\r\n                top: top,\r\n                bottom: bottom,\r\n                fillColor: selectedRgbaObj.a === 0 ? undefined : selectedRgbaObj,\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterCropExtendInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (\r\n            !klCanvas ||\r\n            !history ||\r\n            isNaN(params.input.left) ||\r\n            isNaN(params.input.right) ||\r\n            isNaN(params.input.top) ||\r\n            isNaN(params.input.bottom)\r\n        ) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.resizeCanvas(params.input);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'cropExtend'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: BB.copyObj(params.input),\r\n            }],\r\n        } as TFilterCropExtendHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {CurvesInput, getDefaultCurvesInput, TCurvesInput} from './filter-curves/curves-input';\r\nimport {Options} from '../ui/components/options';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterCurvesInput = {\r\n    curves: TCurvesInput;\r\n};\r\n\r\nexport type TFilterCurvesHistoryEntry = TFilterHistoryEntry<\r\n    'curves',\r\n    TFilterCurvesInput>;\r\n\r\nexport const filterCurves = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        const div = BB.el();\r\n        const result: IFilterGetDialogResult<TFilterCurvesInput> = {\r\n            element: div,\r\n        };\r\n        let klCanvasPreview: KlCanvasPreview;\r\n\r\n        function finishInit (): void {\r\n\r\n            div.innerHTML = LANG('filter-curves-description') + '<br/><br/>';\r\n\r\n            let curves: TCurvesInput = getDefaultCurvesInput();\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            function update (): void {\r\n                try {\r\n                    fxCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n                    if (klCanvasPreview) {\r\n                        klCanvasPreview.render();\r\n                    }\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            const input = new CurvesInput({\r\n                curves,\r\n                callback: function (val) {\r\n                    curves = val;\r\n                    update();\r\n                },\r\n            });\r\n            const modeButtons: Options<string> = input.getModeButtons();\r\n\r\n\r\n            div.append(input.getElement());\r\n\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            result.destroy = (): void => {\r\n                input.destroy();\r\n                texture.destroy();\r\n                modeButtons.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterCurvesInput {\r\n                result.destroy();\r\n                return {\r\n                    curves: curves,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterCurvesInput>): boolean {\r\n        const context = params.context;\r\n        const curves = params.input.curves;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'curves'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterCurvesHistoryEntry);\r\n\r\n        return true;\r\n    },\r\n\r\n\r\n};","import {Options} from '../../ui/components/options';\r\nimport {LANG} from '../../../language/language';\r\nimport {BB} from '../../../bb/bb';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\ntype TCurvePoint = {\r\n    el: HTMLElement;\r\n    pointerListener: PointerListener;\r\n    setPos: (newX: number, newY: number) => void;\r\n};\r\n\r\nexport type TCurvesInput = {\r\n    r: [number, number][];\r\n    g: [number, number][];\r\n    b: [number, number][];\r\n}\r\n\r\nexport function getDefaultCurvesInput (): TCurvesInput {\r\n    return BB.copyObj({\r\n        r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n        g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n        b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n    });\r\n}\r\n\r\nexport class CurvesInput {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly p0: TCurvePoint;\r\n    private readonly p1: TCurvePoint;\r\n    private readonly p2: TCurvePoint;\r\n    private readonly p3: TCurvePoint;\r\n    private readonly modeButtons: Options<string>;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            curves: TCurvesInput;\r\n            callback: (val: TCurvesInput) => void;\r\n        },\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = () => false;\r\n        let mode = 'All';\r\n        let curves = p.curves;\r\n        this.modeButtons = new Options( {\r\n            optionArr: [\r\n                {\r\n                    id: 'All',\r\n                    label: LANG('filter-curves-all'),\r\n                },\r\n                {\r\n                    id: 'Red',\r\n                    label: LANG('red'),\r\n                },\r\n                {\r\n                    id: 'Green',\r\n                    label: LANG('green'),\r\n                },\r\n                {\r\n                    id: 'Blue',\r\n                    label: LANG('blue'),\r\n                },\r\n            ],\r\n            initId: 'All',\r\n            onChange: (id) => {\r\n                mode = id;\r\n                if (mode === 'All') {\r\n                    curves = getDefaultCurvesInput();\r\n                }\r\n                let curve = curves.r;\r\n                if (mode === 'Green') {\r\n                    curve = curves.g;\r\n                }\r\n                if (mode === 'Blue') {\r\n                    curve = curves.b;\r\n                }\r\n                this.p0.setPos(0, areaH - curve[0][1] * areaH);\r\n                this.p1.setPos(curve[1][0] * areaW, areaH - curve[1][1] * areaH);\r\n                this.p2.setPos(curve[2][0] * areaW, areaH - curve[2][1] * areaH);\r\n                this.p3.setPos(areaW, areaH - curve[3][1] * areaH);\r\n\r\n                update();\r\n            },\r\n        });\r\n        this.rootEl.append(this.modeButtons.getElement());\r\n\r\n        const curveArea = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-curves-graph',\r\n            css: {\r\n                position: 'relative',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const areaW = 300, areaH = 100;\r\n        const canvas = BB.canvas(areaW, areaH);\r\n        let ctx = BB.ctx(canvas);\r\n        curveArea.append(canvas);\r\n\r\n        const fit = (v: number): number => {\r\n            return Math.max(0, Math.min(1, v));\r\n        };\r\n\r\n        const createPoint = (\r\n            x: number,\r\n            y: number,\r\n            callback: (p: IVector2D) => void,\r\n            lock?: boolean,\r\n        ): TCurvePoint => {\r\n            const gripSize = 14;\r\n            let internalY = y, internalX = x;\r\n            const pointEl = BB.el({\r\n                className: 'kl-curves-graph__grip',\r\n                css: {\r\n                    left: (x - gripSize / 2) + 'px',\r\n                    top: (y - gripSize / 2) + 'px',\r\n                    width: gripSize + 'px',\r\n                    height: gripSize + 'px',\r\n                    borderRadius: gripSize + 'px',\r\n                },\r\n            });\r\n\r\n            const update = () => {\r\n                BB.css(pointEl, {\r\n                    left: (x - gripSize / 2) + 'px',\r\n                    top: (y - gripSize / 2) + 'px',\r\n                });\r\n            };\r\n\r\n            const pointerListener = new BB.PointerListener({\r\n                target: pointEl,\r\n                onPointer: (event) => {\r\n                    event.eventPreventDefault();\r\n                    if (event.type === 'pointerdown') {\r\n                        internalX = x;\r\n                        internalY = y;\r\n                    }\r\n                    if (event.button === 'left' && event.type === 'pointermove') {\r\n                        if (!lock) {\r\n                            internalX += event.dX;\r\n                        }\r\n                        x = Math.max(0, Math.min(areaW, internalX));\r\n                        internalY += event.dY;\r\n                        y = Math.max(0, Math.min(areaH, internalY));\r\n                        update();\r\n                        callback({\r\n                            x: x,\r\n                            y: y,\r\n                        });\r\n                    }\r\n                },\r\n            });\r\n\r\n            curveArea.append(pointEl);\r\n\r\n            const setPos = (newX: number, newY: number): void => {\r\n                x = newX;\r\n                y = newY;\r\n                internalY = y;\r\n                internalX = x;\r\n                BB.css(pointEl, {\r\n                    left: (x - gripSize / 2) + 'px',\r\n                    top: (y - gripSize / 2) + 'px',\r\n                });\r\n            };\r\n\r\n            return {\r\n                el: pointEl,\r\n                setPos,\r\n                pointerListener,\r\n            };\r\n        };\r\n\r\n        const updateControl = (i: number, x: number, y: number) => {\r\n            if (mode === 'All') {\r\n                curves.r[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n                curves.g[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n                curves.b[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n            if (mode === 'Red') {\r\n                curves.r[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n            if (mode === 'Green') {\r\n                curves.g[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n            if (mode === 'Blue') {\r\n                curves.b[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n        };\r\n\r\n        this.p0 = createPoint(0, areaH, (val: IVector2D) => {\r\n            updateControl(0, val.x, val.y);\r\n            update();\r\n        }, true);\r\n        this.p1 = createPoint(areaW / 3, areaH / 3 * 2, (val: IVector2D) => {\r\n            updateControl(1, val.x, val.y);\r\n            update();\r\n        });\r\n        this.p2 = createPoint(areaW / 3 * 2, areaH / 3, (val: IVector2D) => {\r\n            updateControl(2, val.x, val.y);\r\n            update();\r\n        });\r\n        this.p3 = createPoint(areaW, 0, (val: IVector2D) => {\r\n            updateControl(3, val.x, val.y);\r\n            update();\r\n        }, true);\r\n\r\n\r\n        const update = () => {\r\n            ctx = BB.ctx(canvas);\r\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n            const outCurves: TCurvesInput = {\r\n                r: [],\r\n                g: [],\r\n                b: [],\r\n            };\r\n            for (let i = 0; i < curves.r.length; i++) {\r\n                outCurves.r.push(curves.r[i]);\r\n                outCurves.g.push(curves.g[i]);\r\n                outCurves.b.push(curves.b[i]);\r\n            }\r\n\r\n            const drawCurve = (curve: [number, number][]) => {\r\n                ctx.beginPath();\r\n                const spline = new BB.SplineInterpolator(curve);\r\n                for (let i = 0; i < 100; i++) {\r\n                    let y = spline.interpolate(i / 100);\r\n                    y = Math.max(0, Math.min(1, y));\r\n\r\n                    if (i === 0) {\r\n                        ctx.moveTo(i / 100 * areaW, areaH - y * areaH);\r\n                    } else {\r\n                        ctx.lineTo(i / 100 * areaW, areaH - y * areaH);\r\n                    }\r\n                }\r\n                ctx.stroke();\r\n            };\r\n\r\n            ctx.save();\r\n            if (mode === 'All') {\r\n                ctx.strokeStyle = 'black';\r\n                drawCurve(outCurves.r);\r\n            } else {\r\n                ctx.globalAlpha = 0.5;\r\n                ctx.strokeStyle = 'red';\r\n                drawCurve(outCurves.r);\r\n                ctx.strokeStyle = 'green';\r\n                drawCurve(outCurves.g);\r\n                ctx.strokeStyle = 'blue';\r\n                drawCurve(outCurves.b);\r\n            }\r\n            ctx.restore();\r\n            p.callback(outCurves);\r\n        };\r\n\r\n        update();\r\n    }\r\n\r\n    // ---- interface ----\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.p0.pointerListener.destroy();\r\n        this.p1.pointerListener.destroy();\r\n        this.p2.pointerListener.destroy();\r\n        this.p3.pointerListener.destroy();\r\n    }\r\n\r\n    getModeButtons (): Options<string> {\r\n        return this.modeButtons;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {throwIfNull} from '../../bb/base/base';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {Options} from '../ui/components/options';\r\n\r\nexport type TFilterFlipInput = {\r\n    horizontal: boolean;\r\n    vertical: boolean;\r\n    flipCanvas: boolean;\r\n};\r\n\r\nexport type TFilterFlipHistoryEntry = TFilterHistoryEntry<\r\n    'flip',\r\n    TFilterFlipInput>;\r\n\r\nexport const filterFlip = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterFlipInput> = {\r\n            element: div,\r\n        };\r\n        let isHorizontal = true;\r\n        let isVertical = false;\r\n        let doFlipCanvas = true;\r\n        div.innerHTML = LANG('filter-flip-description') + '<br/><br/>';\r\n\r\n\r\n        const horizontalCheckbox = new Checkbox({\r\n            init: isHorizontal,\r\n            label: LANG('filter-flip-horizontal') + ' ',\r\n            allowTab: true,\r\n            callback: function (v) {\r\n                isHorizontal = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        const verticalCheckbox = new Checkbox({\r\n            init: isVertical,\r\n            label: LANG('filter-flip-vertical') + ' ',\r\n            allowTab: true,\r\n            callback: function (v) {\r\n                isVertical = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        div.append(horizontalCheckbox.getElement());\r\n        div.append(verticalCheckbox.getElement());\r\n\r\n        const targetOptions = new Options<boolean>({\r\n            optionArr: [\r\n                {\r\n                    id: true,\r\n                    label: LANG('filter-flip-image'),\r\n                },\r\n                {\r\n                    id: false,\r\n                    label: LANG('filter-flip-layer'),\r\n                },\r\n            ],\r\n            onChange: (val) => {\r\n                doFlipCanvas = val;\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        div.append(targetOptions.getElement());\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(Math.round(w), Math.round(h)),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over' as TMixMode,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: [previewLayer],\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\r\n\r\n            if (doFlipCanvas) {\r\n                if (isHorizontal) {\r\n                    ctx.translate(previewLayer.image.width, 0);\r\n                    ctx.scale(-1, 1);\r\n                }\r\n                if (isVertical) {\r\n                    ctx.translate(0, previewLayer.image.height);\r\n                    ctx.scale(1, -1);\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < layers.length; i++) {\r\n                ctx.save();\r\n                if (!doFlipCanvas && selectedLayerIndex === i) {\r\n                    if (isHorizontal) {\r\n                        ctx.translate(previewLayer.image.width, 0);\r\n                        ctx.scale(-1, 1);\r\n                    }\r\n                    if (isVertical) {\r\n                        ctx.translate(0, previewLayer.image.height);\r\n                        ctx.scale(1, -1);\r\n                    }\r\n                }\r\n                if (ctx.canvas.width > layers[i].context.canvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.globalAlpha = layers[i].opacity;\r\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\r\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\r\n                ctx.restore();\r\n            }\r\n            klCanvasPreview.render();\r\n            ctx.restore();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            horizontalCheckbox.destroy();\r\n            verticalCheckbox.destroy();\r\n            targetOptions.destroy();\r\n            klCanvasPreview.destroy();\r\n        };\r\n        result.getInput = function (): TFilterFlipInput {\r\n            result.destroy();\r\n            return {\r\n                horizontal: isHorizontal,\r\n                vertical: isVertical,\r\n                flipCanvas: doFlipCanvas,\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterFlipInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        const horizontal = params.input.horizontal;\r\n        const vertical = params.input.vertical;\r\n        const flipCanvas = params.input.flipCanvas;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        klCanvas.flip(\r\n            horizontal,\r\n            vertical,\r\n            flipCanvas ? undefined : throwIfNull(klCanvas.getLayerIndex(context.canvas)),\r\n        );\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['filter', 'flip'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterFlipHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterHueSaturationInput = {\r\n    hue: number;\r\n    saturation: number;\r\n};\r\n\r\nexport type TFilterHueSaturationHistoryEntry = TFilterHistoryEntry<\r\n    'hueSaturation',\r\n    TFilterHueSaturationInput>;\r\n\r\nexport const filterHueSaturation = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height,280, 200,  1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterHueSaturationInput> = {\r\n            element: div,\r\n        };\r\n\r\n        function finishInit (): void {\r\n            let hue = 0, saturation = 0;\r\n            div.innerHTML = LANG('filter-hue-sat-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const hueSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-hue'),\r\n                width: 300,\r\n                height: 30,\r\n                min: -100,\r\n                max: 100,\r\n                value: hue * 100,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    hue = val / 100;\r\n                    fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            const saturationSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-saturation'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (saturation + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    saturation = val / 50 - 1;\r\n                    fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            hueSlider.getElement().style.marginBottom = '10px';\r\n            div.append(hueSlider.getElement(), saturationSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = (): void => {\r\n                hueSlider.destroy();\r\n                saturationSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterHueSaturationInput {\r\n                result.destroy();\r\n                return {\r\n                    hue: hue,\r\n                    saturation: saturation,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterHueSaturationInput>): boolean {\r\n        const context = params.context;\r\n        const hue = params.input.hue;\r\n        const history = params.history;\r\n        const saturation = params.input.saturation;\r\n        if (!context || hue === null || saturation === null || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'hueSaturation'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterHueSaturationHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply} from '../kl-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterInvertInput = null;\r\n\r\nexport type TFilterInvertHistoryEntry = TFilterHistoryEntry<\r\n    'invert',\r\n    TFilterInvertInput>;\r\n\r\nexport const filterInvert = {\r\n\r\n    apply (params: IFilterApply<TFilterInvertInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false;\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).invert().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'invert'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterInvertHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TwoTabs} from '../ui/components/two-tabs';\r\nimport {TRectanglePoints} from '../../fx-canvas/filters/perspective';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterPerspectiveInput = {\r\n    before: TRectanglePoints;\r\n    after: TRectanglePoints;\r\n};\r\n\r\nexport type TFilterPerspectiveHistoryEntry = TFilterHistoryEntry<\r\n    'perspective',\r\n    TFilterPerspectiveInput>;\r\n\r\nexport const filterPerspective = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterPerspectiveInput> = {\r\n            element: div,\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n\r\n        const pointerListenerArr = [];\r\n\r\n        function finishInit (): void {\r\n            div.innerHTML = LANG('filter-perspective-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n            let ba, bb, bc, bd; //before\r\n            let aa, ab, ac, ad; //after\r\n            function update (): void {\r\n                try {\r\n                    fxCanvas.draw(texture).multiplyAlpha().perspective(\r\n                        [ba.x, ba.y, bb.x, bb.y, bc.x, bc.y, bd.x, bd.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        }),\r\n                        [aa.x, aa.y, ab.x, ab.y, ac.x, ac.y, ad.x, ad.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        })\r\n                    ).unmultiplyAlpha().update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob (x, y, callback?) {\r\n                const nobSize = 14;\r\n                const div = document.createElement('div');\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                BB.css(div, {\r\n                    width: nobSize + 'px',\r\n                    height: nobSize + 'px',\r\n                    backgroundColor: '#fff',\r\n                    boxShadow: 'inset 0 0 0 2px #000',\r\n                    borderRadius: nobSize + 'px',\r\n                    position: 'absolute',\r\n                    cursor: 'move',\r\n                    left: ((div as any).x - nobSize / 2) + 'px',\r\n                    top: ((div as any).y - nobSize / 2) + 'px',\r\n                    userSelect: 'none',\r\n                    touchAction: 'none',\r\n                });\r\n\r\n                const pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    onPointer: function (event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + 'px';\r\n                            div.style.top = ((div as any).y - nobSize / 2) + 'px';\r\n                            if (callback) {\r\n                                callback();\r\n                            }\r\n                            update();\r\n                        }\r\n                    },\r\n                });\r\n                (div as any).copy = function (p) {\r\n                    (div as any).x = p.x;\r\n                    (div as any).y = p.y;\r\n                    div.style.left = ((div as any).x - nobSize / 2) + 'px';\r\n                    div.style.top = ((div as any).y - nobSize / 2) + 'px';\r\n                };\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            function updateAfter () {\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            }\r\n\r\n            ba = nob(0, 0, updateAfter);\r\n            bb = nob(displayW, 0, updateAfter);\r\n            bc = nob(displayW, displayH, updateAfter);\r\n            bd = nob(0, displayH, updateAfter);\r\n            aa = nob(0, 0);\r\n            ab = nob(displayW, 0);\r\n            ac = nob(displayW, displayH);\r\n            ad = nob(0, displayH);\r\n\r\n            let before = false;\r\n\r\n            const beforeAfterTabs = new TwoTabs({\r\n                left: LANG('compare-before'),\r\n                right: LANG('compare-after'),\r\n                init: 1,\r\n                onChange: (val: number) => {\r\n                    before = val === 0;\r\n                    if (before) {\r\n                        aa.style.display = 'none';\r\n                        ab.style.display = 'none';\r\n                        ac.style.display = 'none';\r\n                        ad.style.display = 'none';\r\n\r\n                        ba.style.display = 'block';\r\n                        bb.style.display = 'block';\r\n                        bc.style.display = 'block';\r\n                        bd.style.display = 'block';\r\n                        ba.copy(aa);\r\n                        bb.copy(ab);\r\n                        bc.copy(ac);\r\n                        bd.copy(ad);\r\n                    } else {\r\n                        ba.style.display = 'none';\r\n                        bb.style.display = 'none';\r\n                        bc.style.display = 'none';\r\n                        bd.style.display = 'none';\r\n\r\n                        aa.style.display = 'block';\r\n                        ab.style.display = 'block';\r\n                        ac.style.display = 'block';\r\n                        ad.style.display = 'block';\r\n                        aa.copy(ba);\r\n                        ab.copy(bb);\r\n                        ac.copy(bc);\r\n                        ad.copy(bd);\r\n                    }\r\n                    update();\r\n                },\r\n            });\r\n            div.append(beforeAfterTabs.getElement());\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: isSmall ? '340px' : '540px',\r\n                    height: isSmall ? '260px' : '300px',\r\n                    marginTop: '0',\r\n                },\r\n            });\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    const canvas = i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas;\r\n                    previewLayerArr.push({\r\n                        image: canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.append(aa, ab, ac, ad);\r\n\r\n            ba.style.display = 'none';\r\n            bb.style.display = 'none';\r\n            bc.style.display = 'none';\r\n            bd.style.display = 'none';\r\n            previewInnerWrapper.append(ba, bb, bc, bd);\r\n\r\n\r\n            div.append(previewWrapper);\r\n            update();\r\n            result.destroy = (): void => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterPerspectiveInput {\r\n                result.destroy();\r\n                return {\r\n                    before: [\r\n                        ba.x / displayPreviewFactor,\r\n                        ba.y / displayPreviewFactor,\r\n\r\n                        bb.x / displayPreviewFactor,\r\n                        bb.y / displayPreviewFactor,\r\n\r\n                        bc.x / displayPreviewFactor,\r\n                        bc.y / displayPreviewFactor,\r\n\r\n                        bd.x / displayPreviewFactor,\r\n                        bd.y / displayPreviewFactor,\r\n                    ],\r\n                    after: [\r\n                        aa.x / displayPreviewFactor,\r\n                        aa.y / displayPreviewFactor,\r\n\r\n                        ab.x / displayPreviewFactor,\r\n                        ab.y / displayPreviewFactor,\r\n\r\n                        ac.x / displayPreviewFactor,\r\n                        ac.y / displayPreviewFactor,\r\n\r\n                        ad.x / displayPreviewFactor,\r\n                        ad.y / displayPreviewFactor,\r\n                    ],\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterPerspectiveInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const before = params.input.before;\r\n        const after = params.input.after;\r\n        if (!context || !before || !after || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).multiplyAlpha().perspective(before, after).unmultiplyAlpha().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'perspective'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterPerspectiveHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Two buttons next to each other, each representing a tab. one at a time can be active.\r\n */\r\nexport class TwoTabs {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly leftTab: HTMLElement;\r\n    private readonly rightTab: HTMLElement;\r\n    private value: number;\r\n\r\n    private update (): void {\r\n        this.leftTab.classList.toggle('kl-2-tabs--active', this.value === 0);\r\n        this.rightTab.classList.toggle('kl-2-tabs--active', this.value === 1);\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (params: {\r\n        left: string;\r\n        right: string;\r\n        init: number; //0, 1\r\n        onChange: (val: number) => void;\r\n    }) {\r\n        this.value = params.init;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-2-tabs',\r\n        });\r\n\r\n        this.leftTab = BB.el({\r\n            parent: this.rootEl,\r\n            content: params.left,\r\n            className: 'kl-2-tabs__left',\r\n        });\r\n        this.leftTab.onpointerdown = () => false;\r\n\r\n        this.rightTab = BB.el({\r\n            parent: this.rootEl,\r\n            content: params.right,\r\n            className: 'kl-2-tabs__right',\r\n        });\r\n        this.rightTab.onpointerdown = () => false;\r\n\r\n        this.update();\r\n\r\n        this.leftTab.onclick = () => {\r\n            if (this.value === 0) {\r\n                return;\r\n            }\r\n            this.value = 0;\r\n            this.update();\r\n            params.onChange(this.value);\r\n        };\r\n\r\n        this.rightTab.onclick = () => {\r\n            if (this.value === 1) {\r\n                return;\r\n            }\r\n            this.value = 1;\r\n            this.update();\r\n            params.onChange(this.value);\r\n        };\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {Select} from '../ui/components/select';\r\nimport constrainImg from '/src/app/img/ui/constrain.svg';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {table} from '../ui/components/table';\r\nimport {theme} from '../../theme/theme';\r\n\r\nexport type TFilterResizeInput = {\r\n    width: number;\r\n    height: number;\r\n    algorithm: 'smooth' | 'pixelated';\r\n};\r\n\r\nexport type TFilterResizeHistoryEntry = TFilterHistoryEntry<\r\n    'resize',\r\n    TFilterResizeInput>;\r\n\r\nexport const filterResize = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        //BB.centerWithin\r\n        const klCanvas = params.klCanvas;\r\n        if (!klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const fit = BB.fitInto( klCanvas.getWidth(), klCanvas.getHeight(), 280, 200,1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let previewFactor = w / klCanvas.getWidth();\r\n        const tempCanvas = klCanvas.getCompleteCanvas(1);\r\n\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterResizeInput> = {\r\n            element: div,\r\n        };\r\n        let newWidth = klCanvas.getWidth(), newHeight = klCanvas.getHeight();\r\n\r\n        div.innerHTML = LANG('filter-resize-description') + '<br/><br/>';\r\n\r\n\r\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n\r\n        const widthWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            },\r\n        });\r\n        const heightWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            },\r\n        });\r\n        const widthInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxWidth,\r\n                value: '' + klCanvas.getWidth(),\r\n            },\r\n        }) as HTMLInputElement;\r\n        const heightInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxHeight,\r\n                value: '' + klCanvas.getHeight(),\r\n            },\r\n        }) as HTMLInputElement;\r\n        widthInput.onclick = function () {\r\n            (this as any).focus();\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onclick = function () {\r\n            (this as any).focus();\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthInput.onchange = function () {\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onchange = function () {\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthWrapper.append(LANG('width') + ': ', widthInput);\r\n        heightWrapper.append(LANG('height') + ': ', heightInput);\r\n        const inputWrapper = BB.el({\r\n            css: {\r\n                background: 'url(' + constrainImg + ') no-repeat 140px 5px',\r\n                backgroundSize: '50px 52px',\r\n            },\r\n        });\r\n        inputWrapper.append(widthWrapper, heightWrapper);\r\n        const constrainIm = new Image();\r\n        constrainIm.src = constrainImg;\r\n        constrainIm.height = 40;\r\n\r\n        const sizeTable = table([\r\n            [\r\n                LANG('width') + ':&nbsp;',\r\n                widthInput,\r\n                constrainIm,\r\n            ],\r\n            [\r\n                BB.el({css: {height: '5px'}}),\r\n                '',\r\n                '',\r\n            ],\r\n            [\r\n                LANG('height') + ':&nbsp;',\r\n                heightInput,\r\n            ],\r\n        ], {\r\n            '0.2': {rowspan: 3},\r\n        });\r\n        BB.css(sizeTable, {\r\n            marginBottom: '10px',\r\n        });\r\n\r\n        div.append(sizeTable);\r\n\r\n        //contrain checkbox\r\n        let heightChanged = false, widthChanged = false;\r\n        const ratio = klCanvas.getWidth() / klCanvas.getHeight();\r\n\r\n        function updateConstrain (): void {\r\n            constrainIm.style.display = isConstrained ? '' : 'none';\r\n            if (isConstrained) {\r\n                widthInput.value = '' + klCanvas.getWidth();\r\n                heightInput.value = '' + klCanvas.getHeight();\r\n                update();\r\n            }\r\n        }\r\n\r\n        let isConstrained = true;\r\n        const constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                isConstrained = b;\r\n                updateConstrain();\r\n            },\r\n        });\r\n        div.append(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n            },\r\n        }));\r\n\r\n\r\n        const algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')],\r\n            ],\r\n            title: LANG('scaling-algorithm'),\r\n            initValue: 'smooth',\r\n            onChange: function () {\r\n                update();\r\n            },\r\n        });\r\n\r\n        const secondRowElement = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                'alignItems': 'center',\r\n            },\r\n        });\r\n        secondRowElement.append(constrainCheckbox.getElement(), algorithmSelect.getElement());\r\n\r\n        const previewCanvas = BB.canvas(w, h);\r\n        previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n\r\n        const previewCtx = BB.ctx(previewCanvas);\r\n\r\n\r\n        function draw (): void {\r\n            if (algorithmSelect.getValue() === 'smooth') {\r\n                previewCanvas.style.imageRendering = previewFactor > 1 ? 'pixelated' : '';\r\n\r\n                previewCanvas.width = klCanvas.getWidth();\r\n                previewCanvas.height = klCanvas.getHeight();\r\n\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingQuality = 'high';\r\n                previewCtx.drawImage(tempCanvas, 0, 0);\r\n                BB.resizeCanvas(previewCanvas, newWidth, newHeight);\r\n                previewCtx.restore();\r\n\r\n            } else {\r\n                previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n                previewCanvas.width = newWidth;\r\n                previewCanvas.height = newHeight;\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingEnabled = false;\r\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\r\n                previewCtx.restore();\r\n            }\r\n\r\n        }\r\n\r\n        function update (): void {\r\n            if ((widthInput.value.length === 0 && widthChanged) || (heightInput.value.length === 0 && heightChanged)) {\r\n                heightChanged = false;\r\n                widthChanged = false;\r\n                return;\r\n            }\r\n            widthInput.value = '' + Math.max(1, parseInt(widthInput.value));\r\n            heightInput.value = '' + Math.max(1, parseInt(heightInput.value));\r\n            if (isConstrained) {\r\n                if (heightChanged) {\r\n                    widthInput.value = '' + parseInt('' + (parseInt(heightInput.value) * ratio));\r\n                }\r\n                if (widthChanged) {\r\n                    heightInput.value = '' + parseInt('' + (parseInt(widthInput.value) / ratio));\r\n                }\r\n\r\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\r\n                    const fit = BB.fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\r\n                    widthInput.value = '' + parseInt('' + fit.width);\r\n                    heightInput.value = '' + parseInt('' + fit.height);\r\n                }\r\n            }\r\n\r\n            if (parseInt(widthInput.value) > maxWidth) {\r\n                widthInput.value = '' + maxWidth;\r\n            }\r\n            if (parseInt(heightInput.value) > maxHeight) {\r\n                heightInput.value = '' + maxHeight;\r\n            }\r\n\r\n            heightChanged = false;\r\n            widthChanged = false;\r\n\r\n            newWidth = parseInt(widthInput.value);\r\n            newHeight = parseInt(heightInput.value);\r\n\r\n            const preview = BB.fitInto(newWidth, newHeight, 280, 200, 1);\r\n            const previewW = parseInt('' + preview.width), previewH = parseInt('' + preview.height);\r\n            previewFactor = previewW / newWidth;\r\n\r\n            const offset = BB.centerWithin(340, 220, previewW, previewH);\r\n\r\n            draw();\r\n\r\n            previewCanvas.style.width = Math.max(1, previewW) + 'px';\r\n            previewCanvas.style.height = Math.max(1, previewH) + 'px';\r\n            canvasWrapper.style.left = offset.x + 'px';\r\n            canvasWrapper.style.top = offset.y + 'px';\r\n            canvasWrapper.style.width = Math.max(1, previewW) + 'px';\r\n            canvasWrapper.style.height = Math.max(1, previewH) + 'px';\r\n        }\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-transparent-preview',\r\n            css: {\r\n                width: '340px',\r\n                marginLeft: '-20px',\r\n                height: '220px',\r\n                display: 'table',\r\n                marginTop: '10px',\r\n                position: 'relative',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n\r\n        const canvasWrapper = BB.el({\r\n            parent: previewWrapper,\r\n            content: previewCanvas,\r\n            className: 'kl-transparent-preview__canvas',\r\n            css: {\r\n                width: w + 'px',\r\n                height: h + 'px',\r\n                position: 'absolute',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n        function updateCheckerboard (): void {\r\n            BB.createCheckerDataUrl(8, function (url) {\r\n                previewWrapper.style.background = 'url(' + url + ')';\r\n            }, theme.isDark());\r\n        }\r\n        theme.addIsDarkListener(updateCheckerboard);\r\n        updateCheckerboard();\r\n\r\n\r\n        div.append(previewWrapper);\r\n        update();\r\n\r\n        result.destroy = (): void => {\r\n            constrainCheckbox.destroy();\r\n            theme.removeIsDarkListener(updateCheckerboard);\r\n        };\r\n        result.getInput = function (): TFilterResizeInput {\r\n            result.destroy();\r\n            return {\r\n                width: newWidth,\r\n                height: newHeight,\r\n                algorithm: algorithmSelect.getValue(),\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterResizeInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        const width = params.input.width;\r\n        const height = params.input.height;\r\n        const algorithm = params.input.algorithm;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.resize(width, height, algorithm);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'resize'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterResizeHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"c92cL\");","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {theme} from '../../theme/theme';\r\n\r\nexport type TFilterRotateInput = {\r\n    deg: number;\r\n}\r\n\r\nexport type TFilterRotateHistoryEntry = TFilterHistoryEntry<\r\n    'rotate',\r\n    TFilterRotateInput>;\r\n\r\nexport const filterRotate = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const klCanvas = params.klCanvas;\r\n        if (!klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const previewFactor = w / klCanvas.getWidth();\r\n        const tempCanvas = BB.canvas(w, h);\r\n        tempCanvas.style.display = 'block';\r\n        BB.ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterRotateInput> = {\r\n            element: div,\r\n        };\r\n        let deg = 0;\r\n        div.innerHTML = LANG('filter-rotate-description') + '<br/><br/>';\r\n\r\n        const first = true;\r\n\r\n        function update (): void {\r\n            (canvasWrapper.style as any).WebkitTransform = 'rotate(' + deg + 'deg)';\r\n            (canvasWrapper.style as any).MozTransform = 'rotate(' + deg + 'deg)';\r\n            (canvasWrapper.style as any).OTransform = 'rotate(' + deg + 'deg)';\r\n            (canvasWrapper.style as any).msTransform = 'rotate(' + deg + 'deg)';\r\n            if (Math.abs(deg % 180) === 90) {\r\n                //height has to fit width because of rotation\r\n                const fit = BB.fitInto(h, w, 280, 200, 1);\r\n                const scale = parseInt('' + fit.height) / w;\r\n                (canvasWrapper.style as any).WebkitTransform = 'rotate(' + deg + 'deg) scale(' + scale + ')';\r\n                (canvasWrapper.style as any).MozTransform = 'rotate(' + deg + 'deg) scale(' + scale + ')';\r\n                (canvasWrapper.style as any).OTransform = 'rotate(' + deg + 'deg) scale(' + scale + ')';\r\n                (canvasWrapper.style as any).msTransform = 'rotate(' + deg + 'deg) scale(' + scale + ')';\r\n            }\r\n        }\r\n\r\n        const btnPlus = document.createElement('button');\r\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        const btnMinus = document.createElement('button');\r\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        btnMinus.style.marginRight = '5px';\r\n\r\n\r\n        btnPlus.onclick = function () {\r\n            deg += 90;\r\n            update();\r\n        };\r\n        btnMinus.onclick = function () {\r\n            deg -= 90;\r\n            update();\r\n        };\r\n\r\n        div.append(btnMinus, btnPlus);\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n                display: 'table',\r\n            },\r\n        });\r\n\r\n        const previewcell = BB.el({\r\n            parent: previewWrapper,\r\n            css: {\r\n                display: 'table-cell',\r\n                verticalAlign: 'middle',\r\n            },\r\n        });\r\n        const canvasWrapper = BB.el({\r\n            parent: previewcell,\r\n            content: tempCanvas,\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: w + 'px',\r\n                height: h + 'px',\r\n                marginLeft: 'auto',\r\n                marginRight: 'auto',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n\r\n        function updateCheckerboard (): void {\r\n            BB.createCheckerDataUrl(8, function (url) {\r\n                canvasWrapper.style.background = 'url(' + url + ')';\r\n            }, theme.isDark());\r\n        }\r\n        theme.addIsDarkListener(updateCheckerboard);\r\n        updateCheckerboard();\r\n\r\n        canvasWrapper.style.transition = 'all 0.2s ease-out';\r\n\r\n        div.append(previewWrapper);\r\n        update();\r\n\r\n        result.destroy = (): void => {\r\n            theme.removeIsDarkListener(updateCheckerboard);\r\n        };\r\n        result.getInput = function (): TFilterRotateInput {\r\n            result.destroy();\r\n            return {\r\n                deg: deg,\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterRotateInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.rotate(params.input.deg);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'rotate'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterRotateHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterTiltShiftInput = {\r\n    a: IVector2D;\r\n    b: IVector2D;\r\n    blur: number;\r\n    gradient: number;\r\n};\r\n\r\nexport type TFilterTiltShiftHistoryEntry = TFilterHistoryEntry<\r\n    'tiltShift',\r\n    TFilterTiltShiftInput>;\r\n\r\nexport const filterTiltShift = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const previewFactor = w / context.canvas.width;\r\n        const displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterTiltShiftInput> = {\r\n            element: div,\r\n        };\r\n\r\n        const pointerListenerArr = [];\r\n\r\n        function finishInit () {\r\n            let blur = 20, gradient = 200;\r\n            div.innerHTML = LANG('filter-tilt-shift-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n            let fa, fb; // focus line\r\n            function update () {\r\n                try {\r\n                    fxCanvas.draw(texture).tiltShift(\r\n                        fa.x / displayPreviewFactor * previewFactor,\r\n                        fa.y / displayPreviewFactor * previewFactor,\r\n                        fb.x / displayPreviewFactor * previewFactor,\r\n                        fb.y / displayPreviewFactor * previewFactor,\r\n                        blur * previewFactor,\r\n                        gradient * previewFactor\r\n                    ).update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob (x, y) {\r\n                const nobSize = 14;\r\n                const div = BB.el({\r\n                    css: {\r\n                        width: nobSize + 'px',\r\n                        height: nobSize + 'px',\r\n                        backgroundColor: '#fff',\r\n                        boxShadow: 'inset 0 0 0 2px #000',\r\n                        borderRadius: nobSize + 'px',\r\n                        position: 'absolute',\r\n                        cursor: 'move',\r\n                        left: (x - nobSize / 2) + 'px',\r\n                        top: (y - nobSize / 2) + 'px',\r\n                        userSelect: 'none',\r\n                        touchAction: 'none',\r\n                    },\r\n                });\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                const pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    onPointer: function (event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + 'px';\r\n                            div.style.top = ((div as any).y - nobSize / 2) + 'px';\r\n                            update();\r\n                        }\r\n                    },\r\n                });\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            fa = nob(parseInt('' + (displayW / 6)), parseInt('' + (displayH / 2)));\r\n            fb = nob(parseInt('' + (displayW - displayW / 6)), parseInt('' + (displayH - displayH / 3)));\r\n\r\n            const blurSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-blur'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                value: blur,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    blur = val;\r\n                    update();\r\n                },\r\n            });\r\n            blurSlider.getElement().style.marginBottom = '10px';\r\n            div.append(blurSlider.getElement());\r\n            const gradientSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-gradient'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1000,\r\n                value: gradient,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    gradient = val;\r\n                    update();\r\n                },\r\n            });\r\n            div.append(gradientSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.append(fa, fb);\r\n\r\n\r\n            div.append(previewWrapper);\r\n            update();\r\n            result.destroy = (): void => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                blurSlider.destroy();\r\n                gradientSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterTiltShiftInput {\r\n                result.destroy();\r\n                return {\r\n                    a: {x: fa.x / displayPreviewFactor, y: fa.y / displayPreviewFactor},\r\n                    b: {x: fb.x / displayPreviewFactor, y: fb.y / displayPreviewFactor},\r\n                    blur: blur,\r\n                    gradient: gradient,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterTiltShiftInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const a = params.input.a;\r\n        const b = params.input.b;\r\n        const blur = params.input.blur;\r\n        const gradient = params.input.gradient;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).tiltShift(a.x, a.y, b.x, b.y, blur, gradient).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'tiltShift'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterTiltShiftHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {FreeTransform} from '../ui/components/free-transform';\r\nimport {IFreeTransform} from '../ui/components/free-transform-utils';\r\nimport {Select} from '../ui/components/select';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {IRect} from '../../bb/bb-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterTransformInput = {\r\n    bounds: {x: number; y: number; width: number; height: number};\r\n    transform: IFreeTransform;\r\n    isPixelated: boolean;\r\n};\r\n\r\nexport type TFilterTransformHistoryEntry = TFilterHistoryEntry<\r\n    'transform',\r\n    TFilterTransformInput>;\r\n\r\nexport const filterTransform = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n        let freeTransform: FreeTransform;\r\n        const displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        // determine bounds and initial transformation\r\n        const boundsObj: IRect = BB.canvasBounds(context);\r\n        if (boundsObj === null) {\r\n            alert(LANG('filter-transform-empty'));\r\n            return false;\r\n        }\r\n        const initTransform = {\r\n            x: boundsObj.x + boundsObj.width / 2,\r\n            y: boundsObj.y + boundsObj.height / 2,\r\n            width: boundsObj.width,\r\n            height: boundsObj.height,\r\n            angleDeg: 0,\r\n        };\r\n\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterTransformInput> = {\r\n            element: div,\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        div.innerHTML = LANG('filter-transform-description');\r\n\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: function (keyStr) {\r\n                if (BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n\r\n                if (keyStr === 'left') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'right') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'up') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'down') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n            },\r\n\r\n        });\r\n\r\n        const leftWrapper = document.createElement('div');\r\n        const rightWrapper = document.createElement('div');\r\n        const rotWrapper = document.createElement('div');\r\n        const inputY = document.createElement('input');\r\n        const inputX = document.createElement('input');\r\n        const inputR = document.createElement('input');\r\n        leftWrapper.style.width = '100px';\r\n        leftWrapper.style.height = '30px';\r\n        rightWrapper.style.width = '100px';\r\n        rightWrapper.style.height = '30px';\r\n        rightWrapper.style.display = 'inline-block';\r\n        leftWrapper.style.display = 'inline-block';\r\n        rotWrapper.style.display = 'inline-block';\r\n        rotWrapper.style.width = '150px';\r\n        rotWrapper.style.height = '30px';\r\n        inputY.type = 'number';\r\n        inputX.type = 'number';\r\n        inputR.type = 'number';\r\n        inputX.style.width = 70 + 'px';\r\n        inputY.style.width = 70 + 'px';\r\n        inputR.style.width = 70 + 'px';\r\n        inputY.value = '0';\r\n        inputX.value = '0';\r\n        inputR.value = '0';\r\n        inputY.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputX.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputR.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputY.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputY.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        leftWrapper.append('X: ', inputX);\r\n        rightWrapper.append('Y: ', inputY);\r\n        rotWrapper.append(LANG('filter-transform-rotation') + ': ', inputR);\r\n        if (!isSmall) {\r\n            const inputRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\r\n        }\r\n\r\n        // buttons\r\n        const actionBtnCss = {\r\n            marginLeft: '10px',\r\n            marginTop: '10px',\r\n        };\r\n        const buttonRow = BB.el ({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginLeft: '-10px',\r\n            },\r\n        });\r\n        const flipXBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' X',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(-t.width, t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const flipYBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' Y',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(t.width, -t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotLeftBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '-90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg -= 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotRightBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '+90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg += 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleDoubleBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                if (constrainCheckbox.getValue()) {\r\n                    freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\r\n                } else {\r\n                    freeTransform.setSize(t.width * 2, t.height * 2);\r\n                }\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleHalfBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '1/2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const centerBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('center'),\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setPos({ x: context.canvas.width / 2, y: context.canvas.height / 2 });\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n\r\n\r\n\r\n\r\n\r\n        let isConstrained = true;\r\n        const constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-constrain'),\r\n            title: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                isConstrained = b;\r\n                freeTransform.setConstrained(isConstrained);\r\n            },\r\n            css: {\r\n                display: 'inline-block',\r\n            },\r\n        });\r\n        let isSnapping = false;\r\n        const snappingCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-snap'),\r\n            title: LANG('filter-transform-snap-title'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                isSnapping = b;\r\n                freeTransform.setSnapping(isSnapping);\r\n            },\r\n            css: {\r\n                display: 'inline-block',\r\n                marginLeft: '10px',\r\n            },\r\n        });\r\n        const checkboxWrapper = BB.el();\r\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\r\n\r\n        div.append(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n                height: '10px',\r\n            },\r\n        }));\r\n\r\n        const bottomRow = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n\r\n        const algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')],\r\n            ],\r\n            initValue: 'smooth',\r\n            title: LANG('scaling-algorithm'),\r\n            onChange: function () {\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                height: isSmall ? '260px' : '300px',\r\n            },\r\n        });\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n\r\n        const previewLayerArr: IKlBasicLayer[] = [];\r\n        {\r\n            for (let i = 0; i < layers.length; i++) {\r\n                let canvas;\r\n                if (i === selectedLayerIndex) {\r\n                    canvas = BB.canvas(parseInt('' + w), parseInt('' + h));\r\n                    const ctx = BB.ctx(canvas);\r\n                    ctx.drawImage(layers[i].context.canvas, 0, 0, canvas.width, canvas.height);\r\n                } else {\r\n                    canvas = layers[i].context.canvas;\r\n                }\r\n                previewLayerArr.push({\r\n                    image: canvas,\r\n                    opacity: layers[i].opacity,\r\n                    mixModeStr: layers[i].mixModeStr,\r\n                });\r\n            }\r\n        }\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: parseInt('' + displayW),\r\n            height: parseInt('' + displayH),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + displayW) + 'px',\r\n                height: parseInt('' + displayH) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        let lastDrawnTransformStr;\r\n        function updatePreview (doForce: boolean = false) {\r\n            if (!freeTransform) {\r\n                return;\r\n            }\r\n            const transform = freeTransform.getTransform();\r\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) {\r\n                return;\r\n            }\r\n            lastDrawnTransformStr = JSON.stringify(transform);\r\n            if (displayPreviewFactor < 1) {\r\n                transform.x *= displayPreviewFactor;\r\n                transform.y *= displayPreviewFactor;\r\n                transform.width *= displayPreviewFactor;\r\n                transform.height *= displayPreviewFactor;\r\n            }\r\n            const transformLayerCanvas = previewLayerArr[selectedLayerIndex].image as HTMLCanvasElement;\r\n            const ctx = BB.ctx(transformLayerCanvas);\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, transformLayerCanvas.width, transformLayerCanvas.height);\r\n            BB.drawTransformedImageWithBounds(\r\n                ctx,\r\n                layers[selectedLayerIndex].context.canvas,\r\n                transform,\r\n                boundsObj,\r\n                algorithmSelect.getValue() === 'pixelated' ||\r\n                BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            );\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: initTransform.angleDeg,\r\n            isConstrained: true,\r\n            snapX: [0, context.canvas.width],\r\n            snapY: [0, context.canvas.height],\r\n            callback: function (t) {\r\n                inputX.value = '' + Math.round(t.x - initTransform.x);\r\n                inputY.value = '' + Math.round(t.y - initTransform.y);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            scale: displayPreviewFactor,\r\n        });\r\n        BB.css(freeTransform.getElement(), {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n        });\r\n        previewInnerWrapper.append(freeTransform.getElement());\r\n\r\n        function onInputsChanged () {\r\n            freeTransform.setPos({\r\n                x: parseInt(inputX.value) + initTransform.x,\r\n                y: parseInt(inputY.value) + initTransform.y}\r\n            );\r\n            freeTransform.setAngleDeg(parseInt(inputR.value));\r\n            updatePreview();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            keyListener.destroy();\r\n            freeTransform.destroy();\r\n            constrainCheckbox.destroy();\r\n            snappingCheckbox.destroy();\r\n            BB.destroyEl(flipXBtn);\r\n            BB.destroyEl(flipYBtn);\r\n            BB.destroyEl(scaleRotLeftBtn);\r\n            BB.destroyEl(scaleRotRightBtn);\r\n            BB.destroyEl(scaleDoubleBtn);\r\n            BB.destroyEl(scaleHalfBtn);\r\n            BB.destroyEl(centerBtn);\r\n            klCanvasPreview.destroy();\r\n        };\r\n        result.getInput = function (): TFilterTransformInput {\r\n            const transform = freeTransform.getTransform();\r\n            const input: TFilterTransformInput = {\r\n                transform,\r\n                bounds: boundsObj,\r\n                isPixelated: algorithmSelect.getValue() === 'pixelated' ||\r\n                    BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            };\r\n            result.destroy();\r\n            return BB.copyObj(input);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterTransformInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const input = params.input;\r\n\r\n        const copyCanvas = BB.copyCanvas(context.canvas);\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            context,\r\n            copyCanvas,\r\n            input.transform,\r\n            input.bounds,\r\n            input.isPixelated,\r\n        );\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'transform'],\r\n            action: 'apply',\r\n            params: [{input}],\r\n        } as TFilterTransformHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterBlurInput = {\r\n    radius: number;\r\n}\r\n\r\nexport type TFilterBlurHistoryEntry = TFilterHistoryEntry<\r\n    'blur',\r\n    TFilterBlurInput>;\r\n\r\n\r\nexport const filterBlur = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const klCanvas = params.klCanvas;\r\n        const context = params.context;\r\n        if (!klCanvas || !context) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterBlurInput> = {\r\n            element: div,\r\n        };\r\n\r\n\r\n        function finishInit (): void {\r\n            let radius = 10;\r\n            div.innerHTML = LANG('filter-triangle-blur-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 1,\r\n                max: 200,\r\n                value: radius,\r\n                eventResMs: eventResMs,\r\n                onChange: (val): void => {\r\n                    radius = val;\r\n                    fxCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            div.append(radiusSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = (): void => {\r\n                texture.destroy();\r\n                radiusSlider.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterBlurInput {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterBlurInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const radius = params.input.radius;\r\n        if (!context || !radius || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).triangleBlur(radius).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'blur'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterBlurHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterUnsharpMaskInput = {\r\n    radius: number;\r\n    strength: number;\r\n};\r\n\r\nexport type TFilterUnsharpMaskHistoryEntry = TFilterHistoryEntry<\r\n    'unsharpMask',\r\n    TFilterUnsharpMaskInput>;\r\n\r\nexport const filterUnsharpMask = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterUnsharpMaskInput> = {\r\n            element: div,\r\n        };\r\n\r\n        function finishInit () {\r\n            let radius = 2, strength = 5.1 / 10;\r\n            div.innerHTML = LANG('filter-unsharp-mask-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                value: 2,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    radius = val;\r\n                    fxCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 50], [1, 200]],\r\n            });\r\n            const strengthSlider = new KlSlider({\r\n                label: LANG('filter-unsharp-mask-strength'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 50,\r\n                value: 5.1,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    strength = val / 10;\r\n                    fxCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 10], [1, 50]],\r\n            });\r\n            radiusSlider.getElement().style.marginBottom = '10px';\r\n            div.append(radiusSlider.getElement());\r\n            div.append(strengthSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                klCanvasPreview.render();\r\n            } catch (e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = (): void => {\r\n                radiusSlider.destroy();\r\n                strengthSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterUnsharpMaskInput {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius,\r\n                    strength: strength,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply (params: IFilterApply<TFilterUnsharpMaskInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const radius = params.input.radius;\r\n        const strength = params.input.strength;\r\n        if (!context || radius === null || strength === null || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).unsharpMask(radius, strength).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'unsharpMask'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterUnsharpMaskHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Options} from '../ui/components/options';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, IRGBA} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterToAlphaInput = {\r\n    sourceId: string;\r\n    selectedRgbaObj: IRGBA;\r\n};\r\n\r\nexport type TFilterToAlphaHistoryEntry = TFilterHistoryEntry<\r\n    'toAlpha',\r\n    TFilterToAlphaInput>;\r\n\r\nexport const filterToAlpha = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterToAlphaInput> = {\r\n            element: div,\r\n        };\r\n\r\n        function finishInit () {\r\n            const radius = 2, strength = 5.1 / 10;\r\n            div.append(BB.el({\r\n                content: LANG('filter-to-alpha-description'),\r\n                css: {\r\n                    marginBottom: '5px',\r\n                },\r\n            }));\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            function updatePreview () {\r\n                fxCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n                klCanvasPreview.render();\r\n            }\r\n\r\n            // source\r\n            let sourceId = 'inverted-luminance';\r\n            const sourceOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'inverted-luminance',\r\n                        label: LANG('filter-to-alpha-inverted-lum'),\r\n                    },\r\n                    {\r\n                        id: 'luminance',\r\n                        label: LANG('filter-to-alpha-lum'),\r\n                    },\r\n                ],\r\n                initId: sourceId,\r\n                onChange: function (id) {\r\n                    sourceId = id;\r\n                    updatePreview();\r\n                },\r\n            });\r\n            div.append(sourceOptions.getElement());\r\n\r\n            // color\r\n            let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n            const colorOptionsArr = [\r\n                null,\r\n                {r: 0, g: 0, b: 0, a: 1},\r\n                {r: 255, g: 255, b: 255, a: 1},\r\n            ];\r\n            colorOptionsArr.push({\r\n                r: params.currentColorRgb.r,\r\n                g: params.currentColorRgb.g,\r\n                b: params.currentColorRgb.b,\r\n                a: 1,\r\n            });\r\n            colorOptionsArr.push({\r\n                r: params.secondaryColorRgb.r,\r\n                g: params.secondaryColorRgb.g,\r\n                b: params.secondaryColorRgb.b,\r\n                a: 1,\r\n            });\r\n\r\n            const colorOptions = new ColorOptions({\r\n                label: LANG('filter-to-alpha-replace'),\r\n                colorArr: colorOptionsArr,\r\n                initialIndex: 1,\r\n                onChange: function (rgbaObj) {\r\n                    selectedRgbaObj = rgbaObj;\r\n                    updatePreview();\r\n                },\r\n            });\r\n            colorOptions.getElement().style.marginTop = '10px';\r\n            div.append(colorOptions.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            setTimeout(function () { //ie has a problem otherwise...\r\n                try {\r\n                    updatePreview();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }, 1);\r\n\r\n            result.destroy = (): void => {\r\n                texture.destroy();\r\n                sourceOptions.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterToAlphaInput {\r\n                result.destroy();\r\n                return {\r\n                    sourceId: sourceId,\r\n                    selectedRgbaObj: selectedRgbaObj,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply (params: IFilterApply<TFilterToAlphaInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const sourceId = params.input.sourceId;\r\n        const selectedRgbaObj = params.input.selectedRgbaObj;\r\n        if (!context || !sourceId || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'toAlpha'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterToAlphaHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {input} from '../ui/components/input';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {drawGrid} from '../image-operations/draw-grid';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterGridInput = {\r\n    x: number;\r\n    y: number;\r\n    thickness: number;\r\n    color: string;\r\n    opacity: number;\r\n};\r\n\r\nexport type TFilterGridHistoryEntry = TFilterHistoryEntry<\r\n    'grid',\r\n    TFilterGridInput>;\r\n\r\nexport const filterGrid = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterGridInput> = {\r\n            element: div,\r\n        };\r\n        div.innerHTML = LANG('filter-grid-description') + '<br/><br/>';\r\n\r\n        const settingsObj: TFilterGridInput = {\r\n            x: 2,\r\n            y: 2,\r\n            thickness: 2,\r\n            color: '#000',\r\n            opacity: 1,\r\n        };\r\n\r\n        const line1 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        const line2 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n        const xInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.x = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const yInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.y = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const thicknessInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.thickness = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n        settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('shape-stroke'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function (rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            marginRight: '5px',\r\n        };\r\n        line1.append(\r\n            BB.el({content: 'X:', css: labelStyle}),\r\n            xInput,\r\n            BB.el({content: 'Y:', css: labelStyle}),\r\n            yInput,\r\n        );\r\n        line2.append(\r\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\r\n            thicknessInput,\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorOptions.getElement(),\r\n        );\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            }),\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n            drawGrid(ctx, settingsObj.x, settingsObj.y, Math.max(settingsObj.thickness * renderFactor, 1), settingsObj.color, settingsObj.opacity);\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            klCanvasPreview.destroy();\r\n            colorOptions.destroy();\r\n        };\r\n        result.getInput = function (): TFilterGridInput {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterGridInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        drawGrid(\r\n            context,\r\n            params.input.x,\r\n            params.input.y,\r\n            params.input.thickness,\r\n            params.input.color,\r\n            params.input.opacity,\r\n        );\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['filter', 'grid'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterGridHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","\r\n// ideas: padding, gutter, other shapes\r\n\r\nexport function drawGrid (\r\n    ctx: CanvasRenderingContext2D,\r\n    cellsX: number,\r\n    cellsY: number,\r\n    thickness: number, // px\r\n    color: string,\r\n    opacity: number, // 0 - 1\r\n) {\r\n    ctx.save();\r\n    const w = ctx.canvas.width;\r\n    const h = ctx.canvas.height;\r\n    thickness = Math.round(thickness);\r\n    const thickIsRound = thickness % 2 === 0;\r\n\r\n    ctx.beginPath();\r\n    ctx.lineWidth = thickness;\r\n    ctx.strokeStyle = color;\r\n    ctx.globalAlpha = opacity;\r\n\r\n    for(let i = 0; i < cellsX - 1; i++) {\r\n        const cw = w / (cellsX);\r\n        let pos = cw * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n        ctx.moveTo(pos, 0);\r\n        ctx.lineTo(pos, h);\r\n\r\n    }\r\n    for(let i = 0; i < cellsY - 1; i++) {\r\n        const ch = h / (cellsY);\r\n        let pos = ch * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n\r\n        ctx.moveTo(0, pos);\r\n        ctx.lineTo(w, pos);\r\n    }\r\n\r\n    ctx.stroke();\r\n    ctx.restore();\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, IRGB, TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {Options} from '../ui/components/options';\r\nimport {eventResMs} from './filters-consts';\r\nimport {Select} from '../ui/components/select';\r\nimport {translateBlending} from '../canvas/translate-blending';\r\nimport {KL} from '../kl';\r\nimport {ColorConverter} from '../../bb/color/color';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {TFxCanvas} from '../../fx-canvas/fx-canvas-types';\r\nimport {TKlCanvasHistoryEntry} from '../canvas/kl-canvas';\r\n\r\n// see noise(...) in fx-canvas\r\ninterface INoisePreset {\r\n    type: number;\r\n    scaleX: number;\r\n    scaleY: number;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    octaves: number;\r\n    samples: number;\r\n    peaks: number;\r\n    brightness: number;\r\n    contrast: number;\r\n    isReversed: boolean;\r\n}\r\n\r\ntype TNoiseChannels = 'rgb' | 'alpha';\r\n\r\ninterface INoiseSettings extends INoisePreset {\r\n    seed: number;\r\n    colA: IRGB;\r\n    colB: IRGB;\r\n    channels: TNoiseChannels;\r\n}\r\n\r\nexport type TFilterNoiseInput = {\r\n    seed: number;\r\n    presetIndex: number; // which preset from presetArr\r\n    scale: number; // applies to both scaleX and scaleX\r\n    opacity: number; // aka strength\r\n    isReversed: boolean; // reverse direction of color gradient\r\n    channels: TNoiseChannels;\r\n\r\n    // only for channels = rgb\r\n    mixModeStr: GlobalCompositeOperation; // how mixed with image\r\n    colA: IRGB;\r\n    colB: IRGB;\r\n}\r\n\r\n/*export type TFilterNoiseHistoryEntry = TFilterHistoryEntry<\r\n    'replaceLayer',\r\n    TFilterNoiseInput>;*/\r\n\r\nconst presetArr: INoisePreset[] = [\r\n    // each pixel random value\r\n    {type: 0, scaleX: 1, scaleY: 1, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: true},\r\n\r\n    // cloud\r\n    {type: 1, scaleX: 166, scaleY: 164, offsetX: 105, offsetY: 30, octaves: 6, samples: 1, peaks: 0, brightness: 0.055, contrast: 0.23, isReversed: true},\r\n\r\n    // thin lines\r\n    {type: 1, scaleX: 235, scaleY: 190, offsetX: 3227, offsetY: 2156, octaves: 4, samples: 16, peaks: 22, brightness: -0.375, contrast: 1, isReversed: false},\r\n\r\n    // soft large simplex, only 1 octave\r\n    {type: 1, scaleX: 40, scaleY: 40, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: false},\r\n\r\n    // two value large pixels\r\n    {type: 0, scaleX: 26, scaleY: 26, offsetX: 557, offsetY: 365, octaves: 1, samples: 1, peaks: 0, brightness: 0.02, contrast: 1, isReversed: true},\r\n\r\n    // zebra\r\n    {type: 1, scaleX: 1500, scaleY: 1500, offsetX: 745, offsetY: 2871, octaves: 5, samples: 16, peaks: 156.02, brightness: 0.03, contrast: 1, isReversed: true},\r\n\r\n    // sparse dots / stars\r\n    {type: 1, scaleX: 11, scaleY: 11, offsetX: 2940, offsetY: 2045, octaves: 1, samples: 16, peaks: 1, brightness: -0.045, contrast: 1, isReversed: true},\r\n\r\n    // pseudo marble\r\n    {type: 2, scaleX: 74, scaleY: 74, offsetX: 4816, offsetY: 1304, octaves: 3, samples: 1, peaks: 2.78, brightness: 0, contrast: 0, isReversed: false},\r\n];\r\n\r\nfunction drawNoise (fxCanvas: TFxCanvas, settings: INoiseSettings): void {\r\n    fxCanvas.noise(\r\n        settings.seed  ? settings.seed : 0,\r\n        settings.type,\r\n        [settings.scaleX, settings.scaleY],\r\n        [fxCanvas.width / 2, fxCanvas.height / 2],\r\n        settings.octaves,\r\n        settings.samples,\r\n        settings.peaks,\r\n        settings.brightness,\r\n        settings.contrast,\r\n        settings.isReversed,\r\n        settings.colA,\r\n        settings.colB,\r\n        settings.channels ? settings.channels : 'rgb',\r\n    ).update();\r\n}\r\n\r\n\r\nexport const filterNoise = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return; // todo throw?\r\n        }\r\n        let texture;\r\n\r\n        const thumbImgArr = [];\r\n        const thumbSize = 32;\r\n        {\r\n            const canvas = BB.canvas(thumbSize, thumbSize);\r\n            const ctx = BB.ctx(canvas);\r\n            texture = fxCanvas.texture(canvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n            texture.destroy();\r\n\r\n            presetArr.forEach((preset, index) => {\r\n                const thumbImg = new Image();\r\n                const presetCopy = BB.copyObj(preset);\r\n                presetCopy.scaleX /= 10;\r\n                presetCopy.scaleY /= 10;\r\n                drawNoise(fxCanvas, presetCopy);\r\n                ctx.drawImage(fxCanvas, 0, 0);\r\n                thumbImg.src = canvas.toDataURL('image/png');\r\n                thumbImgArr.push(thumbImg);\r\n            });\r\n\r\n        }\r\n\r\n        let tempCanvas = BB.canvas(renderW, renderH);\r\n        texture = fxCanvas.texture(tempCanvas);\r\n        fxCanvas.draw(texture).update(); // update fxCanvas size\r\n        tempCanvas = null;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterNoiseInput> = {\r\n            element: div,\r\n        };\r\n\r\n        div.innerHTML = LANG('filter-noise-description') + '<br/><br/>';\r\n\r\n        const settingsObj: TFilterNoiseInput = {\r\n            seed: Math.random() * 300,\r\n            presetIndex: 0,\r\n            scale: 50,\r\n            opacity: 0.5,\r\n            isReversed: false,\r\n            channels: 'rgb',\r\n            mixModeStr: 'source-over' as GlobalCompositeOperation,\r\n            colA: {r: 0, g: 0, b: 0},\r\n            colB: {r: 255, g: 255, b: 255},\r\n        };\r\n\r\n\r\n        const presetOptions = new Options({\r\n            optionArr: thumbImgArr.map((img, index) => {\r\n                BB.css(img, {\r\n                    margin: '1px',\r\n                    borderRadius: '3px',\r\n                    transition: 'all 0.1s ease-in-out',\r\n                });\r\n                return {\r\n                    id: '' + index,\r\n                    label: img,\r\n                };\r\n            }),\r\n            initId: '0',\r\n            onChange: (id) => {\r\n                settingsObj.presetIndex = Number(id);\r\n                updatePreview();\r\n            },\r\n        });\r\n        presetOptions.getElement().style.marginBottom = '10px';\r\n        div.append(presetOptions.getElement());\r\n\r\n        const scaleSlider = new KlSlider({\r\n            label: LANG('filter-noise-scale'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1,\r\n            max: 1000,\r\n            value: settingsObj.scale,\r\n            eventResMs: eventResMs,\r\n            curve: BB.quadraticSplineInput(1, 1000, 0.1),\r\n            onChange: (value) => {\r\n                settingsObj.scale = value;\r\n                updatePreview();\r\n            },\r\n        });\r\n        scaleSlider.getElement().style.marginBottom = '10px';\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: settingsObj.opacity,\r\n            eventResMs: eventResMs,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n            onChange: (value) => {\r\n                settingsObj.opacity = value;\r\n                updatePreview();\r\n            },\r\n        });\r\n        opacitySlider.getElement().style.marginBottom = '10px';\r\n\r\n        const row1El = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        const row2El = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        const channelsOptions = new Options<TNoiseChannels>({\r\n            optionArr: [\r\n                {id: 'rgb', label: 'RGB'},\r\n                {id: 'alpha', label: LANG('filter-noise-alpha')},\r\n            ],\r\n            initId: 'rgb',\r\n            onChange: (id: TNoiseChannels) => {\r\n                settingsObj.channels = id;\r\n                if (id === 'rgb') {\r\n                    row2El.style.visibility = '';\r\n                } else {\r\n                    row2El.style.visibility = 'hidden';\r\n                }\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const reverseToggle = new Checkbox({\r\n            label: LANG('reverse'),\r\n            callback: (val) => {\r\n                settingsObj.isReversed = val;\r\n                updatePreview();\r\n            },\r\n            allowTab: true,\r\n        });\r\n\r\n        const blendSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                'source-over',\r\n                null,\r\n                'darken',\r\n                'multiply',\r\n                'color-burn',\r\n                null,\r\n                'lighten',\r\n                'screen',\r\n                'color-dodge',\r\n                null,\r\n                'overlay',\r\n                'soft-light',\r\n                'hard-light',\r\n                null,\r\n                'difference',\r\n                'exclusion',\r\n                null,\r\n                'hue',\r\n                'saturation',\r\n                'color',\r\n                'luminosity',\r\n            ].map((item: TMixMode) => {\r\n                return item ? [item, translateBlending(item)] : null;\r\n            }),\r\n            initValue: settingsObj.mixModeStr,\r\n            onChange: (val: GlobalCompositeOperation) => {\r\n                settingsObj.mixModeStr = val;\r\n                updatePreview();\r\n            },\r\n        });\r\n        blendSelect.getElement().title = LANG('layers-blending');\r\n\r\n        const colorWrapper = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        const colInputStyle = {\r\n            width: '34px',\r\n            height: '34px',\r\n            marginRight: '5px',\r\n        };\r\n        const colAInput = KL.input({\r\n            type: 'color',\r\n            init: '#' + ColorConverter.toHexString(settingsObj.colA),\r\n            callback: (val) => {\r\n                settingsObj.colA = ColorConverter.hexToRGB(val);\r\n                updatePreview();\r\n            },\r\n            css: colInputStyle,\r\n        });\r\n\r\n        const colBInput = KL.input({\r\n            type: 'color',\r\n            init: '#' + ColorConverter.toHexString(settingsObj.colB),\r\n            callback: (val) => {\r\n                settingsObj.colB = ColorConverter.hexToRGB(val);\r\n                updatePreview();\r\n            },\r\n            css: colInputStyle,\r\n        });\r\n\r\n        colorWrapper.append(\r\n            colAInput,\r\n            colBInput,\r\n        );\r\n\r\n\r\n        row1El.append(\r\n            channelsOptions.getElement(),\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            reverseToggle.getElement(),\r\n        );\r\n\r\n        row2El.append(\r\n            blendSelect.getElement(),\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorWrapper,\r\n        );\r\n\r\n        div.append(\r\n            scaleSlider.getElement(),\r\n            opacitySlider.getElement(),\r\n            row1El,\r\n            row2El,\r\n        );\r\n\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            }),\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n\r\n            ctx.globalAlpha = settingsObj.opacity;\r\n\r\n            const presetCopy = BB.copyObj(presetArr[settingsObj.presetIndex]);\r\n            presetCopy.seed = settingsObj.seed;\r\n            presetCopy.scaleX = presetCopy.scaleX  * settingsObj.scale / 50 * renderFactor;\r\n            presetCopy.scaleY = presetCopy.scaleY  * settingsObj.scale / 50 * renderFactor;\r\n            presetCopy.colA = settingsObj.colA;\r\n            presetCopy.colB = settingsObj.colB;\r\n            presetCopy.isReversed = settingsObj.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\r\n            presetCopy.channels  = settingsObj.channels;\r\n            drawNoise(fxCanvas, presetCopy);\r\n\r\n            if (settingsObj.channels === 'alpha') {\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n            } else {\r\n                ctx.globalCompositeOperation = settingsObj.mixModeStr;\r\n            }\r\n\r\n            ctx.drawImage(fxCanvas, 0, 0);\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            presetOptions.destroy();\r\n            scaleSlider.destroy();\r\n            opacitySlider.destroy();\r\n            reverseToggle.destroy();\r\n            channelsOptions.destroy();\r\n            texture.destroy();\r\n            blendSelect.destroy();\r\n            klCanvasPreview.destroy();\r\n        };\r\n        result.getInput = function (): TFilterNoiseInput {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterNoiseInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).update();\r\n        texture.destroy();\r\n\r\n        const input = params.input;\r\n\r\n        const presetCopy: INoiseSettings = BB.copyObj(presetArr[input.presetIndex]) as INoiseSettings;\r\n        presetCopy.seed = input.seed;\r\n        presetCopy.scaleX = presetCopy.scaleX  * input.scale / 50;\r\n        presetCopy.scaleY = presetCopy.scaleY  * input.scale / 50;\r\n        presetCopy.colA = input.colA;\r\n        presetCopy.colB = input.colB;\r\n        presetCopy.isReversed = input.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\r\n        presetCopy.channels  = input.channels;\r\n        drawNoise(fxCanvas, presetCopy);\r\n\r\n        context.save();\r\n        context.globalAlpha = input.opacity;\r\n        if (input.channels === 'alpha') {\r\n            context.globalCompositeOperation = 'destination-out';\r\n        } else {\r\n            context.globalCompositeOperation = input.mixModeStr;\r\n        }\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        context.restore();\r\n\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['canvas'],\r\n            action: 'replaceLayer',\r\n            params: [\r\n                klCanvas.getLayerIndex(context.canvas),\r\n                context.getImageData(0, 0, context.canvas.width, context.canvas.height),\r\n            ],\r\n        } as TKlCanvasHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {input} from '../ui/components/input';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {LANG} from '../../language/language';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {TwoTabs} from '../ui/components/two-tabs';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\n\r\nexport type TFilterPatternInput = {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n    blend?: number; // [0, 1] - 1 will blend linearly across whole length\r\n    offsetX: number;\r\n    offsetY: number;\r\n};\r\n\r\nexport type TFilterPatternHistoryEntry = TFilterHistoryEntry<\r\n    'pattern',\r\n    TFilterPatternInput>;\r\n\r\n/**\r\n * Draws pattern onto context. Pattern generated from context.\r\n * Can use blending for smoother transition. Will use area outside of bounds for blending.\r\n *\r\n * @param context\r\n * @param settings\r\n */\r\nfunction drawPattern (context: CanvasRenderingContext2D, settings: TFilterPatternInput): void {\r\n\r\n    // keep bounds in center via offset\r\n    // because blending done towards bottom right\r\n    const blendOffsetX = settings.blend ? Math.round(settings.blend * settings.width / 2) : 0;\r\n    const blendOffsetY = settings.blend ? Math.round(settings.blend * settings.height / 2) : 0;\r\n\r\n    const finalPatternCanvas = BB.canvas(settings.width, settings.height);\r\n\r\n    if (settings.blend) {\r\n        // construct pattern via linear blending\r\n\r\n        const blendCanvas = BB.canvas(settings.width * 2, settings.height * 2);\r\n        const blendCtx = BB.ctx(blendCanvas);\r\n        const colTransparent = '#0000';\r\n        const colOpaque = '#000';\r\n\r\n        // transfer source to blendCanvas\r\n        blendCtx.drawImage(\r\n            context.canvas,\r\n            -settings.x + blendOffsetX,\r\n            -settings.y + blendOffsetY,\r\n        );\r\n\r\n        // --- 1 cross-fade vertical ------------------------\r\n\r\n        // erase vertical gradient bottom half\r\n        blendCtx.save();\r\n        let blendGradient = blendCtx.createLinearGradient(0, settings.height, 0, settings.height * 2);\r\n        blendGradient.addColorStop(0, colOpaque);\r\n        blendGradient.addColorStop(settings.blend, colTransparent);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\r\n        blendCtx.restore();\r\n\r\n        // erase vertical gradient top half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(0, 0, 0, settings.height);\r\n        blendGradient.addColorStop(0, colTransparent);\r\n        blendGradient.addColorStop(settings.blend, colOpaque);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\r\n        blendCtx.restore();\r\n\r\n        // draw bottom half over top half\r\n        blendCtx.save();\r\n        // lighter needed for accurate cross-fade\r\n        blendCtx.globalCompositeOperation = 'lighter';\r\n        blendCtx.drawImage(blendCanvas, 0, -settings.height);\r\n        blendCtx.restore();\r\n\r\n\r\n\r\n        // --- 2 cross-fade horizontal ------------------------\r\n\r\n        // erase horizontal gradient right half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(settings.width, 0, settings.width * 2, 0);\r\n        blendGradient.addColorStop(0, colOpaque);\r\n        blendGradient.addColorStop(settings.blend, colTransparent);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\r\n        blendCtx.restore();\r\n\r\n        // erase horizontal gradient left half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(0, 0, settings.width, 0);\r\n        blendGradient.addColorStop(0, colTransparent);\r\n        blendGradient.addColorStop(settings.blend, colOpaque);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\r\n        blendCtx.restore();\r\n\r\n        // draw right half over left half\r\n        blendCtx.save();\r\n        // lighter needed for accurate cross-fade\r\n        blendCtx.globalCompositeOperation = 'lighter';\r\n        blendCtx.drawImage(blendCanvas, -settings.width, 0);\r\n        blendCtx.restore();\r\n\r\n        // transfer to pattern canvas\r\n        BB.ctx(finalPatternCanvas).drawImage(blendCanvas, 0, 0);\r\n\r\n    } else {\r\n        BB.ctx(finalPatternCanvas).drawImage(\r\n            context.canvas,\r\n            -settings.x,\r\n            -settings.y,\r\n        );\r\n    }\r\n\r\n    context.save();\r\n\r\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n    context.translate(settings.offsetX - blendOffsetX, settings.offsetY - blendOffsetY);\r\n    context.fillStyle = context.createPattern(finalPatternCanvas, 'repeat');\r\n    context.fillRect(-settings.offsetX + blendOffsetX, -settings.offsetY + blendOffsetY, context.canvas.width, context.canvas.height);\r\n\r\n    context.restore();\r\n}\r\n\r\n\r\nexport const filterPattern = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const maxSize = 1024;\r\n        const rootEl = BB.el({\r\n            content: LANG('filter-pattern-description') + '<br><br>',\r\n        });\r\n        const context = params.context;\r\n        const width = context.canvas.width;\r\n        const height = context.canvas.height;\r\n\r\n        let settings: TFilterPatternInput = {\r\n            x: 0,\r\n            y: 0,\r\n            width: width <= 250 ? Math.round(width / 4) : 200,\r\n            height: height <= 250 ? Math.round(height / 4) : 200,\r\n            blend: 0,\r\n            offsetX: 0,\r\n            offsetY: 0,\r\n        };\r\n        let lastDrawnSettings = null;\r\n\r\n        // determine bounds\r\n        const bounds = BB.canvasBounds(context);\r\n        // adjust settings according to bounds\r\n        if ( // use layer bounds if:\r\n            bounds &&\r\n            (bounds.width <= maxSize && bounds.height <= maxSize) && // don't exceed max size\r\n            (bounds.width < width * 0.75 || bounds.height < height * 0.75) // aren't too large (heuristic)\r\n        ) {\r\n            settings.x = bounds.x;\r\n            settings.y = bounds.y;\r\n            settings.width = bounds.width;\r\n            settings.height = bounds.height;\r\n        } else { // otherwise use default size in center\r\n            settings.x = Math.round(width / 2 - settings.width / 2);\r\n            settings.y = Math.round(height / 2 - settings.height / 2);\r\n        }\r\n\r\n        // ---- controls ----\r\n\r\n        const xInput = input({\r\n            init: settings.x,\r\n            type: 'number',\r\n            min: 0,\r\n            max: width,\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.x = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const yInput = input({\r\n            init: settings.y,\r\n            type: 'number',\r\n            min: 0,\r\n            max: height,\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.y = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const widthInput = input({\r\n            init: settings.width,\r\n            type: 'number',\r\n            min: 1,\r\n            max: Math.min(maxSize, width),\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.width = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const heightInput = input({\r\n            init: settings.height,\r\n            type: 'number',\r\n            min: 1,\r\n            max: Math.min(maxSize, height),\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.height = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const inputStyle = {\r\n            marginLeft: '5px',\r\n            flex: '1',\r\n        };\r\n        rootEl.append(\r\n            BB.el({\r\n               content: [\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           'X:',\r\n                           xInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           'Y:',\r\n                           yInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           LANG('width') + ':',\r\n                           widthInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           LANG('height') + ':',\r\n                           heightInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n               ],\r\n               css: {\r\n                   display: 'flex',\r\n                   marginLeft: '-5px',\r\n               },\r\n            }),\r\n        );\r\n\r\n\r\n        const blendSlider = new KlSlider({\r\n            label: LANG('brush-blending'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 0,\r\n            max: 1,\r\n            value: settings.blend,\r\n            eventResMs: eventResMs,\r\n            onChange: function (val) {\r\n                settings.blend = val;\r\n                updatePreview();\r\n            },\r\n            formatFunc: (val) => {\r\n                return BB.round(val, 2);\r\n            },\r\n            manualInputRoundDigits: 2,\r\n        });\r\n        BB.css(blendSlider.getElement(), {\r\n            margin: '10px 0',\r\n        });\r\n\r\n        rootEl.append(\r\n            blendSlider.getElement(),\r\n        );\r\n\r\n        // ---- preview tabs ----\r\n        let previewMode = 1; // 0 before, 1 after\r\n        const beforeAfterTabs = new TwoTabs({\r\n            left: LANG('compare-before'),\r\n            right: LANG('compare-after'),\r\n            init: previewMode,\r\n            onChange: (val) => {\r\n                previewMode = val;\r\n                overlayCanvas.style.display = val === 0 ? 'block' : 'none';\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        rootEl.append(beforeAfterTabs.getElement());\r\n\r\n        // ---- previews ----\r\n\r\n        const klCanvas = params.klCanvas;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                height: isSmall ? '260px' : '300px',\r\n                marginTop: '0',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const previewLayerArr = layers.map((item, i) => {\r\n            if (i === selectedLayerIndex) {\r\n                return previewLayer;\r\n            } else {\r\n                return {\r\n                    image: item.context.canvas,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                };\r\n            }\r\n        });\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const overlayCanvas = BB.canvas(w, h);\r\n        BB.css(overlayCanvas, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            mixBlendMode: 'difference',\r\n            imageRendering: 'pixelated',\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(\r\n            klCanvasPreview.getElement(),\r\n            overlayCanvas\r\n        );\r\n        previewWrapper.append(previewInnerWrapper);\r\n        rootEl.append(previewWrapper);\r\n\r\n\r\n        // ---- preview input processing ----\r\n        const inputs: {\r\n            start: IVector2D;\r\n            end: IVector2D;\r\n            oldSettings: TFilterPatternInput;\r\n            state: null | 'move' | 'select';\r\n        } = {\r\n            start: null,\r\n            end: null,\r\n            oldSettings: null,\r\n            state: null,\r\n        };\r\n\r\n        function syncInputs (): void {\r\n            xInput.value = '' + settings.x;\r\n            yInput.value = '' + settings.y;\r\n            widthInput.value = '' + settings.width;\r\n            heightInput.value = '' + settings.height;\r\n        }\r\n\r\n        const keyListener = new BB.KeyListener({\r\n        });\r\n\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        previewInnerWrapper.style.touchAction = 'none';\r\n        const pointerListener = new BB.PointerListener({\r\n            target: previewInnerWrapper,\r\n            onPointer: (event) => {\r\n                if (previewMode === 0) {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (!inputs.state) {\r\n                            inputs.oldSettings = BB.copyObj(settings);\r\n\r\n                            const x = event.relX / previewFactor;\r\n                            const y = event.relY / previewFactor;\r\n\r\n                            if (BB.isInsideRect(\r\n                                {x, y},\r\n                                {x: settings.x, y: settings.y, width: settings.width, height: settings.height},\r\n                            )) {\r\n                                inputs.state = 'move';\r\n                            } else {\r\n                                inputs.state = 'select';\r\n                            }\r\n                            inputs.start = {x, y};\r\n                        }\r\n                    } else if (event.type === 'pointermove') {\r\n\r\n                        const x = event.relX / previewFactor;\r\n                        const y = event.relY / previewFactor;\r\n\r\n                        if (inputs.state === 'select') {\r\n                            inputs.end = {x, y};\r\n\r\n                            const x1 = Math.max(0, Math.min(inputs.start.x, inputs.end.x));\r\n                            const y1 = Math.max(0, Math.min(inputs.start.y, inputs.end.y));\r\n                            const x2 = Math.min(width, Math.max(inputs.start.x, inputs.end.x));\r\n                            const y2 = Math.min(height, Math.max(inputs.start.y, inputs.end.y));\r\n\r\n                            settings.x = Math.floor(x1);\r\n                            settings.y = Math.floor(y1);\r\n                            settings.width = Math.min(maxSize, Math.ceil(x2 - settings.x));\r\n                            settings.height = Math.min(maxSize, Math.ceil(y2 - settings.y));\r\n\r\n                            if (keyListener.isPressed('shift')) {\r\n                                settings.width = Math.min(settings.width, settings.height);\r\n                                settings.height = Math.min(settings.width, settings.height);\r\n                            }\r\n\r\n                            if (settings.width === 0 || settings.height === 0) {\r\n                                settings = BB.copyObj(inputs.oldSettings);\r\n                            }\r\n\r\n                            syncInputs();\r\n                            updatePreview();\r\n                        } else if (inputs.state === 'move') {\r\n                            const dX = Math.round(x - inputs.start.x);\r\n                            const dY = Math.round(y - inputs.start.y);\r\n\r\n                            settings.x = BB.clamp(inputs.oldSettings.x + dX, 0, width - settings.width);\r\n                            settings.y = BB.clamp(inputs.oldSettings.y + dY, 0, height - settings.height);\r\n\r\n                            syncInputs();\r\n                            updatePreview();\r\n                        }\r\n                    } else if (event.type === 'pointerup') {\r\n                        if (inputs.state) {\r\n                            inputs.state = null;\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (!inputs.state) {\r\n                            inputs.state = 'move';\r\n                            inputs.oldSettings = BB.copyObj(settings);\r\n                            inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n                            inputs.end = null;\r\n                        }\r\n                    } else if (event.type === 'pointermove') {\r\n                        if (inputs.state) {\r\n                            inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n\r\n                            settings.offsetX = Math.round(inputs.end.x - inputs.start.x) + inputs.oldSettings.offsetX;\r\n                            settings.offsetY = Math.round(inputs.end.y - inputs.start.y) + inputs.oldSettings.offsetY;\r\n\r\n                            updatePreview();\r\n                        }\r\n                    } else if (event.type === 'pointerup') {\r\n                        if (inputs.state) {\r\n                            if (!inputs.end) {\r\n                                settings.offsetX = 0;\r\n                                settings.offsetY = 0;\r\n                                updatePreview();\r\n                            }\r\n                            inputs.state = null;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        // ---------- rendering ---------------------\r\n        const fullSizeCanvas = BB.canvas(width, height);\r\n        const fullSizeCtx = BB.ctx(fullSizeCanvas);\r\n\r\n        function sharpStrokeRect (\r\n            context: CanvasRenderingContext2D,\r\n            x: number,\r\n            y: number,\r\n            width: number,\r\n            height: number\r\n        ): void {\r\n            const drawX = Math.round(x + 0.5) - 0.5;\r\n            const drawY = Math.round(y + 0.5) - 0.5;\r\n            const drawWidth = Math.round(x + width - drawX);\r\n            const drawHeight = Math.round(y + height - drawY);\r\n            context.strokeRect(drawX, drawY, drawWidth, drawHeight);\r\n        }\r\n\r\n        function updatePreview (doForce?: boolean) {\r\n            if (!doForce && lastDrawnSettings && JSON.stringify(lastDrawnSettings) === JSON.stringify(settings)) {\r\n                return;\r\n            }\r\n\r\n            if (previewMode === 0) { // before\r\n                fullSizeCtx.clearRect(0, 0, width, height);\r\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\r\n\r\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\r\n                const previewCtx = BB.ctx(previewCanvas);\r\n                previewCtx.save();\r\n                previewCtx.clearRect(0, 0, renderW, renderH);\r\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\r\n                previewCtx.restore();\r\n\r\n                const pW = settings.width * previewFactor;\r\n                const pH = settings.height * previewFactor;\r\n\r\n                const overlayCtx = BB.ctx(overlayCanvas);\r\n                overlayCtx.save();\r\n                overlayCtx.clearRect(0, 0, w, h);\r\n                overlayCtx.strokeStyle = '#fff';\r\n                sharpStrokeRect(\r\n                    overlayCtx,\r\n                    settings.x * previewFactor,\r\n                    settings.y * previewFactor,\r\n                    pW,\r\n                    pH\r\n                );\r\n                if (settings.blend > 0.05) {\r\n                    overlayCtx.strokeStyle = '#f0f';\r\n                    sharpStrokeRect(\r\n                        overlayCtx,\r\n                        settings.x * previewFactor - pW / 2 * settings.blend,\r\n                        settings.y * previewFactor - pH / 2 * settings.blend,\r\n                        pW * (1 + settings.blend),\r\n                        pH * (1 + settings.blend),\r\n                    );\r\n                }\r\n                overlayCtx.restore();\r\n\r\n\r\n\r\n            } else { // after\r\n                fullSizeCtx.clearRect(0, 0, width, height);\r\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\r\n                drawPattern(fullSizeCtx, settings);\r\n\r\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\r\n                const previewCtx = BB.ctx(previewCanvas);\r\n                previewCtx.clearRect(0, 0, renderW, renderH);\r\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\r\n            }\r\n\r\n\r\n            klCanvasPreview.render();\r\n            lastDrawnSettings = BB.copyObj(settings);\r\n        }\r\n\r\n        updatePreview();\r\n\r\n\r\n        // ----- result -------------------\r\n        const result: IFilterGetDialogResult<TFilterPatternInput> = {\r\n            element: rootEl,\r\n            destroy: (): void => {\r\n                blendSlider.destroy();\r\n                keyListener.destroy();\r\n                pointerListener.destroy();\r\n                klCanvasPreview.destroy();\r\n            },\r\n            getInput: () => BB.copyObj(settings),\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterPatternInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const ctx = params.context;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        drawPattern(ctx, params.input);\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'pattern'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterPatternHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {LANG} from '../../language/language';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {Options} from '../ui/components/options';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\n\r\n// see fx-canvas distort\r\nexport type TFilterDistortInput = {\r\n    stepSize: number; // [0, inf]\r\n    distortType: 0 | 1 | 2;\r\n    scale: { x: number; y: number };\r\n    strength: { x: number; y: number };\r\n    phase: { x: number; y: number };\r\n};\r\n\r\nexport type TFilterDistortHistoryEntry = TFilterHistoryEntry<\r\n    'distort',\r\n    TFilterDistortInput>;\r\n\r\nexport const filterDistort = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const rootEl = BB.el({\r\n            content: LANG('filter-distort-description') + '<br><br>',\r\n        });\r\n        const context = params.context;\r\n\r\n        let isSynced = true;\r\n        const settings: TFilterDistortInput = {\r\n            distortType: 0,\r\n            scale: {x: 100, y: 100},\r\n            strength: {x: 20, y: 20},\r\n            phase: {x: 0, y: 0},\r\n            stepSize: 1,\r\n        };\r\n        // let lastDrawnSettings = null;\r\n\r\n        // ---- thumb -------\r\n        const thumbImgArr = [];\r\n        const thumbSize = 32;\r\n        {\r\n            const canvas = BB.canvas(thumbSize, thumbSize);\r\n            const ctx = BB.ctx(canvas);\r\n\r\n            ctx.beginPath();\r\n            ctx.arc(thumbSize / 2, thumbSize / 2, thumbSize / 2.5, 0, Math.PI * 2);\r\n            ctx.fill();\r\n\r\n            let gradient = ctx.createLinearGradient(0, 0, thumbSize, thumbSize);\r\n            gradient.addColorStop(0, '#00f');\r\n            gradient.addColorStop(0.5, '#f00');\r\n            gradient.addColorStop(1, '#fff');\r\n            ctx.fillStyle = gradient;\r\n            ctx.globalCompositeOperation = 'source-atop';\r\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\r\n\r\n            gradient = ctx.createLinearGradient(thumbSize, 0, 0, thumbSize);\r\n            gradient.addColorStop(0, '#000');\r\n            gradient.addColorStop(1, '#000');\r\n            ctx.fillStyle = gradient;\r\n            ctx.globalCompositeOperation = 'destination-atop';\r\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\r\n\r\n            const fxCanvas = getSharedFx();\r\n            const texture = fxCanvas.texture(canvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const scaleFactor = 20;\r\n\r\n            [0, 1, 2].forEach(item => {\r\n                const thumbImg = new Image();\r\n                const settingsCopy: TFilterDistortSettings = BB.copyObj(settings);\r\n                settingsCopy.distortType = item;\r\n                settingsCopy.scale.x /= scaleFactor;\r\n                settingsCopy.scale.y /= scaleFactor;\r\n                settingsCopy.strength.x /= scaleFactor;\r\n                settingsCopy.strength.y /= scaleFactor;\r\n                fxCanvas.draw(texture).multiplyAlpha().distort(settingsCopy).unmultiplyAlpha().update();\r\n                ctx.clearRect(0, 0, thumbSize, thumbSize);\r\n                ctx.drawImage(fxCanvas, 0, 0);\r\n                thumbImg.src = canvas.toDataURL('image/png');\r\n                thumbImgArr.push(thumbImg);\r\n            });\r\n\r\n            texture.destroy();\r\n        }\r\n\r\n\r\n        // ---- controls ----\r\n\r\n        const topRowEl = BB.el({\r\n            parent: rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n\r\n        const typeOptions = new Options({\r\n            optionArr: thumbImgArr.map((img, index) => {\r\n                BB.css(img, {\r\n                    margin: '1px',\r\n                    borderRadius: '3px',\r\n                    transition: 'all 0.1s ease-in-out',\r\n                });\r\n                return {\r\n                    id: '' + index,\r\n                    label: img,\r\n                };\r\n            }),\r\n            initId: '0',\r\n            onChange: (id) => {\r\n                settings.distortType = Number(id) as any;\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        function sync (from: 'x' | 'y') {\r\n            if (from === 'x') {\r\n                settings.scale.y = settings.scale.x;\r\n                settings.strength.y = settings.strength.x;\r\n                settings.phase.y = settings.phase.x;\r\n\r\n                sliderArr[3].setValue(settings.scale.y);\r\n                sliderArr[4].setValue(settings.strength.y);\r\n                sliderArr[5].setValue(settings.phase.y);\r\n            } else {\r\n                settings.scale.x = settings.scale.y;\r\n                settings.strength.x = settings.strength.y;\r\n                settings.phase.x = settings.phase.y;\r\n\r\n                sliderArr[0].setValue(settings.scale.x);\r\n                sliderArr[1].setValue(settings.strength.x);\r\n                sliderArr[2].setValue(settings.phase.x);\r\n            }\r\n            updatePreview();\r\n        }\r\n\r\n        const syncToggle = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-distort-sync-xy'),\r\n            callback: (val) => {\r\n                isSynced = val;\r\n                if (isSynced) {\r\n                    sync('x');\r\n                }\r\n            },\r\n        });\r\n\r\n        topRowEl.append(\r\n            typeOptions.getElement(),\r\n            BB.el({css: {flexGrow: '1'}}),\r\n            syncToggle.getElement(),\r\n        );\r\n\r\n        const xyRowEl = BB.el({\r\n            parent: rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n            },\r\n        });\r\n        const leftCol = BB.el({\r\n            parent: xyRowEl,\r\n            css: {\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n        const rightCol = BB.el({parent: xyRowEl});\r\n\r\n        const sliderWidth = isSmall ? 300 : 245;\r\n        const sliderArr: KlSlider[] = [];\r\n\r\n        ['x', 'y'].forEach((item, index) => {\r\n            const targetEl = index === 0 ? leftCol : rightCol;\r\n\r\n            const scaleSlider = new KlSlider({\r\n                label: LANG('filter-noise-scale') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 1,\r\n                max: 1000,\r\n                curve: 'quadratic',\r\n                value: settings.scale[item],\r\n                eventResMs: eventResMs,\r\n                onChange: (val) => {\r\n                    settings.scale[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item as any);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                },\r\n            });\r\n            scaleSlider.getElement().style.marginTop = '20px';\r\n            targetEl.append(scaleSlider.getElement());\r\n\r\n            const strengthSlider = new KlSlider({\r\n                label: LANG('filter-unsharp-mask-strength') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                curve: 'quadratic',\r\n                value: settings.strength[item],\r\n                eventResMs: eventResMs,\r\n                onChange: (val) => {\r\n                    settings.strength[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item as any);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                },\r\n            });\r\n            strengthSlider.getElement().style.marginTop = '10px';\r\n            targetEl.append(strengthSlider.getElement());\r\n\r\n            const phaseSlider = new KlSlider({\r\n                label: LANG('filter-distort-phase') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: settings.phase[item],\r\n                manualInputRoundDigits: 2,\r\n                eventResMs: eventResMs,\r\n                formatFunc: (val) => BB.round(val, 2),\r\n                onChange: (val) => {\r\n                    settings.phase[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item as any);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                },\r\n            });\r\n            phaseSlider.getElement().style.marginTop = '10px';\r\n            targetEl.append(phaseSlider.getElement());\r\n\r\n            sliderArr.push(scaleSlider);\r\n            sliderArr.push(strengthSlider);\r\n            sliderArr.push(phaseSlider);\r\n        });\r\n\r\n        const stepSlider = new KlSlider({\r\n            label: LANG('filter-distort-stepsize'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1,\r\n            max: 300,\r\n            curve: 'quadratic',\r\n            value: settings.stepSize,\r\n            eventResMs: eventResMs,\r\n            onChange: (val) => {\r\n                settings.stepSize = Math.round(val);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        stepSlider.getElement().style.marginTop = '20px';\r\n        rootEl.append(stepSlider.getElement());\r\n\r\n\r\n        // ---- preview ----\r\n\r\n        const klCanvas = params.klCanvas;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                height: isSmall ? '260px' : '300px',\r\n            },\r\n        });\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return; // todo throw?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: fxCanvas,\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const previewLayerArr = layers.map((item, i) => {\r\n            if (i === selectedLayerIndex) {\r\n                return previewLayer;\r\n            } else {\r\n                return {\r\n                    image: item.context.canvas,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                };\r\n            }\r\n        });\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n        rootEl.append(previewWrapper);\r\n\r\n        // ---------- rendering ---------------------\r\n\r\n        function updatePreview (): void {\r\n            fxCanvas.draw(texture).multiplyAlpha().distort(settings).unmultiplyAlpha().update();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n\r\n        // ----- result -------------------\r\n        const result: IFilterGetDialogResult<TFilterDistortInput> = {\r\n            element: rootEl,\r\n            destroy: () => {\r\n                typeOptions.destroy();\r\n                sliderArr.forEach(item => item.destroy());\r\n                stepSlider.destroy();\r\n                syncToggle.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            },\r\n            getInput: () => BB.copyObj(settings),\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterDistortInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).multiplyAlpha().distort(params.input).unmultiplyAlpha().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'distort'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterDistortHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, IRGB} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {input} from '../ui/components/input';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {drawVanishPoint} from '../image-operations/draw-vanish-point';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterVanishPointInput = {\r\n    x: number;\r\n    y: number;\r\n    lines: number;\r\n    thickness: number;\r\n    color: IRGB;\r\n    opacity: number;\r\n};\r\n\r\nexport type TFilterVanishPointHistoryEntry = TFilterHistoryEntry<\r\n    'vanishPoint',\r\n    TFilterVanishPointInput>;\r\n\r\nexport const filterVanishPoint = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterVanishPointInput> = {\r\n            element: div,\r\n        };\r\n        div.innerHTML = LANG('filter-vanish-point-description') + '<br/><br/>';\r\n\r\n        const settingsObj: TFilterVanishPointInput = {\r\n            x: context.canvas.width / 2,\r\n            y: context.canvas.height / 2,\r\n            lines: 8,\r\n            thickness: 2,\r\n            color: {r: 0, g: 0, b: 0},\r\n            opacity: 1,\r\n        };\r\n\r\n        const linesSlider = new KlSlider({\r\n            label: LANG('filter-vanish-point-lines'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 2,\r\n            max: 20,\r\n            value: settingsObj.lines,\r\n            curve: 'quadratic',\r\n            eventResMs: eventResMs,\r\n            onChange: function (val) {\r\n                settingsObj.lines = Math.round(val);\r\n                updatePreview();\r\n            },\r\n        });\r\n        linesSlider.getElement().style.marginBottom = '10px';\r\n        div.append(linesSlider.getElement());\r\n\r\n        const line1 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        const line2 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n        const xInput = input({\r\n            init: settingsObj.x,\r\n            type: 'number',\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.x = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const yInput = input({\r\n            init: settingsObj.y,\r\n            type: 'number',\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.y = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const thicknessInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.thickness = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n        settingsObj.color = BB.copyObj(selectedRgbaObj);\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('shape-stroke'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function (rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                settingsObj.color = BB.copyObj(selectedRgbaObj);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            marginRight: '5px',\r\n        };\r\n        line1.append(\r\n            BB.el({content: 'X:', css: labelStyle}),\r\n            xInput,\r\n            BB.el({content: 'Y:', css: labelStyle}),\r\n            yInput,\r\n        );\r\n        line2.append(\r\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\r\n            thicknessInput,\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorOptions.getElement(),\r\n        );\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            }),\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n                cursor: 'move',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n\r\n        // ---- preview input processing ----\r\n        const inputs: {\r\n            start: IVector2D;\r\n            end: IVector2D;\r\n            state: null | 'move';\r\n            oldSettings: any;\r\n        } = {\r\n            start: null,\r\n            end: null,\r\n            state: null,\r\n            oldSettings: null,\r\n        };\r\n        function syncInputs (): void {\r\n            xInput.value = '' + settingsObj.x;\r\n            yInput.value = '' + settingsObj.y;\r\n        }\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        previewInnerWrapper.style.touchAction = 'none';\r\n        const pointerListener = new BB.PointerListener({\r\n            target: previewInnerWrapper,\r\n            onPointer: (event) => {\r\n                if (event.type === 'pointerdown') {\r\n                    if (!inputs.state) {\r\n                        inputs.state = 'move';\r\n                        inputs.oldSettings = BB.copyObj(settingsObj);\r\n                        inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n                        inputs.end = null;\r\n                    }\r\n                } else if (event.type === 'pointermove') {\r\n                    if (inputs.state) {\r\n                        inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n\r\n                        settingsObj.x = Math.round(inputs.end.x - inputs.start.x + inputs.oldSettings.x);\r\n                        settingsObj.y = Math.round(inputs.end.y - inputs.start.y + inputs.oldSettings.y);\r\n\r\n                        syncInputs();\r\n                        updatePreview();\r\n                    }\r\n                } else if (event.type === 'pointerup') {\r\n                    if (inputs.state) {\r\n                        inputs.state = null;\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n            drawVanishPoint(\r\n                ctx,\r\n                settingsObj.x * renderFactor,\r\n                settingsObj.y * renderFactor,\r\n                settingsObj.lines,\r\n                Math.max(settingsObj.thickness * renderFactor, 1),\r\n                settingsObj.color,\r\n                settingsObj.opacity,\r\n            );\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = () => {\r\n            linesSlider.destroy();\r\n            pointerListener.destroy();\r\n            klCanvasPreview.destroy();\r\n            colorOptions.destroy();\r\n        };\r\n        result.getInput = function (): TFilterVanishPointInput {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterVanishPointInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        drawVanishPoint(\r\n            context,\r\n            params.input.x,\r\n            params.input.y,\r\n            params.input.lines,\r\n            params.input.thickness,\r\n            params.input.color,\r\n            params.input.opacity,\r\n        );\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['filter', 'vanishPoint'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterVanishPointHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {drawShape} from './shape-tool';\r\nimport {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl-types';\r\n\r\nexport function drawVanishPoint (\r\n    ctx: CanvasRenderingContext2D,\r\n    x: number,\r\n    y: number,\r\n    lines: number, // int, [2, inf]\r\n    thickness: number, // px\r\n    color: IRGB,\r\n    opacity: number, // 0 - 1\r\n): void {\r\n    ctx.save();\r\n\r\n    const degIncrement = 180 / lines;\r\n    for (let deg = 0; deg < 180; deg += degIncrement) {\r\n        const p2 = BB.rotateAround({x, y}, {x: x + 9999, y}, deg);\r\n        drawShape(\r\n            ctx,\r\n            {\r\n                type: 'line',\r\n                x1: x,\r\n                y1: y,\r\n                x2: p2.x,\r\n                y2: p2.y,\r\n                //angleRad: 0,\r\n                isOutwards: true,\r\n                opacity,\r\n                //isEraser: false,\r\n                strokeRgb: color,\r\n                lineWidth: thickness,\r\n                //doLockAlpha: false,\r\n            }\r\n        );\r\n    }\r\n\r\n    ctx.restore();\r\n}","import {KL} from '../kl';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {Psd} from 'ag-psd/dist/psd';\r\n\r\nexport async function klCanvasToPsdBlob (klCanvas: KlCanvas): Promise<Blob> {\r\n    const layerArr = klCanvas.getLayersFast();\r\n\r\n    const psdConfig: Psd = {\r\n        width: klCanvas.getWidth(),\r\n        height: klCanvas.getHeight(),\r\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\r\n        children: layerArr.map(item => {\r\n            // todo - can be optimized if layer mostly empty\r\n            return {\r\n                name: item.name,\r\n                opacity: item.opacity,\r\n                canvas: item.canvas,\r\n                blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n                left: 0,\r\n                top: 0,\r\n            };\r\n        }),\r\n    };\r\n\r\n    const agPsd = await import('ag-psd');\r\n    const buffer = agPsd.writePsdBuffer(psdConfig);\r\n    return new Blob([buffer], { type: 'application/octet-stream' });\r\n}","import {BB} from '../../bb/bb';\r\nimport {IDrawMoveEvent, TDrawEvent} from '../kl-types';\r\n\r\n/**\r\n * Line smoothing. EventChain element. Smoothing via blending new position with old position.\r\n * for onDraw events from KlCanvasWorkspace.\r\n *\r\n * in some draw event\r\n * out some draw event\r\n *\r\n * type: 'line' Events are just passed through.\r\n */\r\nexport class LineSmoothing {\r\n\r\n    private chainOut: ((drawEvent: TDrawEvent) => void) | undefined;\r\n    private smoothing: number;\r\n    private lastMixedInput: {\r\n        x: number;\r\n        y: number;\r\n        pressure: number;\r\n    } | undefined;\r\n    private interval: ReturnType<typeof setInterval> | undefined;\r\n    private timeout: ReturnType<typeof setTimeout> | undefined;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            smoothing: number; // 0-1, 0: no smoothing, 1: 100% smoothing -> would never catch up\r\n        }\r\n    ) {\r\n        this.smoothing = BB.clamp(p.smoothing, 0, 1);\r\n    }\r\n\r\n    chainIn (event: TDrawEvent): TDrawEvent | null {\r\n        event = BB.copyObj(event);\r\n        this.timeout && clearTimeout(this.timeout);\r\n        this.interval && clearInterval(this.interval);\r\n\r\n        if (event.type === 'down') {\r\n            this.lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure,\r\n            };\r\n        }\r\n\r\n        if (event.type === 'move') {\r\n\r\n            const inputX = event.x;\r\n            const inputY = event.y;\r\n            const inputPressure = event.pressure;\r\n\r\n            event.x = BB.mix(event.x, this.lastMixedInput!.x, this.smoothing);\r\n            event.y = BB.mix(event.y, this.lastMixedInput!.y, this.smoothing);\r\n            event.pressure = BB.mix(event.pressure, this.lastMixedInput!.pressure, this.smoothing);\r\n            this.lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure,\r\n            };\r\n\r\n            if (this.smoothing > 0) {\r\n                this.timeout = setTimeout(() => {\r\n                    this.interval = setInterval(() => {\r\n                        event = JSON.parse(JSON.stringify(event)) as IDrawMoveEvent;\r\n\r\n                        event.x = BB.mix(inputX, this.lastMixedInput!.x, this.smoothing);\r\n                        event.y = BB.mix(inputY, this.lastMixedInput!.y, this.smoothing);\r\n                        event.pressure = BB.mix(inputPressure, this.lastMixedInput!.pressure, this.smoothing);\r\n                        this.lastMixedInput = {\r\n                            x: event.x,\r\n                            y: event.y,\r\n                            pressure: event.pressure,\r\n                        };\r\n\r\n                        this.chainOut && this.chainOut(event);\r\n                    }, 35);\r\n                }, 80);\r\n            }\r\n\r\n        }\r\n\r\n        return event;\r\n    }\r\n\r\n    setChainOut (func: (drawEvent: TDrawEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    setSmoothing (s: number): void {\r\n        this.smoothing = BB.clamp(s, 0, 1);\r\n    }\r\n}\r\n","import {TDrawEvent} from '../kl-types';\r\n\r\n/**\r\n * cleans up DrawEvents. More trustworthy events. EventChain element\r\n *\r\n * in some draw event?\r\n * out some draw event?\r\n *\r\n * that events can only go line this: down -> n x move -> up\r\n * so, sanitizes this: down, down, down. becomes only one down. the other downs are ignored/swallowed\r\n */\r\nexport class LineSanitizer {\r\n\r\n    private chainOut: ((drawEvent: TDrawEvent) => void) | undefined;\r\n    private isDrawing: boolean = false;\r\n\r\n    // --- public ---\r\n\r\n    chainIn (event: TDrawEvent): TDrawEvent | null {\r\n\r\n        if (event.type === 'down') {\r\n            if (this.isDrawing) {\r\n                //console.log('line sanitizer - down, but already drawing');\r\n                this.chainOut && this.chainOut({\r\n                    type: 'up',\r\n                    scale: event.scale,\r\n                    shiftIsPressed: event.shiftIsPressed,\r\n                    isCoalesced: false,\r\n                });\r\n            } else {\r\n                this.isDrawing = true;\r\n            }\r\n        }\r\n        if (!this.isDrawing && (event.type === 'move' || event.type === 'up')) {\r\n            //console.log('line sanitizer - ' + event.type + ' but not drawing');\r\n            return null;\r\n        }\r\n\r\n        if (event.type === 'up' && this.isDrawing) {\r\n            this.isDrawing = false;\r\n        }\r\n\r\n        return event;\r\n    }\r\n\r\n    setChainOut (func: (drawEvent: TDrawEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n}\r\n","/**\r\n * from stabilizer dropdown value to linesmoothing value\r\n * @param s\r\n */\r\nexport function translateSmoothing (s: number): number {\r\n    if (s == 1) {\r\n        return 1 - 0.5;\r\n    }\r\n    if (s == 2) {\r\n        return 1 - 0.16;\r\n    }\r\n    if (s == 3) {\r\n        return 1 - 0.035;\r\n    }\r\n    if (s == 4) {\r\n        return 1 - 0.0175;\r\n    }\r\n    if (s == 5) {\r\n        return 1 - 0.00875;\r\n    }\r\n    return s;\r\n}","import {IKlPsd, IRGB, TDropOption, TKlCanvasLayer} from '../klecks/kl-types';\r\nimport {KL} from '../klecks/kl';\r\nimport {LANG} from '../language/language';\r\nimport {BB} from '../bb/bb';\r\nimport {klHistory, TMiscImportImageHistoryEntry} from '../klecks/history/kl-history';\r\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\r\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\r\nimport {HandUi} from '../klecks/ui/tool-tabs/hand-ui';\r\nimport {LayerManager} from '../klecks/ui/tool-tabs/layer-manager/layer-manager';\r\nimport {IRect, ISize2D} from '../bb/bb-types';\r\n\r\n// todo later:\r\n// onImage: (project: IKlProject) => void\r\n// onLayer: (index: number, canvas: HMTLCanvasElement,layerName: string) => void\r\n\r\nexport class ImportHandler {\r\n\r\n    private readonly klRootEl: HTMLElement;\r\n    private readonly klMaxCanvasSize: number;\r\n    private readonly layerManager: LayerManager;\r\n    private readonly setCurrentLayer: (layer: TKlCanvasLayer) => void;\r\n    private readonly klCanvas: KlCanvas;\r\n    private readonly klCanvasWorkspace: KlCanvasWorkspace;\r\n    private readonly handUi: HandUi;\r\n\r\n    private readonly onColor: (rgb: IRGB) => void;\r\n\r\n\r\n    /**\r\n     *\r\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\r\n     * @param filename - string e.g. 'drawing.psd'\r\n     * @param optionStr? - 'default' | 'layer' | 'image'\r\n     */\r\n    private importFinishedLoading (\r\n        importedImage: IKlPsd | {\r\n            type: 'image';\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLCanvasElement | HTMLImageElement;\r\n        },\r\n        filename: string | undefined,\r\n        optionStr: 'default' | 'layer' | 'image',\r\n    ): void {\r\n        if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: LANG('import-broken-file'),\r\n                buttons: ['Ok'],\r\n            });\r\n            return;\r\n        }\r\n\r\n        const getResizedDimensions = (width: number, height: number): ISize2D => {\r\n            let w = parseInt('' + width);\r\n            let h = parseInt('' + height);\r\n            if (w > this.klMaxCanvasSize) {\r\n                h = this.klMaxCanvasSize / w * h;\r\n                w = this.klMaxCanvasSize;\r\n            }\r\n            if (h > this.klMaxCanvasSize) {\r\n                w = this.klMaxCanvasSize / h * w;\r\n                h = this.klMaxCanvasSize;\r\n            }\r\n            w = parseInt('' + w);\r\n            h = parseInt('' + h);\r\n            return {\r\n                width: w,\r\n                height: h,\r\n            };\r\n        };\r\n\r\n        const importAsImage = (canvas: HTMLCanvasElement | HTMLImageElement) => {\r\n            const resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\r\n\r\n            //resize first\r\n            const tempCanvas = BB.canvas(canvas.width, canvas.height);\r\n            const tempCanvasCtx = BB.ctx(tempCanvas);\r\n            tempCanvasCtx.drawImage(canvas, 0, 0);\r\n\r\n            BB.resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\r\n\r\n            this.klCanvas.reset({\r\n                width: resizedDimensions.width,\r\n                height: resizedDimensions.height,\r\n                image: tempCanvas,\r\n                layerName: filename,\r\n            });\r\n\r\n            this.layerManager.update(0);\r\n            this.setCurrentLayer(this.klCanvas.getLayer(0));\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        };\r\n\r\n        /**\r\n         *\r\n         * @param convertedPsdObj - if flattened then without layers\r\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\r\n         */\r\n        const importAsImagePsd = (convertedPsdObj: IKlPsd, cropObj?: IRect) => {\r\n\r\n            // crop\r\n            const crop = (\r\n                targetCanvas: HTMLCanvasElement,\r\n                cropCanvas: HTMLCanvasElement,\r\n                cropObj: IRect,\r\n            ): void => {\r\n                cropCanvas.width = cropCanvas.width;\r\n                BB.ctx(cropCanvas).drawImage(targetCanvas, -cropObj.x, -cropObj.y);\r\n                targetCanvas.width = cropObj.width;\r\n                targetCanvas.height = cropObj.height;\r\n                BB.ctx(targetCanvas).drawImage(cropCanvas, 0, 0);\r\n            };\r\n            if (cropObj && (cropObj.width !== convertedPsdObj.width ||cropObj.height !== convertedPsdObj.height)) {\r\n                const cropCanvas = BB.canvas(cropObj.width, cropObj.height);\r\n                convertedPsdObj.width = cropObj.width;\r\n                convertedPsdObj.height = cropObj.height;\r\n\r\n                if (!convertedPsdObj.layers) {\r\n                    crop(convertedPsdObj.canvas, cropCanvas, cropObj);\r\n                }\r\n                if (convertedPsdObj.layers) {\r\n                    for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                        const item = convertedPsdObj.layers[i];\r\n                        crop(item.image, cropCanvas, cropObj);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // resize\r\n            const resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\r\n            convertedPsdObj.width = resizedDimensions.width;\r\n            convertedPsdObj.height = resizedDimensions.height;\r\n            if (!convertedPsdObj.layers) {\r\n                BB.resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\r\n            }\r\n            if (convertedPsdObj.layers) {\r\n                for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                    const item = convertedPsdObj.layers[i];\r\n                    BB.resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\r\n                }\r\n            }\r\n\r\n            let layerIndex;\r\n            if (convertedPsdObj.layers) {\r\n                layerIndex = this.klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    layers: convertedPsdObj.layers,\r\n                });\r\n            } else {\r\n                layerIndex = this.klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    image: convertedPsdObj.canvas,\r\n                });\r\n            }\r\n            this.layerManager.update(layerIndex);\r\n            this.setCurrentLayer(this.klCanvas.getLayer(layerIndex));\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        };\r\n\r\n        const importAsLayer = (canvas: HTMLCanvasElement | HTMLImageElement) => {\r\n            KL.showImportAsLayerDialog({\r\n                target: this.klRootEl,\r\n                klCanvas: this.klCanvas,\r\n                importImage: canvas,\r\n                callback: (transformObj, isPixelated: boolean) => {\r\n                    if (!transformObj) {\r\n                        return;\r\n                    }\r\n\r\n                    klHistory.pause(true);\r\n                    this.klCanvas.addLayer();\r\n                    const layers = this.klCanvas.getLayers();\r\n                    const activeLayerIndex = layers.length - 1;\r\n                    if (filename) {\r\n                        this.klCanvas.renameLayer(activeLayerIndex, filename);\r\n                    }\r\n                    const activeLayerContext = this.klCanvas.getLayerContext(activeLayerIndex);\r\n                    BB.drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, null, isPixelated);\r\n                    this.setCurrentLayer(this.klCanvas.getLayer(activeLayerIndex));\r\n                    this.layerManager.update(activeLayerIndex);\r\n\r\n                    klHistory.pause(false);\r\n\r\n                    klHistory.push({\r\n                        tool: ['misc'],\r\n                        action: 'importImage',\r\n                        params: [BB.copyCanvas(activeLayerContext.canvas), filename],\r\n                    } as TMiscImportImageHistoryEntry);\r\n                },\r\n            });\r\n        };\r\n\r\n\r\n        if (optionStr === 'default' || !optionStr) {\r\n            KL.showImportImageDialog({\r\n                image: importedImage,\r\n                target: this.klRootEl,\r\n                maxSize: this.klMaxCanvasSize,\r\n                callback: (res) => {\r\n                    if (res.type === 'as-image') {\r\n                        importAsImage(res.image);\r\n                    } else if (res.type === 'as-image-psd') {\r\n                        importAsImagePsd(res.image, res.cropObj);\r\n                    } else if (res.type === 'as-layer') {\r\n                        importAsLayer(res.image);\r\n                    } else if (res.type === 'cancel') {\r\n                        // nothing to do\r\n                    }\r\n                },\r\n            });\r\n        }\r\n\r\n        if (optionStr === 'layer') {\r\n            importAsLayer(importedImage.canvas);\r\n        }\r\n        if (optionStr === 'image') {\r\n            if (importedImage.type === 'psd') {\r\n                importAsImagePsd(importedImage);\r\n            } else {\r\n                importAsImage(importedImage.canvas);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        input: {\r\n            klRootEl: HTMLElement;\r\n            klMaxCanvasSize: number;\r\n            layerManager: LayerManager;\r\n            setCurrentLayer: (layer: TKlCanvasLayer) => void;\r\n            klCanvas: KlCanvas;\r\n            klCanvasWorkspace: KlCanvasWorkspace;\r\n            handUi: HandUi;\r\n        },\r\n        callback: {\r\n            onColor: (rgb: IRGB) => void;\r\n        }\r\n    ) {\r\n        this.klRootEl = input.klRootEl;\r\n        this.klMaxCanvasSize = input.klMaxCanvasSize;\r\n        this.layerManager = input.layerManager;\r\n        this.setCurrentLayer = input.setCurrentLayer;\r\n        this.klCanvas = input.klCanvas;\r\n        this.klCanvasWorkspace = input.klCanvasWorkspace;\r\n        this.handUi = input.handUi;\r\n\r\n        this.onColor = callback.onColor;\r\n    }\r\n\r\n\r\n\r\n    // ---- interface ----\r\n\r\n    onPaste (e: ClipboardEvent): void{\r\n        if (KL.dialogCounter.get() > 0) {\r\n            return;\r\n        }\r\n\r\n        const retrieveImageFromClipboardAsBlob = (\r\n            items: DataTransferItemList,\r\n            callback: (file: File) => void,\r\n        ) => {\r\n            if (!items) {\r\n                return;\r\n            }\r\n            for (let i = 0; i < items.length; i++) {\r\n                if (items[i].type.indexOf('image') == -1) {\r\n                    continue;\r\n                }\r\n                const file = items[i].getAsFile();\r\n                file && callback(file);\r\n            }\r\n        };\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (!e.clipboardData) {\r\n            return;\r\n        }\r\n\r\n        if (e.clipboardData.files[0]) {\r\n            retrieveImageFromClipboardAsBlob(e.clipboardData.items, (imageBlob) => {\r\n                // If there's an image, display it in the canvas\r\n                const img = new Image();\r\n                img.onload = () => {\r\n                    URL.revokeObjectURL(img.src);\r\n                    this.importFinishedLoading({\r\n                        type: 'image',\r\n                        width: img.width,\r\n                        height: img.height,\r\n                        canvas: img,\r\n                    }, undefined, 'default');\r\n                };\r\n                const URLObj = window.URL || window.webkitURL;\r\n                img.src = URLObj.createObjectURL(imageBlob);\r\n            });\r\n        } else if (e.clipboardData.items[0]) {\r\n            e.clipboardData.items[0].getAsString((pasteStr) => {\r\n                pasteStr = pasteStr.trim();\r\n                if (pasteStr.match(/^https?/)) {\r\n                    // url\r\n                    const img = new Image();\r\n                    img.onload = () => {\r\n                        this.importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img,\r\n                        }, undefined, 'default');\r\n                    };\r\n                    img.onerror = (e) => {\r\n                        console.log('error loading', e);\r\n                    };\r\n                    img.crossOrigin = 'Anonymous';\r\n                    img.src = pasteStr;\r\n\r\n                } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\r\n                    // url\r\n                    const rgbObj = BB.ColorConverter.hexToRGB(pasteStr.replace('#', ''));\r\n                    rgbObj && this.onColor(rgbObj);\r\n                }\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    handleFileSelect (files: FileList, optionStr: TDropOption): void {\r\n\r\n        const showWarningPsdFlattened = () => {\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'warning',\r\n                message: LANG('import-psd-unsupported') + '<br /><br />',\r\n                buttons: ['Ok'],\r\n            });\r\n        };\r\n\r\n        let hasUnsupportedFile = false;\r\n        for (let i = 0, file; file = files[i]; i++) {\r\n            const nameSplit = file.name.split('.');\r\n            const extension = nameSplit[nameSplit.length - 1].toLowerCase();\r\n            if (extension === 'psd') {\r\n\r\n                ((f) => {\r\n                    const loaderSizeBytes = 1024 * 1024 * 25; // 25mb\r\n                    const maxSizeBytes = 1024 * 1024 * 1024; // 1gb\r\n                    const maxResolution = 4096;\r\n\r\n                    if (f.size >= maxSizeBytes) { // pretty likely to break stuff\r\n                        KL.popup({\r\n                            target: this.klRootEl,\r\n                            type: 'error',\r\n                            message: 'File too big. Unable to import.<br /><br />',\r\n                            buttons: ['Ok'],\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    const doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\r\n                    let loaderIsOpen = true;\r\n                    let closeLoader: (() => void) | null;\r\n\r\n                    if (doShowLoader) {\r\n                        KL.popup({\r\n                            target: this.klRootEl,\r\n                            message: LANG('import-opening'),\r\n                            callback: (result) => {\r\n                                loaderIsOpen = false;\r\n                                closeLoader = null;\r\n                            },\r\n                            closeFunc: (f) => {\r\n                                closeLoader = f;\r\n                            },\r\n                        });\r\n                    }\r\n\r\n\r\n                    const reader = new FileReader();\r\n                    reader.onload = (readerResult) => {\r\n\r\n                        KL.loadAgPsd().then((agPsdLazy) => {\r\n\r\n                            if (doShowLoader && !loaderIsOpen) {\r\n                                return;\r\n                            }\r\n\r\n                            try {\r\n                                let psd;\r\n\r\n                                // first pass, only read metadata\r\n                                psd = agPsdLazy.readPsd(\r\n                                    (readerResult.target.result as any),\r\n                                    {\r\n                                        skipLayerImageData: true,\r\n                                        skipThumbnail: true,\r\n                                        skipCompositeImageData: true,\r\n                                    });\r\n                                if (psd.width > maxResolution || psd.height > maxResolution) {\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    KL.popup({\r\n                                        target: this.klRootEl,\r\n                                        type: 'error',\r\n                                        message: LANG('import-psd-too-large').replace(/{x}/g, '' + maxResolution)\r\n                                            + '<br /><br />'\r\n                                            + LANG('import-psd-size') + ': ' + psd.width + ' x ' + psd.height + ' pixels'\r\n                                            + '<br /><br />'\r\n                                        ,\r\n                                        buttons: ['Ok'],\r\n                                    });\r\n                                    return;\r\n                                }\r\n\r\n\r\n                                // second pass, now load actual data.\r\n                                psd = null;\r\n\r\n                                try {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any));\r\n                                } catch (e) {\r\n                                    //console.log('failed regular psd import', e);\r\n                                }\r\n                                if (psd) {\r\n                                    //console.log('psd', psd);\r\n                                    const convertedPsd = KL.PSD.readPsd(psd);\r\n                                    //console.log('converted', convertedPsd);\r\n                                    if (optionStr === 'image' && convertedPsd.error) {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    this.importFinishedLoading(convertedPsd, f.name, optionStr);\r\n                                } else {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any), { skipLayerImageData: true, skipThumbnail: true });\r\n                                    if (optionStr === 'image') {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    this.importFinishedLoading({\r\n                                        type: 'psd',\r\n                                        width: psd.width,\r\n                                        height: psd.height,\r\n                                        canvas: psd.canvas,\r\n                                        error: true,\r\n                                    }, f.name, optionStr);\r\n                                }\r\n\r\n                            } catch (e) {\r\n                                closeLoader && closeLoader();\r\n                                KL.popup({\r\n                                    target: this.klRootEl,\r\n                                    type: 'error',\r\n                                    message: 'Failed to load PSD.<br /><br />',\r\n                                    buttons: ['Ok'],\r\n                                });\r\n                                console.log(e);\r\n                                setTimeout(() => {\r\n                                    throw new Error('psd load error');\r\n                                });\r\n                            }\r\n                        }).catch((e) => {\r\n                            closeLoader && closeLoader();\r\n                            alert('Error: failed to load PSD library');\r\n                        });\r\n\r\n                    };\r\n                    reader.readAsArrayBuffer(f);\r\n                })(file);\r\n\r\n            } else if (file.type.match('image.*')) {\r\n                ((f) => {\r\n                    window.URL = window.URL || window.webkitURL;\r\n                    const url = window.URL.createObjectURL(f);\r\n                    const im = new Image();\r\n                    im.src = url;\r\n                    BB.loadImage(im, () => {\r\n                        this.importFinishedLoading({\r\n                            type: 'image',\r\n                            width: im.width,\r\n                            height: im.height,\r\n                            canvas: im,\r\n                        }, f.name, optionStr);\r\n                    });\r\n                })(file);\r\n            } else {\r\n                hasUnsupportedFile = true;\r\n            }\r\n        }\r\n        if (hasUnsupportedFile) {\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                message: LANG('import-unsupported-file'),\r\n                type: 'error',\r\n                buttons: ['OK'],\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\n\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kycpJ\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"TzbtI\");","import {IVector2D} from '../bb/bb-types';\r\n\r\n\r\n\r\nexport type TConsoleApi = {\r\n    readonly draw: (path: IVector2D[]) => void;\r\n    readonly help: () => void;\r\n};\r\n\r\nexport function createConsoleApi (\r\n    p: {\r\n        onDraw: (path: IVector2D[]) => void;\r\n    }\r\n): TConsoleApi {\r\n\r\n    const output = ['Draw via the console! Learn more: %cKL.help()', 'background: #000; color: #0f0;'];\r\n    'info' in console ? console.info(...output) : console.log(...output);\r\n\r\n    return Object.freeze({\r\n        draw: (path: IVector2D[]): void => {\r\n            p.onDraw(path);\r\n        },\r\n        help: (): void => {\r\n            console.log(`KL.draw({x: number; y: number}[]) // draw a line\r\nKL.help() // print help\r\n`);\r\n        },\r\n    });\r\n}"],"names":["$3kC7t","parcelRequire","$d2fa9a947070c225$export$a84540bc8b694b2d","p","klApp","agPsd","onProjectReady","project","isInitialized","Error","saveReminder","$5ngYX","SaveReminder","$gWfkn","klHistory","isDrawing","$3C7jC","KlApp","bottomBar","aboutEl","embed","url","embedUrl","onSubmit","init","loadingScreenEl","parentNode","removeChild","loadingScreenTextEl","document","body","append","getEl","e","textContent","className","console","error","psdQueue","getElementById","$1mH1z","LANG","this","openProject","initError","getPNG","getPSD","default","_state","sent","readPSDs","psds","length","readItem","item","psd","readPsd","blob","$941rU","klPsdToKlProject","callback","forEach","shift","push","Element","prototype","Object","defineProperty","value","x","y","scrollLeft","scrollTop","Array","flat","configurable","depth","isNaN","arguments","Number","reduce","call","acc","cur","isArray","apply","slice","writable","window","getItem","setItem","removeItem","t","n","createDocumentFragment","Node","appendChild","createTextNode","String","Document","DocumentFragment","hasOwnProperty","enumerable","insertBefore","firstChild","padStart","repeat","findIndex","r","TypeError","o","i","$iUR3L","importFilters","$cf5d938ee512ebca$export$96f6458b62e4c2c","pProject","pOptions","_pOptions_app","$7U0Ew","$3WOmu","klCanvasToPsdBlob","_this1","klCanvas","klMaxCanvasSize","Math","min","max","screen","width","height","uiState","$6l0gQ","LocalStorage","filenameBase","app","projectStore","klRootEl","$eWjiX","BB","el","css","position","left","top","right","bottom","uiWidth","innerWidth","uiHeight","innerHeight","exportType","$hrnUX","KL","KlCanvas","projectObj","collapseThreshold","toolWidth","setHistory","mainTabRow","initState","reset","layers","layer","image","pause","addLayer","layerFill","$fohxs","ERASE_COLOR","g","b","canvas","copy","focus","getLayerCount","brushes","message","destroy","entries","param","_param","Brush","setContext","getLayerContext","currentBrushUi","currentBrushId","lastNonEraserBrushId","currentColor","RGB","currentLayerCtx","sizeWatcher","val","brushSettingService","emitSize","_this","klCanvasWorkspace","setCursorSize","BrushSettingService","color","klColorSlider","setColor","copyObj","size","setSize","opacity","setOpacity","getColor","brushUiMap","getSize","getOpacity","sizeSlider","brushesUI","opacitySlider","lineSmoothing","$iuTWx","LineSmoothing","smoothing","$aId1u","translateSmoothing","lineSanitizer","$57YJz","LineSanitizer","drawEventChain","EventChain","chainArr","setChainOut","event","type","toolspace","style","pointerEvents","startLine","pressure","requestFrame","goLine","isCoalesced","setLastDrawEvent","endLine","getBrush","drawLineSegment","x0","y0","x1","y1","textToolSettings","align","isBold","isItalic","font","KlCanvasWorkspace","onDraw","chainIn","onPick","rgbObj","isDragDone","pickingDone","setMode","toolspaceToolRow","getActive","onFill","canvasX","canvasY","layerIndex","getLayerIndex","floodFill","fillUi","getIsEraser","getTolerance","getSample","getGrow","getContiguous","onGradient","typeStr","angleRad","gradientTool","onDown","onMove","onUp","onText","dialogCounter","get","textToolDialog","secondaryColor","getSecondaryRGB","onConfirm","colorRGBA","a","text","textStr","ColorConverter","toRgbaStr","onShape","shapeTool","onViewChange","viewChangeObj","changed","includes","statusOverlay","out","scale","angleDeg","angle","PI","setEnableZoomIn","getMaxScale","setEnableZoomOut","getMinScale","handUi","update","onUndo","canUndo","undoRedoCatchup","undo","onRedo","canRedo","redo","overlayToolspace","toolspaceTopRow","updateMainTabVisibility","activeStr","oldTabId","getOpenedTabId","keysArr","keys","draw","hand","fill","gradient","shape","setIsVisible","open","keyListener","KeyListener","keyStr","comboStr","isInputFocused","getIsDrawing","zoomByStep","isPressed","fitView","resetView","preventDefault","sameKeys","saveToComputer","save","success","_$e","store","getProject","setTimeout","copyToClipboard","comboOnlyContains","translateView","setAngle","getScale","getAngleDeg","decreaseSize","increaseSize","eraserBrush","getIsTransparentBg","clearLayer","setActive","brushTabRow","prevMode","getMode","keyArr","filter","getNextBrushId","newMode","swapColors","ui","Ui","onSizeChange","onOpacityChange","emitOpacity","onConfigChange","emitSliderConfig","getElement","padding","StatusOverlay","overflow","userSelect","touchAction","toolspaceInner","parent","oncontextmenu","onclick","handleClick","toolspaceCollapser","ToolspaceCollapser","onChange","updateCollapse","OverlayToolspace","enabledTest","$jmL5A","EmbedToolspaceTopRow","onHelp","$h62LS","showIframeModal","popup","target","buttons","result","overlay","content","onLeftRight","updateUi","ToolspaceTopRow","logoImg","onLogo","onNew","showNewImageDialog","onImport","fileTab","triggerImport","onSave","onShare","shareImage","marginBottom","ToolspaceToolRow","onActivate","onZoomIn","onZoomOut","setIsSmall","addListener","setEnableUndo","setEnableRedo","KlColorSlider","svHeight","startValue","p_color","emitColor","setHeight","setPickCallback","doPick","setCurrentLayer","context","layerPreview","setLayer","brushDiv","colorDiv","margin","display","flexWrap","justifyContent","alignItems","toolspaceStabilizerRow","ToolspaceStabilizerRow","onSelect","v","setSmoothing","getOutputElement","TabRow","initialId","useAccent","tabArr","createTab","id","title","tooltip","onOpen","brushId","enable","onClose","concat","$4Ea8f","map","HandUi","onReset","onFit","onAngleChange","isRelative","FillUi","colorSlider","gradientUi","GradientUi","textUi","TextUi","shapeUi","ShapeUi","GradientTool","isDone","x2","y2","settings","getSettings","gradientObj","color1","isReversed","doLockAlpha","isEraser","doSnap","setComposite","drawGradient","ctx","ShapeTool","shapeObj","getShape","isOutwards","getIsOutwards","getDoLockAlpha","strokeRgb","lineWidth","getLineWidth","isAngleSnap","getIsSnap","isFixedRatio","getIsFixed","fillRgb","drawShape","layerManager","LayerManager","getLayer","tool","action","params","LayerPreview","onClick","filterTab","FilterTab","UndoRedoCatchup","catchup","newImageDialog","maxCanvasSize","canvasWidth","getWidth","canvasHeight","getHeight","workspaceWidth","workspaceHeight","onCancel","shareCanvas","getCompleteCanvas","fileName","getDate","SaveToComputer","showCrop","clipboardDialog","inputObj","filterLib","cropExtend","input","history","FileTab","files","optionsStr","importHandler","handleFileSelect","imgurUpload","imgurKey","settingsTab","SettingsTab","$parcel$interopDefault","$8dsYZ","minWidth","$4sBxW","isVisible","$6iPxE","$fZtJh","$eOZOu","$haxur","$i7SrA","label","show","hide","$fX22P","bottomBarWrapper","MutationObserver","updateBottomBar","observe","attributes","childList","subtree","undefined","toolspaceScroller","ToolspaceScroller","$qur3y","createConsoleApi","path","index","resize","$iG6pP","ImportHandler","onColor","rgb","KlImageDropper","onDrop","optionStr","addEventListener","onPaste","windowResizeWatcher","zIndex","ResizeObserver","prevent","key","setDirection","isOpen","setWide","scrollHeight","classList","toggle","setUiState","updateUiState","w","h","scrollY","scrollTo","msg","$2wCWz","base64ToBlob","toDataURL","$3wEFn","$1ac26b9c3b886816$export$2e2bcd8739ae039","arr","$8XIsj","$jBmMa","$hhqk6","$apgdg","$46241077d0115b39$export$2e2bcd8739ae039","$4deb7017c774789d$export$2e2bcd8739ae039","$9cbe98d1fb398012$export$6e4a713ddcda1e5e","$dAXbp","$3P46L","$7pyBK","$705qg","drawProject","$aSJRf","WorkspaceSvgOverlay","$7bo3M","$lV6Vy","KlCanvasPreview","$i5nyl","filterLibStatus","$kyVjY","$6rdi0","renderText","$h20yl","floodFillBits","$30Cml","$3ujzu","$7EG77","PSD","setDbName","$9BlwZ","indexedDb","ProjectStore","$6mTnI","loadAgPsd","$lkluh","$eyygR","calcSliderFalloffFactor","$11glk","Checkbox","$7bWhB","$dJPtW","Select","$eEL9N","ImageToggle","$1kyaA","ImageRadioList","$4nUqS","RadioList","$fRGIf","createPenPressureToggle","$lCF5N","KlSlider","$aP0jf","HexColorDialog","$lfHl9","$fg9Sv","KlColorSliderSmall","$gmji4","PointSlider","$j5jvd","ColorOptions","$43qNf","Options","$iFIyy","BoxToggle","$cmnov","$bmB93","CropCopy","$hRdOL","FreeTransform","$cNhNm","FreeTransformCanvas","$kEeSq","Cropper","$32CBv","$kqmpc","$13r5y","$9p4Zp","$8jqzp","ToolDropdown","$84zxV","$9Kxky","$1Ax5m","$e4sAN","$1uc3b","BrowserStorageUi","$9pcu9","$iVHpg","$i8UFO","$2MaaK","showModal","Popup","$dLlkc","DynamicModal","$isYih","showImportAsLayerDialog","$8ebuX","$76Qvv","$keKW3","showImportImageDialog","$kDGzx","showIframePopup","$5ENro","$khi8I","$dJXmR","$5Gc7M","$iS9xS","$9J17G","$eK8ID","$2umOB","$bIgqE","$jMW1P","DecoyKlHistory","$gFgFC","$b60fce38973759d6$var$historyInstance","$b60fce38973759d6$export$2a772a91f059c0f9","$b60fce38973759d6$export$28b6f4d98dde9845","KlHistory","state","listeners","pauseStack","maxState","actionNumber","l","newEntry","pop","lastEntry","maxBefore","broadcast","bufferUpdate","$7jh4K","throwIfNull","$c902829f68f42bce$export$d7e8d4d4450c819c","close","isClosed","clearSelection","unfocusAnyInput","rootRootEl","decrease","destroyEl","xButton","bgEl","rootEl","removeEventListener","wheelPrevent","btnElArr","splice","increase","scrollContent","minHeight","flexDirection","ignoreBackground","tagName","$6ToP3","titleHeight","lineHeight","background","boxShadow","boxClasses","boxEl","div","marginRight","join","flex","add","autoFocus","clickOnEnterBtn","stopPropagation","click","buttonRowEl","marginTop","marginLeft","buttonName","iconUrl","btnClasses","primaries","$d2FVM","iconImg","custom","src","btn","clickOnEnter","closeFunc","$dd0d395ff14a3e11$export$17eb8275e0c4cab8","DialogCounter","count","emit","listener","$05ec456c8871d48f$export$921068d8846a1559","eventUsesHighResTimeStamp","$6J2My","hasPointerEvents","hasWebGl","isCssMinMaxSupported","canShareFiles","insertAfter","loadImage","setAttributes","fitInto","centerWithin","gcd","decToFraction","imageBlobToUrl","dateDayDifference","createSvg","BbLog","$i0uIf","isDark","mix","$eg83P","dist","distSquared","lenSquared","pointsToAngleRad","pointsToAngleDeg","isInsideRect","clamp","rotate","rotateAround","Matrix","$kVHNC","Vec2","$4toIY","intDxy","roundEven","roundUneven","round","updateBounds","boundsInArea","projectPointOnLine","$af1iA","PointLine","BezierLine","SplineInterpolator","quadraticSplineInput","$eelgW","createCanvas","$eIcQa","copyCanvas","testShouldPixelate","drawTransformedImageWithBounds","drawTransformedImageOnCanvas","createCheckerCanvas","createCheckerDataUrl","resizeCanvas","convertToAlphaChannelCanvas","freeCanvas","canvasBounds","HSV","$dJ1E2","CMYK","testIsWhiteBestContrast","appendTextDiv","$72Jv0","makeUnfocusable","$idV3L","PointerListener","$04lDo","$gCzYB","DoubleTapper","$c1lmK","NFingerTapper","$2pgVs","PinchZoomer","$joplQ","CoalescedExploder","$jjWRi","OnePointerLimiter","$635F6","hasWebgl","test","$878b1f179a521546$export$b7d78993b74f766d","navigator","userAgent","toLowerCase","indexOf","$878b1f179a521546$export$4ec3bfbae69fbb50","Event","timeStamp","$878b1f179a521546$export$b7b64c480b083ae0","PointerEvent","$878b1f179a521546$export$9cbe517943afd6db","getContext","premultipliedAlpha","$878b1f179a521546$export$fe0a7220ab4eecad","createElement","offsetLeft","$878b1f179a521546$export$558f5e20caee48c2","$44dda2e48e48a872$export$cd3d1f114b139967","keyDown","keyUp","blur","keyStrToKeyObj","keyStrArr","isDownObj","keyToKeyStrObj","comboArr","codeIsDownObj","listenerArr","emitDown","emitUp","emitBlur","$74d1f29ad2137b2c$var$globalKey","code","oldComboStr","eventArr","space","alt","ctrl","cmd","enter","esc","backspace","delete","sqbr_open","sqbr_close","c","f","s","u","z","plus","minus","up","down","home","end","d","keyListenerRef","first","remove","last","getIsDown","getCombo","$74d1f29ad2137b2c$export$f17908c5de22d32e","onBlur","ref","$74d1f29ad2137b2c$export$e9f65b0175de4c03","comboAStr","comboBStr","split","sort","$893e90c2dcf687ac$var$pointerArr","$893e90c2dcf687ac$var$getButtonStr","$893e90c2dcf687ac$var$pressureNormalizer","$eIAon","PressureNormalizer","$893e90c2dcf687ac$var$timeStampOffset","performance","timing","navigationStart","$893e90c2dcf687ac$var$pointerDownEvt","$893e90c2dcf687ac$var$pointerMoveEvt","$893e90c2dcf687ac$var$pointerUpEvt","$893e90c2dcf687ac$var$pointerCancelEvt","$893e90c2dcf687ac$var$pointerLeaveEvt","$893e90c2dcf687ac$var$pointerEnterEvt","$893e90c2dcf687ac$var$correctPointerEvent","corrected","correctedObj","pointerId","pointerType","pageX","pageY","clientX","clientY","movementX","movementY","normalize","button","coalescedArr","eventPreventDefault","eventStopPropagation","customPressure","isFirefox","coalescedEventArr","getCoalescedEvents","pointerObj","$893e90c2dcf687ac$var$getPointer","lastPageX","lastPageY","$893e90c2dcf687ac$var$addPointer","totalLastX","totalLastY","eventItem","$893e90c2dcf687ac$export$9371bd96776f4e82","targetElement","onPointerCallback","onPointer","onWheelCallback","onWheel","onEnterLeaveCallback","onEnterLeave","maxPointers","wheelCleaner","$93oLo","WheelCleaner","cleanerEvent","isDestroyed","bounds","getBoundingClientRect","whlEvent","$a7ch7","$3Rl3W","relX","relY","onPointerMove","correctedEvent","tempLastPointerType","lastPointerType","dragPointerIdArr","didSkip","outEvent","createPointerOutEvent","onPointerDown","onSkipGlobal","dragObjArr","setupDocumentListeners","dragObj","downPageX","downPageY","lastTimeStamp","windowOnPointerMove","getDragObj","outEvent1","destroyDocumentListeners","removeDragObj","windowOnPointerUp","windowOnPointerLeave","touchToFakePointer","touch","touchEvent","isDown","identifier","handleTouch","changedTouches","fakePointer","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel","process","onPointerEnter","isOverCounter","onPointerLeave","fixScribble","onTouchMoveScribbleFix","removedDragObj","dX","dY","time","coalescedItem","$42238a223231ec71$export$c734b8535f2f8e38","knownUnitArr","sequenceLength","sequenceUnit","toEmitDelta","delta","deltaY","endSequenceTimeout","clearTimeout","endSequence","deltaMode","absDelta","abs","$e14d50e39929aa54$export$61f95f4b79132931","avgPressure","normalizeIsComplete","normalizeFactor","pow","$9a5bdb07e7a7c42f$export$2c9e8a9632a706b2","$9a5bdb07e7a7c42f$export$6c4a311cc157c764","ax","ay","bx","by","sqrt","$9a5bdb07e7a7c42f$export$499eb56409f6cbc2","$9a5bdb07e7a7c42f$export$a4f99f99d3e99cfa","$9a5bdb07e7a7c42f$export$627023b405ba5028","p1","p2","atan2","$9a5bdb07e7a7c42f$export$c03a8450eabc2532","$9a5bdb07e7a7c42f$export$151bd845d70e2099","rect","$9a5bdb07e7a7c42f$export$7d15b64cf5a3a4c4","num","$9a5bdb07e7a7c42f$export$bb628a54ab399bc9","deg","theta","cs","cos","sn","sin","$9a5bdb07e7a7c42f$export$95ec0760d3d00713","center","point","rot","$9a5bdb07e7a7c42f$export$bbf9af158036c5e9","remainder","fDx","fDy","$9a5bdb07e7a7c42f$export$94cce7adf2ec2d08","above","ceil","below","floor","$9a5bdb07e7a7c42f$export$f373b6a7b0c159a","$9a5bdb07e7a7c42f$export$2077e0241d6afd3c","digits","digitMult","$9a5bdb07e7a7c42f$export$f4467a4f41373bc7","$9a5bdb07e7a7c42f$export$bbb91bbc54e7d9ac","$3f0e2f35371c9852$export$dd0873c0fb3ccff6","resultCanvas","drawImage","$3f0e2f35371c9852$export$39f92e86d1722f3a","$3f0e2f35371c9852$export$1555f643cc9a976","transform","scaleX","scaleY","whSwapped","$3f0e2f35371c9852$export$ded2b43392504635","destCtx","transformImage","pixelated","imageSmoothingEnabled","imageSmoothingQuality","translate","restore","$3f0e2f35371c9852$export$425a419ef9fc761f","baseCanvas","transformObj","angleDegree","cache","$3f0e2f35371c9852$export$754559b36e94ea2f","fillStyle","fillRect","$3f0e2f35371c9852$export$42af33c76b681867","create","parseInt","modeStr","$3f0e2f35371c9852$export$59b33278b5b2fc8a","tmp1","tmp2","oldW","oldH","newW","newH","ew","eh","base2","oldWidthEx","log2","oldHeightEx","newWidthEx","newHeightEx","buffer1","buffer2","bufferCtx","globalCompositeOperation","currentWidth","currentHeight","newWidth","newHeight","tmp","canvasCtx","tmp1Ctx","$3f0e2f35371c9852$export$5a7576952c826b4f","imdat","getImageData","data","putImageData","$3f0e2f35371c9852$export$2384aff49c9b73c2","clearRect","$3f0e2f35371c9852$export$3db033c6ee0b8700","boundsObj","tempBounds","$e4df33b4b16105d5$var$multiplyMatrixAndPoint","matrix","$e4df33b4b16105d5$export$5b12bf1653c0dd85","freeze","getIdentity","multiplyMatrixAndPoint","multiplyMatrices","matrixA","matrixB","row0","row1","row2","row3","result0","result1","result2","result3","createTranslationMatrix","createRotationMatrix","createScaleMatrix","$531c9f41f98b7ec0$export$ac4bca90992eed1","sub","nor","len","mul","dot","aArr","bArr","m","$77ae015f37ebe4f1$export$b4c5b177db876445","lineStart","lineEnd","$77ae015f37ebe4f1$export$8b36a4a83269a640","segmentArr","points","getLength","fac","$77ae015f37ebe4f1$export$5379d955c16d4d43","pointArr","p3","p4","resolution","curvePoints","spacing","controlsCallback","lastPoint","dir","lastDot","lastSpacing","pointM1","pointM2","pointM3","pointLine","getBezierPoints","tempSpacing","getAtDist","lastCallbackPoint","dAngle","lastAngle","newP","$77ae015f37ebe4f1$export$80967b1eb9fd6eb4","xa","ya","wx","sig","ddydx","klo","khi","k","tempX","tempY","interpolate","tempDist","$77ae015f37ebe4f1$export$4551d4af86c1eb08","startVal","endVal","stepSize","dec","resultArr","$5e7aac2fa49b6b1f$export$d2edaecd208aed43","$5e7aac2fa49b6b1f$export$8f9ece5a47764b93","$5e7aac2fa49b6b1f$export$89d3f85304bf0767","$5e7aac2fa49b6b1f$export$fb7efcd2e153af6e","_RGBtoHSV","minVal","maxVal","del_R","del_G","del_B","_HSVtoRGB","var_h","var_i","var_1","var_2","var_3","var_r","var_g","var_b","_CMYKtoRGB","_RGBtoCMYK","toRGB","toHSV","toCMYK","toHexString","ha","toString","hb","hc","toRgbStr","rgbaObj","hexToRGB","hexStr","trim","replace","exec","$5e7aac2fa49b6b1f$export$5cf396345d1238ae","$cfe3aa45a75894cc$export$7868464f598ba79d","innerHTML","$cfe3aa45a75894cc$export$906dfdb7df31ccfc","_document_activeElement","getAll","activeElement","getAttribute","$cfe3aa45a75894cc$export$e05240ca9e0b8bd9","focusEl","select","$cfe3aa45a75894cc$export$a3d02541b0ebf605","getSelection","sel","empty","removeAllRanges","selection","preventFocus","$cfe3aa45a75894cc$export$6bd63bfceaafae0c","didFocusRelated","relatedTarget","currentTarget","setAttribute","$cfe3aa45a75894cc$var$els","$cfe3aa45a75894cc$export$c3da0dad1b44eea9","customKeyArr","$cfe3aa45a75894cc$export$b1da1db524e22115","$0d0e99c175410ac4$export$9860cd9e09e6f8ba","$9e5fd8359d8b22f2$export$19fffca37ef3e106","localStorage","$d2c9f6aa6c7498f1$export$fe11e0afe623a677","func","chainOut","eventCopy","$cc27951506e6ad28$export$510622b8aed00381","now","firstLastDownTimeout","tapTimeout","fingers","onTap","eventQueueArr","timeoutObj","fingerArr","timeoutStr","timeMS","diff","nowTime","failGesture","tempLastEventTime","lastEventTime","pointersDownIdArr","maxFirstLastFingerDownMs","downTimeMs","minSilenceBeforeDurationMs","firstDownTime","setupTimeout","maxTapMs","fingerObj","i1","maxPressedDistancePx","fingerObj1","i2","isUp","allAreUp","i3","processEvent","$670d2777518c365a$export$d62358ac2d82abb3","secondFingerTimeout","onPinch","gestureObj","doSwallow","fail","touchPointerArr","isInProgress","continuePinch","beginPinch","otherPointerIdArr","downRelX","downRelY","setupFailTimeout","untilSecondFingerDurationMs","endPinch","touchPointerObj","firstFingerMaxDistancePx","pincherArr","actionObj","startDist","distance","startAngle","$f607ef98ce9eccdc$export$db3963a21c01d803","maxUntilSecondDown","onDoubleTap","gestureFailed","sequenceArr","lastSequenceItem","targetFunc","allowedPointerTypeArr","lastUpTime","allowedButtonArr","maxInbetweenDistancePx","maxUntilSecondDownDurationMs","maxPressedDurationMs","maxUpToUpDurationMs","minSilenceAfterMs","$956c5ff01a38849f$export$71ff2f51bf1f4062","ignorePointerIdArr","downPointerId","$4fb7927cde0b2f75$export$649a211db9812745","continueChain","onscroll","module","exports","getBundleURL","resolve","$e59fbd08bcc1a36b$export$185108a9b725b68","animationName","animationDuration","animationTimingFunction","popupEl","borderRadius","updatePos","elW","offsetWidth","elH","offsetHeight","titleEl","paddingLeft","tabindex","contentEl","$365a915dfb503274$export$48513f6b9f8ce62d","doHighlight","element","innerEl","check","checked","allowTab","tabIndex","allowClick","onchange","$f18fe37a308c53fd$export$b7e3ae3d7c15e42e","$7a3263857aacf58f$export$ef9b1a59e592288f","selectEl","cursor","fontSize","isFocusable","optionArr","changeListener","getValue","initValue","option","option1","$8fa94d142febb502$export$b6d053cded550773","isActive","darkInvert","backgroundImage","isRadio","$8cb981a3c9e5b15b$export$7cc1012a658e6ad8","initialIndex","createOption","initId","radioEl","activeIndex","setValue","$a49c90053f8766a2$export$9da2e8821e6cbb57","isChecked","changeCallback","$8IsQq","backgroundSize","backgroundRepeat","$afe02cc26c765c2c$export$2358c75ad3c15b2d","$5c0625e6104e2c75$export$a1855b925e534de7","isEnabled","manualInputRoundDigits","useSpline","curve","elementWidth","elementHeight","toValue","toDisplayValue","displayValueToValue","displayValue","valueToDisplayValue","isChangeOnFinal","formatFunc","eventResMs","curveArr","splineInterpolator","sliderWrapperEl","labelFontSize","textEl","control","valueToSliderValue","controlInner","updateEnable","doubleTapper","showManualInput","setAllowedButtonArr","virtualVal","eventChain","pointerListenerTimeout","pointerListener","sliderValue","sliderValueToValue","updateLabel","deltaX","sliderValue1","findX","toLocaleString","languageStrings","getCode","isFinal","emitInterval","clearInterval","emitValue","setInterval","manualInput","setIsEnabled","$869o9","KlSliderManualInput","config","isDisabled","$16ee6d1163eaf409$export$f8e41e222e32615d","isRightButton","$068903cd1342554f$export$db3d4fde05db9a5e","roundDigits","currentValue","onblur","privateOnClose","scrollBefore","scrollX","lastValue","$dada52d673c8c4ac$export$cc42e119007cb939","createRgbInputRow","labelStr","attributeStr","rowEl","labelEl","inputEl","lastValidRgb","parseFloat","previewEl","hexInput","hexRowEl","hexLabel","rgbArr","copyButton","$bJupx","execCommand","resultStr","$0ebf4eb3a9343b24$export$4e5102252876c5d7","outputDiv","primaryColorRGB","primaryColorHSV","secondaryColorRGB","secondaryColorHSV","svWrapper","svSvg","DOMParser","parseFromString","documentElement","hueStop","querySelector","divH","divPreview","controlH","updateSVCanvas","SVContainer","pointerSV","updateSVPointer","borderLeft","virtualHSV","pickerButton","$6fV2b","backgroundPosition","isPicking","pickCallback","isOver","hexButton","setColPreview","targetEl","im","Image","cv","gradH","createLinearGradient","col","addColorStop","createHueBg","factor","secondaryColorBtn","updateSecondaryColor","hsv","backgroundColor","updatePrimaryHSV","$00f785a5ea9e210d$export$e4203cb02d5e5b28","theme","$3ce0af1e789f1ab4$export$66306bf21a9ff39e","heightSV","canvasSV","updateSV","canvasH","heightH","cssFloat","pointerH","borderRight","updateHPointer","svPointerId","svPointerListener","hPointerId","hPointerListener","clear","gradient1","colleft","colright","$5e81242a941997c7$export$ac00cea56cec3037","sliderPos","pointSize","sliderPoint","isFirst","imaginaryPos","redrawPoint","$4db8cbbb01889095$export$24ba9b81662d4366","selectedIndex","colorArr","buttonArr","checkerUrl","$1C8RU","found","sItem","colorButton","buttonSize","setIsSelected","updateCheckerboard","addIsDarkListener","removeIsDarkListener","$7960d0c50ff12b0d$export$c019608e5b5bb4cb","wrapperEl","selectedId","classArr","isSmall","optionObj","changeOnInit","getIndex","$c1a93a3cd82636c9$export$5ee0af1d5c87e856","removeProperty","isWide","angleIm","$gGQwz","verticalAlign","innerInnerEl","doPulse","animation","timeout3","timeout","timeout2","$01fcd0ed15aa4018$export$40175a5948a88a57","resetCrop","croppedCanvas","eventTarget","isNotCopy","croppedImage","updateCroppedCanvas","previewWrapper","thumbSize","thumbCanvas","imageRendering","scaleW","scaleH","thumbCtx","thumbX","thumbY","selectionRect","updateSelectionRect","startP","updateCropTimeout","toOriginalSpace","genCrop","topLeftP","bottomRightP","origTopLeftP","origBottomRightP","startCrop","isDragging","didMove","isReset","crop","doUpdate","shiftIsPressed","$ffd40240385bb9f9$export$32b89bc9bb92706a","fullCanvas","cropCallback","output","toClipboard","imgURL","cropCopy","getCroppedImage","err","fetch","clipboard","write","ClipboardItem","name","clipboardItemIsSupported","topWrapper","textAlign","KeyEvent","rectObj","getRect","$82406ffdc1235dbb$export$eff87c52915dd7fe","parentEl","layerElArr","layerHeight","layerSpacing","largeThumbDiv","border","transition","largeThumbCanvas","largeThumbInDocument","klCanvasLayerArr","getLayers","selectedSpotIndex","listDiv","layerListEl","addBtn","duplicateBtn","mergeBtn","removeBtn","modeWrapper","renameBtn","paddingRight","$hWVsV","$5Ycub","$jKBKm","$auzYC","$1Qqvs","MAX_LAYERS","disabled","createLayerList","duplicateLayer","removeLayer","$6NMo1","mergeLayerDialog","topCanvas","bottomCanvas","topOpacity","mixModeStr","mode","mergeLayers","renameLayer","modeSelect","$bBcC4","translateBlending","setMixMode","historyState","getState","oldHistoryState","spot","thumb","oldSpotIndex","newSpotIndex","posy","posY","moveLayer","newspot","lastpos","layerSpot","$jneUH","renameLayerDialog","newName","createLayerEntry","layerName","layercanvas","innerLayer","container1","container2","oldOpacity","thumbDimensions","thc","whiteSpace","ondblclick","opacityLabel","isLast","layerOpacity","onpointerover","largeThumbInTimeout","largeThumbTimeout","onpointerout","dragstart","freshSelection","isSelected","activateLayer","updateLayersVerticalPosition","posToSpot","newSpot","oldSpot","move","child","updateHeight","activeLayerSpotIndex","spotIndex","stateStr","$0621fc8724f6bfac$var$allowedMixModes","$0621fc8724f6bfac$export$9f4f73b1bd7c2f26","$0621fc8724f6bfac$export$4a819bde91671014","layerNrOffset","layerCanvasArr","pickCanvas","changeListenerArr","origLayers","updateIndices","toCopyCanvas","algorithm","layerCanvas","offX","offY","ctemp","layerCtx","fillColor","selected","isLayerLimitReached","doReturnNull","emitChange","temp","targetIndex","layerBottomIndex","layerTopIndex","globalAlpha","isHorizontal","isVertical","tempCtx","colorObj","compositeOperation","tolerance","sampleStr","grow","isContiguous","srcCtx","srcImageData","srcData","targetCtx","targetImageData","targetData","srcCanvas","srcIndex","imageData","canvasObj","imData","compositeObj","$7069db2f5e23d00f$var$fillRect","$7069db2f5e23d00f$var$mx","$7069db2f5e23d00f$var$my","$7069db2f5e23d00f$var$moveIndex","$7069db2f5e23d00f$var$testAndFill","srcArr","targetArr","initRgba","$7069db2f5e23d00f$export$13d50f258a8034f","rgbaArr","Uint8Array","ArrayBuffer","px","py","q","tl","tr","br","bl","$7069db2f5e23d00f$var$floodFill","$01d7180c5d1d0fdf$export$27550cc14d7ae85a","downX","downY","downAngleRad","$01d7180c5d1d0fdf$export$71b514a25c47df50","colorRGB","strokeStyle","r1","r2","pAngleDeg","pAngleDegSnapped","rotated","r11","r21","rx","ry","rdX","rdY","x1r","y1r","x2r","y2r","x1f","y1f","x2f","y2f","beginPath","moveTo","lineTo","stroke","x1f1","y1f1","x2f1","y2f1","strokeRect","ellipse","$fdc12d72a3df9be9$export$482c90f94eb9717c","outer","fontFamily","fontWeight","fontStyle","spanStr","children","offsetTop","el1","fillText","innerText","isDebug","$089586a542a12f27$export$5f63a7b18dc4503a","$5e45fa121ba5050f$export$74d12f09ff9f1956","$5e45fa121ba5050f$export$b1f70a113e3b5c1b","baseColor","color2","createRadialGradient","$2f1281ced73ab1dc$export$6e1bedb2a6cdff30","blendMode","codes","darken","multiply","lighten","difference","exclusion","hue","saturation","luminosity","$f3c4df6b644f6a61$export$28debfc111084e87","currentName","row","clearBtn","suggestions","suggestionBtns","$c8f65770493ffd93$export$ee79aceabae6bb8a","preview","options","spacer","alphaCanvas","next","previous","$d256278b259ca979$export$6b9252711ea5997f","rootElement","elementType","brushCircleOuter","brushCircleInner","pickerPreviewBorder","pickerPreviewCol","compassSize","compass","compassInner","compassBaseCircle","cx","cy","compassLineCircle","compassUpperTriangle","compassLowerTriangle","radius","borderColor","$d492af58f4721011$var$TMode","TMode","$d492af58f4721011$var$MIN_SCALE","$d492af58f4721011$var$MAX_SCALE","$d492af58f4721011$export$6eaf6f7c0cc177fc","renderTargetCanvas","renderTargetCtx","renderWidth","renderHeight","compositeCanvas","compositeCtx","doResizeCanvas","oldTransformObj","targetTransformObj","highResTransformObj","renderedTransformObj","cursorPos","usesCssCursor","bgVisible","transformIsDirty","doAnimateTranslate","svgOverlay","lastRenderedState","reqFrame","emptyCanvas","emptyLightCanvas","isRepeat","currentInputProcessor","onKeyDown","Draw","Pick","Fill","Gradient","Text","Shape","globalMode","inputProcessorObj","spaceHand","Hand","altPicker","zoom","onKeyUp","updateChangeListener","currentMode","renderTime","lastDrawEvent","linetoolProcessor","$dpBaO","LinetoolProcessor","getMatrix","art","getRenderedTransform","coords","pressure1","matrix1","coords1","pressure0","coords2","pointer","updateCursor","getComboStr","resetInputProcessor","coord","workspaceToCanvasCoord","HandGrabbing","Zoom","offsetX","offsetY","internalZoomByStep","picker","pickedColor","getColorAt","updateColorPreview","Rotating","Rotate","centerObj","startAngleRad","dAngleRad","minimizeAngleRad","origin","angleIsExtraSticky","pinchZoomer","snapAngleRad","mainDoubleTapper","middleDoubleTapper","twoFingerTap","threeFingerTap","pointerEventChain","wheelEvent","brushRadius","animationFrameRequested","lastRenderTime","requestAnimationFrame","updateLoop","addChangeListener","modeInt","doForce","oldMode","$eZ2aJ","$7QZIi","$bz6iQ","$kE5UF","oldIsHand","currentIsHand","setAllowedPointerTypeArr","stepNum","centerX","centerY","newStep","newScale","effectiveFactor","transformA","transformB","blendFactor","centerPosA","canvasToWorkspaceCoord","centerPosB","mixedPos","renderContext","workspacePointArr","borderSize","layerArr","getLayersFast","updateCompass","snapDegIncrement","maxDistDeg","modDeg","doRedrawCanvas","newState","doRender","elapsedFrames","checkChange","testBgVisible","mixTransformObj","start","render","klC","oldWidth","oldHeight","diameter","hideBrushCursorTimeout","doAnimate","newAngle","canvasPointsArr","boundsWidth","boundsHeight","newTargetTransformObj","oldAngleRad","tx","ty","$7752bf3fb7f240e9$export$d429e21f52463d17","downEvent","direction","eventQueue","$6faa9d948ec87f40$export$e258ade1648009b7","$0370167ee97a20d9$export$79a74567acf241b0","corners","isConstrained","snapX","snapY","snappingEnabled","ratio","transEl","boundsEl","pointerRemainder","isInverted","boundsStartP","boundsPointerListener","snap","iP","minSnapDist","distX","distY","$lt7cS","toImageSpace","j","projected","dist1","snapToPixel","updateCornerPositions","updateDOM","gripSize","virtualPos","offsetArr","tinyOffset","scaled","cornerCursors","constrainCorner","snapCorner","tP","toTransformSpace","indexes","updateTransformViaCorners","updateScaled","edges","edgeSize","angleOffset","tfD","ti","dimension","restoreRatio","angleGrip","$5cYet","anglePointerListener","offset","snapDeg","iX","iY","_snap_x","_snap_y","e1","cornerIndex","flip","widthChanged","heightChanged","angle90","newHeight1","skipCallback","transformOrigin","copyTransform","$6c5cb3001c773523$export$958c2bfe8d7142a9","$6c5cb3001c773523$export$234b1c16dfa57d6a","$6c5cb3001c773523$export$6a4549ec4168874a","$6c5cb3001c773523$export$3fba3b383c654cc6","$48f5d87739d28bf9$export$205c2dd29f8a66b5","imageWidth","imageHeight","previewFit","transformIndex","innerWrapper","previewLayerArr","klCanvasPreview","transformSize","initTransform","freeTransform","updatePreview","getTransform","destCanvas","setPos","setAngleDeg","fit","$de496a1759b04ed9$export$71ed2b85d4ca43d3","maxW","maxH","gripCursors","outline","grips","outlinePointerListener","_BB_intDxy","commit","thirdsHorizontal","borderTop","borderBottom","thirdsVertical","gripOverlay","transformTop","transformRight","transformBottom","transformLeft","edge0PointerListener","edge1PointerListener","edge2PointerListener","edge3PointerListener","cornerElArr","corner0PointerListener","corner1PointerListener","corner2PointerListener","corner3PointerListener","$18e69c7d4cb991e8$export$d25420b53e16716f","largeCanvasAnimationTimeout","canvasSize","largeCanvasSize","lastDrawnState","lastDrawnSize","animationCanvas","animationCanvasCtx","animationLength","animationCount","largeCanvasIsVisible","contentWrapperEl","canvasWrapperEl","nameWrapper","flexGrow","nameLabelEl","clickableEl","opacityEl","largeCanvasWrapper","webkitTouchCallout","largeCanvas","largeCanvasCtx","updateCheckerPatterns","layerObj","removeLargeCanvas","drawLargeCanvas","largeCanvasAnimationDurationMs","showLargeCanvas","checker","animationCanvasCheckerPattern","createPattern","largeCanvasCheckerPattern","animate","canvasDimensions","isInstant","currentState","klCanvasLayerObj","$e3dfa43019bc3f08$export$962af7e240721d88","freeTransformCanvas","noteEl","originalSizeBtn","fitSizeBtn","setTransformFit","centerBtn","setTransformCenter","importImage","buttonStr","getTransformation","getIsPixelated","$01cb8095758db224$export$e789742143ba5b1","paddingTop","textShadow","optionStyle","optionLayerEl","optionImageEl","rootCounter","optionLayerCounter","optionImageCounter","testAcceptType","dataTransfer","types","updateOptions","$d6fe881e8fc421ac$export$9f0da9b942594e99","sizeObj","queuedObj","colorEl","selectedColorEl","subscriptionFunc","initialColor","updateColor","subscribe","sliderConfig","getSliderConfig","updateUI","mousePos","$6003e73b8cbb69e2$export$665d2c76b1eb8459","createButton","extraPadding","contain","logoButton","$kX3t5","newButton","$frUlg","importButton","$7qUeg","saveButton","$g2tQ8","shareButton","$cmBTx","helpButton","$8pc1M","$18c597dee53260ff$export$a0a40f8a0b8fee15","imArr","titleArr","currentActiveIndex","openTimeout","startX","startY","showDropdown","elementFromPoint","dropdownBtnArr","wrapper","closeDropdown","updateButton","activeButton","boxSizing","activeButtonIm","arrowButton","$32WFC","dropdownWrapper","borderBottomLeftRadius","borderBottomRightRadius","createDropdownButton","smallMargin","onClickDropdownBtn","$a372d78c806cd0cc$export$c744a22bef9e0b97","currentActiveStr","doLighten","doMirror","createTriangleButton","svg","viewBox","preserveAspectRatio","defs","childrenArr","in","stdDeviation","dx","dy","in2","operator","k2","k3","svgTriangleLeft","class","onLeft","svgTriangleRight","onRight","leftPointerListener","rightPointerListener","leftIm","leftImage","rightIm","rightImage","setIsEnabledLeft","setIsEnabledRight","toolDropdown","handButton","zoomInNOutButton","$fORLP","$kRxRZ","zoomInButton","zoomOutButton","undoNRedoButton","$5ZTVn","undoButton","redoButton","doEmit","$90c04b5ac185bf3d$export$8162a66cd18867a7","strengthSelect","setDeltaValue","$d04d72b97d637d65$export$3c6d17ed0106bfb9","roundRight","roundSize","$fqSj0","roundLeft","pTabObj","openedTabObj","activeTab","initTabObj","tab","tabId","$9934467c988b088a$export$cf20160367bae46c","scaleEl","angleEl","resetButton","fitButton","leftRotateButton","$6Dvin","resetAngleButton","rightRotateButton","pIsVisible","pScale","$51d47356d698ffec$export$1e63e3b0645421a2","toleranceSlider","selectRow","growWrapper","growSelect","contiguousToggle","eraserToggle","$d06987f550ff485e$export$32a22540e4b2f123","$45c003c723de07b5$export$a9387b1d4260d39c","previewSize","rectStrokeSvgRect","rectStrokeSvg","rectFilledSvgRect","rectFilledSvg","ellipseStrokeSvgEllipse","ellipseStrokeSvg","ellipseFilledSvgEllipse","ellipseFilledSvg","lineSvgLine","lineSvg","updatePreviews","strokeWidth","lineWidthSlider","fixedToggle","previewPadding","snapToggle","shapeOptions","lockAlphaToggle","outwardsToggle","$4fb68589de8a8c9a$export$f77a89101d7d6586","createRatioSize","ratioX","ratioY","updateRatio","widthInput","heightInput","commonRatios","reducedArr","closestRatio","closestDistance","ratioWrapper","realw","T","U","V","hcf","newImDiv","unitStyle","widthUnit","heightUnit","sizeTable","$cNr8p","table","templateWrapper","presetFitBtn","presetCurrentBtn","presetSquareBtn","presetLandscapeBtn","presetPortraitBtn","presetOversizeBtn","sizeObj1","backgroundRGBA","colorOptionsArr","initColorIndex","colorOptions","onkeyup","secondRow","$96366ef7b36c82a7$export$9852986a3ec5f6a0","cellProps","rowIndex","_rowEl","colIndex","cellEl","rowSpan","rowspan","$3f73fb4b1b574d52$export$5b91f641162972fc","stateIsOpen","directionStr","icon","$9ecpQ","dirStr","$cd9e7df6e228ea45$export$e263e067d6140649","checkerPattern","previewCtx","textCtx","textCanvas","textInput","alignRadioList","italicToggle","boldToggle","sizeInput","fontSelect","rotatedXY","rotatedWH","fitBounds","zoomFac","previewCanvas","layersCtx","emptyCanvasLight","targetCanvas","layersCanvas","changeZoomFac","zoomInBtn","canZoom","zoomOutBtn","onScroll","isSmallWidth","isSmallHeight","previewPointerListener","row2n3Wrapper","unshift","zoomWrapper","sizePointerListener","fontPointerListener","$itzxn","$3RXBC","$dtB7M","$3qZsM","$68rzB","placeholder","$c8d2eb7d799b314c$export$1bf16d9bd59fd8f9","updateResolution","maxSize","resolutionEl","flattenCheckbox","warningsEl","doFlatten","warningArr","warnings","psdWarningArr","contentArr","warningMap","mask","clipping","group","adjustment","alert","showWarnings","noteEl1","cropRect","isCropped","cropObj","$4c230b0de5e1a470$var$kl2PsdMap","$4c230b0de5e1a470$var$psd2KlMap","$4c230b0de5e1a470$var$init","fromEntries","reverse","$4c230b0de5e1a470$export$6df36f0c42d2440f","str","$4c230b0de5e1a470$export$4e3b1f7d3ad623b4","$4c230b0de5e1a470$export$3d649861c4b13fa2","psdObj","addWarning","warningStr","getMixModeStr","prepareMask","maskCanvas","defaultColor","groupMaskCtx","bitsPerChannel","maxLayers","layerCount","countWithinGroup","groupObj","convertGroup","psdGroupObj","groupCanvas","groupCtx","groupOpacity","hidden","groupMixModeStr","hasClipping","innerArr","innerItem","innerCtx","clippingCanvas","clippingCtx","clippingItem","effects","clippingCanvas1","clippingCtx1","clippingItem1","$4c230b0de5e1a470$export$56493bf279c387b3","klPsd","$41164c8aeaf53227$var$indexedDbIsSupported","indexedDB","$41164c8aeaf53227$var$dbNameStr","$41164c8aeaf53227$var$storageNameStr","$41164c8aeaf53227$export$1347f8be1f25c479","$41164c8aeaf53227$var$execIndexedDBTransaction","actionFunction","successCallback","errorCallback","onError","errorStr","hasFinished","requestObj","onupgradeneeded","createObjectStore","keyPath","createIndex","unique","onerror","onsuccess","databaseObj","transactionObj","storeObj","objectStoreNames","contains","deleteDatabase","transaction","objectStore","oncomplete","$41164c8aeaf53227$export$1448a0dd0d3fde8e","query","$41164c8aeaf53227$export$21ade4eb935254aa","storageProject","put","$41164c8aeaf53227$export$42ffd38884aecdac","$fsSyS","$805be15a1e91c0ee$export$7a4e0b62a5d854bc","isLoaded","$805be15a1e91c0ee$export$395d33c8e06b92c9","brightnessContrast","lang","getDialog","inEmbed","$bBJjx","curves","$fb1QA","distort","$4w6gs","$5XYnt","hueSaturation","$hK7d4","darkNoInvert","invert","$bE89l","perspective","$anXZw","$gDMhw","tiltShift","$bNSoq","toAlpha","$dkVDV","$6aHfw","$kLbWO","unsharpMask","$bgekB","grid","$537C7","noise","$kHVZD","pattern","$bphza","vanishPoint","$tP4I2","$68QTJ","$42ac5b30ad65dabb$export$7d68cd8857639377","PenBrush","BlendBrush","$5PSXS","SketchyBrush","$ewgr9","PixelBrush","$kic4a","ChemyBrush","$6Nq1H","SmudgeBrush","$ltaBP","EraserBrush","$7cUpm","$3f0923cd3c55ea92$var$ALPHA_CIRCLE","$3f0923cd3c55ea92$var$TWO_PI","$3f0923cd3c55ea92$export$6f96c8f9e6ae7341","settingAlphaId","instructionArr","alphaCanvas128","alphaCanvas64","alphaCanvas32","settingColor","alphaOpacityArr","$5CF7D","alphaImArr","settingOpacity","settingHasOpacityPressure","before","settingLockLayerAlpha","settingColorStr","arc","closePath","hasDrawnDot","targetMipmap","bezierLine","lastInput","drawArr","dotCallback","localPressure","lastInput2","localOpacity","calcOpacity","localSize","settingSize","settingHasSizePressure","localSpacing","settingSpacing","addFinal","drawDot","historyEntry","actions","inputIsDrawing","lineToolLastDot","inputArr","continueLine","maxInput","loopDist","mouseDist","eX","eY","bdist","updateAlphaCanvas","$74D3O","$ff6c1f784f50f5d5$export$d116ae91f77f1f19","genBrushAlpha01","genBrushAlpha02","$f875015ce1aeb4d3$export$74a44bbc21d06a28","scaleFac","createImageData","sFac2","$gZSR2","simplex2","noisePattern","centerDist","$f875015ce1aeb4d3$var$udSegment","ba","pa","$f875015ce1aeb4d3$export$eaa218d5d17c8f1c","pDist","centerSize","transitionSize","$dfc47a34ad9bc378$var$myModule","$dfc47a34ad9bc378$var$Grad","Grad","$dfc47a34ad9bc378$var$grad3","$dfc47a34ad9bc378$var$p","$dfc47a34ad9bc378$var$perm","$dfc47a34ad9bc378$var$gradP","seed","$dfc47a34ad9bc378$var$F2","$dfc47a34ad9bc378$var$G2","xin","yin","j1","gi0","gi1","gi2","t0","t1","t2","dot2","$dfc47a34ad9bc378$export$d3022aad56692482","$02d77b8dd5755328$var$cellSize","$02d77b8dd5755328$export$9659db8d01dd5313","redrawBounds","cells","getTouchedCells","isTouched","drawCells","touchedCells","cellsW","getCellsWidth","cell","cellOffsetX","cellOffsetY","cellWidth","cellHeight","inCellBounds","tmpCanvas","tmpCtx","alpha","ar","ag","ab","aa","sliceBounds","e2","randI","randLen","randArr","random","samples","samplesSquared","sampleOffsets","sharpness","invSharpness","sharpnessSubtrahend","sizeSquared","distDivisor","alphaMinuend","slicedBounds","ri","re","alphaO","invAlphaO","alphaU","underR","underG","underB","underR1","underG1","underB1","newAlpha","drawBuffer","localColNew","settingSizePressure","calcSpacing","avgX","avgY","blending","mixr","mixg","mixb","average","localColOld","avgParams","prepDot","copyFromCanvas","getAverage","blendCol","blendMix","bezierCallback","settingOpacityPressure","updateRedrawBounds","isTesting","totalCells","drawChangedCells","find","$c214fbe9e4fc15b0$var$sampleCanvas","$c214fbe9e4fc15b0$var$sampleCtx","$c214fbe9e4fc15b0$export$566f9061f0f5ba33","c1","c2","sketchySeed","settingBlending","settingScale","lastX","lastY","p_x","p_y","preMixedColor","mixx","mixy","mixw","mixh","countmix","mixed","mixmode","rand","$58b45953679baa4a$export$4de5ef8eecde6f12","ditherCanvas","ditherCtx","settingIsEraser","ditherArr","ditherPattern","maxAngleRad","d2","d3","isOverThreshold","cubicCurveOverThreshold","plotLine","settingUseDither","controlCallback","controlObj","plotCubicBezierLine","skipFirst","sX","sY","updateDither","$fc1a683099fb2d61$export$fe52c90afd1cf5ba","isBaseLayer","isTransparentBG","radgrad","oFac","useSizePressure","useOpacityPressure","started","_this_historyEntry_actions","$78ad817c60f81b7c$var$CELL_SIZE","$78ad817c60f81b7c$var$smudge","cSize","brush","cX","cY","aIndex","aP","bP","softnessPx","pixel","ai","bi","ix","iy","fac2","alphaLock","bx1","bx2","yStart","iy1","yStart1","x21","ix1","iy2","yStart2","x3","x22","ix2","y3","iy3","yStart3","x4","x23","ix3","$78ad817c60f81b7c$export$c9f800961903deab","completeRedrawBounds","copiedCells","copyImageData","_$i","e3","imWidth","imHeight","$78ad817c60f81b7c$var$prepSmudge","ImageData","updateCompleteRedrawBounds","historyIm","$348fcce123898af9$export$38b08aa4ea8f61c6","settingXSymmetry","settingYSymmetry","buffer","settingMode","Path2D","settingGradient","startAtTop","minY","maxY","lineJoin","settingDistort","pos","historyCanvas","$cVFne","$7de2f0eab7a9ead7$export$f1561c72be54c6a7","penBrush","penBrushUi","blendBrush","$9mjXI","blendBrushUi","sketchyBrush","$iYbUv","sketchyBrushUi","pixelBrush","$brjBD","pixelBrushUi","chemyBrush","$vCnsd","chemyBrushUi","smudgeBrush","$dS2qM","smudgeBrushUi","$9rc5F","eraserBrushUi","brushInterface","alphaNames","$8b6ca25eb0830594$export$a0d4983f3b0b5c8e","$iEKHy","setSpacing","spacingSpline","alphaOptions","setAlpha","getLockAlpha","setLockAlpha","$7NTKy","pressureSizeToggle","sizePressure","pressureOpacityToggle","opacityPressure","changeSliderValue","$e8a5c017c49bb311$export$5ec472fd0ce20d84","$2e3c50106ba150d5$export$156bb4fe8f4bcb4b","$jxqXH","blendingSlider","getBlending","setBlending","setSizePressure","setOpacityPressure","$94537af75923b9e3$export$ffae56164d1bde68","$1SGPc","blendSlider","scaleSlider","setScale","getSeed","setSeed","$9519e739bc9666ee$export$d001f3406562d07","$1qfk4","setIsEraser","ditherToggle","getUseDither","setUseDither","$d6fc2ded7d9d56db$export$cf481ecf227135a8","$6kk87","isTransparentBg","transparencyToggle","setTransparentBG","$1045b9bae2ffbbb4$export$84831662ba707e7a","$1rnhH","$18456e8104a5a825$export$80819a93636ebb04","$5rmB7","toggleRow","actualIconSize","iconSize","modeOptions","brushSize","mirrorXToggle","halfSize","getXSymmetry","setXSymmetry","mirrorYToggle","getYSymmetry","setYSymmetry","gradientToggle","getGradient","setGradient","$2d47de6498e5a87c$export$35fa34e5af64bd4a","isEmbed","iframe","linkEl","href","onload","contentWindow","location","isMaxHeight","$de98bdc3369d2e4f$export$3dff5655255b5729","items","ignoreFocus","inputs","$0e681e75eb3cab30$export$9c72cf485ef46673","_this_options","gridTemplateColumns","gridTemplateRows","gap","gridTemplateAreas","gridArea","infoEl","isBroken","ageEl","textSize","btnCustom","storeButtonEl","clearButtonEl","hideClearButton","visibility","storeListener","onUpdate","timestamp","thumbnail","updateThumb","updateAge","readResult","read","ageStr","age","Date","getTime","resetButtons","Promise","unsubscribe","$14b343f2c12ca9c5$var$makeAsync","nonAsyncFunc","reject","$14b343f2c12ca9c5$export$93d91060b9af7e2a","accessHasFailed","storeKlProjectObj","getKlProjectObj","lowLevelRead","$3hwQ7","ProjectConverter","readStorageProject","storageProject1","createStorageProject","lowLevelStore","lowLevelClear","updateTimestamp","$3ee249752703e788$var$loadImage","URL","revokeObjectURL","onabort","$3ee249752703e788$export$f3c1ac6650038646","createThumbnail","HTMLCanvasElement","_tmp","all","$e3587a28373f51f9$export$b3fb17ae4345ac8f","base64Str","parts","match","binStr","atob","buf","view","charCodeAt","Blob","$01ce2e23a2667e77$export$a2647fbf5f056b0a","onExportTypeChange","onFileSelect","onSaveImageToComputer","onNewImage","onShareImage","onUpload","onCopyToClipboard","fileMenu","uploadImgurButton","clipboardButton","$fEvzb","importWrapper","innerMask","multiple","accept","importFakeButton","exportTypeSelect","saveNote","createSpacer","clearer","line","fileBrowserStorage","saveRow","refresh","$0d10046ca7f6fbd0$export$3f17d740ad471e50","getCurrentColor","getKlMaxCanvasSize","getKlCanvas","getCurrentLayerCtx","isInit","filters","filterKey","buttonLabel","filterName","applyFilter","filterDialog","maxWidth","maxHeight","currentColorRgb","secondaryColorRgb","getInput","finishedDialog","addGroup","groupArr","$6349b006a6604e1b$var$upload","description","$6349b006a6604e1b$var$_upload","img","gif","labelText","response","formData","$2lMgk","FormData","method","headers","Authorization","ok","json","link","$6349b006a6604e1b$export$b1dd62fa0b5f32f5","inputTitle","inputDescription","rows","labelTitle","labelDescription","tos","typeRadio","outDiv","infoHint","deletehash","$ae23cd0c3e53f398$var$agPsdLazy","$ae23cd0c3e53f398$export$ab3d838b1d336b38","$ae23cd0c3e53f398$var$_loadAgPsd","then","$06e8423858d08972$export$befc6437ad34b28a","showReminder","changeTitle","onSaveAsPsd","lastSavedActionNumber","lastSavedAt","psdWrapper","storageWrapper","paddingBottom","psdBtn","storageUi","lastReminderShownAt","onBeforeUnload","returnValue","getActionNumber","visibilityState","unsavedActions","showPopup","onbeforeunload","unsavedInterval","$956d06d740fc5053$export$75e7b60500bb415b","getExportType","filename","mimeType","$6hBII","saveAs","format","saveImage","fileBase","fnameArr","layerArr1","psdConfig","item1","blendKlToPsd","agPsdLazy","writePsdBuffer","catch","$e1c6fbc08bfda4eb$export$2bc2a80e311129ac","createElementNS","download","rel","createObjectURL","$48534f13b7192dff$var$execHistoryEntry","setCurrentLayerCtx","ctx1","id1","ctx2","$48534f13b7192dff$export$5cebd3bb2d68229a","getInitState","getCurrentBrush","doIgnore","shouldIgnoreTest","oldSize","entry","currentLayerIndex","logParam","localCurrentLayerCtx","$53cc60fd413705d6$export$272bfd3ef9ef2f48","onSetColor","onSetSize","onSetOpacity","onGetColor","onGetSize","onGetOpacity","onGetSliderConfig","subscriberArr","instance","obj","skipSubscriber","$5562b5b6c391a7ca$export$5d396b237bd33221","customAbout","themeToLabel","makeLicenses","licenses","overflowY","autoLanguage","getAutoLanguage","langWrapper","$fgfvl","languages","languageSelect","LS_LANGUAGE_KEY","languageHint","themeSelect","getMediaQueryTheme","getStoredTheme","setStoredTheme","$741YV","$dd3r9","$951e508110f8a437$export$42a534af7eb650e8","upBtn","downBtn","upInterval","scrollBy","downInterval","wheelListener","$f244572c1923a3ac$export$7fa03d1ef9d3489e","iconArr","updateIcons","typeOptions","reverseToggle","doSnapToggle","col1","col2","$1eff19bee197987a$export$ce26cd3db18613a3","submitButton","leftRightButton","$4bb0d03ef02dc0c0$var$importFilter","libObj","moduleObj","$4bb0d03ef02dc0c0$export$4283b00eae4a6956","$iiVKq","filterBrightnessContrast","$lorQQ","filterCropExtend","$8Ri8I","filterCurves","$fADXF","filterFlip","$bIns5","filterHueSaturation","$30jcG","filterInvert","$cCks8","filterPerspective","$huXOx","filterResize","$dsRff","filterRotate","$lhchB","filterTiltShift","$lXpcU","filterTransform","$1CjeM","filterBlur","$dNWKZ","filterUnsharpMask","$94Tq7","filterToAlpha","$d8Fqy","filterGrid","$gtdB1","filterNoise","$lQzx7","filterPattern","$10iZP","filterDistort","$dteOZ","filterVanishPoint","$024aabab8b30bbfd$export$af433fb90aa90a38","selectedLayerIndex","tempCanvas","brightness","contrast","fxCanvas","$a5EFw","getSharedFx","texture","brightnessSlider","$cH2YE","contrastSlider","previewInnerWrapper","$fca35583bfaa35b6$export$5ec472fd0ce20d84","$6N0h0","$02a74dc72797630f$var$fx","$02a74dc72797630f$export$8c4423af32b21158","_","gl","isContextLost","wrapTexture","initialize","contents","getPixelArray","wrap","$76shC","$eeae469bfe7893fd$export$a04cfca62fd2892f","loadContentsOf","$7dEWP","setGl","$8dg54","FxTexture","fromElement","textureType","UNSIGNED_BYTE","getExtension","testTexture","RGBA","FLOAT","drawTo","getTextureType","spareTexture","extraTexture","flippedShader","$fvBHO","FxShader","use","getDefaultShader","drawRect","array","readPixels","fn","_len","args","_key","$h6IOH","triangleBlur","$e0olz","$kSoEy","$fkecp","matrixWarp","$44j8K","$2myDH","$9uhWc","$1Vq1u","$bJIp5","multiplyAlpha","$lwXVT","unmultiplyAlpha","$3u9Uu","$9WU1L","$6lIef","$c50d7229cf0a789e$export$6408eeb1703e74b8","$jrAes","simpleShader","$8501a2e1e79821a9$export$d731e22ecd0c25d3","shader","uniforms","textureIn","textureOut","swapWith","$e0143068cd462268$var$floatPrecision","$e0143068cd462268$var$defaultVertexSource","$e0143068cd462268$var$defaultFragmentSource","$e0143068cd462268$export$7d9b0d118d0c4108","vertexSource","fragmentSource","nameStr","vertexAttribute","texCoordAttribute","program","createProgram","testPrecisionSupport","HIGH_FLOAT","MEDIUM_FLOAT","attachShader","compileSource","VERTEX_SHADER","FRAGMENT_SHADER","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","source","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","precisionType","getShaderPrecisionFormat","precision","deleteProgram","useProgram","getUniformLocation","uniform1fv","Float32Array","uniform2fv","uniform3fv","uniform4fv","uniformMatrix3fv","uniformMatrix4fv","$e0143068cd462268$var$isNumber","uniform1f","textures","uniform1i","viewport","getParameter","VIEWPORT","vertexBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","texCoordBuffer","getAttribLocation","enableVertexAttribArray","vertexAttribPointer","drawArrays","TRIANGLE_STRIP","defaultShader","$deb6b884ba4ae312$export$5822a9d0880a5d82","$deb6b884ba4ae312$export$b59c6427db8463f4","newGl","$80392da2a95619fd$export$7e6fd232cff50dd1","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","videoWidth","videoHeight","deleteTexture","unit","activeTexture","TEXTURE0","ensureFormat","framebuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","other","$fRyi0","$7480e3ce85bc65db$export$6894093bf294bea5","red","green","blue","redRamp","splineInterpolate","greenRamp","blueRamp","initFromBytes","$d747444e26286abc$export$4f237735eca1f248","interpolator","$6dd7d8fac84d64b7$export$ef28bbbd731e79bf","$dd5d88e299e80db3$export$d3022aad56692482","octaves","peaks","colA","colB","channels","$3TO8L","texSize","$b01b186720ebdc8e$export$6e852234f1597a14","$4urfK","randomShaderFunc","$904e6ba1142f7a16$export$af69f7ca07da04c9","$1ec92859a97056c3$export$4545acb2b6bb8f22","endX","endY","blurRadius","gradientRadius","$5b33fb39bf5722a9$export$a93b0222aeadc54b","inverse","useTextureSpace","$gDZ5A","warpShader","$5taNf","getInverse","$1d7339974b05a229$export$820b3a44cb7b2b21","uniformsStr","warpStr","$303d8d4ec53c4881$export$1c447127d27d7be4","dx1","dy1","dx2","dy2","dx3","dy3","det","$303d8d4ec53c4881$export$68b3343017e80691","$303d8d4ec53c4881$export$2060d2db72cce88f","$c6e0992c38eb55ab$export$915fb7313c578ba2","strength","ensureFormatViaTexture","originalTexture","unuse","$164716f3bce9dcdb$export$be1ee5ea42904fdc","replaceRGBA","$6fb892cfa80f1621$export$6897c284b6f9f4dc","$4d16a2f492bd5d16$export$541149539f3a4684","after","getSquareToQuad","$34a2490457ff8aab$export$b324c80262feb891","$55618926ab99fefa$export$7c9b924528782480","distortType","phase","$f157b4bc2111ecb8$export$57b05c961ff98d6a","$2680b5781517cb67$export$e5937df51b9e1d86","updateInput","leftInput","rightInput","topInput","bottomInput","leftChanged","rightChanged","topChanged","bottomChanged","cropper","setTransform","previewHeight","offsetWrapper","selectedRgbaObj","updateIsDark","previewFactor","lrWrapper","tbWrapper","labelStyle","useRuleOfThirds","ruleOThirdsCheckbox","showThirds","bgColorOverlay","flexRow","$4c948640eb8ef791$export$309483fcb6d5c7ca","$hRvnE","getDefaultCurvesInput","CurvesInput","modeButtons","getModeButtons","$81ac57466912ccc9$export$4300cf0a0df418a6","$81ac57466912ccc9$export$1c43bf66c2a2e4da","p0","areaH","areaW","curveArea","createPoint","lock","internalY","internalX","pointEl","newX","newY","updateControl","outCurves","drawCurve","spline","$6b01e1931d168e01$export$9b1b7b3985b9625a","previewLayer","doFlipCanvas","horizontalCheckbox","verticalCheckbox","targetOptions","horizontal","vertical","flipCanvas","$041c656037c77a96$export$2aa46bd5587f0eb","hueSlider","saturationSlider","$82b3d1ba61b3412f$export$b7ebcfbdc840ef76","$460859cbeb601dec$export$a76d798fa7d85e4e","displayW","displayH","displayPreviewFactor","pointerListenerArr","bb","bc","bd","ac","ad","nob","updateAfter","beforeAfterTabs","$5vheV","TwoTabs","nobSize","$8b4f5ae4fe73ff76$export$b1241e74876d9bbe","leftTab","onpointerdown","rightTab","$63d62a20f3ba2c7d$export$5705240d31427a82","previewW","previewH","algorithmSelect","canvasWrapper","widthWrapper","heightWrapper","$bNBIp","constrainIm","constrainCheckbox","$878715182dcd377b$export$ac7e9efc751d5791","WebkitTransform","MozTransform","OTransform","msTransform","btnPlus","btnMinus","previewcell","$aa97ed406a9700f0$export$1b8796b18b7c19ed","fa","fb","blurSlider","gradientSlider","$31a0dd41d7428d32$export$dc15474d94cdc2b3","JSON","stringify","lastDrawnTransformStr","transformLayerCanvas","onInputsChanged","inputX","inputY","inputR","leftWrapper","rightWrapper","rotWrapper","actionBtnCss","buttonRow","flipXBtn","flipYBtn","scaleRotLeftBtn","scaleRotRightBtn","scaleDoubleBtn","getRatio","scaleHalfBtn","setConstrained","isSnapping","snappingCheckbox","setSnapping","checkboxWrapper","bottomRow","isPixelated","$95b95646154e8218$export$55e7eb2ebd0db869","radiusSlider","$82f12ab116cea855$export$62ac74a5ea43bd5c","strengthSlider","$a535e7a374deb8f5$export$6158ed2b22ebf4d9","sourceId","sourceOptions","$bad33651972f8d2c$export$50020de79e1bc23","renderW","renderH","$1xi6g","drawGrid","settingsObj","thickness","renderFactor","line1","line2","xInput","yInput","thicknessInput","$74df8e8cd35bce4e$export$20d2db9c68afeac","cellsX","cellsY","thickIsRound","pos1","$595c9469b8f94062$var$presetArr","$595c9469b8f94062$var$drawNoise","$595c9469b8f94062$export$1dab0536099042f5","presetCopy","presetIndex","thumbImgArr","preset","thumbImg","presetOptions","row1El","row2El","channelsOptions","blendSelect","colorWrapper","colInputStyle","colAInput","colBInput","$ebbf7e5d844153e5$var$drawPattern","blendOffsetX","blend","blendOffsetY","finalPatternCanvas","blendCanvas","blendCtx","colTransparent","colOpaque","blendGradient","$ebbf7e5d844153e5$export$5b48b77a483d9b33","syncInputs","sharpStrokeRect","drawX","drawY","drawWidth","drawHeight","lastDrawnSettings","previewMode","fullSizeCtx","fullSizeCanvas","pW","pH","overlayCtx","overlayCanvas","previewCanvas1","previewCtx1","inputStyle","mixBlendMode","oldSettings","x11","y11","$67bee9819cf9d9ba$export$77c344cc65ad0ed2","sync","from","sliderArr","fxCanvas1","texture1","isSynced","settingsCopy","topRowEl","syncToggle","xyRowEl","leftCol","rightCol","sliderWidth","toUpperCase","phaseSlider","stepSlider","$9939d5f20537fa4b$export$a77e8ecd2a7fa9a5","$jsIPR","drawVanishPoint","lines","linesSlider","$cd59789add31bb97$export$8f57d6bdbceb36d0","degIncrement","$40b8cea12adf584e$export$92433b641be3f7a","$40b8cea12adf584e$var$_klCanvasToPsdBlob","$3adbeb1f050c09d3$export$c57e2ed65bcf4d6a","interval","lastMixedInput","inputPressure","parse","$73298182992a8985$export$91dcf4209534d21f","$7aa12ecc06c22770$export$bcd109042a2e4bb5","$504c8450f977b764$export$4ccbb8938b9d5723","importedImage","getResizedDimensions","importAsImage","resizedDimensions","importAsImagePsd","convertedPsdObj","cropCanvas","importAsLayer","activeLayerIndex","activeLayerContext","res","clipboardData","file","getAsFile","retrieveImageFromClipboardAsBlob","imageBlob","importFinishedLoading","URLObj","webkitURL","getAsString","pasteStr","log","crossOrigin","showWarningPsdFlattened","hasUnsupportedFile","nameSplit","maxResolution","closeLoader","doShowLoader","loaderIsOpen","reader","FileReader","readerResult","skipLayerImageData","skipThumbnail","skipCompositeImageData","convertedPsd","readAsArrayBuffer","$a8abbf3a9def9692$export$982e7602957287fa","_console","_console1","info","help"],"version":3,"file":"main-embed.6aa19314.js.map"}