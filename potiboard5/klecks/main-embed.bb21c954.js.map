{"mappings":"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","sources":["src/app/script/main-embed.ts","src/app/script/polyfills.ts","node_modules/mdn-polyfills/Node.prototype.append.js","node_modules/mdn-polyfills/Node.prototype.prepend.js","node_modules/mdn-polyfills/String.prototype.padStart.js","node_modules/mdn-polyfills/Array.prototype.findIndex.js","src/app/script/app/kl-app.ts","src/app/script/klecks/kl.ts","src/app/script/klecks/history/kl-history.ts","src/app/script/klecks/ui/modals/popup.ts","src/app/script/klecks/ui/modals/modal-count.ts","src/app/script/bb/bb.ts","src/app/script/bb/input/event-listener.ts","src/app/script/bb/base/browser.ts","src/app/script/bb/base/create-canvas.ts","src/app/script/bb/base/base.ts","src/app/script/bb/input/key-listener.ts","src/app/script/bb/input/pointer-listener.ts","src/app/script/bb/math/math.ts","src/app/script/bb/input/event-chain.ts","src/app/script/bb/base/canvas.ts","src/app/script/bb/math/matrix.ts","src/app/script/bb/math/vec2.ts","src/app/script/bb/math/line.ts","src/app/script/bb/color/color.ts","src/app/script/bb/base/ui.ts","src/app/script/bb/base/bb-log.ts","<<jsx-config-pragma.js>>","src/app/script/bb/base/local-storage.ts","node_modules/@parcel/runtime-js/lib/runtime-34832b43d0ebd3bf.js","node_modules/@parcel/runtime-js/lib/runtime-a96f6567e6dac4f3.js","src/app/script/klecks/ui/base-components/checkbox.ts","src/app/script/klecks/ui/base-components/input.ts","src/app/script/klecks/ui/base-components/select.ts","src/app/script/klecks/ui/base-components/image-toggle.ts","src/app/script/klecks/ui/base-components/image-radio-list.ts","src/app/script/klecks/ui/base-components/pen-pressure-toggle.ts","node_modules/@parcel/runtime-js/lib/runtime-065238818b5d6d26.js","src/app/script/klecks/ui/base-components/kl-slider.ts","src/app/script/klecks/ui/base-components/slider-falloff.ts","src/app/script/klecks/ui/base-components/kl-slider-manual-input.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-ce95b2abc71314b0.js","src/app/script/klecks/ui/base-components/kl-color-slider.ts","node_modules/@parcel/runtime-js/lib/runtime-e7bece06ac3b91da.js","src/app/script/klecks/ui/base-components/kl-color-slider-small.ts","src/app/script/klecks/ui/base-components/point-slider.ts","src/app/script/klecks/ui/base-components/color-options.ts","src/app/script/klecks/ui/base-components/options.ts","src/app/script/klecks/ui/components/status-overlay.ts","node_modules/@parcel/runtime-js/lib/runtime-76fc4a9796871f89.js","src/app/script/klecks/ui/modals/export-dialog-deprecated.ts","src/app/script/klecks/ui/components/crop-copy.ts","src/app/script/klecks/ui/modals/clipboard-dialog.ts","src/app/script/klecks/ui/tool-tabs/kl-layer-manager.ts","node_modules/@parcel/runtime-js/lib/runtime-9e9c6514323b50ff.js","node_modules/@parcel/runtime-js/lib/runtime-f141aefb87a862aa.js","node_modules/@parcel/runtime-js/lib/runtime-e93ed5f4a72fe388.js","node_modules/@parcel/runtime-js/lib/runtime-e1e96fa0dcd63695.js","node_modules/@parcel/runtime-js/lib/runtime-2d2417fe7f53ff5b.js","src/app/script/klecks/canvas/kl-canvas.ts","src/app/script/klecks/image-operations/flood-fill.ts","src/app/script/klecks/image-operations/shape-tool.ts","src/app/script/klecks/image-operations/render-text.ts","src/app/script/klecks/canvas/draw-project.ts","src/app/script/klecks/image-operations/gradient-tool.ts","src/app/script/klecks/canvas/translate-blending.ts","src/app/script/klecks/canvas-ui/workspace-svg-overlay.ts","src/app/script/klecks/canvas-ui/kl-canvas-workspace.ts","node_modules/@parcel/runtime-js/lib/runtime-ce6158b179cda36d.js","node_modules/@parcel/runtime-js/lib/runtime-9180b336d2c14eb8.js","node_modules/@parcel/runtime-js/lib/runtime-e98ceba16f4f3e8c.js","node_modules/@parcel/runtime-js/lib/runtime-1c4e2d66dbd3cd26.js","src/app/script/klecks/canvas-ui/canvas-preview.ts","src/app/script/klecks/ui/components/free-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-7b1b46c773a5d5de.js","src/app/script/klecks/ui/components/free-transform-canvas.ts","src/app/script/klecks/ui/components/cropper.ts","src/app/script/klecks/ui/components/layer-preview.ts","src/app/script/klecks/ui/components/fitted-image.ts","src/app/script/klecks/ui/modals/show-import-as-layer-dialog.ts","src/app/script/klecks/ui/components/kl-image-dropper.ts","src/app/script/klecks/ui/components/overlay-toolspace.ts","src/app/script/klecks/ui/components/toolspace-top-row.ts","node_modules/@parcel/runtime-js/lib/runtime-c595ccae60beff87.js","node_modules/@parcel/runtime-js/lib/runtime-e5d7180bbee5b536.js","node_modules/@parcel/runtime-js/lib/runtime-6c52a4e8d76ec49b.js","node_modules/@parcel/runtime-js/lib/runtime-fa73233744fc505c.js","node_modules/@parcel/runtime-js/lib/runtime-b34e92e9fb9b8c68.js","node_modules/@parcel/runtime-js/lib/runtime-8a2022a1c05c8770.js","src/app/script/klecks/ui/components/tool-dropdown.ts","node_modules/@parcel/runtime-js/lib/runtime-760df77bff0950f0.js","node_modules/@parcel/runtime-js/lib/runtime-ff3da4d7dabee86d.js","node_modules/@parcel/runtime-js/lib/runtime-182f547eb7376cf5.js","node_modules/@parcel/runtime-js/lib/runtime-297f8366ec2375c9.js","node_modules/@parcel/runtime-js/lib/runtime-d831990ac91a582d.js","node_modules/@parcel/runtime-js/lib/runtime-621488e8bcab6d4d.js","src/app/script/klecks/ui/components/toolspace-tool-row.ts","node_modules/@parcel/runtime-js/lib/runtime-7355152122a84936.js","node_modules/@parcel/runtime-js/lib/runtime-81519c452bdfbaa9.js","node_modules/@parcel/runtime-js/lib/runtime-3fc59c96423b70ad.js","node_modules/@parcel/runtime-js/lib/runtime-1eef10cb07c9c851.js","src/app/script/klecks/ui/components/toolspace-stabilizer-row.ts","src/app/script/klecks/ui/components/tab-row.ts","node_modules/@parcel/runtime-js/lib/runtime-b9f67aff2ffaa235.js","src/app/script/klecks/ui/tool-tabs/hand-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-4486cf75fca81822.js","src/app/script/klecks/ui/tool-tabs/fill-ui.ts","src/app/script/klecks/ui/tool-tabs/text-ui.ts","src/app/script/klecks/ui/tool-tabs/shape-ui.ts","src/app/script/klecks/ui/modals/new-image-dialog.ts","src/app/script/klecks/ui/components/toolspace-collapser.ts","node_modules/@parcel/runtime-js/lib/runtime-3ca3a85d3436a84f.js","src/app/script/klecks/ui/modals/text-tool-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-47401ec572d2cfcf.js","node_modules/@parcel/runtime-js/lib/runtime-6476cf999a0e75d3.js","node_modules/@parcel/runtime-js/lib/runtime-4ee49cef2a1bfd51.js","node_modules/@parcel/runtime-js/lib/runtime-01d9fe07522d7373.js","node_modules/@parcel/runtime-js/lib/runtime-8450ca7f4e68dde7.js","src/app/script/klecks/ui/modals/show-import-image-dialog.ts","src/app/script/klecks/storage/psd.ts","src/app/script/klecks/storage/indexed-db.ts","src/app/script/klecks/filters/filters.ts","node_modules/@parcel/runtime-js/lib/runtime-08ec85fc3ea564e8.js","node_modules/@parcel/runtime-js/lib/runtime-c105dce751d9b16c.js","node_modules/@parcel/runtime-js/lib/runtime-272cd0cc0051d99c.js","node_modules/@parcel/runtime-js/lib/runtime-d623cec3e031c802.js","node_modules/@parcel/runtime-js/lib/runtime-4aa563d1de55ad17.js","node_modules/@parcel/runtime-js/lib/runtime-acf5209c71eb3497.js","node_modules/@parcel/runtime-js/lib/runtime-726a62492af9f94e.js","node_modules/@parcel/runtime-js/lib/runtime-f1cff4f2714da535.js","node_modules/@parcel/runtime-js/lib/runtime-06b47f2ffca8a188.js","node_modules/@parcel/runtime-js/lib/runtime-866a2902b0cdf580.js","node_modules/@parcel/runtime-js/lib/runtime-3b4878106cdf1b9c.js","node_modules/@parcel/runtime-js/lib/runtime-02847deebefdd0a7.js","node_modules/@parcel/runtime-js/lib/runtime-3dce3f08da564a07.js","node_modules/@parcel/runtime-js/lib/runtime-0e43c74fde652ea0.js","node_modules/@parcel/runtime-js/lib/runtime-2d3b073eae8e5f9b.js","node_modules/@parcel/runtime-js/lib/runtime-679ef653bc7e04ce.js","node_modules/@parcel/runtime-js/lib/runtime-b88d84f511ba7b52.js","node_modules/@parcel/runtime-js/lib/runtime-032418d95d19e88c.js","src/app/script/klecks/brushes/brushes.ts","src/app/script/klecks/brushes/pen-brush.ts","src/app/script/klecks/brushes/brushes-common.ts","src/app/script/klecks/brushes/alphas/brush-alphas.ts","src/app/script/bb/math/perlin.ts","src/app/script/klecks/brushes/blend-brush.ts","src/app/script/klecks/brushes/sketchy-brush.ts","src/app/script/klecks/brushes/pixel-brush.ts","src/app/script/klecks/brushes/eraser-brush.ts","src/app/script/klecks/brushes/smudge-brush.ts","src/app/script/klecks/brushes/chemy-brush.ts","src/app/script/klecks/brushes-ui/brushes-ui.ts","src/app/script/klecks/brushes-ui/pen-brush-ui.ts","src/app/script/klecks/brushes-ui/brushes-consts.ts","node_modules/@parcel/runtime-js/lib/runtime-f5fee83b55dfe524.js","src/app/script/klecks/brushes-ui/blend-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-c1ff462122383f3a.js","src/app/script/klecks/brushes-ui/sketchy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-c362cafb743e4bf7.js","src/app/script/klecks/brushes-ui/pixel-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-9083363aed84d015.js","src/app/script/klecks/brushes-ui/eraser-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-72d61ca9dbc6379a.js","src/app/script/klecks/brushes-ui/smudge-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-2e54934a27c8b910.js","src/app/script/klecks/brushes-ui/chemy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-a3466c6b7be08d45.js","src/app/script/klecks/ui/base-components/box-toggle.ts","src/app/script/klecks/ui/modals/show-iframe-popup.ts","src/app/script/klecks/ui/base-components/radio-list.ts","src/app/script/klecks/ui/components/browser-storage-ui.ts","src/app/script/klecks/storage/project-store.ts","src/app/script/klecks/storage/project-converter.ts","src/app/script/klecks/storage/base-64-to-blob.ts","src/app/script/klecks/ui/tool-tabs/file-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-174f5efa9e6f0131.js","src/app/script/klecks/ui/tool-tabs/filter-tab.ts","src/app/script/klecks/ui/modals/imgur-upload.ts","node_modules/@parcel/runtime-js/lib/runtime-257b8f01a8ca9ad6.js","src/app/script/klecks/storage/ag-psd-wrapper.ts","node_modules/@parcel/runtime-js/lib/runtime-5ea32053680ef652.js","src/app/script/klecks/ui/components/save-reminder.ts","src/app/script/klecks/storage/save-to-computer.ts","node_modules/file-saver/src/FileSaver.js","src/app/script/klecks/history/undo-redo-catchup.ts","src/app/script/klecks/brushes-ui/brush-setting-service.ts","src/app/script/klecks/ui/tool-tabs/settings-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-3e3712af4386deba.js","node_modules/@parcel/runtime-js/lib/runtime-050615743b2088cc.js","node_modules/@parcel/runtime-js/lib/runtime-4135c6b241ed0f39.js","src/app/script/klecks/ui/components/toolspace-scroller.ts","src/app/script/klecks/ui/tool-tabs/gradient-ui.ts","src/app/script/embed/toolspace-top-row.ts","src/app/script/klecks/filters/filters-lazy.ts","src/app/script/klecks/filters/filter-brightness-contrast.ts","src/app/script/klecks/filters/filters-consts.ts","src/app/script/klecks/filters/shared-gl-fx.ts","src/app/script-vendor/glfx.ts","src/app/script-vendor/shader-noise.glsl","src/app/script/klecks/filters/filter-crop-extend.ts","src/app/script/klecks/filters/filter-curves.ts","src/app/script/klecks/filters/filter-flip.ts","node_modules/@parcel/runtime-js/lib/runtime-0b614230dd5a2fbc.js","src/app/script/klecks/filters/filter-hue-saturation.ts","src/app/script/klecks/filters/filter-invert.ts","src/app/script/klecks/filters/filter-perspective.ts","src/app/script/klecks/ui/components/two-tabs.ts","src/app/script/klecks/filters/filter-resize.ts","node_modules/@parcel/runtime-js/lib/runtime-c388461235ee692d.js","src/app/script/klecks/filters/filter-rotate.ts","src/app/script/klecks/filters/filter-tilt-shift.ts","src/app/script/klecks/filters/filter-transform.ts","src/app/script/klecks/filters/filter-blur.ts","src/app/script/klecks/filters/filter-unsharp-mask.ts","src/app/script/klecks/filters/filter-to-alpha.ts","src/app/script/klecks/filters/filter-grid.ts","src/app/script/klecks/image-operations/draw-grid.ts","src/app/script/klecks/filters/filter-noise.ts","src/app/script/klecks/filters/filter-pattern.ts","src/app/script/klecks/filters/filter-distort.ts","src/app/script/klecks/filters/filter-vanish-point.ts","src/app/script/klecks/image-operations/draw-vanish-point.ts","src/app/script/klecks/storage/kl-canvas-to-psd-blob.ts","node_modules/@parcel/runtime-js/lib/runtime-fe04d655c2a3180f.js","node_modules/@parcel/runtime-js/lib/runtime-f15ea15a7900b9a3.js"],"sourcesContent":["import './polyfills';\r\nimport {KlApp} from './app/kl-app';\r\nimport {IKlProject} from './klecks/kl.types';\r\nimport {SaveReminder} from './klecks/ui/components/save-reminder';\r\nimport {klHistory} from './klecks/history/kl-history';\r\nimport {klPsdToKlProject, readPsd} from './klecks/storage/psd';\r\nimport {LANG} from './language/language';\r\n\r\nexport interface IEmbedParams {\r\n    project?: IKlProject,\r\n    psdBlob?: Blob,\r\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    embedUrl: string;\r\n    logoImg?: any;\r\n    bottomBar?: HTMLElement;\r\n    aboutEl?: HTMLElement;\r\n}\r\n\r\nexport interface IReadPSD {\r\n    blob: Blob;\r\n    callback: (k: IKlProject) => void;\r\n}\r\n\r\nexport function Embed(p: IEmbedParams) {\r\n\r\n    let isInitialized: boolean = false;\r\n    let klApp;\r\n    const psdQueue: IReadPSD[] = []; // queue of psds waiting while ag-psd is loading\r\n    let agPsd: any | 'error';\r\n\r\n    let loadingScreenEl = document.getElementById(\"loading-screen\");\r\n    let loadingScreenTextEl = document.getElementById(\"loading-screen-text\");\r\n    if (loadingScreenTextEl) {\r\n        loadingScreenTextEl.textContent = LANG('embed-init-waiting');\r\n    }\r\n\r\n    function onProjectReady(project: IKlProject) {\r\n        try {\r\n            if (isInitialized) {\r\n                throw new Error('Already called openProject');\r\n            }\r\n            isInitialized = true;\r\n\r\n            const saveReminder = new SaveReminder(\r\n                klHistory,\r\n                false,\r\n                false,\r\n                () => {},\r\n                () => klApp ? klApp.isDrawing() : false,\r\n                null,\r\n                null,\r\n            );\r\n            klApp = new KlApp(\r\n                project,\r\n                {\r\n                    saveReminder,\r\n                    bottomBar: p.bottomBar,\r\n                    aboutEl: p.aboutEl,\r\n                    embed: {\r\n                        url: p.embedUrl,\r\n                        onSubmit: p.onSubmit,\r\n                    }\r\n                }\r\n            );\r\n            saveReminder.init();\r\n\r\n            if (loadingScreenEl && loadingScreenEl.parentNode) {\r\n                loadingScreenEl.parentNode.removeChild(loadingScreenEl);\r\n            }\r\n            loadingScreenEl = null;\r\n            loadingScreenTextEl = null;\r\n\r\n            document.body.appendChild(klApp.getEl());\r\n        } catch (e) {\r\n            if (loadingScreenTextEl) {\r\n                loadingScreenTextEl.textContent = ' ' + e;\r\n            }\r\n            if (loadingScreenEl) {\r\n                loadingScreenEl.className += 'loading-screen-error';\r\n            }\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    if (p.project) {\r\n        onProjectReady(p.project);\r\n    }\r\n    this.openProject = onProjectReady;\r\n    this.initError = (error: string) => {\r\n        if (loadingScreenTextEl) {\r\n            loadingScreenTextEl.textContent = ' ' + error;\r\n        }\r\n        if (loadingScreenEl) {\r\n            loadingScreenEl.className += 'loading-screen-error';\r\n        }\r\n    };\r\n    this.getPNG = (): Blob => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return klApp.getPNG();\r\n    };\r\n    this.getPSD = async (): Promise<Blob> => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return await klApp.getPSD();\r\n    };\r\n    this.readPSDs = (psds: IReadPSD[]) => {\r\n        if (psds.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const readItem = (item: IReadPSD) => {\r\n            try {\r\n                const psd = agPsd.readPsd(item.blob);\r\n                const project = klPsdToKlProject(readPsd(psd));\r\n                item.callback(project);\r\n            } catch (e) {\r\n                console.error('failed to read psd', e);\r\n                item.callback(null);\r\n            }\r\n        };\r\n\r\n        if (!agPsd) {\r\n            if (psdQueue.length === 0) {\r\n                // load ag-psd\r\n                (async () => {\r\n                    try {\r\n                        agPsd = await import('ag-psd');\r\n                    } catch (e) {\r\n                        agPsd = 'error';\r\n                    }\r\n                    while (psdQueue.length) {\r\n                        readItem(psdQueue.shift());\r\n                    }\r\n                })();\r\n            }\r\n            psds.forEach(item => {\r\n                psdQueue.push(item);\r\n            });\r\n        } else {\r\n            psds.forEach(readItem);\r\n        }\r\n    };\r\n}","// import 'core-js';\r\nimport 'mdn-polyfills/Node.prototype.append';\r\nimport 'mdn-polyfills/Node.prototype.prepend';\r\nimport 'mdn-polyfills/String.prototype.padStart';\r\nimport 'mdn-polyfills/Array.prototype.findIndex';\r\n\r\nif (!('scrollTo' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollTo', {\r\n        value: function (x, y) {\r\n            this.scrollLeft = x;\r\n            this.scrollTop = y;\r\n        }\r\n    });\r\n}\r\n\r\nif (!('scrollBy' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollBy', {\r\n        value: function (x, y) {\r\n            this.scrollLeft += x;\r\n            this.scrollTop += y;\r\n        }\r\n    });\r\n}\r\n\r\n// sometimes Android WebView has no localStorage\r\nif (!('localStorage' in window)) {\r\n    try {\r\n        window['localStorage'] = {\r\n            getItem: () => null,\r\n            setItem: () => {},\r\n            removeItem: () => {},\r\n        } as any;\r\n    } catch (e) {\r\n        // maybe it doesn't let me set this\r\n    }\r\n}","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"append\")||Object.defineProperty(e,\"append\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(n,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"prepend\")||Object.defineProperty(e,\"prepend\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","String.prototype.padStart||(String.prototype.padStart=function(t,n){return t>>=0,n=String(n||\" \"),this.length>t?String(this):((t-=this.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(this))});\n","Array.prototype.findIndex||Object.defineProperty(Array.prototype,\"findIndex\",{value:function(r){if(null==this)throw new TypeError('\"this\" is null or not defined');var e=Object(this),t=e.length>>>0;if(\"function\"!=typeof r)throw new TypeError(\"predicate must be a function\");for(var n=arguments[1],o=0;o<t;){var i=e[o];if(r.call(n,i,o,e))return o;o++}return-1}});\n","import {KL} from '../klecks/kl';\r\nimport {klHistory} from '../klecks/history/kl-history';\r\nimport {BB} from '../bb/bb';\r\nimport {showIframePopup} from '../klecks/ui/modals/show-iframe-popup';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\nimport {exportType} from '../klecks/ui/tool-tabs/file-tab';\r\nimport {ToolspaceTopRow} from \"../embed/toolspace-top-row\";\r\nimport {IGradient, IInitState, IKlProject, IKlPsd} from '../klecks/kl.types';\r\nimport {importFilters} from '../klecks/filters/filters-lazy';\r\nimport {base64ToBlob} from '../klecks/storage/base-64-to-blob';\r\nimport {klCanvasToPsdBlob} from '../klecks/storage/kl-canvas-to-psd-blob';\r\nimport {ProjectStore} from '../klecks/storage/project-store';\r\nimport {SaveReminder} from \"../klecks/ui/components/save-reminder\";\r\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\r\nimport {LANG} from '../language/language';\r\n// @ts-ignore\r\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\r\n// @ts-ignore\r\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\r\n// @ts-ignore\r\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\r\n// @ts-ignore\r\nimport toolGradientImg from 'url:~/src/app/img/ui/tool-gradient.svg';\r\n// @ts-ignore\r\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\r\n// @ts-ignore\r\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\r\n// @ts-ignore\r\nimport tabSettingsImg from 'url:~/src/app/img/ui/tab-settings.svg';\r\n// @ts-ignore\r\nimport tabLayersImg from 'url:~/src/app/img/ui/tab-layers.svg';\r\nimport {LocalStorage} from '../bb/base/local-storage';\r\n\r\n\r\ninterface IKlAppOptions {\r\n    saveReminder?: SaveReminder;\r\n    projectStore?: ProjectStore;\r\n    logoImg?: any; // app logo\r\n    bottomBar?: HTMLElement; // row at bottom of toolspace\r\n    embed?: {\r\n        url: string;\r\n        onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    };\r\n    app?: {\r\n        filenameBase?: string; // part of filename when downloading drawing\r\n        imgurKey?: string; // for imgur uploads\r\n    };\r\n    aboutEl?: HTMLElement; // replaces info about Klecks in settings tab\r\n}\r\n\r\nimportFilters();\r\n\r\nexport function KlApp(pProject: IKlProject | null, pOptions: IKlAppOptions) {\r\n    // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\r\n    // but not larger than 4096 - a fairly arbitrary decision\r\n    let klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\r\n    let collapseThreshold = 820;\r\n    let uiState: 'left' | 'right' = (pOptions.embed ? 'left' : (LocalStorage.getItem('uiState') ? LocalStorage.getItem('uiState') : 'right')) as any;\r\n    const filenameBase = pOptions.app?.filenameBase ? pOptions.app.filenameBase : 'Klecks';\r\n    const projectStore = pOptions.projectStore;\r\n    let klRootEl = document.createElement(\"div\");\r\n    klRootEl.className = 'g-root';\r\n    let uiWidth: number = Math.max(0, window.innerWidth);\r\n    let uiHeight: number = Math.max(0, window.innerHeight);\r\n    const toolWidth = 271;\r\n    let exportType: exportType = 'png';\r\n    let klCanvas: KlCanvas = new KL.KlCanvas(\r\n        pProject ? {\r\n            projectObj: pProject\r\n        } : {\r\n            width: Math.max(10, Math.min(klMaxCanvasSize, window.innerWidth < collapseThreshold ? uiWidth : uiWidth - toolWidth)),\r\n            height: Math.max(10, Math.min(klMaxCanvasSize, uiHeight)),\r\n        }, pOptions.embed ? -1 : 0);\r\n    klCanvas.setHistory(klHistory);\r\n    let initState: IInitState = null;\r\n    let mainTabRow;\r\n\r\n    if (!pOptions.saveReminder) {\r\n        pOptions.saveReminder = {init: () => {}, reset: () => {}} as SaveReminder;\r\n    }\r\n\r\n    function translateSmoothing(s: number): number {\r\n        if (s == 1) {\r\n            return 1 - 0.5;\r\n        }\r\n        if (s == 2) {\r\n            return 1 - 0.16;\r\n        }\r\n        if (s == 3) {\r\n            return 1 - 0.035;\r\n        }\r\n        if (s == 4) {\r\n            return 1 - 0.0175;\r\n        }\r\n        if (s == 5) {\r\n            return 1 - 0.00875;\r\n        }\r\n        return s;\r\n    }\r\n\r\n    let isFirstImage = true;\r\n\r\n    if (pProject) {\r\n        pProject.layers.forEach(layer => {\r\n            layer.image = null;\r\n        });\r\n        pProject = null;\r\n    } else {\r\n        klHistory.pause(true);\r\n        klCanvas.addLayer();\r\n        klCanvas.layerFill(0, { r: 255, g: 255, b: 255});\r\n        klHistory.pause(false);\r\n    }\r\n    try {\r\n        initState = {\r\n            canvas: new KL.KlCanvas({copy: klCanvas}, pOptions.embed ? -1 : 0),\r\n            focus: klCanvas.getLayerCount() - 1,\r\n            brushes: {},\r\n        };\r\n    } catch (e) {\r\n        if (e.message === 'kl-create-canvas-error') {\r\n            klCanvas.destroy();\r\n        }\r\n        throw e;\r\n    }\r\n    for (let b in KL.brushes) {\r\n        if (KL.brushes.hasOwnProperty(b)) {\r\n            initState.brushes[b] = new KL.brushes[b]();\r\n            if (initState.canvas) {\r\n                initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    let currentColor = new BB.RGB(0, 0, 0);\r\n    let currentBrush;\r\n    let currentBrushId: string;\r\n    let lastNonEraserBrushId: string;\r\n    let currentLayerCtx = klCanvas.getLayerContext(klCanvas.getLayerCount() - 1);\r\n\r\n    // when cycling through brushes you need to know the next non-eraser brush\r\n    function getNextBrushId(): string {\r\n        if (currentBrushId === 'eraserBrush') {\r\n            return lastNonEraserBrushId;\r\n        }\r\n        const keyArr = Object.keys(brushUiObj).filter(item => item !== 'eraserBrush');\r\n        const i = keyArr.findIndex(item => item === currentBrushId);\r\n        return keyArr[(i + 1) % keyArr.length];\r\n    }\r\n\r\n    function sizeWatcher(val) {\r\n        brushSettingService.emitSize(val);\r\n        if (klCanvasWorkspace) {\r\n            klCanvasWorkspace.setCursorSize(val * 2);\r\n        }\r\n    }\r\n\r\n    const brushSettingService = new KL.BrushSettingService(\r\n        (color) => {\r\n            klColorSlider.setColor(color);\r\n            currentBrush.setColor(color);\r\n            currentColor = BB.copyObj(color);\r\n        },\r\n        (size) => {\r\n            currentBrush.setSize(size);\r\n            klCanvasWorkspace.setCursorSize(size * 2);\r\n        },\r\n        (opacity) => {\r\n            currentBrush.setOpacity(opacity);\r\n        },\r\n        () => klColorSlider.getColor(),\r\n        () => brushUiObj[currentBrushId].getSize(),\r\n        () => brushUiObj[currentBrushId].getOpacity(),\r\n        () => {\r\n            return {\r\n                sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\r\n            };\r\n        }\r\n    );\r\n\r\n    let lineSmoothing = new BB.EventChain.LineSmoothing({\r\n        smoothing: translateSmoothing(1),\r\n    });\r\n    let lineSanitizer = new BB.EventChain.LineSanitizer();\r\n\r\n    let drawEventChain = new BB.EventChain.EventChain({\r\n        chainArr: [\r\n            lineSanitizer,\r\n            lineSmoothing\r\n        ],\r\n    });\r\n\r\n    drawEventChain.setChainOut(function(event) {\r\n        if (event.type === 'down') {\r\n            toolspace.style.pointerEvents = 'none';\r\n            currentBrush.startLine(event.x, event.y, event.pressure);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'move') {\r\n            currentBrush.goLine(event.x, event.y, event.pressure, false, event.isCoalesced)\r\n            klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'up') {\r\n            toolspace.style.pointerEvents = '';\r\n            currentBrush.endLine();\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'line') {\r\n            currentBrush.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n    });\r\n\r\n    let textToolSettings = {\r\n        size: 20,\r\n        align: 'left' as ('left' | 'center' | 'right'),\r\n        isBold: false,\r\n        isItalic: false,\r\n        font: 'sans-serif' as ('serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'),\r\n        opacity: 1\r\n    };\r\n\r\n    const klCanvasWorkspace: KlCanvasWorkspace = new KL.KlCanvasWorkspace({\r\n        klCanvas: klCanvas,\r\n        width: Math.max(0, uiWidth - toolWidth),\r\n        height: uiHeight,\r\n        onDraw: drawEventChain.chainIn,\r\n        onPick: function(rgbObj, isDragDone) {\r\n            brushSettingService.setColor(rgbObj);\r\n            if (isDragDone) {\r\n                klColorSlider.pickingDone();\r\n                klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\r\n            }\r\n        },\r\n        onFill: function(canvasX, canvasY) {\r\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n            klCanvas.floodFill(\r\n                layerIndex,\r\n                canvasX,\r\n                canvasY,\r\n                fillUi.getIsEraser() ? null : klColorSlider.getColor(),\r\n                fillUi.getOpacity(),\r\n                fillUi.getTolerance(),\r\n                fillUi.getSample(),\r\n                fillUi.getGrow(),\r\n                fillUi.getContiguous()\r\n            );\r\n            klCanvasWorkspace.requestFrame();\r\n        },\r\n        onGradient: function(typeStr, canvasX, canvasY, angleRad) {\r\n            if (typeStr === 'down') {\r\n                gradientTool.onDown(canvasX, canvasY, angleRad);\r\n            }\r\n            if (typeStr === 'move') {\r\n                gradientTool.onMove(canvasX, canvasY);\r\n            }\r\n            if (typeStr === 'up') {\r\n                gradientTool.onUp(canvasX, canvasY);\r\n            }\r\n        },\r\n        onText: function(canvasX, canvasY, angleRad) {\r\n            if (KL.dialogCounter.get() > 0) {\r\n                return;\r\n            }\r\n\r\n            KL.textToolDialog({\r\n                klCanvas: klCanvas,\r\n                layerIndex: klCanvas.getLayerIndex(currentLayerCtx.canvas),\r\n                x: canvasX,\r\n                y: canvasY,\r\n                angleRad: angleRad,\r\n                color: klColorSlider.getColor(),\r\n                secondaryColor: klColorSlider.getSecondaryRGB(),\r\n                size: textToolSettings.size,\r\n                align: textToolSettings.align,\r\n                isBold: textToolSettings.isBold,\r\n                isItalic: textToolSettings.isItalic,\r\n                font: textToolSettings.font,\r\n                opacity: textToolSettings.opacity,\r\n                onConfirm: function(val) {\r\n\r\n                    let colorRGBA = val.color;\r\n                    colorRGBA.a = val.opacity;\r\n\r\n                    textToolSettings.size = val.size;\r\n                    textToolSettings.align = val.align;\r\n                    textToolSettings.isBold = val.isBold;\r\n                    textToolSettings.isItalic = val.isItalic;\r\n                    textToolSettings.font = val.font;\r\n                    textToolSettings.opacity = val.opacity;\r\n\r\n                    let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                    klCanvas.text(layerIndex, {\r\n                        textStr: val.textStr,\r\n                        x: val.x,\r\n                        y: val.y,\r\n                        size: val.size,\r\n                        font: val.font,\r\n                        align: val.align,\r\n                        isBold: val.isBold,\r\n                        isItalic: val.isItalic,\r\n                        angleRad: angleRad,\r\n                        color: BB.ColorConverter.toRgbaStr(colorRGBA)\r\n                    });\r\n                    klCanvasWorkspace.requestFrame();\r\n                }\r\n            });\r\n\r\n        },\r\n        onShape: function(typeStr, canvasX, canvasY, angleRad) {\r\n            if (typeStr === 'down') {\r\n                shapeTool.onDown(canvasX, canvasY, angleRad);\r\n            }\r\n            if (typeStr === 'move') {\r\n                shapeTool.onMove(canvasX, canvasY);\r\n            }\r\n            if (typeStr === 'up') {\r\n                shapeTool.onUp(canvasX, canvasY);\r\n            }\r\n        },\r\n\r\n        onViewChange: function(viewChangeObj) {\r\n\r\n            if (viewChangeObj.changed.includes('scale')) {\r\n                statusOverlay.out({\r\n                    type: 'transform',\r\n                    scale: viewChangeObj.scale,\r\n                    angleDeg: viewChangeObj.angle * 180 / Math.PI\r\n                });\r\n            }\r\n\r\n            toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== klCanvasWorkspace.getMaxScale());\r\n            toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== klCanvasWorkspace.getMinScale());\r\n\r\n            handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\r\n        },\r\n        onUndo: function() {\r\n            if (klHistory.canUndo()) {\r\n                if (undoRedoCatchup.undo()) {\r\n                    statusOverlay.out(LANG('undo'), true);\r\n                }\r\n            }\r\n        },\r\n        onRedo: function() {\r\n            if (klHistory.canRedo()) {\r\n                if (undoRedoCatchup.redo()) {\r\n                    statusOverlay.out(LANG('redo'), true);\r\n                }\r\n            }\r\n        },\r\n    });\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, event, comboStr) {\r\n            if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n\r\n            let isDrawing = lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\r\n            if (isDrawing) {\r\n                return;\r\n            }\r\n\r\n            if (comboStr === 'plus') {\r\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n            }\r\n            if (comboStr === 'minus') {\r\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n            }\r\n            if (comboStr === 'home') {\r\n                klCanvasWorkspace.fitView();\r\n            }\r\n            if (comboStr === 'end') {\r\n                klCanvasWorkspace.resetView(true);\r\n            }\r\n            if (['ctrl+z', 'cmd+z'].includes(comboStr)) {\r\n                event.preventDefault();\r\n                undoRedoCatchup.undo();\r\n            }\r\n            if (\r\n                ['ctrl+y', 'cmd+y'].includes(comboStr) ||\r\n                (\r\n                    (\r\n                        BB.sameKeys('ctrl+shift+z', comboStr) ||\r\n                        BB.sameKeys('cmd+shift+z', comboStr)\r\n                    ) && keyStr === 'z'\r\n                )\r\n            ) {\r\n                event.preventDefault();\r\n                undoRedoCatchup.redo();\r\n            }\r\n            if (!pOptions.embed) {\r\n                if (['ctrl+s', 'cmd+s'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    saveToComputer.save();\r\n                }\r\n                if (['ctrl+shift+s', 'cmd+shift+s'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n\r\n                    (async () => {\r\n                        let success = true;\r\n                        try {\r\n                            await projectStore.store(klCanvas.getProject());\r\n                        } catch (e) {\r\n                            success = false;\r\n                            setTimeout(() => {\r\n                                throw new Error('keyboard-shortcut: failed to store browser storage, ' + e);\r\n                            }, 0);\r\n                            statusOverlay.out(' ' + LANG('file-storage-failed'), true);\r\n                        }\r\n                        if (success) {\r\n                            pOptions.saveReminder.reset();\r\n                            statusOverlay.out(LANG('file-storage-stored'), true);\r\n                        }\r\n                    })();\r\n                }\r\n                if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    copyToClipboard(true);\r\n                }\r\n            }\r\n            if (['ctrl+a', 'cmd+a'].includes(comboStr)) {\r\n                event.preventDefault();\r\n            }\r\n\r\n\r\n            if (keyListener.comboOnlyContains(['left', 'right', 'up', 'down'])) {\r\n                if (keyStr === 'left') {\r\n                    klCanvasWorkspace.translateView(1, 0);\r\n                }\r\n                if (keyStr === 'right') {\r\n                    klCanvasWorkspace.translateView(-1, 0);\r\n                }\r\n                if (keyStr === 'up') {\r\n                    klCanvasWorkspace.translateView(0, 1);\r\n                }\r\n                if (keyStr === 'down') {\r\n                    klCanvasWorkspace.translateView(0, -1);\r\n                }\r\n            }\r\n\r\n\r\n            if (['r+left','r+right'].includes(comboStr)) {\r\n                if (keyStr === 'left') {\r\n                    klCanvasWorkspace.setAngle(-15, true);\r\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n                }\r\n                if (keyStr === 'right') {\r\n                    klCanvasWorkspace.setAngle(15, true);\r\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n                }\r\n            }\r\n            if (['r+up'].includes(comboStr)) {\r\n                klCanvasWorkspace.setAngle(0);\r\n                handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n            }\r\n\r\n\r\n            if (comboStr === 'sqbr_open') {\r\n                currentBrush.decreaseSize(0.03 / klCanvasWorkspace.getScale());\r\n            }\r\n            if (comboStr === 'sqbr_close') {\r\n                currentBrush.increaseSize(0.03 / klCanvasWorkspace.getScale());\r\n            }\r\n            if (comboStr === 'enter') {\r\n                klCanvas.layerFill(klCanvas.getLayerIndex(currentLayerCtx.canvas), klColorSlider.getColor());\r\n                statusOverlay.out(LANG('filled'), true);\r\n            }\r\n            if (['delete', 'backspace'].includes(comboStr)) {\r\n                let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                if (layerIndex === 0 && !brushUiObj.eraserBrush.getIsTransparentBg()) {\r\n                    klCanvas.layerFill(layerIndex, {r: 255, g: 255, b: 255}, 'source-in');\r\n                } else {\r\n                    klCanvas.clearLayer(layerIndex);\r\n                }\r\n                statusOverlay.out(LANG('cleared-layer'), true);\r\n            }\r\n            if (comboStr === 'e') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('draw');\r\n                toolspaceToolRow.setActive('draw');\r\n                mainTabRow.open('draw');\r\n                updateMainTabVisibility();\r\n                brushTabRow.open('eraserBrush');\r\n            }\r\n            if (comboStr === 'b') {\r\n                event.preventDefault();\r\n                const prevMode = klCanvasWorkspace.getMode();\r\n                klCanvasWorkspace.setMode('draw');\r\n                toolspaceToolRow.setActive('draw');\r\n                mainTabRow.open('draw');\r\n                updateMainTabVisibility();\r\n                brushTabRow.open(prevMode === 'draw' ? getNextBrushId() : currentBrushId);\r\n            }\r\n            if (comboStr === 'g') {\r\n                event.preventDefault();\r\n                const newMode = klCanvasWorkspace.getMode() === 'fill' ? 'gradient' : 'fill';\r\n                klCanvasWorkspace.setMode(newMode);\r\n                toolspaceToolRow.setActive(newMode);\r\n                mainTabRow.open(newMode);\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 't') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('text');\r\n                toolspaceToolRow.setActive('text');\r\n                mainTabRow.open('text');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 'u') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('shape');\r\n                toolspaceToolRow.setActive('shape');\r\n                mainTabRow.open('shape');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 'x') {\r\n                event.preventDefault();\r\n                klColorSlider.swapColors();\r\n            }\r\n\r\n\r\n        },\r\n        onUp: function(keyStr, event) {\r\n        }\r\n    });\r\n\r\n    /**\r\n     *\r\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\r\n     * @param filename - string e.g. 'drawing.psd'\r\n     * @param optionStr? - 'default' | 'layer' | 'image'\r\n     */\r\n    function importFinishedLoading(\r\n        importedImage: IKlPsd | {\r\n            type: 'image';\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLCanvasElement | HTMLImageElement;\r\n        },\r\n        filename: string,\r\n        optionStr: 'default' | 'layer' | 'image',\r\n    ) {\r\n        if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                type: \"error\",\r\n                message: LANG('import-broken-file'),\r\n                buttons: [\"Ok\"],\r\n            });\r\n            return;\r\n        }\r\n\r\n        function getResizedDimensions(width, height) {\r\n            let w = parseInt(width);\r\n            let h = parseInt(height);\r\n            if (w > klMaxCanvasSize) {\r\n                h = klMaxCanvasSize / w * h;\r\n                w = klMaxCanvasSize;\r\n            }\r\n            if (h > klMaxCanvasSize) {\r\n                w = klMaxCanvasSize / h * w;\r\n                h = klMaxCanvasSize;\r\n            }\r\n            w = parseInt('' + w);\r\n            h = parseInt('' + h);\r\n            return {\r\n                width: w,\r\n                height: h\r\n            }\r\n        }\r\n\r\n        function importAsImage(canvas) {\r\n            let resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\r\n\r\n            //resize first\r\n            let tempCanvas = BB.canvas(canvas.width, canvas.height);\r\n            let tempCanvasCtx = tempCanvas.getContext('2d');\r\n            tempCanvasCtx.drawImage(canvas, 0, 0);\r\n\r\n            BB.resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\r\n\r\n            klCanvas.reset({\r\n                width: resizedDimensions.width,\r\n                height: resizedDimensions.height,\r\n                image: tempCanvas,\r\n                layerName: filename\r\n            });\r\n\r\n            layerManager.update(0);\r\n            setCurrentLayer(klCanvas.getLayer(0));\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n            isFirstImage = false;\r\n        }\r\n\r\n        /**\r\n         *\r\n         * @param convertedPsdObj - if flattened then without layers\r\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\r\n         */\r\n        function importAsImagePsd(convertedPsdObj: IKlPsd, cropObj?) {\r\n\r\n            // crop\r\n            function crop(targetCanvas, cropCanvas, cropObj) {\r\n                cropCanvas.width = cropCanvas.width;\r\n                cropCanvas.getContext('2d').drawImage(targetCanvas, -cropObj.x, -cropObj.y);\r\n                targetCanvas.width = cropObj.width;\r\n                targetCanvas.height = cropObj.height;\r\n                targetCanvas.getContext('2d').drawImage(cropCanvas, 0, 0);\r\n            }\r\n            if (cropObj && (cropObj.width !== convertedPsdObj.width ||cropObj.height !== convertedPsdObj.height)) {\r\n                let cropCanvas = BB.canvas(cropObj.width, cropObj.height);\r\n                convertedPsdObj.width = cropObj.width;\r\n                convertedPsdObj.height = cropObj.height;\r\n\r\n                if (!convertedPsdObj.layers) {\r\n                    crop(convertedPsdObj.canvas, cropCanvas, cropObj);\r\n                }\r\n                if (convertedPsdObj.layers) {\r\n                    for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                        let item = convertedPsdObj.layers[i];\r\n                        crop(item.image, cropCanvas, cropObj);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // resize\r\n            let resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\r\n            convertedPsdObj.width = resizedDimensions.width;\r\n            convertedPsdObj.height = resizedDimensions.height;\r\n            if (!convertedPsdObj.layers) {\r\n                BB.resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\r\n            }\r\n            if (convertedPsdObj.layers) {\r\n                for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                    let item = convertedPsdObj.layers[i];\r\n                    BB.resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\r\n                }\r\n            }\r\n\r\n            let layerIndex;\r\n            if (convertedPsdObj.layers) {\r\n                layerIndex = klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    layers: convertedPsdObj.layers\r\n                });\r\n            } else {\r\n                layerIndex = klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    image: convertedPsdObj.canvas\r\n                });\r\n            }\r\n            layerManager.update(layerIndex);\r\n            setCurrentLayer(klCanvas.getLayer(layerIndex));\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n            isFirstImage = false;\r\n        }\r\n\r\n        function importAsLayer(canvas) {\r\n            KL.showImportAsLayerDialog({\r\n                target: klRootEl,\r\n                klCanvas: klCanvas,\r\n                importImage: canvas,\r\n                callback: function(transformObj, isPixelated: boolean) {\r\n                    if (!transformObj) {\r\n                        return;\r\n                    }\r\n\r\n                    klHistory.pause(true);\r\n                    klCanvas.addLayer();\r\n                    let layers = klCanvas.getLayers();\r\n                    let activeLayerIndex = layers.length - 1;\r\n                    if (filename) {\r\n                        klCanvas.renameLayer(activeLayerIndex, filename);\r\n                    }\r\n                    let activeLayerContext = klCanvas.getLayerContext(activeLayerIndex);\r\n                    BB.drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, null, isPixelated);\r\n                    setCurrentLayer(klCanvas.getLayer(activeLayerIndex));\r\n                    layerManager.update(activeLayerIndex);\r\n\r\n                    klHistory.pause(false);\r\n\r\n                    klHistory.push({\r\n                        tool: [\"misc\"],\r\n                        action: \"importImage\",\r\n                        params: [BB.copyCanvas(activeLayerContext.canvas), filename]\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n\r\n        if (optionStr === 'default' || !optionStr) {\r\n            KL.showImportImageDialog({\r\n                image: importedImage,\r\n                target: klRootEl,\r\n                maxSize: klMaxCanvasSize,\r\n                callback: function(res) {\r\n                    if (res.type === 'as-image') {\r\n                        importAsImage(res.image);\r\n                    } else if (res.type === 'as-image-psd') {\r\n                        importAsImagePsd(res.image, res.cropObj);\r\n                    } else if (res.type === 'as-layer') {\r\n                        importAsLayer(res.image);\r\n                    } else if (res.type === 'cancel') {\r\n                        // nothing to do\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        if (optionStr === 'layer') {\r\n            importAsLayer(importedImage.canvas);\r\n        }\r\n        if (optionStr === 'image') {\r\n            if (importedImage.type === 'psd') {\r\n                importAsImagePsd(importedImage);\r\n            } else {\r\n                importAsImage(importedImage.canvas);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    function onPaste(e) {\r\n        if (KL.dialogCounter.get() > 0) {\r\n            return;\r\n        }\r\n\r\n        function retrieveImageFromClipboardAsBlob(pasteEvent, callback) {\r\n            if (pasteEvent.clipboardData == false) {\r\n                if (typeof (callback) == \"function\") {\r\n                    callback(undefined);\r\n                }\r\n            }\r\n\r\n            let items = pasteEvent.clipboardData.items;\r\n\r\n            if (items == undefined) {\r\n                if (typeof (callback) == \"function\") {\r\n                    callback(undefined);\r\n                }\r\n            } else {\r\n                for (let i = 0; i < items.length; i++) {\r\n                    if (items[i].type.indexOf(\"image\") == -1) {\r\n                        continue;\r\n                    }\r\n                    let blob = items[i].getAsFile();\r\n\r\n                    if (typeof (callback) == \"function\") {\r\n                        callback(blob);\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (e.clipboardData.files[0]) {\r\n            retrieveImageFromClipboardAsBlob(e, function (imageBlob) {\r\n                // If there's an image, display it in the canvas\r\n                if (imageBlob) {\r\n                    let img = new Image();\r\n                    img.onload = function () {\r\n                        URL.revokeObjectURL(img.src);\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img\r\n                        }, null, 'default');\r\n                    };\r\n                    let URLObj = window.URL || window.webkitURL;\r\n                    img.src = URLObj.createObjectURL(imageBlob);\r\n                }\r\n            });\r\n        } else if (e.clipboardData.items[0]) {\r\n            e.clipboardData.items[0].getAsString(function(pasteStr) {\r\n                pasteStr = pasteStr.trim();\r\n                if (pasteStr.match(/^https?/)) {\r\n                    // url\r\n                    let img = new Image();\r\n                    img.onload = function () {\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img\r\n                        }, null, 'default');\r\n                    };\r\n                    img.onerror = function (e) {\r\n                        console.log('error loading', e);\r\n                    };\r\n                    img.crossOrigin = 'Anonymous';\r\n                    img.src = pasteStr;\r\n\r\n                } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\r\n                    // url\r\n                    let rgbObj = BB.ColorConverter.hexToRGB(pasteStr.replace('#', ''));\r\n                    brushSettingService.setColor(rgbObj);\r\n                }\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    function handleFileSelect(files, optionStr) {\r\n\r\n        function showWarningPsdFlattened() {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                type: \"warning\",\r\n                message: LANG('import-psd-unsupported') + \"<br /><br />\",\r\n                buttons: [\"Ok\"],\r\n            });\r\n        }\r\n\r\n        let hasUnsupportedFile = false;\r\n        for (let i = 0, file; file = files[i]; i++) {\r\n            let extension = file.name.split(\".\");\r\n            extension = extension[extension.length - 1].toLowerCase();\r\n            if (extension === \"psd\") {\r\n\r\n                (function(f) {\r\n                    let loaderSizeBytes = 1024 * 1024 * 25; // 25mb\r\n                    let maxSizeBytes = 1024 * 1024 * 1024; // 1gb\r\n                    let maxResolution = 4096;\r\n\r\n                    if (f.size >= maxSizeBytes) { // pretty likely to break stuff\r\n                        KL.popup({\r\n                            target: klRootEl,\r\n                            type: \"error\",\r\n                            message: \"File too big. Unable to import.<br /><br />\",\r\n                            buttons: [\"Ok\"],\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    let doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\r\n                    let loaderIsOpen = true;\r\n                    let closeLoader;\r\n\r\n                    if (doShowLoader) {\r\n                        KL.popup({\r\n                            target: klRootEl,\r\n                            message: LANG('import-opening'),\r\n                            callback: function (result) {\r\n                                loaderIsOpen = false;\r\n                                closeLoader = null;\r\n                            },\r\n                            closefunc: function (f) {\r\n                                closeLoader = f;\r\n                            }\r\n                        });\r\n                    }\r\n\r\n\r\n                    let reader = new FileReader();\r\n                    reader.onload = function (readerResult) {\r\n\r\n                        KL.loadAgPsd().then(function(agPsdLazy) {\r\n\r\n                            if (doShowLoader && !loaderIsOpen) {\r\n                                return;\r\n                            }\r\n\r\n                            try {\r\n                                let psd;\r\n\r\n                                // first pass, only read metadata\r\n                                psd = agPsdLazy.readPsd(\r\n                                    (readerResult.target.result as any),\r\n                                    {\r\n                                        skipLayerImageData: true,\r\n                                        skipThumbnail: true,\r\n                                        skipCompositeImageData: true\r\n                                    });\r\n                                if (psd.width > maxResolution || psd.height > maxResolution) {\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    KL.popup({\r\n                                        target: klRootEl,\r\n                                        type: \"error\",\r\n                                        //message: \"Image exceeds maximum dimensions of \" + maxResolution + \" x \" + maxResolution + \" pixels. Unable to import.\"\r\n                                        message: LANG('import-psd-too-large').replace(/{x}/g, '' + maxResolution)\r\n                                            + \"<br /><br />\"\r\n                                            + LANG('import-psd-size') + \": \" + psd.width + \" x \" + psd.height + ' pixels'\r\n                                            + \"<br /><br />\"\r\n                                        ,\r\n                                        buttons: [\"Ok\"],\r\n                                    });\r\n                                    return;\r\n                                }\r\n\r\n\r\n                                // second pass, now load actual data.\r\n                                psd = null;\r\n\r\n                                try {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any));\r\n                                } catch (e) {\r\n                                    //console.log('failed regular psd import', e);\r\n                                }\r\n                                if (psd) {\r\n                                    //console.log('psd', psd);\r\n                                    let convertedPsd = KL.PSD.readPsd(psd);\r\n                                    //console.log('converted', convertedPsd);\r\n                                    if (optionStr === 'image' && convertedPsd.error) {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    importFinishedLoading(convertedPsd, f.name, optionStr);\r\n                                } else {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any), { skipLayerImageData: true, skipThumbnail: true });\r\n                                    if (optionStr === 'image') {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    importFinishedLoading({\r\n                                        type: 'psd',\r\n                                        width: psd.width,\r\n                                        height: psd.height,\r\n                                        canvas: psd.canvas,\r\n                                        error: true\r\n                                    }, f.name, optionStr);\r\n                                }\r\n\r\n\r\n                            } catch (e) {\r\n                                if (closeLoader) {\r\n                                    closeLoader();\r\n                                }\r\n                                KL.popup({\r\n                                    target: klRootEl,\r\n                                    type: \"error\",\r\n                                    message: \"Failed to load PSD.<br /><br />\",\r\n                                    buttons: [\"Ok\"],\r\n                                });\r\n                            }\r\n                        }).catch(() => {\r\n                            closeLoader();\r\n                            alert('Error: failed to load PSD library');\r\n                        });\r\n\r\n                    };\r\n                    reader.readAsArrayBuffer(f);\r\n                })(file);\r\n\r\n            } else if (file.type.match('image.*')) {\r\n                (function (f) {\r\n                    window.URL = window.URL || window.webkitURL;\r\n                    let url = window.URL.createObjectURL(f);\r\n                    let im = new Image();\r\n                    im.src = url;\r\n                    BB.loadImage(im, function () {\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: im.width,\r\n                            height: im.height,\r\n                            canvas: im\r\n                        }, f.name, optionStr);\r\n                    });\r\n                })(file);\r\n            } else {\r\n                hasUnsupportedFile = true;\r\n            }\r\n        }\r\n        if (hasUnsupportedFile) {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                message: LANG('import-unsupported-file'),\r\n                type: 'error',\r\n                buttons: ['OK'],\r\n            });\r\n        }\r\n    }\r\n\r\n    if (!pOptions.embed) {\r\n        new KL.KlImageDropper({\r\n            target: document.body,\r\n            onDrop: function(files, optionStr) {\r\n                if (KL.dialogCounter.get() > 0) {\r\n                    return;\r\n                }\r\n                handleFileSelect(files, optionStr);\r\n            },\r\n            enabledTest: function() {\r\n                return KL.dialogCounter.get() === 0;\r\n            }\r\n        });\r\n\r\n        BB.addEventListener(window, 'paste', onPaste, false);\r\n    }\r\n\r\n    const brushUiObj: any = {};\r\n\r\n    // create brush UIs\r\n    for (let b in KL.brushesUI) {\r\n        if (KL.brushesUI.hasOwnProperty(b)) {\r\n            let ui = new KL.brushesUI[b].Ui({\r\n                onSizeChange: sizeWatcher,\r\n                onOpacityChange: function(opacity) {\r\n                    brushSettingService.emitOpacity(opacity);\r\n                },\r\n                onConfigChange: () => {\r\n                    brushSettingService.emitSliderConfig({\r\n                        sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                        opacitySlider: KL.brushesUI[currentBrushId].opacitySlider\r\n                    });\r\n                }\r\n            });\r\n            brushUiObj[b] = ui;\r\n            ui.getElement().style.padding = 10 + 'px';\r\n        }\r\n    }\r\n\r\n\r\n    BB.css(klRootEl, {\r\n        position: 'absolute',\r\n        left: '0',\r\n        top: '0',\r\n        right: '0',\r\n        bottom: '0'\r\n    });\r\n\r\n    let statusOverlay = new KL.StatusOverlay();\r\n\r\n    const toolspace = BB.el({});\r\n    const toolspaceInner = BB.el({\r\n        parent: toolspace,\r\n    });\r\n    toolspace.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n    toolspace.onclick = BB.handleClick;\r\n\r\n\r\n    let toolspaceCollapser = new KL.ToolspaceCollapser({\r\n        onChange: function() {\r\n            updateCollapse();\r\n        }\r\n    });\r\n    function updateCollapse() {\r\n\r\n        //collapser\r\n        if (uiWidth < collapseThreshold) {\r\n            toolspaceCollapser.getElement().style.display = 'block';\r\n\r\n            toolspaceCollapser.setDirection(uiState);\r\n            if (toolspaceCollapser.isOpen()) {\r\n                if (uiState === 'left') {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '271px',\r\n                        right: '',\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '271px'\r\n                    });\r\n                } else {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '271px'\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                }\r\n                toolspace.style.display = 'block';\r\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\r\n                statusOverlay.setWide(false);\r\n\r\n            } else {\r\n                if (uiState === 'left') {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '0',\r\n                        right: '',\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                } else {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '0'\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                }\r\n                toolspace.style.display = 'none';\r\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth), uiHeight);\r\n                statusOverlay.setWide(true);\r\n\r\n            }\r\n\r\n        } else {\r\n            toolspaceCollapser.getElement().style.display = 'none';\r\n            if (uiState === 'left') {\r\n                BB.css(klCanvasWorkspace.getElement(), {\r\n                    left: '271px'\r\n                });\r\n            } else {\r\n                BB.css(klCanvasWorkspace.getElement(), {\r\n                    left: '0'\r\n                });\r\n            }\r\n            toolspace.style.display = 'block';\r\n            klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\r\n            statusOverlay.setWide(false);\r\n\r\n        }\r\n    }\r\n    updateCollapse();\r\n\r\n    function updateUi() {\r\n        if (uiState === 'left') {\r\n            BB.css(toolspace, {\r\n                left: '0',\r\n                right: '',\r\n                borderLeft: 'none',\r\n                borderRight: '1px solid rgb(135, 135, 135)'\r\n            });\r\n            BB.css(klCanvasWorkspace.getElement(), {\r\n                left: '271px'\r\n            });\r\n        } else {\r\n            BB.css(toolspace, {\r\n                left: '',\r\n                right: '0',\r\n                borderLeft: '1px solid rgb(135, 135, 135)',\r\n                borderRight: 'none'\r\n            });\r\n            BB.css(klCanvasWorkspace.getElement(), {\r\n                left: '0'\r\n            });\r\n        }\r\n        statusOverlay.setUiState(uiState);\r\n        layerPreview.setUiState('' + uiState);\r\n        layerManager.setUiState('' + uiState);\r\n        updateCollapse();\r\n        toolspaceScroller.updateUiState(uiState);\r\n    }\r\n\r\n\r\n\r\n    let overlayToolspace;\r\n    setTimeout(function() {\r\n        overlayToolspace = new KL.OverlayToolspace({\r\n            enabledTest: function() {\r\n                return KL.dialogCounter.get() === 0 && !lineSanitizer.getIsDrawing();\r\n            },\r\n            brushSettingService,\r\n        });\r\n        klRootEl.appendChild(overlayToolspace.getElement());\r\n    }, 0);\r\n\r\n    BB.append(klRootEl, [klCanvasWorkspace.getElement(), toolspace, toolspaceCollapser.getElement()]);\r\n\r\n    BB.css(toolspace, {\r\n        position: \"absolute\",\r\n        right: '0',\r\n        top: '0',\r\n        bottom: '0',\r\n        width: (toolWidth - 1) + \"px\",\r\n\r\n        overflow: \"hidden\",\r\n        backgroundColor: \"#ddd\",\r\n        borderLeft: \"1px solid rgb(135, 135, 135)\",\r\n        userSelect: 'none',\r\n        touchAction: 'none'\r\n    });\r\n\r\n    let toolspaceTopRow;\r\n    if (pOptions.embed) {\r\n        toolspaceTopRow = new ToolspaceTopRow({\r\n            onHelp: () => {\r\n                showIframePopup(pOptions.embed.url + '/help.html', !!pOptions.embed);\r\n            },\r\n            onSubmit: () => {\r\n                KL.popup({\r\n                    target: klRootEl,\r\n                    message: LANG('submit-prompt'),\r\n                    buttons: [LANG('submit'), 'Cancel'],\r\n                    callback: async (result) => {\r\n                        if (result !== LANG('submit')) {\r\n                            return;\r\n                        }\r\n\r\n                        let overlay = BB.el({\r\n                            parent: klRootEl,\r\n                            className: 'upload-overlay',\r\n                            content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\r\n                        });\r\n\r\n                        pOptions.embed.onSubmit(\r\n                            () => {\r\n                                pOptions.saveReminder.reset();\r\n                                klRootEl.removeChild(overlay);\r\n                            },\r\n                            () => {\r\n                                klRootEl.removeChild(overlay);\r\n                            });\r\n                    }\r\n                });\r\n            },\r\n            onLeftRight: () => {\r\n                uiState = uiState === 'left' ? 'right' : 'left';\r\n                updateUi();\r\n            },\r\n        });\r\n    } else {\r\n        toolspaceTopRow = new KL.ToolspaceTopRow({\r\n            logoImg: pOptions.logoImg,\r\n            onLogo: function() {\r\n                showIframePopup('./home/', !!pOptions.embed);\r\n            },\r\n            onNew: function() {\r\n                showNewImageDialog();\r\n            },\r\n            onImport: function() {\r\n                fileTab.triggerImport();\r\n            },\r\n            onSave: function() {\r\n                saveToComputer.save();\r\n            },\r\n            onShare: function() {\r\n                shareImage();\r\n            },\r\n            onHelp: function() {\r\n                showIframePopup('./help/', !!pOptions.embed);\r\n            },\r\n        });\r\n    }\r\n    toolspaceTopRow.getElement().classList.add('toolspace-row-shadow');\r\n    toolspaceTopRow.getElement().style.marginBottom = '10px';\r\n    toolspaceInner.appendChild(toolspaceTopRow.getElement());\r\n\r\n    let toolspaceToolRow = new KL.ToolspaceToolRow({\r\n        onActivate: function(activeStr) {\r\n            if (activeStr === 'draw') {\r\n                klCanvasWorkspace.setMode('draw');\r\n            } else if (activeStr === 'hand') {\r\n                klCanvasWorkspace.setMode('hand');\r\n            } else if (activeStr === 'fill') {\r\n                klCanvasWorkspace.setMode('fill');\r\n            } else if (activeStr === 'gradient') {\r\n                klCanvasWorkspace.setMode('gradient');\r\n            } else if (activeStr === 'text') {\r\n                klCanvasWorkspace.setMode('text');\r\n            } else if (activeStr === 'shape') {\r\n                klCanvasWorkspace.setMode('shape');\r\n            } else {\r\n                throw new Error('unknown activeStr');\r\n            }\r\n            mainTabRow.open(activeStr);\r\n            updateMainTabVisibility();\r\n            klColorSlider.pickingDone();\r\n        },\r\n        onZoomIn: function() {\r\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n        },\r\n        onZoomOut: function() {\r\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n        },\r\n        onUndo: function() {\r\n            undoRedoCatchup.undo();\r\n        },\r\n        onRedo: function() {\r\n            undoRedoCatchup.redo();\r\n        }\r\n    });\r\n    toolspaceToolRow.setIsSmall(uiHeight < 540);\r\n    klHistory.addListener(function() {\r\n        toolspaceToolRow.setEnableUndo(klHistory.canUndo());\r\n        toolspaceToolRow.setEnableRedo(klHistory.canRedo());\r\n    });\r\n    toolspaceToolRow.getElement().classList.add('toolspace-row-shadow');\r\n    toolspaceInner.appendChild(toolspaceToolRow.getElement());\r\n\r\n    let klColorSlider;\r\n\r\n    function setCurrentBrush(brushId) {\r\n        if (brushId !== 'eraserBrush') {\r\n            lastNonEraserBrushId = brushId;\r\n        }\r\n\r\n        if (klColorSlider) {\r\n            if (brushId === 'eraserBrush') {\r\n                klColorSlider.enable(false);\r\n            } else {\r\n                klColorSlider.enable(true);\r\n            }\r\n        }\r\n\r\n        currentBrushId = brushId;\r\n        currentBrush = brushUiObj[brushId];\r\n        currentBrush.setColor(currentColor);\r\n        currentBrush.setContext(currentLayerCtx);\r\n        klCanvasWorkspace.setMode('draw');\r\n        toolspaceToolRow.setActive('draw');\r\n        updateMainTabVisibility();\r\n    }\r\n\r\n    function setCurrentLayer(layer) { //BrushContext(p_context) {\r\n        currentLayerCtx = layer.context;\r\n        currentBrush.setContext(layer.context);\r\n        layerPreview.setLayer(layer);\r\n    }\r\n\r\n    function setBrushColor(p_color) {\r\n        currentColor = p_color;\r\n        currentBrush.setColor(p_color);\r\n        brushSettingService.emitColor(p_color);\r\n        klColorSlider.pickingDone();\r\n    }\r\n\r\n    klColorSlider = new KL.KlColorSlider({\r\n        width: 250,\r\n        height: 30,\r\n        svHeight: 100,\r\n        startValue: new BB.RGB(0, 0, 0),\r\n        onPick: setBrushColor\r\n    });\r\n    klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\r\n    klColorSlider.setPickCallback(function (doPick) {\r\n\r\n        if (doPick) {\r\n            klCanvasWorkspace.setMode('pick');\r\n        } else {\r\n            klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\r\n            updateMainTabVisibility();\r\n        }\r\n\r\n    });\r\n    let brushDiv = document.createElement(\"div\");\r\n    let colorDiv = document.createElement(\"div\");\r\n    BB.css(colorDiv, {\r\n        margin: '10px',\r\n        display: 'flex',\r\n        flexWrap: 'wrap',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'flex-end'\r\n    });\r\n    let toolspaceStabilizerRow = new KL.ToolspaceStabilizerRow({\r\n        smoothing: 1,\r\n        onSelect: function(v) {\r\n            lineSmoothing.setSmoothing(translateSmoothing(v));\r\n        }\r\n    });\r\n\r\n\r\n    brushDiv.appendChild(colorDiv);\r\n    BB.append(\r\n        colorDiv,\r\n        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n    );\r\n\r\n    let brushTabRow = new KL.TabRow({\r\n        initialId: 'penBrush',\r\n        useAccent: true,\r\n        tabArr: (function () {\r\n            let result = [];\r\n\r\n            function createTab(keyStr) {\r\n                return {\r\n                    id: keyStr,\r\n                    image: KL.brushesUI[keyStr].image,\r\n                    title: KL.brushesUI[keyStr].tooltip,\r\n                    onOpen: function() {\r\n                        brushUiObj[keyStr].getElement().style.display = 'block';\r\n                        setCurrentBrush(keyStr);\r\n                        klColorSlider.pickingDone();\r\n                        brushSettingService.emitSliderConfig({\r\n                            sizeSlider: KL.brushesUI[keyStr].sizeSlider,\r\n                            opacitySlider: KL.brushesUI[keyStr].opacitySlider\r\n                        });\r\n                        sizeWatcher(brushUiObj[keyStr].getSize());\r\n                        brushSettingService.emitOpacity(brushUiObj[keyStr].getOpacity());\r\n                    },\r\n                    onClose: function() {\r\n                        brushUiObj[keyStr].getElement().style.display = 'none';\r\n                    }\r\n                };\r\n            }\r\n\r\n            let keyArr = Object.keys(brushUiObj);\r\n            for (let i = 0; i < keyArr.length; i++) {\r\n                result.push(createTab(keyArr[i]));\r\n            }\r\n            return result;\r\n        })()\r\n    });\r\n    brushDiv.appendChild(brushTabRow.getElement());\r\n    for (let b in KL.brushesUI) {\r\n        if (KL.brushesUI.hasOwnProperty(b)) {\r\n            brushDiv.appendChild(brushUiObj[b].getElement());\r\n        }\r\n    }\r\n\r\n    const handUi = new KL.HandUi({\r\n        scale: 1,\r\n        angleDeg: 0,\r\n        onReset: function() {\r\n            klCanvasWorkspace.resetView(true);\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n        onFit: function() {\r\n            klCanvasWorkspace.fitView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n        onAngleChange: function(angleDeg, isRelative) {\r\n            klCanvasWorkspace.setAngle(angleDeg, isRelative);\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n    });\r\n\r\n    let fillUi = new KL.FillUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let gradientUi = new KL.GradientUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let textUi = new KL.TextUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let shapeUi = new KL.ShapeUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    const gradientTool = new KL.GradientTool({\r\n        onGradient: (isDone, x1, y1, x2, y2, angleRad) => {\r\n            const layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n            const settings = gradientUi.getSettings();\r\n            const gradientObj: IGradient = {\r\n                type: settings.type,\r\n                color1: klColorSlider.getColor(),\r\n                isReversed: settings.isReversed,\r\n                opacity: settings.opacity,\r\n                doLockAlpha: settings.doLockAlpha,\r\n                isEraser: settings.isEraser,\r\n                doSnap: keyListener.isPressed('shift') || settings.doSnap,\r\n                x1,\r\n                y1,\r\n                x2,\r\n                y2,\r\n                angleRad,\r\n            };\r\n\r\n            if (isDone) {\r\n                klCanvas.setComposite(layerIndex, null);\r\n                klCanvas.drawGradient(layerIndex, gradientObj);\r\n            } else {\r\n                klCanvas.setComposite(layerIndex, {\r\n                    draw: function(ctx) {\r\n                        KL.drawGradient(ctx, gradientObj);\r\n                    }\r\n                });\r\n            }\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n    });\r\n\r\n    let shapeTool = new KL.ShapeTool({\r\n        onShape: function(isDone, x1, y1, x2, y2, angleRad) {\r\n\r\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n\r\n            let shapeObj: any = {\r\n                type: shapeUi.getShape(),\r\n                x1: x1,\r\n                y1: y1,\r\n                x2: x2,\r\n                y2: y2,\r\n                angleRad: angleRad,\r\n                isOutwards: shapeUi.getIsOutwards(),\r\n                opacity: shapeUi.getOpacity(),\r\n                isEraser: shapeUi.getIsEraser(),\r\n                doLockAlpha: shapeUi.getDoLockAlpha(),\r\n            };\r\n            if (shapeUi.getShape() === 'line') {\r\n                shapeObj.strokeRgb = klColorSlider.getColor();\r\n                shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed('shift');\r\n            } else {\r\n                shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed('shift');\r\n                if (shapeUi.getMode() === 'stroke') {\r\n                    shapeObj.strokeRgb = klColorSlider.getColor();\r\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                } else {\r\n                    shapeObj.fillRgb = klColorSlider.getColor();\r\n                }\r\n            }\r\n\r\n            if (isDone) {\r\n                klCanvas.setComposite(layerIndex, null);\r\n                klCanvas.drawShape(layerIndex, shapeObj);\r\n            } else {\r\n                klCanvas.setComposite(layerIndex, {\r\n                    draw: function(ctx) {\r\n                        KL.drawShape(ctx, shapeObj);\r\n                    }\r\n                });\r\n            }\r\n            klCanvasWorkspace.requestFrame();\r\n\r\n        }\r\n    });\r\n\r\n    const layerManager = KL.klLayerManager(klCanvas, function (val) {\r\n        setCurrentLayer(klCanvas.getLayer(val));\r\n        klHistory.push({\r\n            tool: [\"misc\"],\r\n            action: \"focusLayer\",\r\n            params: [val]\r\n        });\r\n    }, klRootEl) as any;\r\n    const layerPreview = new KL.LayerPreview({\r\n        klRootEl: klRootEl,\r\n        onClick: function () {\r\n            mainTabRow.open('layers');\r\n        }\r\n    });\r\n    layerPreview.setIsVisible(uiHeight >= 579);\r\n    layerPreview.setLayer(klCanvas.getLayer(klCanvas.getLayerIndex(currentLayerCtx.canvas)));\r\n\r\n    const filterTab = new KL.FilterTab(\r\n        klRootEl,\r\n        klColorSlider,\r\n        layerManager,\r\n        // setCurrentLayer,\r\n        klCanvasWorkspace,\r\n        handUi,\r\n        () => { //get current color\r\n            return currentColor;\r\n        },\r\n        () => { // get max canvas size\r\n            return klMaxCanvasSize;\r\n        },\r\n        () => { // get kl canvas\r\n            return klCanvas;\r\n        },\r\n        () => { // get current layer ctx\r\n            return currentLayerCtx;\r\n        },\r\n        !!pOptions.embed,\r\n        statusOverlay,\r\n    );\r\n\r\n    const undoRedoCatchup = new KL.UndoRedoCatchup(\r\n        brushUiObj,\r\n        layerPreview,\r\n        layerManager,\r\n        handUi,\r\n        klCanvasWorkspace,\r\n        () => {\r\n            if (!initState) {\r\n                throw new Error('initState not initialized');\r\n            }\r\n            return initState;\r\n        },\r\n        () => klCanvas,\r\n        () => currentLayerCtx,\r\n        (clctx) => {\r\n            currentLayerCtx = clctx;\r\n        },\r\n        () => currentBrush,\r\n    );\r\n    klHistory.addListener((p) => {\r\n        undoRedoCatchup.catchup(p);\r\n    });\r\n\r\n    function showNewImageDialog() {\r\n        KL.newImageDialog({\r\n            currentColor: currentColor,\r\n            secondaryColor: klColorSlider.getSecondaryRGB(),\r\n            maxCanvasSize: klMaxCanvasSize,\r\n            canvasWidth: klCanvas.getWidth(),\r\n            canvasHeight: klCanvas.getHeight(),\r\n            workspaceWidth: window.innerWidth < collapseThreshold ? uiWidth : uiWidth - toolWidth,\r\n            workspaceHeight: uiHeight,\r\n            onConfirm: function(width, height, color) {\r\n                klCanvas.reset({\r\n                    width: width,\r\n                    height: height,\r\n                    color: color.a === 1 ? color : null\r\n                });\r\n\r\n                layerManager.update(0);\r\n                setCurrentLayer(klCanvas.getLayer(0));\r\n                klCanvasWorkspace.resetView();\r\n                handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n                isFirstImage = false;\r\n            },\r\n            onCancel: function() {}\r\n        });\r\n    }\r\n\r\n    function shareImage(callback?) {\r\n        BB.shareCanvas({\r\n            canvas: klCanvas.getCompleteCanvas(1),\r\n            fileName: BB.getDate() + filenameBase + '.png',\r\n            title: BB.getDate() + filenameBase + '.png',\r\n            callback: callback ? callback : function() {}\r\n        });\r\n    }\r\n\r\n    const saveToComputer = new KL.SaveToComputer(\r\n        pOptions.saveReminder,\r\n        klRootEl,\r\n        () => exportType,\r\n        () => klCanvas,\r\n        filenameBase,\r\n    );\r\n\r\n    const fileTab = pOptions.embed ? null : new KL.FileTab(\r\n        klRootEl,\r\n        projectStore,\r\n        () => klCanvas.getProject(),\r\n        exportType,\r\n        (type) => {\r\n            exportType = type;\r\n        },\r\n        handleFileSelect,\r\n        () => {\r\n            saveToComputer.save();\r\n        },\r\n        showNewImageDialog,\r\n        shareImage,\r\n        () => { // on upload\r\n            KL.imgurUpload(klCanvas, klRootEl, pOptions.saveReminder, pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : null, );\r\n        },\r\n        copyToClipboard,\r\n        pOptions.saveReminder,\r\n    );\r\n\r\n    const settingsTab = new KL.SettingsTab(\r\n        () => {\r\n            uiState = uiState === 'left' ? 'right' : 'left';\r\n            updateUi();\r\n            if (!pOptions.embed) {\r\n                LocalStorage.setItem('uiState', uiState);\r\n            }\r\n        },\r\n        pOptions.aboutEl\r\n    );\r\n\r\n    mainTabRow = new KL.TabRow({\r\n        initialId: 'draw',\r\n        tabArr: [\r\n            {\r\n                id: 'draw',\r\n                title: LANG('tool-brush'),\r\n                image: toolPaintImg,\r\n                onOpen: function() {\r\n                    if (currentBrushId === 'eraserBrush') {\r\n                        klColorSlider.enable(false);\r\n                    }\r\n                    BB.append(\r\n                        colorDiv,\r\n                        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n                    );\r\n                    brushDiv.style.display = 'block';\r\n                },\r\n                onClose: function() {\r\n                    brushDiv.style.display = 'none';\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'hand',\r\n                title: LANG('tool-hand'),\r\n                image: toolHandImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    handUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    handUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'fill',\r\n                title: LANG('tool-paint-bucket'),\r\n                image: toolFillImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    fillUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    fillUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'gradient',\r\n                title: LANG('tool-gradient'),\r\n                image: toolGradientImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    gradientUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    gradientUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'text',\r\n                title: LANG('tool-text'),\r\n                image: toolTextImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    textUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    textUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'shape',\r\n                title: LANG('tool-shape'),\r\n                image: toolShapeImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    shapeUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    shapeUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'layers',\r\n                title: LANG('tab-layers'),\r\n                image: tabLayersImg,\r\n                onOpen: function() {\r\n                    layerManager.update();\r\n                    layerManager.style.display = 'block';\r\n                },\r\n                onClose: function() {\r\n                    layerManager.style.display = 'none';\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'edit',\r\n                label: LANG('tab-edit'),\r\n                onOpen: function() {\r\n                    filterTab.show();\r\n                },\r\n                onClose: function() {\r\n                    filterTab.hide();\r\n                },\r\n                css: {\r\n                    padding: '0 7px',\r\n                },\r\n            },\r\n            {\r\n                id: 'file',\r\n                label: LANG('tab-file'),\r\n                isVisible: !!fileTab,\r\n                onOpen: function() {\r\n                    if (!fileTab) {\r\n                        return;\r\n                    }\r\n                    fileTab.getElement().style.display = 'block';\r\n                    fileTab.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    if (!fileTab) {\r\n                        return;\r\n                    }\r\n                    fileTab.getElement().style.display = 'none';\r\n                    fileTab.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    padding: '0 7px',\r\n                },\r\n            },\r\n            {\r\n                id: 'settings',\r\n                title: LANG('tab-settings'),\r\n                image: tabSettingsImg,\r\n                onOpen: function() {\r\n                    settingsTab.getElement().style.display = 'block';\r\n                    // settingsTab.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    settingsTab.getElement().style.display = 'none';\r\n                    // settingsTab.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            }\r\n        ]\r\n    });\r\n    function updateMainTabVisibility() {\r\n        if (!mainTabRow) {\r\n            return;\r\n        }\r\n\r\n        let toolObj = {\r\n            'draw': {},\r\n            'hand': {},\r\n            'fill': {},\r\n            'gradient': {},\r\n            'text': {},\r\n            'shape': {}\r\n        };\r\n\r\n        let activeStr = toolspaceToolRow.getActive();\r\n        let oldTabId = mainTabRow.getOpenedTabId();\r\n\r\n        let keysArr = Object.keys(toolObj);\r\n        for (let i = 0; i < keysArr.length; i++) {\r\n            if (activeStr === keysArr[i]) {\r\n                mainTabRow.setIsVisible(keysArr[i], true);\r\n            } else {\r\n                mainTabRow.setIsVisible(keysArr[i], false);\r\n                if (oldTabId === keysArr[i]) {\r\n                    mainTabRow.open(activeStr);\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    function copyToClipboard(showCrop?) {\r\n        KL.clipboardDialog(klRootEl, klCanvas.getCompleteCanvas(1), function (inputObj) {\r\n            if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) {\r\n                return;\r\n            }\r\n            //do a crop\r\n            KL.filterLib.cropExtend.apply({\r\n                context: currentLayerCtx,\r\n                klCanvas: klCanvas,\r\n                input: inputObj, //{left,right,top,bottom}\r\n                history: klHistory\r\n            });\r\n            layerManager.update();\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        }, statusOverlay, showCrop);\r\n    }\r\n\r\n    const bottomBarWrapper = BB.el({\r\n        css: {\r\n            width: \"270px\",\r\n            position: \"absolute\",\r\n            bottom: '0',\r\n            left: '0'\r\n        },\r\n    });\r\n    if (pOptions.bottomBar) {\r\n        bottomBarWrapper.append(pOptions.bottomBar);\r\n        const observer = new MutationObserver(() => updateBottomBar());\r\n        observer.observe(\r\n            toolspaceInner,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n    }\r\n    function updateBottomBar() {\r\n        if (!pOptions.bottomBar) {\r\n            return;\r\n        }\r\n        const threshold = 617; //590\r\n        const isVisible = (\r\n            threshold < window.innerHeight &&\r\n            toolspaceInner.scrollHeight + 50 < window.innerHeight\r\n        );\r\n        bottomBarWrapper.style.display = isVisible ? '' : 'none';\r\n    }\r\n\r\n\r\n\r\n    BB.append(toolspaceInner, [\r\n        layerPreview.getElement(),\r\n        mainTabRow.getElement(),\r\n        brushDiv,\r\n        handUi.getElement(),\r\n        fillUi.getElement(),\r\n        gradientUi.getElement(),\r\n        textUi.getElement(),\r\n        shapeUi.getElement(),\r\n        layerManager,\r\n        filterTab.getElement(),\r\n        fileTab ? fileTab.getElement() : null,\r\n        settingsTab.getElement(),\r\n        BB.el({\r\n            css: {\r\n                height: '10px', // a bit of spacing at the bottom\r\n            }\r\n        }),\r\n        bottomBarWrapper ? bottomBarWrapper : null\r\n    ]);\r\n\r\n    const toolspaceScroller = new KL.ToolspaceScroller({\r\n        toolspace,\r\n        uiState,\r\n    });\r\n\r\n    // --- interface ---\r\n\r\n    this.getEl = () => {\r\n        return klRootEl;\r\n    };\r\n\r\n    this.resize = (w, h) => {\r\n\r\n        // iPad scrolls down when increasing text zoom\r\n        if (window.scrollY > 0) {\r\n            window.scrollTo(0, 0);\r\n        }\r\n\r\n        if (uiWidth === Math.max(0, w) && uiHeight === Math.max(0, h)) {\r\n            return;\r\n        }\r\n\r\n        uiWidth = Math.max(0, w);\r\n        uiHeight = Math.max(0, h);\r\n\r\n        updateCollapse();\r\n        updateBottomBar();\r\n\r\n        layerPreview.setIsVisible(uiHeight >= 579);\r\n        klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\r\n        toolspaceToolRow.setIsSmall(uiHeight < 540);\r\n    };\r\n\r\n    this.out = (msg) => {\r\n        statusOverlay.out(msg);\r\n    };\r\n\r\n    this.getPNG = function(): Blob {\r\n        return base64ToBlob(klCanvas.getCompleteCanvas(1).toDataURL('image/png'));\r\n    };\r\n\r\n    this.getPSD = async function() {\r\n        return await klCanvasToPsdBlob(klCanvas);\r\n    };\r\n\r\n    this.getProject = () => klCanvas.getProject();\r\n\r\n    this.swapUiLeftRight = () => {\r\n        uiState = uiState === 'left' ? 'right' : 'left';\r\n        if (!pOptions.embed) {\r\n            LocalStorage.setItem('uiState', uiState);\r\n        }\r\n        updateUi();\r\n    };\r\n\r\n    this.saveAsPsd = () => {\r\n        saveToComputer.save('psd');\r\n    };\r\n\r\n    this.isDrawing = () => {\r\n        return lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\r\n    };\r\n\r\n    // --- end interface ---\r\n\r\n    this.resize(uiWidth, uiHeight);\r\n    updateUi();\r\n\r\n    {\r\n        BB.addEventListener(window, 'resize', () => {\r\n            this.resize(window.innerWidth, window.innerHeight);\r\n        });\r\n        BB.addEventListener(window, 'orientationchange', () => {\r\n            this.resize(window.innerWidth, window.innerHeight);\r\n        });\r\n\r\n        // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\r\n        // Workaround: place a div in the body that fills the window, and use a ResizeObserver\r\n        const windowResizeWatcher = BB.el({\r\n            parent: document.body,\r\n            css: {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n                pointerEvents: 'none',\r\n                zIndex: '-1',\r\n                userSelect: 'none',\r\n            }\r\n        });\r\n        try {\r\n            // Not all browsers support ResizeObserver. Not critical though.\r\n            const observer = new ResizeObserver(() => this.resize(window.innerWidth, window.innerHeight));\r\n            observer.observe(windowResizeWatcher);\r\n        } catch (e) {\r\n            windowResizeWatcher.parentNode.removeChild(windowResizeWatcher);\r\n        }\r\n\r\n        // prevent ctrl scroll -> zooming page\r\n        BB.addEventListener(klRootEl, 'wheel', (event) => {\r\n            if (keyListener.isPressed('ctrl')) {\r\n                event.preventDefault();\r\n            }\r\n        });\r\n        //maybe prevent zooming on safari mac os - todo still needed?\r\n        const prevent = (e) => {\r\n            e.preventDefault();\r\n        }\r\n        window.addEventListener('gesturestart', prevent);\r\n        window.addEventListener('gesturechange', prevent);\r\n        window.addEventListener('gestureend', prevent);\r\n    }\r\n}","import {DecoyKlHistory, klHistory} from './history/kl-history';\r\nimport {Popup, popup} from './ui/modals/popup';\r\nimport {dialogCounter} from './ui/modals/modal-count';\r\nimport {Checkbox} from './ui/base-components/checkbox';\r\nimport {input} from './ui/base-components/input';\r\nimport {Select} from './ui/base-components/select';\r\nimport {ImageToggle} from './ui/base-components/image-toggle';\r\nimport {ImageRadioList} from './ui/base-components/image-radio-list';\r\nimport {penPressureToggle} from './ui/base-components/pen-pressure-toggle';\r\nimport {KlSlider} from './ui/base-components/kl-slider';\r\nimport {calcSliderFalloffFactor} from './ui/base-components/slider-falloff';\r\nimport {HexColorDialog} from './ui/modals/color-slider-hex-dialog';\r\nimport {KlColorSlider} from './ui/base-components/kl-color-slider';\r\nimport {KlSmallColorSlider} from './ui/base-components/kl-color-slider-small';\r\nimport {PointSlider} from './ui/base-components/point-slider';\r\nimport {ColorOptions} from './ui/base-components/color-options';\r\nimport {Options} from './ui/base-components/options';\r\nimport {StatusOverlay} from './ui/components/status-overlay';\r\nimport {exportDialog} from './ui/modals/export-dialog-deprecated';\r\nimport {CropCopy} from './ui/components/crop-copy';\r\nimport {clipboardDialog} from './ui/modals/clipboard-dialog';\r\nimport {klLayerManager} from './ui/tool-tabs/kl-layer-manager';\r\nimport {WorkspaceSvgOverlay} from './canvas-ui/workspace-svg-overlay';\r\nimport {KlCanvasWorkspace} from './canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvasPreview} from './canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './ui/components/free-transform';\r\nimport {FreeTransformCanvas} from './ui/components/free-transform-canvas';\r\nimport {Cropper} from './ui/components/cropper';\r\nimport {LayerPreview} from './ui/components/layer-preview';\r\nimport {FittedImage} from './ui/components/fitted-image';\r\nimport {showImportAsLayerDialog} from './ui/modals/show-import-as-layer-dialog';\r\nimport {KlImageDropper} from './ui/components/kl-image-dropper';\r\nimport {OverlayToolspace} from './ui/components/overlay-toolspace';\r\nimport {ToolspaceTopRow} from './ui/components/toolspace-top-row';\r\nimport {ToolDropdown} from './ui/components/tool-dropdown';\r\nimport {ToolspaceToolRow} from './ui/components/toolspace-tool-row';\r\nimport {ToolspaceStabilizerRow} from './ui/components/toolspace-stabilizer-row';\r\nimport {TabRow} from './ui/components/tab-row';\r\nimport {HandUi} from './ui/tool-tabs/hand-ui';\r\nimport {FillUi} from './ui/tool-tabs/fill-ui';\r\nimport {TextUi} from './ui/tool-tabs/text-ui';\r\nimport {ShapeUi} from './ui/tool-tabs/shape-ui';\r\nimport {newImageDialog} from './ui/modals/new-image-dialog';\r\nimport {ToolspaceCollapser} from './ui/components/toolspace-collapser';\r\nimport {renderText} from './image-operations/render-text';\r\nimport {textToolDialog} from './ui/modals/text-tool-dialog';\r\nimport {showImportImageDialog} from './ui/modals/show-import-image-dialog';\r\nimport {floodFillBits} from './image-operations/flood-fill';\r\nimport * as PSD from './storage/psd';\r\nimport {drawShape, ShapeTool} from './image-operations/shape-tool';\r\nimport {KlCanvas} from './canvas/kl-canvas';\r\nimport * as indexedDb from './storage/indexed-db';\r\nimport {filterLib, filterLibStatus} from './filters/filters';\r\nimport {brushes} from './brushes/brushes';\r\nimport {brushesUI} from './brushes-ui/brushes-ui';\r\nimport {showIframePopup} from './ui/modals/show-iframe-popup';\r\nimport {RadioList} from './ui/base-components/radio-list';\r\nimport {BrowserStorageUi} from './ui/components/browser-storage-ui';\r\nimport {drawProject} from './canvas/draw-project';\r\nimport {ProjectStore} from './storage/project-store';\r\nimport {FileTab} from \"./ui/tool-tabs/file-tab\";\r\nimport {FilterTab} from \"./ui/tool-tabs/filter-tab\";\r\nimport {imgurUpload} from \"./ui/modals/imgur-upload\";\r\nimport {loadAgPsd} from \"./storage/ag-psd-wrapper\";\r\nimport {SaveReminder} from \"./ui/components/save-reminder\";\r\nimport {SaveToComputer} from \"./storage/save-to-computer\";\r\nimport {UndoRedoCatchup} from \"./history/undo-redo-catchup\";\r\nimport {setDbName} from './storage/indexed-db';\r\nimport {BrushSettingService} from './brushes-ui/brush-setting-service';\r\nimport {BoxToggle} from './ui/base-components/box-toggle';\r\nimport {SettingsTab} from './ui/tool-tabs/settings-tab';\r\nimport {ToolspaceScroller} from './ui/components/toolspace-scroller';\r\nimport {GradientUi} from './ui/tool-tabs/gradient-ui';\r\nimport {drawGradient, GradientTool} from './image-operations/gradient-tool';\r\n\r\n/**\r\n * paint tool functionality\r\n */\r\nexport const KL = {\r\n\r\n    // --- brushes ---\r\n    brushes,\r\n    brushesUI,\r\n    BrushSettingService,\r\n\r\n    // --- canvas ---\r\n    KlCanvas,\r\n    drawProject,\r\n\r\n    // --- canvas ui ---\r\n    WorkspaceSvgOverlay,\r\n    KlCanvasWorkspace,\r\n    KlCanvasPreview,\r\n\r\n    // --- filters ---\r\n    filterLibStatus,\r\n    filterLib,\r\n\r\n    // --- history ---\r\n    UndoRedoCatchup,\r\n\r\n    // --- image operations ---\r\n    renderText,\r\n    floodFillBits,\r\n    ShapeTool,\r\n    drawShape,\r\n    GradientTool,\r\n    drawGradient,\r\n\r\n    // --- storage ---\r\n    PSD,\r\n    setDbName,\r\n    indexedDb,\r\n    ProjectStore,\r\n    loadAgPsd,\r\n    SaveToComputer,\r\n\r\n    // --- ui - base components ---\r\n    calcSliderFalloffFactor,\r\n    Checkbox,\r\n    input,\r\n    Select,\r\n    ImageToggle,\r\n    ImageRadioList,\r\n    RadioList,\r\n    penPressureToggle,\r\n    KlSlider,\r\n    HexColorDialog,\r\n    KlColorSlider,\r\n    KlSmallColorSlider,\r\n    PointSlider,\r\n    ColorOptions,\r\n    Options,\r\n    BoxToggle,\r\n\r\n    // --- ui - components ---\r\n    StatusOverlay,\r\n    CropCopy,\r\n    FreeTransform,\r\n    FreeTransformCanvas,\r\n    Cropper,\r\n    LayerPreview,\r\n    FittedImage,\r\n    KlImageDropper,\r\n    OverlayToolspace,\r\n    ToolspaceTopRow,\r\n    ToolDropdown,\r\n    ToolspaceToolRow,\r\n    ToolspaceStabilizerRow,\r\n    TabRow,\r\n    ToolspaceCollapser,\r\n    BrowserStorageUi,\r\n    SaveReminder,\r\n    ToolspaceScroller,\r\n\r\n    // --- ui - modals ---\r\n    dialogCounter,\r\n    popup,\r\n    Popup,\r\n    exportDialog,\r\n    clipboardDialog,\r\n    showImportAsLayerDialog,\r\n    newImageDialog,\r\n    textToolDialog,\r\n    showImportImageDialog,\r\n    showIframePopup,\r\n    imgurUpload,\r\n\r\n    // --- ui - tool tabs ---\r\n    HandUi,\r\n    FillUi,\r\n    GradientUi,\r\n    TextUi,\r\n    ShapeUi,\r\n    FileTab,\r\n    FilterTab,\r\n    SettingsTab,\r\n    klLayerManager,\r\n\r\n\r\n    klHistory,\r\n    DecoyKlHistory,\r\n};","\r\nexport interface IHistoryEntry {\r\n    tool: string[];\r\n    action?: string;\r\n    params?: any[];\r\n\r\n    actions?: {\r\n        action: string;\r\n        params: any[];\r\n    }[]\r\n}\r\n\r\nexport interface IHistoryBroadcast {\r\n    bufferUpdate: IHistoryEntry;\r\n}\r\n\r\nexport type IHistoryListener = (p: IHistoryBroadcast | null) => void;\r\n\r\nlet historyInstance: boolean = false;\r\n\r\nexport interface KlHistoryInterface {\r\n    pause (b: boolean): void;\r\n    addListener (l: IHistoryListener): void;\r\n    push (e: IHistoryEntry): void;\r\n    undo (): (IHistoryEntry | null)[];\r\n    redo (): (IHistoryEntry | null)[];\r\n    getAll (): (IHistoryEntry | null)[];\r\n    canRedo (): boolean;\r\n    canUndo (): boolean;\r\n    getState (): number;\r\n    getActionNumber (): number;\r\n}\r\n\r\nexport class DecoyKlHistory implements KlHistoryInterface {\r\n    pause (b: boolean): void {}\r\n    addListener (l: IHistoryListener): void {}\r\n    push (e: IHistoryEntry): void {}\r\n    undo (): (IHistoryEntry | null)[] { return []; }\r\n    redo (): (IHistoryEntry | null)[] { return []; }\r\n    getAll (): (IHistoryEntry | null)[] { return []; }\r\n    canRedo (): boolean { return false; }\r\n    canUndo (): boolean { return false; }\r\n    getState (): number { return 0; }\r\n    getActionNumber (): number { return 0; }\r\n}\r\n\r\nexport class KlHistory implements KlHistoryInterface {\r\n\r\n    private state: number; // on .push state increments by one\r\n    private dataArr: (IHistoryEntry | null)[]; // null if beyond max undo to trigger garbage collection\r\n    private listeners: IHistoryListener[];\r\n    private pauseStack: number; // how often paused without unpause\r\n    private readonly max: number = 20; // max number undo steps\r\n    private maxState: number; // can't go backwards -> max state is the buffer image(klCanvas)\r\n    private actionNumber: number; // current action the user is on. untouched document = -1 because dataArr.length is 0\r\n    \r\n    private broadcast (p: IHistoryBroadcast | null): void {\r\n        setTimeout(() => {\r\n            for (let i = 0; i < this.listeners.length; i++) {\r\n                this.listeners[i](p);\r\n            }\r\n            this.state++;\r\n        }, 1);\r\n    }\r\n    \r\n    // ---- public ----\r\n    \r\n    constructor () {\r\n        if (historyInstance) {\r\n            throw new Error('klHistory already instantiated');\r\n        }\r\n        historyInstance = true;\r\n        this.state = 0;\r\n        this.dataArr = [];\r\n        this.listeners = [];\r\n        this.pauseStack = 0;\r\n        this.maxState = -1;\r\n        this.actionNumber = -1;\r\n    }\r\n\r\n    /**\r\n     * you need pause because there are sometimes actions that would cause other\r\n     * undo steps\r\n     * for example a filter that does something crazy with two layers and then merges them\r\n     * you want that to be one undo step, and prevent merging from causing its undo step.\r\n     * so while that filter is doing its magic you should pause possible undo steps that\r\n     * are caused by a part of its code(in this example: merging layers)\r\n     *\r\n     * @param b\r\n     */\r\n    pause (b: boolean): void {\r\n        if (b === false) {\r\n            this.pauseStack = Math.max(0, this.pauseStack - 1);\r\n        } else {\r\n            this.pauseStack++;\r\n        }\r\n    }\r\n\r\n    addListener (l: IHistoryListener): void {\r\n        this.listeners.push(l);\r\n    }\r\n\r\n    push (e: IHistoryEntry): void {\r\n        if (this.pauseStack > 0) {\r\n            return;\r\n        }\r\n        while (this.actionNumber < this.dataArr.length - 1) {\r\n            this.dataArr.pop();\r\n        }\r\n\r\n        //taking care of actions that shouldn't cause a new undo step\r\n        const top = this.dataArr[this.dataArr.length - 1];\r\n        if (e.action === 'layerOpacity' && top && top.action === 'layerOpacity' && top.params[0] === e.params[0]) {\r\n            this.dataArr[this.dataArr.length - 1] = e;\r\n            this.state++; //still needs to increment because something changed\r\n            return;\r\n        }\r\n        if (e.action === 'focusLayer' && top && top.action === 'focusLayer') {\r\n            this.dataArr[this.dataArr.length - 1] = e;\r\n            this.state++;\r\n            return;\r\n        }\r\n\r\n\r\n        this.dataArr[this.dataArr.length] = e;\r\n        this.actionNumber = this.dataArr.length - 1;\r\n        const maxBefore = this.maxState;\r\n        this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\r\n        if (maxBefore < this.maxState) {\r\n            this.broadcast({bufferUpdate: this.dataArr[this.maxState]});\r\n        } else {\r\n            this.broadcast(null);\r\n        }\r\n        if (this.maxState >= 0) {\r\n            this.dataArr[this.maxState] = null; //to free some memory...imported images take a lot of space\r\n        }\r\n    }\r\n\r\n    undo (): (IHistoryEntry | null)[] {\r\n        let result;\r\n        if (this.canUndo()) {\r\n            result = [];\r\n            for (let i = this.maxState + 1; i < this.actionNumber; i++) {\r\n                result.push(this.dataArr[i]);\r\n            }\r\n            this.actionNumber--;\r\n            this.broadcast(null);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    redo (): (IHistoryEntry | null)[] {\r\n        const result = [];\r\n        if (this.canRedo()) {\r\n            this.actionNumber++;\r\n            result.push(this.dataArr[this.actionNumber]);\r\n            this.broadcast(null);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    getAll (): (IHistoryEntry | null)[] {\r\n        return [].concat(this.dataArr);\r\n    }\r\n\r\n    canRedo (): boolean {\r\n        return this.actionNumber < this.dataArr.length - 1;\r\n    }\r\n\r\n    canUndo (): boolean {\r\n        return this.actionNumber > this.maxState;\r\n    }\r\n\r\n    getState (): number {\r\n        return this.state;\r\n    }\r\n\r\n    /**\r\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\r\n     */\r\n    getActionNumber (): number {\r\n        return (this.actionNumber + 1);\r\n    }\r\n    \r\n}\r\n\r\nexport const klHistory = new KlHistory();\r\n","import {dialogCounter} from './modal-count';\r\nimport {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport checkImg from 'url:~/src/app/img/ui/check.svg';\r\n// @ts-ignore\r\nimport cancelImg from 'url:~/src/app/img/ui/cancel.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\n\r\nwindow.onscroll = (e) => {\r\n    e.preventDefault();\r\n}\r\n\r\nexport function popup (\r\n    p: {\r\n        target: HTMLElement;\r\n        div?: HTMLElement; // node with content\r\n        message: string; // can be html\r\n        callback?: (result: string) => void;\r\n        buttons?: string[]; // \"Ok\", and \"Cancel\" will be automatically translated\r\n        primaries?: string[];\r\n        type?: 'error' | 'warning' | 'upload' | 'ok'; // todo\r\n        closefunc?: (f: () => void) => void; // returns a function you can call to close (Cancel) the dialog\r\n        style?: IKeyString;\r\n        clickOnEnter?: string; // name of button - will be clicked if enter key pressed\r\n        autoFocus?: false | string; // name of  to automatically focus - default 'Ok' - false -> none\r\n        ignoreBackground?: boolean; // deafult false; if true clicking on background doesn't close\r\n    }\r\n): void {\r\n    dialogCounter.increase();\r\n    let isClosed = false;\r\n\r\n\r\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\r\n    const rootRootEl = BB.el({\r\n        parent: document.body,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            overflow: 'hidden',\r\n        }\r\n    });\r\n    const rootEl = BB.el({\r\n        parent: rootRootEl,\r\n        className: 'kl-popup',\r\n    });\r\n\r\n    const scrollContent = BB.el({\r\n        parent: rootEl,\r\n        css: {\r\n            width: '100%',\r\n            minHeight: '100%',\r\n            // padding: '10px 0',\r\n            position: 'relative',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n        }\r\n    });\r\n\r\n    const bgEl = BB.el({\r\n        parent: scrollContent,\r\n        onClick: () => {\r\n            if (p.ignoreBackground) {\r\n                return;\r\n            }\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            zIndex: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n        }\r\n    });\r\n\r\n    const titleHeight = 40;\r\n    const xButton = BB.el({\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: () => {\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            position: 'absolute',\r\n            right: '0',\r\n            top: '0',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        }\r\n    });\r\n\r\n    const boxClasses = ['kl-popup-box'];\r\n    boxClasses.push('kl-popup-box--sm');\r\n    const boxEl = BB.el({\r\n        content: [\r\n            xButton,\r\n            BB.el({\r\n                content:p.message,\r\n                css: {\r\n                    marginBottom: p.div ? '10px' : null,\r\n                    marginRight: '15px',\r\n                }\r\n            }),\r\n            p.div,\r\n        ],\r\n        className: boxClasses.join(' '),\r\n        css: p.style ? p.style : null,\r\n    });\r\n\r\n    scrollContent.append(\r\n        BB.el({\r\n            css: {\r\n                flex: '0.5',\r\n            }\r\n        }),\r\n        boxEl,\r\n        BB.el({\r\n            css: {\r\n                flex: '1',\r\n            }\r\n        })\r\n    );\r\n\r\n    if (p.type === 'error') {\r\n        boxEl.classList.add('poperror');\r\n    }\r\n    if (p.type === 'ok') {\r\n        boxEl.classList.add('popok');\r\n    }\r\n    if (p.type === 'warning') {\r\n        boxEl.classList.add('popwarning');\r\n    }\r\n    if (p.type === 'upload') {\r\n        boxEl.classList.add('popupload');\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e, comboStr) {\r\n            if (isClosed) {\r\n                return;\r\n            }\r\n            if (clickOnEnterBtn && comboStr === 'enter' && !BB.isInputFocused()) {\r\n                e.stopPropagation();\r\n                setTimeout(function() {\r\n                    clickOnEnterBtn.click();\r\n                }, 10);\r\n            }\r\n            if (comboStr === 'esc') {\r\n                e.stopPropagation();\r\n                close('Cancel');\r\n            }\r\n        }\r\n    });\r\n    // prevent ctrl scroll -> zooming page\r\n    const wheelPrevent = (event) => {\r\n        if (keyListener.isPressed('ctrl')) {\r\n            event.preventDefault();\r\n        }\r\n    };\r\n    BB.addEventListener(rootEl, 'wheel', wheelPrevent);\r\n    rootEl.onclick = BB.handleClick;\r\n\r\n    let autoFocus = null;\r\n    if (p.autoFocus) {\r\n        autoFocus = p.autoFocus;\r\n    } else if (p.autoFocus === false) {\r\n        autoFocus = null;\r\n    } else {\r\n        autoFocus = 'Ok';\r\n    }\r\n\r\n    const buttonRowEl = p.buttons && p.buttons.length > 0 ? BB.el({\r\n        parent: boxEl,\r\n        css: {\r\n            display: 'flex',\r\n            flexWrap: 'wrap',\r\n            justifyContent: 'flex-end',\r\n            marginTop: '12px', // 8px already via buttons\r\n            marginLeft: '-8px',\r\n        }\r\n    }) : null;\r\n    let clickOnEnterBtn;\r\n    const btnElArr = [];\r\n    if (p.buttons) {\r\n        p.buttons.forEach(buttonName => {\r\n            const btnClasses = ['kl-popup__btn'];\r\n            if (buttonName === 'Ok' || (p.primaries && p.primaries.includes(buttonName))) {\r\n                btnClasses.push('kl-button-primary');\r\n            }\r\n            let iconUrl;\r\n            let label = buttonName;\r\n            if (buttonName === 'Ok') {\r\n                label = LANG('modal-ok');\r\n                iconUrl = checkImg;\r\n            }\r\n            if (buttonName === 'Cancel') {\r\n                label = LANG('modal-cancel');\r\n                iconUrl = cancelImg;\r\n            }\r\n            let iconImg = null;\r\n            if (iconUrl) {\r\n                iconImg = BB.el({\r\n                    tagName: 'img',\r\n                    custom: {\r\n                        src: iconUrl,\r\n                        height: '17',\r\n                    }\r\n                });\r\n            }\r\n            const btn = BB.el({\r\n                parent: buttonRowEl,\r\n                tagName: 'button',\r\n                className: btnClasses.join(' '),\r\n                content: [iconImg, label],\r\n                onClick: () => {\r\n                    close(buttonName);\r\n                },\r\n            });\r\n            btnElArr.push(btn);\r\n            if (autoFocus === buttonName) {\r\n                setTimeout(() => {\r\n                    btn.focus();\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 10);\r\n                setTimeout(() => {\r\n                    // safari needs a separate timeout\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 20);\r\n            }\r\n            if (buttonName === p.clickOnEnter) {\r\n                clickOnEnterBtn = btn;\r\n            }\r\n        });\r\n    }\r\n\r\n    function close (value: string) {\r\n        if (isClosed) {\r\n            return;\r\n        }\r\n\r\n        isClosed = true;\r\n        BB.clearSelection();\r\n        BB.unfocusAnyInput();\r\n        document.body.removeChild(rootRootEl);\r\n        dialogCounter.decrease();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        keyListener.destroy();\r\n        BB.removeEventListener(rootEl, 'wheel', wheelPrevent);\r\n        rootEl.onclick = null;\r\n        btnElArr.forEach(item => {\r\n            BB.destroyEl(item);\r\n        });\r\n        btnElArr.splice(0, btnElArr.length);\r\n\r\n        if (p.callback) {\r\n            p.callback(value);\r\n        }\r\n    }\r\n\r\n    if (p.closefunc) {\r\n        p.closefunc(function () {\r\n            close('Cancel');\r\n        });\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * popups that fill whole height, with some padding.\r\n * currently only used for iframe popups.\r\n *\r\n * p = {\r\n *      title: DOM Element | string, // optional (todo allow string)\r\n *      icon: 'ok', // optional todo\r\n *      content: DOM Element, // optional\r\n *      buttonArr: [ // optional todo\r\n *          'Ok',\r\n *          'Cancel'\r\n *      ],\r\n *      autoFocus: string | false, //todo\r\n *      clickOnEnter: string, //todo\r\n *      onClose: function(result: string), // optional (todo result)\r\n *\r\n *      //size and position\r\n *      width: 500,\r\n *      isMaxHeight: boolean //todo, currently always true\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const Popup = function(p) {\r\n    dialogCounter.increase();\r\n    const parent = document.body;\r\n    const div = BB.el({\r\n        parent: parent,\r\n        className: 'g-root',\r\n        css: {\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            bottom: '0',\r\n            right: '0',\r\n            background: 'rgba(0, 0, 0, 0.45)',\r\n            overflow: 'auto',\r\n            animationName: 'consoleIn',\r\n            animationDuration: '0.3s',\r\n            animationTimingFunction: 'ease-out'\r\n        }\r\n    });\r\n    div.onclick = BB.handleClick;\r\n\r\n    let updateInterval;\r\n\r\n    function close() {\r\n        dialogCounter.decrease();\r\n        div.onclick = null;\r\n        parent.removeChild(div);\r\n        clearInterval(updateInterval);\r\n        window.removeEventListener('resize', updatePos);\r\n        keyListener.destroy();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        if (p.onClose) {\r\n            p.onClose();\r\n        }\r\n    }\r\n\r\n    //background element registering clicks\r\n    const bgEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            bottom: '0',\r\n            right: '0'\r\n        },\r\n        onClick: close\r\n    });\r\n\r\n    //the actual popup box\r\n    const popupEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'absolute',\r\n            width: (BB.isCssMinMaxSupported() ?\r\n                'min(calc(100% - 40px), ' + (p.width ? p.width : 400) + 'px)' :\r\n                (p.width ? p.width : 400) + 'px'),\r\n            height: 'calc(100% - 40px)',\r\n            background: '#eee',\r\n            borderRadius: '10px',\r\n            overflow: 'hidden',\r\n            boxShadow: 'rgba(0, 0, 0, 0.25) 0px 5px 60px'\r\n        }\r\n    });\r\n\r\n    //x and y position via script. flex not powerful enough imo\r\n    function updatePos() {\r\n        const elW = popupEl.offsetWidth;\r\n        const elH = popupEl.offsetHeight;\r\n\r\n        BB.css(popupEl, {\r\n            left: Math.max(0, (window.innerWidth - elW) / 2) + 'px',\r\n            top: Math.max(20, (window.innerHeight - elH) / 2 - (elH * 0.20)) + 'px'\r\n        });\r\n    }\r\n    //todo also update when popup changes size - resizeobserver and fallback\r\n    //updateInterval = setInterval(updatePos, 100);\r\n    updatePos();\r\n    window.addEventListener('resize', updatePos);\r\n\r\n    //title row in popup\r\n    const titleHeight = 40;\r\n    const titleEl = BB.el({\r\n        parent: popupEl,\r\n        css: {\r\n            height: titleHeight + 'px',\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            paddingLeft: (titleHeight / 2) + 'px'\r\n        }\r\n    });\r\n    if (p.title) {\r\n        titleEl.appendChild(p.title);\r\n    }\r\n    const xButton = BB.el({\r\n        parent: titleEl,\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: close,\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        },\r\n        custom: {\r\n            tabindex: '0',\r\n        }\r\n    });\r\n\r\n    const contentEl = BB.el({\r\n        parent: popupEl,\r\n        css: {\r\n            height: 'calc(100% - ' + titleHeight + 'px)'\r\n        }\r\n    });\r\n    if (p.content) {\r\n        contentEl.appendChild(p.content);\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e) {\r\n            if (keyStr === 'esc') {\r\n                e.stopPropagation();\r\n                close();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n    this.close = function() {\r\n        close();\r\n    };\r\n};","\r\n// not the best\r\n\r\n/**\r\n * how many modals are open\r\n */\r\n\r\nexport class DialogCounter {\r\n    private listeners: ((v: number) => void)[] = [];\r\n    private count = 0;\r\n\r\n    private emit (): void {\r\n        this.listeners.forEach(item => {\r\n            item(this.count);\r\n        });\r\n    }\r\n\r\n    increase (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count += v;\r\n        } else {\r\n            this.count++;\r\n        }\r\n        this.emit();\r\n    }\r\n    decrease (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count -= v;\r\n        } else {\r\n            this.count--;\r\n        }\r\n        this.emit();\r\n    }\r\n    get (): number {\r\n        return this.count;\r\n    }\r\n    subscribe (listener: (v: number) => void): void {\r\n        this.listeners.push(listener);\r\n    }\r\n}\r\n\r\nexport const dialogCounter = new DialogCounter();\r\n","import * as BBEventListener from './input/event-listener';\r\nimport {\r\n    append, centerWithin, copyObj, createSvg,\r\n    css, dateDayDifference, decToFraction,\r\n    fitInto, gcd, getDate,\r\n    handleClick, imageBlobToUrl,\r\n    insertAfter, loadImage,\r\n    reduce,\r\n    setAttributes, shareCanvas\r\n} from './base/base';\r\nimport {\r\n    canShareFiles,\r\n    eventUsesHighResTimeStamp,\r\n    getVisitor,\r\n    hasPointerEvents,\r\n    hasWebGl,\r\n    isCssMinMaxSupported,\r\n    mouseEventHasMovement\r\n} from './base/browser';\r\nimport {KeyListener, sameKeys} from './input/key-listener';\r\nimport {PointerListener} from './input/pointer-listener';\r\nimport * as EventChain from './input/event-chain';\r\nimport {\r\n    canvasBounds,\r\n    convertToAlphaChannelCanvas,\r\n    copyCanvas,\r\n    createCheckerCanvas, createCheckerDataUrl,\r\n    drawTransformedImageOnCanvas,\r\n    drawTransformedImageWithBounds, freeCanvas, resizeCanvas, testShouldPixelate\r\n} from './base/canvas';\r\nimport {Matrix} from './math/matrix';\r\nimport {Vec2} from './math/vec2';\r\nimport {BezierLine, PointLine, projectPointOnLine, quadraticSplineInput, SplineInterpolator} from './math/line';\r\nimport {CMYK, ColorConverter, HSV, RGB, testIsWhiteBestContrast} from './color/color';\r\nimport {\r\n    appendTextDiv,\r\n    clearSelection,\r\n    destroyEl,\r\n    el,\r\n    isInputFocused,\r\n    makeUnfocusable,\r\n    unfocusAnyInput\r\n} from './base/ui';\r\nimport {\r\n    pointsToAngleDeg,\r\n    clamp,\r\n    dist,\r\n    mix,\r\n    pointsToAngleRad,\r\n    rotate,\r\n    rotateAround,\r\n    intDxy,\r\n    roundEven, roundUneven, distSquared, lenSquared, updateBounds, boundsInArea, round, isInsideRect\r\n} from './math/math';\r\nimport {createCanvas} from './base/create-canvas';\r\nimport {BbLog} from './base/bb-log';\r\nimport {LocalStorage} from './base/local-storage';\r\n\r\nexport const BB = {\r\n\r\n    // ---- browser ----\r\n    eventUsesHighResTimeStamp,\r\n    mouseEventHasMovement,\r\n    hasPointerEvents,\r\n    hasWebGl,\r\n    getVisitor,\r\n    isCssMinMaxSupported,\r\n    canShareFiles,\r\n\r\n    // ---- base ----\r\n    insertAfter,\r\n    loadImage,\r\n    css,\r\n    setAttributes,\r\n    append,\r\n    fitInto,\r\n    centerWithin,\r\n    getDate,\r\n    gcd,\r\n    reduce,\r\n    decToFraction,\r\n    imageBlobToUrl,\r\n    dateDayDifference,\r\n    copyObj,\r\n    shareCanvas,\r\n    handleClick,\r\n    createSvg,\r\n    BbLog,\r\n    LocalStorage,\r\n\r\n    // ---- math ----\r\n    mix,\r\n    dist,\r\n    distSquared,\r\n    lenSquared,\r\n    pointsToAngleRad,\r\n    pointsToAngleDeg,\r\n    isInsideRect,\r\n    clamp,\r\n    rotate,\r\n    rotateAround,\r\n    Matrix,\r\n    Vec2,\r\n    intDxy,\r\n    roundEven,\r\n    roundUneven,\r\n    round,\r\n    updateBounds,\r\n    boundsInArea,\r\n\r\n    // ---- line ----\r\n    projectPointOnLine,\r\n    PointLine,\r\n    BezierLine,\r\n    SplineInterpolator,\r\n    quadraticSplineInput,\r\n\r\n    // ---- canvas ----\r\n    canvas: createCanvas,\r\n    copyCanvas,\r\n    testShouldPixelate,\r\n    drawTransformedImageWithBounds,\r\n    drawTransformedImageOnCanvas,\r\n    createCheckerCanvas,\r\n    createCheckerDataUrl,\r\n    resizeCanvas,\r\n    convertToAlphaChannelCanvas,\r\n    freeCanvas,\r\n    canvasBounds,\r\n\r\n    // ---- color ----\r\n    HSV,\r\n    RGB,\r\n    CMYK,\r\n    ColorConverter,\r\n    testIsWhiteBestContrast,\r\n\r\n    // ---- UI ----\r\n    appendTextDiv,\r\n    clearSelection,\r\n    makeUnfocusable,\r\n    el,\r\n    destroyEl,\r\n    isInputFocused,\r\n    unfocusAnyInput,\r\n\r\n\r\n    // ---- events / input ----\r\n\r\n    addEventListener: BBEventListener.addEventListener,\r\n    removeEventListener: BBEventListener.removeEventListener,\r\n    setEventListener: BBEventListener.setEventListener,\r\n\r\n    KeyListener,\r\n    PointerListener,\r\n    sameKeys,\r\n\r\n    EventChain,\r\n\r\n};\r\n","import {hasPointerEvents} from '../base/browser';\r\n\r\nconst listenerFuncObj = {}; // for debugging\r\n\r\nexport const setEventListener = function (DomEl, type, listener) {\r\n    if (!hasPointerEvents) {\r\n        type = type.replace('pointer', 'mouse');\r\n    }\r\n    DomEl[type] = listener;\r\n};\r\n\r\nexport const addEventListener = function (DomEl, type, listener, options?) {\r\n    if (!hasPointerEvents) {\r\n        type = type.replace('pointer', 'mouse');\r\n    }\r\n    /*if (!(type in listenerFuncObj)) {\r\n        listenerFuncObj[type] = [];\r\n    }\r\n    listenerFuncObj[type].push(listener);*/\r\n    DomEl.addEventListener(type, listener, options);\r\n};\r\n\r\nexport const removeEventListener = function (DomEl, type, listener, options?) {\r\n    if (!hasPointerEvents) {\r\n        type = type.replace('pointer', 'mouse');\r\n    }\r\n    /*if (type in listenerFuncObj) {\r\n        for (let i = 0; i < listenerFuncObj[type].length; i++) {\r\n            if (listenerFuncObj[type][i] === listener) {\r\n                listenerFuncObj[type].splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }*/\r\n    DomEl.removeEventListener(type, listener, options);\r\n};","import {createCanvas} from './create-canvas';\r\n\r\nexport const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\r\n\r\nexport const eventUsesHighResTimeStamp = (function() {\r\n\r\n    let eventUsesHighResTimeStamp: boolean | null = null;\r\n    if (document.body) {\r\n        (function() {\r\n            const event = new Event('');\r\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\r\n        })();\r\n    } else {\r\n        window.addEventListener('DOMContentLoaded', function(event) {\r\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\r\n        });\r\n    }\r\n\r\n    return function(): boolean {\r\n        if (eventUsesHighResTimeStamp === null) {\r\n            throw 'eventUsesHighResTimeStamp not initialized';\r\n        }\r\n        return eventUsesHighResTimeStamp;\r\n    }\r\n})();\r\n\r\nexport const mouseEventHasMovement = (() => {\r\n\r\n    // no support: IE, Safari, Safari iOS\r\n    // supported but broken: Firefox\r\n\r\n    if (!('MouseEvent' in window)) {\r\n        return false;\r\n    }\r\n    let mouseEvent;\r\n    try {\r\n        mouseEvent = new MouseEvent('mousemove'); // browsers not supporting the constructor don't have it\r\n    } catch (e) {\r\n        return false;\r\n    }\r\n    if (!('movementX' in mouseEvent)) {\r\n        return false; // likely safari\r\n    }\r\n    return !isFirefox;\r\n})();\r\n\r\nexport const hasPointerEvents = !!window.PointerEvent;\r\n\r\nexport const hasWebGl = (function() {\r\n\r\n    const hasWebgl = (function() {\r\n        const canvas = createCanvas();\r\n        try {\r\n            canvas.getContext('experimental-webgl', { premultipliedAlpha: false });\r\n            return true;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    })();\r\n\r\n    return function() {\r\n        return hasWebgl;\r\n    }\r\n})();\r\n\r\nexport const getVisitor = (function () {\r\n    const visitor = {\r\n        chrome: false,\r\n        gl: false\r\n    };\r\n    //Chrome\r\n    if ((window as any).chrome && (window as any).chrome.app) {\r\n        visitor.chrome = true;\r\n    }\r\n    //WebGL\r\n    visitor.gl = hasWebGl();\r\n    return function () {\r\n        return JSON.parse(JSON.stringify(visitor));\r\n    }\r\n})();\r\n\r\nexport const isCssMinMaxSupported = (function() {\r\n    let result: boolean | null = null;\r\n\r\n    function test() {\r\n        const div = document.createElement('div');\r\n        div.style.position = 'absolute';\r\n        div.style.top = '0';\r\n        div.style.left = 'max(0px, 25px)';\r\n        document.body.appendChild(div);\r\n        setTimeout(function() {\r\n            result = div.offsetLeft === 25;\r\n            document.body.removeChild(div);\r\n        }, 25);\r\n    }\r\n\r\n    if (document.body) {\r\n        test();\r\n    } else {\r\n        window.addEventListener('DOMContentLoaded', function() {\r\n            test();\r\n        });\r\n    }\r\n\r\n    return function(): boolean {\r\n        if (result === null) {\r\n            throw new Error('isCssMinMaxSupported not initialized');\r\n        }\r\n        return result;\r\n    };\r\n})();\r\n\r\nexport const canShareFiles = function(): boolean {\r\n    return 'share' in navigator && 'canShare' in navigator;\r\n};","/*window['canvases'] = [];\r\n\r\nwindow['printCanvases'] = () => {\r\n    let total = 0;\r\n\r\n    console.log(window['canvases'].map(item => {\r\n        total += item.width * item.height;\r\n        return {w: item.width, h: item.height};\r\n    }));\r\n\r\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\r\n};*/\r\n\r\nexport function createCanvas(w?: number, h?: number): HTMLCanvasElement {\r\n    const result = document.createElement('canvas');\r\n    if (w && h) {\r\n        result.width = w;\r\n        result.height = h;\r\n    }\r\n    // window['canvases'].push(result);\r\n    return result;\r\n}","import {IKeyString, ISize2D, ISVG, IVector2D} from '../BB.types';\r\n\r\nexport function insertAfter (referenceNode: Element, newNode: Element): void {\r\n    if (referenceNode.parentNode) {\r\n        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\r\n    }\r\n}\r\n\r\nexport function loadImage (im: HTMLImageElement, callback: () => void): void {\r\n    let counter = 0;\r\n\r\n    function check() {\r\n        if (counter === 1000) {\r\n            alert(\"couldn't load\");\r\n            return;\r\n        }\r\n        if (im.complete) {\r\n            counter++;\r\n            callback();\r\n        } else {\r\n            setTimeout(check, 1);\r\n        }\r\n    }\r\n\r\n    check();\r\n}\r\n\r\nexport function css (el: HTMLElement | SVGElement, styleObj: IKeyString): void {\r\n    const keyArr = Object.keys(styleObj);\r\n    let keyStr: string;\r\n    const style = (el.style as unknown) as IKeyString;\r\n    for (let i = 0; i < keyArr.length; i++) {\r\n        keyStr = keyArr[i];\r\n        style[keyStr] = styleObj[keyStr];\r\n        style.alignContent = 'true';\r\n        if (keyStr === 'userSelect') {\r\n            style.webkitUserSelect = styleObj[keyStr]; // safari\r\n        }\r\n    }\r\n}\r\n\r\nexport function setAttributes (el: HTMLElement, attrObj: IKeyString): void {\r\n    const keyArr = Object.keys(attrObj);\r\n    let keyStr;\r\n    for (let i = 0; i < keyArr.length; i++) {\r\n        keyStr = keyArr[i];\r\n        el.setAttribute(keyStr, attrObj[keyStr]);\r\n    }\r\n}\r\n\r\n/**\r\n * appendChild with an array\r\n * @param target\r\n * @param els\r\n */\r\nexport function append(target: HTMLElement, els: (HTMLElement | string | null)[]) {\r\n    const fragment = document.createDocumentFragment();\r\n    els.forEach(item => item ? fragment.append(item) : null);\r\n    target.append(fragment);\r\n}\r\n\r\n/**\r\n * a needs to fit into b\r\n * @param aw\r\n * @param ah\r\n * @param bw\r\n * @param bh\r\n * @param min\r\n */\r\nexport function fitInto (aw: number, ah: number, bw: number, bh: number, min?: number): ISize2D {\r\n    let width = aw * bw, height = ah * bw;\r\n    if (width > bw) {\r\n        height = bw / width * height;\r\n        width = bw;\r\n    }\r\n    if (height > bh) {\r\n        width = bh / height * width;\r\n        height = bh;\r\n    }\r\n    if (min) {\r\n        width = Math.max(min, width);\r\n        height = Math.max(min, height);\r\n    }\r\n    return {width, height};\r\n}\r\n\r\n/**\r\n * center b in a\r\n * @param aw\r\n * @param ah\r\n * @param bw\r\n * @param bh\r\n */\r\nexport function centerWithin (aw: number, ah: number, bw: number, bh: number): IVector2D {\r\n    return {\r\n        x: aw / 2 - bw / 2,\r\n        y: ah / 2 - bh / 2\r\n    };\r\n}\r\n\r\nexport function getDate (): string {\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\r\n    const day = date.getDate().toString().padStart(2, '0');\r\n    const minutes = (date.getHours() * 60 + date.getMinutes()).toString(36).padStart(3, '0');\r\n\r\n    return year + '_' + month + '_' + day + '_' + minutes + '_';\r\n}\r\n\r\nexport function gcd (a: number, b: number): number {\r\n    return b ? gcd(b, a % b) : a;\r\n}\r\n\r\nexport function reduce (numerator: number, denominator: number): [number, number] {\r\n    const g = gcd(numerator, denominator);\r\n    return [numerator / g, denominator / g];\r\n}\r\n\r\nexport function decToFraction (decimalNumber: number): [number, number] {\r\n    const len = decimalNumber.toString().length - 2;\r\n    const denominator = Math.pow(10, len);\r\n    const numerator = decimalNumber * denominator;\r\n    return reduce(numerator, denominator);\r\n}\r\n\r\n/**\r\n * blobObj isn't always a Blob, but rather an object, because Blob doesn't exist.\r\n * @param blobObj\r\n * @returns {string}\r\n */\r\nexport function imageBlobToUrl(blobObj: Blob): string {\r\n    if (!blobObj) {\r\n        throw new Error('blobObj is undefined or null');\r\n    }\r\n    if (window.Blob && blobObj instanceof Blob) {\r\n        return URL.createObjectURL(blobObj); // object url\r\n    } else if (blobObj.constructor.name === 'Object') {\r\n        const fauxBlob = (blobObj as unknown) as {type: string, encoding: string, data: string};\r\n        return 'data:' + fauxBlob.type + ';' + fauxBlob.encoding + ',' + fauxBlob.data; // data url\r\n    } else {\r\n        throw new Error('unknown blob format');\r\n    }\r\n}\r\n\r\nexport function dateDayDifference (dateA: string | Date, dateB: string | Date): number {\r\n    dateA = new Date(dateA);\r\n    dateB = new Date(dateB);\r\n    dateA.setHours(0, 0, 0, 0);\r\n    dateB.setHours(0, 0, 0, 0);\r\n    return (dateB.getTime() - dateA.getTime()) / (1000 * 60 * 60 * 24);\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\r\nexport function copyObj (obj: any): any {\r\n    return JSON.parse(JSON.stringify(obj));\r\n}\r\n\r\n/**\r\n * triggers Web Share API - share feature on mobile devices\r\n * Only works if they support file sharing - e.g. Safari can't do this yet\r\n * only call if BB.canShareFiles() -> true\r\n *\r\n * p = {\r\n *     canvas: Canvas,\r\n *     fileName: string,\r\n *     title: string\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function shareCanvas (p: {canvas: HTMLCanvasElement, fileName:string, title: string, callback: () => void}): void {\r\n    const mimetype = 'image/png';\r\n    const err = () => alert('sharing not supported');\r\n    p.canvas.toBlob(function(blob) {\r\n        if (blob === null) {\r\n            err();\r\n            p.callback();\r\n            return;\r\n        }\r\n        try {\r\n            const filesArray = [new File([blob], p.fileName, {type: mimetype})];\r\n            navigator.share({\r\n                title: p.title,\r\n                files: filesArray,\r\n            } as any)\r\n                .then(r => {\r\n\r\n                })\r\n                .catch(e => {\r\n                    err();\r\n            });\r\n        } catch(e) {\r\n            err();\r\n        }\r\n        p.callback();\r\n    }, mimetype);\r\n}\r\n\r\n/**\r\n * Prevent ipad from zooming in when double tapping. iPadOS 13 bug.\r\n * Give it your click event\r\n *\r\n * @param clickEvent\r\n * @returns {boolean}\r\n */\r\nexport function handleClick (clickEvent: MouseEvent): boolean {\r\n    const target: HTMLElement | null = clickEvent.target as HTMLElement;\r\n    if (!target) {\r\n        return false;\r\n    }\r\n    if (['A', 'LABEL', 'INPUT'].includes(target.tagName) || (target as any).allowClick) {\r\n        return true;\r\n    }\r\n    clickEvent.preventDefault();\r\n    return false;\r\n}\r\n\r\n\r\n/**\r\n * @param el {elementType: string, childrenArr: []el, ...svg attributes...}\r\n * @returns svg element tree\r\n */\r\nexport function createSvg (el: ISVG): SVGElement {\r\n    const result = document.createElementNS('http://www.w3.org/2000/svg', el.elementType);\r\n    const keyArr = Object.keys(el);\r\n    let keyStr;\r\n    for (let i = 0; i < keyArr.length; i++) {\r\n        keyStr = keyArr[i];\r\n        if (keyStr === 'childrenArr') {\r\n            for (let e = 0; e < el.childrenArr.length; e++) {\r\n                result.appendChild(createSvg(el.childrenArr[e]));\r\n            }\r\n        } else if (keyStr !== 'elementType') {\r\n            result.setAttribute(keyStr, el[keyStr] as string);\r\n        }\r\n    }\r\n    return result;\r\n}","import {addEventListener, removeEventListener} from './event-listener';\r\n\r\n\r\nconst globalKey = (() => {\r\n\r\n    const keyStrToKeyObj = { // keyStr not to contain a '+', because that's used for the comboStr\r\n        'space': [' ', 'Spacebar'], // Spacebar in IE\r\n        'alt': ['Alt', 'AltGraph'],\r\n        'shift': 'Shift',\r\n        'ctrl': 'Control',\r\n        'cmd': ['Meta', 'MetaLeft', 'MetaRight'],\r\n        'enter': 'Enter',\r\n        'esc': 'Escape',\r\n        'backspace': 'Backspace',\r\n        'delete': 'Delete',\r\n        'sqbr_open': '[',\r\n        'sqbr_close': ']',\r\n        'a': ['a', 'A'],\r\n        'b': ['b', 'B'],\r\n        'c': ['c', 'C'],\r\n        'e': ['e', 'E'],\r\n        'f': ['f', 'F'],\r\n        'g': ['g', 'G'],\r\n        'r': ['r', 'R'], // when holding shift\r\n        's': ['s', 'S'],\r\n        't': ['t', 'T'],\r\n        'u': ['u', 'U'],\r\n        'x': ['x', 'X'],\r\n        'y': ['y', 'Y'],\r\n        'z': ['z', 'Z'],\r\n        'plus': '+',\r\n        'minus': '-',\r\n        'left': 'ArrowLeft',\r\n        'right': 'ArrowRight',\r\n        'up': 'ArrowUp',\r\n        'down': 'ArrowDown',\r\n        'home': 'Home',\r\n        'end': 'End'\r\n    };\r\n    const keyToKeyStrArr = Object.keys(keyStrToKeyObj);\r\n    const isDownObj = {};\r\n    const keyToKeyStrObj = {}; // event.key to keyStr { ArrowLeft: 'left', ... }\r\n    let comboArr = [];\r\n    //a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\r\n    let codeIsDownObj = {}; // { KeyE: 'e', KeyF: null } - null not down, string, the associated keyStr\r\n    const listenerArr = [];\r\n\r\n    for (let i = 0; i < keyToKeyStrArr.length; i++) {\r\n        isDownObj[keyToKeyStrArr[i]] = false;\r\n\r\n        const code = keyStrToKeyObj[keyToKeyStrArr[i]];\r\n        if (typeof code === 'string') {\r\n            keyToKeyStrObj[keyStrToKeyObj[keyToKeyStrArr[i]]] = keyToKeyStrArr[i];\r\n        } else {\r\n            for (let e = 0; e < code.length; e++) {\r\n                keyToKeyStrObj[code[e]] = keyToKeyStrArr[i];\r\n            }\r\n        }\r\n    }\r\n\r\n    function emitDown(a, b, c, d?) {\r\n        listenerArr.forEach(item => {\r\n            if (!item[0]) {\r\n                return;\r\n            }\r\n            item[0](a, b, c, d);\r\n        });\r\n    }\r\n\r\n    function emitUp(a, b, c) {\r\n        listenerArr.forEach(item => {\r\n            if (!item[1]) {\r\n                return;\r\n            }\r\n            item[1](a, b, c);\r\n        });\r\n    }\r\n\r\n    function emitBlur() {\r\n        listenerArr.forEach(item => {\r\n            if (!item[2]) {\r\n                return;\r\n            }\r\n            item[2]();\r\n        });\r\n    }\r\n\r\n    function keyDown(e) {\r\n        const key = e.key;\r\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\r\n\r\n        if (key in keyToKeyStrObj) {\r\n            const keyStr = keyToKeyStrObj[key];\r\n            if (isDownObj[keyStr]) {\r\n                emitDown(keyStr, e, comboArr.join('+'), true);\r\n                return;\r\n            }\r\n            isDownObj[keyStr] = true;\r\n            codeIsDownObj[code] = keyStr;\r\n\r\n            //add to combo\r\n            comboArr.push(keyStr);\r\n\r\n            emitDown(keyStr, e, comboArr.join('+'));\r\n        }\r\n    }\r\n\r\n\r\n    function keyUp(e) {\r\n        const key = e.key;\r\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\r\n        const oldComboStr = comboArr.join('+');\r\n\r\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\r\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\r\n        if ([\r\n            'Meta', 'MetaLeft', 'MetaRight',\r\n            'OSLeft', 'OSRight', // Firefox\r\n        ].includes(code)) {\r\n            blur(null);\r\n            return;\r\n        }\r\n\r\n        if (code in codeIsDownObj && codeIsDownObj[code] !== null) {\r\n            const keyStr = codeIsDownObj[code];\r\n            isDownObj[keyStr] = false;\r\n            codeIsDownObj[code] = null;\r\n\r\n            //remove from combo\r\n            for (let i = 0; i < comboArr.length; i++) {\r\n                if (comboArr[i] == keyStr) {\r\n                    comboArr.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n\r\n            emitUp(keyStr, e, oldComboStr);\r\n        }\r\n    }\r\n\r\n    function blur(event) {\r\n        const oldComboStr = comboArr.join('+');\r\n        comboArr = [];\r\n        codeIsDownObj = {};\r\n\r\n        const eventArr = [];\r\n        for (let i = 0; i < keyToKeyStrArr.length; i++) {\r\n            if (isDownObj[keyToKeyStrArr[i]]) {\r\n                isDownObj[keyToKeyStrArr[i]] = false;\r\n                eventArr.push(keyToKeyStrArr[i]);\r\n            }\r\n        }\r\n        for (let i = 0; i < eventArr.length; i++) {\r\n            emitUp(\r\n                eventArr[i],\r\n                {\r\n                    preventDefault: function () {},\r\n                    stopPropagation: function () {},\r\n                },\r\n                oldComboStr,\r\n            );\r\n        }\r\n        emitBlur();\r\n    }\r\n\r\n\r\n\r\n    return {\r\n        add: (keyListener) => {\r\n            if (listenerArr.includes(keyListener)) {\r\n                return;\r\n            }\r\n            const first = listenerArr.length === 0;\r\n            listenerArr.push(keyListener);\r\n\r\n            if (first) {\r\n                addEventListener(document, 'keydown', keyDown);\r\n                addEventListener(document, 'keyup', keyUp);\r\n                addEventListener(window, 'blur', blur);\r\n            }\r\n        },\r\n        remove: (keyListener) => {\r\n            if (!listenerArr.includes(keyListener)) {\r\n                return;\r\n            }\r\n            const last = listenerArr.length === 1;\r\n            for (let i = 0; i < listenerArr.length; i++) {\r\n                if (listenerArr[i] === keyListener) {\r\n                    listenerArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n            if (last) {\r\n                removeEventListener(document, 'keydown', keyDown);\r\n                removeEventListener(document, 'keyup', keyUp);\r\n                removeEventListener(window, 'blur', blur);\r\n            }\r\n        },\r\n        getIsDown: () => {\r\n            return isDownObj;\r\n        },\r\n        getCombo: () => {\r\n            return comboArr;\r\n        },\r\n    };\r\n})();\r\n\r\n\r\n\r\n/**\r\n * Listens to key events in window. Makes combos easier - e.g. ctrl + z\r\n *\r\n * keyStr - see in implementation - my representation of a key. e.g. 'r' can be 'r' and 'R'\r\n * comboStr - string joins currently pressed keyStr with a +\r\n *              e.g. 'ctrl+z'\r\n *\r\n */\r\nexport class KeyListener {\r\n\r\n    private readonly onDown;\r\n    private readonly onUp;\r\n    private readonly onBlur;\r\n    private readonly ref;\r\n\r\n    constructor (\r\n        p: {\r\n            onDown?: (keyStr: string, e: KeyboardEvent, comboStr: string, isRepeat?: boolean) => void;\r\n            onUp?: (keyStr: string, e: KeyboardEvent, oldComboStr: string) => void;\r\n            onBlur?: () => void;\r\n        },\r\n    ) {\r\n        this.onDown = p.onDown;\r\n        this.onUp = p.onUp;\r\n        this.onBlur = p.onBlur;\r\n        this.ref = [this.onDown, this.onUp, this.onBlur];\r\n        globalKey.add(this.ref);\r\n    }\r\n\r\n    isPressed (keyStr: string): boolean {\r\n        if (!(keyStr in globalKey.getIsDown())) {\r\n            throw 'key \"' + keyStr + '\" not found';\r\n        }\r\n        return globalKey.getIsDown()[keyStr];\r\n    }\r\n\r\n    getComboStr (): string {\r\n        return globalKey.getCombo().join('+');\r\n    }\r\n\r\n    comboOnlyContains (keyStrArr: string[]): boolean {\r\n        for (let i = 0; i < globalKey.getCombo().length; i++) {\r\n            if (!keyStrArr.includes(globalKey.getCombo()[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    destroy (): void {\r\n        globalKey.remove(this.ref);\r\n    }\r\n}\r\n\r\nexport function sameKeys(comboAStr: string, comboBStr: string): boolean {\r\n    return comboAStr.split('+').sort().join('+')=== comboBStr.split('+').sort().join('+');\r\n}","import {addEventListener, removeEventListener} from './event-listener';\r\n\r\n\r\n/**\r\n * Filters wheel events. removes swipe scrolling and pinch scrolling that trackpads do. (as best as it can)\r\n * Normalizes regular scrolls.\r\n *\r\n * Why:\r\n * - trackpad scrolling is different from old school mouse scrolling\r\n * - but there is not way to learn from the browser if it's trackpad scrolling\r\n * - browsers don't even give access to the raw swiping or pinching movement, but some abstraction on top, making the scrolling\r\n *      continue an arbitrary amount, at an arbitrary scale\r\n * - each browser does this differently. So you can't offer a coherent experience\r\n *\r\n * - also trackpads are painful to draw with. So supporting a trackpad-based workflow makes not much sense.\r\n *\r\n * @param callback - func({deltaY: number, pageX: number, pageY: number, clientX: number, clientY: number}\r\n * @constructor\r\n */\r\nimport {eventUsesHighResTimeStamp, hasPointerEvents, isFirefox} from '../base/browser';\r\nimport {mix} from '../math/math';\r\n\r\nconst WheelCleaner = function (callback) {\r\n    const sequenceTimeoutMs = 200;\r\n\r\n    const knownUnitArr = [100];\r\n    let sequenceLength = 0;\r\n    let sequenceUnit = null;\r\n    let endSequenceTimeout;\r\n    let toEmitDelta = null;\r\n    let position = null;\r\n\r\n\r\n    function emit(delta) {\r\n        callback({\r\n            deltaY: Math.round(delta / sequenceUnit),\r\n            pageX: position.pageX,\r\n            pageY: position.pageY,\r\n            clientX: position.clientX,\r\n            clientY: position.clientY,\r\n        });\r\n    }\r\n\r\n    function endSequence() {\r\n        if (toEmitDelta !== null) {\r\n            emit(toEmitDelta);\r\n            toEmitDelta = null;\r\n        }\r\n        if (sequenceUnit !== null && !(knownUnitArr.includes(sequenceUnit))) {\r\n            knownUnitArr.push(sequenceUnit);\r\n        }\r\n        sequenceLength = 0;\r\n        sequenceUnit = null;\r\n    }\r\n\r\n    // --- interface ---\r\n    this.process = function (event) {\r\n\r\n        position = {\r\n            pageX: event.pageX,\r\n            pageY: event.pageY,\r\n            clientX: event.clientX,\r\n            clientY: event.clientY,\r\n        };\r\n\r\n        clearTimeout(endSequenceTimeout);\r\n        endSequenceTimeout = setTimeout(endSequence, sequenceTimeoutMs);\r\n\r\n        //prep delta\r\n        let delta = event.deltaY;\r\n        if ('deltaMode' in event && event.deltaMode === 1) {\r\n            delta *= 100 / 3;\r\n        }\r\n        const absDelta = Math.abs(delta);\r\n\r\n\r\n        if (sequenceLength > 0 && sequenceUnit === null) {\r\n            //previously determined dirty sequence\r\n            toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n        //sequence begins\r\n        if (sequenceLength === 0) {\r\n            sequenceLength++;\r\n            if (absDelta < 50) {\r\n                //dirty - probably a swipe scroll or pinch scroll on trackpad\r\n                return;\r\n            }\r\n\r\n            sequenceUnit = absDelta;\r\n            if (knownUnitArr.includes(sequenceUnit)) {\r\n                //we know this unit - emit right away\r\n                emit(delta);\r\n            } else {\r\n                //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\r\n                toEmitDelta = delta;\r\n            }\r\n            return;\r\n        }\r\n\r\n        //sequence continues\r\n        if (absDelta === 0) {\r\n            //ignore zero scroll\r\n            return;\r\n        }\r\n        if (\r\n            absDelta === sequenceUnit ||\r\n            (absDelta / sequenceUnit) % 1 < 0.0001// a multiple\r\n        ) {\r\n            //fine\r\n        } else if ((sequenceUnit / absDelta) % 1 < 0.0001) {\r\n            //unit was actually a multiple - update it\r\n            sequenceUnit = absDelta;\r\n\r\n        } else if (absDelta !== sequenceUnit) {\r\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\r\n            sequenceUnit = null;\r\n            toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n\r\n        if (toEmitDelta !== null) {\r\n            emit(toEmitDelta);\r\n            toEmitDelta = null;\r\n        }\r\n        emit(delta);\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * PointerListener - for pointer events, wheel events. uses fallbacks. ideally consistent behavior across browsers\r\n * Has some workarounds for browser specific bugs. As browsers get better, this constructor should get smaller\r\n *\r\n * p = {\r\n *     target: DOM element,\r\n *     onPointer: func (pointerEvent), //optional\r\n *     onWheel: func (wheelEvent), //optional\r\n *     onEnterLeave: func (isOver: boolean), //optional\r\n *     maxPointers: int (1 - n), //default is 1\r\n *     fixScribble: boolean, // fix ipad scribble issue\r\n * }\r\n *\r\n * pointerEvent = {\r\n *     type: 'pointerdown'|'pointermove'|'pointerup',\r\n *     pointerId: long,\r\n *     pointerType: 'touch'|'mouse'|'pen',\r\n *     pageX: number,\r\n *     pageY: number,\r\n *     clientX: number,\r\n *     clientY: number,\r\n *     relX: number, //position relative to top left of target\r\n *     relY: number,\r\n *     dX: number, //movementX not supported by safari on iOS, so need my own\r\n *     dY: number,\r\n *     downPageX: number, //where was pointer when down-event occurred - set for down|move|up\r\n *     downPageY: number,\r\n *     coalescedArr: Array of {\r\n *         pageX: number,\r\n *         pageY: number,\r\n *         clientX: number,\r\n *         clientY: number,\r\n *         relX: number, //position relative to top left of target\r\n *         relY: number,\r\n *         dX: number,\r\n *         dY: number,\r\n *         time: number// same timescale as performance.now() - might be exact same number as in parent\r\n *     },\r\n *     time: number, // same timescale as performance.now()\r\n *     button: 'left'|'middle'|'right',\r\n *     pressure: number (0-1), // always 1 for touch and mouse\r\n *     eventPreventDefault: function(),\r\n *     eventStopPropagation: function(),\r\n * }\r\n *\r\n * wheelEvent = {\r\n *     deltaY: number, // increments of 1\r\n *     pageX: number,\r\n *     pageY: number,\r\n *     relX: number,\r\n *     relY: number,\r\n * }\r\n *\r\n * isOver(): boolean - if pointer over the target\r\n *\r\n * @param p\r\n */\r\nexport const PointerListener = (function () {\r\n\r\n    //keeping track of pointers for movement fallback\r\n    const pointerArr = [];\r\n\r\n    function addPointer(event) {\r\n        const pointerObj = {\r\n            pointerId: event.pointerId,\r\n            lastPageX: null,\r\n            lastPageY: null\r\n        };\r\n        pointerArr.push(pointerObj);\r\n\r\n        if (pointerArr.length > 15) {\r\n            pointerArr.shift();\r\n        }\r\n\r\n        return pointerObj;\r\n    }\r\n\r\n    function getPointer(event) {\r\n        for (let i = pointerArr.length - 1; i >= 0; i--) {\r\n            if (event.pointerId === pointerArr[i].pointerId) {\r\n                return pointerArr[i];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    let pressureNormalizeAvgCount = 0;\r\n    let pressureNormalizeAvgPressure = null;\r\n    let pressureNormalizeIsComplete = false;\r\n    let pressureNormalizeFactor = 1;\r\n\r\n    return function (p) {\r\n        const targetElement = p.target;\r\n        const onPointerCallback = p.onPointer;\r\n        const onWheelCallback = p.onWheel;\r\n        const onEnterLeaveCallback = p.onEnterLeave;\r\n        const maxPointers = 'maxPointers' in p ? p.maxPointers : 1;\r\n        const buttonsToStr = { // translation\r\n            '1': 'left',\r\n            '2': 'right',\r\n            '4': 'middle'\r\n        };\r\n        const wheelCleaner = new WheelCleaner(function (wheelEvent) {\r\n            if (isDestroyed) {\r\n                return;\r\n            }\r\n            if (onWheelCallback) {\r\n                const bounds = targetElement.getBoundingClientRect();\r\n                wheelEvent.relX = wheelEvent.clientX - bounds.left + targetElement.scrollLeft;\r\n                wheelEvent.relY = wheelEvent.clientY - bounds.top + targetElement.scrollTop;\r\n                onWheelCallback(wheelEvent);\r\n            }\r\n        });\r\n        let isDestroyed = false;\r\n\r\n        const timeStampOffset = eventUsesHighResTimeStamp() ? 0 : -performance.timing.navigationStart;\r\n\r\n\r\n        //to circumvent a chrome input glitch\r\n        let lastPointerType = '';\r\n        let didSkip = false;\r\n\r\n\r\n        /*\r\n        pointers that are pressing a button\r\n        dragObj = {\r\n            pointerId: long,\r\n            pointerType: 'mouse'|'pen'|'touch',\r\n            downPageX: number, //where was pointer when down-event occurred\r\n            downPageY: number,\r\n            button: long,\r\n            lastPageX: number, //pageX in previous event - only for touch events, because they don't have movementX/Y\r\n            lastPageY: number,\r\n            lastTimeStamp: number\r\n        }\r\n         */\r\n        const dragObjArr = [];\r\n        const dragPointerIdArr = [];\r\n\r\n        function getDragObj(pointerId) {\r\n            for (let i = 0; i < dragObjArr.length; i++) {\r\n                if (pointerId === dragObjArr[i].pointerId) {\r\n                    return dragObjArr[i];\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        function removeDragObj(pointerId) {\r\n            let removedDragObj = null;\r\n            for (let i = 0; i < dragPointerIdArr.length; i++) {\r\n                if (dragPointerIdArr[i] === pointerId) {\r\n                    removedDragObj = dragObjArr[i];\r\n                    dragObjArr.splice(i, 1);\r\n                    dragPointerIdArr.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n            return removedDragObj;\r\n        }\r\n\r\n\r\n        function normalizePressure(pressure, type?) {\r\n            if (pressure === 0 || pressure === 1) {\r\n                return pressure;\r\n            }\r\n\r\n            // was this there to prevent some glitch?\r\n            /*if (pressureNormalizeIsComplete && type === 'pointerdown' && pressure !== 1) {\r\n                pressure *= 0.004;\r\n            }*/\r\n\r\n            if (pressureNormalizeAvgCount < 60) {\r\n                if (pressureNormalizeAvgCount === 0) {\r\n                    pressureNormalizeAvgPressure = pressure;\r\n                } else {\r\n                    pressureNormalizeAvgPressure = mix(pressure, pressureNormalizeAvgPressure, 0.95);\r\n                }\r\n                pressureNormalizeAvgCount++;\r\n            } else if (!pressureNormalizeIsComplete) {\r\n                pressureNormalizeIsComplete = true;\r\n                //BB.throwOut('avg pressure decision!' + pressureNormalizeAvgPressure);\r\n                if (pressureNormalizeAvgPressure < 0.13) { // absurd pressure needed\r\n                    pressureNormalizeFactor = 2.3;\r\n                }\r\n            }\r\n\r\n\r\n            return Math.pow(pressure, 1 / pressureNormalizeFactor);\r\n        }\r\n\r\n\r\n        /**\r\n         *\r\n         * More trustworthy pointer attributes. that behave the same across browsers.\r\n         * returns a new object. this object also gets attached to the orig event. -> event.corrected\r\n         *\r\n         * @param event\r\n         * @returns {{pointerId: number, timeStamp: number, button, buttons, pointerType: (string|string|any), movementY: number, movementX: number, pressure, coalescedArr: [], pageY, pageX, clientX, clientY, eventPreventDefault: func, eventStopPropagation: func}\r\n         */\r\n        function correctPointerEvent(event) {\r\n            if (event.corrected) {\r\n                return event.corrected;\r\n            }\r\n\r\n            /*if (event.type === 'pointermove' && !window.hidePressureOut) {\r\n                if (event.type === 'pointermove') {\r\n                    BB.throwOut(event.pressure + ' ' + event.pointerType);\r\n                }\r\n            }*/\r\n\r\n            const correctedObj = {\r\n                pointerId: event.pointerId,\r\n                pointerType: event.pointerType,\r\n                pageX: event.pageX,\r\n                pageY: event.pageY,\r\n                clientX: event.clientX,\r\n                clientY: event.clientY,\r\n                movementX: event.movementX,\r\n                movementY: event.movementY,\r\n                timeStamp: event.timeStamp + timeStampOffset,\r\n                pressure: normalizePressure(event.pressure, event.type),\r\n                buttons: event.buttons,\r\n                button: event.button,\r\n                coalescedArr: [],\r\n                eventPreventDefault: function () {\r\n                    event.preventDefault();\r\n                },\r\n                eventStopPropagation: function () {\r\n                    event.stopPropagation();\r\n                }\r\n            };\r\n            event.corrected = correctedObj;\r\n\r\n            let customPressure = null;\r\n            if ('pointerId' in event) {\r\n                if ('pressure' in event && event.buttons !== 0 && (['mouse'].includes(event.pointerType) || (event.pointerType === 'touch' && event.pressure === 0))) {\r\n                    correctedObj.pressure = 1;\r\n                    customPressure = 1;\r\n                }\r\n            } else {\r\n                correctedObj.pointerId = 0;\r\n                correctedObj.pointerType = 'mouse';\r\n                correctedObj.pressure = event.buttons !== 0 ? 1 : 0;\r\n                customPressure = correctedObj.pressure;\r\n            }\r\n\r\n            if (isFirefox && event.pointerType != 'mouse' && event.type === 'pointermove' && event.buttons === 0) { // once again firefox\r\n                correctedObj.buttons = 1; //todo wrong if no buttons actually pressed\r\n            }\r\n\r\n            let coalescedEventArr = [];\r\n            if ('getCoalescedEvents' in event) {\r\n                coalescedEventArr = event.getCoalescedEvents();\r\n            }\r\n\r\n            // chrome somehow movementX not same scale as pageX. todo: only chrome?\r\n            // so make my own\r\n\r\n            let pointerObj = getPointer(correctedObj);\r\n            if (pointerObj === null) {\r\n                pointerObj = addPointer(correctedObj);\r\n            }\r\n\r\n            const totalLastX = pointerObj.lastPageX;\r\n            const totalLastY = pointerObj.lastPageY;\r\n\r\n            for (let i = 0; i < coalescedEventArr.length; i++) {\r\n                const eventItem = coalescedEventArr[i];\r\n\r\n                correctedObj.coalescedArr.push({\r\n                    pageX: eventItem.pageX,\r\n                    pageY: eventItem.pageY,\r\n                    clientX: eventItem.clientX,\r\n                    clientY: eventItem.clientY,\r\n                    movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\r\n                    movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\r\n                    timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : (eventItem.timeStamp + timeStampOffset), // 0 in firefox\r\n                    pressure: customPressure === null ? normalizePressure(eventItem.pressure) : customPressure\r\n                });\r\n\r\n                pointerObj.lastPageX = eventItem.pageX;\r\n                pointerObj.lastPageY = eventItem.pageY;\r\n            }\r\n\r\n            pointerObj.lastPageX = correctedObj.pageX;\r\n            pointerObj.lastPageY = correctedObj.pageY;\r\n            correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\r\n            correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\r\n\r\n            return correctedObj;\r\n\r\n        }\r\n\r\n        /**\r\n         * creates a value for onPointer, from a pointer event handler\r\n         *\r\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\r\n         * @param correctedEvent - corrected pointer event from correctPointerEvent()\r\n         * @param custom - object for setting custom attributes\r\n         * @returns {{pointerId: number, pointerType: *, dX: (*), relY: number, dY: (*), relX: number, type: *, event: *, pageY: *, pageX: *}}\r\n         */\r\n        function createPointerOutEvent(typeStr, correctedEvent, custom?) {\r\n\r\n            const bounds = targetElement.getBoundingClientRect();\r\n            const result: any = {\r\n                type: typeStr,\r\n                pointerId: correctedEvent.pointerId,\r\n                pointerType: correctedEvent.pointerType,\r\n                pageX: correctedEvent.pageX,\r\n                pageY: correctedEvent.pageY,\r\n                clientX: correctedEvent.clientX,\r\n                clientY: correctedEvent.clientY,\r\n                relX: correctedEvent.clientX - bounds.left + targetElement.scrollLeft,\r\n                relY: correctedEvent.clientY - bounds.top + targetElement.scrollTop,\r\n                dX: correctedEvent.movementX,\r\n                dY: correctedEvent.movementY,\r\n                time: correctedEvent.timeStamp,\r\n                eventPreventDefault: correctedEvent.eventPreventDefault,\r\n                eventStopPropagation: correctedEvent.eventStopPropagation\r\n            };\r\n\r\n            if (typeStr === 'pointermove') {\r\n                result.coalescedArr = [];\r\n                if (correctedEvent.coalescedArr.length > 1) {\r\n                    let coalescedItem;\r\n                    for (let i = 0; i < correctedEvent.coalescedArr.length; i++) {\r\n                        coalescedItem = correctedEvent.coalescedArr[i];\r\n                        result.coalescedArr.push({\r\n                            pageX: coalescedItem.pageX,\r\n                            pageY: coalescedItem.pageY,\r\n                            clientX: coalescedItem.clientX,\r\n                            clientY: coalescedItem.clientY,\r\n                            relX: coalescedItem.clientX - bounds.left + targetElement.scrollLeft,\r\n                            relY: coalescedItem.clientY - bounds.top + targetElement.scrollTop,\r\n                            dX: coalescedItem.movementX,\r\n                            dY: coalescedItem.movementY,\r\n                            time: coalescedItem.timeStamp\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (custom) {\r\n                const keyArr = Object.keys(custom);\r\n                for (let i = 0; i < keyArr.length; i++) {\r\n                    result[keyArr[i]] = custom[keyArr[i]];\r\n                }\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        /**\r\n         * creates a value for onPointer, from a fallback touch event handler\r\n         *\r\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\r\n         * @param touchListItem - element from changed touch list\r\n         * @param touchEvent - touch event\r\n         * @param custom - object for setting custom attributes\r\n         * @returns {{pointerId: number, pointerType: string, relY: number, relX: number, type: *, event: *, pageY: *, pageX: *}}\r\n         */\r\n        function createTouchOutEvent(typeStr, touchListItem, touchEvent, custom) {\r\n            const bounds = targetElement.getBoundingClientRect();\r\n            const result: any = {\r\n                type: typeStr,\r\n                pointerId: touchListItem.identifier,\r\n                pointerType: 'touch',\r\n                pageX: touchListItem.pageX,\r\n                pageY: touchListItem.pageY,\r\n                clientX: touchListItem.clientX,\r\n                clientY: touchListItem.clientY,\r\n                relX: touchListItem.pageX - bounds.left + targetElement.scrollLeft,\r\n                relY: touchListItem.pageY - bounds.top + targetElement.scrollTop,\r\n                time: touchEvent.timeStamp + timeStampOffset,\r\n                eventPreventDefault: function() { touchEvent.preventDefault(); },\r\n                eventStopPropagation: function() { touchEvent.stopPropagation(); }\r\n            };\r\n\r\n            if (typeStr === 'pointermove') {\r\n                result.coalescedArr = [];\r\n            }\r\n\r\n            const keyArr = Object.keys(custom);\r\n            for (let i = 0; i < keyArr.length; i++) {\r\n                result[keyArr[i]] = custom[keyArr[i]];\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        function setupDocumentListeners() {\r\n            addEventListener(document, 'pointermove', onGlobalPointerMove);\r\n            addEventListener(document, 'pointerup', onGlobalPointerUp);\r\n            addEventListener(document, 'pointerleave', onGlobalPointerLeave);\r\n        }\r\n\r\n        function destroyDocumentListeners() {\r\n            removeEventListener(document, 'pointermove', onGlobalPointerMove);\r\n            removeEventListener(document, 'pointerup', onGlobalPointerUp);\r\n            removeEventListener(document, 'pointerleave', onGlobalPointerLeave);\r\n        }\r\n\r\n        let isOverCounter = 0; // might be multiple pointers\r\n        function onPointerEnter() {\r\n            isOverCounter++;\r\n            if (onEnterLeaveCallback) {\r\n                onEnterLeaveCallback(true);\r\n            }\r\n        }\r\n\r\n        function onPointerLeave() {\r\n            isOverCounter--;\r\n            if (onEnterLeaveCallback) {\r\n                onEnterLeaveCallback(false);\r\n            }\r\n        }\r\n\r\n        function onPointermove(event) {\r\n            event = correctPointerEvent(event);\r\n\r\n            const tempLastPointerType = lastPointerType;\r\n            lastPointerType = event.pointerType;\r\n\r\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || event.pointerType === 'touch') {\r\n                didSkip = false;\r\n                return;\r\n            }\r\n\r\n            // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\r\n            if (!didSkip && event.pointerType === 'mouse' && tempLastPointerType === 'pen') {\r\n                didSkip = true;\r\n                return;\r\n            }\r\n            didSkip = false;\r\n\r\n            const outEvent = createPointerOutEvent('pointermove', event);\r\n            onPointerCallback(outEvent);\r\n\r\n        }\r\n\r\n        function onPointerdown(event) {\r\n            //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' pointerdown');\r\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || !([1, 2, 4].includes(event.buttons))) {\r\n                //BB.throwOut('pointerdown ignored');\r\n                return;\r\n            }\r\n\r\n\r\n            //set up global listeners\r\n            if (dragObjArr.length === 0) {\r\n                setupDocumentListeners();\r\n            }\r\n            const dragObj = {\r\n                pointerId: event.pointerId,\r\n                pointerType: event.pointerType,\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY,\r\n                buttons: event.buttons,\r\n                lastPageX: event.pageX,\r\n                lastPageY: event.pageY,\r\n                lastTimeStamp: event.timeStamp\r\n            };\r\n            dragObjArr.push(dragObj);\r\n            setTouchTimeout(dragObj);\r\n            dragPointerIdArr.push(event.pointerId);\r\n\r\n            const outEvent = createPointerOutEvent('pointerdown', event, {\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY,\r\n                button: buttonsToStr[event.buttons],\r\n                pressure: event.pressure\r\n            });\r\n\r\n            onPointerCallback(outEvent);\r\n        }\r\n\r\n\r\n        function onGlobalPointerMove(event) {\r\n            //BB.throwOut('pointermove ' + event.pointerId);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\r\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\r\n                return;\r\n            }\r\n\r\n            const dragObj = getDragObj(event.pointerId);\r\n            clearTouchTimeout(dragObj);\r\n\r\n            //if pointer changes button its pressing -> turn into pointerup\r\n            if (event.buttons !== dragObj.buttons) {\r\n                //pointer up\r\n\r\n                //remove listener\r\n                if (dragObjArr.length === 1) {\r\n                    destroyDocumentListeners();\r\n                }\r\n                removeDragObj(event.pointerId);\r\n\r\n                const outEvent = createPointerOutEvent('pointerup', event, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY\r\n                });\r\n                onPointerCallback(outEvent);\r\n                return;\r\n\r\n            }\r\n\r\n            setTouchTimeout(dragObj);\r\n\r\n            // ipad likes to do this\r\n            if (\r\n                event.pointerType === 'pen' &&\r\n                event.pageX === dragObj.lastPageX &&\r\n                event.pageY === dragObj.lastPageY &&\r\n                event.timeStamp === dragObj.lastTimeStamp\r\n            ) {\r\n                //ignore\r\n                return;\r\n            }\r\n\r\n            const outEvent = createPointerOutEvent('pointermove', event, {\r\n                downPageX: dragObj.downPageX,\r\n                downPageY: dragObj.downPageY,\r\n                button: buttonsToStr[event.buttons],\r\n                pressure: event.pressure\r\n            });\r\n\r\n            dragObj.lastPageX = event.pageX;\r\n            dragObj.lastPageY = event.pageY;\r\n            dragObj.lastTimeStamp = event.timeStamp;\r\n\r\n            onPointerCallback(outEvent);\r\n\r\n        }\r\n\r\n        function onGlobalPointerUp(event) {\r\n            //BB.throwOut('pointerup ' + event.pointerId);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\r\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\r\n                return;\r\n            }\r\n\r\n            //remove listener\r\n            if (dragObjArr.length === 1) {\r\n                destroyDocumentListeners();\r\n            }\r\n            const dragObj = removeDragObj(event.pointerId);\r\n            clearTouchTimeout(dragObj);\r\n\r\n            const outEvent = createPointerOutEvent('pointerup', event, {\r\n                downPageX: dragObj.downPageX,\r\n                downPageY: dragObj.downPageY\r\n            });\r\n            onPointerCallback(outEvent);\r\n\r\n        }\r\n\r\n        function onGlobalPointerLeave(event) {\r\n            //BB.throwOut('pointerleave ' + event.pointerId);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\r\n            if (!(dragPointerIdArr.includes(event.pointerId))) { //} || event.target !== document) {\r\n                return;\r\n            }\r\n\r\n            //remove listener\r\n            if (dragObjArr.length === 1) {\r\n                destroyDocumentListeners();\r\n            }\r\n            const dragObj = removeDragObj(event.pointerId);\r\n            clearTouchTimeout(dragObj);\r\n\r\n            const outEvent = createPointerOutEvent('pointerup', event, {\r\n                downPageX: dragObj.downPageX,\r\n                downPageY: dragObj.downPageY\r\n            });\r\n            onPointerCallback(outEvent);\r\n        }\r\n\r\n\r\n        /*\r\n        --- ipad pointer event glitch damage control ---\r\n\r\n        ipad pointer events are glitchy. doesn't always fire pointerup.\r\n        - when two fingers get really close to each other\r\n        - when finger moves out and back in bottom\r\n\r\n        This artificially fires a pointerup\r\n        */\r\n        function onTouchTimeout(dragObj) {\r\n\r\n            //create fake event\r\n            const fakeEvent = {\r\n                pointerId: dragObj.pointerId,\r\n                pointerType: dragObj.pointerType,\r\n                type: 'pointerup',\r\n                timeStamp: performance.now(),\r\n                pageX: 0,\r\n                pageY: 0,\r\n                clientX: 0,\r\n                clientY: 0,\r\n                preventDefault: function () {\r\n                },\r\n                stopPropagation: function () {\r\n                }\r\n            };\r\n\r\n            //call onGlobalPointerUp with it\r\n            onGlobalPointerUp(fakeEvent);\r\n        }\r\n\r\n        function setTouchTimeout(dragObj) {\r\n            if (dragObj.pointerType !== 'touch') {\r\n                return;\r\n            }\r\n            dragObj.touchTimeout = setTimeout(function () {\r\n                onTouchTimeout(dragObj);\r\n            }, 2500); // 2.5 seconds\r\n        }\r\n\r\n        function clearTouchTimeout(dragObj) {\r\n            if (!dragObj.touchTimeout) {\r\n                return;\r\n            }\r\n            clearTimeout(dragObj.touchTimeout);\r\n            dragObj.touchTimeout = null;\r\n        }\r\n\r\n\r\n        if (onEnterLeaveCallback) {\r\n            addEventListener(targetElement, 'pointerenter', onPointerEnter);\r\n            addEventListener(targetElement, 'pointerleave', onPointerLeave);\r\n        }\r\n        if (onPointerCallback) {\r\n            addEventListener(targetElement, 'pointermove', onPointermove);\r\n            addEventListener(targetElement, 'pointerdown', onPointerdown);\r\n        }\r\n        if (onWheelCallback) {\r\n            addEventListener(targetElement, 'wheel', wheelCleaner.process);\r\n        }\r\n\r\n\r\n        let onTouchstart;\r\n        let onTouchmove;\r\n        let onTouchend;\r\n\r\n        // --- touch fallback ---\r\n        if (!(hasPointerEvents)) {\r\n\r\n            onTouchstart = function (event) {\r\n                ////console.log('onTouchstart', event, event.changedTouches.length);\r\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\r\n\r\n                const touchArr = event.changedTouches;\r\n                for (let i = 0; i < touchArr.length && dragObjArr.length < maxPointers; i++) {\r\n                    const touchObj = touchArr[i];\r\n\r\n                    //set up global listeners\r\n                    if (dragObjArr.length === 0) {\r\n                        addEventListener(document, 'touchmove', onTouchmove);\r\n                        addEventListener(document, 'touchend', onTouchend);\r\n                        addEventListener(document, 'touchcancel', onTouchend);\r\n                    }\r\n                    dragObjArr.push({\r\n                        pointerId: touchObj.identifier,\r\n                        downPageX: touchObj.pageX,\r\n                        downPageY: touchObj.pageY,\r\n                        buttons: 1,\r\n                        lastPageX: touchObj.pageX,\r\n                        lastPageY: touchObj.pageY,\r\n                    });\r\n                    dragPointerIdArr.push(touchObj.identifier);\r\n\r\n                    const outEvent = createTouchOutEvent('pointerdown', touchObj, event, {\r\n                        dX: 0,\r\n                        dY: 0,\r\n                        downPageX: touchObj.downPageX,\r\n                        downPageY: touchObj.downPageY,\r\n                        button: 'left',\r\n                        pressure: 1\r\n                    });\r\n                    onPointerCallback(outEvent);\r\n                }\r\n\r\n            }\r\n\r\n            onTouchmove = function (event) {\r\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\r\n\r\n\r\n                const touchArr = event.changedTouches;\r\n                for (let i = 0; i < touchArr.length; i++) {\r\n                    const touchObj = touchArr[i];\r\n\r\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\r\n                        continue;\r\n                    }\r\n                    const dragObj = getDragObj(touchObj.identifier);\r\n\r\n                    const outEvent = createTouchOutEvent('pointermove', touchObj, event, {\r\n                        dX: touchObj.pageX - dragObj.lastPageX,\r\n                        dY: touchObj.pageY - dragObj.lastPageY,\r\n                        downPageX: dragObj.downPageX,\r\n                        downPageY: dragObj.downPageY,\r\n                        button: 'left',\r\n                        isCoalesced: false,\r\n                        pressure: 1\r\n                    });\r\n                    dragObj.lastPageX = touchObj.pageX;\r\n                    dragObj.lastPageY = touchObj.pageY;\r\n                    onPointerCallback(outEvent);\r\n\r\n                }\r\n\r\n            }\r\n\r\n            onTouchend = function (event) {\r\n                if (event.type !== 'touchcancel') {\r\n                    event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\r\n                }\r\n\r\n\r\n                const touchArr = event.changedTouches;\r\n                for (let i = 0; i < touchArr.length; i++) {\r\n                    const touchObj = touchArr[i];\r\n\r\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\r\n                        continue;\r\n                    }\r\n\r\n                    //remove listener\r\n                    if (dragObjArr.length === 1) {\r\n                        removeEventListener(document, 'touchmove', onTouchmove);\r\n                        removeEventListener(document, 'touchend', onTouchend);\r\n                        removeEventListener(document, 'touchcancel', onTouchend);\r\n                    }\r\n                    const dragObj = removeDragObj(touchObj.identifier);\r\n\r\n                    const outEvent = createTouchOutEvent('pointerup', touchObj, event, {\r\n                        dX: touchObj.pageX - dragObj.lastPageX,\r\n                        dY: touchObj.pageY - dragObj.lastPageY,\r\n                        downPageX: dragObj.downPageX,\r\n                        downPageY: dragObj.downPageY,\r\n                    });\r\n\r\n                    onPointerCallback(outEvent);\r\n                }\r\n\r\n            }\r\n\r\n            if (onPointerCallback) {\r\n                addEventListener(targetElement, 'touchstart', onTouchstart);\r\n            }\r\n\r\n        } else if (p.fixScribble) {\r\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\r\n            onTouchmove = function(e) {\r\n                e.preventDefault();\r\n            }\r\n            addEventListener(targetElement, 'touchmove', onTouchmove);\r\n\r\n        }\r\n\r\n\r\n        // --- interface ---\r\n\r\n        this.isOver = function () {\r\n            return isOverCounter > 0;\r\n        };\r\n\r\n        this.destroy = function () {\r\n            if (isDestroyed) {\r\n                return;\r\n            }\r\n            isDestroyed = true;\r\n            removeEventListener(targetElement, 'pointerenter', onPointerEnter);\r\n            removeEventListener(targetElement, 'pointerleave', onPointerLeave);\r\n            removeEventListener(targetElement, 'pointermove', onPointermove);\r\n            removeEventListener(targetElement, 'pointerdown', onPointerdown);\r\n            removeEventListener(targetElement, 'wheel', wheelCleaner.process);\r\n            if (dragObjArr.length > 0) {\r\n                destroyDocumentListeners();\r\n            }\r\n\r\n            if (!(hasPointerEvents)) {\r\n                removeEventListener(targetElement, 'touchstart', onTouchstart);\r\n                if (dragObjArr.length > 0) {\r\n                    removeEventListener(document, 'touchmove', onTouchmove);\r\n                    removeEventListener(document, 'touchend', onTouchend);\r\n                    removeEventListener(document, 'touchcancel', onTouchend);\r\n                }\r\n            } else {\r\n                removeEventListener(targetElement, 'touchmove', onTouchmove);\r\n            }\r\n        };\r\n\r\n    }\r\n})();","import {IBounds, IRect, IVector2D} from '../BB.types';\r\n\r\nexport function mix (a: number, b: number, f: number): number {\r\n    return a * (1 - f) + b * f;\r\n}\r\n\r\nexport function dist (ax: number, ay: number, bx: number, by: number): number {\r\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\r\n}\r\n\r\nexport function distSquared (ax: number, ay: number, bx: number, by: number): number {\r\n    // faster because no square-root\r\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\r\n}\r\n\r\nexport function lenSquared (x: number, y: number): number {\r\n    // faster because no square-root\r\n    return x * x + y * y;\r\n}\r\n\r\nexport function pointsToAngleRad (p1: IVector2D, p2: IVector2D): number {\r\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n}\r\n\r\nexport function pointsToAngleDeg (p1: IVector2D, p2: IVector2D): number {\r\n    return pointsToAngleRad(p1, p2) * 180 / Math.PI;\r\n}\r\n\r\nexport function isInsideRect(p: IVector2D, rect: IRect): boolean {\r\n    return rect.x <= p.x && p.x <= rect.x + rect.width &&\r\n        rect.y <= p.y && p.y <= rect.y + rect.height;\r\n}\r\n\r\nexport function clamp (num: number, min: number, max: number): number {\r\n    return num <= min\r\n        ? min\r\n        : num >= max\r\n            ? max\r\n            : num;\r\n}\r\n\r\nexport function rotate (x: number, y: number, deg: number): IVector2D {\r\n    const theta = deg * (Math.PI / 180);\r\n    const cs = Math.cos(theta);\r\n    const sn = Math.sin(theta);\r\n\r\n    return {\r\n        x: x * cs - y * sn,\r\n        y: x * sn + y * cs\r\n    };\r\n}\r\n\r\nexport function rotateAround (center: IVector2D, point: IVector2D, deg: number): IVector2D {\r\n    const rot = rotate(point.x - center.x, point.y - center.y, deg);\r\n    rot.x += center.x;\r\n    rot.y += center.y;\r\n    return rot;\r\n}\r\n\r\nexport function intDxy(remainder: IVector2D, fDx: number, fDy: number) {\r\n    remainder.x += fDx;\r\n    remainder.y += fDy;\r\n    const dX = Math.round(remainder.x);\r\n    const dY = Math.round(remainder.y);\r\n    remainder.x -= dX;\r\n    remainder.y -= dY;\r\n    return {\r\n        dX,\r\n        dY,\r\n    };\r\n}\r\n\r\n/**\r\n * return closest even number\r\n * @param f\r\n */\r\nexport function roundEven(f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f;\r\n        }\r\n        return f + 1;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 0) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * return closest uneven number\r\n * @param f\r\n */\r\nexport function roundUneven(f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f + 1;\r\n        }\r\n        return f;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 1) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * round number to certain precision.\r\n * round(1.2345, 2) = 1.23\r\n * round(1.2345, 0) = 0\r\n * round(123, -1) = 120\r\n *\r\n * @param f\r\n * @param digits\r\n */\r\nexport function round(f: number, digits: number): number {\r\n    const digitMult = Math.pow(10, digits);\r\n    return Math.round((f/* + Number.EPSILON*/) * digitMult) / digitMult;\r\n}\r\n\r\n/**\r\n * update target so it includes bounds\r\n * @param target\r\n * @param bounds\r\n */\r\nexport function updateBounds (target: IBounds, bounds: IBounds): IBounds {\r\n    if (!bounds) {\r\n        return target;\r\n    }\r\n    if (!target) {\r\n        target = { x1: bounds.x1, y1: bounds.y1, x2: bounds.x2, y2: bounds.y2 };\r\n    } else {\r\n        target.x1 = Math.min(target.x1, bounds.x1);\r\n        target.y1 = Math.min(target.y1, bounds.y1);\r\n        target.x2 = Math.max(target.x2, bounds.x2);\r\n        target.y2 = Math.max(target.y2, bounds.y2);\r\n    }\r\n    return target;\r\n}\r\n\r\n/**\r\n * determine overlap of bounds with width&height\r\n */\r\nexport function boundsInArea (bounds: IBounds, width: number, height: number): IBounds | null {\r\n    let x1 = Math.max(0, bounds.x1);\r\n    let y1 = Math.max(0, bounds.y1);\r\n    let x2 = Math.min(width - 1, bounds.x2);\r\n    let y2 = Math.min(height - 1, bounds.y2);\r\n    if (x1 > x2 || y1 > y2) {\r\n        return null;\r\n    }\r\n    return { x1, y1, x2, y2 };\r\n}","import {clamp, dist, mix, pointsToAngleRad} from '../math/math';\r\n\r\n\r\ntype ChainOutFunc = (event?) => void;\r\n\r\n/**\r\n * for chaining event processing. useful for gestures (double tap, pinch zoom, max pointer filter).\r\n * each element in the chain might hold back the events, swallow them, or transform them\r\n *\r\n * p = {\r\n *     chainArr: ChainElement[]\r\n * }\r\n *\r\n * chainIn(event): null - feed an event into the chain\r\n * setChainOut(func): void - func(event) <- called when passed through chain\r\n * ^ each ChainElement needs these methods too\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const EventChain = function (p) {\r\n\r\n    const chainArr = p.chainArr;\r\n    let chainOut: ChainOutFunc = () => undefined;\r\n\r\n    function continueChain(i, event) {\r\n        for (; i < chainArr.length; i++) {\r\n            event = chainArr[i].chainIn(event);\r\n            if (event === null) {\r\n                return null;\r\n            }\r\n        }\r\n        chainOut(event);\r\n        return null;\r\n    }\r\n\r\n    for (let i = 0; i < chainArr.length; i++) {\r\n        (function (i) {\r\n            chainArr[i].setChainOut(function (event) {\r\n                continueChain(i + 1, event);\r\n            });\r\n        })(i);\r\n    }\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n        return continueChain(0, event);\r\n    };\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Detects double taps.\r\n *\r\n * p = {\r\n *     onDoubleTap: function({pageX: number, pageY: number}) - fires when double tap occurs\r\n * }\r\n *\r\n * chainIn\r\n * setChainOut\r\n * setAllowedPointerTypeArr(string[]): void - which pointer types are allowed\r\n * setAllowedButtonArr(string[]): void - which buttons are allowed\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const DoubleTapper = function (p) {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n    const minSilenceBeforeDurationMs = 400;\r\n    const maxPressedDurationMs = 300;\r\n    const maxPressedDistancePx = 10;\r\n    const maxInbetweenDistancePx = 19;\r\n    const maxUpToUpDurationMs = 500;\r\n    const maxUntilSecondDownDurationMs = 300;\r\n    const minSilenceAfterMs = 250;\r\n\r\n    let allowedPointerTypeArr = ['touch', 'mouse', 'pen'];\r\n    let allowedButtonArr = ['left'];\r\n\r\n    let sequenceArr = [];\r\n    const pointersDownIdArr = [];\r\n    let lastUpTime = 0;\r\n    let nowTime = 0;\r\n\r\n    let eventQueueArr = [];\r\n\r\n\r\n    function fail() {\r\n        if (sequenceArr.length === 0) { // no gesture started -> can be ignored\r\n            return;\r\n        }\r\n        clearTimeout(timeoutObj.fail);\r\n        clearTimeout(timeoutObj.maxUntilSecondDown);\r\n        clearTimeout(timeoutObj.success);\r\n        timeoutObj.fail = null;\r\n        timeoutObj.maxUntilSecondDown = null;\r\n        timeoutObj.success = null;\r\n\r\n\r\n        for (let i = 0; i < eventQueueArr.length; i++) {\r\n            chainOut(eventQueueArr[i]);\r\n        }\r\n        eventQueueArr = [];\r\n\r\n        sequenceArr = [];\r\n    }\r\n\r\n    // double tap achieved\r\n    function success() {\r\n        timeoutObj.fail = null;\r\n        timeoutObj.success = null;\r\n        eventQueueArr = []; // events get swallowed\r\n        const lastSequenceItem = sequenceArr[sequenceArr.length - 1];\r\n        sequenceArr = [];\r\n        p.onDoubleTap({\r\n            pageX: lastSequenceItem.pageX,\r\n            pageY: lastSequenceItem.pageY,\r\n            relX: lastSequenceItem.relX,\r\n            relY: lastSequenceItem.relY,\r\n        });\r\n    }\r\n\r\n\r\n    const timeoutObj = {\r\n        fail: null,\r\n        maxUntilSecondDown: null,\r\n        success: null\r\n    };\r\n\r\n    //returns false if time already up. otherwise sets up timeout\r\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\r\n        const diff = timeMS - nowTime;\r\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\r\n        return true;\r\n    }\r\n\r\n\r\n    /**\r\n     * @param event object - a pointer event from BB.PointerListener\r\n     */\r\n    function processEvent(event) {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\r\n                if (pointersDownIdArr[i] === event.pointerId) {\r\n                    pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!allowedPointerTypeArr.includes(event.pointerType)) { //wrong input type -> fail\r\n            //console.log('wrong input type -> fail');\r\n            fail();\r\n            return;\r\n        }\r\n\r\n        nowTime = performance.now();\r\n        const lastSequenceItem = sequenceArr.length > 0 ? sequenceArr[sequenceArr.length - 1] : null;\r\n        if (event.type === 'pointerup') {\r\n            lastUpTime = event.time;\r\n        }\r\n\r\n        if (event.type === 'pointerdown') {\r\n            if (pointersDownIdArr.length > 1) { // more than one pointer down -> fail\r\n                //console.log('more than one pointer down -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (timeoutObj.success !== null) { // silence-after not achieved -> fail\r\n                //console.log('silence-after not achieved -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (sequenceArr.length === 0 && nowTime - lastUpTime < minSilenceBeforeDurationMs) { // silence before not achieved -> fail\r\n                //console.log('silence before not achieved -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (!allowedButtonArr.includes(event.button)) { // wrong button -> fail\r\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\r\n                fail();\r\n                return;\r\n            }\r\n            if (lastSequenceItem && lastSequenceItem.isDown || sequenceArr.length > 2) { // jumbled -> fail\r\n                //console.log('jumbled -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (lastSequenceItem) {\r\n                const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n                if (distance > maxInbetweenDistancePx) { //moved too much -> reset\r\n                    //console.log('maxInbetweenDistancePx -> reset');\r\n                    fail();\r\n\r\n                    if (nowTime - lastSequenceItem.time < minSilenceBeforeDurationMs) { //silence before not achieved -> fail\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            sequenceArr.push({\r\n                isDown: true,\r\n                time: nowTime,\r\n                position: [event.pageX, event.pageY],\r\n                pointerId: event.pointerId\r\n            });\r\n            //maxUntilSecondDown\r\n\r\n            if (sequenceArr.length > 1) {\r\n                clearTimeout(timeoutObj.maxUntilSecondDown);\r\n            } else if (!setupTimeout('maxUntilSecondDown', fail, event.time + maxUntilSecondDownDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n\r\n            clearTimeout(timeoutObj.fail);\r\n            if (!setupTimeout('fail', fail, event.time + maxPressedDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointermove' && lastSequenceItem.pointerId === event.pointerId) {\r\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                console.log('another pointer mixing in -> fail');\r\n                fail();\r\n                return;\r\n            }*/\r\n            const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n            if (distance > maxPressedDistancePx) { //moved too much -> fail\r\n                //console.log('maxPressedDistancePx -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointerup') {\r\n            if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                fail();\r\n                return;\r\n            }\r\n            if (nowTime >= lastSequenceItem.time + maxPressedDurationMs) { //pressed too long -> fail\r\n                fail();\r\n                return;\r\n            }\r\n            clearTimeout(timeoutObj.fail);\r\n\r\n            if (sequenceArr.length < 3) {\r\n                if (!setupTimeout('fail', fail, event.time + maxUpToUpDurationMs)) {\r\n                    fail();\r\n                    return;\r\n                }\r\n\r\n                sequenceArr = [\r\n                    lastSequenceItem,\r\n                    {\r\n                        isUp: true,\r\n                        time: nowTime,\r\n                        position: [event.pageX, event.pageY]\r\n                    }\r\n                ];\r\n                return;\r\n            }\r\n\r\n            if (nowTime < sequenceArr[1].time + maxUpToUpDurationMs) {\r\n                // double tap almost success\r\n                // only needs silence\r\n                sequenceArr.push({\r\n                    pageX: event.pageX,\r\n                    pageY: event.pageY,\r\n                    relX: event.relX,\r\n                    relY: event.relY,\r\n                });\r\n                if (!setupTimeout('success', success, event.time + minSilenceAfterMs)) {\r\n                    fail();\r\n                }\r\n            } else { // time up -> fail\r\n                fail();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        processEvent(event);\r\n\r\n        if (sequenceArr.length === 0) { //existing events can not become a double tap\r\n            fail();\r\n            return event;\r\n        }\r\n        // events might become a double tap -> queue\r\n        eventQueueArr.push(event);\r\n        return null;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n\r\n    this.setAllowedPointerTypeArr = function (arr) {\r\n        allowedPointerTypeArr = arr;\r\n    };\r\n\r\n    this.setAllowedButtonArr = function (arr) {\r\n        allowedButtonArr = arr;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Detects a single tap, done with N 'touch' pointers\r\n *\r\n * p = {\r\n *      fingers: number - number of fingers\r\n *      onTap: function() - fires when tap occurs\r\n * }\r\n *\r\n * chainIn\r\n * setChainOut\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const NFingerTapper = function (p) {\r\n\r\n    const fingers = p.fingers;\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    const minSilenceBeforeDurationMs = 50; //250;\r\n    const maxTapMs = 500;\r\n    const maxFirstLastFingerDownMs = 250;\r\n    const maxPressedDistancePx = 12; //5 + fingers * 5;\r\n    const silenceAfterDurationMs = 250;\r\n\r\n\r\n    /*\r\n        fingerObj = {\r\n            pointerId: number,\r\n            downTime: number,\r\n            downPageX: number,\r\n            downPageY: number,\r\n            isUp: boolean\r\n        }\r\n     */\r\n    let fingerArr = [];\r\n    let firstDownTime;\r\n    let eventQueueArr = [];\r\n    let lastEventTime = 0;\r\n    const pointersDownIdArr = [];\r\n\r\n    function fail() {\r\n        if (eventQueueArr.length === 0) {\r\n            return;\r\n        }\r\n        clearTimeout(timeoutObj.firstLastDownTimeout);\r\n        clearTimeout(timeoutObj.tapTimeout);\r\n        for (let i = 0; i < eventQueueArr.length; i++) {\r\n            chainOut(eventQueueArr[i]);\r\n        }\r\n        eventQueueArr = [];\r\n        fingerArr = [];\r\n    }\r\n\r\n    function success() {\r\n        clearTimeout(timeoutObj.firstLastDownTimeout);\r\n        clearTimeout(timeoutObj.tapTimeout);\r\n        eventQueueArr = []; // events get swallowed\r\n        fingerArr = [];\r\n        p.onTap();\r\n    }\r\n\r\n    let nowTime;\r\n    const timeoutObj = {\r\n        firstLastDownTimeout: null,\r\n        tapTimeout: null\r\n    };\r\n\r\n    function setupTimeout(timeoutStr, timeMS) {\r\n        const diff = timeMS - nowTime;\r\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        timeoutObj[timeoutStr] = setTimeout(fail, diff);\r\n        return true;\r\n    }\r\n\r\n    function processEvent(event) {\r\n\r\n        const tempLastEventTime = lastEventTime;\r\n        lastEventTime = event.time;\r\n\r\n        if (event.type === 'pointerdown') {\r\n            pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\r\n                if (pointersDownIdArr[i] === event.pointerId) {\r\n                    pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (event.pointerType !== 'touch') {\r\n            if (fingerArr.length > 0) { // already in gesture -> fail\r\n                fail();\r\n            }\r\n            return;\r\n        }\r\n\r\n        nowTime = performance.now();\r\n\r\n        if (event.type === 'pointerdown') {\r\n            //console.log('down');\r\n            if (fingerArr.length + 1 !== pointersDownIdArr.length) { // failed before, and some fingers are still down -> fail\r\n                fail();\r\n                return;\r\n            }\r\n            if (fingerArr.length === fingers) { // too many fingers down -> fail\r\n                //console.log(fingers + ': too many fingers down -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (fingerArr.length > 0 && event.time - maxFirstLastFingerDownMs > fingerArr[0].downTime) { // took too long to touch with all fingers -> fail\r\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (fingerArr.length === 0 && event.time - minSilenceBeforeDurationMs < tempLastEventTime) { // not enough silence before -> fail\r\n                //console.log(fingers + ': not enough silence before -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            if (fingerArr.length === 0) {\r\n                firstDownTime = event.time;\r\n\r\n                if (!setupTimeout('firstLastDownTimeout', event.time + maxFirstLastFingerDownMs) || !setupTimeout('tapTimeout', event.time + maxTapMs)) { // timeouts already up -> fail\r\n                    fail();\r\n                    return;\r\n                }\r\n\r\n            }\r\n            fingerArr.push({\r\n                pointerId: event.pointerId,\r\n                downTime: event.time,\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY\r\n            });\r\n            return;\r\n\r\n        }\r\n\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            for (let i = 0; i < fingerArr.length; i++) {\r\n                if (fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) { // finger not part of the tap is on screen -> fail\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\r\n                fail();\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'pointerup') {\r\n\r\n            if (fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            //console.log('up', event.pageX, event.pageY);\r\n            if (fingerArr.length !== fingers) { // not enough fingers -> fail\r\n                //console.log(fingers + ': not enough fingers -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            let i = 0;\r\n            for (; i < fingerArr.length; i++) {\r\n                if (fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) {\r\n                //do nothing\r\n                return;\r\n            }\r\n\r\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\r\n                //console.log(fingerArr);\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            fingerObj.isUp = true;\r\n\r\n            let allAreUp = true;\r\n            for (let i = 0; i < fingerArr.length; i++) {\r\n                if (!fingerArr[i].isUp) {\r\n                    allAreUp = false;\r\n                    break;\r\n                }\r\n            }\r\n            //console.log('fingerArr', fingerArr);\r\n\r\n            if (allAreUp) { // success\r\n                success();\r\n                return true;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        const result = processEvent(event);\r\n\r\n        //console.log(fingerArr.length);\r\n\r\n        if (result === true) {\r\n            //tap success -> event gets swallowed\r\n            return null;\r\n        }\r\n        if (fingerArr.length === 0) {\r\n            return event;\r\n        } else {\r\n            eventQueueArr.push(event);\r\n        }\r\n\r\n        return null;\r\n\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Detects a pinch zooming (2 touch pointers). If one finger lifts, then will use the remaining.\r\n * Further pointers are ignored, but their events get swallowed during the pinching.\r\n * pinching ends when ALL pointers are lifted.\r\n * Events passed through if no pinching.\r\n *\r\n * p = {\r\n *      onPinch: function({type: 'end'} | {\r\n *          type: 'move',\r\n *          relX: number,\r\n *          relY: number,\r\n *          downRelX: number,\r\n *          downRelY: number,\r\n *          angleDeg: number,\r\n *          scale: number\r\n *      }) - fires when pinching occurs\r\n * }\r\n *\r\n * chainIn\r\n * setChainOut\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const PinchZoomer = function (p) {\r\n\r\n    const firstFingerMaxDistancePx = 10;\r\n    const untilSecondFingerDurationMs = 250;\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n    const pointersDownIdArr = [];\r\n    /*\r\n    gestureObj = {\r\n        touchPointerArr: Array of {\r\n            pointerId: number,\r\n            relX: number,\r\n            relY: number,\r\n            downRelX: number, // only for first\r\n            downRelY: number\r\n        },\r\n        otherPointerIdArr: number[],\r\n        isInProgress: boolean\r\n    }\r\n    */\r\n    let gestureObj = null;\r\n    let eventQueueArr = [];\r\n\r\n\r\n    function end() {\r\n        gestureObj = null;\r\n        eventQueueArr = [];\r\n    }\r\n\r\n    function fail(doSwallow?) {\r\n        if (!gestureObj) { // no gesture happening -> ignore\r\n            return;\r\n        }\r\n\r\n        clearTimeout(timeoutObj.secondFingerTimeout);\r\n        if (!doSwallow) {\r\n            for (let i = 0; i < eventQueueArr.length; i++) {\r\n                chainOut(eventQueueArr[i]);\r\n            }\r\n        }\r\n        end();\r\n    }\r\n\r\n\r\n    let nowTime;\r\n    const timeoutObj = {\r\n        secondFingerTimeout: null\r\n    };\r\n\r\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\r\n        const diff = timeMS - nowTime;\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\r\n        return true;\r\n    }\r\n\r\n\r\n    function processEvent(event) {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            pointersDownIdArr.push(event.pointerId);\r\n\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\r\n                if (pointersDownIdArr[i] === event.pointerId) {\r\n                    pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        //pass through scenarios\r\n        if (\r\n            !gestureObj && (\r\n                event.pointerType !== 'touch' || // wrong pointer type\r\n                (event.type === 'pointermove' && pointersDownIdArr.length > 0) || // failed before\r\n                pointersDownIdArr.length > 1 || // failed before\r\n                event.type === 'pointerup' // failed before\r\n            )\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        nowTime = performance.now();\r\n\r\n\r\n        //pointer down\r\n        if (event.type === 'pointerdown') {\r\n\r\n            if (gestureObj) {\r\n                if (event.pointerType === 'touch') { // touch finger down - as nth pointer\r\n\r\n                    gestureObj.touchPointerArr.push({\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY\r\n                    });\r\n\r\n                    if (gestureObj.isInProgress) {\r\n                        continuePinch(gestureObj, {\r\n                            type: 'down',\r\n                            index: gestureObj.touchPointerArr.length - 1\r\n                        });\r\n                    } else {\r\n                        clearTimeout(timeoutObj.secondFingerTimeout);\r\n                        gestureObj.isInProgress = true;\r\n                        beginPinch(gestureObj);\r\n                    }\r\n                    return;\r\n\r\n                } else { // non-touch finger down - as nth pointer\r\n\r\n                    if (gestureObj.isInProgress) {\r\n                        gestureObj.otherPointerIdArr.push(event.pointerId);\r\n                    } else { // second pointer wrong type -> fail\r\n                        fail();\r\n                    }\r\n                    return;\r\n                }\r\n\r\n\r\n            } else {\r\n                // first finger down - can only be touch if no gestureObj\r\n                gestureObj = {\r\n                    touchPointerArr: [{\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY,\r\n                        downRelX: event.relX,\r\n                        downRelY: event.relY\r\n                    }],\r\n                    otherPointerIdArr: [],\r\n                    isInProgress: false\r\n                };\r\n                if (!setupTimeout('secondFingerTimeout', function () {\r\n                    fail();\r\n                }, event.time + untilSecondFingerDurationMs)) { // time ran out -> fail\r\n                    fail();\r\n                    return;\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n\r\n        //pointer move\r\n        if (event.type === 'pointermove' && event.pointerType === 'touch') {\r\n            //gesture object should always exist here\r\n\r\n            let touchPointerObj = null;\r\n            let i = 0;\r\n            for (; i < gestureObj.touchPointerArr.length; i++) {\r\n                if (event.pointerId === gestureObj.touchPointerArr[i].pointerId) {\r\n                    touchPointerObj = gestureObj.touchPointerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n\r\n            //null should not be possible\r\n\r\n            touchPointerObj.relX = event.relX;\r\n            touchPointerObj.relY = event.relY;\r\n\r\n            if (!gestureObj.isInProgress) { // only one finger down & pinching hasn't started\r\n                const distance = dist(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\r\n                if (distance > firstFingerMaxDistancePx) { // moved too much -> fail\r\n                    fail();\r\n                    return;\r\n                }\r\n\r\n            } else {\r\n                if (i < 2) { // only first two touches can affect pinching\r\n                    continuePinch(gestureObj, {\r\n                        type: 'move',\r\n                        index: i\r\n                    });\r\n                }\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n\r\n        //pointer up\r\n        if (event.type === 'pointerup') {\r\n            //gesture object should always exist here\r\n\r\n            if (event.pointerType === 'touch') {\r\n                let i = 0;\r\n                for (; i < gestureObj.touchPointerArr.length; i++) {\r\n                    if (gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\r\n                        gestureObj.touchPointerArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n                if (gestureObj.touchPointerArr.length > 0) {\r\n                    continuePinch(gestureObj, {\r\n                        type: 'up',\r\n                        index: i\r\n                    });\r\n                }\r\n\r\n            } else { // non-touch\r\n                for (let i = 0; i < gestureObj.otherPointerIdArr.length; i++) {\r\n                    if (gestureObj.otherPointerIdArr[i] === event.pointerId) {\r\n                        gestureObj.otherPointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            //all fingers lifted?\r\n            if (gestureObj.touchPointerArr.length === 0 && gestureObj.otherPointerIdArr.length === 0) {\r\n                if (gestureObj.isInProgress) { // lifted last finger -> end of pinching\r\n                    end();\r\n                    endPinch();\r\n                } else { // lifted finger again before pinching started -> fail\r\n                    fail();\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    // --- actual pinch transform logic ---\r\n\r\n    let pincherArr = [];\r\n\r\n    function beginPinch(gestureObj) {\r\n\r\n        for (let i = 0; i < gestureObj.touchPointerArr.length; i++) {\r\n            const pointerObj = gestureObj.touchPointerArr[i];\r\n            pincherArr.push({\r\n                pointerId: pointerObj.pointerId,\r\n                relX: pointerObj.relX,\r\n                relY: pointerObj.relY,\r\n                downRelX: pointerObj.relX,\r\n                downRelY: pointerObj.relY\r\n            });\r\n        }\r\n\r\n        const event: any = {\r\n            type: 'move',\r\n            angleRad: 0,\r\n            scale: 1\r\n        };\r\n\r\n        if (pincherArr.length === 1) {\r\n            event.relX = pincherArr[0].downRelX;\r\n            event.relY = pincherArr[0].downRelY;\r\n        } else {\r\n            event.relX = 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX);\r\n            event.relY = 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY);\r\n        }\r\n        event.downRelX = event.relX;\r\n        event.downRelY = event.relY;\r\n\r\n        p.onPinch(event);\r\n\r\n    }\r\n\r\n    //actionObj = {type: 'down'|'move'|'up', index: number}\r\n    function continuePinch(gestureObj, actionObj) {\r\n\r\n        if (actionObj.index > 1) { // only first two pointers matter\r\n            return;\r\n        }\r\n\r\n        if (actionObj.type === 'move') {\r\n\r\n            let event;\r\n            pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\r\n            pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\r\n\r\n            if (pincherArr.length === 1) {\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: pincherArr[0].downRelX,\r\n                    downRelY: pincherArr[0].downRelY,\r\n                    relX: pincherArr[0].relX,\r\n                    relY: pincherArr[0].relY,\r\n                    angleRad: 0,\r\n                    scale: 1\r\n                };\r\n\r\n            } else {\r\n\r\n                const startDist = dist(pincherArr[0].downRelX, pincherArr[0].downRelY, pincherArr[1].downRelX, pincherArr[1].downRelY);\r\n                const distance = dist(pincherArr[0].relX, pincherArr[0].relY, pincherArr[1].relX, pincherArr[1].relY);\r\n\r\n                const startAngle = pointsToAngleRad({\r\n                    x: pincherArr[0].downRelX,\r\n                    y: pincherArr[0].downRelY\r\n                }, {x: pincherArr[1].downRelX, y: pincherArr[1].downRelY});\r\n                const angle = pointsToAngleRad({\r\n                    x: pincherArr[0].relX,\r\n                    y: pincherArr[0].relY\r\n                }, {x: pincherArr[1].relX, y: pincherArr[1].relY});\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX),\r\n                    downRelY: 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY),\r\n                    relX: 0.5 * (pincherArr[0].relX + pincherArr[1].relX),\r\n                    relY: 0.5 * (pincherArr[0].relY + pincherArr[1].relY),\r\n                    angleRad: angle - startAngle,\r\n                    scale: distance / startDist\r\n                };\r\n\r\n            }\r\n\r\n            p.onPinch(event);\r\n\r\n        } else if (actionObj.type === 'down' || actionObj.type === 'up') {\r\n            endPinch();\r\n            beginPinch(gestureObj);\r\n        }\r\n\r\n    }\r\n\r\n    function endPinch() {\r\n        pincherArr = [];\r\n        p.onPinch({\r\n            type: 'end'\r\n        });\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n        processEvent(event);\r\n        if (gestureObj) {\r\n            if (!gestureObj.isInProgress) { // might still fail -> into queue\r\n                eventQueueArr.push(event);\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n        return null;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Splits up coalesced events into their own pointermove events. Otherwise regular pass through.\r\n *\r\n * @constructor\r\n */\r\nexport const CoalescedExploder = function () {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (event.coalescedArr.length > 0) {\r\n\r\n                let eventCopy = JSON.parse(JSON.stringify(event));\r\n                eventCopy.coalescedArr = [];\r\n                let coalescedItem;\r\n\r\n                for (let i = 0; i < event.coalescedArr.length; i++) {\r\n\r\n                    if (i > 0) {\r\n                        eventCopy = JSON.parse(JSON.stringify(event));\r\n                    }\r\n                    coalescedItem = event.coalescedArr[i];\r\n\r\n                    eventCopy.pageX = coalescedItem.pageX;\r\n                    eventCopy.pageY = coalescedItem.pageY;\r\n                    eventCopy.relX = coalescedItem.relX;\r\n                    eventCopy.relY = coalescedItem.relY;\r\n                    eventCopy.dX = coalescedItem.dX;\r\n                    eventCopy.dY = coalescedItem.dY;\r\n                    eventCopy.time = coalescedItem.time;\r\n                    if (i < event.coalescedArr.length - 1) {\r\n                        eventCopy.isCoalesced = true;\r\n                    }\r\n\r\n                    chainOut(eventCopy);\r\n                }\r\n\r\n            } else {\r\n                return event;\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\nexport const OnePointerLimiter = function (pointers?) {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    let downPointerId = null;\r\n    const ignorePointerIdArr = [];\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        if (ignorePointerIdArr.includes(event.pointerId)) {\r\n            if (event.type === 'pointerup') {\r\n                for (let i = 0; i < ignorePointerIdArr.length; i++) {\r\n                    if (ignorePointerIdArr[i] === event.pointerId) {\r\n                        ignorePointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        if (downPointerId === null) {\r\n            if (event.type === 'pointerdown') {\r\n                downPointerId = event.pointerId;\r\n            }\r\n            return event;\r\n\r\n        } else {\r\n            if (event.pointerId !== downPointerId) {\r\n                if (event.type === 'pointerdown') {\r\n                    ignorePointerIdArr.push(event.pointerId);\r\n                }\r\n                return null;\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                downPointerId = null;\r\n            }\r\n            return event;\r\n        }\r\n\r\n        return null;\r\n\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n\r\n};\r\n\r\n\r\n/**\r\n * Not really and event chain element. but pretty similar.\r\n *\r\n * Processes draw input events. When shift held -> linetool\r\n * line events - what KlCanvasWorkspace passes onDraw(e)\r\n *\r\n * p = {\r\n *     onDraw: function(drawEvent)\r\n * }\r\n *\r\n * pass input in with process(drawEvent)\r\n *\r\n * modifies draw event to include such events:\r\n * {\r\n *     type: 'line',\r\n *     x0: null, // you have to fill that in\r\n *     y0: null, // you have to fill that in\r\n *     pressure0: null, // you have to fill that in\r\n *     x1: number,\r\n *     y1: number,\r\n *     pressure1: number\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const LinetoolProcessor = function (p) {\r\n\r\n    let downEvent = null;\r\n    let eventQueue = [];\r\n    let direction = null;\r\n    const DIR_X = 0, DIR_Y = 1;\r\n\r\n    this.process = function (event) {\r\n        if (event.type === 'down') {\r\n            downEvent = event;\r\n            direction = null;\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                p.onDraw({\r\n                    type: 'line',\r\n                    x0: null,\r\n                    y0: null,\r\n                    pressure0: null,\r\n                    x1: event.x,\r\n                    y1: event.y,\r\n                    pressure1: event.pressure\r\n                });\r\n\r\n                eventQueue.push(event);\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'move') {\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                if (direction === null) {\r\n                    const dX = Math.abs(event.x - downEvent.x);\r\n                    const dY = Math.abs(event.y - downEvent.y);\r\n\r\n                    if (dX > 5 || dY > 5) {\r\n                        direction = dX > dY ? DIR_X : DIR_Y;\r\n\r\n                        for (let i = 0; i < eventQueue.length; i++) {\r\n                            const e = eventQueue[i];\r\n                            if (direction === DIR_X) {\r\n                                e.y = downEvent.y;\r\n                            } else {\r\n                                e.x = downEvent.x;\r\n                            }\r\n                            p.onDraw(JSON.parse(JSON.stringify(e)));\r\n                        }\r\n                        eventQueue = [];\r\n                    }\r\n                }\r\n\r\n                if (direction === null) {\r\n                    eventQueue.push(event);\r\n                    return;\r\n                }\r\n\r\n                if (direction === DIR_X) {\r\n                    event.y = downEvent.y;\r\n                } else {\r\n                    event.x = downEvent.x;\r\n                }\r\n\r\n            } else {\r\n                if (eventQueue.length > 0) {\r\n                    for (let i = 0; i < eventQueue.length; i++) {\r\n                        p.onDraw(JSON.parse(JSON.stringify(eventQueue[i])));\r\n                    }\r\n                    eventQueue = [];\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'up') {\r\n            eventQueue = [];\r\n        }\r\n\r\n        p.onDraw(JSON.parse(JSON.stringify(event)));\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * cleans up DrawEvents. More trustworthy events. EventChain element\r\n *\r\n * that events can only go line this: down -> n x move -> up\r\n * so, sanitizes this: down, down, down. becomes only one down. the other downs are ignored/swallowed\r\n * @constructor\r\n */\r\nexport const LineSanitizer = function () {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    let isDrawing = false;\r\n\r\n    // --- interface ---\r\n    this.chainIn = function (event) {\r\n\r\n        if (event.type === 'down') {\r\n            if (isDrawing) {\r\n                //console.log('line sanitizer - down, but already drawing');\r\n                chainOut({\r\n                    type: 'up',\r\n                    scale: event.scale,\r\n                    shiftIsPressed: event.shiftIsPressed,\r\n                    isCoalesced: false\r\n                });\r\n            } else {\r\n                isDrawing = true;\r\n            }\r\n        }\r\n        if (!isDrawing && (event.type === 'move' || event.type === 'up')) {\r\n            //console.log('line sanitizer - ' + event.type + ' but not drawing');\r\n            return null;\r\n        }\r\n\r\n        if (event.type === 'up' && isDrawing) {\r\n            isDrawing = false;\r\n        }\r\n\r\n        return event;\r\n    };\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n    this.getIsDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * Line smoothing. EventChain element. Smoothing via blending new position with old position.\r\n * for onDraw events from KlCanvasWorkspace.\r\n *\r\n * p = {\r\n *     smoothing: number, // 0-1, 0: no smoothing, 1: 100% smoothing -> would never catch up\r\n * }\r\n *\r\n * smoothing > 0: will fire DrawEvents in interval when no new move events\r\n *\r\n * type: 'line' Events are just passed through.\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const LineSmoothing = function (p) {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n    let smoothing = clamp(p.smoothing, 0, 1);\r\n    let lastMixedInput;\r\n    let interval;\r\n    let timeout;\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n        event = JSON.parse(JSON.stringify(event));\r\n        clearTimeout(timeout);\r\n        clearInterval(interval);\r\n\r\n        if (event.type === 'down') {\r\n            lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure\r\n            };\r\n        }\r\n\r\n        if (event.type === 'move') {\r\n\r\n            const inputX = event.x;\r\n            const inputY = event.y;\r\n            const inputPressure = event.pressure;\r\n\r\n            event.x = mix(event.x, lastMixedInput.x, smoothing);\r\n            event.y = mix(event.y, lastMixedInput.y, smoothing);\r\n            event.pressure = mix(event.pressure, lastMixedInput.pressure, smoothing);\r\n            lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure\r\n            };\r\n\r\n            if (smoothing > 0) {\r\n                timeout = setTimeout(function () {\r\n                    interval = setInterval(function () {\r\n                        event = JSON.parse(JSON.stringify(event));\r\n\r\n                        event.x = mix(inputX, lastMixedInput.x, smoothing);\r\n                        event.y = mix(inputY, lastMixedInput.y, smoothing);\r\n                        event.pressure = mix(inputPressure, lastMixedInput.pressure, smoothing);\r\n                        lastMixedInput = {\r\n                            x: event.x,\r\n                            y: event.y,\r\n                            pressure: event.pressure\r\n                        };\r\n\r\n                        chainOut(event);\r\n                    }, 35);\r\n                }, 80);\r\n            }\r\n\r\n        }\r\n\r\n        return event;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n\r\n    this.setSmoothing = function (s) {\r\n        smoothing = clamp(s, 0, 1);\r\n    };\r\n};\r\n","import {IKeyString, IRect} from '../BB.types';\r\nimport {createCanvas} from './create-canvas';\r\n\r\nexport function copyCanvas(canvas: HTMLCanvasElement): HTMLCanvasElement {\r\n    const resultCanvas = createCanvas(canvas.width, canvas.height);\r\n    const ctx = resultCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.drawImage(canvas, 0, 0);\r\n    return resultCanvas;\r\n}\r\n\r\n/**\r\n * Determine if should disable imageSmoothing for transformation.\r\n * ImageSmoothing can make images blurry even when they're in the original scale and aligned with the pixelgrid.\r\n */\r\nexport function testShouldPixelate(\r\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\r\n    scaleX: number,\r\n    scaleY: number,\r\n): boolean {\r\n    if (\r\n        ![1, -1].includes(scaleX) || ![1, -1].includes(scaleY) ||\r\n        transform.width % 1 !== 0 || transform.height % 1 !== 0 ||\r\n        Math.abs(transform.angleDeg) % 90 !== 0\r\n    ) {\r\n        return false;\r\n    }\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    const width = whSwapped ? transform.height : transform.width;\r\n    const height = whSwapped ? transform.width : transform.height;\r\n    return (\r\n            (Math.abs(width) % 2 === 0 && transform.x % 1 === 0) ||\r\n            (Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5)\r\n        ) &&\r\n        (\r\n            (Math.abs(height) % 2 === 0 && transform.y % 1 === 0) ||\r\n            (Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5)\r\n        );\r\n}\r\n\r\n\r\n/**\r\n * @param destCtx - the canvas that will be drawn on\r\n * @param transformImage - image that will be drawn on canvas\r\n * @param transform - {x, y, width, height, angle} - x and y are center of transformImage\r\n * @param bounds object - optional {x, y, width, height} - crop of transformImage in transformImage image space\r\n * @param pixelated\r\n */\r\nexport function drawTransformedImageWithBounds(\r\n    destCtx: CanvasRenderingContext2D,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\r\n    bounds?: {x: number, y: number, width: number, height: number},\r\n    pixelated?: boolean,\r\n): void {\r\n    if (!bounds) {\r\n        bounds = {\r\n            x: 0,\r\n            y: 0,\r\n            width: transformImage.width,\r\n            height: transformImage.height\r\n        };\r\n    }\r\n\r\n    destCtx.save();\r\n    if (pixelated) {\r\n        destCtx.imageSmoothingEnabled = false;\r\n    } else {\r\n        destCtx.imageSmoothingEnabled = true;\r\n        destCtx.imageSmoothingQuality = 'high';\r\n    }\r\n\r\n    destCtx.translate(transform.x, transform.y);\r\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\r\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\r\n    destCtx.drawImage(\r\n        transformImage,\r\n        bounds.x, bounds.y, bounds.width, bounds.height,\r\n        -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\r\n\r\n    destCtx.restore();\r\n}\r\n\r\n/**\r\n * all transformations are optional\r\n * center is the point around which will be scaled and rotated\r\n *\r\n * @param baseCanvas canvas - the canvas that will be drawn on\r\n * @param transformImage image|canvas - image that will be drawn on canvas\r\n * @param transformObj {center: {x, y}, scale: {x, y}, translate: {x, y}, angleDegree}\r\n */\r\nexport function drawTransformedImageOnCanvas(\r\n    baseCanvas: HTMLCanvasElement,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transformObj: {\r\n        center: {x: number, y: number},\r\n        scale: {x: number, y: number},\r\n        translate: {x: number, y: number},\r\n        angleDegree: number,\r\n    },\r\n): void {\r\n    transformObj = JSON.parse(JSON.stringify(transformObj));\r\n    if (!transformObj.center) {\r\n        transformObj.center = {\r\n            x: transformImage.width / 2,\r\n            y: transformImage.height / 2\r\n        }\r\n    }\r\n    if (!transformObj.scale) {\r\n        transformObj.scale = {\r\n            x: 1,\r\n            y: 1\r\n        };\r\n    }\r\n    if (!transformObj.angleDegree) {\r\n        transformObj.angleDegree = 0;\r\n    }\r\n    if (!transformObj.translate) {\r\n        transformObj.translate = {\r\n            x: 0,\r\n            y: 0\r\n        };\r\n    }\r\n\r\n    const ctx = baseCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.save();\r\n    if (\r\n        Math.abs(transformObj.scale.x - 1) >  0.000001 ||\r\n        Math.abs(transformObj.scale.y - 1) > 0.000001 ||\r\n        Math.abs(transformObj.angleDegree % 90) > 0.000001\r\n    ) {\r\n        ctx.imageSmoothingEnabled = true;\r\n        ctx.imageSmoothingQuality = 'high';\r\n    } else {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n\r\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\r\n    ctx.translate(transformObj.center.x, transformObj.center.y);\r\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\r\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\r\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\r\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\r\n\r\n    ctx.restore();\r\n}\r\n\r\nexport const createCheckerCanvas = function(size: number): HTMLCanvasElement {\r\n    const canvas = createCanvas();\r\n    let ctx;\r\n    if (size < 1) {\r\n        canvas.width = 1;\r\n        canvas.height = 1;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = 'rgb(128, 128, 128)';\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    } else if (size > 200) {\r\n        canvas.width = 401;\r\n        canvas.height = 401;\r\n    } else {\r\n        canvas.width = size * 2;\r\n        canvas.height = size * 2;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = 'rgb(255, 255, 255)';\r\n        ctx.fillRect(0, 0, size * 2, size * 2);\r\n        ctx.fillStyle = 'rgb(200, 200, 200)';\r\n        ctx.fillRect(0, 0, size, size);\r\n        ctx.fillRect(size, size, size * 2, size * 2);\r\n    }\r\n    return canvas;\r\n};\r\n\r\nexport const createCheckerDataUrl = (function () {\r\n    const cache: IKeyString = { // previously created dataUrls\r\n        '8': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC',\r\n        '4': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC'\r\n    };\r\n\r\n    return function (size: number, callback?: (s: string) => void) {\r\n        function create(size: number): string {\r\n            size = parseInt('' + size);\r\n            if (cache['' + size]) {\r\n                return cache['' + size];\r\n            }\r\n            const canvas = createCheckerCanvas(size);\r\n            const result = canvas.toDataURL('image/png');\r\n            cache['' + size] = result;\r\n            return result;\r\n        }\r\n\r\n        if (callback) { //async\r\n            setTimeout(function () {\r\n                callback(create(size));\r\n            }, 1);\r\n        } else { //sync\r\n            return create(size);\r\n        }\r\n    };\r\n})();\r\n\r\n/**\r\n * smooth resize image\r\n * @param canvas canvas - will be resized (modified)\r\n * @param w\r\n * @param h\r\n * @param tmp1 canvas - optional, provide to save resources\r\n * @param tmp2 canvas - optional, provide to save resources\r\n */\r\nexport function resizeCanvas(\r\n    canvas: HTMLCanvasElement,\r\n    w: number,\r\n    h: number,\r\n    tmp1?: HTMLCanvasElement,\r\n    tmp2?: HTMLCanvasElement,\r\n): void {\r\n\r\n    //determine base 2 exponents of old and new size\r\n    function getBase2Obj(oldW: number, oldH: number, newW: number, newH: number) {\r\n        const result = {\r\n            oldWidthEx: Math.round(Math.log2(oldW)),\r\n            oldHeightEx: Math.round(Math.log2(oldH)),\r\n            newWidthEx: Math.ceil(Math.log2(newW)),\r\n            newHeightEx: Math.ceil(Math.log2(newH))\r\n        };\r\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\r\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\r\n        return result;\r\n    }\r\n\r\n    if (!w || !h || (w === canvas.width && h === canvas.height)) {\r\n        return;\r\n    }\r\n    w = Math.max(w, 1);\r\n    h = Math.max(h, 1);\r\n    if (w <= canvas.width && h <= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp2 = !tmp2 ? createCanvas() : tmp2;\r\n\r\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\r\n\r\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\r\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\r\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\r\n        tmp1.getContext('2d')!.save();\r\n        tmp2.getContext('2d')!.save();\r\n\r\n        let ew, eh;\r\n        let buffer1 = tmp1, buffer2 = tmp2;\r\n\r\n        ew = base2.oldWidthEx;\r\n        eh = base2.oldHeightEx;\r\n\r\n        let bufferCtx = buffer2.getContext('2d')!;\r\n        bufferCtx.imageSmoothingEnabled = true;\r\n        bufferCtx.imageSmoothingQuality  = 'high';\r\n        bufferCtx.globalCompositeOperation  = 'copy';\r\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\r\n\r\n        let currentWidth = buffer2.width;\r\n        let currentHeight = buffer2.height;\r\n\r\n        //stepwise half the size\r\n        for (; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--) {\r\n            bufferCtx = buffer1.getContext('2d')!;\r\n            bufferCtx.imageSmoothingEnabled = true;\r\n            bufferCtx.imageSmoothingQuality  = 'high';\r\n            bufferCtx.globalCompositeOperation  = 'copy';\r\n\r\n            const newWidth = (ew > base2.newWidthEx) ? currentWidth / 2 : currentWidth;\r\n            const newHeight = (eh > base2.newHeightEx) ? currentHeight / 2 : currentHeight;\r\n\r\n            //buffer also needs to be properly sized, unfortunately\r\n            buffer1.width = newWidth;\r\n            buffer1.height = newHeight;\r\n\r\n            bufferCtx.drawImage(\r\n                buffer2,\r\n                0, 0,\r\n                currentWidth, currentHeight,\r\n                0, 0,\r\n                newWidth, newHeight\r\n            );\r\n            currentWidth = newWidth;\r\n            currentHeight = newHeight;\r\n\r\n            //swap\r\n            const tmp = buffer1;\r\n            buffer1 = buffer2;\r\n            buffer2 = tmp;\r\n        }\r\n\r\n        //when no longer can be halved, bring to target size\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        const canvasCtx = canvas.getContext('2d')!;\r\n        canvasCtx.save();\r\n        canvasCtx.imageSmoothingEnabled = true;\r\n        canvasCtx.imageSmoothingQuality  = 'high';\r\n        canvasCtx.drawImage(\r\n            buffer2,\r\n            0, 0,\r\n            currentWidth, currentHeight,\r\n            0, 0,\r\n            w, h\r\n        );\r\n        canvasCtx.restore();\r\n        tmp1.getContext('2d')!.restore();\r\n        tmp2.getContext('2d')!.restore();\r\n\r\n    } else if (w >= canvas.width && h >= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp1.width = w;\r\n        tmp1.height = h;\r\n        const tmp1Ctx = tmp1.getContext('2d')!;\r\n        tmp1Ctx.save();\r\n        tmp1Ctx.imageSmoothingEnabled = true;\r\n        tmp1Ctx.imageSmoothingQuality  = 'high';\r\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\r\n        tmp1Ctx.restore();\r\n\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        canvas.getContext('2d')!.drawImage(tmp1, 0, 0);\r\n\r\n    } else {\r\n        resizeCanvas(canvas, w, canvas.height, tmp1, tmp2);\r\n        resizeCanvas(canvas, w, h, tmp1, tmp2);\r\n    }\r\n}\r\n\r\n/**\r\n * puts naive greyscale version of image into alpha channel.\r\n * only writes a, doesn't write rgb\r\n * @param canvas\r\n */\r\nexport function convertToAlphaChannelCanvas(canvas: HTMLCanvasElement): void {\r\n    const imdat = canvas.getContext('2d')!.getImageData(0, 0, canvas.width, canvas.height);\r\n    for (let i = 0; i < imdat.data.length; i += 4) {\r\n        if (imdat.data[i + 3] === 0) {\r\n            continue;\r\n        }\r\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\r\n    }\r\n    canvas.getContext('2d')!.putImageData(imdat, 0, 0);\r\n}\r\n\r\n/**\r\n * Sometimes garbage collection is too slow, and canvases use up too much memory,\r\n * or there is a hard to fix memory leak.\r\n * This function manually makes the canvas use as little memory as possible.\r\n */\r\nexport function freeCanvas(canvas: HTMLCanvasElement): void {\r\n    canvas.width = 1;\r\n    canvas.height = 1;\r\n    const ctx = canvas.getContext('2d');\r\n    ctx && ctx.clearRect(0, 0, 1, 1);\r\n}\r\n\r\n/**\r\n * Determine bounding box that describes all pixels which are not fully transparent.\r\n * Returns null if empty.\r\n *\r\n * @param context\r\n */\r\nexport function canvasBounds(context: CanvasRenderingContext2D): IRect | null {\r\n    let boundsObj: {\r\n        x: number;\r\n        y: number;\r\n        width: number;\r\n        height: number;\r\n    } = { x: 0, y: 0, width: 0, height: 0 };\r\n    {\r\n        let tempBounds: any = {\r\n            x1: null,\r\n            y1: null,\r\n            x2: null,\r\n            y2: null\r\n        };\r\n        let imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\r\n\r\n        if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\r\n            tempBounds.x1 = 0;\r\n            tempBounds.y1 = 0;\r\n            tempBounds.x2 = context.canvas.width - 1;\r\n            tempBounds.y2 = context.canvas.height - 1;\r\n        } else {\r\n            for (let i = 3; i < imdat.data.length; i += 4) {\r\n                if (imdat.data[i] > 0 ) {\r\n                    let x = ((i - 3) / 4) %  context.canvas.width;\r\n                    let y = Math.floor((i - 3) / 4 / context.canvas.width);\r\n                    if (tempBounds.x1 > x || tempBounds.x1 === null) {\r\n                        tempBounds.x1 = x;\r\n                    }\r\n                    if (tempBounds.y1 === null) {\r\n                        tempBounds.y1 = y;\r\n                    }\r\n                    if (tempBounds.x2 < x || tempBounds.x2 === null) {\r\n                        tempBounds.x2 = x;\r\n                    }\r\n                    if (tempBounds.y2 < y || tempBounds.y2 === null) {\r\n                        tempBounds.y2 = y;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (tempBounds.x1 === null || tempBounds.y1 === null) {\r\n            return null;\r\n        }\r\n        boundsObj.x = tempBounds.x1;\r\n        boundsObj.y = tempBounds.y1;\r\n        boundsObj.width = tempBounds.x2 - tempBounds.x1 + 1;\r\n        boundsObj.height = tempBounds.y2 - tempBounds.y1 + 1;\r\n    }\r\n    return boundsObj;\r\n}","export const Matrix = (function () {\r\n\r\n    // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\r\n    // yes not optimized - but it's not used for physics simulations.\r\n\r\n    // const perfTotal = 0;\r\n\r\n    // point  matrix\r\n    function multiplyMatrixAndPoint(matrix, point) {\r\n        const result = [\r\n            (point[0] * matrix[0]) + (point[1] * matrix[4]) + (point[2] * matrix[8]) + (point[3] * matrix[12]), // x\r\n            (point[0] * matrix[1]) + (point[1] * matrix[5]) + (point[2] * matrix[9]) + (point[3] * matrix[13]), // y\r\n            (point[0] * matrix[2]) + (point[1] * matrix[6]) + (point[2] * matrix[10]) + (point[3] * matrix[14]), // z\r\n            (point[0] * matrix[3]) + (point[1] * matrix[7]) + (point[2] * matrix[11]) + (point[3] * matrix[15]) // w\r\n        ];\r\n        return result;\r\n    }\r\n\r\n    //matrixB  matrixA\r\n    function multiplyMatrices(matrixA, matrixB) {\r\n\r\n        // Slice the second matrix up into rows\r\n        const row0 = [matrixB[0], matrixB[1], matrixB[2], matrixB[3]];\r\n        const row1 = [matrixB[4], matrixB[5], matrixB[6], matrixB[7]];\r\n        const row2 = [matrixB[8], matrixB[9], matrixB[10], matrixB[11]];\r\n        const row3 = [matrixB[12], matrixB[13], matrixB[14], matrixB[15]];\r\n\r\n        // Multiply each row by matrixA\r\n        const result0 = multiplyMatrixAndPoint(matrixA, row0);\r\n        const result1 = multiplyMatrixAndPoint(matrixA, row1);\r\n        const result2 = multiplyMatrixAndPoint(matrixA, row2);\r\n        const result3 = multiplyMatrixAndPoint(matrixA, row3);\r\n\r\n        // Turn the result rows back into a single matrix\r\n        return [\r\n            result0[0], result0[1], result0[2], result0[3],\r\n            result1[0], result1[1], result1[2], result1[3],\r\n            result2[0], result2[1], result2[2], result2[3],\r\n            result3[0], result3[1], result3[2], result3[3]\r\n        ];\r\n    }\r\n\r\n    function createTranslationMatrix(x, y) {\r\n        return [\r\n            1, 0, 0, 0,\r\n            0, 1, 0, 0,\r\n            0, 0, 1, 0,\r\n            x, y, 0, 1\r\n        ];\r\n    }\r\n\r\n    function createRotationMatrix(angleRad) {\r\n        //let angleRad = angleDeg / 360 * 2 * Math.PI;\r\n        return [\r\n            Math.cos(-angleRad), -Math.sin(-angleRad), 0, 0,\r\n            Math.sin(-angleRad), Math.cos(-angleRad), 0, 0,\r\n            0, 0, 1, 0,\r\n            0, 0, 0, 1\r\n        ];\r\n    }\r\n\r\n    function createScaleMatrix(f) {\r\n        return [\r\n            f, 0, 0, 0,\r\n            0, f, 0, 0,\r\n            0, 0, 1, 0,\r\n            0, 0, 0, 1\r\n        ];\r\n    }\r\n\r\n    return {\r\n        getIdentity: function () {\r\n            return [\r\n                1, 0, 0, 0,\r\n                0, 1, 0, 0,\r\n                0, 0, 1, 0,\r\n                0, 0, 0, 1\r\n            ];\r\n        },\r\n        multiplyMatrixAndPoint: multiplyMatrixAndPoint,\r\n        multiplyMatrices: multiplyMatrices,\r\n        createTranslationMatrix: createTranslationMatrix,\r\n        createRotationMatrix: createRotationMatrix,\r\n        createScaleMatrix: createScaleMatrix\r\n    };\r\n})();","import {IVector2D} from '../BB.types';\r\n\r\nexport const Vec2 = {\r\n    add: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x + p2.x, y: p1.y + p2.y};\r\n    },\r\n    sub: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x - p2.x, y: p1.y - p2.y};\r\n    },\r\n    nor: function (p: IVector2D): IVector2D {\r\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n        return {x: p.x / len, y: p.y / len};\r\n    },\r\n    len: function (p: IVector2D): number {\r\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n    },\r\n    dist: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Vec2.len(Vec2.sub(p1, p2));\r\n    },\r\n    mul: function (p: IVector2D, s: number): IVector2D {\r\n        return {x: p.x * s, y: p.y * s};\r\n    },\r\n    angle: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n    },\r\n    dot: function(a: IVector2D, b: IVector2D): number {\r\n        const aArr = [a.x, a.y];\r\n        const bArr = [b.x, b.y];\r\n        return aArr.map((x, i) => aArr[i] * bArr[i]).reduce((m, n) => m + n);\r\n    }\r\n};","import {Vec2} from './vec2';\r\nimport {pointsToAngleDeg, clamp, dist, mix} from './math';\r\nimport {IVector2D} from \"../bb.types\";\r\n\r\n/**\r\n * project p onto line\r\n * @param lineStart\r\n * @param lineEnd\r\n * @param p\r\n */\r\nexport const projectPointOnLine = function (lineStart: IVector2D, lineEnd: IVector2D, p: IVector2D): IVector2D {\r\n    let x, y;\r\n    if (lineStart.x === lineEnd.x) {\r\n        x = lineStart.x;\r\n        y = p.y;\r\n\r\n        return {\r\n            x: x,\r\n            y: y\r\n        };\r\n    }\r\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\r\n    const b = lineStart.y - (m * lineStart.x);\r\n\r\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\r\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\r\n\r\n    return {\r\n        x: x,\r\n        y: y\r\n    };\r\n};\r\n\r\n\r\n\r\n/**\r\n * Operations on a line made up of points\r\n *\r\n * getAtDist(dist) - point when traveling *dist* along the line\r\n * getLength - gives you total length of line\r\n *\r\n * @param params object - {points: [{x:float, y:float}, ...]}\r\n * @constructor\r\n */\r\nexport const PointLine = function (params) {\r\n    const segmentArr = [];\r\n    const _this = this;\r\n\r\n    for (let i = 0; i < params.points.length; i++) {\r\n        (function (i) {\r\n            let length = undefined;\r\n            if (i < params.points.length - 1) {\r\n                length = dist(params.points[i].x, params.points[i].y, params.points[i + 1].x, params.points[i + 1].y);\r\n            }\r\n            segmentArr[i] = {\r\n                x: params.points[i].x,\r\n                y: params.points[i].y,\r\n                length: length\r\n            };\r\n        })(i);\r\n    }\r\n\r\n    /**\r\n     * @param dist number - distance in pixels, > 0\r\n     * @returns {{x: number, y: number}}\r\n     */\r\n    this.getAtDist = function (dist) {\r\n        let remainder = Math.min(_this.getLength(), dist);\r\n        let i = 0;\r\n\r\n        for (; remainder > segmentArr[i].length && i < segmentArr.length - 2; i++) {\r\n            remainder -= segmentArr[i].length;\r\n        }\r\n\r\n        const fac = Math.min(1, Math.max(0, remainder / segmentArr[i].length));\r\n\r\n        return {\r\n            x: (segmentArr[i].x * (1 - fac) + segmentArr[i + 1].x * fac),\r\n            y: (segmentArr[i].y * (1 - fac) + segmentArr[i + 1].y * fac)\r\n        };\r\n    };\r\n    this.getLength = function () {\r\n        let result = 0;\r\n        for (let i = 0; i < segmentArr.length - 1; i++) {\r\n            result += segmentArr[i].length;\r\n        }\r\n        return result;\r\n    };\r\n};\r\n\r\n/**\r\n * Each instance is one line made up of bezier interpolated segments.\r\n * You feed it points. It calculates control points on its own, and the resulting curve.\r\n *\r\n * @constructor\r\n */\r\nexport const BezierLine = function () {\r\n    const _this = this;\r\n    const pointArr = [];\r\n    let lastDot = 0;\r\n    let lastPoint;\r\n    let lastCallbackPoint;\r\n    let lastAngle;\r\n    let lastSpacing = null;\r\n\r\n    /**\r\n     * creates bezier curve from control points\r\n     *\r\n     * @param p1 - control point 1 {x: float, y: float}\r\n     * @param p2 - control point 2 {x: float, y: float}\r\n     * @param p3 - control point 3 {x: float, y: float}\r\n     * @param p4 - control point 4 {x: float, y: float}\r\n     * @param resolution - int\r\n     * @returns {Array} - bezier curve made up of points {x: float, y: float}\r\n     */\r\n    function getBezierPoints(p1, p2, p3, p4, resolution) {\r\n        const curvePoints = [];\r\n        let t, result;\r\n        for (let i = 0; i <= resolution; i++) {\r\n            t = i / resolution;\r\n            result = {};\r\n            result.x = Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x;\r\n            result.y = Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y;\r\n            curvePoints[curvePoints.length] = result;\r\n        }\r\n        return curvePoints;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * add now point to line\r\n     * line will go until the previous point\r\n     *\r\n     * @param x - coord of new point\r\n     * @param y - coord of new point\r\n     * @param spacing - space between each step\r\n     * @param callback - calls for each step - x, y, t - t is 0-1 how far along\r\n     * @param controlsCallback - calls that callback with the bezier control points p1, p2, p3, p4 - each {x: float, y: float}\r\n     */\r\n    this.add = function (x, y, spacing, callback, controlsCallback) {\r\n        if (lastPoint && x === lastPoint.x && y === lastPoint.y) {\r\n            return;\r\n        }\r\n        lastPoint = {x: x, y: y};\r\n        pointArr[pointArr.length] = {\r\n            x: x,\r\n            y: y,\r\n            spacing: spacing\r\n        };\r\n\r\n        //calculate directions\r\n        if (pointArr.length === 1) {\r\n            lastSpacing = spacing;\r\n            return;\r\n        } else if (pointArr.length === 2) {\r\n            pointArr[0].dir = Vec2.nor(Vec2.sub(pointArr[1], pointArr[0]));\r\n            lastDot = spacing;\r\n            lastSpacing = spacing;\r\n            return;\r\n        } else {\r\n            const pointM1 = pointArr[pointArr.length - 1];\r\n            const pointM2 = pointArr[pointArr.length - 2];\r\n            const pointM3 = pointArr[pointArr.length - 3];\r\n            pointM2.dir = Vec2.nor(Vec2.sub(pointM1, pointM3));\r\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) {\r\n                //when xy -3 == -1\r\n                pointM2.dir = JSON.parse(JSON.stringify(pointM3.dir));\r\n            }\r\n        }\r\n\r\n        //get bezier curve\r\n        const a = pointArr[pointArr.length - 3];\r\n        const b = pointArr[pointArr.length - 2];\r\n        const p1 = a;\r\n        const p2 = Vec2.add(a, Vec2.mul(a.dir, Vec2.dist(a, b) / 4));\r\n        const p3 = Vec2.sub(b, Vec2.mul(b.dir, Vec2.dist(a, b) / 4));\r\n        const p4 = b;\r\n\r\n\r\n        let pointLine;\r\n        if (callback) {\r\n            let curvePoints;\r\n            curvePoints = getBezierPoints(p1, p2, p3, p4, 20);\r\n            pointLine = new PointLine({points: curvePoints});\r\n        } else {\r\n            pointLine = new PointLine({points: [p1, p4]});\r\n        }\r\n\r\n        //interate over curve with spacing and callback\r\n        const len = pointLine.getLength();\r\n        let tempSpacing = mix(lastSpacing, spacing, clamp(lastDot / len, 0, 1));\r\n        let d = lastDot;\r\n        for (; d <= len; d += tempSpacing) {\r\n            tempSpacing = mix(lastSpacing, spacing, clamp(d / len, 0, 1));\r\n            const point = pointLine.getAtDist(d);\r\n            const angle = lastCallbackPoint ? pointsToAngleDeg(lastCallbackPoint, point) : undefined;\r\n            if (callback) {\r\n                callback({\r\n                    x: point.x,\r\n                    y: point.y,\r\n                    t: d / len,\r\n                    angle: angle,\r\n                    dAngle: lastCallbackPoint ? angle - lastAngle : 0\r\n                });\r\n            }\r\n            lastCallbackPoint = point;\r\n            lastAngle = angle;\r\n        }\r\n\r\n        if (callback) {\r\n            lastDot = d - len;\r\n        } else {\r\n            lastDot = 0;\r\n            controlsCallback({p1: p1, p2: p2, p3: p3, p4: p4});\r\n        }\r\n\r\n        lastSpacing = spacing;\r\n    };\r\n\r\n    this.addFinal = function(spacing, callback, controlsCallback) {\r\n        if (pointArr.length < 2) {\r\n            return;\r\n        }\r\n\r\n        const p1 = pointArr[pointArr.length - 2];\r\n        const p2 = pointArr[pointArr.length - 1];\r\n\r\n        const newP = Vec2.add(p2, Vec2.sub(p2, p1));\r\n\r\n        _this.add(newP.x, newP.y, spacing, callback, controlsCallback);\r\n    };\r\n\r\n};\r\n\r\n/**\r\n * from glfx.script by evanW:\r\n * from SplineInterpolator.cs in the Paint.NET source code\r\n *\r\n * points go 0 - 1. I think.\r\n *\r\n * @param points\r\n * @constructor\r\n */\r\nexport const SplineInterpolator = function (points) {\r\n    const n = points.length;\r\n    this.xa = [];\r\n    this.ya = [];\r\n    this.u = [];\r\n    this.y2 = [];\r\n    let i;\r\n\r\n    const first = points[0][0];\r\n    const last = points[points.length - 1][0];\r\n\r\n    points.sort(function (a, b) {\r\n        return a[0] - b[0];\r\n    });\r\n    for (i = 0; i < n; i++) {\r\n        this.xa.push(points[i][0]);\r\n        this.ya.push(points[i][1]);\r\n    }\r\n\r\n    this.u[0] = 0;\r\n    this.y2[0] = 0;\r\n\r\n    for (i = 1; i < n - 1; ++i) {\r\n        // This is the decomposition loop of the tridiagonal algorithm.\r\n        // y2 and u are used for temporary storage of the decomposed factors.\r\n        const wx = this.xa[i + 1] - this.xa[i - 1];\r\n        const sig = (this.xa[i] - this.xa[i - 1]) / wx;\r\n        const p = sig * this.y2[i - 1] + 2.0;\r\n\r\n        this.y2[i] = (sig - 1.0) / p;\r\n\r\n        const ddydx =\r\n            (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\r\n            (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\r\n\r\n        this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\r\n    }\r\n\r\n    this.y2[n - 1] = 0;\r\n\r\n    // This is the backsubstitution loop of the tridiagonal algorithm\r\n    for (i = n - 2; i >= 0; --i) {\r\n        this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\r\n    }\r\n\r\n    this.getFirstX = function () {\r\n        return first;\r\n    };\r\n    this.getLastX = function () {\r\n        return last;\r\n    };\r\n};\r\n\r\nSplineInterpolator.prototype.interpolate = function (x) {\r\n    const n = this.ya.length;\r\n    let klo = 0;\r\n    let khi = n - 1;\r\n\r\n    // We will find the right place in the table by means of\r\n    // bisection. This is optimal if sequential calls to this\r\n    // routine are at random values of x. If sequential calls\r\n    // are in order, and closely spaced, one would do better\r\n    // to store previous values of klo and khi.\r\n    while (khi - klo > 1) {\r\n        const k = (khi + klo) >> 1;\r\n\r\n        if (this.xa[k] > x) {\r\n            khi = k;\r\n        } else {\r\n            klo = k;\r\n        }\r\n    }\r\n\r\n    const h = this.xa[khi] - this.xa[klo];\r\n    const a = (this.xa[khi] - x) / h;\r\n    const b = (x - this.xa[klo]) / h;\r\n\r\n    // Cubic spline polynomial is now evaluated.\r\n    return a * this.ya[klo] + b * this.ya[khi] +\r\n        ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\r\n};\r\n\r\n/**\r\n * find x to y. simply by stepping through. suboptimal, so don't call often.\r\n * searches in x 0-1 range\r\n *\r\n * @param y\r\n * @param resolution\r\n */\r\nSplineInterpolator.prototype.findX = function (y, resolution) {\r\n    let x = null;\r\n    let dist = null;\r\n    for (let i = 0; i <= resolution; i++) {\r\n        const tempX = i / resolution;\r\n        const tempY = this.interpolate(tempX);\r\n        if (x === null) {\r\n            x = tempX;\r\n            dist = Math.abs(tempY - y);\r\n            continue;\r\n        }\r\n\r\n        const tempDist = Math.abs(tempY - y);\r\n\r\n        if (tempDist < dist) {\r\n            x = tempX;\r\n            dist = tempDist;\r\n        } else {\r\n            //distance increasing\r\n            break;\r\n        }\r\n    }\r\n    return x;\r\n};\r\n\r\n/**\r\n * input for a spline, following curve of quadratic function x^2 [0 - 1]\r\n * returns [[0, startVal], ..., [1, endVal]]\r\n * @param startVal\r\n * @param endVal\r\n * @param stepSize\r\n * @returns {[]}\r\n */\r\nexport const quadraticSplineInput = function (startVal, endVal, stepSize) {\r\n    function round(v, dec) {\r\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\r\n    }\r\n\r\n    const resultArr = [];\r\n    for (let i = 0; i <= 1; i += stepSize) {\r\n        resultArr.push([round(i, 4), round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)]);\r\n    }\r\n    return resultArr;\r\n};","\r\n\r\n\r\n// based on js color conversion http://www.webtoolkit.info/\r\n\r\n\r\nexport class HSV {\r\n    h: number;\r\n    s: number;\r\n    v: number;\r\n    constructor(h: number, s: number, v: number) {\r\n        this.h = Math.max(0, Math.min(360, h));\r\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\r\n        this.v = Math.max(0, Math.min(100, v));\r\n    }\r\n}\r\n\r\nexport class RGB {\r\n    r : number;\r\n    g: number;\r\n    b: number;\r\n    constructor(r: number, g: number, b: number) {\r\n        this.r = Math.max(0, Math.min(255, r));\r\n        this.g = Math.max(0, Math.min(255, g));\r\n        this.b = Math.max(0, Math.min(255, b));\r\n    }\r\n}\r\n\r\nexport class CMYK {\r\n    c: number;\r\n    m: number;\r\n    y: number;\r\n    k: number;\r\n    constructor(c: number, m: number, y: number, k: number) {\r\n        this.c = Math.max(0, Math.min(100, c));\r\n        this.m = Math.max(0, Math.min(100, m));\r\n        this.y = Math.max(0, Math.min(100, y));\r\n        this.k = Math.max(0, Math.min(100, k));\r\n    }\r\n}\r\n\r\nexport const ColorConverter = {\r\n\r\n    _RGBtoHSV: function (RGB: RGB): HSV {\r\n        const result = new HSV(0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        const minVal = Math.min(r, g, b);\r\n        const maxVal = Math.max(r, g, b);\r\n        const delta = maxVal - minVal;\r\n\r\n        result.v = maxVal;\r\n\r\n        if (delta == 0) {\r\n            result.h = 0;\r\n            result.s = 0;\r\n        } else {\r\n            result.s = delta / maxVal;\r\n            const del_R = (((maxVal - r) / 6) + (delta / 2)) / delta;\r\n            const del_G = (((maxVal - g) / 6) + (delta / 2)) / delta;\r\n            const del_B = (((maxVal - b) / 6) + (delta / 2)) / delta;\r\n\r\n            if (r == maxVal) {\r\n                result.h = del_B - del_G;\r\n            } else if (g == maxVal) {\r\n                result.h = (1 / 3) + del_R - del_B;\r\n            } else if (b == maxVal) {\r\n                result.h = (2 / 3) + del_G - del_R;\r\n            }\r\n\r\n            if (result.h < 0) {\r\n                result.h += 1;\r\n            }\r\n            if (result.h > 1) {\r\n                result.h -= 1;\r\n            }\r\n        }\r\n\r\n        result.h = Math.round(result.h * 360);\r\n        result.s = Math.round(result.s * 100);\r\n        result.v = Math.round(result.v * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    _HSVtoRGB: function (HSV: HSV): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\r\n\r\n        const h = (HSV.h / 360) % 1;\r\n        const s = HSV.s / 100;\r\n        const v = HSV.v / 100;\r\n\r\n        if (s == 0) {\r\n            result.r = v * 255;\r\n            result.g = v * 255;\r\n            result.b = v * 255;\r\n        } else {\r\n            var_h = h * 6;\r\n            var_i = Math.floor(var_h);\r\n            var_1 = v * (1 - s);\r\n            var_2 = v * (1 - s * (var_h - var_i));\r\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\r\n\r\n            if (var_i == 0) {\r\n                var_r = v;\r\n                var_g = var_3;\r\n                var_b = var_1\r\n            } else if (var_i == 1) {\r\n                var_r = var_2;\r\n                var_g = v;\r\n                var_b = var_1\r\n            } else if (var_i == 2) {\r\n                var_r = var_1;\r\n                var_g = v;\r\n                var_b = var_3\r\n            } else if (var_i == 3) {\r\n                var_r = var_1;\r\n                var_g = var_2;\r\n                var_b = v\r\n            } else if (var_i == 4) {\r\n                var_r = var_3;\r\n                var_g = var_1;\r\n                var_b = v\r\n            } else {\r\n                var_r = v;\r\n                var_g = var_1;\r\n                var_b = var_2\r\n            }\r\n\r\n            result.r = var_r * 255;\r\n            result.g = var_g * 255;\r\n            result.b = var_b * 255;\r\n\r\n            result.r = Math.round(result.r);\r\n            result.g = Math.round(result.g);\r\n            result.b = Math.round(result.b);\r\n        }\r\n\r\n        return result;\r\n    },\r\n\r\n    _CMYKtoRGB: function (CMYK: CMYK): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        const c = CMYK.c / 100;\r\n        const m = CMYK.m / 100;\r\n        const y = CMYK.y / 100;\r\n        const k = CMYK.k / 100;\r\n\r\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\r\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\r\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\r\n\r\n        result.r = Math.round(result.r * 255);\r\n        result.g = Math.round(result.g * 255);\r\n        result.b = Math.round(result.b * 255);\r\n\r\n        return result;\r\n    },\r\n\r\n    _RGBtoCMYK: function (RGB: RGB): CMYK {\r\n        const result = new CMYK(0, 0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\r\n        result.c = (1 - r - result.k) / (1 - result.k);\r\n        result.m = (1 - g - result.k) / (1 - result.k);\r\n        result.y = (1 - b - result.k) / (1 - result.k);\r\n\r\n        result.c = Math.round(result.c * 100);\r\n        result.m = Math.round(result.m * 100);\r\n        result.y = Math.round(result.y * 100);\r\n        result.k = Math.round(result.k * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    toRGB: function (o: RGB | HSV | CMYK): RGB {\r\n        if (o instanceof RGB) {\r\n            return o;\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._HSVtoRGB(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._CMYKtoRGB(o);\r\n        }\r\n    },\r\n\r\n    toHSV: function (o: RGB | HSV | CMYK): HSV {\r\n        if (o instanceof HSV) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoHSV(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._RGBtoHSV(this._CMYKtoRGB(o));\r\n        }\r\n    },\r\n\r\n    toCMYK: function (o: RGB | HSV | CMYK): CMYK {\r\n        if (o instanceof CMYK) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoCMYK(o);\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._RGBtoCMYK(this._HSVtoRGB(o));\r\n        }\r\n    },\r\n    toHexString: function (o: RGB): string {\r\n        if (o instanceof RGB || ('r' in o && 'g' in o && 'b' in o)) {\r\n            let ha = (parseInt('' + o.r)).toString(16);\r\n            let hb = (parseInt('' + o.g)).toString(16);\r\n            let hc = (parseInt('' + o.b)).toString(16);\r\n            if (ha.length == 1)\r\n                ha = '0' + ha;\r\n            if (hb.length == 1)\r\n                hb = '0' + hb;\r\n            if (hc.length == 1)\r\n                hc = '0' + hc;\r\n            return ha + hb + hc;\r\n        }\r\n    },\r\n    toRgbStr: function(rgbObj: {r: number, g: number, b: number}): string {\r\n        return 'rgb(' + Math.round(rgbObj.r) + ', ' + Math.round(rgbObj.g) + ', ' + Math.round(rgbObj.b) + ')';\r\n    },\r\n    toRgbaStr: function(rgbaObj: {r: number, g: number, b: number, a: number}): string {\r\n        return 'rgba(' + Math.round(rgbaObj.r) + ', ' + Math.round(rgbaObj.g) + ', ' + Math.round(rgbaObj.b) + ', ' + rgbaObj.a + ')';\r\n    },\r\n    hexToRGB: function(hexStr: string): RGB | null {\r\n        hexStr = hexStr.trim();\r\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\r\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n        hexStr = hexStr.replace(shorthandRegex, function(m, r, g, b) {\r\n            return r + r + g + g + b + b;\r\n        });\r\n\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\r\n        return result ? new RGB(\r\n            parseInt(result[1], 16),\r\n            parseInt(result[2], 16),\r\n            parseInt(result[3], 16)\r\n        ) : null;\r\n    }\r\n\r\n};\r\n\r\nexport function testIsWhiteBestContrast(rgbObj: {r: number, g: number, b: number}): boolean {\r\n    return (rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114) < 125;\r\n}","import {addEventListener} from '../input/event-listener';\r\nimport {css} from './base';\r\nimport {BB} from '../bb';\r\n\r\n\r\nexport function appendTextDiv(target: HTMLElement, text: string): HTMLDivElement {\r\n    const div = document.createElement('div');\r\n    div.innerHTML = text;\r\n    target.appendChild(div);\r\n    return div;\r\n}\r\n\r\n/**\r\n * Is an input element focused.\r\n * Set attribute \"data-ignore-focus\" to \"true\" if its focus should be ignored.\r\n *\r\n * @param getAll - check all, even those with \"data-ignore-focus\" = \"true\"\r\n */\r\nexport function isInputFocused(getAll: boolean = false): boolean {\r\n    let result = document.activeElement && ['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName);\r\n    if (getAll) {\r\n        return result;\r\n    } else {\r\n        return result && !document.activeElement.getAttribute('data-ignore-focus');\r\n    }\r\n}\r\n\r\nexport function unfocusAnyInput(): void {\r\n    if (isInputFocused(true)) {\r\n        /*\r\n            Unfocus anything that is focused.\r\n\r\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\r\n            that isn't its direct parent, then Firefox will keep anything attached to this\r\n            Input in memory. It will not be garbage collected until a new Input is focused.\r\n\r\n            Workaround: Temporarily create an input, focus it, detach it.\r\n             */\r\n        const focusEl = BB.el({\r\n            parent: document.body,\r\n            tagName: 'input',\r\n            css: {\r\n                opacity: '0',\r\n                width: '0',\r\n                height: '0',\r\n            }\r\n        }) as HTMLInputElement;\r\n        setTimeout(() => {\r\n            focusEl.select();\r\n            focusEl.focus();\r\n            focusEl.parentNode.removeChild(focusEl);\r\n        }, 10);\r\n    }\r\n}\r\n\r\n/**\r\n * clears text selection in window\r\n */\r\nexport function clearSelection(): void {\r\n    if (window.getSelection) {\r\n        const sel = window.getSelection();\r\n        if (sel) {\r\n            if (sel.empty) {\r\n                sel.empty();\r\n            } else if (sel.removeAllRanges) {\r\n                sel.removeAllRanges();\r\n            }\r\n        }\r\n    } else if ('selection' in document) {\r\n        (document as any).selection.empty();\r\n    }\r\n}\r\n\r\n/**\r\n * prevents being able to focus element.\r\n * warning: it creates a listener\r\n *\r\n * @param el - dom element\r\n */\r\nexport const makeUnfocusable = (function() {\r\n\r\n    function preventFocus(event: MouseEvent) {\r\n        event.preventDefault();\r\n        let didFocusRelated = false;\r\n        if (event.relatedTarget) {\r\n            try {\r\n                (event.relatedTarget as HTMLElement).focus();\r\n                didFocusRelated = true;\r\n            } catch(e) {\r\n                console.error('failed to focus');\r\n            }\r\n        }\r\n        if (!didFocusRelated) {\r\n            (event.currentTarget as HTMLElement).blur();\r\n        }\r\n    }\r\n\r\n    return function(el) {\r\n        el.setAttribute('tabindex', '-1');\r\n        addEventListener(el, 'focus', preventFocus);\r\n    };\r\n})();\r\n\r\n\r\nconst els: {\r\n    el: HTMLElement;\r\n    listeners: [string, any][];\r\n}[] = [];\r\n// window['els'] = els;\r\n\r\n/**\r\n *\r\n * Create DOM element - div by default\r\n * params = {\r\n * \t    parent: someOtherDiv,\r\n * \t    css: {\r\n * \t\t    width: \"500px\",\r\n * \t\t    backgroundColor: \"#fff\"\r\n * \t    },\r\n * \t    content: \"test\", //or  content: [divA, divB, divC]   or content: someDiv\r\n * \t    className: \"bla\",\r\n *      id: \"bla\"\r\n * }\r\n *\r\n *  If onClick or onChange is used, then BB.destroyEl MUST be called\r\n *  to prevent a memory leak.\r\n *\r\n * @param params\r\n */\r\nexport function el(\r\n    params: {\r\n        parent?: HTMLElement,\r\n        css?: { [key: string]: string },\r\n        custom?: { [key: string]: any },\r\n        content?: string | (HTMLElement | string | null)[] | HTMLElement | SVGElement,\r\n        textContent?: string,\r\n        className?: string,\r\n        title?: string,\r\n        id?: string,\r\n        tagName?: string,\r\n        onClick?: (e: Event) => void,\r\n        onChange?: (e: Event) => void,\r\n    }\r\n): HTMLElement {\r\n    const div = document.createElement(params.tagName ? params.tagName : 'div');\r\n    if (params.css) {\r\n        css(div, params.css);\r\n    }\r\n\r\n    if (params.content) {\r\n        if (typeof params.content === typeof 'aa') {\r\n            div.innerHTML = params.content as string;\r\n\r\n        } else if (Array.isArray(params.content)) {\r\n            BB.append(div, params.content);\r\n\r\n        } else {\r\n            div.appendChild(params.content as HTMLElement);\r\n\r\n        }\r\n    }\r\n    if (params.textContent) {\r\n        div.textContent = params.textContent;\r\n    }\r\n    if (params.className) {\r\n        div.className = params.className;\r\n    }\r\n    if (params.id) {\r\n        div.id = params.id;\r\n    }\r\n    if (params.parent) {\r\n        params.parent.appendChild(div);\r\n    }\r\n    if ('title' in params && params.title !== undefined) {\r\n        div.title = params.title;\r\n    }\r\n    const listeners = [];\r\n    if ('onClick' in params) {\r\n        addEventListener(div, 'click', params.onClick);\r\n        listeners.push(['click', params.onClick]);\r\n    }\r\n    if ('onChange' in params) {\r\n        addEventListener(div, 'change', params.onChange);\r\n        listeners.push(['change', params.onChange]);\r\n    }\r\n    if (listeners.length > 0) {\r\n        els.push({\r\n            el: div,\r\n            listeners: listeners,\r\n        })\r\n        /*div.style.backgroundColor = '#ff0';\r\n        div.style.border = '1px solid #ff0';*/\r\n    }\r\n    if ('custom' in params) {\r\n        const customKeyArr = Object.keys(params.custom);\r\n        for (let i = 0; i < customKeyArr.length; i++) {\r\n            div.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\r\n        }\r\n    }\r\n    return div;\r\n}\r\n\r\n/**\r\n * removes event listeners for Elements created via el()\r\n * @param el\r\n */\r\nexport function destroyEl(el: HTMLElement) {\r\n    for (let i = 0; i < els.length; i++) {\r\n        const item = els[i];\r\n        if (item.el === el) {\r\n            item.listeners.forEach(item => {\r\n                el.removeEventListener(item[0], item[1]);\r\n            });\r\n            els.splice(i, 1);\r\n            return;\r\n        }\r\n    }\r\n    // not found\r\n    return;\r\n}\r\n","\r\nexport class BbLog {\r\n\r\n    private static listeners: any[] = [];\r\n\r\n    constructor() {\r\n    }\r\n\r\n    static subscribe(listener) {\r\n        if (BbLog.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        BbLog.listeners.push(listener);\r\n    }\r\n\r\n    static unsubscribe(listener) {\r\n        for (let i = 0; i < BbLog.listeners.length; i++) {\r\n            if (listener === BbLog.listeners[i]) {\r\n                BbLog.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    static emit (msg) {\r\n        BbLog.listeners.forEach(item => {\r\n            item(msg);\r\n        });\r\n    }\r\n}",null,"/**\r\n * LocalStorage wrapper that does not throw exceptions.\r\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\r\n */\r\nexport class LocalStorage {\r\n\r\n    private static error;\r\n\r\n    static getItem (key: string): string {\r\n        let result = null;\r\n        try {\r\n            result = localStorage.getItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static setItem (key: string, value: string): void {\r\n        try {\r\n            localStorage.setItem(key, value);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static removeItem (key: string): void {\r\n        try {\r\n            localStorage.removeItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static getError (): any {\r\n        return this.error;\r\n    }\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"l7FYj\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kbyFQ\");","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Checkbox - with label\r\n */\r\nexport class Checkbox {\r\n\r\n    private element: HTMLElement;\r\n    private check: HTMLInputElement;\r\n    private doHighlight: boolean;\r\n\r\n    // --- public ---\r\n\r\n    constructor (params: {\r\n        init?: boolean; // default false\r\n        label: string;\r\n        callback: (boolean) => void;\r\n        allowTab?: boolean; // default false\r\n        title?: string;\r\n        doHighlight?: boolean; // default false\r\n        css?: any;\r\n    }) {\r\n        this.doHighlight = params.doHighlight;\r\n\r\n        this.element = BB.el({\r\n            className: 'kl-checkbox'\r\n        });\r\n\r\n        const innerEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'label',\r\n            className: 'kl-checkbox__inner'\r\n        });\r\n\r\n        this.check = BB.el({\r\n            parent: innerEl,\r\n            tagName: 'input',\r\n            css: {\r\n                marginLeft: '0',\r\n                display: 'inline-block'\r\n            },\r\n            custom: {\r\n                type: 'checkbox'\r\n            }\r\n        }) as HTMLInputElement;\r\n        this.check.checked = params.init;\r\n        if (this.doHighlight && this.check.checked) {\r\n            this.element.classList.add('kl-checkbox--highlight');\r\n        }\r\n        if (!params.allowTab) {\r\n            this.check.tabIndex = -1;\r\n        }\r\n\r\n        if (params.title) {\r\n            innerEl.title = params.title;\r\n        }\r\n\r\n        const label = document.createElement('div');\r\n        label.style.display = 'inline-block';\r\n        label.innerHTML = params.label;\r\n        (label as any).allowClick = true;\r\n        innerEl.appendChild(label);\r\n\r\n        this.check.onchange = () => {\r\n            if (this.doHighlight) {\r\n                this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\r\n            }\r\n            params.callback(this.check.checked);\r\n            setTimeout(() => {\r\n                this.check.blur();\r\n            }, 0);\r\n        };\r\n        if (params.css) {\r\n            BB.css(this.element, params.css);\r\n        }\r\n    }\r\n\r\n    getValue(): boolean {\r\n        return this.check.checked;\r\n    }\r\n\r\n    setValue(b: boolean) {\r\n        this.check.checked = !!b;\r\n        if (this.doHighlight) {\r\n            this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\r\n        }\r\n    }\r\n\r\n    getElement(): HTMLElement {\r\n        return this.element;\r\n    }\r\n\r\n    destroy() {\r\n        this.check.onchange = null;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\n\r\nexport const input = function (params: {\r\n    type?: 'button' | 'checkbox' | 'number' | 'text' | 'color'; // default text\r\n    min?: number;\r\n    max?: number;\r\n    callback: (val: string) => void;\r\n    init: string | number;\r\n    css?: IKeyString;\r\n}) {\r\n    const result = document.createElement('input');\r\n    if (params.type) {\r\n        try {\r\n            result.type = params.type;\r\n        } catch(e) {} // ie can't deal with number\r\n    } else {\r\n        result.type = 'text';\r\n    }\r\n    if (params.min !== undefined) {\r\n        result.min = '' + params.min;\r\n    }\r\n    if (params.max !== undefined) {\r\n        result.max = '' + params.max;\r\n    }\r\n    result.value = '' + params.init;\r\n    if (params.callback) {\r\n        result.onchange = function() {\r\n            params.callback(result.value);\r\n        };\r\n    }\r\n    if (params.css) {\r\n        BB.css(result, params.css);\r\n    }\r\n\r\n    return result;\r\n};","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\n\r\n/**\r\n * A select dropdown\r\n */\r\nexport class Select {\r\n\r\n    private selectEl: HTMLSelectElement;\r\n    private optionArr: ([string, string] | null)[]; // [value, label]\r\n    private changeListener: (event) => void;\r\n    private onChange: (val: string) => void;\r\n\r\n    \r\n    // --- public ---\r\n    constructor (p: {\r\n        isFocusable?: boolean; // default false\r\n        optionArr: ([string, string] | null)[], // [value, label]\r\n        initValue?: string; // default null\r\n        onChange: (val: string) => void;\r\n        css?: IKeyString;\r\n        title?: string;\r\n    }) {\r\n        this.selectEl = BB.el({\r\n            tagName: 'select',\r\n            title: p.title,\r\n            css: {\r\n                cursor: 'pointer',\r\n                fontSize: '15px',\r\n                padding: '3px',\r\n                background: '#fff', // makes safari pay attention to font-size\r\n                //webkitAppearance: 'none'\r\n                colorScheme: 'only light', // chrome doesn't properly invert the text color\r\n            }\r\n        }) as HTMLSelectElement;\r\n        if (p.css) {\r\n            BB.css(this.selectEl, p.css);\r\n        }\r\n\r\n        const isFocusable = p.isFocusable;\r\n        if (!isFocusable) {\r\n            this.selectEl.tabIndex = -1;\r\n        }\r\n        this.optionArr = p.optionArr;\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            if (this.optionArr[i] === null) {\r\n                continue;\r\n            }\r\n            const option = document.createElement('option');\r\n            option.value = this.optionArr[i][0];\r\n            option.textContent = this.optionArr[i][1];\r\n            this.selectEl.append(option);\r\n        }\r\n        this.onChange = p.onChange;\r\n        this.changeListener = (e) => {\r\n            if (!isFocusable) {\r\n                this.selectEl.blur();\r\n            }\r\n            this.onChange(this.selectEl.value);\r\n        };\r\n        this.selectEl.addEventListener('change', this.changeListener);\r\n        this.selectEl.value = 'initValue' in p ? p.initValue : null;\r\n    }\r\n\r\n    setValue (val) {\r\n        this.selectEl.value = val;\r\n    }\r\n\r\n    getValue () {\r\n        return this.selectEl.value;\r\n    }\r\n\r\n    setDeltaValue (delta) {\r\n        let index = 0;\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            if ('' + this.optionArr[i][0] === this.selectEl.value) {\r\n                index = i;\r\n                break;\r\n            }\r\n        }\r\n        index = Math.max(0, Math.min(this.optionArr.length -1, index + delta));\r\n        this.selectEl.value = this.optionArr[index][0];\r\n        this.onChange(this.selectEl.value);\r\n    }\r\n\r\n    getElement () {\r\n        return this.selectEl;\r\n    }\r\n\r\n    destroy = () => {\r\n        this.selectEl.removeEventListener('change', this.changeListener);\r\n    }\r\n    \r\n}\r\n","import {BB} from '../../../bb/bb';\r\n\r\n\r\n/**\r\n * Toggle button with an image\r\n *\r\n * p = {\r\n *     initValue: boolean,\r\n *     title: string,\r\n *     isRadio: boolean, // if true, can't click when active\r\n *     onChange: function(boolean)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const ImageToggle = function(p) {\r\n    let isActive = !!p.initValue;\r\n    const div = BB.el({\r\n        className: 'image-toggle',\r\n        title: p.title,\r\n        css: {\r\n            backgroundImage: \"url('\" + p.image + \"')\"\r\n        },\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            if (p.isRadio && isActive) {\r\n                return;\r\n            }\r\n            isActive = !isActive;\r\n            update();\r\n            p.onChange(isActive);\r\n        },\r\n    });\r\n\r\n    function update() {\r\n        div.classList.toggle('image-toggle-active', isActive);\r\n    }\r\n\r\n    update();\r\n\r\n    // --- interface ---\r\n    this.setValue = function(b) {\r\n        isActive = !!b;\r\n        update();\r\n    };\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.getValue = function() {\r\n        return isActive;\r\n    };\r\n    this.destroy = () => {\r\n        BB.destroyEl(div);\r\n    };\r\n\r\n};","import {BB} from '../../../bb/bb';\r\nimport {ImageToggle} from './image-toggle';\r\n\r\n/**\r\n * Radio input group. each one has an image\r\n *\r\n * p = {\r\n *     optionArr: {\r\n *         id: string,\r\n *         title: string,\r\n *         image: string,\r\n *     }[],\r\n *     initId: string,\r\n *     sizePx: number,\r\n *     onChange: function(id: string): void\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport const ImageRadioList = function(p) {\r\n\r\n    const div = BB.el({\r\n        className: 'image-radio-wrapper',\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n\r\n    let activeIndex;\r\n    const optionArr = [];\r\n\r\n    function select(index, id) {\r\n        activeIndex = index;\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            optionArr[i].setValue(i === activeIndex);\r\n        }\r\n        p.onChange(id);\r\n    }\r\n\r\n    function createOption(index, o) {\r\n        if (o.id === p.initId) {\r\n            activeIndex = index;\r\n        }\r\n        const radioEl = new ImageToggle({\r\n            image: o.image,\r\n            title: o.title,\r\n            initValue: o.id === p.initId,\r\n            isRadio: true,\r\n            onChange: function() {\r\n                select(index, o.id);\r\n            }\r\n        });\r\n        div.appendChild(radioEl.getElement());\r\n\r\n        return radioEl;\r\n\r\n    }\r\n\r\n    for (let i = 0; i < p.optionArr.length; i++) {\r\n        optionArr.push(createOption(i, p.optionArr[i]));\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.getValue = function() {\r\n        return p.optionArr[activeIndex].id;\r\n    };\r\n    this.destroy = () => {\r\n        optionArr.forEach(item => {\r\n            item.destroy();\r\n        })\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport iconImg from 'url:~/src/app/img/ui/brush-pressure.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * small toggle button with a pen icon - representing toggling pressure sensitivity\r\n * @param isChecked - boolean - initial value\r\n * @param changeCallback - function(isChecked boolean) - called on change\r\n * @returns {HTMLElement} - the toggle button\r\n */\r\nexport const penPressureToggle = function(isChecked, changeCallback) {\r\n\r\n    const toggleDiv = BB.el({\r\n        css: {\r\n            cssFloat: 'right',\r\n            borderRadius: '3px',\r\n            width: '18px',\r\n            height: '18px',\r\n            backgroundImage: 'url(\"' + iconImg + '\")',\r\n            backgroundSize: 'contain',\r\n            backgroundRepeat: 'no-repeat',\r\n            cursor: 'pointer',\r\n            boxSizing: 'border-box',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n\r\n    if (!BB.hasPointerEvents) {\r\n        toggleDiv.style.display = 'none';\r\n    }\r\n\r\n    function redraw() {\r\n        if (isChecked) {\r\n            BB.css(toggleDiv, {\r\n                backgroundColor: '#fff',\r\n                opacity: '0.9',\r\n                border: '1px solid var(--active-highlight-color)'\r\n            });\r\n        } else {\r\n            BB.css(toggleDiv, {\r\n                backgroundColor: 'transparent',\r\n                opacity: '0.5',\r\n                border: '1px solid #666'\r\n            });\r\n        }\r\n    }\r\n\r\n    toggleDiv.title = LANG('brush-toggle-pressure');\r\n    toggleDiv.onclick = function() {\r\n        isChecked = !isChecked;\r\n        redraw();\r\n        changeCallback(isChecked);\r\n    };\r\n\r\n    redraw();\r\n    changeCallback(isChecked);\r\n\r\n    return toggleDiv;\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"5H9IS\");","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport {IKlSliderConfig} from '../../kl.types';\r\nimport {languageStrings} from '../../../language/language';\r\nimport {DoubleTapper, EventChain} from '../../../bb/input/event-chain';\r\nimport {KlSliderManualInput} from './kl-slider-manual-input';\r\n\r\n/**\r\n * Horizontal slider, can be changed by dragging anywhere on it. Has a label & value.\r\n * e.g. used for brush size\r\n *\r\n * left mouse button - set absolute value\r\n * right mouse button - change relative value\r\n * drag mouse vertically away - high precision mode\r\n * double-click/tap slider -> manual input mode\r\n *\r\n * Values can be spline interpolated\r\n * On change callback can be debounced\r\n *\r\n */\r\nexport class KlSlider {\r\n\r\n    /*\r\n    Three types of values\r\n    - value - the actual value, when using setValue(), getValue(), and what is emitted\r\n    - displayValue - the number that the user sees on the slider and in the manual input field\r\n        - might be further formatted with formatFunc\r\n        - also might be the same as value, if no toDisplayValue function provided\r\n    - sliderValue - the draggable position of the slider, 0 - 1\r\n     */\r\n\r\n    private value: number;\r\n\r\n    private elementWidth: number;\r\n    private elementHeight: number;\r\n    private isEnabled: boolean;\r\n\r\n    private min: number; // min value\r\n    private max: number; // max value\r\n    private useSpline: boolean;\r\n    private splineInterpolator: any; // todo type\r\n    private resolution: number;\r\n\r\n    private isChangeOnFinal: boolean;\r\n    private formatFunc: null | ((val: number) => number);\r\n\r\n    private onChange: (val: number) => void;\r\n    private valueToDisplayValue: (value: number) => number;\r\n    private displayValueToValue: (displayValue: number) => number;\r\n\r\n\r\n    private roolEl: HTMLElement;\r\n    private sliderWrapperEl: HTMLElement;\r\n    private textEl: HTMLElement; // displays label, displayValue\r\n    private label: string;\r\n    private control: HTMLElement;\r\n    private manualInput: null | KlSliderManualInput;\r\n    private manualInputRoundDigits: number;\r\n\r\n    private pointerListener: any; // todo type\r\n    private pointerListenerTimeout: any;\r\n\r\n    private eventResMs: null | number;\r\n    private emitValue: null | number = null; // next value for interval\r\n    private emitInterval: null | any; // interval of eventResMs which calls onChange()\r\n\r\n    private valueToSliderValue(value: number): number {\r\n        if (this.useSpline) {\r\n            return this.splineInterpolator.findX(value, Math.floor(this.resolution));\r\n        }\r\n        return (value - this.min) / (this.max - this.min);\r\n    }\r\n\r\n    private sliderValuetoValue(sliderValue: number): number {\r\n        let result = this.min + sliderValue * (this.max - this.min);\r\n        if (this.useSpline) {\r\n            result = this.splineInterpolator.interpolate(sliderValue);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private updateLabel(): void {\r\n        let displayValue: number | string = this.valueToDisplayValue(this.value);\r\n        displayValue = this.formatFunc ? this.formatFunc(displayValue) : Math.round(displayValue);\r\n        displayValue = displayValue.toLocaleString(languageStrings.getCode());\r\n        this.textEl.innerHTML = this.label + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + displayValue + '</span>';\r\n\r\n        const sliderValue = this.valueToSliderValue(this.value);\r\n        this.control.style.width = (sliderValue * this.elementWidth) + 'px';\r\n    }\r\n\r\n    private emit(isFinal: boolean): void {\r\n        if (!isFinal && this.isChangeOnFinal) {\r\n            return;\r\n        }\r\n\r\n        if (isFinal || !this.eventResMs) {\r\n            this.onChange(this.value);\r\n            if (this.emitInterval) {\r\n                clearInterval(this.emitInterval);\r\n                this.emitInterval = null;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (this.emitInterval) {\r\n            this.emitValue = this.value;\r\n\r\n        } else {\r\n            this.onChange(this.value);\r\n\r\n            this.emitInterval = setInterval(() => {\r\n                if (this.emitValue === null) {\r\n                    clearInterval(this.emitInterval);\r\n                    this.emitInterval = null;\r\n                } else {\r\n                    this.onChange(this.emitValue);\r\n                    this.emitValue = null;\r\n                }\r\n            }, this.eventResMs);\r\n        }\r\n    }\r\n\r\n    private updateEnable(): void {\r\n        BB.css(this.sliderWrapperEl, {\r\n            opacity: this.isEnabled ? null : '0.5',\r\n            pointerEvents: this.isEnabled ? null : 'none',\r\n        });\r\n        if (this.manualInput) {\r\n            this.manualInput.setIsEnabled(this.isEnabled);\r\n        }\r\n    }\r\n\r\n    private showManualInput(): void {\r\n\r\n        this.manualInput = new KlSliderManualInput(\r\n            this.valueToDisplayValue(this.value),\r\n            this.valueToDisplayValue(this.min),\r\n            this.valueToDisplayValue(this.max),\r\n            this.sliderWrapperEl.getBoundingClientRect(),\r\n            (val) => {\r\n                val = this.displayValueToValue(val);\r\n                this.setValue(BB.clamp(val, this.min, this.max));\r\n                this.onChange(this.value);\r\n            },\r\n            () => {\r\n                BB.css(this.sliderWrapperEl, {\r\n                    display: null,\r\n                });\r\n                this.roolEl.removeChild(this.manualInput.getElement());\r\n                this.manualInput.destroy();\r\n                this.manualInput = null;\r\n            },\r\n            (this.manualInputRoundDigits && this.manualInputRoundDigits > 0) ? this.manualInputRoundDigits : 0,\r\n        );\r\n        this.roolEl.append(this.manualInput.getElement());\r\n        setTimeout(() => {\r\n            this.manualInput.focus();\r\n        });\r\n        BB.css(this.sliderWrapperEl, {\r\n            display: 'none',\r\n        });\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        p: {\r\n            label: string,\r\n            width: number, // px\r\n            height: number, // px\r\n            min: number, // min value\r\n            max: number,\r\n            value: number,\r\n            resolution?: number, // int, if you want spline.findX() to use a custom resolution\r\n            curve?: 'quadratic' | any[], // optional. array is BB.SplineInterpolator points. 0-1\r\n            formatFunc?: (val: number) => number, // function to display a different number than value\r\n            onChange?: (val: number) => void,\r\n            isChangeOnFinal?: boolean, // only fire onChange on pointerUp\r\n            eventResMs?: number, // frequency of change events\r\n            isEnabled?: boolean, // default = true\r\n            manualInputRoundDigits?: number, // default 0, how value should be rounded for manual input\r\n            toDisplayValue?: (value: number) => number,\r\n            toValue?: (displayValue: number) => number,\r\n        }\r\n    ) {\r\n        const _this = this;\r\n        this.isEnabled = p.isEnabled !== false;\r\n        this.manualInputRoundDigits = p.manualInputRoundDigits;\r\n        this.useSpline = !!p.curve;\r\n\r\n        if (!p.label) {\r\n            throw new Error('KlSlider missing params');\r\n        }\r\n        if (p.min != 0 && p.max != 0 && p.value != 0) {\r\n            if (!p.min || !p.max || !p.value) {\r\n                throw new Error('KlSlider broken params');\r\n            }\r\n        }\r\n        if (p.min >= p.max) {\r\n            throw new Error('KlSlider broken params');\r\n        }\r\n\r\n        this.min = p.min;\r\n        this.max = p.max;\r\n        this.value = BB.clamp(p.value, this.min, this.max);\r\n        this.elementWidth = p.width;\r\n        this.elementHeight = p.height;\r\n        this.resolution = p.resolution ? p.resolution : this.elementWidth * 2;\r\n\r\n        this.onChange = p.onChange ? p.onChange : () => {};\r\n        if (!this.displayValueToValue !== !this.valueToDisplayValue) {\r\n            throw new Error('both or neither have to be set, toValue and toDisplayValue');\r\n        }\r\n        this.displayValueToValue = p.toValue ? p.toValue : (displayValue) => displayValue;\r\n        this.valueToDisplayValue = p.toDisplayValue ? p.toDisplayValue : (value) => value;\r\n        this.isChangeOnFinal = !!p.isChangeOnFinal;\r\n        this.formatFunc = p.formatFunc;\r\n        this.eventResMs = p.eventResMs;\r\n\r\n        if (this.useSpline) {\r\n            const curveArr = p.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : p.curve;\r\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        }\r\n\r\n        this.roolEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n        this.sliderWrapperEl = BB.el({\r\n            parent: this.roolEl,\r\n            className: 'sliderWrapper',\r\n            css: {\r\n                overflow: 'hidden',\r\n                position: 'relative',\r\n                width: this.elementWidth + 'px',\r\n                height: this.elementHeight + 'px',\r\n                userSelect: 'none'\r\n            }\r\n        });\r\n        this.roolEl.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        this.label = p.label;\r\n        const labelFontSize = this.elementHeight - 14;\r\n        this.textEl = BB.el({\r\n            content: this.label,\r\n            css: {\r\n                position: 'absolute',\r\n                left: '7px',\r\n                top: (this.elementHeight / 2 - labelFontSize / 2 + 1) + 'px',\r\n                lineHeight: labelFontSize + 'px',\r\n                fontSize: labelFontSize + 'px',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        this.control = BB.el({\r\n            className: 'sliderInner',\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                width: (this.valueToSliderValue(this.value) * this.elementWidth) + 'px',\r\n                height: this.elementHeight + 'px',\r\n            }\r\n        });\r\n        const controlInner = document.createElement('div');\r\n\r\n        this.sliderWrapperEl.append(this.control, this.textEl);\r\n        this.control.append(controlInner);\r\n\r\n        this.updateEnable();\r\n\r\n\r\n        const doubleTapper = new DoubleTapper({\r\n            onDoubleTap: () => {\r\n                this.showManualInput();\r\n            }\r\n        })\r\n        doubleTapper.setAllowedButtonArr(['left', 'right']);\r\n        const eventChain = new EventChain({\r\n            chainArr: [\r\n                doubleTapper\r\n            ]\r\n        });\r\n\r\n        let virtualVal;\r\n        const onPointer = (event) => {\r\n            event.eventPreventDefault();\r\n\r\n            if (!this.isEnabled) {\r\n                return;\r\n            }\r\n\r\n            if (event.type === 'pointerdown') {\r\n\r\n                // unfocus manual slider input\r\n                BB.unfocusAnyInput();\r\n\r\n                this.sliderWrapperEl.className = 'sliderWrapper sliderWrapperActive';\r\n\r\n                if (event.button === 'left') {\r\n                    let sliderValue = event.relX / this.elementWidth;\r\n                    sliderValue = Math.max(0, Math.min(1, sliderValue));\r\n                    this.value = this.sliderValuetoValue(sliderValue);\r\n                    this.updateLabel();\r\n                    this.emit(false);\r\n                }\r\n                virtualVal = this.valueToSliderValue(this.value);\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                let deltaX = event.dX;\r\n                const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n                deltaX *= factor;\r\n                deltaX /= this.elementWidth;\r\n\r\n                virtualVal += deltaX;\r\n\r\n                let sliderValue = Math.max(0, Math.min(1, virtualVal));\r\n                this.value = this.sliderValuetoValue(sliderValue);\r\n                this.updateLabel();\r\n                this.emit(false);\r\n            }\r\n\r\n            if (event.type === 'pointerup') {\r\n                this.sliderWrapperEl.className = 'sliderWrapper';\r\n                this.emit(true);\r\n            }\r\n\r\n        }\r\n\r\n        this.pointerListenerTimeout = setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.sliderWrapperEl,\r\n                maxPointers: 1,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    onPointer(e);\r\n                    eventChain.chainIn(e);\r\n                },\r\n                onWheel: (event) => {\r\n                    let sliderValue = this.valueToSliderValue(this.value);\r\n                    sliderValue = BB.clamp(sliderValue - event.deltaY / 40, 0, 1);\r\n                    this.value = this.sliderValuetoValue(sliderValue);\r\n                    this.updateLabel();\r\n                    this.onChange(this.value);\r\n                }\r\n            });\r\n            this.updateLabel();\r\n        }, 1);\r\n    }\r\n\r\n    changeSliderValue(f: number): void {\r\n        if (!this.isEnabled) {\r\n            return;\r\n        }\r\n        let sliderValue = this.valueToSliderValue(this.value);\r\n        sliderValue = BB.clamp(sliderValue + f, 0, 1);\r\n        this.value = this.sliderValuetoValue(sliderValue);\r\n        this.updateLabel();\r\n        this.onChange(this.value);\r\n    }\r\n\r\n    setValue (v: number): void {\r\n        this.value = BB.clamp(v, this.min, this.max);\r\n        this.updateLabel();\r\n    }\r\n\r\n    getValue (): number {\r\n        return this.value;\r\n    }\r\n\r\n    update (config: IKlSliderConfig): void {\r\n        this.min = config.min;\r\n        this.max = config.max;\r\n        this.useSpline = !!config.curve;\r\n        if (this.useSpline) {\r\n            const curveArr = config.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : config.curve;\r\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        } else {\r\n            this.splineInterpolator = null;\r\n        }\r\n        this.setIsEnabled(!config.isDisabled);\r\n    }\r\n\r\n    setIsEnabled (e: boolean): void {\r\n        this.isEnabled = !!e;\r\n        this.updateEnable();\r\n    }\r\n\r\n    destroy (): void {\r\n        clearTimeout(this.pointerListenerTimeout);\r\n        if (this.pointerListener) {\r\n            this.pointerListener.destroy();\r\n        }\r\n        if (this.manualInput) {\r\n            this.manualInput.destroy();\r\n        }\r\n        if (this.emitInterval) {\r\n            clearInterval(this.emitInterval);\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.roolEl;\r\n    }\r\n\r\n}\r\n","\r\n\r\n/**\r\n * to make sliders more finegrained.\r\n * @param deltaY number - how far pointer moved away vertically since down\r\n * @returns {number} the factor 0-1. 0 -> infinite movement for change of 1. 1 -> 1px for change of 1\r\n */\r\nexport const calcSliderFalloffFactor = function(deltaY, isRightButton) {\r\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\r\n    if (isRightButton) {\r\n        result *= 2;\r\n    }\r\n    return 1 / result;\r\n};\r\n","import {BB} from '../../../bb/bb';\r\nimport {input} from './input';\r\n\r\n/**\r\n * Used by KlSlider. Allows user to type in value in input (type=number) field, instead of dragging with mouse.\r\n * Input goes away when losing focus, or when pressing Enter/Escape.\r\n */\r\nexport class KlSliderManualInput {\r\n\r\n    private input: HTMLInputElement;\r\n    private isEnabled: boolean;\r\n    private scrollBefore: { x: number, y: number }; // window scroll position on creation\r\n    private lastValue: number; // last emitted value\r\n    private isClosed: boolean = false;\r\n\r\n    private emit(): void {\r\n        if (this.lastValue !== Number(this.input.value)) {\r\n            this.onChange(Number(this.input.value));\r\n            this.lastValue = Number(this.input.value);\r\n        }\r\n    }\r\n\r\n    private privateOnClose(): void {\r\n        if (this.isClosed) {\r\n            return;\r\n        }\r\n        this.isClosed = true;\r\n\r\n        this.emit();\r\n        this.onClose();\r\n        setTimeout(() => {\r\n            // because iPad keyboard changes the scroll position\r\n            window.scrollTo(this.scrollBefore.x, this.scrollBefore.y);\r\n            this.scrollBefore = null;\r\n        });\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor(\r\n        value: number, // initial value (displayValue)\r\n        min: number,\r\n        max: number,\r\n        rect: DOMRect, // size of input field\r\n        private onChange: (displayValue: number) => void,\r\n        private onClose: () => void,\r\n        roundDigits?: number,\r\n    ) {\r\n\r\n        this.input = input({\r\n            type: 'number',\r\n            init: value,\r\n            min,\r\n            max,\r\n            callback: (val) => {\r\n                this.emit();\r\n            },\r\n        });\r\n        if (roundDigits !== 0) {\r\n            this.input.setAttribute('step', 'any');\r\n        }\r\n        this.input.onblur = () => {\r\n            this.privateOnClose();\r\n        };\r\n        this.input.addEventListener('keyup', (e) => {\r\n            if (['Enter', 'Escape'].includes(e.key)) {\r\n                this.privateOnClose();\r\n            } else {\r\n                this.emit();\r\n            }\r\n        });\r\n        this.input.addEventListener('wheel', () => this.emit());\r\n\r\n        this.scrollBefore = {\r\n            x: window.scrollX,\r\n            y: window.scrollY,\r\n        };\r\n\r\n        let currentValue;\r\n        if (roundDigits || roundDigits === 0) {\r\n            currentValue = BB.round(value, roundDigits);\r\n        } else {\r\n            currentValue = value;\r\n        }\r\n        this.lastValue = currentValue;\r\n        this.input.value = '' + currentValue;\r\n\r\n        BB.css(this.input, {\r\n            width: rect.width + 'px',\r\n            height: rect.height + 'px',\r\n        });\r\n    }\r\n\r\n    getElement() {\r\n        return this.input;\r\n    }\r\n\r\n    setIsEnabled(b: boolean): void {\r\n        this.isEnabled = !!b;\r\n    }\r\n\r\n    focus(): void {\r\n        this.input.focus();\r\n        this.input.select();\r\n    }\r\n\r\n    destroy(): void {\r\n        BB.destroyEl(this.input);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {input} from '../base-components/input';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n// @ts-ignore\r\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\r\n\r\n/**\r\n * dialog for manually inputting the color\r\n * @param p {color: rgbObj, onClose: function(rgbObj | null)}\r\n * @constructor\r\n */\r\nexport const HexColorDialog = function (p) {\r\n\r\n    let lastValidRgb = new BB.RGB(p.color.r, p.color.g, p.color.b);\r\n\r\n    const div = BB.el({});\r\n\r\n    const previewEl = BB.el({\r\n        css: {\r\n            width: '20px',\r\n            height: '20px',\r\n            marginBottom: '10px',\r\n            boxShadow: 'inset 0 0 0 1px #fff, 0 0 0 1px #000',\r\n            background: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.appendChild(previewEl);\r\n\r\n\r\n    // --- Hex ---\r\n    const hexRowEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginBottom: '15px'\r\n        }\r\n    });\r\n    const hexLabel = BB.el({\r\n        content: LANG('mci-hex'),\r\n        css: {\r\n            width: '60px'\r\n        }\r\n    });\r\n    const hexInput = input({\r\n        init: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n        css: {\r\n            width: '80px'\r\n        },\r\n        callback: function() {\r\n            let rgbObj = BB.ColorConverter.hexToRGB(hexInput.value);\r\n            if (rgbObj === null) {\r\n                rgbObj = lastValidRgb;\r\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n            } else {\r\n                lastValidRgb = rgbObj;\r\n            }\r\n            previewEl.style.background = '#' + BB.ColorConverter.toHexString(rgbObj);\r\n\r\n            for (let i = 0; i < rgbArr.length; i++) {\r\n                rgbArr[i].update();\r\n            }\r\n        }\r\n    });\r\n    const copyButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img src=\"' + copyImg + '\" height=\"20\"/>',\r\n        title: LANG('mci-copy'),\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            hexInput.select();\r\n            document.execCommand('copy');\r\n        }\r\n    });\r\n    hexRowEl.appendChild(hexLabel);\r\n    hexRowEl.appendChild(hexInput);\r\n    hexRowEl.appendChild(copyButton);\r\n    div.appendChild(hexRowEl);\r\n    setTimeout(function () {\r\n        hexInput.focus();\r\n        hexInput.select();\r\n    }, 0);\r\n\r\n\r\n    // --- R G B ---\r\n    function createRgbInputRow(labelStr, attributeStr) {\r\n        const result: any = {};\r\n\r\n        const rowEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '5px',\r\n            }\r\n        });\r\n        const labelEl = BB.el({\r\n            content: labelStr,\r\n            css: {\r\n                width: '60px'\r\n            }\r\n        });\r\n\r\n        const inputEl = input({\r\n            init: lastValidRgb[attributeStr],\r\n            min: 0,\r\n            max: 255,\r\n            type: 'number',\r\n            css: {\r\n                width: '80px'\r\n            },\r\n            callback: function() {\r\n                if (inputEl.value === '' || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\r\n                    result.update();\r\n                    return;\r\n                }\r\n                inputEl.value = '' + Math.round(parseFloat(inputEl.value));\r\n                lastValidRgb[attributeStr] = inputEl.value;\r\n                previewEl.style.background = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n            }\r\n        });\r\n\r\n        rowEl.appendChild(labelEl);\r\n        rowEl.appendChild(inputEl);\r\n        div.appendChild(rowEl);\r\n\r\n\r\n        result.update = function() {\r\n            inputEl.value = lastValidRgb[attributeStr];\r\n        };\r\n        result.destroy = () => {\r\n            inputEl.onchange = null;\r\n        };\r\n        return result;\r\n    }\r\n    const rgbArr = [];\r\n    rgbArr.push(createRgbInputRow(LANG('red'), 'r'));\r\n    rgbArr.push(createRgbInputRow(LANG('green'), 'g'));\r\n    rgbArr.push(createRgbInputRow(LANG('blue'), 'b'));\r\n\r\n\r\n    popup({\r\n        target: document.body,\r\n        message: `<b>${LANG('manual-color-input')}</b>`,\r\n        div: div,\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (resultStr) {\r\n            BB.destroyEl(copyButton);\r\n            rgbArr.forEach(item => item.destroy());\r\n            rgbArr.splice(0, rgbArr.length);\r\n\r\n            p.onClose(resultStr === 'Ok' ? BB.ColorConverter.hexToRGB(hexInput.value) : null);\r\n        }\r\n    });\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"la7yv\");","import {BB} from '../../../bb/bb';\r\nimport {HexColorDialog} from '../modals/color-slider-hex-dialog';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\n// @ts-ignore\r\nimport eyedropperImg from 'url:~/src/app/img/ui/tool-picker.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * big main HS+V color slider\r\n * 2 elements: slider, and colorpreview(output) + eyedropper\r\n *\r\n * p = {\r\n *     width: number,\r\n *     height: number, // hue slider and output height\r\n *     svHeight: number,\r\n *     startValue: rgb, // 0-255\r\n *     onPick: function(rgb)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const KlColorSlider = function (p) {\r\n\r\n    const _this = this;\r\n    let pickCallback = function(result?) {};\r\n    const div = document.createElement('div');\r\n    div.style.position = 'relative';\r\n    div.className = 'colorSlider';\r\n    const outputDiv = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center'\r\n        }\r\n    });\r\n    const width = p.width;\r\n    let svHeight = p.svHeight;\r\n    const height = p.height;\r\n    const emitColor = p.onPick;\r\n\r\n    let primaryColorRGB = {\r\n        r: parseInt(p.startValue.r, 10),\r\n        g: parseInt(p.startValue.g, 10),\r\n        b: parseInt(p.startValue.b, 10)\r\n    };\r\n    let primaryColorHSV = BB.ColorConverter.toHSV(p.startValue); // BB.HSV\r\n    let secondaryColorRGB = {r: 255, g: 255, b: 255};\r\n    let secondaryColorHSV = BB.ColorConverter._RGBtoHSV(secondaryColorRGB); // BB.HSV\r\n\r\n    const svWrapper = BB.el({});\r\n    const svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"> <defs> <linearGradient id=\"value\" gradientTransform=\"rotate(90)\"> <stop offset=\"0\" stop-color=\"rgba(0,0,0,0)\"/> <stop offset=\"100%\" stop-color=\"rgba(0,0,0,1)\"/> </linearGradient> <linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"> <stop offset=\"0\" stop-color=\"#fff\"/> <stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/> </linearGradient> </defs> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\"/></svg>', 'image/svg+xml').documentElement;\r\n    const hueStop = (svSvg as any).getElementById('hue-stop');\r\n    BB.setAttributes(hueStop, {\r\n        'stop-color': '#f0f'\r\n    });\r\n    BB.css(svSvg, {\r\n        width: width + 'px',\r\n        height: svHeight + 'px'\r\n    });\r\n    svWrapper.appendChild(svSvg);\r\n\r\n    const divH = document.createElement('div');\r\n    BB.css(divH, {\r\n        position: 'relative',\r\n        height: height + 'px'\r\n    });\r\n    const divPreview = document.createElement('div');\r\n    const controlH = document.createElement('div');\r\n\r\n    const enabled = true;\r\n\r\n    function updatePrimaryHSV(hsv) {\r\n        if (hsv.s === 0) {\r\n            primaryColorHSV = new BB.HSV(primaryColorHSV.h, hsv.s, hsv.v);\r\n        } else {\r\n            primaryColorHSV = new BB.HSV(hsv.h, hsv.s, hsv.v);\r\n        }\r\n    }\r\n\r\n    function createHueBg(targetEl) {\r\n        const im = new Image();\r\n        BB.css(im, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            display: 'none',\r\n            pointerEvents: 'none'\r\n        });\r\n        const cv = BB.canvas(width, height);\r\n        const ctx = cv.getContext('2d');\r\n        const gradH = ctx.createLinearGradient(0, 0, width, 0);\r\n        for (let i = 0; i < 1; i += 0.01) {\r\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n            let ha = (parseInt('' + col.r)).toString(16);\r\n            let hb = (parseInt('' + col.g)).toString(16);\r\n            let hc = (parseInt('' + col.b)).toString(16);\r\n            if (ha.length === 1)\r\n                ha = '0' + ha;\r\n            if (hb.length === 1)\r\n                hb = '0' + hb;\r\n            if (hc.length === 1)\r\n                hc = '0' + hc;\r\n            gradH.addColorStop(i, '#' + ha + hb + hc);\r\n        }\r\n        ctx.fillStyle = gradH;\r\n        ctx.fillRect(0, 0, width, height);\r\n\r\n        targetEl.appendChild(im);\r\n        im.alt = 'hue';\r\n        im.src = cv.toDataURL('image/png');\r\n        im.style.display = 'block';\r\n    }\r\n\r\n\r\n    function updateSVCanvas() {\r\n        const rgb = BB.ColorConverter.toRGB(new BB.HSV(primaryColorHSV.h, 100, 100));\r\n        BB.setAttributes(hueStop, {\r\n            'stop-color': '#' + BB.ColorConverter.toHexString(rgb)\r\n        });\r\n    }\r\n\r\n    function updateSVPointer() {\r\n\r\n        const left = primaryColorHSV.s / 100 * width - 7;\r\n        const top = (1 - primaryColorHSV.v / 100) * svHeight - 6;\r\n        BB.css(pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px'\r\n        });\r\n    }\r\n\r\n    function setColPreview() {\r\n        divPreview.style.backgroundColor = 'rgb(' + primaryColorRGB.r + ',' + primaryColorRGB.g + ',' + primaryColorRGB.b + ')';\r\n\r\n        if (BB.testIsWhiteBestContrast(primaryColorRGB)) {\r\n            BB.css(pickerButton, {\r\n                filter: 'invert(1)'\r\n            });\r\n            BB.css(hexButton, {\r\n                filter: 'invert(1)'\r\n            });\r\n        } else{\r\n            BB.css(pickerButton, {\r\n                filter: ''\r\n            });\r\n            BB.css(hexButton, {\r\n                filter: ''\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    updateSVCanvas();\r\n    div.style.width = width + 'px';\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    const SVContainer = document.createElement('div');\r\n    BB.css(SVContainer, {\r\n        width: width + 'px',\r\n        height: svHeight + 'px',\r\n        overflow: 'hidden',\r\n        display: 'block',\r\n        position: 'relative',\r\n        cursor: 'crosshair',\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\r\n    });\r\n\r\n    const pointerSV = document.createElement('div');\r\n    BB.css(pointerSV, {\r\n        width: '12px',\r\n        height: '12px',\r\n        borderRadius: '6px',\r\n        position: 'absolute',\r\n        pointerEvents: 'none',\r\n        boxShadow: '0px 0px 0 1px #000, inset 0px 0px 0 1px #fff'\r\n    });\r\n\r\n    SVContainer.appendChild(svWrapper);\r\n    SVContainer.appendChild(pointerSV);\r\n    updateSVPointer();\r\n    div.appendChild(SVContainer);\r\n    div.appendChild(divH);\r\n    outputDiv.appendChild(divPreview);\r\n    BB.css(divPreview, {\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        width: (height * 2.5) + 'px',\r\n        height: height + 'px',\r\n        //position: \"relative\",\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\r\n        colorScheme: 'only light',\r\n    });\r\n\r\n    BB.css(divH, {\r\n        overflow: 'hidden',\r\n        position: 'relative',\r\n        width: width + 'px',\r\n        height: height + 'px',\r\n        cursor: 'ew-resize',\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\r\n        marginTop: '1px',\r\n        marginBottom: '1px'\r\n    });\r\n\r\n    //divH.className = \"svSlider\";\r\n    BB.css(controlH, {\r\n        width: '1px',\r\n        height: height + 'px',\r\n        background: '#000',\r\n        borderLeft: '1px solid #fff',\r\n        position: 'absolute',\r\n        top: '0',\r\n        left: parseInt('' + (primaryColorHSV.h / 360 * width - 1)) + 'px'\r\n    });\r\n\r\n\r\n    const virtualHSV = {\r\n        h: 0,\r\n        s: 0,\r\n        v: 0\r\n    };\r\n    let svPointerListener;\r\n    let hPointerListener;\r\n\r\n\r\n    const pickerButton = BB.el({\r\n        title: LANG('eyedropper') + ' [Alt]',\r\n        className: 'color-picker-preview-button',\r\n        css: {\r\n            width: '30px',\r\n            height: '30px',\r\n            backgroundImage: 'url(' + eyedropperImg + ')',\r\n            backgroundRepeat:  'no-repeat',\r\n            backgroundSize: '70%',\r\n            backgroundPosition: 'center'\r\n        }\r\n    });\r\n    let isPicking = false;\r\n\r\n\r\n    pickerButton.onclick = function () {\r\n        if (isPicking === false) {\r\n            pickerButton.classList.remove('color-picker-preview-button-hover');\r\n            pickerButton.classList.add('color-picker-preview-button-active');\r\n            isPicking = true;\r\n            pickCallback(true);\r\n        } else {\r\n            pickCallback(false);\r\n            _this.pickingDone();\r\n        }\r\n    };\r\n    const pickerButtonPointerListener = new BB.PointerListener({\r\n        target: pickerButton,\r\n        onEnterLeave: function(isOver) {\r\n            if (isPicking) {\r\n                return;\r\n            }\r\n            pickerButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n        }\r\n    });\r\n    divPreview.appendChild(pickerButton);\r\n\r\n\r\n    const hexButton = BB.el({\r\n        content: '#',\r\n        className: 'color-picker-preview-button',\r\n        title: LANG('manual-color-input'),\r\n        css: {\r\n            height: '100%',\r\n            width: height + 'px',\r\n            lineHeight: height + 'px',\r\n            fontSize: (height * 0.65) + 'px'\r\n        },\r\n        onClick: function() {\r\n            HexColorDialog({\r\n                color: new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b),\r\n                onClose: function(rgbObj) {\r\n                    if (!rgbObj) {\r\n                        return;\r\n                    }\r\n                    _this.setColor(rgbObj);\r\n                    emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\r\n                }\r\n            });\r\n        }\r\n    });\r\n    const hexButtonPointerListener = new BB.PointerListener({\r\n        target: hexButton,\r\n        onEnterLeave: function(isOver) {\r\n            hexButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n        }\r\n    });\r\n    divPreview.appendChild(hexButton);\r\n\r\n    setColPreview();\r\n\r\n\r\n    setTimeout(function() {\r\n        createHueBg(divH);\r\n        divH.appendChild(controlH);\r\n        svPointerListener = new BB.PointerListener({\r\n            target: svWrapper,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown') {\r\n\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    BB.unfocusAnyInput();\r\n\r\n                    BB.css(SVContainer, {\r\n                        boxShadow: '0px 0px 0px 1px rgb(255,255,255)',\r\n                        zIndex: '1'\r\n                    });\r\n\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.s = event.relX / width * 100;\r\n                        virtualHSV.v = 100 - event.relY / svHeight * 100;\r\n\r\n                        primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n\r\n                        updateSVPointer();\r\n                        setColPreview();\r\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n                    } else {\r\n                        virtualHSV.s = primaryColorHSV.s;\r\n                        virtualHSV.v = primaryColorHSV.v;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                    let factor = 1;\r\n                    if (event.button === 'right') {\r\n                        factor = 0.5;\r\n                    }\r\n\r\n                    virtualHSV.s += event.dX / width * 100 * factor;\r\n                    virtualHSV.v -= event.dY / svHeight * 100 * factor;\r\n\r\n                    primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                    updateSVPointer();\r\n                    setColPreview();\r\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n\r\n                }\r\n\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(SVContainer, {\r\n                        boxShadow: '0 0 0 1px rgb(188, 188, 188)',\r\n                        zIndex: '0'\r\n                    });\r\n                }\r\n\r\n            }\r\n        });\r\n        hPointerListener = new BB.PointerListener({\r\n            target: divH,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n\r\n                if (event.type === 'pointerdown') {\r\n\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    BB.unfocusAnyInput();\r\n\r\n                    BB.css(divH, {\r\n                        boxShadow: '0px 0px 0px 1px rgba(255,255,255,1)'\r\n                    });\r\n\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.h = event.relX / width * 359.99;\r\n\r\n                        primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\r\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                        controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\r\n                        updateSVCanvas();\r\n                        setColPreview();\r\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n                    } else {\r\n                        virtualHSV.h = primaryColorHSV.h;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                    const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                    const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                    virtualHSV.h += event.dX / width * 359.99 * factor;\r\n\r\n                    if (event.button === 'right') {\r\n                        virtualHSV.h = virtualHSV.h % 359.99;\r\n                        if (virtualHSV.h < 0) {\r\n                            virtualHSV.h += 359.99;\r\n                        }\r\n                    }\r\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                    primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\r\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                    controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\r\n                    updateSVCanvas();\r\n                    setColPreview();\r\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n\r\n                }\r\n\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(divH, {\r\n                        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    }, 1);\r\n\r\n\r\n    // --- second color ---\r\n\r\n    const secondaryColorBtn = BB.el({\r\n        parent: outputDiv,\r\n        title: LANG('secondary-color') + ' [X]',\r\n        css: {\r\n            cursor: 'pointer',\r\n            marginLeft: '5px',\r\n            width: '22px',\r\n            height: '22px',\r\n            boxShadow: 'rgb(188, 188, 188) 0px 0px 0px 1px',\r\n            colorScheme: 'only light',\r\n        },\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            swapColors();\r\n        }\r\n    });\r\n    function updateSecondaryColor() {\r\n        secondaryColorBtn.style.backgroundColor = BB.ColorConverter.toRgbStr(secondaryColorRGB);\r\n    }\r\n    function swapColors() {\r\n        // swap hsv\r\n        let tmp: any = secondaryColorHSV;\r\n        secondaryColorHSV = primaryColorHSV;\r\n        updatePrimaryHSV(tmp);\r\n        // swap rgb\r\n        tmp = secondaryColorRGB;\r\n        secondaryColorRGB = primaryColorRGB;\r\n        primaryColorRGB = tmp;\r\n\r\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\r\n        updateSVCanvas();\r\n        updateSVPointer();\r\n        setColPreview();\r\n        updateSecondaryColor();\r\n\r\n        emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\r\n    }\r\n    updateSecondaryColor();\r\n\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.setColor = function (c) {\r\n        primaryColorRGB = {r: parseInt(c.r, 10), g: parseInt(c.g, 10), b: parseInt(c.b, 10)};\r\n        updatePrimaryHSV(BB.ColorConverter.toHSV(c));\r\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\r\n        updateSVCanvas();\r\n        updateSVPointer();\r\n        setColPreview();\r\n    };\r\n\r\n    this.getColor = function () {\r\n        return new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b);\r\n    };\r\n\r\n    this.getSecondaryRGB = function() {\r\n        return new BB.RGB(secondaryColorRGB.r, secondaryColorRGB.g, secondaryColorRGB.b);\r\n    };\r\n\r\n    this.setPickCallback = function (func) {\r\n        pickCallback = func;\r\n    };\r\n\r\n    this.pickingDone = function () {\r\n        if (!isPicking) {\r\n            return;\r\n        }\r\n        isPicking = false;\r\n        pickerButton.classList.remove('color-picker-preview-button-active');\r\n    };\r\n\r\n    this.enable = function (e) {\r\n        if (e) {\r\n            div.style.pointerEvents = '';\r\n            div.style.opacity = '1';\r\n            outputDiv.style.pointerEvents = '';\r\n            outputDiv.style.opacity = '1';\r\n        } else {\r\n            div.style.pointerEvents = 'none';\r\n            div.style.opacity = '0.5';\r\n            outputDiv.style.pointerEvents = 'none';\r\n            outputDiv.style.opacity = '0.5';\r\n        }\r\n    };\r\n\r\n    this.setHeight = function (h) {\r\n        h = parseInt('' +(h - height * 2 - 3), 10);\r\n        if (h === svHeight) {\r\n            return;\r\n        }\r\n        svHeight = h;\r\n        BB.css(svSvg, {\r\n            width: width + 'px',\r\n            height: svHeight + 'px'\r\n        });\r\n        SVContainer.style.height = svHeight + 'px';\r\n        updateSVPointer();\r\n    };\r\n\r\n    this.swapColors = function() {\r\n        swapColors();\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.getOutputElement = function() {\r\n        return outputDiv;\r\n    }\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cTtMO\");","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\n\r\n\r\n/**\r\n * a small color slider\r\n *\r\n * params {\r\n * \t width: 200,\r\n * \t heightSV: 200,\r\n * \t heightH: 10,\r\n * \t color: {r,g,b}\r\n * \t callback: function(c){}\r\n * }\r\n *\r\n * @param params\r\n * @constructor\r\n */\r\nexport const KlSmallColorSlider = function (params) {\r\n    const div = document.createElement('div');\r\n    div.oncontextmenu = function(e) {\r\n        e.preventDefault();\r\n    };\r\n    let color = BB.ColorConverter.toHSV(new BB.RGB(params.color.r, params.color.g, params.color.b));\r\n    BB.css(div, {\r\n        width: params.width + 'px',\r\n        position: 'relative',\r\n        overflow: 'hidden',\r\n        userSelect: 'none'\r\n    });\r\n\r\n    const canvasSV = BB.canvas(10, 10);\r\n    canvasSV.style.width = params.width + 'px';\r\n    canvasSV.style.height = params.heightSV + 'px';\r\n    canvasSV.style.cursor = 'crosshair';\r\n\r\n    function updateSV() {\r\n        const ctx = canvasSV.getContext('2d');\r\n        for (let i = 0; i < canvasSV.height; i += 1) {\r\n            const gradient1 = ctx.createLinearGradient(0, 0, canvasSV.width, 0);\r\n\r\n            const colleft = BB.ColorConverter.toRGB(new BB.HSV(color.h, 1, 100 - (i / canvasSV.height * 100.0)));\r\n            const colright = BB.ColorConverter.toRGB(new BB.HSV(color.h, 100, 100 - (i / canvasSV.height * 100.0)));\r\n            gradient1.addColorStop(0, '#' + BB.ColorConverter.toHexString(colleft));\r\n            gradient1.addColorStop(1, '#' + BB.ColorConverter.toHexString(colright));\r\n            ctx.fillStyle = '#ff0000'; //needed for chrome...otherwise alpha problem\r\n            ctx.fillStyle = gradient1;\r\n            ctx.fillRect(0, i, canvasSV.width, 1);\r\n        }\r\n    }\r\n\r\n    updateSV();\r\n\r\n    const canvasH = BB.canvas(params.width, params.heightH);\r\n    canvasH.style.cursor = 'ew-resize';\r\n    (function () {\r\n        const ctx = canvasH.getContext('2d');\r\n\r\n        const gradH = ctx.createLinearGradient(0, 0, params.width, 0);\r\n        for (let i = 0; i < 1; i += 0.01) {\r\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n            gradH.addColorStop(i, 'rgba(' + parseInt('' + col.r) + ', ' + parseInt('' + col.g) + ', ' + parseInt('' + col.b) + ', 1)');\r\n        }\r\n        ctx.fillStyle = gradH;\r\n        ctx.fillRect(0, 0, params.width, params.heightH);\r\n\r\n    })();\r\n    BB.css(canvasSV, {\r\n        width: params.width + 'px',\r\n        height: params.heightSV + 'px',\r\n        overflow: 'hidden',\r\n        position: 'relative'\r\n    });\r\n    canvasSV.style.cssFloat = 'left';\r\n    canvasH.style.cssFloat = 'left';\r\n\r\n    div.appendChild(canvasSV);\r\n    div.appendChild(canvasH);\r\n\r\n    const pointerSV = document.createElement('div');\r\n    BB.css(pointerSV, {\r\n        width: '8px',\r\n        height: '8px',\r\n        borderRadius: '8px',\r\n        position: 'absolute',\r\n        pointerEvents: 'none',\r\n        boxShadow: '0 0 0 1px #000, inset 0 0 0 1px #fff'\r\n    });\r\n    div.appendChild(pointerSV);\r\n\r\n    const pointerH = document.createElement('div');\r\n    BB.css(pointerH, {\r\n        width: '0',\r\n        height: params.heightH + 'px',\r\n        borderLeft: '1px solid #fff',\r\n        borderRight: '1px solid #000',\r\n        position: 'absolute',\r\n        top: params.heightSV + 'px',\r\n        pointerEvents: 'none'\r\n    });\r\n    div.appendChild(pointerH);\r\n\r\n\r\n    function updateSVPointer() {\r\n        const left = color.s / 100 * params.width - 4;\r\n        const top = (1 - color.v / 100) * params.heightSV - 4;\r\n        BB.css(pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px'\r\n        });\r\n        /*if (top < params.heightSV/3) {\r\n        pointerSV.style.border = \"1px solid rgba(0,0,0,1)\";\r\n    } else {\r\n        pointerSV.style.border = \"1px solid rgba(255,255,255,1)\";\r\n    }*/\r\n    }\r\n\r\n    function updateHPointer() {\r\n        pointerH.style.left = (color.h / 359.999 * params.width - 1) + 'px';\r\n    }\r\n\r\n    updateSVPointer();\r\n    updateHPointer();\r\n\r\n    const virtualHSV = {\r\n        h: 0,\r\n        s: 0,\r\n        v: 0\r\n    };\r\n\r\n    let svPointerId = null;\r\n    const svPointerListener = new BB.PointerListener({\r\n        target: canvasSV,\r\n        maxPointers: 1,\r\n        fixScribble: true,\r\n        onPointer: function(event) {\r\n\r\n            if (event.type === 'pointerdown') {\r\n\r\n                // prevent manual slider input keeping focus on iPad\r\n                BB.unfocusAnyInput();\r\n\r\n                svPointerId = event.pointerId;\r\n                if (event.button === 'left') {\r\n\r\n                    virtualHSV.s = event.relX / params.width * 100;\r\n                    virtualHSV.v = 100 - event.relY / params.heightSV * 100;\r\n\r\n                    color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\r\n\r\n                    updateSVPointer();\r\n                    params.callback(BB.ColorConverter.toRGB(color));\r\n                } else {\r\n                    virtualHSV.s = color.s;\r\n                    virtualHSV.v = color.v;\r\n                }\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && svPointerId === event.pointerId) {\r\n\r\n                let factor = 1;\r\n                if (event.button === 'right') {\r\n                    factor = 0.5;\r\n                }\r\n\r\n                virtualHSV.s += event.dX / params.width * 100 * factor;\r\n                virtualHSV.v -= event.dY / params.heightSV * 100 * factor;\r\n\r\n                color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\r\n                updateSVPointer();\r\n                params.callback(BB.ColorConverter.toRGB(color));\r\n\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                svPointerId = null;\r\n            }\r\n\r\n        }\r\n    });\r\n\r\n    let hPointerId = null;\r\n    const hPointerListener = new BB.PointerListener({\r\n        target: canvasH,\r\n        maxPointers: 1,\r\n        fixScribble: true,\r\n        onPointer: function(event) {\r\n\r\n            if (event.type === 'pointerdown') {\r\n                hPointerId = event.pointerId;\r\n                if (event.button === 'left') {\r\n\r\n                    virtualHSV.h = event.relX / params.width * 359.99;\r\n\r\n                    color = new BB.HSV(virtualHSV.h, color.s, color.v);\r\n                    updateSV();\r\n                    updateHPointer();\r\n                    params.callback(BB.ColorConverter.toRGB(color));\r\n                } else {\r\n                    virtualHSV.h = color.h;\r\n                }\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && hPointerId === event.pointerId) {\r\n\r\n                const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                virtualHSV.h += event.dX / params.width * 359.99 * factor;\r\n\r\n                if (event.button === 'right') {\r\n                    virtualHSV.h = virtualHSV.h % 359.99;\r\n                    if (virtualHSV.h < 0) {\r\n                        virtualHSV.h += 359.99;\r\n                    }\r\n                }\r\n                virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                color = new BB.HSV(virtualHSV.h, color.s, color.v);\r\n                updateSV();\r\n                updateHPointer();\r\n                params.callback(BB.ColorConverter.toRGB(color));\r\n\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                hPointerId = null;\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    const cleardiv = document.createElement('div');\r\n    cleardiv.style.clear = 'both';\r\n    div.appendChild(cleardiv);\r\n\r\n    // --- interface ---\r\n    this.setColor = function (c) {\r\n        color = BB.ColorConverter.toHSV(new BB.RGB(c.r, c.g, c.b));\r\n        updateSV();\r\n        updateSVPointer();\r\n        updateHPointer();\r\n    };\r\n    this.getColor = function () {\r\n        return BB.ColorConverter.toRGB(color);\r\n    };\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.destroy = function() {\r\n        svPointerListener.destroy();\r\n        hPointerListener.destroy();\r\n    };\r\n    this.end = function() {\r\n        svPointerId = null;\r\n        hPointerId = null;\r\n    };\r\n\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n\r\n/**\r\n * a slider that looks like this\r\n * ------O----\r\n *\r\n * param: {init, width, pointSize, callback(value, isFirst, isLast)}\r\n *\r\n * @param param\r\n * @constructor\r\n */\r\nexport const PointSlider = function(param) {\r\n\r\n    const div = document.createElement('div');\r\n    div.style.position = 'relative';\r\n    const sliderLine = BB.el({});\r\n    const sliderPoint = BB.el({\r\n        css: {\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.appendChild(sliderLine);\r\n    div.appendChild(sliderPoint);\r\n    let sliderPos;\r\n    let isDragging = false;\r\n\r\n    //sliderLine\r\n    {\r\n        BB.css(sliderLine, {\r\n            marginTop: parseInt('' + (param.pointSize / 2 - 1)) + 'px',\r\n            height: '2px',\r\n            background: '#aaa',\r\n            width: param.width + 'px'\r\n        });\r\n    }\r\n    //sliderPoint\r\n    const touchAreaEl = BB.el({ // expand clickable area\r\n        parent: sliderPoint,\r\n        css: {\r\n            // background: 'rgba(255,0,0,0.4)',\r\n            margin: '-7px 0 0 -7px',\r\n            width: 'calc(100% + 14px)',\r\n            height: 'calc(100% + 7px)',\r\n        }\r\n    });\r\n\r\n    function redrawPoint() {\r\n        sliderPoint.style.left = sliderPos + 'px';\r\n        if (isDragging) {\r\n            sliderPoint.style.boxShadow = '0 0 6px rgba(0,0,0,1)';\r\n        } else {\r\n            sliderPoint.style.boxShadow = '0 0 3px rgba(0,0,0,0.8)';\r\n        }\r\n    }\r\n    function getValue() {\r\n        return sliderPos /  (param.width - param.pointSize);\r\n    }\r\n\r\n    let pointerListener;\r\n    {\r\n        let isFirst;\r\n        sliderPos = BB.clamp(param.init * (param.width - param.pointSize), 0, param.width - param.pointSize);\r\n        BB.css(sliderPoint, {\r\n            position: 'absolute',\r\n            top: '0px',\r\n            backgroundColor: '#eaeaea',\r\n            boxShadow: '0 0 3px rgba(0,0,0,0.8)',\r\n            width: param.pointSize + 'px',\r\n            height: param.pointSize + 'px',\r\n            borderRadius: param.pointSize + 'px',\r\n            cursor: 'ew-resize',\r\n            transition: 'box-shadow 0.2s ease-in-out'\r\n        });\r\n        redrawPoint();\r\n        let imaginaryPos;\r\n        pointerListener = new BB.PointerListener({\r\n            target: sliderPoint,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    isFirst = true;\r\n                    isDragging = true;\r\n                    imaginaryPos = sliderPos;\r\n                    redrawPoint();\r\n                    event.eventStopPropagation();\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                    event.eventStopPropagation();\r\n                    imaginaryPos = imaginaryPos + event.dX;\r\n                    sliderPos = parseInt('' + BB.clamp(imaginaryPos, 0, param.width - param.pointSize));\r\n                    redrawPoint();\r\n                    param.callback(getValue(), isFirst, false);\r\n                    isFirst = false;\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    event.eventStopPropagation();\r\n                    isDragging = false;\r\n                    redrawPoint();\r\n                    param.callback(getValue(), false, true);\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    // --- interface ---\r\n    this.getEl = function() {\r\n        return div;\r\n    };\r\n    this.setActive = function(isActive) {\r\n        if (isActive) {\r\n            sliderPoint.style.backgroundColor = '#fff';\r\n        } else {\r\n            sliderPoint.style.backgroundColor = '#eaeaea';\r\n        }\r\n    };\r\n    this.destroy = function() {\r\n        pointerListener.destroy();\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * UI to pick between colors in colorArr. can display full transparent (checkerboard).\r\n * Can't deal with 0.5 alpha.\r\n * Rectangular buttons.\r\n *\r\n * p = {\r\n *     colorArr: rgba[], // duplicates are removed\r\n *     onChange: func(rgbaObj),\r\n *     label: string,\r\n *     initialIndex: int// optional, index before duplicates were removed\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const ColorOptions = function(p) {\r\n    const div = BB.el({\r\n        content: p.label ? p.label : '',\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n\r\n    let selectedIndex = 0;\r\n    const colorArr = [];\r\n    const buttonArr = [];\r\n    const buttonSize = 22;\r\n    const checkerUrl = BB.createCheckerDataUrl(5);\r\n\r\n    // build colorArr while removing duplicates\r\n    for (let i = 0; i < p.colorArr.length; i++) {\r\n        const item = p.colorArr[i];\r\n        let found = false;\r\n        for (let e = 0; e < colorArr.length; e++) {\r\n            const sItem = colorArr[e];\r\n            if (sItem === null || item === null) {\r\n                continue;\r\n            }\r\n            if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\r\n                found = true;\r\n                break;\r\n            }\r\n        }\r\n        if (found) {\r\n            continue;\r\n        }\r\n        colorArr.push(item);\r\n        if ('initialIndex' in p && p.initialIndex === i) {\r\n            selectedIndex = colorArr.length - 1;\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < colorArr.length; i++) {\r\n        (function(i) {\r\n\r\n            const colorButton = BB.el({\r\n                content: colorArr[i] ? '' : 'X',\r\n                css: {\r\n                    width: buttonSize + 'px',\r\n                    height: buttonSize + 'px',\r\n                    backgroundColor: colorArr[i] ? BB.ColorConverter.toRgbaStr(colorArr[i]) : 'transparent',\r\n                    marginLeft: '7px',\r\n                    boxShadow: '0 0 0 1px #aaa',\r\n                    cursor: 'pointer',\r\n                    userSelect: 'none',\r\n                    textAlign: 'center',\r\n                    lineHeight: (buttonSize + 1) + 'px',\r\n                    color: '#aaa'\r\n                }\r\n            });\r\n            if (colorArr[i] && colorArr[i].a === 0) {\r\n                colorButton.style.backgroundImage = 'url(' + checkerUrl + ')';\r\n            }\r\n\r\n            colorButton.onclick = function(e) {\r\n                e.preventDefault();\r\n                selectedIndex = i;\r\n                update();\r\n                p.onChange(colorArr[i]);\r\n            };\r\n\r\n            (colorButton as any).setIsSelected = function(b) {\r\n                if (b) {\r\n                    BB.css(colorButton, {\r\n                        boxShadow: '0 0 0 2px var(--active-highlight-color), 0 0 5px 0 var(--active-highlight-color)',\r\n                        pointerEvents: 'none'\r\n                    });\r\n                } else {\r\n                    BB.css(colorButton, {\r\n                        boxShadow: '0 0 0 1px #aaa',\r\n                        pointerEvents: ''\r\n                    });\r\n                }\r\n            };\r\n\r\n\r\n            div.appendChild(colorButton);\r\n            buttonArr.push(colorButton);\r\n        })(i);\r\n    }\r\n\r\n\r\n    function update() {\r\n        for (let i = 0; i < buttonArr.length; i++) {\r\n            buttonArr[i].setIsSelected(i === selectedIndex);\r\n        }\r\n    }\r\n    update();\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.destroy = () => {\r\n        buttonArr.forEach(item => {\r\n            item.onclick = null;\r\n        });\r\n        buttonArr.splice(0, buttonArr.length);\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * selectable options\r\n * p = {\r\n *     optionArr: {\r\n *          id: string,\r\n *          label: string | HTMLElement\r\n *     }[],\r\n *     initialId?: string,\r\n *     onChange: function(id string): void,\r\n *     changeOnInit?: boolean, // trigger change on creation\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const Options = function(p) {\r\n    const div = BB.el({});\r\n\r\n    const wrapperEl = BB.el({\r\n        parent: div,\r\n        className: 'kl-option-wrapper',\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n\r\n    const optionArr: {\r\n        id: string;\r\n        el: HTMLElement;\r\n    }[] = [];\r\n    let selectedId = 'initialId' in p ? p.initialId : p.optionArr[0].id;\r\n\r\n    function createOption(o) {\r\n        const optionObj = {\r\n            id: o.id,\r\n            el: null,\r\n        };\r\n\r\n        const classArr = ['kl-option'];\r\n        if (p.isSmall) {\r\n            classArr.push('kl-option--small');\r\n        }\r\n        if (typeof o.label !== 'string') {\r\n            classArr.push('kl-option--custom-el');\r\n            BB.css(o.label, {\r\n                display: 'block',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n\r\n        optionObj.el = BB.el({\r\n            parent: wrapperEl,\r\n            content: o.label,\r\n            className: classArr.join(' '),\r\n            onClick: function() {\r\n                if (selectedId !== optionObj.id) {\r\n                    selectedId = optionObj.id;\r\n                    update();\r\n                    p.onChange(selectedId);\r\n                }\r\n            }\r\n        });\r\n\r\n        if (o.title) {\r\n            optionObj.el.title = o.title;\r\n        }\r\n\r\n        optionArr.push(optionObj);\r\n    }\r\n\r\n    function update() {\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            optionArr[i].el.classList.toggle('kl-option-selected', optionArr[i].id === selectedId);\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < p.optionArr.length; i++) {\r\n        createOption(p.optionArr[i]);\r\n    }\r\n\r\n    update();\r\n\r\n    if (p.changeOnInit) {\r\n        setTimeout(function() {\r\n            p.onChange(selectedId);\r\n        }, 0);\r\n    }\r\n\r\n    function getIndex() {\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            if (optionArr[i].id === selectedId) {\r\n                return i;\r\n            }\r\n        }\r\n    }\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.getValue = function() {\r\n        return selectedId;\r\n    }\r\n    this.next = function() {\r\n        selectedId = optionArr[(getIndex() + 1) % optionArr.length].id;\r\n        update();\r\n        p.onChange(selectedId);\r\n    };\r\n    this.previous = function() {\r\n        selectedId = optionArr[(optionArr.length + getIndex() - 1) % optionArr.length].id;\r\n        update();\r\n        p.onChange(selectedId);\r\n    };\r\n    this.destroy = () => {\r\n        optionArr.forEach(item => {\r\n            BB.destroyEl(item.el);\r\n        });\r\n        optionArr.splice(0, optionArr.length);\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport angleSvg from 'url:~/src/app/img/ui/angle.svg';\r\n\r\n\r\ntype TUiState = 'left' | 'right';\r\n\r\n/**\r\n * display little messages at the top of KlWorkspace\r\n */\r\nexport class StatusOverlay {\r\n\r\n    private el: HTMLDivElement;\r\n    private innerEl: HTMLDivElement;\r\n    private angleIm: HTMLImageElement;\r\n    private innerInnerEl: HTMLDivElement;\r\n    private isWide: boolean;\r\n    private uiState: TUiState;\r\n\r\n    private timeout: number;\r\n    private timeout2: number;\r\n    private timeout3: number;\r\n\r\n    private updateUiState() {\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n        setTimeout(()=>{}, 100);\r\n        if (this.uiState === 'left') {\r\n            this.el.style.left = '271px';\r\n        } else {\r\n            this.el.style.removeProperty('left');\r\n        }\r\n    }\r\n\r\n    private init() {\r\n        this.el = BB.el({\r\n            className: \"top-overlay g-root\",\r\n            onClick: BB.handleClick,\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n        }\r\n\r\n        this.updateUiState();\r\n\r\n        this.innerEl = BB.el({\r\n            className: 'top-overlay-inner',\r\n        }) as HTMLDivElement\r\n\r\n\r\n        this.angleIm = new Image();\r\n        this.angleIm.src = angleSvg;\r\n        BB.css(this.angleIm, {\r\n            verticalAlign: 'bottom',\r\n            width: '20px',\r\n            height: '20px',\r\n            marginLeft: '5px',\r\n            borderRadius: '10px'\r\n        });\r\n\r\n        this.innerInnerEl = document.createElement('div');\r\n        this.innerInnerEl.style.display = 'inline-block';\r\n\r\n        this.innerEl.appendChild(this.innerInnerEl);\r\n        this.innerEl.appendChild(this.angleIm);\r\n        this.el.appendChild(this.innerEl);\r\n        document.body.appendChild(this.el);\r\n        this.el.style.display = \"none\";\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        this.init();\r\n    }\r\n\r\n    setWide(b: boolean) {\r\n        this.isWide = !!b;\r\n\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n            this.el.style.left = '';\r\n        } else {\r\n            this.el.style.removeProperty('width');\r\n            this.el.style.left = this.uiState === 'left' ? '271px' : '';\r\n        }\r\n    }\r\n\r\n    setUiState(state: TUiState) {\r\n        this.uiState = state;\r\n        this.updateUiState();\r\n    }\r\n\r\n    out(msg: string | {type: 'transform', angleDeg: number, scale: number}, doPulse?: boolean) {\r\n\r\n        if (msg && typeof msg === 'object') {\r\n\r\n            if (msg.type === 'transform') {\r\n                this.angleIm.style.display = 'inline-block';\r\n                this.angleIm.style.transform = 'rotate(' + msg.angleDeg + 'deg)';\r\n\r\n                if (msg.angleDeg % 90 === 0) {\r\n                    this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255, 255, 255, 0.7)';\r\n                } else {\r\n                    this.angleIm.style.boxShadow = '';\r\n                }\r\n\r\n                this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + \"%\";\r\n\r\n\r\n            } else {\r\n                this.angleIm.style.display = 'none';\r\n            }\r\n\r\n\r\n\r\n        } else if (typeof msg === 'string') {\r\n            this.angleIm.style.display = 'none';\r\n            this.innerInnerEl.innerHTML = msg;\r\n        }\r\n\r\n        if (doPulse) {\r\n            this.innerEl.style.animation = '';\r\n            setTimeout(\r\n                () => this.innerEl.style.animation = 'top-overlay-pulse 0.5s ease-out',\r\n                20\r\n            );\r\n            if (this.timeout3) {\r\n                clearTimeout(this.timeout3);\r\n            }\r\n            this.timeout3 = window.setTimeout(\r\n                () => this.innerEl.style.animation = '',\r\n                520\r\n            );\r\n        }\r\n\r\n\r\n\r\n        if (this.timeout) {\r\n            clearTimeout(this.timeout);\r\n        }\r\n        if (this.timeout2) {\r\n            clearTimeout(this.timeout2);\r\n        }\r\n        this.el.style.animationName = doPulse ? 'consoleInFast' : \"consoleIn\";\r\n        this.el.style.opacity = \"1\";\r\n        this.timeout = window.setTimeout(() => {\r\n            this.el.style.opacity = \"0\";\r\n            this.el.style.animationName = \"consoleOut\";\r\n            this.timeout2 = window.setTimeout(() => {\r\n                this.el.style.display = \"none\";\r\n                this.timeout2 = 0;\r\n            }, 450);\r\n            this.timeout = 0;\r\n        }, 1200);\r\n        this.el.style.display = \"flex\";\r\n    }\r\n\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iQ1f0\");","import {BB} from '../../../bb/bb';\r\nimport {popup} from './popup';\r\n\r\nexport function exportDialog(parent, image) {\r\n    let boxSize, aboutCloseFunc, aboutDiv, closed, aniToggle, imageContainer, coverImage, coverSize,\r\n        text, holding, aniTimeout, halfBoxSize;\r\n    boxSize = 22 * 2;\r\n    halfBoxSize = 22;\r\n    aboutCloseFunc = function () {\r\n    };\r\n    closed = false;\r\n    aniToggle = false;\r\n    aboutDiv = document.createElement(\"div\");\r\n    BB.css(aboutDiv, {\r\n        width: (7 * boxSize) + \"px\"\r\n    });\r\n\r\n    imageContainer = document.createElement(\"div\");\r\n    coverImage = new Image();\r\n    coverImage.src = image.src;\r\n\r\n    imageContainer.appendChild(coverImage);\r\n    imageContainer.appendChild(image);\r\n\r\n    BB.css(imageContainer, {\r\n        width: (6 * boxSize) + \"px\",\r\n        height: (4 * boxSize) + \"px\",\r\n        marginTop: (boxSize / 2 - 1) + \"px\",\r\n        marginLeft: (boxSize / 2 - 1) + \"px\",\r\n        position: \"relative\",\r\n        overflow: \"hidden\",\r\n        boxShadow: \"0 0 10px 4px rgba(255,255,255, 0)\",\r\n        border: \"1px solid rgba(255, 255, 255, 1)\",\r\n        transition: \"box-shadow 0.7s linear\"\r\n    });\r\n    BB.css(image, {\r\n        position: \"absolute\",\r\n        left: '0',\r\n        top: '0',\r\n        width: (6 * boxSize) + \"px\",\r\n        height: (4 * boxSize) + \"px\",\r\n        opacity: '0'\r\n    });\r\n    coverSize = {\r\n        width: (6 * boxSize),\r\n        height: (6 * boxSize / image.width) * image.height\r\n    };\r\n    if (coverSize.height < (4 * boxSize)) {\r\n        coverSize.height = (4 * boxSize);\r\n        coverSize.width = (coverSize.height / image.height) * image.width;\r\n    }\r\n    BB.css(coverImage, {\r\n        position: \"absolute\",\r\n        top: (2 * boxSize) + \"px\",\r\n        left: (3 * boxSize) + \"px\",\r\n        width: coverSize.width + \"px\",\r\n        height: coverSize.height + \"px\",\r\n        marginLeft: (-coverSize.width / 2) + \"px\",\r\n        marginTop: (-coverSize.height / 2) + \"px\"\r\n    });\r\n\r\n    function animation() {\r\n        if (closed) {\r\n            return;\r\n        }\r\n        aniToggle = !aniToggle;\r\n        if (aniToggle) {\r\n            BB.css(imageContainer, {\r\n                border: \"1px solid rgba(0, 0, 0, 1)\"\r\n            });\r\n        } else {\r\n            BB.css(imageContainer, {\r\n                border: \"1px solid rgba(200, 200, 200, 1)\"\r\n            });\r\n        }\r\n        setTimeout(animation, 510);\r\n    }\r\n\r\n    animation();\r\n\r\n    text = document.createElement(\"div\");\r\n    text.innerHTML = \"Right-Click or Press-Hold on the image, then save.\";\r\n    text.ontouchstart = function () {\r\n        return false;\r\n    };\r\n    BB.css(text, {\r\n        fontSize: (boxSize / 2.5) + \"px\",\r\n        color: \"#666\",\r\n        padding: \"10px\",\r\n        textAlign: \"center\"\r\n    });\r\n\r\n    aboutDiv.appendChild(imageContainer);\r\n    aboutDiv.appendChild(text);\r\n\r\n    holding = false;\r\n    image.ontouchstart = function () {\r\n        BB.css(imageContainer, {\r\n            boxShadow: \"0 0 10px 8px rgba(0,255,255, 1)\"\r\n        });\r\n        holding = true;\r\n        aniTimeout = setTimeout(function () {\r\n            holding = false;\r\n            BB.css(imageContainer, {\r\n                boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\r\n            });\r\n        }, 1500);\r\n    };\r\n    image.ontouchmove = function () {\r\n        BB.css(imageContainer, {\r\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\r\n        });\r\n        holding = false;\r\n        clearTimeout(aniTimeout);\r\n    };\r\n    image.ontouchend = function () {\r\n        BB.css(imageContainer, {\r\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\r\n        });\r\n        holding = false;\r\n        clearTimeout(aniTimeout);\r\n    };\r\n\r\n    popup({\r\n        target: parent,\r\n        message: \"<b>Save Image</b>\",\r\n        div: aboutDiv,\r\n        buttons: [\"Close\"],\r\n        callback: function (result) {\r\n            closed = true;\r\n        }\r\n    });\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * element that lets you crop an image and copy it via right click\r\n *\r\n * param = {\r\n *     width: number,\r\n *     height: number,\r\n *     canvas: image | canvas,\r\n *     isNotCopy: boolean,\r\n *     onChange: function(width, height)\r\n * }\r\n *\r\n * @param param object\r\n * @constructor\r\n */\r\nexport function CropCopy(param) {\r\n    const div = document.createElement('div');\r\n    BB.css(div, {\r\n        position: 'relative',\r\n        height: param.height + 'px',\r\n        width: param.width + 'px',\r\n        overflow: 'hidden',\r\n        colorScheme: 'only light',\r\n    });\r\n    div.style.position = 'relative';\r\n\r\n    let crop;\r\n    function resetCrop() {\r\n        crop = {\r\n            x: 0,\r\n            y: 0,\r\n            width: param.canvas.width,\r\n            height: param.canvas.height\r\n        };\r\n    }\r\n    resetCrop();\r\n\r\n\r\n    function updateCroppedCanvas() {\r\n        croppedCanvas.width = Math.round(crop.width);\r\n        croppedCanvas.height = Math.round(crop.height);\r\n        let ctx = croppedCanvas.getContext('2d');\r\n        ctx.drawImage(param.canvas, Math.round(-crop.x), Math.round(-crop.y));\r\n        if (croppedImage) {\r\n            croppedImage.src = croppedCanvas.toDataURL('image/png');\r\n        }\r\n\r\n        if (param.onChange) {\r\n            param.onChange(croppedCanvas.width, croppedCanvas.height);\r\n        }\r\n    }\r\n    function updateSelectionRect() {\r\n        BB.css(selectionRect, {\r\n            left: (thumbX + crop.x * scaleW) + 'px',\r\n            top: (thumbY + crop.y * scaleH) + 'px',\r\n            width: (crop.width * scaleW) + 'px',\r\n            height: (crop.height * scaleH) + 'px'\r\n        });\r\n        if (param.onChange) {\r\n            param.onChange(Math.round(crop.width), Math.round(crop.height));\r\n        }\r\n    }\r\n    function isInsideSelectionRect(p) {\r\n        let rect = {\r\n            x: Math.round(thumbX + crop.x * scaleW),\r\n            y: Math.round(thumbY + crop.y * scaleH),\r\n            width: Math.round(crop.width * scaleW),\r\n            height: Math.round(crop.height * scaleH)\r\n        };\r\n        return BB.isInsideRect(p, rect);\r\n    }\r\n\r\n    const croppedCanvas = BB.canvas();\r\n    let eventTarget = croppedCanvas;\r\n    let croppedImage = null;\r\n    if (!param.isNotCopy) { //navigator.appName === 'Microsoft Internet Explorer') { //i would prefer not using an image\r\n        croppedImage = new Image();\r\n        eventTarget = croppedImage;\r\n    }\r\n    BB.css(eventTarget, {\r\n        height: param.height + 'px',\r\n        width: param.width + 'px'\r\n    });\r\n    div.appendChild(eventTarget);\r\n    updateCroppedCanvas();\r\n\r\n    const padding = 20;\r\n    const previewWrapper = BB.el({\r\n        css: {\r\n            width: param.width + 'px',\r\n            height: param.height + 'px',\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            pointerEvents: 'none'\r\n        }\r\n    });\r\n    div.appendChild(previewWrapper);\r\n    BB.createCheckerDataUrl(4, function(v) {\r\n        previewWrapper.style.backgroundImage = 'url('+v+')';\r\n    });\r\n\r\n    const thumbSize = BB.fitInto(param.canvas.width, param.canvas.height, param.width - padding * 2, param.height - padding * 2, 1);\r\n    const thumbCanvas = BB.canvas(Math.round(thumbSize.width), Math.round(thumbSize.height));\r\n    thumbCanvas.style.imageRendering = 'pixelated';\r\n    const scaleW = thumbCanvas.width / param.canvas.width;\r\n    const scaleH = thumbCanvas.height / param.canvas.height;\r\n    const thumbCtx = thumbCanvas.getContext('2d');\r\n    thumbCtx.imageSmoothingEnabled = false;\r\n    thumbCtx.drawImage(param.canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);\r\n    previewWrapper.appendChild(thumbCanvas);\r\n    const thumbX = parseInt('' + ((param.width - thumbCanvas.width) / 2));\r\n    const thumbY = parseInt('' + ((param.height - thumbCanvas.height) / 2));\r\n    BB.css(thumbCanvas, {\r\n        position: 'absolute',\r\n        left: thumbX + \"px\",\r\n        top: thumbY + \"px\"\r\n    });\r\n\r\n    const selectionRect = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            boxShadow: '0 0 0 1px #fff, 0 0 0 2px #000, 0 0 40px 1px #000',\r\n        }\r\n    });\r\n    previewWrapper.appendChild(selectionRect);\r\n    updateSelectionRect();\r\n\r\n\r\n    function toOriginalSpace(p) {\r\n        return {\r\n            x: BB.clamp((p.x - thumbX) / scaleW, 0, param.canvas.width),\r\n            y: BB.clamp((p.y - thumbY) / scaleH, 0, param.canvas.height),\r\n        };\r\n    }\r\n    //gen crop from thumb-space points\r\n    function genCrop(p1, p2) {\r\n        let topLeftP = {\r\n            x: Math.min(p1.x, p2.x),\r\n            y: Math.min(p1.y, p2.y)\r\n        };\r\n        let bottomRightP = {\r\n            x: Math.max(p1.x, p2.x),\r\n            y: Math.max(p1.y, p2.y)\r\n        };\r\n        let origTopLeftP = toOriginalSpace(topLeftP);\r\n        let origBottomRightP = toOriginalSpace(bottomRightP);\r\n        origTopLeftP.x = Math.floor(origTopLeftP.x);\r\n        origTopLeftP.y = Math.floor(origTopLeftP.y);\r\n        origBottomRightP.x = Math.ceil(origBottomRightP.x);\r\n        origBottomRightP.y = Math.ceil(origBottomRightP.y);\r\n        return {\r\n            x: origTopLeftP.x,\r\n            y: origTopLeftP.y,\r\n            width: origBottomRightP.x - origTopLeftP.x,\r\n            height: origBottomRightP.y - origTopLeftP.y\r\n        };\r\n    }\r\n\r\n    function isReset() {\r\n        return crop.x === 0 && crop.y === 0 && crop.width === param.canvas.width && crop.height === param.canvas.height;\r\n    }\r\n\r\n    let startP;\r\n    let startCrop = null;\r\n    let isDragging = false;\r\n    let didMove = false;\r\n    let updateCropTimeout;\r\n    const pointerListener = new BB.PointerListener({\r\n        target: eventTarget,\r\n        fixScribble: true,\r\n        onPointer: function(event) {\r\n            let fullPos;\r\n            if (event.type === 'pointerdown' && event.button === 'left') {\r\n                event.eventPreventDefault();\r\n                isDragging = true;\r\n                startP = {\r\n                    x: event.relX,\r\n                    y: event.relY\r\n                };\r\n                if (!isReset() && isInsideSelectionRect(startP)) {\r\n                    startCrop = {\r\n                        x: crop.x,\r\n                        y: crop.y,\r\n                        width: crop.width,\r\n                        height: crop.height\r\n                    };\r\n                } else {\r\n                    crop = genCrop(startP, startP);\r\n                }\r\n            } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                event.eventPreventDefault();\r\n                didMove = true;\r\n                if (startCrop) {\r\n                    crop.x = startCrop.x + Math.round((event.relX - startP.x) / scaleW);\r\n                    crop.y = startCrop.y + Math.round((event.relY - startP.y) / scaleH);\r\n                    crop.x = BB.clamp(crop.x, 0, param.canvas.width - crop.width);\r\n                    crop.y = BB.clamp(crop.y, 0, param.canvas.height - crop.height);\r\n                } else {\r\n                    crop = genCrop(startP, {x: event.relX, y: event.relY});\r\n                }\r\n                updateSelectionRect();\r\n            } else if (event.type === 'pointerup' && startP) {\r\n                event.eventPreventDefault();\r\n                isDragging = false;\r\n                startCrop = null;\r\n                startP = null;\r\n                if (crop.width === 0 || crop.height === 0 || !didMove) {\r\n                    resetCrop();\r\n                    updateSelectionRect();\r\n                }\r\n                didMove = false;\r\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e, comboStr) {\r\n            if (isDragging) {\r\n                return;\r\n            }\r\n            let doUpdate = false;\r\n\r\n            let stepSize = Math.max(1, 1 / scaleW);\r\n            let shiftIsPressed = keyListener.isPressed('shift');\r\n\r\n            if (keyStr === 'left') {\r\n                if (shiftIsPressed) {\r\n                    crop.width = BB.clamp(crop.width - stepSize, 1, param.canvas.width - crop.x);\r\n                } else {\r\n                    crop.x = BB.clamp(crop.x - stepSize, 0, param.canvas.width - crop.width);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n            if (keyStr === 'right') {\r\n                if (shiftIsPressed) {\r\n                    crop.width = BB.clamp(crop.width + stepSize, 1, param.canvas.width - crop.x);\r\n                } else {\r\n                    crop.x = BB.clamp(crop.x + stepSize, 0, param.canvas.width - crop.width);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n            if (keyStr === 'up') {\r\n                if (shiftIsPressed) {\r\n                    crop.height = BB.clamp(crop.height - stepSize, 1, param.canvas.height - crop.y);\r\n                } else {\r\n                    crop.y = BB.clamp(crop.y - stepSize, 0, param.canvas.height - crop.height);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n            if (keyStr === 'down') {\r\n                if (shiftIsPressed) {\r\n                    crop.height = BB.clamp(crop.height + stepSize, 1, param.canvas.height - crop.y);\r\n                } else {\r\n                    crop.y = BB.clamp(crop.y + stepSize, 0, param.canvas.height - crop.height);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n\r\n            if (doUpdate) {\r\n                e.preventDefault();\r\n                updateSelectionRect();\r\n                clearTimeout(updateCropTimeout);\r\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 100);\r\n            }\r\n        }\r\n    });\r\n\r\n    this.getEl = function() {\r\n        return div;\r\n    };\r\n    this.reset = function() {\r\n        resetCrop();\r\n        updateCroppedCanvas();\r\n        updateSelectionRect();\r\n    };\r\n    this.destroy = function() {\r\n        eventTarget.style.removeProperty('width');\r\n        eventTarget.style.removeProperty('height');\r\n        keyListener.destroy();\r\n        pointerListener.destroy();\r\n    };\r\n    this.isReset = function() {\r\n        return isReset();\r\n    };\r\n    this.getRect = function() {\r\n        return JSON.parse(JSON.stringify(crop));\r\n    };\r\n    this.getCroppedImage = function() {\r\n        return croppedCanvas;\r\n    };\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {popup} from './popup';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/// <reference path=\"./types.d.ts\" />\r\n\r\n/**\r\n *\r\n * @param parent\r\n * @param fullCanvas\r\n * @param cropCallback\r\n * @param output - BB.Output\r\n * @param showCrop - boolean - show crop button\r\n */\r\nexport function clipboardDialog(parent, fullCanvas, cropCallback, output, showCrop) {\r\n\r\n    let clipboardItemIsSupported = false;\r\n    try {\r\n        clipboardItemIsSupported = !!ClipboardItem;\r\n    } catch (e) {}\r\n\r\n    const div = document.createElement(\"div\");\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n\r\n    let topWrapper = BB.el({\r\n        content: LANG('crop-drag-to-crop') + (clipboardItemIsSupported ? '' : '<br>' + LANG('cropcopy-click-hold')),\r\n        css: {\r\n            textAlign: 'center'\r\n        }\r\n    });\r\n    div.appendChild(topWrapper);\r\n\r\n\r\n    let cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 350,\r\n        canvas: fullCanvas,\r\n        clipboardItemIsSupported\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n        borderTop: '1px solid #bbb',\r\n        borderBottom: '1px solid #bbb'\r\n    });\r\n    div.appendChild(cropCopy.getEl());\r\n\r\n    function toClipboard() {\r\n        const imgURL = cropCopy.getCroppedImage().toDataURL('image/png');\r\n        setTimeout(async function() {\r\n            try {\r\n                const data = await fetch(imgURL);\r\n                const blob = await data.blob();\r\n                await (navigator.clipboard as any).write([\r\n                    new ClipboardItem({\r\n                        [blob.type]: blob\r\n                    } as any) // todo check is possible?\r\n                ]);\r\n                setTimeout(function() {\r\n                    output.out(LANG('cropcopy-copied'), true);\r\n                }, 200);\r\n            } catch (err) {\r\n                console.error(err.name, err.message);\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, KeyEvent, comboStr) {\r\n            if (comboStr === 'ctrl+c') {\r\n                toClipboard();\r\n                closefunc();\r\n            }\r\n        }\r\n    });\r\n\r\n    let closefunc;\r\n    function blur() {\r\n        closefunc();\r\n    }\r\n    BB.addEventListener(window, \"blur\", blur);\r\n\r\n    const buttonArr = [];\r\n    if (clipboardItemIsSupported) {\r\n        buttonArr.push(LANG('cropcopy-btn-copy'));\r\n    }\r\n    if (showCrop) {\r\n        buttonArr.push(LANG('cropcopy-btn-crop'));\r\n    }\r\n    buttonArr.push('Cancel');\r\n\r\n    popup({\r\n        target: parent,\r\n        message: '<b>' + (showCrop ? `${LANG('cropcopy-title-copy')} / ${LANG('cropcopy-title-crop')}` : `${LANG('cropcopy-title-copy')}`) + '</b>',\r\n        div: div,\r\n        style: isSmall ? {} : {\r\n            width: \"500px\"\r\n        },\r\n        buttons: buttonArr,\r\n        primaries: [LANG('cropcopy-btn-copy')],\r\n        callback: function (result) {\r\n            if (result === LANG('cropcopy-btn-copy')) {\r\n                toClipboard();\r\n            } else if (result === LANG('cropcopy-btn-crop')) {\r\n                let rectObj = cropCopy.getRect();\r\n                cropCallback({\r\n                    left: Math.round(-rectObj.x),\r\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\r\n                    top: Math.round(-rectObj.y),\r\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height)\r\n                });\r\n            }\r\n            BB.removeEventListener(window, \"blur\", blur);\r\n            cropCopy.destroy();\r\n            keyListener.destroy();\r\n        },\r\n        clickOnEnter: LANG('cropcopy-btn-copy'),\r\n        closefunc: function (func) {\r\n            closefunc = func;\r\n        }\r\n    });\r\n}","import {BB} from '../../../bb/bb';\r\nimport {popup} from '../modals/popup';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {Options} from '../base-components/options';\r\nimport {Select} from '../base-components/select';\r\nimport {PointSlider} from '../base-components/point-slider';\r\n// @ts-ignore\r\nimport addLayerImg from 'url:~/src/app/img/ui/add-layer.svg';\r\n// @ts-ignore\r\nimport duplicateLayerImg from 'url:~/src/app/img/ui/duplicate-layer.svg';\r\n// @ts-ignore\r\nimport mergeLayerImg from 'url:~/src/app/img/ui/merge-layers.svg';\r\n// @ts-ignore\r\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\r\n// @ts-ignore\r\nimport renameLayerImg from 'url:~/src/app/img/ui/rename-layer.svg';\r\nimport {KlCanvas, MAX_LAYERS} from '../../canvas/kl-canvas';\r\nimport {IMixMode} from '../../kl.types';\r\nimport {LANG} from '../../../language/language';\r\nimport {translateBlending} from '../../canvas/translate-blending';\r\n\r\n\r\nexport function klLayerManager(p_canvas: KlCanvas, p_func, p_rootDiv) {\r\n    let klCanvas: KlCanvas = p_canvas;\r\n    let layerElArr = [];\r\n    let layerHeight = 35;\r\n    let layerSpacing = 0;\r\n    let width = 250;\r\n    let oldHistoryState;\r\n    let updatefunc = p_func;\r\n    let uiState = 'right'; // 'left | 'right'\r\n\r\n\r\n    let largeThumbDiv = BB.el({\r\n        onClick: BB.handleClick,\r\n        css: {\r\n            position: \"absolute\",\r\n            right: \"280px\",\r\n            top: \"500px\",\r\n            background: \"#aaa\",\r\n            boxShadow: \"1px 1px 3px rgba(0,0,0,0.3)\",\r\n            pointerEvents: \"none\",\r\n            padding: '0',\r\n            border: \"1px solid #aaa\",\r\n            transition: \"opacity 0.3s ease-out\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    BB.createCheckerDataUrl(4, function(url) {\r\n        largeThumbDiv.style.backgroundImage = \"url(\" + url + \")\";\r\n    });\r\n    let largeThumbCanvas = BB.canvas(200, 200);\r\n    largeThumbCanvas.style.display = \"block\";\r\n    largeThumbDiv.appendChild(largeThumbCanvas);\r\n    let largeThumbTimeout, largeThumbInTimeout;\r\n    let largeThumbInDocument = false;\r\n\r\n\r\n    let klCanvasLayerArr = klCanvas.getLayers();\r\n    let selectedSpotIndex = klCanvasLayerArr.length - 1;\r\n    let div = document.createElement(\"div\");\r\n    div.style.marginRight = \"10px\";\r\n    div.style.marginBottom = \"10px\";\r\n    div.style.marginLeft = \"10px\";\r\n    div.style.marginTop = \"10px\";\r\n    div.style.cursor = \"default\";\r\n\r\n    let listdiv = document.createElement(\"div\");\r\n    BB.css(listdiv, {\r\n        width: width + \"px\",\r\n        position: \"relative\"\r\n\r\n    });\r\n\r\n\r\n    function renameLayer(layer) {\r\n        let div = document.createElement('div');\r\n\r\n        let label = BB.el({\r\n            content: LANG('layers-rename-name') + ':',\r\n            css: {\r\n                marginRight: '5px'\r\n            }\r\n        });\r\n\r\n        const row = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n        let input = document.createElement('input');\r\n        input.value = klCanvas.getLayer(layer).name;\r\n        input.setAttribute('data-ignore-focus', 'true');\r\n        const clearBtn = BB.el({\r\n            tagName: 'Button',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/>',\r\n            title: LANG('layers-rename-clear'),\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: () => {\r\n                input.value = '';\r\n                input.focus();\r\n            }\r\n        });\r\n        const suggestions = [\r\n            LANG('layers-rename-sketch'),\r\n            LANG('layers-rename-colors'),\r\n            LANG('layers-rename-shading'),\r\n            LANG('layers-rename-lines'),\r\n            LANG('layers-rename-effects'),\r\n            LANG('background'),\r\n            LANG('layers-rename-foreground'),\r\n        ];\r\n        const suggestionBtns = [];\r\n        const row2 = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginTop: '5px',\r\n                marginLeft: '-5px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        suggestions.forEach(item => {\r\n            const btn = BB.el({\r\n                parent: row2,\r\n                tagName: 'Button',\r\n                content: item,\r\n                onClick: () => {\r\n                    input.value = btn.textContent;\r\n                },\r\n                css: {\r\n                    margin: '5px 0 0 5px',\r\n                }\r\n            });\r\n            suggestionBtns.push(btn);\r\n        });\r\n\r\n        div.appendChild(label);\r\n        label.append(row, row2);\r\n        row.append(input, clearBtn);\r\n\r\n        setTimeout(function() {\r\n            input.focus();\r\n            input.select();\r\n        }, 10);\r\n\r\n        popup({\r\n            target: p_rootDiv,\r\n            message: `<b>${LANG('layers-rename-title')}</b>`,\r\n            div: div,\r\n            buttons: [LANG('layers-rename'), 'Cancel'],\r\n            primaries: [LANG('layers-rename')],\r\n            callback: function (val) {\r\n                BB.destroyEl(clearBtn);\r\n                suggestionBtns.forEach(item => {\r\n                    BB.destroyEl(item);\r\n                });\r\n                suggestionBtns.splice(0, suggestionBtns.length);\r\n                if (val === LANG('layers-rename')) {\r\n                    if (input.value === klCanvas.getLayer(layer).name) {\r\n                        return;\r\n                    }\r\n                    klCanvas.renameLayer(layer, input.value);\r\n                    createLayerList();\r\n                    klHistory.pause(true);\r\n                    updatefunc(layer);\r\n                    klHistory.pause(false);\r\n                }\r\n            },\r\n            clickOnEnter: LANG('layers-rename')\r\n        });\r\n    }\r\n\r\n\r\n    let layerListEl = BB.el({});\r\n\r\n    (div as any).disableButtons = function(){}; //probably remove\r\n    (div as any).enableButtons = function(){}; //probably remove\r\n    let addnewBtn = document.createElement(\"button\");\r\n    let duplicateBtn = document.createElement(\"button\");\r\n    let mergeBtn = document.createElement(\"button\");\r\n    let removeBtn = document.createElement(\"button\");\r\n    let renameBtn = document.createElement(\"button\");\r\n\r\n    function createButtons() {\r\n        let div = document.createElement(\"div\");\r\n        function async() {\r\n            BB.makeUnfocusable(addnewBtn);\r\n            BB.makeUnfocusable(duplicateBtn);\r\n            BB.makeUnfocusable(mergeBtn);\r\n            BB.makeUnfocusable(removeBtn);\r\n            BB.makeUnfocusable(renameBtn);\r\n\r\n            addnewBtn.style.cssFloat = 'left';\r\n            duplicateBtn.style.cssFloat = 'left';\r\n            mergeBtn.style.cssFloat = 'left';\r\n            removeBtn.style.cssFloat = 'left';\r\n            renameBtn.style.cssFloat = 'left';\r\n\r\n            addnewBtn.title = LANG('layers-new');\r\n            duplicateBtn.title = LANG('layers-duplicate');\r\n            removeBtn.title = LANG('layers-remove');\r\n            mergeBtn.title = LANG('layers-merge');\r\n            renameBtn.title = LANG('layers-rename-title');\r\n\r\n            addnewBtn.style.paddingLeft = \"5px\";\r\n            addnewBtn.style.paddingRight = \"3px\";\r\n\r\n            removeBtn.style.paddingLeft = \"5px\";\r\n            removeBtn.style.paddingRight = \"3px\";\r\n\r\n            duplicateBtn.style.paddingLeft = \"5px\";\r\n            duplicateBtn.style.paddingRight = \"3px\";\r\n\r\n            mergeBtn.style.paddingLeft = \"5px\";\r\n            mergeBtn.style.paddingRight = \"3px\";\r\n\r\n            renameBtn.style.height = \"30px\";\r\n            renameBtn.style.lineHeight = \"20px\";\r\n\r\n            addnewBtn.innerHTML = \"<img src='\" + addLayerImg + \"' height='20'/>\";\r\n            duplicateBtn.innerHTML = \"<img src='\" + duplicateLayerImg + \"' height='20'/>\";\r\n            mergeBtn.innerHTML = \"<img src='\" + mergeLayerImg + \"' height='20'/>\";\r\n            removeBtn.innerHTML = \"<img src='\" + removeLayerImg + \"' height='20'/>\";\r\n            renameBtn.innerHTML = \"<img src='\" + renameLayerImg + \"' height='20'/>\";\r\n            addnewBtn.style.marginRight = \"5px\";\r\n            removeBtn.style.marginRight = \"5px\";\r\n            duplicateBtn.style.marginRight = \"5px\";\r\n            mergeBtn.style.marginRight = \"5px\";\r\n            div.appendChild(addnewBtn);\r\n            div.appendChild(removeBtn);\r\n            div.appendChild(duplicateBtn);\r\n            div.appendChild(mergeBtn);\r\n            div.appendChild(renameBtn);\r\n            div.appendChild(BB.el({\r\n                css: {\r\n                    clear: 'both'\r\n                }\r\n            }));\r\n\r\n            let clearboth = document.createElement(\"div\");\r\n            clearboth.style.clear = \"both\";\r\n            clearboth.style.height = \"10px\";\r\n            div.appendChild(clearboth);\r\n\r\n\r\n            addnewBtn.onclick = function () {\r\n                if (klCanvas.addLayer(selectedSpotIndex) === false) {\r\n                    return;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n\r\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n                    addnewBtn.disabled = true;\r\n                    duplicateBtn.disabled = true;\r\n                }\r\n                removeBtn.disabled = false;\r\n                selectedSpotIndex = selectedSpotIndex + 1;\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n            };\r\n            duplicateBtn.onclick = function () {\r\n                if (klCanvas.duplicateLayer(selectedSpotIndex) === false) {\r\n                    return;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n                    addnewBtn.disabled = true;\r\n                    duplicateBtn.disabled = true;\r\n                }\r\n                removeBtn.disabled = false;\r\n                selectedSpotIndex++;\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n            };\r\n            removeBtn.onclick = function () {\r\n                if (layerElArr.length <= 1) {\r\n                    return;\r\n                }\r\n\r\n                klCanvas.removeLayer(selectedSpotIndex);\r\n                if (selectedSpotIndex > 0) {\r\n                    selectedSpotIndex--;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n                if (klCanvasLayerArr.length === 1) {\r\n                    removeBtn.disabled = true;\r\n                }\r\n                if (klCanvasLayerArr.length < MAX_LAYERS) {\r\n                    addnewBtn.disabled = false;\r\n                    duplicateBtn.disabled = false;\r\n                }\r\n            };\r\n            mergeBtn.onclick = function () {\r\n                if (selectedSpotIndex <= 0) {\r\n                    return;\r\n                }\r\n\r\n                function mergeDialog(p) {\r\n                    let div = document.createElement(\"div\");\r\n                    div.innerHTML = LANG('layers-merge-description');\r\n\r\n                    let options = new Options({\r\n                        optionArr: [\r\n                            {id: p.mixModeStr, label: translateBlending(p.mixModeStr)},\r\n                            {id: 'source-in', label: 'source-in'},\r\n                            {id: 'source-out', label: 'source-out'},\r\n                            {id: 'source-atop', label: 'source-atop'},\r\n                            {id: 'destination-in', label: 'destination-in'},\r\n                            {id: 'destination-out', label: 'destination-out'},\r\n                            {id: 'destination-atop', label: 'destination-atop'},\r\n                            {id: 'xor', label: 'xor'}\r\n                        ],\r\n                        initId: p.mixModeStr,\r\n                        onChange: function(id) {\r\n                            update();\r\n                        },\r\n                        isSmall: true\r\n                    });\r\n                    options.getElement().style.marginTop = '5px';\r\n                    div.appendChild(options.getElement());\r\n\r\n                    const thumbDimensions = BB.fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\r\n                    let preview = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n                    preview.title = LANG('preview');\r\n                    let spacer = document.createElement(\"div\");\r\n                    spacer.innerHTML = \"<br/>\";\r\n                    spacer.style.clear = \"both\";\r\n                    div.appendChild(spacer);\r\n                    div.appendChild(preview);\r\n                    BB.css(preview, {\r\n                        display: \"block\",\r\n                        marginLeft: \"auto\",\r\n                        marginRight: \"auto\",\r\n                        colorScheme: 'only light',\r\n                    });\r\n                    preview.style.boxShadow = \"0 0 3px rgba(0,0,0,0.5)\";\r\n                    BB.createCheckerDataUrl(4, function(url) {\r\n                        preview.style.backgroundImage = \"url(\" + url + \")\";\r\n                    });\r\n\r\n                    let alphaCanvas = BB.copyCanvas(preview);\r\n                    alphaCanvas.getContext(\"2d\").drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\r\n                    BB.convertToAlphaChannelCanvas(alphaCanvas);\r\n\r\n                    function update() {\r\n                        let ctx = preview.getContext(\"2d\");\r\n                        ctx.save();\r\n                        ctx.clearRect(0, 0, preview.width, preview.height);\r\n                        if (preview.width > p.topCanvas.width) {\r\n                            ctx.imageSmoothingEnabled = false;\r\n                        }\r\n                        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\r\n\r\n                        if (options.getValue() === 'as-alpha') {\r\n                            ctx.globalCompositeOperation = 'destination-in';\r\n                            ctx.globalAlpha = p.topOpacity;\r\n                            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\r\n                        } else {\r\n                            ctx.globalCompositeOperation = options.getValue();\r\n                            ctx.globalAlpha = p.topOpacity;\r\n                            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\r\n                        }\r\n                        ctx.restore();\r\n                    }\r\n\r\n                    update();\r\n\r\n\r\n                    let keyListener = new BB.KeyListener({\r\n                        onDown: function(keyStr) {\r\n                            if (keyStr === 'right') {\r\n                                options.next();\r\n                            }\r\n                            if (keyStr === 'left') {\r\n                                options.previous();\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    popup({\r\n                        target: p_rootDiv,\r\n                        message: `<b>${LANG('layers-merge-modal-title')}</b>`,\r\n                        div: div,\r\n                        buttons: [\"Ok\", \"Cancel\"],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: function (val) {\r\n                            keyListener.destroy();\r\n                            options.destroy();\r\n                            if (val === \"Ok\") {\r\n                                p.callback(options.getValue());\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                mergeDialog({\r\n                    topCanvas: klCanvasLayerArr[selectedSpotIndex].context.canvas,\r\n                    bottomCanvas: klCanvasLayerArr[selectedSpotIndex - 1].context.canvas,\r\n                    topOpacity: klCanvas.getLayer(selectedSpotIndex).opacity,\r\n                    mixModeStr: klCanvasLayerArr[selectedSpotIndex].mixModeStr,\r\n                    callback: function (mode) {\r\n                        klCanvas.mergeLayers(selectedSpotIndex, selectedSpotIndex - 1, mode);\r\n                        klCanvasLayerArr = klCanvas.getLayers();\r\n                        selectedSpotIndex--;\r\n                        if (klCanvasLayerArr.length === 1) {\r\n                            removeBtn.disabled = true;\r\n                        }\r\n                        if (klCanvasLayerArr.length < MAX_LAYERS) {\r\n                            addnewBtn.disabled = false;\r\n                            duplicateBtn.disabled = false;\r\n                        }\r\n                        createLayerList();\r\n                        klHistory.pause(true);\r\n                        updatefunc(selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                });\r\n            };\r\n\r\n            renameBtn.onclick = function () {\r\n                renameLayer(selectedSpotIndex);\r\n            };\r\n        }\r\n        setTimeout(async, 1);\r\n        return div;\r\n    }\r\n    div.appendChild(createButtons());\r\n\r\n    let modeWrapper;\r\n    let modeSelect;\r\n    {\r\n        modeWrapper = BB.el({\r\n            content: LANG('layers-blending') + '&nbsp;',\r\n            css: {\r\n                fontSize: '15px'\r\n            }\r\n        });\r\n\r\n        modeSelect = new Select({\r\n            optionArr: [\r\n                'source-over',\r\n                null,\r\n                'darken',\r\n                'multiply',\r\n                'color-burn',\r\n                null,\r\n                'lighten',\r\n                'screen',\r\n                'color-dodge',\r\n                null,\r\n                'overlay',\r\n                'soft-light',\r\n                'hard-light',\r\n                null,\r\n                'difference',\r\n                'exclusion',\r\n                null,\r\n                'hue',\r\n                'saturation',\r\n                'color',\r\n                'luminosity',\r\n            ].map((item: IMixMode) => {\r\n                return item ? [item, translateBlending(item)] : null;\r\n            }),\r\n            onChange: function(val) {\r\n                klCanvas.setMixMode(selectedSpotIndex, val as IMixMode);\r\n                (div as any).update(selectedSpotIndex);\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n\r\n        modeWrapper.appendChild(modeSelect.getElement());\r\n        div.appendChild(modeWrapper);\r\n\r\n    }\r\n\r\n\r\n    function createLayerList() {\r\n        oldHistoryState = klHistory.getState();\r\n        function createLayerEntry(index) {\r\n            let layerName = klCanvas.getLayer(index).name;\r\n            let opacity = klCanvasLayerArr[index].opacity;\r\n            let layercanvas = klCanvasLayerArr[index].context.canvas;\r\n\r\n            let layer = document.createElement(\"div\");\r\n            layer.className = \"layerBox\";\r\n            layerElArr[index] = layer;\r\n            (layer as any).posY = ((klCanvasLayerArr.length - 1) * 35 - index * 35);\r\n            BB.css(layer, {\r\n                width: \"250px\",\r\n                height: \"34px\",\r\n                backgroundColor: \"rgb( 220, 220, 220)\",\r\n                border: \"1px solid #aaa\",\r\n                position: \"absolute\",\r\n                left: \"0 px\",\r\n                top: (layer as any).posY + \"px\",\r\n                transition: \"all 0.1s linear\",\r\n                borderRadius: \"5px\",\r\n                boxSizing: 'border-box'\r\n            });\r\n            let innerLayer = document.createElement(\"div\");\r\n            BB.css(innerLayer, {\r\n                position: \"relative\"\r\n            });\r\n\r\n            let container1 = document.createElement(\"div\");\r\n            BB.css(container1, {\r\n                width: \"250px\",\r\n                height: \"34px\"\r\n            });\r\n            let container2 = document.createElement(\"div\");\r\n            layer.appendChild(innerLayer);\r\n            innerLayer.appendChild(container1);\r\n            innerLayer.appendChild(container2);\r\n\r\n            (layer as any).spot = index;\r\n\r\n            //thumb\r\n            {\r\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\r\n                let thumb = (layer as any).thumb = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n\r\n                let thc = thumb.getContext(\"2d\");\r\n                thc.save();\r\n                if (thumb.width > layercanvas.width) {\r\n                    thc.imageSmoothingEnabled = false;\r\n                }\r\n                thc.drawImage(layercanvas, 0, 0, thumb.width, thumb.height);\r\n                thc.restore();\r\n                BB.css((layer as any).thumb, {\r\n                    position: \"absolute\",\r\n                    left: ((32 - (layer as any).thumb.width) / 2) + \"px\",\r\n                    top: ((32 - (layer as any).thumb.height) / 2) + \"px\",\r\n                    colorScheme: 'only light',\r\n                });\r\n                BB.createCheckerDataUrl(4, function(url) {\r\n                    thumb.style.backgroundImage = \"url(\" + url + \")\";\r\n                });\r\n            }\r\n\r\n            //layerlabel\r\n            {\r\n                (layer as any).label = document.createElement(\"div\");\r\n                (layer as any).lname = layerName;\r\n                (layer as any).label.append((layer as any).lname);\r\n\r\n                BB.css((layer as any).label, {\r\n                    position: \"absolute\",\r\n                    left: (1 + 32 + 5) + \"px\",\r\n                    top: 1 + \"px\",\r\n                    fontSize: \"13px\",\r\n                    width: \"170px\",\r\n                    height: \"20px\",\r\n                    overflow: \"hidden\",\r\n                    color: \"#666\",\r\n                    whiteSpace: 'nowrap'\r\n                });\r\n\r\n                (layer as any).label.ondblclick = function() {\r\n                    renameLayer((layer as any).spot);\r\n                };\r\n            }\r\n            //layerlabel\r\n            {\r\n                (layer as any).opacityLabel = document.createElement(\"div\");\r\n                (layer as any).opacity = opacity;\r\n                (layer as any).opacityLabel.append(parseInt('' + ((layer as any).opacity * 100)) + \"%\");\r\n\r\n                BB.css((layer as any).opacityLabel, {\r\n                    position: \"absolute\",\r\n                    left: (250 - 1 - 5 - 50) + \"px\",\r\n                    top: 1 + \"px\",\r\n                    fontSize: \"13px\",\r\n                    textAlign: \"right\",\r\n                    width: \"50px\",\r\n                    color: \"#666\",\r\n                    transition: \"color 0.2s ease-in-out\"\r\n                });\r\n            }\r\n\r\n            let oldOpacity;\r\n            let opacitySlider = new PointSlider({\r\n                init: (layer as any).opacity,\r\n                width: 204,\r\n                pointSize: 14,\r\n                callback: function(sliderValue, isFirst, isLast) {\r\n                    if (isFirst) {\r\n                        oldOpacity = klCanvas.getLayer((layer as any).spot).opacity;\r\n                        klHistory.pause(true);\r\n                        return;\r\n                    }\r\n                    if (isLast) {\r\n                        klHistory.pause(false);\r\n                        if (oldOpacity !== sliderValue) {\r\n                            klCanvas.layerOpacity((layer as any).spot, sliderValue);\r\n                        }\r\n                        return;\r\n                    }\r\n                    (layer as any).opacityLabel.innerHTML = Math.round(sliderValue * 100) + \"%\";\r\n                    klCanvas.layerOpacity((layer as any).spot, sliderValue);\r\n                }\r\n            });\r\n            BB.css(opacitySlider.getEl(), {\r\n                position: 'absolute',\r\n                left: '39px',\r\n                top: '17px'\r\n            });\r\n            (layer as any).opacitySlider = opacitySlider;\r\n\r\n            //larger layer preview - hover\r\n            BB.setEventListener((layer as any).thumb, 'onpointerover', function (e) {\r\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== 'touch')) { //shouldn't show while dragging\r\n                    return;\r\n                }\r\n\r\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\r\n\r\n                if (largeThumbCanvas.width !== thumbDimensions.width || largeThumbCanvas.height !== thumbDimensions.height) {\r\n                    largeThumbCanvas.width = thumbDimensions.width;\r\n                    largeThumbCanvas.height = thumbDimensions.height;\r\n                }\r\n                let ctx = largeThumbCanvas.getContext(\"2d\");\r\n                ctx.save();\r\n                if (largeThumbCanvas.width > layercanvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.imageSmoothingQuality = 'high';\r\n                ctx.clearRect(0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\r\n                ctx.drawImage(layercanvas, 0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\r\n                ctx.restore();\r\n                BB.css(largeThumbDiv, {\r\n                    top: (e.clientY - largeThumbCanvas.height / 2) + \"px\",\r\n                    opacity: '0'\r\n                });\r\n                if (largeThumbInDocument === false) {\r\n                    document.body.appendChild(largeThumbDiv);\r\n                    largeThumbInDocument = true;\r\n                }\r\n                clearTimeout(largeThumbInTimeout);\r\n                largeThumbInTimeout = setTimeout(function () {\r\n                    BB.css(largeThumbDiv, {\r\n                        opacity: '1'\r\n                    });\r\n                }, 20);\r\n                clearTimeout(largeThumbTimeout);\r\n            });\r\n            BB.setEventListener((layer as any).thumb, 'onpointerout', function () {\r\n                clearTimeout(largeThumbInTimeout);\r\n                BB.css(largeThumbDiv, {\r\n                    opacity: '0'\r\n                });\r\n                clearTimeout(largeThumbTimeout);\r\n                largeThumbTimeout = setTimeout(function () {\r\n                    if (!largeThumbInDocument) {\r\n                        return;\r\n                    }\r\n                    document.body.removeChild(largeThumbDiv);\r\n                    largeThumbInDocument = false;\r\n                }, 300);\r\n            });\r\n\r\n            container1.appendChild((layer as any).thumb);\r\n            container1.appendChild((layer as any).label);\r\n            container1.appendChild((layer as any).opacityLabel);\r\n            container1.appendChild(opacitySlider.getEl());\r\n            let dragstart = false;\r\n            let freshSelection = false;\r\n\r\n            //events for moving layers up and down\r\n            function dragEventHandler(event) {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    BB.css(layer, {\r\n                        transition: \"box-shadow 0.3s ease-in-out\"\r\n                    });\r\n                    //dragContainer.appendChild(layer);\r\n                    layer.style.zIndex = '1';\r\n                    lastpos = (layer as any).spot;\r\n                    freshSelection = false;\r\n                    if (!(layer as any).isSelected) {\r\n                        freshSelection = true;\r\n                        (div as any).activateLayer((layer as any).spot);\r\n                    }\r\n                    dragstart = true;\r\n\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    if (dragstart) {\r\n                        dragstart = false;\r\n                        BB.css(layer, {\r\n                            boxShadow: \"1px 3px 5px rgba(0,0,0,0.4)\"\r\n                        });\r\n                    }\r\n                    (layer as any).posY += event.dY;\r\n                    let corrected = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\r\n                    layer.style.top = corrected + \"px\";\r\n                    updateLayersVerticalPosition((layer as any).spot, posToSpot((layer as any).posY));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(layer, {\r\n                        transition: \"all 0.1s linear\"\r\n                    });\r\n                    setTimeout(function () {\r\n                        BB.css(layer, {\r\n                            boxShadow: \"\"\r\n                        });\r\n                    }, 20);\r\n                    (layer as any).posY = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\r\n                    //regularContainer.appendChild(layer);\r\n                    layer.style.zIndex = \"\";\r\n                    let newSpot = posToSpot((layer as any).posY);\r\n                    let oldSpot = (layer as any).spot;\r\n                    move((layer as any).spot, newSpot);\r\n                    if (oldSpot != newSpot) {\r\n                        klHistory.pause(true);\r\n                        updatefunc(selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                    if (oldSpot === newSpot && freshSelection) {\r\n                        updatefunc(selectedSpotIndex);\r\n                    }\r\n                    freshSelection = false;\r\n                }\r\n            }\r\n\r\n            (layer as any).pointerListener = new BB.PointerListener({\r\n                target: container1,\r\n                maxPointers: 1,\r\n                onPointer: dragEventHandler\r\n            });\r\n\r\n            layerListEl.appendChild(layer);\r\n        }\r\n        layerElArr = [];\r\n        while (layerListEl.firstChild) {\r\n            let child = layerListEl.firstChild;\r\n            (child as any).pointerListener.destroy();\r\n            (child as any).opacitySlider.destroy();\r\n            layerListEl.removeChild(child);\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            createLayerEntry(i);\r\n        }\r\n        (div as any).activateLayer(selectedSpotIndex);\r\n        updateHeight();\r\n    }\r\n\r\n\r\n    listdiv.appendChild(layerListEl);\r\n    div.appendChild(listdiv);\r\n\r\n\r\n    function posToSpot(p) {\r\n        let result = parseInt('' + ((p) / (layerHeight + layerSpacing) + 0.5));\r\n        result = Math.min(klCanvasLayerArr.length - 1, Math.max(0, result));\r\n        result = klCanvasLayerArr.length - result - 1;\r\n        return result;\r\n    }\r\n\r\n    let lastpos = 0;\r\n\r\n    //update css position of all layers that are not being dragged, while dragging\r\n    function updateLayersVerticalPosition(id, newspot) {\r\n        newspot = Math.min(klCanvasLayerArr.length - 1, Math.max(0, newspot));\r\n        if (newspot === lastpos) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            if (layerElArr[i].spot === id) { // <- here\r\n                continue;\r\n            }\r\n            let posy = layerElArr[i].spot;\r\n            if (layerElArr[i].spot > id) {\r\n                posy--;\r\n            }\r\n            if (posy >= newspot) {\r\n                posy++;\r\n            }\r\n            layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\r\n            layerElArr[i].style.top = layerElArr[i].posY + \"px\";\r\n        }\r\n        lastpos = newspot;\r\n    }\r\n\r\n    function move(oldSpotIndex, newSpotIndex) {\r\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) {\r\n            throw 'layermanager - invalid move';\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            (function (i) {\r\n                let posy = layerElArr[i].spot; // <- here\r\n                if (layerElArr[i].spot === oldSpotIndex) {\r\n                    posy = newSpotIndex;\r\n                } else {\r\n                    if (layerElArr[i].spot > oldSpotIndex)\r\n                        posy--;\r\n                    if (posy >= newSpotIndex)\r\n                        posy++;\r\n                }\r\n                layerElArr[i].spot = posy;\r\n                layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\r\n                layerElArr[i].style.top = layerElArr[i].posY + \"px\";\r\n            }(i));\r\n        }\r\n        if (oldSpotIndex === newSpotIndex) {\r\n            return;\r\n        }\r\n        klCanvas.moveLayer(selectedSpotIndex, newSpotIndex - oldSpotIndex);\r\n        klCanvasLayerArr = klCanvas.getLayers();\r\n        selectedSpotIndex = newSpotIndex;\r\n        mergeBtn.disabled = selectedSpotIndex === 0;\r\n    }\r\n\r\n\r\n    //updating the thumbs in interval\r\n    //don't update when: manager not visible || layer didn't change || is drawing\r\n    let updateThumbsInterval = setInterval(function() {\r\n        if (div.style.display !== \"block\") {\r\n            return;\r\n        }\r\n\r\n        let historyState = klHistory.getState();\r\n        if (historyState === oldHistoryState) {\r\n            return;\r\n        }\r\n        oldHistoryState = historyState;\r\n\r\n        for (let i = 0; i < layerElArr.length; i++) {\r\n            if (selectedSpotIndex === layerElArr[i].spot && klCanvasLayerArr[layerElArr[i].spot]) { // second check, because might be out of date\r\n                let ctx = layerElArr[i].thumb.getContext(\"2d\");\r\n                ctx.save();\r\n                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n                if (klCanvasLayerArr[layerElArr[i].spot].context.canvas.width < layerElArr[i].thumb.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.drawImage(klCanvasLayerArr[layerElArr[i].spot].context.canvas, 0, 0, layerElArr[i].thumb.width, layerElArr[i].thumb.height);\r\n                ctx.restore();\r\n            }\r\n        }\r\n\r\n    }, 1);\r\n\r\n    function updateHeight() {\r\n        layerListEl.style.height = (layerElArr.length * 35) + 'px';\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    (div as any).update = function (activeLayerSpotIndex) {\r\n        klCanvasLayerArr = klCanvas.getLayers();\r\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) {\r\n            selectedSpotIndex = activeLayerSpotIndex;\r\n        }\r\n        removeBtn.disabled = klCanvasLayerArr.length === 1;\r\n        if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n            addnewBtn.disabled = true;\r\n            duplicateBtn.disabled = true;\r\n        } else {\r\n            addnewBtn.disabled = false;\r\n            duplicateBtn.disabled = false;\r\n        }\r\n        setTimeout(function() {\r\n            createLayerList();\r\n        }, 1);\r\n    };\r\n    (div as any).getSelected = function () {\r\n        return selectedSpotIndex;\r\n    };\r\n    (div as any).activateLayer = function (spotIndex) {\r\n        if (spotIndex < 0 || spotIndex > layerElArr.length - 1) {\r\n            throw 'invalid spotIndex ' + spotIndex + ', layerElArr.length ' + layerElArr.length;\r\n        }\r\n        selectedSpotIndex = spotIndex;\r\n        modeSelect.setValue(klCanvasLayerArr[selectedSpotIndex].mixModeStr);\r\n        for (let i = 0; i < layerElArr.length; i++) {\r\n            if (selectedSpotIndex === layerElArr[i].spot) {\r\n                layerElArr[i].style.backgroundColor = \"rgb( 250, 250, 250)\";\r\n                layerElArr[i].label.style.color = \"#000\";\r\n                layerElArr[i].style.boxShadow = \"\";\r\n                layerElArr[i].style.border = \"1px solid var(--active-highlight-color)\";\r\n                layerElArr[i].opacitySlider.setActive(true);\r\n                layerElArr[i].isSelected = true;\r\n            } else {\r\n                layerElArr[i].style.backgroundColor = \"rgb( 220, 220, 220)\";\r\n                layerElArr[i].label.style.color = \"#666\";\r\n                layerElArr[i].style.boxShadow = \"\";\r\n                layerElArr[i].style.border = \"1px solid rgb(158, 158, 158)\";\r\n                layerElArr[i].opacitySlider.setActive(false);\r\n                layerElArr[i].isSelected = false;\r\n            }\r\n        }\r\n        mergeBtn.disabled = selectedSpotIndex === 0;\r\n    };\r\n    (div as any).setUiState = function(stateStr) {\r\n        uiState = '' + stateStr;\r\n\r\n        if (uiState === 'left') {\r\n            BB.css(largeThumbDiv, {\r\n                left: '280px',\r\n                right: ''\r\n            });\r\n        } else {\r\n            BB.css(largeThumbDiv, {\r\n                left: '',\r\n                right: '280px'\r\n            });\r\n        }\r\n    };\r\n\r\n    createLayerList();\r\n\r\n    return div;\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1mb1v\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"11KJK\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"floUo\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kino6\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hhQeq\");","import {BB} from '../../bb/bb';\r\nimport {floodFillBits} from '../image-operations/flood-fill';\r\nimport {drawShape} from '../image-operations/shape-tool';\r\nimport {IRenderTextParam, renderText} from '../image-operations/render-text';\r\nimport {IGradient, IKlProject, IMixMode, IRGB, IShapeToolObject} from '../kl.types';\r\nimport {DecoyKlHistory, KlHistoryInterface} from '../history/kl-history';\r\nimport {drawProject} from './draw-project';\r\nimport {LANG} from '../../language/language';\r\nimport {drawGradient} from '../image-operations/gradient-tool';\r\n\r\n\r\nconst allowedMixModes = [\r\n    'source-over',\r\n    'darken',\r\n    'multiply',\r\n    'color-burn',\r\n    'lighten',\r\n    'screen',\r\n    'color-dodge',\r\n    'overlay',\r\n    'soft-light',\r\n    'hard-light',\r\n    'difference',\r\n    'exclusion',\r\n    'hue',\r\n    'saturation',\r\n    'color',\r\n    'luminosity',\r\n];\r\n\r\nexport const MAX_LAYERS = 16;\r\n\r\ninterface KlCanvasLayer extends HTMLCanvasElement {\r\n    name: string;\r\n    mixModeStr: IMixMode;\r\n    opacity: number;\r\n    compositeObj?: {\r\n        draw: (ctx: CanvasRenderingContext2D) => void;\r\n    },\r\n    index: number; // certain brushes need to know\r\n}\r\n\r\n/**\r\n * The image/canvas that the user paints on\r\n * Has layers. layers have names and opacity.\r\n *\r\n * Interacts with the history you specify (for undo/redo)\r\n */\r\nexport class KlCanvas {\r\n\r\n    // todo changeListener consistent concept\r\n    // todo history interaction, consistent concept - currently have to look at code to know if something pushes on history\r\n\r\n    private width: number;\r\n    private height: number;\r\n    private layerCanvasArr: KlCanvasLayer[];\r\n    private pickCanvas: HTMLCanvasElement; // canvas to draw into for color picker\r\n    private history: KlHistoryInterface;\r\n    private changeListenerArr:  (() => void)[]; // subscribers get notified when opacity changes\r\n\r\n\r\n    private init (w: number, h: number): void {\r\n        if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            throw new Error('init - invalid canvas size: ' + w + ', ' + h);\r\n        }\r\n        this.width = w;\r\n        this.height = h;\r\n    }\r\n\r\n    private emitChange (): void {\r\n        // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\r\n        this.changeListenerArr.forEach(item => item());\r\n    }\r\n\r\n    private updateIndices (): void {\r\n        this.layerCanvasArr.forEach((item, index) => {\r\n            item.index = index;\r\n        });\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        params: {\r\n            projectObj: {\r\n                width: number;\r\n                height: number;\r\n                layers: {\r\n                    name: string;\r\n                    opacity: number;\r\n                    image: HTMLImageElement | HTMLCanvasElement; // already loaded!\r\n                }[];\r\n            }\r\n        } | {\r\n            // creates blank KlCanvas, 0 layers\r\n            width: number;\r\n            height: number;\r\n        } | {\r\n            copy: KlCanvas;\r\n        },\r\n        private layerNrOffset: number = 0,\r\n    ) {\r\n        this.layerCanvasArr = [];\r\n        this.pickCanvas = BB.canvas(1, 1);\r\n        this.history = new DecoyKlHistory();\r\n        if ('copy' in params) {\r\n            this.width = 1;\r\n            this.height = 1;\r\n        } else {\r\n            if ('width' in params && 'height' in params) {\r\n                this.width = params.width;\r\n                this.height = params.height;\r\n            } else {\r\n                this.width = 1;\r\n                this.height = 1;\r\n            }\r\n        }\r\n        this.init(this.width, this.height);\r\n\r\n        this.changeListenerArr = [];\r\n\r\n        if ('copy' in params) {\r\n            try {\r\n                this.copy(params.copy);\r\n            } catch (e) {\r\n                this.destroy();\r\n                throw e;\r\n            }\r\n        } else if ('projectObj' in params) {\r\n            const origLayers = [].concat(params.projectObj.layers);\r\n            this.init(params.projectObj.width, params.projectObj.height);\r\n\r\n            if (!origLayers.length) {\r\n                throw new Error('project.layers needs at least 1 layer');\r\n            }\r\n\r\n            for (let i = 0; i < origLayers.length; i++) {\r\n                if (origLayers[i].mixModeStr && !allowedMixModes.includes(origLayers[i].mixModeStr)) {\r\n                    throw new Error('unknown mixModeStr ' + origLayers[i].mixModeStr);\r\n                }\r\n\r\n                this.addLayer();\r\n                this.layerOpacity(i, origLayers[i].opacity);\r\n                this.layerCanvasArr[i].name = origLayers[i].name;\r\n                this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr ? origLayers[i].mixModeStr : 'source-over';\r\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    /**\r\n     * Resets canvas -> 1 layer, 100% opacity,\r\n     * unless layers provided.\r\n     * @param p\r\n     */\r\n    reset (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n            color?: IRGB; // optional - fill color\r\n            image?: HTMLImageElement | HTMLCanvasElement; // image drawn on layer\r\n            layerName?: string; // if via image\r\n            layers?: {\r\n                name: string;\r\n                opacity: number;\r\n                mixModeStr: IMixMode;\r\n                image: HTMLCanvasElement;\r\n            }[];\r\n        }\r\n    ): void | number {\r\n        if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height) ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        this.history.pause(true);\r\n\r\n        this.width = p.width;\r\n        this.height = p.height;\r\n\r\n        this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\r\n\r\n        if (p.layers) {\r\n            for (let i = 0; i < p.layers.length; i++) {\r\n                let item = p.layers[i];\r\n                if (!this.layerCanvasArr[i]) {\r\n                    this.addLayer();\r\n                }\r\n                this.layerCanvasArr[i].name = item.name;\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n                this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : 'source-over';\r\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(item.image, 0, 0);\r\n                this.layerOpacity(i, item.opacity);\r\n            }\r\n        } else {\r\n            this.layerCanvasArr[0].name = p.layerName ? p.layerName : LANG('layers-layer') + \" 1\";\r\n            this.layerCanvasArr[0].width = this.width;\r\n            this.layerCanvasArr[0].height = this.height;\r\n            this.layerCanvasArr[0].mixModeStr = 'source-over';\r\n            this.layerOpacity(0, 1);\r\n            if (p.color) {\r\n                this.layerFill(0, p.color);\r\n            } else if (p.image) {\r\n                this.layerCanvasArr[0].getContext(\"2d\").drawImage(p.image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n\r\n        this.history.pause(false);\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"reset\",\r\n            params: [p] // dont screw with p\r\n        });\r\n\r\n        return this.layerCanvasArr.length - 1;\r\n    }\r\n\r\n    isLayerLimitReached (): boolean {\r\n        return this.layerCanvasArr.length >= MAX_LAYERS;\r\n    }\r\n\r\n    getWidth (): number {\r\n        return this.width;\r\n    }\r\n\r\n    getHeight (): number {\r\n        return this.height;\r\n    }\r\n\r\n    copy (toCopyCanvas: KlCanvas): void {\r\n        if (\r\n            toCopyCanvas.getWidth() < 1 ||\r\n            toCopyCanvas.getHeight() < 1 ||\r\n            isNaN(toCopyCanvas.getWidth()) ||\r\n            isNaN(toCopyCanvas.getHeight())\r\n        ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        // keep existing canvases\r\n\r\n        let origLayers = toCopyCanvas.getLayers();\r\n\r\n        while (this.layerCanvasArr.length > origLayers.length) {\r\n            this.removeLayer(this.layerCanvasArr.length - 1);\r\n        }\r\n\r\n        if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) {\r\n            this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\r\n        }\r\n        for (let i = 0; i < origLayers.length; i++) {\r\n            if (i >= this.layerCanvasArr.length) {\r\n                this.addLayer();\r\n            } else {\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n            }\r\n            this.layerOpacity(i, origLayers[i].opacity);\r\n            this.layerCanvasArr[i].name = origLayers[i].name;\r\n            this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].context.canvas, 0, 0);\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    getLayerCount (): number {\r\n        return this.layerCanvasArr.length;\r\n    }\r\n\r\n    resize (w: number, h: number, algorithm: 'smooth' | 'pixelated' = 'smooth'): boolean {\r\n        if (!w || !h || (w === this.width && h === this.height) || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            return false;\r\n        }\r\n        w = Math.max(w, 1);\r\n        h = Math.max(h, 1);\r\n\r\n        let tmp1, tmp2;\r\n\r\n        if (algorithm === 'pixelated') {\r\n            tmp1 = BB.canvas(w, h);\r\n            let tmp1Ctx = tmp1.getContext('2d');\r\n            tmp1Ctx.imageSmoothingEnabled = false;\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                if (i > 0) {\r\n                    tmp1Ctx.clearRect(0, 0, w, h);\r\n                }\r\n                let layerCanvas = this.layerCanvasArr[i];\r\n                tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\r\n                layerCanvas.width = w;\r\n                layerCanvas.height = h;\r\n                let layerContext = layerCanvas.getContext('2d');\r\n                layerContext.drawImage(tmp1, 0, 0);\r\n            }\r\n\r\n        } else if (algorithm === 'smooth') {\r\n            tmp1 = BB.canvas();\r\n            tmp2 = BB.canvas();\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                BB.resizeCanvas(this.layerCanvasArr[i], w, h, tmp1, tmp2);\r\n            }\r\n        } else {\r\n            throw new Error('unknown resize algorithm');\r\n        }\r\n\r\n        this.width = w;\r\n        this.height = h;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * crop / extend\r\n     * @param p\r\n     */\r\n    resizeCanvas (p: {\r\n        left: number;\r\n        top: number;\r\n        right: number;\r\n        bottom: number;\r\n        fillColor?: IRGB\r\n    }): void {\r\n\r\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\r\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\r\n        const offX = Math.round(p.left);\r\n        const offY = Math.round(p.top);\r\n\r\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) {\r\n            throw new Error('KlCanvas.resizeCanvas - invalid canvas size');\r\n        }\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            const ctemp = BB.canvas(this.width, this.height);\r\n            let layerCanvas = this.layerCanvasArr[i];\r\n            let layerCtx = this.layerCanvasArr[i].getContext(\"2d\");\r\n            ctemp.getContext(\"2d\").drawImage(layerCanvas, 0, 0);\r\n\r\n            this.layerCanvasArr[i].width = newW;\r\n            this.layerCanvasArr[i].height = newH;\r\n\r\n            layerCtx.save();\r\n            if (i === 0 && p.fillColor) {\r\n                layerCtx.fillStyle = BB.ColorConverter.toRgbStr(p.fillColor);\r\n                layerCtx.fillRect(0, 0, newW, newH);\r\n                layerCtx.clearRect(offX, offY, this.width, this.height);\r\n            }\r\n            layerCtx.drawImage(ctemp, offX, offY);\r\n            layerCtx.restore();\r\n        }\r\n        this.width = newW;\r\n        this.height = newH;\r\n    }\r\n\r\n    /**\r\n     * will be inserted on top of selected\r\n     * @param selected\r\n     */\r\n    addLayer (selected?: number): false | number {\r\n        if (this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        let canvas = BB.canvas(this.width, this.height);\r\n        if (!canvas.getContext('2d')) {\r\n            throw new Error('kl-create-canvas-error');\r\n        }\r\n\r\n        (canvas as any).mixModeStr = 'source-over';\r\n\r\n        if (selected === undefined) {\r\n            this.layerCanvasArr[this.layerCanvasArr.length] = canvas as any;\r\n            selected = Math.max(0, this.layerCanvasArr.length - 1);\r\n        } else {\r\n            this.layerCanvasArr.splice(selected + 1, 0, canvas as any);\r\n            selected++;\r\n        }\r\n\r\n        (canvas as any).name = LANG('layers-layer') + \" \" + (this.layerCanvasArr.length + this.layerNrOffset);\r\n        this.history.pause(true);\r\n        this.layerOpacity(selected, 1);\r\n        this.history.pause(false);\r\n        this.updateIndices();\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"addLayer\",\r\n            params: [selected - 1]\r\n        });\r\n        return selected;\r\n    }\r\n\r\n    duplicateLayer (i: number): false | number {\r\n        if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        let canvas = BB.canvas(this.width, this.height);\r\n        this.layerCanvasArr.splice(i + 1, 0, canvas as any);\r\n\r\n        (canvas as any).name = this.layerCanvasArr[i].name + \" \" + LANG('layers-copy');\r\n        (canvas as any).mixModeStr = this.layerCanvasArr[i].mixModeStr;\r\n        canvas.getContext(\"2d\").drawImage(this.layerCanvasArr[i], 0, 0);\r\n        this.history.pause(true);\r\n        this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\r\n        this.history.pause(false);\r\n\r\n        this.updateIndices();\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"duplicateLayer\",\r\n            params: [i]\r\n        });\r\n        return i + 1;\r\n    }\r\n\r\n    getLayerContext (i: number, doReturnNull?: boolean): CanvasRenderingContext2D | null {\r\n        if (this.layerCanvasArr[i]) {\r\n            return this.layerCanvasArr[i].getContext(\"2d\");\r\n        }\r\n        if (doReturnNull) {\r\n            return null;\r\n        }\r\n        throw new Error(\"layer of index \" + i + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n    }\r\n\r\n    removeLayer (i: number): false | number {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr.splice(i, 1);\r\n            this.updateIndices();\r\n        } else {\r\n            return false;\r\n        }\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"removeLayer\",\r\n            params: [i]\r\n        });\r\n\r\n        return Math.max(0, i - 1);\r\n    }\r\n\r\n    renameLayer (i: number, name: string): boolean {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr[i].name = name;\r\n        } else {\r\n            return false;\r\n        }\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"renameLayer\",\r\n            params: [i, name]\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n    layerOpacity (i: number, o: number): void {\r\n        if (!this.layerCanvasArr[i]) {\r\n            return;\r\n        }\r\n        o = Math.max(0, Math.min(1, o));\r\n        this.layerCanvasArr[i].opacity = o;\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"layerOpacity\",\r\n            params: [i, o]\r\n        });\r\n\r\n        this.emitChange();\r\n    }\r\n\r\n    moveLayer (i: number, d: number): void | number {\r\n        if (d === 0) {\r\n            return;\r\n        }\r\n        if (this.layerCanvasArr[i]) {\r\n            const temp = this.layerCanvasArr[i];\r\n            this.layerCanvasArr.splice(i, 1);\r\n            const targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\r\n            this.layerCanvasArr.splice(targetIndex, 0, temp);\r\n            this.updateIndices();\r\n            this.history.push({\r\n                tool: [\"canvas\"],\r\n                action: \"moveLayer\",\r\n                params: [i, d]\r\n            });\r\n            return targetIndex;\r\n        }\r\n    }\r\n\r\n    mergeLayers (layerBottomIndex: number, layerTopIndex: number, mixModeStr: IMixMode | 'as-alpha'): void | number {\r\n        if (\r\n            !this.layerCanvasArr[layerBottomIndex] ||\r\n            !this.layerCanvasArr[layerTopIndex] ||\r\n            layerBottomIndex === layerTopIndex\r\n        ) {\r\n            return;\r\n        }\r\n        //order messed up\r\n        if (layerBottomIndex > layerTopIndex) {\r\n            let temp = layerBottomIndex;\r\n            layerBottomIndex = layerTopIndex;\r\n            layerTopIndex = temp;\r\n        }\r\n\r\n        let topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\r\n        if (topOpacity !== 0 && topOpacity) {\r\n            let ctx = this.layerCanvasArr[layerBottomIndex].getContext(\"2d\");\r\n            ctx.save();\r\n\r\n            if (mixModeStr === 'as-alpha') { // todo remove this?\r\n\r\n                BB.convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\r\n                ctx.globalCompositeOperation = 'destination-in';\r\n                ctx.globalAlpha = topOpacity;\r\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            } else {\r\n\r\n                if (mixModeStr) {\r\n                    ctx.globalCompositeOperation = mixModeStr;\r\n                }\r\n                ctx.globalAlpha = topOpacity;\r\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            }\r\n\r\n            ctx.restore();\r\n\r\n            // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n            // TODO remove if chrome updated\r\n            if (mixModeStr) {\r\n                ctx.save();\r\n                ctx.fillStyle = \"rgba(0,0,0,0.01)\";\r\n                ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n                ctx.restore();\r\n            }\r\n        }\r\n        this.updateIndices();\r\n        this.history.pause(true);\r\n        this.removeLayer(layerTopIndex);\r\n        this.history.pause(false);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"mergeLayers\",\r\n            params: [layerBottomIndex, layerTopIndex, mixModeStr]\r\n        });\r\n\r\n        return layerBottomIndex;\r\n    }\r\n\r\n    rotate (deg: number): void {\r\n        while (deg < 0) {\r\n            deg += 360;\r\n        }\r\n        deg %= 360;\r\n        if (deg % 90 != 0 || deg === 0)\r\n            return;\r\n        let temp = BB.canvas();\r\n        if (deg === 0 || deg === 180) {\r\n            temp.width = this.width;\r\n            temp.height = this.height;\r\n        } else if (deg === 90 || deg === 270) {\r\n            temp.width = this.height;\r\n            temp.height = this.width;\r\n        }\r\n        let ctx = temp.getContext(\"2d\");\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.clearRect(0, 0, temp.width, temp.height);\r\n            ctx.save();\r\n            ctx.translate(temp.width / 2, temp.height / 2);\r\n            ctx.rotate(deg * Math.PI / 180);\r\n            if (deg === 180) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            } else if (deg === 90 || deg === 270) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\r\n            }\r\n            this.layerCanvasArr[i].width = temp.width;\r\n            this.layerCanvasArr[i].height = temp.height;\r\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\r\n            ctx.restore();\r\n        }\r\n        this.width = temp.width;\r\n        this.height = temp.height;\r\n    }\r\n\r\n    flip (isHorizontal: boolean, isVertical: boolean, layerIndex: number): void {\r\n        if (!isHorizontal && !isVertical) {\r\n            return;\r\n        }\r\n\r\n        let temp = BB.canvas(this.width, this.height);\r\n        temp.width = this.width;\r\n        temp.height = this.height;\r\n        let tempCtx = temp.getContext(\"2d\");\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n\r\n            if ( (layerIndex || layerIndex === 0) && i !== layerIndex) {\r\n                continue;\r\n            }\r\n\r\n            tempCtx.save();\r\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\r\n            tempCtx.translate(temp.width / 2, temp.height / 2);\r\n            tempCtx.scale((isHorizontal ? -1 : 1), (isVertical ? -1 : 1));\r\n            tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            tempCtx.restore();\r\n\r\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\r\n        }\r\n    }\r\n\r\n    layerFill (layerIndex: number, colorObj: IRGB, compositeOperation?: string): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.save();\r\n        if (compositeOperation) {\r\n            ctx.globalCompositeOperation = compositeOperation as GlobalCompositeOperation;\r\n        }\r\n        ctx.fillStyle = \"rgba(\" + colorObj.r + \",\" + colorObj.g + \",\" + colorObj.b + \",1)\";\r\n        ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n        // TODO remove if chrome updated\r\n        ctx.save();\r\n        ctx.fillStyle = \"rgba(0,0,0,0.01)\";\r\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n        ctx.restore();\r\n\r\n        /*if (!document.getElementById('testocanvas')) {\r\n            layerCanvasArr[layerIndex].id = 'testocanvas';\r\n            document.body.appendChild(layerCanvasArr[layerIndex]);\r\n            BB.css(layerCanvasArr[layerIndex], {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }\r\n        if (!document.getElementById('testocanvas')) {\r\n            let c = document.createElement('canvas');\r\n            c.width = 1000;\r\n            c.height = 1000;\r\n            let ctx2 = c.getContext('2d');\r\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\r\n            c.id = 'testocanvas';\r\n            document.body.appendChild(c);\r\n            BB.css(c, {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }*/\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"layerFill\",\r\n            params: [layerIndex, colorObj, compositeOperation]\r\n        });\r\n    }\r\n\r\n    floodFill (\r\n        layerIndex: number, // index of layer to be filled\r\n        x: number, // starting point\r\n        y: number,\r\n        rgb: IRGB | null, // fill color, if null -> erase\r\n        opacity: number,\r\n        tolerance: number,\r\n        sampleStr: 'current' | 'all' | 'above',\r\n        grow: number, // int >= 0 - radius around filled area that is to be filled too\r\n        isContiguous: boolean,\r\n    ): void {\r\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) {\r\n            return;\r\n        }\r\n        tolerance = Math.round(tolerance);\r\n\r\n        if (!(['above', 'current', 'all'].includes(sampleStr))) {\r\n            throw new Error('invalid sampleStr');\r\n        }\r\n\r\n        let result;\r\n\r\n        let srcCtx;\r\n        let srcImageData;\r\n        let srcData;\r\n\r\n        let targetCtx;\r\n        let targetImageData;\r\n        let targetData;\r\n\r\n\r\n        if (sampleStr === 'all') {\r\n\r\n            let srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\r\n            srcCtx = srcCanvas.getContext('2d');\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            srcCanvas = null;\r\n            srcCtx = null;\r\n            srcImageData = null;\r\n            srcData = null;\r\n\r\n            targetCtx = this.layerCanvasArr[layerIndex].getContext('2d');\r\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        } else {\r\n            let srcIndex = sampleStr === 'above' ? layerIndex + 1 : layerIndex;\r\n\r\n            if (srcIndex >= this.layerCanvasArr.length) {\r\n                return;\r\n            }\r\n\r\n            srcCtx = this.layerCanvasArr[srcIndex].getContext('2d');\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            if (layerIndex !== srcIndex) {\r\n                srcCtx = null;\r\n                srcImageData = null;\r\n                srcData = null;\r\n            }\r\n\r\n            targetCtx = layerIndex === srcIndex ? srcCtx : this.layerCanvasArr[layerIndex].getContext('2d');\r\n            targetImageData = layerIndex === srcIndex ? srcImageData : targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        }\r\n\r\n        targetData = targetImageData.data;\r\n        if (rgb) {\r\n            if (opacity === 1) {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4] = rgb.r;\r\n                        targetData[i * 4 + 1] = rgb.g;\r\n                        targetData[i * 4 + 2] = rgb.b;\r\n                        targetData[i * 4 + 3] = 255;\r\n                    }\r\n                }\r\n            } else {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4] = BB.mix(targetData[i * 4], rgb.r, opacity);\r\n                        targetData[i * 4 + 1] = BB.mix(targetData[i * 4 + 1], rgb.g, opacity);\r\n                        targetData[i * 4 + 2] = BB.mix(targetData[i * 4 + 2], rgb.b, opacity);\r\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 255, opacity);\r\n                    }\r\n                }\r\n            }\r\n        } else { // erase\r\n            if (opacity === 1) {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4 + 3] = 0;\r\n                    }\r\n                }\r\n            } else {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 0, opacity);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        targetCtx.putImageData(targetImageData, 0, 0);\r\n\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [layerIndex, targetImageData]\r\n        });\r\n    }\r\n\r\n    /**\r\n     * draw shape via BB.drawShape\r\n     * @param layerIndex\r\n     * @param shapeObj\r\n     */\r\n    drawShape (layerIndex: number, shapeObj: IShapeToolObject): void {\r\n        if (shapeObj.x1 === shapeObj.x2 && shapeObj.y1 === shapeObj.y2) {\r\n            return;\r\n        }\r\n        drawShape(this.layerCanvasArr[layerIndex].getContext(\"2d\"), shapeObj);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"drawShape\",\r\n            params: [layerIndex, BB.copyObj(shapeObj)],\r\n        });\r\n    }\r\n\r\n    drawGradient(layerIndex: number, gradientObj: IGradient): void {\r\n        drawGradient(this.layerCanvasArr[layerIndex].getContext(\"2d\"), gradientObj);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"drawGradient\",\r\n            params: [layerIndex, BB.copyObj(gradientObj)],\r\n        });\r\n    }\r\n\r\n    text (layerIndex: number, p: IRenderTextParam): void {\r\n        renderText(this.layerCanvasArr[layerIndex], BB.copyObj(p));\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"text\",\r\n            params: [layerIndex, BB.copyObj(p)],\r\n        });\r\n    }\r\n\r\n    replaceLayer (layerIndex: number, imageData: ImageData): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.putImageData(imageData, 0, 0);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [layerIndex, imageData],\r\n        });\r\n    }\r\n\r\n    clearLayer (layerIndex: number): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"clearLayer\",\r\n            params: [layerIndex]\r\n        });\r\n    }\r\n\r\n    getLayers (): {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                context: item.getContext(\"2d\"),\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayersFast (): {\r\n        canvas: KlCanvasLayer;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                canvas: item,\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayerIndex (canvasObj: HTMLCanvasElement, doReturnNull?: boolean): null | number {\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            if (this.layerCanvasArr[i] === canvasObj) {\r\n                return i;\r\n            }\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error(\"layer not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getLayer (index: number, doReturnNull?: boolean): null | {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        id: number;\r\n    } {\r\n        if (this.layerCanvasArr[index]) {\r\n            return {\r\n                context: this.layerCanvasArr[index].getContext(\"2d\"),\r\n                opacity: this.layerCanvasArr[index].opacity,\r\n                name: this.layerCanvasArr[index].name,\r\n                id: index,\r\n            };\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error(\"layer of index \" + index + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getColorAt (x: number, y: number): IRGB {\r\n        x = Math.floor(x);\r\n        y = Math.floor(y);\r\n        let ctx = this.pickCanvas.getContext(\"2d\");\r\n        ctx.save();\r\n        ctx.imageSmoothingEnabled = false;\r\n        ctx.clearRect(0, 0, 1, 1);\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.globalAlpha = this.layerCanvasArr[i].opacity;\r\n            ctx.globalCompositeOperation = this.layerCanvasArr[i].mixModeStr;\r\n            ctx.drawImage(this.layerCanvasArr[i], -x, -y);\r\n        }\r\n        ctx.restore();\r\n        let imData = ctx.getImageData(0, 0, 1, 1);\r\n        return new BB.RGB(imData.data[0], imData.data[1], imData.data[2]);\r\n    }\r\n\r\n    getCompleteCanvas (factor: number): HTMLCanvasElement {\r\n        return drawProject(this.getProject(), factor);\r\n    }\r\n\r\n    getProject (): IKlProject {\r\n        return {\r\n            width: this.width,\r\n            height: this.height,\r\n            layers: this.layerCanvasArr.map(layer => {\r\n                return {\r\n                    name: layer.name,\r\n                    opacity: layer.opacity,\r\n                    mixModeStr: layer.mixModeStr,\r\n                    image: layer,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    addChangeListener (func: () => void): void {\r\n        if (this.changeListenerArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.changeListenerArr.push(func);\r\n    }\r\n\r\n    removeChangeListener (func: () => void): void {\r\n        for (let i = 0; i < this.changeListenerArr.length; i++) {\r\n            if (this.changeListenerArr[i] === func) {\r\n                this.changeListenerArr.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    setMixMode (layerIndex: number, mixModeStr: IMixMode): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"setMixMode\",\r\n            params: [layerIndex, '' + mixModeStr],\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Set composite drawing step for KlCanvasWorkspace.\r\n     * To apply temporary manipulations to a layer.\r\n     *\r\n     * @param layerIndex\r\n     * @param compositeObj\r\n     */\r\n    setComposite (\r\n        layerIndex: number,\r\n        compositeObj: null | {\r\n            draw: (ctx: CanvasRenderingContext2D) => void;\r\n        }\r\n    ): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].compositeObj = compositeObj;\r\n    }\r\n\r\n    destroy (): void {\r\n        if (this.layerCanvasArr === null) {\r\n            return;\r\n        }\r\n        this.layerCanvasArr.forEach(canvas => {\r\n            BB.freeCanvas(canvas);\r\n        });\r\n        this.layerCanvasArr = null;\r\n    }\r\n\r\n}\r\n","\r\n/**\r\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/ but it implemented tolerance wrong, and had bugs.\r\n * So, my own implementation. can handle tolerance, grow, opacity.\r\n * Needs to be optimized.\r\n */\r\n\r\n/**\r\n * Set values in data within rect to 254, unless they're 255\r\n *\r\n * @param data Uint8Array\r\n * @param width int\r\n * @param x0 int\r\n * @param y0 int\r\n * @param x1 int >x0\r\n * @param y1 int >y0\r\n */\r\nfunction fillRect(data, width, x0, y0, x1, y1) {\r\n    for (let x = x0; x <= x1; x++) {\r\n        for (let y = y0; y <= y1; y++) {\r\n            if (data[y * width + x] === 255) {\r\n                continue;\r\n            }\r\n            data[y * width + x] = 254;\r\n        }\r\n    }\r\n}\r\n\r\nlet mx, my;\r\n\r\n/**\r\n * Get index i moved by dX, dY. in array with dimensions width height.\r\n * Returns null if outside bounds.\r\n *\r\n * @param width int\r\n * @param height int\r\n * @param i int\r\n * @param dX int\r\n * @param dY int\r\n * @returns {null|*}\r\n */\r\nfunction moveIndex(width, height, i, dX, dY) {\r\n    mx = i % width + dX;\r\n    my = Math.floor(i / width) + dY;\r\n\r\n    if (mx < 0 || my < 0 || mx >= width || my >= height) {\r\n        return null;\r\n    }\r\n\r\n    return my * width + mx;\r\n}\r\n\r\n/**\r\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\r\n * returns false if already filled, or i is null\r\n *\r\n * @param srcArr Uint8Array rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param initRgba rgba\r\n * @param tolerance int 0 - 255\r\n * @param i int - srcArr index\r\n * @returns {boolean}\r\n */\r\nfunction testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i) {\r\n    if (i === null || targetArr[i] === 255) {\r\n        return false;\r\n    }\r\n\r\n    if (\r\n        srcArr[i * 4] === initRgba[0] &&\r\n        srcArr[i * 4 + 1] === initRgba[1] &&\r\n        srcArr[i * 4 + 2] === initRgba[2] &&\r\n        srcArr[i * 4 + 3] === initRgba[3]\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    if (\r\n        tolerance > 0 &&\r\n        Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n\r\n/**\r\n *\r\n * @param srcArr Uint8Array rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param px int\r\n * @param py int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n */\r\nfunction floodFill(srcArr, targetArr, width, height, px, py, tolerance, grow, isContiguous) {\r\n\r\n    let initRgba = [\r\n        srcArr[(py * width + px) * 4],\r\n        srcArr[(py * width + px) * 4 + 1],\r\n        srcArr[(py * width + px) * 4 + 2],\r\n        srcArr[(py * width + px) * 4 + 3]\r\n    ];\r\n\r\n    if (isContiguous) {\r\n        let q = [];\r\n        q.push(py * width + px);\r\n        targetArr[py * width + px] = 255;\r\n\r\n        let i, e;\r\n        while (q.length) {\r\n            i = q.pop();\r\n\r\n            // queue up unfilled neighbors\r\n            e = moveIndex(width, height, i, -1, 0); // left\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n\r\n            e = moveIndex(width, height, i, 1, 0); // right\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n\r\n            e = moveIndex(width, height, i, 0, -1); // up\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n\r\n            e = moveIndex(width, height, i, 0, 1); // bottom\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n        }\r\n    } else {\r\n        for (let i = 0; i < width * height; i++) {\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i);\r\n        }\r\n    }\r\n\r\n\r\n    // grow\r\n    if (grow === 0) {\r\n        return;\r\n    }\r\n\r\n    // how does it grow? it finds all pixel at the edge.\r\n    // then depending on what kind of edge it is, it draws a rectangle into target\r\n    // the rectangle has the value 254, or else it mess it all up.\r\n    // after it's all done, replaces it with 255\r\n    let x0, x1, y0, y1;\r\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\r\n    for (let x = 0; x < width; x++) {\r\n        for (let y = 0; y < height; y++) {\r\n            if (targetArr[y * width + x] !== 255) {\r\n                continue;\r\n            }\r\n\r\n            // bounds of rectangle\r\n            x0 = x;\r\n            x1 = x;\r\n            y0 = y;\r\n            y1 = y;\r\n\r\n            l = targetArr[(y) * width + x - 1] !== 255;\r\n            tl = targetArr[(y - 1) * width + x - 1] !== 255;\r\n            t = targetArr[(y - 1) * width + x] !== 255;\r\n            tr = targetArr[(y - 1) * width + x + 1] !== 255;\r\n            r = targetArr[(y) * width + x + 1] !== 255;\r\n            br = targetArr[(y + 1) * width + x + 1] !== 255;\r\n            b = targetArr[(y + 1) * width + x] !== 255;\r\n            bl = targetArr[(y + 1) * width + x - 1] !== 255;\r\n\r\n            if (l) { // left\r\n                x0 = x - grow;\r\n            }\r\n            if (l && tl && t) { // top left\r\n                x0 = x - grow;\r\n                y0 = y - grow;\r\n            }\r\n            if (t) { // top\r\n                y0 = Math.min(y0, y - grow);\r\n            }\r\n            if (t && tr && r) { // top right\r\n                y0 = Math.min(y0, y - grow);\r\n                x1 = x + grow;\r\n            }\r\n            if (r) { // right\r\n                x1 = Math.max(x1, x + 1 * grow);\r\n            }\r\n            if (r && br && b) { // bottom right\r\n                x1 = Math.max(x1, x + 1 * grow);\r\n                y1 = Math.max(y1, y + 1 * grow);\r\n            }\r\n            if (b) { // bottom\r\n                y1 = Math.max(y1, y + 1 * grow);\r\n            }\r\n            if (b && bl && l) { // bottom left\r\n                x0 = Math.min(x0, x - 1 * grow);\r\n                y1 = Math.max(y1, y + 1 * grow);\r\n            }\r\n\r\n            if (!l && !tl && !t && !tr && !r && !br && !b && !bl) {\r\n                continue;\r\n            }\r\n\r\n            fillRect(\r\n                targetArr,\r\n                width,\r\n                Math.max(0, x0),\r\n                Math.max(0, y0),\r\n                Math.min(width - 1, x1),\r\n                Math.min(height - 1, y1)\r\n            );\r\n        }\r\n    }\r\n    for (let i = 0; i < width * height; i++) {\r\n        if (targetArr[i] === 254) {\r\n            targetArr[i] = 255;\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * Does flood fill, and returns that. an array - 0 not filled. 255 filled\r\n *\r\n * returns {\r\n *     data: Uint8Array\r\n * }\r\n *\r\n * @param rgbaArr Uint8Array rgba\r\n * @param width int\r\n * @param height int\r\n * @param x int\r\n * @param y int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n * @returns {{data: Uint8Array}}\r\n */\r\nexport function floodFillBits(rgbaArr, width, height, x, y, tolerance, grow, isContiguous) {\r\n    x = Math.round(x);\r\n    y = Math.round(y);\r\n\r\n    let resultArr = new Uint8Array(new ArrayBuffer(width * height));\r\n\r\n    floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\r\n\r\n    return {\r\n        data: resultArr\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB, IShapeToolObject} from '../kl.types';\r\n\r\n\r\n/**\r\n * Input processor for shape tool.\r\n * Coordinates are in canvas space.\r\n * angleRad is the angle of the canvas.\r\n *\r\n * @param p - {onShape: func(isDone, x1, y1, x2, y2, angleRad)}\r\n * @constructor\r\n */\r\nexport function ShapeTool(p) {\r\n\r\n    let downX, downY, downAngleRad;\r\n\r\n    this.onDown = function(x, y, angleRad) {\r\n        downX = x;\r\n        downY = y;\r\n        downAngleRad = angleRad;\r\n    };\r\n\r\n    this.onMove = function(x, y) {\r\n        p.onShape(false, downX, downY, x, y, downAngleRad);\r\n    };\r\n\r\n    this.onUp = function(x, y) {\r\n        p.onShape(true, downX, downY, x, y, downAngleRad);\r\n    };\r\n}\r\n\r\nfunction applyDefaults(obj: any, defaults: any): void {\r\n    for (const property in defaults) {\r\n        if (!(property in obj)) {\r\n            obj[property] = defaults[property];\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Draw a shape (rectangle, ellipse, line)\r\n *\r\n * @param ctx\r\n * @param shapeObj\r\n */\r\nexport function drawShape(\r\n    ctx: CanvasRenderingContext2D,\r\n    shapeObj: IShapeToolObject,\r\n) {\r\n    shapeObj = BB.copyObj(shapeObj);\r\n    applyDefaults(shapeObj, {\r\n        angleRad: 0,\r\n        isOutwards: false,\r\n        opacity: 1,\r\n        isEraser: false,\r\n        doLockAlpha: false,\r\n    });\r\n\r\n    if (['rect', 'ellipse', 'line'].includes(shapeObj.type)) {\r\n        const lineWidth = Math.round(shapeObj.lineWidth);\r\n        const angleDeg = shapeObj.angleRad * 180 / Math.PI;\r\n\r\n        // --- prep color ---\r\n        let colorRGB: IRGB = shapeObj.isEraser ? {r: 255, g: 255, b: 255} : (shapeObj.fillRgb ? shapeObj.fillRgb : shapeObj.strokeRgb);\r\n\r\n\r\n        // --- prep canvas ---\r\n        ctx.save();\r\n        if (shapeObj.opacity) {\r\n            ctx.globalAlpha = shapeObj.opacity;\r\n        }\r\n        if (shapeObj.isEraser) {\r\n            ctx.globalCompositeOperation = 'destination-out';\r\n        }\r\n        if (shapeObj.doLockAlpha) {\r\n            ctx.globalCompositeOperation = 'source-atop';\r\n        }\r\n        ctx.rotate(-shapeObj.angleRad);\r\n        if (shapeObj.fillRgb) {\r\n            ctx.fillStyle = BB.ColorConverter.toRgbStr(colorRGB);\r\n        } else if (shapeObj.strokeRgb) {\r\n            ctx.strokeStyle = BB.ColorConverter.toRgbStr(colorRGB);\r\n            ctx.lineWidth = lineWidth;\r\n        }\r\n\r\n        let x1 = shapeObj.x1;\r\n        let y1 = shapeObj.y1;\r\n        let x2 = shapeObj.x2;\r\n        let y2 = shapeObj.y2;\r\n\r\n        // --- angle snapping ---\r\n        if (shapeObj.isAngleSnap) {\r\n            let r1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            let r2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            let pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\r\n            let pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\r\n            let rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\r\n            x2 = rotated.x;\r\n            y2 = rotated.y;\r\n\r\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\r\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\r\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\r\n                    x2 = x1;\r\n                } else { // left or right\r\n                    y2 = y1;\r\n                }\r\n            }\r\n        }\r\n\r\n        let x = x1;\r\n        let y = y1;\r\n        let dX = x2 - x1;\r\n        let dY = y2 - y1;\r\n\r\n        // --- 1:1 ratio ---\r\n        if (shapeObj.type !== 'line' && shapeObj.isFixedRatio) {\r\n            let r1 = BB.rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\r\n            let r2 = BB.rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            let rx = r1.x;\r\n            let ry = r1.y;\r\n            let rdX = r2.x - r1.x;\r\n            let rdY = r2.y - r1.y;\r\n\r\n            if (Math.abs(rdX) < Math.abs(rdY)) {\r\n                rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\r\n            } else {\r\n                rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\r\n            }\r\n            r2.x = rx + rdX;\r\n            r2.y = ry + rdY;\r\n\r\n            r1 = BB.rotate(r1.x, r1.y, -shapeObj.angleRad / Math.PI * 180);\r\n            r2 = BB.rotate(r2.x, r2.y, -shapeObj.angleRad / Math.PI * 180);\r\n\r\n            x1 = r1.x;\r\n            y1 = r1.y;\r\n            x2 = r2.x;\r\n            y2 = r2.y;\r\n\r\n            x = x1;\r\n            y = y1;\r\n            dX = x2 - x1;\r\n            dY = y2 - y1;\r\n        }\r\n\r\n        // outwards modifier\r\n        if (shapeObj.isOutwards) {\r\n            x -= dX;\r\n            y -= dY;\r\n            dX *= 2;\r\n            dY *= 2;\r\n\r\n            x1 = x;\r\n            y1 = y;\r\n            x2 = x + dX;\r\n            y2 = y + dY;\r\n        }\r\n\r\n        let p1;\r\n        let p2;\r\n        if (shapeObj.type === 'line') { // --- line ---\r\n\r\n            // rounded\r\n            const x1r = Math.round(x1);\r\n            const y1r = Math.round(y1);\r\n            const x2r = Math.round(x2);\r\n            const y2r = Math.round(y2);\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (lineWidth % 2 === 0) {\r\n\r\n                if (y1r === y2r) {\r\n                    p1 = {\r\n                        x: x1f,\r\n                        y: y1r,\r\n                    };\r\n                    p2 = {\r\n                        x: x2f,\r\n                        y: y2r,\r\n                    };\r\n\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                } else if (x1r === x2r) {\r\n                    p1 = {\r\n                        x: x1r,\r\n                        y: y1f,\r\n                    };\r\n                    p2 = {\r\n                        x: x2r,\r\n                        y: y2f,\r\n                    };\r\n\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                } else {\r\n                    p1 = {\r\n                        x: x1,\r\n                        y: y1,\r\n                    };\r\n                    p2 = {\r\n                        x: x2,\r\n                        y: y2,\r\n                    };\r\n                }\r\n\r\n            } else {\r\n                p1 = {\r\n                    x: x1f,\r\n                    y: y1f,\r\n                };\r\n                p2 = {\r\n                    x: x2f,\r\n                    y: y2f,\r\n                };\r\n                if (y1f === y2f) {\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                    p1.y += 0.5;\r\n                    p2.y += 0.5;\r\n                } else if (x1f === x2f) {\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                    p1.x += 0.5;\r\n                    p2.x += 0.5;\r\n                } else {\r\n                    p1.x = x1;\r\n                    p1.y = y1;\r\n                    p2.x = x2;\r\n                    p2.y = y2;\r\n                }\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            ctx.beginPath();\r\n            ctx.moveTo(p1.x, p1.y);\r\n            ctx.lineTo(p2.x, p2.y);\r\n            ctx.stroke();\r\n\r\n        } else if (shapeObj.type === 'rect') { // --- rect ---\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (angleDeg % 90 === 0) {\r\n                if (shapeObj.fillRgb) {\r\n                    if (x1 % 1 === 0) {\r\n                        x1 += 1;\r\n                    }\r\n                    if (y1 % 1 === 0) {\r\n                        y1 += 1;\r\n                    }\r\n                    if (x2 % 1 === 0) {\r\n                        x2 += 1;\r\n                    }\r\n                    if (y2 % 1 === 0) {\r\n                        y2 += 1;\r\n                    }\r\n\r\n                    p1 = {\r\n                        x: x1 < x2 ? x1f : x2f,\r\n                        y: y1 < y2 ? y1f : y2f,\r\n                    };\r\n                    p2 = {\r\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\r\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y),\r\n                    };\r\n                    p2.x = p1.x + p2.x;\r\n                    p2.y = p1.y + p2.y;\r\n\r\n                } else {\r\n                    if (lineWidth % 2 === 0) {\r\n                        p1 = {\r\n                            x: x1f,\r\n                            y: y1f,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f,\r\n                            y: y2f,\r\n                        };\r\n                    } else {\r\n                        p1 = {\r\n                            x: x1f + 0.5,\r\n                            y: y1f + 0.5,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f + 0.5,\r\n                            y: y2f + 0.5,\r\n                        };\r\n                    }\r\n                }\r\n            } else {\r\n                p1 = {\r\n                    x: x1,\r\n                    y: y1,\r\n                };\r\n                p2 = {\r\n                    x: x2,\r\n                    y: y2,\r\n                };\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2.x = p2.x - p1.x;\r\n            p2.y = p2.y - p1.y;\r\n\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\r\n            } else {\r\n                ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\r\n            }\r\n\r\n        } else {  // --- circle ---\r\n            p1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n            x = p1.x;\r\n            y = p1.y;\r\n            dX = p2.x - p1.x;\r\n            dY = p2.y - p1.y;\r\n\r\n            ctx.beginPath();\r\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fill();\r\n            } else {\r\n                ctx.stroke();\r\n            }\r\n        }\r\n\r\n\r\n        ctx.restore();\r\n\r\n    } else {\r\n        throw new Error('unknown shape');\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {IRect} from '../../bb/bb.types';\r\n\r\nexport interface IRenderTextParam {\r\n    textStr: string; // text to be drawn. can contain newlines\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\r\n    align: 'left' | 'center' | 'right'; // default 'left'\r\n    isBold: boolean; // default false\r\n    isItalic: boolean; // default false\r\n    angleRad: number; // default 0 - rotates around x y\r\n    lineHeight?: number; // pixels\r\n    color: string;\r\n    isDebug?: boolean;\r\n}\r\n\r\n\r\n/**\r\n * Draw text on a canvas.\r\n *\r\n * @param canvas\r\n * @param p\r\n * @returns - bounds. coords relative to p.x p.y\r\n */\r\nexport function renderText(canvas: HTMLCanvasElement, p: IRenderTextParam): IRect {\r\n\r\n    // always at least a space. so bounds aren't just a dot\r\n    let textStr = p.textStr === '' ? ' ' : p.textStr;\r\n\r\n    // --- create el ---\r\n    // create an actual dom element. figure out where exactly each letter is positioned.\r\n    // that way multiline is feasible. canvas can't do multiline or text-align\r\n    let outer = BB.el({\r\n        css: {\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            width: '100000px',\r\n            fontSize: p.size + 'px',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n        }\r\n    });\r\n    let div = BB.el({\r\n        parent: outer,\r\n        css: {\r\n            display: 'inline-block',\r\n            textAlign: p.align ? p.align : 'left',\r\n            fontFamily: p.font ? p.font : 'sans-serif',\r\n            fontSize: p.size + 'px',\r\n            fontWeight: p.isBold ? 'bold' : 'normal',\r\n            fontStyle: p.isItalic ? 'italic' : 'normal',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n\r\n\r\n            opacity: '0',\r\n            pointerEvents: 'none'\r\n        }\r\n    });\r\n    let spanStr = '';\r\n    let replaceObj = {\r\n        \"\\n\": '<br>',\r\n        \" \": '&nbsp;',\r\n        \"\t\": '&nbsp;&nbsp;&nbsp;&nbsp;',\r\n    };\r\n    for (let i = 0; i < textStr.length; i++) {\r\n        if (textStr[i] === \"\\n\") {\r\n            div.appendChild(BB.el({\r\n                tagName: 'span',\r\n                textContent: spanStr,\r\n                css: {\r\n                    whiteSpace: 'pre'\r\n                }\r\n            }));\r\n            spanStr = '';\r\n            div.appendChild(BB.el({\r\n                tagName: 'br'\r\n            }));\r\n            continue;\r\n        }\r\n        spanStr += textStr[i].replace(\"\\t\", '    ');\r\n    }\r\n    div.appendChild(BB.el({\r\n        tagName: 'span',\r\n        textContent: spanStr,\r\n        css: {\r\n            whiteSpace: 'pre'\r\n        }\r\n    }));\r\n    document.body.appendChild(outer);\r\n\r\n\r\n    // --- determine bounds ---\r\n    let bounds = {\r\n        x0: 99999999,\r\n        y0: 99999999,\r\n        x1: 0,\r\n        y1: 0\r\n    }\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        let el = div.children[i] as HTMLElement;\r\n        bounds.x0 = Math.min(bounds.x0, el.offsetLeft);\r\n        bounds.y0 = Math.min(bounds.y0, el.offsetTop);\r\n        bounds.x1 = Math.max(bounds.x1, el.offsetLeft + el.offsetWidth);\r\n        bounds.y1 = Math.max(bounds.y1, el.offsetTop + el.offsetHeight);\r\n    }\r\n\r\n    // --- draw ---\r\n    let ctx = canvas.getContext('2d');\r\n    ctx.save();\r\n\r\n    let font = [];\r\n    if (p.isItalic) {\r\n        font.push('italic');\r\n    }\r\n    if (p.isBold) {\r\n        font.push('bold');\r\n    }\r\n    font.push(p.size + 'px ' + (p.font ? p.font : 'sans-serif'));\r\n    ctx.font = font.join(' ');\r\n    ctx.fillStyle = p.color ? p.color : '#000';\r\n\r\n    let x = p.x;\r\n    let y = p.y;\r\n    if (p.align === 'right') {\r\n        x += -bounds.x1 + bounds.x0;\r\n    }\r\n    if (p.align === 'center') {\r\n        x += (-bounds.x1 + bounds.x0) / 2;\r\n    }\r\n    ctx.translate(p.x, p.y);\r\n    ctx.rotate(p.angleRad ? -p.angleRad : 0);\r\n    ctx.translate(-p.x, -p.y);\r\n    ctx.translate(x, y);\r\n\r\n    // fill\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        let el = div.children[i] as HTMLElement;\r\n\r\n        //ctx.fillText(el.innerText, 0, 0);\r\n        ctx.fillText(el.innerText, el.offsetLeft, el.offsetTop);\r\n    }\r\n\r\n    if (p.isDebug) {\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeRect(0, -p.size * 0.85, bounds.x1, bounds.y1);\r\n        ctx.restore();\r\n        ctx.fillRect(p.x - 1, p.y - 1, 2, 2);\r\n    } else {\r\n        ctx.restore();\r\n    }\r\n\r\n    document.body.removeChild(outer);\r\n\r\n    return {\r\n        x: x - p.x,\r\n        y: y - p.y -p.size * 0.85,\r\n        width: bounds.x1 - bounds.x0,\r\n        height: bounds.y1 - bounds.y0\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IKlProject} from '../kl.types';\r\n\r\nexport function drawProject(project: IKlProject, factor) {\r\n    let resultCanvas = BB.canvas(\r\n        Math.max(1, Math.round(project.width * factor)),\r\n        Math.max(1, Math.round(project.height * factor))\r\n    );\r\n    let ctx = resultCanvas.getContext(\"2d\");\r\n    ctx.save();\r\n    if (factor > 1) {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n    for (let i = 0; i < project.layers.length; i++) {\r\n        if (project.layers[i].opacity === 0) {\r\n            continue;\r\n        }\r\n        ctx.globalAlpha = project.layers[i].opacity;\r\n        ctx.globalCompositeOperation = project.layers[i].mixModeStr ? project.layers[i].mixModeStr : 'source-over';\r\n        ctx.drawImage(project.layers[i].image, 0, 0, resultCanvas.width, resultCanvas.height);\r\n    }\r\n    ctx.restore();\r\n    return resultCanvas;\r\n}","import {IGradient} from '../kl.types';\r\nimport {BB} from '../../bb/bb';\r\n\r\n\r\ntype TOnGradient = (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\r\n\r\n/**\r\n * Input processor for gradient tool.\r\n * Coordinates are in canvas space.\r\n * angleRad is the angle of the canvas.\r\n */\r\nexport class GradientTool {\r\n    private downX: number;\r\n    private downY: number;\r\n    private downAngleRad: number;\r\n    private onGradient: TOnGradient;\r\n\r\n    // ---- public ----\r\n    constructor(\r\n        p: {\r\n            onGradient: TOnGradient;\r\n        }\r\n    ) {\r\n        this.onGradient = p.onGradient;\r\n    }\r\n\r\n    onDown(x: number, y: number, angleRad: number): void {\r\n        this.downX = x;\r\n        this.downY = y;\r\n        this.downAngleRad = angleRad;\r\n    }\r\n\r\n    onMove(x: number, y: number): void {\r\n        this.onGradient(false, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n\r\n    onUp(x: number, y: number): void {\r\n        this.onGradient(true, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n}\r\n\r\nexport function drawGradient(\r\n    ctx: CanvasRenderingContext2D,\r\n    gradientObj: IGradient,\r\n): void {\r\n    ctx.save();\r\n\r\n    let x1 = gradientObj.x1;\r\n    let y1 = gradientObj.y1;\r\n    let x2 = gradientObj.x2;\r\n    let y2 = gradientObj.y2;\r\n\r\n    if (gradientObj.doSnap) {\r\n        const angleDeg = gradientObj.angleRad * 180 / Math.PI;\r\n\r\n        let r1 = BB.rotate(x1, y1, gradientObj.angleRad / Math.PI * 180);\r\n        let r2 = BB.rotate(x2, y2, gradientObj.angleRad / Math.PI * 180);\r\n\r\n        let pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\r\n        let pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\r\n        let rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\r\n        x2 = rotated.x;\r\n        y2 = rotated.y;\r\n\r\n        // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\r\n        if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\r\n            if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\r\n                x2 = x1;\r\n            } else { // left or right\r\n                y2 = y1;\r\n            }\r\n        }\r\n    }\r\n\r\n    let baseColor = gradientObj.color1;\r\n    if (gradientObj.isEraser && gradientObj.doLockAlpha) {\r\n        baseColor = {r: 255, g: 255, b: 255};\r\n    }\r\n    let color1 = BB.copyObj(baseColor);\r\n    color1.a = gradientObj.opacity;\r\n    let color2 = BB.copyObj(baseColor);\r\n    color2.a = 0;\r\n    if (gradientObj.isReversed) {\r\n        const temp = color1;\r\n        color1 = color2;\r\n        color2 = temp;\r\n    }\r\n\r\n    let gradient;\r\n    if (gradientObj.type === 'linear') {\r\n        gradient = ctx.createLinearGradient(x1, y1, x2, y2);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n\r\n    } else if (gradientObj.type === 'linear-mirror') {\r\n        const d = {\r\n            x: x2 - x1,\r\n            y: y2 - y1,\r\n        };\r\n        gradient = ctx.createLinearGradient(x1 - d.x,y1 - d.y, x2, y2);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color2));\r\n        gradient.addColorStop(0.5, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n\r\n    } else if (gradientObj.type === 'radial') {\r\n        const r = BB.Vec2.dist(\r\n            {x: x1, y: y1},\r\n            {x: x2, y: y2},\r\n        );\r\n        gradient = ctx.createRadialGradient(x1, y1, 0, x1, y1, r);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n    }\r\n\r\n    ctx.fillStyle = gradient;\r\n    if (gradientObj.isEraser) {\r\n        ctx.globalCompositeOperation = 'destination-out';\r\n    }\r\n    if (gradientObj.doLockAlpha) {\r\n        ctx.globalCompositeOperation = 'source-atop';\r\n    }\r\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n\r\n    ctx.restore();\r\n}","import {IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {TTranslationCode} from '../../../languages/languages';\r\n\r\nexport function translateBlending(blendMode?: IMixMode): string {\r\n    if (!blendMode) {\r\n        return LANG('layers-blend-normal');\r\n    }\r\n\r\n    const codes: {\r\n        [key: string]: TTranslationCode\r\n    } = {\r\n        'source-over': 'layers-blend-normal',\r\n        'darken': 'layers-blend-darken',\r\n        'multiply': 'layers-blend-multiply',\r\n        'color-burn': 'layers-blend-color-burn',\r\n        'lighten': 'layers-blend-lighten',\r\n        'screen': 'layers-blend-screen',\r\n        'color-dodge': 'layers-blend-color-dodge',\r\n        'overlay': 'layers-blend-overlay',\r\n        'soft-light': 'layers-blend-soft-light',\r\n        'hard-light': 'layers-blend-hard-light',\r\n        'difference': 'layers-blend-difference',\r\n        'exclusion': 'layers-blend-exclusion',\r\n        'hue': 'layers-blend-hue',\r\n        'saturation': 'layers-blend-saturation',\r\n        'color': 'layers-blend-color',\r\n        'luminosity': 'layers-blend-luminosity',\r\n    };\r\n\r\n    if (!(blendMode in codes)) {\r\n        throw new Error('unknown blend mode');\r\n    }\r\n    return LANG(codes[blendMode]);\r\n}","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl.types';\r\n\r\n/**\r\n * Overlay for KlCanvasWorkspace.\r\n * - brush circle\r\n * - eyedropper circle\r\n * - compass needle (rotation hud)\r\n */\r\nexport class WorkspaceSvgOverlay {\r\n    private rootElement: SVGElement;\r\n    private brushCircleOuter: SVGElement;\r\n    private brushCircleInner: SVGElement;\r\n    private pickerPreviewBorder: SVGElement;\r\n    private pickerPreviewCol: SVGElement;\r\n    private readonly compassSize: number;\r\n    private compass: SVGElement;\r\n    private compassInner: SVGElement;\r\n    private compassBaseCircle: SVGElement;\r\n    private compassLineCircle: SVGElement;\r\n    private compassUpperTriangle: SVGElement;\r\n    private compassLowerTriangle: SVGElement;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n        }\r\n    ) {\r\n        this.rootElement = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + p.width,\r\n            height: '' + p.height,\r\n        });\r\n        BB.css(this.rootElement, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            pointerEvents: 'none',\r\n            userSelect: 'none'\r\n        });\r\n\r\n        //brush circles\r\n        this.brushCircleOuter = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '10',\r\n            stroke: 'rgba(0,0,0,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.brushCircleInner = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '9',\r\n            stroke: 'rgba(255,255,255,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\r\n\r\n        //color picker preview circle\r\n        this.pickerPreviewBorder = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '22',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewBorder.style.opacity = '0';\r\n        this.pickerPreviewCol = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '20',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewCol.style.opacity = '0';\r\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\r\n\r\n\r\n        //rotation compass\r\n        this.compassSize = 30;\r\n        this.compass = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'translate(' + (p.width/2) + ', ' + (p.height/2) + ')',\r\n        });\r\n        BB.css(this.compass, {\r\n            transition: 'opacity 0.25s ease-in-out',\r\n            opacity: '0',\r\n        });\r\n        this.compassInner = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'rotate(45)',\r\n        });\r\n        this.compassBaseCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'rgba(0,0,0,0.9)',\r\n            stroke: 'none',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + this.compassSize,\r\n        });\r\n        this.compassLineCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'none',\r\n            stroke: 'rgba(255,255,255,0.75)',\r\n            'stroke-width': '1',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + (this.compassSize * 0.9),\r\n        });\r\n        this.compassUpperTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#f00',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,-'+(this.compassSize * 0.9)+' z',\r\n        });\r\n        this.compassLowerTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#fff',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,'+(this.compassSize * 0.9)+' z',\r\n        });\r\n\r\n        this.compassInner.append(\r\n            this.compassBaseCircle,\r\n            this.compassLineCircle,\r\n            this.compassUpperTriangle,\r\n            this.compassLowerTriangle\r\n        );\r\n        this.compass.append(this.compassInner);\r\n        this.rootElement.append(this.compass);\r\n    }\r\n\r\n    getElement (): SVGElement {\r\n        return this.rootElement;\r\n    }\r\n\r\n    setSize (width: number, height: number): void {\r\n        this.rootElement.setAttribute('width', '' + width);\r\n        this.rootElement.setAttribute('height', '' + height);\r\n        this.compass.setAttribute('transform', 'translate(' + (width/2) + ', ' + (height/2) + ')');\r\n    }\r\n\r\n    updateCursor (p: {\r\n        x?: number;\r\n        y?: number;\r\n        radius?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if ('x' in p) {\r\n            this.brushCircleOuter.setAttribute('cx', '' + p.x);\r\n            this.brushCircleInner.setAttribute('cx', '' + p.x);\r\n        }\r\n        if ('y' in p) {\r\n            this.brushCircleOuter.setAttribute('cy', '' + p.y);\r\n            this.brushCircleInner.setAttribute('cy', '' + p.y);\r\n        }\r\n        if ('radius' in p) {\r\n            this.brushCircleOuter.setAttribute('r', '' + Math.max(0, p.radius));\r\n            this.brushCircleInner.setAttribute('r', '' + Math.max(0, p.radius - 1));\r\n        }\r\n        if ('isVisible' in p) {\r\n            this.brushCircleOuter.style.opacity = p.isVisible ? '1' : '0';\r\n            this.brushCircleInner.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateColorPreview (p: {\r\n        x?: number;\r\n        y?: number;\r\n        color?: IRGB;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if ('x' in p) {\r\n            this.pickerPreviewCol.setAttribute('cx', '' + p.x);\r\n            this.pickerPreviewBorder.setAttribute('cx', '' + p.x);\r\n        }\r\n        if ('y' in p) {\r\n            this.pickerPreviewCol.setAttribute('cy', '' + p.y);\r\n            this.pickerPreviewBorder.setAttribute('cy', '' + p.y);\r\n        }\r\n        if ('color' in p) {\r\n            this.pickerPreviewCol.setAttribute('stroke', BB.ColorConverter.toRgbStr(p.color));\r\n            let borderColor = BB.testIsWhiteBestContrast(p.color) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\r\n            this.pickerPreviewBorder.setAttribute('stroke', borderColor);\r\n        }\r\n        if ('isVisible' in p) {\r\n            this.pickerPreviewCol.style.opacity = p.isVisible ? '1' : '0';\r\n            this.pickerPreviewBorder.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateCompass (p: {\r\n        angleDeg?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if ('angleDeg' in p) {\r\n            this.compassInner.setAttribute('transform', 'rotate(' + p.angleDeg + ')');\r\n            this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? '1' : '0';\r\n        }\r\n        if ('isVisible' in p) {\r\n            this.compass.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB, ITransform} from '../kl.types';\r\nimport {WorkspaceSvgOverlay} from './workspace-svg-overlay';\r\nimport {klHistory} from '../history/kl-history';\r\n// @ts-ignore\r\nimport pickerImg from 'url:~/src/app/img/ui/cursor-picker.png';\r\n// @ts-ignore\r\nimport zoomEwImg from 'url:~/src/app/img/ui/cursor-zoom-ew.png';\r\n// @ts-ignore\r\nimport fillImg from 'url:~/src/app/img/ui/cursor-fill.png';\r\n// @ts-ignore\r\nimport textImg from 'url:~/src/app/img/ui/cursor-text.png';\r\nimport {IPressureInput, IVector2D} from '../../bb/bb.types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {KeyListener} from '../../bb/input/key-listener';\r\nimport {KL} from '../kl';\r\n\r\nexport interface IViewChangeEvent {\r\n    changed: ('scale' | 'angle')[];\r\n    angle: number;\r\n    scale: number;\r\n}\r\n\r\ntype TModeStr = 'draw' | 'pick' | 'hand' | 'shape' | 'fill' | 'gradient' | 'text'; // | 'transform' | 'select'\r\n\r\nconst MIN_SCALE = 1 / 16;\r\nconst MAX_SCALE = 64;\r\nenum TMode {\r\n    Draw,\r\n    Hand,\r\n    HandGrabbing,\r\n    Pick,\r\n    Zoom,\r\n    Rotate,\r\n    Rotating,\r\n    Fill,\r\n    Gradient,\r\n    Text,\r\n    Shape,\r\n}\r\nconst ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\r\n\r\n/**\r\n * Work area that displays the KlCanvas.\r\n * - pan, zoom, rotate (also via multi-touch)\r\n * - input modes: drawing, hand, pick, fill, text // transform, select\r\n * - drawing input events\r\n * - view change events\r\n * - eyedropper input events (pick)\r\n * - draws cursor, eyedropper overlay\r\n *\r\n * subscribes to klCanvas changes\r\n * listens to kl history for changes\r\n * and you can manually trigger redraw\r\n */\r\nexport class KlCanvasWorkspace {\r\n\r\n    private rootEl: HTMLElement;\r\n    private klCanvas: KlCanvas;\r\n    private renderTargetCanvas: HTMLCanvasElement;\r\n    private renderTargetCtx: CanvasRenderingContext2D;\r\n    private renderWidth: number;\r\n    private renderHeight: number;\r\n    private compositeCanvas: HTMLCanvasElement; // for drawing klcanvas layer composite\r\n    private compositeCtx: CanvasRenderingContext2D;\r\n    private doResizeCanvas: boolean;\r\n    private oldTransformObj: ITransform;\r\n    private targetTransformObj: ITransform; // animation target\r\n    private highResTransformObj: ITransform; // animated, internal high res\r\n    private renderedTransformObj: ITransform; // same as highRes, but rounded - what's actually displayed\r\n    private cursorPos: IVector2D;\r\n    private usesCssCursor: boolean;\r\n    private bgVisible: boolean;\r\n    private transformIsDirty: boolean;\r\n    private doAnimateTranslate: boolean;\r\n    private svgOverlay: WorkspaceSvgOverlay;\r\n    private emptyCanvas: HTMLCanvasElement;\r\n    private keyListener: KeyListener;\r\n    private currentMode: TMode;\r\n    private globalMode: TMode;\r\n    private renderTime: number; // for debugging - average ms per render()\r\n    private lastDrawEvent: IPressureInput | null; // previous drawing input\r\n    private linetoolProcessor: any; // todo type - BB.EventChain.LinetoolProcessor\r\n    private pointer: IVector2D | null; // position of cursor\r\n    private isDrawing: boolean;\r\n    private inputProcessorObj: any; // todo type\r\n    private currentInputProcessor: any; // todo type\r\n    private angleIsExtraSticky: boolean;\r\n    private pinchZoomer: any; // todo type - BB.EventChain.PinchZoomer\r\n    private mainDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\r\n    private middleDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\r\n    private twoFingerTap: any; // todo type - BB.EventChain.NFingerTapper\r\n    private threeFingerTap: any; // todo type - BB.EventChain.NFingerTapper\r\n    private pointerEventChain: any; // todo type - BB.EventChain.EventChain\r\n    private pointerListener: any; // todo type - BB.PointerListener\r\n    private brushRadius: number;\r\n    private animationFrameRequested: boolean;\r\n    private lastRenderedState: number; // KlHistory state - to detect if there are changes to draw\r\n    private lastRenderTime: number; // ms from performance.now()\r\n    private hideBrushCursorTimeout: number;\r\n    private onViewChange: (e:  IViewChangeEvent) => void;\r\n\r\n    private getRenderedTransform (): ITransform {\r\n        // rounded x & y so canvas is less blurry.\r\n        const result = this.renderedTransformObj;\r\n        result.x = this.highResTransformObj.x;\r\n        result.y = this.highResTransformObj.y;\r\n        result.scale = this.highResTransformObj.scale;\r\n        result.angle = this.highResTransformObj.angle;\r\n\r\n        if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\r\n            result.x = Math.round(result.x);\r\n            result.y = Math.round(result.y);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private updateChangeListener (): void {\r\n        this.klCanvas.addChangeListener(() => {\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n        });\r\n    }\r\n\r\n    private updateCursor (modeInt: TMode, doForce?: boolean): void {\r\n        if (modeInt === this.currentMode && !doForce) {\r\n            return;\r\n        }\r\n        const oldMode = this.currentMode;\r\n        this.currentMode = modeInt;\r\n        this.lastRenderedState = -1;\r\n        if (this.currentMode === TMode.Draw) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        } else if (this.currentMode === TMode.Hand) {\r\n            this.rootEl.style.cursor = 'grab';\r\n        } else if (this.currentMode === TMode.HandGrabbing) {\r\n            this.rootEl.style.cursor = 'grabbing';\r\n        } else if (this.currentMode === TMode.Pick) {\r\n            this.rootEl.style.cursor = \"url('\" + pickerImg + \"') 0 15, crosshair\";\r\n        } else if (this.currentMode === TMode.Zoom) {\r\n            this.rootEl.style.cursor = \"url('\" + zoomEwImg + \"') 7 7, zoom-in\";\r\n        } else if (this.currentMode === TMode.Rotate) {\r\n            this.rootEl.style.cursor = \"grab\";\r\n        } else if (this.currentMode === TMode.Rotating) {\r\n            this.rootEl.style.cursor = \"grabbing\";\r\n        } else if (this.currentMode === TMode.Fill) {\r\n            this.rootEl.style.cursor = \"url('\" + fillImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Gradient) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        } else if (this.currentMode === TMode.Text) {\r\n            this.rootEl.style.cursor = \"url('\" + textImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Shape) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        }\r\n\r\n        if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode)) {\r\n            const oldIsHand = [TMode.Hand, TMode.HandGrabbing].includes(oldMode);\r\n            const currentIsHand = [TMode.Hand, TMode.HandGrabbing].includes(this.currentMode);\r\n            if (!oldIsHand && currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n            }\r\n            if (oldIsHand && !currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n            }\r\n        }\r\n\r\n        if (this.currentMode !== TMode.Pick) {\r\n            this.svgOverlay.updateColorPreview({isVisible: false});\r\n        }\r\n    }\r\n\r\n    /**\r\n     * returns false if no change of zoom\r\n     * @param stepNum\r\n     * @param centerX\r\n     * @param centerY\r\n     * @private\r\n     */\r\n    private internalZoomByStep (stepNum: number, centerX: number, centerY: number): boolean {\r\n        const step = Math.log2(this.targetTransformObj.scale);\r\n\r\n        let newStep = step / Math.abs(stepNum);\r\n        newStep += stepNum > 0 ? 1 : -1;\r\n        newStep = Math.round(newStep);\r\n        newStep *= Math.abs(stepNum);\r\n        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, Math.pow(2, newStep)));\r\n\r\n        //has zoomed?\r\n        if (newScale === this.targetTransformObj.scale) {\r\n            return false;\r\n        }\r\n\r\n\r\n        const effectiveFactor = newScale / this.targetTransformObj.scale;\r\n        this.targetTransformObj.scale = newScale;\r\n\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerX, centerY));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerX, -centerY));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.transformIsDirty = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * mixes two transform objects. modifies A\r\n     * @param transformA\r\n     * @param transformB\r\n     * @param blendFactor 0 -> A, 1 -> B\r\n     * @private\r\n     */\r\n    private mixTransformObj (transformA: ITransform, transformB: ITransform, blendFactor: number): void {\r\n        if (transformA.angle === transformB.angle) {\r\n            transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n            transformA.x = BB.mix(transformA.x, transformB.x, blendFactor);\r\n            transformA.y = BB.mix(transformA.y, transformB.y, blendFactor);\r\n            transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n            return;\r\n        }\r\n\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        // --- determine centerPosA, centerPosB ---\r\n        const centerPosA = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2\r\n        }, transformA);\r\n        const centerPosB = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2\r\n        }, transformB);\r\n\r\n        // --- centerPosMixed ---\r\n        transformA.x = BB.mix(centerPosA.x , centerPosB.x, blendFactor);\r\n        transformA.y = BB.mix(centerPosA.y , centerPosB.y, blendFactor);\r\n\r\n        // --- scale and angle ---\r\n        transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n        transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n\r\n        // --- x and y ---\r\n        const mixedPos = this.canvasToWorkspaceCoord({\r\n            x: -w / 2,\r\n            y: -h / 2\r\n        }, transformA);\r\n        transformA.x = mixedPos.x;\r\n        transformA.y = mixedPos.y;\r\n    }\r\n\r\n    private render (): void {\r\n        if (this.doResizeCanvas) {\r\n            this.doResizeCanvas = false;\r\n            this.renderTargetCanvas.width = this.renderWidth;\r\n            this.renderTargetCanvas.height = this.renderHeight;\r\n        }\r\n        this.renderContext(this.renderTargetCtx);\r\n    }\r\n\r\n    /**\r\n     * is the gray background that surrounds canvas visible?\r\n     * @private\r\n     */\r\n    private testBgVisible (): boolean {\r\n        //bring workspace points (corners of workspace) into canvas coordinate system\r\n        //then check if any corner point is outside of the canvas -> that means the bg is visible\r\n\r\n        const workspacePointArr = [\r\n            [0, 0], // top left\r\n            [this.renderWidth, 0], // top right\r\n            [this.renderWidth, this.renderHeight], // bottom right\r\n            [0, this.renderHeight], // bottom left\r\n        ];\r\n\r\n        const art = this.getRenderedTransform();\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        //transform points, then test if outside of canvas\r\n        for (let i = 0; i < workspacePointArr.length; i++) {\r\n            let coords = [workspacePointArr[i][0], workspacePointArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n            if (\r\n                !(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() &&\r\n                    0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())\r\n            ){\r\n                //if not inside -> bg visible\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private renderContext (ctx: CanvasRenderingContext2D): void {\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        const art = this.getRenderedTransform();\r\n\r\n        if (art.scale >= 4 || (art.scale === 1 && art.angle === 0)) {\r\n            ctx.imageSmoothingEnabled = false;\r\n        } else {\r\n            ctx.imageSmoothingEnabled = true;\r\n            ctx.imageSmoothingQuality  = 'low'; // art.scale >= 1 ? 'low' : 'medium';\r\n        }\r\n        //ctx.imageSmoothingEnabled = false;\r\n        //renderTargetCtx.globalCompositeOperation  = 'multiply';\r\n\r\n\r\n\r\n        ctx.save();\r\n        {\r\n            if (this.bgVisible) {\r\n                ctx.fillStyle = 'rgb(158,158,158)'; // 'rgb(185,185,185)';\r\n                ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\r\n            } else {\r\n                ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\r\n            }\r\n\r\n\r\n\r\n            if (this.bgVisible) {\r\n                ctx.save();\r\n\r\n                ctx.translate(art.x, art.y);\r\n                ctx.scale(art.scale, art.scale);\r\n                ctx.rotate(art.angle);\r\n\r\n                ctx.imageSmoothingEnabled = false;\r\n\r\n                //outline\r\n                const borderSize = 1;\r\n                ctx.globalAlpha = 0.2;\r\n                ctx.drawImage(\r\n                    this.emptyCanvas,\r\n                    -borderSize / art.scale,\r\n                    -borderSize / art.scale,\r\n                    w + borderSize * 2 / art.scale,\r\n                    h + borderSize * 2 / art.scale\r\n                );\r\n                ctx.globalAlpha = 1;\r\n\r\n                //erase\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n                ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\r\n\r\n                ctx.restore();\r\n            }\r\n\r\n            /*const region = new Path2D();\r\n            region.rect(80, 10, 20, 130);\r\n            ctx.clip(region);*/\r\n\r\n            ctx.translate(art.x, art.y);\r\n            ctx.scale(art.scale, art.scale);\r\n            ctx.rotate(art.angle);\r\n\r\n            const layerArr = this.klCanvas.getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    ctx.globalAlpha = layerArr[i].opacity;\r\n                    ctx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n\r\n                    if (layerArr[i].canvas.compositeObj) {\r\n                        if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\r\n                            this.compositeCanvas.width = layerArr[i].canvas.width;\r\n                            this.compositeCanvas.height = layerArr[i].canvas.height;\r\n                        } else {\r\n                            this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\r\n                        }\r\n                        this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\r\n                        layerArr[i].canvas.compositeObj.draw(this.compositeCtx);\r\n                        ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\r\n                    } else {\r\n                        ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\r\n                    }\r\n                }\r\n            }\r\n            ctx.globalAlpha = 1;\r\n\r\n\r\n\r\n        }\r\n        ctx.restore();\r\n\r\n        // rotation hud\r\n        if (TMode.Rotate === this.currentMode || TMode.Rotating === this.currentMode) {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: true,\r\n                angleDeg: art.angle / Math.PI * 180\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: false\r\n            });\r\n        }\r\n    }\r\n\r\n    private workspaceToCanvasCoord (p: IVector2D): IVector2D {\r\n        const art = this.getRenderedTransform();\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private canvasToWorkspaceCoord (p: IVector2D, transformObj: ITransform): IVector2D {\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(transformObj.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(transformObj.scale));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private snapAngleRad (angleRad: number, snapDegIncrement: number, maxDistDeg: number): number {\r\n        let angleDeg = angleRad * 180 / Math.PI;\r\n        const modDeg = Math.abs(angleDeg % snapDegIncrement);\r\n        const dist = Math.min(modDeg, snapDegIncrement - modDeg);\r\n\r\n        if (dist <= maxDistDeg) {\r\n            angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\r\n        }\r\n\r\n        return angleDeg / 180 * Math.PI;\r\n    }\r\n\r\n    /**\r\n     * angle always in range [-PI, PI]\r\n     * @param angleRad\r\n     * @private\r\n     */\r\n    private minimizeAngleRad (angleRad: number): number {\r\n        angleRad = angleRad % (2 * Math.PI);\r\n        if (angleRad > Math.PI) {\r\n            angleRad -= 2 * Math.PI;\r\n        } else if (angleRad < -Math.PI) {\r\n            angleRad += 2 * Math.PI;\r\n        }\r\n        return angleRad;\r\n    }\r\n\r\n    private resetInputProcessor (): void {\r\n        this.currentInputProcessor = null;\r\n        this.updateCursor(this.globalMode);\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    private reqFrame (doRedrawCanvas?: boolean): void {\r\n        this.animationFrameRequested = true;\r\n        if (doRedrawCanvas) {\r\n            this.lastRenderedState = -1;\r\n        }\r\n    }\r\n\r\n    private updateLoop (): void {\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState;\r\n\r\n        //handle variable framerate\r\n        const nowTime = performance.now();\r\n        const elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\r\n        this.lastRenderTime = nowTime;\r\n\r\n        if (this.animationFrameRequested || doRender) {\r\n            this.animationFrameRequested = false;\r\n            this.checkChange(elapsedFrames);\r\n        }\r\n    }\r\n\r\n    private checkChange (elapsedFrames: number): void {\r\n\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState ||\r\n            this.highResTransformObj.scale !== this.targetTransformObj.scale ||\r\n            this.highResTransformObj.x !== this.targetTransformObj.x ||\r\n            this.highResTransformObj.y !== this.targetTransformObj.y;\r\n\r\n        //update transform\r\n        if (\r\n            !this.doAnimateTranslate &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else if (\r\n            (this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) &&\r\n            (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            this. doAnimateTranslate = false;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else {\r\n            this.reqFrame(); //probably needs another frame\r\n            const blendFactor = Math.min(1, ANIMATION_SPEED * elapsedFrames);\r\n            this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\r\n            this.bgVisible = true; // spare yourself the calculation\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        }\r\n\r\n        if (this.pointer && this.currentMode == TMode.Draw && !this.usesCssCursor) {\r\n            this.svgOverlay.updateCursor({\r\n                x: this.pointer.x,\r\n                y: this.pointer.y,\r\n                isVisible: true\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCursor({isVisible: false});\r\n        }\r\n\r\n\r\n        if (doRender) {\r\n            //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\r\n            this.lastRenderedState = newState;\r\n            const start = performance.now();\r\n            this.render();\r\n            this.renderTime = BB.mix(this.renderTime, performance.now() - start, 0.05);\r\n        }\r\n        //setTimeout(this.checkChange, 100);\r\n\r\n\r\n\r\n        if (doRender) {\r\n\r\n            //console.log('rendertime ms: ', this.renderTime);\r\n        }\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            klCanvas: any; // todo\r\n            width: number;\r\n            height: number;\r\n            onDraw: (val) => void; // todo\r\n            onPick: (rgb: IRGB, isPointerup: boolean) => void;\r\n            onFill: (canvasX: number, canvasY: number) => void;\r\n            onGradient: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onText: (canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onShape: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onViewChange: (e:  IViewChangeEvent) => void;\r\n            onUndo: () => void;\r\n            onRedo: () => void;\r\n        }\r\n    ) {\r\n        const _this = this;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                right: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                cursor: 'crosshair',\r\n                userSelect: 'none',\r\n                colorScheme: 'only light',\r\n            }\r\n        });\r\n        this.klCanvas = p.klCanvas;\r\n        this.onViewChange = p.onViewChange;\r\n        this.renderTargetCanvas = BB.canvas(p.width, p.height);\r\n        this.renderTargetCtx = this.renderTargetCanvas.getContext('2d');\r\n        this.renderWidth = p.width;\r\n        this.renderHeight = p.height;\r\n        this.compositeCanvas = BB.canvas(1, 1); // for drawing klcanvas layer composite\r\n        this.compositeCtx = this.compositeCanvas.getContext('2d');\r\n        this.doResizeCanvas = false;\r\n        this.oldTransformObj = null;\r\n        this.targetTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0\r\n        };\r\n        this.highResTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0\r\n        };\r\n        this.renderedTransformObj = {\r\n            x: null,\r\n            y: null,\r\n            scale: null,\r\n            angle: null\r\n        };\r\n        this.cursorPos = {\r\n            x: 0,\r\n            y: 0\r\n        };\r\n        this.usesCssCursor = false;\r\n        this.bgVisible = true;\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n\r\n        this.svgOverlay = new WorkspaceSvgOverlay({\r\n            width: p.width,\r\n            height: p.height\r\n        });\r\n\r\n        BB.css(this.renderTargetCanvas, {\r\n            userSelect: 'none',\r\n            pointerEvents: 'none',\r\n        });\r\n        BB.createCheckerDataUrl(8, (url) => {\r\n            this.renderTargetCanvas.style.background = \"url(\" + url + \")\";\r\n        });\r\n        this.rootEl.appendChild(this.renderTargetCanvas);\r\n        this.rootEl.appendChild(this.svgOverlay.getElement());\r\n        BB.addEventListener(this.rootEl, 'touchend', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        BB.addEventListener(this.rootEl, 'contextmenu', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        BB.addEventListener(this.rootEl, 'dragstart', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n\r\n        this.emptyCanvas = BB.canvas(1, 1);\r\n        {\r\n            const ctx = this.emptyCanvas.getContext('2d');\r\n            ctx.fillRect(0, 0, 1, 1);\r\n        }\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n                if (isRepeat) {\r\n                    return;\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n\r\n                } else {\r\n\r\n                    if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'space') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.spaceHand;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ([TMode.Draw, TMode.Hand, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'alt') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.altPicker;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if (['r', 'shift+r'].includes(comboStr)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.rotate;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ('z' === comboStr) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.zoom;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                }\r\n\r\n            },\r\n            onUp: (keyStr, event, oldComboStr) => {\r\n                // prevent menu bar in Firefox\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.currentMode = TMode.Draw;\r\n        this.globalMode = TMode.Draw;\r\n\r\n        this.renderTime = 0;\r\n\r\n        this.lastDrawEvent = null;\r\n\r\n        this.linetoolProcessor = new BB.EventChain.LinetoolProcessor({\r\n            onDraw: (event) => {\r\n                const getMatrix = () => {\r\n                    const art = this.getRenderedTransform();\r\n                    let matrix = BB.Matrix.getIdentity();\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n                    return matrix;\r\n                };\r\n\r\n                if (event.type === 'line' && !this.lastDrawEvent) {\r\n                    const matrix = getMatrix();\r\n                    let coords = [event.x1, event.y1, 0, 1];\r\n                    coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                    this.lastDrawEvent = {\r\n                        x: coords[0],\r\n                        y: coords[1],\r\n                        pressure: event.pressure1\r\n                    };\r\n                    return;\r\n                }\r\n\r\n                if ('x' in event || 'x0' in event) {\r\n\r\n                    const matrix = getMatrix();\r\n\r\n                    if ('x' in event) { //down or move\r\n                        let coords = [event.x, event.y, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x = coords[0];\r\n                        event.y = coords[1];\r\n                    }\r\n                    if ('x0' in event) { //line\r\n                        event.x0 = this.lastDrawEvent.x;\r\n                        event.y0 = this.lastDrawEvent.y;\r\n                        event.pressure0 = this.lastDrawEvent.pressure;\r\n                        let coords = [event.x1, event.y1, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x1 = coords[0];\r\n                        event.y1 = coords[1];\r\n\r\n                        this.lastDrawEvent = {\r\n                            x: event.x1,\r\n                            y: event.y1,\r\n                            pressure: event.pressure1,\r\n                        };\r\n                    }\r\n                }\r\n\r\n\r\n                if (['down', 'move'].includes(event.type)) {\r\n                    this.lastDrawEvent = event;\r\n                }\r\n                p.onDraw(event);\r\n            }\r\n        });\r\n\r\n        this.pointer = null;\r\n        this.isDrawing = false;\r\n\r\n\r\n        this.inputProcessorObj = {\r\n            draw: {\r\n                onPointer: (val) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Draw);\r\n\r\n                    const comboStr = this.keyListener.getComboStr();\r\n\r\n                    const event: any = {\r\n                        scale: this.highResTransformObj.scale\r\n                    };\r\n                    event.shiftIsPressed = comboStr === 'shift';\r\n                    event.pressure = val.pressure;\r\n                    event.isCoalesced = !!val.isCoalesced;\r\n\r\n                    if (val.type === 'pointerdown') {\r\n\r\n                        this.isDrawing = true;\r\n                        event.type = 'down';\r\n\r\n                    } else if (val.button) {\r\n                        event.type = 'move';\r\n\r\n                    } else if (val.type === 'pointerup') {\r\n\r\n                        this.isDrawing = false;\r\n                        event.type = 'up';\r\n\r\n                        this.linetoolProcessor.process(event);\r\n                        this.resetInputProcessor();\r\n                        return;\r\n                    } else {\r\n                        return;\r\n                    }\r\n\r\n                    event.x = val.relX;\r\n                    event.y = val.relY;\r\n\r\n                    this.linetoolProcessor.process(event);\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            fill: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Fill);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            gradient: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Gradient);\r\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        this.isDrawing = true;\r\n                        p.onGradient('down', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        p.onGradient('move', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.isDrawing = false;\r\n                        p.onGradient('up', coord.x, coord.y, this.renderedTransformObj.angle);\r\n                        this.resetInputProcessor();\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            text: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Text);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            shape: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Shape);\r\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        this.isDrawing = true;\r\n                        p.onShape('down', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        p.onShape('move', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.isDrawing = false;\r\n                        p.onShape('up', coord.x, coord.y, this.renderedTransformObj.angle);\r\n                        this.resetInputProcessor();\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            hand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            spaceHand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'space') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                }\r\n            },\r\n            zoom: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Zoom);\r\n\r\n                    if (event.button === 'left' && !event.isCoalesced && event.dX != 0) {\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n\r\n                        this.internalZoomByStep(event.dX / 175, event.downPageX - offsetX, event.downPageY - offsetY);\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'z') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Zoom);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                }\r\n            },\r\n            picker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup'\r\n                        });\r\n\r\n                        if (event.type === 'pointerup') {\r\n                            this.resetInputProcessor();\r\n                        }\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            altPicker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup'\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'alt') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                }\r\n            },\r\n            rotate: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(event.button === 'left' ? TMode.Rotating : TMode.Rotate);\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                    } else if (event.button === 'left' && !event.isCoalesced && this.oldTransformObj) {\r\n\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n                        //rotation done around center\r\n                        const centerObj = {\r\n                            x: this.renderWidth / 2,\r\n                            y: this.renderHeight / 2\r\n                        };\r\n\r\n                        const startAngleRad = BB.Vec2.angle(centerObj, {x: event.downPageX - offsetX, y: event.downPageY - offsetY});\r\n                        const angleRad = BB.Vec2.angle(centerObj, {x: event.pageX - offsetX, y: event.pageY - offsetY});\r\n                        let dAngleRad = angleRad - startAngleRad;\r\n\r\n                        //apply angle\r\n                        this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\r\n                        this.targetTransformObj.angle += dAngleRad;\r\n\r\n                        if (this.keyListener.isPressed('shift')) {\r\n                            this.targetTransformObj.angle = Math.round(this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\r\n                            dAngleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n                        }\r\n\r\n                        this.targetTransformObj.angle = this.minimizeAngleRad(this.targetTransformObj.angle);\r\n\r\n                        //rotate transform.xy\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(dAngleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n\r\n                        this.transformIsDirty = true;\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['angle'],\r\n                            scale: this.targetTransformObj.scale,\r\n                            angle: this.targetTransformObj.angle\r\n                        });\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    const comboStr = this.keyListener.getComboStr();\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        this.currentInputProcessor = null;\r\n\r\n\r\n        this.angleIsExtraSticky = false;\r\n        this.pinchZoomer = new BB.EventChain.PinchZoomer({\r\n            onPinch: (event) => {\r\n\r\n                if (event.type === 'move') {\r\n\r\n                    if (!this.oldTransformObj) {\r\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.angleIsExtraSticky = this.targetTransformObj.angle % (Math.PI / 2) === 0;\r\n                    }\r\n\r\n                    this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\r\n\r\n                    event.scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, this.targetTransformObj.scale * event.scale)) / this.targetTransformObj.scale;\r\n\r\n                    this.targetTransformObj.scale *= event.scale;\r\n                    this.targetTransformObj.angle += event.angleRad;\r\n                    this.targetTransformObj.angle = this.minimizeAngleRad(\r\n                        this.snapAngleRad(\r\n                            this.targetTransformObj.angle,\r\n                            90,\r\n                            this.angleIsExtraSticky ? 12 : 4\r\n                        )\r\n                    );\r\n                    if (this.targetTransformObj.angle % (Math.PI / 2) !== 0) {\r\n                        this.angleIsExtraSticky = false;\r\n                    }\r\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\r\n                    event.angleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n\r\n                    //calc translation\r\n                    {\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX, event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(event.scale));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(event.angleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-event.relX, -event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\r\n\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                    }\r\n\r\n                    this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n\r\n                    //if (event.scale !== 1) {\r\n                    this.onViewChange({\r\n                        changed: ['scale', 'angle'],\r\n                        scale: this.targetTransformObj.scale,\r\n                        angle: this.targetTransformObj.angle\r\n                    });\r\n                    //}\r\n                    this.reqFrame();\r\n                    this.transformIsDirty = true;\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                } else if (event.type === 'end') {\r\n                    this.oldTransformObj = null;\r\n                }\r\n\r\n\r\n            }\r\n        });\r\n\r\n        const onDoubleTap = (event) => {\r\n            if (_this.fitView()) {\r\n                this.lastRenderedState = -1;\r\n                this.reqFrame();\r\n            } else {\r\n                // zoom 2 steps further\r\n\r\n                let didZoom = this.internalZoomByStep(\r\n                    2,\r\n                    event.relX,\r\n                    event.relY,\r\n                );\r\n                if (didZoom) {\r\n                    this.onViewChange({\r\n                        changed: ['scale'],\r\n                        angle: this.targetTransformObj.angle,\r\n                        scale: this.targetTransformObj.scale\r\n                    });\r\n                }\r\n\r\n                //updateCursor(TMode.Draw, true);\r\n                this.lastRenderedState = -1;\r\n            }\r\n        }\r\n\r\n        this.mainDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper.setAllowedButtonArr(['middle']);\r\n\r\n\r\n        this.twoFingerTap = new BB.EventChain.NFingerTapper({\r\n            fingers: 2,\r\n            onTap: () => {\r\n                p.onUndo();\r\n            }\r\n        });\r\n        this.threeFingerTap = new BB.EventChain.NFingerTapper({\r\n            fingers: 3,\r\n            onTap: () => {\r\n                p.onRedo();\r\n            }\r\n        });\r\n\r\n\r\n        this.pointerEventChain = new BB.EventChain.EventChain({\r\n            chainArr: [\r\n                this.twoFingerTap,\r\n                this.threeFingerTap,\r\n                this.mainDoubleTapper,\r\n                this.middleDoubleTapper,\r\n                this.pinchZoomer,\r\n                new BB.EventChain.OnePointerLimiter(),\r\n                new BB.EventChain.CoalescedExploder()\r\n            ]\r\n        });\r\n        this.pointerEventChain.setChainOut((event) => {\r\n\r\n            this.cursorPos.x = event.relX;\r\n            this.cursorPos.y = event.relY;\r\n            if (event.type === 'pointerup' && event.pointerType === 'touch') {\r\n                this.pointer = null;\r\n                this.lastRenderedState = -1;\r\n                this.reqFrame();\r\n            } else {\r\n                if (!this.pointer) {\r\n                    this.pointer = { x: 0, y: 0 };\r\n                }\r\n                this.pointer.x = event.relX;\r\n                this.pointer.y = event.relY;\r\n            }\r\n\r\n            if (this.currentInputProcessor) {\r\n                this.currentInputProcessor.onPointer(event);\r\n\r\n            } else {\r\n\r\n                let comboStr = this.keyListener.getComboStr();\r\n\r\n                if (this.globalMode === TMode.Draw) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.draw;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Draw);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Hand) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'middle'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Pick) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'right'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Fill) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.fill;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Fill);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Gradient) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.gradient;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Gradient);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Text) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.text;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Text);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Shape) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.shape;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Shape);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n        });\r\n\r\n        //prevent ctrl scroll -> zooming page\r\n        BB.addEventListener(this.rootEl, 'wheel', (event) => {\r\n            event.preventDefault();\r\n        });\r\n\r\n\r\n        setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.rootEl,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    if (e.type === 'pointerdown' && e.button === 'middle') {\r\n                        try {\r\n                            e.eventPreventDefault();\r\n                        } catch (e) {}\r\n                    }\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    if (e.type === 'pointerdown') {\r\n                        BB.unfocusAnyInput();\r\n                    }\r\n                    /*if (e.type === 'pointermove') {\r\n                        BB.throwOut(JSON.stringify(e));\r\n                    }*/\r\n\r\n                    this.pointerEventChain.chainIn(e)\r\n                },\r\n                onWheel: (wheelEvent) => {\r\n\r\n                    if (this.isDrawing) {\r\n                        return;\r\n                    }\r\n\r\n                    this.reqFrame();\r\n                    let didZoom = this.internalZoomByStep(\r\n                        -wheelEvent.deltaY / (this.keyListener.isPressed('shift') ? 8 : 2),\r\n                        wheelEvent.relX,\r\n                        wheelEvent.relY\r\n                    );\r\n                    if (didZoom) {\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale\r\n                        });\r\n                    }\r\n\r\n                    //updateCursor(TMode.Draw, true);\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                },\r\n                onEnterLeave: (isOver) => {\r\n                    if (!isOver) {\r\n                        if (!this.isDrawing) {\r\n                            this.pointer = null;\r\n                            this.lastRenderedState = -1;\r\n                        }\r\n                    }\r\n                },\r\n                maxPointers: 4\r\n            });\r\n        }, 1);\r\n\r\n        this.brushRadius = 1;\r\n\r\n        this.animationFrameRequested = false;\r\n\r\n\r\n\r\n\r\n        //setup rendering\r\n        this.lastRenderedState = -2;\r\n        this.lastRenderTime = performance.now();\r\n\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n\r\n        this.resetView();\r\n    }\r\n\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setCanvas (klC: KlCanvas): void {\r\n        this.klCanvas = klC;\r\n        this.lastDrawEvent = null;\r\n        this.resetView();\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    /**\r\n     * set size of workspace area in pixels\r\n     * @param width\r\n     * @param height\r\n     */\r\n    setSize (width: number, height: number): void {\r\n        const oldWidth = this.renderWidth;\r\n        const oldHeight = this.renderHeight;\r\n\r\n        if (width === oldWidth && height === oldHeight) {\r\n            return;\r\n        }\r\n\r\n        this.doResizeCanvas = true;\r\n        this.renderWidth = width;\r\n        this.renderHeight = height;\r\n\r\n        this.svgOverlay.setSize(width, height);\r\n\r\n        this.targetTransformObj.x += (width - oldWidth) / 2;\r\n        this.targetTransformObj.y += (height - oldHeight) / 2;\r\n\r\n        this.highResTransformObj.x = this.targetTransformObj.x;\r\n        this.highResTransformObj.y = this.targetTransformObj.y;\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setMode (modeStr: TModeStr): void {\r\n        //only sets the base mode\r\n        if (modeStr === 'draw') {\r\n            this.globalMode = TMode.Draw;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'fill') {\r\n            this.globalMode = TMode.Fill;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'gradient') {\r\n            this.globalMode = TMode.Gradient;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'text') {\r\n            this.globalMode = TMode.Text;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'shape') {\r\n            this.globalMode = TMode.Shape;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'hand') {\r\n            this.globalMode = TMode.Hand;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n        }\r\n        if (modeStr === 'pick') {\r\n            this.globalMode = TMode.Pick;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n    }\r\n\r\n    getMode(): TModeStr {\r\n        if (this.globalMode === TMode.Draw) {\r\n            return 'draw';\r\n        }\r\n        if (this.globalMode === TMode.Fill) {\r\n            return 'fill';\r\n        }\r\n        if (this.globalMode === TMode.Gradient) {\r\n            return 'gradient';\r\n        }\r\n        if (this.globalMode === TMode.Text) {\r\n            return 'text';\r\n        }\r\n        if (this.globalMode === TMode.Shape) {\r\n            return 'shape';\r\n        }\r\n        if (this.globalMode === TMode.Hand) {\r\n            return 'hand';\r\n        }\r\n        if (this.globalMode === TMode.Pick) {\r\n            return 'pick';\r\n        }\r\n    }\r\n\r\n    setEnabled (b: boolean): void {\r\n        // todo\r\n    }\r\n\r\n    setCursorSize (diameter: number): void {\r\n        this.brushRadius = diameter / 2;\r\n\r\n        this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n\r\n        if (this.pointer === null) {\r\n            clearTimeout(this.hideBrushCursorTimeout);\r\n\r\n            this.svgOverlay.updateCursor({\r\n                x: this.renderWidth / 2,\r\n                y: this.renderHeight / 2,\r\n                isVisible: true\r\n            });\r\n\r\n            // @ts-ignore\r\n            this.hideBrushCursorTimeout = setTimeout(() => {\r\n                if (this.pointer !== null) {\r\n                    return;\r\n                }\r\n                this.svgOverlay.updateCursor({isVisible: false});\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n    zoomByStep (stepNum: number): void {\r\n        if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) {\r\n            return;\r\n        }\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale'],\r\n            angle: this.targetTransformObj.angle,\r\n            scale: this.targetTransformObj.scale\r\n        });\r\n    }\r\n\r\n    resetView (doAnimate?: boolean): void {\r\n        this.targetTransformObj.scale = 1;\r\n        this.targetTransformObj.angle = 0;\r\n\r\n        this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\r\n        this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\r\n\r\n        if (!doAnimate) {\r\n            this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n        } else {\r\n            this.doAnimateTranslate = true;\r\n            this.transformIsDirty = true;\r\n        }\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n        this.reqFrame();\r\n\r\n        if (doAnimate) {\r\n            this.onViewChange({\r\n                changed: ['scale', 'angle'],\r\n                scale: this.targetTransformObj.scale,\r\n                angle: this.targetTransformObj.angle\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * fit into view. center. snap angle. padding\r\n     * returns true if transform changes\r\n     */\r\n    fitView (): boolean {\r\n        // determine new transform\r\n        const newAngle = this.snapAngleRad(this.targetTransformObj.angle, 90, 90);\r\n\r\n        //calc width and height of bounds\r\n        const canvasPointsArr = [\r\n            [0, 0], // top left\r\n            [this.klCanvas.getWidth(), 0], // top right\r\n            [this.klCanvas.getWidth(), this.klCanvas.getHeight()], // bottom right\r\n            [0, this.klCanvas.getHeight()], // bottom left\r\n            [this.klCanvas.getWidth() / 2, this.klCanvas.getHeight() / 2], // center\r\n        ];\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(newAngle));\r\n\r\n        //rotate points\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            let coords = [canvasPointsArr[i][0], canvasPointsArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n            canvasPointsArr[i][0] = coords[0];\r\n            canvasPointsArr[i][1] = coords[1];\r\n        }\r\n\r\n        const boundsObj = {\r\n            x0: null,\r\n            y0: null,\r\n            x1: null,\r\n            y1: null\r\n        };\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            if (boundsObj.x0 === null || canvasPointsArr[i][0] < boundsObj.x0) {\r\n                boundsObj.x0 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y0 === null || canvasPointsArr[i][1] < boundsObj.y0) {\r\n                boundsObj.y0 = canvasPointsArr[i][1];\r\n            }\r\n            if (boundsObj.x1 === null || canvasPointsArr[i][0] > boundsObj.x1) {\r\n                boundsObj.x1 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y1 === null || canvasPointsArr[i][1] > boundsObj.y1) {\r\n                boundsObj.y1 = canvasPointsArr[i][1];\r\n            }\r\n        }\r\n        const boundsWidth = boundsObj.x1 - boundsObj.x0;\r\n        const boundsHeight = boundsObj.y1 - boundsObj.y0;\r\n\r\n        //fit bounds\r\n        const padding = 0;\r\n        const { width: fitWidth } = BB.fitInto(\r\n            boundsWidth,\r\n            boundsHeight, \r\n            this.renderWidth - padding, \r\n            this.renderHeight - padding, \r\n            1\r\n        );\r\n\r\n        //determine scale\r\n        const factor = fitWidth / boundsWidth;\r\n\r\n        const newTargetTransformObj = {\r\n            angle: newAngle,\r\n            x: (this.renderWidth / 2) - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor,\r\n            y: (this.renderHeight / 2) - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor,\r\n            scale: factor,\r\n        };\r\n\r\n        if (\r\n            newTargetTransformObj.angle === this.targetTransformObj.angle &&\r\n            Math.abs(newTargetTransformObj.x - this.targetTransformObj.x) < 0.0000000001 &&\r\n            Math.abs(newTargetTransformObj.y - this.targetTransformObj.y) < 0.0000000001 &&\r\n            newTargetTransformObj.scale === this.targetTransformObj.scale\r\n        ) {\r\n            return false;\r\n        }\r\n        this.targetTransformObj = newTargetTransformObj;\r\n\r\n        this.doAnimateTranslate = true;\r\n        this.transformIsDirty = true;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale', 'angle'],\r\n            scale: this.targetTransformObj.scale,\r\n            angle: this.targetTransformObj.angle\r\n        });\r\n        return true;\r\n    }\r\n\r\n    setAngle (angleDeg: number, isRelative?: boolean): void {\r\n        //rotation done around center\r\n        const centerObj = {\r\n            x: this.renderWidth / 2,\r\n            y: this.renderHeight / 2\r\n        };\r\n\r\n        const oldAngleRad = this.targetTransformObj.angle;\r\n        const angleRad = angleDeg / 180 * Math.PI;\r\n\r\n        if (isRelative) {\r\n            this.targetTransformObj.angle += angleRad;\r\n        } else {\r\n            this.targetTransformObj.angle = angleRad;\r\n        }\r\n\r\n        this.targetTransformObj.angle = this.minimizeAngleRad(\r\n            this.snapAngleRad(\r\n                this.targetTransformObj.angle,\r\n                90,\r\n                4\r\n            )\r\n        );\r\n\r\n        //rotate transform.xy\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n        this.transformIsDirty = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    /**\r\n     * translate canvas by viewport pixels\r\n     * @param tx\r\n     * @param ty\r\n     */\r\n    translateView (tx: number, ty: number): void {\r\n        const scale = 40;\r\n\r\n        this.targetTransformObj.x += tx * scale;\r\n        this.targetTransformObj.y += ty * scale;\r\n\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    getScale (): number {\r\n        return this.targetTransformObj.scale;\r\n    }\r\n\r\n    getAngleDeg (): number {\r\n        return this.targetTransformObj.angle * 180 / Math.PI;\r\n    }\r\n\r\n    getMaxScale (): number {\r\n        return MAX_SCALE;\r\n    }\r\n\r\n    getMinScale (): number {\r\n        return MIN_SCALE;\r\n    }\r\n\r\n    requestFrame (): void {\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setLastDrawEvent (x: number | null, y?: number, pressure?: number): void {\r\n        if (x === null) {\r\n            this.lastDrawEvent = null;\r\n            return;\r\n        }\r\n\r\n        if (!this.lastDrawEvent) {\r\n            this.lastDrawEvent = {x: 0, y: 0, pressure: 0};\r\n        }\r\n        this.lastDrawEvent.x = x;\r\n        this.lastDrawEvent.y = y;\r\n        this.lastDrawEvent.pressure = pressure;\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1dLwT\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"9wZxU\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hQSEH\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"916ZI\");","import {BB} from '../../bb/bb';\r\nimport {IKlBasicLayer} from '../kl.types';\r\n\r\n/**\r\n * preview of image with layers. can do mix modes and opacity.\r\n * creates a canvas.\r\n *\r\n * p = {\r\n *     width: 123,\r\n *     height: 123,\r\n *     layers: [// can be changed after the fact\r\n *         {\r\n *             image: Canvas,\r\n *             opacity: 1,\r\n *             mixModeStr: 'source-over'\r\n *         }\r\n *     ]\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function KlCanvasPreview(\r\n    p: {\r\n        width: number;\r\n        height: number;\r\n        layers: IKlBasicLayer[];\r\n    }\r\n) {\r\n    const scale = p.width / p.layers[0].image.width;\r\n    const width = scale > 1 ? p.layers[0].image.width : p.width;\r\n    const height = scale > 1 ? p.layers[0].image.height : p.height;\r\n\r\n    let canvas = BB.canvas(width, height);\r\n    canvas.style.backgroundImage = 'url(' + BB.createCheckerDataUrl(8) + ')';\r\n    let ctx = canvas.getContext('2d');\r\n\r\n    BB.css(canvas, {\r\n        width: '100%',\r\n        height: '100%',\r\n        imageRendering: scale > 1 ? 'pixelated' : null,\r\n    });\r\n\r\n    function render() {\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        for (let i = 0; i < p.layers.length; i++) {\r\n            ctx.globalAlpha = p.layers[i].opacity;\r\n            ctx.globalCompositeOperation = p.layers[i].mixModeStr;\r\n            if (canvas.width > p.layers[i].image.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(p.layers[i].image, 0, 0, canvas.width, canvas.height);\r\n        }\r\n        ctx.restore();\r\n    }\r\n\r\n    setTimeout(render, 0);\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return canvas;\r\n    };\r\n\r\n    this.render = function() {\r\n        render();\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport rotateImg from 'url:~/src/app/img/ui/cursor-rotate.png';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {IVector2D} from '../../../bb/bb.types';\r\n\r\nexport interface ITransform {\r\n    x: number; // center of transform region. image space\r\n    y: number;\r\n    width: number; // size of transform region. image space\r\n    height: number;\r\n    angleDeg: number; // angle of transform region. degrees\r\n}\r\n\r\n\r\n/**\r\n * snap entire transform to pixel grid. changes transform\r\n *\r\n * for x y:\r\n * If a dimension has an even size, it be an integer.\r\n * If it's uneven, it's sits exactly half way between two pixels.\r\n *\r\n * @param transform\r\n */\r\nfunction snapToPixel(transform: ITransform): void {\r\n    if (Math.abs(transform.angleDeg) % 90 !== 0) {\r\n        return;\r\n    }\r\n\r\n    transform.width = Math.round(transform.width);\r\n    transform.height = Math.round(transform.height);\r\n    // 0 is original orientation.\r\n    // At 90 and 270 width and height become swapped due to different orientation.\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    transform.x = ((whSwapped ? transform.height : transform.width) % 2 === 0) ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\r\n    transform.y = ((whSwapped ? transform.width : transform.height) % 2 === 0)  ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\r\n}\r\n\r\nfunction copyTransform(transform: ITransform): ITransform {\r\n    return {\r\n        x: transform.x,\r\n        y: transform.y,\r\n        width: transform.width,\r\n        height: transform.height,\r\n        angleDeg: transform.angleDeg,\r\n    };\r\n}\r\n\r\n/**\r\n * image space to transform space\r\n * - origin of transform space is at center of transform bounds.\r\n * - same scale as image space. -> one unit is x: 1/width, y: 1/height\r\n * - up is where transform points up\r\n * - x goes right\r\n * - y goes down\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nfunction toTransformSpace (x: number, y: number, transform: ITransform): IVector2D {\r\n    let px, py;\r\n    px = x - transform.x;\r\n    py = y - transform.y;\r\n\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: px, y: py},\r\n        -transform.angleDeg);\r\n    px = rot.x;\r\n    py = rot.y;\r\n\r\n    return {\r\n        x: px,\r\n        y: py,\r\n    };\r\n}\r\n\r\n/**\r\n * transform space to image space\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nfunction toImageSpace(x: number, y: number, transform: ITransform): IVector2D {\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: x, y: y},\r\n        transform.angleDeg);\r\n    return {\r\n        x: rot.x + transform.x,\r\n        y: rot.y + transform.y,\r\n    };\r\n}\r\n\r\n\r\n\r\n/**\r\n * Free Transform UI\r\n * rotate, scale, translate\r\n *\r\n * - if rotation is multiple of 90 it will snap to pixels, to be more useful for pixel art\r\n * - when rotation goes from non-multiple of 90 to a multiple, it will snap position and width height to pixels\r\n * - transform.x, transform.y can sit between pixels (by 0.5) if width or height is odd number.\r\n *      - this is what complicates things\r\n * - if transform region small, corner grips move out of the way\r\n *\r\n * iX iY, iP.x, iP.y - i indicates image space\r\n * tX tY, tP.x, tP.y - t indicates transform space\r\n *\r\n * Not sure if can be used for navigable canvas. (especially if canvas rotates view)\r\n * Probably can't be extended for distort. Needs a different approach.\r\n *\r\n * --- DOM structure ---\r\n * rootEl {\r\n * \ttransEl [\r\n * \t\tboundsEl\r\n * \t\tedges[]\r\n * \t\tcorners[] - round grips in the corner of transform region\r\n * \t\tangleGrip\r\n * \t]\r\n * }\r\n *\r\n */\r\nexport class FreeTransform {\r\n\r\n    // --- private ---\r\n    private readonly transform: ITransform; // coordinates and dimensions of transformation\r\n    private isConstrained: boolean;\r\n    private ratio: number; // aspect ratio of transform\r\n    private readonly scale: number;\r\n    private readonly scaled = { // scaled coordinates and dimensions for screenspace\r\n        x: 0,\r\n        y: 0,\r\n        width: 0,\r\n        height: 0,\r\n        corners: [{x: 0, y: 0}], // in transform space\r\n    };\r\n    private readonly minSnapDist = 7; // minimal snapping distance in px screenspace\r\n    private snappingEnabled: boolean;\r\n    private readonly snapX: number[];\r\n    private readonly snapY: number[];\r\n    private readonly callback: (transform: ITransform) => void;\r\n\r\n\r\n    private readonly cornerCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n    private readonly gripSize = 14;\r\n    private readonly edgeSize = 10;\r\n\r\n    private readonly rootEl: HTMLElement; // sits at origin of image\r\n    private readonly transEl: HTMLElement; // at middle of transform. rotates\r\n    private readonly boundsEl: HTMLElement; // draggable bounds rectangle with outline\r\n    private readonly corners: {\r\n        i: number; // index in corners array\r\n        el: HTMLElement; // draggable corner circle in DOM\r\n        x: number; // unscaled position (transform space)\r\n        y: number;\r\n        virtualPos: IVector2D; // unscaled temporary position (image space)\r\n        updateDOM: () => void; // update styling in DOM\r\n        pointerListener: any;\r\n    }[] = [];\r\n    private keyListener: KeyListener;\r\n    private boundsPointerListener: any; // BB.PointerListener\r\n    private anglePointerListener: any; // BB.PointerListener\r\n    private readonly edges: { // derive position from corners\r\n        el: HTMLElement;\r\n        updateDOM: () => void;\r\n        pointerListener: any;\r\n    }[] = [];\r\n    private readonly angleGrip: {\r\n        el: HTMLElement,\r\n        x: number; // transform space\r\n        y: number;\r\n        snap: boolean,\r\n        updateDOM: () => void,\r\n    };\r\n\r\n    private updateScaled(): void {\r\n        this.scaled.x = this.transform.x * this.scale;\r\n        this.scaled.y = this.transform.y * this.scale;\r\n        this.scaled.width = this.transform.width * this.scale;\r\n        this.scaled.height = this.transform.height * this.scale;\r\n        this.scaled.corners = this.corners.map((item) => {\r\n            return {x: item.x * this.scale, y: item.y * this.scale};\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\r\n     * both in image space\r\n     *\r\n     * @param iX - image space\r\n     * @param iY - image space\r\n     * @private\r\n     */\r\n    private snapCorner (iX: number, iY: number): IVector2D {\r\n        if (!this.snappingEnabled) {\r\n            return {x: iX, y: iY};\r\n        }\r\n        let dist: number;\r\n        const snap: {\r\n            x: number;\r\n            y: number;\r\n            dist: {\r\n                x: number;\r\n                y: number;\r\n            }\r\n        } = {\r\n            x: null,\r\n            y: null,\r\n            dist: {\r\n                x: null,\r\n                y: null,\r\n            }\r\n        };\r\n        for (let e = 0; e < this.snapX.length; e++) {\r\n            dist = Math.abs(iX - this.snapX[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.x === null || dist < snap.dist.x) {\r\n                    snap.x = this.snapX[e];\r\n                    snap.dist.x = dist;\r\n                }\r\n            }\r\n        }\r\n        for (let e = 0; e < this.snapY.length; e++) {\r\n            dist = Math.abs(iY - this.snapY[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.y === null || dist < snap.dist.y) {\r\n                    snap.y = this.snapY[e];\r\n                    snap.dist.y = dist;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (snap.x === null && snap.y === null) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        return {\r\n            x: snap.x ?? iX,\r\n            y: snap.y ?? iY,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * If constrained return nearest corner pos that fits aspect ratio\r\n     *\r\n     * @param cornerIndex\r\n     * @param iX\r\n     * @param iY\r\n     * @private\r\n     */\r\n    private constrainCorner (cornerIndex: number, iX: number, iY: number): IVector2D {\r\n        if (!this.isConstrained) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        const flip = this.transform.width * this.transform.height < 0 ? -1 : 1;\r\n        return BB.projectPointOnLine(\r\n            {x: this.transform.x, y: this.transform.y},\r\n            toImageSpace(this.ratio, flip * ([0, 2].includes(cornerIndex) ? 1 : -1), this.transform),\r\n            {x: iX, y: iY}\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Update corners according to width height.\r\n     * Not their DOM.\r\n     */\r\n    private updateCornerPositions (): void {\r\n        this.corners[0].x = (-this.transform.width / 2); // top left\r\n        this.corners[0].y = (-this.transform.height / 2);\r\n\r\n        this.corners[1].x = (this.transform.width / 2); // top right\r\n        this.corners[1].y = (-this.transform.height / 2);\r\n\r\n        this.corners[2].x = (this.transform.width / 2); // bottom right\r\n        this.corners[2].y = (this.transform.height / 2);\r\n\r\n        this.corners[3].x = (-this.transform.width / 2); // bottom left\r\n        this.corners[3].y = (this.transform.height / 2);\r\n    }\r\n\r\n    /**\r\n     * If constrained and dragging an edge, restore aspect ratio\r\n     * Updates corner positions.\r\n     *\r\n     * @param widthChanged\r\n     * @param heightChanged\r\n     * @private\r\n     */\r\n    private restoreRatio (widthChanged: boolean, heightChanged: boolean): void {\r\n        if (!this.isConstrained) {\r\n            return;\r\n        }\r\n        const angle90 = Math.abs(this.transform.angleDeg) % 90 === 0;\r\n        const whSwapped = Math.abs(this.transform.angleDeg - 90) % 180 === 0;\r\n        if (heightChanged && !widthChanged) {\r\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\r\n            let newWidth = this.ratio * newHeight;\r\n            if (angle90) {\r\n                newWidth = (whSwapped ? this.transform.y % 1 : this.transform.x % 1) === 0 ?\r\n                    BB.roundEven(newWidth) : BB.roundUneven(newWidth);\r\n            }\r\n            if (this.corners[1].x - this.corners[0].x < 0) {\r\n                newWidth *= -1;\r\n            }\r\n            this.corners[0].x = -newWidth / 2;\r\n            this.corners[3].x = -newWidth / 2;\r\n            this.corners[1].x = newWidth / 2;\r\n            this.corners[2].x = newWidth / 2;\r\n        }\r\n        if (!heightChanged && widthChanged) {\r\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\r\n            let newHeight = newWidth / this.ratio;\r\n            if (angle90) {\r\n                newHeight = (whSwapped ? this.transform.x % 1 : this.transform.y % 1) === 0  ?\r\n                    BB.roundEven(newHeight) : BB.roundUneven(newHeight);\r\n            }\r\n            if (this.corners[3].y - this.corners[0].y < 0) {\r\n                newHeight *= -1;\r\n            }\r\n            this.corners[0].y = -newHeight / 2;\r\n            this.corners[1].y = -newHeight / 2;\r\n            this.corners[2].y = newHeight / 2;\r\n            this.corners[3].y = newHeight / 2;\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * update transform based on corners\r\n     * @private\r\n     */\r\n    private updateTransformViaCorners (): void {\r\n\r\n        // calc transform center in image space\r\n        const rot = BB.rotateAround(\r\n            {x: 0, y: 0},\r\n            {\r\n                x: (this.corners[0].x + this.corners[1].x) / 2,\r\n                y: (this.corners[0].y + this.corners[3].y) / 2,\r\n            },\r\n            this.transform.angleDeg\r\n        );\r\n        this.transform.x = rot.x + this.transform.x;\r\n        this.transform.y = rot.y + this.transform.y;\r\n\r\n        // update size\r\n        this.transform.width = this.corners[1].x - this.corners[0].x;\r\n        this.transform.height = this.corners[3].y - this.corners[0].y;\r\n\r\n        // new center means corners changed their position\r\n        this.updateCornerPositions();\r\n\r\n        this.updateDOM();\r\n    }\r\n\r\n    /**\r\n     * updates DOM according to transform\r\n     * @param skipCallback\r\n     */\r\n    private updateDOM (skipCallback?: boolean) {\r\n        this.updateScaled();\r\n\r\n        BB.css(this.transEl, {\r\n            left: this.scaled.x + \"px\",\r\n            top: this.scaled.y + \"px\",\r\n            transformOrigin: \"0 0\",\r\n            transform: \"rotate(\" + this.transform.angleDeg + \"deg)\",\r\n        });\r\n\r\n        BB.css(this.boundsEl, {\r\n            width: Math.abs(this.scaled.width) + \"px\",\r\n            height: Math.abs(this.scaled.height) + \"px\",\r\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + \"px\",\r\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + \"px\"\r\n        });\r\n\r\n        this.corners[0].updateDOM();\r\n        this.corners[1].updateDOM();\r\n        this.corners[2].updateDOM();\r\n        this.corners[3].updateDOM();\r\n\r\n        this.edges[0].updateDOM();\r\n        this.edges[1].updateDOM();\r\n        this.edges[2].updateDOM();\r\n        this.edges[3].updateDOM();\r\n\r\n\r\n        this.angleGrip.x = 0;\r\n        this.angleGrip.y = (-Math.abs(this.transform.height * this.scale) / 2) - 20;\r\n        this.angleGrip.updateDOM();\r\n        if (!skipCallback) {\r\n            if (this.callback) { // why should updateDOM trigger the callback?\r\n                this.callback(copyTransform(this.transform));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // --- public ---\r\n    constructor (\r\n        params: {\r\n            x: number; // center of transform region. image space\r\n            y: number;\r\n            width: number; // size of transform region. image space\r\n            height: number;\r\n            angleDeg: number; // angle of transform region. degrees\r\n\r\n            isConstrained: boolean; // proportions constrained\r\n            snapX: number[]; // where snapping along X axis. image space\r\n            snapY: number[]; // where snapping along X axis. image space\r\n            scale: number; // ratio of screen-space / image-space\r\n            callback: (transform: ITransform) => void;\r\n        }\r\n    ) {\r\n        this.transform = { // coordinates and dimensions of transformation\r\n            x: params.x,\r\n            y: params.y,\r\n            width: params.width,\r\n            height: params.height,\r\n            angleDeg: params.angleDeg,\r\n        };\r\n\r\n        this.isConstrained = !!params.isConstrained;\r\n\r\n        this.snapX = params.snapX;\r\n        this.snapY = params.snapY;\r\n        this.callback = params.callback;\r\n        this.scale = params.scale;\r\n        this.snappingEnabled = true;\r\n        this.ratio = this.transform.width / this.transform.height;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-free-transform',\r\n            css: {\r\n                userSelect: 'none',\r\n            }\r\n        });\r\n        this.transEl = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                position: 'absolute',\r\n            }\r\n        });\r\n\r\n        this.boundsEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                cursor: 'move',\r\n                boxShadow: 'rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px',\r\n            }\r\n        });\r\n\r\n        const pointerRemainder = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        function resetRemainder() {\r\n            pointerRemainder.x = 0;\r\n            pointerRemainder.y = 0;\r\n        }\r\n        this.keyListener = new BB.KeyListener({});\r\n\r\n        let boundsStartP = {\r\n            x: 0,\r\n            y: 0,\r\n        }\r\n        this.boundsPointerListener = new BB.PointerListener({\r\n            target: this.boundsEl,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointerdown') {\r\n                    boundsStartP = {x: this.transform.x, y: this.transform.y};\r\n                }\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    this.transform.x = boundsStartP.x + (event.pageX - event.downPageX) / this.scale;\r\n                    this.transform.y = boundsStartP.y + (event.pageY - event.downPageY) / this.scale;\r\n\r\n\r\n                    let dist;\r\n                    let snap: any = {};\r\n                    if (this.snappingEnabled) {\r\n                        let i;\r\n                        for (i = 0; i < this.snapX.length; i++) {\r\n                            dist = Math.abs(this.transform.x - this.snapX[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.x || dist < snap.distX) {\r\n                                    snap.x = this.snapX[i];\r\n                                    snap.distX = dist;\r\n                                }\r\n                            }\r\n                        }\r\n                        for (i = 0; i < this.snapY.length; i++) {\r\n                            dist = Math.abs(this.transform.y - this.snapY[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.y || dist < snap.distY) {\r\n                                    snap.y = this.snapY[i];\r\n                                    snap.distY = dist;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        let iP;\r\n                        for (i = 0; i < 4; i++) {\r\n                            iP = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n                            let j;\r\n                            for (j = 0; j < this.snapX.length; j++) {\r\n                                dist = Math.abs(iP.x - this.snapX[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.x || dist < snap.distX) {\r\n                                        snap.x = this.snapX[j] - (iP.x - this.transform.x);\r\n                                        snap.distX = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                            for (j = 0; j < this.snapY.length; j++) {\r\n                                dist = Math.abs(iP.y - this.snapY[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.y || dist < snap.distY) {\r\n                                        snap.y = this.snapY[j] - (iP.y - this.transform.y);\r\n                                        snap.distY = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        let projected = BB.projectPointOnLine(\r\n                            {x: 0, y: boundsStartP.y},\r\n                            {x: 10, y: boundsStartP.y},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        let dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        snap = {};\r\n                        snap.x = projected.x;\r\n                        snap.y = projected.y;\r\n                        snap.distX = dist;\r\n                        snap.distY = dist;\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: 0},\r\n                            {x: boundsStartP.x, y: 10},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap.x = projected.x;\r\n                            snap.y = projected.y;\r\n                            snap.distX = dist;\r\n                            snap.distY = dist;\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y + 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap.x = projected.x;\r\n                            snap.y = projected.y;\r\n                            snap.distX = dist;\r\n                            snap.distY = dist;\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y - 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap.x = projected.x;\r\n                            snap.y = projected.y;\r\n                            snap.distX = dist;\r\n                            snap.distY = dist;\r\n                        }\r\n                    }\r\n                    if (snap.x != undefined) {\r\n                        this.transform.x = snap.x;\r\n                    }\r\n                    if (snap.y != undefined) {\r\n                        this.transform.y = snap.y;\r\n                    }\r\n\r\n                    // snap to pixels\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                    }\r\n\r\n                    this.updateDOM();\r\n                }\r\n            }\r\n        })\r\n\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                const g = this.corners[i] = {\r\n                    i: i,\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.gripSize + 'px',\r\n                            height: this.gripSize + 'px',\r\n                            background: '#fff',\r\n                            /*background: [\r\n                                '#ff0000',\r\n                                '#00ff00',\r\n                                '#0000ff',\r\n                                '#ff00ff',\r\n                            ][i],*/\r\n                            borderRadius: this.gripSize + 'px',\r\n                            position: 'absolute',\r\n                            boxShadow: 'inset 0 0 0 2px #000'\r\n                        }\r\n                    }),\r\n                    x: 0,\r\n                    y: 0,\r\n                    virtualPos: {\r\n                        x: 0,\r\n                        y: 0,\r\n                    },\r\n                    updateDOM: null,\r\n                    pointerListener: null,\r\n                };\r\n                g.updateDOM = () => {\r\n\r\n                    // grip position\r\n                    // if gets small, offset grips, so easier to handle\r\n                    const offsetArr = [[-1, -1], [1, -1], [1, 1], [-1, 1]].map(item => {\r\n                        item[0] *= this.transform.width > 0 ? 1 : -1;\r\n                        item[1] *= this.transform.height > 0 ? 1 : -1;\r\n                        return item;\r\n                    });\r\n                    const tinyOffset = Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20 ? 10 : 0;\r\n\r\n                    BB.css(g.el, {\r\n                        left: (this.scaled.corners[g.i].x - this.gripSize / 2 + offsetArr[i][0] * tinyOffset) + 'px',\r\n                        top: (this.scaled.corners[g.i].y - this.gripSize / 2 + offsetArr[i][1] * tinyOffset) + 'px'\r\n                    });\r\n\r\n\r\n                    // cursor\r\n                    let angle = BB.pointsToAngleDeg(\r\n                        {\r\n                            x: this.transform.x,\r\n                            y: this.transform.y,\r\n                        },\r\n                        toImageSpace(g.x, g.y, this.transform),\r\n                    ) + 135; // offset so nw is 0\r\n                    while (angle < 0) {\r\n                        angle += 360;\r\n                    }\r\n                    let index = Math.round(angle / 45) % this.cornerCursors.length;\r\n                    BB.css(g.el, {\r\n                        cursor: this.cornerCursors[index] + '-resize',\r\n                    });\r\n                };\r\n\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.corners[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            this.corners[i].virtualPos = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n\r\n                        } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                            this.corners[i].virtualPos.x += event.dX / this.scale;\r\n                            this.corners[i].virtualPos.y += event.dY / this.scale;\r\n\r\n                            let iP = {\r\n                                x: this.corners[i].virtualPos.x,\r\n                                y: this.corners[i].virtualPos.y,\r\n                            };\r\n                            iP = this.constrainCorner(i, iP.x, iP.y);\r\n                            if (!this.isConstrained) {\r\n                                iP = this.snapCorner(iP.x, iP.y);\r\n                            }\r\n\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                iP.x = Math.round(iP.x);\r\n                                iP.y = Math.round(iP.y);\r\n                            }\r\n\r\n                            const tP = toTransformSpace(iP.x, iP.y, this.transform);\r\n\r\n                            const dX = tP.x - this.corners[i].x;\r\n                            const dY = tP.y - this.corners[i].y;\r\n                            this.corners[i].x = tP.x;\r\n                            this.corners[i].y = tP.y;\r\n\r\n                            let indexes = [];\r\n                            if (i === 0) { // top left\r\n                                indexes = [3, 1, 2];\r\n                            } else if (i === 1) { // top right\r\n                                indexes = [2, 0, 3];\r\n                            } else if (i === 2) { // bottom right\r\n                                indexes = [1, 3, 0];\r\n                            } else if (i === 3) { // bottom left\r\n                                indexes = [0, 2, 1];\r\n                            }\r\n\r\n                            this.corners[indexes[0]].x = this.corners[i].x;\r\n                            this.corners[indexes[1]].y = this.corners[i].y;\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                this.corners[indexes[2]].x -= dX;\r\n                                this.corners[indexes[2]].y -= dY;\r\n                                this.corners[indexes[1]].x = this.corners[indexes[2]].x;\r\n                                this.corners[indexes[0]].y = this.corners[indexes[2]].y;\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    }\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.updateCornerPositions();\r\n        this.updateScaled();\r\n\r\n        let isInverted: boolean;\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                this.edges[i] = {\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.edgeSize + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                            /*background: [\r\n                                '#ff000044',\r\n                                '#00ff0044',\r\n                                '#0000ff44',\r\n                                '#ff00ff44',\r\n                            ][i],*/\r\n                            position: 'absolute',\r\n                        },\r\n                    }),\r\n                    updateDOM: null,\r\n                    pointerListener: null,\r\n                };\r\n                const g = this.edges[i];\r\n                g.updateDOM = () => {\r\n                    if (i === 0) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: (Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) - this.edgeSize) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 1) {\r\n                        BB.css(g.el, {\r\n                            left: Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    } else if (i === 2) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + 'px',\r\n                            top: Math.max(this.scaled.corners[0].y,this.scaled.corners[3].y) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 3) {\r\n                        BB.css(g.el, {\r\n                            left: (Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) - this.edgeSize) + 'px',\r\n                            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    }\r\n                    let angleOffset = Math.round(this.transform.angleDeg / 45);\r\n                    while (angleOffset < 0)\r\n                        angleOffset += 8;\r\n                    angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\r\n                    g.el.style.cursor = this.cornerCursors[angleOffset] + '-resize';\r\n\r\n                };\r\n\r\n                const isVertical = [0, 2].includes(i);\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.edges[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            if (isVertical) { // top bottom\r\n                                isInverted = this.corners[0].y >= this.corners[3].y;\r\n                            } else { // left right\r\n                                isInverted = this.corners[0].x >= this.corners[1].x;\r\n                            }\r\n                            resetRemainder();\r\n                        }\r\n                        if (event.type === 'pointermove' && event.button === 'left') {\r\n                            const tfD = BB.rotateAround({x: 0, y: 0},\r\n                                {x: event.dX / this.scale, y: event.dY / this.scale},\r\n                                -this.transform.angleDeg);\r\n                            let ti = {\r\n                                dX: tfD.x,\r\n                                dY: tfD.y,\r\n                            };\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                ti = BB.intDxy(pointerRemainder, tfD.x, tfD.y);\r\n                            }\r\n\r\n                            let indexes = [];\r\n                            if (i === 0) { // top\r\n                                indexes = [2, 3, 0, 1];\r\n                            } else if (i === 1) { // right\r\n                                indexes = [0, 3, 1, 2];\r\n                            } else if (i === 2) { // bottom\r\n                                indexes = [0, 1, 2, 3];\r\n                            } else if (i === 3) { // left\r\n                                indexes = [1, 2, 0, 3];\r\n                            }\r\n\r\n                            let dimension = isVertical ? 'y' : 'x';\r\n                            let d = isVertical ? ti.dY : ti.dX;\r\n\r\n                            if (isInverted) {\r\n                                this.corners[indexes[0]][dimension] += d;\r\n                                this.corners[indexes[1]][dimension] += d;\r\n                            } else {\r\n                                this.corners[indexes[2]][dimension] += d;\r\n                                this.corners[indexes[3]][dimension] += d;\r\n                            }\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                if (isInverted) {\r\n                                    this.corners[indexes[2]][dimension] -= d;\r\n                                    this.corners[indexes[3]][dimension] -= d;\r\n                                } else {\r\n                                    this.corners[indexes[0]][dimension] -= d;\r\n                                    this.corners[indexes[1]][dimension] -= d;\r\n                                }\r\n                            }\r\n\r\n                            if (isVertical) { // top bottom\r\n                                this.restoreRatio(false, true);\r\n                            } else { // left right\r\n                                this.restoreRatio(true, false);\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    }\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.angleGrip = {\r\n            el: BB.el({\r\n                css: {\r\n                    cursor: 'url(' + rotateImg + ') 10 10, move',\r\n                    width: this.gripSize + 'px',\r\n                    height: this.gripSize + 'px',\r\n                    background: '#0ff',\r\n                    borderRadius: this.gripSize + 'px',\r\n                    position: 'absolute',\r\n                    boxShadow: 'inset 0 0 0 2px #000',\r\n                },\r\n            }),\r\n            x: 0,\r\n            y: 0,\r\n            snap: false,\r\n            updateDOM: () => {\r\n                BB.css(this.angleGrip.el, {\r\n                    left: (this.angleGrip.x - this.gripSize / 2) + 'px',\r\n                    top: (this.angleGrip.y - this.gripSize / 2) + 'px',\r\n                });\r\n            },\r\n        };\r\n        BB.el({\r\n            parent: this.angleGrip.el,\r\n            css: {\r\n                width: '2px',\r\n                height: '13px',\r\n                left: (this.gripSize / 2 - 1) + 'px',\r\n                top: this.gripSize + 'px',\r\n                background: '#0ff',\r\n                position: 'absolute'\r\n            }\r\n        });\r\n\r\n        this.anglePointerListener = new BB.PointerListener({\r\n            target: this.angleGrip.el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    const bounds = this.rootEl.getBoundingClientRect();\r\n                    const offset = {\r\n                        x: bounds.left - this.rootEl.scrollLeft,\r\n                        y: bounds.top - this.rootEl.scrollTop,\r\n                    };\r\n                    const iP = {x: (event.clientX - offset.x) / this.scale, y: (event.clientY - offset.y) / this.scale};\r\n\r\n                    const a = BB.pointsToAngleDeg({x: this.transform.x, y: this.transform.y}, iP) + 90;\r\n                    this.transform.angleDeg = a;\r\n                    const snapDeg = Math.round(a / 360 * 8) * 45;\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    } else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    }\r\n                    this.updateDOM();\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                        this.updateDOM();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        snapToPixel(this.transform);\r\n        this.updateDOM(true);\r\n        BB.append(this.transEl, [\r\n            this.boundsEl,\r\n            this.edges[0].el,\r\n            this.edges[1].el,\r\n            this.edges[2].el,\r\n            this.edges[3].el,\r\n            this.corners[0].el,\r\n            this.corners[1].el,\r\n            this.corners[2].el,\r\n            this.corners[3].el,\r\n            this.angleGrip.el,\r\n        ]);\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    getTransform (): ITransform {\r\n        return copyTransform(this.transform);\r\n    }\r\n\r\n    setConstrained (b: boolean): void {\r\n        this.isConstrained = !!b;\r\n        if (b && this.transform.width !== 0 && this.transform.height !== 0) {\r\n            this.ratio = Math.abs(this.transform.width / this.transform.height);\r\n        }\r\n    }\r\n\r\n    setSnapping (s: boolean): void {\r\n        this.snappingEnabled = !!s;\r\n    }\r\n\r\n    setPos (p: IVector2D): void {\r\n        this.transform.x = p.x;\r\n        this.transform.y = p.y;\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    move (dX: number, dY: number): void {\r\n        this.transform.x += dX;\r\n        this.transform.y += dY;\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setSize (w: number, h: number): void {\r\n        this.transform.width = w;\r\n        this.transform.height = h;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n        }\r\n        this.updateCornerPositions();\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setAngleDeg (a: number): void {\r\n        this.transform.angleDeg = a;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n            this.updateCornerPositions();\r\n        }\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getRatio (): number {\r\n        return this.ratio;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.keyListener.destroy();\r\n        this.boundsPointerListener.destroy();\r\n        this.corners[0].pointerListener.destroy();\r\n        this.corners[1].pointerListener.destroy();\r\n        this.corners[2].pointerListener.destroy();\r\n        this.corners[3].pointerListener.destroy();\r\n        this.edges[0].pointerListener.destroy();\r\n        this.edges[1].pointerListener.destroy();\r\n        this.edges[2].pointerListener.destroy();\r\n        this.edges[3].pointerListener.destroy();\r\n        this.anglePointerListener.destroy();\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"045N6\");","import {BB} from '../../../bb/bb';\r\nimport {KlCanvasPreview} from '../../canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './free-transform';\r\nimport {IKlBasicLayer, IMixMode} from '../../kl.types';\r\n\r\n/**\r\n * a basic canvas where you can transform one layer(move around, rotate, scale)\r\n *\r\n * @param params\r\n * @returns {HTMLDivElement}\r\n * @constructor\r\n */\r\nexport function FreeTransformCanvas(params: {\r\n    elementWidth: number;\r\n    elementHeight: number;\r\n    imageWidth: number;\r\n    imageHeight: number;\r\n    layers: IKlBasicLayer[];\r\n    transformIndex: number;\r\n}) {\r\n    /*\r\n    div\r\n        innerWrapper\r\n            klCanvasPreview\r\n            transform.div\r\n    */\r\n\r\n    let previewFit = BB.fitInto(\r\n        params.imageWidth,\r\n        params.imageHeight,\r\n        params.elementWidth - 20,\r\n        params.elementHeight - 60,\r\n        1\r\n    );\r\n    let scale = previewFit.width / params.imageWidth;\r\n\r\n    let div = BB.el({\r\n        css: {\r\n            width: params.elementWidth + \"px\",\r\n            height: params.elementHeight + \"px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            userSelect: \"none\",\r\n            position: \"relative\",\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    let innerWrapper = BB.el({\r\n        css: {\r\n            position: 'relative',\r\n            boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n            width: previewFit.width + 'px',\r\n            height: previewFit.height + 'px'\r\n        }\r\n    });\r\n    div.appendChild(innerWrapper);\r\n\r\n    let previewLayerArr = params.layers.map(item => {\r\n        return {\r\n            image: item.image,\r\n            mixModeStr: item.mixModeStr,\r\n            opacity: item.opacity,\r\n        }\r\n    });\r\n    previewLayerArr[previewLayerArr.length - 1].image = BB.canvas(\r\n        scale > 1 ? params.imageWidth : previewFit.width,\r\n        scale > 1 ? params.imageHeight : previewFit.height,\r\n    );\r\n    let klCanvasPreview = new KlCanvasPreview({\r\n        width: previewFit.width,\r\n        height: previewFit.height,\r\n        layers: previewLayerArr\r\n    });\r\n    innerWrapper.appendChild(klCanvasPreview.getElement());\r\n\r\n    let freeTransform;\r\n    let initTransform;\r\n    function updatePreview() {\r\n        if (!freeTransform) {\r\n            return;\r\n        }\r\n\r\n        let transform = freeTransform.getTransform();\r\n        if (scale < 1) {\r\n            transform.x *= scale;\r\n            transform.y *= scale;\r\n            transform.width *= scale;\r\n            transform.height *= scale;\r\n        }\r\n\r\n        let destCanvas = previewLayerArr[params.transformIndex].image;\r\n        let ctx = (destCanvas as HTMLCanvasElement).getContext('2d');\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, destCanvas.width, destCanvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            ctx,\r\n            params.layers[params.transformIndex].image,\r\n            transform,\r\n            null,\r\n            BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n        );\r\n        ctx.restore();\r\n        klCanvasPreview.render();\r\n    }\r\n\r\n    {\r\n        let transformSize = {\r\n            width: params.layers[params.transformIndex].image.width * scale,\r\n            height: params.layers[params.transformIndex].image.height * scale\r\n        };\r\n        if (transformSize.width > previewFit.width || transformSize.height > previewFit.height) {\r\n            transformSize = BB.fitInto(\r\n                params.layers[params.transformIndex].image.width,\r\n                params.layers[params.transformIndex].image.height,\r\n                previewFit.width,\r\n                previewFit.height,\r\n                1\r\n            );\r\n        }\r\n        initTransform = {\r\n            x: params.imageWidth / 2,\r\n            y: params.imageHeight / 2,\r\n            width: params.layers[params.transformIndex].image.width,\r\n            height: params.layers[params.transformIndex].image.height,\r\n        };\r\n        freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: 0,\r\n            isConstrained: true,\r\n            snapX: [0, params.imageWidth],\r\n            snapY: [0, params.imageHeight],\r\n            scale: scale,\r\n            callback: (transform) => {\r\n                updatePreview();\r\n            },\r\n        });\r\n    }\r\n    BB.css(freeTransform.getElement(), {\r\n        position: 'absolute',\r\n        left: '0',\r\n        top: '0'\r\n    });\r\n    innerWrapper.appendChild(freeTransform.getElement());\r\n    setTimeout(updatePreview, 0);\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.move = function(dX, dY) {\r\n        freeTransform.move(dX, dY);\r\n    };\r\n    this.reset = function() {\r\n        let w = params.layers[params.transformIndex].image.width;\r\n        let h = params.layers[params.transformIndex].image.height;\r\n\r\n        freeTransform.setSize(w, h);\r\n        freeTransform.setPos({x: w / 2, y: h / 2});\r\n        freeTransform.setAngleDeg(0);\r\n        updatePreview();\r\n    };\r\n    this.setTransformFit = function() {\r\n\r\n        let fit = BB.fitInto(\r\n            params.layers[params.transformIndex].image.width,\r\n            params.layers[params.transformIndex].image.height,\r\n            params.imageWidth,\r\n            params.imageHeight,\r\n            1\r\n        );\r\n\r\n        freeTransform.setSize(fit.width, fit.height);\r\n        freeTransform.setPos({x: fit.width / 2, y: fit.height / 2});\r\n        freeTransform.setAngleDeg(0);\r\n        updatePreview();\r\n    };\r\n    this.setTransformCenter = function() {\r\n        freeTransform.setPos({x: params.imageWidth / 2, y: params.imageHeight / 2});\r\n        freeTransform.setAngleDeg(0);\r\n        updatePreview();\r\n    };\r\n    //gives you the transformation in the original scale\r\n    this.getTransformation = function () {\r\n        if (!freeTransform) {\r\n            return false;\r\n        }\r\n        return freeTransform.getTransform();\r\n    };\r\n    this.getIsPixelated = () => {\r\n        const transform = freeTransform.getTransform();\r\n        return BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height);\r\n    };\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.destroy = function() {\r\n        freeTransform.destroy();\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/*\r\n\tCropper params\r\n\t{\r\n\t\tx: int, //pos in relation zum bild\r\n\t\ty: int,\r\n\t\tw: int,\r\n\t\th: int,\r\n\t\tscale: float, //zoom\r\n\t\tcallback: function //wenn sich was ndert\r\n\t}\r\n\tthe div that you append this to must be relative\r\n*/\r\nexport function Cropper (params) {\r\n    let x = params.x,\r\n        y = params.y,\r\n        width = params.width,\r\n        height = params.height,\r\n        scale = params.scale,\r\n        callback = params.callback,\r\n        maxW = params.maxW,\r\n        maxH = params.maxH;\r\n    let div = document.createElement(\"div\");\r\n    let gripCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n\r\n    let keyListener = new BB.KeyListener({});\r\n\r\n    BB.css(div, {\r\n        position: \"absolute\",\r\n        left: (x * scale) + \"px\",\r\n        top: (y * scale) + \"px\"\r\n    });\r\n\r\n    let outline = document.createElement(\"div\");\r\n    BB.css(outline, {\r\n        position: \"absolute\",\r\n        border: \"1px dashed #fff\",\r\n        cursor: \"move\"\r\n    });\r\n    (outline as any).update = function () {\r\n        BB.css(outline, {\r\n            left: (grips[0].x * scale - 1) + \"px\",\r\n            top: (grips[0].y * scale - 1) + \"px\",\r\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\r\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\r\n        });\r\n    };\r\n    let pointerRemainder = { // needs to be reset after dragging complete\r\n        x: 0,\r\n        y: 0,\r\n    };\r\n    let outlinePointerListener = new BB.PointerListener({\r\n        target: outline,\r\n        onPointer: function(event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n\r\n                grips[0].x += dX;\r\n                grips[0].y += dY;\r\n                grips[1].x += dX;\r\n                grips[1].y += dY;\r\n                grips[2].x += dX;\r\n                grips[2].y += dY;\r\n                grips[3].x += dX;\r\n                grips[3].y += dY;\r\n\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n\r\n    let thirdsHorizontal = document.createElement(\"div\");\r\n    BB.css(thirdsHorizontal, {\r\n        position: \"absolute\",\r\n        borderTop: \"1px solid #0ff\",\r\n        borderBottom: \"1px solid #0ff\"\r\n    });\r\n    (thirdsHorizontal as any).update = function () {\r\n        BB.css(thirdsHorizontal, {\r\n            left: (grips[0].x * scale) + \"px\",\r\n            top: ((grips[0].y + (grips[2].y - grips[0].y) / 3) * scale) + \"px\",\r\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\r\n            height: ((grips[2].y - grips[0].y) / 3 * scale) + \"px\"\r\n\r\n        });\r\n    };\r\n    let thirdsVertical = document.createElement(\"div\");\r\n    BB.css(thirdsVertical, {\r\n        position: \"absolute\",\r\n        borderLeft: \"1px solid #0ff\",\r\n        borderRight: \"1px solid #0ff\"\r\n    });\r\n    (thirdsVertical as any).update = function () {\r\n        BB.css(thirdsVertical, {\r\n            left: ((grips[0].x + (grips[2].x - grips[0].x) / 3) * scale) + \"px\",\r\n            top: (grips[0].y * scale) + \"px\",\r\n            width: ((grips[2].x - grips[0].x) / 3 * scale) + \"px\",\r\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\r\n\r\n        });\r\n    };\r\n\r\n    const gripSize = 40;\r\n    const gripOverlay = 10;\r\n\r\n    let grips: {\r\n        x: number; // int\r\n        y: number;\r\n    }[] = [ // aka corner coordinates\r\n        {x: 0, y: 0}, // top left\r\n        {x: width, y: 0}, // top right\r\n        {x: width, y: height}, // bottom right\r\n        {x: 0, y: height}, //bottom left\r\n    ];\r\n\r\n    function transformTop(dY) {\r\n        grips[0].y += dY;\r\n        grips[0].y = Math.max(grips[3].y - maxH, Math.min(grips[3].y - 1, grips[0].y));\r\n        grips[1].y = grips[0].y;\r\n    }\r\n    function transformRight(dX) {\r\n        grips[1].x += dX;\r\n        grips[1].x = Math.min(grips[0].x + maxW, Math.max(grips[0].x + 1, grips[1].x));\r\n        grips[2].x = grips[1].x;\r\n    }\r\n    function transformBottom(dY) {\r\n        grips[2].y += dY;\r\n        grips[2].y = Math.min(grips[1].y + maxH, Math.max(grips[1].y + 1, grips[2].y));\r\n        grips[3].y = grips[2].y;\r\n    }\r\n    function transformLeft(dX) {\r\n        grips[0].x += dX;\r\n        grips[0].x = Math.max(grips[1].x - maxW, Math.min(grips[1].x - 1, grips[0].x));\r\n        grips[3].x = grips[0].x;\r\n    }\r\n\r\n    function commit() {\r\n        pointerRemainder.x = 0;\r\n        pointerRemainder.y = 0;\r\n        callback(getTransform());\r\n    }\r\n\r\n\r\n\r\n\r\n    let edges = [];\r\n    for (let i = 0; i < 4; i++) {\r\n        (function (i) {\r\n            edges[i] = document.createElement(\"div\");\r\n            let g = edges[i];\r\n            g.style.width = gripSize + \"px\";\r\n            g.style.height = gripSize + \"px\";\r\n            //g.style.background = \"#0f0\";\r\n            g.style.position = \"absolute\";\r\n            g.update = function () {\r\n                if (i === 0) { //top\r\n                    g.style.left = (grips[0].x * scale + gripOverlay) + \"px\";\r\n                    g.style.top = (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\";\r\n                    g.style.width = ((grips[1].x - grips[0].x) * scale - gripOverlay * 2) + \"px\";\r\n                    g.style.height = (gripSize * 2) + \"px\";\r\n                } else if (i === 1) { //right\r\n                    g.style.left = (grips[1].x * scale - gripOverlay) + \"px\";\r\n                    g.style.top = (grips[1].y * scale + gripOverlay) + \"px\";\r\n                    g.style.width = (gripSize * 2) + \"px\";\r\n                    g.style.height = ((grips[2].y - grips[1].y) * scale - gripOverlay * 2) + \"px\";\r\n                } else if (i === 2) { //bottom\r\n                    g.style.left = (grips[3].x * scale + gripOverlay) + \"px\";\r\n                    g.style.top = (grips[3].y * scale - gripOverlay) + \"px\";\r\n                    g.style.width = ((grips[2].x - grips[3].x) * scale - gripOverlay * 2) + \"px\";\r\n                    g.style.height = (gripSize * 2) + \"px\";\r\n                } else if (i === 3) { //left\r\n                    g.style.left = (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\";\r\n                    g.style.top = (grips[0].y * scale + gripOverlay) + \"px\";\r\n                    g.style.width = (gripSize * 2) + \"px\";\r\n                    g.style.height = ((grips[3].y - grips[0].y) * scale - gripOverlay * 2) + \"px\";\r\n                }\r\n                let angleOffset = i * 2 + 1;\r\n                g.style.cursor = gripCursors[angleOffset] + \"-resize\";\r\n\r\n            };\r\n        })(i);\r\n    }\r\n\r\n    let darken = [];\r\n    for (let i = 0; i < 4; i++) {\r\n        (function (i) {\r\n            darken[i] = document.createElement(\"div\");\r\n            let g = darken[i];\r\n            g.style.position = \"absolute\";\r\n            g.style.background = \"#000\";\r\n            g.style.opacity = \"0.5\";\r\n            g.update = function () {\r\n                if (i === 0) {\r\n                    g.style.left = (grips[0].x * scale) + \"px\";\r\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\r\n                    g.style.width = ((grips[1].x - grips[0].x) * scale) + \"px\";\r\n                    g.style.height = \"8000px\";\r\n                } else if (i === 1) {\r\n                    g.style.left = (grips[1].x * scale) + \"px\";\r\n                    g.style.top = (grips[1].y * scale - 8000) + \"px\";\r\n                    g.style.width = \"8000px\";\r\n                    g.style.height = 16000 + \"px\";\r\n                } else if (i === 2) {\r\n                    g.style.left = (grips[3].x * scale) + \"px\";\r\n                    g.style.top = (grips[3].y * scale) + \"px\";\r\n                    g.style.width = ((grips[2].x - grips[3].x) * scale) + \"px\";\r\n                    g.style.height = \"8000px\";\r\n                } else if (i === 3) {\r\n                    g.style.left = (grips[0].x * scale - 8000) + \"px\";\r\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\r\n                    g.style.width = \"8000px\";\r\n                    g.style.height = 16000 + \"px\";\r\n                }\r\n\r\n            };\r\n        })(i);\r\n    }\r\n\r\n    let edge0PointerListener = new BB.PointerListener({\r\n        target: edges[0],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformTop(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformBottom(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    let edge1PointerListener = new BB.PointerListener({\r\n        target: edges[1],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformRight(dX);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformLeft(-dX);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    let edge2PointerListener = new BB.PointerListener({\r\n        target: edges[2],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformBottom(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformTop(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    let edge3PointerListener = new BB.PointerListener({\r\n        target: edges[3],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformLeft(dX);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformRight(-dX);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    let cornerElArr = [];\r\n    (function() {\r\n        for (let i = 0; i < 4; i++) {\r\n            (function (i) {\r\n                cornerElArr[i] = document.createElement(\"div\");\r\n                let g = cornerElArr[i];\r\n                BB.css(g, {\r\n                    //background: '#f00',\r\n                    width: (gripSize * 2) + 'px',\r\n                    height: (gripSize * 2) + 'px',\r\n                    position: 'absolute'\r\n                });\r\n                g.style.cursor = ['nwse-resize', 'nesw-resize'][i % 2];\r\n                g.update = function () {\r\n                    if (i === 0) { //top left\r\n                        BB.css(g, {\r\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\r\n                            top: (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\"\r\n                        });\r\n                    } else if (i === 1) { //top right\r\n                        BB.css(g, {\r\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\r\n                            top: (grips[1].y * scale - gripSize * 2 + gripOverlay) + \"px\"\r\n                        });\r\n                    } else if (i === 2) { //bottom right\r\n                        BB.css(g, {\r\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\r\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\r\n                        });\r\n                    } else if (i === 3) { //bottom left\r\n                        BB.css(g, {\r\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\r\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\r\n                        });\r\n                    }\r\n                };\r\n            })(i);\r\n        }\r\n    })();\r\n    //top left\r\n    let corner0PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[0],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformLeft(dX);\r\n                transformTop(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformRight(-dX);\r\n                    transformBottom(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    //top right\r\n    let corner1PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[1],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformRight(dX);\r\n                transformTop(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformLeft(-dX);\r\n                    transformBottom(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    //bottom right\r\n    let corner2PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[2],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformRight(dX);\r\n                transformBottom(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformLeft(-dX);\r\n                    transformTop(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    //bottom left\r\n    let corner3PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[3],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformLeft(dX);\r\n                transformBottom(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformRight(-dX);\r\n                    transformTop(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n\r\n\r\n    function getTransform() {\r\n        grips[1].x -= grips[0].x;\r\n        grips[1].y -= grips[0].y;\r\n        grips[2].x -= grips[0].x;\r\n        grips[2].y -= grips[0].y;\r\n        grips[3].x -= grips[0].x;\r\n        grips[3].y -= grips[0].y;\r\n        x += grips[0].x;\r\n        y += grips[0].y;\r\n        grips[0].x = 0;\r\n        grips[0].y = 0;\r\n        return {\r\n            x: x,\r\n            y: y,\r\n            width: grips[1].x,\r\n            height: grips[2].y\r\n        };\r\n    }\r\n\r\n\r\n    div.append(\r\n        darken[1],\r\n        darken[0],\r\n        darken[2],\r\n        darken[3],\r\n        thirdsHorizontal,\r\n        thirdsVertical,\r\n        outline,\r\n\r\n        edges[1],\r\n        edges[0],\r\n        edges[2],\r\n        edges[3],\r\n\r\n        cornerElArr[0],\r\n        cornerElArr[1],\r\n        cornerElArr[2],\r\n        cornerElArr[3],\r\n    );\r\n\r\n\r\n    function update() {\r\n\r\n        edges[0].update();\r\n        edges[1].update();\r\n        edges[2].update();\r\n        edges[3].update();\r\n        cornerElArr[0].update();\r\n        cornerElArr[1].update();\r\n        cornerElArr[2].update();\r\n        cornerElArr[3].update();\r\n        darken[0].update();\r\n        darken[1].update();\r\n        darken[2].update();\r\n        darken[3].update();\r\n        (outline as any).update();\r\n        (thirdsHorizontal as any).update();\r\n        (thirdsVertical as any).update();\r\n    }\r\n\r\n    update();\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getTransform = getTransform;\r\n\r\n    this.setTransform = function (p) {\r\n        x = p.x;\r\n        y = p.y;\r\n        width = p.width;\r\n        height = p.height;\r\n\r\n        BB.css(div, {\r\n            left: (x * scale) + \"px\",\r\n            top: (y * scale) + \"px\"\r\n        });\r\n\r\n        grips[0].x = 0;\r\n        grips[0].y = 0;\r\n        grips[1].x = width;\r\n        grips[1].y = 0;\r\n        grips[2].x = width;\r\n        grips[2].y = height;\r\n        grips[3].x = 0;\r\n        grips[3].y = height;\r\n\r\n        update();\r\n        commit();\r\n    };\r\n\r\n    this.setScale = function (s) {\r\n        scale = s;\r\n        BB.css(div, {\r\n            left: (x * scale) + \"px\",\r\n            top: (y * scale) + \"px\"\r\n        });\r\n        update();\r\n    };\r\n\r\n    this.showThirds = function (b) {\r\n        if (b) {\r\n            thirdsHorizontal.style.display = \"block\";\r\n            thirdsVertical.style.display = \"block\";\r\n        } else {\r\n            thirdsHorizontal.style.display = \"none\";\r\n            thirdsVertical.style.display = \"none\";\r\n        }\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.destroy = function() {\r\n        keyListener.destroy();\r\n        outlinePointerListener.destroy();\r\n        corner0PointerListener.destroy();\r\n        corner1PointerListener.destroy();\r\n        corner2PointerListener.destroy();\r\n        corner3PointerListener.destroy();\r\n        edge0PointerListener.destroy();\r\n        edge1PointerListener.destroy();\r\n        edge2PointerListener.destroy();\r\n        edge3PointerListener.destroy();\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Previews currently active layer\r\n * thumbnail (hover shows bigger preview), layername, opacity\r\n *\r\n * internally listens to kl history. updates when there's a change.\r\n * but you need to update it when the active layer changed. (different canvas object)\r\n *\r\n * update visibility for performance\r\n *\r\n * p = {\r\n *     onClick: function() // when clicking on layer name\r\n *     klRootEl: klRootEl,\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function LayerPreview(p) {\r\n\r\n    // internally redraws with in an interval. checks history is something changed\r\n    // this update will be animated\r\n    // it will not be animated if the resolution changed\r\n    // also redraws when you call updateLayer - not animated\r\n\r\n    // syncs via updateLayer, and internally updates layer opacity via a hack\r\n\r\n    let div = BB.el({});\r\n    let layerObj;\r\n    let isVisible = true;\r\n    const height = 40;\r\n    const canvasSize = height - 10;\r\n    const largeCanvasSize = 300;\r\n    let lastDrawnState = -2;\r\n    let lastDrawnSize = {\r\n        width: 0,\r\n        height: 0\r\n    };\r\n    let animationCanvas = BB.canvas(); // to help animate the transition\r\n    let animationCanvasCtx = animationCanvas.getContext('2d');\r\n    const animationLength = 30;\r\n    let animationCount = 0; // >0 means it's animating\r\n    let largeCanvasIsVisible = false;\r\n    let largeCanvasAnimationTimeout;\r\n    const largeCanvasAnimationDurationMs = 300;\r\n    let uiState = 'right'; // 'left' | 'right'\r\n\r\n\r\n    // --- setup dom ---\r\n    let contentWrapperEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            height: height + 'px',\r\n            color: '#666',\r\n        }\r\n    });\r\n    let canvasWrapperEl = BB.el({\r\n        css: {\r\n            //background: '#f00',\r\n            minWidth: height + 'px',\r\n            height: height + 'px',\r\n            display: 'flex',\r\n            justifyContent: 'center',\r\n            alignItems: 'center'\r\n        }\r\n    });\r\n    let canvas = BB.canvas(canvasSize, canvasSize);\r\n    let canvasCtx = canvas.getContext('2d');\r\n    canvas.title = LANG('layers-active-layer');\r\n    BB.css(canvas, {\r\n        boxShadow: '0 0 0 1px #9e9e9e',\r\n        colorScheme: 'only light',\r\n    });\r\n    let nameWrapper = BB.el({\r\n        css: {\r\n            //background: '#ff0',\r\n            flexGrow: '1',\r\n            paddingLeft: '10px',\r\n            fontSize: '13px',\r\n            overflow: 'hidden',\r\n            position: 'relative'\r\n        }\r\n    });\r\n    let nameLabelEl = BB.el({\r\n        content: '',\r\n        css: {\r\n            cssFloat: 'left',\r\n            whiteSpace: 'nowrap'\r\n        }\r\n    });\r\n    let nameFadeEl = BB.el({\r\n        css: {\r\n            backgroundImage: 'linear-gradient(to right, rgba(221,221,221,0) 0%, rgba(221,221,221,0.8) 100%)',\r\n            position: 'absolute',\r\n            right: \"0\",\r\n            top: \"0\",\r\n            width: \"50px\",\r\n            height: '100%'\r\n        }\r\n    });\r\n    let clickableEl = BB.el({\r\n        css: {\r\n            //background: 'rgba(0,255,0,0.6)',\r\n            position: 'absolute',\r\n            left: \"10px\",\r\n            top: \"0\",\r\n            width: \"90px\",\r\n            height: '100%'\r\n        }\r\n    });\r\n    if (p.onClick) {\r\n        BB.addEventListener(clickableEl,'click', function() {\r\n            p.onClick();\r\n        });\r\n        BB.addEventListener(canvas,'click', function() {\r\n            p.onClick();\r\n        });\r\n    }\r\n    let opacityEl = BB.el({\r\n        content: LANG('opacity') + '<br>100%',\r\n        css: {\r\n            minWidth: '60px',\r\n            fontSize: '12px',\r\n            textAlign: 'center',\r\n            background: '#dddddd',\r\n            color: '#555'\r\n        }\r\n    });\r\n\r\n    const largeCanvasWrapper = BB.el({\r\n        onClick: BB.handleClick,\r\n        css: {\r\n            pointerEvents: 'none',\r\n            background: '#fff',\r\n            position: 'absolute',\r\n            right: '280px',\r\n            top: '10px',\r\n            border: '1px solid #aaa',\r\n            boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\r\n            transition: 'opacity '+largeCanvasAnimationDurationMs+'ms ease-in-out',\r\n            userSelect: 'none',\r\n            display: 'block',\r\n            webkitTouchCallout: 'none',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    let largeCanvas = BB.canvas(largeCanvasSize, largeCanvasSize);\r\n    largeCanvasWrapper.append(largeCanvas);\r\n    let largeCanvasCtx = largeCanvas.getContext('2d');\r\n    BB.css(largeCanvas, {\r\n        display: 'block',\r\n    });\r\n\r\n    div.appendChild(contentWrapperEl);\r\n    contentWrapperEl.appendChild(canvasWrapperEl);\r\n    canvasWrapperEl.appendChild(canvas);\r\n    contentWrapperEl.appendChild(nameWrapper);\r\n    nameWrapper.appendChild(nameLabelEl);\r\n    nameWrapper.appendChild(nameFadeEl);\r\n    nameWrapper.appendChild(clickableEl);\r\n    contentWrapperEl.appendChild(opacityEl);\r\n\r\n\r\n    let animationCanvasCheckerPattern = animationCanvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\r\n    let largeCanvasCheckerPattern = canvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\r\n\r\n\r\n\r\n    // --- update logic ---\r\n\r\n    // cross-fade done via 2 canvases (old and new state)\r\n    // both have checkerboard background drawn on them, both fully opaque\r\n    // -> no \"lighter\" is needed for accurate cross-fading\r\n\r\n    function animate() {\r\n        if (animationCount === 0) {\r\n            return;\r\n        }\r\n\r\n        animationCount--;\r\n\r\n        canvasCtx.save();\r\n        canvasCtx.globalAlpha = Math.pow((animationLength - animationCount) / animationLength, 2);\r\n        canvasCtx.drawImage(animationCanvas, 0, 0);\r\n        canvasCtx.restore();\r\n\r\n        if (animationCount > 0) {\r\n            requestAnimationFrame(animate);\r\n        }\r\n    }\r\n\r\n    function draw(isInstant) {\r\n\r\n        if (!isVisible) {\r\n            return;\r\n        }\r\n\r\n        nameLabelEl.textContent = layerObj.name;\r\n        opacityEl.innerHTML = LANG('opacity') + '<br>' + Math.round(layerObj.opacity * 100) + '%';\r\n\r\n        let layerCanvas = layerObj.context.canvas;\r\n\r\n        if (layerCanvas.width !== lastDrawnSize.width || layerCanvas.height !== lastDrawnSize.height) {\r\n            let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, canvasSize, canvasSize, 1);\r\n            canvas.width = Math.round(canvasDimensions.width);\r\n            canvas.height = Math.round(canvasDimensions.height);\r\n\r\n            isInstant = true;\r\n        }\r\n\r\n        animationCanvas.width = canvas.width;\r\n        animationCanvas.height = canvas.height;\r\n\r\n        animationCanvasCtx.save();\r\n        animationCanvasCtx.imageSmoothingEnabled = false;\r\n        animationCanvasCtx.fillStyle = animationCanvasCheckerPattern;\r\n        animationCanvasCtx.fillRect(0, 0, animationCanvas.width, animationCanvas.height);\r\n        animationCanvasCtx.drawImage(layerCanvas, 0, 0, animationCanvas.width, animationCanvas.height);\r\n        animationCanvasCtx.restore();\r\n\r\n        if (isInstant) {\r\n            animationCount = 0;\r\n            canvasCtx.save();\r\n            canvasCtx.drawImage(animationCanvas, 0, 0);\r\n            canvasCtx.restore();\r\n\r\n        } else {\r\n            animationCount = animationLength;\r\n            animate();\r\n\r\n        }\r\n\r\n        drawLargeCanvas();\r\n\r\n        lastDrawnState = klHistory.getState();\r\n        lastDrawnSize.width = layerCanvas.width;\r\n        lastDrawnSize.height = layerCanvas.height;\r\n    }\r\n\r\n    function update() {\r\n        draw(true);\r\n    }\r\n\r\n    setInterval(function() {\r\n\r\n        if (!layerObj) {\r\n            return;\r\n        }\r\n\r\n        let currentState = klHistory.getState();\r\n        if (currentState === lastDrawnState) {\r\n            return;\r\n        }\r\n\r\n        //update opacity w hack\r\n        layerObj.opacity = layerObj.context.canvas.opacity;\r\n\r\n        draw(false);\r\n\r\n    }, 2000);\r\n\r\n\r\n    //is always instant\r\n    function drawLargeCanvas() {\r\n\r\n        if (!largeCanvasIsVisible || !layerObj) {\r\n            return;\r\n        }\r\n\r\n        let layerCanvas = layerObj.context.canvas;\r\n\r\n        let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, largeCanvasSize, largeCanvasSize, 1);\r\n        largeCanvas.width = Math.round(canvasDimensions.width);\r\n        largeCanvas.height = Math.round(canvasDimensions.height);\r\n        largeCanvasCtx.save();\r\n        if (largeCanvas.width > layerCanvas.width) {\r\n            largeCanvasCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            largeCanvasCtx.imageSmoothingEnabled = true;\r\n            largeCanvasCtx.imageSmoothingQuality = 'high';\r\n        }\r\n        largeCanvasCtx.fillStyle = largeCanvasCheckerPattern;\r\n        largeCanvasCtx.fillRect(0, 0, largeCanvas.width, largeCanvas.height);\r\n        largeCanvasCtx.drawImage(layerCanvas, 0, 0, largeCanvas.width, largeCanvas.height);\r\n        largeCanvasCtx.restore();\r\n\r\n        const bounds = div.getBoundingClientRect();\r\n        BB.css(largeCanvasWrapper, {\r\n            top: Math.max(10, (bounds.top + height / 2 - largeCanvas.height / 2)) + \"px\"\r\n        });\r\n\r\n    }\r\n\r\n    function removeLargeCanvas() {\r\n        try {\r\n            p.klRootEl.removeChild(largeCanvasWrapper);\r\n        } catch(e) {\r\n\r\n        }\r\n    }\r\n\r\n    function showLargeCanvas(b) {\r\n        if (largeCanvasIsVisible === b) {\r\n            return;\r\n        }\r\n\r\n        clearTimeout(largeCanvasAnimationTimeout);\r\n        largeCanvasIsVisible = b;\r\n\r\n        if (b) {\r\n            largeCanvasAnimationTimeout = setTimeout(function() {\r\n                drawLargeCanvas();\r\n                largeCanvasWrapper.style.opacity = '0';\r\n                p.klRootEl.appendChild(largeCanvasWrapper);\r\n                setTimeout(function() {\r\n                    largeCanvasWrapper.style.opacity = '1';\r\n                }, 20);\r\n            }, 250);\r\n\r\n        } else {\r\n            largeCanvasWrapper.style.opacity = '0';\r\n            largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\r\n        }\r\n\r\n    }\r\n\r\n    let pointerListener = new BB.PointerListener({\r\n        target: canvas,\r\n        onEnterLeave: function(b) {\r\n            showLargeCanvas(b);\r\n        }\r\n    });\r\n\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(b) {\r\n        if (isVisible === b) {\r\n            return;\r\n        }\r\n        isVisible = b;\r\n        contentWrapperEl.style.display = isVisible ? 'flex' : 'none';\r\n        div.style.marginBottom = isVisible ? '' : '10px';\r\n\r\n        let currentState = klHistory.getState();\r\n        if (b && lastDrawnState !== currentState) {\r\n            update();\r\n        }\r\n    };\r\n\r\n    //when the layer might have changed\r\n    this.setLayer = function(klCanvasLayerObj) {\r\n        layerObj = klCanvasLayerObj;\r\n        update();\r\n    };\r\n\r\n    this.setUiState = function(stateStr) {\r\n        uiState = '' + stateStr;\r\n\r\n        if (uiState === 'left') {\r\n            BB.css(largeCanvasWrapper, {\r\n                left: '280px',\r\n                right: ''\r\n            });\r\n        } else {\r\n            BB.css(largeCanvasWrapper, {\r\n                left: '',\r\n                right: '280px'\r\n            });\r\n        }\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * fits image into a size\r\n * params: {\r\n *    image: image,\r\n *    width: int,\r\n *    height: int\r\n * }\r\n *\r\n * methods:\r\n * getDiv()\r\n *\r\n * @param params\r\n * @constructor\r\n */\r\nexport function FittedImage(params) {\r\n    let fit = BB.fitInto(params.image.width, params.image.height, params.width, params.height, 1);\r\n    let w = parseInt('' + fit.width);\r\n    let h = parseInt('' + fit.height);\r\n\r\n    let canvas = BB.canvas(w, h);\r\n\r\n    canvas.getContext(\"2d\").drawImage(params.image, 0, 0, w, h);\r\n    BB.css(canvas, {\r\n        display: \"block\",\r\n        boxShadow: \"0 0 0 1px #aaa\"\r\n    });\r\n\r\n    this.getElement = function() {\r\n        return canvas;\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\nimport {FreeTransformCanvas} from '../components/free-transform-canvas';\r\nimport {popup} from './popup';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {IKlBasicLayer} from '../../kl.types';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showImportAsLayerDialog(\r\n    params: {\r\n        target: HTMLElement;\r\n        klCanvas: KlCanvas;\r\n        importImage: HTMLImageElement | HTMLCanvasElement;\r\n        callback: (\r\n            p?: {x: number, y: number, width:number, height: number, angleDeg: number},\r\n            isPixelated?: boolean\r\n        ) => void;\r\n    }\r\n): void {\r\n\r\n    let div = document.createElement(\"div\");\r\n    BB.appendTextDiv(div, LANG('import-as-layer-description'));\r\n    if (params.klCanvas.isLayerLimitReached()) {\r\n        let noteEl = BB.el({\r\n            content: LANG('import-as-layer-limit-reached'),\r\n            css: {\r\n                background: '#ff0',\r\n                padding: '10px',\r\n                marginTop: '5px',\r\n                marginBottom: '5px',\r\n                border: '1px solid #e7d321',\r\n                borderRadius: '5px'\r\n            }\r\n        });\r\n        div.appendChild(noteEl);\r\n    }\r\n    let isSmall = window.innerWidth < 550;\r\n\r\n    let buttonRowEl = BB.el({\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n    let originalSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: '1:1',\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function() {\r\n            freeTransformCanvas.reset();\r\n        }\r\n    });\r\n    let fitSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('import-as-layer-fit'),\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function() {\r\n            freeTransformCanvas.setTransformFit();\r\n        }\r\n    });\r\n    let centerBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('center'),\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function() {\r\n            freeTransformCanvas.setTransformCenter();\r\n        }\r\n    });\r\n    buttonRowEl.appendChild(originalSizeBtn);\r\n    buttonRowEl.appendChild(fitSizeBtn);\r\n    buttonRowEl.appendChild(centerBtn);\r\n    div.appendChild(buttonRowEl);\r\n\r\n\r\n\r\n    let layers: IKlBasicLayer[] = [];\r\n    {\r\n        let klCanvasLayerArr = params.klCanvas.getLayers();\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            layers.push({\r\n                image: klCanvasLayerArr[i].context.canvas,\r\n                opacity: klCanvasLayerArr[i].opacity,\r\n                mixModeStr: klCanvasLayerArr[i].mixModeStr\r\n            });\r\n        }\r\n    }\r\n    layers.push({\r\n        image: params.importImage,\r\n        opacity: 1,\r\n        mixModeStr: 'source-over'\r\n    });\r\n\r\n\r\n    let freeTransformCanvas = new FreeTransformCanvas({\r\n        elementWidth: isSmall ? 340 : 540,\r\n        elementHeight: isSmall ? 280 : 350,\r\n        imageWidth: params.klCanvas.getLayerContext(0).canvas.width,\r\n        imageHeight: params.klCanvas.getLayerContext(0).canvas.height,\r\n        layers: layers,\r\n        transformIndex: layers.length - 1,\r\n    });\r\n    BB.css(freeTransformCanvas.getElement(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n    });\r\n    div.appendChild(freeTransformCanvas.getElement());\r\n\r\n    function move(x, y) {\r\n        freeTransformCanvas.move(x, y);\r\n    }\r\n\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr) {\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    popup({\r\n        target: params.target,\r\n        message: `<b>${LANG('import-as-layer-title')}</b>`,\r\n        div: div,\r\n        style: isSmall ? null : {\r\n            width: '500px'\r\n        },\r\n        buttons: [\"Ok\", \"Cancel\"],\r\n        clickOnEnter: 'Ok',\r\n        callback: function(buttonStr) {\r\n            keyListener.destroy();\r\n            freeTransformCanvas.destroy();\r\n            BB.destroyEl(originalSizeBtn);\r\n            BB.destroyEl(fitSizeBtn);\r\n            BB.destroyEl(centerBtn);\r\n            if (buttonStr === 'Ok') {\r\n                params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\r\n            } else {\r\n                params.callback();\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Not really generalized. UI when you drag/drop an image into window.\r\n * The moment you create it, it will listen.\r\n *\r\n * @param p object {onDrop: func(files, optionStr), target: DOM Element, enabledTest: func -> bool} - optionStr: 'default'|'layer'|'image'\r\n * @constructor\r\n */\r\nexport function KlImageDropper(p) {\r\n\r\n    //set up DOM\r\n    let rootEl = BB.el({\r\n        content: 'Drop to import',\r\n        css: {\r\n            paddingTop: '100px',\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n            background: 'rgba(50, 50, 50, 0.7)',\r\n            color: '#fff',\r\n            textShadow: '2px 2px #000',\r\n            textAlign: 'center',\r\n            fontSize: '25px'\r\n        }\r\n    });\r\n    let wrapperEl = BB.el({\r\n        css: {\r\n            'marginTop': '50px',\r\n            'display': 'flex',\r\n            'justifyContent': 'center'\r\n        }\r\n    });\r\n    let optionStyle = {\r\n        width: '200px',\r\n        padding: '50px',\r\n        margin: '10px',\r\n        //opacity: 0.5,\r\n        borderRadius: '20px',\r\n        border: '1px dashed #fff',\r\n        background: '#00aefe',\r\n        fontWeight: 'bold'\r\n    };\r\n    let optionLayerEl = BB.el({\r\n        content: 'As Layer',\r\n        css: optionStyle\r\n    });\r\n    let optionImageEl = BB.el({\r\n        content: 'As New Image',\r\n        css: optionStyle\r\n    });\r\n\r\n    rootEl.appendChild(wrapperEl);\r\n    wrapperEl.appendChild(optionLayerEl);\r\n    wrapperEl.appendChild(optionImageEl);\r\n\r\n\r\n    let rootCounter = 0;\r\n    let optionLayerCounter = 0;\r\n    let optionImageCounter = 0;\r\n\r\n    function destroy() {\r\n        rootCounter = 0;\r\n        optionLayerCounter = 0;\r\n        optionImageCounter = 0;\r\n        try {\r\n            p.target.removeChild(rootEl);\r\n        } catch (e) { }\r\n    }\r\n\r\n    function testAcceptType(event) {\r\n        try {\r\n            return !event.dataTransfer.types.includes('text/plain');\r\n        } catch(e) {\r\n\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function updateOptions() {\r\n        let boxShadow = '0 0 20px 4px #fff';\r\n        if (optionLayerCounter > 0) {\r\n            optionLayerEl.style.boxShadow = boxShadow;\r\n            optionImageEl.style.boxShadow = '';\r\n        } else if (optionImageCounter > 0) {\r\n            optionLayerEl.style.boxShadow = '';\r\n            optionImageEl.style.boxShadow = boxShadow;\r\n        } else {\r\n            optionLayerEl.style.boxShadow = '';\r\n            optionImageEl.style.boxShadow = '';\r\n        }\r\n    }\r\n\r\n    BB.addEventListener(optionLayerEl,'dragenter', function() {\r\n        optionLayerCounter++;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionLayerEl,'dragleave', function() {\r\n        optionLayerCounter--;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionImageEl,'dragenter', function() {\r\n        optionImageCounter++;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionImageEl,'dragleave', function() {\r\n        optionImageCounter--;\r\n        updateOptions();\r\n    });\r\n\r\n\r\n    function rootDragOver(event) {\r\n        if (!testAcceptType(event)) {\r\n            return;\r\n        }\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n    }\r\n    function rootDragEnter(event) {\r\n        if (!p.enabledTest() || !testAcceptType(event)) {\r\n            return;\r\n        }\r\n        if (rootCounter === 0) {\r\n            p.target.appendChild(rootEl);\r\n        }\r\n        rootCounter++;\r\n\r\n    }\r\n    function rootDragLeave(event) {\r\n        if (!testAcceptType(event) || rootCounter === 0) {\r\n            return;\r\n        }\r\n        rootCounter = Math.max(0, rootCounter - 1);\r\n        if (rootCounter === 0) {\r\n            p.target.removeChild(rootEl);\r\n        }\r\n\r\n    }\r\n    function rootDrop(event) {\r\n        if (!testAcceptType(event) || event.dataTransfer.files.length === 0) {\r\n            destroy();\r\n            return;\r\n        }\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n\r\n        let optionStr = 'default';\r\n        if (optionLayerCounter > 0) {\r\n            optionStr = 'layer';\r\n        } else if (optionImageCounter > 0) {\r\n            optionStr = 'image';\r\n        }\r\n\r\n        p.onDrop(event.dataTransfer.files, optionStr);\r\n\r\n\r\n        if (rootCounter > 0) {\r\n            p.target.removeChild(rootEl);\r\n        }\r\n        rootCounter = 0;\r\n        optionLayerCounter = 0;\r\n        optionImageCounter = 0;\r\n        updateOptions();\r\n    }\r\n\r\n    BB.addEventListener(window,'dragover', rootDragOver, false);\r\n    BB.addEventListener(window,'dragenter', rootDragEnter, false);\r\n    BB.addEventListener(window,'dragleave', rootDragLeave, false);\r\n    BB.addEventListener(window,'drop', rootDrop, false);\r\n\r\n    // if something goes wrong and you're stuck with overlay\r\n    BB.addEventListener(rootEl, 'pointerdown', function() {\r\n        destroy();\r\n    });\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr) {\r\n            if (rootCounter > 0 && keyStr === 'esc') {\r\n                destroy();\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KlSmallColorSlider} from '../base-components/kl-color-slider-small';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {BrushSettingService} from '../../brushes-ui/brush-setting-service';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Compressed HUD toolspace. When you hold ctrl+alt.\r\n * small color picker, brush settings\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function OverlayToolspace(\r\n    p: {\r\n        brushSettingService: BrushSettingService; // to sync with outside\r\n        enabledTest: () => boolean; // calls to see if it's allowed to show\r\n    }\r\n) {\r\n\r\n    const sizeObj = {\r\n        width: 150,\r\n        svHeight: 90,\r\n        hHeight: 20,\r\n        sliderHeight: 25\r\n    };\r\n\r\n    let isVisible = false;\r\n    const div = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            left: '500px',\r\n            top: '500px',\r\n            background: 'rgb(221, 221, 221)',\r\n            display: 'none',\r\n            border: '1px solid #fff',\r\n            boxShadow: '0 0 10px rgba(0,0,0,0.5)',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    const queuedObj = {\r\n        color: null,\r\n        size: null,\r\n        opacity: null\r\n    };\r\n\r\n\r\n    // --- inputs ---\r\n\r\n    //color selection\r\n    const colorSlider = new KlSmallColorSlider({\r\n        width: sizeObj.width,\r\n        heightSV: sizeObj.svHeight,\r\n        heightH: sizeObj.hHeight,\r\n        color: p.brushSettingService.getColor(),\r\n        callback: function (rgbObj) {\r\n            selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\r\n            p.brushSettingService.setColor(rgbObj, subscriptionFunc);\r\n        }\r\n    });\r\n    const selectedColorEl = BB.el({\r\n        css: {\r\n            width: sizeObj.width + 'px',\r\n            height: sizeObj.hHeight + 'px',\r\n            pointerEvents: 'none'\r\n        }\r\n    });\r\n    {\r\n        const initialColor = p.brushSettingService.getColor();\r\n        selectedColorEl.style.backgroundColor = \"rgb(\" + initialColor.r + \",\" + initialColor.g + \",\" + initialColor.b + \")\";\r\n    }\r\n\r\n    div.appendChild(selectedColorEl);\r\n    div.appendChild(colorSlider.getElement());\r\n\r\n\r\n    function updateColor(rgbObj) {\r\n        colorSlider.setColor(rgbObj);\r\n        selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    //brushsize slider\r\n\r\n    const sizeSlider = new KlSlider({\r\n        label: LANG('brush-size'),\r\n        width: sizeObj.width,\r\n        height: sizeObj.sliderHeight,\r\n        min: 0,\r\n        max: 500,\r\n        value: 50,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        toDisplayValue: (val) => val * 2,\r\n        toValue: (displayValue) => displayValue / 2,\r\n        onChange: function(v) {\r\n            p.brushSettingService.setSize(v);\r\n        },\r\n        formatFunc: (displayValue) => {\r\n            if (displayValue < 10) {\r\n                return BB.round(displayValue, 1);\r\n            } else {\r\n                return Math.round(displayValue);\r\n            }\r\n        },\r\n    });\r\n    BB.css(sizeSlider.getElement(), {\r\n        marginTop: '2px'\r\n    });\r\n    div.appendChild(sizeSlider.getElement());\r\n\r\n    const opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: sizeObj.width,\r\n        height: sizeObj.sliderHeight,\r\n        min: 0,\r\n        max: 1,\r\n        value: 1,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        toDisplayValue: (val) => val * 100,\r\n        toValue: (displayValue) => displayValue / 100,\r\n        onChange: function(v) {\r\n            p.brushSettingService.setOpacity(v);\r\n        },\r\n    });\r\n    BB.css(opacitySlider.getElement(), {\r\n        margin: '2px 0'\r\n    });\r\n    div.appendChild(opacitySlider.getElement());\r\n\r\n\r\n\r\n    // --- general setup ---\r\n\r\n    const subscriptionFunc = function(event) {\r\n        if (event.type === 'color') {\r\n            if (!isVisible) {\r\n                queuedObj.color = event.value;\r\n            } else {\r\n                updateColor(event.value);\r\n            }\r\n        }\r\n        if (event.type === 'size') {\r\n            if (!isVisible) {\r\n                queuedObj.size = event.value;\r\n            } else {\r\n                sizeSlider.setValue(event.value);\r\n            }\r\n        }\r\n        if (event.type === 'opacity') {\r\n            if (!isVisible) {\r\n                queuedObj.opacity = event.value;\r\n            } else {\r\n                opacitySlider.setValue(event.value);\r\n            }\r\n        }\r\n        if (event.type === 'sliderConfig') {\r\n            sizeSlider.update(event.value.sizeSlider);\r\n            opacitySlider.update(event.value.opacitySlider);\r\n        }\r\n    };\r\n    p.brushSettingService.subscribe(subscriptionFunc);\r\n    {\r\n        const sliderConfig = p.brushSettingService.getSliderConfig();\r\n        sizeSlider.update(sliderConfig.sizeSlider);\r\n        opacitySlider.update(sliderConfig.opacitySlider);\r\n        sizeSlider.setValue(p.brushSettingService.getSize());\r\n        opacitySlider.setValue(p.brushSettingService.getOpacity());\r\n    }\r\n\r\n    function updateUI() {\r\n\r\n        // unfocus manual slider input\r\n        BB.unfocusAnyInput();\r\n\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible && mousePos) {\r\n            div.style.left = (mousePos.x - Math.round(sizeObj.width / 2)) + 'px';\r\n            div.style.top = (mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2)) + 'px';\r\n        }\r\n    }\r\n\r\n    let mousePos = null;\r\n    BB.addEventListener(document, 'pointermove', function(event) {\r\n        mousePos = {\r\n            x: event.pageX,\r\n            y: event.pageY,\r\n        };\r\n    });\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, event, comboStr, isRepeat) {\r\n            if (isRepeat) {\r\n                return;\r\n            }\r\n            if (isVisible) {\r\n                isVisible = false;\r\n                updateUI();\r\n                return;\r\n            }\r\n\r\n            if (!p.enabledTest() || !mousePos) {\r\n                return;\r\n            }\r\n\r\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(comboStr)) {\r\n                event.preventDefault();\r\n                isVisible = true;\r\n\r\n                if (queuedObj.color !== null) {\r\n                    updateColor(queuedObj.color);\r\n                    queuedObj.color = null;\r\n                }\r\n                if (queuedObj.size !== null) {\r\n                    sizeSlider.setValue(queuedObj.size);\r\n                    queuedObj.size = null;\r\n                }\r\n                if (queuedObj.opacity !== null) {\r\n                    opacitySlider.setValue(queuedObj.opacity);\r\n                    queuedObj.opacity = null;\r\n                }\r\n\r\n                updateUI();\r\n            }\r\n\r\n        },\r\n        onUp: function(keyStr, event, oldComboStr) {\r\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(oldComboStr) && isVisible) {\r\n                isVisible = false;\r\n                colorSlider.end();\r\n                updateUI();\r\n            }\r\n        },\r\n        onBlur: function() {\r\n            if (isVisible) {\r\n                isVisible = false;\r\n                colorSlider.end();\r\n                updateUI();\r\n            }\r\n        }\r\n    });\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * Topmost row of buttons in toolspace (with the app logo)\r\n *\r\n * p = { // button click callbacks\r\n *      logoImg: img,\r\n *     onLogo: function(),\r\n *     onNew: function(),\r\n *     onImport: function(),\r\n *     onSave: function(),\r\n *     onShare: function(),\r\n *     onHelp: function()\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceTopRow(p) {\r\n    let div = document.createElement('div');\r\n    BB.css(div, {\r\n        height: '36px',\r\n        //background: '#f00',\r\n        display: 'flex',\r\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n    });\r\n\r\n    function createButton(p) {\r\n        let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n        let result = BB.el({\r\n            className: 'toolspace-row-button nohighlight',\r\n            title: p.title,\r\n            onClick: p.onClick,\r\n            css: {\r\n                padding: p.contain ? padding + 'px 0' : ''\r\n            }\r\n        });\r\n        let im = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: p.contain ? 'contain' : '',\r\n                //filter: 'grayscale(1)',\r\n                height: '100%'\r\n            }\r\n        });\r\n        im.style.pointerEvents = 'none';\r\n        result.appendChild(im);\r\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: result,\r\n            onEnterLeave: function(isOver) {\r\n                result.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n        return result;\r\n    }\r\n\r\n    let logoButton = createButton({\r\n        onClick: p.onLogo,\r\n        title: LANG('home'),\r\n        image: p.logoImg ? p.logoImg : klecksLogoImg,\r\n        contain: true\r\n    });\r\n    logoButton.style.width = '45px';\r\n    logoButton.style.borderRight = '1px solid rgb(212, 212, 212)';\r\n    let newButton = createButton({\r\n        onClick: p.onNew,\r\n        title: LANG('file-new'),\r\n        image: newImageImg,\r\n        extraPadding: 1,\r\n        contain: true\r\n    });\r\n    let importButton = createButton({\r\n        onClick: p.onImport,\r\n        title: LANG('file-import'),\r\n        image: importImg,\r\n        extraPadding: 1,\r\n        contain: true\r\n    });\r\n    let saveButton = createButton({\r\n        onClick: p.onSave,\r\n        title: LANG('file-save'),\r\n        image: exportImg,\r\n        extraPadding: 1,\r\n        contain: true\r\n    });\r\n\r\n    let shareButton = null;\r\n    if (BB.canShareFiles()) {\r\n        shareButton = createButton({\r\n            onClick: p.onShare,\r\n            title: LANG('file-share'),\r\n            image: shareImg,\r\n            contain: true\r\n        });\r\n    }\r\n    let helpButton = createButton({\r\n        onClick: p.onHelp,\r\n        title: LANG('help'),\r\n        image: helpImg,\r\n        contain: true\r\n    });\r\n\r\n    div.appendChild(logoButton);\r\n    div.appendChild(newButton);\r\n    div.appendChild(importButton);\r\n    div.appendChild(saveButton);\r\n    if (shareButton) {\r\n        div.appendChild(shareButton);\r\n    }\r\n    div.appendChild(helpButton);\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    }\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eHdqz\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3x5dR\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hbDTd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"16iGk\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2ME3z\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hZnSk\");","import {BB} from '../../../bb/bb';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n// @ts-ignore\r\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\r\n// @ts-ignore\r\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\r\n// @ts-ignore\r\nimport toolGradientImg from 'url:~/src/app/img/ui/tool-gradient.svg';\r\n// @ts-ignore\r\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\r\n// @ts-ignore\r\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\r\n// @ts-ignore\r\nimport caretDownImg from 'url:~/src/app/img/ui/caret-down.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Toolrow Dropdown. The button where you select: brush, fill, select, transform, etc.\r\n *\r\n * p = {\r\n *     onChange: func(activeStr)\r\n * }\r\n *\r\n * activeStr = 'draw' | 'fill' | 'text' | 'shape' | 'gradient'\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolDropdown(p) {\r\n\r\n    let optionArr = ['draw', 'fill', 'gradient', 'text', 'shape'];\r\n    let imArr = [\r\n        toolPaintImg,\r\n        toolFillImg,\r\n        toolGradientImg,\r\n        toolTextImg,\r\n        toolShapeImg\r\n    ];\r\n    let titleArr = [\r\n        `${LANG('tool-brush')} [B]`,\r\n        `${LANG('tool-paint-bucket')} [G]`,\r\n        `${LANG('tool-gradient')} [G]`,\r\n        `${LANG('tool-text')} [T]`,\r\n        `${LANG('tool-shape')} [U]`,\r\n    ];\r\n    let currentActiveIndex = 0;\r\n    let isActive = true;\r\n    let isOpen = false;\r\n\r\n    //preload images\r\n    setTimeout(function() {\r\n        for (let i = 1; i < imArr.length; i++) {\r\n            let im = new Image();\r\n            im.src = imArr[i];\r\n        }\r\n    }, 100);\r\n\r\n    let smallMargin = '6px 0';\r\n    let div = BB.el({\r\n        css: {\r\n            position: 'relative',\r\n            flexGrow: '1'\r\n        }\r\n    });\r\n\r\n    let openTimeout;\r\n    let isDragging = false;\r\n    let startX, startY;\r\n    let pointerListener;\r\n    if (BB.hasPointerEvents) {\r\n        pointerListener = new BB.PointerListener({\r\n            target: div,\r\n            maxPointers: 1,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown') {\r\n                    if (isOpen) {\r\n                        return;\r\n                    }\r\n\r\n                    openTimeout = setTimeout(function() {\r\n                        showDropdown();\r\n                    }, 400);\r\n                    isDragging = true;\r\n                    startX = event.pageX;\r\n                    startY = event.pageY;\r\n\r\n                } else if (event.type === 'pointermove') {\r\n                    if (isDragging && !isOpen && BB.dist(startX, startY, event.pageX, event.pageY) > 5) {\r\n                        clearTimeout(openTimeout);\r\n                        showDropdown();\r\n                    }\r\n\r\n                } else if (event.type === 'pointerup') {\r\n                    clearTimeout(openTimeout);\r\n                    if (isOpen && isDragging) {\r\n                        let target = document.elementFromPoint(event.pageX, event.pageY);\r\n                        for (let i = 0; i < dropdownBtnArr.length; i++) {\r\n                            if (target === dropdownBtnArr[i].wrapper) {\r\n                                closeDropdown();\r\n                                isActive = true;\r\n                                currentActiveIndex = i;\r\n                                updateButton();\r\n                                p.onChange(optionArr[currentActiveIndex]);\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                    isDragging = false;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    let activeButton = BB.el({\r\n        parent: div,\r\n        className: 'toolspace-row-button nohighlight toolspace-row-button-activated',\r\n        title: titleArr[currentActiveIndex],\r\n        onClick: function(e) {\r\n            if (isActive && !isOpen) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                showDropdown();\r\n                return;\r\n            }\r\n\r\n            isActive = true;\r\n            p.onChange(optionArr[currentActiveIndex]);\r\n            if (isOpen) {\r\n                closeDropdown();\r\n            }\r\n        },\r\n        css: {\r\n            padding: '10px 0',\r\n            pointerEvents: 'auto',\r\n            height: '100%',\r\n            boxSizing: 'border-box'\r\n        }\r\n    });\r\n\r\n    let activeButtonIm = BB.el({\r\n        parent: activeButton,\r\n        css: {\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            backgroundSize: 'contain',\r\n            width: 'calc(100% - 7px)',\r\n            height: '100%',\r\n            pointerEvents: 'none',\r\n            opacity: '0.75',\r\n        }\r\n    });\r\n\r\n    let arrowButton = BB.el({\r\n        parent: activeButton,\r\n        css: {\r\n            position: 'absolute',\r\n            right: '1px',\r\n            bottom: '1px',\r\n            width: '18px',\r\n            height: '18px',\r\n            //background: '#aaa',\r\n            //borderRadius: '2px',\r\n            cursor: 'pointer',\r\n\r\n            backgroundImage: 'url(\\'' + caretDownImg + '\\')',\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            backgroundSize: '60%'\r\n        },\r\n        title: 'More Tools',\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            showDropdown();\r\n        }\r\n    });\r\n\r\n\r\n    let overlay = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            //background: 'rgba(255,0,0,0.5)',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0'\r\n        }\r\n    });\r\n    let overlayPointerListener = new BB.PointerListener({\r\n        target: overlay,\r\n        pointers: 1,\r\n        onPointer: function(e) {\r\n            if (e.type === 'pointerdown') {\r\n                e.eventPreventDefault();\r\n                closeDropdown();\r\n            }\r\n        }\r\n    });\r\n\r\n    let dropdownWrapper = BB.el({\r\n        className: 'tool-dropdown-wrapper',\r\n        css: {\r\n            position: 'absolute',\r\n            width: '100%',\r\n            height: (100 * (optionArr.length - 1)) + '%',\r\n            top: '100%',\r\n            left: '0',\r\n            zIndex: '1',\r\n            boxSizing: 'border-box',\r\n            cursor: 'pointer',\r\n            transition: 'height 0.1s ease-in-out, opacity 0.1s ease-in-out',\r\n            borderBottomLeftRadius: '5px',\r\n            borderBottomRightRadius: '5px',\r\n            overflow: 'hidden',\r\n        }\r\n    });\r\n\r\n    let dropdownBtnArr = [];\r\n\r\n    function createDropdownButton(p) {\r\n        let result = {};\r\n\r\n        let wrapper = BB.el({\r\n            parent: dropdownWrapper,\r\n            className: 'tool-dropdown-button',\r\n            title: p.title,\r\n            css: {\r\n                padding: '10px 0',\r\n                height: (100 / (optionArr.length - 1)) + '%',\r\n                boxSizing: 'border-box'\r\n            },\r\n            onClick: function(e) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                p.onClick(p.index, p.id);\r\n            }\r\n        });\r\n        (result as any).wrapper = wrapper;\r\n        let im = BB.el({\r\n            parent: wrapper,\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: 'contain',\r\n                height: '100%',\r\n                pointerEvents: 'none',\r\n                opacity: '0.75'\r\n            }\r\n        });\r\n\r\n        // --- interface ---\r\n        (result as any).show = function(b) {\r\n            wrapper.style.display = b ? 'block' : 'none';\r\n        };\r\n\r\n        (result as any).setIsSmall = function(b) {\r\n            wrapper.style.padding = b ? smallMargin : '10px 0';\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    function onClickDropdownBtn(index, id) {\r\n        closeDropdown();\r\n\r\n        isActive = true;\r\n        currentActiveIndex = index;\r\n\r\n        updateButton();\r\n\r\n        p.onChange(optionArr[currentActiveIndex]);\r\n    }\r\n\r\n    for (let i = 0; i < optionArr.length; i++) {\r\n        dropdownBtnArr.push(createDropdownButton({\r\n            index: i,\r\n            id: optionArr[i],\r\n            image: imArr[i],\r\n            title: titleArr[i],\r\n            onClick: onClickDropdownBtn\r\n        }));\r\n    }\r\n\r\n    function showDropdown() {\r\n        dialogCounter.increase(0.5);\r\n        isOpen = true;\r\n\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            dropdownBtnArr[i].show(currentActiveIndex !== i);\r\n        }\r\n\r\n        arrowButton.style.display = 'none';\r\n        div.style.zIndex = '1';\r\n        document.body.appendChild(overlay);\r\n        div.appendChild(dropdownWrapper);\r\n    }\r\n\r\n    function closeDropdown() {\r\n        dialogCounter.decrease(0.5);\r\n        isOpen = false;\r\n        arrowButton.style.removeProperty('display');\r\n        div.style.removeProperty('z-index');\r\n        document.body.removeChild(overlay);\r\n\r\n        div.removeChild(dropdownWrapper);\r\n    }\r\n\r\n    function updateButton() {\r\n        activeButton.title = titleArr[currentActiveIndex];\r\n        activeButtonIm.style.backgroundImage = 'url(\\'' + imArr[currentActiveIndex] + '\\')';\r\n    }\r\n    updateButton();\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.setIsSmall = function(b) {\r\n        activeButton.style.padding = b ? smallMargin : '10px 0';\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            dropdownBtnArr[i].setIsSmall(b);\r\n        }\r\n        if (b) {\r\n            arrowButton.style.width = '14px';\r\n            arrowButton.style.height = '14px';\r\n        } else {\r\n            arrowButton.style.width = '18px';\r\n            arrowButton.style.height = '18px';\r\n        }\r\n    };\r\n\r\n    this.setActive = function(activeStr) {\r\n        if (optionArr.includes(activeStr)) {\r\n            isActive = true;\r\n            for (let i = 0; i < optionArr.length; i++) {\r\n                if (optionArr[i] === activeStr) {\r\n                    currentActiveIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n            activeButton.classList.add('toolspace-row-button-activated');\r\n            updateButton();\r\n        } else {\r\n            isActive = false;\r\n            activeButton.classList.remove('toolspace-row-button-activated');\r\n        }\r\n    };\r\n\r\n    this.getActive = function() {\r\n        return optionArr[currentActiveIndex];\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6mHrC\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hS5Hj\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"4KGfM\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"doX4v\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7NqHO\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dz3mY\");","import {BB} from '../../../bb/bb';\r\nimport {ToolDropdown} from './tool-dropdown';\r\n// @ts-ignore\r\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\r\n// @ts-ignore\r\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\r\n// @ts-ignore\r\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\r\n// @ts-ignore\r\nimport toolUndoImg from 'url:~/src/app/img/ui/tool-undo.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * Row of buttons in toolspace. image-operations (draw, hand), zoom, undo/redo\r\n * Need to do syncing. So tool is correct, and zoom/undo/redo buttons are properly enabled/disabled\r\n * heights: 54px tall, 36px small -> via setIsSmall\r\n *\r\n * p = {\r\n *     onActivate: function(activeStr), // clicking on tool button - activating it\r\n *     onZoomIn: function(),\r\n *     onZoomOut: function(),\r\n *     onUndo: function(),\r\n *     onRedo: function(),\r\n * }\r\n *\r\n * activeStr = 'draw' | 'hand' | 'fill' | 'text'\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceToolRow(p) {\r\n    let div = document.createElement('div');\r\n    BB.css(div, {\r\n        height: '54px',\r\n        //height: '36px',\r\n        display: 'flex',\r\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n    });\r\n\r\n    let currentActiveStr = 'draw'; // 'draw' | 'hand' | 'fill'\r\n\r\n    function setActive(activeStr, doEmit?) {\r\n        if (currentActiveStr === activeStr) {\r\n            return;\r\n        }\r\n\r\n        currentActiveStr = activeStr;\r\n\r\n        toolDropdown.setActive(currentActiveStr);\r\n        handButton.classList.toggle('toolspace-row-button-activated', currentActiveStr === 'hand');\r\n\r\n        if (doEmit) {\r\n            p.onActivate(currentActiveStr);\r\n        }\r\n    }\r\n\r\n    function createButton(p) {\r\n\r\n        let smallMargin = p.doLighten ? '6px 0' : '8px 0';\r\n\r\n        let result = BB.el({\r\n            className: 'toolspace-row-button nohighlight',\r\n            //title: p.title,\r\n            onClick: p.onClick,\r\n            css: {\r\n                padding: p.contain ? '10px 0' : ''\r\n            }\r\n        });\r\n        let im = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: p.contain ? 'contain' : '',\r\n                //filter: 'grayscale(1)',\r\n                height: '100%',\r\n                transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none',\r\n                opacity: p.doLighten ? '0.75' : '1'\r\n            }\r\n        });\r\n        result.appendChild(im);\r\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: result,\r\n            onEnterLeave: function(isOver) {\r\n                result.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n        (result as any).setIsSmall = function(b) {\r\n            result.style.padding = p.contain ? (b ? smallMargin : '10px 0') : '';\r\n        }\r\n        return result;\r\n    }\r\n\r\n\r\n    function createTriangleButton(p) { // because IE and Edge don't support clip path\r\n\r\n        let result = document.createElement('div');\r\n        BB.css(result, {\r\n            flexGrow: '1',\r\n            position: 'relative'\r\n        });\r\n\r\n        let svg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '67px', // can't think of a way doing with percentage\r\n            height: '54px',\r\n            viewBox: '0 0 100 100',\r\n            preserveAspectRatio: 'none'\r\n        });\r\n        BB.css(svg, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0'\r\n        });\r\n\r\n        let blurRadius = 10;\r\n        let blurOffsetX = 2;\r\n        let blurOffsetY = 2;\r\n\r\n        let defs = BB.createSvg( { // inset shadow via svg\r\n            elementType: 'defs',\r\n            childrenArr: [\r\n                {\r\n                    elementType: 'filter',\r\n                    id: 'innershadow',\r\n                    x0: '-50%',\r\n                    y0: '-50%',\r\n                    width: '200%',\r\n                    height: '200%',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'feGaussianBlur',\r\n                            in: 'SourceAlpha',\r\n                            stdDeviation: '' + blurRadius,\r\n                            result: 'blur'\r\n                        }, {\r\n                            elementType: 'feOffset',\r\n                            dx: '' + blurOffsetX,\r\n                            dy: '' + blurOffsetY\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'SourceAlpha',\r\n                            operator: 'arithmetic',\r\n                            k2: '-1',\r\n                            k3: '1',\r\n                            result: 'shadowDiff'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feFlood',\r\n                            'flood-color': '#000',\r\n                            'flood-opacity': '0.2'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'shadowDiff',\r\n                            operator: 'in'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'SourceGraphic',\r\n                            operator: 'over',\r\n                            result: 'firstfilter'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feGaussianBlur',\r\n                            in: 'firstfilter',\r\n                            stdDeviation: '' + blurRadius,\r\n                            result: 'blur2'\r\n                        }, {\r\n                            elementType: 'feOffset',\r\n                            dx: '' + blurOffsetX,\r\n                            dy: '' + blurOffsetY\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'firstfilter',\r\n                            operator: 'arithmetic',\r\n                            k2: '-1',\r\n                            k3: '1',\r\n                            result: 'shadowDiff'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feFlood',\r\n                            'flood-color': '#000',\r\n                            'flood-opacity': '0.2'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'shadowDiff',\r\n                            operator: 'in'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'firstfilter',\r\n                            operator: 'over'\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        });\r\n\r\n\r\n        let svgTriangleLeft = BB.createSvg({\r\n            elementType: 'path',\r\n            'vector-effect': 'non-scaling-stroke',\r\n            d: 'M0,0 L 100,0 0,100 z',\r\n            fill: 'rgba(0,0,0,0)',\r\n            class: 'toolspace-svg-triangle-button'\r\n        });\r\n        svgTriangleLeft.onclick = function() {\r\n            p.onLeft();\r\n            svgTriangleLeft.classList.remove('toolspace-svg-triangle-button-hover');\r\n        };\r\n\r\n        let svgTriangleRight = BB.createSvg({\r\n            elementType: 'path',\r\n            'vector-effect': 'non-scaling-stroke',\r\n            d: 'M100,100 L 100,0 0,100 z',\r\n            fill: 'rgba(0,0,0,0)',\r\n            class: 'toolspace-svg-triangle-button'\r\n        });\r\n        svgTriangleRight.onclick = function() {\r\n            p.onRight();\r\n            svgTriangleRight.classList.remove('toolspace-svg-triangle-button-hover');\r\n        };\r\n\r\n        // because :hover causes problems w touch\r\n        (result as any).leftPointerListener = new BB.PointerListener({\r\n            target: svgTriangleLeft,\r\n            onEnterLeave: function(isOver) {\r\n                svgTriangleLeft.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n            }\r\n        });\r\n        (result as any).rightPointerListener = new BB.PointerListener({\r\n            target: svgTriangleRight,\r\n            onEnterLeave: function(isOver) {\r\n                svgTriangleRight.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n            }\r\n        });\r\n\r\n\r\n        svg.appendChild(defs);\r\n        svg.appendChild(svgTriangleLeft);\r\n        svg.appendChild(svgTriangleRight);\r\n        result.appendChild(svg);\r\n\r\n\r\n        let leftIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '8px',\r\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        result.appendChild(leftIm);\r\n\r\n\r\n        let rightIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                right: '10px',\r\n                bottom: '8px',\r\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        result.appendChild(rightIm);\r\n\r\n\r\n\r\n\r\n\r\n        (result as any).setIsEnabledLeft = function(b) {\r\n            svgTriangleLeft.classList.toggle('toolspace-row-button-disabled', !b);\r\n            leftIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n        (result as any).setIsEnabledRight = function(b) {\r\n            svgTriangleRight.classList.toggle('toolspace-row-button-disabled', !b);\r\n            rightIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    function createTriangleButtonViaClipPath(p) {\r\n        let result = document.createElement('div');\r\n        BB.css(result, {\r\n            flexGrow: '1',\r\n            position: 'relative'\r\n        });\r\n\r\n\r\n        let leftButton = BB.el({\r\n            className: 'toolspace-triangle-button',\r\n            onClick: p.onLeft,\r\n            css: {\r\n                clipPath: 'polygon(0% 0%, 100% 0%, 100% 0%, 0% 100%)'\r\n            }\r\n        });\r\n\r\n        let leftIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '8px',\r\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        leftButton.appendChild(leftIm);\r\n\r\n\r\n\r\n        let rightButton = BB.el({\r\n            className: 'toolspace-triangle-button',\r\n            onClick: p.onRight,\r\n            css: {\r\n                clipPath: 'polygon(0% 100%, 100% 0%, 100% 100%, 0% 100%)'\r\n            }\r\n        });\r\n\r\n        let rightIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                right: '10px',\r\n                bottom: '8px',\r\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        rightButton.appendChild(rightIm);\r\n\r\n\r\n\r\n        result.appendChild(leftButton);\r\n        result.appendChild(rightButton);\r\n\r\n\r\n        // because :hover causes problems w touch\r\n        (result as any).leftPointerListener = new BB.PointerListener({\r\n            target: leftButton,\r\n            onEnterLeave: function(isOver) {\r\n                leftButton.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n        (result as any).rightPointerListener = new BB.PointerListener({\r\n            target: rightButton,\r\n            onEnterLeave: function(isOver) {\r\n                rightButton.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n\r\n\r\n\r\n        (result as any).setIsEnabledLeft = function(b) {\r\n            leftButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n        (result as any).setIsEnabledRight = function(b) {\r\n            rightButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n        return result;\r\n    }\r\n\r\n    let toolDropdown = new ToolDropdown({\r\n        onChange: function(activeStr) {\r\n            setActive(activeStr, true);\r\n        }\r\n    });\r\n    div.appendChild(toolDropdown.getElement());\r\n\r\n    let handButton = createButton({\r\n        onClick: function() {\r\n            setActive('hand', true);\r\n        },\r\n        image: toolHandImg,\r\n        contain: true,\r\n        doLighten: true\r\n    });\r\n    handButton.style.borderRight = '1px solid rgb(212, 212, 212)';\r\n    handButton.title = LANG('tool-hand');\r\n    div.appendChild(handButton);\r\n\r\n    let zoomInNOutButton = createTriangleButton({\r\n        onLeft: p.onZoomIn,\r\n        onRight: p.onZoomOut,\r\n        leftImage: toolZoomInImg,\r\n        rightImage: toolZoomOutImg,\r\n    });\r\n    zoomInNOutButton.title = LANG('tool-zoom');\r\n    div.appendChild(zoomInNOutButton);\r\n\r\n    let zoomInButton = createButton({\r\n        onClick: p.onZoomIn,\r\n        image: toolZoomInImg,\r\n        contain: true\r\n    });\r\n    zoomInButton.title = LANG('zoom-in');\r\n    div.appendChild(zoomInButton);\r\n\r\n    let zoomOutButton = createButton({\r\n        onClick: p.onZoomOut,\r\n        image: toolZoomOutImg,\r\n        contain: true\r\n    });\r\n    zoomOutButton.title = LANG('zoom-out');\r\n    div.appendChild(zoomOutButton);\r\n\r\n    let undoNRedoButton = createTriangleButton({\r\n        onLeft: p.onUndo,\r\n        onRight: p.onRedo,\r\n        leftImage: toolUndoImg,\r\n        rightImage: null,\r\n    });\r\n    undoNRedoButton.title = LANG('tool-undo-redo');\r\n    (undoNRedoButton as any).setIsEnabledLeft(false);\r\n    (undoNRedoButton as any).setIsEnabledRight(false);\r\n    div.appendChild(undoNRedoButton);\r\n\r\n    let undoButton = createButton({\r\n        onClick: p.onUndo,\r\n        image: toolUndoImg,\r\n        contain: true\r\n    });\r\n    undoButton.title = LANG('undo');\r\n    undoButton.classList.add('toolspace-row-button-disabled');\r\n    div.appendChild(undoButton);\r\n\r\n    let redoButton = createButton({\r\n        onClick: p.onRedo,\r\n        image: toolUndoImg,\r\n        contain: true,\r\n        doMirror: true\r\n    });\r\n    redoButton.title = LANG('redo');\r\n    redoButton.classList.add('toolspace-row-button-disabled');\r\n    div.appendChild(redoButton);\r\n\r\n    zoomInButton.style.display = 'none';\r\n    zoomOutButton.style.display = 'none';\r\n    undoButton.style.display = 'none';\r\n    redoButton.style.display = 'none';\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.setIsSmall = function(b) {\r\n        BB.css(div, {\r\n            height: b ? '36px' : '54px'\r\n        });\r\n\r\n        toolDropdown.setIsSmall(b);\r\n        (handButton as any).setIsSmall(b);\r\n        (zoomInButton as any).setIsSmall(b);\r\n        (zoomOutButton as any).setIsSmall(b);\r\n        (undoButton as any).setIsSmall(b);\r\n        (redoButton as any).setIsSmall(b);\r\n\r\n        if (b) {\r\n            zoomInNOutButton.style.display = 'none';\r\n            undoNRedoButton.style.display = 'none';\r\n            zoomInButton.style.display = 'block';\r\n            zoomOutButton.style.display = 'block';\r\n            undoButton.style.display = 'block';\r\n            redoButton.style.display = 'block';\r\n        } else {\r\n            zoomInNOutButton.style.display = 'block';\r\n            undoNRedoButton.style.display = 'block';\r\n            zoomInButton.style.display = 'none';\r\n            zoomOutButton.style.display = 'none';\r\n            undoButton.style.display = 'none';\r\n            redoButton.style.display = 'none';\r\n        }\r\n\r\n    };\r\n\r\n    this.setEnableZoomIn = function(b) {\r\n        zoomInButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (zoomInNOutButton as any).setIsEnabledLeft(b);\r\n    };\r\n    this.setEnableZoomOut = function(b) {\r\n        zoomOutButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (zoomInNOutButton as any).setIsEnabledRight(b);\r\n    };\r\n    this.setEnableUndo = function(b) {\r\n        undoButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (undoNRedoButton as any).setIsEnabledLeft(b);\r\n    };\r\n    this.setEnableRedo = function(b) {\r\n        redoButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (undoNRedoButton as any).setIsEnabledRight(b);\r\n    };\r\n    this.setActive = function(activeStr) {\r\n        setActive(activeStr);\r\n    };\r\n    this.getActive = function() {\r\n        return currentActiveStr;\r\n    };\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2gZH2\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"04ZZm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"j9xio\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"AnO0a\");","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../base-components/select';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Ui to select stabilizer level. 4 options. returned as 0-3\r\n *\r\n * p = {\r\n *     smoothing: number, // initial level 0-3\r\n *     onSelect: function(level number) // 0-3, when level changes\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceStabilizerRow(p) {\r\n\r\n    let div = BB.el({\r\n        tagName: 'label',\r\n        content: LANG('stabilizer') + '&nbsp;',\r\n        title: LANG('stabilizer-title'),\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            fontSize: '13px',\r\n            color: 'rgba(0,0,0,0.6)'\r\n        }\r\n    });\r\n\r\n    let strengthSelect = new Select({\r\n        optionArr: [\r\n            ['0', '0'],\r\n            ['1', '1'],\r\n            ['2', '2'],\r\n            ['3', '3'],\r\n            ['4', '4'],\r\n            ['5', '5']\r\n        ],\r\n        initValue: p.smoothing,\r\n        onChange: function(val) {\r\n            p.onSelect(parseInt(val));\r\n        }\r\n    });\r\n    div.appendChild(strengthSelect.getElement());\r\n\r\n    let pointerListener = new BB.PointerListener({\r\n        target: div,\r\n        onWheel: function(e) {\r\n            strengthSelect.setDeltaValue(e.deltaY);\r\n        }\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport invertedBorderImg from 'url:~/src/app/img/ui/inverted-border.svg';\r\n\r\n/**\r\n * row of tabs. uses css class .tabrow-tab\r\n *\r\n * p = {\r\n *     initialId: string, // e.g. 'draw'\r\n *     useAccent: boolean,\r\n *     tabArr: [\r\n *         {\r\n *             id: string, // e.g. 'draw',\r\n *             label: string, // optional\r\n *             image: string, // optional background image\r\n *             title: string, // optional\r\n *             isVisible: boolean, // optional - default is true\r\n *             onOpen: function(),\r\n *             onClose: function(),\r\n *             css: {...},\r\n *         }\r\n *     ]\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function TabRow(p) {\r\n    let _this = this;\r\n    let height = 35;\r\n    let div = BB.el({\r\n        className: 'tabrow',\r\n        css: {\r\n            height: height + 'px'\r\n        }\r\n    });\r\n\r\n    let tabArr = []; //creates its own internal arr\r\n    let openedTabObj = null;\r\n\r\n    const roundSize = 10;\r\n    const roundRight = BB.el({\r\n        css: {\r\n            width: roundSize + 'px',\r\n            height: roundSize + 'px',\r\n            backgroundImage: `url('${invertedBorderImg}')`,\r\n            backgroundSize: 'cover',\r\n            position: 'absolute',\r\n            right: -roundSize + 'px',\r\n            bottom: '0',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n    const roundLeft = BB.el({\r\n        css: {\r\n            width: roundSize + 'px',\r\n            height: roundSize + 'px',\r\n            backgroundImage: `url('${invertedBorderImg}')`,\r\n            backgroundSize: 'cover',\r\n            position: 'absolute',\r\n            left: -roundSize + 'px',\r\n            bottom: '0',\r\n            transform: 'scale(-1,1)',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n\r\n    function createTab(pTabObj, initialId, useAccent) {\r\n        let result: any = {\r\n            id: pTabObj.id,\r\n            isVisible: 'isVisible' in pTabObj ? pTabObj.isVisible : true,\r\n            onOpen: pTabObj.onOpen,\r\n            onClose: pTabObj.onClose,\r\n            update: function(openedTabObj) {\r\n                tabDiv.className = openedTabObj === result ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab';\r\n                tabDiv.style.display = result.isVisible ? 'block' : 'none';\r\n            }\r\n        };\r\n        let tabDiv = BB.el({\r\n            content: 'label' in pTabObj ? pTabObj.label : '',\r\n            title: 'title' in pTabObj ? pTabObj.title : undefined,\r\n            className: initialId === result.id ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab',\r\n            css: {\r\n                lineHeight: height + 'px',\r\n                display: result.isVisible ? 'block' : 'none',\r\n                zIndex: '0',\r\n            },\r\n            onClick: function() {\r\n                if (openedTabObj === result) {\r\n                    return;\r\n                }\r\n                _this.open(result.id);\r\n            }\r\n        });\r\n        result.div = tabDiv;\r\n        if ('image' in pTabObj) {\r\n            BB.css(tabDiv, {\r\n                backgroundImage: 'url(\\'' + pTabObj.image + '\\')',\r\n                backgroundSize: (height - 7) + 'px'\r\n            });\r\n        }\r\n        if ('css' in pTabObj) {\r\n            BB.css(tabDiv, pTabObj.css);\r\n        }\r\n        div.appendChild(tabDiv);\r\n\r\n        let pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: tabDiv,\r\n            onEnterLeave: function(isOver) {\r\n                tabDiv.classList.toggle('tabrow-tab-hover', isOver);\r\n            }\r\n        });\r\n\r\n        if (initialId === result.id) {\r\n            result.onOpen();\r\n            result.div.appendChild(roundRight);\r\n            result.div.appendChild(roundLeft);\r\n        } else {\r\n            result.onClose();\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    for (let i = 0; i < p.tabArr.length; i++) {\r\n        tabArr.push(createTab(p.tabArr[i], p.initialId, p.useAccent));\r\n    }\r\n\r\n    for (let i = 0; i < tabArr.length; i++) {\r\n        if (tabArr[i].id === p.initialId) {\r\n            openedTabObj = tabArr[i];\r\n        }\r\n    }\r\n    if (openedTabObj === null) {\r\n        throw 'invalid initialId';\r\n    }\r\n\r\n    function update() {\r\n        for (let i = 0; i < tabArr.length; i++) {\r\n            tabArr[i].update(openedTabObj);\r\n        }\r\n    }\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.open = function(tabId) {\r\n        for (let i = 0; i < tabArr.length; i++) {\r\n            if (tabArr[i].id === tabId) {\r\n                if (openedTabObj === tabArr[i]) { // already open\r\n                    return;\r\n                }\r\n                openedTabObj.onClose();\r\n                openedTabObj = tabArr[i];\r\n                openedTabObj.onOpen();\r\n                openedTabObj.div.appendChild(roundRight);\r\n                openedTabObj.div.appendChild(roundLeft);\r\n                update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.open - invalid tabId';\r\n    };\r\n\r\n    this.getOpenedTabId = function() {\r\n        return '' + openedTabObj.id;\r\n    };\r\n\r\n    this.setIsVisible = function(tabId, isVisible) {\r\n        for (let i = 0; i < tabArr.length; i++) {\r\n            if (tabArr[i].id === tabId) {\r\n                tabArr[i].isVisible = !!isVisible;\r\n                update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.setIsVisible - invalid tabId';\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"nTvP2\");","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport angleImg from 'url:~/src/app/img/ui/angle.svg';\r\n// @ts-ignore\r\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Ui, when hand tool tab is open.\r\n *\r\n * p = {\r\n *     scale: number, // initial value\r\n *     angleDeg: number, // initial value\r\n *     onReset: function(),\r\n *     onFit: function(),\r\n *     onAngleChange: function(angleDeg number, isRelative number)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function HandUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n    let scale = p.scale;\r\n    let angleDeg = p.angleDeg;\r\n\r\n    let row1 = BB.el({\r\n        css: {\r\n            marginBottom: '10px',\r\n            display: 'flex'\r\n        }\r\n    });\r\n    let row2 = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            marginBottom: '10px',\r\n        }\r\n    });\r\n    let row3 = BB.el({\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n    div.append(row1, row2, row3);\r\n\r\n\r\n    let scaleEl = BB.el({\r\n        css: {\r\n            width: '55px',\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    row1.appendChild(scaleEl);\r\n\r\n    let angleIm = new Image();\r\n    angleIm.src = angleImg;\r\n    BB.css(angleIm, {\r\n        verticalAlign: 'bottom',\r\n        width: '20px',\r\n        height: '20px',\r\n        marginRight: '5px',\r\n        borderRadius: '10px',\r\n        background: 'rgba(0,0,0,0.2)',\r\n        userSelect: 'none'\r\n    });\r\n    row1.appendChild(angleIm);\r\n\r\n    let angleEl = BB.el({\r\n        css: {\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    row1.appendChild(angleEl);\r\n\r\n\r\n    function update() {\r\n        scaleEl.innerHTML = Math.round(scale * 100) + '%';\r\n        angleEl.innerHTML =  Math.round(angleDeg) + '';\r\n\r\n\r\n        angleIm.style.transform = 'rotate(' + angleDeg + 'deg)';\r\n        if (angleDeg % 90 === 0) {\r\n            angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)';\r\n        } else {\r\n            angleIm.style.boxShadow = '';\r\n        }\r\n    }\r\n    update();\r\n\r\n\r\n    let resetButton = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('hand-reset'),\r\n        onClick: p.onReset\r\n    });\r\n    BB.makeUnfocusable(resetButton);\r\n\r\n    let fitButton = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('hand-fit'),\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: p.onFit\r\n    });\r\n    BB.makeUnfocusable(fitButton);\r\n    row2.append(resetButton, fitButton);\r\n\r\n    let leftRotateButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\r\n        onClick: function() {\r\n            p.onAngleChange(-15, true);\r\n        }\r\n    });\r\n    BB.makeUnfocusable(leftRotateButton);\r\n\r\n    let resetAngleButton = BB.el({\r\n        tagName: 'button',\r\n        content: '0',\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            p.onAngleChange(0);\r\n        }\r\n    });\r\n    BB.makeUnfocusable(resetAngleButton);\r\n\r\n    let rightRotateButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\"/>',\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            p.onAngleChange(15, true);\r\n        }\r\n    });\r\n    BB.makeUnfocusable(rightRotateButton);\r\n    row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\r\n\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            update();\r\n        }\r\n    };\r\n    this.update = function(pScale, pAngleDeg) {\r\n        scale = pScale;\r\n        angleDeg = pAngleDeg;\r\n        if (isVisible) {\r\n            update();\r\n        }\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6toXQ\");","import {BB} from '../../../bb/bb';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {Select} from '../base-components/select';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Paint Bucket tab contents (color slider, opacity slider, etc)\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function FillUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n\r\n    let colorDiv = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginBottom: '10px'\r\n        }\r\n    });\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 1 / 100,\r\n        max: 1,\r\n        value: 1,\r\n        toValue: (displayValue) => displayValue / 100,\r\n        toDisplayValue: (value) => value * 100,\r\n    });\r\n    div.appendChild(opacitySlider.getElement());\r\n\r\n    let toleranceSlider = new KlSlider({\r\n        label: LANG('bucket-tolerance'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 0,\r\n        max: 255,\r\n        value: 20 * (255 / 100),\r\n        toValue: (displayValue) => displayValue * (255 / 100),\r\n        toDisplayValue: (value) => value / (255 / 100),\r\n    });\r\n    BB.css(toleranceSlider.getElement(), {\r\n        marginTop: '10px'\r\n    });\r\n    div.appendChild(toleranceSlider.getElement());\r\n\r\n    let selectRow = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n\r\n    let modeWrapper;\r\n    let modeSelect;\r\n    modeWrapper = BB.el({\r\n        content: LANG('bucket-sample') + '&nbsp;',\r\n        title: LANG('bucket-sample-title'),\r\n        css: {\r\n            fontSize: '15px'\r\n        }\r\n    });\r\n    modeSelect = new Select({\r\n        optionArr: [\r\n            ['all', LANG('bucket-sample-all')],\r\n            ['current', LANG('bucket-sample-active')],\r\n            ['above', LANG('bucket-sample-above')]\r\n        ],\r\n        initValue: 'all',\r\n        onChange: function(val) {}\r\n    });\r\n    let modePointerListener = new BB.PointerListener({\r\n        target: modeSelect.getElement(),\r\n        onWheel: function(e) {\r\n            modeSelect.setDeltaValue(e.deltaY);\r\n        }\r\n    });\r\n    modeWrapper.appendChild(modeSelect.getElement());\r\n    selectRow.appendChild(modeWrapper);\r\n\r\n    let growWrapper;\r\n    let growSelect;\r\n    growWrapper = BB.el({\r\n        content: LANG('bucket-grow') + '&nbsp;',\r\n        title: LANG('bucket-grow-title'),\r\n        css: {\r\n            fontSize: '15px',\r\n            marginLeft: '10px'\r\n        }\r\n    });\r\n    growSelect = new Select({\r\n        optionArr: [\r\n            ['0', '0'],\r\n            ['1', '1'],\r\n            ['2', '2'],\r\n            ['3', '3'],\r\n            ['4', '4'],\r\n            ['5', '5'],\r\n            ['6', '6'],\r\n            ['7', '7'],\r\n        ],\r\n        initValue: '0',\r\n        onChange: function(val) {}\r\n    });\r\n    let growPointerListener = new BB.PointerListener({\r\n        target: growSelect.getElement(),\r\n        onWheel: function(e) {\r\n            growSelect.setDeltaValue(e.deltaY);\r\n        }\r\n    });\r\n    growWrapper.appendChild(growSelect.getElement());\r\n    selectRow.appendChild(growWrapper);\r\n\r\n\r\n    let isContiguous = true;\r\n    let contiguousToggle = new Checkbox({\r\n        init: true,\r\n        label: LANG('bucket-contiguous'),\r\n        title: LANG('bucket-contiguous-title'),\r\n        callback: function (b) {\r\n            isContiguous = b;\r\n        },\r\n        css: {\r\n            paddingRight: '5px',\r\n            display: 'inline-block',\r\n            width: '50%',\r\n        }\r\n    });\r\n\r\n    let eraserToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('eraser'),\r\n        callback: function (b) {},\r\n        css: {\r\n\r\n            paddingRight: '5px',\r\n            display: 'inline-block',\r\n            width: '50%',\r\n        }\r\n    });\r\n\r\n    div.append(BB.el({\r\n        content: [\r\n            contiguousToggle.getElement(),\r\n            eraserToggle.getElement(),\r\n        ],\r\n        css: {\r\n            display: 'flex',\r\n            marginTop: '10px',\r\n        }\r\n    }));\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            colorDiv.appendChild(p.colorSlider.getElement());\r\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\r\n        }\r\n    };\r\n\r\n    this.getTolerance = function() {\r\n        return toleranceSlider.getValue();\r\n    };\r\n\r\n    this.getOpacity = function() {\r\n        return opacitySlider.getValue();\r\n    };\r\n\r\n    /**\r\n     * returns string 'current' | 'all' | 'above'\r\n     */\r\n    this.getSample = function() {\r\n        return modeSelect.getValue();\r\n    };\r\n\r\n    this.getGrow = function() {\r\n        return parseInt(growSelect.getValue(), 10);\r\n    }\r\n\r\n    this.getContiguous = () => isContiguous;\r\n\r\n    this.getIsEraser = () => eraserToggle.getValue();\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Text Tool tab contents (color slider)\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function TextUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n\r\n    let colorDiv = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginBottom: '10px'\r\n        }\r\n    });\r\n\r\n    let hint = BB.el({\r\n        parent: div,\r\n        content: LANG('text-instruction'),\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            colorDiv.appendChild(p.colorSlider.getElement());\r\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\r\n            //update();\r\n        }\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {Options} from '../base-components/options';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Shape Tool tab contents\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ShapeUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n\r\n    let colorDiv = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginBottom: '10px'\r\n        }\r\n    });\r\n\r\n    let previewSize = 35;\r\n    let previewPadding = 8;\r\n    let shape; // 'rect'|'ellipse'|'line'\r\n    let mode; // 'stroke'|'fill'\r\n\r\n\r\n    let rectStrokeSvgRect = BB.createSvg({\r\n        elementType: 'rect',\r\n        x: '' + previewPadding,\r\n        width: '' + (previewSize - previewPadding * 2)\r\n    });\r\n    let rectStrokeSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize\r\n    });\r\n    rectStrokeSvg.appendChild(rectStrokeSvgRect);\r\n    BB.css(rectStrokeSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n    let rectFilledSvgRect = BB.createSvg({\r\n        elementType: 'rect',\r\n        x: '' + previewPadding,\r\n        width: '' + (previewSize - previewPadding * 2)\r\n    });\r\n    let rectFilledSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize\r\n    });\r\n    rectFilledSvg.appendChild(rectFilledSvgRect);\r\n    BB.css(rectFilledSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n\r\n    let ellipseStrokeSvgEllipse = BB.createSvg({\r\n        elementType: 'ellipse',\r\n        cx: '' + (previewSize / 2),\r\n        cy: '' + (previewSize / 2),\r\n        rx: '' + (previewSize / 2 - previewPadding)\r\n    });\r\n    let ellipseStrokeSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize,\r\n    });\r\n    ellipseStrokeSvg.appendChild(ellipseStrokeSvgEllipse);\r\n    BB.css(ellipseStrokeSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n    let ellipseFilledSvgEllipse = BB.createSvg({\r\n        elementType: 'ellipse',\r\n        cx: '' + (previewSize / 2),\r\n        cy: '' + (previewSize / 2),\r\n        rx: '' + (previewSize / 2 - previewPadding)\r\n    });\r\n    let ellipseFilledSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize,\r\n    });\r\n    ellipseFilledSvg.appendChild(ellipseFilledSvgEllipse);\r\n    BB.css(ellipseFilledSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n\r\n    let lineSvgLine = BB.createSvg({\r\n        elementType: 'line',\r\n        x1: '' + previewPadding,\r\n        x2: '' + (previewSize - previewPadding)\r\n    });\r\n    let lineSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize\r\n    });\r\n    lineSvg.appendChild(lineSvgLine);\r\n    BB.css(lineSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n    function updatePreviews() {\r\n        let strokeWidth = BB.clamp(Math.round(lineWidthSlider.getValue() / 10), 1, 10) + 'px';\r\n\r\n        let squish = 1.35;\r\n\r\n        BB.css(rectStrokeSvgRect, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n        BB.css(rectFilledSvgRect, { fill: 'black', stroke: 'none' });\r\n\r\n        BB.css(ellipseStrokeSvgEllipse, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n        BB.css(ellipseFilledSvgEllipse, { fill: 'black', stroke: 'none' });\r\n\r\n        BB.css(\r\n            lineSvgLine,\r\n            { fill: 'none', stroke: 'black', strokeWidth: strokeWidth }\r\n        );\r\n\r\n        if ((fixedToggle as any).getValue()) {\r\n            rectStrokeSvgRect.setAttribute('y', '' + previewPadding);\r\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n            rectFilledSvgRect.setAttribute('y', '' + previewPadding);\r\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n\r\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n        } else {\r\n            rectStrokeSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n            rectFilledSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n\r\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n        }\r\n\r\n        if ((snapToggle as any).getValue()) {\r\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding));\r\n            lineSvgLine.setAttribute('y2', '' + previewPadding);\r\n        } else {\r\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding * squish));\r\n            lineSvgLine.setAttribute('y2', '' + (previewPadding * squish));\r\n        }\r\n    }\r\n\r\n    let row1 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'start'\r\n        }\r\n    });\r\n\r\n    let shapeOptions = new Options({\r\n        optionArr: [\r\n            {\r\n                id: 'rect-stroke',\r\n                label: rectStrokeSvg,\r\n                title: LANG('shape-rect') + ' ' + LANG('shape-stroke'),\r\n            },\r\n            {\r\n                id: 'ellipse-stroke',\r\n                label: ellipseStrokeSvg,\r\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-stroke'),\r\n            },\r\n            {\r\n                id: 'line',\r\n                label: lineSvg,\r\n                title: LANG('shape-line'),\r\n            },\r\n            {\r\n                id: 'rect-fill',\r\n                label: rectFilledSvg,\r\n                title: LANG('shape-rect') + ' ' + LANG('shape-fill'),\r\n            },\r\n            {\r\n                id: 'ellipse-fill',\r\n                label: ellipseFilledSvg,\r\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-fill'),\r\n            },\r\n        ],\r\n        initId: 'rect',\r\n        onChange: function(id) {\r\n            let split = id.split('-');\r\n            shape = split[0];\r\n            mode = split[1];\r\n\r\n            BB.css(fixedToggle.getElement(), {\r\n                display: shape === 'line' ? 'none' : null\r\n            });\r\n            BB.css(snapToggle.getElement(), {\r\n                display: shape === 'line' ? null : 'none'\r\n            });\r\n            BB.css(lineWidthSlider.getElement(), {\r\n                display: (shape !== 'line' && mode === 'fill') ? 'none' : null\r\n            });\r\n        },\r\n        changeOnInit: true\r\n    });\r\n    shapeOptions.getElement().style.width = '120px';\r\n    row1.appendChild(shapeOptions.getElement());\r\n\r\n    const eraserToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('eraser'),\r\n        callback: function(b) {\r\n            updatePreviews();\r\n        }\r\n    });\r\n\r\n    const lockAlphaToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('lock-alpha'),\r\n        title: LANG('lock-alpha-title'),\r\n        callback: (b) => {\r\n        },\r\n        doHighlight: true,\r\n    });\r\n    lockAlphaToggle.getElement().style.marginTop = '10px';\r\n\r\n    row1.append(BB.el({\r\n        content: [\r\n            eraserToggle.getElement(),\r\n            lockAlphaToggle.getElement(),\r\n        ]\r\n    }));\r\n\r\n    let lineWidthSlider = new KlSlider({\r\n        label: LANG('shape-line-width'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 1,\r\n        max: 200,\r\n        value: 4,\r\n        curve: 'quadratic',\r\n        onChange: (val) => {\r\n            updatePreviews();\r\n        },\r\n    });\r\n    BB.css(lineWidthSlider.getElement(), {\r\n        marginTop: '10px'\r\n    });\r\n    div.appendChild(lineWidthSlider.getElement());\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 1 / 100,\r\n        max: 1,\r\n        value: 1,\r\n        toValue: (displayValue) => displayValue / 100,\r\n        toDisplayValue: (value) => value * 100,\r\n    });\r\n    BB.css(opacitySlider.getElement(), {\r\n        marginTop: '10px'\r\n    });\r\n    div.appendChild(opacitySlider.getElement());\r\n\r\n    let row2 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n\r\n    let outwardsToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('shape-outwards'),\r\n        callback: function(b) {},\r\n        css: {\r\n            width: '50%',\r\n            marginRight: '10px',\r\n        }\r\n    });\r\n    row2.appendChild(outwardsToggle.getElement());\r\n\r\n    let fixedToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('shape-fixed'),\r\n        callback: function(b) {\r\n            updatePreviews();\r\n        },\r\n        css: {\r\n            flexGrow: '1',\r\n        }\r\n    });\r\n    row2.appendChild(fixedToggle.getElement());\r\n\r\n    let snapToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('angle-snap'),\r\n        title: LANG('angle-snap-title'),\r\n        callback: function(b) {\r\n            updatePreviews();\r\n        },\r\n        css: {\r\n            flexGrow: '1',\r\n        }\r\n    });\r\n    row2.appendChild(snapToggle.getElement());\r\n\r\n\r\n    updatePreviews();\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            colorDiv.appendChild(p.colorSlider.getElement());\r\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\r\n            //update();\r\n        }\r\n    };\r\n\r\n    this.getShape = function() {\r\n        return shape;\r\n    };\r\n\r\n    this.getMode = function() {\r\n        return mode;\r\n    };\r\n\r\n    this.getIsEraser = function() {\r\n        return (eraserToggle as any).getValue();\r\n    };\r\n\r\n    this.getOpacity = function() {\r\n        return opacitySlider.getValue();\r\n    };\r\n\r\n    this.getLineWidth = function() {\r\n        return lineWidthSlider.getValue();\r\n    };\r\n\r\n    this.getIsOutwards = function() {\r\n        return (outwardsToggle as any).getValue();\r\n    };\r\n\r\n    this.getIsFixed = function() {\r\n        return (fixedToggle as any).getValue();\r\n    };\r\n\r\n    this.getIsSnap = function() {\r\n        return (snapToggle as any).getValue();\r\n    };\r\n\r\n    this.getDoLockAlpha = () => {\r\n        return lockAlphaToggle.getValue();\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../base-components/select';\r\nimport {ColorOptions} from '../base-components/color-options';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * P = {\r\n *     currentColor: RGB, // current color\r\n *     secondaryColor: RGB,\r\n *     maxCanvasSize: number,\r\n *     canvasWidth: number, // current canvas size\r\n *     canvasHeight: number, // current canvas size\r\n *     workspaceWidth: number,\r\n *     workspaceHeight: number,\r\n *     onConfirm: function(width number, height number, color RGBA),\r\n *     onCancel: function()\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function newImageDialog(p) {\r\n\r\n    let currentColor = p.currentColor;\r\n    let secondaryColor = p.secondaryColor;\r\n    let maxCanvasSize = p.maxCanvasSize;\r\n    let canvasWidth = p.canvasWidth;\r\n    let canvasHeight = p.canvasHeight;\r\n    let workspaceWidth = p.workspaceWidth;\r\n    let workspaceHeight = p.workspaceHeight;\r\n    let onConfirm = p.onConfirm;\r\n    let onCancel = p.onCancel;\r\n\r\n\r\n    function createRatioSize(ratioX, ratioY, width, height, padding) {\r\n        return BB.fitInto(ratioX, ratioY, Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding), 1);\r\n    }\r\n\r\n    let newImDiv = document.createElement(\"div\");\r\n    let widthWrapper = document.createElement(\"div\");\r\n    let heightWrapper = document.createElement(\"div\");\r\n    let widthInput = document.createElement(\"input\");\r\n    let widthUnit = document.createElement(\"div\");\r\n    let heightInput = document.createElement(\"input\");\r\n    let heightUnit = document.createElement(\"div\");\r\n    widthWrapper.style.position = \"relative\";\r\n    widthWrapper.style.width = \"145px\";\r\n    widthWrapper.style.height = \"35px\";\r\n    widthWrapper.style.lineHeight = \"30px\";\r\n    heightWrapper.style.width = \"145px\";\r\n    heightWrapper.style.height = \"35px\";\r\n    heightWrapper.style.lineHeight = \"30px\";\r\n\r\n    widthUnit.innerText = LANG('new-px');\r\n    widthUnit.style.color = '#888';\r\n    widthUnit.style.fontSize = \"12px\";\r\n    widthUnit.style.marginLeft = \"5px\";\r\n    widthUnit.style.cssFloat = \"right\";\r\n\r\n    heightUnit.innerText = LANG('new-px');\r\n    heightUnit.style.color = '#888';\r\n    heightUnit.style.fontSize = \"12px\";\r\n    heightUnit.style.marginLeft = \"5px\";\r\n    heightUnit.style.cssFloat = \"right\";\r\n\r\n    widthInput.setAttribute('data-ignore-focus', 'true');\r\n    heightInput.setAttribute('data-ignore-focus', 'true');\r\n\r\n    widthInput.type = 'number';\r\n    widthInput.min = '1';\r\n    widthInput.max = maxCanvasSize;\r\n    widthInput.style.cssFloat = \"right\";\r\n    widthInput.style.width = \"70px\";\r\n\r\n    heightInput.type = 'number';\r\n    heightInput.min = '1';\r\n    heightInput.max = maxCanvasSize;\r\n    heightInput.style.cssFloat = \"right\";\r\n    heightInput.style.width = \"70px\";\r\n    widthInput.value = canvasWidth;\r\n    heightInput.value = canvasHeight;\r\n    widthInput.onclick = function () {\r\n        (this as any).focus();\r\n        updateRatio();\r\n    };\r\n    heightInput.onclick = function () {\r\n        (this as any).focus();\r\n        updateRatio();\r\n    };\r\n    widthWrapper.appendChild(widthUnit);\r\n    widthWrapper.appendChild(widthInput);\r\n    BB.appendTextDiv(widthWrapper, LANG('width') + \": \");\r\n    heightWrapper.appendChild(heightUnit);\r\n    heightWrapper.appendChild(heightInput);\r\n    BB.appendTextDiv(heightWrapper, LANG('height') + \": \");\r\n    let ratioWrapper = document.createElement(\"div\");\r\n    ratioWrapper.style.marginTop = '5px';\r\n    ratioWrapper.style.color = '#888';\r\n\r\n    let templateWrapper = document.createElement(\"div\");\r\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\r\n    let presetFitBtn = document.createElement(\"button\");\r\n    templateWrapper.style.marginBottom = \"10px\";\r\n    let presetCurrentBtn = document.createElement(\"button\");\r\n    let presetSquareBtn = document.createElement(\"button\");\r\n    let presetLandscapeBtn = document.createElement(\"button\");\r\n    let presetPortraitBtn = document.createElement(\"button\");\r\n    let presetOversizeBtn = document.createElement(\"button\");\r\n\r\n    presetCurrentBtn.textContent = LANG('new-current');\r\n    presetFitBtn.textContent = LANG('new-fit');\r\n    presetOversizeBtn.textContent = LANG('new-oversize');\r\n    presetLandscapeBtn.textContent = LANG('new-landscape');\r\n    presetPortraitBtn.textContent = LANG('new-portrait');\r\n    presetSquareBtn.textContent = LANG('new-square');\r\n\r\n    presetCurrentBtn.style.marginRight = \"5px\";\r\n    presetFitBtn.style.marginRight = \"5px\";\r\n    presetOversizeBtn.style.marginRight = \"5px\";\r\n    presetLandscapeBtn.style.marginTop = \"5px\";\r\n    presetLandscapeBtn.style.marginRight = \"5px\";\r\n    presetPortraitBtn.style.marginTop = \"5px\";\r\n    presetPortraitBtn.style.marginRight = \"5px\";\r\n\r\n    templateWrapper.appendChild(presetCurrentBtn);\r\n    templateWrapper.appendChild(presetFitBtn);\r\n    templateWrapper.appendChild(presetOversizeBtn);\r\n    templateWrapper.appendChild(presetSquareBtn);\r\n    templateWrapper.appendChild(presetLandscapeBtn);\r\n    templateWrapper.appendChild(presetPortraitBtn);\r\n\r\n    let templatePadding = 0;\r\n\r\n    presetCurrentBtn.onclick = function () {\r\n        widthInput.value = canvasWidth;\r\n        heightInput.value = canvasHeight;\r\n        updateRatio();\r\n    };\r\n    presetFitBtn.onclick = function () {\r\n        widthInput.value = workspaceWidth;\r\n        heightInput.value = workspaceHeight;\r\n        updateRatio();\r\n    };\r\n    presetOversizeBtn.onclick = function () {\r\n        widthInput.value = workspaceWidth + 500;\r\n        heightInput.value = workspaceHeight + 500;\r\n        updateRatio();\r\n    };\r\n    presetSquareBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetLandscapeBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetPortraitBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n\r\n    let select = new Select({\r\n        isFocusable: true,\r\n        optionArr: [\r\n            ['screen', LANG('new-screen')],\r\n            ['16 9', LANG('new-video') + ' 16:9'],\r\n            ['3 2', '3:2'],\r\n            ['5 3', '5:3'],\r\n            ['2 1', '2:1'],\r\n            ['paper', LANG('new-din-paper') + ' 2:1'],\r\n            ['9 16', '9:16'],\r\n            ['2 3', '2:3'],\r\n            ['3 5', '3:5'],\r\n            ['1 2', '1:2'],\r\n            ['1 1.4142135623730951', '1:2']\r\n        ],\r\n        onChange: function(val) {\r\n            if (val === 'screen') {\r\n                widthInput.value = '' + window.screen.width;\r\n                heightInput.value = '' + window.screen.height;\r\n            } else if (val === 'paper') {\r\n                let sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            } else {\r\n                let split = val.split(' ');\r\n                let sizeObj = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            }\r\n            updateRatio();\r\n            select.setValue(null);\r\n        }\r\n    });\r\n    setTimeout(() => {\r\n        // safari: not empty without also setting it to null via timeout\r\n        select.setValue(null);\r\n    }, 0);\r\n    BB.css(select.getElement(), {\r\n        width: '80px',\r\n    });\r\n    templateWrapper.appendChild(select.getElement());\r\n\r\n\r\n\r\n    let backgroundRGBA = {r: 255, g: 255, b: 255, a: 1};\r\n\r\n    let colorOptionsArr = [\r\n        {r: 255, g: 255, b: 255, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 0}\r\n    ];\r\n    colorOptionsArr.push({\r\n        r: currentColor.r,\r\n        g: currentColor.g,\r\n        b: currentColor.b,\r\n        a: 1\r\n    });\r\n    colorOptionsArr.push({\r\n        r: secondaryColor.r,\r\n        g: secondaryColor.g,\r\n        b: secondaryColor.b,\r\n        a: 1\r\n    });\r\n\r\n    let colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        onChange: function(rgbaObj) {\r\n            backgroundRGBA = rgbaObj;\r\n            preview.style.backgroundColor = \"rgba(\" + rgbaObj.r + \",\" + rgbaObj.g + \",\" + rgbaObj.b + \", \" + rgbaObj.a + \")\";\r\n        }\r\n    });\r\n\r\n    let previewWrapper = document.createElement(\"div\");\r\n    BB.css(previewWrapper, {\r\n        boxSizing: 'border-box',\r\n        width: '340px',\r\n        height: '140px',\r\n        display: 'table',\r\n        backgroundColor: '#9e9e9e',\r\n        padding: '10px',\r\n        marginTop: '10px',\r\n        boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\r\n        marginLeft: '-20px',\r\n        colorScheme: 'only light',\r\n    });\r\n    let preview = document.createElement(\"div\");\r\n    BB.css(preview, {\r\n        width: 200 + \"px\",\r\n        height: 100 + \"px\",\r\n        backgroundColor: \"#fff\",\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n        color: \"#aaa\",\r\n        fontSize: \"16px\",\r\n        fontWeight: \"bold\",\r\n        textAlign: \"center\",\r\n        verticalAlign: \"center\",\r\n        display: \"table\",\r\n        overflow: \"hidden\",\r\n        boxShadow: \"0px 0px 3px rgba(0,0,0,0.5)\"\r\n    });\r\n    let previewcell = document.createElement(\"div\");\r\n    previewcell.style.display = \"table-cell\";\r\n    previewcell.style.verticalAlign = \"middle\";\r\n    previewcell.appendChild(preview);\r\n    previewWrapper.appendChild(previewcell);\r\n    let cell = BB.appendTextDiv(preview, \"\");\r\n    //let ratio = BB.appendTextDiv(cell, \"1:2\");\r\n    cell.style.display = \"table-cell\";\r\n    cell.style.verticalAlign = \"middle\";\r\n    let prevW = parseInt(widthInput.value);\r\n    let prevH = parseInt(heightInput.value);\r\n\r\n    function updateRatio() {\r\n        widthInput.value = '' + Math.min(maxCanvasSize, parseInt(widthInput.value));\r\n        heightInput.value = '' + Math.min(maxCanvasSize, parseInt(heightInput.value));\r\n\r\n        function HCF(u, v) {\r\n            let U = u, V = v;\r\n            while (true) {\r\n                if (!(U %= V))\r\n                    return V;\r\n                if (!(V %= U))\r\n                    return U;\r\n            }\r\n        }\r\n\r\n        let w = parseInt(widthInput.value);\r\n        let h = parseInt(heightInput.value);\r\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\r\n            if (w > maxCanvasSize)\r\n                w = maxCanvasSize;\r\n            else if (h > maxCanvasSize)\r\n                h = maxCanvasSize;\r\n\r\n            widthInput.value = '' + w;\r\n            heightInput.value = '' + h;\r\n        }\r\n\r\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\r\n        let commonRatios = [\r\n            [1, 2], [2, 1],\r\n            [2, 3], [3, 2],\r\n            [3, 4], [4, 3],\r\n            [4, 5], [5, 4],\r\n            [16, 9], [9, 16],\r\n            [3, 2], [2, 3],\r\n            [5, 3], [3, 5],\r\n            [2, 1], [1, 2],\r\n            [1.414, 1], [1, 1.414],\r\n        ];\r\n        let reducedArr = BB.reduce(w, h);\r\n        let closestRatio = null;\r\n        let closestDistance = null;\r\n        for (let i = 0; i < commonRatios.length; i++) {\r\n            if (i === 0 || Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\r\n                closestRatio = commonRatios[i];\r\n                closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\r\n            }\r\n        }\r\n        //display ratio\r\n        if (closestDistance > 0 && closestDistance < 0.005) {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ~' + closestRatio[0] + ':' + closestRatio[1];\r\n        } else {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ' + reducedArr[0] + ':' + reducedArr[1];\r\n        }\r\n\r\n        prevW = w;\r\n        prevH = h;\r\n        let realw = w;\r\n        let T = HCF(w, h);\r\n        w /= T;\r\n        h /= T;\r\n        w *= 260;\r\n        h *= 260;\r\n        if (w > 260) {\r\n            h = 260 / w * h;\r\n            w = 260;\r\n        }\r\n        if (h > 100) {\r\n            w = 100 / h * w;\r\n            h = 100;\r\n\r\n        }\r\n\r\n        preview.style.width = w + \"px\";\r\n        preview.style.height = h + \"px\";\r\n        BB.createCheckerDataUrl(parseInt('' + (30 * (w / realw))), function (url) {\r\n            previewWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n    }\r\n\r\n    widthInput.onchange = function () {\r\n        if (widthInput.value === '' || parseInt(widthInput.value) < 0) {\r\n            widthInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    widthInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    heightInput.onchange = function () {\r\n        if (heightInput.value === '' || parseFloat(heightInput.value) < 0) {\r\n            heightInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    heightInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    updateRatio();\r\n\r\n    newImDiv.appendChild(templateWrapper);\r\n    let secondRow = BB.el({\r\n        parent: newImDiv,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'flex-end'\r\n        }\r\n    });\r\n    let secondRowLeft = BB.el({\r\n        parent: secondRow\r\n    });\r\n    secondRowLeft.appendChild(widthWrapper);\r\n    secondRowLeft.appendChild(heightWrapper);\r\n    secondRowLeft.appendChild(ratioWrapper);\r\n    secondRow.appendChild(colorOptions.getElement());\r\n\r\n    newImDiv.appendChild(previewWrapper);\r\n\r\n    popup({\r\n        target: document.body,\r\n        message: `<b>${LANG('new-title')}</b>`,\r\n        div: newImDiv,\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (result) {\r\n            widthInput.onclick = null;\r\n            heightInput.onclick = null;\r\n            presetCurrentBtn.onclick = null;\r\n            presetFitBtn.onclick = null;\r\n            presetOversizeBtn.onclick = null;\r\n            presetSquareBtn.onclick = null;\r\n            presetLandscapeBtn.onclick = null;\r\n            presetPortraitBtn.onclick = null;\r\n            widthInput.onchange = null;\r\n            widthInput.onkeyup = null;\r\n            heightInput.onchange = null;\r\n            heightInput.onkeyup = null;\r\n            select.destroy();\r\n            colorOptions.destroy();\r\n\r\n            if (result === \"Cancel\" || parseInt(widthInput.value) <= 0 || parseInt(heightInput.value) <= 0 || isNaN(parseInt(widthInput.value)) || isNaN(parseInt(heightInput.value))) {\r\n                onCancel();\r\n                return;\r\n            }\r\n            onConfirm(parseInt(widthInput.value), parseInt(heightInput.value), backgroundRGBA);\r\n        },\r\n        clickOnEnter: 'Ok'\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport collapseImg from 'url:~/src/app/img/ui/ui-collapse.svg';\r\nimport {LANG} from \"../../../language/language\";\r\n\r\n/**\r\n * button that allows to collapse toolspace (for mobile)\r\n *\r\n * p = {\r\n *     onChange: function()\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceCollapser(p) {\r\n    let isOpen = true;\r\n    let directionStr = 'right'; // 'left' | 'right'\r\n\r\n    function update() {\r\n        if (directionStr === 'left') {\r\n            icon.style.transform = isOpen ? 'rotate(180deg)' : '';\r\n        } else {\r\n            icon.style.transform = isOpen ? '' : 'rotate(180deg)';\r\n        }\r\n    }\r\n\r\n    let div = BB.el({\r\n        css: {\r\n            width: '36px',\r\n            height: '36px',\r\n            background: 'rgba(100, 100, 100, 0.9)',\r\n            color: '#fff',\r\n            position: 'absolute',\r\n            top: '0',\r\n            textAlign: 'center',\r\n            lineHeight: '36px',\r\n            cursor: 'pointer',\r\n            userSelect: 'none',\r\n            padding: '6px',\r\n            boxSizing: 'border-box'\r\n        },\r\n        title: LANG('toggle-show-tools'),\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            isOpen = !isOpen;\r\n            update();\r\n            p.onChange();\r\n        }\r\n    });\r\n\r\n    let icon = BB.el({\r\n        parent: div,\r\n        css: {\r\n            backgroundImage: `url(${collapseImg})`,\r\n            width: '100%',\r\n            height: '100%',\r\n            backgroundSize: 'contain',\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    // --- interface ---\r\n    this.isOpen = function() {\r\n        return isOpen;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param dirStr\r\n     */\r\n    this.setDirection = function(dirStr) {\r\n        directionStr = dirStr;\r\n        update();\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"b1UMP\");","import {BB} from '../../../bb/bb';\r\nimport {renderText} from '../../image-operations/render-text';\r\nimport {ColorOptions} from '../base-components/color-options';\r\nimport {Select} from '../base-components/select';\r\nimport {ImageRadioList} from '../base-components/image-radio-list';\r\nimport {ImageToggle} from '../base-components/image-toggle';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {popup} from './popup';\r\n// @ts-ignore\r\nimport alignLeftImg from 'url:~/src/app/img/ui/align-left.svg';\r\n// @ts-ignore\r\nimport alignCenterImg from 'url:~/src/app/img/ui/align-center.svg';\r\n// @ts-ignore\r\nimport alignRightImg from 'url:~/src/app/img/ui/align-right.svg';\r\n// @ts-ignore\r\nimport typoItalicImg from 'url:~/src/app/img/ui/typo-italic.svg';\r\n// @ts-ignore\r\nimport typoBoldImg from 'url:~/src/app/img/ui/typo-bold.svg';\r\n// @ts-ignore\r\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\r\n// @ts-ignore\r\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\r\nimport {IRGB} from '../../kl.types';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Text Tool dialog\r\n *\r\n * confirmP = {\r\n *     x: number,\r\n *     y: number,\r\n *     textStr: string,\r\n *     align: 'left' | 'center' | 'right',\r\n *     isItalic: boolean,\r\n *     isBold: boolean,\r\n *     color: rgb,\r\n *     size: number, // px\r\n *     font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy',\r\n *     opacity: number, // 0 - 1\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function textToolDialog(\r\n    p: {\r\n        klCanvas: KlCanvas;\r\n        layerIndex: number;\r\n        x: number;\r\n        y: number;\r\n        angleRad: number;\r\n        color: IRGB;\r\n        secondaryColor: IRGB;\r\n        size: number; // px\r\n        align: 'left' | 'center' | 'right'; // default 'left'\r\n        isBold: boolean; // default false\r\n        isItalic: boolean; // default false\r\n        font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\r\n        opacity: number; // 0 - 1; default 1\r\n        onConfirm: (confirmP) => void;\r\n    }\r\n) {\r\n\r\n    let div = BB.el({});\r\n\r\n    let isSmallWidth = window.innerWidth < 550;\r\n    let isSmallHeight = window.innerHeight < 630;\r\n\r\n    // --- preview ---\r\n    // Text drawn on klCanvas-sized canvas: textCanvas\r\n    // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\r\n    //      they are transformed. canvas size of final preview\r\n    // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\r\n    // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\r\n\r\n    let width = isSmallWidth ? 340 : 540;\r\n    let height = isSmallWidth ? (isSmallHeight ? 210 : 260) : (isSmallHeight ? 230 : 350);\r\n    let scale = 1;\r\n\r\n    let layerArr = p.klCanvas.getLayersFast();\r\n    let textCanvas = BB.canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\r\n    let textCtx = textCanvas.getContext('2d');\r\n    let targetCanvas = BB.canvas(width, height);\r\n    let targetCtx = targetCanvas.getContext('2d');\r\n    let layersCanvas = BB.canvas(width, height);\r\n    let layersCtx = layersCanvas.getContext('2d');\r\n    let previewCanvas = BB.canvas(width, height); // the one that is visible\r\n    let previewCtx = previewCanvas.getContext('2d');\r\n    BB.css(previewCanvas, {\r\n        display: 'block'\r\n    });\r\n    let previewWrapper = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'relative',\r\n            width: width + 'px',\r\n            marginLeft: '-20px',\r\n            cursor: 'move',\r\n            colorScheme: 'only light',\r\n            touchAction: 'none',\r\n        },\r\n        onClick: function() {\r\n            textInput.focus();\r\n        }\r\n    });\r\n    BB.el({ // inset shadow on preview\r\n        parent: previewWrapper,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n    previewWrapper.appendChild(previewCanvas);\r\n    let checkerPattern = previewCtx.createPattern(BB.createCheckerCanvas(8), 'repeat');\r\n    let emptyCanvas = BB.canvas(1, 1);\r\n    {\r\n        let ctx = emptyCanvas.getContext('2d');\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    }\r\n\r\n    function updatePreview() {\r\n\r\n        // try to draw very much like klCanvasWorkspace\r\n\r\n        // --- draw text ---\r\n        textCtx.clearRect(0, 0, textCanvas.width, textCanvas.height);\r\n        let colorRGBA = {\r\n            ...p.color,\r\n            a: opacitySlider.getValue(),\r\n        };\r\n        let bounds = renderText(textCanvas, {\r\n            x: p.x,\r\n            y: p.y,\r\n            textStr: textInput.value,\r\n            align: alignRadioList.getValue(),\r\n            isItalic: italicToggle.getValue(),\r\n            isBold: boldToggle.getValue(),\r\n            size: parseFloat(sizeInput.value),\r\n            font: fontSelect.getValue(),\r\n            color: BB.ColorConverter.toRgbaStr(colorRGBA),\r\n            angleRad: p.angleRad\r\n        });\r\n\r\n\r\n        // --- determine transformation of viewport ---\r\n        // text should always be visible\r\n        bounds.width = Math.max(bounds.width, 1);\r\n        bounds.height = Math.max(bounds.height, 1);\r\n        let rotatedXY = BB.rotate(bounds.x, bounds.y, -p.angleRad / Math.PI * 180);\r\n        let rotatedWH = BB.rotate(bounds.width, bounds.height, -p.angleRad / Math.PI * 180);\r\n        let centerX = p.x + rotatedXY.x + rotatedWH.x / 2;\r\n        let centerY = p.y + rotatedXY.y + rotatedWH.y / 2;\r\n\r\n        let padding = 100;\r\n        let fitBounds = BB.fitInto(bounds.width, bounds.height, width - padding, height - padding);\r\n        scale = Math.min(1, fitBounds.width / bounds.width);\r\n        scale = Math.min(4, scale * Math.pow(2, zoomFac));\r\n\r\n\r\n        // --- compose text and target layer ---\r\n        targetCtx.save();\r\n\r\n        if (scale >= 4) {\r\n            targetCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            targetCtx.imageSmoothingEnabled = true;\r\n            targetCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n        }\r\n\r\n        targetCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        targetCtx.translate(width / 2, height / 2);\r\n        targetCtx.scale(scale, scale);\r\n        targetCtx.rotate(p.angleRad);\r\n        targetCtx.drawImage(layerArr[p.layerIndex].canvas, -centerX, -centerY);\r\n        targetCtx.drawImage(textCanvas, -centerX, -centerY);\r\n        targetCtx.restore();\r\n\r\n\r\n        // --- layers ---\r\n        layersCtx.save();\r\n\r\n        layersCtx.fillStyle = 'rgb(158,158,158)';\r\n        layersCtx.fillRect(0, 0, width, height);\r\n\r\n        { // bg\r\n            layersCtx.save();\r\n\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n\r\n            layersCtx.imageSmoothingEnabled = false;\r\n\r\n            //outline\r\n            let borderSize = 1 / scale;\r\n            layersCtx.globalAlpha = 0.2;\r\n            layersCtx.drawImage(emptyCanvas, -centerX - borderSize, -centerY - borderSize, textCanvas.width + borderSize * 2, textCanvas.height + borderSize * 2);\r\n            layersCtx.globalAlpha = 1;\r\n\r\n            //erase\r\n            layersCtx.globalCompositeOperation = 'destination-out';\r\n            layersCtx.drawImage(emptyCanvas, -centerX, -centerY, textCanvas.width, textCanvas.height);\r\n\r\n            layersCtx.restore();\r\n        }\r\n\r\n        { // individual layers\r\n\r\n            if (scale >= 4) {\r\n                layersCtx.imageSmoothingEnabled = false;\r\n            } else {\r\n                layersCtx.imageSmoothingEnabled = true;\r\n                layersCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n            }\r\n\r\n            // layers below\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (var i = 0; i < p.layerIndex; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n            // target layer\r\n            layersCtx.globalAlpha = layerArr[p.layerIndex].opacity;\r\n            layersCtx.globalCompositeOperation = layerArr[p.layerIndex].mixModeStr;\r\n            layersCtx.drawImage(targetCanvas, 0, 0);\r\n\r\n            // layers above\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (let i = p.layerIndex + 1; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n        }\r\n\r\n        layersCtx.restore();\r\n\r\n\r\n\r\n        // --- final composite ---\r\n        previewCtx.save();\r\n        previewCtx.fillStyle = checkerPattern;\r\n        previewCtx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        previewCtx.drawImage(layersCanvas, 0, 0);\r\n        previewCtx.restore();\r\n\r\n        // bounds\r\n        previewCtx.save();\r\n        previewCtx.globalCompositeOperation = 'difference';\r\n        previewCtx.strokeStyle = '#fff';\r\n        previewCtx.lineWidth = 1;\r\n        // centerX = p.x + bounds.x + bounds.width / 2;\r\n        // centerY = p.y + bounds.y + bounds.height / 2;\r\n        previewCtx.strokeRect(\r\n            Math.round(width / 2 - (bounds.width / 2) * scale),\r\n            Math.round(height / 2 - (bounds.height / 2) * scale),\r\n            Math.round(bounds.width * scale),\r\n            Math.round(bounds.height * scale)\r\n        );\r\n        previewCtx.restore();\r\n\r\n    }\r\n\r\n    function move(x, y) {\r\n        let rotated = BB.rotate(x, y, -p.angleRad / Math.PI * 180);\r\n        p.x += rotated.x / scale;\r\n        p.y += rotated.y / scale;\r\n        updatePreview();\r\n    }\r\n\r\n    let previewPointerListener = new BB.PointerListener({\r\n        target: previewCanvas,\r\n        pointers: 1,\r\n        onPointer: function(e) {\r\n            if (e.type === 'pointermove' && e.button) {\r\n                e.eventPreventDefault();\r\n                move(-e.dX, -e.dY);\r\n            }\r\n        },\r\n        onWheel: function(e) {\r\n            changeZoomFac(-e.deltaY);\r\n        }\r\n    });\r\n\r\n    const wheelPrevent = (event) => {\r\n        event.preventDefault();\r\n    }\r\n    BB.addEventListener(previewCanvas, 'wheel', wheelPrevent);\r\n\r\n\r\n\r\n    let row1 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n    let row2n3Wrapper = BB.el({\r\n        parent: div,\r\n        css: isSmallWidth ? {} : {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between'\r\n        }\r\n    });\r\n    let row2 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginTop: '5px'\r\n        }\r\n    });\r\n    let row3 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n            marginTop: '5px',\r\n            width: isSmallWidth ? '' : '300px'\r\n        }\r\n    });\r\n\r\n    // --- row 1 ---\r\n\r\n    // color\r\n    let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n    let colorOptionsArr = [\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 255, g: 255, b: 255, a: 1}\r\n    ];\r\n    colorOptionsArr.unshift({\r\n        r: p.secondaryColor.r,\r\n        g: p.secondaryColor.g,\r\n        b: p.secondaryColor.b,\r\n        a: 1,\r\n    });\r\n    colorOptionsArr.unshift({\r\n        r: p.color.r,\r\n        g: p.color.g,\r\n        b: p.color.b,\r\n        a: 1,\r\n    });\r\n\r\n    let colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        initialIndex: 0,\r\n        onChange: function(rgbaObj) {\r\n            p.color = rgbaObj;\r\n            updatePreview();\r\n        }\r\n    });\r\n    colorOptions.getElement().title = LANG('text-color');\r\n    colorOptions.getElement().style.marginLeft = '-5px';\r\n    row1.appendChild(colorOptions.getElement());\r\n\r\n\r\n    let zoomFac = 0;\r\n    function changeZoomFac(d) {\r\n        zoomFac = Math.min(2, Math.max(-2, zoomFac + d));\r\n        updatePreview();\r\n        zoomInBtn.disabled = !canZoom(1);\r\n        zoomOutBtn.disabled = !canZoom(-1);\r\n    }\r\n    function canZoom(d) {\r\n        return zoomFac !== Math.min(2, Math.max(-2, zoomFac + d));\r\n    }\r\n\r\n    let zoomWrapper = BB.el({\r\n        parent: row1,\r\n        css: {\r\n\r\n        }\r\n    })\r\n\r\n    let zoomInBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomInImg}\">`,\r\n        title: LANG('zoom-in'),\r\n        tagName: 'button',\r\n        onClick: function() {\r\n            changeZoomFac(1);\r\n        },\r\n        css: {\r\n            fontWeight: 'bold'\r\n        }\r\n    }) as HTMLButtonElement;\r\n    let zoomOutBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomOutImg}\">`,\r\n        title: LANG('zoom-out'),\r\n        tagName: 'button',\r\n        onClick: function() {\r\n            changeZoomFac(-1);\r\n        },\r\n        css: {\r\n            fontWeight: 'bold',\r\n            marginLeft: '5px'\r\n        }\r\n    }) as HTMLButtonElement;\r\n\r\n\r\n\r\n    // --- row 2 ---\r\n    let sizeInput = BB.el({\r\n        parent: row2,\r\n        tagName: 'input',\r\n        title: LANG('text-size'),\r\n        custom: {\r\n            type: 'number',\r\n            min: 1,\r\n            max: 10000,\r\n            value: p.size\r\n        },\r\n        css: {\r\n            width: '60px'\r\n        },\r\n        onChange: function() {\r\n            sizeInput.value = '' + Math.max(1, Math.min(10000, parseInt(sizeInput.value)));\r\n            updatePreview();\r\n        }\r\n    }) as HTMLInputElement;\r\n    let sizePointerListener = new BB.PointerListener({\r\n        target: sizeInput,\r\n        onWheel: function(e) {\r\n            sizeInput.value = '' + Math.max(1, Math.min(1000, parseInt(sizeInput.value) - e.deltaY));\r\n            updatePreview();\r\n        }\r\n    });\r\n\r\n    let modeWrapper;\r\n    let fontSelect;\r\n    let fontPointerListener;\r\n    {\r\n        modeWrapper = BB.el({\r\n            css: {\r\n                fontSize: '15px',\r\n                marginLeft: '10px'\r\n            }\r\n        });\r\n        fontSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['sans-serif', 'Sans-serif'],\r\n                ['serif', 'Serif'],\r\n                ['monospace', 'Monospace'],\r\n                ['cursive', 'Cursive'],\r\n                ['fantasy', 'Fantasy'],\r\n            ],\r\n            initValue: p.font,\r\n            onChange: function(val) {\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        modeWrapper.appendChild(fontSelect.getElement());\r\n        row2.appendChild(modeWrapper);\r\n\r\n        fontPointerListener = new BB.PointerListener({\r\n            target: fontSelect.getElement(),\r\n            onWheel: function(e) {\r\n                fontSelect.setDeltaValue(e.deltaY);\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n    // --- row 3 ---\r\n\r\n    let alignRadioList = new ImageRadioList({\r\n        optionArr: [\r\n            {\r\n                id: 'left',\r\n                title: LANG('text-left'),\r\n                image: alignLeftImg,\r\n            },\r\n            {\r\n                id: 'center',\r\n                title: LANG('text-center'),\r\n                image: alignCenterImg,\r\n            },\r\n            {\r\n                id: 'right',\r\n                title: LANG('text-right'),\r\n                image: alignRightImg,\r\n            }\r\n        ],\r\n        initId: p.align,\r\n        onChange: function(id) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(alignRadioList.getElement());\r\n\r\n    let italicToggle = new ImageToggle({\r\n        image: typoItalicImg,\r\n        title: LANG('text-italic'),\r\n        initValue: p.isItalic,\r\n        onChange: function(b) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(italicToggle.getElement());\r\n\r\n    let boldToggle = new ImageToggle({\r\n        image: typoBoldImg,\r\n        title: LANG('text-bold'),\r\n        initValue: p.isBold,\r\n        onChange: function(b) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(boldToggle.getElement());\r\n\r\n\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 150,\r\n        height: 30,\r\n        min: 1 / 100,\r\n        max: 1,\r\n        value: p.opacity,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        toValue: (displayValue) => displayValue / 100,\r\n        toDisplayValue: (value) => value * 100,\r\n        onChange: function(v) {\r\n            updatePreview();\r\n        },\r\n    });\r\n    row3.appendChild(opacitySlider.getElement());\r\n\r\n\r\n\r\n    let textInput = BB.el({\r\n        parent: div,\r\n        tagName: 'textarea',\r\n        custom: {\r\n            placeholder: LANG('text-placeholder'),\r\n            'data-ignore-focus': 'true',\r\n        },\r\n        css: {\r\n            whiteSpace: 'pre',\r\n            overflow: 'auto',\r\n            width: '100%',\r\n            height: '70px',\r\n            resize: 'vertical',\r\n            marginTop: '10px'\r\n        },\r\n        onChange: function() {\r\n            updatePreview();\r\n        }\r\n    }) as HTMLTextAreaElement;\r\n    textInput.addEventListener('input', updatePreview);\r\n    setTimeout(function() {\r\n        textInput.focus();\r\n        textInput.select();\r\n    });\r\n    let closefunc;\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e, comboStr) {\r\n            if (BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    // prevent mobile keyboards scrolling page\r\n    function onScroll() {\r\n        window.scrollTo(0, 0);\r\n    }\r\n    window.addEventListener('scroll', onScroll);\r\n\r\n\r\n    popup({\r\n        target: document.body,\r\n        message: `<b>${LANG('text-title')}</b>`,\r\n        div: div,\r\n        buttons: [\"Ok\", \"Cancel\"],\r\n        style: isSmallWidth ? {} : {\r\n            width: '500px'\r\n        },\r\n        callback: function(val) {\r\n            let result = {\r\n                x: p.x,\r\n                y: p.y,\r\n                textStr: textInput.value,\r\n                align: alignRadioList.getValue(),\r\n                isItalic: italicToggle.getValue(),\r\n                isBold: boldToggle.getValue(),\r\n                color: p.color,\r\n                size: sizeInput.value,\r\n                font: fontSelect.getValue(),\r\n                opacity: opacitySlider.getValue(),\r\n            };\r\n\r\n            window.removeEventListener('scroll', onScroll);\r\n            textInput.removeEventListener('input', updatePreview);\r\n            BB.destroyEl(textInput);\r\n            previewPointerListener.destroy();\r\n            sizePointerListener.destroy();\r\n            fontPointerListener.destroy();\r\n            BB.removeEventListener(previewCanvas, 'wheel', wheelPrevent);\r\n            BB.destroyEl(previewWrapper);\r\n            BB.destroyEl(zoomInBtn);\r\n            BB.destroyEl(zoomOutBtn);\r\n            BB.destroyEl(sizeInput);\r\n            colorOptions.destroy();\r\n            fontSelect.destroy();\r\n            keyListener.destroy();\r\n            alignRadioList.destroy();\r\n            italicToggle.destroy();\r\n            boldToggle.destroy();\r\n            opacitySlider.destroy();\r\n            if (val === 'Ok') {\r\n                p.onConfirm(result);\r\n            }\r\n        },\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        ignoreBackground: true,\r\n        closefunc: function (func) {\r\n            closefunc = func;\r\n        },\r\n    });\r\n\r\n    updatePreview();\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"lvwQ5\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"imAvm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dC0sF\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h3hPo\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1pAeY\");","import {BB} from '../../../bb/bb';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n *\r\n * p = {\r\n *     image: convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas},\r\n *     maxSize: number,\r\n *     target: htmlElement,\r\n *     callback: func(\r\n *         {\r\n *             type: 'as-image',\r\n *             image: image | canvas,\r\n *         } | {\r\n *             type: 'as-image-psd',\r\n *             image: convertedPsd,\r\n *             cropObj: {x: number, y: number, width: number, height: number}\r\n *         } | {\r\n *             type: 'as-layer',\r\n *             image: image | canvas,\r\n *         } | {\r\n *             type: 'cancel',\r\n *         }\r\n *     )\r\n * }\r\n *\r\n * @param p {}\r\n */\r\nexport function showImportImageDialog(p) {\r\n    const div = BB.el({});\r\n\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n    const style = isSmall ? {} : { width: '500px' };\r\n    let resolutionEl;\r\n    const cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 400,\r\n        canvas: p.image.canvas,\r\n        isNotCopy: true,\r\n        onChange: function(width, height) {\r\n            if (!resolutionEl) {\r\n                return;\r\n            }\r\n            updateResolution(width, height);\r\n        }\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginLeft: '-20px',\r\n        borderTop: '1px solid #bbb',\r\n        borderBottom: '1px solid #bbb'\r\n    });\r\n    cropCopy.getEl().title = LANG('crop-drag-to-crop');\r\n    div.appendChild(cropCopy.getEl());\r\n\r\n\r\n    resolutionEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginTop: '10px',\r\n            textAlign: 'center',\r\n            color: '#888',\r\n            lineHeight: '20px',\r\n        }\r\n    });\r\n    function updateResolution(w: number, h: number) {\r\n        const fit = BB.fitInto(w, h, p.maxSize, p.maxSize);\r\n\r\n        if (fit.width < w) {\r\n            resolutionEl.innerHTML = `<span style=\"color:#f00\">${w} X ${h}</span>  ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\r\n            resolutionEl.title = LANG('import-too-large');\r\n        } else {\r\n            resolutionEl.innerHTML = `${w} X ${h}`;\r\n            resolutionEl.title = '';\r\n        }\r\n    }\r\n    updateResolution(p.image.width, p.image.height);\r\n\r\n\r\n    let doFlatten = false;\r\n    function showWarnings(psdWarningArr) {\r\n        let contentArr = [];\r\n        let warningMap = {\r\n            'mask': 'Masks not supported. Mask was applied.',\r\n            'clipping': 'Clipping not supported. Clipping layers were merged.',\r\n            'group': 'Groups not supported. Layers were ungrouped.',\r\n            'adjustment': 'Adjustment layers not supported.',\r\n            'layer-effect': 'Layer effects not supported.',\r\n            'smart-object': 'Smart objects not supported.',\r\n            'blend-mode': 'Unsupported layer blend mode.',\r\n            'bits-per-channel': 'Unsupported color depth. Only 8bit per channel supported.',\r\n        };\r\n        for (let i = 0; i < psdWarningArr.length; i++) {\r\n            contentArr.push('- ' + warningMap[psdWarningArr[i]]);\r\n        }\r\n        alert(contentArr.join(\"\\n\"));\r\n    }\r\n\r\n    let flattenCheckbox;\r\n    if (p.image.type === 'psd') {\r\n        const noteStyle = {\r\n            background: 'rgba(255,255,0,0.5)',\r\n            padding: '10px',\r\n            marginTop: '5px',\r\n            marginBottom: '5px',\r\n            border: '1px solid #e7d321',\r\n            borderRadius: '5px'\r\n        };\r\n        if (p.image.layers) {\r\n            flattenCheckbox = new Checkbox({\r\n                init: doFlatten,\r\n                label: LANG('import-flatten'),\r\n                callback: function(b) {\r\n                    doFlatten = b;\r\n                }\r\n            });\r\n            div.appendChild(flattenCheckbox.getElement());\r\n\r\n            if (p.image.warningArr) {\r\n                const noteEl = BB.el({\r\n                    content: LANG('import-psd-limited-support'),\r\n                    css: noteStyle\r\n                });\r\n                noteEl.appendChild(BB.el({\r\n                    tagName: 'a',\r\n                    content: 'Details',\r\n                    onClick: function() {\r\n                        showWarnings(p.image.warningArr);\r\n                    }\r\n                }));\r\n                div.appendChild(noteEl);\r\n            }\r\n        } else {\r\n            const noteEl = BB.el({\r\n                content: LANG('import-psd-unsupported'),\r\n                css: noteStyle\r\n            });\r\n            div.appendChild(noteEl);\r\n        }\r\n    }\r\n\r\n    function callback(result) {\r\n        const croppedImage = cropCopy.getCroppedImage();\r\n        const cropRect = cropCopy.getRect();\r\n        const isCropped = p.image.width !== cropRect.width && p.image.height !== cropRect.height;\r\n        cropCopy.destroy();\r\n        if (flattenCheckbox) {\r\n            flattenCheckbox.destroy();\r\n        }\r\n\r\n        if (result === LANG('import-btn-as-layer')) {\r\n            p.callback({\r\n                type: 'as-layer',\r\n                image: isCropped ? croppedImage : p.image.canvas,\r\n            });\r\n\r\n        } else if (result === LANG('import-btn-as-image')) {\r\n            if (p.image.type === 'psd') {\r\n                if (doFlatten) {\r\n                    p.image.layers = null;\r\n                }\r\n                p.callback({\r\n                    type: 'as-image-psd',\r\n                    image: p.image,\r\n                    cropObj: cropRect\r\n                });\r\n            } else if (p.image.type === 'image') {\r\n                p.callback({\r\n                    type: 'as-image',\r\n                    image: croppedImage\r\n                });\r\n            }\r\n        } else {\r\n            p.callback({\r\n                type: 'cancel'\r\n            });\r\n        }\r\n    }\r\n    popup({\r\n        target: p.target,\r\n        message: `<b>${LANG('import-title')}</b>`,\r\n        div: div,\r\n        style,\r\n        buttons: [LANG('import-btn-as-layer'), LANG('import-btn-as-image'), \"Cancel\"],\r\n        primaries: [LANG('import-btn-as-layer'), LANG('import-btn-as-image')],\r\n        callback: callback,\r\n        autoFocus: 'As Image'\r\n    });\r\n}","import {createCanvas} from '../../bb/base/create-canvas';\r\nimport {Psd} from 'ag-psd/dist/psd';\r\nimport {IKlProject, IKlPsd, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {MAX_LAYERS} from '../canvas/kl-canvas';\r\n\r\nlet kl2PsdMap;\r\nlet psd2KlMap;\r\n\r\nfunction init() {\r\n    if (kl2PsdMap) {\r\n        return;\r\n    }\r\n\r\n    kl2PsdMap = {\r\n        'source-over': 'normal',\r\n\r\n        'darken': 'darken',\r\n        'multiply': 'multiply',\r\n        'color-burn': 'color burn',\r\n\r\n        'lighten': 'lighten',\r\n        'screen': 'screen',\r\n        'color-dodge': 'color dodge',\r\n\r\n        'overlay': 'overlay',\r\n        'soft-light': 'soft light',\r\n        'hard-light': 'hard light',\r\n\r\n        'difference': 'difference',\r\n        'exclusion': 'exclusion',\r\n\r\n        'hue': 'hue',\r\n        'saturation': 'saturation',\r\n        'color': 'color',\r\n        'luminosity': 'luminosity',\r\n    };\r\n\r\n    psd2KlMap = {};\r\n    let keys = Object.keys(kl2PsdMap);\r\n    for (let i = 0; i < keys.length; i++) {\r\n        psd2KlMap[kl2PsdMap[keys[i]]] = keys[i];\r\n    }\r\n}\r\n\r\nexport function blendPsdToKl(str: string): IMixMode {\r\n    init();\r\n    return psd2KlMap[str];\r\n}\r\n\r\nexport function blendKlToPsd(str: string): string {\r\n    init();\r\n    return kl2PsdMap[str];\r\n}\r\n\r\n\r\n/**\r\n * Converts ag-psd object into something that KlCanvas can represent\r\n * @param psdObj\r\n */\r\nexport function readPsd(psdObj: Psd): IKlPsd {\r\n    let result: IKlPsd = {\r\n        type: 'psd',\r\n        canvas: psdObj.canvas,\r\n        width: psdObj.width,\r\n        height: psdObj.height\r\n    };\r\n\r\n    function addWarning(warningStr) {\r\n        if (!result.warningArr) {\r\n            result.warningArr = [];\r\n        }\r\n        if (result.warningArr.includes(warningStr)) {\r\n            return;\r\n        }\r\n        result.warningArr.push(warningStr);\r\n    }\r\n\r\n    function getMixModeStr(blendMode): IMixMode {\r\n        let mixModeStr: IMixMode = blendPsdToKl(blendMode);\r\n        if (!mixModeStr) {\r\n            addWarning('blend-mode');\r\n            mixModeStr = 'source-over';\r\n        }\r\n        return mixModeStr;\r\n    }\r\n\r\n    if (psdObj.bitsPerChannel !== 8) {\r\n        addWarning('bits-per-channel');\r\n    }\r\n\r\n    if (!psdObj.children) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    // count resulting layers\r\n    let maxLayers = MAX_LAYERS;\r\n    let layerCount = 0;\r\n    function countWithinGroup(groupObj) {\r\n        let result = 0;\r\n        if (groupObj.blendMode) {\r\n            let mixModeStr = blendPsdToKl(groupObj.blendMode);\r\n            if (mixModeStr && mixModeStr !== 'source-over') {\r\n                return 1;\r\n            }\r\n        }\r\n        for (let i = 0; i < groupObj.children.length; i++) {\r\n            let item = groupObj.children[i];\r\n            if (item.clipping || item.adjustment) {\r\n                continue;\r\n            }\r\n\r\n            if (item.children) {\r\n                addWarning('group');\r\n                result += countWithinGroup(item);\r\n            } else {\r\n                result++;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    layerCount += countWithinGroup(psdObj);\r\n    if (layerCount > maxLayers) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    result.layers = [];\r\n\r\n    function prepareMask(maskCanvas, defaultColor) {\r\n        const groupMaskCtx = maskCanvas.getContext('2d');\r\n        let imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n        if (defaultColor === 0) {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = imData.data[i];\r\n            }\r\n        } else {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = 255 - imData.data[i];\r\n            }\r\n        }\r\n        groupMaskCtx.putImageData(imData, 0, 0);\r\n    }\r\n\r\n    function convertGroup(psdGroupObj): {\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n        opacity: number;\r\n        image: HTMLCanvasElement;\r\n    }[] {\r\n\r\n        let resultArr: {\r\n            name: string;\r\n            mixModeStr: IMixMode;\r\n            opacity: number;\r\n            image: HTMLCanvasElement;\r\n        }[] = [];\r\n        let groupOpacity = psdGroupObj.hidden ? 0 : psdGroupObj.opacity;\r\n        let groupMixModeStr = getMixModeStr(psdGroupObj.blendMode);\r\n        let groupCanvas;\r\n        let groupCtx;\r\n        if (groupMixModeStr !== 'source-over') {\r\n            groupCanvas = createCanvas(result.width, result.height);\r\n            groupCtx = groupCanvas.getContext('2d');\r\n        }\r\n\r\n\r\n        // prepare group mask\r\n        if (psdGroupObj.mask) {\r\n            addWarning('mask');\r\n            prepareMask(psdGroupObj.mask.canvas, psdGroupObj.mask.defaultColor);\r\n        }\r\n\r\n\r\n        for (let i = 0; i < psdGroupObj.children.length; i++) {\r\n            let item = psdGroupObj.children[i];\r\n            if (item.clipping) {\r\n                continue;\r\n            }\r\n            if (item.adjustment) {\r\n                addWarning('adjustment');\r\n                continue;\r\n            }\r\n\r\n            let hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\r\n            if (hasClipping) {\r\n                addWarning('clipping');\r\n            }\r\n\r\n            if (item.children) {\r\n                let innerArr = convertGroup(item);\r\n\r\n                for (let e = 0; e < innerArr.length; e++) {\r\n                    let innerItem = innerArr[e];\r\n                    let innerCtx = innerItem.image.getContext('2d');\r\n\r\n                    // clipping\r\n                    if (hasClipping) {\r\n                        let clippingCanvas = createCanvas(result.width, result.height);\r\n                        let clippingCtx = clippingCanvas.getContext('2d');\r\n                        clippingCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                        for (let f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++) {\r\n                            let clippingItem = psdGroupObj.children[f];\r\n                            if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                                continue;\r\n                            }\r\n                            clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                            clippingCtx.globalAlpha = clippingItem.opacity;\r\n                            clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\r\n                        }\r\n\r\n                        innerCtx.globalCompositeOperation = 'source-atop';\r\n                        innerCtx.drawImage(clippingCanvas, 0, 0);\r\n                    }\r\n\r\n\r\n\r\n                    // group mask\r\n                    if (psdGroupObj.mask) {\r\n                        innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                        innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n                    }\r\n\r\n                    if (groupCanvas) {\r\n                        groupCtx.globalCompositeOperation = innerItem.mixModeStr;\r\n                        groupCtx.globalAlpha = innerItem.opacity;\r\n                        groupCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                    } else {\r\n                        innerItem.opacity = innerItem.opacity * groupOpacity;\r\n                        resultArr.push(innerItem);\r\n                    }\r\n                }\r\n\r\n                continue;\r\n            }\r\n\r\n            let canvas = createCanvas(result.width, result.height);\r\n            let ctx = canvas.getContext('2d');\r\n            if (item.canvas) { // if a layer is empty it has no canvas\r\n                ctx.drawImage(item.canvas, item.left, item.top);\r\n            }\r\n\r\n            // effects\r\n            if (item.effects) {\r\n                addWarning('layer-effect');\r\n            }\r\n\r\n            // mask\r\n            if (item.mask) {\r\n                addWarning('mask');\r\n                prepareMask(item.mask.canvas, item.mask.defaultColor);\r\n\r\n                ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\r\n            }\r\n\r\n            // clipping\r\n            if (hasClipping) {\r\n                let clippingCanvas = createCanvas(item.right - item.left, item.bottom - item.top);\r\n                let clippingCtx = clippingCanvas.getContext('2d');\r\n                clippingCtx.drawImage(item.canvas, 0, 0);\r\n\r\n                for (let e = i + 1; e < psdGroupObj.children.length && psdGroupObj.children[e].clipping; e++) {\r\n                    let clippingItem = psdGroupObj.children[e];\r\n                    if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                        continue;\r\n                    }\r\n                    clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                    clippingCtx.globalAlpha = clippingItem.opacity;\r\n                    clippingCtx.drawImage(clippingItem.canvas, clippingItem.left - item.left, clippingItem.top - item.top);\r\n                }\r\n\r\n                ctx.globalCompositeOperation = 'source-atop';\r\n                ctx.drawImage(clippingCanvas, item.left, item.top);\r\n            }\r\n\r\n            // group mask\r\n            if (psdGroupObj.mask) {\r\n                ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n            }\r\n\r\n            if (groupCanvas) {\r\n                if (groupOpacity > 0) {\r\n                    groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\r\n                    groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\r\n                    groupCtx.drawImage(canvas, 0, 0);\r\n                }\r\n\r\n            } else {\r\n                resultArr.push({\r\n                    name: item.name,\r\n                    opacity: (item.hidden ? 0 : item.opacity) * groupOpacity,\r\n                    mixModeStr: getMixModeStr(item.blendMode),\r\n                    image: canvas,\r\n                });\r\n            }\r\n        }\r\n\r\n        if (groupCanvas) {\r\n            resultArr = [\r\n                {\r\n                    name: psdGroupObj.name,\r\n                    opacity: groupOpacity,\r\n                    mixModeStr: groupMixModeStr,\r\n                    image: groupCanvas,\r\n                }\r\n            ];\r\n        }\r\n\r\n        return resultArr;\r\n    }\r\n\r\n    result.layers = convertGroup({\r\n        name: 'root',\r\n        opacity: 1,\r\n        blendMode: 'normal',\r\n        children: psdObj.children\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\nexport function klPsdToKlProject(klPsd: IKlPsd): IKlProject {\r\n    // only share references to Canvas elements\r\n    const result: IKlProject = {\r\n        width: klPsd.width,\r\n        height: klPsd.height,\r\n        layers: [],\r\n    };\r\n    if (klPsd.layers) {\r\n        result.layers = result.layers.concat(klPsd.layers.map(item => {\r\n            return {\r\n                name: item.name,\r\n                opacity: item.opacity,\r\n                mixModeStr: item.mixModeStr,\r\n                image: item.image,\r\n            };\r\n        }));\r\n    } else {\r\n        // flattened\r\n        result.layers.push({\r\n            name: LANG('background'),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over',\r\n            image: klPsd.canvas,\r\n        });\r\n    }\r\n    return result;\r\n}","//browser storage indexedDB\r\n\r\n\r\nimport {IKlStorageProject} from '../kl.types';\r\n\r\nconst indexedDbIsSupported = !!window.indexedDB;\r\nlet dbNameStr = 'Klecks';\r\nconst storageNameStr = 'ProjectStore';\r\n\r\nexport function setDbName(name: string) {\r\n    dbNameStr = '' + name;\r\n}\r\n\r\n/**\r\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\r\n * with index 'id'\r\n *\r\n * @param actionFunction function(storeObj) - what you want to execute during transaction\r\n * @param successCallback function() - on succesful transaction\r\n * @param errorCallback function(errorStr) - on error\r\n */\r\nfunction execIndexedDBTransaction(actionFunction, successCallback, errorCallback) {\r\n\r\n    let hasFinished = false;\r\n\r\n    function onSuccess() {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        successCallback();\r\n    }\r\n\r\n    function onError(errorStr) {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        errorCallback(errorStr);\r\n    }\r\n\r\n    if (!indexedDbIsSupported) {\r\n        setTimeout(function () {\r\n            onError('no indexed db available');\r\n        }, 0);\r\n        return;\r\n    }\r\n    let requestObj;\r\n\r\n    try {\r\n        requestObj = window.indexedDB.open(dbNameStr, 1);\r\n    } catch (e) {\r\n        onError(e.message);\r\n        return;\r\n    }\r\n\r\n    requestObj.onupgradeneeded = function (e) {\r\n        try {\r\n            let db = requestObj.result;\r\n            let store = db.createObjectStore(storageNameStr, {keyPath: 'id'});\r\n            store.createIndex('id', 'id', {unique: true});\r\n        } catch (e) {\r\n            onError(e.message);\r\n        }\r\n    };\r\n    requestObj.onerror = function (e) {\r\n        onError('indexedDB.open failed, ' + requestObj.error);\r\n    };\r\n    requestObj.onsuccess = function (e) {\r\n        let databaseObj;\r\n        let transactionObj;\r\n        let storeObj;\r\n\r\n        try {\r\n            databaseObj = requestObj.result;\r\n            if (!databaseObj.objectStoreNames.contains(storageNameStr)) {\r\n                //someone maybe messed with the db, or creation failed earlier\r\n                //it's broken -> destroy\r\n                window.indexedDB.deleteDatabase(dbNameStr);\r\n                onError('object store ' + storageNameStr + ' missing. destroying db');\r\n                return;\r\n            }\r\n            transactionObj = databaseObj.transaction(storageNameStr, 'readwrite');\r\n            storeObj = transactionObj.objectStore(storageNameStr);\r\n            storeObj.index('id');\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        databaseObj.onerror = function (e) {\r\n            onError('database error, ' + databaseObj.error);\r\n        };\r\n\r\n        try {\r\n            actionFunction(storeObj);\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        transactionObj.oncomplete = function () {\r\n            onSuccess();\r\n            databaseObj.close();\r\n        };\r\n        transactionObj.onerror = function () {\r\n            onError('transaction error, ' + transactionObj.error);\r\n        };\r\n    };\r\n}\r\n\r\n/**\r\n * getKlProjectObj {\r\n *     width: int,\r\n *     height: int,\r\n *     layers: {\r\n *        name: string,\r\n *        opacity: float (0 - 1),\r\n *        mixModeStr: string,\r\n *        image: image object                <--------- image already loaded!\r\n *     }[]\r\n * }\r\n *\r\n * @param successCallback function - called when succesfully queried. passes KlProjectObj\r\n * @param errorCallback - function(errorStr) - called when error during query\r\n */\r\nexport function getKlProjectObj(successCallback, errorCallback) {\r\n    if (indexedDbIsSupported) {\r\n        let query;\r\n        execIndexedDBTransaction(function (storeObj) {\r\n            query = storeObj.get(1);\r\n        }, function () {\r\n            successCallback(query.result);\r\n        }, function (errorStr) {\r\n            errorCallback('execIndexedDBTransaction error, ' + errorStr);\r\n        });\r\n    } else {\r\n        successCallback(null);\r\n    }\r\n}\r\n\r\n/**\r\n * stores a klProjectObj into id = 1 in database:dbNameStr > storage: storageNameStr\r\n *\r\n * KlProjectObj {\r\n *     width: int,\r\n *     height: int,\r\n *     layers: {\r\n *        name: string,\r\n *        opacity: float (0 - 1),\r\n *        mixModeStr: string,\r\n *        blob: blob object                 <--------- blob!\r\n *     }[]\r\n * }\r\n *\r\n * @param storageProject IKlStorageProject - project to be stored\r\n * @param successCallback function() - on successful transaction\r\n * @param errorCallback function(errorStr) - on error\r\n */\r\nexport function storeKlProjectObj(storageProject: IKlStorageProject, successCallback, errorCallback) {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.put(storageProject);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (errorStr) {\r\n        errorCallback(errorStr);\r\n    });\r\n\r\n}\r\n\r\n/**\r\n * removes id = 1 from database:dbNameStr > storage: storageNameStr\r\n *\r\n * @param successCallback function() - on successful transaction\r\n * @param errorCallback function(error) - on error\r\n */\r\nexport function clear(successCallback, errorCallback) {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.delete(1);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (error) {\r\n        errorCallback(error);\r\n    });\r\n\r\n}\r\n","import {IFilter} from '../kl.types';\r\n// @ts-ignore\r\nimport glBrightnessContrastImg from 'url:~/src/app/img/ui/edit-brightness-contrast.svg';\r\n// @ts-ignore\r\nimport cropExtendImg from 'url:~/src/app/img/ui/edit-crop.svg';\r\n// @ts-ignore\r\nimport glCurvesImg from 'url:~/src/app/img/ui/edit-curves.svg';\r\n// @ts-ignore\r\nimport flipImg from 'url:~/src/app/img/ui/edit-flip.svg';\r\n// @ts-ignore\r\nimport glHueSaturationImg from 'url:~/src/app/img/ui/edit-hue-saturation.svg';\r\n// @ts-ignore\r\nimport invertImg from 'url:~/src/app/img/ui/edit-invert.png';\r\n// @ts-ignore\r\nimport glPerspectiveImg from 'url:~/src/app/img/ui/edit-perspective.svg';\r\n// @ts-ignore\r\nimport resizeImg from 'url:~/src/app/img/ui/edit-resize.svg';\r\n// @ts-ignore\r\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\r\n// @ts-ignore\r\nimport glTiltShiftImg from 'url:~/src/app/img/ui/edit-tilt-shift.png';\r\n// @ts-ignore\r\nimport toAlphaImg from 'url:~/src/app/img/ui/edit-to-alpha.svg';\r\n// @ts-ignore\r\nimport transformImg from 'url:~/src/app/img/ui/edit-transform.svg';\r\n// @ts-ignore\r\nimport glBlurImg from 'url:~/src/app/img/ui/edit-triangle-blur.png';\r\n// @ts-ignore\r\nimport glUnsharpMaskImg from 'url:~/src/app/img/ui/edit-unsharp-mask.png';\r\n// @ts-ignore\r\nimport gridImg from 'url:~/src/app/img/ui/edit-grid.svg';\r\n// @ts-ignore\r\nimport noiseImg from 'url:~/src/app/img/ui/edit-noise.svg';\r\n// @ts-ignore\r\nimport patternImg from 'url:~/src/app/img/ui/edit-pattern.svg';\r\n// @ts-ignore\r\nimport vanishPointImg from 'url:~/src/app/img/ui/edit-vanish-point.svg';\r\n// @ts-ignore\r\nimport distortImg from 'url:~/src/app/img/ui/edit-distort.svg';\r\n\r\n\r\nexport const filterLibStatus = {\r\n    isLoaded: false,\r\n};\r\nexport const filterLib: {\r\n    [key:string]: IFilter;\r\n} = {\r\n    brightnessContrast: {\r\n        lang: {name: 'filter-bright-contrast-title', button: 'filter-bright-contrast'},\r\n        icon: glBrightnessContrastImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    cropExtend: {\r\n        lang: {name: 'filter-crop-title', button: 'filter-crop-extend'},\r\n        icon: cropExtendImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    curves: {\r\n        lang: {name: 'filter-curves-title', button: 'filter-curves'},\r\n        icon: glCurvesImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    distort: {\r\n        lang: {name: 'filter-distort', button: 'filter-distort'},\r\n        icon: distortImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    flip: {\r\n        lang: {name: 'filter-flip-title', button: 'filter-flip'},\r\n        icon: flipImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    hueSaturation: {\r\n        lang: {name: 'filter-hue-sat-title', button: 'filter-hue-sat'},\r\n        icon: glHueSaturationImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    invert: {\r\n        lang: {name: 'filter-invert', button: 'filter-invert'},\r\n        icon: invertImg,\r\n        updatePos: false,\r\n        isInstant: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    perspective: {\r\n        lang: {name: 'filter-perspective-title', button: 'filter-perspective'},\r\n        icon: glPerspectiveImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    resize: {\r\n        lang: {name: 'filter-resize-title', button: 'filter-resize'},\r\n        icon: resizeImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    rotate: {\r\n        lang: {name: 'filter-rotate-title', button: 'filter-rotate'},\r\n        icon: rotateImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    tiltShift: {\r\n        lang: {name: 'filter-tilt-shift-title', button: 'filter-tilt-shift'},\r\n        icon: glTiltShiftImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    toAlpha: {\r\n        lang: {name: 'filter-to-alpha-title', button: 'filter-to-alpha'},\r\n        icon: toAlphaImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    transform: {\r\n        lang: {name: 'filter-transform-title', button: 'filter-transform'},\r\n        icon: transformImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    blur: {\r\n        lang: {name: 'filter-triangle-blur-title', button: 'filter-triangle-blur'},\r\n        icon: glBlurImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    unsharpMask: {\r\n        lang: {name: 'filter-unsharp-mask-title', button: 'filter-unsharp-mask'},\r\n        icon: glUnsharpMaskImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    grid: {\r\n        lang: {name: 'filter-grid', button: 'filter-grid'},\r\n        icon: gridImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    noise: {\r\n        lang: {name: 'filter-noise', button: 'filter-noise'},\r\n        icon: noiseImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    pattern: {\r\n        lang: {name: 'filter-pattern', button: 'filter-pattern'},\r\n        icon: patternImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    vanishPoint: {\r\n        lang: {name: 'filter-vanish-point-title', button: 'filter-vanish-point'},\r\n        icon: vanishPointImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n};\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"5tPq3\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cazOx\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"245NA\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1hkCG\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"k2eFf\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"krKGd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ehfxY\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"beOjS\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"Gk9bV\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"csed7\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"equSE\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h1dN3\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"LfAXI\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cB6q6\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"S9ano\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"4eqRj\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"8mvSV\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kbc0v\");","import {PenBrush} from './pen-brush';\r\nimport {BlendBrush} from './blend-brush';\r\nimport {SketchyBrush} from './sketchy-brush';\r\nimport {PixelBrush} from './pixel-brush';\r\nimport {EraserBrush} from './eraser-brush';\r\nimport {SmudgeBrush} from './smudge-brush';\r\nimport {ChemyBrush} from './chemy-brush';\r\n\r\nexport const brushes = {\r\n    PenBrush,\r\n    BlendBrush,\r\n    SketchyBrush,\r\n    PixelBrush,\r\n    ChemyBrush,\r\n    SmudgeBrush,\r\n    EraserBrush,\r\n}","import {BB} from '../../bb/bb';\r\nimport {alphaImArr} from './brushes-common';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\n\r\nexport function PenBrush() {\r\n\r\n    let context;\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n\r\n    let settingColor, settingSize = 2, settingSpacing = 0.8489, settingOpacity = 1;\r\n    let settingColorStr;\r\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\r\n    let settingLockLayerAlpha = false;\r\n    let ALPHA_CIRCLE = 0, ALPHA_CHALK = 1, ALPHA_CAL = 2, ALPHA_SQUARE = 3;\r\n    let settingAlphaId = ALPHA_CIRCLE;\r\n\r\n    let lineToolLastDot;\r\n    let lastInput = {x: 0, y: 0, pressure: 0};\r\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\r\n\r\n    let isDrawing = false;\r\n    let alphaOpacityArr = [1, 0.9, 1, 1];\r\n\r\n    //mipmapping\r\n    let alphaCanvas128 = BB.canvas(128, 128);\r\n    let alphaCanvas64 = BB.canvas(64, 64);\r\n    let alphaCanvas32 = BB.canvas(32, 32);\r\n\r\n    let bezierLine = null;\r\n\r\n    let twoPI = Math.PI * 2;\r\n    let hasDrawnDot = false; // current stroke has drawn at least one dot\r\n    let inputArr: {x: number, y: number, pressure: number}[];\r\n\r\n    // pressure: 0-1\r\n    function calcOpacity(pressure: number) {\r\n        return settingOpacity * (settingHasOpacityPressure ? pressure * pressure : 1);\r\n    }\r\n\r\n    function updateAlphaCanvas() {\r\n        if (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE) {\r\n            return;\r\n        }\r\n\r\n        let instructionArr = [\r\n            [alphaCanvas128, 128],\r\n            [alphaCanvas64, 64],\r\n            [alphaCanvas32, 32]\r\n        ];\r\n\r\n        let ctx;\r\n\r\n        for (let i = 0; i < instructionArr.length; i++) {\r\n            ctx = (instructionArr[i][0] as any).getContext(\"2d\");\r\n\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.fillStyle = \"rgba(\" + settingColor.r + \", \" + settingColor.g + \", \" + settingColor.b + \", \" + alphaOpacityArr[settingAlphaId] + \")\";\r\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.globalCompositeOperation = \"destination-in\";\r\n            ctx.imageSmoothingQuality = 'high';\r\n            ctx.drawImage(alphaImArr[settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.restore();\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     * @param angle\r\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\r\n     */\r\n    function drawDot(x, y, size, opacity, angle?, before?) {\r\n        if (size <= 0) {\r\n            return;\r\n        }\r\n\r\n        if (settingLockLayerAlpha) {\r\n            context.globalCompositeOperation = \"source-atop\";\r\n        }\r\n\r\n        if (!before || before[3] !== opacity) {\r\n            context.globalAlpha = opacity;\r\n        }\r\n\r\n        if (!before && (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE)) {\r\n            context.fillStyle = settingColorStr;\r\n        }\r\n\r\n        if (settingAlphaId === ALPHA_CIRCLE) {\r\n            context.beginPath();\r\n            context.arc(x, y, size, 0, twoPI);\r\n            context.closePath();\r\n            context.fill();\r\n            hasDrawnDot = true;\r\n\r\n        } else if (settingAlphaId === ALPHA_SQUARE) {\r\n            if (angle !== undefined) {\r\n                context.save();\r\n                context.translate(x, y);\r\n                context.rotate(angle / 180 * Math.PI);\r\n                context.fillRect(-size, -size, size * 2, size * 2);\r\n                context.restore();\r\n                hasDrawnDot = true;\r\n            }\r\n\r\n        } else { // other brush alphas\r\n            context.save();\r\n            context.translate(x, y);\r\n            let targetMipmap = alphaCanvas128;\r\n            if (size <= 32 && size > 16) {\r\n                targetMipmap = alphaCanvas64;\r\n            } else if (size <= 16) {\r\n                targetMipmap = alphaCanvas32;\r\n            }\r\n            context.scale(size, size);\r\n            if (settingAlphaId === ALPHA_CHALK) {\r\n                context.rotate(((x + y) * 53123) % twoPI); // without mod it sometimes looks different\r\n            }\r\n            context.drawImage(targetMipmap, -1, -1, 2, 2);\r\n\r\n            context.restore();\r\n            hasDrawnDot = true;\r\n        }\r\n    }\r\n\r\n    function continueLine(x, y, size, pressure) {\r\n        if (bezierLine === null) {\r\n            bezierLine = new BB.BezierLine();\r\n            bezierLine.add(lastInput.x, lastInput.y, 0, function(){});\r\n        }\r\n\r\n        let drawArr = []; //draw instructions. will be all drawn at once\r\n\r\n        function dotCallback(val) {\r\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\r\n            let localOpacity = calcOpacity(localPressure);\r\n            let localSize = Math.max(0.1, settingSize * (settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        }\r\n\r\n        let localSpacing = size * settingSpacing;\r\n        if (x === null) {\r\n            bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        context.save();\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            let item = drawArr[i];\r\n            drawDot(item[0], item[1], item[2], item[3], item[4], before);\r\n            before = item;\r\n        }\r\n        context.restore();\r\n    }\r\n\r\n    //------------------ interface ---------------------------------------------------\r\n\r\n\r\n    this.startLine = function (x, y, p) {\r\n        historyEntry = {\r\n            tool: [\"brush\", \"PenBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [settingHasOpacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setAlpha\",\r\n            params: [settingAlphaId]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        let localOpacity = calcOpacity(p);\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, p * settingSize) : Math.max(0.1, settingSize);\r\n\r\n        hasDrawnDot = false;\r\n\r\n        isDrawing = true;\r\n        context.save();\r\n        drawDot(x, y, localSize, localOpacity);\r\n        context.restore();\r\n\r\n        lineToolLastDot = localSize * settingSpacing;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n        lastInput2.pressure = p;\r\n\r\n        inputArr = [{\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        }];\r\n\r\n        historyEntry.actions.push({\r\n            action: \"startLine\",\r\n            params: [x, y, p]\r\n        });\r\n    };\r\n\r\n    this.goLine = function (x, y, p) {\r\n        if (!isDrawing) {\r\n            return;\r\n        }\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [x, y, p]\r\n        });\r\n\r\n        let pressure = BB.clamp(p, 0, 1);\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n\r\n        context.save();\r\n        continueLine(x, y, localSize, lastInput.pressure);\r\n\r\n        /*context.fillStyle = 'red';\r\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\r\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/\r\n\r\n        context.restore();\r\n\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput2.pressure = lastInput.pressure;\r\n        lastInput.pressure = pressure;\r\n\r\n        inputArr.push({\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        });\r\n    };\r\n\r\n    this.endLine = function (x, y) {\r\n\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n        context.save();\r\n        continueLine(null, null, localSize, lastInput.pressure);\r\n        context.restore();\r\n\r\n        isDrawing = false;\r\n\r\n        if (settingAlphaId === ALPHA_SQUARE && !hasDrawnDot) {\r\n            // find max pressure input, use that one\r\n            let maxInput = inputArr[0];\r\n            inputArr.forEach(item => {\r\n                if (item.pressure > maxInput.pressure) {\r\n                    maxInput = item;\r\n                }\r\n            })\r\n\r\n            context.save();\r\n            let p = BB.clamp(maxInput.pressure, 0, 1);\r\n            let localOpacity = calcOpacity(p);\r\n            drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\r\n            context.restore();\r\n        }\r\n\r\n        bezierLine = null;\r\n\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: [x, y]\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n\r\n        hasDrawnDot = false;\r\n        inputArr = [];\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = settingSize * settingSpacing;\r\n        lineToolLastDot = settingSize * settingSpacing;\r\n        context.save();\r\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\r\n        }\r\n        context.restore();\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"PenBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [settingHasOpacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setAlpha\",\r\n            params: [settingAlphaId]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    //IS\r\n    this.isDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n    //SET\r\n    this.setAlpha = function (a) {\r\n        if (settingAlphaId === a) {\r\n            return;\r\n        }\r\n        settingAlphaId = a;\r\n        updateAlphaCanvas();\r\n    };\r\n    this.setColor = function (c) {\r\n        if (settingColor === c) {\r\n            return;\r\n        }\r\n        settingColor = {r: c.r, g: c.g, b: c.b};\r\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\r\n        updateAlphaCanvas();\r\n    };\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSize = function (s) {\r\n        settingSize = s;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        settingOpacity = o;\r\n    };\r\n    this.setSpacing = function (s) {\r\n        settingSpacing = s;\r\n    };\r\n    this.sizePressure = function (b) {\r\n        settingHasSizePressure = b;\r\n    };\r\n    this.opacityPressure = function (b) {\r\n        settingHasOpacityPressure = b;\r\n    };\r\n    this.setLockAlpha = function (b) {\r\n        settingLockLayerAlpha = b;\r\n    };\r\n    //GET\r\n    this.getSpacing = function () {\r\n        return settingSpacing;\r\n    };\r\n    this.getSize = function () {\r\n        return settingSize;\r\n    };\r\n    this.getOpacity = function () {\r\n        return settingOpacity;\r\n    };\r\n    this.getLockAlpha = function (b) {\r\n        return settingLockLayerAlpha;\r\n    };\r\n}","import {genBrushAlpha01, genBrushAlpha02} from './alphas/brush-alphas';\r\n\r\nexport const alphaImArr = []; //used by default brush\r\nalphaImArr[1] = genBrushAlpha01(128);\r\nalphaImArr[2] = genBrushAlpha02(128);","import {BB} from '../../../bb/bb';\r\nimport {noise} from '../../../bb/math/perlin';\r\nimport {IVector2D} from '../../../bb/bb.types';\r\n\r\n// chalk\r\nexport function genBrushAlpha01(w: number): HTMLCanvasElement {\r\n\r\n    const scaleFac = w / 500;\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    const ctx = canvas.getContext('2d');\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            let i = (y * w + x) * 4;\r\n\r\n            // base noise\r\n            const sFac2 = scaleFac + noise.simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\r\n            let noisePattern = 100 + (noise.simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\r\n            noisePattern -= (noise.simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\r\n\r\n            // fade out in circular shape\r\n            const centerDist = BB.dist(w / 2, h / 2, x, y);\r\n            let falloff = BB.clamp(\r\n                1 - ((centerDist - (w / 2.5)) / (w / 14) + noise.simplex2(x / 22 / sFac2, y / 22 / sFac2)),\r\n                0,\r\n                1);\r\n            noisePattern = noisePattern * falloff;\r\n\r\n            // make the middle darker\r\n            const falloff2 = BB.clamp(1 - centerDist / w, 0, 1) * 2;\r\n            noisePattern = noisePattern * falloff2;\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = BB.clamp(noisePattern, 0, 255);\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}\r\n\r\n// https://www.shadertoy.com/view/3tdSDj\r\nfunction udSegment( p: IVector2D, a: IVector2D, b: IVector2D ) {\r\n    let ba = BB.Vec2.sub(b, a);\r\n    let pa = BB.Vec2.sub(p, a);\r\n    let h = BB.clamp( BB.Vec2.dot(pa,ba) / BB.Vec2.dot(ba,ba), 0.0, 1.0 );\r\n    return BB.Vec2.len(BB.Vec2.sub(pa, BB.Vec2.mul(ba, h)));\r\n}\r\n\r\n// calligraphy\r\nexport function genBrushAlpha02(w: number): HTMLCanvasElement {\r\n\r\n    const pDist = 1 / 4;\r\n    let centerSize = 2 / 3;\r\n    let transitionSize = 1 / 3;\r\n    centerSize *= pDist;\r\n    transitionSize *= pDist;\r\n    const p1 = {x: pDist * w, y: w - (w * pDist)};\r\n    const p2 = {x: w - (w * pDist), y: pDist * w};\r\n\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    let ctx = canvas.getContext('2d');\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            const i = (y * w + x) * 4;\r\n\r\n            let col = udSegment({x: x, y: y}, p1, p2);\r\n\r\n            col = BB.clamp(\r\n                255 - ((col - (w * centerSize)) / (w * transitionSize) * 255),\r\n                0,\r\n                255\r\n            );\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = col;\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}","/*\r\n * A speed-improved perlin and simplex noise algorithms for 2D.\r\n *\r\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\n * Better rank ordering method by Stefan Gustavson in 2012.\r\n * Converted to Javascript by Joseph Gentle.\r\n *\r\n * Version 2012-03-09\r\n *\r\n * This code was placed in the public domain by its original author,\r\n * Stefan Gustavson. You may use it as you see fit, but\r\n * attribution is appreciated.\r\n *\r\n */\r\n\r\nconst myModule = {} as any;\r\n\r\n\r\nfunction Grad(x, y, z) {\r\n    this.x = x; this.y = y; this.z = z;\r\n}\r\n\r\nGrad.prototype.dot2 = function(x, y) {\r\n    return this.x*x + this.y*y;\r\n};\r\n/*\r\nGrad.prototype.dot3 = function(x, y, z) {\r\n    return this.x*x + this.y*y + this.z*z;\r\n};*/\r\n\r\nlet grad3 = [new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),\r\n    new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),\r\n    new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];\r\n\r\nlet p = [151,160,137,91,90,15,\r\n    131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,\r\n    190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,\r\n    88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,\r\n    77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,\r\n    102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,\r\n    135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,\r\n    5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,\r\n    223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,\r\n    129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,\r\n    251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,\r\n    49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,\r\n    138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\r\n// To remove the need for index wrapping, double the permutation table length\r\nlet perm = new Array(512);\r\nlet gradP = new Array(512);\r\n\r\n// This isn't a very good seeding function, but it works ok. It supports 2^16\r\n// different seed values. Write something better if you need more seeds.\r\nmyModule.seed = function(seed) {\r\n    if (seed > 0 && seed < 1) {\r\n        // Scale the seed out\r\n        seed *= 65536;\r\n    }\r\n\r\n    seed = Math.floor(seed);\r\n    if (seed < 256) {\r\n        seed |= seed << 8;\r\n    }\r\n\r\n    for (let i = 0; i < 256; i++) {\r\n        let v;\r\n        if (i & 1) {\r\n            v = p[i] ^ (seed & 255);\r\n        } else {\r\n            v = p[i] ^ ((seed>>8) & 255);\r\n        }\r\n\r\n        perm[i] = perm[i + 256] = v;\r\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\r\n    }\r\n};\r\n\r\nmyModule.seed(0);\r\n\r\n/*\r\nfor (let i=0; i<256; i++) {\r\n  perm[i] = perm[i + 256] = p[i];\r\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\r\n}*/\r\n\r\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\r\nlet F2 = 0.5*(Math.sqrt(3)-1);\r\nlet G2 = (3-Math.sqrt(3))/6;\r\n\r\n/*let F3 = 1/3;\r\nlet G3 = 1/6;*/\r\n\r\n// 2D simplex noise\r\nmyModule.simplex2 = function(xin, yin) {\r\n    let n0, n1, n2; // Noise contributions from the three corners\r\n    // Skew the input space to determine which simplex cell we're in\r\n    let s = (xin+yin)*F2; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    let t = (i+j)*G2;\r\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin-j+t;\r\n    // For the 2D case, the simplex shape is an equilateral triangle.\r\n    // Determine which simplex we are in.\r\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n    if (x0>y0) { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n        i1=1; j1=0;\r\n    } else {    // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n        i1=0; j1=1;\r\n    }\r\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n    // c = (3-sqrt(3))/6\r\n    let x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n    let y1 = y0 - j1 + G2;\r\n    let x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n    let y2 = y0 - 1 + 2 * G2;\r\n    // Work out the hashed gradient indices of the three simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    let gi0 = gradP[i+perm[j]];\r\n    let gi1 = gradP[i+i1+perm[j+j1]];\r\n    let gi2 = gradP[i+1+perm[j+1]];\r\n    // Calculate the contribution from the three corners\r\n    let t0 = 0.5 - x0*x0-y0*y0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot2(x0, y0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.5 - x1*x1-y1*y1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\r\n    }\r\n    let t2 = 0.5 - x2*x2-y2*y2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 70 * (n0 + n1 + n2);\r\n};\r\n/*\r\n// 3D simplex noise\r\nmyModule.simplex3 = function(xin, yin, zin) {\r\n    let n0, n1, n2, n3; // Noise contributions from the four corners\r\n\r\n    // Skew the input space to determine which simplex cell we're in\r\n    let s = (xin+yin+zin)*F3; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    let k = Math.floor(zin+s);\r\n\r\n    let t = (i+j+k)*G3;\r\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin-j+t;\r\n    let z0 = zin-k+t;\r\n\r\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n    // Determine which simplex we are in.\r\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n    if (x0 >= y0) {\r\n        if (y0 >= z0)      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; }\r\n        else if (x0 >= z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; }\r\n        else              { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; }\r\n    } else {\r\n        if (y0 < z0)      { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; }\r\n        else if (x0 < z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; }\r\n        else             { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; }\r\n    }\r\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n    // c = 1/6.\r\n    let x1 = x0 - i1 + G3; // Offsets for second corner\r\n    let y1 = y0 - j1 + G3;\r\n    let z1 = z0 - k1 + G3;\r\n\r\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\r\n    let y2 = y0 - j2 + 2 * G3;\r\n    let z2 = z0 - k2 + 2 * G3;\r\n\r\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\r\n    let y3 = y0 - 1 + 3 * G3;\r\n    let z3 = z0 - 1 + 3 * G3;\r\n\r\n    // Work out the hashed gradient indices of the four simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    k &= 255;\r\n    let gi0 = gradP[i+   perm[j+   perm[k   ]]];\r\n    let gi1 = gradP[i+i1+perm[j+j1+perm[k+k1]]];\r\n    let gi2 = gradP[i+i2+perm[j+j2+perm[k+k2]]];\r\n    let gi3 = gradP[i+ 1+perm[j+ 1+perm[k+ 1]]];\r\n\r\n    // Calculate the contribution from the four corners\r\n    let t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\r\n    }\r\n    let t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\r\n    }\r\n    let t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\r\n    if (t3<0) {\r\n        n3 = 0;\r\n    } else {\r\n        t3 *= t3;\r\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 32 * (n0 + n1 + n2 + n3);\r\n\r\n};\r\n*/\r\n// ##### Perlin noise stuff\r\n/*\r\nfunction fade(t) {\r\n    return t*t*t*(t*(t*6-15)+10);\r\n}\r\n\r\nfunction lerp(a, b, t) {\r\n    return (1-t)*a + t*b;\r\n}\r\n\r\n// 2D Perlin Noise\r\nmyModule.perlin2 = function(x, y) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y);\r\n    // Get relative xy coordinates of point within that cell\r\n    x = x - X; y = y - Y;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255;\r\n\r\n    // Calculate noise contributions from each of the four corners\r\n    let n00 = gradP[X+perm[Y]].dot2(x, y);\r\n    let n01 = gradP[X+perm[Y+1]].dot2(x, y-1);\r\n    let n10 = gradP[X+1+perm[Y]].dot2(x-1, y);\r\n    let n11 = gradP[X+1+perm[Y+1]].dot2(x-1, y-1);\r\n\r\n    // Compute the fade curve value for x\r\n    let u = fade(x);\r\n\r\n    // Interpolate the four results\r\n    return lerp(\r\n        lerp(n00, n10, u),\r\n        lerp(n01, n11, u),\r\n        fade(y));\r\n};*/\r\n/*\r\n// 3D Perlin Noise\r\nmyModule.perlin3 = function(x, y, z) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y), Z = Math.floor(z);\r\n    // Get relative xyz coordinates of point within that cell\r\n    x = x - X; y = y - Y; z = z - Z;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255; Z = Z & 255;\r\n\r\n    // Calculate noise contributions from each of the eight corners\r\n    let n000 = gradP[X+  perm[Y+  perm[Z  ]]].dot3(x,   y,     z);\r\n    let n001 = gradP[X+  perm[Y+  perm[Z+1]]].dot3(x,   y,   z-1);\r\n    let n010 = gradP[X+  perm[Y+1+perm[Z  ]]].dot3(x,   y-1,   z);\r\n    let n011 = gradP[X+  perm[Y+1+perm[Z+1]]].dot3(x,   y-1, z-1);\r\n    let n100 = gradP[X+1+perm[Y+  perm[Z  ]]].dot3(x-1,   y,   z);\r\n    let n101 = gradP[X+1+perm[Y+  perm[Z+1]]].dot3(x-1,   y, z-1);\r\n    let n110 = gradP[X+1+perm[Y+1+perm[Z  ]]].dot3(x-1, y-1,   z);\r\n    let n111 = gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1, y-1, z-1);\r\n\r\n    // Compute the fade curve value for x, y, z\r\n    let u = fade(x);\r\n    let v = fade(y);\r\n    let w = fade(z);\r\n\r\n    // Interpolate\r\n    return lerp(\r\n        lerp(\r\n            lerp(n000, n100, u),\r\n            lerp(n001, n101, u), w),\r\n        lerp(\r\n            lerp(n010, n110, u),\r\n            lerp(n011, n111, u), w),\r\n        v);\r\n};*/\r\n\r\nexport const noise = myModule;","import {BB} from '../../bb/bb';\r\nimport {IRGB, IRGBA} from '../kl.types';\r\nimport {IBounds, IPressureInput} from '../../bb/bb.types';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\n\r\nconst cellSize = 256;\r\n\r\ninterface IDrawBufferItem {\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    opacity: number;\r\n    x1: number;\r\n    y1: number;\r\n    x2: number;\r\n    y2: number;\r\n    r: number;\r\n    g: number;\r\n    b: number;\r\n}\r\n\r\n// faster than using BB.clamp somehow (in chrome)\r\nfunction clamp(num, min, max) {\r\n    return num <= min\r\n        ? min\r\n        : num >= max\r\n            ? max\r\n            : num\r\n}\r\n\r\nexport class BlendBrush {\r\n\r\n    private isTesting: boolean = false; // testing mode - context only gets updated when line is finished\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private color: IRGB;\r\n    private size: number = 29; // radius - 0.5 - 99999\r\n    private opacity: number = 0.6; // 0-1\r\n    private blending: number = 0.65; // 0-1\r\n\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingSizePressure: boolean = true;\r\n    private settingOpacityPressure: boolean = false;\r\n\r\n    private blendCol: IRGBA = {r: 0, g: 0, b: 0, a: 1}; // todo docs\r\n    private blendMix: number = 0.45; // todo docs\r\n    private mixr: number; // todo docs\r\n    private mixg: number; // todo docs\r\n    private mixb: number; // todo docs\r\n    private localColOld: IRGBA; // todo docs\r\n\r\n    private isDrawing: boolean = false;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private bezierLine: any; // todo type\r\n\r\n    private history: KlHistoryInterface | null;\r\n    private historyEntry: IHistoryEntry;\r\n    private redrawBounds: IBounds;\r\n    private cells: (ImageData | null)[];\r\n    private drawBuffer: IDrawBufferItem[];\r\n\r\n    private updateRedrawBounds (bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    private getCellsWidth(): number {\r\n        return Math.ceil(this.context.canvas.width / cellSize);\r\n    }\r\n\r\n    /**\r\n     * draw changed cells (changed by brushstroke) onto context\r\n     * @private\r\n     */\r\n    private drawChangedCells(): void {\r\n        const cells = this.cells.map(item => null);\r\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\r\n        touchedCells.forEach((isTouched, index) => {\r\n            if (isTouched) {\r\n                cells[index] = this.cells[index];\r\n            }\r\n        });\r\n        this.drawCells(cells);\r\n        this.redrawBounds = null;\r\n    }\r\n\r\n    private getTouchedCells(bounds: IBounds): boolean[] {\r\n        const touchedCells = this.cells.map(item => false);\r\n        const cellsW = this.getCellsWidth();\r\n        bounds = {\r\n            x1: Math.floor(bounds.x1 / cellSize),\r\n            y1: Math.floor(bounds.y1 / cellSize),\r\n            x2: Math.floor(bounds.x2 / cellSize),\r\n            y2: Math.floor(bounds.y2 / cellSize),\r\n        };\r\n        for (let i = bounds.x1; i <= bounds.x2; i++) {\r\n            for (let e = bounds.y1; e <= bounds.y2; e++) {\r\n                touchedCells[e * cellsW + i] = true;\r\n            }\r\n        }\r\n        return touchedCells;\r\n    }\r\n\r\n    /**\r\n     * Slice up bounds accordings to cells\r\n     * @param bounds\r\n     * @private\r\n     */\r\n    private sliceBounds(bounds: IBounds): {index: number; bounds: IBounds}[] {\r\n        const cellsW = this.getCellsWidth();\r\n        const result: {index: number; bounds: IBounds}[] = [];\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n\r\n        touchedCells.forEach((cell, i) => {\r\n            if (!cell) {\r\n                return;\r\n            }\r\n\r\n            const cellOffsetX = (i % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(i / cellsW) * cellSize;\r\n            const cellWidth = this.cells[i].width;\r\n            const cellHeight = this.cells[i].height;\r\n\r\n            const inCellBounds = {\r\n                x1: Math.max(0, bounds.x1 - cellOffsetX),\r\n                y1: Math.max(0, bounds.y1 - cellOffsetY),\r\n                x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\r\n                y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY),\r\n            }\r\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) {\r\n                return;\r\n            }\r\n            result.push({\r\n                index: i,\r\n                bounds: inCellBounds,\r\n            });\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    private copyFromCanvas(bounds: IBounds) {\r\n        if (!bounds) {\r\n            return;\r\n        }\r\n\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n        const cellsW = this.getCellsWidth();\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.cells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * cellSize + cellSize, this.context.canvas.width) - 1) % cellSize + 1;\r\n            const h = (Math.min(y * cellSize + cellSize, this.context.canvas.height) - 1) % cellSize + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = tmpCanvas.getContext('2d');\r\n            tmpCtx.drawImage(this.context.canvas, -x * cellSize, -y * cellSize);\r\n\r\n            this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\r\n        });\r\n    }\r\n\r\n    private getAverage (x, y, size): IRGBA {\r\n\r\n        size = Math.max(0.5, size * 0.75);\r\n        const x1 = Math.max(0, Math.floor(x - size));\r\n        const y1 = Math.max(0, Math.floor(y - size));\r\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return {\r\n                r: 0,\r\n                g: 0,\r\n                b: 0,\r\n                a: 0,\r\n            };\r\n        }\r\n\r\n        let ar = 0, ag = 0, ab = 0, aa = 0, alpha;\r\n\r\n        const slicedBounds = this.sliceBounds({ x1, y1, x2, y2 });\r\n        slicedBounds.forEach(slice => {\r\n            const width = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n            const bounds = slice.bounds;\r\n\r\n            for (let i = bounds.y1; i <= bounds.y2; i += 4) {\r\n                for (let e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 4 * 4) {\r\n                    alpha = data[e2 + 3];\r\n                    ar += data[e2] * alpha;\r\n                    ag += data[e2 + 1] * alpha;\r\n                    ab += data[e2 + 2] * alpha;\r\n                    aa += alpha;\r\n                }\r\n            }\r\n        });\r\n\r\n        if (aa !== 0) {\r\n            ar /= aa;\r\n            ag /= aa;\r\n            ab /= aa;\r\n            aa = Math.min(1, aa);\r\n        }\r\n        return {\r\n            r: ar,\r\n            g: ag,\r\n            b: ab,\r\n            a: aa\r\n        };\r\n    }\r\n\r\n    private prepDot (x: number, y: number, size: number): IBounds {\r\n        size = Math.max(0.5, size);\r\n        let x1 = Math.max(0, Math.floor(x - size));\r\n        let y1 = Math.max(0, Math.floor(y - size));\r\n        let x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        let y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return null;\r\n        }\r\n        return { x1, y1, x2, y2 };\r\n    }\r\n\r\n    private drawDot (params: IDrawBufferItem): void {\r\n        // array with random numbers. faster than Math.random()\r\n        let randI = 0;\r\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n        const randArr = [];\r\n        for (let i = 0; i < randLen; i++) {\r\n            randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n        }\r\n\r\n        // thin lines take more than just 1 sample\r\n        const sampleArr = [8,4,4,4,2,2,2,2,2,2]; // <0.5, 0.5, 1, 1.5, etc.\r\n        const samples = sampleArr[Math.floor(params.size * 2)];\r\n        const samplesSquared: number = samples ? samples * samples : 0;\r\n        const sampleOffsets = [];\r\n        if (samples) {\r\n            let i = 0;\r\n            for (let n = 0; n < samples; n++) {\r\n                for (let m = 0; m < samples; m++, i += 2) {\r\n                    sampleOffsets[i] = (n + 1) / samples; // x offset\r\n                    sampleOffsets[i + 1] = (m + 1) / samples; // y offset\r\n                }\r\n            }\r\n        }\r\n\r\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\r\n        // to optimize calculations\r\n        const invSharpness = 1 - sharpness;\r\n        const sharpnessSubtrahend = sharpness / invSharpness;\r\n        const sizeSquared = params.size * params.size;\r\n        const distDivisor = sizeSquared * invSharpness / params.opacity;\r\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\r\n\r\n\r\n        const slicedBounds = this.sliceBounds({\r\n            x1: params.x1,\r\n            y1: params.y1,\r\n            x2: params.x2,\r\n            y2: params.y2,\r\n        });\r\n\r\n        const cellsW = this.getCellsWidth();\r\n        slicedBounds.forEach(slice => {\r\n            const cellOffsetX = (slice.index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(slice.index / cellsW) * cellSize;\r\n            const cellWidth = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n\r\n            // i - y index within cell\r\n            // e - x index within cell\r\n\r\n            // e2 - index in image data\r\n\r\n            // ri - y index within image relative to dot-center\r\n            // re - x index within image relative to dot-center\r\n\r\n            for (let i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++) {\r\n                for (\r\n                    let e = slice.bounds.x1,\r\n                        e2 = i * cellWidth * 4 + slice.bounds.x1 * 4,\r\n                        re = e + cellOffsetX - params.x;\r\n                    e <= slice.bounds.x2;\r\n                    e++,\r\n                        e2 += 4,\r\n                        re++\r\n                ) {\r\n                    // O = over -> brush-dot\r\n                    // U = under -> image\r\n\r\n                    let alphaO = 0;\r\n                    if (samplesSquared) {\r\n                        for (let f = 0; f < sampleOffsets.length; f += 2) {\r\n                            const dist = BB.lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\r\n                            if (dist >= sizeSquared) {\r\n                                continue;\r\n                            }\r\n                            alphaO += clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                        }\r\n                        if (!alphaO) {\r\n                            continue;\r\n                        }\r\n                        alphaO /= samplesSquared;\r\n                    } else {\r\n                        // technically needs + 0.5 offset, but not noticeable with large brush\r\n                        const dist = Math.pow(re, 2) + Math.pow(ri, 2);\r\n                        if (dist >= sizeSquared) {\r\n                            continue;\r\n                        }\r\n                        alphaO = clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                    }\r\n\r\n                    const invAlphaO = 1 - alphaO;\r\n                    const alphaU =data[e2 + 3] / 255;\r\n\r\n                    if (this.settingLockLayerAlpha) {\r\n                        const underR = (params.r * alphaO) + ((data[e2]) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1]) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2]) * invAlphaO);\r\n                        if (alphaU) {\r\n                            data[e2] = Math.floor(underR + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB + randArr[randI]);\r\n                        }\r\n                    } else {\r\n                        const underR = (params.r * alphaO) + ((data[e2] * alphaU) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1] * alphaU) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2] * alphaU) * invAlphaO);\r\n\r\n                        let newAlpha = 1 - invAlphaO * (1 - alphaU);\r\n                        data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\r\n                        if (newAlpha) {\r\n                            data[e2] = Math.floor(underR / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB / (newAlpha) + randArr[randI]);\r\n                        }\r\n                    }\r\n                    randI = (randI + 1) % randLen;\r\n\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    private calcSpacing (size: number): number {\r\n        return BB.mix(\r\n            (size * 2) / 2, // until size 5.3\r\n            (size * 2) / 9, // at size 24\r\n            BB.clamp((size - 2.7) / (12 - 2.7), 0, 1)\r\n        );\r\n    }\r\n\r\n    private continueLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n\r\n        this.drawBuffer = [];\r\n\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (this.settingSizePressure) ? Math.max(1, p * this.size) : Math.max(1, this.size);\r\n\r\n        let bdist = this.calcSpacing(localSize);\r\n\r\n        let avgX = x;\r\n        let avgY = y;\r\n        if (x === null) {\r\n            avgX = this.lastInput.x;\r\n            avgY = this.lastInput.y;\r\n        }\r\n\r\n        let localColNew;\r\n\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            let average;\r\n            if (isCoalesced) {\r\n                average = {r: this.localColOld.r, g: this.localColOld.g, b: this.localColOld.b, a: 0};\r\n            } else {\r\n                const avgParams = [avgX, avgY, ((this.settingSizePressure) ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size))];\r\n                const bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\r\n                this.copyFromCanvas(bounds);\r\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\r\n            }\r\n            localColNew = {r: 0, g: 0, b: 0, a: 0};\r\n\r\n            if (average.a > 0 && this.blendCol.a === 0) {\r\n                this.blendCol.r = average.r;\r\n                this.blendCol.g = average.g;\r\n                this.blendCol.b = average.b;\r\n                this.blendCol.a = average.a;\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n\r\n            } else {\r\n                if (average.a === 0) {\r\n                    average.r = this.color.r;\r\n                    average.g = this.color.g;\r\n                    average.b = this.color.b;\r\n                    average.a = 1 - this.blending;\r\n                }\r\n\r\n                this.blendCol.r = BB.mix(this.blendCol.r, BB.mix(this.blendCol.r, average.r, this.blendMix), average.a);\r\n                this.blendCol.g = BB.mix(this.blendCol.g, BB.mix(this.blendCol.g, average.g, this.blendMix), average.a);\r\n                this.blendCol.b = BB.mix(this.blendCol.b, BB.mix(this.blendCol.b, average.b, this.blendMix), average.a);\r\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n            }\r\n\r\n        }\r\n\r\n\r\n        const bezierCallback = (val) => {\r\n            if (this.blending >= 1 && this.blendCol.a <= 0) {\r\n                return;\r\n            }\r\n            let factor = val.t;\r\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (this.settingOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\r\n            localSize = (this.settingSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\r\n            if (this.blending != 0) {\r\n                this.mixr = BB.mix(this.localColOld.r, localColNew.r, factor);\r\n                this.mixg = BB.mix(this.localColOld.g, localColNew.g, factor);\r\n                this.mixb = BB.mix(this.localColOld.b, localColNew.b, factor);\r\n            }\r\n            if (this.blending === 1 && this.localColOld.a === 0) {\r\n                this.mixr = localColNew.r;\r\n                this.mixg = localColNew.g;\r\n                this.mixb = localColNew.b;\r\n            }\r\n            const bounds = this.prepDot(val.x, val.y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: val.x,\r\n                    y: val.y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                })\r\n            }\r\n        };\r\n\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.localColOld = localColNew;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.size;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.size = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.opacity = o;\r\n    }\r\n\r\n    getBlending (): number {\r\n        return this.blending;\r\n    }\r\n\r\n    setBlending (b: number) {\r\n        this.blending = b;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.color = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setSizePressure (b: boolean): void {\r\n        this.settingSizePressure = !!b;\r\n    }\r\n\r\n    setOpacityPressure (b: boolean): void {\r\n        this.settingOpacityPressure = !!b;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setIsTesting (b: boolean): void {\r\n        this.isTesting = !!b;\r\n    }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: [\"brush\", \"BlendBrush\"],\r\n            actions: []\r\n        };\r\n\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n\r\n        this.isDrawing = true;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        let localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            this.copyFromCanvas(this.prepDot(x, y, localSize));\r\n\r\n            let average = this.getAverage(\r\n                x,\r\n                y,\r\n                ((this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size))\r\n            );\r\n            if (average.a === 0) {\r\n                this.blendCol = {\r\n                    r: this.color.r,\r\n                    g: this.color.g,\r\n                    b: this.color.b,\r\n                    a: 1 - this.blending,\r\n                };\r\n            } else {\r\n                this.blendCol = {\r\n                    r: average.r,\r\n                    g: average.g,\r\n                    b: average.b,\r\n                    a: average.a,\r\n                };\r\n            }\r\n\r\n            this.mixr = this.blendCol.r;\r\n            this.mixg = this.blendCol.g;\r\n            this.mixb = this.blendCol.b;\r\n        }\r\n\r\n        this.localColOld = {r: this.mixr, g: this.mixg, b: this.mixb, a: this.blendCol.a};\r\n\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        if (this.blending < 1 || this.blendCol.a > 0) {\r\n            const bounds = this.prepDot(x, y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x,\r\n                    y: y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                })\r\n            }\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.bezierLine = new BB.BezierLine();\r\n        this.bezierLine.add(x, y, 0, function () {\r\n        });\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    endLine (): void {\r\n        if (this.bezierLine) {\r\n            this.continueLine(null, null, this.lastInput.pressure, false);\r\n        }\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.drawChangedCells();\r\n        }\r\n\r\n        if (this.historyEntry && this.history && this.cells.find(item => !!item)) {\r\n            this.historyEntry.actions.push({\r\n                action: \"drawCells\",\r\n                params: [this.cells],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n\r\n    /**\r\n     * draw cells onto context\r\n     * @param cells\r\n     */\r\n    drawCells (cells: (ImageData | null)[]): void {\r\n        const cellsW = this.getCellsWidth();\r\n        cells.forEach((imageData, index) => {\r\n            if (!imageData) {\r\n                return;\r\n            }\r\n            const cellOffsetX = (index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(index / cellsW) * cellSize;\r\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\r\n        });\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\r\n        let average = this.getAverage(x1, y1, Math.max(0.1, this.size));\r\n\r\n        if (average.a === 0) {\r\n            this.blendCol = {\r\n                r: this.color.r,\r\n                g: this.color.g,\r\n                b: this.color.b,\r\n                a: 1 - this.blending,\r\n            };\r\n        } else {\r\n            this.blendCol = {\r\n                r: average.r,\r\n                g: average.g,\r\n                b: average.b,\r\n                a: average.a,\r\n            };\r\n        }\r\n\r\n        this.mixr = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixg = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixb = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\r\n\r\n\r\n        const p = 1;\r\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        const bdist = this.calcSpacing(localSize);\r\n        for (let loopDist = 0; loopDist <= mouseDist; loopDist += bdist) {\r\n            const bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\r\n            if (bounds) {\r\n                this.copyFromCanvas(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x1 + eX * loopDist,\r\n                    y: y1 + eY * loopDist,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                })\r\n            }\r\n        }\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        if (this.history && this.cells.find(item => !!item)) {\r\n            this.drawCells(this.cells);\r\n            this.historyEntry = {\r\n                tool: [\"brush\", \"BlendBrush\"],\r\n                actions: [{\r\n                    action: \"drawCells\",\r\n                    params: [this.cells],\r\n                }],\r\n            };\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\nconst sampleCanvas = BB.canvas(32, 32);\r\nconst sampleCtx = sampleCanvas.getContext('2d');\r\n\r\nexport function SketchyBrush() {\r\n    let context;\r\n    let settingColor;\r\n\r\n    let settingSize = 1, settingOpacity = 0.2;\r\n    let settingBlending = 0.5;\r\n    let settingScale = 1;\r\n\r\n    let lastX, lastY;\r\n    let isDrawing = false;\r\n    let lastInput = {x: 0, y: 0, pressure: 0};\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n    let sketchySeed = 0;\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSeed = function (s) {\r\n        sketchySeed = parseInt(s);\r\n    };\r\n    this.getSeed = function () {\r\n        return parseInt('' + sketchySeed);\r\n    };\r\n\r\n    function rand() {\r\n        sketchySeed++;\r\n        return Math.sin(6324634.2345 * Math.cos(sketchySeed * 5342.3423)) * 0.5 + 0.5;\r\n    }\r\n\r\n    let points = [];\r\n    let count = 0;\r\n    let mixmode = [\r\n        function (c1, c2) {\r\n            return c1;\r\n        },\r\n        function (c1, c2) {\r\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\r\n            result.r *= c2.r / 255;\r\n            result.g *= c2.g / 255;\r\n            result.b *= c2.b / 255;\r\n            return result;\r\n        },\r\n        function (c1, c2) {\r\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\r\n            result.r *= c2.r / 255;\r\n            result.g *= c2.g / 255;\r\n            result.b *= c2.b / 255;\r\n            return result;\r\n        }\r\n    ];\r\n\r\n    this.getSize = function () {\r\n        return settingSize / 2;\r\n    };\r\n    this.setColor = function (c) {\r\n        settingColor = c;\r\n    };\r\n    this.getOpacity = function () {\r\n        return settingOpacity;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        settingOpacity = o;\r\n    };\r\n    this.getBlending = function () {\r\n        return settingBlending;\r\n    };\r\n    this.setBlending = function (b) {\r\n        settingBlending = b;\r\n    };\r\n    this.setSize = function (s) {\r\n        settingSize = s * 2;\r\n    };\r\n    this.getScale = function () {\r\n        return settingScale;\r\n    };\r\n    this.setScale = function (s) {\r\n        settingScale = s;\r\n    };\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.startLine = function (x, y, pressure, shift) {\r\n        if (shift && lastInput.x) {\r\n            let lx = lastInput.x, ly = lastInput.y;\r\n            isDrawing = true;\r\n            //this.goLine(x,y,pressure);\r\n            this.endLine();\r\n        } else {\r\n            isDrawing = true;\r\n            lastX = x;\r\n            lastY = y;\r\n            lastInput.x = x;\r\n            lastInput.y = y;\r\n            historyEntry = {\r\n                tool: [\"brush\", \"SketchyBrush\"],\r\n                actions: []\r\n            };\r\n            historyEntry.actions.push({\r\n                action: \"setScale\",\r\n                params: [settingScale]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setSize\",\r\n                params: [settingSize / 2]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setOpacity\",\r\n                params: [settingOpacity]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setColor\",\r\n                params: [settingColor]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setBlending\",\r\n                params: [settingBlending]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"startLine\",\r\n                params: [x, y, pressure]\r\n            });\r\n        }\r\n\r\n    };\r\n    this.goLine = function (p_x, p_y, pressure, preMixedColor) {\r\n        if (!isDrawing || (p_x === lastInput.x && p_y === lastInput.y)) {\r\n            return;\r\n        }\r\n\r\n        let e, b, a, g;\r\n        let x = parseInt(p_x);\r\n        let y = parseInt(p_y);\r\n        points.push([x, y]);\r\n\r\n        let mixr = settingColor.r;\r\n        let mixg = settingColor.g;\r\n        let mixb = settingColor.b;\r\n\r\n        if (preMixedColor !== null) {\r\n            mixr = preMixedColor.r;\r\n            mixg = preMixedColor.g;\r\n            mixb = preMixedColor.b;\r\n        } else {\r\n            if (settingBlending !== 0) {\r\n                if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < context.canvas.width - 1 && y - 5 < context.canvas.height - 1) {\r\n                    mixr = 0;\r\n                    mixg = 0;\r\n                    mixb = 0;\r\n                    let mixx = Math.min(context.canvas.width - 1, Math.max(0, x - 5));\r\n                    let mixy = Math.min(context.canvas.height - 1, Math.max(0, y - 5));\r\n                    let mixw = Math.min(context.canvas.width - 1, Math.max(0, x + 5));\r\n                    let mixh = Math.min(context.canvas.height - 1, Math.max(0, y + 5));\r\n                    mixw -= mixx;\r\n                    mixh -= mixy;\r\n\r\n                    if (mixw > 0 && mixh > 0) {\r\n                        let imdat = context.getImageData(mixx, mixy, mixw, mixh);\r\n                        let countmix = 0;\r\n                        for (let i = 0; i < imdat.data.length; i += 4) {\r\n                            mixr += imdat.data[i + 0];\r\n                            mixg += imdat.data[i + 1];\r\n                            mixb += imdat.data[i + 2];\r\n                            countmix++;\r\n                        }\r\n                        mixr /= countmix;\r\n                        mixg /= countmix;\r\n                        mixb /= countmix;\r\n                    }\r\n\r\n                    let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\r\n                    mixr = parseInt('' + BB.mix(settingColor.r, mixed.r, settingBlending));\r\n                    mixg = parseInt('' + BB.mix(settingColor.g, mixed.g, settingBlending));\r\n                    mixb = parseInt('' + BB.mix(settingColor.b, mixed.b, settingBlending));\r\n                }\r\n            }\r\n        }\r\n\r\n        context.save();\r\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\r\n        context.lineWidth = settingSize;\r\n\r\n        context.beginPath();\r\n        context.moveTo(lastX, lastY);\r\n        context.lineTo(x, y);\r\n\r\n        for (e = 0; e < points.length; e++) {\r\n            b = points[e][0] - points[count][0];\r\n            a = points[e][1] - points[count][1];\r\n            g = b * b + a * a;\r\n            if (g < 4000 * settingScale * settingScale && rand() > g / 2000 / settingScale / settingScale) {\r\n                context.moveTo(points[count][0] + (b * 0.3), points[count][1] + (a * 0.3));\r\n                context.lineTo(points[e][0] - (b * 0.3), points[e][1] - (a * 0.3));\r\n            }\r\n        }\r\n\r\n        context.stroke();\r\n        context.restore();\r\n\r\n\r\n        count++;\r\n        lastX = x;\r\n        lastY = y;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [p_x, p_y, pressure, {r: mixr, g: mixg, b: mixb}]\r\n        });\r\n    };\r\n    this.endLine = function () {\r\n        isDrawing = false;\r\n        count = 0;\r\n        points = [];\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: []\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n\r\n        context.save();\r\n        context.lineWidth = settingSize;\r\n\r\n        let mixr = settingColor.r, mixg = settingColor.g, mixb = settingColor.b;\r\n        if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < context.canvas.width - 1 && y1 - 5 < context.canvas.height - 1) {\r\n            mixr = 0;\r\n            mixg = 0;\r\n            mixb = 0;\r\n            let mixx = Math.min(context.canvas.width - 1, Math.max(0, x1 - 5));\r\n            let mixy = Math.min(context.canvas.height - 1, Math.max(0, y1 - 5));\r\n            let mixw = Math.min(context.canvas.width - 1, Math.max(0, x1 + 5));\r\n            let mixh = Math.min(context.canvas.height - 1, Math.max(0, y1 + 5));\r\n            mixw -= mixx;\r\n            mixh -= mixy;\r\n            if (mixw > 0 && mixh > 0) {\r\n                let w = Math.min(sampleCanvas.width, mixw);\r\n                let h = Math.min(sampleCanvas.height, mixh);\r\n                sampleCtx.save();\r\n                sampleCtx.globalCompositeOperation = 'copy';\r\n                sampleCtx.drawImage(context.canvas, mixx, mixy, mixw, mixh, 0, 0, w, h);\r\n                sampleCtx.restore();\r\n\r\n                let imdat = sampleCtx.getImageData(mixx, mixy, mixw, mixh);\r\n                let countmix = 0;\r\n                for (let i = 0; i < imdat.data.length; i += 4) {\r\n                    mixr += imdat.data[i + 0];\r\n                    mixg += imdat.data[i + 1];\r\n                    mixb += imdat.data[i + 2];\r\n                    countmix++;\r\n                }\r\n                mixr /= countmix;\r\n                mixg /= countmix;\r\n                mixb /= countmix;\r\n            }\r\n        }\r\n        let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\r\n        mixr = parseInt('' + (settingBlending * mixed.r + settingColor.r * (1 - settingBlending)));\r\n        mixg = parseInt('' + (settingBlending * mixed.g + settingColor.g * (1 - settingBlending)));\r\n        mixb = parseInt('' + (settingBlending * mixed.b + settingColor.b * (1 - settingBlending)));\r\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\r\n        context.beginPath();\r\n        context.moveTo(x1, y1);\r\n        context.lineTo(x2, y2);\r\n        context.stroke();\r\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\r\n        context.restore();\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"SketchyBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"setScale\",\r\n            params: [settingScale]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize / 2]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setBlending\",\r\n            params: [settingBlending]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    this.isDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\nexport function PixelBrush() {\r\n\r\n    let context;\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n\r\n    let settingColor, settingSize = 0.5, settingSpacing = 0.9, settingOpacity = 1;\r\n    let settingColorStr;\r\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\r\n    let settingLockLayerAlpha = false;\r\n    let settingIsEraser = false;\r\n    let settingUseDither = true;\r\n\r\n    let lineToolLastDot;\r\n    let lastInput = {x: 0, y: 0, pressure: 0};\r\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\r\n\r\n    let isDrawing = false;\r\n    let bezierLine = null;\r\n    let twoPI = Math.PI * 2;\r\n\r\n\r\n    let ditherCanvas = BB.canvas(4, 4);\r\n    let ditherCtx = ditherCanvas.getContext('2d');\r\n    let ditherPattern;\r\n    let ditherArr = [\r\n        [3, 2],\r\n        [1, 0],\r\n        [3, 0],\r\n        [1, 2],\r\n        [2, 1],\r\n        [0, 3],\r\n        [0, 1],\r\n        [2, 3],\r\n\r\n        [2, 0],\r\n        [0, 2],\r\n        [0, 0],\r\n        [2, 2],\r\n        [1, 1],\r\n        [3, 3],\r\n        [3, 1],\r\n        [1, 3]\r\n    ];\r\n\r\n    function updateDither() {\r\n        ditherCtx.clearRect(0, 0, 4, 4);\r\n        ditherCtx.fillStyle = settingIsEraser ? '#fff' : settingColorStr;\r\n        for (let i = 0; i < Math.max(1, Math.round(settingOpacity * ditherArr.length)); i++) {\r\n            ditherCtx.fillRect(ditherArr[i][0], ditherArr[i][1], 1, 1);\r\n        }\r\n        ditherPattern = context.createPattern(ditherCanvas, 'repeat');\r\n    }\r\n\r\n\r\n    /**\r\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\r\n     * @param p1\r\n     * @param p2\r\n     * @param p3\r\n     * @param p4\r\n     * @param maxAngleRad\r\n     */\r\n    function cubicCurveOverThreshold(p1, p2, p3, p4, max) {\r\n        let d = BB.Vec2.nor({\r\n            x: p4.x - p1.x,\r\n            y: p4.y - p1.y\r\n        });\r\n        let d2 = BB.Vec2.nor({\r\n            x: p2.x - p1.x,\r\n            y: p2.y - p1.y\r\n        });\r\n        let d3 = BB.Vec2.nor({\r\n            x: p4.x - p3.x,\r\n            y: p4.y - p3.y\r\n        });\r\n        let a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\r\n        let a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\r\n\r\n        return Math.max(BB.Vec2.dist(d, d2), BB.Vec2.dist(d, d3)) > max;\r\n    }\r\n\r\n    //bresenheim line drawing\r\n    function plotLine(x0, y0, x1, y1, skipFirst) {\r\n        context.save();\r\n\r\n        if (settingIsEraser) {\r\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            } else {\r\n                context.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        } else {\r\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        }\r\n        context.globalAlpha = settingUseDither ? 1 : settingOpacity;\r\n\r\n        x0 = Math.floor(x0);\r\n        y0 = Math.floor(y0);\r\n        x1 = Math.floor(x1);\r\n        y1 = Math.floor(y1);\r\n\r\n        let dX = Math.abs(x1 - x0);\r\n        let sX = x0 < x1 ? 1 : -1;\r\n        let dY = -Math.abs(y1 - y0);\r\n        let sY = y0 < y1 ? 1 : -1;\r\n        let err = dX + dY;\r\n        while (true) {\r\n            if (skipFirst) {\r\n                skipFirst = false;\r\n            } else {\r\n                context.fillRect(x0, y0, 1, 1);\r\n            }\r\n            if (x0 === x1 && y0 === y1) {\r\n                break;\r\n            }\r\n            let e2 = 2 * err;\r\n            if (e2 >= dY) {\r\n                err += dY;\r\n                x0 += sX;\r\n            }\r\n            if (e2 <= dX) {\r\n                err += dX;\r\n                y0 += sY;\r\n            }\r\n        }\r\n\r\n        context.restore();\r\n    }\r\n\r\n    function plotCubicBezierLine(p1, p2, p3, p4) {\r\n\r\n        let isOverThreshold = cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\r\n\r\n        p1.x = Math.floor(p1.x);\r\n        p1.y = Math.floor(p1.y);\r\n        p4.x = Math.floor(p4.x);\r\n        p4.y = Math.floor(p4.y);\r\n\r\n        let dist = BB.dist(p1.x, p1.y, p4.x, p4.y);\r\n        if (!isOverThreshold || dist < 7) {\r\n            plotLine(p1.x, p1.y, p4.x, p4.y, true);\r\n            return;\r\n        }\r\n\r\n        let n = Math.max(2, Math.round(dist / 4));\r\n        let pointArr = [];\r\n        for (let i = 0; i <= n; i++) {\r\n            let t = i / n;\r\n            let a = Math.pow(1 - t, 3);\r\n            let b = 3 * t * Math.pow(1 - t, 2);\r\n            let c = 3 * Math.pow(t, 2) * (1 - t);\r\n            let d = Math.pow(t, 3);\r\n            pointArr.push({\r\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\r\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            plotLine(\r\n                Math.round(pointArr[i].x),\r\n                Math.round(pointArr[i].y),\r\n                Math.round(pointArr[i + 1].x),\r\n                Math.round(pointArr[i + 1].y),\r\n                true\r\n            );\r\n        }\r\n    }\r\n\r\n    function drawDot(x, y, size, opacity, angle?) {\r\n        context.save();\r\n        if (settingIsEraser) {\r\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            } else {\r\n                context.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        } else {\r\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        }\r\n        context.globalAlpha = settingUseDither ? 1 : opacity;\r\n        context.fillRect(\r\n            Math.round(x + -size),\r\n            Math.round(y + -size),\r\n            Math.round(size * 2),\r\n            Math.round(size * 2)\r\n        );\r\n        context.restore();\r\n    }\r\n\r\n\r\n    function continueLine(x, y, size, pressure) {\r\n        if (bezierLine === null) {\r\n            bezierLine = new BB.BezierLine();\r\n            bezierLine.add(lastInput.x, lastInput.y, 0, function () {\r\n            });\r\n        }\r\n\r\n        context.save();\r\n\r\n        function dotCallback(val) {\r\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\r\n            let localOpacity = settingOpacity * (settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            let localSize = Math.max(0.5, settingSize * (settingHasSizePressure ? localPressure : 1));\r\n            drawDot(val.x, val.y, localSize, localOpacity, val.angle);\r\n        }\r\n\r\n        function controlCallback(controlObj) {\r\n            plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\r\n        }\r\n\r\n        if (Math.round(settingSize * 2) === 1) {\r\n            if (x === null) {\r\n                bezierLine.addFinal(4, null, controlCallback);\r\n            } else {\r\n                bezierLine.add(x, y, 4, null, controlCallback);\r\n            }\r\n\r\n        } else {\r\n            let localSpacing = size * settingSpacing;\r\n\r\n            if (x === null) {\r\n                bezierLine.addFinal(localSpacing, dotCallback);\r\n            } else {\r\n                bezierLine.add(x, y, localSpacing, dotCallback);\r\n            }\r\n        }\r\n\r\n        context.restore();\r\n    }\r\n\r\n    //------------------ interface ---------------------------------------------------\r\n\r\n\r\n    this.startLine = function (x, y, p) {\r\n        historyEntry = {\r\n            tool: [\"brush\", \"PixelBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setIsEraser\",\r\n            params: [settingIsEraser]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setUseDither\",\r\n            params: [settingUseDither]\r\n        });\r\n\r\n        if (settingUseDither) {\r\n            updateDither();\r\n        }\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localOpacity = settingHasOpacityPressure ? (settingOpacity * p * p) : settingOpacity;\r\n        let localSize = settingHasSizePressure ? Math.max(0.5, p * settingSize) : Math.max(0.5, settingSize);\r\n\r\n        isDrawing = true;\r\n        drawDot(x, y, localSize, localOpacity);\r\n        lineToolLastDot = localSize * settingSpacing;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n        lastInput2 = BB.copyObj(lastInput);\r\n\r\n        historyEntry.actions.push({\r\n            action: \"startLine\",\r\n            params: [x, y, p]\r\n        });\r\n    };\r\n\r\n    this.goLine = function (x, y, p) {\r\n        if (!isDrawing) {\r\n            return;\r\n        }\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [x, y, p]\r\n        });\r\n\r\n        //debug\r\n        //drawDot(x, y, 1, 0.5);\r\n\r\n        let pressure = BB.clamp(p, 0, 1);\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n\r\n        continueLine(x, y, localSize, lastInput.pressure);\r\n\r\n        lastInput2 = BB.copyObj(lastInput);\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = pressure;\r\n    };\r\n\r\n    this.endLine = function (x, y) {\r\n\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n        continueLine(null, null, localSize, lastInput.pressure);\r\n\r\n        //debug\r\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\r\n        //drawDot(x, y, 10, 0.1);\r\n\r\n        isDrawing = false;\r\n\r\n        bezierLine = null;\r\n\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: [x, y]\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (settingUseDither) {\r\n            updateDither();\r\n        }\r\n\r\n        if (Math.round(settingSize * 2) === 1) {\r\n            plotLine(x1, y1, x2, y2, true);\r\n        } else {\r\n            let angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\r\n            let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n            let eX = (x2 - x1) / mouseDist;\r\n            let eY = (y2 - y1) / mouseDist;\r\n            let loopDist;\r\n            let bdist = settingSize * settingSpacing;\r\n            lineToolLastDot = settingSize * settingSpacing;\r\n            for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n                drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\r\n            }\r\n        }\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"PixelBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setIsEraser\",\r\n            params: [settingIsEraser]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setUseDither\",\r\n            params: [settingUseDither]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    //IS\r\n    this.isDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n    //SET\r\n    this.setColor = function (c) {\r\n        if (settingColor === c) {\r\n            return;\r\n        }\r\n        settingColor = c;\r\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\r\n    };\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSize = function (s) {\r\n        settingSize = Math.round(s * 2) / 2;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        settingOpacity = o;\r\n    };\r\n    this.setSpacing = function (s) {\r\n        settingSpacing = s;\r\n    };\r\n    this.sizePressure = function (b) {\r\n        settingHasSizePressure = b;\r\n    };\r\n    this.opacityPressure = function (b) {\r\n        settingHasOpacityPressure = b;\r\n    };\r\n    this.setLockAlpha = function (b) {\r\n        settingLockLayerAlpha = b;\r\n    };\r\n    this.setIsEraser = function (b) {\r\n        settingIsEraser = !!b;\r\n    };\r\n    this.setUseDither = function (b) {\r\n        settingUseDither = !!b;\r\n    };\r\n    //GET\r\n    this.getSpacing = function () {\r\n        return settingSpacing;\r\n    };\r\n    this.getSize = function () {\r\n        return settingSize;\r\n    };\r\n    this.getOpacity = function () {\r\n        return settingOpacity;\r\n    };\r\n    this.getLockAlpha = function () {\r\n        return settingLockLayerAlpha;\r\n    };\r\n    this.getIsEraser = function () {\r\n        return settingIsEraser;\r\n    };\r\n    this.getUseDither = function () {\r\n        return settingUseDither;\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\nexport function EraserBrush() {\r\n    let context;\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n\r\n    let size = 30, spacing = 0.4, opacity = 1;\r\n    let sizePressure = true, opacityPressure = false;\r\n    let lastDot, lastInput = {x: 0, y: 0, pressure: 0};\r\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\r\n    let started = false;\r\n\r\n    let bezierLine;\r\n    let isBaseLayer = false;\r\n    let isTransparentBG = false;\r\n\r\n    function drawDot(x, y, size, opacity) {\r\n\r\n        context.save();\r\n        if (isBaseLayer) {\r\n            if (isTransparentBG) {\r\n                context.globalCompositeOperation = \"destination-out\";\r\n            } else {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        } else {\r\n            context.globalCompositeOperation = \"destination-out\";\r\n        }\r\n        let radgrad = context.createRadialGradient(size, size, 0, size, size, size);\r\n        let sharpness = Math.pow(opacity, 2);\r\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\r\n        let oFac = Math.max(0, Math.min(1, opacity));\r\n        let localOpacity = 2 * oFac - oFac * oFac;\r\n        radgrad.addColorStop(sharpness, \"rgba(255, 255, 255, \" + localOpacity + \")\");\r\n        radgrad.addColorStop(1, \"rgba(255, 255, 255, 0)\");\r\n        context.fillStyle = radgrad;\r\n        context.translate(x - size, y - size);\r\n        context.fillRect(0, 0, size * 2, size * 2);\r\n        context.restore();\r\n    }\r\n\r\n    function continueLine(x, y, p) {\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\r\n\r\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * localSize * spacing);\r\n\r\n        function bezierCallback(val) {\r\n            let factor = val.t;\r\n            localPressure = lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (opacityPressure) ? (opacity * localPressure * localPressure) : opacity;\r\n            localSize = (sizePressure) ? Math.max(0.1, localPressure * size) : Math.max(0.1, size);\r\n\r\n            drawDot(val.x, val.y, localSize, localOpacity);\r\n        }\r\n\r\n        if (x === null) {\r\n            bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n    }\r\n\r\n\r\n    this.startLine = function (x, y, p) {\r\n        historyEntry = {\r\n            tool: [\"brush\", \"EraserBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [opacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [sizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [size]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [opacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setTransparentBG\",\r\n            params: [isTransparentBG]\r\n        });\r\n\r\n        isBaseLayer = 0 === context.canvas.index;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localOpacity = (opacityPressure) ? (opacity * p * p) : opacity;\r\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\r\n\r\n        started = true;\r\n        if (localSize > 1) {\r\n            drawDot(x, y, localSize, localOpacity);\r\n        }\r\n        lastDot = localSize * spacing;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n        lastInput2 = BB.copyObj(lastInput);\r\n\r\n        bezierLine = new BB.BezierLine();\r\n        bezierLine.add(x, y, 0, function () {\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"startLine\",\r\n            params: [x, y, p]\r\n        });\r\n    };\r\n    this.goLine = function (x, y, p) {\r\n        if (!started) {\r\n            return;\r\n        }\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [x, y, p]\r\n        });\r\n\r\n        continueLine(x, y, lastInput.pressure);\r\n\r\n        lastInput2 = BB.copyObj(lastInput);\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n    };\r\n    this.endLine = function () {\r\n\r\n        if (bezierLine) {\r\n            continueLine(null, null, lastInput.pressure);\r\n        }\r\n\r\n        started = false;\r\n        bezierLine = undefined;\r\n\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: []\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n\r\n        isBaseLayer = 0 === context.canvas.index;\r\n\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n\r\n        if (started || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * size * spacing);\r\n        lastDot = 0;\r\n        for (loopDist = lastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, size, opacity);\r\n        }\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"EraserBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [opacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [sizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [size]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [opacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setTransparentBG\",\r\n            params: [isTransparentBG]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    //IS\r\n    this.isDrawing = function () {\r\n        return started;\r\n    };\r\n    //SET\r\n    /*this.setAlpha = function(a) {\r\n        lastInput = {};\r\n        alpha = a;\r\n        updateAlphaCanvas();\r\n    };*/\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSize = function (s) {\r\n        size = s;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        opacity = o;\r\n    };\r\n    this.sizePressure = function (b) {\r\n        sizePressure = b;\r\n    };\r\n    this.opacityPressure = function (b) {\r\n        opacityPressure = b;\r\n    };\r\n    this.setTransparentBG = function (b) {\r\n        isTransparentBG = b == true;\r\n    };\r\n    //GET\r\n    this.getSize = function () {\r\n        return size;\r\n    };\r\n    this.getOpacity = function () {\r\n        return opacity;\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb.types';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB} from '../kl.types';\r\n\r\n// let statCount = 1;\r\n// let statAcc = 0;\r\n// stats on win10, chrome, size 100, opacity 80, smudge()\r\n// unoptimized: 1 ms\r\n// minimal: 0.09 ms\r\n// minimal + circle: 0.5ms\r\n// minimal + circle + ix, iy: 0.23ms\r\n// unoptimized + ix, iy: 0.64 ms\r\n// unoptimized + ix, iy + sans rounding: 0.61 ms\r\n// ix, iy + sans rounding + sans random: 0.32ms\r\n// ix, iy + sans rounding + fast random: 0.46 ms\r\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\r\n\r\nconst CELL_SIZE = 256;\r\n\r\ninterface ISmudgeParams {\r\n    aP: IVector2D;\r\n    bP: IVector2D;\r\n    size: {\r\n        w: number;\r\n        h: number;\r\n    };\r\n    brush: {\r\n        center: IVector2D,\r\n        size: number;\r\n        opacity: number;\r\n        alphaLock: boolean;\r\n    };\r\n}\r\n\r\n\r\n/**\r\n * determine bounds of smudge\r\n * @param imWidth\r\n * @param imHeight\r\n * @param aP\r\n * @param bP\r\n * @param size\r\n */\r\nfunction prepSmudge(\r\n    imWidth: number,\r\n    imHeight: number,\r\n    aP: IVector2D, // top left of source, integers\r\n    bP: IVector2D, // top left of dest, integers\r\n    size: {w: number; h: number}, // size of both rectangles, integers\r\n): {\r\n    aP: IVector2D,\r\n    bP: IVector2D,\r\n    size: {w: number; h: number},\r\n} {\r\n\r\n    if (aP.x === bP.x && aP.y === bP.y) {\r\n        return null;\r\n    }\r\n\r\n    aP = BB.copyObj(aP);\r\n    bP = BB.copyObj(bP);\r\n    size = BB.copyObj(size);\r\n\r\n    // corner behavior\r\n    // cut down rectangles, if a or b go outside\r\n    // i.e. if user drags partially or fully outside the canvas\r\n    {\r\n        let top = 0;\r\n        let right = 0;\r\n        let bottom = 0;\r\n        let left = 0;\r\n\r\n        if (aP.x < 0) {\r\n            left = -aP.x;\r\n        }\r\n        if (aP.y < 0) {\r\n            top = -aP.y;\r\n        }\r\n        if (bP.x < 0) {\r\n            left = Math.max(left, -bP.x);\r\n        }\r\n        if (bP.y < 0) {\r\n            top = Math.max(top, -bP.y);\r\n        }\r\n        if (aP.x + size.w > imWidth) {\r\n            right = aP.x + size.w - imWidth;\r\n        }\r\n        if (aP.y + size.h > imHeight) {\r\n            bottom = aP.y + size.h - imHeight;\r\n        }\r\n        if (bP.x + size.w > imWidth) {\r\n            right = Math.max(right, bP.x + size.w - imWidth);\r\n        }\r\n        if (bP.y + size.h > imHeight) {\r\n            bottom = Math.max(bottom, bP.y + size.h - imHeight);\r\n        }\r\n\r\n        aP.x += left;\r\n        bP.x += left;\r\n        aP.y += top;\r\n        bP.y += top;\r\n\r\n        size.w = size.w - left - right;\r\n        size.h = size.h - top - bottom;\r\n        if (size.w <= 0 || size.h <= 0) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    return {\r\n        aP: {\r\n            x: aP.x,\r\n            y: aP.y,\r\n        },\r\n        bP: {\r\n            x: bP.x,\r\n            y: bP.y,\r\n        },\r\n        size: {\r\n            w: size.w,\r\n            h: size.h,\r\n        }\r\n    };\r\n}\r\n\r\n// faster than using BB.clamp somehow (in chrome)\r\nfunction clamp(num, min, max) {\r\n    return num <= min\r\n        ? min\r\n        : num >= max\r\n            ? max\r\n            : num\r\n}\r\n\r\n/**\r\n * Pixel operations that do the smudging via ImageData\r\n * @param imageData\r\n * @param p\r\n */\r\nfunction smudge(imageData: ImageData, p : ISmudgeParams): void {\r\n\r\n    p = BB.copyObj(p);\r\n\r\n    const cSize = p.brush.size;\r\n    const cX = p.brush.center.x;\r\n    const cY = p.brush.center.y;\r\n\r\n    /*if (statCount % 1000 === 0) {\r\n        console.log(statAcc / 1000);\r\n        statAcc = 0;\r\n    }\r\n    let start = performance.now();*/\r\n\r\n\r\n    // determine offset\r\n    let aIndex = p.aP.y * imageData.width + p.aP.x;\r\n    let bIndex = p.bP.y * imageData.width + p.bP.x;\r\n    const offset = (bIndex - aIndex) * 4;\r\n\r\n    // array with random numbers. faster than Math.random()\r\n    let randI = 0;\r\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n    const randArr = [];\r\n    for (let i = 0; i < randLen; i++) {\r\n        randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n    }\r\n\r\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\r\n\r\n    const pixel = (ai, bi, ix, iy) => {\r\n\r\n        const dist = BB.dist(cX, cY, ix, iy);\r\n        const fac = 1 - p.brush.opacity * (1 - clamp((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\r\n\r\n        if (fac === 1) {\r\n            return;\r\n        }\r\n\r\n        if (!imageData.data[ai + 3]) {\r\n\r\n        } else if (!imageData.data[bi + 3]) { // don't mix if target fully transparent. pixel might have a strange color.\r\n            imageData.data[bi] = imageData.data[ai + 0];\r\n            imageData.data[bi + 1] = imageData.data[ai + 1];\r\n            imageData.data[bi + 2] = imageData.data[ai + 2];\r\n        } else {\r\n\r\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\r\n            // not totally accurate. TODO same compositing as blend brush\r\n            let fac2;\r\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) {\r\n                fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\r\n            } else {\r\n                fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\r\n            }\r\n\r\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\r\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\r\n            // No +0.5, because it cancels out with rand.\r\n            imageData.data[bi] = Math.floor(BB.mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\r\n            imageData.data[bi + 1] = Math.floor(BB.mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\r\n            imageData.data[bi + 2] = Math.floor(BB.mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\r\n\r\n            randI = (randI + 1) % randLen;\r\n        }\r\n        // Always mix alpha. unless alpha lock\r\n        if (!p.brush.alphaLock) {\r\n            imageData.data[bi + 3] = Math.floor(BB.mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\r\n        }\r\n\r\n    };\r\n\r\n    const bx1 = p.bP.x * 4;\r\n    const bx2 = bx1 + (p.size.w - 1) * 4;\r\n\r\n    // transfer of pixels depends on direction of smudging if there is overlap\r\n    if (p.aP.y < p.bP.y) {\r\n        for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else if (p.aP.y > p.bP.y) {\r\n        for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else {\r\n        if (p.aP.x < p.bP.x) {\r\n            for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        } else {\r\n            for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x; x < bx2 + yStart; x += 4, x2 += 4, ix++) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //statCount++;\r\n    //statAcc += performance.now() - start;\r\n}\r\n\r\nexport class SmudgeBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IHistoryEntry;\r\n\r\n    private settingColor: IRGB = {r: 0, g: 0, b: 0};\r\n    private settingSize: number = 35;\r\n    private settingSpacing: number = 0.20446882736951905;\r\n    private settingOpacity: number = 0.8;\r\n    private settingColorStr: string;\r\n    private settingHasSizePressure: boolean = false;\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingLockLayerAlpha: boolean = false;\r\n\r\n    private lineToolLastDot: number;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastDot: IVector2D;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private bezierLine: any = null; // todo type BezierLine\r\n\r\n    private redrawBounds: IBounds;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    private copyImageData: ImageData;\r\n\r\n    private drawBuffer: ISmudgeParams[] = [];\r\n\r\n    private copiedCells: boolean[];\r\n\r\n    updateRedrawBounds(bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    updateCompleteRedrawBounds (x1, y1, x2, y2): void {\r\n        this.completeRedrawBounds = BB.updateBounds(\r\n            this.completeRedrawBounds,\r\n            { x1, y1, x2, y2 }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    copyFromCanvas(): void {\r\n\r\n        const touchedCells = this.copiedCells.map(item => false);\r\n\r\n        const bounds: IBounds[] = [];\r\n        const cellsW = Math.ceil(this.copyImageData.width / CELL_SIZE);\r\n\r\n        if (!this.redrawBounds) {\r\n            return;\r\n        }\r\n        bounds.push({\r\n            x1: Math.floor(this.redrawBounds.x1 / CELL_SIZE),\r\n            y1: Math.floor(this.redrawBounds.y1 / CELL_SIZE),\r\n            x2: Math.floor(this.redrawBounds.x2 / CELL_SIZE),\r\n            y2: Math.floor(this.redrawBounds.y2 / CELL_SIZE),\r\n        });\r\n        bounds.forEach(item => {\r\n            for (let i = item.x1; i <= item.x2; i++) {\r\n                for (let e = item.y1; e <= item.y2; e++) {\r\n                    touchedCells[e * cellsW + i] = true;\r\n                }\r\n            }\r\n        });\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.copiedCells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            this.copiedCells[i] = true;\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * CELL_SIZE + CELL_SIZE, this.copyImageData.width) - 1) % CELL_SIZE + 1;\r\n            const h = (Math.min(y * CELL_SIZE + CELL_SIZE, this.copyImageData.height) - 1) % CELL_SIZE + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = tmpCanvas.getContext('2d');\r\n            tmpCtx.drawImage(this.context.canvas, -x * CELL_SIZE, -y * CELL_SIZE);\r\n\r\n            const data = tmpCtx.getImageData(0, 0, w, h);\r\n\r\n            for (let i = 0; i < h; i++) {\r\n                for (let e = 0, e2 = i * w * 4, e3 = ((y * CELL_SIZE + i) * this.copyImageData.width + x * CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4) {\r\n                    this.copyImageData.data[e3] = data.data[e2];\r\n                    this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\r\n                    this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\r\n                    this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * fill drawBuffer with params about to be drawn\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     */\r\n    prepDot (x: number, y: number, size: number, opacity: number): void {\r\n        if (!this.lastDot) {\r\n            this.lastDot = {\r\n                x: x,\r\n                y: y,\r\n            };\r\n            return;\r\n        }\r\n\r\n        size = Math.round(size);\r\n\r\n\r\n        const w = Math.round(size * 2);\r\n        const h = Math.round(size * 2);\r\n\r\n        const bounds = prepSmudge(\r\n            this.copyImageData.width,\r\n            this.copyImageData.height,\r\n            {\r\n                x: Math.round(this.lastDot.x - size),\r\n                y: Math.round(this.lastDot.y - size),\r\n            },\r\n            {\r\n                x: Math.round(x - size),\r\n                y: Math.round(y - size),\r\n            },\r\n            {\r\n                w,\r\n                h,\r\n            },\r\n        );\r\n\r\n        if (bounds) {\r\n            const params: ISmudgeParams = {\r\n                aP: bounds.aP,\r\n                bP: bounds.bP,\r\n                size: bounds.size,\r\n                brush: {\r\n                    center: { x, y },\r\n                    size,\r\n                    opacity,\r\n                    alphaLock: this.settingLockLayerAlpha,\r\n                }\r\n            };\r\n            this.updateRedrawBounds({\r\n                x1: params.bP.x,\r\n                y1: params.bP.y,\r\n                x2: params.bP.x + params.brush.size * 2,\r\n                y2: params.bP.y + params.brush.size * 2,\r\n            });\r\n            this.drawBuffer.push(params);\r\n        }\r\n\r\n        this.lastDot = {\r\n            x: x,\r\n            y: y,\r\n        };\r\n    }\r\n\r\n    continueLine (x: number, y: number, size: number, pressure: number): void {\r\n        this.drawBuffer = [];\r\n\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function(){});\r\n        }\r\n\r\n        const drawArr = []; //draw instructions. will be all drawn at once\r\n\r\n        const dotCallback = (val): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        };\r\n\r\n        const localSpacing = size * this.settingSpacing / 3;\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            const item = drawArr[i];\r\n            this.prepDot(item[0], item[1], item[2], item[3]);\r\n            before = item;\r\n        }\r\n\r\n        this.copyFromCanvas();\r\n\r\n        for (let i = 0; i < this.drawBuffer.length; i++) {\r\n            smudge(this.copyImageData, this.drawBuffer[i]);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor () { }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: [\"brush\", \"SmudgeBrush\"],\r\n            actions: []\r\n        };\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.lastDot = null;\r\n        this.isDrawing = true;\r\n\r\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\r\n        const totalCells = Math.ceil(this.context.canvas.width / CELL_SIZE) * Math.ceil(this.context.canvas.height / CELL_SIZE);\r\n        this.copiedCells = '0'.repeat(totalCells).split('').map(item => false);\r\n\r\n        this.prepDot(x, y, localSize, localOpacity);\r\n\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2.pressure = p;\r\n\r\n        this.completeRedrawBounds = null;\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        this.redrawBounds = null;\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput2.pressure = this.lastInput.pressure;\r\n        this.lastInput.pressure = pressure;\r\n    }\r\n\r\n    endLine (): void {\r\n        this.redrawBounds = null;\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.context.save();\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n        this.context.restore();\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        if (this.historyEntry && this.completeRedrawBounds) {\r\n            let historyIm: ImageData | HTMLCanvasElement = this.copyImageData;\r\n            if (!(\r\n                this.completeRedrawBounds.x1 === 0 &&\r\n                this.completeRedrawBounds.y1 === 0 &&\r\n                this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 &&\r\n                this.completeRedrawBounds.y2 >= this.context.canvas.height - 1\r\n            )) {\r\n\r\n                // temp canvas to prevent main canvas from getting slowed down in chrome\r\n                const tmpCanvas = BB.canvas(\r\n                    this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                    this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n                );\r\n                const tmpCtx = tmpCanvas.getContext('2d');\r\n                tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n                historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\r\n            }\r\n            this.historyEntry.actions.push({\r\n                action: \"drawImage\",\r\n                params: [\r\n                    historyIm,\r\n                    this.completeRedrawBounds.x1,\r\n                    this.completeRedrawBounds.y1,\r\n                ],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n        this.copyImageData = null;\r\n    }\r\n\r\n    drawImage (im: ImageData | HTMLCanvasElement, x: number, y: number): void {\r\n        if (im instanceof ImageData) {\r\n            this.context.putImageData(im, x, y);\r\n        } else {\r\n            this.context.clearRect(x, y, im.width, im.height);\r\n            this.context.drawImage(im, x, y);\r\n        }\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        return;\r\n        /*\r\n        // todo\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = settingSize * settingSpacing;\r\n        lineToolLastDot = settingSize * settingSpacing;\r\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\r\n        }\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"SmudgeBrush\"],\r\n            actions: []\r\n        };\r\n        // todo\r\n        history.add(historyEntry);*/\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) {\r\n            return;\r\n        }\r\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\r\n        this.settingColorStr = BB.ColorConverter.toRgbStr(this.settingColor);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = !!b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = !!b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl.types';\r\nimport {IBounds} from '../../bb/bb.types';\r\nimport {KlHistoryInterface} from '../history/kl-history';\r\n\r\ntype TChemyMode = 'fill' | 'stroke';\r\n\r\nexport class ChemyBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private settingColor: IRGB;\r\n    private settingSize: number = 0.25; // radius - 0.5 - 99999\r\n    private settingOpacity: number = 1; // 0-1\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingIsEraser: boolean = false;\r\n    private settingMode: TChemyMode = 'fill';\r\n    private settingDistort: number = 0; // 0 - 1\r\n    private settingXSymmetry: boolean = false;\r\n    private settingYSymmetry: boolean = false;\r\n    private settingGradient: boolean = false;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private history: KlHistoryInterface;\r\n\r\n    private copyCanvas: HTMLCanvasElement;\r\n    private path: {x: number, y: number}[];\r\n    private minY: number;\r\n    private maxY: number;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    updateCompleteRedrawBounds (x, y): void {\r\n        let bounds = { x1: x, y1: y, x2: x, y2: y};\r\n        if (this.settingXSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: -x + this.copyCanvas.width,\r\n                    y1: y,\r\n                    x2: -x + this.copyCanvas.width,\r\n                    y2: y,\r\n                }\r\n                );\r\n        }\r\n        if (this.settingYSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: x,\r\n                    y1: -y + this.copyCanvas.height,\r\n                    x2: x,\r\n                    y2: -y + this.copyCanvas.height,\r\n                }\r\n            );\r\n        }\r\n        const buffer = this.settingMode === 'stroke' ? this.settingSize + 1 : 1;\r\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\r\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\r\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\r\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\r\n\r\n        this.completeRedrawBounds = BB.updateBounds(this.completeRedrawBounds, bounds);\r\n    }\r\n\r\n    private drawShape (): void {\r\n        this.context.save();\r\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\r\n        this.context.drawImage(this.copyCanvas, 0, 0);\r\n\r\n        let color = {...this.settingColor};\r\n        if (this.settingIsEraser) {\r\n            color.r = 255;\r\n            color.g = 255;\r\n            color.b = 255;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = \"source-atop\";\r\n            } else {\r\n                this.context.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        } else {\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        }\r\n\r\n        if (this.path) {\r\n\r\n            // path\r\n            const path = new Path2D();\r\n            this.path.forEach((item, index) => {\r\n                if (index === 0) {\r\n                    path.moveTo(item.x, item.y);\r\n                } else {\r\n                    path.lineTo(item.x, item.y);\r\n                }\r\n            });\r\n\r\n            let style: string | CanvasGradient = BB.ColorConverter.toRgbaStr({\r\n                r: color.r,\r\n                g: color.g,\r\n                b: color.b,\r\n                a: this.settingOpacity,\r\n            });\r\n            if (this.settingGradient) {\r\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\r\n                const gradient = this.context.createLinearGradient(\r\n                    0, startAtTop ? this.minY : this.maxY,\r\n                    0, startAtTop ? this.maxY : this.minY,\r\n                );\r\n                gradient.addColorStop(\r\n                    0,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: this.settingOpacity,\r\n                    })\r\n                );\r\n                gradient.addColorStop(\r\n                    1,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: 0,\r\n                    })\r\n                );\r\n                style = gradient;\r\n            }\r\n\r\n            // setup params\r\n            if (this.settingMode === 'fill') {\r\n                this.context.fillStyle = style;\r\n\r\n            } else {\r\n                this.context.lineWidth = this.settingSize * 2;\r\n                this.context.lineJoin = 'bevel';\r\n                this.context.strokeStyle = style;\r\n            }\r\n\r\n            // draw\r\n            const draw = () => {\r\n                if (this.settingMode === 'fill') {\r\n                    this.context.fill(path);\r\n                } else {\r\n                    this.context.stroke(path);\r\n                }\r\n            };\r\n\r\n            draw();\r\n            if (this.settingXSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(this.context.canvas.width / 2, 0);\r\n                this.context.scale(-1, 1);\r\n                this.context.translate(-this.context.canvas.width / 2, 0);\r\n                draw();\r\n                this.context.restore();\r\n            }\r\n            if (this.settingYSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(0, this.context.canvas.height / 2);\r\n                this.context.scale(1, -1);\r\n                this.context.translate(0, -this.context.canvas.height / 2);\r\n                draw();\r\n                this.context.restore();\r\n                if (this.settingXSymmetry) {\r\n                    this.context.save();\r\n                    this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\r\n                    this.context.scale(-1, -1);\r\n                    this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\r\n                    draw();\r\n                    this.context.restore();\r\n                }\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingMode === 'stroke' ? this.settingSize : 0;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.settingColor = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setMode (mode: TChemyMode): void {\r\n        this.settingMode = mode;\r\n    }\r\n\r\n    getMode (): TChemyMode {\r\n        return this.settingMode;\r\n    }\r\n\r\n    setDistort (distort: number): void {\r\n        this.settingDistort = BB.clamp(distort, 0, 1);\r\n    }\r\n\r\n    getDistort (): number {\r\n        return this.settingDistort;\r\n    }\r\n\r\n    setXSymmetry (b: boolean): void {\r\n        this.settingXSymmetry = !!b;\r\n    }\r\n\r\n    getXSymmetry (): boolean {\r\n        return this.settingXSymmetry;\r\n    }\r\n\r\n    setYSymmetry (b: boolean): void {\r\n        this.settingYSymmetry = !!b;\r\n    }\r\n\r\n    getYSymmetry (): boolean {\r\n        return this.settingYSymmetry;\r\n    }\r\n\r\n    setGradient (b: boolean): void {\r\n        this.settingGradient = !!b;\r\n    }\r\n\r\n    getGradient (): boolean {\r\n        return this.settingGradient;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.settingIsEraser;\r\n    }\r\n\r\n    setIsEraser (b: boolean): void {\r\n        this.settingIsEraser = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    startLine (x: number, y: number): void {\r\n        this.isDrawing = true;\r\n        this.path = [{x, y}];\r\n        this.minY = y;\r\n        this.maxY = y;\r\n        this.copyCanvas = BB.canvas(this.context.canvas.width, this.context.canvas.height);\r\n        this.copyCanvas.getContext('2d').drawImage(this.context.canvas, 0, 0);\r\n        this.completeRedrawBounds = null;\r\n        this.updateCompleteRedrawBounds(x, y);\r\n    }\r\n\r\n    goLine (x: number, y: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        let pos = { x, y };\r\n        if (this.settingDistort > 0) {\r\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\r\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\r\n        }\r\n\r\n        this.minY = Math.min(this.minY, pos.y);\r\n        this.maxY = Math.max(this.maxY, pos.y);\r\n        this.path.push(pos);\r\n        this.updateCompleteRedrawBounds(x, y);\r\n        this.drawShape();\r\n    }\r\n\r\n    endLine (): void {\r\n        this.isDrawing = false;\r\n        this.completeRedrawBounds = BB.boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\r\n        if (this.path.length > 1 && this.completeRedrawBounds) {\r\n            const historyCanvas = BB.canvas(\r\n                this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n            );\r\n            const historyCtx = historyCanvas.getContext('2d');\r\n            historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n            this.history.push({\r\n                tool: [\"brush\", \"ChemyBrush\"],\r\n                actions: [\r\n                    {\r\n                        action: \"drawImage\",\r\n                        params: [\r\n                            historyCanvas, // faster than getting image data (measured on 2018 lenovo chromebook)\r\n                            this.completeRedrawBounds.x1,\r\n                            this.completeRedrawBounds.y1,\r\n                        ],\r\n                    }\r\n                ]\r\n            });\r\n        }\r\n        this.path = null;\r\n        this.copyCanvas = null;\r\n    }\r\n\r\n    drawImage (im: HTMLCanvasElement, x: number, y: number): void {\r\n        this.context.save();\r\n        this.context.clearRect(x, y, im.width, im.height);\r\n        this.context.drawImage(im, x, y);\r\n        this.context.restore();\r\n    }\r\n\r\n    drawLineSegment (x1, y1, x2, y2): void {\r\n        // might make sense for stroke\r\n    }\r\n}\r\n","import {penBrushUi} from './pen-brush-ui';\r\nimport {blendBrushUi} from './blend-brush-ui';\r\nimport {sketchyBrushUi} from './sketchy-brush-ui';\r\nimport {pixelBrushUi} from './pixel-brush-ui';\r\nimport {eraserBrushUi} from './eraser-brush-ui';\r\nimport {smudgeBrushUi} from './smudge-brush-ui';\r\nimport {chemyBrushUi} from './chemy-brush-ui';\r\nimport {IBrushUi} from '../kl.types';\r\n\r\n/**\r\n * UI for brushes.\r\n * Each brush ui carries the brush with it.\r\n * So if you want to draw, you do it through the UI. should be changed sometime.\r\n */\r\n\r\nexport const brushesUI: {\r\n    [key: string]: IBrushUi;\r\n} = {\r\n    penBrush: penBrushUi,\r\n    blendBrush: blendBrushUi,\r\n    sketchyBrush: sketchyBrushUi,\r\n    pixelBrush: pixelBrushUi,\r\n    chemyBrush: chemyBrushUi,\r\n    smudgeBrush: smudgeBrushUi,\r\n    eraserBrush: eraserBrushUi,\r\n};\r\n","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pen.svg';\r\nimport {genBrushAlpha01, genBrushAlpha02} from '../brushes/alphas/brush-alphas';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {input} from '../ui/base-components/input';\r\n\r\nexport const penBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pen'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1/100,\r\n            max: 1,\r\n            curve: [[0, 1/100], [0.5, 30/100], [1, 1]]\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    let alphaNames = [\r\n        LANG('brush-pen-circle'),\r\n        LANG('brush-pen-chalk'),\r\n        LANG('brush-pen-calligraphy'),\r\n        LANG('brush-pen-square'),\r\n    ];\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pen');\r\n        alphaNames = [\r\n            LANG('brush-pen-circle'),\r\n            LANG('brush-pen-chalk'),\r\n            LANG('brush-pen-calligraphy'),\r\n            LANG('brush-pen-square'),\r\n        ];\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.PenBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        let alphas = [];\r\n        let currentAlpha = 0;\r\n        for (let i = 0; i < 4; i++) {\r\n            (function (i) {\r\n                let alpha = BB.el({\r\n                    title: alphaNames[i],\r\n                    onClick: () => {\r\n                        alphaClick(i);\r\n                    }\r\n                });\r\n                let canvas = BB.canvas(70, 70);\r\n                let ctx = canvas.getContext('2d');\r\n                if (i === 0 || i === 3) {\r\n                    if (i === 0) {\r\n                        ctx.beginPath();\r\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\r\n                        ctx.closePath();\r\n                        ctx.fill();\r\n                    } else {\r\n                        ctx.fillRect(5, 5, 60, 60);\r\n                    }\r\n                } else if (i === 1) {\r\n                    ctx.drawImage(genBrushAlpha01(60), 5, 5);\r\n                } else if (i === 2) {\r\n                    ctx.drawImage(genBrushAlpha02(60), 5, 5);\r\n                }\r\n                alpha.style.backgroundImage = 'url(' + canvas.toDataURL('image/png') + ')';\r\n\r\n                alphas.push(alpha);\r\n            }(i));\r\n        }\r\n\r\n        function updateAlphas() {\r\n            for (let i = 0; i < alphas.length; i++) {\r\n                if (i === currentAlpha) {\r\n                    alphas[i].className = 'brush-alpha-selected';\r\n                } else {\r\n                    alphas[i].className = 'brush-alpha';\r\n                }\r\n            }\r\n        }\r\n\r\n        updateAlphas();\r\n\r\n        function alphaClick(id) {\r\n            currentAlpha = id;\r\n            brush.setAlpha(id);\r\n            updateAlphas();\r\n        }\r\n\r\n        let lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n            css: {\r\n                cssFloat: 'right',\r\n                textAlign: 'right',\r\n            }\r\n        });\r\n\r\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                })\r\n            );\r\n\r\n            let alphaWrapper = document.createElement(\"div\");\r\n            for (let i = 0; i < alphas.length; i++) {\r\n                alphaWrapper.appendChild(alphas[i]);\r\n            }\r\n            alphaWrapper.style.marginTop = \"10px\";\r\n            div.appendChild(alphaWrapper);\r\n            alphaWrapper.appendChild(lockAlphaToggle.getElement());\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","\r\nexport const eventResMs = 20;","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iiCd6\");","import {BB} from '../../bb/bb';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-blend.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const blendBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-blend'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-blend');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.BlendBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: 58,\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n            let blendingSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 225,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: brush.getBlending(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val);\r\n                },\r\n            });\r\n            blendingSlider.getElement().style.marginTop = \"10px\";\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.setSizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.setOpacityPressure(b);\r\n            });\r\n\r\n            let lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                    display: 'inline-block',\r\n                }\r\n            });\r\n\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                }),\r\n                blendingSlider.getElement(),\r\n                lockAlphaToggle.getElement()\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y, p, isCoalesced);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6fRlX\");","import {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-sketchy.png';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {BB} from '../../bb/bb';\r\n\r\nexport const sketchyBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-sketchy'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 10\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-sketchy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.SketchyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize() * 2,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: function (val) {\r\n                    brush.setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n            let blendSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: brush.getBlending(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val);\r\n                },\r\n            });\r\n            let scaleSlider = new KlSlider({\r\n                label: LANG('brush-sketchy-scale'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 1,\r\n                max: 20,\r\n                value: brush.getScale(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setScale(val);\r\n                },\r\n            });\r\n            opacitySlider.getElement().style.marginTop = \"10px\";\r\n            blendSlider.getElement().style.marginTop = \"10px\";\r\n            scaleSlider.getElement().style.marginTop = \"10px\";\r\n            div.appendChild(sizeSlider.getElement());\r\n            div.appendChild(opacitySlider.getElement());\r\n            div.appendChild(blendSlider.getElement());\r\n            div.appendChild(scaleSlider.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, pressure) {\r\n            brush.startLine(x, y, pressure);\r\n        };\r\n        this.goLine = function (x, y, pressure) {\r\n            brush.goLine(x, y, pressure, null);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getSeed = function () {\r\n            return parseInt(brush.getSeed());\r\n        };\r\n        this.setSeed = function (s) {\r\n            brush.setSeed(parseInt(s));\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hC7PC\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pixel.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const pixelBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pixel'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pixel');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.PixelBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        let lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n            css: {\r\n                marginRight: '10px',\r\n            }\r\n        });\r\n\r\n        let eraserToggle = new Checkbox({\r\n            init: brush.getIsEraser(),\r\n            label: LANG('eraser'),\r\n            callback: function (b) {\r\n                brush.setIsEraser(b);\r\n            },\r\n            css: {\r\n                marginRight: '10px',\r\n            }\r\n        });\r\n\r\n        let ditherToggle = new Checkbox({\r\n            init: brush.getUseDither(),\r\n            label: LANG('brush-pixel-dither'),\r\n            callback: function (b) {\r\n                brush.setUseDither(b);\r\n            }\r\n        });\r\n\r\n        let spacingSpline = new BB.SplineInterpolator([[0.5, 0.45], [100, 4]]);\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                opacitySlider.getElement()\r\n            );\r\n\r\n            let toggleRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px'\r\n                }\r\n            });\r\n\r\n            toggleRow.appendChild(lockAlphaToggle.getElement());\r\n            toggleRow.appendChild(eraserToggle.getElement());\r\n            toggleRow.appendChild(ditherToggle.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size * 2);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity * 100);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eZgVv\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-eraser.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const eraserBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('eraser') + ' [E]',\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 200,\r\n            curve: BB.quadraticSplineInput(0.5, 200, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('eraser') + ' [E]';\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.EraserBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n        let isTransparentBg = false;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: 30,\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                })\r\n            );\r\n\r\n            let transparencyToggle = new Checkbox({\r\n                init: false,\r\n                label: LANG('brush-eraser-transparent-bg'),\r\n                callback: function (b) {\r\n                    isTransparentBg = b;\r\n                    brush.setTransparentBG(b);\r\n                },\r\n                css: {\r\n                    marginTop: \"10px\",\r\n                }\r\n            });\r\n            div.appendChild(transparencyToggle.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        function drawDot(x, y) {\r\n            brush.drawDot(x, y);\r\n        }\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            //brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.getIsTransparentBg = function () {\r\n            return isTransparentBg;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        }\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fPZin\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-smudge.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const smudgeBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-smudge'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-smudge');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.SmudgeBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        let lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n        });\r\n\r\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(false, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                })\r\n            );\r\n\r\n            let bottomRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            bottomRow.append(lockAlphaToggle.getElement());\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fp7H1\");","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-chemy.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {BoxToggle} from '../ui/base-components/box-toggle';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const chemyBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-chemy'),\r\n        sizeSlider: {\r\n            min: 0.25,\r\n            max: 25,\r\n            curve: BB.quadraticSplineInput(0.25, 25, 0.1),\r\n            isDisabled: true,\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-chemy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement(\"div\"); // the gui\r\n        const brush = new brushes.ChemyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider: KlSlider;\r\n        let opacitySlider: KlSlider;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                isEnabled: brush.getMode() === 'stroke',\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 5) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            BB.css(opacitySlider.getElement(), {\r\n                marginTop: '10px',\r\n            });\r\n\r\n            let eraserToggle = new Checkbox({\r\n                init: brush.getIsEraser(),\r\n                label: LANG('eraser'),\r\n                callback: function (b) {\r\n                    brush.setIsEraser(b);\r\n                },\r\n                css: {\r\n                    marginTop: '10px',\r\n                    marginLeft: '10px',\r\n                }\r\n            });\r\n\r\n            const lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n\r\n            const toggleRow = BB.el({\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n\r\n            const iconSize = 35;\r\n            const padding = 8;\r\n            const actualIconSize = iconSize - padding * 2;\r\n            const halfSize = actualIconSize / 2;\r\n\r\n            const modeOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'fill',\r\n                        label: BB.createSvg({\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: '#000',\r\n                                    style: `transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-fill'),\r\n                    },\r\n                    {\r\n                        id: 'stroke',\r\n                        label: BB.createSvg({\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: 'none',\r\n                                    stroke: '#000',\r\n                                    style: `stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-stroke'),\r\n                    }\r\n                ],\r\n                initId: brush.getMode(),\r\n                onChange: (id: string): void => {\r\n                    brush.setMode(id as 'stroke' | 'fill');\r\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === 'fill';\r\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\r\n\r\n                    const brushSize = brush.getSize();\r\n                    sizeSlider.setValue(brushSize);\r\n                    p.onSizeChange(brushSize);\r\n                    p.onConfigChange();\r\n                }\r\n            });\r\n\r\n            const mirrorXToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`,\r\n                        },\r\n                    ]\r\n                }),\r\n                title: LANG('brush-chemy-mirror-x'),\r\n                init: brush.getXSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setXSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const mirrorYToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`,\r\n                        },\r\n                    ]\r\n                }),\r\n                title: LANG('brush-chemy-mirror-y'),\r\n                init: brush.getYSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setYSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const gradientToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'defs',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'linearGradient',\r\n                                    id: 'gradient',\r\n                                    x1: '0',\r\n                                    y1: '0',\r\n                                    x2: '0',\r\n                                    y2: '1',\r\n                                    childrenArr: [\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '0%',\r\n                                            'stop-color': 'rgba(0,0,0,0)',\r\n                                        },\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '100%',\r\n                                            'stop-color': 'rgba(0,0,0,1)',\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            elementType: 'rect',\r\n                            fill: \"url('#gradient')\",\r\n                            x: '' + padding,\r\n                            y: '' + padding,\r\n                            width: '' + actualIconSize,\r\n                            height: '' + actualIconSize,\r\n                        },\r\n                    ]\r\n                }),\r\n                title: LANG('brush-chemy-gradient'),\r\n                init: brush.getGradient(),\r\n                onChange: (b) => {\r\n                    brush.setGradient(b);\r\n                },\r\n            });\r\n\r\n            BB.css(mirrorXToggle.getElement(), {\r\n                marginLeft: '10px',\r\n            });\r\n            {\r\n                const margin = {\r\n                    marginLeft: '4px',\r\n                };\r\n                BB.css(mirrorYToggle.getElement(), margin);\r\n                BB.css(gradientToggle.getElement(), margin);\r\n            }\r\n\r\n            toggleRow.append(\r\n                modeOptions.getElement(),\r\n                mirrorXToggle.getElement(),\r\n                mirrorYToggle.getElement(),\r\n                gradientToggle.getElement(),\r\n            );\r\n\r\n            div.append(\r\n                sizeSlider.getElement(),\r\n                opacitySlider.getElement(),\r\n                toggleRow,\r\n                BB.el({\r\n                    content: [\r\n                        lockAlphaToggle.getElement(),\r\n                        eraserToggle.getElement(),\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                    }\r\n                })\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eX098\");","import {BB} from '../../../bb/bb';\r\n\r\nexport class BoxToggle {\r\n    el: HTMLElement;\r\n    value: boolean;\r\n\r\n    update (): void {\r\n        this.el.classList.toggle('kl-box-toggle--active', this.value);\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            label: string | HTMLElement | SVGElement;\r\n            title?: string;\r\n            init?: boolean;\r\n            onChange: (b: boolean) => void;\r\n        }\r\n    ) {\r\n        this.value = !!p.init;\r\n        this.el = BB.el({\r\n            content: p.label,\r\n            title: p.title,\r\n            className: (typeof p.label === 'string') ? 'kl-box-toggle' : 'kl-box-toggle kl-box-toggle--custom-el',\r\n            onClick: () => {\r\n                this.value = !this.value;\r\n                this.update();\r\n                p.onChange(this.value);\r\n            },\r\n            css: {\r\n                cursor: 'pointer',\r\n            }\r\n        });\r\n        if (typeof p.label !== 'string') {\r\n            BB.css(p.label, {\r\n                display: 'block',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n        this.update();\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.value;\r\n    }\r\n\r\n    setValue (b: boolean): void {\r\n        this.value = !!b;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.el);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {Popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showIframePopup(url, isEmbed) {\r\n    if (!isEmbed && (window.innerHeight < 500 || window.innerWidth < 700)) {\r\n        window.open(url);\r\n        return;\r\n    }\r\n\r\n    let iframe = BB.el({\r\n        tagName: 'iframe',\r\n        custom: {\r\n            src: url,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            height: '100%'\r\n        }\r\n    }) as HTMLIFrameElement;\r\n    let titleEl = BB.el({});\r\n\r\n    let linkEl;\r\n    if (!isEmbed) {\r\n        linkEl = BB.el({\r\n            tagName: 'a',\r\n            parent: titleEl,\r\n            content: LANG('modal-new-tab'),\r\n            custom: {\r\n                href: 'help',\r\n                target: '_blank',\r\n            },\r\n            onClick: function() {\r\n                popup.close();\r\n            }\r\n        }) as HTMLAnchorElement;\r\n        iframe.onload = function() {\r\n            BB.setAttributes(linkEl, {\r\n                href: '' + iframe.contentWindow.location,\r\n            });\r\n        };\r\n    }\r\n\r\n\r\n    let popup = new Popup({\r\n        title: titleEl,\r\n        content: iframe,\r\n        width: 880,\r\n        isMaxHeight: true,\r\n        onClose: () => {\r\n            if (linkEl) {\r\n                BB.destroyEl(linkEl);\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nexport class RadioList {\r\n\r\n    el: HTMLDivElement;\r\n    inputs: HTMLInputElement[] = [];\r\n\r\n    constructor({name, init, items, ignoreFocus}: {\r\n        name: string;\r\n        init?: string;\r\n        items: {\r\n            label: string;\r\n            value: string;\r\n        }[],\r\n        ignoreFocus?: boolean; // default false\r\n    }) {\r\n        this.el = BB.el({\r\n            className: 'kl-radio'\r\n        }) as HTMLDivElement;\r\n\r\n        items.forEach(item => {\r\n            let label = BB.el({\r\n                tagName: 'label'\r\n            });\r\n            let input = BB.el({\r\n                tagName: 'input',\r\n                parent: label,\r\n                custom: {\r\n                    name: name,\r\n                    value: item.value,\r\n                    type: 'radio',\r\n                }\r\n            }) as HTMLInputElement;\r\n            if (ignoreFocus) {\r\n                input.setAttribute('data-ignore-focus', 'true');\r\n            }\r\n            if (init === item.value) {\r\n                input.checked = true;\r\n            }\r\n            label.append(item.label);\r\n            this.el.append(label);\r\n            this.inputs.push(input);\r\n        });\r\n    }\r\n\r\n\r\n    getValue(): string {\r\n        for (let i = 0; i < this.inputs.length; i++) {\r\n            if (this.inputs[i].checked) {\r\n                return this.inputs[i].value;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getElement() {\r\n        return this.el;\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n// @ts-ignore\r\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\r\nimport {IKlProject} from '../../kl.types';\r\nimport {showIframePopup} from '../modals/show-iframe-popup';\r\nimport {SaveReminder} from './save-reminder';\r\nimport {IProjectStoreListener, ProjectStore} from '../../storage/project-store';\r\nimport {KL} from '../../kl';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport class BrowserStorageUi {\r\n\r\n    private previewEl: HTMLDivElement;\r\n    private infoEl: HTMLDivElement;\r\n    private ageEl: HTMLDivElement;\r\n    private storeButtonEl: HTMLButtonElement;\r\n    private clearButtonEl: HTMLButtonElement;\r\n    private storeListener: IProjectStoreListener;\r\n\r\n    private timestamp: number;\r\n\r\n    private updateAge() {\r\n        if (!this.timestamp) {\r\n            return;\r\n        }\r\n        let age = new Date().getTime() - this.timestamp;\r\n        let ageStr;\r\n        age = Math.floor(age / 1000 / 60);\r\n        ageStr = LANG('file-storage-min-ago').replace('{x}', '' + age);\r\n        if (age > 60) {\r\n            age = Math.floor(age / 60);\r\n            ageStr = LANG('file-storage-hours-ago').replace('{x}', '' + age);\r\n            if (age > 24) {\r\n                age = Math.floor(age / 24);\r\n                ageStr = LANG('file-storage-days-ago').replace('{x}', '' + age);\r\n                if (age > 31) {\r\n                    ageStr = LANG('file-storage-month-ago');\r\n                }\r\n            }\r\n        }\r\n        this.ageEl.textContent = ageStr;\r\n    }\r\n\r\n    private resetButtons() {\r\n        if (this.timestamp) {\r\n            this.storeButtonEl.textContent = LANG('file-storage-overwrite');\r\n            this.storeButtonEl.disabled = false;\r\n            this.clearButtonEl.disabled = false;\r\n        } else {\r\n            this.storeButtonEl.textContent = LANG('file-storage-store');\r\n            this.storeButtonEl.disabled = false;\r\n            this.clearButtonEl.disabled = true;\r\n        }\r\n    }\r\n\r\n    private updateThumb(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.timestamp = timestamp;\r\n        if (this.timestamp) {\r\n            BB.css(thumbnail, {\r\n                display: 'block',\r\n                maxWidth: 'calc(100% - 2px)',\r\n                maxHeight: 'calc(100% - 2px)',\r\n                margin: '0 auto',\r\n                background: \"url('\" + BB.createCheckerCanvas(4).toDataURL('image/png') + \"')\",\r\n                boxShadow: '0 0 0 1px #aaa',\r\n                pointerEvents: 'none',\r\n            });\r\n            this.previewEl.innerHTML = '';\r\n            this.updateAge();\r\n            this.previewEl.append(thumbnail, this.ageEl);\r\n        } else {\r\n            this.previewEl.innerHTML = LANG('file-storage-empty');\r\n        }\r\n        this.resetButtons();\r\n    }\r\n\r\n    private async store() {\r\n        this.storeButtonEl.textContent = LANG('file-storage-storing');\r\n        this.storeButtonEl.disabled = true;\r\n        this.clearButtonEl.disabled = true;\r\n        await new Promise((resolve) => {\r\n            setTimeout(() => resolve(null), 20);\r\n        });\r\n        try {\r\n            await this.projectStore.store(this.getProject());\r\n            this.saveReminder.reset();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: [\r\n                    `${LANG('file-storage-failed-1')}<ul>`,\r\n                    `<li>${LANG('file-storage-failed-2')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-3')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-4')}</li>`,\r\n                    `</ul>`,\r\n                ].join(''),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to store browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    private async clear() {\r\n        this.storeButtonEl.disabled = true;\r\n        this.clearButtonEl.disabled = true;\r\n        try {\r\n            await this.projectStore.clear();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: LANG('file-storage-failed-clear'),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to clear browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    element: HTMLDivElement;\r\n\r\n    constructor (\r\n        private projectStore: ProjectStore,\r\n        private getProject: () => IKlProject,\r\n        private saveReminder: SaveReminder,\r\n        private klRootEl: HTMLDivElement,\r\n        private options?: { hideClearButton?: boolean; isFocusable?: boolean }, // isFocusable default = false\r\n    ) {\r\n        this.element = BB.el({\r\n            css: {\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 0fr',\r\n                gridTemplateRows: '0fr 0fr 0fr',\r\n                gap: '0 0',\r\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"',\r\n            }\r\n        }) as HTMLDivElement;\r\n\r\n\r\n        const title = BB.el({\r\n            parent: this.element,\r\n            content: LANG('file-storage'),\r\n            css: {\r\n                gridArea: 'title',\r\n                display: 'flex',\r\n                margin: '-5px 0',\r\n                //background: '#f00',\r\n            }\r\n        });\r\n\r\n        this.infoEl = BB.el({\r\n            parent: title,\r\n            content: '?',\r\n            title: LANG('file-storage-about'),\r\n            css: {\r\n                cursor: 'pointer',\r\n                marginLeft: '5px',\r\n                width: '19px',\r\n                height: '19px',\r\n                borderRadius: '100%',\r\n                textAlign: 'center',\r\n                lineHeight: '19px',\r\n                fontWeight: 'bold',\r\n                boxShadow: 'inset 0 0 0 1px #000',\r\n            },\r\n            onClick: () => {\r\n                showIframePopup('./help/#help-browser-storage', false);\r\n            }\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.projectStore.isBroken()) {\r\n            BB.el({\r\n                parent: this.element,\r\n                content: \" \" + LANG('file-storage-cant-access'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            return;\r\n        }\r\n\r\n        this.previewEl = BB.el({\r\n            parent: this.element,\r\n            title: LANG('file-storage-thumb-title'),\r\n            css: {\r\n                gridArea: 'preview',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                marginTop: '10px',\r\n                position: 'relative',\r\n                boxShadow: 'inset 0 0 0 1px #aaa',\r\n                background: '#cdcdcd',\r\n                color: '#545454',\r\n                colorScheme: 'only light',\r\n                minHeight: '67px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        this.ageEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                right: '0',\r\n                bottom: '0',\r\n                width: '100%',\r\n                textAlign: 'center',\r\n                background: 'rgba(0,0,0,0.7)',\r\n                color: '#fff',\r\n                textSize: '13px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        const btnCustom = options?.isFocusable ?  {} : {\r\n            tabIndex: -1,\r\n        };\r\n        this.storeButtonEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'gridButton',\r\n            content: LANG('file-storage-store'),\r\n            css: {\r\n                gridArea: 'store',\r\n                //background: '#00f',\r\n            },\r\n            custom: btnCustom,\r\n            onClick: () => this.store(),\r\n        }) as HTMLButtonElement;\r\n        this.clearButtonEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'gridButton',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/> ' + LANG('file-storage-clear'),\r\n            css: {\r\n                gridArea: 'clear',\r\n                //background: '#ff0',\r\n            },\r\n            custom: btnCustom,\r\n            onClick: () => this.clear(),\r\n        }) as HTMLButtonElement;\r\n\r\n        if (this.options?.hideClearButton) {\r\n            this.clearButtonEl.style.visibility = 'hidden';\r\n        }\r\n\r\n        this.storeListener = {\r\n            onUpdate: (timestamp, thumbnail) => {\r\n                this.updateThumb(timestamp, thumbnail);\r\n            },\r\n        };\r\n        this.projectStore.subscribe(this.storeListener);\r\n\r\n        setInterval(() => this.updateAge(), 1000 * 60);\r\n\r\n        (async () => {\r\n            try {\r\n                const readResult = await this.projectStore.read();\r\n                if (readResult) {\r\n                    this.updateThumb(readResult.timestamp, readResult.thumbnail);\r\n                } else {\r\n                    this.updateThumb();\r\n                }\r\n            } catch (e) {\r\n                setTimeout(() => {\r\n                    throw new Error('storage-ui: failed initial read browser storage, ' + e);\r\n                }, 0);\r\n            }\r\n        })();\r\n    }\r\n\r\n\r\n    getElement() {\r\n        return this.element;\r\n    }\r\n\r\n    show () {\r\n        // todo\r\n    }\r\n\r\n    hide () {\r\n        // todo\r\n    }\r\n\r\n    destroy() {\r\n        BB.destroyEl(this.infoEl);\r\n        BB.destroyEl(this.storeButtonEl);\r\n        BB.destroyEl(this.clearButtonEl);\r\n        this.projectStore.unsubscribe(this.storeListener);\r\n    }\r\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\r\nimport {ProjectConverter} from './project-converter';\r\nimport {clear, getKlProjectObj, storeKlProjectObj} from './indexed-db';\r\nimport {LocalStorage} from '../../bb/base/local-storage';\r\n\r\n\r\nexport interface IProjectStoreListener {\r\n    onUpdate: (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) => void,\r\n}\r\n\r\nfunction makeAsync(func): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n        func(resolve, reject);\r\n    });\r\n}\r\n\r\n/**\r\n * simplified interface for storing projects into browser storage\r\n */\r\nexport class ProjectStore {\r\n\r\n    private listeners: IProjectStoreListener[] = [];\r\n    private accessHasFailed: boolean = false;\r\n\r\n    async lowLevelStore (project: IKlStorageProject): Promise<any> {\r\n        await new Promise((resolve, reject) => {\r\n            storeKlProjectObj(project, resolve, reject);\r\n        });\r\n    }\r\n\r\n    async lowLevelRead (): Promise<IKlStorageProject> {\r\n        return await makeAsync(getKlProjectObj) as IKlStorageProject;\r\n    }\r\n\r\n    async lowLevelClear (): Promise<any> {\r\n        await makeAsync(clear);\r\n    }\r\n\r\n\r\n\r\n    private emit(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.listeners.forEach(item => {\r\n            item.onUpdate(timestamp, thumbnail);\r\n        });\r\n    }\r\n\r\n    private updateTimestamp() {\r\n        LocalStorage.setItem('indexedDbUpdatedAt', '' + new Date().getTime());\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== 'indexedDbUpdatedAt' || this.listeners.length === 0) {\r\n                return;\r\n            }\r\n            try {\r\n                ( async () => {\r\n                    const readResult = await this.read();\r\n                    if (readResult) {\r\n                        this.emit(readResult.timestamp, readResult.thumbnail);\r\n                    } else {\r\n                        this.emit();\r\n                    }\r\n                })();\r\n            } catch (e) {\r\n                if (e.message.indexOf('db-error') === 0) {\r\n                    this.accessHasFailed = true;\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    async read(): Promise<{\r\n        project: IKlProject,\r\n        timestamp: number,\r\n        thumbnail: HTMLImageElement | HTMLCanvasElement\r\n    } | null> {\r\n        let storageProject;\r\n        try {\r\n            storageProject = await this.lowLevelRead();\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        if (!storageProject) {\r\n            return null;\r\n        }\r\n        let result;\r\n        try {\r\n            result = await ProjectConverter.readStorageProject(storageProject);\r\n        } catch (e) {\r\n            throw new Error('format-error: ' + e);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    async store(project: IKlProject): Promise<void> {\r\n        try {\r\n            const storageProject = ProjectConverter.createStorageProject(project);\r\n            await this.lowLevelStore(storageProject);\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        {\r\n            // immediately test if it can be read\r\n            const storageProject = await this.lowLevelRead();\r\n            let readResult = null;\r\n            try {\r\n                readResult = await ProjectConverter.readStorageProject(storageProject);\r\n            } catch (e) {\r\n                await this.lowLevelClear();\r\n                this.updateTimestamp();\r\n                setTimeout(() => this.emit(), 0);\r\n                throw new Error('format-error: ' + e);\r\n            }\r\n            this.updateTimestamp();\r\n            setTimeout(() => this.emit(readResult.timestamp, readResult.thumbnail), 0);\r\n        }\r\n    }\r\n\r\n    async clear(): Promise<void> {\r\n        await this.lowLevelClear();\r\n        this.updateTimestamp();\r\n        setTimeout(() => this.emit(), 0);\r\n    }\r\n\r\n    subscribe(listener: IProjectStoreListener) {\r\n        if (this.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        this.listeners.push(listener);\r\n    }\r\n\r\n    unsubscribe(listener: IProjectStoreListener) {\r\n        for (let i = 0; i < this.listeners.length; i++) {\r\n            if (listener === this.listeners[i]) {\r\n                this.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    isBroken() {\r\n        return this.accessHasFailed;\r\n    }\r\n\r\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\r\nimport {BB} from '../../bb/bb';\r\nimport {drawProject} from '../canvas/draw-project';\r\nimport {base64ToBlob} from './base-64-to-blob';\r\n\r\n\r\nconst thumbSize = 240;\r\n\r\nfunction loadImage(blob: Blob): Promise<HTMLImageElement> {\r\n    return new Promise<HTMLImageElement>((resolve, reject) => {\r\n        const im = new Image();\r\n        try {\r\n            im.src = BB.imageBlobToUrl(blob);\r\n        } catch (e) {\r\n            reject('imageBlobToUrl, ' + e.message);\r\n            return;\r\n        }\r\n        im.onload = () => {\r\n            URL.revokeObjectURL(im.src);\r\n            resolve(im);\r\n        }\r\n        im.onabort = function () {\r\n            reject('layer image failed loading');\r\n        };\r\n        im.onerror = function () {\r\n            reject('layer image failed loading');\r\n        };\r\n    });\r\n}\r\n\r\n/**\r\n * for:\r\n * - preparing project to be stored in ProjectStore\r\n * - reading a project that came out of the ProjectStore\r\n */\r\nexport class ProjectConverter {\r\n\r\n    private static createThumbnail(project): HTMLCanvasElement {\r\n        const size = BB.fitInto(project.width, project.height, thumbSize, thumbSize);\r\n        const factor = size.width / project.width;\r\n        return drawProject(project, factor);\r\n    }\r\n\r\n    static createStorageProject(project: IKlProject): IKlStorageProject {\r\n        return {\r\n            id: 1,\r\n            timestamp: new Date().getTime(),\r\n            thumbnail: base64ToBlob(ProjectConverter.createThumbnail(project).toDataURL('image/png')),\r\n            width: project.width,\r\n            height: project.height,\r\n            layers: project.layers.map(item => {\r\n                let blob;\r\n                if (item.image instanceof HTMLCanvasElement) {\r\n                    blob = base64ToBlob((item.image as HTMLCanvasElement).toDataURL('image/png'));\r\n                } else {\r\n                    // todo image\r\n                    throw new Error('Not implemented');\r\n                }\r\n                return {\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                    blob,\r\n                }\r\n            }),\r\n        };\r\n    }\r\n\r\n    static async readStorageProject(storageProject: IKlStorageProject): Promise<{\r\n        project: IKlProject,\r\n        timestamp: number,\r\n        thumbnail: HTMLImageElement | HTMLCanvasElement\r\n    }> {\r\n        if (\r\n            !storageProject.width || !storageProject.height ||\r\n            isNaN(storageProject.width) || isNaN(storageProject.height) ||\r\n            storageProject.width < 1 || storageProject.height < 1\r\n        ) {\r\n            throw new Error('readStorageProject invalid canvas size: ' + storageProject.width + ', ' + storageProject.height);\r\n        }\r\n        const project: IKlProject = {\r\n            width: storageProject.width,\r\n            height: storageProject.height,\r\n            layers: (await Promise.all(storageProject.layers.map(layer => loadImage(layer.blob))))\r\n                .map((image, i) => {\r\n                    return {\r\n                        name: storageProject.layers[i].name,\r\n                        opacity: storageProject.layers[i].opacity,\r\n                        mixModeStr: storageProject.layers[i].mixModeStr,\r\n                        image,\r\n                    };\r\n                }),\r\n        };\r\n\r\n        let thumbnail;\r\n        if (storageProject.thumbnail) {\r\n            thumbnail = await loadImage(storageProject.thumbnail);\r\n        } else {\r\n            thumbnail = ProjectConverter.createThumbnail(project);\r\n        }\r\n\r\n        return {\r\n            project: project,\r\n            timestamp: storageProject.timestamp,\r\n            thumbnail: thumbnail,\r\n        };\r\n    }\r\n\r\n}","\r\nexport function base64ToBlob(base64Str: string): Blob {\r\n    let parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n    let binStr = atob(parts[3]);\r\n    let buf = new ArrayBuffer(binStr.length);\r\n    let view = new Uint8Array(buf);\r\n    for (let i = 0; i < view.length; i++) {\r\n        view[i] = binStr.charCodeAt(i);\r\n    }\r\n    return new Blob([view], {'type': parts[1]});\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\n// @ts-ignore\r\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\r\nimport {BrowserStorageUi} from '../components/browser-storage-ui';\r\nimport {IKlProject} from '../../kl.types';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport type exportType = 'png' | 'layers' | 'psd';\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport class FileTab {\r\n\r\n    private readonly div: HTMLDivElement;\r\n    private importButton: HTMLInputElement;\r\n    private fileBrowserStorage: BrowserStorageUi;\r\n\r\n    constructor(\r\n        klRootEl,\r\n        projectStore: ProjectStore,\r\n        getProject: () => IKlProject,\r\n        private exportType,\r\n        onExportTypeChange,\r\n        onFileSelect,\r\n        onSaveImageToComputer,\r\n        onNewImage,\r\n        onShareImage,\r\n        onUpload,\r\n        onCopyToClipboard,\r\n        saveReminder: SaveReminder,\r\n    ) {\r\n        const _this = this;\r\n        this.div = document.createElement(\"div\");\r\n\r\n        const asyncCreation = () => {\r\n            let filemenu = document.createElement(\"div\");\r\n            let newButton = document.createElement(\"button\");\r\n            let saveButton = document.createElement(\"button\");\r\n            let shareButton = document.createElement(\"button\");\r\n            let uploadImgurButton = document.createElement(\"button\");\r\n            let clipboardButton = document.createElement(\"button\");\r\n\r\n            newButton.style.cssFloat = 'left';\r\n            BB.css(saveButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n            });\r\n            BB.css(clipboardButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n            });\r\n\r\n            newButton.tabIndex = -1;\r\n            saveButton.tabIndex = -1;\r\n            shareButton.tabIndex = -1;\r\n            uploadImgurButton.tabIndex = -1;\r\n            clipboardButton.tabIndex = -1;\r\n\r\n            newButton.innerHTML = `<img src='${newImageImg}' alt='icon' height='20'/>${LANG('file-new')}`;\r\n            saveButton.innerHTML = `<img src='${exportImg}' alt='icon' height='20'/>${LANG('file-save')}`;\r\n            shareButton.innerHTML = `<img src='${shareImg}' alt='icon' height='20'/>${LANG('file-share')}`;\r\n            uploadImgurButton.innerHTML = `<img style='float:left' src='${uploadImg}' height='20' alt='icon'/>${LANG('file-upload')}`;\r\n            clipboardButton.innerHTML = `<img src='${copyImg}' alt='icon' height='20'/>${LANG('file-copy')}`;\r\n            clipboardButton.title = LANG('file-copy-title');\r\n            newButton.className = \"gridButton\";\r\n            saveButton.className = \"gridButton\";\r\n            shareButton.className = \"gridButton\";\r\n            uploadImgurButton.className = \"gridButton\";\r\n            clipboardButton.className = \"gridButton\";\r\n\r\n\r\n            this.importButton = document.createElement(\"input\");\r\n            this.importButton.tabIndex = -1;\r\n            this.importButton.type = \"file\";\r\n            this.importButton.multiple = true;\r\n            this.importButton.accept = \"image\";\r\n            (this.importButton as any).size = \"71\";\r\n            this.importButton.textContent = \"Import\";\r\n            let importWrapper: any = this.importButton;\r\n\r\n            function createImportButton() {\r\n                importWrapper = document.createElement(\"div\");\r\n                importWrapper.className = \"gridButton\";\r\n                importWrapper.style.position = \"relative\";\r\n                importWrapper.style.cursor = \"pointer\";\r\n                importWrapper.style.cssFloat = \"left\";\r\n\r\n                let innerMask = document.createElement(\"div\");\r\n                innerMask.style.width = \"120px\";\r\n                innerMask.style.height = \"28px\";\r\n                innerMask.style.overflow = \"hidden\";\r\n                innerMask.style.cursor = \"pointer\";\r\n                innerMask.style.position = \"relative\";\r\n\r\n                importWrapper.appendChild(innerMask);\r\n                innerMask.appendChild(_this.importButton);\r\n\r\n                let importFakeButton = document.createElement(\"button\");\r\n                importFakeButton.innerHTML = \"<img style='float:left' height='20' src='\" + importImg + \"' alt='icon'/>\" + LANG('file-import');\r\n                importFakeButton.tabIndex = -1;\r\n\r\n                BB.css(importFakeButton, {\r\n                    width: \"120px\",\r\n                    display: \"box\",\r\n                    position: \"absolute\",\r\n                    left: '0',\r\n                    top: '0',\r\n                    cursor: \"pointer\"\r\n                });\r\n                BB.css(_this.importButton, {\r\n                    display: 'none'\r\n                });\r\n                importWrapper.appendChild(importFakeButton);\r\n\r\n                importFakeButton.onclick = function() {\r\n                    _this.importButton.click();\r\n                }\r\n            }\r\n\r\n            createImportButton();\r\n\r\n            this.importButton.onchange = function (e) {\r\n                onFileSelect(_this.importButton.files, 'default');\r\n                _this.importButton.value = \"\";\r\n\r\n            };\r\n\r\n\r\n            // --- export filetype dropdown ---\r\n            let exportTypeWrapper;\r\n            let exportTypeSelect;\r\n            {\r\n                exportTypeWrapper = BB.el({\r\n                    css: {\r\n                        fontSize: '15px',\r\n                        marginLeft: '10px',\r\n                        marginTop: '10px',\r\n                        cssFloat: 'left',\r\n                        width: 'calc(50% - 15px)',\r\n                        height: '30px'\r\n                    }\r\n                });\r\n                exportTypeSelect = new KL.Select({\r\n                    optionArr: [\r\n                        ['png', LANG('file-save-png')],\r\n                        ['psd', LANG('file-save-psd')],\r\n                        ['layers', LANG('file-save-layers')],\r\n                    ],\r\n                    initValue: exportType,\r\n                    onChange: function(val) {\r\n                        exportType = val;\r\n                        onExportTypeChange(exportType);\r\n                        onSaveImageToComputer();\r\n                    }\r\n                });\r\n                BB.css(exportTypeSelect.getElement(), {\r\n                    width: '120px',\r\n                    height: '30px'\r\n                });\r\n                exportTypeWrapper.appendChild(exportTypeSelect.getElement());\r\n\r\n            }\r\n\r\n\r\n\r\n            newButton.onclick = onNewImage;\r\n            saveButton.onclick = function () {\r\n                onSaveImageToComputer();\r\n            };\r\n            shareButton.onclick = function() {\r\n                shareButton.disabled = true;\r\n                onShareImage(() => {\r\n                    shareButton.disabled = false;\r\n                });\r\n            };\r\n            uploadImgurButton.onclick = function () {\r\n                onUpload();\r\n            };\r\n\r\n            clipboardButton.onclick = function() {\r\n                clipboardButton.blur();\r\n                onCopyToClipboard();\r\n            };\r\n\r\n            let saveNote = document.createElement(\"div\");\r\n            saveNote.textContent = \" \" + LANG('file-no-autosave');\r\n            BB.css(saveNote, {\r\n                textAlign: \"center\",\r\n                marginTop: \"10px\",\r\n                background: \"rgb(243, 243, 161)\",\r\n                padding: \"5px 0px\",\r\n                color: 'rgba(0,0,0,0.65)',\r\n                fontSize: '15px',\r\n            });\r\n\r\n            function createSpacer() {\r\n                let el = document.createElement(\"div\");\r\n                let clearer = document.createElement(\"div\");\r\n                let line = document.createElement(\"div\");\r\n                el.appendChild(clearer);\r\n                el.appendChild(line);\r\n                BB.css(clearer, {\r\n                    clear: 'both'\r\n                });\r\n                BB.css(line, {\r\n                    marginLeft: \"10px\",\r\n                    marginRight: \"10px\",\r\n                    marginTop: \"10px\",\r\n                    borderBottom: \"1px solid rgba(0,0,0,0.2)\",\r\n                    clear: 'both'\r\n                });\r\n                return el;\r\n            }\r\n\r\n            _this.fileBrowserStorage = new BrowserStorageUi(projectStore, getProject, saveReminder, klRootEl);\r\n            BB.css(_this.fileBrowserStorage.getElement(), {\r\n                //background: 'red',\r\n                margin: '10px',\r\n            });\r\n\r\n\r\n            //actual structure\r\n            BB.append(filemenu, [\r\n                saveNote,\r\n                newButton,\r\n                importWrapper,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                saveButton,\r\n                exportTypeWrapper,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                clipboardButton,\r\n                BB.canShareFiles() ? shareButton : null,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                createSpacer(),\r\n                _this.fileBrowserStorage.getElement(),\r\n                createSpacer(),\r\n                uploadImgurButton,\r\n            ]);\r\n\r\n            this.div.appendChild(filemenu);\r\n        };\r\n\r\n        setTimeout(asyncCreation, 1);\r\n    }\r\n\r\n    refresh() {\r\n    }\r\n\r\n    getElement() {\r\n        return this.div;\r\n    }\r\n\r\n    setIsVisible(isVisible: boolean) {\r\n        if (isVisible) {\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    triggerImport() {\r\n        this.importButton.click();\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2oHM2\");","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\nimport {StatusOverlay} from '../components/status-overlay';\r\nimport {KlCanvasWorkspace} from '../../canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult} from '../../kl.types';\r\n\r\n\r\nexport class FilterTab {\r\n\r\n    private readonly div: HTMLDivElement;\r\n    private isInit = false;\r\n\r\n    constructor (\r\n        private klRootEl,\r\n        private klColorSlider,\r\n        private layerManager,\r\n        // private setCurrentLayer,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private handUi,\r\n        private getCurrentColor,\r\n        private getKlMaxCanvasSize,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx,\r\n        private isEmbed: boolean,\r\n        private statusOverlay: StatusOverlay,\r\n    ) {\r\n        this.div = document.createElement(\"div\");\r\n    }\r\n\r\n    private init() {\r\n        const _this = this;\r\n        let filters = KL.filterLib;\r\n        let buttons = [];\r\n\r\n        BB.BbLog.emit({\r\n            type: 'init-filters',\r\n        });\r\n\r\n        if (!KL.filterLibStatus.isLoaded) {\r\n            throw new Error('filters not loaded');\r\n        }\r\n\r\n        function createButton(filterKey, filterArr) {\r\n            let button = document.createElement(\"button\");\r\n            let buttonLabel = LANG(filterArr[filterKey].lang.button);\r\n            let im = '<img height=\"20\" width=\"18\" src=\"' + filterArr[filterKey].icon + '\" alt=\"icon\" />';\r\n            button.innerHTML = im + buttonLabel;\r\n            button.className = \"gridButton\";\r\n            BB.css(button, {\r\n                lineHeight: '20px',\r\n                fontSize: '12px',\r\n            });\r\n            button.tabIndex = -1;\r\n\r\n            const filterName = LANG(filterArr[filterKey].lang.name);\r\n\r\n            button.onclick = function () {\r\n\r\n                function finishedDialog(result, filterDialog) {\r\n                    if (result == \"Cancel\") {\r\n                        if (filterDialog.destroy) {\r\n                            filterDialog.destroy();\r\n                        }\r\n                        return;\r\n                    }\r\n                    let input;\r\n                    try {\r\n                        input = filterDialog.getInput(); // also destroys\r\n                    } catch (e) {\r\n                        if (e.message.indexOf('.getInput is not a function') !== -1) {\r\n                            throw 'filterDialog.getInput is not a function, filter: ' + filterName;\r\n                        } else {\r\n                            throw e;\r\n                        }\r\n                    }\r\n                    applyFilter(input);\r\n                }\r\n\r\n                if (!('apply' in filterArr[filterKey])) {\r\n                    alert('Application not fully loaded');\r\n                    return;\r\n                }\r\n\r\n                function applyFilter(input) {\r\n                    let filterResult = filterArr[filterKey].apply({\r\n                        context: _this.getCurrentLayerCtx(),\r\n                        klCanvas: _this.getKlCanvas(),\r\n                        history: klHistory,\r\n                        input: input\r\n                    } as IFilterApply);\r\n                    if (filterResult === false) {\r\n                        alert(\"Couldn't apply the edit action\");\r\n                    }\r\n                    /*\r\n                     _this.setCurrentLayer(_this.getKlCanvas().getLayer(_this.layerManager.getSelected()));\r\n                    */\r\n                    if (filterArr[filterKey].updatePos === true) {\r\n                        _this.klCanvasWorkspace.resetView();\r\n                        _this.handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                    _this.layerManager.update();\r\n                }\r\n\r\n                if (filterArr[filterKey].isInstant){\r\n                    button.blur();\r\n                    applyFilter(null);\r\n                    _this.statusOverlay.out('\"' + filterName + '\" ' + LANG('filter-applied'), true);\r\n                } else {\r\n                    let secondaryColorRGB = _this.klColorSlider.getSecondaryRGB();\r\n                    let filterDialog = filterArr[filterKey].getDialog({\r\n                        context: _this.getCurrentLayerCtx(),\r\n                        klCanvas: _this.getKlCanvas(),\r\n                        maxWidth: _this.getKlMaxCanvasSize(),\r\n                        maxHeight: _this.getKlMaxCanvasSize(),\r\n                        currentColorRgb: {r: _this.getCurrentColor().r, g: _this.getCurrentColor().g, b: _this.getCurrentColor().b},\r\n                        secondaryColorRgb: {r: secondaryColorRGB.r, g: secondaryColorRGB.g, b: secondaryColorRGB.b}\r\n                    } as IFilterGetDialogParam) as IFilterGetDialogResult;\r\n\r\n                    if (!filterDialog) {\r\n                        return;\r\n                        //alert('Error: could not perform action');\r\n                        //throw('filter['+filterKey+'].getDialog returned '+filterDialog+'. ctx:' + currentLayerCtx + ' klCanvas:' + klCanvas);\r\n                    }\r\n\r\n                    let closefunc;\r\n                    // Todo should move into getDialogParams\r\n                    filterDialog.errorCallback = function(e) {\r\n                        setTimeout(function() {\r\n                            alert('Error: could not perform action');\r\n                            throw e;\r\n                        }, 0);\r\n                        closefunc();\r\n                    };\r\n\r\n\r\n                    let style: IKeyString = {};\r\n                    if ('width' in filterDialog) {\r\n                        style.width = filterDialog.width + 'px'\r\n                    }\r\n\r\n                    KL.popup({\r\n                        target: _this.klRootEl,\r\n                        message: \"<b>\" + filterName + \"</b>\",\r\n                        div: filterDialog.element,\r\n                        style: style,\r\n                        buttons: [\"Ok\", \"Cancel\"],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: function(result) {\r\n                            finishedDialog(result, filterDialog);\r\n                        },\r\n                        closefunc: function (func) {\r\n                            closefunc = func;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            buttons[buttons.length] = button;\r\n            return button;\r\n        }\r\n\r\n        function addGroup(groupArr, filterArr, targetEl) {\r\n            for (let filterKey in filterArr) {\r\n                if (filterArr.hasOwnProperty[filterKey] || !groupArr.includes(filterKey)) {\r\n                    continue;\r\n                }\r\n                if (_this.isEmbed && !filterArr[filterKey].inEmbed) {\r\n                    continue;\r\n                }\r\n                targetEl.appendChild(createButton(filterKey, filterArr));\r\n            }\r\n        }\r\n\r\n        const groupA = [\r\n            'cropExtend',\r\n            'flip',\r\n            'perspective',\r\n            'resize',\r\n            'rotate',\r\n            'transform',\r\n        ];\r\n        const groupB = [\r\n            'brightnessContrast',\r\n            'curves',\r\n            'distort',\r\n            'hueSaturation',\r\n            'invert',\r\n            'tiltShift',\r\n            'toAlpha',\r\n            'blur',\r\n            'unsharpMask',\r\n        ];\r\n        const groupC = [\r\n            'grid',\r\n            'noise',\r\n            'pattern',\r\n            'vanishPoint'\r\n        ];\r\n\r\n        addGroup(groupA, filters, _this.div);\r\n\r\n        _this.div.appendChild(BB.el({className: 'gridHr'}));\r\n        addGroup(groupB, filters, _this.div);\r\n        _this.div.appendChild(BB.el({className: 'gridHr'}));\r\n        addGroup(groupC, filters, _this.div);\r\n\r\n        this.isInit = true;\r\n    }\r\n\r\n    getElement() {\r\n        return this.div;\r\n    }\r\n\r\n    show() {\r\n        if (!this.isInit) {\r\n            this.init();\r\n        }\r\n        this.div.style.display = 'block';\r\n    }\r\n\r\n    hide() {\r\n        this.div.style.display = 'none';\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\n// @ts-ignore\r\nimport loadingImg from 'url:~/src/app/img/ui/loading.gif';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {base64ToBlob} from '../../storage/base-64-to-blob';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\nasync function upload(canvas, title, description, type: 'png' | 'jpeg', imgurKey: string): Promise<{deletehash: string}> {\r\n    let img = base64ToBlob(canvas.toDataURL(\"image/\" + type));\r\n\r\n    let w = window.open();\r\n    let label = w.document.createElement(\"div\");\r\n    let gif = w.document.createElement(\"img\");\r\n    gif.src = loadingImg;\r\n    label.appendChild(gif);\r\n    BB.css(gif, {\r\n        filter: \"invert(1)\"\r\n    });\r\n    w.document.body.style.backgroundColor = \"#121211\";\r\n    w.document.body.style.backgroundImage = \"linear-gradient(#2b2b2b 0%, #121211 50%)\";\r\n    w.document.body.style.backgroundRepeat = \"no-repeat\";\r\n    let labelText = w.document.createElement(\"div\");\r\n    labelText.style.marginTop = \"10px\";\r\n    label.appendChild(labelText);\r\n    labelText.textContent = LANG('upload-uploading');\r\n\r\n    w.document.body.appendChild(label);\r\n    BB.css(label, {\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n        marginTop: \"100px\",\r\n        fontFamily: \"Arial, sans-serif\",\r\n        fontSize: \"20px\",\r\n        textAlign: \"center\",\r\n        transition: \"opacity 0.3s ease-in-out\",\r\n        opacity: '0',\r\n        color: \"#ccc\"\r\n    });\r\n    setTimeout(function () {\r\n        label.style.opacity = '1';\r\n    }, 20);\r\n\r\n    let response;\r\n    try {\r\n        const formData = new FormData();\r\n        formData.append('title', title);\r\n        formData.append('description', description);\r\n        formData.append('image', img);\r\n        response = await fetch('https://api.imgur.com/3/image',  {\r\n            method: 'POST',\r\n            headers: {\r\n                Authorization: 'Client-ID ' + imgurKey,\r\n            },\r\n            body: formData\r\n        });\r\n\r\n    } catch (e) {\r\n        w.close();\r\n        throw new Error(e);\r\n    }\r\n    if (!response.ok) {\r\n        w.close();\r\n        throw new Error();\r\n    }\r\n    let data = (await response.json()).data;\r\n\r\n    w.location.href = (data as any).link.replace(/\\.(jpg|png)/, '');\r\n\r\n    return data;\r\n}\r\n\r\n\r\nexport function imgurUpload(klCanvas: KlCanvas, klRootEl, saveReminder: SaveReminder, imgurKey: string) {\r\n    if (!imgurKey) {\r\n        throw new Error('imgur key missing');\r\n    }\r\n\r\n    let inputTitle = document.createElement(\"input\");\r\n    inputTitle.type = \"text\";\r\n    inputTitle.value = LANG('upload-title-untitled');\r\n    let inputDescription = BB.el({\r\n        tagName: 'textarea',\r\n        custom: {\r\n            rows: 2,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            maxWidth: '100%',\r\n        },\r\n    }) as HTMLTextAreaElement;\r\n\r\n    let labelTitle = document.createElement(\"div\");\r\n    labelTitle.textContent = LANG('upload-name') + \":\";\r\n    let labelDescription = BB.el({\r\n        content: LANG('upload-caption') + ':',\r\n        css: {\r\n            marginTop: '10px',\r\n        }\r\n    });\r\n\r\n    let tos = document.createElement(\"div\");\r\n    tos.innerHTML = `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${LANG('upload-tos')}</a> ${LANG('upload-tos-2')}`;\r\n\r\n    const typeRadio = new KL.RadioList({\r\n        name: 'filetype',\r\n        init: 'jpeg',\r\n        items: [\r\n            { label: 'JPG', value: 'jpeg' },\r\n            { label: 'PNG', value: 'png' },\r\n        ],\r\n        ignoreFocus: true,\r\n    });\r\n    BB.css(typeRadio.getElement(), {\r\n        marginBottom: '10px',\r\n    });\r\n\r\n\r\n    let outDiv = document.createElement(\"div\");\r\n    let infoHint = document.createElement(\"div\");\r\n    infoHint.className = \"info-hint\";\r\n    infoHint.textContent = LANG('upload-link-notice');\r\n    outDiv.append(\r\n        infoHint,\r\n        typeRadio.getElement(),\r\n        labelTitle,\r\n        inputTitle,\r\n        labelDescription,\r\n        inputDescription,\r\n        tos\r\n    );\r\n    KL.popup({\r\n        target: klRootEl,\r\n        message: `<b>${LANG('upload-title')}</b>`,\r\n        type: \"upload\",\r\n        div: outDiv,\r\n        buttons: [LANG('upload-submit'), \"Cancel\"],\r\n        clickOnEnter: LANG('upload-submit'),\r\n        primaries: [LANG('upload-submit')],\r\n        autoFocus: LANG('upload-submit'),\r\n        callback: async function (val) {\r\n            if (val === LANG('upload-submit') || val === \"Yes\" || val === \"Ok\") {\r\n                try {\r\n                    const result = await upload(\r\n                        klCanvas.getCompleteCanvas(1),\r\n                        inputTitle.value,\r\n                        inputDescription.value,\r\n                        typeRadio.getValue() as 'png' | 'jpeg',\r\n                        imgurKey,\r\n                    );\r\n\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: \"ok\",\r\n                        message: `<h3>${LANG('upload-success')}</h3><br>${LANG('upload-delete')}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/delete/${result.deletehash}</a><br><br>`,\r\n                        buttons: [\"Ok\"]\r\n                    });\r\n                    saveReminder.reset();\r\n\r\n                } catch(e) {\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: \"error\",\r\n                        message: LANG('upload-failed'),\r\n                        buttons: [\"Ok\"]\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iGeXe\");","import {BB} from '../../bb/bb';\r\n\r\nlet agPsdLazy;\r\nexport async function loadAgPsd() {\r\n    if (!agPsdLazy) {\r\n        agPsdLazy = await import('ag-psd');\r\n        BB.BbLog.emit({\r\n            type: 'loaded-agpsd',\r\n        });\r\n    }\r\n    return agPsdLazy;\r\n}","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kNYzr\"))).then(() => parcelRequire('2m2jt'));","import {KL} from '../../kl';\r\nimport {BB} from '../../../bb/bb';\r\nimport {KlHistoryInterface} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\nimport {BrowserStorageUi} from './browser-storage-ui';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {IKlProject} from '../../kl.types';\r\n\r\n\r\nconst reminderTimelimitMs = 1000 * 60 * 20; // 20 minutes\r\nconst unsavedActionsLimit = 100; // number of actions user did since last save\r\n\r\n\r\n/**\r\n * remind user of saving, keep user aware of save state\r\n */\r\nexport class SaveReminder {\r\n    private lastSavedActionNumber: number = null;\r\n    private lastSavedAt: number;\r\n\r\n    private lastReminderShownAt: number;\r\n    private unsavedInterval;\r\n    private closeFunc: () => void;\r\n\r\n    showPopup (): void {\r\n        if (!this.projectStore || !this.getProject) {\r\n            throw new Error('projectStore and getProject need to be set');\r\n        }\r\n\r\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\r\n\r\n        const contentEl = BB.el({});\r\n\r\n        contentEl.append(\r\n            BB.el({\r\n                content: LANG(\r\n                    'save-reminder-text',\r\n                    {\r\n                        a: '<strong>' + min,\r\n                        b: '</strong>',\r\n                    }\r\n                ),\r\n                css: {\r\n                    marginBottom: '20px',\r\n                }\r\n            }),\r\n        );\r\n\r\n        const psdWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n            }\r\n        });\r\n        const storageWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n                paddingBottom: '0',\r\n            }\r\n        });\r\n        contentEl.append(psdWrapper, storageWrapper);\r\n\r\n\r\n        const psdBtn = BB.el({\r\n            tagName: 'button',\r\n            className: 'kl-button',\r\n            content: LANG('save-reminder-save-psd'),\r\n            onClick: () => this.onSaveAsPsd(),\r\n        });\r\n        psdWrapper.append(\r\n            psdBtn,\r\n            BB.el({\r\n                content: LANG('save-reminder-psd-layers'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            }),\r\n        );\r\n\r\n\r\n        const storageUi = new BrowserStorageUi(\r\n            this.projectStore,\r\n            this.getProject,\r\n            this,\r\n            document.body as any,\r\n            {\r\n                hideClearButton: true,\r\n                isFocusable: true,\r\n            }\r\n        );\r\n        storageWrapper.append(storageUi.getElement());\r\n\r\n\r\n        KL.popup({\r\n            target: document.body,\r\n            message: `<b>${LANG('save-reminder-title')}</b>`,\r\n            div: contentEl,\r\n            ignoreBackground: true,\r\n            callback: () => {\r\n                storageUi.destroy();\r\n                BB.destroyEl(psdBtn);\r\n                this.closeFunc = null;\r\n                this.lastReminderShownAt = performance.now();\r\n            },\r\n            closefunc: (f) => {\r\n                this.closeFunc = f;\r\n            }\r\n        });\r\n        setTimeout(() => {\r\n            psdBtn.focus();\r\n        }, 40);\r\n    }\r\n\r\n    constructor (\r\n        private history: KlHistoryInterface,\r\n        private showReminder: boolean,\r\n        private changeTitle: boolean,\r\n        private onSaveAsPsd: () => void,\r\n        private isDrawing: () => boolean,\r\n        private projectStore: ProjectStore | null, // needed if showReminder\r\n        private getProject: (() => IKlProject) | null, // needed if showReminder\r\n        private title: string = 'Klecks',\r\n    ) { }\r\n\r\n    init (): void {\r\n        if (this.lastSavedActionNumber !== null) { // already initialized\r\n            return;\r\n        }\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n\r\n        if (this.showReminder) {\r\n            setInterval(() => {\r\n                if (document.visibilityState !== 'visible') {\r\n                    return;\r\n                }\r\n\r\n                let unsavedActions = Math.abs(this.history.getActionNumber() - this.lastSavedActionNumber);\r\n\r\n                if (\r\n                    KL.dialogCounter.get() === 0 &&\r\n                    !this.isDrawing() &&\r\n                    this.lastReminderShownAt + reminderTimelimitMs < performance.now() &&\r\n                    unsavedActions >= unsavedActionsLimit\r\n                ) {\r\n                    this.showPopup();\r\n                }\r\n            }, 1000 * 5);\r\n        }\r\n\r\n        // confirmation dialog when closing tab\r\n        function onBeforeUnload(e) {\r\n            e.preventDefault();\r\n            e.returnValue = '';\r\n        }\r\n\r\n        this.history.addListener(() => {\r\n            let actionNumber = this.history.getActionNumber();\r\n            if (this.lastSavedActionNumber !== actionNumber) {\r\n                BB.setEventListener(window, 'onbeforeunload', onBeforeUnload);\r\n            } else {\r\n                BB.setEventListener(window, 'onbeforeunload', null);\r\n            }\r\n        });\r\n\r\n        if (this.changeTitle) {\r\n            document.addEventListener(\"visibilitychange\", () => {\r\n                if (document.visibilityState === 'visible') {\r\n                    document.title = this.title;\r\n                    clearInterval(this.unsavedInterval);\r\n                } else {\r\n                    let actionNumber = this.history.getActionNumber();\r\n                    if (this.lastSavedActionNumber !== actionNumber) {\r\n                        document.title = LANG('unsaved') + ' - ' + this.title;\r\n                        let state = 0;\r\n                        this.unsavedInterval = setInterval(() => {\r\n                            state = (state + 1) % 2;\r\n                            if (state === 1) {\r\n                                document.title = LANG('unsaved') + '  ' + this.title;\r\n                            } else {\r\n                                document.title = LANG('unsaved') + ' - ' + this.title;\r\n                            }\r\n                        }, 1000 * 60 * 3);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    reset (): void {\r\n        if (this.lastSavedActionNumber === null) { // not initialized\r\n            return;\r\n        }\r\n\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n        BB.setEventListener(window, 'onbeforeunload', null);\r\n\r\n        if (this.closeFunc) {\r\n            this.closeFunc();\r\n        }\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {KL} from '../kl';\r\nimport {saveAs} from 'file-saver';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\n\r\nexport class SaveToComputer {\r\n\r\n    constructor(\r\n        private saveReminder,\r\n        private klRootEl,\r\n        private getExportType,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private filenameBase: string,\r\n    ) {}\r\n\r\n    save(format?: 'psd' | 'layers' | 'png') {\r\n        const _this = this;\r\n\r\n        _this.saveReminder.reset();\r\n\r\n\r\n        function saveImage(canvas, filename, mimeType) {\r\n            let parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n            //assume base64 encoding\r\n            let binStr = atob(parts[3]);\r\n            //convert to binary in ArrayBuffer\r\n            let buf = new ArrayBuffer(binStr.length);\r\n            let view = new Uint8Array(buf);\r\n            for (let i = 0; i < view.length; i++) {\r\n                view[i] = binStr.charCodeAt(i);\r\n            }\r\n            let blob = new Blob([view], {'type': parts[1]});\r\n            saveAs(blob, filename);\r\n        }\r\n\r\n        if (!format) {\r\n            format = _this.getExportType();\r\n        }\r\n\r\n        if (format === 'png') {\r\n            let extension = 'png';\r\n            let mimeType = 'image/png';\r\n            let filename = BB.getDate() + this.filenameBase + \".\" + extension;\r\n            let fullCanvas = _this.getKlCanvas().getCompleteCanvas(1);\r\n\r\n            /*fullCanvas.toBlob(function(blob) {\r\n                if (blob === null) {\r\n                    throw 'save image error, blob is null';\r\n                }\r\n                saveAs(blob, filename);\r\n            }, mimetype);*/\r\n\r\n            //using old code, because saving somehow doesn't work for ipad before ios 13\r\n            //and it doesn't even throw an exception\r\n            try {\r\n                saveImage(fullCanvas, filename, mimeType);\r\n            } catch (error) { //fallback for old browsers\r\n                let im = new Image();\r\n                im.width = _this.getKlCanvas().getWidth();\r\n                im.height = _this.getKlCanvas().getHeight();\r\n                im.src = fullCanvas.toDataURL(mimeType);\r\n                KL.exportDialog(_this.klRootEl, im);\r\n            }\r\n        } else if (format === 'layers') {\r\n            let extension = 'png';\r\n            let mimeType = 'image/png';\r\n            let fileBase = BB.getDate() + this.filenameBase;\r\n            let layerArr = _this.getKlCanvas().getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                let item = layerArr[i];\r\n                let fnameArr = [\r\n                    fileBase,\r\n                    '_',\r\n                    ('' + (i + 1)).padStart(2, '0'),\r\n                    '_',\r\n                    item.name,\r\n                    '.',\r\n                    extension\r\n                ];\r\n                saveImage(item.canvas, fnameArr.join(''), mimeType);\r\n            }\r\n        } else if (format === 'psd') {\r\n\r\n            let layerArr = _this.getKlCanvas().getLayersFast();\r\n\r\n            let psdConfig = {\r\n                width: _this.getKlCanvas().getWidth(),\r\n                height: _this.getKlCanvas().getHeight(),\r\n                children: [],\r\n                canvas: _this.getKlCanvas().getCompleteCanvas(1)\r\n            };\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                let item = layerArr[i];\r\n                psdConfig.children.push({\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    canvas: item.canvas,\r\n                    blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n                    left: 0,\r\n                    top: 0\r\n                });\r\n            }\r\n\r\n            KL.loadAgPsd().then((agPsdLazy) => {\r\n                let buffer = agPsdLazy.writePsdBuffer(psdConfig);\r\n                let blob = new Blob([buffer], { type: 'application/octet-stream' });\r\n                saveAs(blob, BB.getDate() + this.filenameBase + '.psd');\r\n            }).catch(() => {\r\n                alert('Error: failed to load PSD library');\r\n            });\r\n\r\n        }\r\n\r\n    }\r\n\r\n}","/*\n* FileSaver.js\n* A saveAs() FileSaver implementation.\n*\n* By Eli Grey, http://eligrey.com\n*\n* License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)\n* source  : http://purl.eligrey.com/github/FileSaver.js\n*/\n\n// The one and only way of getting global scope in all environments\n// https://stackoverflow.com/q/3277182/1008999\nvar _global = typeof window === 'object' && window.window === window\n  ? window : typeof self === 'object' && self.self === self\n  ? self : typeof global === 'object' && global.global === global\n  ? global\n  : this\n\nfunction bom (blob, opts) {\n  if (typeof opts === 'undefined') opts = { autoBom: false }\n  else if (typeof opts !== 'object') {\n    console.warn('Deprecated: Expected third argument to be a object')\n    opts = { autoBom: !opts }\n  }\n\n  // prepend BOM for UTF-8 XML and text/* types (including HTML)\n  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n  if (opts.autoBom && /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n    return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type })\n  }\n  return blob\n}\n\nfunction download (url, name, opts) {\n  var xhr = new XMLHttpRequest()\n  xhr.open('GET', url)\n  xhr.responseType = 'blob'\n  xhr.onload = function () {\n    saveAs(xhr.response, name, opts)\n  }\n  xhr.onerror = function () {\n    console.error('could not download file')\n  }\n  xhr.send()\n}\n\nfunction corsEnabled (url) {\n  var xhr = new XMLHttpRequest()\n  // use sync to avoid popup blocker\n  xhr.open('HEAD', url, false)\n  try {\n    xhr.send()\n  } catch (e) {}\n  return xhr.status >= 200 && xhr.status <= 299\n}\n\n// `a.click()` doesn't work for all browsers (#465)\nfunction click (node) {\n  try {\n    node.dispatchEvent(new MouseEvent('click'))\n  } catch (e) {\n    var evt = document.createEvent('MouseEvents')\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,\n                          20, false, false, false, false, 0, null)\n    node.dispatchEvent(evt)\n  }\n}\n\n// Detect WebView inside a native macOS app by ruling out all browsers\n// We just need to check for 'Safari' because all other browsers (besides Firefox) include that too\n// https://www.whatismybrowser.com/guides/the-latest-user-agent/macos\nvar isMacOSWebView = _global.navigator && /Macintosh/.test(navigator.userAgent) && /AppleWebKit/.test(navigator.userAgent) && !/Safari/.test(navigator.userAgent)\n\nvar saveAs = _global.saveAs || (\n  // probably in some web worker\n  (typeof window !== 'object' || window !== _global)\n    ? function saveAs () { /* noop */ }\n\n  // Use download attribute first if possible (#193 Lumia mobile) unless this is a macOS WebView\n  : ('download' in HTMLAnchorElement.prototype && !isMacOSWebView)\n  ? function saveAs (blob, name, opts) {\n    var URL = _global.URL || _global.webkitURL\n    var a = document.createElement('a')\n    name = name || blob.name || 'download'\n\n    a.download = name\n    a.rel = 'noopener' // tabnabbing\n\n    // TODO: detect chrome extensions & packaged apps\n    // a.target = '_blank'\n\n    if (typeof blob === 'string') {\n      // Support regular links\n      a.href = blob\n      if (a.origin !== location.origin) {\n        corsEnabled(a.href)\n          ? download(blob, name, opts)\n          : click(a, a.target = '_blank')\n      } else {\n        click(a)\n      }\n    } else {\n      // Support blobs\n      a.href = URL.createObjectURL(blob)\n      setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s\n      setTimeout(function () { click(a) }, 0)\n    }\n  }\n\n  // Use msSaveOrOpenBlob as a second approach\n  : 'msSaveOrOpenBlob' in navigator\n  ? function saveAs (blob, name, opts) {\n    name = name || blob.name || 'download'\n\n    if (typeof blob === 'string') {\n      if (corsEnabled(blob)) {\n        download(blob, name, opts)\n      } else {\n        var a = document.createElement('a')\n        a.href = blob\n        a.target = '_blank'\n        setTimeout(function () { click(a) })\n      }\n    } else {\n      navigator.msSaveOrOpenBlob(bom(blob, opts), name)\n    }\n  }\n\n  // Fallback to using FileReader and a popup\n  : function saveAs (blob, name, opts, popup) {\n    // Open a popup immediately do go around popup blocker\n    // Mostly only available on user interaction and the fileReader is async so...\n    popup = popup || open('', '_blank')\n    if (popup) {\n      popup.document.title =\n      popup.document.body.innerText = 'downloading...'\n    }\n\n    if (typeof blob === 'string') return download(blob, name, opts)\n\n    var force = blob.type === 'application/octet-stream'\n    var isSafari = /constructor/i.test(_global.HTMLElement) || _global.safari\n    var isChromeIOS = /CriOS\\/[\\d]+/.test(navigator.userAgent)\n\n    if ((isChromeIOS || (force && isSafari) || isMacOSWebView) && typeof FileReader !== 'undefined') {\n      // Safari doesn't allow downloading of blob URLs\n      var reader = new FileReader()\n      reader.onloadend = function () {\n        var url = reader.result\n        url = isChromeIOS ? url : url.replace(/^data:[^;]*;/, 'data:attachment/file;')\n        if (popup) popup.location.href = url\n        else location = url\n        popup = null // reverse-tabnabbing #460\n      }\n      reader.readAsDataURL(blob)\n    } else {\n      var URL = _global.URL || _global.webkitURL\n      var url = URL.createObjectURL(blob)\n      if (popup) popup.location = url\n      else location.href = url\n      popup = null // reverse-tabnabbing #460\n      setTimeout(function () { URL.revokeObjectURL(url) }, 4E4) // 40s\n    }\n  }\n)\n\n_global.saveAs = saveAs.saveAs = saveAs\n\nif (typeof module !== 'undefined') {\n  module.exports = saveAs;\n}\n","import {KL} from '../kl';\r\nimport {IHistoryBroadcast, IHistoryEntry, klHistory} from './kl-history';\r\nimport {KlCanvasWorkspace} from '../canvas-ui/kl-canvas-workspace';\r\nimport {IFilterApply, IInitState} from '../kl.types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\n\r\nexport class UndoRedoCatchup {\r\n\r\n    private doIgnore = false;\r\n\r\n    /**\r\n     * Prevent multiple undo / redo getting triggered at once.\r\n     * Might be confusing if main thread is choking.\r\n     */\r\n    private ignoreTest (): boolean {\r\n        if (this.doIgnore) {\r\n            return false;\r\n        }\r\n        this.doIgnore = true;\r\n        setTimeout(() => {\r\n            this.doIgnore = false;\r\n        }, 0);\r\n        return true;\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        private brushUiObj,\r\n        private layerPreview,\r\n        private layerManager,\r\n        private handUi,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private getInitState: () => IInitState,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx,\r\n        private setCurrentLayerCtx,\r\n        private getCurrentBrush,\r\n    ) { }\r\n\r\n    undo (): boolean {\r\n        if (!this.ignoreTest()) {\r\n            return false;\r\n        }\r\n\r\n        if (!klHistory.canUndo()) { // || workspace.isPainting()) {\r\n            return false;\r\n        }\r\n        const actions: IHistoryEntry[] = klHistory.undo();\r\n        const klCanvas = this.getKlCanvas();\r\n        klHistory.pause(true);\r\n        const initState: IInitState = this.getInitState();\r\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\r\n        klCanvas.copy(initState.canvas);\r\n        let layerIndex = initState.focus;\r\n        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\r\n        const brushes: any = {};\r\n        for (let b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\r\n        for (let i = 0; i < actions.length; i++) {\r\n            ((i) => {\r\n                if (actions[i].tool[0] === \"brush\") {\r\n                    const b = brushes[actions[i].tool[1]];\r\n                    if (actions[i].actions) {\r\n                        for (let e = 0; e < actions[i].actions.length; e++) {\r\n                            const p = actions[i].actions[e].params;\r\n                            b[actions[i].actions[e].action].apply(b, p);\r\n                        }\r\n                    } else {\r\n                        const p = actions[i].params;\r\n                        b[actions[i].action].apply(b, p);\r\n                    }\r\n                } else if (actions[i].tool[0] === \"canvas\") {\r\n                    const p = actions[i].params;\r\n                    const id = klCanvas[actions[i].action].apply(klCanvas, p);\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"filter\") {\r\n                    const p = [{\r\n                        context: this.getCurrentLayerCtx(),\r\n                        klCanvas,\r\n                        input: actions[i].params[0].input,\r\n                        history: new KL.DecoyKlHistory(),\r\n                    } as IFilterApply];\r\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\r\n\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\r\n                    layerIndex = actions[i].params[0];\r\n                    this.setCurrentLayerCtx(klCanvas.getLayerContext(actions[i].params[0]));\r\n                    for (let b in brushes) {\r\n                        if (brushes.hasOwnProperty(b)) {\r\n                            brushes[b].setContext(this.getCurrentLayerCtx());\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\r\n                    const id = klCanvas.addLayer();\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        if (actions[i].params[1]) {\r\n                            klCanvas.renameLayer(layerIndex, actions[i].params[1]);\r\n                        }\r\n                        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\r\n                }\r\n            })(i);\r\n        }\r\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        this.layerManager.update(layerIndex);\r\n        this.layerPreview.setLayer(klCanvas.getLayer(layerIndex));\r\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n\r\n        klHistory.pause(false);\r\n        return true;\r\n    }\r\n\r\n    redo (): boolean {\r\n        if (!this.ignoreTest()) {\r\n            return false;\r\n        }\r\n\r\n        if (!klHistory.canRedo()) {\r\n            return false;\r\n        }\r\n        const actions = klHistory.redo();\r\n        const klCanvas = this.getKlCanvas();\r\n        klHistory.pause(true);\r\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\r\n        let layerIndex;\r\n        const brushes: any = {};\r\n        for (let b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(this.brushUiObj.sketchyBrush.getSeed());\r\n        for (let i = 0; i < actions.length; i++) {\r\n            ((i) => {\r\n                if (actions[i].tool[0] === \"brush\") {\r\n                    const b = brushes[actions[i].tool[1]];\r\n                    if (actions[i].actions) {\r\n                        for (let e = 0; e < actions[i].actions.length; e++) {\r\n                            const p = actions[i].actions[e].params;\r\n                            b[actions[i].actions[e].action].apply(b, p);\r\n                        }\r\n                    } else {\r\n                        const p = actions[i].params;\r\n                        b[actions[i].action].apply(b, p);\r\n                    }\r\n                } else if (actions[i].tool[0] === \"canvas\") {\r\n                    const p = actions[i].params;\r\n                    const id = klCanvas[actions[i].action].apply(klCanvas, p);\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"filter\") {\r\n                    const p = [{\r\n                        context: this.getCurrentLayerCtx(),\r\n                        klCanvas,\r\n                        input: actions[i].params[0].input,\r\n                        history: new KL.DecoyKlHistory(),\r\n                    } as IFilterApply];\r\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\r\n\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\r\n                    layerIndex = actions[i].params[0];\r\n                    this.setCurrentLayerCtx(klCanvas.getLayerContext(actions[i].params[0]));\r\n                    for (let b in brushes) {\r\n                        if (brushes.hasOwnProperty(b)) {\r\n                            brushes[b].setContext(this.getCurrentLayerCtx());\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\r\n                    const id = klCanvas.addLayer();\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        if (actions[i].params[1]) {\r\n                            klCanvas.renameLayer(layerIndex, actions[i].params[1]);\r\n                        }\r\n                        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\r\n                }\r\n            })(i);\r\n        }\r\n\r\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        const currentLayerIndex = klCanvas.getLayerIndex(this.getCurrentLayerCtx().canvas);\r\n        this.layerManager.update(currentLayerIndex);\r\n        this.layerPreview.setLayer(klCanvas.getLayer(currentLayerIndex));\r\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n        klHistory.pause(false);\r\n\r\n        return true;\r\n    }\r\n\r\n    catchup (logParam: IHistoryBroadcast | null): void {\r\n        // const start = performance.now();\r\n        //play catch up (the version that is a few steps behind)\r\n        if (logParam && logParam.bufferUpdate) {\r\n            const initState: IInitState = this.getInitState();\r\n\r\n            const brushes = initState.brushes;\r\n            const actions = [logParam.bufferUpdate];\r\n            let localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\r\n            const klCanvas = initState.canvas;\r\n            let layerIndex = initState.focus;\r\n            ((i) => {\r\n                if (actions[i].tool[0] === \"brush\") {\r\n                    let b = brushes[actions[i].tool[1]];\r\n                    if (actions[i].actions) {\r\n                        for (let e = 0; e < actions[i].actions.length; e++) {\r\n                            const p = actions[i].actions[e].params;\r\n                            b[actions[i].actions[e].action].apply(b, p);\r\n                        }\r\n                    } else {\r\n                        const p = actions[i].params;\r\n                        b[actions[i].action].apply(b, p);\r\n                    }\r\n                } else if (actions[i].tool[0] === \"canvas\") {\r\n                    const p = actions[i].params;\r\n                    const id = klCanvas[actions[i].action].apply(klCanvas, p);\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        localCurrentLayerCtx = klCanvas.getLayerContext(layerIndex);\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(localCurrentLayerCtx);\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"filter\") {\r\n                    const p = [{\r\n                        context: localCurrentLayerCtx,\r\n                        klCanvas,\r\n                        input: actions[i].params[0].input,\r\n                        history: new KL.DecoyKlHistory(),\r\n                    } as IFilterApply];\r\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\r\n\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\r\n                    layerIndex = actions[i].params[0];\r\n                    localCurrentLayerCtx = klCanvas.getLayerContext(actions[i].params[0]);\r\n                    for (let b in brushes) {\r\n                        if (brushes.hasOwnProperty(b)) {\r\n                            brushes[b].setContext(localCurrentLayerCtx);\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\r\n                    const id = klCanvas.addLayer();\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        if (actions[i].params[1]) {\r\n                            klCanvas.renameLayer(layerIndex, actions[i].params[1]);\r\n                        }\r\n                        localCurrentLayerCtx = klCanvas.getLayerContext(layerIndex);\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(localCurrentLayerCtx);\r\n                            }\r\n                        }\r\n                    }\r\n                    localCurrentLayerCtx.drawImage(actions[i].params[0], 0, 0);\r\n                }\r\n            })(0);\r\n            initState.focus = layerIndex;\r\n        }\r\n        // console.log('catchup', performance.now() - start);\r\n    }\r\n\r\n\r\n}","import {IRGB, ISliderConfig} from '../kl.types';\r\n\r\nexport type TBrushSettingEmit = { type: 'color'; value: IRGB } |\r\n    { type: 'opacity'; value: number } |\r\n    { type: 'size'; value: number } |\r\n    { type: 'sliderConfig'; value: ISliderConfig };\r\n\r\nexport type TBrushSettingSubscriber = (p : TBrushSettingEmit) => void;\r\n\r\n/**\r\n * Central place to update brush settings, and to subscribe to changes.\r\n */\r\nexport class BrushSettingService {\r\n\r\n    private static instance: BrushSettingService;\r\n    subscriberArr: TBrushSettingSubscriber[] = [];\r\n\r\n    private emit (obj: TBrushSettingEmit, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (this.subscriberArr[i] === skipSubscriber) {\r\n                continue;\r\n            }\r\n            this.subscriberArr[i](obj);\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        private onSetColor: (rgb: IRGB) => void,\r\n        private onSetSize: (size: number) => void,\r\n        private onSetOpacity: (opacity: number) => void,\r\n        private onGetColor: () => IRGB,\r\n        private onGetSize: () => number,\r\n        private onGetOpacity: () => number,\r\n        private onGetSliderConfig: () => ISliderConfig,\r\n    ) {\r\n        if (BrushSettingService.instance) {\r\n            throw new Error('BrushSettingService already instantiated');\r\n        }\r\n        BrushSettingService.instance = this;\r\n    }\r\n\r\n    emitColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'color',\r\n                value: color\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSize (size: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'size',\r\n                value: size\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'opacity',\r\n                value: opacity\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSliderConfig (sliderConfig: ISliderConfig, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.emit(\r\n            {\r\n                type: 'sliderConfig',\r\n                value: sliderConfig\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    /**\r\n     * set current brush color\r\n     * @param color\r\n     * @param skipSubscriber\r\n     */\r\n    setColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetColor(color);\r\n        this.emitColor(color, skipSubscriber);\r\n    }\r\n\r\n    /**\r\n     * set current brush size\r\n     * @param size\r\n     * @param skipSubscriber\r\n     */\r\n    setSize (size: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetSize(size);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * set current opacity\r\n     * @param opacity\r\n     * @param skipSubscriber\r\n     */\r\n    setOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetOpacity(opacity);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * get current brush color\r\n     */\r\n    getColor (): IRGB {\r\n        return this.onGetColor();\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.onGetSize();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.onGetOpacity();\r\n    }\r\n\r\n    getSliderConfig (): ISliderConfig {\r\n        return this.onGetSliderConfig();\r\n    }\r\n\r\n    /**\r\n     * subscribe to changes\r\n     * @param func\r\n     */\r\n    subscribe (func: TBrushSettingSubscriber): void {\r\n        if (this.subscriberArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.subscriberArr.push(func);\r\n    }\r\n\r\n    unsubscribe (func: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (func === this.subscriberArr[i]) {\r\n                this.subscriberArr.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG, languageStrings, LS_LANGUAGE_KEY} from '../../../language/language';\r\nimport {KL} from '../../kl';\r\nimport {languages} from '../../../../languages/languages';\r\nimport {Popup} from '../modals/popup';\r\n// @ts-ignore\r\nimport bitbofLogoImg from 'url:~/src/app/img/bitbof-logo.svg';\r\n// @ts-ignore\r\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\r\n// @ts-ignore\r\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\r\nimport {LocalStorage} from '../../../bb/base/local-storage';\r\n\r\nexport class SettingsTab {\r\n\r\n    private el: HTMLElement;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        onLeftRight: () => void,\r\n        customAbout?: HTMLElement,\r\n    ) {\r\n\r\n        // ---- language ----\r\n        const language = languageStrings.getLanguage();\r\n\r\n        this.el = BB.el({\r\n            content: `\r\n${LANG('settings-language')}: ${language.name} (${language.code})\r\n            `,\r\n            css: {\r\n                margin: '10px',\r\n            }\r\n        });\r\n\r\n        const preferredLanguageRow = BB.el({\r\n            content: LANG('settings-preferred-language') + ':<br>',\r\n            css: {\r\n                marginTop: '10px',\r\n            }\r\n        });\r\n        const options: [string, string][] = [\r\n            ['auto', LANG('auto')] as [string, string]\r\n        ].concat(\r\n            languages.map(item => {\r\n                return [item.code, item.name + ` (${item.code})`];\r\n            })\r\n        );\r\n        const languageSelect = new KL.Select({\r\n            initValue: LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto',\r\n            optionArr: options,\r\n            onChange: (val) => {\r\n                if (val === 'auto') {\r\n                    LocalStorage.removeItem(LS_LANGUAGE_KEY);\r\n                } else {\r\n                    LocalStorage.setItem(LS_LANGUAGE_KEY, val);\r\n                }\r\n                languageHint.style.display = 'block';\r\n            },\r\n        });\r\n        const languageHint = BB.el({\r\n            content: LANG('settings-language-reload'),\r\n            css: {\r\n                display: 'none',\r\n                marginTop: '5px',\r\n            }\r\n        });\r\n\r\n        preferredLanguageRow.append(\r\n            languageSelect.getElement(),\r\n            languageHint,\r\n        );\r\n\r\n        this.el.append(preferredLanguageRow);\r\n\r\n        // ---- flip ui ----\r\n        BB.el({\r\n            tagName: 'button',\r\n            parent: this.el,\r\n            content: '<img height=\"20\" width=\"18\" src=\"' + uiSwapImg + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + LANG('switch-ui-left-right'),\r\n            onClick: () => onLeftRight(),\r\n            css: {\r\n                marginTop: '20px',\r\n            },\r\n            custom: {\r\n                tabIndex: '-1',\r\n            }\r\n        });\r\n\r\n\r\n        // ---- about ----\r\n        this.el.append(BB.el({className: 'gridHr', css: {margin: '10px 0'}}));\r\n\r\n        function makeLicenses() {\r\n            return BB.el({\r\n                tagName: 'a',\r\n                content: LANG('licenses'),\r\n                onClick: () => {\r\n                    import('./licenses').then(result => {\r\n                        new Popup({\r\n                            title: BB.el({\r\n                                content: LANG('licenses'),\r\n                            }),\r\n                            content: BB.el({\r\n                                content: BB.el({\r\n                                    content: result.licenses.replace(/\\n/g, '<br>'),\r\n                                    css: {\r\n                                        padding: '20px',\r\n                                    }\r\n                                }),\r\n                                css: {\r\n                                    height: '100%',\r\n                                    overflowY: 'scroll',\r\n                                }\r\n                            }),\r\n                            width: 800,\r\n                            isMaxHeight: true,\r\n                        });\r\n                    });\r\n                },\r\n            });\r\n        }\r\n\r\n        if (customAbout) {\r\n            this.el.append(customAbout);\r\n            if (!customAbout.innerHTML) {\r\n                const minimalAbout = BB.el({\r\n                    parent: customAbout,\r\n                    css: {\r\n                       textAlign: 'center',\r\n                   }\r\n                });\r\n                minimalAbout.append(\r\n                    BB.el({\r\n                        content: `<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2022<br>`,\r\n                    }),\r\n                    makeLicenses(),\r\n                );\r\n            }\r\n        } else {\r\n            const versionEl = BB.el({\r\n                parent: this.el,\r\n                css: {\r\n                    textAlign: 'center',\r\n                },\r\n                content: `\r\n<img alt=\"Klecks\" height=\"25\" src=\"${klecksLogoImg}\"><br>\r\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2022<br>`\r\n            });\r\n\r\n            versionEl.append(\r\n                makeLicenses(),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('donate'),\r\n                    custom: {\r\n                        href: 'https://kleki.com/donate/',\r\n                        target: '_blank',\r\n                    }\r\n                }),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('source-code'),\r\n                    custom: {\r\n                        href: 'https://klecks.org',\r\n                        target: '_blank',\r\n                    }\r\n                }),\r\n            );\r\n\r\n\r\n        }\r\n\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== LS_LANGUAGE_KEY) {\r\n                return;\r\n            }\r\n            languageSelect.setValue(\r\n                LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'\r\n            );\r\n        });\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kSWIa\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"4FMUg\");","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"79hnx\"))).then(() => parcelRequire('jNQF2'));","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport caretImg from 'url:~/src/app/img/ui/caret-down.svg';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\nimport {LANG} from '../../../language/language';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n\r\n/**\r\n * Scroll buttons at the top and bottom of toolspace\r\n * Show up when window is very small.\r\n * Allow user to scroll up and down toolspace.\r\n */\r\nexport class ToolspaceScroller {\r\n\r\n    private toolspace: HTMLElement;\r\n    private upBtn: HTMLElement;\r\n    private downBtn: HTMLElement;\r\n    private downInterval: any;\r\n    private upInterval: any;\r\n\r\n    private update(): void {\r\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) { // small buffer where it's not worth it\r\n            if (!this.upInterval) {\r\n                this.upBtn.style.display = this.toolspace.scrollTop === 0 ? 'none' : 'block';\r\n            }\r\n            if (!this.downInterval) {\r\n                this.downBtn.style.display = (\r\n                    this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ?\r\n                        'none' : 'block'\r\n                );\r\n            }\r\n        } else {\r\n            this.upBtn.style.display = 'none';\r\n            this.downBtn.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n    constructor(p: {toolspace: HTMLElement, uiState: 'left' | 'right'}) {\r\n        this.toolspace = p.toolspace;\r\n        this.upBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                top: '0',\r\n                transform: 'rotate(180deg)',\r\n            }\r\n        });\r\n        this.downBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                bottom: '0',\r\n            }\r\n        });\r\n        this.updateUiState(p.uiState);\r\n\r\n        const upListener = new BB.PointerListener({\r\n            target: this.upBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.upInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, -13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.upInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.upInterval = null;\r\n                        this.update()\r\n                    }, 50);\r\n                }\r\n            },\r\n        });\r\n        const downListener = new BB.PointerListener({\r\n            target: this.downBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.downInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, 13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.downInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.downInterval = null;\r\n                        this.update()\r\n                    }, 50);\r\n                }\r\n            }\r\n        });\r\n\r\n        const wheelListener = (e: WheelEvent) => {\r\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\r\n            this.update();\r\n        };\r\n        this.upBtn.addEventListener('wheel', wheelListener);\r\n        this.downBtn.addEventListener('wheel', wheelListener);\r\n\r\n        this.update();\r\n\r\n        const observer = new MutationObserver(() => this.update());\r\n        observer.observe(\r\n            this.toolspace,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n        window.addEventListener('resize', () => this.update());\r\n\r\n        // hide if in dialog because that can have its own scrollbar\r\n        dialogCounter.subscribe((v) => {\r\n            // ignores the 0.5 by tool dropdown\r\n            this.upBtn.style.opacity = v >= 1 ? '0' : '';\r\n            this.downBtn.style.opacity = v >= 1 ? '0' : '';\r\n        });\r\n    }\r\n\r\n    updateUiState (uiState: 'left' | 'right'): void {\r\n        BB.css(this.upBtn, {\r\n            left: uiState === 'left' ? '0' : null,\r\n            right: uiState === 'right' ? '0' : null,\r\n        });\r\n        BB.css(this.downBtn, {\r\n            left: uiState === 'left' ? '0' : null,\r\n            right: uiState === 'right' ? '0' : null,\r\n        });\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {LANG} from '../../../language/language';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {Options} from '../base-components/options';\r\n\r\n\r\ninterface IGradientUiSettings {\r\n    opacity: number;\r\n    type: 'linear' | 'linear-mirror' | 'radial';\r\n    doLockAlpha: boolean;\r\n    doSnap: boolean;\r\n    isReversed: boolean;\r\n    isEraser: boolean;\r\n}\r\n\r\n/**\r\n * Gradient Tool tab contents\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport class GradientUi {\r\n\r\n    private rootEl: HTMLElement;\r\n    private colorDiv: HTMLElement;\r\n    private colorSlider: any; // todo type\r\n    private isVisible: boolean;\r\n    private iconArr: HTMLElement[];\r\n\r\n    private settings: IGradientUiSettings = {\r\n        opacity: 1,\r\n        type: 'linear',\r\n        doLockAlpha: false,\r\n        doSnap: false,\r\n        isReversed: false,\r\n        isEraser: false,\r\n    };\r\n\r\n    private updateIcons(): void {\r\n        const col1 = this.settings.isReversed ? '#0000' : '#000';\r\n        const col2 = this.settings.isReversed ? '#000' : '#0000';\r\n        this.iconArr[0].style.background = `linear-gradient(${col1}, ${col2})`;\r\n        this.iconArr[1].style.background = `linear-gradient(${col2}, ${col1}, ${col2})`;\r\n        this.iconArr[2].style.background = `radial-gradient(${col1}, ${col2})`;\r\n    }\r\n\r\n    // ----- public -------\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: any; // KlColorSlider - when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.colorSlider = p.colorSlider;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px'\r\n            }\r\n        });\r\n        this.isVisible = true;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n\r\n        this.iconArr = [];\r\n        {\r\n            const size = 33;\r\n            [0, 1, 2].forEach(item => {\r\n                const el = BB.el({\r\n                    css: {\r\n                        width: size + 'px',\r\n                        height: size + 'px',\r\n                        borderRadius: '3px',\r\n                        margin: '1px',\r\n                    }\r\n                });\r\n                this.iconArr.push(el);\r\n            });\r\n        }\r\n        this.updateIcons();\r\n\r\n        const typeOptions = new Options({\r\n            optionArr: [\r\n                {\r\n                    id: 'linear',\r\n                    label: this.iconArr[0],\r\n                    title: LANG('gradient-linear'),\r\n                },\r\n                {\r\n                    id: 'linear-mirror',\r\n                    label: this.iconArr[1],\r\n                    title: LANG('gradient-linear-mirror'),\r\n                },\r\n                {\r\n                    id: 'radial',\r\n                    label: this.iconArr[2],\r\n                    title: LANG('gradient-radial'),\r\n                }\r\n            ],\r\n            initId: 'linear',\r\n            onChange: (id) => {\r\n                this.settings.type = id;\r\n            },\r\n        });\r\n        this.rootEl.append(typeOptions.getElement());\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: this.settings.opacity,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n            onChange: (val) => {\r\n                this.settings.opacity = val;\r\n            }\r\n        });\r\n        BB.css(opacitySlider.getElement(), {\r\n            marginTop: '10px'\r\n        });\r\n        this.rootEl.append(opacitySlider.getElement());\r\n\r\n\r\n\r\n        const row1 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px'\r\n            }\r\n        });\r\n\r\n        const reverseToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('reverse'),\r\n            callback: (b) => {\r\n                this.settings.isReversed = b;\r\n                this.updateIcons();\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            }\r\n        });\r\n\r\n        const doSnapToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('angle-snap'),\r\n            title: LANG('angle-snap-title'),\r\n            callback: (b) => {\r\n                this.settings.doSnap = b;\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            }\r\n        });\r\n\r\n        row1.append(\r\n            reverseToggle.getElement(),\r\n            doSnapToggle.getElement(),\r\n        );\r\n\r\n\r\n        const row2 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px'\r\n            }\r\n        });\r\n\r\n        const eraserToggle = new Checkbox({\r\n            init: this.settings.isEraser,\r\n            label: LANG('eraser'),\r\n            callback: (b) => {\r\n                this.settings.isEraser = b;\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            }\r\n        });\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('lock-alpha'),\r\n            title: LANG('lock-alpha-title'),\r\n            callback: (b) => {\r\n                this.settings.doLockAlpha = b;\r\n            },\r\n            doHighlight: true,\r\n            css: {\r\n                width: '50%',\r\n            }\r\n        });\r\n\r\n        row2.append(\r\n            eraserToggle.getElement(),\r\n            lockAlphaToggle.getElement(),\r\n        );\r\n\r\n\r\n    }\r\n\r\n    getElement(): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible(isVisible: boolean): void {\r\n        this.isVisible = !!isVisible;\r\n        this.rootEl.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            this.colorDiv.appendChild(this.colorSlider.getElement());\r\n            this.colorDiv.appendChild(this.colorSlider.getOutputElement());\r\n        }\r\n    }\r\n\r\n    getSettings(): IGradientUiSettings {\r\n        return BB.copyObj(this.settings);\r\n    }\r\n\r\n}","/**\r\n * Topmost row of buttons in toolspace\r\n *\r\n * p = { // button click callbacks\r\n *     onSubmit: function(),\r\n *     onLeftRight: function(),\r\n *     onHelp: function()\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nimport {BB} from \"../bb/bb\";\r\n// @ts-ignore\r\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\r\n// @ts-ignore\r\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\r\nimport {LANG} from '../language/language';\r\n\r\nexport class ToolspaceTopRow {\r\n    el: HTMLDivElement;\r\n\r\n    constructor(p: {onSubmit: () => void, onLeftRight: () => void, onHelp: () => void}) {\r\n        let div = document.createElement('div');\r\n        this.el = div;\r\n        BB.css(div, {\r\n            height: '36px',\r\n            //background: '#f00',\r\n            display: 'flex',\r\n            backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n        });\r\n\r\n        function createButton(p) {\r\n            let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n            let result = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.content ? '' : (p.contain ? padding + 'px 0' : ''),\r\n                }\r\n            });\r\n            if (p.content) {\r\n                result.appendChild(p.content);\r\n            } else {\r\n                let im = BB.el({\r\n                    css: {\r\n                        backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                        backgroundRepeat: 'no-repeat',\r\n                        backgroundPosition: 'center',\r\n                        backgroundSize: p.contain ? 'contain' : '',\r\n                        //filter: 'grayscale(1)',\r\n                        height: '100%'\r\n                    }\r\n                });\r\n                im.style.pointerEvents = 'none';\r\n                result.appendChild(im);\r\n            }\r\n            (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: result,\r\n                onEnterLeave: function(isOver) {\r\n                    result.classList.toggle('toolspace-row-button-hover', isOver);\r\n                }\r\n            });\r\n            return result;\r\n        }\r\n\r\n        let submitButton = createButton({\r\n            onClick: p.onSubmit,\r\n            title: LANG('submit-title'),\r\n            content: BB.el({\r\n                content: LANG('submit'),\r\n                className: 'toolspace-row-button__submit',\r\n                css: {\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    width: '100%',\r\n                    height: '100%'\r\n                }\r\n            }),\r\n            contain: true\r\n        });\r\n        submitButton.style.width = '45px';\r\n\r\n        let helpButton = createButton({\r\n            onClick: p.onHelp,\r\n            title: LANG('help'),\r\n            image: helpImg,\r\n            contain: true\r\n        });\r\n\r\n        let leftRightButton = createButton({\r\n            onClick: p.onLeftRight,\r\n            title: LANG('switch-ui-left-right'),\r\n            image: uiSwapImg,\r\n            contain: true\r\n        });\r\n\r\n        div.appendChild(submitButton);\r\n        div.appendChild(leftRightButton);\r\n        div.appendChild(helpButton);\r\n    }\r\n\r\n    getElement() {\r\n        return this.el;\r\n    }\r\n}\r\n","import {filterLib, filterLibStatus} from './filters';\r\nimport {filterBrightnessContrast} from './filter-brightness-contrast';\r\nimport {filterCropExtend} from './filter-crop-extend';\r\nimport {filterCurves} from './filter-curves';\r\nimport {filterFlip} from './filter-flip';\r\nimport {filterHueSaturation} from './filter-hue-saturation';\r\nimport {filterInvert} from './filter-invert';\r\nimport {filterPerspective} from './filter-perspective';\r\nimport {filterResize} from './filter-resize';\r\nimport {filterRotate} from './filter-rotate';\r\nimport {filterTiltShift} from './filter-tilt-shift';\r\nimport {filterTransform} from './filter-transform';\r\nimport {filterBlur} from './filter-blur';\r\nimport {filterUnsharpMask} from './filter-unsharp-mask';\r\nimport {filterToAlpha} from './filter-to-alpha';\r\nimport {filterGrid} from './filter-grid';\r\nimport {filterNoise} from './filter-noise';\r\nimport {filterPattern} from './filter-pattern';\r\nimport {filterDistort} from './filter-distort';\r\nimport {filterVanishPoint} from \"./filter-vanish-point\";\r\n\r\nlet embed: boolean;\r\nfunction importFilter(libObj, moduleObj): void {\r\n    if (moduleObj.getDialog) {\r\n        libObj.getDialog = moduleObj.getDialog;\r\n    }\r\n    libObj.apply = moduleObj.apply;\r\n}\r\n\r\n\r\nexport function importFilters(isEmbed?: boolean) {\r\n    if (filterLibStatus.isLoaded) {\r\n        return;\r\n    }\r\n    embed = isEmbed\r\n\r\n    importFilter(filterLib.brightnessContrast, filterBrightnessContrast);\r\n    importFilter(filterLib.cropExtend, filterCropExtend);\r\n    importFilter(filterLib.curves, filterCurves);\r\n    importFilter(filterLib.flip, filterFlip);\r\n    importFilter(filterLib.hueSaturation, filterHueSaturation);\r\n    importFilter(filterLib.invert, filterInvert);\r\n    importFilter(filterLib.perspective, filterPerspective);\r\n    importFilter(filterLib.resize, filterResize);\r\n    importFilter(filterLib.rotate, filterRotate);\r\n    importFilter(filterLib.tiltShift, filterTiltShift);\r\n    importFilter(filterLib.transform, filterTransform);\r\n    importFilter(filterLib.blur, filterBlur);\r\n    importFilter(filterLib.unsharpMask, filterUnsharpMask);\r\n    importFilter(filterLib.toAlpha, filterToAlpha);\r\n    importFilter(filterLib.grid, filterGrid);\r\n    importFilter(filterLib.noise, filterNoise);\r\n    importFilter(filterLib.pattern, filterPattern);\r\n    importFilter(filterLib.distort, filterDistort);\r\n    importFilter(filterLib.vanishPoint, filterVanishPoint);\r\n\r\n    filterLibStatus.isLoaded = true;\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterBrightnessContrast = {\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n\r\n        function finishInit() {\r\n\r\n            let brightness = 0, contrast = 0;\r\n            div.innerHTML = LANG('filter-bright-contrast-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let brightnessSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-brightness'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (brightness + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brightness = val / 50 - 1;\r\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            let contrastSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-contrast'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (contrast + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    contrast = val / 50 - 1;\r\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            brightnessSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(brightnessSlider.getElement());\r\n            div.appendChild(contrastSlider.getElement());\r\n\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                brightnessSlider.destroy();\r\n                contrastSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    brightness: brightness,\r\n                    contrast: contrast\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let brightness = params.input.brightness;\r\n        let contrast = params.input.contrast;\r\n        let history = params.history;\r\n        if (!context || brightness === null || contrast === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"brightnessContrast\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n\r\n        return true;\r\n    }\r\n}","\r\nexport const eventResMs = 60;","import {fx} from '../../../script-vendor/glfx';\r\n\r\nlet fxCanvas = null\r\ntry {\r\n    fxCanvas = fx.canvas();\r\n} catch (e) {\r\n}\r\n\r\nexport function getSharedFx() {\r\n    if (!fxCanvas || fxCanvas._.gl.isContextLost()) {\r\n        try {\r\n            fxCanvas = fx.canvas();\r\n        } catch (e) {\r\n        }\r\n    }\r\n    return fxCanvas;\r\n}","\r\n// @ts-ignore\r\nimport shaderNoise from './shader-noise.glsl';\r\n\r\n/*\r\n * glfx.script\r\n * http://evanw.github.com/glfx.js/\r\n *\r\n * Copyright 2011 Evan Wallace\r\n * Released under the MIT license\r\n *\r\n * modifications by bitbof\r\n */\r\nexport const fx = (function () {\r\n    let exports: any = {};\r\n\r\n// src/OES_texture_float_linear-polyfill.script\r\n// From: https://github.com/evanw/OES_texture_float_linear-polyfill\r\n    (function () {\r\n        // Uploads a 2x2 floating-point texture where one pixel is 2 and the other\r\n        // three pixels are 0. Linear filtering is only supported if a sample taken\r\n        // from the center of that texture is (2 + 0 + 0 + 0) / 4 = 0.5.\r\n        function supportsOESTextureFloatLinear(gl) {\r\n            // Need floating point textures in the first place\r\n            if (!gl.getExtension('OES_texture_float')) {\r\n                return false;\r\n            }\r\n\r\n            // Create a render target\r\n            let framebuffer = gl.createFramebuffer();\r\n            let byteTexture = gl.createTexture();\r\n            gl.bindTexture(gl.TEXTURE_2D, byteTexture);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, byteTexture, 0);\r\n\r\n            // Create a simple floating-point texture with value of 0.5 in the center\r\n            let rgba = [\r\n                2, 0, 0, 0,\r\n                0, 0, 0, 0,\r\n                0, 0, 0, 0,\r\n                0, 0, 0, 0\r\n            ];\r\n            let floatTexture = gl.createTexture();\r\n            gl.bindTexture(gl.TEXTURE_2D, floatTexture);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, gl.FLOAT, new Float32Array(rgba));\r\n\r\n            // Create the test shader\r\n            let program = gl.createProgram();\r\n            let vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n            let fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n            gl.shaderSource(vertexShader, '\\\r\n      attribute vec2 vertex;\\\r\n      void main() {\\\r\n        gl_Position = vec4(vertex, 0.0, 1.0);\\\r\n      }\\\r\n    ');\r\n            gl.shaderSource(fragmentShader, '\\\r\n      uniform sampler2D texture;\\\r\n      void main() {\\\r\n        gl_FragColor = texture2D(texture, vec2(0.5));\\\r\n      }\\\r\n    ');\r\n            gl.compileShader(vertexShader);\r\n            gl.compileShader(fragmentShader);\r\n            gl.attachShader(program, vertexShader);\r\n            gl.attachShader(program, fragmentShader);\r\n            gl.linkProgram(program);\r\n\r\n            // Create a buffer containing a single point\r\n            let buffer = gl.createBuffer();\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0]), gl.STREAM_DRAW);\r\n            gl.enableVertexAttribArray(0);\r\n            gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\r\n\r\n            // Render the point and read back the rendered pixel\r\n            let pixel = new Uint8Array(4);\r\n            gl.useProgram(program);\r\n            gl.viewport(0, 0, 1, 1);\r\n            gl.bindTexture(gl.TEXTURE_2D, floatTexture);\r\n            gl.drawArrays(gl.POINTS, 0, 1);\r\n            gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixel);\r\n\r\n            // The center sample will only have a value of 0.5 if linear filtering works\r\n            return pixel[0] === 127 || pixel[0] === 128;\r\n        }\r\n\r\n        // The constructor for the returned extension object\r\n        function OESTextureFloatLinear() {\r\n        }\r\n\r\n        // Cache the extension so it's specific to each context like extensions should be\r\n        function getOESTextureFloatLinear(gl) {\r\n            if (gl.$OES_texture_float_linear$ === void 0) {\r\n                Object.defineProperty(gl, '$OES_texture_float_linear$', {\r\n                    enumerable: false,\r\n                    configurable: false,\r\n                    writable: false,\r\n                    value: new OESTextureFloatLinear()\r\n                });\r\n            }\r\n            return gl.$OES_texture_float_linear$;\r\n        }\r\n\r\n        // This replaces the real getExtension()\r\n        function getExtension(name) {\r\n            return name === 'OES_texture_float_linear'\r\n                ? getOESTextureFloatLinear(this)\r\n                : oldGetExtension.call(this, name);\r\n        }\r\n\r\n        // This replaces the real getSupportedExtensions()\r\n        function getSupportedExtensions() {\r\n            let extensions = oldGetSupportedExtensions.call(this);\r\n            if (extensions.indexOf('OES_texture_float_linear') === -1) {\r\n                extensions.push('OES_texture_float_linear');\r\n            }\r\n            return extensions;\r\n        }\r\n\r\n        // Get a WebGL context\r\n        try {\r\n            let gl = document.createElement('canvas').getContext('experimental-webgl');\r\n        } catch (e) {\r\n        }\r\n\r\n        // Don't install the polyfill if the browser already supports it or doesn't have WebGL\r\n        if (!gl || (gl as any).getSupportedExtensions().indexOf('OES_texture_float_linear') !== -1) {\r\n            return;\r\n        }\r\n\r\n        // Install the polyfill if linear filtering works with floating-point textures\r\n        let oldGetExtension;\r\n        let oldGetSupportedExtensions;\r\n        if (supportsOESTextureFloatLinear(gl)) {\r\n            oldGetExtension = WebGLRenderingContext.prototype.getExtension;\r\n            oldGetSupportedExtensions = WebGLRenderingContext.prototype.getSupportedExtensions;\r\n            WebGLRenderingContext.prototype.getExtension = getExtension;\r\n            WebGLRenderingContext.prototype.getSupportedExtensions = getSupportedExtensions;\r\n        }\r\n    }());\r\n\r\n// src/core\\canvas.script\r\n    var gl;\r\n\r\n    function clamp(lo, value, hi) {\r\n        return Math.max(lo, Math.min(value, hi));\r\n    }\r\n\r\n    function wrapTexture(texture) {\r\n        return {\r\n            _: texture,\r\n            loadContentsOf: function (element) {\r\n                // Make sure that we're using the correct global WebGL context\r\n                gl = this._.gl;\r\n                this._.loadContentsOf(element);\r\n            },\r\n            destroy: function () {\r\n                // Make sure that we're using the correct global WebGL context\r\n                gl = this._.gl;\r\n                this._.destroy();\r\n            }\r\n        };\r\n    }\r\n\r\n    function texture(element) {\r\n        return wrapTexture(Texture.fromElement(element));\r\n    }\r\n\r\n    function initialize(width, height) {\r\n        let type = gl.UNSIGNED_BYTE;\r\n\r\n        // Go for floating point buffer textures if we can, it'll make the bokeh\r\n        // filter look a lot better. Note that on Windows, ANGLE does not let you\r\n        // render to a floating-point texture when linear filtering is enabled.\r\n        // See http://crbug.com/172278 for more information.\r\n        if (gl.getExtension('OES_texture_float') && gl.getExtension('OES_texture_float_linear')) {\r\n            let testTexture = new Texture(100, 100, gl.RGBA, gl.FLOAT);\r\n            try {\r\n                // Only use gl.FLOAT if we can render to it\r\n                testTexture.drawTo(function () {\r\n                    type = gl.FLOAT;\r\n                });\r\n            } catch (e) {\r\n            }\r\n            testTexture.destroy();\r\n        }\r\n\r\n        if (this._.texture) this._.texture.destroy();\r\n        if (this._.spareTexture) this._.spareTexture.destroy();\r\n        this.width = width;\r\n        this.height = height;\r\n        this._.texture = new Texture(width, height, gl.RGBA, type);\r\n        this._.spareTexture = new Texture(width, height, gl.RGBA, type);\r\n        this._.extraTexture = this._.extraTexture || new Texture(0, 0, gl.RGBA, type);\r\n        this._.flippedShader = this._.flippedShader || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\\\r\n        }\\\r\n    ', 'flippedShader');\r\n        this._.isInitialized = true;\r\n    }\r\n\r\n    /*\r\n       Draw a texture to the canvas, with an optional width and height to scale to.\r\n       If no width and height are given then the original texture width and height\r\n       are used.\r\n    */\r\n    function draw(texture, width, height) {\r\n        if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\r\n            initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\r\n        }\r\n\r\n        texture._.use();\r\n        this._.texture.drawTo(function () {\r\n            Shader.getDefaultShader().drawRect();\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    function update() {\r\n        this._.texture.use();\r\n        this._.flippedShader.drawRect();\r\n        return this;\r\n    }\r\n\r\n    function simpleShader(shader, uniforms, textureIn, textureOut) {\r\n        (textureIn || this._.texture).use();\r\n        this._.spareTexture.drawTo(function () {\r\n            shader.uniforms(uniforms).drawRect();\r\n        });\r\n        this._.spareTexture.swapWith(textureOut || this._.texture);\r\n    }\r\n\r\n    function replace(node) {\r\n        node.parentNode.insertBefore(this, node);\r\n        node.parentNode.removeChild(node);\r\n        return this;\r\n    }\r\n\r\n    function contents() {\r\n        let texture = new Texture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\r\n        this._.texture.use();\r\n        texture.drawTo(function () {\r\n            Shader.getDefaultShader().drawRect();\r\n        });\r\n        return wrapTexture(texture);\r\n    }\r\n\r\n    /*\r\n       Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\r\n       Length of the array will be width * height * 4.\r\n    */\r\n    function getPixelArray() {\r\n        let w = this._.texture.width;\r\n        let h = this._.texture.height;\r\n        let array = new Uint8Array(w * h * 4);\r\n        this._.texture.drawTo(function () {\r\n            gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\r\n        });\r\n        return array;\r\n    }\r\n\r\n    function wrap(func) {\r\n        return function () {\r\n            // Make sure that we're using the correct global WebGL context\r\n            gl = this._.gl;\r\n\r\n            // Now that the context has been switched, we can call the wrapped function\r\n            return func.apply(this, arguments);\r\n        };\r\n    }\r\n\r\n    exports.canvas = function () {\r\n        let canvas: any = document.createElement('canvas');\r\n        try {\r\n            gl = canvas.getContext('experimental-webgl', {premultipliedAlpha: false});\r\n        } catch (e) {\r\n            gl = null;\r\n        }\r\n        if (!gl) {\r\n            throw 'This browser does not support WebGL';\r\n        }\r\n        canvas._ = {\r\n            gl: gl,\r\n            isInitialized: false,\r\n            texture: null,\r\n            spareTexture: null,\r\n            flippedShader: null\r\n        };\r\n\r\n        // Core methods\r\n        canvas.texture = wrap(texture);\r\n        canvas.draw = wrap(draw);\r\n        canvas.update = wrap(update);\r\n        canvas.replace = wrap(replace);\r\n        canvas.contents = wrap(contents);\r\n        canvas.getPixelArray = wrap(getPixelArray);\r\n\r\n        // Filter methods\r\n        canvas.brightnessContrast = wrap(brightnessContrast);\r\n        canvas.hexagonalPixelate = wrap(hexagonalPixelate);\r\n        canvas.hueSaturation = wrap(hueSaturation);\r\n        canvas.colorHalftone = wrap(colorHalftone);\r\n        canvas.triangleBlur = wrap(triangleBlur);\r\n        canvas.unsharpMask = wrap(unsharpMask);\r\n        canvas.perspective = wrap(perspective);\r\n        canvas.matrixWarp = wrap(matrixWarp);\r\n        canvas.bulgePinch = wrap(bulgePinch);\r\n        canvas.tiltShift = wrap(tiltShift);\r\n        canvas.dotScreen = wrap(dotScreen);\r\n        canvas.edgeWork = wrap(edgeWork);\r\n        canvas.lensBlur = wrap(lensBlur);\r\n        canvas.zoomBlur = wrap(zoomBlur);\r\n        canvas.noise = wrap(noise);\r\n        canvas.denoise = wrap(denoise);\r\n        canvas.curves = wrap(curves);\r\n        canvas.swirl = wrap(swirl);\r\n        canvas.ink = wrap(ink);\r\n        canvas.vignette = wrap(vignette);\r\n        canvas.vibrance = wrap(vibrance);\r\n        canvas.sepia = wrap(sepia);\r\n        canvas.invert = wrap(invert);\r\n        canvas.multiplyAlpha = wrap(multiplyAlpha);\r\n        canvas.unmultiplyAlpha = wrap(unmultiplyAlpha);\r\n        canvas.toAlpha = wrap(toAlpha);\r\n        canvas.distort = wrap(distort);\r\n\r\n        return canvas;\r\n    };\r\n    exports.splineInterpolate = splineInterpolate;\r\n\r\n// src/core\\matrix.script\r\n// from javax.media.jai.PerspectiveTransform\r\n\r\n    function getSquareToQuad(x0, y0, x1, y1, x2, y2, x3, y3) {\r\n        let dx1 = x1 - x2;\r\n        let dy1 = y1 - y2;\r\n        let dx2 = x3 - x2;\r\n        let dy2 = y3 - y2;\r\n        let dx3 = x0 - x1 + x2 - x3;\r\n        let dy3 = y0 - y1 + y2 - y3;\r\n        let det = dx1 * dy2 - dx2 * dy1;\r\n        let a = (dx3 * dy2 - dx2 * dy3) / det;\r\n        let b = (dx1 * dy3 - dx3 * dy1) / det;\r\n        return [\r\n            x1 - x0 + a * x1, y1 - y0 + a * y1, a,\r\n            x3 - x0 + b * x3, y3 - y0 + b * y3, b,\r\n            x0, y0, 1\r\n        ];\r\n    }\r\n\r\n    function getInverse(m) {\r\n        let a = m[0], b = m[1], c = m[2];\r\n        let d = m[3], e = m[4], f = m[5];\r\n        let g = m[6], h = m[7], i = m[8];\r\n        let det = a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\r\n        return [\r\n            (e * i - f * h) / det, (c * h - b * i) / det, (b * f - c * e) / det,\r\n            (f * g - d * i) / det, (a * i - c * g) / det, (c * d - a * f) / det,\r\n            (d * h - e * g) / det, (b * g - a * h) / det, (a * e - b * d) / det\r\n        ];\r\n    }\r\n\r\n    function multiply(a, b) {\r\n        return [\r\n            a[0] * b[0] + a[1] * b[3] + a[2] * b[6],\r\n            a[0] * b[1] + a[1] * b[4] + a[2] * b[7],\r\n            a[0] * b[2] + a[1] * b[5] + a[2] * b[8],\r\n            a[3] * b[0] + a[4] * b[3] + a[5] * b[6],\r\n            a[3] * b[1] + a[4] * b[4] + a[5] * b[7],\r\n            a[3] * b[2] + a[4] * b[5] + a[5] * b[8],\r\n            a[6] * b[0] + a[7] * b[3] + a[8] * b[6],\r\n            a[6] * b[1] + a[7] * b[4] + a[8] * b[7],\r\n            a[6] * b[2] + a[7] * b[5] + a[8] * b[8]\r\n        ];\r\n    }\r\n\r\n// src/core\\shader.script\r\n    var Shader = (function () {\r\n        function isArray(obj) {\r\n            return Object.prototype.toString.call(obj) == '[object Array]';\r\n        }\r\n\r\n        function isNumber(obj) {\r\n            return Object.prototype.toString.call(obj) == '[object Number]';\r\n        }\r\n\r\n        function compileSource(type, source, nameStr) {\r\n            let shader = gl.createShader(type);\r\n            gl.shaderSource(shader, source.replace(/#define.*/, '')); // glslify adds a line add the beginning that breaks it\r\n            gl.compileShader(shader);\r\n            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n                throw 'compile error: ' + nameStr + ' - ' + gl.getShaderInfoLog(shader);\r\n            }\r\n            return shader;\r\n        }\r\n\r\n        let defaultVertexSource = '\\\r\n    attribute vec2 vertex;\\\r\n    attribute vec2 _texCoord;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        texCoord = _texCoord;\\\r\n        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\r\n    }';\r\n\r\n        let defaultFragmentSource = '\\\r\n    uniform sampler2D texture;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        gl_FragColor = texture2D(texture, texCoord);\\\r\n    }';\r\n\r\n        // added test 2020-04-27 bitbof\r\n        let floatPrecision = null;\r\n\r\n        function testPrecisionSupport(precisionType) {\r\n            let format = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, precisionType);\r\n            return format !== null && format.precision !== 0;\r\n        }\r\n\r\n        function Shader(vertexSource?, fragmentSource?, nameStr?) {\r\n            this.vertexAttribute = null;\r\n            this.texCoordAttribute = null;\r\n            this.program = gl.createProgram();\r\n            vertexSource = vertexSource || defaultVertexSource;\r\n            fragmentSource = fragmentSource || defaultFragmentSource;\r\n            if (floatPrecision === null) {\r\n                floatPrecision = testPrecisionSupport(gl.HIGH_FLOAT) ? 'highp' : (testPrecisionSupport(gl.MEDIUM_FLOAT) ? 'mediump' : 'lowp');\r\n            }\r\n            fragmentSource = 'precision ' + floatPrecision + ' float;' + fragmentSource; // annoying requirement is annoying\r\n            gl.attachShader(this.program, compileSource(gl.VERTEX_SHADER, vertexSource, nameStr + '(vertex)'));\r\n            gl.attachShader(this.program, compileSource(gl.FRAGMENT_SHADER, fragmentSource, nameStr + '(fragment)'));\r\n            gl.linkProgram(this.program);\r\n            if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\r\n                throw 'link error: ' + gl.getProgramInfoLog(this.program);\r\n            }\r\n        }\r\n\r\n        Shader.prototype.destroy = function () {\r\n            gl.deleteProgram(this.program);\r\n            this.program = null;\r\n        };\r\n\r\n        Shader.prototype.uniforms = function (uniforms) {\r\n            gl.useProgram(this.program);\r\n            for (var name in uniforms) {\r\n                if (!uniforms.hasOwnProperty(name)) continue;\r\n                let location = gl.getUniformLocation(this.program, name);\r\n                if (location === null) continue; // will be null if the uniform isn't used in the shader\r\n                let value = uniforms[name];\r\n                if (isArray(value)) {\r\n                    switch (value.length) {\r\n                        case 1:\r\n                            gl.uniform1fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 2:\r\n                            gl.uniform2fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 3:\r\n                            gl.uniform3fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 4:\r\n                            gl.uniform4fv(location, new Float32Array(value));\r\n                            break;\r\n                        case 9:\r\n                            gl.uniformMatrix3fv(location, false, new Float32Array(value));\r\n                            break;\r\n                        case 16:\r\n                            gl.uniformMatrix4fv(location, false, new Float32Array(value));\r\n                            break;\r\n                        default:\r\n                            throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\r\n                    }\r\n                } else if (isNumber(value)) {\r\n                    gl.uniform1f(location, value);\r\n                } else {\r\n                    throw 'attempted to set uniform \"' + name + '\" to invalid value ' + (value || 'undefined').toString();\r\n                }\r\n            }\r\n            // allow chaining\r\n            return this;\r\n        };\r\n\r\n        // textures are uniforms too but for some reason can't be specified by gl.uniform1f,\r\n        // even though floating point numbers represent the integers 0 through 7 exactly\r\n        Shader.prototype.textures = function (textures) {\r\n            gl.useProgram(this.program);\r\n            for (var name in textures) {\r\n                if (!textures.hasOwnProperty(name)) continue;\r\n                gl.uniform1i(gl.getUniformLocation(this.program, name), textures[name]);\r\n            }\r\n            // allow chaining\r\n            return this;\r\n        };\r\n\r\n        Shader.prototype.drawRect = function (left, top, right, bottom) {\r\n            let undefined;\r\n            let viewport = gl.getParameter(gl.VIEWPORT);\r\n            top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\r\n            left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\r\n            right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\r\n            bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\r\n            if (gl.vertexBuffer == null) {\r\n                gl.vertexBuffer = gl.createBuffer();\r\n            }\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([left, top, left, bottom, right, top, right, bottom]), gl.STATIC_DRAW);\r\n            if (gl.texCoordBuffer == null) {\r\n                gl.texCoordBuffer = gl.createBuffer();\r\n                gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n                gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\r\n            }\r\n            if (this.vertexAttribute == null) {\r\n                this.vertexAttribute = gl.getAttribLocation(this.program, 'vertex');\r\n                gl.enableVertexAttribArray(this.vertexAttribute);\r\n            }\r\n            if (this.texCoordAttribute == null) {\r\n                this.texCoordAttribute = gl.getAttribLocation(this.program, '_texCoord');\r\n                gl.enableVertexAttribArray(this.texCoordAttribute);\r\n            }\r\n            gl.useProgram(this.program);\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n            gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n            gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\r\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n        };\r\n\r\n        Shader.getDefaultShader = function () {\r\n            gl.defaultShader = gl.defaultShader || new Shader();\r\n            return gl.defaultShader;\r\n        };\r\n\r\n        return Shader;\r\n    })();\r\n\r\n// src/core\\spline.script\r\n// from SplineInterpolator.cs in the Paint.NET source code\r\n\r\n    function SplineInterpolator(points) {\r\n        let n = points.length;\r\n        this.xa = [];\r\n        this.ya = [];\r\n        this.u = [];\r\n        this.y2 = [];\r\n\r\n        points.sort(function (a, b) {\r\n            return a[0] - b[0];\r\n        });\r\n        for (var i = 0; i < n; i++) {\r\n            this.xa.push(points[i][0]);\r\n            this.ya.push(points[i][1]);\r\n        }\r\n\r\n        this.u[0] = 0;\r\n        this.y2[0] = 0;\r\n\r\n        for (var i = 1; i < n - 1; ++i) {\r\n            // This is the decomposition loop of the tridiagonal algorithm.\r\n            // y2 and u are used for temporary storage of the decomposed factors.\r\n            let wx = this.xa[i + 1] - this.xa[i - 1];\r\n            let sig = (this.xa[i] - this.xa[i - 1]) / wx;\r\n            let p = sig * this.y2[i - 1] + 2.0;\r\n\r\n            this.y2[i] = (sig - 1.0) / p;\r\n\r\n            let ddydx =\r\n                (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\r\n                (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\r\n\r\n            this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\r\n        }\r\n\r\n        this.y2[n - 1] = 0;\r\n\r\n        // This is the backsubstitution loop of the tridiagonal algorithm\r\n        for (var i = n - 2; i >= 0; --i) {\r\n            this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\r\n        }\r\n    }\r\n\r\n    SplineInterpolator.prototype.interpolate = function (x) {\r\n        let n = this.ya.length;\r\n        let klo = 0;\r\n        let khi = n - 1;\r\n\r\n        // We will find the right place in the table by means of\r\n        // bisection. This is optimal if sequential calls to this\r\n        // routine are at random values of x. If sequential calls\r\n        // are in order, and closely spaced, one would do better\r\n        // to store previous values of klo and khi.\r\n        while (khi - klo > 1) {\r\n            let k = (khi + klo) >> 1;\r\n\r\n            if (this.xa[k] > x) {\r\n                khi = k;\r\n            } else {\r\n                klo = k;\r\n            }\r\n        }\r\n\r\n        let h = this.xa[khi] - this.xa[klo];\r\n        let a = (this.xa[khi] - x) / h;\r\n        let b = (x - this.xa[klo]) / h;\r\n\r\n        // Cubic spline polynomial is now evaluated.\r\n        return a * this.ya[klo] + b * this.ya[khi] +\r\n            ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\r\n    };\r\n\r\n// src/core\\texture.script\r\n    var Texture = (function () {\r\n        Texture.fromElement = function (element) {\r\n            let texture = new Texture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\r\n            texture.loadContentsOf(element);\r\n            return texture;\r\n        };\r\n\r\n        function Texture(width, height, format, type) {\r\n            this.gl = gl;\r\n            this.id = gl.createTexture();\r\n            this.width = width;\r\n            this.height = height;\r\n            this.format = format;\r\n            this.type = type;\r\n\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            if (width && height) gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n        }\r\n\r\n        Texture.prototype.loadContentsOf = function (element) {\r\n            this.width = element.width || element.videoWidth;\r\n            this.height = element.height || element.videoHeight;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\r\n        };\r\n\r\n        Texture.prototype.initFromBytes = function (width, height, data) {\r\n            this.width = width;\r\n            this.height = height;\r\n            this.format = gl.RGBA;\r\n            this.type = gl.UNSIGNED_BYTE;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\r\n        };\r\n\r\n        Texture.prototype.destroy = function () {\r\n            gl.deleteTexture(this.id);\r\n            this.id = null;\r\n        };\r\n\r\n        Texture.prototype.use = function (unit) {\r\n            gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        };\r\n\r\n        Texture.prototype.unuse = function (unit) {\r\n            gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n            gl.bindTexture(gl.TEXTURE_2D, null);\r\n        };\r\n\r\n        Texture.prototype.ensureFormat = function (width, height, format, type) {\r\n            // allow passing an existing texture instead of individual arguments\r\n            if (arguments.length == 1) {\r\n                let texture = arguments[0];\r\n                width = texture.width;\r\n                height = texture.height;\r\n                format = texture.format;\r\n                type = texture.type;\r\n            }\r\n\r\n            // change the format only if required\r\n            if (width != this.width || height != this.height || format != this.format || type != this.type) {\r\n                this.width = width;\r\n                this.height = height;\r\n                this.format = format;\r\n                this.type = type;\r\n                gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n                gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n            }\r\n        };\r\n\r\n        Texture.prototype.drawTo = function (callback) {\r\n            // start rendering to this texture\r\n            gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\r\n            if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\r\n                throw new Error('incomplete framebuffer');\r\n            }\r\n            gl.viewport(0, 0, this.width, this.height);\r\n\r\n            // do the drawing\r\n            callback();\r\n\r\n            // stop rendering to this texture\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n        };\r\n\r\n        let canvas = null;\r\n\r\n        function getCanvas(texture) {\r\n            if (canvas == null) canvas = document.createElement('canvas');\r\n            canvas.width = texture.width;\r\n            canvas.height = texture.height;\r\n            let c = canvas.getContext('2d');\r\n            c.clearRect(0, 0, canvas.width, canvas.height);\r\n            return c;\r\n        }\r\n\r\n        Texture.prototype.fillUsingCanvas = function (callback) {\r\n            callback(getCanvas(this));\r\n            this.format = gl.RGBA;\r\n            this.type = gl.UNSIGNED_BYTE;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, canvas);\r\n            return this;\r\n        };\r\n\r\n        Texture.prototype.toImage = function (image) {\r\n            this.use();\r\n            Shader.getDefaultShader().drawRect();\r\n            let size = this.width * this.height * 4;\r\n            let pixels = new Uint8Array(size);\r\n            let c = getCanvas(this);\r\n            let data = c.createImageData(this.width, this.height);\r\n            gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n            for (var i = 0; i < size; i++) {\r\n                data.data[i] = pixels[i];\r\n            }\r\n            c.putImageData(data, 0, 0);\r\n            image.src = canvas.toDataURL();\r\n        };\r\n\r\n        Texture.prototype.swapWith = function (other) {\r\n            let temp;\r\n            temp = other.id;\r\n            other.id = this.id;\r\n            this.id = temp;\r\n            temp = other.width;\r\n            other.width = this.width;\r\n            this.width = temp;\r\n            temp = other.height;\r\n            other.height = this.height;\r\n            this.height = temp;\r\n            temp = other.format;\r\n            other.format = this.format;\r\n            this.format = temp;\r\n        };\r\n\r\n        return Texture;\r\n    })();\r\n\r\n// src/filters\\common.script\r\n    function warpShader(uniforms, warp) {\r\n        return new Shader(null, uniforms + '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        vec2 coord = texCoord * texSize;\\\r\n        ' + warp + '\\\r\n        gl_FragColor = texture2D(texture, coord / texSize);\\\r\n        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\r\n        if (coord != clampedCoord) {\\\r\n            /* fade to transparent if we are outside the image */\\\r\n            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\r\n        }\\\r\n    }', 'warp');\r\n    }\r\n\r\n// returns a random number between 0 and 1\r\n    var randomShaderFunc = '\\\r\n    float random(vec3 scale, float seed) {\\\r\n        /* use the fragment position for a different seed per-pixel */\\\r\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\r\n    }\\\r\n';\r\n\r\n// src/filters\\adjust\\brightnesscontrast.script\r\n    /**\r\n     * @filter           Brightness / Contrast\r\n     * @description      Provides additive brightness and multiplicative contrast control.\r\n     * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\r\n     * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n     */\r\n    function brightnessContrast(brightness, contrast) {\r\n        gl.brightnessContrast = gl.brightnessContrast || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float brightness;\\\r\n        uniform float contrast;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.rgb += brightness;\\\r\n            if (contrast > 0.0) {\\\r\n                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\r\n            } else {\\\r\n                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\r\n            }\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'brightnessContrast');\r\n\r\n        simpleShader.call(this, gl.brightnessContrast, {\r\n            brightness: clamp(-1, brightness, 1),\r\n            contrast: clamp(-1, contrast, 1)\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\curves.script\r\n    function splineInterpolate(points) {\r\n        let interpolator = new SplineInterpolator(points);\r\n        let array = [];\r\n        for (var i = 0; i < 256; i++) {\r\n            array.push(clamp(0, Math.floor(interpolator.interpolate(i / 255) * 256), 255));\r\n        }\r\n        return array;\r\n    }\r\n\r\n    /**\r\n     * @filter      Curves\r\n     * @description A powerful mapping tool that transforms the colors in the image\r\n     *              by an arbitrary function. The function is interpolated between\r\n     *              a set of 2D points using splines. The curves filter can take\r\n     *              either one or three arguments which will apply the mapping to\r\n     *              either luminance or RGB values, respectively.\r\n     * @param red   A list of points that define the function for the red channel.\r\n     *              Each point is a list of two values: the value before the mapping\r\n     *              and the value after the mapping, both in the range 0 to 1. For\r\n     *              example, [[0,1], [1,0]] would invert the red channel while\r\n     *              [[0,0], [1,1]] would leave the red channel unchanged. If green\r\n     *              and blue are omitted then this argument also applies to the\r\n     *              green and blue channels.\r\n     * @param green (optional) A list of points that define the function for the green\r\n     *              channel (just like for red).\r\n     * @param blue  (optional) A list of points that define the function for the blue\r\n     *              channel (just like for red).\r\n     */\r\n    function curves(red, green, blue) {\r\n        // Create the ramp texture\r\n        red = splineInterpolate(red);\r\n        if (arguments.length == 1) {\r\n            green = blue = red;\r\n        } else {\r\n            green = splineInterpolate(green);\r\n            blue = splineInterpolate(blue);\r\n        }\r\n        let array = [];\r\n        for (var i = 0; i < 256; i++) {\r\n            array.splice(array.length, 0, red[i], green[i], blue[i], 255);\r\n        }\r\n        this._.extraTexture.initFromBytes(256, 1, array);\r\n        this._.extraTexture.use(1);\r\n\r\n        gl.curves = gl.curves || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform sampler2D map;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.r = texture2D(map, vec2(color.r)).r;\\\r\n            color.g = texture2D(map, vec2(color.g)).g;\\\r\n            color.b = texture2D(map, vec2(color.b)).b;\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'curves');\r\n\r\n        gl.curves.textures({\r\n            map: 1\r\n        });\r\n        simpleShader.call(this, gl.curves, {});\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\denoise.script\r\n    /**\r\n     * @filter         Denoise\r\n     * @description    Smooths over grainy noise in dark images using an 9x9 box filter\r\n     *                 weighted by color intensity, similar to a bilateral filter.\r\n     * @param exponent The exponent of the color intensity difference, should be greater\r\n     *                 than zero. A value of zero just gives an 9x9 box blur and high values\r\n     *                 give the original image, but ideal values are usually around 10-20.\r\n     */\r\n    function denoise(exponent) {\r\n        // Do a 9x9 bilateral box filter\r\n        gl.denoise = gl.denoise || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float exponent;\\\r\n        uniform float strength;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 center = texture2D(texture, texCoord);\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            for (float x = -4.0; x <= 4.0; x += 1.0) {\\\r\n                for (float y = -4.0; y <= 4.0; y += 1.0) {\\\r\n                    vec4 sample = texture2D(texture, texCoord + vec2(x, y) / texSize);\\\r\n                    float weight = 1.0 - abs(dot(sample.rgb - center.rgb, vec3(0.25)));\\\r\n                    weight = pow(weight, exponent);\\\r\n                    color += sample * weight;\\\r\n                    total += weight;\\\r\n                }\\\r\n            }\\\r\n            gl_FragColor = color / total;\\\r\n        }\\\r\n    ', 'denoise');\r\n\r\n        // Perform two iterations for stronger results\r\n        for (var i = 0; i < 2; i++) {\r\n            simpleShader.call(this, gl.denoise, {\r\n                exponent: Math.max(0, exponent),\r\n                texSize: [this.width, this.height]\r\n            });\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\huesaturation.script\r\n    /**\r\n     * @filter           Hue / Saturation\r\n     * @description      Provides rotational hue and multiplicative saturation control. RGB color space\r\n     *                   can be imagined as a cube where the axes are the red, green, and blue color\r\n     *                   values. Hue changing works by rotating the color vector around the grayscale\r\n     *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\r\n     *                   Saturation is implemented by scaling all color channel values either toward\r\n     *                   or away from the average color channel value.\r\n     * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\r\n     *                   and 1 is 180 degree rotation in the positive direction)\r\n     * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n     */\r\n    function hueSaturation(hue, saturation) {\r\n        gl.hueSaturation = gl.hueSaturation || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float hue;\\\r\n        uniform float saturation;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\r\n            float angle = hue * 3.14159265;\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\r\n            float len = length(color.rgb);\\\r\n            color.rgb = vec3(\\\r\n                dot(color.rgb, weights.xyz),\\\r\n                dot(color.rgb, weights.zxy),\\\r\n                dot(color.rgb, weights.yzx)\\\r\n            );\\\r\n            \\\r\n            /* saturation adjustment */\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            if (saturation > 0.0) {\\\r\n                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\r\n            } else {\\\r\n                color.rgb += (average - color.rgb) * (-saturation);\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'hueSaturation');\r\n\r\n        simpleShader.call(this, gl.hueSaturation, {\r\n            hue: clamp(-1, hue, 1),\r\n            saturation: clamp(-1, saturation, 1)\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\noise.script\r\n    /**\r\n     * @filter         Noise\r\n     * @description    draws noise, completely replaces original image\r\n     * @param seed\r\n     * @param type\r\n     * @param scale\r\n     * @param offset\r\n     * @param octaves\r\n     * @param samples\r\n     * @param peaks\r\n     * @param brightness\r\n     * @param contrast\r\n     * @param isReversed\r\n     * @param colA\r\n     * @param colB\r\n     * @param channels\r\n     */\r\n    function noise(\r\n        seed: number, // float, any value okay\r\n        type: number, // 1 value, 2 simplex, 3 cellular\r\n        scale: [number, number], // float, small scale will show repeating patterns\r\n        offset: [number, number], // offset x, y - large offsets will show repeating patterns\r\n        octaves: number, // int 0 - 4\r\n        samples: number, // 1 | 4 | 8 -> super-sampling\r\n        peaks: number, // how often it will ramp *additionally* from 0 to 1\r\n        brightness: number, // range [-1, 1]\r\n        contrast: number, // range [-1, 1]\r\n        isReversed: boolean, // reverse 0-1 range\r\n        colA: {r: number, g: number, b: number}, // which color at 0, if rgb\r\n        colB: {r: number, g: number, b: number}, // which color at 1, if rgb\r\n        channels: 'rgb' | 'alpha', // which channel to target\r\n    ) {\r\n        gl.noise = gl.noise || new Shader(null, shaderNoise.replace(/#define.*/, ''), 'noise');\r\n        simpleShader.call(this, gl.noise, {\r\n            seed,\r\n            type,\r\n            scale: [scale[0], scale[1]],\r\n            offset,\r\n            octaves,\r\n            samples,\r\n            texSize: [this.width, this.height],\r\n            peaks,\r\n            brightness,\r\n            contrast,\r\n            isReversed: isReversed ? 1.0 : 0.0,\r\n            colA: colA ? [colA.r / 255, colA.g / 255, colA.b / 255] : [0, 0, 0],\r\n            colB: colB ? [colB.r / 255, colB.g / 255, colB.b / 255] : [1, 1, 1],\r\n            channels: channels === 'rgb' ? 0 : 1,\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\sepia.script\r\n    /**\r\n     * @filter         Sepia\r\n     * @description    Gives the image a reddish-brown monochrome tint that imitates an old photograph.\r\n     * @param amount   0 to 1 (0 for no effect, 1 for full sepia coloring)\r\n     */\r\n    function sepia(amount) {\r\n        gl.sepia = gl.sepia || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float r = color.r;\\\r\n            float g = color.g;\\\r\n            float b = color.b;\\\r\n            \\\r\n            color.r = min(1.0, (r * (1.0 - (0.607 * amount))) + (g * (0.769 * amount)) + (b * (0.189 * amount)));\\\r\n            color.g = min(1.0, (r * 0.349 * amount) + (g * (1.0 - (0.314 * amount))) + (b * 0.168 * amount));\\\r\n            color.b = min(1.0, (r * 0.272 * amount) + (g * 0.534 * amount) + (b * (1.0 - (0.869 * amount))));\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'sepia');\r\n\r\n        simpleShader.call(this, gl.sepia, {\r\n            amount: clamp(0, amount, 1)\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\unsharpmask.script\r\n    /**\r\n     * @filter         Unsharp Mask\r\n     * @description    A form of image sharpening that amplifies high-frequencies in the image. It\r\n     *                 is implemented by scaling pixels away from the average of their neighbors.\r\n     * @param radius   The blur radius that calculates the average of the neighboring pixels.\r\n     * @param strength A scale factor where 0 is no effect and higher values cause a stronger effect.\r\n     */\r\n    function unsharpMask(radius, strength) {\r\n        gl.unsharpMask = gl.unsharpMask || new Shader(null, '\\\r\n        uniform sampler2D blurredTexture;\\\r\n        uniform sampler2D originalTexture;\\\r\n        uniform float strength;\\\r\n        uniform float threshold;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 blurred = texture2D(blurredTexture, texCoord);\\\r\n            vec4 original = texture2D(originalTexture, texCoord);\\\r\n            gl_FragColor = mix(blurred, original, 1.0 + strength);\\\r\n        }\\\r\n    ', 'unsharpMask');\r\n\r\n        // Store a copy of the current texture in the second texture unit\r\n        this._.extraTexture.ensureFormat(this._.texture);\r\n        this._.texture.use();\r\n        this._.extraTexture.drawTo(function () {\r\n            Shader.getDefaultShader().drawRect();\r\n        });\r\n\r\n        // Blur the current texture, then use the stored texture to detect edges\r\n        this._.extraTexture.use(1);\r\n        this.triangleBlur(radius);\r\n        gl.unsharpMask.textures({\r\n            originalTexture: 1\r\n        });\r\n        simpleShader.call(this, gl.unsharpMask, {\r\n            strength: strength\r\n        });\r\n        this._.extraTexture.unuse(1);\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\vibrance.script\r\n    /**\r\n     * @filter       Vibrance\r\n     * @description  Modifies the saturation of desaturated colors, leaving saturated colors unmodified.\r\n     * @param amount -1 to 1 (-1 is minimum vibrance, 0 is no change, and 1 is maximum vibrance)\r\n     */\r\n    function vibrance(amount) {\r\n        gl.vibrance = gl.vibrance || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            float mx = max(color.r, max(color.g, color.b));\\\r\n            float amt = (mx - average) * (-amount * 3.0);\\\r\n            color.rgb = mix(color.rgb, vec3(mx), amt);\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'vibrance');\r\n\r\n        simpleShader.call(this, gl.vibrance, {\r\n            amount: clamp(-1, amount, 1)\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\adjust\\vignette.script\r\n    /**\r\n     * @filter         Vignette\r\n     * @description    Adds a simulated lens edge darkening effect.\r\n     * @param size     0 to 1 (0 for center of frame, 1 for edge of frame)\r\n     * @param amount   0 to 1 (0 for no effect, 1 for maximum lens darkening)\r\n     */\r\n    function vignette(size, amount) {\r\n        gl.vignette = gl.vignette || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float size;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            float dist = distance(texCoord, vec2(0.5, 0.5));\\\r\n            color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount + size));\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'vignette');\r\n\r\n        simpleShader.call(this, gl.vignette, {\r\n            size: clamp(0, size, 1),\r\n            amount: clamp(0, amount, 1)\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\blur\\lensblur.script\r\n    /**\r\n     * @filter           Lens Blur\r\n     * @description      Imitates a camera capturing the image out of focus by using a blur that generates\r\n     *                   the large shapes known as bokeh. The polygonal shape of real bokeh is due to the\r\n     *                   blades of the aperture diaphragm when it isn't fully open. This blur renders\r\n     *                   bokeh from a 6-bladed diaphragm because the computation is more efficient. It\r\n     *                   can be separated into three rhombi, each of which is just a skewed box blur.\r\n     *                   This filter makes use of the floating point texture WebGL extension to implement\r\n     *                   the brightness parameter, so there will be severe visual artifacts if brightness\r\n     *                   is non-zero and the floating point texture extension is not available. The\r\n     *                   idea was from John White's SIGGRAPH 2011 talk but this effect has an additional\r\n     *                   brightness parameter that fakes what would otherwise come from a HDR source.\r\n     * @param radius     the radius of the hexagonal disk convolved with the image\r\n     * @param brightness -1 to 1 (the brightness of the bokeh, negative values will create dark bokeh)\r\n     * @param angle      the rotation of the bokeh in radians\r\n     */\r\n    function lensBlur(radius, brightness, angle) {\r\n        // All averaging is done on values raised to a power to make more obvious bokeh\r\n        // (we will raise the average to the inverse power at the end to compensate).\r\n        // Without this the image looks almost like a normal blurred image. This hack is\r\n        // obviously not realistic, but to accurately simulate this we would need a high\r\n        // dynamic range source photograph which we don't have.\r\n        gl.lensBlurPrePass = gl.lensBlurPrePass || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float power;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color = pow(color, vec4(power));\\\r\n            gl_FragColor = vec4(color);\\\r\n        }\\\r\n    ', 'lensBlurPrePass');\r\n\r\n        let common = '\\\r\n        uniform sampler2D texture0;\\\r\n        uniform sampler2D texture1;\\\r\n        uniform vec2 delta0;\\\r\n        uniform vec2 delta1;\\\r\n        uniform float power;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        vec4 sample(vec2 delta) {\\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(delta, 151.7182), 0.0);\\\r\n            \\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            for (float t = 0.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset) / 30.0;\\\r\n                color += texture2D(texture0, texCoord + delta * percent);\\\r\n                total += 1.0;\\\r\n            }\\\r\n            return color / total;\\\r\n        }\\\r\n    ';\r\n\r\n        gl.lensBlur0 = gl.lensBlur0 || new Shader(null, common + '\\\r\n        void main() {\\\r\n            gl_FragColor = sample(delta0);\\\r\n        }\\\r\n    ', 'lensBlur0');\r\n        gl.lensBlur1 = gl.lensBlur1 || new Shader(null, common + '\\\r\n        void main() {\\\r\n            gl_FragColor = (sample(delta0) + sample(delta1)) * 0.5;\\\r\n        }\\\r\n    ', 'lensBlur1');\r\n        gl.lensBlur2 = gl.lensBlur2 || new Shader(null, common + '\\\r\n        void main() {\\\r\n            vec4 color = (sample(delta0) + 2.0 * texture2D(texture1, texCoord)) / 3.0;\\\r\n            gl_FragColor = pow(color, vec4(power));\\\r\n        }\\\r\n    ', 'lensBlur2').textures({texture1: 1});\r\n\r\n        // Generate\r\n        let dir = [];\r\n        for (var i = 0; i < 3; i++) {\r\n            let a = angle + i * Math.PI * 2 / 3;\r\n            dir.push([radius * Math.sin(a) / this.width, radius * Math.cos(a) / this.height]);\r\n        }\r\n        let power = Math.pow(10, clamp(-1, brightness, 1));\r\n\r\n        // Remap the texture values, which will help make the bokeh effect\r\n        simpleShader.call(this, gl.lensBlurPrePass, {\r\n            power: power\r\n        });\r\n\r\n        // Blur two rhombi in parallel into extraTexture\r\n        this._.extraTexture.ensureFormat(this._.texture);\r\n        simpleShader.call(this, gl.lensBlur0, {\r\n            delta0: dir[0]\r\n        }, this._.texture, this._.extraTexture);\r\n        simpleShader.call(this, gl.lensBlur1, {\r\n            delta0: dir[1],\r\n            delta1: dir[2]\r\n        }, this._.extraTexture, this._.extraTexture);\r\n\r\n        // Blur the last rhombus and combine with extraTexture\r\n        simpleShader.call(this, gl.lensBlur0, {\r\n            delta0: dir[1]\r\n        });\r\n        this._.extraTexture.use(1);\r\n        simpleShader.call(this, gl.lensBlur2, {\r\n            power: 1 / power,\r\n            delta0: dir[2]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\blur\\tiltshift.script\r\n    /**\r\n     * @filter               Tilt Shift\r\n     * @description          Simulates the shallow depth of field normally encountered in close-up\r\n     *                       photography, which makes the scene seem much smaller than it actually\r\n     *                       is. This filter assumes the scene is relatively planar, in which case\r\n     *                       the part of the scene that is completely in focus can be described by\r\n     *                       a line (the intersection of the focal plane and the scene). An example\r\n     *                       of a planar scene might be looking at a road from above at a downward\r\n     *                       angle. The image is then blurred with a blur radius that starts at zero\r\n     *                       on the line and increases further from the line.\r\n     * @param startX         The x coordinate of the start of the line segment.\r\n     * @param startY         The y coordinate of the start of the line segment.\r\n     * @param endX           The x coordinate of the end of the line segment.\r\n     * @param endY           The y coordinate of the end of the line segment.\r\n     * @param blurRadius     The maximum radius of the pyramid blur.\r\n     * @param gradientRadius The distance from the line at which the maximum blur radius is reached.\r\n     */\r\n    function tiltShift(startX, startY, endX, endY, blurRadius, gradientRadius) {\r\n        gl.tiltShift = gl.tiltShift || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float blurRadius;\\\r\n        uniform float gradientRadius;\\\r\n        uniform vec2 start;\\\r\n        uniform vec2 end;\\\r\n        uniform vec2 delta;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\\\r\n            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'tiltShift');\r\n\r\n        let dx = endX - startX;\r\n        let dy = endY - startY;\r\n        let d = Math.sqrt(dx * dx + dy * dy);\r\n        simpleShader.call(this, gl.tiltShift, {\r\n            blurRadius: blurRadius,\r\n            gradientRadius: gradientRadius,\r\n            start: [startX, startY],\r\n            end: [endX, endY],\r\n            delta: [dx / d, dy / d],\r\n            texSize: [this.width, this.height]\r\n        });\r\n        simpleShader.call(this, gl.tiltShift, {\r\n            blurRadius: blurRadius,\r\n            gradientRadius: gradientRadius,\r\n            start: [startX, startY],\r\n            end: [endX, endY],\r\n            delta: [-dy / d, dx / d],\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\blur\\triangleblur.script\r\n    /**\r\n     * @filter       Triangle Blur\r\n     * @description  This is the most basic blur filter, which convolves the image with a\r\n     *               pyramid filter. The pyramid filter is separable and is applied as two\r\n     *               perpendicular triangle filters.\r\n     * @param radius The radius of the pyramid convolved with the image.\r\n     */\r\n    function triangleBlur(radius) {\r\n        gl.triangleBlur = gl.triangleBlur || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta * percent);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'triangleBlur');\r\n\r\n        simpleShader.call(this, gl.triangleBlur, {\r\n            delta: [radius / this.width, 0]\r\n        });\r\n        simpleShader.call(this, gl.triangleBlur, {\r\n            delta: [0, radius / this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\blur\\zoomblur.script\r\n    /**\r\n     * @filter         Zoom Blur\r\n     * @description    Blurs the image away from a certain point, which looks like radial motion blur.\r\n     * @param centerX  The x coordinate of the blur origin.\r\n     * @param centerY  The y coordinate of the blur origin.\r\n     * @param strength The strength of the blur. Values in the range 0 to 1 are usually sufficient,\r\n     *                 where 0 doesn't change the image and 1 creates a highly blurred image.\r\n     */\r\n    function zoomBlur(centerX, centerY, strength) {\r\n        gl.zoomBlur = gl.zoomBlur || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float strength;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            vec2 toCenter = center - texCoord * texSize;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = 0.0; t <= 40.0; t++) {\\\r\n                float percent = (t + offset) / 40.0;\\\r\n                float weight = 4.0 * (percent - percent * percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + toCenter * percent * strength / texSize);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'zoomBlur');\r\n\r\n        simpleShader.call(this, gl.zoomBlur, {\r\n            center: [centerX, centerY],\r\n            strength: strength,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\fun\\colorhalftone.script\r\n    /**\r\n     * @filter        Color Halftone\r\n     * @description   Simulates a CMYK halftone rendering of the image by multiplying pixel values\r\n     *                with a four rotated 2D sine wave patterns, one each for cyan, magenta, yellow,\r\n     *                and black.\r\n     * @param centerX The x coordinate of the pattern origin.\r\n     * @param centerY The y coordinate of the pattern origin.\r\n     * @param angle   The rotation of the pattern in radians.\r\n     * @param size    The diameter of a dot in pixels.\r\n     */\r\n    function colorHalftone(centerX, centerY, angle, size) {\r\n        gl.colorHalftone = gl.colorHalftone || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float angle;\\\r\n        uniform float scale;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        \\\r\n        float pattern(float angle) {\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec2 tex = texCoord * texSize - center;\\\r\n            vec2 point = vec2(\\\r\n                c * tex.x - s * tex.y,\\\r\n                s * tex.x + c * tex.y\\\r\n            ) * scale;\\\r\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\r\n        }\\\r\n        \\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            vec3 cmy = 1.0 - color.rgb;\\\r\n            float k = min(cmy.x, min(cmy.y, cmy.z));\\\r\n            cmy = (cmy - k) / (1.0 - k);\\\r\n            cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(angle + 0.26179), pattern(angle + 1.30899), pattern(angle)), 0.0, 1.0);\\\r\n            k = clamp(k * 10.0 - 5.0 + pattern(angle + 0.78539), 0.0, 1.0);\\\r\n            gl_FragColor = vec4(1.0 - cmy - k, color.a);\\\r\n        }\\\r\n    ', 'colorHalftone');\r\n\r\n        simpleShader.call(this, gl.colorHalftone, {\r\n            center: [centerX, centerY],\r\n            angle: angle,\r\n            scale: Math.PI / size,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\fun\\dotscreen.script\r\n    /**\r\n     * @filter        Dot Screen\r\n     * @description   Simulates a black and white halftone rendering of the image by multiplying\r\n     *                pixel values with a rotated 2D sine wave pattern.\r\n     * @param centerX The x coordinate of the pattern origin.\r\n     * @param centerY The y coordinate of the pattern origin.\r\n     * @param angle   The rotation of the pattern in radians.\r\n     * @param size    The diameter of a dot in pixels.\r\n     */\r\n    function dotScreen(centerX, centerY, angle, size) {\r\n        gl.dotScreen = gl.dotScreen || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float angle;\\\r\n        uniform float scale;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        \\\r\n        float pattern() {\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec2 tex = texCoord * texSize - center;\\\r\n            vec2 point = vec2(\\\r\n                c * tex.x - s * tex.y,\\\r\n                s * tex.x + c * tex.y\\\r\n            ) * scale;\\\r\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\r\n        }\\\r\n        \\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\\\r\n        }\\\r\n    ', 'dotScreen');\r\n\r\n        simpleShader.call(this, gl.dotScreen, {\r\n            center: [centerX, centerY],\r\n            angle: angle,\r\n            scale: Math.PI / size,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\fun\\edgework.script\r\n    /**\r\n     * @filter       Edge Work\r\n     * @description  Picks out different frequencies in the image by subtracting two\r\n     *               copies of the image blurred with different radii.\r\n     * @param radius The radius of the effect in pixels.\r\n     */\r\n    function edgeWork(radius) {\r\n        gl.edgeWork1 = gl.edgeWork1 || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec2 color = vec2(0.0);\\\r\n            vec2 total = vec2(0.0);\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec3 sample = texture2D(texture, texCoord + delta * percent).rgb;\\\r\n                float average = (sample.r + sample.g + sample.b) / 3.0;\\\r\n                color.x += average * weight;\\\r\n                total.x += weight;\\\r\n                if (abs(t) < 15.0) {\\\r\n                    weight = weight * 2.0 - 1.0;\\\r\n                    color.y += average * weight;\\\r\n                    total.y += weight;\\\r\n                }\\\r\n            }\\\r\n            gl_FragColor = vec4(color / total, 0.0, 1.0);\\\r\n        }\\\r\n    ', 'edgeWork1');\r\n        gl.edgeWork2 = gl.edgeWork2 || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec2 color = vec2(0.0);\\\r\n            vec2 total = vec2(0.0);\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec2 sample = texture2D(texture, texCoord + delta * percent).xy;\\\r\n                color.x += sample.x * weight;\\\r\n                total.x += weight;\\\r\n                if (abs(t) < 15.0) {\\\r\n                    weight = weight * 2.0 - 1.0;\\\r\n                    color.y += sample.y * weight;\\\r\n                    total.y += weight;\\\r\n                }\\\r\n            }\\\r\n            float c = clamp(10000.0 * (color.y / total.y - color.x / total.x) + 0.5, 0.0, 1.0);\\\r\n            gl_FragColor = vec4(c, c, c, 1.0);\\\r\n        }\\\r\n    ', 'edgeWork2');\r\n\r\n        simpleShader.call(this, gl.edgeWork1, {\r\n            delta: [radius / this.width, 0]\r\n        });\r\n        simpleShader.call(this, gl.edgeWork2, {\r\n            delta: [0, radius / this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\fun\\hexagonalpixelate.script\r\n    /**\r\n     * @filter        Hexagonal Pixelate\r\n     * @description   Renders the image using a pattern of hexagonal tiles. Tile colors\r\n     *                are nearest-neighbor sampled from the centers of the tiles.\r\n     * @param centerX The x coordinate of the pattern center.\r\n     * @param centerY The y coordinate of the pattern center.\r\n     * @param scale   The width of an individual tile, in pixels.\r\n     */\r\n    function hexagonalPixelate(centerX, centerY, scale) {\r\n        gl.hexagonalPixelate = gl.hexagonalPixelate || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float scale;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec2 tex = (texCoord * texSize - center) / scale;\\\r\n            tex.y /= 0.866025404;\\\r\n            tex.x -= tex.y * 0.5;\\\r\n            \\\r\n            vec2 a;\\\r\n            if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) a = vec2(floor(tex.x), floor(tex.y));\\\r\n            else a = vec2(ceil(tex.x), ceil(tex.y));\\\r\n            vec2 b = vec2(ceil(tex.x), floor(tex.y));\\\r\n            vec2 c = vec2(floor(tex.x), ceil(tex.y));\\\r\n            \\\r\n            vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\\\r\n            vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\\\r\n            vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\\\r\n            vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\\\r\n            \\\r\n            float alen = length(TEX - A);\\\r\n            float blen = length(TEX - B);\\\r\n            float clen = length(TEX - C);\\\r\n            \\\r\n            vec2 choice;\\\r\n            if (alen < blen) {\\\r\n                if (alen < clen) choice = a;\\\r\n                else choice = c;\\\r\n            } else {\\\r\n                if (blen < clen) choice = b;\\\r\n                else choice = c;\\\r\n            }\\\r\n            \\\r\n            choice.x += choice.y * 0.5;\\\r\n            choice.y *= 0.866025404;\\\r\n            choice *= scale / texSize;\\\r\n            gl_FragColor = texture2D(texture, choice + center / texSize);\\\r\n        }\\\r\n    ', 'hexagonalPixelate');\r\n\r\n        simpleShader.call(this, gl.hexagonalPixelate, {\r\n            center: [centerX, centerY],\r\n            scale: scale,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\fun\\ink.script\r\n    /**\r\n     * @filter         Ink\r\n     * @description    Simulates outlining the image in ink by darkening edges stronger than a\r\n     *                 certain threshold. The edge detection value is the difference of two\r\n     *                 copies of the image, each blurred using a blur of a different radius.\r\n     * @param strength The multiplicative scale of the ink edges. Values in the range 0 to 1\r\n     *                 are usually sufficient, where 0 doesn't change the image and 1 adds lots\r\n     *                 of black edges. Negative strength values will create white ink edges\r\n     *                 instead of black ones.\r\n     */\r\n    function ink(strength) {\r\n        gl.ink = gl.ink || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float strength;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec2 dx = vec2(1.0 / texSize.x, 0.0);\\\r\n            vec2 dy = vec2(0.0, 1.0 / texSize.y);\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float bigTotal = 0.0;\\\r\n            float smallTotal = 0.0;\\\r\n            vec3 bigAverage = vec3(0.0);\\\r\n            vec3 smallAverage = vec3(0.0);\\\r\n            for (float x = -2.0; x <= 2.0; x += 1.0) {\\\r\n                for (float y = -2.0; y <= 2.0; y += 1.0) {\\\r\n                    vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\\\r\n                    bigAverage += sample;\\\r\n                    bigTotal += 1.0;\\\r\n                    if (abs(x) + abs(y) < 2.0) {\\\r\n                        smallAverage += sample;\\\r\n                        smallTotal += 1.0;\\\r\n                    }\\\r\n                }\\\r\n            }\\\r\n            vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\\\r\n            gl_FragColor = vec4(color.rgb - dot(edge, edge) * strength * 100000.0, color.a);\\\r\n        }\\\r\n    ', 'ink');\r\n\r\n        simpleShader.call(this, gl.ink, {\r\n            strength: strength * strength * strength * strength * strength,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\warp\\bulgepinch.script\r\n    /**\r\n     * @filter         Bulge / Pinch\r\n     * @description    Bulges or pinches the image in a circle.\r\n     * @param centerX  The x coordinate of the center of the circle of effect.\r\n     * @param centerY  The y coordinate of the center of the circle of effect.\r\n     * @param radius   The radius of the circle of effect.\r\n     * @param strength -1 to 1 (-1 is strong pinch, 0 is no effect, 1 is strong bulge)\r\n     */\r\n    function bulgePinch(centerX, centerY, radius, strength) {\r\n        gl.bulgePinch = gl.bulgePinch || warpShader('\\\r\n        uniform float radius;\\\r\n        uniform float strength;\\\r\n        uniform vec2 center;\\\r\n    ', '\\\r\n        coord -= center;\\\r\n        float distance = length(coord);\\\r\n        if (distance < radius) {\\\r\n            float percent = distance / radius;\\\r\n            if (strength > 0.0) {\\\r\n                coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);\\\r\n            } else {\\\r\n                coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);\\\r\n            }\\\r\n        }\\\r\n        coord += center;\\\r\n    ');\r\n\r\n        simpleShader.call(this, gl.bulgePinch, {\r\n            radius: radius,\r\n            strength: clamp(-1, strength, 1),\r\n            center: [centerX, centerY],\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\warp\\matrixwarp.script\r\n    /**\r\n     * @filter                Matrix Warp\r\n     * @description           Transforms an image by a 2x2 or 3x3 matrix. The coordinates used in\r\n     *                        the transformation are (x, y) for a 2x2 matrix or (x, y, 1) for a\r\n     *                        3x3 matrix, where x and y are in units of pixels.\r\n     * @param matrix          A 2x2 or 3x3 matrix represented as either a list or a list of lists.\r\n     *                        For example, the 3x3 matrix [[2,0,0],[0,3,0],[0,0,1]] can also be\r\n     *                        represented as [2,0,0,0,3,0,0,0,1] or just [2,0,0,3].\r\n     * @param inverse         A boolean value that, when true, applies the inverse transformation\r\n     *                        instead. (optional, defaults to false)\r\n     * @param useTextureSpace A boolean value that, when true, uses texture-space coordinates\r\n     *                        instead of screen-space coordinates. Texture-space coordinates range\r\n     *                        from -1 to 1 instead of 0 to width - 1 or height - 1, and are easier\r\n     *                        to use for simple operations like flipping and rotating.\r\n     */\r\n    function matrixWarp(matrix, inverse, useTextureSpace) {\r\n        gl.matrixWarp = gl.matrixWarp || warpShader('\\\r\n        uniform mat3 matrix;\\\r\n        uniform bool useTextureSpace;\\\r\n    ', '\\\r\n        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;\\\r\n        vec3 warp = matrix * vec3(coord, 1.0);\\\r\n        coord = warp.xy / warp.z;\\\r\n        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;\\\r\n    ');\r\n\r\n        // Flatten all members of matrix into one big list\r\n        matrix = Array.prototype.concat.apply([], matrix);\r\n\r\n        // Extract a 3x3 matrix out of the arguments\r\n        if (matrix.length == 4) {\r\n            matrix = [\r\n                matrix[0], matrix[1], 0,\r\n                matrix[2], matrix[3], 0,\r\n                0, 0, 1\r\n            ];\r\n        } else if (matrix.length != 9) {\r\n            throw 'can only warp with 2x2 or 3x3 matrix';\r\n        }\r\n\r\n        simpleShader.call(this, gl.matrixWarp, {\r\n            matrix: inverse ? getInverse(matrix) : matrix,\r\n            texSize: [this.width, this.height],\r\n            useTextureSpace: useTextureSpace | 0\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n// src/filters\\warp\\perspective.script\r\n    /**\r\n     * @filter       Perspective\r\n     * @description  Warps one quadrangle to another with a perspective transform. This can be used to\r\n     *               make a 2D image look 3D or to recover a 2D image captured in a 3D environment.\r\n     * @param before The x and y coordinates of four points before the transform in a flat list. This\r\n     *               would look like [ax, ay, bx, by, cx, cy, dx, dy] for four points (ax, ay), (bx, by),\r\n     *               (cx, cy), and (dx, dy).\r\n     * @param after  The x and y coordinates of four points after the transform in a flat list, just\r\n     *               like the other argument.\r\n     */\r\n    function perspective(before, after) {\r\n        let a = getSquareToQuad.apply(null, after);\r\n        let b = getSquareToQuad.apply(null, before);\r\n        let c = multiply(getInverse(a), b);\r\n        return this.matrixWarp(c);\r\n    }\r\n\r\n// src/filters\\warp\\swirl.script\r\n    /**\r\n     * @filter        Swirl\r\n     * @description   Warps a circular region of the image in a swirl.\r\n     * @param centerX The x coordinate of the center of the circular region.\r\n     * @param centerY The y coordinate of the center of the circular region.\r\n     * @param radius  The radius of the circular region.\r\n     * @param angle   The angle in radians that the pixels in the center of\r\n     *                the circular region will be rotated by.\r\n     */\r\n    function swirl(centerX, centerY, radius, angle) {\r\n        gl.swirl = gl.swirl || warpShader('\\\r\n        uniform float radius;\\\r\n        uniform float angle;\\\r\n        uniform vec2 center;\\\r\n    ', '\\\r\n        coord -= center;\\\r\n        float distance = length(coord);\\\r\n        if (distance < radius) {\\\r\n            float percent = (radius - distance) / radius;\\\r\n            float theta = percent * percent * angle;\\\r\n            float s = sin(theta);\\\r\n            float c = cos(theta);\\\r\n            coord = vec2(\\\r\n                coord.x * c - coord.y * s,\\\r\n                coord.x * s + coord.y * c\\\r\n            );\\\r\n        }\\\r\n        coord += center;\\\r\n    ');\r\n\r\n        simpleShader.call(this, gl.swirl, {\r\n            radius: radius,\r\n            center: [centerX, centerY],\r\n            angle: angle,\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @filter        Invert\r\n     * @description   Inverts color of each pixel\r\n     */\r\n    function invert() {\r\n        gl.invert = gl.invert || new Shader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        color.rgb = 1.0 - color.rgb;\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'invert');\r\n\r\n        simpleShader.call(this, gl.invert, {\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @filter        multiplyAlpha\r\n     * @description   applies alpha multiply\r\n     */\r\n    function multiplyAlpha() {\r\n        gl.multiplyAlpha = gl.multiplyAlpha || new Shader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        color.rgb *= color.a;\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'multiplyAlpha');\r\n\r\n        simpleShader.call(this, gl.multiplyAlpha, {\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @filter        unmultiplyAlpha\r\n     * @description   reverses alpha multiply\r\n     */\r\n    function unmultiplyAlpha() {\r\n        gl.unmultiplyAlpha = gl.unmultiplyAlpha || new Shader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        if(color.a > 0.0) {\\\r\n            color.rgb /= color.a;\\\r\n        }\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'unmultiplyAlpha');\r\n\r\n        simpleShader.call(this, gl.unmultiplyAlpha, {\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @filter        To Alpha\r\n     * @description   Generates alpha channel from luminance (r+g+b)\r\n     * @param isInverted    boolean - invert luminance\r\n     * @param replaceRGBA    rgba - color to replace rgb with. if a = 0 -> keep orig color\r\n     */\r\n    function toAlpha(isInverted, replaceRGBA) {\r\n        gl.toAlpha = gl.toAlpha || new Shader(null, '\\\r\n    uniform bool isInverted;\\\r\n    uniform vec4 replace;\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        float alpha = (color.r + color.g + color.b) / 3.0;\\\r\n        if (isInverted) alpha = 1.0 - alpha;\\\r\n        alpha = min(color.a, alpha);\\\r\n        if (replace.a > 0.0) color = replace;\\\r\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha);\\\r\n    }\\\r\n', 'toAlpha');\r\n\r\n        simpleShader.call(this, gl.toAlpha, {\r\n            isInverted: isInverted ? 1 : 0,\r\n            replace: replaceRGBA ? [replaceRGBA.r / 255, replaceRGBA.g / 255, replaceRGBA.b / 255, replaceRGBA.a] : [0, 0, 0, 0],\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @filter        Distort\r\n     * @description   Distorts image (moves pixels around)\r\n     */\r\n    function distort(settings: {\r\n        stepSize: number; // [1, inf]\r\n        distortType: 0 | 1 | 2;\r\n        scale: { x: number; y: number };\r\n        strength: { x: number; y: number };\r\n        phase: { x: number; y: number };\r\n    }) {\r\n        gl.distort = gl.distort || warpShader('\\\r\n        uniform float stepSize;\\\r\n        uniform vec2 scale;\\\r\n        uniform vec2 strength;\\\r\n        uniform vec2 phase;\\\r\n        uniform float type;\\\r\n        ', '\\\r\n        const float PI = 3.14159265;\\\r\n        float x = coord.x;\\\r\n        float y = coord.y;\\\r\n        if (stepSize > 1.0) {\\\r\n            x = floor(x / stepSize) * stepSize;\\\r\n            y = floor(y / stepSize) * stepSize;\\\r\n        }\\\r\n        float distortX = sin((x/scale.x + phase.x) * PI * 2.0) * strength.x;\\\r\n        float distortY = sin((y/scale.y + phase.y) * PI * 2.0) * strength.y;\\\r\n        if (type == 0.0) {\\\r\n            coord.y += distortX;\\\r\n            coord.x += distortY;\\\r\n        } else if (type == 1.0) {\\\r\n            coord.x += distortX;\\\r\n            coord.y += distortY;\\\r\n        } else if (type == 2.0) {\\\r\n            gl_FragColor = texture2D(texture, vec2(x, y) / texSize);\\\r\n            coord.y += sin(gl_FragColor.r/scale.x*200.0 + phase.x * PI * 2.0) * strength.x;\\\r\n            coord.x += cos(gl_FragColor.g/scale.y*200.0 + phase.y * PI * 2.0) * strength.y;\\\r\n        }\\\r\n        coord.x = mod(coord.x, texSize.x);\\\r\n        coord.y = mod(coord.y, texSize.y);\\\r\n        \\\r\n        ');\r\n\r\n        simpleShader.call(this, gl.distort, {\r\n            stepSize: settings.stepSize,\r\n            type: settings.distortType,\r\n            scale: [settings.scale.x, settings.scale.y],\r\n            strength: [settings.strength.x, settings.strength.y],\r\n            phase: [settings.phase.x, settings.phase.y],\r\n            texSize: [this.width, this.height]\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    return exports;\r\n})();\r\n","uniform sampler2D texture;\r\nvarying vec2 texCoord;\r\nuniform vec2 texSize;\r\n\r\nuniform float seed;\r\nuniform float type;\r\nuniform vec2 scale;\r\nuniform vec2 offset;\r\nuniform float octaves;\r\nuniform float samples;\r\n\r\nuniform float peaks;\r\nuniform float contrast;\r\nuniform float brightness;\r\nuniform float isReversed;\r\n\r\nuniform vec3 colA;\r\nuniform vec3 colB;\r\n\r\nuniform float channels; // 0 - rgb, 1 - alpha\r\n\r\n// fbm, cellular_noise based on\r\n// https://github.com/Gonkee/Gonkees-Shaders\r\n// MIT, Copyright  Gonkee\r\n\r\n// hash & simplex based on\r\n// https://www.shadertoy.com/view/Msf3WH\r\n// MIT, Copyright  2013 Inigo Quilez\r\n// https://www.youtube.com/c/InigoQuilez\r\n// https://iquilezles.org\r\n\r\n\r\n\r\nfloat rand(vec2 co) {\r\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\r\n}\r\n\r\nfloat value_noise(vec2 coord){\r\n    return rand(floor(coord) / 100.0);\r\n}\r\n\r\nfloat cellular_noise(vec2 coord) {\r\n    vec2 i = floor(coord);\r\n    vec2 f = fract(coord);\r\n\r\n    float min_dist = 99999.0;\r\n    for (float x = -1.0; x <= 1.0; x++) {\r\n        for (float y = -1.0; y <= 1.0; y++) {\r\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\r\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\r\n            min_dist = min(min_dist, dist);\r\n        }\r\n    }\r\n    return min_dist;\r\n}\r\n\r\n// ---------- Simplex Alternative _--------------------\r\n\r\nvec3 hash(vec3 p)\r\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\r\n, dot(p, vec3(269.5, 183.3, 246.1))\r\n, dot(p, vec3(113.5, 271.9, 124.6)))\r\n;return fract(sin(p)*43758.5453123)*2.-1.; }\r\n\r\nmat3 hash(mat3 p)\r\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\r\n\r\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\r\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\r\n\r\n//return noiseGra13dx as .x, and its derivatives as .yzw\r\n// https://www.shadertoy.com/view/llByD1\r\nvec3 noiseGra13dx(in vec3 x) {\r\n    vec3 p=floor(x), w=fract(x)\r\n    #if 1\r\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\r\n    #else\r\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\r\n    #endif\r\n    //gradients\r\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\r\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\r\n    //projections\r\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\r\n    //interpolations\r\n    float g=dot(G, w), f=dot(F, w-vec3(1));\r\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\r\n    mat3 S=D-mat3(G, G, G), W=D-E;\r\n    a.x=(a.x+a.y+a.z)+f-g;\r\n    ;float b=u.x*u.y*u.z;\r\n\r\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\r\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\r\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\r\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\r\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\r\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\r\n    return 0.5 + 0.5 * result.xxx;\r\n}\r\n\r\nfloat fbm(vec2 coord) {\r\n    float normalize_factor = 0.0;\r\n    float value = 0.0;\r\n    float scale = 0.5;\r\n\r\n    for (float i = 0.0; i < 7.0; i++){\r\n        if (i < octaves) {\r\n            if (type == 0.0) {\r\n                value += value_noise(coord) * scale;\r\n            } else if (type == 1.0) {\r\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\r\n            } else if (type == 2.0) {\r\n                value += cellular_noise(coord) * scale;\r\n            }\r\n            normalize_factor += scale;\r\n            coord *= 2.0;\r\n            scale *= 0.5;\r\n        }\r\n    }\r\n    return value / normalize_factor;\r\n}\r\n\r\nfloat render (vec2 pos) {\r\n    float result = fbm(pos);\r\n    //\r\n\r\n    if (peaks > 0.0) {\r\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\r\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\r\n    }\r\n\r\n    result += brightness;\r\n    if (contrast > 0.0) {\r\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\r\n    } else if (contrast < 0.0) {\r\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\r\n    }\r\n\r\n    if (isReversed == 1.0) {\r\n        result = 1.0 - result;\r\n    }\r\n    return result;\r\n}\r\n\r\n\r\nvoid main() {\r\n    vec4 color;\r\n\r\n    vec2 seedOffset;\r\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\r\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\r\n\r\n    float val = 0.0;\r\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\r\n\r\n    if (samples == 1.0) {\r\n        val = render(basePos);\r\n\r\n    }/* else if (samples == 4.0) {\r\n        for (float i = 0.0; i < 2.0; i++) {\r\n            for (float e = 0.0; e < 2.0; e++) {\r\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\r\n            }\r\n        }\r\n        val /= 4.0;\r\n\r\n    }*/ else if (samples == 16.0) {\r\n        for (float i = 0.0; i < 4.0; i++) {\r\n            for (float e = 0.0; e < 4.0; e++) {\r\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\r\n            }\r\n        }\r\n        val /= 16.0;\r\n    }\r\n\r\n    if (channels == 0.0) {\r\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\r\n    } else {\r\n        gl_FragColor = vec4(vec3(1.0), val);\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {input} from '../ui/base-components/input';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {Cropper} from '../ui/components/cropper';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterCropExtend = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        const klCanvas = params.klCanvas;\r\n        if (!klCanvas)\r\n            return false;\r\n        const tempCanvas = BB.canvas();\r\n        {\r\n            let fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 560, 400, 1);\r\n            let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n            let previewFactor = w / klCanvas.getWidth();\r\n            tempCanvas.width = w;\r\n            tempCanvas.height = h;\r\n            tempCanvas.style.display = 'block';\r\n            tempCanvas.getContext(\"2d\").drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n        }\r\n\r\n        const div = document.createElement(\"div\");\r\n        const result: any = {\r\n            element: div\r\n        };\r\n        div.innerHTML = LANG('filter-crop-description') + \"<br/><br/>\";\r\n        let left = 0, right = 0, top = 0, bottom = 0;\r\n        let leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\r\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n        let scale;\r\n\r\n\r\n\r\n        // --- input elements ---\r\n\r\n        const lrWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'}\r\n        });\r\n        const tbWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'}\r\n        });\r\n        div.appendChild(lrWrapper);\r\n        div.appendChild(tbWrapper);\r\n\r\n        const leftInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                leftChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n        const rightInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px'},\r\n            callback: function(v) {\r\n                rightChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n        const topInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                topChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n        const bottomInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px'},\r\n            callback: function(v) {\r\n                bottomChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            width: '60px'\r\n        };\r\n        lrWrapper.append(\r\n            BB.el({content: LANG('filter-crop-left') + ':', css: labelStyle}),\r\n            leftInput,\r\n            BB.el({content: LANG('filter-crop-right') + ':', css: labelStyle}),\r\n            rightInput\r\n        );\r\n        tbWrapper.append(\r\n            BB.el({content: LANG('filter-crop-top') + ':', css: labelStyle}),\r\n            topInput,\r\n            BB.el({content: LANG('filter-crop-bottom') + ':', css: labelStyle}),\r\n            bottomInput\r\n        );\r\n\r\n        function updateInput() {\r\n            left = parseInt(leftInput.value);\r\n            right = parseInt(rightInput.value);\r\n            top = parseInt(topInput.value);\r\n            bottom = parseInt(bottomInput.value);\r\n            let newWidth = klCanvas.getWidth() + left + right;\r\n            let newHeight = klCanvas.getHeight() + top + bottom;\r\n\r\n            if (newWidth <= 0) {\r\n                if (leftChanged) {\r\n                    left = -klCanvas.getWidth() - right + 1;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -klCanvas.getWidth() - left + 1;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = 1;\r\n            }\r\n            if (newWidth > maxWidth) {\r\n                if (leftChanged) {\r\n                    left = -klCanvas.getWidth() - right + maxWidth;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -klCanvas.getWidth() - left + maxWidth;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = maxWidth;\r\n            }\r\n            if (newHeight <= 0) {\r\n                if (topChanged) {\r\n                    top = -klCanvas.getHeight() - bottom + 1;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -klCanvas.getHeight() - top + 1;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = 1;\r\n            }\r\n            if (newHeight > maxHeight) {\r\n                if (topChanged) {\r\n                    top = -klCanvas.getHeight() - bottom + maxHeight;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -klCanvas.getHeight() - top + maxHeight;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = maxHeight;\r\n            }\r\n            cropper.setTransform({\r\n                x: -left,\r\n                y: -top,\r\n                width: newWidth,\r\n                height: newHeight\r\n            });\r\n\r\n\r\n            leftChanged = false;\r\n            rightChanged = false;\r\n            topChanged = false;\r\n            bottomChanged = false;\r\n        }\r\n\r\n        let useRuleOfThirds = true;\r\n        let ruleOThirdsCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-crop-rule-thirds'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                useRuleOfThirds = b;\r\n                cropper.showThirds(useRuleOfThirds);\r\n            }\r\n        });\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both'\r\n            }\r\n        }));\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 0};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 0},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n            {r: 0, g: 0, b: 0, a: 1}\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('filter-crop-fill'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function(rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                updateBg(rgbaObj);\r\n            }\r\n        });\r\n\r\n\r\n        const flexRow = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between'\r\n            }\r\n        });\r\n        div.appendChild(flexRow);\r\n        flexRow.appendChild(ruleOThirdsCheckbox.getElement());\r\n        flexRow.appendChild(colorOptions.getElement());\r\n\r\n\r\n        // when input field changed, or dragging in preview finished\r\n        // adjusts the zoom\r\n        function update(transform) {\r\n            const fit = BB.fitInto(transform.width, transform.height, 260, 180, 1);\r\n            scale = fit.width / transform.width;\r\n\r\n            const offset = BB.centerWithin(340, 220, fit.width, fit.height);\r\n\r\n            tempCanvas.style.width = klCanvas.getWidth() * scale + \"px\";\r\n            tempCanvas.style.height = klCanvas.getHeight() * scale + \"px\";\r\n\r\n            offsetWrapper.style.left = (offset.x - transform.x * scale) + \"px\";\r\n            offsetWrapper.style.top = (offset.y - transform.y * scale) + \"px\";\r\n\r\n            left = parseInt('' + -transform.x);\r\n            top = parseInt('' + -transform.y);\r\n            right = parseInt('' + (transform.x + transform.width - klCanvas.getWidth()));\r\n            bottom = parseInt('' + (transform.y + transform.height - klCanvas.getHeight()));\r\n            leftInput.value = '' + left;\r\n            topInput.value = '' + top;\r\n            rightInput.value = '' + right;\r\n            bottomInput.value = '' + bottom;\r\n\r\n            BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                previewWrapper.style.background = \"url(\" + url + \")\";\r\n                if (selectedRgbaObj.a !== 0) {\r\n                    tempCanvas.style.background = \"url(\" + url + \")\";\r\n                }\r\n            });\r\n            previewWrapper.style.backgroundPosition = (offset.x) + \"px \" + (offset.y) + \"px\";\r\n\r\n            cropper.setScale(scale);\r\n        }\r\n\r\n        const previewWrapper = BB.el({\r\n            css: {\r\n                width: \"340px\",\r\n                marginTop: '10px',\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                position: \"relative\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                userSelect: 'none',\r\n                colorScheme: 'only light',\r\n                touchAction: 'none',\r\n            }\r\n        });\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        const bgColorOverlay = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0'\r\n            }\r\n        });\r\n        previewWrapper.appendChild(bgColorOverlay);\r\n\r\n        const offsetWrapper = document.createElement(\"div\");\r\n        offsetWrapper.style.position = \"absolute\";\r\n        offsetWrapper.style.left = \"0px\";\r\n        offsetWrapper.style.top = \"0px\";\r\n        previewWrapper.appendChild(offsetWrapper);\r\n\r\n\r\n        const canvasWrapper = BB.appendTextDiv(offsetWrapper, \"\");\r\n        canvasWrapper.appendChild(tempCanvas);\r\n        //tempCanvas.style.width = w + \"px\";\r\n        //tempCanvas.style.height = h + \"px\";\r\n        tempCanvas.style.boxShadow = \"0 0 3px 1px rgba(0,0,0,0.5)\";\r\n        tempCanvas.style.position = \"absolute\";\r\n        tempCanvas.style.left = \"0px\";\r\n        tempCanvas.style.top = \"0px\";\r\n\r\n        div.appendChild(previewWrapper);\r\n        const cropper = new Cropper({\r\n            x: 0,\r\n            y: 0,\r\n            width: klCanvas.getWidth(),\r\n            height: klCanvas.getHeight(),\r\n            scale: scale,\r\n            callback: update,\r\n            maxW: maxWidth,\r\n            maxH: maxHeight\r\n        });\r\n        update(cropper.getTransform());\r\n        offsetWrapper.appendChild(cropper.getElement());\r\n\r\n        function updateBg(rgbaObj) {\r\n\r\n            let borderColor;\r\n            if (rgbaObj.a === 0) {\r\n                borderColor = 'rgba(0,0,0,0.5)';\r\n                bgColorOverlay.style.background = '';\r\n                tempCanvas.style.background = '';\r\n            } else {\r\n                borderColor = (rgbaObj.r + rgbaObj.g + rgbaObj.b < 255 * 3 / 2) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\r\n                bgColorOverlay.style.background = BB.ColorConverter.toRgbStr(rgbaObj);\r\n\r\n                BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                    tempCanvas.style.background = \"url(\" + url + \")\";\r\n                });\r\n            }\r\n            tempCanvas.style.boxShadow = \"0 0 3px 1px \" + borderColor;\r\n        }\r\n\r\n        result.destroy = () => {\r\n            cropper.destroy();\r\n            ruleOThirdsCheckbox.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return {\r\n                left: left,\r\n                right: right,\r\n                top: top,\r\n                bottom: bottom,\r\n                fillColor: selectedRgbaObj.a === 0 ? null : selectedRgbaObj\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!klCanvas || !history || isNaN(params.input.left) || isNaN(params.input.right) || isNaN(params.input.top) || isNaN(params.input.bottom)) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.resizeCanvas(params.input);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"cropExtend\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: JSON.parse(JSON.stringify(params.input))\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterCurves = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div,\r\n        };\r\n        let klCanvasPreview;\r\n\r\n        function finishInit() {\r\n\r\n            let previewFactor = w / context.canvas.width;\r\n            let brightness = 0, contrast = 0;\r\n\r\n            div.innerHTML = LANG('filter-curves-description') + \"<br/><br/>\";\r\n\r\n            let curves = {\r\n                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n            };\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n                    if (klCanvasPreview) {\r\n                        klCanvasPreview.render();\r\n                    }\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            let modeButtons;\r\n\r\n            function CurvesInput(p) {\r\n                let div = document.createElement(\"div\");\r\n                div.oncontextmenu = function () {\r\n                    return false;\r\n                };\r\n                div.style.position = \"relative\";\r\n                div.style.marginBottom = \"10px\";\r\n                let mode = \"All\";\r\n                let curves = p.curves;\r\n                modeButtons = new Options( {\r\n                    optionArr: [\r\n                        {\r\n                            id: 'All',\r\n                            label: LANG('filter-curves-all')\r\n                        },\r\n                        {\r\n                            id: 'Red',\r\n                            label: LANG('red')\r\n                        },\r\n                        {\r\n                            id: 'Green',\r\n                            label: LANG('green')\r\n                        },\r\n                        {\r\n                            id: 'Blue',\r\n                            label: LANG('blue')\r\n                        },\r\n                    ],\r\n                    initialId: 'All',\r\n                    onChange: function(id) {\r\n                        mode = id;\r\n                        if (mode === \"All\") {\r\n                            curves = {\r\n                                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                            };\r\n                        }\r\n                        let curve = curves.r;\r\n                        if (mode === \"Green\") {\r\n                            curve = curves.g;\r\n                        }\r\n                        if (mode === \"Blue\") {\r\n                            curve = curves.b;\r\n                        }\r\n                        (p0 as any).setPos(0, areah - curve[0][1] * areah);\r\n                        (p1 as any).setPos(curve[1][0] * areaw, areah - curve[1][1] * areah);\r\n                        (p2 as any).setPos(curve[2][0] * areaw, areah - curve[2][1] * areah);\r\n                        (p3 as any).setPos(areaw, areah - curve[3][1] * areah);\r\n\r\n                        update();\r\n                    }\r\n                });\r\n                div.appendChild(modeButtons.getElement());\r\n\r\n                let curveArea = document.createElement(\"div\");\r\n                BB.css(curveArea, {\r\n                    position: 'relative',\r\n                    marginTop: '10px',\r\n                    colorScheme: 'only light',\r\n                })\r\n                div.appendChild(curveArea);\r\n\r\n                let areaw = 300, areah = 100;\r\n                let canvas = BB.canvas(areaw, areah);\r\n                BB.css(canvas, {\r\n                    background: \"#c6c6c6\",\r\n                    boxShadow: \"0 0 0 1px rgba(0,0,0,0.3)\"\r\n                });\r\n                let ctx = canvas.getContext(\"2d\");\r\n                curveArea.appendChild(canvas);\r\n\r\n                let points = {\r\n                    r: [],\r\n                    g: [],\r\n                    b: []\r\n                };\r\n\r\n                function fit(v) {\r\n                    return Math.max(0, Math.min(1, v));\r\n                }\r\n\r\n                function createPoint(x, y, callback, lock?) {\r\n                    let gripSize = 14;\r\n                    let internalY = y, internalX = x;\r\n                    let point = document.createElement(\"div\");\r\n                    BB.css(point, {\r\n                        position: \"absolute\",\r\n                        left: (x - gripSize / 2) + \"px\",\r\n                        top: (y - gripSize / 2) + \"px\",\r\n                        width: gripSize + \"px\",\r\n                        height: gripSize + \"px\",\r\n                        background: \"#fff\",\r\n                        cursor: \"move\",\r\n                        borderRadius: gripSize + \"px\",\r\n                        boxShadow: \"inset 0 0 0 2px #000\",\r\n                        userSelect: 'none',\r\n                        touchAction: 'none',\r\n                    });\r\n\r\n                    function update() {\r\n                        BB.css(point, {\r\n                            left: (x - gripSize / 2) + \"px\",\r\n                            top: (y - gripSize / 2) + \"px\"\r\n                        });\r\n                    }\r\n\r\n                    (point as any).pointerListener = new BB.PointerListener({\r\n                        target: point,\r\n                        maxPointers: 1,\r\n                        onPointer: function(event) {\r\n                            event.eventPreventDefault();\r\n                            if (event.type === 'pointerdown') {\r\n                                internalX = x;\r\n                                internalY = y;\r\n                            }\r\n                            if (event.button === 'left' && event.type === 'pointermove') {\r\n                                if (!lock) {\r\n                                    internalX += event.dX;\r\n                                }\r\n                                x = Math.max(0, Math.min(areaw, internalX));\r\n                                internalY += event.dY;\r\n                                y = Math.max(0, Math.min(areah, internalY));\r\n                                update();\r\n                                callback({\r\n                                    x: x,\r\n                                    y: y\r\n                                });\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    curveArea.appendChild(point);\r\n\r\n                    (point as any).setPos = function (newX, newY) {\r\n                        x = newX;\r\n                        y = newY;\r\n                        internalY = y;\r\n                        internalX = x;\r\n                        BB.css(point, {\r\n                            left: (x - gripSize / 2) + \"px\",\r\n                            top: (y - gripSize / 2) + \"px\"\r\n                        });\r\n                    };\r\n\r\n                    return point;\r\n                }\r\n\r\n                function updateControl(i, x, y) {\r\n                    if (mode === \"All\") {\r\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                    if (mode === \"Red\") {\r\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                    if (mode === \"Green\") {\r\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                    if (mode === \"Blue\") {\r\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                }\r\n\r\n                let p0 = createPoint(0, areah, function (val) {\r\n                    updateControl(0, val.x, val.y);\r\n                    update();\r\n                }, true);\r\n                let p1 = createPoint(areaw / 3, areah / 3 * 2, function (val) {\r\n                    updateControl(1, val.x, val.y);\r\n                    update();\r\n                });\r\n                let p2 = createPoint(areaw / 3 * 2, areah / 3, function (val) {\r\n                    updateControl(2, val.x, val.y);\r\n                    update();\r\n                });\r\n                let p3 = createPoint(areaw, 0, function (val) {\r\n                    updateControl(3, val.x, val.y);\r\n                    update();\r\n                }, true);\r\n\r\n\r\n                function update() {\r\n                    canvas.width = canvas.width;\r\n                    ctx = canvas.getContext(\"2d\");\r\n\r\n                    let outCurves = {\r\n                        r: [],\r\n                        g: [],\r\n                        b: []\r\n                    };\r\n                    for (let i = 0; i < curves.r.length; i++) {\r\n                        outCurves.r.push(curves.r[i]);\r\n                        outCurves.g.push(curves.g[i]);\r\n                        outCurves.b.push(curves.b[i]);\r\n                    }\r\n\r\n                    function drawCurve(curve) {\r\n                        ctx.beginPath();\r\n                        let spline = new BB.SplineInterpolator(curve);\r\n                        for (let i = 0; i < 100; i++) {\r\n                            let y = spline.interpolate(i / 100);\r\n                            y = Math.max(0, Math.min(1, y));\r\n\r\n                            if (i === 0) {\r\n                                ctx.moveTo(i / 100 * areaw, areah - y * areah);\r\n                            } else {\r\n                                ctx.lineTo(i / 100 * areaw, areah - y * areah);\r\n                            }\r\n                        }\r\n                        ctx.stroke();\r\n                    }\r\n\r\n                    ctx.save();\r\n                    if (mode === \"All\") {\r\n                        ctx.strokeStyle = \"black\";\r\n                        drawCurve(outCurves.r);\r\n                    } else {\r\n                        ctx.globalAlpha = 0.5;\r\n                        ctx.strokeStyle = \"red\";\r\n                        drawCurve(outCurves.r);\r\n                        ctx.strokeStyle = \"green\";\r\n                        drawCurve(outCurves.g);\r\n                        ctx.strokeStyle = \"blue\";\r\n                        drawCurve(outCurves.b);\r\n                    }\r\n                    ctx.restore();\r\n                    p.callback(outCurves);\r\n                }\r\n\r\n                update();\r\n\r\n\r\n                this.getDiv = function () {\r\n                    return div;\r\n                };\r\n                this.destroy = function() {\r\n                    (p0 as any).pointerListener.destroy();\r\n                    (p1 as any).pointerListener.destroy();\r\n                    (p2 as any).pointerListener.destroy();\r\n                    (p3 as any).pointerListener.destroy();\r\n                };\r\n            }\r\n\r\n            let input = new CurvesInput({\r\n                curves: curves,\r\n                callback: function (val) {\r\n                    curves = val;\r\n                    update();\r\n                }\r\n            });\r\n\r\n\r\n            div.appendChild(input.getDiv());\r\n\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            result.destroy = () => {\r\n                input.destroy();\r\n                texture.destroy();\r\n                modeButtons.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    curves: curves\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let curves = params.input.curves;\r\n        let history = params.history;\r\n        if (!context || curves === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"curves\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterFlip = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        let isHorizontal = true;\r\n        let isVertical = false;\r\n        let doFlipCanvas = true;\r\n        div.innerHTML = LANG('filter-flip-description') + \"<br/><br/>\";\r\n\r\n\r\n        let horizontalCheckbox = new Checkbox({\r\n            init: isHorizontal,\r\n            label: LANG('filter-flip-horizontal') + ' ',\r\n            allowTab: true,\r\n            callback: function(v) {\r\n                isHorizontal = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n        let verticalCheckbox = new Checkbox({\r\n            init: isVertical,\r\n            label: LANG('filter-flip-vertical') + ' ',\r\n            allowTab: true,\r\n            callback: function(v) {\r\n                isVertical = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n        div.appendChild(horizontalCheckbox.getElement());\r\n        div.appendChild(verticalCheckbox.getElement());\r\n\r\n\r\n\r\n\r\n\r\n        let fcOption = document.createElement(\"div\");\r\n        BB.setEventListener(fcOption, 'onpointerdown', function () {\r\n            return false;\r\n        });\r\n        fcOption.textContent = LANG('filter-flip-image');\r\n        fcOption.style.width = \"150px\";\r\n        fcOption.style.height = \"30px\";\r\n        fcOption.style.paddingTop = \"10px\";\r\n        fcOption.style.textAlign = \"center\";\r\n        fcOption.style.cssFloat = \"left\";\r\n        fcOption.style.paddingBottom = \"0px\";\r\n        fcOption.style.borderTopLeftRadius = \"10px\";\r\n        fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n        fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n        fcOption.style.backgroundSize = '8%';\r\n        fcOption.style.backgroundColor = \"#9e9e9e\";\r\n\r\n        let flOption = document.createElement(\"div\");\r\n        BB.setEventListener(flOption, 'onpointerdown', function () {\r\n            return false;\r\n        });\r\n        flOption.textContent = LANG('filter-flip-layer');\r\n        flOption.style.width = \"150px\";\r\n        flOption.style.height = \"30px\";\r\n        flOption.style.paddingTop = \"10px\";\r\n        flOption.style.textAlign = \"center\";\r\n        flOption.style.cssFloat = \"left\";\r\n        flOption.style.paddingBottom = \"0px\";\r\n        flOption.style.borderTopRightRadius = \"10px\";\r\n        flOption.style.cursor = \"pointer\";\r\n        flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n        flOption.style.backgroundSize = '8%';\r\n\r\n        BB.setEventListener(fcOption, 'onpointerover', function () {\r\n            if (doFlipCanvas === false)\r\n                fcOption.style.backgroundColor = \"#ccc\";\r\n        });\r\n        BB.setEventListener(fcOption, 'onpointerout', function () {\r\n            if (doFlipCanvas === false)\r\n                fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n        });\r\n        BB.setEventListener(flOption, 'onpointerover', function () {\r\n            if (doFlipCanvas === true)\r\n                flOption.style.backgroundColor = \"#ccc\";\r\n        });\r\n        BB.setEventListener(flOption, 'onpointerout', function () {\r\n            if (doFlipCanvas === true)\r\n                flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n        });\r\n\r\n        fcOption.onclick = function () {\r\n            doFlipCanvas = true;\r\n\r\n            flOption.style.background = \"\";\r\n            flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            flOption.style.boxShadow = \"\";\r\n            flOption.style.cursor = \"pointer\";\r\n\r\n            fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n            fcOption.style.backgroundSize = '8%';\r\n            fcOption.style.backgroundColor = \"#9e9e9e\";\r\n            fcOption.style.cursor = \"default\";\r\n            fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n\r\n            updatePreview();\r\n        };\r\n        flOption.onclick = function () {\r\n            doFlipCanvas = false;\r\n\r\n            fcOption.style.background = \"\";\r\n            fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            fcOption.style.boxShadow = \"\";\r\n            fcOption.style.cursor = \"pointer\";\r\n\r\n            flOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n            flOption.style.backgroundSize = '8%';\r\n            flOption.style.backgroundColor = \"#9e9e9e\";\r\n            flOption.style.cursor = \"default\";\r\n            flOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n\r\n            updatePreview();\r\n        };\r\n\r\n        let optionWrapper = document.createElement(\"div\");\r\n        optionWrapper.appendChild(fcOption);\r\n        optionWrapper.appendChild(flOption);\r\n        div.appendChild(optionWrapper);\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(Math.round(w), Math.round(h)),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over' as IMixMode,\r\n        };\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: [previewLayer]\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        function updatePreview() {\r\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\r\n\r\n            if (doFlipCanvas) {\r\n                if (isHorizontal) {\r\n                    ctx.translate(previewLayer.image.width, 0);\r\n                    ctx.scale(-1, 1);\r\n                }\r\n                if (isVertical) {\r\n                    ctx.translate(0, previewLayer.image.height);\r\n                    ctx.scale(1, -1);\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < layers.length; i++) {\r\n                ctx.save();\r\n                if (!doFlipCanvas && selectedLayerIndex === i) {\r\n                    if (isHorizontal) {\r\n                        ctx.translate(previewLayer.image.width, 0);\r\n                        ctx.scale(-1, 1);\r\n                    }\r\n                    if (isVertical) {\r\n                        ctx.translate(0, previewLayer.image.height);\r\n                        ctx.scale(1, -1);\r\n                    }\r\n                }\r\n                if (ctx.canvas.width > layers[i].context.canvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.globalAlpha = layers[i].opacity;\r\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\r\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\r\n                ctx.restore();\r\n            }\r\n            klCanvasPreview.render();\r\n            ctx.restore();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            horizontalCheckbox.destroy();\r\n            verticalCheckbox.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return {\r\n                horizontal: isHorizontal,\r\n                vertical: isVertical,\r\n                flipCanvas: doFlipCanvas\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        let horizontal = params.input.horizontal;\r\n        let vertical = params.input.vertical;\r\n        let flipCanvas = params.input.flipCanvas;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        klCanvas.flip(horizontal, vertical, flipCanvas ? null : klCanvas.getLayerIndex(context.canvas));\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: [\"filter\", \"flip\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    },\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eFiVD\");","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterHueSaturation = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height,280, 200,  1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        function finishInit() {\r\n            let hue = 0, saturation = 0;\r\n            div.innerHTML = LANG('filter-hue-sat-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let hueSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-hue'),\r\n                width: 300,\r\n                height: 30,\r\n                min: -100,\r\n                max: 100,\r\n                value: hue * 100,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    hue = val / 100;\r\n                    glCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            let saturationSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-saturation'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (saturation + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    saturation = val / 50 - 1;\r\n                    glCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            hueSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(hueSlider.getElement());\r\n            div.appendChild(saturationSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                hueSlider.destroy();\r\n                saturationSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    hue: hue,\r\n                    Saturation: saturation\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let hue = params.input.hue;\r\n        let history = params.history;\r\n        let Saturation = params.input.Saturation;\r\n        if (!context || hue === null || Saturation === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"hueSaturation\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply} from '../kl.types';\r\n\r\nexport const filterInvert = {\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false;\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).invert().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"invert\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {TwoTabs} from '../ui/components/two-tabs';\r\n\r\nexport const filterPerspective = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let isSmall = window.innerWidth < 550;\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n\r\n        let pointerListenerArr = [];\r\n\r\n        function finishInit() {\r\n            div.innerHTML = LANG('filter-perspective-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n            let ba, bb, bc, bd; //before\r\n            let aa, ab, ac, ad; //after\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).multiplyAlpha().perspective(\r\n                        [ba.x, ba.y, bb.x, bb.y, bc.x, bc.y, bd.x, bd.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        }),\r\n                        [aa.x, aa.y, ab.x, ab.y, ac.x, ac.y, ad.x, ad.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        })\r\n                    ).unmultiplyAlpha().update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob(x, y, callback?) {\r\n                let nobSize = 14;\r\n                let div = document.createElement(\"div\");\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                BB.css(div, {\r\n                    width: nobSize + \"px\",\r\n                    height: nobSize + \"px\",\r\n                    backgroundColor: \"#fff\",\r\n                    boxShadow: \"inset 0 0 0 2px #000\",\r\n                    borderRadius: nobSize + \"px\",\r\n                    position: \"absolute\",\r\n                    cursor: \"move\",\r\n                    left: ((div as any).x - nobSize / 2) + \"px\",\r\n                    top: ((div as any).y - nobSize / 2) + \"px\",\r\n                    userSelect: 'none',\r\n                    touchAction: 'none',\r\n                });\r\n\r\n                let pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    maxPointers: 1,\r\n                    onPointer: function(event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                            if (callback) {\r\n                                callback();\r\n                            }\r\n                            update();\r\n                        }\r\n                    }\r\n                });\r\n                (div as any).copy = function (p) {\r\n                    (div as any).x = p.x;\r\n                    (div as any).y = p.y;\r\n                    div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                    div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                };\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            function updateAfter() {\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            }\r\n\r\n            ba = nob(0, 0, updateAfter);\r\n            bb = nob(displayW, 0, updateAfter);\r\n            bc = nob(displayW, displayH, updateAfter);\r\n            bd = nob(0, displayH, updateAfter);\r\n            aa = nob(0, 0);\r\n            ab = nob(displayW, 0);\r\n            ac = nob(displayW, displayH);\r\n            ad = nob(0, displayH);\r\n\r\n            let before = false;\r\n\r\n            const beforeAfterTabs = new TwoTabs({\r\n                left: LANG('compare-before'),\r\n                right: LANG('compare-after'),\r\n                init: 1,\r\n                onChange: (val: number) => {\r\n                    before = val === 0;\r\n                    if (before) {\r\n                        aa.style.display = \"none\";\r\n                        ab.style.display = \"none\";\r\n                        ac.style.display = \"none\";\r\n                        ad.style.display = \"none\";\r\n\r\n                        ba.style.display = \"block\";\r\n                        bb.style.display = \"block\";\r\n                        bc.style.display = \"block\";\r\n                        bd.style.display = \"block\";\r\n                        ba.copy(aa);\r\n                        bb.copy(ab);\r\n                        bc.copy(ac);\r\n                        bd.copy(ad);\r\n                    } else {\r\n                        ba.style.display = \"none\";\r\n                        bb.style.display = \"none\";\r\n                        bc.style.display = \"none\";\r\n                        bd.style.display = \"none\";\r\n\r\n                        aa.style.display = \"block\";\r\n                        ab.style.display = \"block\";\r\n                        ac.style.display = \"block\";\r\n                        ad.style.display = \"block\";\r\n                        aa.copy(ba);\r\n                        ab.copy(bb);\r\n                        ac.copy(bc);\r\n                        ad.copy(bd);\r\n                    }\r\n                    update();\r\n                },\r\n            });\r\n            div.append(beforeAfterTabs.getElement());\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n            BB.css(previewWrapper, {\r\n                width: isSmall ? '340px' : '540px',\r\n                marginLeft: \"-20px\",\r\n                height: isSmall ? '260px' : '300px',\r\n                backgroundColor: \"#9e9e9e\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    let canvas = i === selectedLayerIndex ? glCanvas : layers[i].context.canvas;\r\n                    previewLayerArr.push({\r\n                        image: canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.appendChild(aa);\r\n            previewInnerWrapper.appendChild(ab);\r\n            previewInnerWrapper.appendChild(ac);\r\n            previewInnerWrapper.appendChild(ad);\r\n\r\n            ba.style.display = \"none\";\r\n            bb.style.display = \"none\";\r\n            bc.style.display = \"none\";\r\n            bd.style.display = \"none\";\r\n            previewInnerWrapper.appendChild(ba);\r\n            previewInnerWrapper.appendChild(bb);\r\n            previewInnerWrapper.appendChild(bc);\r\n            previewInnerWrapper.appendChild(bd);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n            update();\r\n            result.destroy = () => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    before: [\r\n                        ba.x / displayPreviewFactor,\r\n                        ba.y / displayPreviewFactor,\r\n\r\n                        bb.x / displayPreviewFactor,\r\n                        bb.y / displayPreviewFactor,\r\n\r\n                        bc.x / displayPreviewFactor,\r\n                        bc.y / displayPreviewFactor,\r\n\r\n                        bd.x / displayPreviewFactor,\r\n                        bd.y / displayPreviewFactor,\r\n                    ],\r\n                    after: [\r\n                        aa.x / displayPreviewFactor,\r\n                        aa.y / displayPreviewFactor,\r\n\r\n                        ab.x / displayPreviewFactor,\r\n                        ab.y / displayPreviewFactor,\r\n\r\n                        ac.x / displayPreviewFactor,\r\n                        ac.y / displayPreviewFactor,\r\n\r\n                        ad.x / displayPreviewFactor,\r\n                        ad.y / displayPreviewFactor,\r\n                    ]\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let before = params.input.before;\r\n        let after = params.input.after;\r\n        if (!context || !before || !after || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).multiplyAlpha().perspective(before, after).unmultiplyAlpha().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"perspective\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\r\n\r\nconst activeColor = '#9e9e9e';\r\nconst inactiveColor = 'rgba(0,0,0,0.1)';\r\nconst hoverColor = '#ccc';\r\n\r\nexport class TwoTabs {\r\n\r\n    private rootEl: HTMLElement;\r\n    private leftTab: HTMLElement;\r\n    private rightTab: HTMLElement;\r\n    private value: number;\r\n\r\n    private update(): void {\r\n        if (this.value === 0) {\r\n            BB.css(this.leftTab, {\r\n                background: \"url(\" + checkmarkImg + \") no-repeat 12px 16px\",\r\n                backgroundColor: activeColor,\r\n                backgroundSize: '8%',\r\n                boxShadow: 'inset 0px 5px 10px rgba(0,0,0,0.5)',\r\n                cursor: 'default',\r\n            });\r\n            BB.css(this.rightTab, {\r\n                background: '',\r\n                backgroundColor: inactiveColor,\r\n                backgroundSize: '8%',\r\n                boxShadow: '',\r\n                cursor: 'pointer',\r\n            });\r\n        } else {\r\n            BB.css(this.rightTab, {\r\n                background: \"url(\" + checkmarkImg + \") no-repeat 12px 16px\",\r\n                backgroundColor: activeColor,\r\n                backgroundSize: '8%',\r\n                boxShadow: 'inset 0px 5px 10px rgba(0,0,0,0.5)',\r\n                cursor: 'default',\r\n            });\r\n            BB.css(this.leftTab, {\r\n                background: '',\r\n                backgroundColor: inactiveColor,\r\n                backgroundSize: '8%',\r\n                boxShadow: '',\r\n                cursor: 'pointer',\r\n            });\r\n        }\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor(params: {\r\n        left: string;\r\n        right: string;\r\n        init: number; //0, 1\r\n        onChange: (val: number) => void;\r\n    }) {\r\n        this.value = params.init;\r\n\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n            }\r\n        });\r\n\r\n        this.leftTab = BB.el({\r\n            parent: this.rootEl,\r\n            content: params.left,\r\n            css: {\r\n                width: '150px',\r\n                height: '30px',\r\n                paddingTop: '10px',\r\n                textAlign: 'center',\r\n                paddingBottom: '0',\r\n                borderTopLeftRadius: '10px',\r\n                backgroundSize: '8%',\r\n            }\r\n        });\r\n        BB.setEventListener(this.leftTab, 'onpointerdown', function () {\r\n            return false;\r\n        });\r\n\r\n        this.rightTab = BB.el({\r\n            parent: this.rootEl,\r\n            content: params.right,\r\n            css: {\r\n                width: '150px',\r\n                height: '30px',\r\n                paddingTop: '10px',\r\n                textAlign: 'center',\r\n                paddingBottom: '0',\r\n                borderTopRightRadius: '10px',\r\n                backgroundSize: '8%',\r\n            }\r\n        });\r\n        BB.setEventListener(this.rightTab, 'onpointerdown', () => {\r\n            return false;\r\n        });\r\n\r\n        this.update();\r\n\r\n        BB.setEventListener(this.leftTab, 'onpointerover', () => {\r\n            if (this.value !== 0) {\r\n                this.leftTab.style.backgroundColor = hoverColor;\r\n            }\r\n        });\r\n        BB.setEventListener(this.leftTab, 'onpointerout', () => {\r\n            if (this.value !== 0) {\r\n                this.leftTab.style.backgroundColor = inactiveColor;\r\n            }\r\n        });\r\n        BB.setEventListener(this.rightTab, 'onpointerover', () => {\r\n            if (this.value !== 1) {\r\n                this.rightTab.style.backgroundColor = hoverColor;\r\n            }\r\n        });\r\n        BB.setEventListener(this.rightTab, 'onpointerout', () => {\r\n            if (this.value !== 1) {\r\n                this.rightTab.style.backgroundColor = inactiveColor;\r\n            }\r\n        });\r\n\r\n        this.leftTab.onclick = () => {\r\n            if (this.value === 0) {\r\n                return;\r\n            }\r\n            this.value = 0;\r\n            this.update();\r\n            params.onChange(this.value);\r\n        };\r\n\r\n        this.rightTab.onclick = () => {\r\n            if (this.value === 1) {\r\n                return;\r\n            }\r\n            this.value = 1;\r\n            this.update();\r\n            params.onChange(this.value);\r\n        };\r\n    }\r\n\r\n    getElement(): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {Select} from '../ui/base-components/select';\r\n// @ts-ignore\r\nimport constrainImg from 'url:~/src/app/img/ui/constrain.svg';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterResize = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        //BB.centerWithin\r\n        let klCanvas = params.klCanvas;\r\n        if (!klCanvas)\r\n            return false;\r\n\r\n        let fit = BB.fitInto( klCanvas.getWidth(), klCanvas.getHeight(), 280, 200,1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let previewFactor = w / klCanvas.getWidth();\r\n        let tempCanvas = klCanvas.getCompleteCanvas(1);\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        let newWidth = klCanvas.getWidth(), newHeight = klCanvas.getHeight();\r\n\r\n        div.innerHTML = LANG('filter-resize-description') + \"<br/><br/>\";\r\n\r\n\r\n        let maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n\r\n        let widthWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            }\r\n        });\r\n        let heightWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            }\r\n        });\r\n        let widthInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxWidth,\r\n                value: '' + klCanvas.getWidth(),\r\n            }\r\n        }) as HTMLInputElement;\r\n        let heightInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxHeight,\r\n                value: '' + klCanvas.getHeight(),\r\n            }\r\n        }) as HTMLInputElement;\r\n        widthInput.onclick = function () {\r\n            (this as any).focus();\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onclick = function () {\r\n            (this as any).focus();\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthInput.onchange = function () {\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onchange = function () {\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthWrapper.append(LANG('width') + \": \", widthInput);\r\n        heightWrapper.append(LANG('height') + \": \", heightInput);\r\n        let inputWrapper = BB.el({\r\n            css: {\r\n                background: \"url(\" + constrainImg + \") no-repeat 140px 5px\",\r\n                backgroundSize: '50px 52px',\r\n            }\r\n        });\r\n        inputWrapper.append(widthWrapper, heightWrapper);\r\n        div.appendChild(inputWrapper);\r\n\r\n        //contrain checkbox\r\n        let heightChanged = false, widthChanged = false;\r\n        let ratio = klCanvas.getWidth() / klCanvas.getHeight();\r\n\r\n        function updateConstrain() {\r\n            if (isConstrained) {\r\n                widthInput.value = '' + klCanvas.getWidth();\r\n                heightInput.value = '' + klCanvas.getHeight();\r\n                inputWrapper.style.background = \"url(\" + constrainImg + \") no-repeat 140px 5px\";\r\n                inputWrapper.style.backgroundSize = '50px 52px';\r\n                update();\r\n            } else {\r\n                inputWrapper.style.background = \"\";\r\n            }\r\n        }\r\n\r\n        let isConstrained = true;\r\n        let constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isConstrained = b;\r\n                updateConstrain();\r\n            }\r\n        });\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both'\r\n            }\r\n        }));\r\n\r\n\r\n        let algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')]\r\n            ],\r\n            title: LANG('scaling-algorithm'),\r\n            initValue: 'smooth',\r\n            onChange: function() {\r\n                update();\r\n            },\r\n        });\r\n\r\n        let secondRowElement = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between'\r\n            }\r\n        });\r\n        secondRowElement.appendChild(constrainCheckbox.getElement());\r\n        secondRowElement.appendChild(algorithmSelect.getElement());\r\n\r\n        let previewCanvas = BB.canvas(w, h);\r\n        previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n\r\n        let previewCtx = previewCanvas.getContext('2d');\r\n\r\n\r\n        function draw() {\r\n            if (algorithmSelect.getValue() === 'smooth') {\r\n                previewCanvas.style.imageRendering = previewFactor > 1 ? 'pixelated' : '';\r\n\r\n                previewCanvas.width = klCanvas.getWidth();\r\n                previewCanvas.height = klCanvas.getHeight();\r\n\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingQuality = 'high';\r\n                previewCtx.drawImage(tempCanvas, 0, 0);\r\n                BB.resizeCanvas(previewCanvas, newWidth, newHeight);\r\n                previewCtx.restore();\r\n\r\n            } else {\r\n                previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n                previewCanvas.width = newWidth;\r\n                previewCanvas.height = newHeight;\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingEnabled = false;\r\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\r\n                previewCtx.restore();\r\n            }\r\n\r\n        }\r\n\r\n        function update() {\r\n            if ((widthInput.value.length === 0 && widthChanged) || (heightInput.value.length === 0 && heightChanged)) {\r\n                heightChanged = false;\r\n                widthChanged = false;\r\n                return;\r\n            }\r\n            widthInput.value = '' + Math.max(1, parseInt(widthInput.value));\r\n            heightInput.value = '' + Math.max(1, parseInt(heightInput.value));\r\n            if (isConstrained) {\r\n                if (heightChanged) {\r\n                    widthInput.value = '' + parseInt('' + (parseInt(heightInput.value) * ratio));\r\n                }\r\n                if (widthChanged) {\r\n                    heightInput.value = '' + parseInt('' + (parseInt(widthInput.value) / ratio));\r\n                }\r\n\r\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\r\n                    let fit = BB.fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\r\n                    widthInput.value = '' + parseInt('' + fit.width);\r\n                    heightInput.value = '' + parseInt('' + fit.height);\r\n                }\r\n            }\r\n\r\n            if (parseInt(widthInput.value) > maxWidth) {\r\n                widthInput.value = '' + maxWidth;\r\n            }\r\n            if (parseInt(heightInput.value) > maxHeight) {\r\n                heightInput.value = '' + maxHeight;\r\n            }\r\n\r\n            heightChanged = false;\r\n            widthChanged = false;\r\n\r\n            newWidth = parseInt(widthInput.value);\r\n            newHeight = parseInt(heightInput.value);\r\n\r\n            let preview = BB.fitInto(newWidth, newHeight, 280, 200, 1);\r\n            let previewW = parseInt('' + preview.width), previewH = parseInt('' + preview.height);\r\n            previewFactor = previewW / newWidth;\r\n\r\n            let offset = BB.centerWithin(340, 220, previewW, previewH);\r\n\r\n            draw();\r\n\r\n            previewCanvas.style.width = Math.max(1, previewW) + \"px\";\r\n            previewCanvas.style.height = Math.max(1, previewH) + \"px\";\r\n            canvasWrapper.style.left = offset.x + \"px\";\r\n            canvasWrapper.style.top = offset.y + \"px\";\r\n            canvasWrapper.style.width = Math.max(1, previewW) + \"px\";\r\n            canvasWrapper.style.height = Math.max(1, previewH) + \"px\";\r\n        }\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            display: \"table\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n\r\n        let canvasWrapper = BB.appendTextDiv(previewWrapper, \"\");\r\n        canvasWrapper.appendChild(previewCanvas);\r\n        canvasWrapper.style.width = w + \"px\";\r\n        canvasWrapper.style.height = h + \"px\";\r\n        canvasWrapper.style.position = \"absolute\";\r\n        canvasWrapper.style.overflow = \"hidden\";\r\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\r\n        canvasWrapper.style.overflow = \"hidden\";\r\n        BB.createCheckerDataUrl(8, function (url) {\r\n            previewWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n\r\n        div.appendChild(previewWrapper);\r\n        update();\r\n\r\n        result.destroy = () => {\r\n            constrainCheckbox.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return {\r\n                width: newWidth,\r\n                height: newHeight,\r\n                algorithm: algorithmSelect.getValue()\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        let width = params.input.width;\r\n        let height = params.input.height;\r\n        let algorithm = params.input.algorithm;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.resize(width, height, algorithm);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"resize\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2BZYe\");","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterRotate = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let klCanvas = params.klCanvas;\r\n        if (!klCanvas)\r\n            return false;\r\n\r\n        let fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let previewFactor = w / klCanvas.getWidth();\r\n        let tempCanvas = BB.canvas(w, h);\r\n        tempCanvas.style.display = 'block';\r\n        tempCanvas.getContext(\"2d\").drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        let deg = 0;\r\n        div.innerHTML = LANG('filter-rotate-description') + \"<br/><br/>\";\r\n\r\n        let first = true;\r\n\r\n        function update() {\r\n            (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg)\";\r\n            (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg)\";\r\n            (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg)\";\r\n            (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg)\";\r\n            if (Math.abs(deg % 180) === 90) {\r\n                //height has to fit width because of rotation\r\n                let fit = BB.fitInto(h, w, 280, 200, 1);\r\n                let scale = parseInt('' + fit.height) / w;\r\n                (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n                (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n                (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n                (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n            }\r\n        }\r\n\r\n        let btnPlus = document.createElement(\"button\");\r\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        let btnMinus = document.createElement(\"button\");\r\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        btnMinus.style.marginRight = '5px';\r\n\r\n\r\n        btnPlus.onclick = function () {\r\n            deg += 90;\r\n            update();\r\n        };\r\n        btnMinus.onclick = function () {\r\n            deg -= 90;\r\n            update();\r\n        };\r\n\r\n        div.appendChild(btnMinus);\r\n        div.appendChild(btnPlus);\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            display: \"table\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewcell = document.createElement(\"div\");\r\n        previewcell.style.display = \"table-cell\";\r\n        previewcell.style.verticalAlign = \"middle\";\r\n        let canvasWrapper = BB.appendTextDiv(previewcell, \"\");\r\n        canvasWrapper.appendChild(tempCanvas);\r\n        previewWrapper.appendChild(previewcell);\r\n        canvasWrapper.style.width = w + \"px\";\r\n        canvasWrapper.style.height = h + \"px\";\r\n        canvasWrapper.style.marginLeft = \"auto\";\r\n        canvasWrapper.style.marginRight = \"auto\";\r\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\r\n        canvasWrapper.style.overflow = \"hidden\";\r\n        BB.createCheckerDataUrl(4, function (url) {\r\n            canvasWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n        canvasWrapper.style.transition = \"all 0.2s ease-out\";\r\n\r\n        div.appendChild(previewWrapper);\r\n        update();\r\n\r\n        result.getInput = function () {\r\n            return {\r\n                deg: deg\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        let deg = params.input.deg;\r\n        if (!klCanvas || !history)\r\n            return false;\r\n        history.pause(true);\r\n        klCanvas.rotate(deg);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"rotate\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterTiltShift = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let previewFactor = w / context.canvas.width;\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        let pointerListenerArr = [];\r\n\r\n        function finishInit() {\r\n            let blur = 20, gradient = 200;\r\n            div.innerHTML = LANG('filter-tilt-shift-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n            let fa, fb; // focus line\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).tiltShift(\r\n                        fa.x / displayPreviewFactor * previewFactor,\r\n                        fa.y / displayPreviewFactor * previewFactor,\r\n                        fb.x / displayPreviewFactor * previewFactor,\r\n                        fb.y / displayPreviewFactor * previewFactor,\r\n                        blur * previewFactor,\r\n                        gradient * previewFactor\r\n                    ).update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob(x, y) {\r\n                let nobSize = 14;\r\n                let div = BB.el({\r\n                    css: {\r\n                        width: nobSize + \"px\",\r\n                        height: nobSize + \"px\",\r\n                        backgroundColor: '#fff',\r\n                        boxShadow: \"inset 0 0 0 2px #000\",\r\n                        borderRadius: nobSize + \"px\",\r\n                        position: \"absolute\",\r\n                        cursor: 'move',\r\n                        left: (x - nobSize / 2) + \"px\",\r\n                        top: (y - nobSize / 2) + \"px\",\r\n                        userSelect: 'none',\r\n                        touchAction: 'none',\r\n                    }\r\n                });\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                let pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    maxPointers: 1,\r\n                    onPointer: function(event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                            update();\r\n                        }\r\n                    }\r\n                });\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            fa = nob(parseInt('' + (displayW / 6)), parseInt('' + (displayH / 2)));\r\n            fb = nob(parseInt('' + (displayW - displayW / 6)), parseInt('' + (displayH - displayH / 3)));\r\n\r\n            let blurSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-blur'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                value: blur,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    blur = val;\r\n                    update();\r\n                },\r\n            });\r\n            blurSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(blurSlider.getElement());\r\n            let gradientSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-gradient'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1000,\r\n                value: gradient,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    gradient = val;\r\n                    update();\r\n                },\r\n            });\r\n            div.appendChild(gradientSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.appendChild(fa);\r\n            previewInnerWrapper.appendChild(fb);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n            update();\r\n            result.destroy = () => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                blurSlider.destroy();\r\n                gradientSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    a: {x: fa.x / displayPreviewFactor, y: fa.y / displayPreviewFactor},\r\n                    b: {x: fb.x / displayPreviewFactor, y: fb.y / displayPreviewFactor},\r\n                    blur: blur,\r\n                    gradient: gradient\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let a = params.input.a;\r\n        let b = params.input.b;\r\n        let blur = params.input.blur;\r\n        let gradient = params.input.gradient;\r\n        if (!context || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).tiltShift(a.x, a.y, b.x, b.y, blur, gradient).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"tiltShift\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {FreeTransform, ITransform} from '../ui/components/free-transform';\r\nimport {Select} from '../ui/base-components/select';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {IRect} from '../../bb/bb.types';\r\n\r\ninterface IFilterTransformInput {\r\n    bounds: {x: number, y: number, width: number, height: number};\r\n    transform: ITransform;\r\n    isPixelated: boolean;\r\n}\r\n\r\nexport const filterTransform = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let isSmall = window.innerWidth < 550;\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n        let freeTransform: FreeTransform;\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        // determine bounds and initial transformation\r\n        const boundsObj: IRect = BB.canvasBounds(context);\r\n        if (boundsObj === null) {\r\n            alert(LANG('filter-transform-empty'));\r\n            return false;\r\n        }\r\n        const initTransform = {\r\n            x: boundsObj.x + boundsObj.width / 2,\r\n            y: boundsObj.y + boundsObj.height / 2,\r\n            width: boundsObj.width,\r\n            height: boundsObj.height,\r\n            angleDeg: 0,\r\n        };\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        div.innerHTML = LANG('filter-transform-description');\r\n\r\n        let keyListener = new BB.KeyListener({\r\n            onDown: function(keyStr) {\r\n                if (BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n\r\n                if (keyStr === 'left') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'right') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'up') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'down') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n            }\r\n\r\n        });\r\n\r\n        let leftWrapper = document.createElement(\"div\");\r\n        let rightWrapper = document.createElement(\"div\");\r\n        let rotWrapper = document.createElement(\"div\");\r\n        let inputY = document.createElement(\"input\");\r\n        let inputX = document.createElement(\"input\");\r\n        let inputR = document.createElement(\"input\");\r\n        leftWrapper.style.width = \"100px\";\r\n        leftWrapper.style.height = \"30px\";\r\n        rightWrapper.style.width = \"100px\";\r\n        rightWrapper.style.height = \"30px\";\r\n        rightWrapper.style.display = \"inline-block\";\r\n        leftWrapper.style.display = \"inline-block\";\r\n        rotWrapper.style.display = \"inline-block\";\r\n        rotWrapper.style.width = \"150px\";\r\n        rotWrapper.style.height = \"30px\";\r\n        inputY.type = \"number\";\r\n        inputX.type = \"number\";\r\n        inputR.type = \"number\";\r\n        inputX.style.width = 70 + \"px\";\r\n        inputY.style.width = 70 + \"px\";\r\n        inputR.style.width = 70 + \"px\";\r\n        inputY.value = '0';\r\n        inputX.value = '0';\r\n        inputR.value = '0';\r\n        inputY.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputX.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputR.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputY.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputY.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        leftWrapper.append(\"X: \", inputX);\r\n        rightWrapper.append(\"Y: \", inputY);\r\n        rotWrapper.append(LANG('filter-transform-rotation') + ': ', inputR);\r\n        if (!isSmall) {\r\n            const inputRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\r\n        }\r\n\r\n        // buttons\r\n        const actionBtnCss = {\r\n            marginLeft: '10px',\r\n            marginTop: '10px',\r\n        };\r\n        const buttonRow = BB.el ({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginLeft: '-10px',\r\n            }\r\n        });\r\n        const flipXBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' X',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(-t.width, t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const flipYBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' Y',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(t.width, -t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotLeftBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '-90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg -= 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotRightBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '+90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg += 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleDoubleBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                if (constrainCheckbox.getValue()) {\r\n                    freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\r\n                } else {\r\n                    freeTransform.setSize(t.width * 2, t.height * 2);\r\n                }\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleHalfBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '1/2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const centerBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('center'),\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setPos({ x: context.canvas.width / 2, y: context.canvas.height / 2 });\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n\r\n\r\n\r\n\r\n\r\n        let isConstrained = true;\r\n        let constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-constrain'),\r\n            title: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isConstrained = b;\r\n                freeTransform.setConstrained(isConstrained);\r\n            },\r\n            css: {\r\n                display: 'inline-block'\r\n            }\r\n        });\r\n        let isSnapping = false;\r\n        let snappingCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-snap'),\r\n            title: LANG('filter-transform-snap-title'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isSnapping = b;\r\n                freeTransform.setSnapping(isSnapping);\r\n            },\r\n            css: {\r\n                display: 'inline-block',\r\n                marginLeft: '10px',\r\n            }\r\n        });\r\n        const checkboxWrapper = BB.el({});\r\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\r\n\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n                height: '10px'\r\n            }\r\n        }));\r\n\r\n        const bottomRow = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n            }\r\n        });\r\n\r\n        let algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')]\r\n            ],\r\n            initValue: 'smooth',\r\n            title: LANG('scaling-algorithm'),\r\n            onChange: function() {\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        BB.css(previewWrapper, {\r\n            width: isSmall ? '340px' : '540px',\r\n            marginLeft: \"-20px\",\r\n            height: isSmall ? '260px' : '300px',\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayerArr: IKlBasicLayer[] = [];\r\n        {\r\n            for (let i = 0; i < layers.length; i++) {\r\n                let canvas;\r\n                if (i === selectedLayerIndex) {\r\n                    canvas = BB.canvas(parseInt('' + w), parseInt('' + h));\r\n                    let ctx = canvas.getContext('2d');\r\n                    ctx.drawImage(layers[i].context.canvas, 0, 0, canvas.width, canvas.height);\r\n                } else {\r\n                    canvas = layers[i].context.canvas;\r\n                }\r\n                previewLayerArr.push({\r\n                    image: canvas,\r\n                    opacity: layers[i].opacity,\r\n                    mixModeStr: layers[i].mixModeStr\r\n                });\r\n            }\r\n        }\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: parseInt('' + displayW),\r\n            height: parseInt('' + displayH),\r\n            layers: previewLayerArr\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + displayW) + 'px',\r\n                height: parseInt('' + displayH) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        let lastDrawnTransformStr;\r\n        function updatePreview(doForce: boolean = false) {\r\n            if (!freeTransform) {\r\n                return;\r\n            }\r\n            let transform = freeTransform.getTransform();\r\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) {\r\n                return;\r\n            }\r\n            lastDrawnTransformStr = JSON.stringify(transform);\r\n            if (displayPreviewFactor < 1) {\r\n                transform.x *= displayPreviewFactor;\r\n                transform.y *= displayPreviewFactor;\r\n                transform.width *= displayPreviewFactor;\r\n                transform.height *= displayPreviewFactor;\r\n            }\r\n            let transformLayerCanvas = previewLayerArr[selectedLayerIndex].image as HTMLCanvasElement;\r\n            let ctx = transformLayerCanvas.getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, transformLayerCanvas.width, transformLayerCanvas.height);\r\n            BB.drawTransformedImageWithBounds(\r\n                ctx,\r\n                layers[selectedLayerIndex].context.canvas,\r\n                transform,\r\n                boundsObj,\r\n                algorithmSelect.getValue() === 'pixelated' ||\r\n                BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            );\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: initTransform.angleDeg,\r\n            isConstrained: true,\r\n            snapX: [0, context.canvas.width],\r\n            snapY: [0, context.canvas.height],\r\n            callback: function (t) {\r\n                inputX.value = '' + Math.round(t.x - initTransform.x);\r\n                inputY.value = '' + Math.round(t.y - initTransform.y);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            scale: displayPreviewFactor\r\n        });\r\n        BB.css(freeTransform.getElement(), {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0'\r\n        });\r\n        previewInnerWrapper.appendChild(freeTransform.getElement());\r\n\r\n        function onInputsChanged() {\r\n            freeTransform.setPos({\r\n                x: parseInt(inputX.value) + initTransform.x,\r\n                y: parseInt(inputY.value) + initTransform.y}\r\n            );\r\n            freeTransform.setAngleDeg(parseInt(inputR.value));\r\n            updatePreview();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            keyListener.destroy();\r\n            freeTransform.destroy();\r\n            constrainCheckbox.destroy();\r\n            snappingCheckbox.destroy();\r\n            BB.destroyEl(flipXBtn);\r\n            BB.destroyEl(flipYBtn);\r\n            BB.destroyEl(scaleRotLeftBtn);\r\n            BB.destroyEl(scaleRotRightBtn);\r\n            BB.destroyEl(scaleDoubleBtn);\r\n            BB.destroyEl(scaleHalfBtn);\r\n            BB.destroyEl(centerBtn);\r\n        };\r\n        result.getInput = function () {\r\n            const transform = freeTransform.getTransform();\r\n            let input = {\r\n                transform,\r\n                bounds: boundsObj,\r\n                isPixelated: algorithmSelect.getValue() === 'pixelated' ||\r\n                    BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            } as IFilterTransformInput;\r\n            result.destroy();\r\n            return JSON.parse(JSON.stringify(input));\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const input: IFilterTransformInput = params.input;\r\n\r\n        let copyCanvas = BB.copyCanvas(context.canvas);\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            context,\r\n            copyCanvas,\r\n            input.transform,\r\n            input.bounds,\r\n            input.isPixelated,\r\n        );\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"transform\"],\r\n            action: \"apply\",\r\n            params: [{input}],\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterBlur = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let klCanvas = params.klCanvas;\r\n        let context = params.context;\r\n        if (!klCanvas || !context) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let previewFactor = w / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n\r\n        function finishInit() {\r\n            let radius = 10;\r\n            div.innerHTML = LANG('filter-triangle-blur-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 1,\r\n                max: 200,\r\n                value: radius,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    radius = val;\r\n                    glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            div.appendChild(radiusSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                texture.destroy();\r\n                radiusSlider.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let radius = params.input.radius;\r\n        if (!context || !radius || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).triangleBlur(radius).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"blur\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterUnsharpMask = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let previewFactor = w / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        function finishInit() {\r\n            let radius = 2, strength = 5.1 / 10;\r\n            div.innerHTML = LANG('filter-unsharp-mask-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                value: 2,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    radius = val;\r\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 50], [1, 200]],\r\n            });\r\n            let strengthSlider = new KlSlider({\r\n                label: LANG('filter-unsharp-mask-strength'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 50,\r\n                value: 5.1,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    strength = val / 10;\r\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 10], [1, 50]],\r\n            });\r\n            radiusSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(radiusSlider.getElement());\r\n            div.appendChild(strengthSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                radiusSlider.destroy();\r\n                strengthSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius,\r\n                    strength: strength\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let radius = params.input.radius;\r\n        let strength = params.input.strength;\r\n        if (!context || radius === null || strength === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).unsharpMask(radius, strength).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"unsharpMask\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const filterToAlpha = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        function finishInit() {\r\n            let radius = 2, strength = 5.1 / 10;\r\n            div.appendChild(BB.el({\r\n                content: LANG('filter-to-alpha-description'),\r\n                css: {\r\n                    marginBottom: '5px'\r\n                }\r\n            }));\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            function updatePreview() {\r\n                glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n                klCanvasPreview.render();\r\n            }\r\n\r\n            // source\r\n            let sourceId = 'inverted-luminance';\r\n            let sourceOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'inverted-luminance',\r\n                        label: LANG('filter-to-alpha-inverted-lum')\r\n                    },\r\n                    {\r\n                        id: 'luminance',\r\n                        label: LANG('filter-to-alpha-lum')\r\n                    }\r\n                ],\r\n                initialId: sourceId,\r\n                onChange: function(id) {\r\n                    sourceId = id;\r\n                    updatePreview();\r\n                }\r\n            });\r\n            div.appendChild(sourceOptions.getElement());\r\n\r\n            // color\r\n            let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n            let colorOptionsArr = [\r\n                null,\r\n                {r: 0, g: 0, b: 0, a: 1},\r\n                {r: 255, g: 255, b: 255, a: 1}\r\n            ];\r\n            colorOptionsArr.push({\r\n                r: params.currentColorRgb.r,\r\n                g: params.currentColorRgb.g,\r\n                b: params.currentColorRgb.b,\r\n                a: 1,\r\n            });\r\n            colorOptionsArr.push({\r\n                r: params.secondaryColorRgb.r,\r\n                g: params.secondaryColorRgb.g,\r\n                b: params.secondaryColorRgb.b,\r\n                a: 1,\r\n            });\r\n\r\n            let colorOptions = new ColorOptions({\r\n                label: LANG('filter-to-alpha-replace'),\r\n                colorArr: colorOptionsArr,\r\n                initialIndex: 1,\r\n                onChange: function(rgbaObj) {\r\n                    selectedRgbaObj = rgbaObj;\r\n                    updatePreview();\r\n                }\r\n            });\r\n            colorOptions.getElement().style.marginTop = '10px';\r\n            div.appendChild(colorOptions.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            setTimeout(function() { //ie has a problem otherwise...\r\n                try {\r\n                    updatePreview();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }, 1);\r\n\r\n            result.destroy = () => {\r\n                texture.destroy();\r\n                sourceOptions.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    sourceId: sourceId,\r\n                    selectedRgbaObj: selectedRgbaObj\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let sourceId = params.input.sourceId;\r\n        let selectedRgbaObj = params.input.selectedRgbaObj;\r\n        if (!context || !sourceId || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"toAlpha\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {input} from '../ui/base-components/input';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {drawGrid} from '../image-operations/draw-grid';\r\n\r\n\r\n\r\nexport const filterGrid = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        div.innerHTML = LANG('filter-grid-description') + \"<br/><br/>\";\r\n\r\n        const settingsObj = {\r\n            x: 2,\r\n            y: 2,\r\n            thickness: 2,\r\n            color: '#000',\r\n            opacity: 1,\r\n        };\r\n\r\n        let line1 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            }\r\n        });\r\n        let line2 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px'\r\n            }\r\n        });\r\n        const xInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.x = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const yInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.y = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const thicknessInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.thickness = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n        settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('shape-stroke'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function(rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            marginRight: '5px',\r\n        };\r\n        line1.append(\r\n            BB.el({content: 'X:', css: labelStyle}),\r\n            xInput,\r\n            BB.el({content: 'Y:', css: labelStyle}),\r\n            yInput,\r\n        );\r\n        line2.append(\r\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\r\n            thicknessInput,\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorOptions.getElement(),\r\n        );\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            })\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        function updatePreview() {\r\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n            drawGrid(ctx, settingsObj.x, settingsObj.y, Math.max(settingsObj.thickness * renderFactor, 1), settingsObj.color, settingsObj.opacity);\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        drawGrid(context, params.input.x, params.input.y, params.input.thickness, params.input.color, params.input.opacity);\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: [\"filter\", \"grid\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    },\r\n\r\n};","\r\n// ideas: padding, gutter, other shapes\r\n\r\nexport function drawGrid(\r\n    ctx: CanvasRenderingContext2D,\r\n    cellsX: number,\r\n    cellsY: number,\r\n    thickness: number, // px\r\n    color: string,\r\n    opacity: number, // 0 - 1\r\n) {\r\n    ctx.save();\r\n    const w = ctx.canvas.width;\r\n    const h = ctx.canvas.height;\r\n    thickness = Math.round(thickness);\r\n    const thickIsRound = thickness % 2 === 0;\r\n\r\n    ctx.beginPath();\r\n    ctx.lineWidth = thickness;\r\n    ctx.strokeStyle = color;\r\n    ctx.globalAlpha = opacity;\r\n\r\n    for(let i = 0; i < cellsX - 1; i++) {\r\n        const cw = w / (cellsX);\r\n        let pos = cw * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n        ctx.moveTo(pos, 0);\r\n        ctx.lineTo(pos, h);\r\n\r\n    }\r\n    for(let i = 0; i < cellsY - 1; i++) {\r\n        const ch = h / (cellsY);\r\n        let pos = ch * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n\r\n        ctx.moveTo(0, pos);\r\n        ctx.lineTo(w, pos);\r\n    }\r\n\r\n    ctx.stroke();\r\n    ctx.restore();\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode, IRGB} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {eventResMs} from './filters-consts';\r\nimport {Select} from '../ui/base-components/select';\r\nimport {translateBlending} from '../canvas/translate-blending';\r\nimport {KL} from '../kl';\r\nimport {ColorConverter} from '../../bb/color/color';\r\n// @ts-ignore\r\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\n\r\n// see noise(...) in glfx.ts\r\ninterface INoisePreset {\r\n    type: number;\r\n    scaleX: number;\r\n    scaleY: number;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    octaves: number;\r\n    samples: number;\r\n    peaks: number;\r\n    brightness: number;\r\n    contrast: number;\r\n    isReversed: boolean;\r\n}\r\n\r\ntype TNoiseChannels = 'rgb' | 'alpha';\r\n\r\ninterface INoiseSettings extends INoisePreset {\r\n    seed: number;\r\n    colA: IRGB;\r\n    colB: IRGB;\r\n    channels: TNoiseChannels;\r\n}\r\n\r\ninterface INoiseFilterInput {\r\n    seed: number;\r\n    presetIndex: number; // which preset from presetArr\r\n    scale: number; // applies to both scaleX and scaleX\r\n    opacity: number; // aka strength\r\n    isReversed: boolean; // reverse direction of color gradient\r\n    channels: TNoiseChannels;\r\n\r\n    // only for channels = rgb\r\n    mixModeStr: GlobalCompositeOperation; // how mixed with image\r\n    colA: IRGB;\r\n    colB: IRGB;\r\n}\r\n\r\nconst presetArr: INoisePreset[] = [\r\n    // each pixel random value\r\n    {type: 0, scaleX: 1, scaleY: 1, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: true},\r\n\r\n    // cloud\r\n    {type: 1, scaleX: 166, scaleY: 164, offsetX: 105, offsetY: 30, octaves: 6, samples: 1, peaks: 0, brightness: 0.055, contrast: 0.23, isReversed: true},\r\n\r\n    // thin lines\r\n    {type: 1, scaleX: 235, scaleY: 190, offsetX: 3227, offsetY: 2156, octaves: 4, samples: 16, peaks: 22, brightness: -0.375, contrast: 1, isReversed: false},\r\n\r\n    // soft large simplex, only 1 octave\r\n    {type: 1, scaleX: 40, scaleY: 40, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: false},\r\n\r\n    // two value large pixels\r\n    {type: 0, scaleX: 26, scaleY: 26, offsetX: 557, offsetY: 365, octaves: 1, samples: 1, peaks: 0, brightness: 0.02, contrast: 1, isReversed: true},\r\n\r\n    // zebra\r\n    {type: 1, scaleX: 1500, scaleY: 1500, offsetX: 745, offsetY: 2871, octaves: 5, samples: 16, peaks: 156.02, brightness: 0.03, contrast: 1, isReversed: true},\r\n\r\n    // sparse dots / stars\r\n    {type: 1, scaleX: 11, scaleY: 11, offsetX: 2940, offsetY: 2045, octaves: 1, samples: 16, peaks: 1, brightness: -0.045, contrast: 1, isReversed: true},\r\n\r\n    // pseudo marble\r\n    {type: 2, scaleX: 74, scaleY: 74, offsetX: 4816, offsetY: 1304, octaves: 3, samples: 1, peaks: 2.78, brightness: 0, contrast: 0, isReversed: false},\r\n];\r\n\r\nfunction drawNoise(glCanvas, settings: INoiseSettings): void {\r\n    glCanvas.noise(\r\n        settings.seed  ? settings.seed : 0,\r\n        settings.type,\r\n        [settings.scaleX, settings.scaleY],\r\n        [glCanvas.width / 2, glCanvas.height / 2],\r\n        settings.octaves,\r\n        settings.samples,\r\n        settings.peaks,\r\n        settings.brightness,\r\n        settings.contrast,\r\n        settings.isReversed,\r\n        settings.colA,\r\n        settings.colB,\r\n        settings.channels ? settings.channels : 'rgb',\r\n    ).update();\r\n}\r\n\r\n\r\nexport const filterNoise = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n\r\n\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return; // todo throw?\r\n        }\r\n        let texture;\r\n\r\n        const thumbImgArr = [];\r\n        const thumbSize = 32;\r\n        {\r\n            const canvas = BB.canvas(thumbSize, thumbSize);\r\n            const ctx = canvas.getContext('2d');\r\n            texture = glCanvas.texture(canvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n            texture.destroy();\r\n\r\n            presetArr.forEach((preset, index) => {\r\n                const thumbImg = new Image();\r\n                const presetCopy = BB.copyObj(preset);\r\n                presetCopy.scaleX /= 10;\r\n                presetCopy.scaleY /= 10;\r\n                drawNoise(glCanvas, presetCopy);\r\n                ctx.drawImage(glCanvas, 0, 0);\r\n                thumbImg.src = canvas.toDataURL('image/png');\r\n                thumbImgArr.push(thumbImg);\r\n            });\r\n\r\n        }\r\n\r\n        let tempCanvas = BB.canvas(renderW, renderH);\r\n        texture = glCanvas.texture(tempCanvas);\r\n        glCanvas.draw(texture).update(); // update glCanvas size\r\n        tempCanvas = null;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        div.innerHTML = LANG('filter-noise-description') + \"<br/><br/>\";\r\n\r\n        const settingsObj: INoiseFilterInput = {\r\n            seed: Math.random() * 300,\r\n            presetIndex: 0,\r\n            scale: 50,\r\n            opacity: 0.5,\r\n            isReversed: false,\r\n            channels: 'rgb',\r\n            mixModeStr: 'source-over' as GlobalCompositeOperation,\r\n            colA: {r: 0, g: 0, b: 0},\r\n            colB: {r: 255, g: 255, b: 255},\r\n        };\r\n\r\n\r\n        const presetOptions = new Options({\r\n            optionArr: thumbImgArr.map((img, index) => {\r\n                BB.css(img, {\r\n                    margin: '1px',\r\n                    borderRadius: '3px',\r\n                    transition: 'all 0.1s ease-in-out',\r\n                })\r\n                return {\r\n                    id: '' + index,\r\n                    label: img,\r\n                };\r\n            }),\r\n            initialId: '0',\r\n            onChange: (id) => {\r\n                settingsObj.presetIndex = Number(id);\r\n                updatePreview();\r\n            }\r\n        });\r\n        presetOptions.getElement().style.marginBottom = '10px';\r\n        div.append(presetOptions.getElement());\r\n\r\n        const scaleSlider = new KlSlider({\r\n            label: LANG('filter-noise-scale'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1,\r\n            max: 1000,\r\n            value: settingsObj.scale,\r\n            eventResMs: eventResMs,\r\n            curve: BB.quadraticSplineInput(1, 1000, 0.1),\r\n            onChange: (value) => {\r\n                settingsObj.scale = value;\r\n                updatePreview();\r\n            },\r\n        });\r\n        scaleSlider.getElement().style.marginBottom = \"10px\";\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: settingsObj.opacity,\r\n            eventResMs: eventResMs,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n            onChange: (value) => {\r\n                settingsObj.opacity = value;\r\n                updatePreview();\r\n            },\r\n        });\r\n        opacitySlider.getElement().style.marginBottom = \"10px\";\r\n\r\n        const row1El = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginBottom: '10px',\r\n            }\r\n        });\r\n\r\n        const row2El = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n\r\n        const channelsOptions = new Options({\r\n            optionArr: [\r\n                {id: 'rgb', label: 'RGB'},\r\n                {id: 'alpha', label: LANG('filter-noise-alpha')},\r\n            ],\r\n            initialId: 'rgb',\r\n            onChange: (id: TNoiseChannels) => {\r\n                settingsObj.channels = id;\r\n                if (id === 'rgb') {\r\n                    row2El.style.visibility = '';\r\n                } else {\r\n                    row2El.style.visibility = 'hidden';\r\n                }\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const reverseToggle = new Checkbox({\r\n            label: LANG('reverse'),\r\n            callback: (val) => {\r\n                settingsObj.isReversed = val;\r\n                updatePreview();\r\n            },\r\n            allowTab: true,\r\n        });\r\n\r\n        const blendSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                'source-over',\r\n                null,\r\n                'darken',\r\n                'multiply',\r\n                'color-burn',\r\n                null,\r\n                'lighten',\r\n                'screen',\r\n                'color-dodge',\r\n                null,\r\n                'overlay',\r\n                'soft-light',\r\n                'hard-light',\r\n                null,\r\n                'difference',\r\n                'exclusion',\r\n                null,\r\n                'hue',\r\n                'saturation',\r\n                'color',\r\n                'luminosity',\r\n            ].map((item: IMixMode) => {\r\n                return item ? [item, translateBlending(item)] : null;\r\n            }),\r\n            initValue: settingsObj.mixModeStr,\r\n            onChange: (val: GlobalCompositeOperation) => {\r\n                settingsObj.mixModeStr = val;\r\n                updatePreview();\r\n            },\r\n        });\r\n        blendSelect.getElement().title = LANG('layers-blending');\r\n\r\n        const colorWrapper = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n\r\n        const colInputStyle = {\r\n            width: '34px',\r\n            height: '34px',\r\n            marginRight: '5px',\r\n        }\r\n        const colAInput = KL.input({\r\n            type: 'color',\r\n            init: '#' + ColorConverter.toHexString(settingsObj.colA),\r\n            callback: (val) => {\r\n                settingsObj.colA = ColorConverter.hexToRGB(val);\r\n                updatePreview();\r\n            },\r\n            css: colInputStyle,\r\n        });\r\n\r\n        const colBInput = KL.input({\r\n            type: 'color',\r\n            init: '#' + ColorConverter.toHexString(settingsObj.colB),\r\n            callback: (val) => {\r\n                settingsObj.colB = ColorConverter.hexToRGB(val);\r\n                updatePreview();\r\n            },\r\n            css: colInputStyle,\r\n        });\r\n\r\n        colorWrapper.append(\r\n            colAInput,\r\n            colBInput,\r\n        );\r\n\r\n\r\n        row1El.append(\r\n            channelsOptions.getElement(),\r\n            BB.el({css:{flexGrow: '1',}}),\r\n            reverseToggle.getElement(),\r\n        );\r\n\r\n        row2El.append(\r\n            blendSelect.getElement(),\r\n            BB.el({css:{flexGrow: '1',}}),\r\n            colorWrapper,\r\n        );\r\n\r\n        div.append(\r\n            scaleSlider.getElement(),\r\n            opacitySlider.getElement(),\r\n            row1El,\r\n            row2El,\r\n        );\r\n\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            })\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        function updatePreview() {\r\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n\r\n            ctx.globalAlpha = settingsObj.opacity;\r\n\r\n            const presetCopy = BB.copyObj(presetArr[settingsObj.presetIndex]);\r\n            presetCopy.seed = settingsObj.seed;\r\n            presetCopy.scaleX = presetCopy.scaleX  * settingsObj.scale / 50 * renderFactor;\r\n            presetCopy.scaleY = presetCopy.scaleY  * settingsObj.scale / 50 * renderFactor;\r\n            presetCopy.colA = settingsObj.colA;\r\n            presetCopy.colB = settingsObj.colB;\r\n            presetCopy.isReversed = settingsObj.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\r\n            presetCopy.channels  = settingsObj.channels;\r\n            drawNoise(glCanvas, presetCopy);\r\n\r\n            if (settingsObj.channels === 'alpha') {\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n            } else {\r\n                ctx.globalCompositeOperation = settingsObj.mixModeStr;\r\n            }\r\n\r\n            ctx.drawImage(glCanvas, 0, 0);\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            presetOptions.destroy();\r\n            scaleSlider.destroy();\r\n            opacitySlider.destroy();\r\n            reverseToggle.destroy();\r\n            channelsOptions.destroy();\r\n            texture.destroy();\r\n            blendSelect.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).update();\r\n        texture.destroy();\r\n\r\n        const input: INoiseFilterInput = params.input;\r\n\r\n        const presetCopy = BB.copyObj(presetArr[input.presetIndex]);\r\n        presetCopy.seed = input.seed;\r\n        presetCopy.scaleX = presetCopy.scaleX  * input.scale / 50;\r\n        presetCopy.scaleY = presetCopy.scaleY  * input.scale / 50;\r\n        presetCopy.colA = input.colA;\r\n        presetCopy.colB = input.colB;\r\n        presetCopy.isReversed = input.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\r\n        presetCopy.channels  = input.channels;\r\n        drawNoise(glCanvas, presetCopy);\r\n\r\n        context.save();\r\n        context.globalAlpha = input.opacity;\r\n        if (input.channels === 'alpha') {\r\n            context.globalCompositeOperation = 'destination-out';\r\n        } else {\r\n            context.globalCompositeOperation = input.mixModeStr;\r\n        }\r\n        context.drawImage(glCanvas, 0, 0);\r\n        context.restore();\r\n\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [\r\n                klCanvas.getLayerIndex(context.canvas),\r\n                context.getImageData(0, 0, context.canvas.width, context.canvas.height),\r\n            ]\r\n        });\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl.types';\r\nimport {input} from '../ui/base-components/input';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {LANG} from '../../language/language';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {TwoTabs} from '../ui/components/two-tabs';\r\nimport {IVector2D} from '../../bb/bb.types';\r\n\r\n\r\ninterface IPatternSettings {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n    blend?: number; // [0, 1] - 1 will blend linearly across whole length\r\n    offsetX: number;\r\n    offsetY: number;\r\n}\r\n\r\n/**\r\n * Draws pattern onto context. Pattern generated from context.\r\n * Can use blending for smoother transition. Will use area outside of bounds for blending.\r\n *\r\n * @param context\r\n * @param settings\r\n */\r\nfunction drawPattern(context: CanvasRenderingContext2D, settings: IPatternSettings): void {\r\n\r\n    // keep bounds in center via offset\r\n    // because blending done towards bottom right\r\n    const blendOffsetX = settings.blend ? Math.round(settings.blend * settings.width / 2) : 0;\r\n    const blendOffsetY = settings.blend ? Math.round(settings.blend * settings.height / 2) : 0;\r\n\r\n    const finalPatternCanvas = BB.canvas(settings.width, settings.height);\r\n\r\n    if (settings.blend) {\r\n        // construct pattern via linear blending\r\n\r\n        const blendCanvas = BB.canvas(settings.width * 2, settings.height * 2);\r\n        const blendCtx = blendCanvas.getContext('2d');\r\n        const colTransparent = '#0000';\r\n        const colOpaque = '#000';\r\n\r\n        // transfer source to blendCanvas\r\n        blendCtx.drawImage(\r\n            context.canvas,\r\n            -settings.x + blendOffsetX,\r\n            -settings.y + blendOffsetY,\r\n        );\r\n\r\n        // --- 1 cross-fade vertical ------------------------\r\n\r\n        // erase vertical gradient bottom half\r\n        blendCtx.save();\r\n        let blendGradient = blendCtx.createLinearGradient(0, settings.height, 0, settings.height * 2);\r\n        blendGradient.addColorStop(0, colOpaque);\r\n        blendGradient.addColorStop(settings.blend, colTransparent);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\r\n        blendCtx.restore();\r\n\r\n        // erase vertical gradient top half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(0, 0, 0, settings.height);\r\n        blendGradient.addColorStop(0, colTransparent);\r\n        blendGradient.addColorStop(settings.blend, colOpaque);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\r\n        blendCtx.restore();\r\n\r\n        // draw bottom half over top half\r\n        blendCtx.save();\r\n        // lighter needed for accurate cross-fade\r\n        blendCtx.globalCompositeOperation = 'lighter';\r\n        blendCtx.drawImage(blendCanvas, 0, -settings.height);\r\n        blendCtx.restore();\r\n\r\n\r\n\r\n        // --- 2 cross-fade horizontal ------------------------\r\n\r\n        // erase horizontal gradient right half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(settings.width, 0, settings.width * 2, 0);\r\n        blendGradient.addColorStop(0, colOpaque);\r\n        blendGradient.addColorStop(settings.blend, colTransparent);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\r\n        blendCtx.restore();\r\n\r\n        // erase horizontal gradient left half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(0, 0, settings.width, 0);\r\n        blendGradient.addColorStop(0, colTransparent);\r\n        blendGradient.addColorStop(settings.blend, colOpaque);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\r\n        blendCtx.restore();\r\n\r\n        // draw right half over left half\r\n        blendCtx.save();\r\n        // lighter needed for accurate cross-fade\r\n        blendCtx.globalCompositeOperation = 'lighter';\r\n        blendCtx.drawImage(blendCanvas, -settings.width, 0);\r\n        blendCtx.restore();\r\n\r\n        // transfer to pattern canvas\r\n        finalPatternCanvas.getContext('2d').drawImage(blendCanvas, 0, 0);\r\n\r\n    } else {\r\n        finalPatternCanvas.getContext('2d').drawImage(\r\n            context.canvas,\r\n            -settings.x,\r\n            -settings.y,\r\n        );\r\n    }\r\n\r\n    context.save();\r\n\r\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n    context.translate(settings.offsetX - blendOffsetX, settings.offsetY - blendOffsetY);\r\n    context.fillStyle = context.createPattern(finalPatternCanvas, 'repeat');\r\n    context.fillRect(-settings.offsetX + blendOffsetX, -settings.offsetY + blendOffsetY, context.canvas.width, context.canvas.height);\r\n\r\n    context.restore();\r\n}\r\n\r\n\r\nexport const filterPattern = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const maxSize = 1024;\r\n        const rootEl = BB.el({\r\n            content: LANG('filter-pattern-description') + '<br><br>',\r\n        });\r\n        const context = params.context;\r\n        const width = context.canvas.width;\r\n        const height = context.canvas.height;\r\n\r\n        let settings: IPatternSettings = {\r\n            x: 0,\r\n            y: 0,\r\n            width: width <= 250 ? Math.round(width / 4) : 200,\r\n            height: height <= 250 ? Math.round(height / 4) : 200,\r\n            blend: 0,\r\n            offsetX: 0,\r\n            offsetY: 0,\r\n        };\r\n        let lastDrawnSettings = null;\r\n\r\n        // determine bounds\r\n        const bounds = BB.canvasBounds(context);\r\n        // adjust settings according to bounds\r\n        if ( // use layer bounds if:\r\n            bounds &&\r\n            (bounds.width <= maxSize && bounds.height <= maxSize) && // don't exceed max size\r\n            (bounds.width < width * 0.75 || bounds.height < height * 0.75) // aren't too large (heuristic)\r\n        ) {\r\n            settings.x = bounds.x;\r\n            settings.y = bounds.y;\r\n            settings.width = bounds.width;\r\n            settings.height = bounds.height;\r\n        } else { // otherwise use default size in center\r\n            settings.x = Math.round(width / 2 - settings.width / 2);\r\n            settings.y = Math.round(height / 2 - settings.height / 2);\r\n        }\r\n\r\n        // ---- controls ----\r\n\r\n        const xInput = input({\r\n            init: settings.x,\r\n            type: 'number',\r\n            min: 0,\r\n            max: width,\r\n            css: {width: '100%'},\r\n            callback: function(v) {\r\n                settings.x = Number(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const yInput = input({\r\n            init: settings.y,\r\n            type: 'number',\r\n            min: 0,\r\n            max: height,\r\n            css: {width: '100%'},\r\n            callback: function(v) {\r\n                settings.y = Number(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const widthInput = input({\r\n            init: settings.width,\r\n            type: 'number',\r\n            min: 1,\r\n            max: Math.min(maxSize, width),\r\n            css: {width: '100%'},\r\n            callback: function(v) {\r\n                settings.width = Number(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const heightInput = input({\r\n            init: settings.height,\r\n            type: 'number',\r\n            min: 1,\r\n            max: Math.min(maxSize, height),\r\n            css: {width: '100%'},\r\n            callback: function(v) {\r\n                settings.height = Number(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        const inputStyle = {\r\n            marginLeft: '5px',\r\n            flex: '1',\r\n        };\r\n        rootEl.append(\r\n            BB.el({\r\n               content: [\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           'X:',\r\n                           xInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           'Y:',\r\n                           yInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           LANG('width') + ':',\r\n                           widthInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           LANG('height') + ':',\r\n                           heightInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n               ],\r\n               css: {\r\n                   display: 'flex',\r\n                   marginLeft: '-5px',\r\n               }\r\n            }),\r\n        );\r\n\r\n\r\n        const blendSlider = new KlSlider({\r\n            label: LANG('brush-blending'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 0,\r\n            max: 1,\r\n            value: settings.blend,\r\n            eventResMs: eventResMs,\r\n            onChange: function (val) {\r\n                settings.blend = val;\r\n                updatePreview();\r\n            },\r\n            formatFunc: (val) => {\r\n                return BB.round(val, 2);\r\n            },\r\n            manualInputRoundDigits: 2,\r\n        });\r\n        BB.css(blendSlider.getElement(), {\r\n            margin: '10px 0',\r\n        })\r\n\r\n        rootEl.append(\r\n            blendSlider.getElement(),\r\n        );\r\n\r\n        // ---- preview tabs ----\r\n        let previewMode = 1; // 0 before, 1 after\r\n        const beforeAfterTabs = new TwoTabs({\r\n            left: LANG('compare-before'),\r\n            right: LANG('compare-after'),\r\n            init: previewMode,\r\n            onChange: (val) => {\r\n                previewMode = val;\r\n                overlayCanvas.style.display = val === 0 ? 'block' : 'none';\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        rootEl.append(beforeAfterTabs.getElement());\r\n\r\n        // ---- previews ----\r\n\r\n        const klCanvas = params.klCanvas;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const previewWrapper = BB.el({\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                marginLeft: \"-20px\",\r\n                height: isSmall ? '260px' : '300px',\r\n                backgroundColor: \"#9e9e9e\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            }\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const previewLayerArr = layers.map((item, i) => {\r\n            if (i === selectedLayerIndex) {\r\n                return previewLayer;\r\n            } else {\r\n                return {\r\n                    image: item.context.canvas,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                };\r\n            }\r\n        });\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const overlayCanvas = BB.canvas(w, h);\r\n        BB.css(overlayCanvas, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            mixBlendMode: 'difference',\r\n            imageRendering: 'pixelated',\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.append(\r\n            klCanvasPreview.getElement(),\r\n            overlayCanvas\r\n        );\r\n        previewWrapper.append(previewInnerWrapper);\r\n        rootEl.append(previewWrapper);\r\n\r\n\r\n        // ---- preview input processing ----\r\n        const inputs: {\r\n            start: IVector2D;\r\n            end: IVector2D;\r\n            oldSettings: IPatternSettings;\r\n            state: null | 'move' | 'select';\r\n        } = {\r\n            start: null,\r\n            end: null,\r\n            oldSettings: null,\r\n            state: null,\r\n        };\r\n\r\n        function syncInputs(): void {\r\n            xInput.value = '' + settings.x;\r\n            yInput.value = '' + settings.y;\r\n            widthInput.value = '' + settings.width;\r\n            heightInput.value = '' + settings.height;\r\n        }\r\n\r\n        const keyListener = new BB.KeyListener({\r\n        });\r\n\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        previewInnerWrapper.style.touchAction = 'none';\r\n        const pointerListener = new BB.PointerListener({\r\n            target: previewInnerWrapper,\r\n            onPointer: (event) => {\r\n                if (previewMode === 0) {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (!inputs.state) {\r\n                            inputs.oldSettings = BB.copyObj(settings);\r\n\r\n                            const x = event.relX / previewFactor;\r\n                            const y = event.relY / previewFactor;\r\n\r\n                            if (BB.isInsideRect(\r\n                                {x, y},\r\n                                {x: settings.x, y: settings.y, width: settings.width, height: settings.height},\r\n                            )) {\r\n                                inputs.state = 'move';\r\n                            } else {\r\n                                inputs.state = 'select';\r\n                            }\r\n                            inputs.start = {x, y};\r\n                        }\r\n                    } else if (event.type === 'pointermove') {\r\n\r\n                        const x = event.relX / previewFactor;\r\n                        const y = event.relY / previewFactor;\r\n\r\n                        if (inputs.state === 'select') {\r\n                            inputs.end = {x, y};\r\n\r\n                            const x1 = Math.max(0, Math.min(inputs.start.x, inputs.end.x));\r\n                            const y1 = Math.max(0, Math.min(inputs.start.y, inputs.end.y));\r\n                            const x2 = Math.min(width, Math.max(inputs.start.x, inputs.end.x));\r\n                            const y2 = Math.min(height, Math.max(inputs.start.y, inputs.end.y));\r\n\r\n                            settings.x = Math.floor(x1);\r\n                            settings.y = Math.floor(y1);\r\n                            settings.width = Math.min(maxSize, Math.ceil(x2 - settings.x));\r\n                            settings.height = Math.min(maxSize, Math.ceil(y2 - settings.y));\r\n\r\n                            if (keyListener.isPressed('shift')) {\r\n                                settings.width = Math.min(settings.width, settings.height);\r\n                                settings.height = Math.min(settings.width, settings.height);\r\n                            }\r\n\r\n                            if (settings.width === 0 || settings.height === 0) {\r\n                                settings = BB.copyObj(inputs.oldSettings);\r\n                            }\r\n\r\n                            syncInputs();\r\n                            updatePreview();\r\n                        } else if (inputs.state === 'move') {\r\n                            const dX = Math.round(x - inputs.start.x);\r\n                            const dY = Math.round(y - inputs.start.y);\r\n\r\n                            settings.x = BB.clamp(inputs.oldSettings.x + dX, 0, width - settings.width);\r\n                            settings.y = BB.clamp(inputs.oldSettings.y + dY, 0, height - settings.height);\r\n\r\n                            syncInputs();\r\n                            updatePreview();\r\n                        }\r\n                    } else if (event.type === 'pointerup') {\r\n                        if (inputs.state) {\r\n                            inputs.state = null;\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (!inputs.state) {\r\n                            inputs.state = 'move';\r\n                            inputs.oldSettings = BB.copyObj(settings);\r\n                            inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n                            inputs.end = null;\r\n                        }\r\n                    } else if (event.type === 'pointermove') {\r\n                        if (inputs.state) {\r\n                            inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n\r\n                            settings.offsetX = Math.round(inputs.end.x - inputs.start.x) + inputs.oldSettings.offsetX;\r\n                            settings.offsetY = Math.round(inputs.end.y - inputs.start.y) + inputs.oldSettings.offsetY;\r\n\r\n                            updatePreview();\r\n                        }\r\n                    } else if (event.type === 'pointerup') {\r\n                        if (inputs.state) {\r\n                            if (!inputs.end) {\r\n                                settings.offsetX = 0;\r\n                                settings.offsetY = 0;\r\n                                updatePreview();\r\n                            }\r\n                            inputs.state = null;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        // ---------- rendering ---------------------\r\n        const fullSizeCanvas = BB.canvas(width, height);\r\n        const fullSizeCtx = fullSizeCanvas.getContext('2d');\r\n\r\n        function sharpStrokeRect(\r\n            context: CanvasRenderingContext2D,\r\n            x: number,\r\n            y: number,\r\n            width: number,\r\n            height: number\r\n        ): void {\r\n            const drawX = Math.round(x + 0.5) - 0.5;\r\n            const drawY = Math.round(y + 0.5) - 0.5;\r\n            const drawWidth = Math.round(x + width - drawX);\r\n            const drawHeight = Math.round(y + height - drawY);\r\n            context.strokeRect(drawX, drawY, drawWidth, drawHeight);\r\n        }\r\n\r\n        function updatePreview(doForce?: boolean) {\r\n            if (!doForce && lastDrawnSettings && JSON.stringify(lastDrawnSettings) === JSON.stringify(settings)) {\r\n                return;\r\n            }\r\n\r\n            if (previewMode === 0) { // before\r\n                fullSizeCtx.clearRect(0, 0, width, height);\r\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\r\n\r\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\r\n                const previewCtx = previewCanvas.getContext('2d');\r\n                previewCtx.save();\r\n                previewCtx.clearRect(0, 0, renderW, renderH);\r\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\r\n                previewCtx.restore();\r\n\r\n                const pW = settings.width * previewFactor;\r\n                const pH = settings.height * previewFactor;\r\n\r\n                const overlayCtx = overlayCanvas.getContext('2d');\r\n                overlayCtx.save();\r\n                overlayCtx.clearRect(0, 0, w, h);\r\n                overlayCtx.strokeStyle = '#fff';\r\n                sharpStrokeRect(\r\n                    overlayCtx,\r\n                    settings.x * previewFactor,\r\n                    settings.y * previewFactor,\r\n                    pW,\r\n                    pH\r\n                );\r\n                if (settings.blend > 0.05) {\r\n                    overlayCtx.strokeStyle = '#f0f';\r\n                    sharpStrokeRect(\r\n                        overlayCtx,\r\n                        settings.x * previewFactor - pW / 2 * settings.blend,\r\n                        settings.y * previewFactor - pH / 2 * settings.blend,\r\n                        pW * (1 + settings.blend),\r\n                        pH * (1 + settings.blend),\r\n                    );\r\n                }\r\n                overlayCtx.restore();\r\n\r\n\r\n\r\n            } else { // after\r\n                fullSizeCtx.clearRect(0, 0, width, height);\r\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\r\n                drawPattern(fullSizeCtx, settings);\r\n\r\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\r\n                const previewCtx = previewCanvas.getContext('2d');\r\n                previewCtx.clearRect(0, 0, renderW, renderH);\r\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\r\n            }\r\n\r\n\r\n            klCanvasPreview.render();\r\n            lastDrawnSettings = BB.copyObj(settings);\r\n        }\r\n\r\n        updatePreview();\r\n\r\n\r\n        // ----- result -------------------\r\n        const result: IFilterGetDialogResult = {\r\n            element: rootEl,\r\n            destroy: () => {\r\n                blendSlider.destroy();\r\n                keyListener.destroy();\r\n                pointerListener.destroy();\r\n            },\r\n            getInput: () => BB.copyObj(settings),\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const klCanvas = params.klCanvas;\r\n        const ctx = params.context;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        drawPattern(ctx, params.input);\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"pattern\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl.types';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {LANG} from '../../language/language';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\n\r\n\r\n// see glfx distort\r\ninterface IDistortSettings {\r\n    stepSize: number; // [0, inf]\r\n    distortType: 0 | 1 | 2;\r\n    scale: { x: number; y: number };\r\n    strength: { x: number; y: number };\r\n    phase: { x: number; y: number };\r\n}\r\n\r\n\r\n\r\nexport const filterDistort = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const rootEl = BB.el({\r\n            content: LANG('filter-distort-description') + '<br><br>',\r\n        });\r\n        const context = params.context;\r\n        const width = context.canvas.width;\r\n        const height = context.canvas.height;\r\n\r\n        let isSynced = true;\r\n        let settings: IDistortSettings = {\r\n            distortType: 0,\r\n            scale: {x: 100, y: 100},\r\n            strength: {x: 20, y: 20},\r\n            phase: {x: 0, y: 0},\r\n            stepSize: 1,\r\n        };\r\n        // let lastDrawnSettings = null;\r\n\r\n        // ---- thumb -------\r\n        const thumbImgArr = [];\r\n        const thumbSize = 32;\r\n        {\r\n            const canvas = BB.canvas(thumbSize, thumbSize);\r\n            const ctx = canvas.getContext('2d');\r\n\r\n            ctx.beginPath();\r\n            ctx.arc(thumbSize / 2, thumbSize / 2, thumbSize / 2.5, 0, Math.PI * 2);\r\n            ctx.fill();\r\n\r\n            let gradient = ctx.createLinearGradient(0, 0, thumbSize, thumbSize);\r\n            gradient.addColorStop(0, '#00f');\r\n            gradient.addColorStop(0.5, '#f00');\r\n            gradient.addColorStop(1, '#fff');\r\n            ctx.fillStyle = gradient;\r\n            ctx.globalCompositeOperation = 'source-atop';\r\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\r\n\r\n            gradient = ctx.createLinearGradient(thumbSize, 0, 0, thumbSize);\r\n            gradient.addColorStop(0, '#000');\r\n            gradient.addColorStop(1, '#000');\r\n            ctx.fillStyle = gradient;\r\n            ctx.globalCompositeOperation = 'destination-atop';\r\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\r\n\r\n            const glCanvas = getSharedFx();\r\n            const texture = glCanvas.texture(canvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            const scaleFactor = 20;\r\n\r\n            [0, 1, 2].forEach(item => {\r\n                const thumbImg = new Image();\r\n                const settingsCopy = BB.copyObj(settings);\r\n                settingsCopy.distortType = item;\r\n                settingsCopy.scale.x /= scaleFactor;\r\n                settingsCopy.scale.y /= scaleFactor;\r\n                settingsCopy.strength.x /= scaleFactor;\r\n                settingsCopy.strength.y /= scaleFactor;\r\n                glCanvas.draw(texture).multiplyAlpha().distort(settingsCopy).unmultiplyAlpha().update();\r\n                ctx.clearRect(0, 0, thumbSize, thumbSize);\r\n                ctx.drawImage(glCanvas, 0, 0);\r\n                thumbImg.src = canvas.toDataURL('image/png');\r\n                thumbImgArr.push(thumbImg);\r\n            });\r\n\r\n            texture.destroy();\r\n        }\r\n\r\n\r\n        // ---- controls ----\r\n\r\n        const topRowEl = BB.el({\r\n            parent: rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            }\r\n        });\r\n\r\n        const typeOptions = new Options({\r\n            optionArr: thumbImgArr.map((img, index) => {\r\n                BB.css(img, {\r\n                    margin: '1px',\r\n                    borderRadius: '3px',\r\n                    transition: 'all 0.1s ease-in-out',\r\n                })\r\n                return {\r\n                    id: '' + index,\r\n                    label: img,\r\n                };\r\n            }),\r\n            initialId: '0',\r\n            onChange: (id) => {\r\n                settings.distortType = Number(id) as any;\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        function sync(from: 'x' | 'y') {\r\n            if (from === 'x') {\r\n                settings.scale.y = settings.scale.x;\r\n                settings.strength.y = settings.strength.x;\r\n                settings.phase.y = settings.phase.x;\r\n\r\n                sliderArr[3].setValue(settings.scale.y);\r\n                sliderArr[4].setValue(settings.strength.y);\r\n                sliderArr[5].setValue(settings.phase.y);\r\n            } else {\r\n                settings.scale.x = settings.scale.y;\r\n                settings.strength.x = settings.strength.y;\r\n                settings.phase.x = settings.phase.y;\r\n\r\n                sliderArr[0].setValue(settings.scale.x);\r\n                sliderArr[1].setValue(settings.strength.x);\r\n                sliderArr[2].setValue(settings.phase.x);\r\n            }\r\n            updatePreview();\r\n        }\r\n\r\n        const syncToggle = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-distort-sync-xy'),\r\n            callback: (val) => {\r\n                isSynced = val;\r\n                if (isSynced) {\r\n                    sync('x');\r\n                }\r\n            },\r\n        });\r\n\r\n        topRowEl.append(\r\n            typeOptions.getElement(),\r\n            BB.el({css: {flexGrow: '1'}}),\r\n            syncToggle.getElement(),\r\n        );\r\n\r\n        const xyRowEl = BB.el({\r\n            parent: rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n            }\r\n        });\r\n        const leftCol = BB.el({\r\n            parent: xyRowEl,\r\n            css: {\r\n                marginRight: '10px',\r\n            }\r\n        });\r\n        const rightCol = BB.el({parent: xyRowEl});\r\n\r\n        const sliderWidth = isSmall ? 300 : 245;\r\n        const sliderArr: KlSlider[] = [];\r\n\r\n        ['x', 'y'].forEach((item, index) => {\r\n            const targetEl = index === 0 ? leftCol : rightCol;\r\n\r\n            const scaleSlider = new KlSlider({\r\n                label: LANG('filter-noise-scale') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 1,\r\n                max: 1000,\r\n                curve: 'quadratic',\r\n                value: settings.scale[item],\r\n                eventResMs: eventResMs,\r\n                onChange: (val) => {\r\n                    settings.scale[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item as any);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                }\r\n            });\r\n            scaleSlider.getElement().style.marginTop = '20px';\r\n            targetEl.append(scaleSlider.getElement());\r\n\r\n            const strengthSlider = new KlSlider({\r\n                label: LANG('filter-unsharp-mask-strength') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                curve: 'quadratic',\r\n                value: settings.strength[item],\r\n                eventResMs: eventResMs,\r\n                onChange: (val) => {\r\n                    settings.strength[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item as any);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                }\r\n            });\r\n            strengthSlider.getElement().style.marginTop = '10px';\r\n            targetEl.append(strengthSlider.getElement());\r\n\r\n            const phaseSlider = new KlSlider({\r\n                label: LANG('filter-distort-phase') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: settings.phase[item],\r\n                manualInputRoundDigits: 2,\r\n                eventResMs: eventResMs,\r\n                formatFunc: (val) => BB.round(val, 2),\r\n                onChange: (val) => {\r\n                    settings.phase[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item as any);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                }\r\n            });\r\n            phaseSlider.getElement().style.marginTop = '10px';\r\n            targetEl.append(phaseSlider.getElement());\r\n\r\n            sliderArr.push(scaleSlider);\r\n            sliderArr.push(strengthSlider);\r\n            sliderArr.push(phaseSlider);\r\n        });\r\n\r\n        const stepSlider = new KlSlider({\r\n            label: LANG('filter-distort-stepsize'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1,\r\n            max: 300,\r\n            curve: 'quadratic',\r\n            value: settings.stepSize,\r\n            eventResMs: eventResMs,\r\n            onChange: (val) => {\r\n                settings.stepSize = Math.round(val);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        stepSlider.getElement().style.marginTop = '20px';\r\n        rootEl.append(stepSlider.getElement());\r\n\r\n\r\n        // ---- preview ----\r\n\r\n        const klCanvas = params.klCanvas;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const previewWrapper = BB.el({\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                marginLeft: \"-20px\",\r\n                height: isSmall ? '260px' : '300px',\r\n                backgroundColor: \"#9e9e9e\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n                marginTop: '10px',\r\n            }\r\n        });\r\n\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return; // todo throw?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: glCanvas,\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const previewLayerArr = layers.map((item, i) => {\r\n            if (i === selectedLayerIndex) {\r\n                return previewLayer;\r\n            } else {\r\n                return {\r\n                    image: item.context.canvas,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                };\r\n            }\r\n        });\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n        rootEl.append(previewWrapper);\r\n\r\n        // ---------- rendering ---------------------\r\n\r\n        function updatePreview() {\r\n            glCanvas.draw(texture).multiplyAlpha().distort(settings).unmultiplyAlpha().update();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n\r\n        // ----- result -------------------\r\n        const result: IFilterGetDialogResult = {\r\n            element: rootEl,\r\n            destroy: () => {\r\n                typeOptions.destroy();\r\n                sliderArr.forEach(item => item.destroy());\r\n                stepSlider.destroy();\r\n                syncToggle.destroy();\r\n                texture.destroy();\r\n            },\r\n            getInput: () => BB.copyObj(settings),\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const klCanvas = params.klCanvas;\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).multiplyAlpha().distort(params.input).unmultiplyAlpha().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"distort\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {input} from '../ui/base-components/input';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {drawVanishPoint} from \"../image-operations/draw-vanish-point\";\r\nimport {KlSlider} from \"../ui/base-components/kl-slider\";\r\nimport {eventResMs} from \"./filters-consts\";\r\nimport {IVector2D} from \"../../bb/bb.types\";\r\n\r\n\r\n\r\nexport const filterVanishPoint = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = klCanvas.getLayers();\r\n        let selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        div.innerHTML = LANG('filter-vanish-point-description') + \"<br/><br/>\";\r\n\r\n        const settingsObj = {\r\n            x: context.canvas.width / 2,\r\n            y: context.canvas.height / 2,\r\n            lines: 8,\r\n            thickness: 2,\r\n            color: {r: 0, g: 0, b: 0},\r\n            opacity: 1,\r\n        };\r\n\r\n        const linesSlider = new KlSlider({\r\n            label: LANG('filter-vanish-point-lines'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 2,\r\n            max: 20,\r\n            value: settingsObj.lines,\r\n            curve: 'quadratic',\r\n            eventResMs: eventResMs,\r\n            onChange: function (val) {\r\n                settingsObj.lines = Math.round(val);\r\n                updatePreview();\r\n            },\r\n        });\r\n        linesSlider.getElement().style.marginBottom = '10px';\r\n        div.append(linesSlider.getElement());\r\n\r\n        let line1 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            }\r\n        });\r\n        let line2 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px'\r\n            }\r\n        });\r\n        const xInput = input({\r\n            init: settingsObj.x,\r\n            type: 'number',\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.x = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const yInput = input({\r\n            init: settingsObj.y,\r\n            type: 'number',\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.y = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const thicknessInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.thickness = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n        settingsObj.color = BB.copyObj(selectedRgbaObj);\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('shape-stroke'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function(rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                settingsObj.color = BB.copyObj(selectedRgbaObj);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            marginRight: '5px',\r\n        };\r\n        line1.append(\r\n            BB.el({content: 'X:', css: labelStyle}),\r\n            xInput,\r\n            BB.el({content: 'Y:', css: labelStyle}),\r\n            yInput,\r\n        );\r\n        line2.append(\r\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\r\n            thicknessInput,\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorOptions.getElement(),\r\n        );\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            })\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n                cursor: 'move',\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n\r\n        // ---- preview input processing ----\r\n        const inputs: {\r\n            start: IVector2D;\r\n            end: IVector2D;\r\n            state: null | 'move';\r\n            oldSettings: any;\r\n        } = {\r\n            start: null,\r\n            end: null,\r\n            state: null,\r\n            oldSettings: null,\r\n        };\r\n        function syncInputs(): void {\r\n            xInput.value = '' + settingsObj.x;\r\n            yInput.value = '' + settingsObj.y;\r\n        }\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        previewInnerWrapper.style.touchAction = 'none';\r\n        const pointerListener = new BB.PointerListener({\r\n            target: previewInnerWrapper,\r\n            onPointer: (event) => {\r\n                if (event.type === 'pointerdown') {\r\n                    if (!inputs.state) {\r\n                        inputs.state = 'move';\r\n                        inputs.oldSettings = BB.copyObj(settingsObj);\r\n                        inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n                        inputs.end = null;\r\n                    }\r\n                } else if (event.type === 'pointermove') {\r\n                    if (inputs.state) {\r\n                        inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n\r\n                        settingsObj.x = Math.round(inputs.end.x - inputs.start.x + inputs.oldSettings.x);\r\n                        settingsObj.y = Math.round(inputs.end.y - inputs.start.y + inputs.oldSettings.y);\r\n\r\n                        syncInputs();\r\n                        updatePreview();\r\n                    }\r\n                } else if (event.type === 'pointerup') {\r\n                    if (inputs.state) {\r\n                        inputs.state = null;\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n\r\n        function updatePreview() {\r\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n            drawVanishPoint(\r\n                ctx,\r\n                settingsObj.x * renderFactor,\r\n                settingsObj.y * renderFactor,\r\n                settingsObj.lines,\r\n                Math.max(settingsObj.thickness * renderFactor, 1),\r\n                settingsObj.color,\r\n                settingsObj.opacity,\r\n            );\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            linesSlider.destroy();\r\n            pointerListener.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let klCanvas = params.klCanvas;\r\n        let history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        drawVanishPoint(\r\n            context,\r\n            params.input.x,\r\n            params.input.y,\r\n            params.input.lines,\r\n            params.input.thickness,\r\n            params.input.color,\r\n            params.input.opacity\r\n        );\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: [\"filter\", \"vanishPoint\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    },\r\n\r\n};","import {drawShape} from \"./shape-tool\";\r\nimport {BB} from \"../../bb/bb\";\r\nimport {IRGB} from \"../kl.types\";\r\n\r\nexport function drawVanishPoint(\r\n    ctx: CanvasRenderingContext2D,\r\n    x: number,\r\n    y: number,\r\n    lines: number, // int, [2, inf]\r\n    thickness: number, // px\r\n    color: IRGB,\r\n    opacity: number, // 0 - 1\r\n): void {\r\n    ctx.save();\r\n\r\n    const degIncrement = 180 / lines;\r\n    for (let deg = 0; deg < 180; deg += degIncrement) {\r\n        const p2 = BB.rotateAround({x, y}, {x: x + 9999, y}, deg);\r\n        drawShape(\r\n            ctx,\r\n            {\r\n                type: 'line',\r\n                x1: x,\r\n                y1: y,\r\n                x2: p2.x,\r\n                y2: p2.y,\r\n                //angleRad: 0,\r\n                isOutwards: true,\r\n                opacity,\r\n                //isEraser: false,\r\n                strokeRgb: color,\r\n                lineWidth: thickness,\r\n                //doLockAlpha: false,\r\n            }\r\n        );\r\n    }\r\n\r\n    ctx.restore();\r\n}","import {KL} from '../kl';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\n\r\nexport async function klCanvasToPsdBlob(klCanvas: KlCanvas): Promise<Blob> {\r\n    let layerArr = klCanvas.getLayersFast();\r\n\r\n    let psdConfig = {\r\n        width: klCanvas.getWidth(),\r\n        height: klCanvas.getHeight(),\r\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\r\n        children: []\r\n    };\r\n    for (let i = 0; i < layerArr.length; i++) {\r\n        // todo - can be optimized if layer mostly empty\r\n        let item = layerArr[i];\r\n        psdConfig.children.push({\r\n            name: item.name,\r\n            opacity: item.opacity,\r\n            canvas: item.canvas,\r\n            blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n            left: 0,\r\n            top: 0\r\n        });\r\n    }\r\n\r\n    let agPsd = await import('ag-psd');\r\n    let buffer = agPsd.writePsdBuffer(psdConfig);\r\n    return new Blob([buffer], { type: 'application/octet-stream' });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"k9Nks\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"bBxqy\");"],"names":["$3kC7t","parcelRequire","$d2fa9a947070c225$export$a84540bc8b694b2d","p","klApp","agPsd","onProjectReady","project","isInitialized","Error","saveReminder","$5ngYX","SaveReminder","$gWfkn","klHistory","isDrawing","$3C7jC","KlApp","bottomBar","aboutEl","embed","url","embedUrl","onSubmit","init","loadingScreenEl","parentNode","removeChild","loadingScreenTextEl","document","body","appendChild","getEl","e","textContent","className","console","error","psdQueue","getElementById","$1mH1z","LANG","this","openProject","initError","getPNG","getPSD","default","$parcel$interopDefault","$cijLd","mark","_callee","readPSDs","psds","length","readItem","item","psd","readPsd","blob","$941rU","klPsdToKlProject","callback","forEach","_ctx","sent","shift","push","Element","prototype","Object","defineProperty","value","x","y","scrollLeft","scrollTop","window","getItem","setItem","removeItem","t","Array","slice","call","arguments","n","createDocumentFragment","Node","createTextNode","String","Document","DocumentFragment","hasOwnProperty","configurable","enumerable","writable","insertBefore","firstChild","padStart","repeat","findIndex","r","TypeError","o","i","$cf5d938ee512ebca$export$96f6458b62e4c2c","pProject","pOptions","ref","translateSmoothing","s","sizeWatcher","val","brushSettingService","emitSize","klCanvasWorkspace","setCursorSize","importFinishedLoading","importedImage","filename","optionStr","getResizedDimensions","width","height","w","parseInt","h","klMaxCanvasSize","importAsImage","canvas","resizedDimensions","tempCanvas","$eWjiX","BB","getContext","drawImage","resizeCanvas","reset","image","layerName","layerManager","update","setCurrentLayer","klCanvas","getLayer","resetView","handUi","getScale","getAngleDeg","importAsImagePsd","convertedPsdObj","cropObj","crop","targetCanvas","cropCanvas","layers","layerIndex","i1","item1","KL","showImportAsLayerDialog","klRootEl","transformObj","isPixelated","pause","addLayer","getLayers","renameLayer","activeLayerIndex","activeLayerContext","getLayerContext","drawTransformedImageWithBounds","tool","action","params","copyCanvas","isNaN","popup","type","message","buttons","$hrnUX","showImportImageDialog","target","maxSize","res","importAsLayer","files","showWarningPsdFlattened","file","name","split","extension","toLowerCase","f","size","loaderIsOpen","result","closeLoader","FileReader","readerResult","loadAgPsd","then","agPsdLazy","doShowLoader","maxResolution","replace","convertedPsd","PSD","skipLayerImageData","skipThumbnail","e1","catch","alert","match","URL","webkitURL","createObjectURL","im","Image","src","loadImage","hasUnsupportedFile","collapseThreshold","getElement","style","display","setDirection","uiState","isOpen","css","toolspaceCollapser","left","right","setSize","Math","max","uiWidth","toolWidth","uiHeight","setWide","statusOverlay","toolspace","borderLeft","borderRight","setUiState","updateCollapse","toolspaceScroller","updateUiState","layer","currentLayerCtx","context","currentBrush","setContext","layerPreview","setLayer","newImageDialog","currentColor","klColorSlider","getSecondaryRGB","getWidth","getHeight","innerWidth","color","a","onCancel","shareImage","shareCanvas","getCompleteCanvas","fileName","getDate","filenameBase","title","mainTabRow","activeStr","toolspaceToolRow","getActive","oldTabId","getOpenedTabId","keysArr","keys","draw","hand","gradient","text","shape","setIsVisible","open","showCrop","clipboardDialog","inputObj","top","bottom","filterLib","cropExtend","apply","input","history","updateBottomBar","isVisible","innerHeight","toolspaceInner","scrollHeight","bottomBarWrapper","min","screen","$6l0gQ","LocalStorage","app","projectStore","createElement","exportType","KlCanvas","projectObj","setHistory","layerFill","b","initState","copy","focus","getLayerCount","brushes","destroy","currentBrushId","lastNonEraserBrushId","RGB","BrushSettingService","setColor","copyObj","opacity","setOpacity","getColor","brushUiObj","getSize","getOpacity","sizeSlider","brushesUI","opacitySlider","lineSmoothing","EventChain","LineSmoothing","smoothing","LineSanitizer","lineSanitizer","setChainOut","event","pointerEvents","startLine","pressure","requestFrame","goLine","isCoalesced","setLastDrawEvent","endLine","getBrush","drawLineSegment","x0","y0","x1","y1","textToolSettings","align","isBold","isItalic","KlCanvasWorkspace","drawEventChain","chainIn","rgbObj","isDragDone","pickingDone","setMode","canvasX","canvasY","getLayerIndex","floodFill","fillUi","getIsEraser","getTolerance","getSample","getGrow","getContiguous","typeStr","angleRad","gradientTool","onDown","onMove","onUp","dialogCounter","get","textToolDialog","font","colorRGBA","textStr","ColorConverter","toRgbaStr","shapeTool","viewChangeObj","changed","includes","out","scale","angleDeg","angle","PI","setEnableZoomIn","getMaxScale","setEnableZoomOut","getMinScale","canUndo","undoRedoCatchup","undo","canRedo","redo","KeyListener","keyStr","comboStr","isInputFocused","getIsDrawing","zoomByStep","keyListener","isPressed","fitView","preventDefault","sameKeys","prev","next","store","getProject","t0","stop","copyToClipboard","comboOnlyContains","translateView","setAngle","decreaseSize","increaseSize","eraserBrush","getIsTransparentBg","clearLayer","g","setActive","updateMainTabVisibility","brushTabRow","prevMode","getMode","keyArr","filter","getNextBrushId","newMode","swapColors","KlImageDropper","onDrop","handleFileSelect","enabledTest","addEventListener","pasteEvent","clipboardData","undefined","items","indexOf","getAsFile","retrieveImageFromClipboardAsBlob","imageBlob","img","onload","revokeObjectURL","URLObj","getAsString","pasteStr","trim","onerror","log","crossOrigin","hexToRGB","b1","Ui","onOpacityChange","emitOpacity","onConfigChange","emitSliderConfig","ui","padding","position","StatusOverlay","el","oncontextmenu","onclick","handleClick","overlayToolspace","ToolspaceCollapser","setTimeout","OverlayToolspace","append","toolspaceTopRow","$85H3x","ToolspaceTopRow","showIframePopup","wrap","abrupt","parent","overlay","_ref","updateUi","logoImg","onLogo","$5ebUJ","onNew","showNewImageDialog","onImport","fileTab","triggerImport","onSave","saveToComputer","save","onShare","classList","add","marginBottom","ToolspaceToolRow","onZoomIn","onZoomOut","onUndo","onRedo","setIsSmall","addListener","setEnableUndo","setEnableRedo","KlColorSlider","onPick","p_color","emitColor","setHeight","setPickCallback","doPick","brushDiv","colorDiv","flexWrap","justifyContent","alignItems","toolspaceStabilizerRow","ToolspaceStabilizerRow","onSelect","v","setSmoothing","getOutputElement","TabRow","tooltip","brushId","enable","onClose","createTab","b2","HandUi","onFit","onAngleChange","isRelative","FillUi","colorSlider","gradientUi","GradientUi","TextUi","ShapeUi","GradientTool","isDone","x2","y2","settings","getSettings","gradientObj","color1","isReversed","doLockAlpha","isEraser","doSnap","setComposite","drawGradient","ctx","ShapeTool","shapeObj","shapeUi","getShape","isOutwards","getIsOutwards","getDoLockAlpha","strokeRgb","lineWidth","getLineWidth","isAngleSnap","getIsSnap","isFixedRatio","getIsFixed","fillRgb","drawShape","klLayerManager","LayerPreview","onClick","filterTab","FilterTab","UndoRedoCatchup","clctx","catchup","SaveToComputer","FileTab","imgurUpload","imgurKey","SettingsTab","$fxAg2","onOpen","minWidth","$2dTGs","$fuF9j","$3N9oF","$adBnR","textUi","$cafM1","$23J3k","show","hide","id","$eIlXd","settingsTab","MutationObserver","observe","attributes","childList","subtree","ToolspaceScroller","resize","scrollY","scrollTo","$3WOmu","klCanvasToPsdBlob","swapUiLeftRight","saveAsPsd","_this","zIndex","userSelect","ResizeObserver","windowResizeWatcher","$iUR3L","importFilters","$9cbe98d1fb398012$export$6e4a713ddcda1e5e","$dAXbp","$3P46L","$7pyBK","$705qg","drawProject","$aSJRf","WorkspaceSvgOverlay","$7bo3M","$lV6Vy","KlCanvasPreview","$i5nyl","filterLibStatus","$kyVjY","$6rdi0","renderText","$h20yl","floodFillBits","$30Cml","$3ujzu","$7EG77","setDbName","$9BlwZ","indexedDb","ProjectStore","$6mTnI","$lkluh","$eyygR","calcSliderFalloffFactor","$l4PqG","Checkbox","$lXqiv","$c4LUw","Select","$21VAD","ImageToggle","$jKOQl","ImageRadioList","$gmlbk","RadioList","$bHZQg","penPressureToggle","$fCJWy","KlSlider","$llzZ0","HexColorDialog","$lfHl9","$h7i9r","KlSmallColorSlider","$kzhsD","PointSlider","$bd9hB","ColorOptions","$9A7OD","Options","$iskOY","BoxToggle","$iDHln","$bmB93","CropCopy","$hRdOL","FreeTransform","$cNhNm","FreeTransformCanvas","$kEeSq","Cropper","$32CBv","$kqmpc","FittedImage","$j1kEL","$13r5y","$9p4Zp","$8jqzp","ToolDropdown","$84zxV","$9Kxky","$1Ax5m","$e4sAN","$1uc3b","BrowserStorageUi","$9pcu9","$iVHpg","$i8UFO","$ekHRj","Popup","exportDialog","$auloj","$isYih","$8ebuX","$76Qvv","$keKW3","$kDGzx","$5ENro","$khi8I","$dJXmR","$5Gc7M","$iS9xS","$9J17G","$eK8ID","$2umOB","$bIgqE","$5rdL4","DecoyKlHistory","$gFgFC","$b60fce38973759d6$var$historyInstance","$b60fce38973759d6$export$2a772a91f059c0f9","key","l","KlHistory","$7U0Ew","state","dataArr","listeners","pauseStack","maxState","actionNumber","pop","maxBefore","broadcast","bufferUpdate","$9fd01211d0fde0a8$export$63b4813c5280c707","close","isClosed","clearSelection","unfocusAnyInput","rootRootEl","decrease","destroyEl","xButton","bgEl","removeEventListener","rootEl","wheelPrevent","btnElArr","splice","increase","overflow","scrollContent","minHeight","flexDirection","ignoreBackground","tagName","content","concat","$fh18w","titleHeight","lineHeight","background","boxShadow","boxClasses","boxEl","div","marginRight","join","flex","clickOnEnterBtn","stopPropagation","click","autoFocus","buttonRowEl","marginTop","marginLeft","buttonName","iconUrl","btnClasses","primaries","label","$c0kqC","iconImg","custom","btn","clickOnEnter","closefunc","onscroll","$9fd01211d0fde0a8$export$129a32eedafa97c5","clearInterval","updateInterval","updatePos","elW","popupEl","offsetWidth","elH","offsetHeight","animationName","animationDuration","animationTimingFunction","isCssMinMaxSupported","borderRadius","titleEl","paddingLeft","tabindex","contentEl","$dd0d395ff14a3e11$export$17eb8275e0c4cab8","DialogCounter","count","emit","listener","$h4olN","$05ec456c8871d48f$export$921068d8846a1559","eventUsesHighResTimeStamp","$6J2My","mouseEventHasMovement","hasPointerEvents","hasWebGl","getVisitor","canShareFiles","insertAfter","$7jh4K","setAttributes","fitInto","centerWithin","gcd","reduce","decToFraction","imageBlobToUrl","dateDayDifference","createSvg","BbLog","$i0uIf","mix","$eg83P","dist","distSquared","lenSquared","pointsToAngleRad","pointsToAngleDeg","isInsideRect","clamp","rotate","rotateAround","Matrix","$kVHNC","Vec2","$4toIY","intDxy","roundEven","roundUneven","round","updateBounds","boundsInArea","projectPointOnLine","$af1iA","PointLine","BezierLine","SplineInterpolator","quadraticSplineInput","$eelgW","createCanvas","$eIcQa","testShouldPixelate","drawTransformedImageOnCanvas","createCheckerCanvas","createCheckerDataUrl","convertToAlphaChannelCanvas","freeCanvas","canvasBounds","HSV","$dJ1E2","CMYK","testIsWhiteBestContrast","appendTextDiv","$72Jv0","makeUnfocusable","setEventListener","$idV3L","PointerListener","$04lDo","$exufe","$cdd5ef6b176accd6$export$d031894fc27e45","DomEl","$cdd5ef6b176accd6$export$3f65cefe8380dbea","options","$cdd5ef6b176accd6$export$8ff9f68337b520c0","hasWebgl","visitor","test","$878b1f179a521546$export$b7d78993b74f766d","navigator","userAgent","$878b1f179a521546$export$4ec3bfbae69fbb50","Event","timeStamp","$878b1f179a521546$export$ebcc19037a7ab076","mouseEvent","MouseEvent","$878b1f179a521546$export$b7b64c480b083ae0","PointerEvent","$878b1f179a521546$export$9cbe517943afd6db","premultipliedAlpha","$878b1f179a521546$export$96cd70eaafd80100","chrome","gl","JSON","parse","stringify","$878b1f179a521546$export$fe0a7220ab4eecad","offsetLeft","$878b1f179a521546$export$558f5e20caee48c2","$44dda2e48e48a872$export$cd3d1f114b139967","$2bd9b7b9bc92046d$export$c4f94c8b3850a5a9","referenceNode","newNode","nextSibling","$2bd9b7b9bc92046d$export$fe58198efe02b173","counter","check","complete","$2bd9b7b9bc92046d$export$dbf350e5966cf602","styleObj","alignContent","webkitUserSelect","$2bd9b7b9bc92046d$export$74da2cba014bdc09","attrObj","setAttribute","$2bd9b7b9bc92046d$export$10d8903dec122b9d","els","fragment","$2bd9b7b9bc92046d$export$fa55905620c22535","aw","ah","bw","bh","$2bd9b7b9bc92046d$export$76d0c1a172b67a61","$2bd9b7b9bc92046d$export$aa350b96d91cd94","date","Date","getFullYear","getMonth","toString","getHours","getMinutes","$2bd9b7b9bc92046d$export$f81847884871263e","$2bd9b7b9bc92046d$export$533b26079ad0b4b","numerator","denominator","$2bd9b7b9bc92046d$export$8215e6b900906daa","decimalNumber","len","pow","$2bd9b7b9bc92046d$export$5063ec57a23c4f2e","blobObj","Blob","constructor","fauxBlob","encoding","data","$2bd9b7b9bc92046d$export$1093707c159148e8","dateA","dateB","setHours","getTime","$2bd9b7b9bc92046d$export$af0d87255f3cfd7e","obj","$2bd9b7b9bc92046d$export$331c30fd60da0115","mimetype","err","toBlob","filesArray","File","share","$2bd9b7b9bc92046d$export$b981489921ee18cd","clickEvent","allowClick","$2bd9b7b9bc92046d$export$c54fe3b9ecaa84cf","createElementNS","elementType","childrenArr","$74d1f29ad2137b2c$var$globalKey","emitDown","c","d","listenerArr","emitUp","keyDown","code","keyCode","keyToKeyStrObj","isDownObj","comboArr","codeIsDownObj","keyUp","oldComboStr","blur","eventArr","keyToKeyStrArr","keyStrToKeyObj","space","alt","ctrl","cmd","enter","esc","backspace","delete","sqbr_open","sqbr_close","u","z","plus","minus","up","down","home","end","first","remove","last","getIsDown","getCombo","$74d1f29ad2137b2c$export$f17908c5de22d32e","onBlur","keyStrArr","$74d1f29ad2137b2c$export$e9f65b0175de4c03","comboAStr","comboBStr","sort","pointerArr","pressureNormalizeAvgCount","pressureNormalizeAvgPressure","pressureNormalizeIsComplete","pressureNormalizeFactor","$893e90c2dcf687ac$var$WheelCleaner","endSequenceTimeout","delta","deltaY","sequenceUnit","pageX","pageY","clientX","clientY","endSequence","toEmitDelta","knownUnitArr","sequenceLength","process","clearTimeout","deltaMode","absDelta","abs","$893e90c2dcf687ac$export$9371bd96776f4e82","getDragObj","pointerId","dragObjArr","removeDragObj","removedDragObj","dragPointerIdArr","normalizePressure","correctPointerEvent","corrected","correctedObj","pointerType","movementX","movementY","timeStampOffset","button","eventStopPropagation","customPressure","isFirefox","coalescedEventArr","getCoalescedEvents","getPointer","pointerObj","lastPageX","lastPageY","addPointer","totalLastY","eventItem","coalescedArr","totalLastX","correctedEvent","targetElement","getBoundingClientRect","bounds","eventPreventDefault","coalescedItem","relX","relY","dX","dY","time","createTouchOutEvent","touchListItem","touchEvent","identifier","destroyDocumentListeners","onGlobalPointerMove","onGlobalPointerUp","onGlobalPointerLeave","onPointerEnter","isOverCounter","onEnterLeaveCallback","onPointerLeave","onPointermove","tempLastPointerType","lastPointerType","maxPointers","didSkip","outEvent","createPointerOutEvent","dragObj","downPageX","downPageY","buttonsToStr","clearTouchTimeout","setTouchTimeout","lastTimeStamp","outEvent1","onPointerCallback","touchTimeout","fakeEvent","performance","now","onTouchTimeout","onPointer","onWheelCallback","onWheel","onEnterLeave","wheelEvent","timing","navigationStart","onPointerdown","wheelCleaner","touchArr","changedTouches","touchObj","onTouchmove","onTouchend","$9a5bdb07e7a7c42f$export$2c9e8a9632a706b2","$9a5bdb07e7a7c42f$export$6c4a311cc157c764","ax","ay","bx","by","sqrt","$9a5bdb07e7a7c42f$export$499eb56409f6cbc2","$9a5bdb07e7a7c42f$export$a4f99f99d3e99cfa","$9a5bdb07e7a7c42f$export$627023b405ba5028","p1","p2","atan2","$9a5bdb07e7a7c42f$export$c03a8450eabc2532","$9a5bdb07e7a7c42f$export$151bd845d70e2099","rect","$9a5bdb07e7a7c42f$export$7d15b64cf5a3a4c4","num","$9a5bdb07e7a7c42f$export$bb628a54ab399bc9","deg","theta","cs","cos","sn","sin","$9a5bdb07e7a7c42f$export$95ec0760d3d00713","center","point","rot","$9a5bdb07e7a7c42f$export$bbf9af158036c5e9","remainder","fDx","fDy","$9a5bdb07e7a7c42f$export$94cce7adf2ec2d08","above","ceil","below","floor","$9a5bdb07e7a7c42f$export$f373b6a7b0c159a","$9a5bdb07e7a7c42f$export$2077e0241d6afd3c","digits","digitMult","$9a5bdb07e7a7c42f$export$f4467a4f41373bc7","$9a5bdb07e7a7c42f$export$bbb91bbc54e7d9ac","$12950380ec51f25d$export$649a211db9812745","continueChain","chainArr","chainOut","func","$12950380ec51f25d$export$db3963a21c01d803","fail","sequenceArr","timeoutObj","maxUntilSecondDown","success","eventQueueArr","lastSequenceItem","onDoubleTap","setupTimeout","timeoutStr","targetFunc","timeMS","diff","nowTime","minSilenceBeforeDurationMs","maxPressedDurationMs","maxPressedDistancePx","maxInbetweenDistancePx","maxUpToUpDurationMs","maxUntilSecondDownDurationMs","minSilenceAfterMs","allowedPointerTypeArr","allowedButtonArr","pointersDownIdArr","lastUpTime","isDown","isUp","processEvent","setAllowedPointerTypeArr","arr","setAllowedButtonArr","firstDownTime","firstLastDownTimeout","tapTimeout","fingerArr","lastEventTime","fingers","maxFirstLastFingerDownMs","downTime","tempLastEventTime","maxTapMs","fingerObj","fingerObj1","i2","allAreUp","i3","onTap","gestureObj","doSwallow","secondFingerTimeout","touchPointerArr","isInProgress","continuePinch","index","otherPointerIdArr","downRelX","downRelY","untilSecondFingerDurationMs","endPinch","touchPointerObj","firstFingerMaxDistancePx","pincherArr","actionObj","startDist","distance","startAngle","onPinch","beginPinch","$12950380ec51f25d$export$fe11e0afe623a677","eventCopy","pointers","downPointerId","ignorePointerIdArr","pressure0","pressure1","eventQueue","shiftIsPressed","direction","downEvent","onDraw","$12950380ec51f25d$export$91dcf4209534d21f","lastMixedInput","inputX","inputY","inputPressure","$3f0e2f35371c9852$export$dd0873c0fb3ccff6","resultCanvas","$3f0e2f35371c9852$export$1555f643cc9a976","transform","scaleX","scaleY","whSwapped","$3f0e2f35371c9852$export$ded2b43392504635","destCtx","transformImage","pixelated","imageSmoothingEnabled","imageSmoothingQuality","translate","restore","$3f0e2f35371c9852$export$425a419ef9fc761f","baseCanvas","angleDegree","cache","$3f0e2f35371c9852$export$754559b36e94ea2f","fillStyle","fillRect","$3f0e2f35371c9852$export$42af33c76b681867","create","toDataURL","$3f0e2f35371c9852$export$59b33278b5b2fc8a","tmp1","tmp2","oldW","oldH","newW","newH","ew","eh","base2","oldWidthEx","log2","oldHeightEx","newWidthEx","newHeightEx","buffer1","buffer2","bufferCtx","globalCompositeOperation","currentWidth","currentHeight","newWidth","newHeight","tmp","canvasCtx","tmp1Ctx","$3f0e2f35371c9852$export$5a7576952c826b4f","imdat","getImageData","putImageData","$3f0e2f35371c9852$export$2384aff49c9b73c2","clearRect","$3f0e2f35371c9852$export$3db033c6ee0b8700","boundsObj","tempBounds","multiplyMatrixAndPoint","$e4df33b4b16105d5$export$5b12bf1653c0dd85","getIdentity","matrix","multiplyMatrices","matrixA","matrixB","row0","row1","row2","row3","result0","result1","result2","result3","createTranslationMatrix","createRotationMatrix","createScaleMatrix","$531c9f41f98b7ec0$export$ac4bca90992eed1","sub","nor","mul","dot","aArr","bArr","map","m","$77ae015f37ebe4f1$export$b4c5b177db876445","lineStart","lineEnd","$77ae015f37ebe4f1$export$8b36a4a83269a640","segmentArr","points","getAtDist","getLength","fac","pointArr","lastSpacing","spacing","controlsCallback","lastPoint","dir","lastDot","pointM1","pointM2","pointM3","curvePoints","p3","p4","resolution","getBezierPoints","pointLine","tempSpacing","lastCallbackPoint","dAngle","lastAngle","addFinal","newP","xa","ya","wx","sig","ddydx","getFirstX","getLastX","interpolate","klo","khi","k","$77ae015f37ebe4f1$export$80967b1eb9fd6eb4","findX","$5e7aac2fa49b6b1f$export$d2edaecd208aed43","$5e7aac2fa49b6b1f$export$8f9ece5a47764b93","$5e7aac2fa49b6b1f$export$89d3f85304bf0767","$5e7aac2fa49b6b1f$export$fb7efcd2e153af6e","_RGBtoHSV","minVal","maxVal","del_R","del_G","del_B","_HSVtoRGB","var_h","var_i","var_1","var_2","var_3","var_r","var_g","var_b","_CMYKtoRGB","_RGBtoCMYK","toRGB","toHSV","toCMYK","toHexString","ha","hb","hc","toRgbStr","rgbaObj","hexStr","exec","$5e7aac2fa49b6b1f$export$5cf396345d1238ae","$cfe3aa45a75894cc$export$7868464f598ba79d","innerHTML","$cfe3aa45a75894cc$export$906dfdb7df31ccfc","getAll","activeElement","getAttribute","$cfe3aa45a75894cc$export$e05240ca9e0b8bd9","focusEl","select","$cfe3aa45a75894cc$export$a3d02541b0ebf605","getSelection","sel","empty","removeAllRanges","selection","didFocusRelated","relatedTarget","currentTarget","preventFocus","$cfe3aa45a75894cc$export$c3da0dad1b44eea9","isArray","onChange","$cfe3aa45a75894cc$var$els","customKeyArr","$0d0e99c175410ac4$export$9860cd9e09e6f8ba","msg","$9e5fd8359d8b22f2$export$19fffca37ef3e106","localStorage","module","exports","getBundleURL","resolve","$d82e0c66c1aaca81$export$48513f6b9f8ce62d","doHighlight","element","innerEl","checked","allowTab","tabIndex","onchange","toggle","$aa0ec58519fa7d10$export$b7e3ae3d7c15e42e","$eb01976a4bab51ce$export$ef9b1a59e592288f","selectEl","changeListener","cursor","fontSize","colorScheme","isFocusable","optionArr","option","initValue","$5cde84e643fb89d6$export$b6d053cded550773","isActive","backgroundImage","isRadio","setValue","getValue","$459eb3dcb08ae3f8$export$7cc1012a658e6ad8","activeIndex","createOption","initId","radioEl","$12a3b74a8702bb1f$export$77219f67585650fa","isChecked","changeCallback","redraw","toggleDiv","backgroundColor","border","cssFloat","$e1Rnq","backgroundSize","backgroundRepeat","boxSizing","$cf8be10874d1afb1$export$a1855b925e534de7","isEnabled","manualInputRoundDigits","useSpline","curve","elementWidth","elementHeight","displayValueToValue","valueToDisplayValue","toValue","displayValue","toDisplayValue","isChangeOnFinal","formatFunc","eventResMs","curveArr","splineInterpolator","roolEl","sliderWrapperEl","labelFontSize","textEl","control","valueToSliderValue","controlInner","updateEnable","doubleTapper","DoubleTapper","showManualInput","virtualVal","eventChain","pointerListenerTimeout","pointerListener","fixScribble","sliderValue","sliderValuetoValue","updateLabel","deltaX","sliderValue1","toLocaleString","languageStrings","getCode","isFinal","emitInterval","emitValue","setInterval","manualInput","setIsEnabled","$348ou","KlSliderManualInput","config","isDisabled","$0c2dd884393cffca$export$f8e41e222e32615d","isRightButton","$a36067096711f77d$export$db3d4fde05db9a5e","roundDigits","currentValue","onblur","privateOnClose","scrollBefore","scrollX","lastValue","Number","$dada52d673c8c4ac$export$cc42e119007cb939","createRgbInputRow","labelStr","attributeStr","rowEl","labelEl","inputEl","lastValidRgb","parseFloat","previewEl","hexInput","hexRowEl","hexLabel","rgbArr","copyButton","$fcsnL","execCommand","resultStr","$9eeb6c00ea2d3242$export$4e5102252876c5d7","updatePrimaryHSV","hsv","primaryColorHSV","updateSVCanvas","rgb","hueStop","updateSVPointer","svHeight","pointerSV","setColPreview","divPreview","primaryColorRGB","pickerButton","hexButton","updateSecondaryColor","secondaryColorBtn","secondaryColorRGB","secondaryColorHSV","controlH","pickCallback","outputDiv","startValue","svWrapper","svSvg","DOMParser","parseFromString","documentElement","divH","SVContainer","virtualHSV","$1nsGS","backgroundPosition","isPicking","isOver","targetEl","cv","gradH","createLinearGradient","col","addColorStop","createHueBg","factor","$3ac3f56275b45315$export$dcd33f7653c95f09","updateSV","canvasSV","gradient1","colleft","colright","heightSV","updateHPointer","pointerH","canvasH","heightH","svPointerId","svPointerListener","hPointerId","hPointerListener","cleardiv","clear","$0b17443c34517974$export$ac00cea56cec3037","param","redrawPoint","sliderPoint","sliderPos","isDragging","pointSize","sliderLine","isFirst","imaginaryPos","margin","transition","$a19b2655062f09b7$export$24ba9b81662d4366","buttonArr","setIsSelected","selectedIndex","colorArr","checkerUrl","found","sItem","initialIndex","colorButton","buttonSize","textAlign","$c8511e371b1e3768$export$c019608e5b5bb4cb","optionObj","classArr","isSmall","wrapperEl","selectedId","getIndex","initialId","changeOnInit","previous","$c1a93a3cd82636c9$export$5ee0af1d5c87e856","removeProperty","isWide","angleIm","$bv5Zj","verticalAlign","innerInnerEl","doPulse","animation","timeout3","timeout","timeout2","$81ac8fccf3fa43c3$export$8e17099f54853f0e","aboutDiv","closed","aniToggle","imageContainer","coverImage","coverSize","aniTimeout","boxSize","ontouchstart","ontouchmove","ontouchend","$01fcd0ed15aa4018$export$40175a5948a88a57","resetCrop","updateCroppedCanvas","croppedCanvas","croppedImage","updateSelectionRect","selectionRect","thumbX","scaleW","thumbY","scaleH","toOriginalSpace","genCrop","topLeftP","bottomRightP","origTopLeftP","origBottomRightP","isReset","eventTarget","isNotCopy","previewWrapper","thumbSize","thumbCanvas","imageRendering","thumbCtx","startP","updateCropTimeout","startCrop","didMove","doUpdate","stepSize","getRect","getCroppedImage","$ffd40240385bb9f9$export$32b89bc9bb92706a","fullCanvas","cropCallback","output","toClipboard","imgURL","cropCopy","fetch","clipboard","write","ClipboardItem","clipboardItemIsSupported","topWrapper","borderTop","borderBottom","KeyEvent","rectObj","$aacd8170d7ccb1c6$export$56cc6eb0b4c43d97","p_canvas","p_func","p_rootDiv","oldHistoryState","row","clearBtn","$8yL1I","suggestions","suggestionBtns","createLayerList","updatefunc","createLayerEntry","klCanvasLayerArr","layercanvas","layerElArr","posY","innerLayer","container1","container2","spot","oldOpacity","thumbDimensions","thumb","thc","lname","whiteSpace","ondblclick","opacityLabel","isLast","layerOpacity","largeThumbCanvas","largeThumbDiv","largeThumbInDocument","largeThumbInTimeout","largeThumbTimeout","dragstart","freshSelection","lastpos","isSelected","activateLayer","updateLayersVerticalPosition","posToSpot","newSpot","oldSpot","move","selectedSpotIndex","layerListEl","getState","child","updateHeight","layerHeight","layerSpacing","newspot","posy","oldSpotIndex","newSpotIndex","moveLayer","mergeBtn","disabled","listdiv","disableButtons","enableButtons","modeWrapper","modeSelect","addnewBtn","duplicateBtn","removeBtn","renameBtn","paddingRight","$d42vI","$dKwR8","$3VpTB","$g91IK","clearboth","MAX_LAYERS","duplicateLayer","removeLayer","mixModeStr","$bBcC4","translateBlending","topCanvas","preview","spacer","alphaCanvas","bottomCanvas","globalAlpha","topOpacity","mergeDialog","mode","mergeLayers","createButtons","setMixMode","historyState","activeLayerSpotIndex","getSelected","spotIndex","stateStr","$0621fc8724f6bfac$var$allowedMixModes","$0621fc8724f6bfac$export$9f4f73b1bd7c2f26","$0621fc8724f6bfac$export$4a819bde91671014","layerNrOffset","layerCanvasArr","pickCanvas","changeListenerArr","origLayers","updateIndices","toCopyCanvas","algorithm","layerCanvas","layerContext","offX","offY","ctemp","layerCtx","fillColor","selected","isLayerLimitReached","doReturnNull","emitChange","temp","targetIndex","layerBottomIndex","layerTopIndex","isHorizontal","isVertical","tempCtx","colorObj","compositeOperation","tolerance","sampleStr","grow","isContiguous","srcCanvas","srcData","srcCtx","srcImageData","targetImageData","targetCtx","srcIndex","targetData","imageData","canvasObj","$7069db2f5e23d00f$var$fillRect","$7069db2f5e23d00f$var$mx","$7069db2f5e23d00f$var$my","$7069db2f5e23d00f$var$moveIndex","$7069db2f5e23d00f$var$testAndFill","srcArr","targetArr","initRgba","px","py","q","tl","tr","br","bl","$01d7180c5d1d0fdf$export$27550cc14d7ae85a","downX","downY","downAngleRad","onShape","$01d7180c5d1d0fdf$export$71b514a25c47df50","defaults","property","$01d7180c5d1d0fdf$var$applyDefaults","colorRGB","strokeStyle","r1","r2","pAngleDeg","pAngleDegSnapped","rotated","r11","r21","rx","ry","rdX","rdY","x1r","y1r","x2r","y2r","x1f","y1f","x2f","y2f","beginPath","moveTo","lineTo","stroke","x1f1","y1f1","x2f1","y2f1","strokeRect","ellipse","fill","$fdc12d72a3df9be9$export$482c90f94eb9717c","outer","fontFamily","fontWeight","fontStyle","spanStr","children","offsetTop","el1","fillText","innerText","isDebug","$089586a542a12f27$export$5f63a7b18dc4503a","$5e45fa121ba5050f$export$74d12f09ff9f1956","onGradient","$5e45fa121ba5050f$export$b1f70a113e3b5c1b","baseColor","color2","createRadialGradient","$2f1281ced73ab1dc$export$6e1bedb2a6cdff30","blendMode","codes","darken","multiply","lighten","difference","exclusion","hue","saturation","luminosity","$d256278b259ca979$export$6b9252711ea5997f","rootElement","brushCircleOuter","brushCircleInner","pickerPreviewBorder","pickerPreviewCol","compassSize","compass","compassInner","compassBaseCircle","cx","cy","compassLineCircle","compassUpperTriangle","compassLowerTriangle","radius","borderColor","$d492af58f4721011$var$TMode","TMode","$d492af58f4721011$var$MIN_SCALE","$d492af58f4721011$export$6eaf6f7c0cc177fc","_this1","onViewChange","renderTargetCanvas","renderTargetCtx","renderWidth","renderHeight","compositeCanvas","compositeCtx","doResizeCanvas","oldTransformObj","targetTransformObj","highResTransformObj","renderedTransformObj","cursorPos","usesCssCursor","bgVisible","transformIsDirty","doAnimateTranslate","svgOverlay","emptyCanvas","isRepeat","currentInputProcessor","onKeyDown","Draw","Pick","Fill","Gradient","Text","Shape","globalMode","inputProcessorObj","spaceHand","Hand","altPicker","zoom","onKeyUp","updateChangeListener","currentMode","renderTime","lastDrawEvent","linetoolProcessor","LinetoolProcessor","getMatrix","art","getRenderedTransform","coords","matrix1","coords1","coords2","pointer","reqFrame","updateCursor","getComboStr","resetInputProcessor","coord","workspaceToCanvasCoord","onFill","onText","HandGrabbing","Zoom","offsetX","offsetY","internalZoomByStep","lastRenderedState","picker","pickedColor","getColorAt","updateColorPreview","Rotating","Rotate","centerObj","startAngleRad","dAngleRad","minimizeAngleRad","origin","angleIsExtraSticky","pinchZoomer","PinchZoomer","snapAngleRad","mainDoubleTapper","middleDoubleTapper","twoFingerTap","NFingerTapper","threeFingerTap","pointerEventChain","OnePointerLimiter","CoalescedExploder","brushRadius","animationFrameRequested","requestAnimationFrame","updateLoop","addChangeListener","modeInt","doForce","oldMode","$hNEwm","$iOLNv","$3zTyb","$kFdtJ","oldIsHand","currentIsHand","stepNum","centerX","centerY","newStep","newScale","effectiveFactor","transformA","transformB","blendFactor","centerPosA","canvasToWorkspaceCoord","centerPosB","mixedPos","workspacePointArr","borderSize","layerArr","getLayersFast","compositeObj","updateCompass","snapDegIncrement","maxDistDeg","modDeg","doRedrawCanvas","newState","elapsedFrames","lastRenderTime","doRender","checkChange","testBgVisible","start","klC","oldWidth","oldHeight","modeStr","diameter","hideBrushCursorTimeout","doAnimate","canvasPointsArr","newAngle","boundsWidth","boundsHeight","newTargetTransformObj","oldAngleRad","tx","ty","$6faa9d948ec87f40$export$e258ade1648009b7","render","$0370167ee97a20d9$var$snapToPixel","$0370167ee97a20d9$var$copyTransform","$0370167ee97a20d9$var$toTransformSpace","$0370167ee97a20d9$var$toImageSpace","corners","isConstrained","snapX","snapY","snappingEnabled","ratio","transEl","boundsEl","boundsStartP","iP","minSnapDist","snap","distX","distY","j","projected","dist1","updateCornerPositions","updateDOM","gripSize","offsetArr","scaled","tinyOffset","cornerCursors","virtualPos","constrainCorner","snapCorner","tP","indexes","updateTransformViaCorners","edgeSize","edges","angleOffset","isInverted","pointerRemainder","tfD","ti","dimension","restoreRatio","angleGrip","$lQMok","anglePointerListener","offset","snapDeg","iX","iY","_x","_y","cornerIndex","flip","widthChanged","heightChanged","angle90","newHeight1","skipCallback","transformOrigin","$48f5d87739d28bf9$export$205c2dd29f8a66b5","updatePreview","freeTransform","getTransform","destCanvas","previewLayerArr","transformIndex","initTransform","klCanvasPreview","imageWidth","imageHeight","previewFit","innerWrapper","transformSize","setPos","setAngleDeg","fit","setTransformCenter","getTransformation","getIsPixelated","$de496a1759b04ed9$export$71ed2b85d4ca43d3","transformTop","grips","maxH","transformRight","maxW","transformBottom","transformLeft","commit","cornerElArr","outline","thirdsHorizontal","thirdsVertical","gripCursors","outlinePointerListener","gripOverlay","edge0PointerListener","edge1PointerListener","edge2PointerListener","edge3PointerListener","corner0PointerListener","corner1PointerListener","corner2PointerListener","corner3PointerListener","setTransform","setScale","showThirds","$18e69c7d4cb991e8$export$d25420b53e16716f","layerObj","largeCanvasAnimationTimeout","isInstant","nameLabelEl","opacityEl","lastDrawnSize","canvasDimensions","canvasSize","animationCanvas","animationCanvasCtx","animationCanvasCheckerPattern","animationCount","animationLength","animate","drawLargeCanvas","lastDrawnState","largeCanvasIsVisible","largeCanvasSize","largeCanvas","largeCanvasCtx","largeCanvasCheckerPattern","largeCanvasWrapper","removeLargeCanvas","largeCanvasAnimationDurationMs","contentWrapperEl","canvasWrapperEl","nameWrapper","flexGrow","nameFadeEl","clickableEl","webkitTouchCallout","createPattern","showLargeCanvas","currentState","klCanvasLayerObj","$a29ff52bf33e0691$export$83ae33786c7b4ee5","$e3dfa43019bc3f08$export$962af7e240721d88","freeTransformCanvas","noteEl","originalSizeBtn","fitSizeBtn","setTransformFit","centerBtn","importImage","buttonStr","$01cb8095758db224$export$e789742143ba5b1","rootCounter","optionLayerCounter","optionImageCounter","testAcceptType","dataTransfer","types","updateOptions","optionLayerEl","optionImageEl","paddingTop","textShadow","optionStyle","$d6fe881e8fc421ac$export$9f0da9b942594e99","updateColor","selectedColorEl","updateUI","mousePos","sizeObj","hHeight","sliderHeight","queuedObj","subscriptionFunc","initialColor","subscribe","sliderConfig","getSliderConfig","$6003e73b8cbb69e2$export$665d2c76b1eb8459","createButton","extraPadding","contain","logoButton","$8oUiM","newButton","$1gUFn","importButton","$gswMe","saveButton","$lLh5u","shareButton","$5xpQb","helpButton","onHelp","$kS5uZ","$18c597dee53260ff$export$a0a40f8a0b8fee15","createDropdownButton","wrapper","dropdownWrapper","smallMargin","onClickDropdownBtn","closeDropdown","currentActiveIndex","updateButton","showDropdown","dropdownBtnArr","arrowButton","activeButton","titleArr","activeButtonIm","imArr","openTimeout","startX","startY","elementFromPoint","$gzZrf","borderBottomLeftRadius","borderBottomRightRadius","$a372d78c806cd0cc$export$c744a22bef9e0b97","doEmit","currentActiveStr","toolDropdown","handButton","onActivate","doLighten","doMirror","createTriangleButton","svg","viewBox","preserveAspectRatio","defs","in","stdDeviation","dx","dy","in2","operator","k2","k3","svgTriangleLeft","class","onLeft","svgTriangleRight","onRight","leftPointerListener","rightPointerListener","leftIm","leftImage","rightIm","rightImage","setIsEnabledLeft","setIsEnabledRight","zoomInNOutButton","$3KoFh","$eWf2I","zoomInButton","zoomOutButton","undoNRedoButton","$fc34V","undoButton","redoButton","$90c04b5ac185bf3d$export$8162a66cd18867a7","strengthSelect","setDeltaValue","$d04d72b97d637d65$export$3c6d17ed0106bfb9","pTabObj","useAccent","openedTabObj","tabDiv","roundRight","roundLeft","tabArr","roundSize","$4m0AU","tabId","$9934467c988b088a$export$cf20160367bae46c","scaleEl","angleEl","resetButton","onReset","fitButton","leftRotateButton","$2n4Fs","resetAngleButton","rightRotateButton","pIsVisible","pScale","$51d47356d698ffec$export$1e63e3b0645421a2","toleranceSlider","selectRow","growWrapper","growSelect","contiguousToggle","eraserToggle","$d06987f550ff485e$export$32a22540e4b2f123","$45c003c723de07b5$export$a9387b1d4260d39c","updatePreviews","strokeWidth","lineWidthSlider","squish","rectStrokeSvgRect","rectFilledSvgRect","ellipseStrokeSvgEllipse","ellipseFilledSvgEllipse","lineSvgLine","fixedToggle","previewPadding","previewSize","snapToggle","rectStrokeSvg","rectFilledSvg","ellipseStrokeSvg","ellipseFilledSvg","lineSvg","shapeOptions","lockAlphaToggle","outwardsToggle","$4fb68589de8a8c9a$export$f77a89101d7d6586","createRatioSize","ratioX","ratioY","maxCanvasSize","updateRatio","widthInput","heightInput","commonRatios","reducedArr","closestRatio","closestDistance","ratioWrapper","realw","T","U","V","HCF","secondaryColor","canvasWidth","canvasHeight","workspaceWidth","workspaceHeight","onConfirm","newImDiv","widthWrapper","heightWrapper","widthUnit","heightUnit","templateWrapper","presetFitBtn","presetCurrentBtn","presetSquareBtn","presetLandscapeBtn","presetPortraitBtn","presetOversizeBtn","sizeObj1","backgroundRGBA","colorOptionsArr","colorOptions","previewcell","cell","onkeyup","secondRow","secondRowLeft","$3f73fb4b1b574d52$export$5b91f641162972fc","icon","directionStr","$jiQkU","dirStr","$3Rl3W","$cd9e7df6e228ea45$export$e263e067d6140649","textCtx","textCanvas","$a7ch7","textInput","alignRadioList","italicToggle","boldToggle","sizeInput","fontSelect","rotatedXY","rotatedWH","fitBounds","zoomFac","previewCanvas","layersCtx","previewCtx","checkerPattern","layersCanvas","changeZoomFac","zoomInBtn","canZoom","zoomOutBtn","onScroll","isSmallWidth","isSmallHeight","touchAction","previewPointerListener","row2n3Wrapper","unshift","fontPointerListener","zoomWrapper","sizePointerListener","$2dqOY","$rk4vM","$hucjG","$cZa2s","$03Zd8","placeholder","$c8d2eb7d799b314c$export$1bf16d9bd59fd8f9","resolutionEl","updateResolution","flattenCheckbox","doFlatten","noteStyle","warningArr","psdWarningArr","contentArr","warningMap","mask","clipping","group","adjustment","showWarnings","noteEl1","cropRect","isCropped","$4c230b0de5e1a470$var$kl2PsdMap","$4c230b0de5e1a470$var$psd2KlMap","$4c230b0de5e1a470$var$init","$4c230b0de5e1a470$export$6df36f0c42d2440f","str","$4c230b0de5e1a470$export$4e3b1f7d3ad623b4","$4c230b0de5e1a470$export$3d649861c4b13fa2","psdObj","addWarning","warningStr","getMixModeStr","prepareMask","maskCanvas","defaultColor","groupMaskCtx","imData","bitsPerChannel","maxLayers","layerCount","countWithinGroup","groupObj","convertGroup","psdGroupObj","groupCanvas","groupCtx","resultArr","groupOpacity","hidden","groupMixModeStr","hasClipping","innerArr","innerItem","innerCtx","clippingCanvas","clippingCtx","clippingItem","effects","clippingCanvas1","clippingCtx1","clippingItem1","$4c230b0de5e1a470$export$56493bf279c387b3","klPsd","$41164c8aeaf53227$var$indexedDbIsSupported","indexedDB","$41164c8aeaf53227$var$dbNameStr","$41164c8aeaf53227$var$storageNameStr","$41164c8aeaf53227$export$1347f8be1f25c479","$41164c8aeaf53227$var$execIndexedDBTransaction","actionFunction","successCallback","errorCallback","onError","errorStr","hasFinished","requestObj","createObjectStore","keyPath","createIndex","unique","objectStoreNames","contains","deleteDatabase","storeObj","transactionObj","databaseObj","transaction","objectStore","e2","oncomplete","$41164c8aeaf53227$export$1448a0dd0d3fde8e","query","$41164c8aeaf53227$export$21ade4eb935254aa","storageProject","put","$41164c8aeaf53227$export$42ffd38884aecdac","$8k5kH","$805be15a1e91c0ee$export$7a4e0b62a5d854bc","isLoaded","$805be15a1e91c0ee$export$395d33c8e06b92c9","brightnessContrast","lang","getDialog","inEmbed","$4UkHZ","curves","$e7LnL","distort","$bt9IQ","$iI5sC","hueSaturation","$eySuj","invert","$iPRwU","perspective","$krmR4","$92iBR","tiltShift","$bFASM","toAlpha","$9m6gZ","$4fkq2","$dPWA8","unsharpMask","$cQHFd","grid","$9vOYE","noise","$as29q","pattern","$mMv4g","vanishPoint","$5UWr6","$68QTJ","$42ac5b30ad65dabb$export$7d68cd8857639377","PenBrush","BlendBrush","$5PSXS","SketchyBrush","$ewgr9","PixelBrush","$kic4a","ChemyBrush","$6Nq1H","SmudgeBrush","$ltaBP","EraserBrush","$7cUpm","$3f0923cd3c55ea92$export$6f96c8f9e6ae7341","historyEntry","settingColor","settingColorStr","lineToolLastDot","calcOpacity","settingOpacity","settingHasOpacityPressure","updateAlphaCanvas","settingAlphaId","ALPHA_CIRCLE","ALPHA_SQUARE","instructionArr","alphaCanvas128","alphaCanvas64","alphaCanvas32","alphaOpacityArr","$5CF7D","alphaImArr","drawDot","before","settingLockLayerAlpha","arc","twoPI","closePath","hasDrawnDot","targetMipmap","ALPHA_CHALK","bezierLine","lastInput","dotCallback","localPressure","lastInput2","localOpacity","localSize","settingSize","settingHasSizePressure","drawArr","localSpacing","settingSpacing","actions","inputArr","maxInput","loopDist","mouseDist","bdist","eX","eY","setAlpha","setSpacing","sizePressure","opacityPressure","setLockAlpha","getSpacing","$74D3O","$ff6c1f784f50f5d5$export$d116ae91f77f1f19","genBrushAlpha01","genBrushAlpha02","$f875015ce1aeb4d3$export$74a44bbc21d06a28","scaleFac","createImageData","sFac2","$gZSR2","simplex2","noisePattern","centerDist","$f875015ce1aeb4d3$var$udSegment","ba","pa","$f875015ce1aeb4d3$export$eaa218d5d17c8f1c","pDist","centerSize","transitionSize","$dfc47a34ad9bc378$var$myModule","$dfc47a34ad9bc378$var$Grad","dot2","$dfc47a34ad9bc378$var$grad3","$dfc47a34ad9bc378$var$p","$dfc47a34ad9bc378$var$perm","$dfc47a34ad9bc378$var$gradP","seed","$dfc47a34ad9bc378$var$G2","xin","yin","j1","$dfc47a34ad9bc378$var$F2","gi0","gi1","gi2","$02d77b8dd5755328$var$cellSize","$02d77b8dd5755328$var$clamp","$02d77b8dd5755328$export$9659db8d01dd5313","redrawBounds","cells","getTouchedCells","isTouched","touchedCells","cellsW","getCellsWidth","cellOffsetX","cellOffsetY","cellWidth","cellHeight","inCellBounds","tmpCtx","alpha","ar","ag","ab","aa","sliceBounds","randI","randLen","randArr","random","samples","samplesSquared","sampleOffsets","sharpness","invSharpness","sharpnessSubtrahend","sizeSquared","distDivisor","alphaMinuend","slicedBounds","ri","re","alphaO","underR","invAlphaO","underG","underB","alphaU","underR1","underG1","underB1","newAlpha","drawBuffer","settingSizePressure","calcSpacing","avgX","avgY","blending","mixr","mixg","mixb","average","localColOld","avgParams","prepDot","copyFromCanvas","getAverage","blendCol","localColNew","blendMix","settingOpacityPressure","updateRedrawBounds","totalCells","isTesting","drawChangedCells","continueLine","find","$c214fbe9e4fc15b0$var$sampleCanvas","$c214fbe9e4fc15b0$var$sampleCtx","$c214fbe9e4fc15b0$export$566f9061f0f5ba33","lastX","lastY","settingBlending","settingScale","sketchySeed","setSeed","getSeed","mixmode","c1","c2","getBlending","setBlending","p_x","p_y","preMixedColor","mixx","mixy","mixw","mixh","countmix","mixed","$58b45953679baa4a$export$4de5ef8eecde6f12","ditherPattern","updateDither","ditherCtx","settingIsEraser","ditherArr","ditherCanvas","skipFirst","settingUseDither","sX","sY","plotCubicBezierLine","isOverThreshold","d2","d3","cubicCurveOverThreshold","plotLine","controlCallback","controlObj","setIsEraser","setUseDither","getLockAlpha","$fc1a683099fb2d61$export$fe52c90afd1cf5ba","isBaseLayer","isTransparentBG","radgrad","oFac","bezierCallback","started","setTransparentBG","$78ad817c60f81b7c$var$CELL_SIZE","$78ad817c60f81b7c$var$smudge","cSize","brush","cX","cY","aP","bP","aIndex","ai","bi","ix","iy","softnessPx","fac2","alphaLock","bx1","yStart","bx2","pixel","iy1","yStart1","x21","ix1","yStart2","x3","x22","ix2","iy2","y3","iy3","yStart3","x4","x23","ix3","completeRedrawBounds","copiedCells","copyImageData","_$i","e3","imWidth","imHeight","$78ad817c60f81b7c$var$prepSmudge","ImageData","updateCompleteRedrawBounds","historyIm","tmpCanvas","$348fcce123898af9$export$38b08aa4ea8f61c6","settingXSymmetry","settingYSymmetry","buffer","settingMode","path","Path2D","settingGradient","startAtTop","minY","maxY","lineJoin","settingDistort","pos","historyCanvas","$cVFne","$7de2f0eab7a9ead7$export$f1561c72be54c6a7","penBrush","penBrushUi","blendBrush","$9mjXI","blendBrushUi","sketchyBrush","$iYbUv","sketchyBrushUi","pixelBrush","$brjBD","pixelBrushUi","chemyBrush","$vCnsd","chemyBrushUi","smudgeBrush","$dS2qM","smudgeBrushUi","$9rc5F","eraserBrushUi","brushInterface","alphaNames","$8b6ca25eb0830594$export$a0d4983f3b0b5c8e","$7gVvp","updateAlphas","alphas","currentAlpha","spacingSpline","onSizeChange","$7NTKy","pressureSizeToggle","pressureOpacityToggle","alphaWrapper","changeSliderValue","$e8a5c017c49bb311$export$5ec472fd0ce20d84","$2e3c50106ba150d5$export$156bb4fe8f4bcb4b","$cQSIC","blendingSlider","setSizePressure","setOpacityPressure","$94537af75923b9e3$export$ffae56164d1bde68","$bteky","blendSlider","scaleSlider","$9519e739bc9666ee$export$d001f3406562d07","$4PDnu","ditherToggle","getUseDither","toggleRow","$d6fc2ded7d9d56db$export$cf481ecf227135a8","$984eq","isTransparentBg","transparencyToggle","$1045b9bae2ffbbb4$export$84831662ba707e7a","$3QgTy","$18456e8104a5a825$export$80819a93636ebb04","$18kre","actualIconSize","iconSize","modeOptions","brushSize","mirrorXToggle","halfSize","getXSymmetry","setXSymmetry","mirrorYToggle","getYSymmetry","setYSymmetry","gradientToggle","getGradient","setGradient","$14dc4cf18966a4f4$export$2358c75ad3c15b2d","$6f92981a32875bca$export$5334e08b3589fc5c","isEmbed","linkEl","iframe","href","contentWindow","location","isMaxHeight","$142eacf53b1eb43d$export$3dff5655255b5729","ignoreFocus","inputs","$0e681e75eb3cab30$export$9c72cf485ef46673","gridTemplateColumns","gridTemplateRows","gap","gridTemplateAreas","gridArea","infoEl","isBroken","ageEl","textSize","btnCustom","storeButtonEl","clearButtonEl","hideClearButton","visibility","storeListener","onUpdate","timestamp","thumbnail","updateThumb","updateAge","readResult","read","ageStr","age","maxWidth","maxHeight","resetButtons","Promise","unsubscribe","$14b343f2c12ca9c5$var$makeAsync","reject","$14b343f2c12ca9c5$export$93d91060b9af7e2a","accessHasFailed","storeKlProjectObj","getKlProjectObj","lowLevelRead","$3hwQ7","ProjectConverter","readStorageProject","t1","storageProject1","createStorageProject","lowLevelStore","lowLevelClear","updateTimestamp","$3ee249752703e788$var$loadImage","onabort","$3ee249752703e788$export$f3c1ac6650038646","$2wCWz","base64ToBlob","createThumbnail","HTMLCanvasElement","all","t2","$e3587a28373f51f9$export$b3fb17ae4345ac8f","base64Str","parts","binStr","atob","buf","ArrayBuffer","view","Uint8Array","charCodeAt","$01ce2e23a2667e77$export$a2647fbf5f056b0a","onExportTypeChange","onFileSelect","onSaveImageToComputer","onNewImage","onShareImage","onUpload","onCopyToClipboard","createSpacer","clearer","line","filemenu","uploadImgurButton","clipboardButton","$4xKQD","multiple","accept","exportTypeWrapper","exportTypeSelect","importWrapper","innerMask","importFakeButton","createImportButton","saveNote","fileBrowserStorage","refresh","$0d10046ca7f6fbd0$export$3f17d740ad471e50","getCurrentColor","getKlMaxCanvasSize","getKlCanvas","getCurrentLayerCtx","isInit","filterKey","filterArr","buttonLabel","filterName","applyFilter","filterDialog","getInput","finishedDialog","groupArr","filters","addGroup","$6349b006a6604e1b$var$upload","description","$6349b006a6604e1b$var$_upload","gif","labelText","response","formData","$j8sUl","FormData","method","headers","Authorization","ok","json","link","$6349b006a6604e1b$export$b1dd62fa0b5f32f5","inputTitle","inputDescription","rows","labelTitle","labelDescription","tos","typeRadio","outDiv","infoHint","deletehash","$ae23cd0c3e53f398$var$agPsdLazy","$ae23cd0c3e53f398$export$ab3d838b1d336b38","$ae23cd0c3e53f398$var$_loadAgPsd","$06e8423858d08972$export$befc6437ad34b28a","showReminder","changeTitle","onSaveAsPsd","lastSavedActionNumber","lastSavedAt","psdWrapper","storageWrapper","paddingBottom","psdBtn","storageUi","closeFunc","lastReminderShownAt","onBeforeUnload","returnValue","getActionNumber","visibilityState","unsavedActions","showPopup","unsavedInterval","$956d06d740fc5053$export$75e7b60500bb415b","getExportType","format","saveImage","mimeType","$98ax7","saveAs","fnameArr","fileBase","layerArr1","psdConfig","blendKlToPsd","writePsdBuffer","XMLHttpRequest","responseType","send","a1","status","dispatchEvent","createEvent","initMouseEvent","self","$parcel$global","global","HTMLAnchorElement","download","rel","msSaveOrOpenBlob","autoBom","warn","HTMLElement","safari","onloadend","readAsDataURL","define","amd","$48534f13b7192dff$export$5cebd3bb2d68229a","getInitState","setCurrentLayerCtx","getCurrentBrush","doIgnore","ignoreTest","oldSize","id1","b3","currentLayerIndex","logParam","localCurrentLayerCtx","$53cc60fd413705d6$export$272bfd3ef9ef2f48","onSetColor","onSetSize","onSetOpacity","onGetColor","onGetSize","onGetOpacity","onGetSliderConfig","subscriberArr","instance","skipSubscriber","$5562b5b6c391a7ca$export$5d396b237bd33221","onLeftRight","customAbout","makeLicenses","licenses","overflowY","language","getLanguage","preferredLanguageRow","$fgfvl","languages","languageSelect","LS_LANGUAGE_KEY","languageHint","$7OLuX","$6qSiv","$951e508110f8a437$export$42a534af7eb650e8","upBtn","downBtn","upInterval","scrollBy","downInterval","wheelListener","$f244572c1923a3ac$export$7fa03d1ef9d3489e","iconArr","updateIcons","typeOptions","reverseToggle","doSnapToggle","col1","col2","$b37f5cd553722692$export$665d2c76b1eb8459","submitButton","leftRightButton","$4bb0d03ef02dc0c0$var$importFilter","libObj","moduleObj","$4bb0d03ef02dc0c0$export$4283b00eae4a6956","$iiVKq","filterBrightnessContrast","$lorQQ","filterCropExtend","$8Ri8I","filterCurves","$fADXF","filterFlip","$bIns5","filterHueSaturation","$30jcG","filterInvert","$cCks8","filterPerspective","$huXOx","filterResize","$dsRff","filterRotate","$lhchB","filterTiltShift","$lXpcU","filterTransform","$1CjeM","filterBlur","$dNWKZ","filterUnsharpMask","$94Tq7","filterToAlpha","$d8Fqy","filterGrid","$gtdB1","filterNoise","$lQzx7","filterPattern","$10iZP","filterDistort","$dteOZ","filterVanishPoint","$024aabab8b30bbfd$export$af433fb90aa90a38","selectedLayerIndex","brightness","contrast","glCanvas","$5RaQo","getSharedFx","texture","brightnessSlider","$cH2YE","contrastSlider","previewInnerWrapper","$fca35583bfaa35b6$export$5ec472fd0ce20d84","$TEtAx","$0e6e34a2063e157d$var$fxCanvas","fx","$0e6e34a2063e157d$export$8c4423af32b21158","_","isContextLost","$dVkJn","$5eb53faa48338ac6$export$68ae324f2f6c6252","lo","hi","wrapTexture","loadContentsOf","Texture","fromElement","initialize","UNSIGNED_BYTE","getExtension","testTexture","RGBA","FLOAT","drawTo","spareTexture","extraTexture","flippedShader","Shader","use","getDefaultShader","drawRect","shader","uniforms","textureIn","textureOut","swapWith","node","getPixelArray","array","readPixels","getSquareToQuad","dx1","dy1","dx2","dy2","dx3","dy3","det","warpShader","warp","simpleShader","interpolator","red","green","blue","splineInterpolate","initFromBytes","textures","exponent","denoise","texSize","octaves","peaks","colA","colB","channels","amount","sepia","strength","ensureFormat","triangleBlur","originalTexture","unuse","vibrance","vignette","lensBlurPrePass","common","randomShaderFunc","lensBlur0","lensBlur1","lensBlur2","texture1","power","delta0","delta1","endX","endY","blurRadius","gradientRadius","zoomBlur","colorHalftone","dotScreen","edgeWork","edgeWork1","edgeWork2","hexagonalPixelate","ink","bulgePinch","inverse","useTextureSpace","matrixWarp","getInverse","after","swirl","multiplyAlpha","unmultiplyAlpha","replaceRGBA","distortType","phase","oldGetExtension","oldGetSupportedExtensions","getSupportedExtensions","createFramebuffer","createTexture","TEXTURE_2D","byteTexture","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","FRAMEBUFFER","framebuffer","COLOR_ATTACHMENT0","floatTexture","bindTexture","texParameteri","LINEAR","texImage2D","Float32Array","program","createProgram","vertexShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","attachShader","linkProgram","createBuffer","ARRAY_BUFFER","bufferData","STREAM_DRAW","enableVertexAttribArray","vertexAttribPointer","viewport","POINTS","supportsOESTextureFloatLinear","WebGLRenderingContext","$OES_texture_float_linear$","OESTextureFloatLinear","getOESTextureFloatLinear","extensions","contents","lensBlur","isNumber","source","nameStr","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","testPrecisionSupport","precisionType","getShaderPrecisionFormat","precision","vertexSource","fragmentSource","vertexAttribute","texCoordAttribute","defaultVertexSource","defaultFragmentSource","floatPrecision","HIGH_FLOAT","MEDIUM_FLOAT","compileSource","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","useProgram","getUniformLocation","uniform1fv","uniform2fv","uniform3fv","uniform4fv","uniformMatrix3fv","uniformMatrix4fv","$2680b5781517cb67$export$e5937df51b9e1d86","updateInput","leftInput","rightInput","topInput","bottomInput","leftChanged","rightChanged","topChanged","bottomChanged","cropper","offsetWrapper","selectedRgbaObj","previewFactor","lrWrapper","tbWrapper","labelStyle","useRuleOfThirds","ruleOThirdsCheckbox","currentColorRgb","secondaryColorRgb","bgColorOverlay","updateBg","flexRow","$4c948640eb8ef791$export$309483fcb6d5c7ca","modeButtons","p0","areah","areaw","curveArea","createPoint","lock","internalY","internalX","newX","newY","updateControl","outCurves","drawCurve","spline","getDiv","$6b01e1931d168e01$export$9b1b7b3985b9625a","previewLayer","doFlipCanvas","horizontalCheckbox","verticalCheckbox","fcOption","borderTopLeftRadius","$1RI49","flOption","borderTopRightRadius","optionWrapper","horizontal","vertical","flipCanvas","$041c656037c77a96$export$2aa46bd5587f0eb","hueSlider","saturationSlider","Saturation","$82b3d1ba61b3412f$export$b7ebcfbdc840ef76","$460859cbeb601dec$export$a76d798fa7d85e4e","displayW","displayH","displayPreviewFactor","pointerListenerArr","bb","bc","bd","ac","ad","nob","updateAfter","beforeAfterTabs","$5vheV","TwoTabs","nobSize","$8b4f5ae4fe73ff76$var$activeColor","$8b4f5ae4fe73ff76$var$inactiveColor","$8b4f5ae4fe73ff76$var$hoverColor","$8b4f5ae4fe73ff76$export$b1241e74876d9bbe","leftTab","rightTab","$63d62a20f3ba2c7d$export$5705240d31427a82","previewW","previewH","algorithmSelect","canvasWrapper","inputWrapper","$jfTWC","constrainCheckbox","secondRowElement","$878715182dcd377b$export$ac7e9efc751d5791","WebkitTransform","MozTransform","OTransform","msTransform","btnPlus","btnMinus","$aa97ed406a9700f0$export$1b8796b18b7c19ed","fa","fb","blurSlider","gradientSlider","$31a0dd41d7428d32$export$dc15474d94cdc2b3","lastDrawnTransformStr","transformLayerCanvas","onInputsChanged","inputR","leftWrapper","rightWrapper","rotWrapper","actionBtnCss","buttonRow","flipXBtn","flipYBtn","scaleRotLeftBtn","scaleRotRightBtn","scaleDoubleBtn","getRatio","scaleHalfBtn","setConstrained","isSnapping","snappingCheckbox","setSnapping","checkboxWrapper","bottomRow","$95b95646154e8218$export$55e7eb2ebd0db869","radiusSlider","$82f12ab116cea855$export$62ac74a5ea43bd5c","strengthSlider","$a535e7a374deb8f5$export$6158ed2b22ebf4d9","sourceId","sourceOptions","$bad33651972f8d2c$export$50020de79e1bc23","renderW","renderH","$1xi6g","drawGrid","settingsObj","thickness","renderFactor","line1","line2","xInput","yInput","thicknessInput","$74df8e8cd35bce4e$export$20d2db9c68afeac","cellsX","cellsY","thickIsRound","pos1","$595c9469b8f94062$var$presetArr","$595c9469b8f94062$var$drawNoise","$595c9469b8f94062$export$1dab0536099042f5","presetCopy","presetIndex","thumbImgArr","preset","thumbImg","presetOptions","row1El","row2El","channelsOptions","blendSelect","colorWrapper","colInputStyle","colAInput","colBInput","$ebbf7e5d844153e5$var$drawPattern","blendOffsetX","blend","blendOffsetY","finalPatternCanvas","blendCanvas","blendCtx","colTransparent","colOpaque","blendGradient","syncInputs","sharpStrokeRect","drawX","drawY","drawWidth","drawHeight","lastDrawnSettings","previewMode","fullSizeCtx","fullSizeCanvas","pW","pH","overlayCtx","overlayCanvas","previewCtx1","inputStyle","oldSettings","x11","y11","$67bee9819cf9d9ba$export$77c344cc65ad0ed2","sync","from","sliderArr","glCanvas1","isSynced","settingsCopy","topRowEl","syncToggle","xyRowEl","leftCol","rightCol","sliderWidth","toUpperCase","phaseSlider","stepSlider","$9939d5f20537fa4b$export$a77e8ecd2a7fa9a5","$jsIPR","drawVanishPoint","lines","linesSlider","$cd59789add31bb97$export$8f57d6bdbceb36d0","degIncrement","$40b8cea12adf584e$export$92433b641be3f7a","$40b8cea12adf584e$var$_klCanvasToPsdBlob"],"version":3,"file":"main-embed.bb21c954.js.map"}