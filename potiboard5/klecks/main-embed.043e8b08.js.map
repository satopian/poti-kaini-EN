{"mappings":"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","sources":["src/app/script/main-embed.ts","src/app/script/polyfills.ts","node_modules/mdn-polyfills/Node.prototype.append.js","node_modules/mdn-polyfills/Node.prototype.prepend.js","node_modules/mdn-polyfills/String.prototype.padStart.js","src/app/script/app/kl-app.ts","src/app/script/klecks/kl.ts","src/app/script/klecks/history/kl-history.ts","src/app/script/klecks/ui/modals/popup.ts","src/app/script/klecks/ui/modals/modal-count.ts","src/app/script/bb/bb.ts","src/app/script/bb/input/event-listener.ts","src/app/script/bb/base/browser.ts","src/app/script/bb/base/create-canvas.ts","src/app/script/bb/base/base.ts","src/app/script/bb/input/key-listener.ts","src/app/script/bb/input/pointer-listener.ts","src/app/script/bb/math/math.ts","src/app/script/bb/input/event-chain.ts","src/app/script/bb/base/canvas.ts","src/app/script/bb/math/matrix.ts","src/app/script/bb/math/vec2.ts","src/app/script/bb/math/line.ts","src/app/script/bb/color/color.ts","src/app/script/bb/base/ui.ts","src/app/script/bb/base/bb-log.ts","src/app/script/bb/base/local-storage.ts","node_modules/@parcel/runtime-js/lib/runtime-34832b43d0ebd3bf.js","node_modules/@parcel/runtime-js/lib/runtime-a96f6567e6dac4f3.js","src/app/script/klecks/ui/base-components/checkbox.ts","src/app/script/klecks/ui/base-components/input.ts","src/app/script/klecks/ui/base-components/select.ts","src/app/script/klecks/ui/base-components/image-toggle.ts","src/app/script/klecks/ui/base-components/image-radio-list.ts","src/app/script/klecks/ui/base-components/pen-pressure-toggle.ts","node_modules/@parcel/runtime-js/lib/runtime-065238818b5d6d26.js","src/app/script/klecks/ui/base-components/kl-slider.ts","src/app/script/klecks/ui/base-components/slider-falloff.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-ce95b2abc71314b0.js","src/app/script/klecks/ui/base-components/kl-color-slider.ts","node_modules/@parcel/runtime-js/lib/runtime-e7bece06ac3b91da.js","src/app/script/klecks/ui/base-components/kl-color-slider-small.ts","src/app/script/klecks/ui/base-components/point-slider.ts","src/app/script/klecks/ui/base-components/color-options.ts","src/app/script/klecks/ui/base-components/options.ts","src/app/script/klecks/ui/components/status-overlay.ts","node_modules/@parcel/runtime-js/lib/runtime-76fc4a9796871f89.js","src/app/script/klecks/ui/modals/export-dialog-deprecated.ts","src/app/script/klecks/ui/components/crop-copy.ts","src/app/script/klecks/ui/modals/clipboard-dialog.ts","src/app/script/klecks/ui/tool-tabs/kl-layer-manager.ts","node_modules/@parcel/runtime-js/lib/runtime-9e9c6514323b50ff.js","node_modules/@parcel/runtime-js/lib/runtime-f141aefb87a862aa.js","node_modules/@parcel/runtime-js/lib/runtime-e93ed5f4a72fe388.js","node_modules/@parcel/runtime-js/lib/runtime-e1e96fa0dcd63695.js","node_modules/@parcel/runtime-js/lib/runtime-2d2417fe7f53ff5b.js","src/app/script/klecks/canvas/kl-canvas.ts","src/app/script/klecks/image-operations/flood-fill.ts","src/app/script/klecks/image-operations/shape-tool.ts","src/app/script/klecks/image-operations/render-text.ts","src/app/script/klecks/canvas/draw-project.ts","src/app/script/klecks/canvas/translate-blending.ts","src/app/script/klecks/canvas-ui/workspace-svg-overlay.ts","src/app/script/klecks/canvas-ui/kl-canvas-workspace.ts","node_modules/@parcel/runtime-js/lib/runtime-ce6158b179cda36d.js","node_modules/@parcel/runtime-js/lib/runtime-9180b336d2c14eb8.js","node_modules/@parcel/runtime-js/lib/runtime-e98ceba16f4f3e8c.js","node_modules/@parcel/runtime-js/lib/runtime-1c4e2d66dbd3cd26.js","src/app/script/klecks/canvas-ui/canvas-preview.ts","src/app/script/klecks/ui/components/free-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-7b1b46c773a5d5de.js","src/app/script/klecks/ui/components/free-transform-canvas.ts","src/app/script/klecks/ui/components/cropper.ts","src/app/script/klecks/ui/components/layer-preview.ts","src/app/script/klecks/ui/components/fitted-image.ts","src/app/script/klecks/ui/modals/show-import-as-layer-dialog.ts","src/app/script/klecks/ui/components/kl-image-dropper.ts","src/app/script/klecks/ui/components/overlay-toolspace.ts","src/app/script/klecks/ui/components/toolspace-top-row.ts","node_modules/@parcel/runtime-js/lib/runtime-c595ccae60beff87.js","node_modules/@parcel/runtime-js/lib/runtime-e5d7180bbee5b536.js","node_modules/@parcel/runtime-js/lib/runtime-6c52a4e8d76ec49b.js","node_modules/@parcel/runtime-js/lib/runtime-fa73233744fc505c.js","node_modules/@parcel/runtime-js/lib/runtime-b34e92e9fb9b8c68.js","node_modules/@parcel/runtime-js/lib/runtime-8a2022a1c05c8770.js","src/app/script/klecks/ui/components/tool-dropdown.ts","node_modules/@parcel/runtime-js/lib/runtime-760df77bff0950f0.js","node_modules/@parcel/runtime-js/lib/runtime-ff3da4d7dabee86d.js","node_modules/@parcel/runtime-js/lib/runtime-297f8366ec2375c9.js","node_modules/@parcel/runtime-js/lib/runtime-d831990ac91a582d.js","node_modules/@parcel/runtime-js/lib/runtime-621488e8bcab6d4d.js","src/app/script/klecks/ui/components/toolspace-tool-row.ts","node_modules/@parcel/runtime-js/lib/runtime-7355152122a84936.js","node_modules/@parcel/runtime-js/lib/runtime-81519c452bdfbaa9.js","node_modules/@parcel/runtime-js/lib/runtime-3fc59c96423b70ad.js","node_modules/@parcel/runtime-js/lib/runtime-1eef10cb07c9c851.js","src/app/script/klecks/ui/components/toolspace-stabilizer-row.ts","src/app/script/klecks/ui/components/tab-row.ts","node_modules/@parcel/runtime-js/lib/runtime-b9f67aff2ffaa235.js","src/app/script/klecks/ui/tool-tabs/hand-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-4486cf75fca81822.js","src/app/script/klecks/ui/tool-tabs/fill-ui.ts","src/app/script/klecks/ui/tool-tabs/text-ui.ts","src/app/script/klecks/ui/tool-tabs/shape-ui.ts","src/app/script/klecks/ui/modals/new-image-dialog.ts","src/app/script/klecks/ui/components/toolspace-collapser.ts","node_modules/@parcel/runtime-js/lib/runtime-3ca3a85d3436a84f.js","src/app/script/klecks/ui/modals/text-tool-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-47401ec572d2cfcf.js","node_modules/@parcel/runtime-js/lib/runtime-6476cf999a0e75d3.js","node_modules/@parcel/runtime-js/lib/runtime-4ee49cef2a1bfd51.js","node_modules/@parcel/runtime-js/lib/runtime-01d9fe07522d7373.js","node_modules/@parcel/runtime-js/lib/runtime-8450ca7f4e68dde7.js","src/app/script/klecks/ui/modals/show-import-image-dialog.ts","src/app/script/klecks/storage/psd.ts","src/app/script/klecks/storage/indexed-db.ts","src/app/script/klecks/filters/filters.ts","node_modules/@parcel/runtime-js/lib/runtime-08ec85fc3ea564e8.js","node_modules/@parcel/runtime-js/lib/runtime-c105dce751d9b16c.js","node_modules/@parcel/runtime-js/lib/runtime-272cd0cc0051d99c.js","node_modules/@parcel/runtime-js/lib/runtime-d623cec3e031c802.js","node_modules/@parcel/runtime-js/lib/runtime-4aa563d1de55ad17.js","node_modules/@parcel/runtime-js/lib/runtime-acf5209c71eb3497.js","node_modules/@parcel/runtime-js/lib/runtime-726a62492af9f94e.js","node_modules/@parcel/runtime-js/lib/runtime-f1cff4f2714da535.js","node_modules/@parcel/runtime-js/lib/runtime-06b47f2ffca8a188.js","node_modules/@parcel/runtime-js/lib/runtime-866a2902b0cdf580.js","node_modules/@parcel/runtime-js/lib/runtime-3b4878106cdf1b9c.js","node_modules/@parcel/runtime-js/lib/runtime-02847deebefdd0a7.js","node_modules/@parcel/runtime-js/lib/runtime-3dce3f08da564a07.js","src/app/script/klecks/brushes/brushes.ts","src/app/script/klecks/brushes/pen-brush.ts","src/app/script/klecks/brushes/brushes-common.ts","src/app/script/klecks/brushes/alphas/brush-alphas.ts","src/app/script/bb/math/perlin.ts","src/app/script/klecks/brushes/blend-brush.ts","src/app/script/klecks/brushes/sketchy-brush.ts","src/app/script/klecks/brushes/pixel-brush.ts","src/app/script/klecks/brushes/eraser-brush.ts","src/app/script/klecks/brushes/smudge-brush.ts","src/app/script/klecks/brushes/chemy-brush.ts","src/app/script/klecks/brushes-ui/brushes-ui.ts","src/app/script/klecks/brushes-ui/pen-brush-ui.ts","src/app/script/klecks/brushes-ui/brushes-consts.ts","node_modules/@parcel/runtime-js/lib/runtime-f5fee83b55dfe524.js","src/app/script/klecks/brushes-ui/blend-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-c1ff462122383f3a.js","src/app/script/klecks/brushes-ui/sketchy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-c362cafb743e4bf7.js","src/app/script/klecks/brushes-ui/pixel-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-9083363aed84d015.js","src/app/script/klecks/brushes-ui/eraser-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-72d61ca9dbc6379a.js","src/app/script/klecks/brushes-ui/smudge-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-2e54934a27c8b910.js","src/app/script/klecks/brushes-ui/chemy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-a3466c6b7be08d45.js","src/app/script/klecks/ui/base-components/box-toggle.ts","src/app/script/klecks/ui/modals/show-iframe-popup.ts","src/app/script/klecks/ui/base-components/radio-list.ts","src/app/script/klecks/ui/components/browser-storage-ui.ts","src/app/script/klecks/storage/project-store.ts","src/app/script/klecks/storage/project-converter.ts","src/app/script/klecks/storage/base-64-to-blob.ts","src/app/script/klecks/ui/tool-tabs/file-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-174f5efa9e6f0131.js","src/app/script/klecks/ui/tool-tabs/filter-tab.ts","src/app/script/klecks/ui/modals/imgur-upload.ts","node_modules/@parcel/runtime-js/lib/runtime-257b8f01a8ca9ad6.js","src/app/script/klecks/storage/ag-psd-wrapper.ts","node_modules/@parcel/runtime-js/lib/runtime-5ea32053680ef652.js","src/app/script/klecks/ui/components/save-reminder.ts","src/app/script/klecks/storage/save-to-computer.ts","node_modules/file-saver/src/FileSaver.js","src/app/script/klecks/history/undo-redo-catchup.ts","src/app/script/klecks/brushes-ui/brush-setting-service.ts","src/app/script/klecks/ui/tool-tabs/settings-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-3e3712af4386deba.js","node_modules/@parcel/runtime-js/lib/runtime-050615743b2088cc.js","node_modules/@parcel/runtime-js/lib/runtime-4135c6b241ed0f39.js","src/app/script/klecks/ui/components/toolspace-scroller.ts","src/app/script/embed/toolspace-top-row.ts","src/app/script/klecks/filters/filters-lazy.ts","src/app/script/klecks/filters/gl-brightness-contrast.ts","src/app/script/klecks/filters/filters-consts.ts","src/app/script/klecks/filters/shared-gl-fx.ts","src/app/script-vendor/glfx.ts","src/app/script/klecks/filters/crop-extend.ts","src/app/script/klecks/filters/gl-curves.ts","src/app/script/klecks/filters/flip.ts","src/app/script/klecks/filters/gl-perspective.ts","node_modules/@parcel/runtime-js/lib/runtime-0b614230dd5a2fbc.js","src/app/script/klecks/filters/gl-hue-saturation.ts","src/app/script/klecks/filters/invert.ts","src/app/script/klecks/filters/resize.ts","src/app/script/klecks/filters/gl-tilt-shift.ts","src/app/script/klecks/filters/rotate.ts","node_modules/@parcel/runtime-js/lib/runtime-c388461235ee692d.js","src/app/script/klecks/filters/transform.ts","src/app/script/klecks/filters/gl-blur.ts","src/app/script/klecks/filters/gl-unsharp-mask.ts","src/app/script/klecks/filters/to-alpha.ts","src/app/script/klecks/storage/kl-canvas-to-psd-blob.ts","node_modules/@parcel/runtime-js/lib/runtime-fe04d655c2a3180f.js","node_modules/@parcel/runtime-js/lib/runtime-f15ea15a7900b9a3.js"],"sourcesContent":["import './polyfills';\r\nimport {KlApp} from './app/kl-app';\r\nimport {IKlProject} from './klecks/kl.types';\r\nimport {SaveReminder} from './klecks/ui/components/save-reminder';\r\nimport {klHistory} from './klecks/history/kl-history';\r\nimport {klPsdToKlProject, readPsd} from './klecks/storage/psd';\r\nimport {LANG} from './language/language';\r\n\r\nexport interface IEmbedParams {\r\n    project?: IKlProject,\r\n    psdBlob?: Blob,\r\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    embedUrl: string;\r\n    logoImg?: any;\r\n    bottomBar?: HTMLElement;\r\n    aboutEl?: HTMLElement;\r\n}\r\n\r\nexport interface IReadPSD {\r\n    blob: Blob;\r\n    callback: (k: IKlProject) => void;\r\n}\r\n\r\nexport function Embed(p: IEmbedParams) {\r\n\r\n    let isInitialized: boolean = false;\r\n    let klApp;\r\n    const psdQueue: IReadPSD[] = []; // queue of psds waiting while ag-psd is loading\r\n    let agPsd: any | 'error';\r\n\r\n    let loadingScreenEl = document.getElementById(\"loading-screen\");\r\n    let loadingScreenTextEl = document.getElementById(\"loading-screen-text\");\r\n    if (loadingScreenTextEl) {\r\n        loadingScreenTextEl.textContent = LANG('embed-init-waiting');\r\n    }\r\n\r\n    function onProjectReady(project: IKlProject) {\r\n        try {\r\n            if (isInitialized) {\r\n                throw new Error('Already called openProject');\r\n            }\r\n            isInitialized = true;\r\n\r\n            const saveReminder = new SaveReminder(\r\n                klHistory,\r\n                false,\r\n                false,\r\n                () => {},\r\n                () => klApp ? klApp.isDrawing() : false,\r\n                null,\r\n                null,\r\n            );\r\n            klApp = new KlApp(\r\n                project,\r\n                {\r\n                    saveReminder,\r\n                    bottomBar: p.bottomBar,\r\n                    aboutEl: p.aboutEl,\r\n                    embed: {\r\n                        url: p.embedUrl,\r\n                        onSubmit: p.onSubmit,\r\n                    }\r\n                }\r\n            );\r\n            saveReminder.init();\r\n\r\n            if (loadingScreenEl && loadingScreenEl.parentNode) {\r\n                loadingScreenEl.parentNode.removeChild(loadingScreenEl);\r\n            }\r\n            loadingScreenEl = null;\r\n            loadingScreenTextEl = null;\r\n\r\n            document.body.appendChild(klApp.getEl());\r\n        } catch (e) {\r\n            if (loadingScreenTextEl) {\r\n                loadingScreenTextEl.textContent = ' ' + e;\r\n            }\r\n            if (loadingScreenEl) {\r\n                loadingScreenEl.className += 'loading-screen-error';\r\n            }\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    if (p.project) {\r\n        onProjectReady(p.project);\r\n    }\r\n    this.openProject = onProjectReady;\r\n    this.initError = (error: string) => {\r\n        if (loadingScreenTextEl) {\r\n            loadingScreenTextEl.textContent = ' ' + error;\r\n        }\r\n        if (loadingScreenEl) {\r\n            loadingScreenEl.className += 'loading-screen-error';\r\n        }\r\n    };\r\n    this.getPNG = (): Blob => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return klApp.getPNG();\r\n    };\r\n    this.getPSD = async (): Promise<Blob> => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return await klApp.getPSD();\r\n    };\r\n    this.readPSDs = (psds: IReadPSD[]) => {\r\n        if (psds.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const readItem = (item: IReadPSD) => {\r\n            try {\r\n                const psd = agPsd.readPsd(item.blob);\r\n                const project = klPsdToKlProject(readPsd(psd));\r\n                item.callback(project);\r\n            } catch (e) {\r\n                console.error('failed to read psd', e);\r\n                item.callback(null);\r\n            }\r\n        };\r\n\r\n        if (!agPsd) {\r\n            if (psdQueue.length === 0) {\r\n                // load ag-psd\r\n                (async () => {\r\n                    try {\r\n                        agPsd = await import('ag-psd');\r\n                    } catch (e) {\r\n                        agPsd = 'error';\r\n                    }\r\n                    while (psdQueue.length) {\r\n                        readItem(psdQueue.shift());\r\n                    }\r\n                })();\r\n            }\r\n            psds.forEach(item => {\r\n                psdQueue.push(item);\r\n            });\r\n        } else {\r\n            psds.forEach(readItem);\r\n        }\r\n    };\r\n}","// import 'core-js';\r\nimport 'mdn-polyfills/Node.prototype.append';\r\nimport 'mdn-polyfills/Node.prototype.prepend';\r\nimport 'mdn-polyfills/String.prototype.padStart';\r\n\r\nif (!('scrollTo' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollTo', {\r\n        value: function (x, y) {\r\n            this.scrollLeft = x;\r\n            this.scrollTop = y;\r\n        }\r\n    });\r\n}\r\n\r\nif (!('scrollBy' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollBy', {\r\n        value: function (x, y) {\r\n            this.scrollLeft += x;\r\n            this.scrollTop += y;\r\n        }\r\n    });\r\n}\r\n\r\n// sometimes Android WebView has no localStorage\r\nif (!('localStorage' in window)) {\r\n    try {\r\n        window['localStorage'] = {\r\n            getItem: () => null,\r\n            setItem: () => {},\r\n            removeItem: () => {},\r\n        } as any;\r\n    } catch (e) {\r\n        // maybe it doesn't let me set this\r\n    }\r\n}","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"append\")||Object.defineProperty(e,\"append\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(n,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"prepend\")||Object.defineProperty(e,\"prepend\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","String.prototype.padStart||(String.prototype.padStart=function(t,n){return t>>=0,n=String(n||\" \"),this.length>t?String(this):((t-=this.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(this))});\n","import {KL} from '../klecks/kl';\r\nimport {klHistory} from '../klecks/history/kl-history';\r\nimport {BB} from '../bb/bb';\r\nimport {showIframePopup} from '../klecks/ui/modals/show-iframe-popup';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\nimport {exportType} from '../klecks/ui/tool-tabs/file-tab';\r\nimport {ToolspaceTopRow} from \"../embed/toolspace-top-row\";\r\nimport {IInitState, IKlProject, IKlPsd} from '../klecks/kl.types';\r\nimport {importFilters} from '../klecks/filters/filters-lazy';\r\nimport {base64ToBlob} from '../klecks/storage/base-64-to-blob';\r\nimport {klCanvasToPsdBlob} from '../klecks/storage/kl-canvas-to-psd-blob';\r\nimport {ProjectStore} from '../klecks/storage/project-store';\r\nimport {SaveReminder} from \"../klecks/ui/components/save-reminder\";\r\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\r\nimport {LANG} from '../language/language';\r\n// @ts-ignore\r\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\r\n// @ts-ignore\r\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\r\n// @ts-ignore\r\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\r\n// @ts-ignore\r\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\r\n// @ts-ignore\r\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\r\n// @ts-ignore\r\nimport tabSettingsImg from 'url:~/src/app/img/ui/tab-settings.svg';\r\n// @ts-ignore\r\nimport tabLayersImg from 'url:~/src/app/img/ui/tab-layers.svg';\r\nimport {LocalStorage} from '../bb/base/local-storage';\r\n\r\n\r\ninterface IKlAppOptions {\r\n    saveReminder?: SaveReminder;\r\n    projectStore?: ProjectStore;\r\n    logoImg?: any; // app logo\r\n    bottomBar?: HTMLElement; // row at bottom of toolspace\r\n    embed?: {\r\n        url: string;\r\n        onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    };\r\n    app?: {\r\n        filenameBase?: string; // part of filename when downloading drawing\r\n        imgurKey?: string; // for imgur uploads\r\n    };\r\n    aboutEl?: HTMLElement; // replaces info about Klecks in settings tab\r\n}\r\n\r\nimportFilters();\r\n\r\nexport function KlApp(pProject: IKlProject | null, pOptions: IKlAppOptions) {\r\n    // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\r\n    // but not larger than 4096 - a fairly arbitrary decision\r\n    let klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\r\n    let collapseThreshold = 820;\r\n    let uiState: 'left' | 'right' = (pOptions.embed ? 'left' : (LocalStorage.getItem('uiState') ? LocalStorage.getItem('uiState') : 'right')) as any;\r\n    const filenameBase = pOptions.app?.filenameBase ? pOptions.app.filenameBase : 'Klecks';\r\n    const projectStore = pOptions.projectStore;\r\n    let klRootEl = document.createElement(\"div\");\r\n    klRootEl.className = 'g-root';\r\n    let uiWidth: number = Math.max(0, window.innerWidth);\r\n    let uiHeight: number = Math.max(0, window.innerHeight);\r\n    const toolWidth = 271;\r\n    let exportType: exportType = 'png';\r\n    let klCanvas: KlCanvas = new KL.KlCanvas(\r\n        pProject ? {\r\n            projectObj: pProject\r\n        } : {\r\n            width: Math.max(10, Math.min(klMaxCanvasSize, window.innerWidth < collapseThreshold ? uiWidth : uiWidth - toolWidth)),\r\n            height: Math.max(10, Math.min(klMaxCanvasSize, uiHeight)),\r\n        }, pOptions.embed ? -1 : 0);\r\n    klCanvas.setHistory(klHistory);\r\n    let initState: IInitState = null;\r\n    let mainTabRow;\r\n\r\n    if (!pOptions.saveReminder) {\r\n        pOptions.saveReminder = {init: () => {}, reset: () => {}} as SaveReminder;\r\n    }\r\n\r\n    function translateSmoothing(s: number): number {\r\n        if (s == 1) {\r\n            return 1 - 0.5;\r\n        }\r\n        if (s == 2) {\r\n            return 1 - 0.16;\r\n        }\r\n        if (s == 3) {\r\n            return 1 - 0.035;\r\n        }\r\n        if (s == 4) {\r\n            return 1 - 0.0175;\r\n        }\r\n        if (s == 5) {\r\n            return 1 - 0.00875;\r\n        }\r\n        return s;\r\n    }\r\n\r\n    let isFirstImage = true;\r\n\r\n    if (pProject) {\r\n        pProject.layers.forEach(layer => {\r\n            layer.image = null;\r\n        });\r\n        pProject = null;\r\n    } else {\r\n        klHistory.pause(true);\r\n        klCanvas.addLayer();\r\n        klCanvas.layerFill(0, { r: 255, g: 255, b: 255});\r\n        klHistory.pause(false);\r\n    }\r\n    try {\r\n        initState = {\r\n            canvas: new KL.KlCanvas({copy: klCanvas}, pOptions.embed ? -1 : 0),\r\n            focus: klCanvas.getLayerCount() - 1,\r\n            brushes: {},\r\n        };\r\n    } catch (e) {\r\n        if (e.message === 'kl-create-canvas-error') {\r\n            klCanvas.destroy();\r\n        }\r\n        throw e;\r\n    }\r\n    for (let b in KL.brushes) {\r\n        if (KL.brushes.hasOwnProperty(b)) {\r\n            initState.brushes[b] = new KL.brushes[b]();\r\n            if (initState.canvas) {\r\n                initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    let currentColor = new BB.RGB(0, 0, 0);\r\n    let currentBrush, currentBrushId;\r\n    let lastNonEraserBrushId = 0;\r\n    let currentLayerCtx = klCanvas.getLayerContext(klCanvas.getLayerCount() - 1);\r\n\r\n    function sizeWatcher(val) {\r\n        brushSettingService.emitSize(val);\r\n        if (klCanvasWorkspace) {\r\n            klCanvasWorkspace.setCursorSize(val * 2);\r\n        }\r\n    }\r\n\r\n    const brushSettingService = new KL.BrushSettingService(\r\n        (color) => {\r\n            klColorSlider.setColor(color);\r\n            currentBrush.setColor(color);\r\n            currentColor = BB.copyObj(color);\r\n        },\r\n        (size) => {\r\n            currentBrush.setSize(size);\r\n            klCanvasWorkspace.setCursorSize(size * 2);\r\n        },\r\n        (opacity) => {\r\n            currentBrush.setOpacity(opacity);\r\n        },\r\n        () => klColorSlider.getColor(),\r\n        () => brushUiObj[currentBrushId].getSize(),\r\n        () => brushUiObj[currentBrushId].getOpacity(),\r\n        () => {\r\n            return {\r\n                sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\r\n            };\r\n        }\r\n    );\r\n\r\n    let lineSmoothing = new BB.EventChain.LineSmoothing({\r\n        smoothing: translateSmoothing(1),\r\n    });\r\n    let lineSanitizer = new BB.EventChain.LineSanitizer();\r\n\r\n    let drawEventChain = new BB.EventChain.EventChain({\r\n        chainArr: [\r\n            lineSanitizer,\r\n            lineSmoothing\r\n        ],\r\n    });\r\n\r\n    drawEventChain.setChainOut(function(event) {\r\n        if (event.type === 'down') {\r\n            toolspace.style.pointerEvents = 'none';\r\n            currentBrush.startLine(event.x, event.y, event.pressure);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'move') {\r\n            currentBrush.goLine(event.x, event.y, event.pressure, false, event.isCoalesced)\r\n            klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'up') {\r\n            toolspace.style.pointerEvents = '';\r\n            currentBrush.endLine();\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'line') {\r\n            currentBrush.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n    });\r\n\r\n    let textToolSettings = {\r\n        size: 20,\r\n        align: 'left' as ('left' | 'center' | 'right'),\r\n        isBold: false,\r\n        isItalic: false,\r\n        font: 'sans-serif' as ('serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'),\r\n        opacity: 1\r\n    };\r\n\r\n    const klCanvasWorkspace: KlCanvasWorkspace = new KL.KlCanvasWorkspace({\r\n        klCanvas: klCanvas,\r\n        width: Math.max(0, uiWidth - toolWidth),\r\n        height: uiHeight,\r\n        onDraw: drawEventChain.chainIn,\r\n        onPick: function(rgbObj, isDragDone) {\r\n            brushSettingService.setColor(rgbObj);\r\n            if (isDragDone) {\r\n                klColorSlider.pickingDone();\r\n                klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\r\n            }\r\n        },\r\n        onFill: function(canvasX, canvasY) {\r\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n            klCanvas.floodFill(layerIndex, canvasX, canvasY, klColorSlider.getColor(), fillUi.getOpacity(), fillUi.getTolerance(), fillUi.getSample(), fillUi.getGrow(), fillUi.getContiguous());\r\n            klCanvasWorkspace.requestFrame();\r\n        },\r\n        onText: function(canvasX, canvasY, angleRad) {\r\n            if (KL.dialogCounter.get() > 0) {\r\n                return;\r\n            }\r\n\r\n            KL.textToolDialog({\r\n                klCanvas: klCanvas,\r\n                layerIndex: klCanvas.getLayerIndex(currentLayerCtx.canvas),\r\n                x: canvasX,\r\n                y: canvasY,\r\n                angleRad: angleRad,\r\n                color: klColorSlider.getColor(),\r\n                secondaryColor: klColorSlider.getSecondaryRGB(),\r\n                size: textToolSettings.size,\r\n                align: textToolSettings.align,\r\n                isBold: textToolSettings.isBold,\r\n                isItalic: textToolSettings.isItalic,\r\n                font: textToolSettings.font,\r\n                opacity: textToolSettings.opacity,\r\n                onConfirm: function(val) {\r\n\r\n                    let colorRGBA = val.color;\r\n                    colorRGBA.a = val.opacity;\r\n\r\n                    textToolSettings.size = val.size;\r\n                    textToolSettings.align = val.align;\r\n                    textToolSettings.isBold = val.isBold;\r\n                    textToolSettings.isItalic = val.isItalic;\r\n                    textToolSettings.font = val.font;\r\n                    textToolSettings.opacity = val.opacity;\r\n\r\n                    let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                    klCanvas.text(layerIndex, {\r\n                        textStr: val.textStr,\r\n                        x: val.x,\r\n                        y: val.y,\r\n                        size: val.size,\r\n                        font: val.font,\r\n                        align: val.align,\r\n                        isBold: val.isBold,\r\n                        isItalic: val.isItalic,\r\n                        angleRad: angleRad,\r\n                        color: BB.ColorConverter.toRgbaStr(colorRGBA)\r\n                    });\r\n                    klCanvasWorkspace.requestFrame();\r\n                }\r\n            });\r\n\r\n        },\r\n        onShape: function(typeStr, canvasX, canvasY, angleRad) {\r\n            if (typeStr === 'down') {\r\n                shapeTool.onDown(canvasX, canvasY, angleRad);\r\n            }\r\n            if (typeStr === 'move') {\r\n                shapeTool.onMove(canvasX, canvasY);\r\n            }\r\n            if (typeStr === 'up') {\r\n                shapeTool.onUp(canvasX, canvasY);\r\n            }\r\n        },\r\n\r\n        onViewChange: function(viewChangeObj) {\r\n\r\n            if (viewChangeObj.changed.includes('scale')) {\r\n                statusOverlay.out({\r\n                    type: 'transform',\r\n                    scale: viewChangeObj.scale,\r\n                    angleDeg: viewChangeObj.angle * 180 / Math.PI\r\n                });\r\n            }\r\n\r\n            toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== klCanvasWorkspace.getMaxScale());\r\n            toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== klCanvasWorkspace.getMinScale());\r\n\r\n            handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\r\n        },\r\n        onUndo: function() {\r\n            if (klHistory.canUndo()) {\r\n                if (undoRedoCatchup.undo()) {\r\n                    statusOverlay.out(LANG('undo'), true);\r\n                }\r\n            }\r\n        },\r\n        onRedo: function() {\r\n            if (klHistory.canRedo()) {\r\n                if (undoRedoCatchup.redo()) {\r\n                    statusOverlay.out(LANG('redo'), true);\r\n                }\r\n            }\r\n        },\r\n    });\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, event, comboStr) {\r\n            if (KL.dialogCounter.get() > 0) {\r\n                return;\r\n            }\r\n            if (BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n\r\n            let isDrawing = lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\r\n            if (isDrawing) {\r\n                return;\r\n            }\r\n\r\n            if (comboStr === 'plus') {\r\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n            }\r\n            if (comboStr === 'minus') {\r\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n            }\r\n            if (comboStr === 'home') {\r\n                klCanvasWorkspace.fitView();\r\n            }\r\n            if (comboStr === 'end') {\r\n                klCanvasWorkspace.resetView(true);\r\n            }\r\n            if (['ctrl+z', 'cmd+z'].includes(comboStr)) {\r\n                event.preventDefault();\r\n                undoRedoCatchup.undo();\r\n            }\r\n            if (\r\n                ['ctrl+y', 'cmd+y'].includes(comboStr) ||\r\n                (\r\n                    (\r\n                        BB.sameKeys('ctrl+shift+z', comboStr) ||\r\n                        BB.sameKeys('cmd+shift+z', comboStr)\r\n                    ) && keyStr === 'z'\r\n                )\r\n            ) {\r\n                event.preventDefault();\r\n                undoRedoCatchup.redo();\r\n            }\r\n            if (!pOptions.embed) {\r\n                if (['ctrl+s', 'cmd+s'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    saveToComputer.save();\r\n                }\r\n                if (['ctrl+shift+s', 'cmd+shift+s'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n\r\n                    (async () => {\r\n                        let success = true;\r\n                        try {\r\n                            await projectStore.store(klCanvas.getProject());\r\n                        } catch (e) {\r\n                            success = false;\r\n                            setTimeout(() => {\r\n                                throw new Error('keyboard-shortcut: failed to store browser storage, ' + e);\r\n                            }, 0);\r\n                            statusOverlay.out(' ' + LANG('file-storage-failed'), true);\r\n                        }\r\n                        if (success) {\r\n                            pOptions.saveReminder.reset();\r\n                            statusOverlay.out(LANG('file-storage-stored'), true);\r\n                        }\r\n                    })();\r\n                }\r\n                if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    copyToClipboard(true);\r\n                }\r\n            }\r\n            if (['ctrl+a', 'cmd+a'].includes(comboStr)) {\r\n                event.preventDefault();\r\n            }\r\n\r\n\r\n            if (keyListener.comboOnlyContains(['left', 'right', 'up', 'down'])) {\r\n                if (keyStr === 'left') {\r\n                    klCanvasWorkspace.translateView(1, 0);\r\n                }\r\n                if (keyStr === 'right') {\r\n                    klCanvasWorkspace.translateView(-1, 0);\r\n                }\r\n                if (keyStr === 'up') {\r\n                    klCanvasWorkspace.translateView(0, 1);\r\n                }\r\n                if (keyStr === 'down') {\r\n                    klCanvasWorkspace.translateView(0, -1);\r\n                }\r\n            }\r\n\r\n\r\n            if (['r+left','r+right'].includes(comboStr)) {\r\n                if (keyStr === 'left') {\r\n                    klCanvasWorkspace.setAngle(-15, true);\r\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n                }\r\n                if (keyStr === 'right') {\r\n                    klCanvasWorkspace.setAngle(15, true);\r\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n                }\r\n            }\r\n            if (['r+up'].includes(comboStr)) {\r\n                klCanvasWorkspace.setAngle(0);\r\n                handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n            }\r\n\r\n\r\n            if (comboStr === 'sqbr_open') {\r\n                currentBrush.decreaseSize(0.03 / klCanvasWorkspace.getScale());\r\n            }\r\n            if (comboStr === 'sqbr_close') {\r\n                currentBrush.increaseSize(0.03 / klCanvasWorkspace.getScale());\r\n            }\r\n            if (comboStr === 'enter') {\r\n                klCanvas.layerFill(klCanvas.getLayerIndex(currentLayerCtx.canvas), klColorSlider.getColor());\r\n                statusOverlay.out(LANG('filled'), true);\r\n            }\r\n            if (['delete', 'backspace'].includes(comboStr)) {\r\n                let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                if (layerIndex === 0 && !brushUiObj.eraserBrush.getIsTransparentBg()) {\r\n                    klCanvas.layerFill(layerIndex, {r: 255, g: 255, b: 255}, 'source-in');\r\n                } else {\r\n                    klCanvas.clearLayer(layerIndex);\r\n                }\r\n                statusOverlay.out(LANG('cleared-layer'), true);\r\n            }\r\n            if (comboStr === 'e') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('draw');\r\n                toolspaceToolRow.setActive('draw');\r\n                mainTabRow.open('draw');\r\n                updateMainTabVisibility();\r\n                brushTabRow.open('eraserBrush');\r\n            }\r\n            if (comboStr === 'b') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('draw');\r\n                toolspaceToolRow.setActive('draw');\r\n                mainTabRow.open('draw');\r\n                updateMainTabVisibility();\r\n                brushTabRow.open(lastNonEraserBrushId);\r\n            }\r\n            if (comboStr === 'g') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('fill');\r\n                toolspaceToolRow.setActive('fill');\r\n                mainTabRow.open('fill');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 't') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('text');\r\n                toolspaceToolRow.setActive('text');\r\n                mainTabRow.open('text');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 'u') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('shape');\r\n                toolspaceToolRow.setActive('shape');\r\n                mainTabRow.open('shape');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 'x') {\r\n                event.preventDefault();\r\n                klColorSlider.swapColors();\r\n            }\r\n\r\n\r\n        },\r\n        onUp: function(keyStr, event) {\r\n        }\r\n    });\r\n\r\n    /**\r\n     *\r\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\r\n     * @param filename - string e.g. 'drawing.psd'\r\n     * @param optionStr? - 'default' | 'layer' | 'image'\r\n     */\r\n    function importFinishedLoading(\r\n        importedImage: IKlPsd | {\r\n            type: 'image';\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLCanvasElement | HTMLImageElement;\r\n        },\r\n        filename: string,\r\n        optionStr: 'default' | 'layer' | 'image',\r\n    ) {\r\n        if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                type: \"error\",\r\n                message: LANG('import-broken-file'),\r\n                buttons: [\"Ok\"],\r\n            });\r\n            return;\r\n        }\r\n\r\n        function getResizedDimensions(width, height) {\r\n            let w = parseInt(width);\r\n            let h = parseInt(height);\r\n            if (w > klMaxCanvasSize) {\r\n                h = klMaxCanvasSize / w * h;\r\n                w = klMaxCanvasSize;\r\n            }\r\n            if (h > klMaxCanvasSize) {\r\n                w = klMaxCanvasSize / h * w;\r\n                h = klMaxCanvasSize;\r\n            }\r\n            w = parseInt('' + w);\r\n            h = parseInt('' + h);\r\n            return {\r\n                width: w,\r\n                height: h\r\n            }\r\n        }\r\n\r\n        function importAsImage(canvas) {\r\n            let resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\r\n\r\n            //resize first\r\n            let tempCanvas = BB.canvas(canvas.width, canvas.height);\r\n            let tempCanvasCtx = tempCanvas.getContext('2d');\r\n            tempCanvasCtx.drawImage(canvas, 0, 0);\r\n\r\n            BB.resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\r\n\r\n            klCanvas.reset({\r\n                width: resizedDimensions.width,\r\n                height: resizedDimensions.height,\r\n                image: tempCanvas,\r\n                layerName: filename\r\n            });\r\n\r\n            layerManager.update(0);\r\n            setCurrentLayer(klCanvas.getLayer(0));\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n            isFirstImage = false;\r\n        }\r\n\r\n        /**\r\n         *\r\n         * @param convertedPsdObj - if flattened then without layers\r\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\r\n         */\r\n        function importAsImagePsd(convertedPsdObj: IKlPsd, cropObj?) {\r\n\r\n            // crop\r\n            function crop(targetCanvas, cropCanvas, cropObj) {\r\n                cropCanvas.width = cropCanvas.width;\r\n                cropCanvas.getContext('2d').drawImage(targetCanvas, -cropObj.x, -cropObj.y);\r\n                targetCanvas.width = cropObj.width;\r\n                targetCanvas.height = cropObj.height;\r\n                targetCanvas.getContext('2d').drawImage(cropCanvas, 0, 0);\r\n            }\r\n            if (cropObj && (cropObj.width !== convertedPsdObj.width ||cropObj.height !== convertedPsdObj.height)) {\r\n                let cropCanvas = BB.canvas(cropObj.width, cropObj.height);\r\n                convertedPsdObj.width = cropObj.width;\r\n                convertedPsdObj.height = cropObj.height;\r\n\r\n                if (!convertedPsdObj.layers) {\r\n                    crop(convertedPsdObj.canvas, cropCanvas, cropObj);\r\n                }\r\n                if (convertedPsdObj.layers) {\r\n                    for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                        let item = convertedPsdObj.layers[i];\r\n                        crop(item.image, cropCanvas, cropObj);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // resize\r\n            let resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\r\n            convertedPsdObj.width = resizedDimensions.width;\r\n            convertedPsdObj.height = resizedDimensions.height;\r\n            if (!convertedPsdObj.layers) {\r\n                BB.resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\r\n            }\r\n            if (convertedPsdObj.layers) {\r\n                for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                    let item = convertedPsdObj.layers[i];\r\n                    BB.resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\r\n                }\r\n            }\r\n\r\n            let layerIndex;\r\n            if (convertedPsdObj.layers) {\r\n                layerIndex = klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    layers: convertedPsdObj.layers\r\n                });\r\n            } else {\r\n                layerIndex = klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    image: convertedPsdObj.canvas\r\n                });\r\n            }\r\n            layerManager.update(layerIndex);\r\n            setCurrentLayer(klCanvas.getLayer(layerIndex));\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n            isFirstImage = false;\r\n        }\r\n\r\n        function importAsLayer(canvas) {\r\n            KL.showImportAsLayerDialog({\r\n                target: klRootEl,\r\n                klCanvas: klCanvas,\r\n                importImage: canvas,\r\n                callback: function(transformObj, isPixelated: boolean) {\r\n                    if (!transformObj) {\r\n                        return;\r\n                    }\r\n\r\n                    klHistory.pause(true);\r\n                    klCanvas.addLayer();\r\n                    let layers = klCanvas.getLayers();\r\n                    let activeLayerIndex = layers.length - 1;\r\n                    if (filename) {\r\n                        klCanvas.renameLayer(activeLayerIndex, filename);\r\n                    }\r\n                    let activeLayerContext = klCanvas.getLayerContext(activeLayerIndex);\r\n                    BB.drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, null, isPixelated);\r\n                    setCurrentLayer(klCanvas.getLayer(activeLayerIndex));\r\n                    layerManager.update(activeLayerIndex);\r\n\r\n                    klHistory.pause(false);\r\n\r\n                    klHistory.push({\r\n                        tool: [\"misc\"],\r\n                        action: \"importImage\",\r\n                        params: [BB.copyCanvas(activeLayerContext.canvas), filename]\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n\r\n        if (optionStr === 'default' || !optionStr) {\r\n            KL.showImportImageDialog({\r\n                image: importedImage,\r\n                target: klRootEl,\r\n                maxSize: klMaxCanvasSize,\r\n                callback: function(res) {\r\n                    if (res.type === 'as-image') {\r\n                        importAsImage(res.image);\r\n                    } else if (res.type === 'as-image-psd') {\r\n                        importAsImagePsd(res.image, res.cropObj);\r\n                    } else if (res.type === 'as-layer') {\r\n                        importAsLayer(res.image);\r\n                    } else if (res.type === 'cancel') {\r\n                        // nothing to do\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        if (optionStr === 'layer') {\r\n            importAsLayer(importedImage.canvas);\r\n        }\r\n        if (optionStr === 'image') {\r\n            if (importedImage.type === 'psd') {\r\n                importAsImagePsd(importedImage);\r\n            } else {\r\n                importAsImage(importedImage.canvas);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    function onPaste(e) {\r\n        if (KL.dialogCounter.get() > 0) {\r\n            return;\r\n        }\r\n\r\n        function retrieveImageFromClipboardAsBlob(pasteEvent, callback) {\r\n            if (pasteEvent.clipboardData == false) {\r\n                if (typeof (callback) == \"function\") {\r\n                    callback(undefined);\r\n                }\r\n            }\r\n\r\n            let items = pasteEvent.clipboardData.items;\r\n\r\n            if (items == undefined) {\r\n                if (typeof (callback) == \"function\") {\r\n                    callback(undefined);\r\n                }\r\n            } else {\r\n                for (let i = 0; i < items.length; i++) {\r\n                    if (items[i].type.indexOf(\"image\") == -1) {\r\n                        continue;\r\n                    }\r\n                    let blob = items[i].getAsFile();\r\n\r\n                    if (typeof (callback) == \"function\") {\r\n                        callback(blob);\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (e.clipboardData.files[0]) {\r\n            retrieveImageFromClipboardAsBlob(e, function (imageBlob) {\r\n                // If there's an image, display it in the canvas\r\n                if (imageBlob) {\r\n                    let img = new Image();\r\n                    img.onload = function () {\r\n                        URL.revokeObjectURL(img.src);\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img\r\n                        }, null, 'default');\r\n                    };\r\n                    let URLObj = window.URL || window.webkitURL;\r\n                    img.src = URLObj.createObjectURL(imageBlob);\r\n                }\r\n            });\r\n        } else if (e.clipboardData.items[0]) {\r\n            e.clipboardData.items[0].getAsString(function(pasteStr) {\r\n                pasteStr = pasteStr.trim();\r\n                if (pasteStr.match(/^https?/)) {\r\n                    // url\r\n                    let img = new Image();\r\n                    img.onload = function () {\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img\r\n                        }, null, 'default');\r\n                    };\r\n                    img.onerror = function (e) {\r\n                        console.log('error loading', e);\r\n                    };\r\n                    img.crossOrigin = 'Anonymous';\r\n                    img.src = pasteStr;\r\n\r\n                } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\r\n                    // url\r\n                    let rgbObj = BB.ColorConverter.hexToRGB(pasteStr.replace('#', ''));\r\n                    brushSettingService.setColor(rgbObj);\r\n                }\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    function handleFileSelect(files, optionStr) {\r\n\r\n        function showWarningPsdFlattened() {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                type: \"warning\",\r\n                message: LANG('import-psd-unsupported') + \"<br /><br />\",\r\n                buttons: [\"Ok\"],\r\n            });\r\n        }\r\n\r\n        let hasUnsupportedFile = false;\r\n        for (let i = 0, file; file = files[i]; i++) {\r\n            let extension = file.name.split(\".\");\r\n            extension = extension[extension.length - 1].toLowerCase();\r\n            if (extension === \"psd\") {\r\n\r\n                (function(f) {\r\n                    let loaderSizeBytes = 1024 * 1024 * 25; // 25mb\r\n                    let maxSizeBytes = 1024 * 1024 * 1024; // 1gb\r\n                    let maxResolution = 4096;\r\n\r\n                    if (f.size >= maxSizeBytes) { // pretty likely to break stuff\r\n                        KL.popup({\r\n                            target: klRootEl,\r\n                            type: \"error\",\r\n                            message: \"File too big. Unable to import.<br /><br />\",\r\n                            buttons: [\"Ok\"],\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    let doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\r\n                    let loaderIsOpen = true;\r\n                    let closeLoader;\r\n\r\n                    if (doShowLoader) {\r\n                        KL.popup({\r\n                            target: klRootEl,\r\n                            message: LANG('import-opening'),\r\n                            callback: function (result) {\r\n                                loaderIsOpen = false;\r\n                                closeLoader = null;\r\n                            },\r\n                            closefunc: function (f) {\r\n                                closeLoader = f;\r\n                            }\r\n                        });\r\n                    }\r\n\r\n\r\n                    let reader = new FileReader();\r\n                    reader.onload = function (readerResult) {\r\n\r\n                        KL.loadAgPsd().then(function(agPsdLazy) {\r\n\r\n                            if (doShowLoader && !loaderIsOpen) {\r\n                                return;\r\n                            }\r\n\r\n                            try {\r\n                                let psd;\r\n\r\n                                // first pass, only read metadata\r\n                                psd = agPsdLazy.readPsd(\r\n                                    (readerResult.target.result as any),\r\n                                    {\r\n                                        skipLayerImageData: true,\r\n                                        skipThumbnail: true,\r\n                                        skipCompositeImageData: true\r\n                                    });\r\n                                if (psd.width > maxResolution || psd.height > maxResolution) {\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    KL.popup({\r\n                                        target: klRootEl,\r\n                                        type: \"error\",\r\n                                        //message: \"Image exceeds maximum dimensions of \" + maxResolution + \" x \" + maxResolution + \" pixels. Unable to import.\"\r\n                                        message: LANG('import-psd-too-large').replace(/{x}/g, '' + maxResolution)\r\n                                            + \"<br /><br />\"\r\n                                            + LANG('import-psd-size') + \": \" + psd.width + \" x \" + psd.height + ' pixels'\r\n                                            + \"<br /><br />\"\r\n                                        ,\r\n                                        buttons: [\"Ok\"],\r\n                                    });\r\n                                    return;\r\n                                }\r\n\r\n\r\n                                // second pass, now load actual data.\r\n                                psd = null;\r\n\r\n                                try {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any));\r\n                                } catch (e) {\r\n                                    //console.log('failed regular psd import', e);\r\n                                }\r\n                                if (psd) {\r\n                                    //console.log('psd', psd);\r\n                                    let convertedPsd = KL.PSD.readPsd(psd);\r\n                                    //console.log('converted', convertedPsd);\r\n                                    if (optionStr === 'image' && convertedPsd.error) {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    importFinishedLoading(convertedPsd, f.name, optionStr);\r\n                                } else {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any), { skipLayerImageData: true, skipThumbnail: true });\r\n                                    if (optionStr === 'image') {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    importFinishedLoading({\r\n                                        type: 'psd',\r\n                                        width: psd.width,\r\n                                        height: psd.height,\r\n                                        canvas: psd.canvas,\r\n                                        error: true\r\n                                    }, f.name, optionStr);\r\n                                }\r\n\r\n\r\n                            } catch (e) {\r\n                                if (closeLoader) {\r\n                                    closeLoader();\r\n                                }\r\n                                KL.popup({\r\n                                    target: klRootEl,\r\n                                    type: \"error\",\r\n                                    message: \"Failed to load PSD.<br /><br />\",\r\n                                    buttons: [\"Ok\"],\r\n                                });\r\n                            }\r\n                        }).catch(() => {\r\n                            closeLoader();\r\n                            alert('Error: failed to load PSD library');\r\n                        });\r\n\r\n                    };\r\n                    reader.readAsArrayBuffer(f);\r\n                })(file);\r\n\r\n            } else if (file.type.match('image.*')) {\r\n                (function (f) {\r\n                    window.URL = window.URL || window.webkitURL;\r\n                    let url = window.URL.createObjectURL(f);\r\n                    let im = new Image();\r\n                    im.src = url;\r\n                    BB.loadImage(im, function () {\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: im.width,\r\n                            height: im.height,\r\n                            canvas: im\r\n                        }, f.name, optionStr);\r\n                    });\r\n                })(file);\r\n            } else {\r\n                hasUnsupportedFile = true;\r\n            }\r\n        }\r\n        if (hasUnsupportedFile) {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                message: LANG('import-unsupported-file'),\r\n                type: 'error',\r\n                buttons: ['OK'],\r\n            });\r\n        }\r\n    }\r\n\r\n    if (!pOptions.embed) {\r\n        new KL.KlImageDropper({\r\n            target: document.body,\r\n            onDrop: function(files, optionStr) {\r\n                if (KL.dialogCounter.get() > 0) {\r\n                    return;\r\n                }\r\n                handleFileSelect(files, optionStr);\r\n            },\r\n            enabledTest: function() {\r\n                return KL.dialogCounter.get() === 0;\r\n            }\r\n        });\r\n\r\n        BB.addEventListener(window, 'paste', onPaste, false);\r\n    }\r\n\r\n    const brushUiObj: any = {};\r\n\r\n    // create brush UIs\r\n    for (let b in KL.brushesUI) {\r\n        if (KL.brushesUI.hasOwnProperty(b)) {\r\n            let ui = new KL.brushesUI[b].Ui({\r\n                onSizeChange: sizeWatcher,\r\n                onOpacityChange: function(opacity) {\r\n                    brushSettingService.emitOpacity(opacity);\r\n                },\r\n                onConfigChange: () => {\r\n                    brushSettingService.emitSliderConfig({\r\n                        sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                        opacitySlider: KL.brushesUI[currentBrushId].opacitySlider\r\n                    });\r\n                }\r\n            });\r\n            brushUiObj[b] = ui;\r\n            ui.getElement().style.padding = 10 + 'px';\r\n        }\r\n    }\r\n\r\n\r\n    BB.css(klRootEl, {\r\n        position: 'absolute',\r\n        left: '0',\r\n        top: '0',\r\n        right: '0',\r\n        bottom: '0'\r\n    });\r\n\r\n    let statusOverlay = new KL.StatusOverlay();\r\n\r\n    const toolspace = BB.el({});\r\n    const toolspaceInner = BB.el({\r\n        parent: toolspace,\r\n    });\r\n    toolspace.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n    toolspace.onclick = BB.handleClick;\r\n\r\n\r\n    let toolspaceCollapser = new KL.ToolspaceCollapser({\r\n        onChange: function() {\r\n            updateCollapse();\r\n        }\r\n    });\r\n    function updateCollapse() {\r\n\r\n        //collapser\r\n        if (uiWidth < collapseThreshold) {\r\n            toolspaceCollapser.getElement().style.display = 'block';\r\n\r\n            toolspaceCollapser.setDirection(uiState);\r\n            if (toolspaceCollapser.isOpen()) {\r\n                if (uiState === 'left') {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '271px',\r\n                        right: '',\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '271px'\r\n                    });\r\n                } else {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '271px'\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                }\r\n                toolspace.style.display = 'block';\r\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\r\n                statusOverlay.setWide(false);\r\n\r\n            } else {\r\n                if (uiState === 'left') {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '0',\r\n                        right: '',\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                } else {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '0'\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                }\r\n                toolspace.style.display = 'none';\r\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth), uiHeight);\r\n                statusOverlay.setWide(true);\r\n\r\n            }\r\n\r\n        } else {\r\n            toolspaceCollapser.getElement().style.display = 'none';\r\n            if (uiState === 'left') {\r\n                BB.css(klCanvasWorkspace.getElement(), {\r\n                    left: '271px'\r\n                });\r\n            } else {\r\n                BB.css(klCanvasWorkspace.getElement(), {\r\n                    left: '0'\r\n                });\r\n            }\r\n            toolspace.style.display = 'block';\r\n            klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\r\n            statusOverlay.setWide(false);\r\n\r\n        }\r\n    }\r\n    updateCollapse();\r\n\r\n    function updateUi() {\r\n        if (uiState === 'left') {\r\n            BB.css(toolspace, {\r\n                left: '0',\r\n                right: '',\r\n                borderLeft: 'none',\r\n                borderRight: '1px solid rgb(135, 135, 135)'\r\n            });\r\n            BB.css(klCanvasWorkspace.getElement(), {\r\n                left: '271px'\r\n            });\r\n        } else {\r\n            BB.css(toolspace, {\r\n                left: '',\r\n                right: '0',\r\n                borderLeft: '1px solid rgb(135, 135, 135)',\r\n                borderRight: 'none'\r\n            });\r\n            BB.css(klCanvasWorkspace.getElement(), {\r\n                left: '0'\r\n            });\r\n        }\r\n        statusOverlay.setUiState(uiState);\r\n        layerPreview.setUiState('' + uiState);\r\n        layerManager.setUiState('' + uiState);\r\n        updateCollapse();\r\n        toolspaceScroller.updateUiState(uiState);\r\n    }\r\n\r\n\r\n\r\n    let overlayToolspace;\r\n    setTimeout(function() {\r\n        overlayToolspace = new KL.OverlayToolspace({\r\n            enabledTest: function() {\r\n                return KL.dialogCounter.get() === 0 && !lineSanitizer.getIsDrawing();\r\n            },\r\n            brushSettingService,\r\n        });\r\n        klRootEl.appendChild(overlayToolspace.getElement());\r\n    }, 0);\r\n\r\n    BB.append(klRootEl, [klCanvasWorkspace.getElement(), toolspace, toolspaceCollapser.getElement()]);\r\n\r\n    BB.css(toolspace, {\r\n        position: \"absolute\",\r\n        right: '0',\r\n        top: '0',\r\n        bottom: '0',\r\n        width: (toolWidth - 1) + \"px\",\r\n\r\n        overflow: \"hidden\",\r\n        backgroundColor: \"#ddd\",\r\n        borderLeft: \"1px solid rgb(135, 135, 135)\",\r\n        userSelect: 'none',\r\n        touchAction: 'none'\r\n    });\r\n\r\n    let toolspaceTopRow;\r\n    if (pOptions.embed) {\r\n        toolspaceTopRow = new ToolspaceTopRow({\r\n            onHelp: () => {\r\n                showIframePopup(pOptions.embed.url + '/help.html', !!pOptions.embed);\r\n            },\r\n            onSubmit: () => {\r\n                KL.popup({\r\n                    target: klRootEl,\r\n                    message: LANG('submit-prompt'),\r\n                    buttons: [LANG('submit'), 'Cancel'],\r\n                    callback: async (result) => {\r\n                        if (result !== LANG('submit')) {\r\n                            return;\r\n                        }\r\n\r\n                        let overlay = BB.el({\r\n                            parent: klRootEl,\r\n                            className: 'upload-overlay',\r\n                            content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\r\n                        });\r\n\r\n                        pOptions.embed.onSubmit(\r\n                            () => {\r\n                                pOptions.saveReminder.reset();\r\n                                klRootEl.removeChild(overlay);\r\n                            },\r\n                            () => {\r\n                                klRootEl.removeChild(overlay);\r\n                            });\r\n                    }\r\n                });\r\n            },\r\n            onLeftRight: () => {\r\n                uiState = uiState === 'left' ? 'right' : 'left';\r\n                updateUi();\r\n            },\r\n        });\r\n    } else {\r\n        toolspaceTopRow = new KL.ToolspaceTopRow({\r\n            logoImg: pOptions.logoImg,\r\n            onLogo: function() {\r\n                showIframePopup('./home/', !!pOptions.embed);\r\n            },\r\n            onNew: function() {\r\n                showNewImageDialog();\r\n            },\r\n            onImport: function() {\r\n                fileTab.triggerImport();\r\n            },\r\n            onSave: function() {\r\n                saveToComputer.save();\r\n            },\r\n            onShare: function() {\r\n                shareImage();\r\n            },\r\n            onHelp: function() {\r\n                showIframePopup('./help/', !!pOptions.embed);\r\n            },\r\n        });\r\n    }\r\n    BB.addClassName(toolspaceTopRow.getElement(), 'toolspace-row-shadow');\r\n    toolspaceTopRow.getElement().style.marginBottom = '10px';\r\n    toolspaceInner.appendChild(toolspaceTopRow.getElement());\r\n\r\n    let toolspaceToolRow = new KL.ToolspaceToolRow({\r\n        onActivate: function(activeStr) {\r\n            if (activeStr === 'draw') {\r\n                klCanvasWorkspace.setMode('draw');\r\n            } else if (activeStr === 'hand') {\r\n                klCanvasWorkspace.setMode('hand');\r\n            } else if (activeStr === 'fill') {\r\n                klCanvasWorkspace.setMode('fill');\r\n            } else if (activeStr === 'text') {\r\n                klCanvasWorkspace.setMode('text');\r\n            } else if (activeStr === 'shape') {\r\n                klCanvasWorkspace.setMode('shape');\r\n            } else {\r\n                throw new Error('unknown activeStr');\r\n            }\r\n            mainTabRow.open(activeStr);\r\n            updateMainTabVisibility();\r\n            klColorSlider.pickingDone();\r\n        },\r\n        onZoomIn: function() {\r\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n        },\r\n        onZoomOut: function() {\r\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n        },\r\n        onUndo: function() {\r\n            undoRedoCatchup.undo();\r\n        },\r\n        onRedo: function() {\r\n            undoRedoCatchup.redo();\r\n        }\r\n    });\r\n    toolspaceToolRow.setIsSmall(uiHeight < 540);\r\n    klHistory.addListener(function() {\r\n        toolspaceToolRow.setEnableUndo(klHistory.canUndo());\r\n        toolspaceToolRow.setEnableRedo(klHistory.canRedo());\r\n    });\r\n    BB.addClassName(toolspaceToolRow.getElement(), 'toolspace-row-shadow');\r\n    toolspaceInner.appendChild(toolspaceToolRow.getElement());\r\n\r\n    let klColorSlider;\r\n\r\n    function setCurrentBrush(brushId) {\r\n        if (brushId !== 'eraserBrush') {\r\n            lastNonEraserBrushId = brushId;\r\n        }\r\n\r\n        if (klColorSlider) {\r\n            if (brushId === 'eraserBrush') {\r\n                klColorSlider.enable(false);\r\n            } else {\r\n                klColorSlider.enable(true);\r\n            }\r\n        }\r\n\r\n        currentBrushId = brushId;\r\n        currentBrush = brushUiObj[brushId];\r\n        currentBrush.setColor(currentColor);\r\n        currentBrush.setContext(currentLayerCtx);\r\n        klCanvasWorkspace.setMode('draw');\r\n        toolspaceToolRow.setActive('draw');\r\n        updateMainTabVisibility();\r\n    }\r\n\r\n    function setCurrentLayer(layer) { //BrushContext(p_context) {\r\n        currentLayerCtx = layer.context;\r\n        currentBrush.setContext(layer.context);\r\n        layerPreview.setLayer(layer);\r\n    }\r\n\r\n    function setBrushColor(p_color) {\r\n        currentColor = p_color;\r\n        currentBrush.setColor(p_color);\r\n        brushSettingService.emitColor(p_color);\r\n        klColorSlider.pickingDone();\r\n    }\r\n\r\n    klColorSlider = new KL.KlColorSlider({\r\n        width: 250,\r\n        height: 30,\r\n        svHeight: 100,\r\n        startValue: new BB.RGB(0, 0, 0),\r\n        onPick: setBrushColor\r\n    });\r\n    klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\r\n    klColorSlider.setPickCallback(function (doPick) {\r\n\r\n        if (doPick) {\r\n            klCanvasWorkspace.setMode('pick');\r\n        } else {\r\n            klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\r\n            updateMainTabVisibility();\r\n        }\r\n\r\n    });\r\n    let brushDiv = document.createElement(\"div\");\r\n    let colorDiv = document.createElement(\"div\");\r\n    BB.css(colorDiv, {\r\n        margin: '10px',\r\n        display: 'flex',\r\n        flexWrap: 'wrap',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'flex-end'\r\n    });\r\n    let toolspaceStabilizerRow = new KL.ToolspaceStabilizerRow({\r\n        smoothing: 1,\r\n        onSelect: function(v) {\r\n            lineSmoothing.setSmoothing(translateSmoothing(v));\r\n        }\r\n    });\r\n\r\n\r\n    brushDiv.appendChild(colorDiv);\r\n    BB.append(\r\n        colorDiv,\r\n        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n    );\r\n\r\n    let brushTabRow = new KL.TabRow({\r\n        initialId: 'penBrush',\r\n        useAccent: true,\r\n        tabArr: (function () {\r\n            let result = [];\r\n\r\n            function createTab(keyStr) {\r\n                return {\r\n                    id: keyStr,\r\n                    image: KL.brushesUI[keyStr].image,\r\n                    title: KL.brushesUI[keyStr].tooltip,\r\n                    onOpen: function() {\r\n                        brushUiObj[keyStr].getElement().style.display = 'block';\r\n                        setCurrentBrush(keyStr);\r\n                        klColorSlider.pickingDone();\r\n                        brushSettingService.emitSliderConfig({\r\n                            sizeSlider: KL.brushesUI[keyStr].sizeSlider,\r\n                            opacitySlider: KL.brushesUI[keyStr].opacitySlider\r\n                        });\r\n                        sizeWatcher(brushUiObj[keyStr].getSize());\r\n                        brushSettingService.emitOpacity(brushUiObj[keyStr].getOpacity());\r\n                    },\r\n                    onClose: function() {\r\n                        brushUiObj[keyStr].getElement().style.display = 'none';\r\n                    }\r\n                };\r\n            }\r\n\r\n            let keyArr = Object.keys(brushUiObj);\r\n            for (let i = 0; i < keyArr.length; i++) {\r\n                result.push(createTab(keyArr[i]));\r\n            }\r\n            return result;\r\n        })()\r\n    });\r\n    brushDiv.appendChild(brushTabRow.getElement());\r\n    for (let b in KL.brushesUI) {\r\n        if (KL.brushesUI.hasOwnProperty(b)) {\r\n            brushDiv.appendChild(brushUiObj[b].getElement());\r\n        }\r\n    }\r\n\r\n    const handUi = new KL.HandUi({\r\n        scale: 1,\r\n        angleDeg: 0,\r\n        onReset: function() {\r\n            klCanvasWorkspace.resetView(true);\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n        onFit: function() {\r\n            klCanvasWorkspace.fitView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n        onAngleChange: function(angleDeg, isRelative) {\r\n            klCanvasWorkspace.setAngle(angleDeg, isRelative);\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n    });\r\n\r\n    let fillUi = new KL.FillUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let textUi = new KL.TextUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let shapeUi = new KL.ShapeUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let shapeTool = new KL.ShapeTool({\r\n        onShape: function(isDone, x1, y1, x2, y2, angleRad) {\r\n\r\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n\r\n            let shapeObj: any = {\r\n                type: shapeUi.getShape(),\r\n                x1: x1,\r\n                y1: y1,\r\n                x2: x2,\r\n                y2: y2,\r\n                angleRad: angleRad,\r\n                isOutwards: shapeUi.getIsOutwards(),\r\n                opacity: shapeUi.getOpacity(),\r\n                isEraser: shapeUi.getIsEraser()\r\n            };\r\n            if (shapeUi.getShape() === 'line') {\r\n                shapeObj.strokeRgb = klColorSlider.getColor();\r\n                shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed('shift');\r\n            } else {\r\n                shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed('shift');\r\n                if (shapeUi.getMode() === 'stroke') {\r\n                    shapeObj.strokeRgb = klColorSlider.getColor();\r\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                } else {\r\n                    shapeObj.fillRgb = klColorSlider.getColor();\r\n                }\r\n            }\r\n\r\n            if (isDone) {\r\n                klCanvas.setComposite(layerIndex, null);\r\n                klCanvas.drawShape(layerIndex, shapeObj);\r\n            } else {\r\n                klCanvas.setComposite(layerIndex, {\r\n                    draw: function(ctx) {\r\n                        KL.drawShape(ctx, shapeObj);\r\n                    }\r\n                });\r\n            }\r\n            klCanvasWorkspace.requestFrame();\r\n\r\n        }\r\n    });\r\n\r\n    const layerManager = KL.klLayerManager(klCanvas, function (val) {\r\n        setCurrentLayer(klCanvas.getLayer(val));\r\n        klHistory.push({\r\n            tool: [\"misc\"],\r\n            action: \"focusLayer\",\r\n            params: [val]\r\n        });\r\n    }, klRootEl) as any;\r\n    const layerPreview = new KL.LayerPreview({\r\n        klRootEl: klRootEl,\r\n        onClick: function () {\r\n            mainTabRow.open('layers');\r\n        }\r\n    });\r\n    layerPreview.setIsVisible(uiHeight >= 579);\r\n    layerPreview.setLayer(klCanvas.getLayer(klCanvas.getLayerIndex(currentLayerCtx.canvas)));\r\n\r\n    const filterTab = new KL.FilterTab(\r\n        klRootEl,\r\n        klColorSlider,\r\n        layerManager,\r\n        setCurrentLayer,\r\n        klCanvasWorkspace,\r\n        handUi,\r\n        () => { //get current color\r\n            return currentColor;\r\n        },\r\n        () => { // get max canvas size\r\n            return klMaxCanvasSize;\r\n        },\r\n        () => { // get kl canvas\r\n            return klCanvas;\r\n        },\r\n        () => { // get current layer ctx\r\n            return currentLayerCtx;\r\n        },\r\n        !!pOptions.embed,\r\n        statusOverlay,\r\n    );\r\n\r\n    const undoRedoCatchup = new KL.UndoRedoCatchup(\r\n        brushUiObj,\r\n        layerPreview,\r\n        layerManager,\r\n        handUi,\r\n        klCanvasWorkspace,\r\n        () => {\r\n            if (!initState) {\r\n                throw new Error('initState not initialized');\r\n            }\r\n            return initState;\r\n        },\r\n        () => klCanvas,\r\n        () => currentLayerCtx,\r\n        (clctx) => {\r\n            currentLayerCtx = clctx;\r\n        },\r\n        () => currentBrush,\r\n    );\r\n    klHistory.addListener((p) => {\r\n        undoRedoCatchup.catchup(p);\r\n    });\r\n\r\n    function showNewImageDialog() {\r\n        KL.newImageDialog({\r\n            currentColor: currentColor,\r\n            secondaryColor: klColorSlider.getSecondaryRGB(),\r\n            maxCanvasSize: klMaxCanvasSize,\r\n            canvasWidth: klCanvas.getWidth(),\r\n            canvasHeight: klCanvas.getHeight(),\r\n            workspaceWidth: window.innerWidth < collapseThreshold ? uiWidth : uiWidth - toolWidth,\r\n            workspaceHeight: uiHeight,\r\n            onConfirm: function(width, height, color) {\r\n                klCanvas.reset({\r\n                    width: width,\r\n                    height: height,\r\n                    color: color.a === 1 ? color : null\r\n                });\r\n\r\n                layerManager.update(0);\r\n                setCurrentLayer(klCanvas.getLayer(0));\r\n                klCanvasWorkspace.resetView();\r\n                handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n                isFirstImage = false;\r\n            },\r\n            onCancel: function() {}\r\n        });\r\n    }\r\n\r\n    function shareImage(callback?) {\r\n        BB.shareCanvas({\r\n            canvas: klCanvas.getCompleteCanvas(1),\r\n            fileName: BB.getDate() + filenameBase + '.png',\r\n            title: BB.getDate() + filenameBase + '.png',\r\n            callback: callback ? callback : function() {}\r\n        });\r\n    }\r\n\r\n    const saveToComputer = new KL.SaveToComputer(\r\n        pOptions.saveReminder,\r\n        klRootEl,\r\n        () => exportType,\r\n        () => klCanvas,\r\n        filenameBase,\r\n    );\r\n\r\n    const fileTab = pOptions.embed ? null : new KL.FileTab(\r\n        klRootEl,\r\n        projectStore,\r\n        () => klCanvas.getProject(),\r\n        exportType,\r\n        (type) => {\r\n            exportType = type;\r\n        },\r\n        handleFileSelect,\r\n        () => {\r\n            saveToComputer.save();\r\n        },\r\n        showNewImageDialog,\r\n        shareImage,\r\n        () => { // on upload\r\n            KL.imgurUpload(klCanvas, klRootEl, pOptions.saveReminder, pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : null, );\r\n        },\r\n        copyToClipboard,\r\n        pOptions.saveReminder,\r\n    );\r\n\r\n    const settingsTab = new KL.SettingsTab(\r\n        () => {\r\n            uiState = uiState === 'left' ? 'right' : 'left';\r\n            updateUi();\r\n            if (!pOptions.embed) {\r\n                LocalStorage.setItem('uiState', uiState);\r\n            }\r\n        },\r\n        pOptions.aboutEl\r\n    );\r\n\r\n    mainTabRow = new KL.TabRow({\r\n        initialId: 'draw',\r\n        tabArr: [\r\n            {\r\n                id: 'draw',\r\n                title: LANG('tool-brush'),\r\n                image: toolPaintImg,\r\n                onOpen: function() {\r\n                    if (currentBrushId === 'eraserBrush') {\r\n                        klColorSlider.enable(false);\r\n                    }\r\n                    BB.append(\r\n                        colorDiv,\r\n                        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n                    );\r\n                    brushDiv.style.display = 'block';\r\n                },\r\n                onClose: function() {\r\n                    brushDiv.style.display = 'none';\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'hand',\r\n                title: LANG('tool-hand'),\r\n                image: toolHandImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    handUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    handUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'fill',\r\n                title: LANG('tool-paint-bucket'),\r\n                image: toolFillImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    fillUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    fillUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'text',\r\n                title: LANG('tool-text'),\r\n                image: toolTextImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    textUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    textUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'shape',\r\n                title: LANG('tool-shape'),\r\n                image: toolShapeImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    shapeUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    shapeUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'layers',\r\n                title: LANG('tab-layers'),\r\n                image: tabLayersImg,\r\n                onOpen: function() {\r\n                    layerManager.update();\r\n                    layerManager.style.display = 'block';\r\n                },\r\n                onClose: function() {\r\n                    layerManager.style.display = 'none';\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'edit',\r\n                label: LANG('tab-edit'),\r\n                onOpen: function() {\r\n                    filterTab.show();\r\n                },\r\n                onClose: function() {\r\n                    filterTab.hide();\r\n                },\r\n                css: {\r\n                    padding: '0 7px',\r\n                },\r\n            },\r\n            {\r\n                id: 'file',\r\n                label: LANG('tab-file'),\r\n                isVisible: !!fileTab,\r\n                onOpen: function() {\r\n                    if (!fileTab) {\r\n                        return;\r\n                    }\r\n                    fileTab.getElement().style.display = 'block';\r\n                    fileTab.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    if (!fileTab) {\r\n                        return;\r\n                    }\r\n                    fileTab.getElement().style.display = 'none';\r\n                    fileTab.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    padding: '0 7px',\r\n                },\r\n            },\r\n            {\r\n                id: 'settings',\r\n                title: LANG('tab-settings'),\r\n                image: tabSettingsImg,\r\n                onOpen: function() {\r\n                    settingsTab.getElement().style.display = 'block';\r\n                    // settingsTab.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    settingsTab.getElement().style.display = 'none';\r\n                    // settingsTab.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            }\r\n        ]\r\n    });\r\n    function updateMainTabVisibility() {\r\n        if (!mainTabRow) {\r\n            return;\r\n        }\r\n\r\n        let toolObj = {\r\n            'draw': {},\r\n            'hand': {},\r\n            'fill': {},\r\n            'text': {},\r\n            'shape': {}\r\n        };\r\n\r\n        let activeStr = toolspaceToolRow.getActive();\r\n        let oldTabId = mainTabRow.getOpenedTabId();\r\n\r\n        let keysArr = Object.keys(toolObj);\r\n        for (let i = 0; i < keysArr.length; i++) {\r\n            if (activeStr === keysArr[i]) {\r\n                mainTabRow.setIsVisible(keysArr[i], true);\r\n            } else {\r\n                mainTabRow.setIsVisible(keysArr[i], false);\r\n                if (oldTabId === keysArr[i]) {\r\n                    mainTabRow.open(activeStr);\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    function copyToClipboard(showCrop?) {\r\n        KL.clipboardDialog(klRootEl, klCanvas.getCompleteCanvas(1), function (inputObj) {\r\n            if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) {\r\n                return;\r\n            }\r\n            //do a crop\r\n            let p = {\r\n                context: currentLayerCtx,\r\n                canvas: klCanvas,\r\n                input: inputObj, //{left,right,top,bottom}\r\n                history: klHistory\r\n            };\r\n            KL.filterLib.cropExtend.apply(p);\r\n            layerManager.update();\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        }, statusOverlay, showCrop);\r\n    }\r\n\r\n    const bottomBarWrapper = BB.el({\r\n        css: {\r\n            width: \"270px\",\r\n            position: \"absolute\",\r\n            bottom: '0',\r\n            left: '0'\r\n        },\r\n    });\r\n    if (pOptions.bottomBar) {\r\n        bottomBarWrapper.append(pOptions.bottomBar);\r\n        const observer = new MutationObserver(() => updateBottomBar());\r\n        observer.observe(\r\n            toolspaceInner,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n    }\r\n    function updateBottomBar() {\r\n        if (!pOptions.bottomBar) {\r\n            return;\r\n        }\r\n        const threshold = 617; //590\r\n        const isVisible = (\r\n            threshold < window.innerHeight &&\r\n            toolspaceInner.scrollHeight + 50 < window.innerHeight\r\n        );\r\n        bottomBarWrapper.style.display = isVisible ? '' : 'none';\r\n    }\r\n\r\n\r\n\r\n    BB.append(toolspaceInner, [\r\n        layerPreview.getElement(),\r\n        mainTabRow.getElement(),\r\n        brushDiv,\r\n        handUi.getElement(),\r\n        fillUi.getElement(),\r\n        textUi.getElement(),\r\n        shapeUi.getElement(),\r\n        layerManager,\r\n        filterTab.getElement(),\r\n        fileTab ? fileTab.getElement() : null,\r\n        settingsTab.getElement(),\r\n        BB.el({\r\n            css: {\r\n                height: '10px', // a bit of spacing at the bottom\r\n            }\r\n        }),\r\n        bottomBarWrapper ? bottomBarWrapper : null\r\n    ]);\r\n\r\n    const toolspaceScroller = new KL.ToolspaceScroller({\r\n        toolspace,\r\n        uiState,\r\n    });\r\n\r\n    // --- interface ---\r\n\r\n    this.getEl = () => {\r\n        return klRootEl;\r\n    };\r\n\r\n    this.resize = (w, h) => {\r\n\r\n        // iPad scrolls down when increasing text zoom\r\n        if (window.scrollY > 0) {\r\n            window.scrollTo(0, 0);\r\n        }\r\n\r\n        if (uiWidth === Math.max(0, w) && uiHeight === Math.max(0, h)) {\r\n            return;\r\n        }\r\n\r\n        uiWidth = Math.max(0, w);\r\n        uiHeight = Math.max(0, h);\r\n\r\n        updateCollapse();\r\n        updateBottomBar();\r\n\r\n        layerPreview.setIsVisible(uiHeight >= 579);\r\n        klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\r\n        toolspaceToolRow.setIsSmall(uiHeight < 540);\r\n    };\r\n\r\n    this.out = (msg) => {\r\n        statusOverlay.out(msg);\r\n    };\r\n\r\n    this.getPNG = function(): Blob {\r\n        return base64ToBlob(klCanvas.getCompleteCanvas(1).toDataURL('image/png'));\r\n    };\r\n\r\n    this.getPSD = async function() {\r\n        return await klCanvasToPsdBlob(klCanvas);\r\n    };\r\n\r\n    this.getProject = () => klCanvas.getProject();\r\n\r\n    this.swapUiLeftRight = () => {\r\n        uiState = uiState === 'left' ? 'right' : 'left';\r\n        if (!pOptions.embed) {\r\n            LocalStorage.setItem('uiState', uiState);\r\n        }\r\n        updateUi();\r\n    };\r\n\r\n    this.saveAsPsd = () => {\r\n        saveToComputer.save('psd');\r\n    };\r\n\r\n    this.isDrawing = () => {\r\n        return lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\r\n    };\r\n\r\n    // --- end interface ---\r\n\r\n    this.resize(uiWidth, uiHeight);\r\n    updateUi();\r\n\r\n    {\r\n        BB.addEventListener(window, 'resize', () => {\r\n            this.resize(window.innerWidth, window.innerHeight);\r\n        });\r\n        BB.addEventListener(window, 'orientationchange', () => {\r\n            this.resize(window.innerWidth, window.innerHeight);\r\n        });\r\n\r\n        // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\r\n        // Workaround: place a div in the body that fills the window, and use a ResizeObserver\r\n        const windowResizeWatcher = BB.el({\r\n            parent: document.body,\r\n            css: {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n                pointerEvents: 'none',\r\n                zIndex: '-1',\r\n                userSelect: 'none',\r\n            }\r\n        });\r\n        try {\r\n            // Not all browsers support ResizeObserver. Not critical though.\r\n            const observer = new ResizeObserver(() => this.resize(window.innerWidth, window.innerHeight));\r\n            observer.observe(windowResizeWatcher);\r\n        } catch (e) {\r\n            windowResizeWatcher.parentNode.removeChild(windowResizeWatcher);\r\n        }\r\n\r\n        // prevent ctrl scroll -> zooming page\r\n        BB.addEventListener(this.getEl(), 'wheel', (event) => {\r\n            event.preventDefault();\r\n        });\r\n        //maybe prevent zooming on safari mac os - I can't test it\r\n        const prevent = (e) => {\r\n            e.preventDefault();\r\n        }\r\n        window.addEventListener('gesturestart', prevent);\r\n        window.addEventListener('gesturechange', prevent);\r\n        window.addEventListener('gestureend', prevent);\r\n    }\r\n}","import {DecoyKlHistory, klHistory} from './history/kl-history';\r\nimport {Popup, popup} from './ui/modals/popup';\r\nimport {dialogCounter} from './ui/modals/modal-count';\r\nimport {Checkbox} from './ui/base-components/checkbox';\r\nimport {input} from './ui/base-components/input';\r\nimport {Select} from './ui/base-components/select';\r\nimport {ImageToggle} from './ui/base-components/image-toggle';\r\nimport {ImageRadioList} from './ui/base-components/image-radio-list';\r\nimport {penPressureToggle} from './ui/base-components/pen-pressure-toggle';\r\nimport {KlSlider} from './ui/base-components/kl-slider';\r\nimport {calcSliderFalloffFactor} from './ui/base-components/slider-falloff';\r\nimport {HexColorDialog} from './ui/modals/color-slider-hex-dialog';\r\nimport {KlColorSlider} from './ui/base-components/kl-color-slider';\r\nimport {KlSmallColorSlider} from './ui/base-components/kl-color-slider-small';\r\nimport {PointSlider} from './ui/base-components/point-slider';\r\nimport {ColorOptions} from './ui/base-components/color-options';\r\nimport {Options} from './ui/base-components/options';\r\nimport {StatusOverlay} from './ui/components/status-overlay';\r\nimport {exportDialog} from './ui/modals/export-dialog-deprecated';\r\nimport {CropCopy} from './ui/components/crop-copy';\r\nimport {clipboardDialog} from './ui/modals/clipboard-dialog';\r\nimport {klLayerManager} from './ui/tool-tabs/kl-layer-manager';\r\nimport {WorkspaceSvgOverlay} from './canvas-ui/workspace-svg-overlay';\r\nimport {KlCanvasWorkspace} from './canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvasPreview} from './canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './ui/components/free-transform';\r\nimport {FreeTransformCanvas} from './ui/components/free-transform-canvas';\r\nimport {Cropper} from './ui/components/cropper';\r\nimport {LayerPreview} from './ui/components/layer-preview';\r\nimport {FittedImage} from './ui/components/fitted-image';\r\nimport {showImportAsLayerDialog} from './ui/modals/show-import-as-layer-dialog';\r\nimport {KlImageDropper} from './ui/components/kl-image-dropper';\r\nimport {OverlayToolspace} from './ui/components/overlay-toolspace';\r\nimport {ToolspaceTopRow} from './ui/components/toolspace-top-row';\r\nimport {ToolDropdown} from './ui/components/tool-dropdown';\r\nimport {ToolspaceToolRow} from './ui/components/toolspace-tool-row';\r\nimport {ToolspaceStabilizerRow} from './ui/components/toolspace-stabilizer-row';\r\nimport {TabRow} from './ui/components/tab-row';\r\nimport {HandUi} from './ui/tool-tabs/hand-ui';\r\nimport {FillUi} from './ui/tool-tabs/fill-ui';\r\nimport {TextUi} from './ui/tool-tabs/text-ui';\r\nimport {ShapeUi} from './ui/tool-tabs/shape-ui';\r\nimport {newImageDialog} from './ui/modals/new-image-dialog';\r\nimport {ToolspaceCollapser} from './ui/components/toolspace-collapser';\r\nimport {renderText} from './image-operations/render-text';\r\nimport {textToolDialog} from './ui/modals/text-tool-dialog';\r\nimport {showImportImageDialog} from './ui/modals/show-import-image-dialog';\r\nimport {floodFillBits} from './image-operations/flood-fill';\r\nimport * as PSD from './storage/psd';\r\nimport {drawShape, ShapeTool} from './image-operations/shape-tool';\r\nimport {KlCanvas} from './canvas/kl-canvas';\r\nimport * as indexedDb from './storage/indexed-db';\r\nimport {filterLib, filterLibStatus} from './filters/filters';\r\nimport {brushes} from './brushes/brushes';\r\nimport {brushesUI} from './brushes-ui/brushes-ui';\r\nimport {showIframePopup} from './ui/modals/show-iframe-popup';\r\nimport {RadioList} from './ui/base-components/radio-list';\r\nimport {BrowserStorageUi} from './ui/components/browser-storage-ui';\r\nimport {drawProject} from './canvas/draw-project';\r\nimport {ProjectStore} from './storage/project-store';\r\nimport {FileTab} from \"./ui/tool-tabs/file-tab\";\r\nimport {FilterTab} from \"./ui/tool-tabs/filter-tab\";\r\nimport {imgurUpload} from \"./ui/modals/imgur-upload\";\r\nimport {loadAgPsd} from \"./storage/ag-psd-wrapper\";\r\nimport {SaveReminder} from \"./ui/components/save-reminder\";\r\nimport {SaveToComputer} from \"./storage/save-to-computer\";\r\nimport {UndoRedoCatchup} from \"./history/undo-redo-catchup\";\r\nimport {setDbName} from './storage/indexed-db';\r\nimport {BrushSettingService} from './brushes-ui/brush-setting-service';\r\nimport {BoxToggle} from './ui/base-components/box-toggle';\r\nimport {SettingsTab} from './ui/tool-tabs/settings-tab';\r\nimport {ToolspaceScroller} from './ui/components/toolspace-scroller';\r\n\r\n/**\r\n * paint tool functionality\r\n */\r\nexport const KL = {\r\n\r\n    // --- brushes ---\r\n    brushes,\r\n    brushesUI,\r\n    BrushSettingService,\r\n\r\n    // --- canvas ---\r\n    KlCanvas,\r\n    drawProject,\r\n\r\n    // --- canvas ui ---\r\n    WorkspaceSvgOverlay,\r\n    KlCanvasWorkspace,\r\n    KlCanvasPreview,\r\n\r\n    // --- filters ---\r\n    filterLibStatus,\r\n    filterLib,\r\n\r\n    // --- history ---\r\n    UndoRedoCatchup,\r\n\r\n    // --- image operations ---\r\n    renderText,\r\n    floodFillBits,\r\n    ShapeTool,\r\n    drawShape,\r\n\r\n    // --- storage ---\r\n    PSD,\r\n    setDbName,\r\n    indexedDb,\r\n    ProjectStore,\r\n    loadAgPsd,\r\n    SaveToComputer,\r\n\r\n    // --- ui - base components ---\r\n    calcSliderFalloffFactor,\r\n    Checkbox,\r\n    input,\r\n    Select,\r\n    ImageToggle,\r\n    ImageRadioList,\r\n    RadioList,\r\n    penPressureToggle,\r\n    KlSlider,\r\n    HexColorDialog,\r\n    KlColorSlider,\r\n    KlSmallColorSlider,\r\n    PointSlider,\r\n    ColorOptions,\r\n    Options,\r\n    BoxToggle,\r\n\r\n    // --- ui - components ---\r\n    StatusOverlay,\r\n    CropCopy,\r\n    FreeTransform,\r\n    FreeTransformCanvas,\r\n    Cropper,\r\n    LayerPreview,\r\n    FittedImage,\r\n    KlImageDropper,\r\n    OverlayToolspace,\r\n    ToolspaceTopRow,\r\n    ToolDropdown,\r\n    ToolspaceToolRow,\r\n    ToolspaceStabilizerRow,\r\n    TabRow,\r\n    ToolspaceCollapser,\r\n    BrowserStorageUi,\r\n    SaveReminder,\r\n    ToolspaceScroller,\r\n\r\n    // --- ui - modals ---\r\n    dialogCounter,\r\n    popup,\r\n    Popup,\r\n    exportDialog,\r\n    clipboardDialog,\r\n    showImportAsLayerDialog,\r\n    newImageDialog,\r\n    textToolDialog,\r\n    showImportImageDialog,\r\n    showIframePopup,\r\n    imgurUpload,\r\n\r\n    // --- ui - tool tabs ---\r\n    HandUi,\r\n    FillUi,\r\n    TextUi,\r\n    ShapeUi,\r\n    FileTab,\r\n    FilterTab,\r\n    SettingsTab,\r\n    klLayerManager,\r\n\r\n\r\n    klHistory,\r\n    DecoyKlHistory,\r\n};","\r\nexport interface IHistoryEntry {\r\n    tool: string[];\r\n    action?: string;\r\n    params?: any[];\r\n\r\n    actions?: {\r\n        action: string;\r\n        params: any[];\r\n    }[]\r\n}\r\n\r\nexport interface IHistoryBroadcast {\r\n    bufferUpdate: IHistoryEntry;\r\n}\r\n\r\nexport type IHistoryListener = (p: IHistoryBroadcast | null) => void;\r\n\r\nlet historyInstance: boolean = false;\r\n\r\nexport interface KlHistoryInterface {\r\n    pause (b: boolean): void;\r\n    addListener (l: IHistoryListener): void;\r\n    push (e: IHistoryEntry): void;\r\n    undo (): (IHistoryEntry | null)[];\r\n    redo (): (IHistoryEntry | null)[];\r\n    getAll (): (IHistoryEntry | null)[];\r\n    canRedo (): boolean;\r\n    canUndo (): boolean;\r\n    getState (): number;\r\n    getActionNumber (): number;\r\n}\r\n\r\nexport class DecoyKlHistory implements KlHistoryInterface {\r\n    pause (b: boolean): void {}\r\n    addListener (l: IHistoryListener): void {}\r\n    push (e: IHistoryEntry): void {}\r\n    undo (): (IHistoryEntry | null)[] { return []; }\r\n    redo (): (IHistoryEntry | null)[] { return []; }\r\n    getAll (): (IHistoryEntry | null)[] { return []; }\r\n    canRedo (): boolean { return false; }\r\n    canUndo (): boolean { return false; }\r\n    getState (): number { return 0; }\r\n    getActionNumber (): number { return 0; }\r\n}\r\n\r\nexport class KlHistory implements KlHistoryInterface {\r\n\r\n    private state: number; // on .push state increments by one\r\n    private dataArr: (IHistoryEntry | null)[]; // null if beyond max undo to trigger garbage collection\r\n    private listeners: IHistoryListener[];\r\n    private pauseStack: number; // how often paused without unpause\r\n    private readonly max: number = 20; // max number undo steps\r\n    private maxState: number; // can't go backwards -> max state is the buffer image(klCanvas)\r\n    private actionNumber: number; // current action the user is on. untouched document = -1 because dataArr.length is 0\r\n    \r\n    private broadcast (p: IHistoryBroadcast | null): void {\r\n        setTimeout(() => {\r\n            for (let i = 0; i < this.listeners.length; i++) {\r\n                this.listeners[i](p);\r\n            }\r\n            this.state++;\r\n        }, 1);\r\n    }\r\n    \r\n    // ---- public ----\r\n    \r\n    constructor () {\r\n        if (historyInstance) {\r\n            throw new Error('klHistory already instantiated');\r\n        }\r\n        historyInstance = true;\r\n        this.state = 0;\r\n        this.dataArr = [];\r\n        this.listeners = [];\r\n        this.pauseStack = 0;\r\n        this.maxState = -1;\r\n        this.actionNumber = -1;\r\n    }\r\n\r\n    /**\r\n     * you need pause because there are sometimes actions that would cause other\r\n     * undo steps\r\n     * for example a filter that does something crazy with two layers and then merges them\r\n     * you want that to be one undo step, and prevent merging from causing its undo step.\r\n     * so while that filter is doing its magic you should pause possible undo steps that\r\n     * that are caused by a part of its code(in this example: merging layers)\r\n     *\r\n     * @param b\r\n     */\r\n    pause (b: boolean): void {\r\n        if (b === false) {\r\n            this.pauseStack = Math.max(0, this.pauseStack - 1);\r\n        } else {\r\n            this.pauseStack++;\r\n        }\r\n    }\r\n\r\n    addListener (l: IHistoryListener): void {\r\n        this.listeners.push(l);\r\n    }\r\n\r\n    push (e: IHistoryEntry): void {\r\n        if (this.pauseStack > 0) {\r\n            return;\r\n        }\r\n        while (this.actionNumber < this.dataArr.length - 1) {\r\n            this.dataArr.pop();\r\n        }\r\n\r\n        //taking care of actions that shouldn't cause a new undo step\r\n        const top = this.dataArr[this.dataArr.length - 1];\r\n        if (e.action === 'layerOpacity' && top && top.action === 'layerOpacity' && top.params[0] === e.params[0]) {\r\n            this.dataArr[this.dataArr.length - 1] = e;\r\n            this.state++; //still needs to increment because something changed\r\n            return;\r\n        }\r\n        if (e.action === 'focusLayer' && top && top.action === 'focusLayer') {\r\n            this.dataArr[this.dataArr.length - 1] = e;\r\n            this.state++;\r\n            return;\r\n        }\r\n\r\n\r\n        this.dataArr[this.dataArr.length] = e;\r\n        this.actionNumber = this.dataArr.length - 1;\r\n        const maxBefore = this.maxState;\r\n        this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\r\n        if (maxBefore < this.maxState) {\r\n            this.broadcast({bufferUpdate: this.dataArr[this.maxState]});\r\n        } else {\r\n            this.broadcast(null);\r\n        }\r\n        if (this.maxState >= 0) {\r\n            this.dataArr[this.maxState] = null; //to free some memory...imported images take a lot of space\r\n        }\r\n    }\r\n\r\n    undo (): (IHistoryEntry | null)[] {\r\n        let result;\r\n        if (this.canUndo()) {\r\n            result = [];\r\n            for (let i = this.maxState + 1; i < this.actionNumber; i++) {\r\n                result.push(this.dataArr[i]);\r\n            }\r\n            this.actionNumber--;\r\n            this.broadcast(null);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    redo (): (IHistoryEntry | null)[] {\r\n        const result = [];\r\n        if (this.canRedo()) {\r\n            this.actionNumber++;\r\n            result.push(this.dataArr[this.actionNumber]);\r\n            this.broadcast(null);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    getAll (): (IHistoryEntry | null)[] {\r\n        return [].concat(this.dataArr);\r\n    }\r\n\r\n    canRedo (): boolean {\r\n        return this.actionNumber < this.dataArr.length - 1;\r\n    }\r\n\r\n    canUndo (): boolean {\r\n        return this.actionNumber > this.maxState;\r\n    }\r\n\r\n    getState (): number {\r\n        return this.state;\r\n    }\r\n\r\n    /**\r\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\r\n     */\r\n    getActionNumber (): number {\r\n        return (this.actionNumber + 1);\r\n    }\r\n    \r\n}\r\n\r\nexport const klHistory = new KlHistory();\r\n","import {dialogCounter} from './modal-count';\r\nimport {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport checkImg from 'url:~/src/app/img/ui/check.svg';\r\n// @ts-ignore\r\nimport cancelImg from 'url:~/src/app/img/ui/cancel.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\n\r\nwindow.onscroll = (e) => {\r\n    e.preventDefault();\r\n}\r\n\r\nexport function popup (\r\n    p: {\r\n        target: HTMLElement;\r\n        div?: HTMLElement; // node with content\r\n        message: string; // can be html\r\n        callback?: (result: string) => void;\r\n        buttons?: string[]; // \"Ok\", and \"Cancel\" will be automatically translated\r\n        primaries?: string[];\r\n        type?: 'error' | 'warning' | 'upload' | 'ok'; // todo\r\n        closefunc?: (f: () => void) => void; // returns a function you can call to close (Cancel) the dialog\r\n        style?: IKeyString;\r\n        clickOnEnter?: string; // name of button - will be clicked if enter key pressed\r\n        autoFocus?: false | string; // name of  to automatically focus - default 'Ok' - false -> none\r\n        ignoreBackground?: boolean; // deafult false; if true clicking on background doesn't close\r\n    }\r\n): void {\r\n    dialogCounter.increase();\r\n    let isClosed = false;\r\n\r\n\r\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\r\n    const rootRootEl = BB.el({\r\n        parent: document.body,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            overflow: 'hidden',\r\n        }\r\n    });\r\n    const rootEl = BB.el({\r\n        parent: rootRootEl,\r\n        className: 'kl-popup',\r\n    });\r\n\r\n    const scrollContent = BB.el({\r\n        parent: rootEl,\r\n        css: {\r\n            width: '100%',\r\n            minHeight: '100%',\r\n            // padding: '10px 0',\r\n            position: 'relative',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n        }\r\n    });\r\n\r\n    const bgEl = BB.el({\r\n        parent: scrollContent,\r\n        onClick: () => {\r\n            if (p.ignoreBackground) {\r\n                return;\r\n            }\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            zIndex: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n        }\r\n    });\r\n\r\n    const titleHeight = 40;\r\n    const xButton = BB.el({\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: () => {\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            position: 'absolute',\r\n            right: '0',\r\n            top: '0',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        }\r\n    });\r\n\r\n    const boxClasses = ['kl-popup-box'];\r\n    boxClasses.push('kl-popup-box--sm');\r\n    const boxEl = BB.el({\r\n        content: [\r\n            xButton,\r\n            BB.el({\r\n                content:p.message,\r\n                css: {\r\n                    marginBottom: p.div ? '10px' : null,\r\n                    marginRight: '15px',\r\n                }\r\n            }),\r\n            p.div,\r\n        ],\r\n        className: boxClasses.join(' '),\r\n        css: p.style ? p.style : null,\r\n    });\r\n\r\n    scrollContent.append(\r\n        BB.el({\r\n            css: {\r\n                flex: '0.5',\r\n            }\r\n        }),\r\n        boxEl,\r\n        BB.el({\r\n            css: {\r\n                flex: '1',\r\n            }\r\n        })\r\n    );\r\n\r\n    if (p.type === 'error') {\r\n        BB.addClassName(boxEl, 'poperror');\r\n    }\r\n    if (p.type === 'ok') {\r\n        BB.addClassName(boxEl, 'popok');\r\n    }\r\n    if (p.type === 'warning') {\r\n        BB.addClassName(boxEl, 'popwarning');\r\n    }\r\n    if (p.type === 'upload') {\r\n        BB.addClassName(boxEl, 'popupload');\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e, comboStr) {\r\n            if (isClosed) {\r\n                return;\r\n            }\r\n            if (clickOnEnterBtn && comboStr === 'enter' && !BB.isInputFocused()) {\r\n                e.stopPropagation();\r\n                setTimeout(function() {\r\n                    clickOnEnterBtn.click();\r\n                }, 10);\r\n            }\r\n            if (comboStr === 'esc') {\r\n                e.stopPropagation();\r\n                close('Cancel');\r\n            }\r\n        }\r\n    });\r\n    // prevent ctrl scroll -> zooming page\r\n    const wheelPrevent = (event) => {\r\n        if (keyListener.isPressed('ctrl')) {\r\n            event.preventDefault();\r\n        }\r\n    };\r\n    BB.addEventListener(rootEl, 'wheel', wheelPrevent);\r\n    rootEl.onclick = BB.handleClick;\r\n\r\n    let autoFocus = null;\r\n    if (p.autoFocus) {\r\n        autoFocus = p.autoFocus;\r\n    } else if (p.autoFocus === false) {\r\n        autoFocus = null;\r\n    } else {\r\n        autoFocus = 'Ok';\r\n    }\r\n\r\n    const buttonRowEl = p.buttons && p.buttons.length > 0 ? BB.el({\r\n        parent: boxEl,\r\n        css: {\r\n            display: 'flex',\r\n            flexWrap: 'wrap',\r\n            justifyContent: 'flex-end',\r\n            marginTop: '12px', // 8px already via buttons\r\n            marginLeft: '-8px',\r\n        }\r\n    }) : null;\r\n    let clickOnEnterBtn;\r\n    const btnElArr = [];\r\n    if (p.buttons) {\r\n        p.buttons.forEach(buttonName => {\r\n            const btnClasses = ['kl-popup__btn'];\r\n            if (buttonName === 'Ok' || (p.primaries && p.primaries.includes(buttonName))) {\r\n                btnClasses.push('kl-button-primary');\r\n            }\r\n            let iconUrl;\r\n            let label = buttonName;\r\n            if (buttonName === 'Ok') {\r\n                label = LANG('modal-ok');\r\n                iconUrl = checkImg;\r\n            }\r\n            if (buttonName === 'Cancel') {\r\n                label = LANG('modal-cancel');\r\n                iconUrl = cancelImg;\r\n            }\r\n            let iconImg = null;\r\n            if (iconUrl) {\r\n                iconImg = BB.el({\r\n                    tagName: 'img',\r\n                    custom: {\r\n                        src: iconUrl,\r\n                        height: '17',\r\n                    }\r\n                });\r\n            }\r\n            const btn = BB.el({\r\n                parent: buttonRowEl,\r\n                tagName: 'button',\r\n                className: btnClasses.join(' '),\r\n                content: [iconImg, label],\r\n                onClick: () => {\r\n                    close(buttonName);\r\n                },\r\n            });\r\n            btnElArr.push(btn);\r\n            if (autoFocus === buttonName) {\r\n                setTimeout(() => {\r\n                    btn.focus();\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 10);\r\n                setTimeout(() => {\r\n                    // safari needs a separate timeout\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 20);\r\n            }\r\n            if (buttonName === p.clickOnEnter) {\r\n                clickOnEnterBtn = btn;\r\n            }\r\n        });\r\n    }\r\n\r\n    function close (value: string) {\r\n        if (isClosed) {\r\n            return;\r\n        }\r\n\r\n        isClosed = true;\r\n        BB.clearSelection();\r\n        {\r\n            /*\r\n            Unfocus anything that is focused.\r\n\r\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\r\n            that isn't its direct parent, then Firefox will keep anything attached to this\r\n            Input in memory. It will not be garbage collected until a new Input is focused.\r\n\r\n            Workaround: Temporarily create an input, focus it, detach it.\r\n             */\r\n            const focusEl = BB.el({\r\n                parent: document.body,\r\n                tagName: 'input',\r\n                css: {\r\n                    opacity: '0',\r\n                    width: '0',\r\n                    height: '0',\r\n                }\r\n            }) as HTMLInputElement;\r\n            setTimeout(() => {\r\n                focusEl.select();\r\n                focusEl.focus();\r\n                focusEl.parentNode.removeChild(focusEl);\r\n            }, 10);\r\n        }\r\n        document.body.removeChild(rootRootEl);\r\n        dialogCounter.decrease();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        keyListener.destroy();\r\n        BB.removeEventListener(rootEl, 'wheel', wheelPrevent);\r\n        rootEl.onclick = null;\r\n        btnElArr.forEach(item => {\r\n            BB.destroyEl(item);\r\n        });\r\n        btnElArr.splice(0, btnElArr.length);\r\n\r\n        if (p.callback) {\r\n            p.callback(value);\r\n        }\r\n    }\r\n\r\n    if (p.closefunc) {\r\n        p.closefunc(function () {\r\n            close('Cancel');\r\n        });\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * popups that fill whole height, with some padding.\r\n * currently only used for iframe popups.\r\n *\r\n * p = {\r\n *      title: DOM Element | string, // optional (todo allow string)\r\n *      icon: 'ok', // optional todo\r\n *      content: DOM Element, // optional\r\n *      buttonArr: [ // optional todo\r\n *          'Ok',\r\n *          'Cancel'\r\n *      ],\r\n *      autoFocus: string | false, //todo\r\n *      clickOnEnter: string, //todo\r\n *      onClose: function(result: string), // optional (todo result)\r\n *\r\n *      //size and position\r\n *      width: 500,\r\n *      isMaxHeight: boolean //todo, currently always true\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const Popup = function(p) {\r\n    dialogCounter.increase();\r\n    const parent = document.body;\r\n    const div = BB.el({\r\n        parent: parent,\r\n        className: 'g-root',\r\n        css: {\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            bottom: '0',\r\n            right: '0',\r\n            background: 'rgba(0, 0, 0, 0.45)',\r\n            overflow: 'auto',\r\n            animationName: 'consoleIn',\r\n            animationDuration: '0.3s',\r\n            animationTimingFunction: 'ease-out'\r\n        }\r\n    });\r\n    div.onclick = BB.handleClick;\r\n\r\n    let updateInterval;\r\n\r\n    function close() {\r\n        dialogCounter.decrease();\r\n        div.onclick = null;\r\n        parent.removeChild(div);\r\n        clearInterval(updateInterval);\r\n        window.removeEventListener('resize', updatePos);\r\n        keyListener.destroy();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        if (p.onClose) {\r\n            p.onClose();\r\n        }\r\n    }\r\n\r\n    //background element registering clicks\r\n    const bgEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            bottom: '0',\r\n            right: '0'\r\n        },\r\n        onClick: close\r\n    });\r\n\r\n    //the actual popup box\r\n    const popupEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'absolute',\r\n            width: (BB.isCssMinMaxSupported() ?\r\n                'min(calc(100% - 40px), ' + (p.width ? p.width : 400) + 'px)' :\r\n                (p.width ? p.width : 400) + 'px'),\r\n            height: 'calc(100% - 40px)',\r\n            background: '#eee',\r\n            borderRadius: '10px',\r\n            overflow: 'hidden',\r\n            boxShadow: 'rgba(0, 0, 0, 0.25) 0px 5px 60px'\r\n        }\r\n    });\r\n\r\n    //x and y position via script. flex not powerful enough imo\r\n    function updatePos() {\r\n        const elW = popupEl.offsetWidth;\r\n        const elH = popupEl.offsetHeight;\r\n\r\n        BB.css(popupEl, {\r\n            left: Math.max(0, (window.innerWidth - elW) / 2) + 'px',\r\n            top: Math.max(20, (window.innerHeight - elH) / 2 - (elH * 0.20)) + 'px'\r\n        });\r\n    }\r\n    //todo also update when popup changes size - resizeobserver and fallback\r\n    //updateInterval = setInterval(updatePos, 100);\r\n    updatePos();\r\n    window.addEventListener('resize', updatePos);\r\n\r\n    //title row in popup\r\n    const titleHeight = 40;\r\n    const titleEl = BB.el({\r\n        parent: popupEl,\r\n        css: {\r\n            height: titleHeight + 'px',\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            paddingLeft: (titleHeight / 2) + 'px'\r\n        }\r\n    });\r\n    if (p.title) {\r\n        titleEl.appendChild(p.title);\r\n    }\r\n    const xButton = BB.el({\r\n        parent: titleEl,\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: close,\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        },\r\n        custom: {\r\n            tabindex: '0',\r\n        }\r\n    });\r\n\r\n    const contentEl = BB.el({\r\n        parent: popupEl,\r\n        css: {\r\n            height: 'calc(100% - ' + titleHeight + 'px)'\r\n        }\r\n    });\r\n    if (p.content) {\r\n        contentEl.appendChild(p.content);\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e) {\r\n            if (keyStr === 'esc') {\r\n                e.stopPropagation();\r\n                close();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n    this.close = function() {\r\n        close();\r\n    };\r\n};","\r\n// not the best\r\n\r\n/**\r\n * how many modals are open\r\n */\r\n\r\nexport class DialogCounter {\r\n    private listeners: ((v: number) => void)[] = [];\r\n    private count = 0;\r\n\r\n    private emit (): void {\r\n        this.listeners.forEach(item => {\r\n            item(this.count);\r\n        });\r\n    }\r\n\r\n    increase (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count += v;\r\n        } else {\r\n            this.count++;\r\n        }\r\n        this.emit();\r\n    }\r\n    decrease (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count -= v;\r\n        } else {\r\n            this.count--;\r\n        }\r\n        this.emit();\r\n    }\r\n    get (): number {\r\n        return this.count;\r\n    }\r\n    subscribe (listener: (v: number) => void): void {\r\n        this.listeners.push(listener);\r\n    }\r\n}\r\n\r\nexport const dialogCounter = new DialogCounter();\r\n","import * as BBEventListener from './input/event-listener';\r\nimport {\r\n    addClassName, append, centerWithin, copyObj, createSvg,\r\n    css, dateDayDifference, decToFraction,\r\n    fitInto, gcd, getDate,\r\n    handleClick, imageBlobToUrl,\r\n    insertAfter, loadImage,\r\n    reduce,\r\n    removeClassName, setAttributes, shareCanvas\r\n} from './base/base';\r\nimport {\r\n    canShareFiles,\r\n    eventUsesHighResTimeStamp,\r\n    getVisitor,\r\n    hasPointerEvents,\r\n    hasWebGl,\r\n    isCssMinMaxSupported,\r\n    mouseEventHasMovement\r\n} from './base/browser';\r\nimport {KeyListener, sameKeys} from './input/key-listener';\r\nimport {PointerListener} from './input/pointer-listener';\r\nimport * as EventChain from './input/event-chain';\r\nimport {\r\n    convertToAlphaChannelCanvas,\r\n    copyCanvas,\r\n    createCheckerCanvas, createCheckerDataUrl,\r\n    drawTransformedImageOnCanvas,\r\n    drawTransformedImageWithBounds, freeCanvas, resizeCanvas, testShouldPixelate\r\n} from './base/canvas';\r\nimport {Matrix} from './math/matrix';\r\nimport {Vec2} from './math/vec2';\r\nimport {BezierLine, PointLine, projectPointOnLine, quadraticSplineInput, SplineInterpolator} from './math/line';\r\nimport {CMYK, ColorConverter, HSV, RGB, testIsWhiteBestContrast} from './color/color';\r\nimport {appendTextDiv, clearSelection, destroyEl, el, isInputFocused, makeUnfocusable} from './base/ui';\r\nimport {\r\n    pointsToAngleDeg,\r\n    clamp,\r\n    dist,\r\n    mix,\r\n    pointsToAngleRad,\r\n    rotate,\r\n    rotateAround,\r\n    intDxy,\r\n    roundEven, roundUneven, distSquared, lenSquared, updateBounds, boundsInArea\r\n} from './math/math';\r\nimport {createCanvas} from './base/create-canvas';\r\nimport {BbLog} from './base/bb-log';\r\nimport {LocalStorage} from './base/local-storage';\r\n\r\nexport const BB = {\r\n\r\n    // ---- browser ----\r\n    eventUsesHighResTimeStamp,\r\n    mouseEventHasMovement,\r\n    hasPointerEvents,\r\n    hasWebGl,\r\n    getVisitor,\r\n    isCssMinMaxSupported,\r\n    canShareFiles,\r\n\r\n    // ---- base ----\r\n    insertAfter,\r\n    loadImage,\r\n    css,\r\n    setAttributes,\r\n    addClassName,\r\n    removeClassName,\r\n    append,\r\n    fitInto,\r\n    centerWithin,\r\n    getDate,\r\n    gcd,\r\n    reduce,\r\n    decToFraction,\r\n    imageBlobToUrl,\r\n    dateDayDifference,\r\n    copyObj,\r\n    shareCanvas,\r\n    handleClick,\r\n    createSvg,\r\n    BbLog,\r\n    LocalStorage,\r\n\r\n    // ---- math ----\r\n    mix,\r\n    dist,\r\n    distSquared,\r\n    lenSquared,\r\n    pointsToAngleRad,\r\n    pointsToAngleDeg,\r\n    clamp,\r\n    rotate,\r\n    rotateAround,\r\n    Matrix,\r\n    Vec2,\r\n    intDxy,\r\n    roundEven,\r\n    roundUneven,\r\n    updateBounds,\r\n    boundsInArea,\r\n\r\n    // ---- line ----\r\n    projectPointOnLine,\r\n    PointLine,\r\n    BezierLine,\r\n    SplineInterpolator,\r\n    quadraticSplineInput,\r\n\r\n    // ---- canvas ----\r\n    canvas: createCanvas,\r\n    copyCanvas,\r\n    testShouldPixelate,\r\n    drawTransformedImageWithBounds,\r\n    drawTransformedImageOnCanvas,\r\n    createCheckerCanvas,\r\n    createCheckerDataUrl,\r\n    resizeCanvas,\r\n    convertToAlphaChannelCanvas,\r\n    freeCanvas,\r\n\r\n    // ---- color ----\r\n    HSV,\r\n    RGB,\r\n    CMYK,\r\n    ColorConverter,\r\n    testIsWhiteBestContrast,\r\n\r\n    // ---- UI ----\r\n    appendTextDiv,\r\n    clearSelection,\r\n    makeUnfocusable,\r\n    el,\r\n    destroyEl,\r\n    isInputFocused: isInputFocused,\r\n\r\n\r\n    // ---- events / input ----\r\n\r\n    addEventListener: BBEventListener.addEventListener,\r\n    removeEventListener: BBEventListener.removeEventListener,\r\n    setEventListener: BBEventListener.setEventListener,\r\n\r\n    KeyListener,\r\n    PointerListener,\r\n    sameKeys,\r\n\r\n    EventChain,\r\n\r\n};\r\n","import {hasPointerEvents} from '../base/browser';\r\n\r\nconst listenerFuncObj = {}; // for debugging\r\n\r\nexport const setEventListener = function (DomEl, type, listener) {\r\n    if (!hasPointerEvents) {\r\n        type = type.replace('pointer', 'mouse');\r\n    }\r\n    DomEl[type] = listener;\r\n};\r\n\r\nexport const addEventListener = function (DomEl, type, listener, options?) {\r\n    if (!hasPointerEvents) {\r\n        type = type.replace('pointer', 'mouse');\r\n    }\r\n    /*if (!(type in listenerFuncObj)) {\r\n        listenerFuncObj[type] = [];\r\n    }\r\n    listenerFuncObj[type].push(listener);*/\r\n    DomEl.addEventListener(type, listener, options);\r\n};\r\n\r\nexport const removeEventListener = function (DomEl, type, listener, options?) {\r\n    if (!hasPointerEvents) {\r\n        type = type.replace('pointer', 'mouse');\r\n    }\r\n    /*if (type in listenerFuncObj) {\r\n        for (let i = 0; i < listenerFuncObj[type].length; i++) {\r\n            if (listenerFuncObj[type][i] === listener) {\r\n                listenerFuncObj[type].splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }*/\r\n    DomEl.removeEventListener(type, listener, options);\r\n};","import {createCanvas} from './create-canvas';\r\n\r\nexport const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\r\n\r\nexport const eventUsesHighResTimeStamp = (function() {\r\n\r\n    let eventUsesHighResTimeStamp: boolean | null = null;\r\n    if (document.body) {\r\n        (function() {\r\n            const event = new Event('');\r\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\r\n        })();\r\n    } else {\r\n        window.addEventListener('DOMContentLoaded', function(event) {\r\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\r\n        });\r\n    }\r\n\r\n    return function(): boolean {\r\n        if (eventUsesHighResTimeStamp === null) {\r\n            throw 'eventUsesHighResTimeStamp not initialized';\r\n        }\r\n        return eventUsesHighResTimeStamp;\r\n    }\r\n})();\r\n\r\nexport const mouseEventHasMovement = (() => {\r\n\r\n    // no support: IE, Safari, Safari iOS\r\n    // supported but broken: Firefox\r\n\r\n    if (!('MouseEvent' in window)) {\r\n        return false;\r\n    }\r\n    let mouseEvent;\r\n    try {\r\n        mouseEvent = new MouseEvent('mousemove'); // browsers not supporting the constructor don't have it\r\n    } catch (e) {\r\n        return false;\r\n    }\r\n    if (!('movementX' in mouseEvent)) {\r\n        return false; // likely safari\r\n    }\r\n    return !isFirefox;\r\n})();\r\n\r\nexport const hasPointerEvents = !!window.PointerEvent;\r\n\r\nexport const hasWebGl = (function() {\r\n\r\n    const hasWebgl = (function() {\r\n        const canvas = createCanvas();\r\n        try {\r\n            canvas.getContext('experimental-webgl', { premultipliedAlpha: false });\r\n            return true;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    })();\r\n\r\n    return function() {\r\n        return hasWebgl;\r\n    }\r\n})();\r\n\r\nexport const getVisitor = (function () {\r\n    const visitor = {\r\n        chrome: false,\r\n        gl: false\r\n    };\r\n    //Chrome\r\n    if ((window as any).chrome && (window as any).chrome.app) {\r\n        visitor.chrome = true;\r\n    }\r\n    //WebGL\r\n    visitor.gl = hasWebGl();\r\n    return function () {\r\n        return JSON.parse(JSON.stringify(visitor));\r\n    }\r\n})();\r\n\r\nexport const isCssMinMaxSupported = (function() {\r\n    let result: boolean | null = null;\r\n\r\n    function test() {\r\n        const div = document.createElement('div');\r\n        div.style.position = 'absolute';\r\n        div.style.top = '0';\r\n        div.style.left = 'max(0px, 25px)';\r\n        document.body.appendChild(div);\r\n        setTimeout(function() {\r\n            result = div.offsetLeft === 25;\r\n            document.body.removeChild(div);\r\n        }, 25);\r\n    }\r\n\r\n    if (document.body) {\r\n        test();\r\n    } else {\r\n        window.addEventListener('DOMContentLoaded', function() {\r\n            test();\r\n        });\r\n    }\r\n\r\n    return function(): boolean {\r\n        if (result === null) {\r\n            throw new Error('isCssMinMaxSupported not initialized');\r\n        }\r\n        return result;\r\n    };\r\n})();\r\n\r\nexport const canShareFiles = function(): boolean {\r\n    return 'share' in navigator && 'canShare' in navigator;\r\n};","/*window['canvases'] = [];\r\n\r\nwindow['printCanvases'] = () => {\r\n    let total = 0;\r\n\r\n    console.log(window['canvases'].map(item => {\r\n        total += item.width * item.height;\r\n        return {w: item.width, h: item.height};\r\n    }));\r\n\r\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\r\n};*/\r\n\r\nexport function createCanvas(w?: number, h?: number): HTMLCanvasElement {\r\n    const result = document.createElement('canvas');\r\n    if (w && h) {\r\n        result.width = w;\r\n        result.height = h;\r\n    }\r\n    // window['canvases'].push(result);\r\n    return result;\r\n}","import {IKeyString, ISize2D, ISVG, IVector2D} from '../BB.types';\r\n\r\nexport function insertAfter (referenceNode: Element, newNode: Element): void {\r\n    if (referenceNode.parentNode) {\r\n        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\r\n    }\r\n}\r\n\r\nexport function loadImage (im: HTMLImageElement, callback: () => void): void {\r\n    let counter = 0;\r\n\r\n    function check() {\r\n        if (counter === 1000) {\r\n            alert(\"couldn't load\");\r\n            return;\r\n        }\r\n        if (im.complete) {\r\n            counter++;\r\n            callback();\r\n        } else {\r\n            setTimeout(check, 1);\r\n        }\r\n    }\r\n\r\n    check();\r\n}\r\n\r\nexport function css (el: HTMLElement | SVGElement, styleObj: IKeyString): void {\r\n    const keyArr = Object.keys(styleObj);\r\n    let keyStr: string;\r\n    const style = (el.style as unknown) as IKeyString;\r\n    for (let i = 0; i < keyArr.length; i++) {\r\n        keyStr = keyArr[i];\r\n        style[keyStr] = styleObj[keyStr];\r\n        style.alignContent = 'true';\r\n        if (keyStr === 'userSelect') {\r\n            style.webkitUserSelect = styleObj[keyStr]; // safari\r\n        }\r\n    }\r\n}\r\n\r\nexport function setAttributes (el: HTMLElement, attrObj: IKeyString): void {\r\n    const keyArr = Object.keys(attrObj);\r\n    let keyStr;\r\n    for (let i = 0; i < keyArr.length; i++) {\r\n        keyStr = keyArr[i];\r\n        el.setAttribute(keyStr, attrObj[keyStr]);\r\n    }\r\n}\r\n\r\nexport function addClassName (el: HTMLElement | SVGElement, classStr: string): void {\r\n    const classAttr = el.getAttribute('class');\r\n    const splitArr = classAttr === null ? [] : classAttr.split(' ');\r\n    if (splitArr.includes(classStr)) {\r\n        return;\r\n    }\r\n    splitArr.push(classStr);\r\n    el.setAttribute('class', splitArr.join(' '));\r\n}\r\n\r\nexport function removeClassName (el: HTMLElement | SVGElement, classStr: string): void {\r\n    const classAttr = el.getAttribute('class');\r\n    const splitArr = classAttr === null ? [] : classAttr.split(' ');\r\n    if (!splitArr.includes(classStr)) {\r\n        return;\r\n    }\r\n    for (let i = 0; i < splitArr.length; i++) {\r\n        if (splitArr[i] === classStr) {\r\n            splitArr.splice(i, 1);\r\n            i--;\r\n        }\r\n    }\r\n    el.setAttribute('class', splitArr.join(' '));\r\n}\r\n\r\n/**\r\n * appendChild with an array\r\n * @param target\r\n * @param els\r\n */\r\nexport function append(target: HTMLElement, els: (HTMLElement | string | null)[]) {\r\n    const fragment = document.createDocumentFragment();\r\n    els.forEach(item => item ? fragment.append(item) : null);\r\n    target.append(fragment);\r\n}\r\n\r\n/**\r\n * a needs to fit into b\r\n * @param aw\r\n * @param ah\r\n * @param bw\r\n * @param bh\r\n * @param min\r\n */\r\nexport function fitInto (aw: number, ah: number, bw: number, bh: number, min?: number): ISize2D {\r\n    let width = aw * bw, height = ah * bw;\r\n    if (width > bw) {\r\n        height = bw / width * height;\r\n        width = bw;\r\n    }\r\n    if (height > bh) {\r\n        width = bh / height * width;\r\n        height = bh;\r\n    }\r\n    if (min) {\r\n        width = Math.max(min, width);\r\n        height = Math.max(min, height);\r\n    }\r\n    return {width, height};\r\n}\r\n\r\n/**\r\n * center b in a\r\n * @param aw\r\n * @param ah\r\n * @param bw\r\n * @param bh\r\n */\r\nexport function centerWithin (aw: number, ah: number, bw: number, bh: number): IVector2D {\r\n    return {\r\n        x: aw / 2 - bw / 2,\r\n        y: ah / 2 - bh / 2\r\n    };\r\n}\r\n\r\nexport function getDate (): string {\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\r\n    const day = date.getDate().toString().padStart(2, '0');\r\n    const minutes = (date.getHours() * 60 + date.getMinutes()).toString(36).padStart(3, '0');\r\n\r\n    return year + '_' + month + '_' + day + '_' + minutes + '_';\r\n}\r\n\r\nexport function gcd (a: number, b: number): number {\r\n    return b ? gcd(b, a % b) : a;\r\n}\r\n\r\nexport function reduce (numerator: number, denominator: number): [number, number] {\r\n    const g = gcd(numerator, denominator);\r\n    return [numerator / g, denominator / g];\r\n}\r\n\r\nexport function decToFraction (decimalNumber: number): [number, number] {\r\n    const len = decimalNumber.toString().length - 2;\r\n    const denominator = Math.pow(10, len);\r\n    const numerator = decimalNumber * denominator;\r\n    return reduce(numerator, denominator);\r\n}\r\n\r\n/**\r\n * blobObj isn't always a Blob, but rather an object, because Blob doesn't exist.\r\n * @param blobObj\r\n * @returns {string}\r\n */\r\nexport function imageBlobToUrl(blobObj: Blob): string {\r\n    if (!blobObj) {\r\n        throw new Error('blobObj is undefined or null');\r\n    }\r\n    if (window.Blob && blobObj instanceof Blob) {\r\n        return URL.createObjectURL(blobObj); // object url\r\n    } else if (blobObj.constructor.name === 'Object') {\r\n        const fauxBlob = (blobObj as unknown) as {type: string, encoding: string, data: string};\r\n        return 'data:' + fauxBlob.type + ';' + fauxBlob.encoding + ',' + fauxBlob.data; // data url\r\n    } else {\r\n        throw new Error('unknown blob format');\r\n    }\r\n}\r\n\r\nexport function dateDayDifference (dateA: string | Date, dateB: string | Date): number {\r\n    dateA = new Date(dateA);\r\n    dateB = new Date(dateB);\r\n    dateA.setHours(0, 0, 0, 0);\r\n    dateB.setHours(0, 0, 0, 0);\r\n    return (dateB.getTime() - dateA.getTime()) / (1000 * 60 * 60 * 24);\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\r\nexport function copyObj (obj: any): any {\r\n    return JSON.parse(JSON.stringify(obj));\r\n}\r\n\r\n/**\r\n * triggers Web Share API - share feature on mobile devices\r\n * Only works if they support file sharing - e.g. Safari can't do this yet\r\n * only call if BB.canShareFiles() -> true\r\n *\r\n * p = {\r\n *     canvas: Canvas,\r\n *     fileName: string,\r\n *     title: string\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function shareCanvas (p: {canvas: HTMLCanvasElement, fileName:string, title: string, callback: () => void}): void {\r\n    const mimetype = 'image/png';\r\n    const err = () => alert('sharing not supported');\r\n    p.canvas.toBlob(function(blob) {\r\n        if (blob === null) {\r\n            err();\r\n            p.callback();\r\n            return;\r\n        }\r\n        try {\r\n            const filesArray = [new File([blob], p.fileName, {type: mimetype})];\r\n            navigator.share({\r\n                title: p.title,\r\n                files: filesArray,\r\n            } as any)\r\n                .then(r => {\r\n\r\n                })\r\n                .catch(e => {\r\n                    err();\r\n            });\r\n        } catch(e) {\r\n            err();\r\n        }\r\n        p.callback();\r\n    }, mimetype);\r\n}\r\n\r\n/**\r\n * Prevent ipad from zooming in when double tapping. iPadOS 13 bug.\r\n * Give it your click event\r\n *\r\n * @param clickEvent\r\n * @returns {boolean}\r\n */\r\nexport function handleClick (clickEvent: MouseEvent): boolean {\r\n    const target: HTMLElement | null = clickEvent.target as HTMLElement;\r\n    if (!target) {\r\n        return false;\r\n    }\r\n    if (['A', 'LABEL', 'INPUT'].includes(target.tagName) || (target as any).allowClick) {\r\n        return true;\r\n    }\r\n    clickEvent.preventDefault();\r\n    return false;\r\n}\r\n\r\n\r\n/**\r\n * @param el {elementType: string, childrenArr: []el, ...svg attributes...}\r\n * @returns svg element tree\r\n */\r\nexport function createSvg (el: ISVG): SVGElement {\r\n    const result = document.createElementNS('http://www.w3.org/2000/svg', el.elementType);\r\n    const keyArr = Object.keys(el);\r\n    let keyStr;\r\n    for (let i = 0; i < keyArr.length; i++) {\r\n        keyStr = keyArr[i];\r\n        if (keyStr === 'childrenArr') {\r\n            for (let e = 0; e < el.childrenArr.length; e++) {\r\n                result.appendChild(createSvg(el.childrenArr[e]));\r\n            }\r\n        } else if (keyStr !== 'elementType') {\r\n            result.setAttribute(keyStr, el[keyStr] as string);\r\n        }\r\n    }\r\n    return result;\r\n}","import {addEventListener, removeEventListener} from './event-listener';\r\n\r\n\r\nconst globalKey = (() => {\r\n\r\n    const keyStrToKeyObj = { // keyStr not to contain a '+', because that's used for the comboStr\r\n        'space': [' ', 'Spacebar'], // Spacebar in IE\r\n        'alt': ['Alt', 'AltGraph'],\r\n        'shift': 'Shift',\r\n        'ctrl': 'Control',\r\n        'cmd': ['Meta', 'MetaLeft', 'MetaRight'],\r\n        'enter': 'Enter',\r\n        'esc': 'Escape',\r\n        'backspace': 'Backspace',\r\n        'delete': 'Delete',\r\n        'sqbr_open': '[',\r\n        'sqbr_close': ']',\r\n        'a': ['a', 'A'],\r\n        'b': ['b', 'B'],\r\n        'c': ['c', 'C'],\r\n        'e': ['e', 'E'],\r\n        'f': ['f', 'F'],\r\n        'g': ['g', 'G'],\r\n        'r': ['r', 'R'], // when holding shift\r\n        's': ['s', 'S'],\r\n        't': ['t', 'T'],\r\n        'u': ['u', 'U'],\r\n        'x': ['x', 'X'],\r\n        'y': ['y', 'Y'],\r\n        'z': ['z', 'Z'],\r\n        'plus': '+',\r\n        'minus': '-',\r\n        'left': 'ArrowLeft',\r\n        'right': 'ArrowRight',\r\n        'up': 'ArrowUp',\r\n        'down': 'ArrowDown',\r\n        'home': 'Home',\r\n        'end': 'End'\r\n    };\r\n    const keyToKeyStrArr = Object.keys(keyStrToKeyObj);\r\n    const isDownObj = {};\r\n    const keyToKeyStrObj = {}; // event.key to keyStr { ArrowLeft: 'left', ... }\r\n    let comboArr = [];\r\n    //a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\r\n    let codeIsDownObj = {}; // { KeyE: 'e', KeyF: null } - null not down, string, the associated keyStr\r\n    const listenerArr = [];\r\n\r\n    for (let i = 0; i < keyToKeyStrArr.length; i++) {\r\n        isDownObj[keyToKeyStrArr[i]] = false;\r\n\r\n        const code = keyStrToKeyObj[keyToKeyStrArr[i]];\r\n        if (typeof code === 'string') {\r\n            keyToKeyStrObj[keyStrToKeyObj[keyToKeyStrArr[i]]] = keyToKeyStrArr[i];\r\n        } else {\r\n            for (let e = 0; e < code.length; e++) {\r\n                keyToKeyStrObj[code[e]] = keyToKeyStrArr[i];\r\n            }\r\n        }\r\n    }\r\n\r\n    function emitDown(a, b, c, d?) {\r\n        listenerArr.forEach(item => {\r\n            if (!item[0]) {\r\n                return;\r\n            }\r\n            item[0](a, b, c, d);\r\n        });\r\n    }\r\n\r\n    function emitUp(a, b, c) {\r\n        listenerArr.forEach(item => {\r\n            if (!item[1]) {\r\n                return;\r\n            }\r\n            item[1](a, b, c);\r\n        });\r\n    }\r\n\r\n    function emitBlur() {\r\n        listenerArr.forEach(item => {\r\n            if (!item[2]) {\r\n                return;\r\n            }\r\n            item[2]();\r\n        });\r\n    }\r\n\r\n    function keyDown(e) {\r\n        const key = e.key;\r\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\r\n\r\n        if (key in keyToKeyStrObj) {\r\n            const keyStr = keyToKeyStrObj[key];\r\n            if (isDownObj[keyStr]) {\r\n                emitDown(keyStr, e, comboArr.join('+'), true);\r\n                return;\r\n            }\r\n            isDownObj[keyStr] = true;\r\n            codeIsDownObj[code] = keyStr;\r\n\r\n            //add to combo\r\n            comboArr.push(keyStr);\r\n\r\n            emitDown(keyStr, e, comboArr.join('+'));\r\n        }\r\n    }\r\n\r\n\r\n    function keyUp(e) {\r\n        const key = e.key;\r\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\r\n        const oldComboStr = comboArr.join('+');\r\n\r\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\r\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\r\n        if ([\r\n            'Meta', 'MetaLeft', 'MetaRight',\r\n            'OSLeft', 'OSRight', // Firefox\r\n        ].includes(code)) {\r\n            blur(null);\r\n            return;\r\n        }\r\n\r\n        if (code in codeIsDownObj && codeIsDownObj[code] !== null) {\r\n            const keyStr = codeIsDownObj[code];\r\n            isDownObj[keyStr] = false;\r\n            codeIsDownObj[code] = null;\r\n\r\n            //remove from combo\r\n            for (let i = 0; i < comboArr.length; i++) {\r\n                if (comboArr[i] == keyStr) {\r\n                    comboArr.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n\r\n            emitUp(keyStr, e, oldComboStr);\r\n        }\r\n    }\r\n\r\n    function blur(event) {\r\n        const oldComboStr = comboArr.join('+');\r\n        comboArr = [];\r\n        codeIsDownObj = {};\r\n\r\n        const eventArr = [];\r\n        for (let i = 0; i < keyToKeyStrArr.length; i++) {\r\n            if (isDownObj[keyToKeyStrArr[i]]) {\r\n                isDownObj[keyToKeyStrArr[i]] = false;\r\n                eventArr.push(keyToKeyStrArr[i]);\r\n            }\r\n        }\r\n        for (let i = 0; i < eventArr.length; i++) {\r\n            emitUp(\r\n                eventArr[i],\r\n                {\r\n                    preventDefault: function () {},\r\n                    stopPropagation: function () {},\r\n                },\r\n                oldComboStr,\r\n            );\r\n        }\r\n        emitBlur();\r\n    }\r\n\r\n\r\n\r\n    return {\r\n        add: (keyListener) => {\r\n            if (listenerArr.includes(keyListener)) {\r\n                return;\r\n            }\r\n            const first = listenerArr.length === 0;\r\n            listenerArr.push(keyListener);\r\n\r\n            if (first) {\r\n                addEventListener(document, 'keydown', keyDown);\r\n                addEventListener(document, 'keyup', keyUp);\r\n                addEventListener(window, 'blur', blur);\r\n            }\r\n        },\r\n        remove: (keyListener) => {\r\n            if (!listenerArr.includes(keyListener)) {\r\n                return;\r\n            }\r\n            const last = listenerArr.length === 1;\r\n            for (let i = 0; i < listenerArr.length; i++) {\r\n                if (listenerArr[i] === keyListener) {\r\n                    listenerArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n            if (last) {\r\n                removeEventListener(document, 'keydown', keyDown);\r\n                removeEventListener(document, 'keyup', keyUp);\r\n                removeEventListener(window, 'blur', blur);\r\n            }\r\n        },\r\n        getIsDown: () => {\r\n            return isDownObj;\r\n        },\r\n        getCombo: () => {\r\n            return comboArr;\r\n        },\r\n    };\r\n})();\r\n\r\n\r\n\r\n/**\r\n * Listens to key events in window. Makes combos easier - e.g. ctrl + z\r\n *\r\n * keyStr - see in implementation - my representation of a key. e.g. 'r' can be 'r' and 'R'\r\n * comboStr - string joins currently pressed keyStr with a +\r\n *              e.g. 'ctrl+z'\r\n *\r\n */\r\nexport class KeyListener {\r\n\r\n    private readonly onDown;\r\n    private readonly onUp;\r\n    private readonly onBlur;\r\n    private readonly ref;\r\n\r\n    constructor (\r\n        p: {\r\n            onDown?: (keyStr: string, e: KeyboardEvent, comboStr: string, isRepeat?: boolean) => void;\r\n            onUp?: (keyStr: string, e: KeyboardEvent, oldComboStr: string) => void;\r\n            onBlur?: () => void;\r\n        },\r\n    ) {\r\n        this.onDown = p.onDown;\r\n        this.onUp = p.onUp;\r\n        this.onBlur = p.onBlur;\r\n        this.ref = [this.onDown, this.onUp, this.onBlur];\r\n        globalKey.add(this.ref);\r\n    }\r\n\r\n    isPressed (keyStr: string): boolean {\r\n        if (!(keyStr in globalKey.getIsDown())) {\r\n            throw 'key \"' + keyStr + '\" not found';\r\n        }\r\n        return globalKey.getIsDown()[keyStr];\r\n    }\r\n\r\n    getComboStr (): string {\r\n        return globalKey.getCombo().join('+');\r\n    }\r\n\r\n    comboOnlyContains (keyStrArr: string[]): boolean {\r\n        for (let i = 0; i < globalKey.getCombo().length; i++) {\r\n            if (!keyStrArr.includes(globalKey.getCombo()[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    destroy (): void {\r\n        globalKey.remove(this.ref);\r\n    }\r\n}\r\n\r\nexport function sameKeys(comboAStr: string, comboBStr: string): boolean {\r\n    return comboAStr.split('+').sort().join('+')=== comboBStr.split('+').sort().join('+');\r\n}","import {addEventListener, removeEventListener} from './event-listener';\r\n\r\n\r\n/**\r\n * Filters wheel events. removes swipe scrolling and pinch scrolling that trackpads do. (as best as it can)\r\n * Normalizes regular scrolls.\r\n *\r\n * Why:\r\n * - trackpad scrolling is different from old school mouse scrolling\r\n * - but there is not way to learn from the browser if it's trackpad scrolling\r\n * - browsers don't even give access to the raw swiping or pinching movement, but some abstraction on top, making the scrolling\r\n *      continue an arbitrary amount, at an arbitrary scale\r\n * - each browser does this differently. So you can't offer a coherent experience\r\n *\r\n * - also trackpads are painful to draw with. So supporting a trackpad-based workflow makes not much sense.\r\n *\r\n * @param callback - func({deltaY: number, pageX: number, pageY: number, clientX: number, clientY: number}\r\n * @constructor\r\n */\r\nimport {eventUsesHighResTimeStamp, hasPointerEvents, isFirefox} from '../base/browser';\r\nimport {mix} from '../math/math';\r\n\r\nconst WheelCleaner = function (callback) {\r\n    const sequenceTimeoutMs = 200;\r\n\r\n    const knownUnitArr = [100];\r\n    let sequenceLength = 0;\r\n    let sequenceUnit = null;\r\n    let endSequenceTimeout;\r\n    let toEmitDelta = null;\r\n    let position = null;\r\n\r\n\r\n    function emit(delta) {\r\n        callback({\r\n            deltaY: Math.round(delta / sequenceUnit),\r\n            pageX: position.pageX,\r\n            pageY: position.pageY,\r\n            clientX: position.clientX,\r\n            clientY: position.clientY,\r\n        });\r\n    }\r\n\r\n    function endSequence() {\r\n        if (toEmitDelta !== null) {\r\n            emit(toEmitDelta);\r\n            toEmitDelta = null;\r\n        }\r\n        if (sequenceUnit !== null && !(knownUnitArr.includes(sequenceUnit))) {\r\n            knownUnitArr.push(sequenceUnit);\r\n        }\r\n        sequenceLength = 0;\r\n        sequenceUnit = null;\r\n    }\r\n\r\n    // --- interface ---\r\n    this.process = function (event) {\r\n\r\n        position = {\r\n            pageX: event.pageX,\r\n            pageY: event.pageY,\r\n            clientX: event.clientX,\r\n            clientY: event.clientY,\r\n        };\r\n\r\n        clearTimeout(endSequenceTimeout);\r\n        endSequenceTimeout = setTimeout(endSequence, sequenceTimeoutMs);\r\n\r\n        //prep delta\r\n        let delta = event.deltaY;\r\n        if ('deltaMode' in event && event.deltaMode === 1) {\r\n            delta *= 100 / 3;\r\n        }\r\n        const absDelta = Math.abs(delta);\r\n\r\n\r\n        if (sequenceLength > 0 && sequenceUnit === null) {\r\n            //previously determined dirty sequence\r\n            toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n        //sequence begins\r\n        if (sequenceLength === 0) {\r\n            sequenceLength++;\r\n            if (absDelta < 50) {\r\n                //dirty - probably a swipe scroll or pinch scroll on trackpad\r\n                return;\r\n            }\r\n\r\n            sequenceUnit = absDelta;\r\n            if (knownUnitArr.includes(sequenceUnit)) {\r\n                //we know this unit - emit right away\r\n                emit(delta);\r\n            } else {\r\n                //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\r\n                toEmitDelta = delta;\r\n            }\r\n            return;\r\n        }\r\n\r\n        //sequence continues\r\n        if (absDelta === 0) {\r\n            //ignore zero scroll\r\n            return;\r\n        }\r\n        if (\r\n            absDelta === sequenceUnit ||\r\n            (absDelta / sequenceUnit) % 1 < 0.0001// a multiple\r\n        ) {\r\n            //fine\r\n        } else if ((sequenceUnit / absDelta) % 1 < 0.0001) {\r\n            //unit was actually a multiple - update it\r\n            sequenceUnit = absDelta;\r\n\r\n        } else if (absDelta !== sequenceUnit) {\r\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\r\n            sequenceUnit = null;\r\n            toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n\r\n        if (toEmitDelta !== null) {\r\n            emit(toEmitDelta);\r\n            toEmitDelta = null;\r\n        }\r\n        emit(delta);\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * PointerListener - for pointer events, wheel events. uses fallbacks. ideally consistent behavior across browsers\r\n * Has some workarounds for browser specific bugs. As browsers get better, this constructor should get smaller\r\n *\r\n * p = {\r\n *     target: DOM element,\r\n *     onPointer: func (pointerEvent), //optional\r\n *     onWheel: func (wheelEvent), //optional\r\n *     onEnterLeave: func (isOver: boolean), //optional\r\n *     maxPointers: int (1 - n), //default is 1\r\n *     fixScribble: boolean, // fix ipad scribble issue\r\n * }\r\n *\r\n * pointerEvent = {\r\n *     type: 'pointerdown'|'pointermove'|'pointerup',\r\n *     pointerId: long,\r\n *     pointerType: 'touch'|'mouse'|'pen',\r\n *     pageX: number,\r\n *     pageY: number,\r\n *     clientX: number,\r\n *     clientY: number,\r\n *     relX: number, //position relative to top left of target\r\n *     relY: number,\r\n *     dX: number, //movementX not supported by safari on iOS, so need my own\r\n *     dY: number,\r\n *     downPageX: number, //where was pointer when down-event occurred - set for down|move|up\r\n *     downPageY: number,\r\n *     coalescedArr: Array of {\r\n *         pageX: number,\r\n *         pageY: number,\r\n *         clientX: number,\r\n *         clientY: number,\r\n *         relX: number, //position relative to top left of target\r\n *         relY: number,\r\n *         dX: number,\r\n *         dY: number,\r\n *         time: number// same timescale as performance.now() - might be exact same number as in parent\r\n *     },\r\n *     time: number, // same timescale as performance.now()\r\n *     button: 'left'|'middle'|'right',\r\n *     pressure: number (0-1), // always 1 for touch and mouse\r\n *     eventPreventDefault: function(),\r\n *     eventStopPropagation: function(),\r\n * }\r\n *\r\n * wheelEvent = {\r\n *     deltaY: number, // increments of 1\r\n *     pageX: number,\r\n *     pageY: number,\r\n *     relX: number,\r\n *     relY: number,\r\n * }\r\n *\r\n * isOver(): boolean - if pointer over the target\r\n *\r\n * @param p\r\n */\r\nexport const PointerListener = (function () {\r\n\r\n    //keeping track of pointers for movement fallback\r\n    const pointerArr = [];\r\n\r\n    function addPointer(event) {\r\n        const pointerObj = {\r\n            pointerId: event.pointerId,\r\n            lastPageX: null,\r\n            lastPageY: null\r\n        };\r\n        pointerArr.push(pointerObj);\r\n\r\n        if (pointerArr.length > 15) {\r\n            pointerArr.shift();\r\n        }\r\n\r\n        return pointerObj;\r\n    }\r\n\r\n    function getPointer(event) {\r\n        for (let i = pointerArr.length - 1; i >= 0; i--) {\r\n            if (event.pointerId === pointerArr[i].pointerId) {\r\n                return pointerArr[i];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    let pressureNormalizeAvgCount = 0;\r\n    let pressureNormalizeAvgPressure = null;\r\n    let pressureNormalizeIsComplete = false;\r\n    let pressureNormalizeFactor = 1;\r\n\r\n    return function (p) {\r\n        const targetElement = p.target;\r\n        const onPointerCallback = p.onPointer;\r\n        const onWheelCallback = p.onWheel;\r\n        const onEnterLeaveCallback = p.onEnterLeave;\r\n        const maxPointers = 'maxPointers' in p ? p.maxPointers : 1;\r\n        const buttonsToStr = { // translation\r\n            '1': 'left',\r\n            '2': 'right',\r\n            '4': 'middle'\r\n        };\r\n        const wheelCleaner = new WheelCleaner(function (wheelEvent) {\r\n            if (isDestroyed) {\r\n                return;\r\n            }\r\n            if (onWheelCallback) {\r\n                const bounds = targetElement.getBoundingClientRect();\r\n                wheelEvent.relX = wheelEvent.clientX - bounds.left + targetElement.scrollLeft;\r\n                wheelEvent.relY = wheelEvent.clientY - bounds.top + targetElement.scrollTop;\r\n                onWheelCallback(wheelEvent);\r\n            }\r\n        });\r\n        let isDestroyed = false;\r\n\r\n        const timeStampOffset = eventUsesHighResTimeStamp() ? 0 : -performance.timing.navigationStart;\r\n\r\n\r\n        //to circumvent a chrome input glitch\r\n        let lastPointerType = '';\r\n        let didSkip = false;\r\n\r\n\r\n        /*\r\n        pointers that are pressing a button\r\n        dragObj = {\r\n            pointerId: long,\r\n            pointerType: 'mouse'|'pen'|'touch',\r\n            downPageX: number, //where was pointer when down-event occurred\r\n            downPageY: number,\r\n            button: long,\r\n            lastPageX: number, //pageX in previous event - only for touch events, because they don't have movementX/Y\r\n            lastPageY: number,\r\n            lastTimeStamp: number\r\n        }\r\n         */\r\n        const dragObjArr = [];\r\n        const dragPointerIdArr = [];\r\n\r\n        function getDragObj(pointerId) {\r\n            for (let i = 0; i < dragObjArr.length; i++) {\r\n                if (pointerId === dragObjArr[i].pointerId) {\r\n                    return dragObjArr[i];\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        function removeDragObj(pointerId) {\r\n            let removedDragObj = null;\r\n            for (let i = 0; i < dragPointerIdArr.length; i++) {\r\n                if (dragPointerIdArr[i] === pointerId) {\r\n                    removedDragObj = dragObjArr[i];\r\n                    dragObjArr.splice(i, 1);\r\n                    dragPointerIdArr.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n            return removedDragObj;\r\n        }\r\n\r\n\r\n        function normalizePressure(pressure, type?) {\r\n            if (pressure === 0 || pressure === 1) {\r\n                return pressure;\r\n            }\r\n\r\n            // was this there to prevent some glitch?\r\n            /*if (pressureNormalizeIsComplete && type === 'pointerdown' && pressure !== 1) {\r\n                pressure *= 0.004;\r\n            }*/\r\n\r\n            if (pressureNormalizeAvgCount < 60) {\r\n                if (pressureNormalizeAvgCount === 0) {\r\n                    pressureNormalizeAvgPressure = pressure;\r\n                } else {\r\n                    pressureNormalizeAvgPressure = mix(pressure, pressureNormalizeAvgPressure, 0.95);\r\n                }\r\n                pressureNormalizeAvgCount++;\r\n            } else if (!pressureNormalizeIsComplete) {\r\n                pressureNormalizeIsComplete = true;\r\n                //BB.throwOut('avg pressure decision!' + pressureNormalizeAvgPressure);\r\n                if (pressureNormalizeAvgPressure < 0.13) { // absurd pressure needed\r\n                    pressureNormalizeFactor = 2.3;\r\n                }\r\n            }\r\n\r\n\r\n            return Math.pow(pressure, 1 / pressureNormalizeFactor);\r\n        }\r\n\r\n\r\n        /**\r\n         *\r\n         * More trustworthy pointer attributes. that behave the same across browsers.\r\n         * returns a new object. this object also gets attached to the orig event. -> event.corrected\r\n         *\r\n         * @param event\r\n         * @returns {{pointerId: number, timeStamp: number, button, buttons, pointerType: (string|string|any), movementY: number, movementX: number, pressure, coalescedArr: [], pageY, pageX, clientX, clientY, eventPreventDefault: func, eventStopPropagation: func}\r\n         */\r\n        function correctPointerEvent(event) {\r\n            if (event.corrected) {\r\n                return event.corrected;\r\n            }\r\n\r\n            /*if (event.type === 'pointermove' && !window.hidePressureOut) {\r\n                if (event.type === 'pointermove') {\r\n                    BB.throwOut(event.pressure + ' ' + event.pointerType);\r\n                }\r\n            }*/\r\n\r\n            const correctedObj = {\r\n                pointerId: event.pointerId,\r\n                pointerType: event.pointerType,\r\n                pageX: event.pageX,\r\n                pageY: event.pageY,\r\n                clientX: event.clientX,\r\n                clientY: event.clientY,\r\n                movementX: event.movementX,\r\n                movementY: event.movementY,\r\n                timeStamp: event.timeStamp + timeStampOffset,\r\n                pressure: normalizePressure(event.pressure, event.type),\r\n                buttons: event.buttons,\r\n                button: event.button,\r\n                coalescedArr: [],\r\n                eventPreventDefault: function () {\r\n                    event.preventDefault();\r\n                },\r\n                eventStopPropagation: function () {\r\n                    event.stopPropagation();\r\n                }\r\n            };\r\n            event.corrected = correctedObj;\r\n\r\n            let customPressure = null;\r\n            if ('pointerId' in event) {\r\n                if ('pressure' in event && event.buttons !== 0 && (['mouse'].includes(event.pointerType) || (event.pointerType === 'touch' && event.pressure === 0))) {\r\n                    correctedObj.pressure = 1;\r\n                    customPressure = 1;\r\n                }\r\n            } else {\r\n                correctedObj.pointerId = 0;\r\n                correctedObj.pointerType = 'mouse';\r\n                correctedObj.pressure = event.buttons !== 0 ? 1 : 0;\r\n                customPressure = correctedObj.pressure;\r\n            }\r\n\r\n            if (isFirefox && event.pointerType != 'mouse' && event.type === 'pointermove' && event.buttons === 0) { // once again firefox\r\n                correctedObj.buttons = 1; //todo wrong if no buttons actually pressed\r\n            }\r\n\r\n            let coalescedEventArr = [];\r\n            if ('getCoalescedEvents' in event) {\r\n                coalescedEventArr = event.getCoalescedEvents();\r\n            }\r\n\r\n            // chrome somehow movementX not same scale as pageX. todo: only chrome?\r\n            // so make my own\r\n\r\n            let pointerObj = getPointer(correctedObj);\r\n            if (pointerObj === null) {\r\n                pointerObj = addPointer(correctedObj);\r\n            }\r\n\r\n            const totalLastX = pointerObj.lastPageX;\r\n            const totalLastY = pointerObj.lastPageY;\r\n\r\n            for (let i = 0; i < coalescedEventArr.length; i++) {\r\n                const eventItem = coalescedEventArr[i];\r\n\r\n                correctedObj.coalescedArr.push({\r\n                    pageX: eventItem.pageX,\r\n                    pageY: eventItem.pageY,\r\n                    clientX: eventItem.clientX,\r\n                    clientY: eventItem.clientY,\r\n                    movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\r\n                    movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\r\n                    timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : (eventItem.timeStamp + timeStampOffset), // 0 in firefox\r\n                    pressure: customPressure === null ? normalizePressure(eventItem.pressure) : customPressure\r\n                });\r\n\r\n                pointerObj.lastPageX = eventItem.pageX;\r\n                pointerObj.lastPageY = eventItem.pageY;\r\n            }\r\n\r\n            pointerObj.lastPageX = correctedObj.pageX;\r\n            pointerObj.lastPageY = correctedObj.pageY;\r\n            correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\r\n            correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\r\n\r\n            return correctedObj;\r\n\r\n        }\r\n\r\n        /**\r\n         * creates a value for onPointer, from a pointer event handler\r\n         *\r\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\r\n         * @param correctedEvent - corrected pointer event from correctPointerEvent()\r\n         * @param custom - object for setting custom attributes\r\n         * @returns {{pointerId: number, pointerType: *, dX: (*), relY: number, dY: (*), relX: number, type: *, event: *, pageY: *, pageX: *}}\r\n         */\r\n        function createPointerOutEvent(typeStr, correctedEvent, custom?) {\r\n\r\n            const bounds = targetElement.getBoundingClientRect();\r\n            const result: any = {\r\n                type: typeStr,\r\n                pointerId: correctedEvent.pointerId,\r\n                pointerType: correctedEvent.pointerType,\r\n                pageX: correctedEvent.pageX,\r\n                pageY: correctedEvent.pageY,\r\n                clientX: correctedEvent.clientX,\r\n                clientY: correctedEvent.clientY,\r\n                relX: correctedEvent.clientX - bounds.left + targetElement.scrollLeft,\r\n                relY: correctedEvent.clientY - bounds.top + targetElement.scrollTop,\r\n                dX: correctedEvent.movementX,\r\n                dY: correctedEvent.movementY,\r\n                time: correctedEvent.timeStamp,\r\n                eventPreventDefault: correctedEvent.eventPreventDefault,\r\n                eventStopPropagation: correctedEvent.eventStopPropagation\r\n            };\r\n\r\n            if (typeStr === 'pointermove') {\r\n                result.coalescedArr = [];\r\n                if (correctedEvent.coalescedArr.length > 1) {\r\n                    let coalescedItem;\r\n                    for (let i = 0; i < correctedEvent.coalescedArr.length; i++) {\r\n                        coalescedItem = correctedEvent.coalescedArr[i];\r\n                        result.coalescedArr.push({\r\n                            pageX: coalescedItem.pageX,\r\n                            pageY: coalescedItem.pageY,\r\n                            clientX: coalescedItem.clientX,\r\n                            clientY: coalescedItem.clientY,\r\n                            relX: coalescedItem.clientX - bounds.left + targetElement.scrollLeft,\r\n                            relY: coalescedItem.clientY - bounds.top + targetElement.scrollTop,\r\n                            dX: coalescedItem.movementX,\r\n                            dY: coalescedItem.movementY,\r\n                            time: coalescedItem.timeStamp\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (custom) {\r\n                const keyArr = Object.keys(custom);\r\n                for (let i = 0; i < keyArr.length; i++) {\r\n                    result[keyArr[i]] = custom[keyArr[i]];\r\n                }\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        /**\r\n         * creates a value for onPointer, from a fallback touch event handler\r\n         *\r\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\r\n         * @param touchListItem - element from changed touch list\r\n         * @param touchEvent - touch event\r\n         * @param custom - object for setting custom attributes\r\n         * @returns {{pointerId: number, pointerType: string, relY: number, relX: number, type: *, event: *, pageY: *, pageX: *}}\r\n         */\r\n        function createTouchOutEvent(typeStr, touchListItem, touchEvent, custom) {\r\n            const bounds = targetElement.getBoundingClientRect();\r\n            const result: any = {\r\n                type: typeStr,\r\n                pointerId: touchListItem.identifier,\r\n                pointerType: 'touch',\r\n                pageX: touchListItem.pageX,\r\n                pageY: touchListItem.pageY,\r\n                clientX: touchListItem.clientX,\r\n                clientY: touchListItem.clientY,\r\n                relX: touchListItem.pageX - bounds.left + targetElement.scrollLeft,\r\n                relY: touchListItem.pageY - bounds.top + targetElement.scrollTop,\r\n                time: touchEvent.timeStamp + timeStampOffset,\r\n                eventPreventDefault: function() { touchEvent.preventDefault(); },\r\n                eventStopPropagation: function() { touchEvent.stopPropagation(); }\r\n            };\r\n\r\n            if (typeStr === 'pointermove') {\r\n                result.coalescedArr = [];\r\n            }\r\n\r\n            const keyArr = Object.keys(custom);\r\n            for (let i = 0; i < keyArr.length; i++) {\r\n                result[keyArr[i]] = custom[keyArr[i]];\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        function setupDocumentListeners() {\r\n            addEventListener(document, 'pointermove', onGlobalPointerMove);\r\n            addEventListener(document, 'pointerup', onGlobalPointerUp);\r\n            addEventListener(document, 'pointerleave', onGlobalPointerLeave);\r\n        }\r\n\r\n        function destroyDocumentListeners() {\r\n            removeEventListener(document, 'pointermove', onGlobalPointerMove);\r\n            removeEventListener(document, 'pointerup', onGlobalPointerUp);\r\n            removeEventListener(document, 'pointerleave', onGlobalPointerLeave);\r\n        }\r\n\r\n        let isOverCounter = 0; // might be multiple pointers\r\n        function onPointerEnter() {\r\n            isOverCounter++;\r\n            if (onEnterLeaveCallback) {\r\n                onEnterLeaveCallback(true);\r\n            }\r\n        }\r\n\r\n        function onPointerLeave() {\r\n            isOverCounter--;\r\n            if (onEnterLeaveCallback) {\r\n                onEnterLeaveCallback(false);\r\n            }\r\n        }\r\n\r\n        function onPointermove(event) {\r\n            event = correctPointerEvent(event);\r\n\r\n            const tempLastPointerType = lastPointerType;\r\n            lastPointerType = event.pointerType;\r\n\r\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || event.pointerType === 'touch') {\r\n                didSkip = false;\r\n                return;\r\n            }\r\n\r\n            // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\r\n            if (!didSkip && event.pointerType === 'mouse' && tempLastPointerType === 'pen') {\r\n                didSkip = true;\r\n                return;\r\n            }\r\n            didSkip = false;\r\n\r\n            const outEvent = createPointerOutEvent('pointermove', event);\r\n            onPointerCallback(outEvent);\r\n\r\n        }\r\n\r\n        function onPointerdown(event) {\r\n            //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' pointerdown');\r\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || !([1, 2, 4].includes(event.buttons))) {\r\n                //BB.throwOut('pointerdown ignored');\r\n                return;\r\n            }\r\n\r\n\r\n            //set up global listeners\r\n            if (dragObjArr.length === 0) {\r\n                setupDocumentListeners();\r\n            }\r\n            const dragObj = {\r\n                pointerId: event.pointerId,\r\n                pointerType: event.pointerType,\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY,\r\n                buttons: event.buttons,\r\n                lastPageX: event.pageX,\r\n                lastPageY: event.pageY,\r\n                lastTimeStamp: event.timeStamp\r\n            };\r\n            dragObjArr.push(dragObj);\r\n            setTouchTimeout(dragObj);\r\n            dragPointerIdArr.push(event.pointerId);\r\n\r\n            const outEvent = createPointerOutEvent('pointerdown', event, {\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY,\r\n                button: buttonsToStr[event.buttons],\r\n                pressure: event.pressure\r\n            });\r\n\r\n            onPointerCallback(outEvent);\r\n        }\r\n\r\n\r\n        function onGlobalPointerMove(event) {\r\n            //BB.throwOut('pointermove ' + event.pointerId);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\r\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\r\n                return;\r\n            }\r\n\r\n            const dragObj = getDragObj(event.pointerId);\r\n            clearTouchTimeout(dragObj);\r\n\r\n            //if pointer changes button its pressing -> turn into pointerup\r\n            if (event.buttons !== dragObj.buttons) {\r\n                //pointer up\r\n\r\n                //remove listener\r\n                if (dragObjArr.length === 1) {\r\n                    destroyDocumentListeners();\r\n                }\r\n                removeDragObj(event.pointerId);\r\n\r\n                const outEvent = createPointerOutEvent('pointerup', event, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY\r\n                });\r\n                onPointerCallback(outEvent);\r\n                return;\r\n\r\n            }\r\n\r\n            setTouchTimeout(dragObj);\r\n\r\n            // ipad likes to do this\r\n            if (\r\n                event.pointerType === 'pen' &&\r\n                event.pageX === dragObj.lastPageX &&\r\n                event.pageY === dragObj.lastPageY &&\r\n                event.timeStamp === dragObj.lastTimeStamp\r\n            ) {\r\n                //ignore\r\n                return;\r\n            }\r\n\r\n            const outEvent = createPointerOutEvent('pointermove', event, {\r\n                downPageX: dragObj.downPageX,\r\n                downPageY: dragObj.downPageY,\r\n                button: buttonsToStr[event.buttons],\r\n                pressure: event.pressure\r\n            });\r\n\r\n            dragObj.lastPageX = event.pageX;\r\n            dragObj.lastPageY = event.pageY;\r\n            dragObj.lastTimeStamp = event.timeStamp;\r\n\r\n            onPointerCallback(outEvent);\r\n\r\n        }\r\n\r\n        function onGlobalPointerUp(event) {\r\n            //BB.throwOut('pointerup ' + event.pointerId);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\r\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\r\n                return;\r\n            }\r\n\r\n            //remove listener\r\n            if (dragObjArr.length === 1) {\r\n                destroyDocumentListeners();\r\n            }\r\n            const dragObj = removeDragObj(event.pointerId);\r\n            clearTouchTimeout(dragObj);\r\n\r\n            const outEvent = createPointerOutEvent('pointerup', event, {\r\n                downPageX: dragObj.downPageX,\r\n                downPageY: dragObj.downPageY\r\n            });\r\n            onPointerCallback(outEvent);\r\n\r\n        }\r\n\r\n        function onGlobalPointerLeave(event) {\r\n            //BB.throwOut('pointerleave ' + event.pointerId);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\r\n            if (!(dragPointerIdArr.includes(event.pointerId))) { //} || event.target !== document) {\r\n                return;\r\n            }\r\n\r\n            //remove listener\r\n            if (dragObjArr.length === 1) {\r\n                destroyDocumentListeners();\r\n            }\r\n            const dragObj = removeDragObj(event.pointerId);\r\n            clearTouchTimeout(dragObj);\r\n\r\n            const outEvent = createPointerOutEvent('pointerup', event, {\r\n                downPageX: dragObj.downPageX,\r\n                downPageY: dragObj.downPageY\r\n            });\r\n            onPointerCallback(outEvent);\r\n        }\r\n\r\n\r\n        /*\r\n        --- ipad pointer event glitch damage control ---\r\n\r\n        ipad pointer events are glitchy. doesn't always fire pointerup.\r\n        - when two fingers get really close to each other\r\n        - when finger moves out and back in bottom\r\n\r\n        This artificially fires a pointerup\r\n        */\r\n        function onTouchTimeout(dragObj) {\r\n\r\n            //create fake event\r\n            const fakeEvent = {\r\n                pointerId: dragObj.pointerId,\r\n                pointerType: dragObj.pointerType,\r\n                type: 'pointerup',\r\n                timeStamp: performance.now(),\r\n                pageX: 0,\r\n                pageY: 0,\r\n                clientX: 0,\r\n                clientY: 0,\r\n                preventDefault: function () {\r\n                },\r\n                stopPropagation: function () {\r\n                }\r\n            };\r\n\r\n            //call onGlobalPointerUp with it\r\n            onGlobalPointerUp(fakeEvent);\r\n        }\r\n\r\n        function setTouchTimeout(dragObj) {\r\n            if (dragObj.pointerType !== 'touch') {\r\n                return;\r\n            }\r\n            dragObj.touchTimeout = setTimeout(function () {\r\n                onTouchTimeout(dragObj);\r\n            }, 2500); // 2.5 seconds\r\n        }\r\n\r\n        function clearTouchTimeout(dragObj) {\r\n            if (!dragObj.touchTimeout) {\r\n                return;\r\n            }\r\n            clearTimeout(dragObj.touchTimeout);\r\n            dragObj.touchTimeout = null;\r\n        }\r\n\r\n\r\n        if (onEnterLeaveCallback) {\r\n            addEventListener(targetElement, 'pointerenter', onPointerEnter);\r\n            addEventListener(targetElement, 'pointerleave', onPointerLeave);\r\n        }\r\n        if (onPointerCallback) {\r\n            addEventListener(targetElement, 'pointermove', onPointermove);\r\n            addEventListener(targetElement, 'pointerdown', onPointerdown);\r\n        }\r\n        if (onWheelCallback) {\r\n            addEventListener(targetElement, 'wheel', wheelCleaner.process);\r\n        }\r\n\r\n\r\n        let onTouchstart;\r\n        let onTouchmove;\r\n        let onTouchend;\r\n\r\n        // --- touch fallback ---\r\n        if (!(hasPointerEvents)) {\r\n\r\n            onTouchstart = function (event) {\r\n                ////console.log('onTouchstart', event, event.changedTouches.length);\r\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\r\n\r\n                const touchArr = event.changedTouches;\r\n                for (let i = 0; i < touchArr.length && dragObjArr.length < maxPointers; i++) {\r\n                    const touchObj = touchArr[i];\r\n\r\n                    //set up global listeners\r\n                    if (dragObjArr.length === 0) {\r\n                        addEventListener(document, 'touchmove', onTouchmove);\r\n                        addEventListener(document, 'touchend', onTouchend);\r\n                        addEventListener(document, 'touchcancel', onTouchend);\r\n                    }\r\n                    dragObjArr.push({\r\n                        pointerId: touchObj.identifier,\r\n                        downPageX: touchObj.pageX,\r\n                        downPageY: touchObj.pageY,\r\n                        buttons: 1,\r\n                        lastPageX: touchObj.pageX,\r\n                        lastPageY: touchObj.pageY,\r\n                    });\r\n                    dragPointerIdArr.push(touchObj.identifier);\r\n\r\n                    const outEvent = createTouchOutEvent('pointerdown', touchObj, event, {\r\n                        dX: 0,\r\n                        dY: 0,\r\n                        downPageX: touchObj.downPageX,\r\n                        downPageY: touchObj.downPageY,\r\n                        button: 'left',\r\n                        pressure: 1\r\n                    });\r\n                    onPointerCallback(outEvent);\r\n                }\r\n\r\n            }\r\n\r\n            onTouchmove = function (event) {\r\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\r\n\r\n\r\n                const touchArr = event.changedTouches;\r\n                for (let i = 0; i < touchArr.length; i++) {\r\n                    const touchObj = touchArr[i];\r\n\r\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\r\n                        continue;\r\n                    }\r\n                    const dragObj = getDragObj(touchObj.identifier);\r\n\r\n                    const outEvent = createTouchOutEvent('pointermove', touchObj, event, {\r\n                        dX: touchObj.pageX - dragObj.lastPageX,\r\n                        dY: touchObj.pageY - dragObj.lastPageY,\r\n                        downPageX: dragObj.downPageX,\r\n                        downPageY: dragObj.downPageY,\r\n                        button: 'left',\r\n                        isCoalesced: false,\r\n                        pressure: 1\r\n                    });\r\n                    dragObj.lastPageX = touchObj.pageX;\r\n                    dragObj.lastPageY = touchObj.pageY;\r\n                    onPointerCallback(outEvent);\r\n\r\n                }\r\n\r\n            }\r\n\r\n            onTouchend = function (event) {\r\n                if (event.type !== 'touchcancel') {\r\n                    event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\r\n                }\r\n\r\n\r\n                const touchArr = event.changedTouches;\r\n                for (let i = 0; i < touchArr.length; i++) {\r\n                    const touchObj = touchArr[i];\r\n\r\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\r\n                        continue;\r\n                    }\r\n\r\n                    //remove listener\r\n                    if (dragObjArr.length === 1) {\r\n                        removeEventListener(document, 'touchmove', onTouchmove);\r\n                        removeEventListener(document, 'touchend', onTouchend);\r\n                        removeEventListener(document, 'touchcancel', onTouchend);\r\n                    }\r\n                    const dragObj = removeDragObj(touchObj.identifier);\r\n\r\n                    const outEvent = createTouchOutEvent('pointerup', touchObj, event, {\r\n                        dX: touchObj.pageX - dragObj.lastPageX,\r\n                        dY: touchObj.pageY - dragObj.lastPageY,\r\n                        downPageX: dragObj.downPageX,\r\n                        downPageY: dragObj.downPageY,\r\n                    });\r\n\r\n                    onPointerCallback(outEvent);\r\n                }\r\n\r\n            }\r\n\r\n            if (onPointerCallback) {\r\n                addEventListener(targetElement, 'touchstart', onTouchstart);\r\n            }\r\n\r\n        } else if (p.fixScribble) {\r\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\r\n            onTouchmove = function(e) {\r\n                e.preventDefault();\r\n            }\r\n            addEventListener(targetElement, 'touchmove', onTouchmove);\r\n\r\n        }\r\n\r\n\r\n        // --- interface ---\r\n\r\n        this.isOver = function () {\r\n            return isOverCounter > 0;\r\n        };\r\n\r\n        this.destroy = function () {\r\n            if (isDestroyed) {\r\n                return;\r\n            }\r\n            isDestroyed = true;\r\n            removeEventListener(targetElement, 'pointerenter', onPointerEnter);\r\n            removeEventListener(targetElement, 'pointerleave', onPointerLeave);\r\n            removeEventListener(targetElement, 'pointermove', onPointermove);\r\n            removeEventListener(targetElement, 'pointerdown', onPointerdown);\r\n            removeEventListener(targetElement, 'wheel', wheelCleaner.process);\r\n            if (dragObjArr.length > 0) {\r\n                destroyDocumentListeners();\r\n            }\r\n\r\n            if (!(hasPointerEvents)) {\r\n                removeEventListener(targetElement, 'touchstart', onTouchstart);\r\n                if (dragObjArr.length > 0) {\r\n                    removeEventListener(document, 'touchmove', onTouchmove);\r\n                    removeEventListener(document, 'touchend', onTouchend);\r\n                    removeEventListener(document, 'touchcancel', onTouchend);\r\n                }\r\n            } else {\r\n                removeEventListener(targetElement, 'touchmove', onTouchmove);\r\n            }\r\n        };\r\n\r\n    }\r\n})();","import {IBounds, IVector2D} from '../BB.types';\r\n\r\nexport function mix (a: number, b: number, f: number): number {\r\n    return a * (1 - f) + b * f;\r\n}\r\n\r\nexport function dist (ax: number, ay: number, bx: number, by: number): number {\r\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\r\n}\r\n\r\nexport function distSquared (ax: number, ay: number, bx: number, by: number): number {\r\n    // faster because no square-root\r\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\r\n}\r\n\r\nexport function lenSquared (x: number, y: number): number {\r\n    // faster because no square-root\r\n    return x * x + y * y;\r\n}\r\n\r\nexport function pointsToAngleRad (p1: IVector2D, p2: IVector2D): number {\r\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n}\r\n\r\nexport function pointsToAngleDeg (p1: IVector2D, p2: IVector2D): number {\r\n    return pointsToAngleRad(p1, p2) * 180 / Math.PI;\r\n}\r\n\r\nexport function clamp (num: number, min: number, max: number): number {\r\n    return num <= min\r\n        ? min\r\n        : num >= max\r\n            ? max\r\n            : num;\r\n}\r\n\r\nexport function rotate (x: number, y: number, deg: number): IVector2D {\r\n    const theta = deg * (Math.PI / 180);\r\n    const cs = Math.cos(theta);\r\n    const sn = Math.sin(theta);\r\n\r\n    return {\r\n        x: x * cs - y * sn,\r\n        y: x * sn + y * cs\r\n    };\r\n}\r\n\r\nexport function rotateAround (center: IVector2D, point: IVector2D, deg: number): IVector2D {\r\n    const rot = rotate(point.x - center.x, point.y - center.y, deg);\r\n    rot.x += center.x;\r\n    rot.y += center.y;\r\n    return rot;\r\n}\r\n\r\nexport function intDxy(remainder: IVector2D, fDx: number, fDy: number) {\r\n    remainder.x += fDx;\r\n    remainder.y += fDy;\r\n    const dX = Math.round(remainder.x);\r\n    const dY = Math.round(remainder.y);\r\n    remainder.x -= dX;\r\n    remainder.y -= dY;\r\n    return {\r\n        dX,\r\n        dY,\r\n    };\r\n}\r\n\r\n/**\r\n * return closest even number\r\n * @param f\r\n */\r\nexport function roundEven(f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f;\r\n        }\r\n        return f + 1;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 0) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * return closest uneven number\r\n * @param f\r\n */\r\nexport function roundUneven(f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f + 1;\r\n        }\r\n        return f;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 1) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * update target so it includes bounds\r\n * @param target\r\n * @param bounds\r\n */\r\nexport function updateBounds (target: IBounds, bounds: IBounds): IBounds {\r\n    if (!bounds) {\r\n        return target;\r\n    }\r\n    if (!target) {\r\n        target = { x1: bounds.x1, y1: bounds.y1, x2: bounds.x2, y2: bounds.y2 };\r\n    } else {\r\n        target.x1 = Math.min(target.x1, bounds.x1);\r\n        target.y1 = Math.min(target.y1, bounds.y1);\r\n        target.x2 = Math.max(target.x2, bounds.x2);\r\n        target.y2 = Math.max(target.y2, bounds.y2);\r\n    }\r\n    return target;\r\n}\r\n\r\n/**\r\n * determine overlap of bounds with width&height\r\n */\r\nexport function boundsInArea (bounds: IBounds, width: number, height: number): IBounds | null {\r\n    let x1 = Math.max(0, bounds.x1);\r\n    let y1 = Math.max(0, bounds.y1);\r\n    let x2 = Math.min(width - 1, bounds.x2);\r\n    let y2 = Math.min(height - 1, bounds.y2);\r\n    if (x1 > x2 || y1 > y2) {\r\n        return null;\r\n    }\r\n    return { x1, y1, x2, y2 };\r\n}","import {clamp, dist, mix, pointsToAngleRad} from '../math/math';\r\n\r\n\r\ntype ChainOutFunc = (event?) => void;\r\n\r\n/**\r\n * for chaining event processing. useful for gestures (double tap, pinch zoom, max pointer filter).\r\n * each element in the chain might hold back the events, swallow them, or transform them\r\n *\r\n * p = {\r\n *     chainArr: ChainElement[]\r\n * }\r\n *\r\n * chainIn(event): null - feed an event into the chain\r\n * setChainOut(func): void - func(event) <- called when passed through chain\r\n * ^ each ChainElement needs these methods too\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const EventChain = function (p) {\r\n\r\n    const chainArr = p.chainArr;\r\n    let chainOut: ChainOutFunc = () => undefined;\r\n\r\n    function continueChain(i, event) {\r\n        for (; i < chainArr.length; i++) {\r\n            event = chainArr[i].chainIn(event);\r\n            if (event === null) {\r\n                return null;\r\n            }\r\n        }\r\n        chainOut(event);\r\n        return null;\r\n    }\r\n\r\n    for (let i = 0; i < chainArr.length; i++) {\r\n        (function (i) {\r\n            chainArr[i].setChainOut(function (event) {\r\n                continueChain(i + 1, event);\r\n            });\r\n        })(i);\r\n    }\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n        return continueChain(0, event);\r\n    };\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Detects double taps.\r\n *\r\n * p = {\r\n *     onDoubleTap: function({pageX: number, pageY: number}) - fires when double tap occurs\r\n * }\r\n *\r\n * chainIn\r\n * setChainOut\r\n * setAllowedPointerTypeArr(string[]): void - which pointer types are allowed\r\n * setAllowedButtonArr(string[]): void - which buttons are allowed\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const DoubleTapper = function (p) {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n    const minSilenceBeforeDurationMs = 400;\r\n    const maxPressedDurationMs = 300;\r\n    const maxPressedDistancePx = 10;\r\n    const maxInbetweenDistancePx = 19;\r\n    const maxUpToUpDurationMs = 500;\r\n    const maxUntilSecondDownDurationMs = 300;\r\n    const minSilenceAfterMs = 250;\r\n\r\n    let allowedPointerTypeArr = ['touch', 'mouse', 'pen'];\r\n    let allowedButtonArr = ['left'];\r\n\r\n    let sequenceArr = [];\r\n    const pointersDownIdArr = [];\r\n    let lastUpTime = 0;\r\n    let nowTime = 0;\r\n\r\n    let eventQueueArr = [];\r\n\r\n\r\n    function fail() {\r\n        if (sequenceArr.length === 0) { // no gesture started -> can be ignored\r\n            return;\r\n        }\r\n        clearTimeout(timeoutObj.fail);\r\n        clearTimeout(timeoutObj.maxUntilSecondDown);\r\n        clearTimeout(timeoutObj.success);\r\n        timeoutObj.fail = null;\r\n        timeoutObj.maxUntilSecondDown = null;\r\n        timeoutObj.success = null;\r\n\r\n\r\n        for (let i = 0; i < eventQueueArr.length; i++) {\r\n            chainOut(eventQueueArr[i]);\r\n        }\r\n        eventQueueArr = [];\r\n\r\n        sequenceArr = [];\r\n    }\r\n\r\n    // double tap achieved\r\n    function success() {\r\n        timeoutObj.fail = null;\r\n        timeoutObj.success = null;\r\n        eventQueueArr = []; // events get swallowed\r\n        const lastSequenceItem = sequenceArr[sequenceArr.length - 1];\r\n        sequenceArr = [];\r\n        p.onDoubleTap({pageX: lastSequenceItem.pageX, pageY: lastSequenceItem.pageY});\r\n    }\r\n\r\n\r\n    const timeoutObj = {\r\n        fail: null,\r\n        maxUntilSecondDown: null,\r\n        success: null\r\n    };\r\n\r\n    //returns false if time already up. otherwise sets up timeout\r\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\r\n        const diff = timeMS - nowTime;\r\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\r\n        return true;\r\n    }\r\n\r\n\r\n    /**\r\n     * @param event object - a pointer event from BB.PointerListener\r\n     */\r\n    function processEvent(event) {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\r\n                if (pointersDownIdArr[i] === event.pointerId) {\r\n                    pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!allowedPointerTypeArr.includes(event.pointerType)) { //wrong input type -> fail\r\n            //console.log('wrong input type -> fail');\r\n            fail();\r\n            return;\r\n        }\r\n\r\n        nowTime = performance.now();\r\n        const lastSequenceItem = sequenceArr.length > 0 ? sequenceArr[sequenceArr.length - 1] : null;\r\n        if (event.type === 'pointerup') {\r\n            lastUpTime = event.time;\r\n        }\r\n\r\n        if (event.type === 'pointerdown') {\r\n            if (pointersDownIdArr.length > 1) { // more than one pointer down -> fail\r\n                //console.log('more than one pointer down -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (timeoutObj.success !== null) { // silence-after not achieved -> fail\r\n                //console.log('silence-after not achieved -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (sequenceArr.length === 0 && nowTime - lastUpTime < minSilenceBeforeDurationMs) { // silence before not achieved -> fail\r\n                //console.log('silence before not achieved -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (!allowedButtonArr.includes(event.button)) { // wrong button -> fail\r\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\r\n                fail();\r\n                return;\r\n            }\r\n            if (lastSequenceItem && lastSequenceItem.isDown || sequenceArr.length > 2) { // jumbled -> fail\r\n                //console.log('jumbled -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (lastSequenceItem) {\r\n                const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n                if (distance > maxInbetweenDistancePx) { //moved too much -> reset\r\n                    //console.log('maxInbetweenDistancePx -> reset');\r\n                    fail();\r\n\r\n                    if (nowTime - lastSequenceItem.time < minSilenceBeforeDurationMs) { //silence before not achieved -> fail\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            sequenceArr.push({\r\n                isDown: true,\r\n                time: nowTime,\r\n                position: [event.pageX, event.pageY],\r\n                pointerId: event.pointerId\r\n            });\r\n            //maxUntilSecondDown\r\n\r\n            if (sequenceArr.length > 1) {\r\n                clearTimeout(timeoutObj.maxUntilSecondDown);\r\n            } else if (!setupTimeout('maxUntilSecondDown', fail, event.time + maxUntilSecondDownDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n\r\n            clearTimeout(timeoutObj.fail);\r\n            if (!setupTimeout('fail', fail, event.time + maxPressedDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointermove' && lastSequenceItem.pointerId === event.pointerId) {\r\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                console.log('another pointer mixing in -> fail');\r\n                fail();\r\n                return;\r\n            }*/\r\n            const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n            if (distance > maxPressedDistancePx) { //moved too much -> fail\r\n                //console.log('maxPressedDistancePx -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointerup') {\r\n            if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                fail();\r\n                return;\r\n            }\r\n            if (nowTime >= lastSequenceItem.time + maxPressedDurationMs) { //pressed too long -> fail\r\n                fail();\r\n                return;\r\n            }\r\n            clearTimeout(timeoutObj.fail);\r\n\r\n            if (sequenceArr.length < 3) {\r\n                if (!setupTimeout('fail', fail, event.time + maxUpToUpDurationMs)) {\r\n                    fail();\r\n                    return;\r\n                }\r\n\r\n                sequenceArr = [\r\n                    lastSequenceItem,\r\n                    {\r\n                        isUp: true,\r\n                        time: nowTime,\r\n                        position: [event.pageX, event.pageY]\r\n                    }\r\n                ];\r\n                return;\r\n            }\r\n\r\n            if (nowTime < sequenceArr[1].time + maxUpToUpDurationMs) {\r\n                // double tap almost success\r\n                // only needs silence\r\n                sequenceArr.push({\r\n                    pageX: event.pageX,\r\n                    pageY: event.pageY\r\n                });\r\n                if (!setupTimeout('success', success, event.time + minSilenceAfterMs)) {\r\n                    fail();\r\n                }\r\n            } else { // time up -> fail\r\n                fail();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        processEvent(event);\r\n\r\n        if (sequenceArr.length === 0) { //existing events can not become a double tap\r\n            fail();\r\n            return event;\r\n        }\r\n        // events might become a double tap -> queue\r\n        eventQueueArr.push(event);\r\n        return null;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n\r\n    this.setAllowedPointerTypeArr = function (arr) {\r\n        allowedPointerTypeArr = arr;\r\n    };\r\n\r\n    this.setAllowedButtonArr = function (arr) {\r\n        allowedButtonArr = arr;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Detects a single tap, done with N 'touch' pointers\r\n *\r\n * p = {\r\n *      fingers: number - number of fingers\r\n *      onTap: function() - fires when tap occurs\r\n * }\r\n *\r\n * chainIn\r\n * setChainOut\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const NFingerTapper = function (p) {\r\n\r\n    const fingers = p.fingers;\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    const minSilenceBeforeDurationMs = 50; //250;\r\n    const maxTapMs = 500;\r\n    const maxFirstLastFingerDownMs = 250;\r\n    const maxPressedDistancePx = 12; //5 + fingers * 5;\r\n    const silenceAfterDurationMs = 250;\r\n\r\n\r\n    /*\r\n        fingerObj = {\r\n            pointerId: number,\r\n            downTime: number,\r\n            downPageX: number,\r\n            downPageY: number,\r\n            isUp: boolean\r\n        }\r\n     */\r\n    let fingerArr = [];\r\n    let firstDownTime;\r\n    let eventQueueArr = [];\r\n    let lastEventTime = 0;\r\n    const pointersDownIdArr = [];\r\n\r\n    function fail() {\r\n        if (eventQueueArr.length === 0) {\r\n            return;\r\n        }\r\n        clearTimeout(timeoutObj.firstLastDownTimeout);\r\n        clearTimeout(timeoutObj.tapTimeout);\r\n        for (let i = 0; i < eventQueueArr.length; i++) {\r\n            chainOut(eventQueueArr[i]);\r\n        }\r\n        eventQueueArr = [];\r\n        fingerArr = [];\r\n    }\r\n\r\n    function success() {\r\n        clearTimeout(timeoutObj.firstLastDownTimeout);\r\n        clearTimeout(timeoutObj.tapTimeout);\r\n        eventQueueArr = []; // events get swallowed\r\n        fingerArr = [];\r\n        p.onTap();\r\n    }\r\n\r\n    let nowTime;\r\n    const timeoutObj = {\r\n        firstLastDownTimeout: null,\r\n        tapTimeout: null\r\n    };\r\n\r\n    function setupTimeout(timeoutStr, timeMS) {\r\n        const diff = timeMS - nowTime;\r\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        timeoutObj[timeoutStr] = setTimeout(fail, diff);\r\n        return true;\r\n    }\r\n\r\n    function processEvent(event) {\r\n\r\n        const tempLastEventTime = lastEventTime;\r\n        lastEventTime = event.time;\r\n\r\n        if (event.type === 'pointerdown') {\r\n            pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\r\n                if (pointersDownIdArr[i] === event.pointerId) {\r\n                    pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (event.pointerType !== 'touch') {\r\n            if (fingerArr.length > 0) { // already in gesture -> fail\r\n                fail();\r\n            }\r\n            return;\r\n        }\r\n\r\n        nowTime = performance.now();\r\n\r\n        if (event.type === 'pointerdown') {\r\n            //console.log('down');\r\n            if (fingerArr.length + 1 !== pointersDownIdArr.length) { // failed before, and some fingers are still down -> fail\r\n                fail();\r\n                return;\r\n            }\r\n            if (fingerArr.length === fingers) { // too many fingers down -> fail\r\n                //console.log(fingers + ': too many fingers down -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (fingerArr.length > 0 && event.time - maxFirstLastFingerDownMs > fingerArr[0].downTime) { // took too long to touch with all fingers -> fail\r\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (fingerArr.length === 0 && event.time - minSilenceBeforeDurationMs < tempLastEventTime) { // not enough silence before -> fail\r\n                //console.log(fingers + ': not enough silence before -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            if (fingerArr.length === 0) {\r\n                firstDownTime = event.time;\r\n\r\n                if (!setupTimeout('firstLastDownTimeout', event.time + maxFirstLastFingerDownMs) || !setupTimeout('tapTimeout', event.time + maxTapMs)) { // timeouts already up -> fail\r\n                    fail();\r\n                    return;\r\n                }\r\n\r\n            }\r\n            fingerArr.push({\r\n                pointerId: event.pointerId,\r\n                downTime: event.time,\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY\r\n            });\r\n            return;\r\n\r\n        }\r\n\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            for (let i = 0; i < fingerArr.length; i++) {\r\n                if (fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) { // finger not part of the tap is on screen -> fail\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\r\n                fail();\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'pointerup') {\r\n\r\n            if (fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            //console.log('up', event.pageX, event.pageY);\r\n            if (fingerArr.length !== fingers) { // not enough fingers -> fail\r\n                //console.log(fingers + ': not enough fingers -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            let i = 0;\r\n            for (; i < fingerArr.length; i++) {\r\n                if (fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) {\r\n                //do nothing\r\n                return;\r\n            }\r\n\r\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\r\n                //console.log(fingerArr);\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            fingerObj.isUp = true;\r\n\r\n            let allAreUp = true;\r\n            for (let i = 0; i < fingerArr.length; i++) {\r\n                if (!fingerArr[i].isUp) {\r\n                    allAreUp = false;\r\n                    break;\r\n                }\r\n            }\r\n            //console.log('fingerArr', fingerArr);\r\n\r\n            if (allAreUp) { // success\r\n                success();\r\n                return true;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        const result = processEvent(event);\r\n\r\n        //console.log(fingerArr.length);\r\n\r\n        if (result === true) {\r\n            //tap success -> event gets swallowed\r\n            return null;\r\n        }\r\n        if (fingerArr.length === 0) {\r\n            return event;\r\n        } else {\r\n            eventQueueArr.push(event);\r\n        }\r\n\r\n        return null;\r\n\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Detects a pinch zooming (2 touch pointers). If one finger lifts, then will use the remaining.\r\n * Further pointers are ignored, but their events get swallowed during the pinching.\r\n * pinching ends when ALL pointers are lifted.\r\n * Events passed through if no pinching.\r\n *\r\n * p = {\r\n *      onPinch: function({type: 'end'} | {\r\n *          type: 'move',\r\n *          relX: number,\r\n *          relY: number,\r\n *          downRelX: number,\r\n *          downRelY: number,\r\n *          angleDeg: number,\r\n *          scale: number\r\n *      }) - fires when pinching occurs\r\n * }\r\n *\r\n * chainIn\r\n * setChainOut\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const PinchZoomer = function (p) {\r\n\r\n    const firstFingerMaxDistancePx = 10;\r\n    const untilSecondFingerDurationMs = 250;\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n    const pointersDownIdArr = [];\r\n    /*\r\n    gestureObj = {\r\n        touchPointerArr: Array of {\r\n            pointerId: number,\r\n            relX: number,\r\n            relY: number,\r\n            downRelX: number, // only for first\r\n            downRelY: number\r\n        },\r\n        otherPointerIdArr: number[],\r\n        isInProgress: boolean\r\n    }\r\n    */\r\n    let gestureObj = null;\r\n    let eventQueueArr = [];\r\n\r\n\r\n    function end() {\r\n        gestureObj = null;\r\n        eventQueueArr = [];\r\n    }\r\n\r\n    function fail(doSwallow?) {\r\n        if (!gestureObj) { // no gesture happening -> ignore\r\n            return;\r\n        }\r\n\r\n        clearTimeout(timeoutObj.secondFingerTimeout);\r\n        if (!doSwallow) {\r\n            for (let i = 0; i < eventQueueArr.length; i++) {\r\n                chainOut(eventQueueArr[i]);\r\n            }\r\n        }\r\n        end();\r\n    }\r\n\r\n\r\n    let nowTime;\r\n    const timeoutObj = {\r\n        secondFingerTimeout: null\r\n    };\r\n\r\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\r\n        const diff = timeMS - nowTime;\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\r\n        return true;\r\n    }\r\n\r\n\r\n    function processEvent(event) {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            pointersDownIdArr.push(event.pointerId);\r\n\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\r\n                if (pointersDownIdArr[i] === event.pointerId) {\r\n                    pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        //pass through scenarios\r\n        if (\r\n            !gestureObj && (\r\n                event.pointerType !== 'touch' || // wrong pointer type\r\n                (event.type === 'pointermove' && pointersDownIdArr.length > 0) || // failed before\r\n                pointersDownIdArr.length > 1 || // failed before\r\n                event.type === 'pointerup' // failed before\r\n            )\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        nowTime = performance.now();\r\n\r\n\r\n        //pointer down\r\n        if (event.type === 'pointerdown') {\r\n\r\n            if (gestureObj) {\r\n                if (event.pointerType === 'touch') { // touch finger down - as nth pointer\r\n\r\n                    gestureObj.touchPointerArr.push({\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY\r\n                    });\r\n\r\n                    if (gestureObj.isInProgress) {\r\n                        continuePinch(gestureObj, {\r\n                            type: 'down',\r\n                            index: gestureObj.touchPointerArr.length - 1\r\n                        });\r\n                    } else {\r\n                        clearTimeout(timeoutObj.secondFingerTimeout);\r\n                        gestureObj.isInProgress = true;\r\n                        beginPinch(gestureObj);\r\n                    }\r\n                    return;\r\n\r\n                } else { // non-touch finger down - as nth pointer\r\n\r\n                    if (gestureObj.isInProgress) {\r\n                        gestureObj.otherPointerIdArr.push(event.pointerId);\r\n                    } else { // second pointer wrong type -> fail\r\n                        fail();\r\n                    }\r\n                    return;\r\n                }\r\n\r\n\r\n            } else {\r\n                // first finger down - can only be touch if no gestureObj\r\n                gestureObj = {\r\n                    touchPointerArr: [{\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY,\r\n                        downRelX: event.relX,\r\n                        downRelY: event.relY\r\n                    }],\r\n                    otherPointerIdArr: [],\r\n                    isInProgress: false\r\n                };\r\n                if (!setupTimeout('secondFingerTimeout', function () {\r\n                    fail();\r\n                }, event.time + untilSecondFingerDurationMs)) { // time ran out -> fail\r\n                    fail();\r\n                    return;\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n\r\n        //pointer move\r\n        if (event.type === 'pointermove' && event.pointerType === 'touch') {\r\n            //gesture object should always exist here\r\n\r\n            let touchPointerObj = null;\r\n            let i = 0;\r\n            for (; i < gestureObj.touchPointerArr.length; i++) {\r\n                if (event.pointerId === gestureObj.touchPointerArr[i].pointerId) {\r\n                    touchPointerObj = gestureObj.touchPointerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n\r\n            //null should not be possible\r\n\r\n            touchPointerObj.relX = event.relX;\r\n            touchPointerObj.relY = event.relY;\r\n\r\n            if (!gestureObj.isInProgress) { // only one finger down & pinching hasn't started\r\n                const distance = dist(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\r\n                if (distance > firstFingerMaxDistancePx) { // moved too much -> fail\r\n                    fail();\r\n                    return;\r\n                }\r\n\r\n            } else {\r\n                if (i < 2) { // only first two touches can affect pinching\r\n                    continuePinch(gestureObj, {\r\n                        type: 'move',\r\n                        index: i\r\n                    });\r\n                }\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n\r\n        //pointer up\r\n        if (event.type === 'pointerup') {\r\n            //gesture object should always exist here\r\n\r\n            if (event.pointerType === 'touch') {\r\n                let i = 0;\r\n                for (; i < gestureObj.touchPointerArr.length; i++) {\r\n                    if (gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\r\n                        gestureObj.touchPointerArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n                if (gestureObj.touchPointerArr.length > 0) {\r\n                    continuePinch(gestureObj, {\r\n                        type: 'up',\r\n                        index: i\r\n                    });\r\n                }\r\n\r\n            } else { // non-touch\r\n                for (let i = 0; i < gestureObj.otherPointerIdArr.length; i++) {\r\n                    if (gestureObj.otherPointerIdArr[i] === event.pointerId) {\r\n                        gestureObj.otherPointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            //all fingers lifted?\r\n            if (gestureObj.touchPointerArr.length === 0 && gestureObj.otherPointerIdArr.length === 0) {\r\n                if (gestureObj.isInProgress) { // lifted last finger -> end of pinching\r\n                    end();\r\n                    endPinch();\r\n                } else { // lifted finger again before pinching started -> fail\r\n                    fail();\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    // --- actual pinch transform logic ---\r\n\r\n    let pincherArr = [];\r\n\r\n    function beginPinch(gestureObj) {\r\n\r\n        for (let i = 0; i < gestureObj.touchPointerArr.length; i++) {\r\n            const pointerObj = gestureObj.touchPointerArr[i];\r\n            pincherArr.push({\r\n                pointerId: pointerObj.pointerId,\r\n                relX: pointerObj.relX,\r\n                relY: pointerObj.relY,\r\n                downRelX: pointerObj.relX,\r\n                downRelY: pointerObj.relY\r\n            });\r\n        }\r\n\r\n        const event: any = {\r\n            type: 'move',\r\n            angleRad: 0,\r\n            scale: 1\r\n        };\r\n\r\n        if (pincherArr.length === 1) {\r\n            event.relX = pincherArr[0].downRelX;\r\n            event.relY = pincherArr[0].downRelY;\r\n        } else {\r\n            event.relX = 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX);\r\n            event.relY = 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY);\r\n        }\r\n        event.downRelX = event.relX;\r\n        event.downRelY = event.relY;\r\n\r\n        p.onPinch(event);\r\n\r\n    }\r\n\r\n    //actionObj = {type: 'down'|'move'|'up', index: number}\r\n    function continuePinch(gestureObj, actionObj) {\r\n\r\n        if (actionObj.index > 1) { // only first two pointers matter\r\n            return;\r\n        }\r\n\r\n        if (actionObj.type === 'move') {\r\n\r\n            let event;\r\n            pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\r\n            pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\r\n\r\n            if (pincherArr.length === 1) {\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: pincherArr[0].downRelX,\r\n                    downRelY: pincherArr[0].downRelY,\r\n                    relX: pincherArr[0].relX,\r\n                    relY: pincherArr[0].relY,\r\n                    angleRad: 0,\r\n                    scale: 1\r\n                };\r\n\r\n            } else {\r\n\r\n                const startDist = dist(pincherArr[0].downRelX, pincherArr[0].downRelY, pincherArr[1].downRelX, pincherArr[1].downRelY);\r\n                const distance = dist(pincherArr[0].relX, pincherArr[0].relY, pincherArr[1].relX, pincherArr[1].relY);\r\n\r\n                const startAngle = pointsToAngleRad({\r\n                    x: pincherArr[0].downRelX,\r\n                    y: pincherArr[0].downRelY\r\n                }, {x: pincherArr[1].downRelX, y: pincherArr[1].downRelY});\r\n                const angle = pointsToAngleRad({\r\n                    x: pincherArr[0].relX,\r\n                    y: pincherArr[0].relY\r\n                }, {x: pincherArr[1].relX, y: pincherArr[1].relY});\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX),\r\n                    downRelY: 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY),\r\n                    relX: 0.5 * (pincherArr[0].relX + pincherArr[1].relX),\r\n                    relY: 0.5 * (pincherArr[0].relY + pincherArr[1].relY),\r\n                    angleRad: angle - startAngle,\r\n                    scale: distance / startDist\r\n                };\r\n\r\n            }\r\n\r\n            p.onPinch(event);\r\n\r\n        } else if (actionObj.type === 'down' || actionObj.type === 'up') {\r\n            endPinch();\r\n            beginPinch(gestureObj);\r\n        }\r\n\r\n    }\r\n\r\n    function endPinch() {\r\n        pincherArr = [];\r\n        p.onPinch({\r\n            type: 'end'\r\n        });\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n        processEvent(event);\r\n        if (gestureObj) {\r\n            if (!gestureObj.isInProgress) { // might still fail -> into queue\r\n                eventQueueArr.push(event);\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n        return null;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Splits up coalesced events into their own pointermove events. Otherwise regular pass through.\r\n *\r\n * @constructor\r\n */\r\nexport const CoalescedExploder = function () {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (event.coalescedArr.length > 0) {\r\n\r\n                let eventCopy = JSON.parse(JSON.stringify(event));\r\n                eventCopy.coalescedArr = [];\r\n                let coalescedItem;\r\n\r\n                for (let i = 0; i < event.coalescedArr.length; i++) {\r\n\r\n                    if (i > 0) {\r\n                        eventCopy = JSON.parse(JSON.stringify(event));\r\n                    }\r\n                    coalescedItem = event.coalescedArr[i];\r\n\r\n                    eventCopy.pageX = coalescedItem.pageX;\r\n                    eventCopy.pageY = coalescedItem.pageY;\r\n                    eventCopy.relX = coalescedItem.relX;\r\n                    eventCopy.relY = coalescedItem.relY;\r\n                    eventCopy.dX = coalescedItem.dX;\r\n                    eventCopy.dY = coalescedItem.dY;\r\n                    eventCopy.time = coalescedItem.time;\r\n                    if (i < event.coalescedArr.length - 1) {\r\n                        eventCopy.isCoalesced = true;\r\n                    }\r\n\r\n                    chainOut(eventCopy);\r\n                }\r\n\r\n            } else {\r\n                return event;\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\nexport const OnePointerLimiter = function (pointers?) {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    let downPointerId = null;\r\n    const ignorePointerIdArr = [];\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        if (ignorePointerIdArr.includes(event.pointerId)) {\r\n            if (event.type === 'pointerup') {\r\n                for (let i = 0; i < ignorePointerIdArr.length; i++) {\r\n                    if (ignorePointerIdArr[i] === event.pointerId) {\r\n                        ignorePointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        if (downPointerId === null) {\r\n            if (event.type === 'pointerdown') {\r\n                downPointerId = event.pointerId;\r\n            }\r\n            return event;\r\n\r\n        } else {\r\n            if (event.pointerId !== downPointerId) {\r\n                if (event.type === 'pointerdown') {\r\n                    ignorePointerIdArr.push(event.pointerId);\r\n                }\r\n                return null;\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                downPointerId = null;\r\n            }\r\n            return event;\r\n        }\r\n\r\n        return null;\r\n\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n\r\n};\r\n\r\n\r\n/**\r\n * Not really and event chain element. but pretty similar.\r\n *\r\n * Processes draw input events. When shift held -> linetool\r\n * line events - what KlCanvasWorkspace passes onDraw(e)\r\n *\r\n * p = {\r\n *     onDraw: function(drawEvent)\r\n * }\r\n *\r\n * pass input in with process(drawEvent)\r\n *\r\n * modifies draw event to include such events:\r\n * {\r\n *     type: 'line',\r\n *     x0: null, // you have to fill that in\r\n *     y0: null, // you have to fill that in\r\n *     pressure0: null, // you have to fill that in\r\n *     x1: number,\r\n *     y1: number,\r\n *     pressure1: number\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const LinetoolProcessor = function (p) {\r\n\r\n    let downEvent = null;\r\n    let eventQueue = [];\r\n    let direction = null;\r\n    const DIR_X = 0, DIR_Y = 1;\r\n\r\n    this.process = function (event) {\r\n        if (event.type === 'down') {\r\n            downEvent = event;\r\n            direction = null;\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                p.onDraw({\r\n                    type: 'line',\r\n                    x0: null,\r\n                    y0: null,\r\n                    pressure0: null,\r\n                    x1: event.x,\r\n                    y1: event.y,\r\n                    pressure1: event.pressure\r\n                });\r\n\r\n                eventQueue.push(event);\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'move') {\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                if (direction === null) {\r\n                    const dX = Math.abs(event.x - downEvent.x);\r\n                    const dY = Math.abs(event.y - downEvent.y);\r\n\r\n                    if (dX > 5 || dY > 5) {\r\n                        direction = dX > dY ? DIR_X : DIR_Y;\r\n\r\n                        for (let i = 0; i < eventQueue.length; i++) {\r\n                            const e = eventQueue[i];\r\n                            if (direction === DIR_X) {\r\n                                e.y = downEvent.y;\r\n                            } else {\r\n                                e.x = downEvent.x;\r\n                            }\r\n                            p.onDraw(JSON.parse(JSON.stringify(e)));\r\n                        }\r\n                        eventQueue = [];\r\n                    }\r\n                }\r\n\r\n                if (direction === null) {\r\n                    eventQueue.push(event);\r\n                    return;\r\n                }\r\n\r\n                if (direction === DIR_X) {\r\n                    event.y = downEvent.y;\r\n                } else {\r\n                    event.x = downEvent.x;\r\n                }\r\n\r\n            } else {\r\n                if (eventQueue.length > 0) {\r\n                    for (let i = 0; i < eventQueue.length; i++) {\r\n                        p.onDraw(JSON.parse(JSON.stringify(eventQueue[i])));\r\n                    }\r\n                    eventQueue = [];\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'up') {\r\n            eventQueue = [];\r\n        }\r\n\r\n        p.onDraw(JSON.parse(JSON.stringify(event)));\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * cleans up DrawEvents. More trustworthy events. EventChain element\r\n *\r\n * that events can only go line this: down -> n x move -> up\r\n * so, sanitizes this: down, down, down. becomes only one down. the other downs are ignored/swallowed\r\n * @constructor\r\n */\r\nexport const LineSanitizer = function () {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    let isDrawing = false;\r\n\r\n    // --- interface ---\r\n    this.chainIn = function (event) {\r\n\r\n        if (event.type === 'down') {\r\n            if (isDrawing) {\r\n                //console.log('line sanitizer - down, but already drawing');\r\n                chainOut({\r\n                    type: 'up',\r\n                    scale: event.scale,\r\n                    shiftIsPressed: event.shiftIsPressed,\r\n                    isCoalesced: false\r\n                });\r\n            } else {\r\n                isDrawing = true;\r\n            }\r\n        }\r\n        if (!isDrawing && (event.type === 'move' || event.type === 'up')) {\r\n            //console.log('line sanitizer - ' + event.type + ' but not drawing');\r\n            return null;\r\n        }\r\n\r\n        if (event.type === 'up' && isDrawing) {\r\n            isDrawing = false;\r\n        }\r\n\r\n        return event;\r\n    };\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n    this.getIsDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * Line smoothing. EventChain element. Smoothing via blending new position with old position.\r\n * for onDraw events from KlCanvasWorkspace.\r\n *\r\n * p = {\r\n *     smoothing: number, // 0-1, 0: no smoothing, 1: 100% smoothing -> would never catch up\r\n * }\r\n *\r\n * smoothing > 0: will fire DrawEvents in interval when no new move events\r\n *\r\n * type: 'line' Events are just passed through.\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const LineSmoothing = function (p) {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n    let smoothing = clamp(p.smoothing, 0, 1);\r\n    let lastMixedInput;\r\n    let interval;\r\n    let timeout;\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n        event = JSON.parse(JSON.stringify(event));\r\n        clearTimeout(timeout);\r\n        clearInterval(interval);\r\n\r\n        if (event.type === 'down') {\r\n            lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure\r\n            };\r\n        }\r\n\r\n        if (event.type === 'move') {\r\n\r\n            const inputX = event.x;\r\n            const inputY = event.y;\r\n            const inputPressure = event.pressure;\r\n\r\n            event.x = mix(event.x, lastMixedInput.x, smoothing);\r\n            event.y = mix(event.y, lastMixedInput.y, smoothing);\r\n            event.pressure = mix(event.pressure, lastMixedInput.pressure, smoothing);\r\n            lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure\r\n            };\r\n\r\n            if (smoothing > 0) {\r\n                timeout = setTimeout(function () {\r\n                    interval = setInterval(function () {\r\n                        event = JSON.parse(JSON.stringify(event));\r\n\r\n                        event.x = mix(inputX, lastMixedInput.x, smoothing);\r\n                        event.y = mix(inputY, lastMixedInput.y, smoothing);\r\n                        event.pressure = mix(inputPressure, lastMixedInput.pressure, smoothing);\r\n                        lastMixedInput = {\r\n                            x: event.x,\r\n                            y: event.y,\r\n                            pressure: event.pressure\r\n                        };\r\n\r\n                        chainOut(event);\r\n                    }, 35);\r\n                }, 80);\r\n            }\r\n\r\n        }\r\n\r\n        return event;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n\r\n    this.setSmoothing = function (s) {\r\n        smoothing = clamp(s, 0, 1);\r\n    };\r\n};\r\n","import {IKeyString} from '../BB.types';\r\nimport {createCanvas} from './create-canvas';\r\n\r\nexport function copyCanvas(canvas: HTMLCanvasElement): HTMLCanvasElement {\r\n    const resultCanvas = createCanvas(canvas.width, canvas.height);\r\n    const ctx = resultCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.drawImage(canvas, 0, 0);\r\n    return resultCanvas;\r\n}\r\n\r\n/**\r\n * Determine if should disable imageSmoothing for transformation.\r\n * ImageSmoothing can make images blurry even when they're in the original scale and aligned with the pixelgrid.\r\n */\r\nexport function testShouldPixelate(\r\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\r\n    scaleX: number,\r\n    scaleY: number,\r\n): boolean {\r\n    if (\r\n        ![1, -1].includes(scaleX) || ![1, -1].includes(scaleY) ||\r\n        transform.width % 1 !== 0 || transform.height % 1 !== 0 ||\r\n        Math.abs(transform.angleDeg) % 90 !== 0\r\n    ) {\r\n        return false;\r\n    }\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    const width = whSwapped ? transform.height : transform.width;\r\n    const height = whSwapped ? transform.width : transform.height;\r\n    return (\r\n            (Math.abs(width) % 2 === 0 && transform.x % 1 === 0) ||\r\n            (Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5)\r\n        ) &&\r\n        (\r\n            (Math.abs(height) % 2 === 0 && transform.y % 1 === 0) ||\r\n            (Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5)\r\n        );\r\n}\r\n\r\n\r\n/**\r\n * @param destCtx - the canvas that will be drawn on\r\n * @param transformImage - image that will be drawn on canvas\r\n * @param transform - {x, y, width, height, angle} - x and y are center of transformImage\r\n * @param bounds object - optional {x, y, width, height} - crop of transformImage in transformImage image space\r\n * @param pixelated\r\n */\r\nexport function drawTransformedImageWithBounds(\r\n    destCtx: CanvasRenderingContext2D,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\r\n    bounds?: {x: number, y: number, width: number, height: number},\r\n    pixelated?: boolean,\r\n): void {\r\n    if (!bounds) {\r\n        bounds = {\r\n            x: 0,\r\n            y: 0,\r\n            width: transformImage.width,\r\n            height: transformImage.height\r\n        };\r\n    }\r\n\r\n    destCtx.save();\r\n    if (pixelated) {\r\n        destCtx.imageSmoothingEnabled = false;\r\n    } else {\r\n        destCtx.imageSmoothingEnabled = true;\r\n        destCtx.imageSmoothingQuality = 'high';\r\n    }\r\n\r\n    destCtx.translate(transform.x, transform.y);\r\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\r\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\r\n    destCtx.drawImage(\r\n        transformImage,\r\n        bounds.x, bounds.y, bounds.width, bounds.height,\r\n        -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\r\n\r\n    destCtx.restore();\r\n}\r\n\r\n/**\r\n * all transformations are optional\r\n * center is the point around which will be scaled and rotated\r\n *\r\n * @param baseCanvas canvas - the canvas that will be drawn on\r\n * @param transformImage image|canvas - image that will be drawn on canvas\r\n * @param transformObj {center: {x, y}, scale: {x, y}, translate: {x, y}, angleDegree}\r\n */\r\nexport function drawTransformedImageOnCanvas(\r\n    baseCanvas: HTMLCanvasElement,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transformObj: {\r\n        center: {x: number, y: number},\r\n        scale: {x: number, y: number},\r\n        translate: {x: number, y: number},\r\n        angleDegree: number,\r\n    },\r\n): void {\r\n    transformObj = JSON.parse(JSON.stringify(transformObj));\r\n    if (!transformObj.center) {\r\n        transformObj.center = {\r\n            x: transformImage.width / 2,\r\n            y: transformImage.height / 2\r\n        }\r\n    }\r\n    if (!transformObj.scale) {\r\n        transformObj.scale = {\r\n            x: 1,\r\n            y: 1\r\n        };\r\n    }\r\n    if (!transformObj.angleDegree) {\r\n        transformObj.angleDegree = 0;\r\n    }\r\n    if (!transformObj.translate) {\r\n        transformObj.translate = {\r\n            x: 0,\r\n            y: 0\r\n        };\r\n    }\r\n\r\n    const ctx = baseCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.save();\r\n    if (\r\n        Math.abs(transformObj.scale.x - 1) >  0.000001 ||\r\n        Math.abs(transformObj.scale.y - 1) > 0.000001 ||\r\n        Math.abs(transformObj.angleDegree % 90) > 0.000001\r\n    ) {\r\n        ctx.imageSmoothingEnabled = true;\r\n        ctx.imageSmoothingQuality = 'high';\r\n    } else {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n\r\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\r\n    ctx.translate(transformObj.center.x, transformObj.center.y);\r\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\r\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\r\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\r\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\r\n\r\n    ctx.restore();\r\n}\r\n\r\nexport const createCheckerCanvas = function(size: number): HTMLCanvasElement {\r\n    const canvas = createCanvas();\r\n    let ctx;\r\n    if (size < 1) {\r\n        canvas.width = 1;\r\n        canvas.height = 1;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = 'rgb(128, 128, 128)';\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    } else if (size > 200) {\r\n        canvas.width = 401;\r\n        canvas.height = 401;\r\n    } else {\r\n        canvas.width = size * 2;\r\n        canvas.height = size * 2;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = 'rgb(255, 255, 255)';\r\n        ctx.fillRect(0, 0, size * 2, size * 2);\r\n        ctx.fillStyle = 'rgb(200, 200, 200)';\r\n        ctx.fillRect(0, 0, size, size);\r\n        ctx.fillRect(size, size, size * 2, size * 2);\r\n    }\r\n    return canvas;\r\n};\r\n\r\nexport const createCheckerDataUrl = (function () {\r\n    const cache: IKeyString = { // previously created dataUrls\r\n        '8': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC',\r\n        '4': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC'\r\n    };\r\n\r\n    return function (size: number, callback?: (s: string) => void) {\r\n        function create(size: number): string {\r\n            size = parseInt('' + size);\r\n            if (cache['' + size]) {\r\n                return cache['' + size];\r\n            }\r\n            const canvas = createCheckerCanvas(size);\r\n            const result = canvas.toDataURL('image/png');\r\n            cache['' + size] = result;\r\n            return result;\r\n        }\r\n\r\n        if (callback) { //async\r\n            setTimeout(function () {\r\n                callback(create(size));\r\n            }, 1);\r\n        } else { //sync\r\n            return create(size);\r\n        }\r\n    };\r\n})();\r\n\r\n/**\r\n * smooth resize image\r\n * @param canvas canvas - will be resized (modified)\r\n * @param w\r\n * @param h\r\n * @param tmp1 canvas - optional, provide to save resources\r\n * @param tmp2 canvas - optional, provide to save resources\r\n */\r\nexport function resizeCanvas(\r\n    canvas: HTMLCanvasElement,\r\n    w: number,\r\n    h: number,\r\n    tmp1?: HTMLCanvasElement,\r\n    tmp2?: HTMLCanvasElement,\r\n): void {\r\n\r\n    //determine base 2 exponents of old and new size\r\n    function getBase2Obj(oldW: number, oldH: number, newW: number, newH: number) {\r\n        const result = {\r\n            oldWidthEx: Math.round(Math.log2(oldW)),\r\n            oldHeightEx: Math.round(Math.log2(oldH)),\r\n            newWidthEx: Math.ceil(Math.log2(newW)),\r\n            newHeightEx: Math.ceil(Math.log2(newH))\r\n        };\r\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\r\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\r\n        return result;\r\n    }\r\n\r\n    if (!w || !h || (w === canvas.width && h === canvas.height)) {\r\n        return;\r\n    }\r\n    w = Math.max(w, 1);\r\n    h = Math.max(h, 1);\r\n    if (w <= canvas.width && h <= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp2 = !tmp2 ? createCanvas() : tmp2;\r\n\r\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\r\n\r\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\r\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\r\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\r\n        tmp1.getContext('2d')!.save();\r\n        tmp2.getContext('2d')!.save();\r\n\r\n        let ew, eh;\r\n        let buffer1 = tmp1, buffer2 = tmp2;\r\n\r\n        ew = base2.oldWidthEx;\r\n        eh = base2.oldHeightEx;\r\n\r\n        let bufferCtx = buffer2.getContext('2d')!;\r\n        bufferCtx.imageSmoothingEnabled = true;\r\n        bufferCtx.imageSmoothingQuality  = 'high';\r\n        bufferCtx.globalCompositeOperation  = 'copy';\r\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\r\n\r\n        let currentWidth = buffer2.width;\r\n        let currentHeight = buffer2.height;\r\n\r\n        //stepwise half the size\r\n        for (; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--) {\r\n            bufferCtx = buffer1.getContext('2d')!;\r\n            bufferCtx.imageSmoothingEnabled = true;\r\n            bufferCtx.imageSmoothingQuality  = 'high';\r\n            bufferCtx.globalCompositeOperation  = 'copy';\r\n\r\n            const newWidth = (ew > base2.newWidthEx) ? currentWidth / 2 : currentWidth;\r\n            const newHeight = (eh > base2.newHeightEx) ? currentHeight / 2 : currentHeight;\r\n\r\n            //buffer also needs to be properly sized, unfortunately\r\n            buffer1.width = newWidth;\r\n            buffer1.height = newHeight;\r\n\r\n            bufferCtx.drawImage(\r\n                buffer2,\r\n                0, 0,\r\n                currentWidth, currentHeight,\r\n                0, 0,\r\n                newWidth, newHeight\r\n            );\r\n            currentWidth = newWidth;\r\n            currentHeight = newHeight;\r\n\r\n            //swap\r\n            const tmp = buffer1;\r\n            buffer1 = buffer2;\r\n            buffer2 = tmp;\r\n        }\r\n\r\n        //when no longer can be halved, bring to target size\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        const canvasCtx = canvas.getContext('2d')!;\r\n        canvasCtx.save();\r\n        canvasCtx.imageSmoothingEnabled = true;\r\n        canvasCtx.imageSmoothingQuality  = 'high';\r\n        canvasCtx.drawImage(\r\n            buffer2,\r\n            0, 0,\r\n            currentWidth, currentHeight,\r\n            0, 0,\r\n            w, h\r\n        );\r\n        canvasCtx.restore();\r\n        tmp1.getContext('2d')!.restore();\r\n        tmp2.getContext('2d')!.restore();\r\n\r\n    } else if (w >= canvas.width && h >= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp1.width = w;\r\n        tmp1.height = h;\r\n        const tmp1Ctx = tmp1.getContext('2d')!;\r\n        tmp1Ctx.save();\r\n        tmp1Ctx.imageSmoothingEnabled = true;\r\n        tmp1Ctx.imageSmoothingQuality  = 'high';\r\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\r\n        tmp1Ctx.restore();\r\n\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        canvas.getContext('2d')!.drawImage(tmp1, 0, 0);\r\n\r\n    } else {\r\n        resizeCanvas(canvas, w, canvas.height, tmp1, tmp2);\r\n        resizeCanvas(canvas, w, h, tmp1, tmp2);\r\n    }\r\n}\r\n\r\n/**\r\n * puts naive greyscale version of image into alpha channel.\r\n * only writes a, doesn't write rgb\r\n * @param canvas\r\n */\r\nexport function convertToAlphaChannelCanvas(canvas: HTMLCanvasElement): void {\r\n    const imdat = canvas.getContext('2d')!.getImageData(0, 0, canvas.width, canvas.height);\r\n    for (let i = 0; i < imdat.data.length; i += 4) {\r\n        if (imdat.data[i + 3] === 0) {\r\n            continue;\r\n        }\r\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\r\n    }\r\n    canvas.getContext('2d')!.putImageData(imdat, 0, 0);\r\n}\r\n\r\n/**\r\n * Sometimes garbage collection is too slow, and canvases use up too much memory,\r\n * or there is a hard to fix memory leak.\r\n * This function manually makes the canvas use as little memory as possible.\r\n */\r\nexport function freeCanvas(canvas: HTMLCanvasElement): void {\r\n    canvas.width = 1;\r\n    canvas.height = 1;\r\n    const ctx = canvas.getContext('2d');\r\n    ctx && ctx.clearRect(0, 0, 1, 1);\r\n}","export const Matrix = (function () {\r\n\r\n    // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\r\n    // yes not optimized - but it's not used for physics simulations.\r\n\r\n    // const perfTotal = 0;\r\n\r\n    // point  matrix\r\n    function multiplyMatrixAndPoint(matrix, point) {\r\n        const result = [\r\n            (point[0] * matrix[0]) + (point[1] * matrix[4]) + (point[2] * matrix[8]) + (point[3] * matrix[12]), // x\r\n            (point[0] * matrix[1]) + (point[1] * matrix[5]) + (point[2] * matrix[9]) + (point[3] * matrix[13]), // y\r\n            (point[0] * matrix[2]) + (point[1] * matrix[6]) + (point[2] * matrix[10]) + (point[3] * matrix[14]), // z\r\n            (point[0] * matrix[3]) + (point[1] * matrix[7]) + (point[2] * matrix[11]) + (point[3] * matrix[15]) // w\r\n        ];\r\n        return result;\r\n    }\r\n\r\n    //matrixB  matrixA\r\n    function multiplyMatrices(matrixA, matrixB) {\r\n\r\n        // Slice the second matrix up into rows\r\n        const row0 = [matrixB[0], matrixB[1], matrixB[2], matrixB[3]];\r\n        const row1 = [matrixB[4], matrixB[5], matrixB[6], matrixB[7]];\r\n        const row2 = [matrixB[8], matrixB[9], matrixB[10], matrixB[11]];\r\n        const row3 = [matrixB[12], matrixB[13], matrixB[14], matrixB[15]];\r\n\r\n        // Multiply each row by matrixA\r\n        const result0 = multiplyMatrixAndPoint(matrixA, row0);\r\n        const result1 = multiplyMatrixAndPoint(matrixA, row1);\r\n        const result2 = multiplyMatrixAndPoint(matrixA, row2);\r\n        const result3 = multiplyMatrixAndPoint(matrixA, row3);\r\n\r\n        // Turn the result rows back into a single matrix\r\n        return [\r\n            result0[0], result0[1], result0[2], result0[3],\r\n            result1[0], result1[1], result1[2], result1[3],\r\n            result2[0], result2[1], result2[2], result2[3],\r\n            result3[0], result3[1], result3[2], result3[3]\r\n        ];\r\n    }\r\n\r\n    function createTranslationMatrix(x, y) {\r\n        return [\r\n            1, 0, 0, 0,\r\n            0, 1, 0, 0,\r\n            0, 0, 1, 0,\r\n            x, y, 0, 1\r\n        ];\r\n    }\r\n\r\n    function createRotationMatrix(angleRad) {\r\n        //let angleRad = angleDeg / 360 * 2 * Math.PI;\r\n        return [\r\n            Math.cos(-angleRad), -Math.sin(-angleRad), 0, 0,\r\n            Math.sin(-angleRad), Math.cos(-angleRad), 0, 0,\r\n            0, 0, 1, 0,\r\n            0, 0, 0, 1\r\n        ];\r\n    }\r\n\r\n    function createScaleMatrix(f) {\r\n        return [\r\n            f, 0, 0, 0,\r\n            0, f, 0, 0,\r\n            0, 0, 1, 0,\r\n            0, 0, 0, 1\r\n        ];\r\n    }\r\n\r\n    return {\r\n        getIdentity: function () {\r\n            return [\r\n                1, 0, 0, 0,\r\n                0, 1, 0, 0,\r\n                0, 0, 1, 0,\r\n                0, 0, 0, 1\r\n            ];\r\n        },\r\n        multiplyMatrixAndPoint: multiplyMatrixAndPoint,\r\n        multiplyMatrices: multiplyMatrices,\r\n        createTranslationMatrix: createTranslationMatrix,\r\n        createRotationMatrix: createRotationMatrix,\r\n        createScaleMatrix: createScaleMatrix\r\n    };\r\n})();","import {IVector2D} from '../BB.types';\r\n\r\nexport const Vec2 = {\r\n    add: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x + p2.x, y: p1.y + p2.y};\r\n    },\r\n    sub: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x - p2.x, y: p1.y - p2.y};\r\n    },\r\n    nor: function (p: IVector2D): IVector2D {\r\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n        return {x: p.x / len, y: p.y / len};\r\n    },\r\n    len: function (p: IVector2D): number {\r\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n    },\r\n    dist: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Vec2.len(Vec2.sub(p1, p2));\r\n    },\r\n    mul: function (p: IVector2D, s: number): IVector2D {\r\n        return {x: p.x * s, y: p.y * s};\r\n    },\r\n    angle: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n    },\r\n    dot: function(a: IVector2D, b: IVector2D): number {\r\n        const aArr = [a.x, a.y];\r\n        const bArr = [b.x, b.y];\r\n        return aArr.map((x, i) => aArr[i] * bArr[i]).reduce((m, n) => m + n);\r\n    }\r\n};","import {Vec2} from './vec2';\r\nimport {pointsToAngleDeg, clamp, dist, mix} from './math';\r\nimport {IVector2D} from \"../bb.types\";\r\n\r\n/**\r\n * project p onto line\r\n * @param lineStart\r\n * @param lineEnd\r\n * @param p\r\n */\r\nexport const projectPointOnLine = function (lineStart: IVector2D, lineEnd: IVector2D, p: IVector2D): IVector2D {\r\n    let x, y;\r\n    if (lineStart.x === lineEnd.x) {\r\n        x = lineStart.x;\r\n        y = p.y;\r\n\r\n        return {\r\n            x: x,\r\n            y: y\r\n        };\r\n    }\r\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\r\n    const b = lineStart.y - (m * lineStart.x);\r\n\r\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\r\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\r\n\r\n    return {\r\n        x: x,\r\n        y: y\r\n    };\r\n};\r\n\r\n\r\n\r\n/**\r\n * Operations on a line made up of points\r\n *\r\n * getAtDist(dist) - point when traveling *dist* along the line\r\n * getLength - gives you total length of line\r\n *\r\n * @param params object - {points: [{x:float, y:float}, ...]}\r\n * @constructor\r\n */\r\nexport const PointLine = function (params) {\r\n    const segmentArr = [];\r\n    const _this = this;\r\n\r\n    for (let i = 0; i < params.points.length; i++) {\r\n        (function (i) {\r\n            let length = undefined;\r\n            if (i < params.points.length - 1) {\r\n                length = dist(params.points[i].x, params.points[i].y, params.points[i + 1].x, params.points[i + 1].y);\r\n            }\r\n            segmentArr[i] = {\r\n                x: params.points[i].x,\r\n                y: params.points[i].y,\r\n                length: length\r\n            };\r\n        })(i);\r\n    }\r\n\r\n    /**\r\n     * @param dist number - distance in pixels, > 0\r\n     * @returns {{x: number, y: number}}\r\n     */\r\n    this.getAtDist = function (dist) {\r\n        let remainder = Math.min(_this.getLength(), dist);\r\n        let i = 0;\r\n\r\n        for (; remainder > segmentArr[i].length && i < segmentArr.length - 2; i++) {\r\n            remainder -= segmentArr[i].length;\r\n        }\r\n\r\n        const fac = Math.min(1, Math.max(0, remainder / segmentArr[i].length));\r\n\r\n        return {\r\n            x: (segmentArr[i].x * (1 - fac) + segmentArr[i + 1].x * fac),\r\n            y: (segmentArr[i].y * (1 - fac) + segmentArr[i + 1].y * fac)\r\n        };\r\n    };\r\n    this.getLength = function () {\r\n        let result = 0;\r\n        for (let i = 0; i < segmentArr.length - 1; i++) {\r\n            result += segmentArr[i].length;\r\n        }\r\n        return result;\r\n    };\r\n};\r\n\r\n/**\r\n * Each instance is one line made up of bezier interpolated segments.\r\n * You feed it points. It calculates control points on its own, and the resulting curve.\r\n *\r\n * @constructor\r\n */\r\nexport const BezierLine = function () {\r\n    const _this = this;\r\n    const pointArr = [];\r\n    let lastDot = 0;\r\n    let lastPoint;\r\n    let lastCallbackPoint;\r\n    let lastAngle;\r\n    let lastSpacing = null;\r\n\r\n    /**\r\n     * creates bezier curve from control points\r\n     *\r\n     * @param p1 - control point 1 {x: float, y: float}\r\n     * @param p2 - control point 2 {x: float, y: float}\r\n     * @param p3 - control point 3 {x: float, y: float}\r\n     * @param p4 - control point 4 {x: float, y: float}\r\n     * @param resolution - int\r\n     * @returns {Array} - bezier curve made up of points {x: float, y: float}\r\n     */\r\n    function getBezierPoints(p1, p2, p3, p4, resolution) {\r\n        const curvePoints = [];\r\n        let t, result;\r\n        for (let i = 0; i <= resolution; i++) {\r\n            t = i / resolution;\r\n            result = {};\r\n            result.x = Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x;\r\n            result.y = Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y;\r\n            curvePoints[curvePoints.length] = result;\r\n        }\r\n        return curvePoints;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * add now point to line\r\n     * line will go until the previous point\r\n     *\r\n     * @param x - coord of new point\r\n     * @param y - coord of new point\r\n     * @param spacing - space between each step\r\n     * @param callback - calls for each step - x, y, t - t is 0-1 how far along\r\n     * @param controlsCallback - calls that callback with the bezier control points p1, p2, p3, p4 - each {x: float, y: float}\r\n     */\r\n    this.add = function (x, y, spacing, callback, controlsCallback) {\r\n        if (lastPoint && x === lastPoint.x && y === lastPoint.y) {\r\n            return;\r\n        }\r\n        lastPoint = {x: x, y: y};\r\n        pointArr[pointArr.length] = {\r\n            x: x,\r\n            y: y,\r\n            spacing: spacing\r\n        };\r\n\r\n        //calculate directions\r\n        if (pointArr.length === 1) {\r\n            lastSpacing = spacing;\r\n            return;\r\n        } else if (pointArr.length === 2) {\r\n            pointArr[0].dir = Vec2.nor(Vec2.sub(pointArr[1], pointArr[0]));\r\n            lastDot = spacing;\r\n            lastSpacing = spacing;\r\n            return;\r\n        } else {\r\n            const pointM1 = pointArr[pointArr.length - 1];\r\n            const pointM2 = pointArr[pointArr.length - 2];\r\n            const pointM3 = pointArr[pointArr.length - 3];\r\n            pointM2.dir = Vec2.nor(Vec2.sub(pointM1, pointM3));\r\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) {\r\n                //when xy -3 == -1\r\n                pointM2.dir = JSON.parse(JSON.stringify(pointM3.dir));\r\n            }\r\n        }\r\n\r\n        //get bezier curve\r\n        const a = pointArr[pointArr.length - 3];\r\n        const b = pointArr[pointArr.length - 2];\r\n        const p1 = a;\r\n        const p2 = Vec2.add(a, Vec2.mul(a.dir, Vec2.dist(a, b) / 4));\r\n        const p3 = Vec2.sub(b, Vec2.mul(b.dir, Vec2.dist(a, b) / 4));\r\n        const p4 = b;\r\n\r\n\r\n        let pointLine;\r\n        if (callback) {\r\n            let curvePoints;\r\n            curvePoints = getBezierPoints(p1, p2, p3, p4, 20);\r\n            pointLine = new PointLine({points: curvePoints});\r\n        } else {\r\n            pointLine = new PointLine({points: [p1, p4]});\r\n        }\r\n\r\n        //interate over curve with spacing and callback\r\n        const len = pointLine.getLength();\r\n        let tempSpacing = mix(lastSpacing, spacing, clamp(lastDot / len, 0, 1));\r\n        let d = lastDot;\r\n        for (; d <= len; d += tempSpacing) {\r\n            tempSpacing = mix(lastSpacing, spacing, clamp(d / len, 0, 1));\r\n            const point = pointLine.getAtDist(d);\r\n            const angle = lastCallbackPoint ? pointsToAngleDeg(lastCallbackPoint, point) : undefined;\r\n            if (callback) {\r\n                callback({\r\n                    x: point.x,\r\n                    y: point.y,\r\n                    t: d / len,\r\n                    angle: angle,\r\n                    dAngle: lastCallbackPoint ? angle - lastAngle : 0\r\n                });\r\n            }\r\n            lastCallbackPoint = point;\r\n            lastAngle = angle;\r\n        }\r\n\r\n        if (callback) {\r\n            lastDot = d - len;\r\n        } else {\r\n            lastDot = 0;\r\n            controlsCallback({p1: p1, p2: p2, p3: p3, p4: p4});\r\n        }\r\n\r\n        lastSpacing = spacing;\r\n    };\r\n\r\n    this.addFinal = function(spacing, callback, controlsCallback) {\r\n        if (pointArr.length < 2) {\r\n            return;\r\n        }\r\n\r\n        const p1 = pointArr[pointArr.length - 2];\r\n        const p2 = pointArr[pointArr.length - 1];\r\n\r\n        const newP = Vec2.add(p2, Vec2.sub(p2, p1));\r\n\r\n        _this.add(newP.x, newP.y, spacing, callback, controlsCallback);\r\n    };\r\n\r\n};\r\n\r\n/**\r\n * from glfx.script by evanW:\r\n * from SplineInterpolator.cs in the Paint.NET source code\r\n *\r\n * points go 0 - 1. I think.\r\n *\r\n * @param points\r\n * @constructor\r\n */\r\nexport const SplineInterpolator = function (points) {\r\n    const n = points.length;\r\n    this.xa = [];\r\n    this.ya = [];\r\n    this.u = [];\r\n    this.y2 = [];\r\n    let i;\r\n\r\n    const first = points[0][0];\r\n    const last = points[points.length - 1][0];\r\n\r\n    points.sort(function (a, b) {\r\n        return a[0] - b[0];\r\n    });\r\n    for (i = 0; i < n; i++) {\r\n        this.xa.push(points[i][0]);\r\n        this.ya.push(points[i][1]);\r\n    }\r\n\r\n    this.u[0] = 0;\r\n    this.y2[0] = 0;\r\n\r\n    for (i = 1; i < n - 1; ++i) {\r\n        // This is the decomposition loop of the tridiagonal algorithm.\r\n        // y2 and u are used for temporary storage of the decomposed factors.\r\n        const wx = this.xa[i + 1] - this.xa[i - 1];\r\n        const sig = (this.xa[i] - this.xa[i - 1]) / wx;\r\n        const p = sig * this.y2[i - 1] + 2.0;\r\n\r\n        this.y2[i] = (sig - 1.0) / p;\r\n\r\n        const ddydx =\r\n            (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\r\n            (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\r\n\r\n        this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\r\n    }\r\n\r\n    this.y2[n - 1] = 0;\r\n\r\n    // This is the backsubstitution loop of the tridiagonal algorithm\r\n    for (i = n - 2; i >= 0; --i) {\r\n        this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\r\n    }\r\n\r\n    this.getFirstX = function () {\r\n        return first;\r\n    };\r\n    this.getLastX = function () {\r\n        return last;\r\n    };\r\n};\r\n\r\nSplineInterpolator.prototype.interpolate = function (x) {\r\n    const n = this.ya.length;\r\n    let klo = 0;\r\n    let khi = n - 1;\r\n\r\n    // We will find the right place in the table by means of\r\n    // bisection. This is optimal if sequential calls to this\r\n    // routine are at random values of x. If sequential calls\r\n    // are in order, and closely spaced, one would do better\r\n    // to store previous values of klo and khi.\r\n    while (khi - klo > 1) {\r\n        const k = (khi + klo) >> 1;\r\n\r\n        if (this.xa[k] > x) {\r\n            khi = k;\r\n        } else {\r\n            klo = k;\r\n        }\r\n    }\r\n\r\n    const h = this.xa[khi] - this.xa[klo];\r\n    const a = (this.xa[khi] - x) / h;\r\n    const b = (x - this.xa[klo]) / h;\r\n\r\n    // Cubic spline polynomial is now evaluated.\r\n    return a * this.ya[klo] + b * this.ya[khi] +\r\n        ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\r\n};\r\n\r\n/**\r\n * find x to y. simply by stepping through. suboptimal, so don't call often.\r\n * searches in x 0-1 range\r\n *\r\n * @param y\r\n * @param resolution\r\n */\r\nSplineInterpolator.prototype.findX = function (y, resolution) {\r\n    let x = null;\r\n    let dist = null;\r\n    for (let i = 0; i <= resolution; i++) {\r\n        const tempX = i / resolution;\r\n        const tempY = this.interpolate(tempX);\r\n        if (x === null) {\r\n            x = tempX;\r\n            dist = Math.abs(tempY - y);\r\n            continue;\r\n        }\r\n\r\n        const tempDist = Math.abs(tempY - y);\r\n\r\n        if (tempDist < dist) {\r\n            x = tempX;\r\n            dist = tempDist;\r\n        } else {\r\n            //distance increasing\r\n            break;\r\n        }\r\n    }\r\n    return x;\r\n};\r\n\r\n/**\r\n * input for a spline, following curve of quadratic function x^2 [0 - 1]\r\n * returns [[0, startVal], ..., [1, endVal]]\r\n * @param startVal\r\n * @param endVal\r\n * @param stepSize\r\n * @returns {[]}\r\n */\r\nexport const quadraticSplineInput = function (startVal, endVal, stepSize) {\r\n    function round(v, dec) {\r\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\r\n    }\r\n\r\n    const resultArr = [];\r\n    for (let i = 0; i <= 1; i += stepSize) {\r\n        resultArr.push([round(i, 4), round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)]);\r\n    }\r\n    return resultArr;\r\n};","\r\n\r\n\r\n// based on js color conversion http://www.webtoolkit.info/\r\n\r\n\r\nexport class HSV {\r\n    h: number;\r\n    s: number;\r\n    v: number;\r\n    constructor(h: number, s: number, v: number) {\r\n        this.h = Math.max(0, Math.min(360, h));\r\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\r\n        this.v = Math.max(0, Math.min(100, v));\r\n    }\r\n}\r\n\r\nexport class RGB {\r\n    r : number;\r\n    g: number;\r\n    b: number;\r\n    constructor(r: number, g: number, b: number) {\r\n        this.r = Math.max(0, Math.min(255, r));\r\n        this.g = Math.max(0, Math.min(255, g));\r\n        this.b = Math.max(0, Math.min(255, b));\r\n    }\r\n}\r\n\r\nexport class CMYK {\r\n    c: number;\r\n    m: number;\r\n    y: number;\r\n    k: number;\r\n    constructor(c: number, m: number, y: number, k: number) {\r\n        this.c = Math.max(0, Math.min(100, c));\r\n        this.m = Math.max(0, Math.min(100, m));\r\n        this.y = Math.max(0, Math.min(100, y));\r\n        this.k = Math.max(0, Math.min(100, k));\r\n    }\r\n}\r\n\r\nexport const ColorConverter = {\r\n\r\n    _RGBtoHSV: function (RGB: RGB): HSV {\r\n        const result = new HSV(0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        const minVal = Math.min(r, g, b);\r\n        const maxVal = Math.max(r, g, b);\r\n        const delta = maxVal - minVal;\r\n\r\n        result.v = maxVal;\r\n\r\n        if (delta == 0) {\r\n            result.h = 0;\r\n            result.s = 0;\r\n        } else {\r\n            result.s = delta / maxVal;\r\n            const del_R = (((maxVal - r) / 6) + (delta / 2)) / delta;\r\n            const del_G = (((maxVal - g) / 6) + (delta / 2)) / delta;\r\n            const del_B = (((maxVal - b) / 6) + (delta / 2)) / delta;\r\n\r\n            if (r == maxVal) {\r\n                result.h = del_B - del_G;\r\n            } else if (g == maxVal) {\r\n                result.h = (1 / 3) + del_R - del_B;\r\n            } else if (b == maxVal) {\r\n                result.h = (2 / 3) + del_G - del_R;\r\n            }\r\n\r\n            if (result.h < 0) {\r\n                result.h += 1;\r\n            }\r\n            if (result.h > 1) {\r\n                result.h -= 1;\r\n            }\r\n        }\r\n\r\n        result.h = Math.round(result.h * 360);\r\n        result.s = Math.round(result.s * 100);\r\n        result.v = Math.round(result.v * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    _HSVtoRGB: function (HSV: HSV): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\r\n\r\n        const h = (HSV.h / 360) % 1;\r\n        const s = HSV.s / 100;\r\n        const v = HSV.v / 100;\r\n\r\n        if (s == 0) {\r\n            result.r = v * 255;\r\n            result.g = v * 255;\r\n            result.b = v * 255;\r\n        } else {\r\n            var_h = h * 6;\r\n            var_i = Math.floor(var_h);\r\n            var_1 = v * (1 - s);\r\n            var_2 = v * (1 - s * (var_h - var_i));\r\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\r\n\r\n            if (var_i == 0) {\r\n                var_r = v;\r\n                var_g = var_3;\r\n                var_b = var_1\r\n            } else if (var_i == 1) {\r\n                var_r = var_2;\r\n                var_g = v;\r\n                var_b = var_1\r\n            } else if (var_i == 2) {\r\n                var_r = var_1;\r\n                var_g = v;\r\n                var_b = var_3\r\n            } else if (var_i == 3) {\r\n                var_r = var_1;\r\n                var_g = var_2;\r\n                var_b = v\r\n            } else if (var_i == 4) {\r\n                var_r = var_3;\r\n                var_g = var_1;\r\n                var_b = v\r\n            } else {\r\n                var_r = v;\r\n                var_g = var_1;\r\n                var_b = var_2\r\n            }\r\n\r\n            result.r = var_r * 255;\r\n            result.g = var_g * 255;\r\n            result.b = var_b * 255;\r\n\r\n            result.r = Math.round(result.r);\r\n            result.g = Math.round(result.g);\r\n            result.b = Math.round(result.b);\r\n        }\r\n\r\n        return result;\r\n    },\r\n\r\n    _CMYKtoRGB: function (CMYK: CMYK): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        const c = CMYK.c / 100;\r\n        const m = CMYK.m / 100;\r\n        const y = CMYK.y / 100;\r\n        const k = CMYK.k / 100;\r\n\r\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\r\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\r\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\r\n\r\n        result.r = Math.round(result.r * 255);\r\n        result.g = Math.round(result.g * 255);\r\n        result.b = Math.round(result.b * 255);\r\n\r\n        return result;\r\n    },\r\n\r\n    _RGBtoCMYK: function (RGB: RGB): CMYK {\r\n        const result = new CMYK(0, 0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\r\n        result.c = (1 - r - result.k) / (1 - result.k);\r\n        result.m = (1 - g - result.k) / (1 - result.k);\r\n        result.y = (1 - b - result.k) / (1 - result.k);\r\n\r\n        result.c = Math.round(result.c * 100);\r\n        result.m = Math.round(result.m * 100);\r\n        result.y = Math.round(result.y * 100);\r\n        result.k = Math.round(result.k * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    toRGB: function (o: RGB | HSV | CMYK): RGB {\r\n        if (o instanceof RGB) {\r\n            return o;\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._HSVtoRGB(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._CMYKtoRGB(o);\r\n        }\r\n    },\r\n\r\n    toHSV: function (o: RGB | HSV | CMYK): HSV {\r\n        if (o instanceof HSV) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoHSV(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._RGBtoHSV(this._CMYKtoRGB(o));\r\n        }\r\n    },\r\n\r\n    toCMYK: function (o: RGB | HSV | CMYK): CMYK {\r\n        if (o instanceof CMYK) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoCMYK(o);\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._RGBtoCMYK(this._HSVtoRGB(o));\r\n        }\r\n    },\r\n    toHexString: function (o: RGB): string {\r\n        if (o instanceof RGB) {\r\n            let ha = (parseInt('' + o.r)).toString(16);\r\n            let hb = (parseInt('' + o.g)).toString(16);\r\n            let hc = (parseInt('' + o.b)).toString(16);\r\n            if (ha.length == 1)\r\n                ha = '0' + ha;\r\n            if (hb.length == 1)\r\n                hb = '0' + hb;\r\n            if (hc.length == 1)\r\n                hc = '0' + hc;\r\n            return ha + hb + hc;\r\n        }\r\n    },\r\n    toRgbStr: function(rgbObj: {r: number, g: number, b: number}): string {\r\n        return 'rgb(' + Math.round(rgbObj.r) + ', ' + Math.round(rgbObj.g) + ', ' + Math.round(rgbObj.b) + ')';\r\n    },\r\n    toRgbaStr: function(rgbaObj: {r: number, g: number, b: number, a: number}): string {\r\n        return 'rgba(' + Math.round(rgbaObj.r) + ', ' + Math.round(rgbaObj.g) + ', ' + Math.round(rgbaObj.b) + ', ' + rgbaObj.a + ')';\r\n    },\r\n    hexToRGB: function(hexStr: string): RGB | null {\r\n        hexStr = hexStr.trim();\r\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\r\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n        hexStr = hexStr.replace(shorthandRegex, function(m, r, g, b) {\r\n            return r + r + g + g + b + b;\r\n        });\r\n\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\r\n        return result ? new RGB(\r\n            parseInt(result[1], 16),\r\n            parseInt(result[2], 16),\r\n            parseInt(result[3], 16)\r\n        ) : null;\r\n    }\r\n\r\n};\r\n\r\nexport function testIsWhiteBestContrast(rgbObj: {r: number, g: number, b: number}): boolean {\r\n    return (rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114) < 125;\r\n}","import {addEventListener} from '../input/event-listener';\r\nimport {css} from './base';\r\nimport {BB} from '../bb';\r\n\r\n\r\nexport function appendTextDiv(target: HTMLElement, text: string): HTMLDivElement {\r\n    const div = document.createElement('div');\r\n    div.innerHTML = text;\r\n    target.appendChild(div);\r\n    return div;\r\n}\r\n\r\n/**\r\n * Is an input element focused.\r\n * Set attribute \"data-ignore-focus\" to \"true\" if its focus should be ignored.\r\n *\r\n * @param getAll - check all, even those with \"data-ignore-focus\" = \"true\"\r\n */\r\nexport function isInputFocused(getAll: boolean = false): boolean {\r\n    let result = document.activeElement && ['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName);\r\n    if (getAll) {\r\n        return result;\r\n    } else {\r\n        return result && !document.activeElement.getAttribute('data-ignore-focus');\r\n    }\r\n}\r\n\r\n/**\r\n * clears text selection in window\r\n */\r\nexport function clearSelection(): void {\r\n    if (window.getSelection) {\r\n        const sel = window.getSelection();\r\n        if (sel) {\r\n            if (sel.empty) {\r\n                sel.empty();\r\n            } else if (sel.removeAllRanges) {\r\n                sel.removeAllRanges();\r\n            }\r\n        }\r\n    } else if ('selection' in document) {\r\n        (document as any).selection.empty();\r\n    }\r\n}\r\n\r\n/**\r\n * prevents being able to focus element.\r\n * warning: it creates a listener\r\n *\r\n * @param el - dom element\r\n */\r\nexport const makeUnfocusable = (function() {\r\n\r\n    function preventFocus(event: MouseEvent) {\r\n        event.preventDefault();\r\n        let didFocusRelated = false;\r\n        if (event.relatedTarget) {\r\n            try {\r\n                (event.relatedTarget as HTMLElement).focus();\r\n                didFocusRelated = true;\r\n            } catch(e) {\r\n                console.error('failed to focus');\r\n            }\r\n        }\r\n        if (!didFocusRelated) {\r\n            (event.currentTarget as HTMLElement).blur();\r\n        }\r\n    }\r\n\r\n    return function(el) {\r\n        el.setAttribute('tabindex', '-1');\r\n        addEventListener(el, 'focus', preventFocus);\r\n    };\r\n})();\r\n\r\n\r\nconst els: {\r\n    el: HTMLElement;\r\n    listeners: [string, any][];\r\n}[] = [];\r\n// window['els'] = els;\r\n\r\n/**\r\n *\r\n * Create DOM element - div by default\r\n * params = {\r\n * \t    parent: someOtherDiv,\r\n * \t    css: {\r\n * \t\t    width: \"500px\",\r\n * \t\t    backgroundColor: \"#fff\"\r\n * \t    },\r\n * \t    content: \"test\", //or  content: [divA, divB, divC]   or content: someDiv\r\n * \t    className: \"bla\",\r\n *      id: \"bla\"\r\n * }\r\n *\r\n *  If onClick or onChange is used, then BB.destroyEl MUST be called\r\n *  to prevent a memory leak.\r\n *\r\n * @param params\r\n */\r\nexport function el(\r\n    params: {\r\n        parent?: HTMLElement,\r\n        css?: { [key: string]: string },\r\n        custom?: { [key: string]: any },\r\n        content?: string | (HTMLElement | string | null)[] | HTMLElement | SVGElement,\r\n        textContent?: string,\r\n        className?: string,\r\n        title?: string,\r\n        id?: string,\r\n        tagName?: string,\r\n        onClick?: (e: Event) => void,\r\n        onChange?: (e: Event) => void,\r\n    }\r\n): HTMLElement {\r\n    const div = document.createElement(params.tagName ? params.tagName : 'div');\r\n    if (params.css) {\r\n        css(div, params.css);\r\n    }\r\n\r\n    if (params.content) {\r\n        if (typeof params.content === typeof 'aa') {\r\n            div.innerHTML = params.content as string;\r\n\r\n        } else if (Array.isArray(params.content)) {\r\n            BB.append(div, params.content);\r\n\r\n        } else {\r\n            div.appendChild(params.content as HTMLElement);\r\n\r\n        }\r\n    }\r\n    if (params.textContent) {\r\n        div.textContent = params.textContent;\r\n    }\r\n    if (params.className) {\r\n        div.className = params.className;\r\n    }\r\n    if (params.id) {\r\n        div.id = params.id;\r\n    }\r\n    if (params.parent) {\r\n        params.parent.appendChild(div);\r\n    }\r\n    if ('title' in params && params.title !== undefined) {\r\n        div.title = params.title;\r\n    }\r\n    const listeners = [];\r\n    if ('onClick' in params) {\r\n        addEventListener(div, 'click', params.onClick);\r\n        listeners.push(['click', params.onClick]);\r\n    }\r\n    if ('onChange' in params) {\r\n        addEventListener(div, 'change', params.onChange);\r\n        listeners.push(['change', params.onChange]);\r\n    }\r\n    if (listeners.length > 0) {\r\n        els.push({\r\n            el: div,\r\n            listeners: listeners,\r\n        })\r\n        /*div.style.backgroundColor = '#ff0';\r\n        div.style.border = '1px solid #ff0';*/\r\n    }\r\n    if ('custom' in params) {\r\n        const customKeyArr = Object.keys(params.custom);\r\n        for (let i = 0; i < customKeyArr.length; i++) {\r\n            div.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\r\n        }\r\n    }\r\n    return div;\r\n}\r\n\r\n/**\r\n * removes event listeners for Elements created via el()\r\n * @param el\r\n */\r\nexport function destroyEl(el: HTMLElement) {\r\n    for (let i = 0; i < els.length; i++) {\r\n        const item = els[i];\r\n        if (item.el === el) {\r\n            item.listeners.forEach(item => {\r\n                el.removeEventListener(item[0], item[1]);\r\n            });\r\n            els.splice(i, 1);\r\n            return;\r\n        }\r\n    }\r\n    // not found\r\n    return;\r\n}\r\n","\r\nexport class BbLog {\r\n\r\n    private static listeners: any[] = [];\r\n\r\n    constructor() {\r\n    }\r\n\r\n    static subscribe(listener) {\r\n        if (BbLog.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        BbLog.listeners.push(listener);\r\n    }\r\n\r\n    static unsubscribe(listener) {\r\n        for (let i = 0; i < BbLog.listeners.length; i++) {\r\n            if (listener === BbLog.listeners[i]) {\r\n                BbLog.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    static emit (msg) {\r\n        BbLog.listeners.forEach(item => {\r\n            item(msg);\r\n        });\r\n    }\r\n}","/**\r\n * LocalStorage wrapper that does not throw exceptions.\r\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\r\n */\r\nexport class LocalStorage {\r\n\r\n    private static error;\r\n\r\n    static getItem (key: string): string {\r\n        let result = null;\r\n        try {\r\n            result = localStorage.getItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static setItem (key: string, value: string): void {\r\n        try {\r\n            localStorage.setItem(key, value);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static removeItem (key: string): void {\r\n        try {\r\n            localStorage.removeItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static getError (): any {\r\n        return this.error;\r\n    }\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"l7FYj\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kbyFQ\");","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Checkbox - with label\r\n */\r\nexport class Checkbox {\r\n\r\n    private element: HTMLElement;\r\n    private check: HTMLInputElement;\r\n\r\n    // --- public ---\r\n\r\n    constructor (params: {\r\n        init?: boolean; // default false\r\n        label: string;\r\n        callback: (boolean) => void;\r\n        allowTab?: boolean; // default false\r\n        title?: string;\r\n        doHighlight?: boolean; // default false\r\n        css?: any;\r\n    }) {\r\n        this.element = BB.el({\r\n            className: 'kl-checkbox'\r\n        });\r\n\r\n        const innerEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'label',\r\n            className: 'kl-checkbox__inner'\r\n        });\r\n\r\n        this.check = BB.el({\r\n            parent: innerEl,\r\n            tagName: 'input',\r\n            css: {\r\n                marginLeft: '0',\r\n                display: 'inline-block'\r\n            },\r\n            custom: {\r\n                type: 'checkbox'\r\n            }\r\n        }) as HTMLInputElement;\r\n        this.check.checked = params.init;\r\n        if (params.doHighlight && this.check.checked) {\r\n            BB.addClassName(this.element, 'kl-checkbox--highlight');\r\n        }\r\n        if (!params.allowTab) {\r\n            this.check.tabIndex = -1;\r\n        }\r\n\r\n        if (params.title) {\r\n            innerEl.title = params.title;\r\n        }\r\n\r\n        const label = document.createElement('div');\r\n        label.style.display = 'inline-block';\r\n        label.innerHTML = params.label;\r\n        (label as any).allowClick = true;\r\n        innerEl.appendChild(label);\r\n\r\n        this.check.onchange = () => {\r\n            if (params.doHighlight) {\r\n                if (this.check.checked) {\r\n                    BB.addClassName(this.element, 'kl-checkbox--highlight');\r\n                } else {\r\n                    BB.removeClassName(this.element, 'kl-checkbox--highlight');\r\n                }\r\n            }\r\n            params.callback(this.check.checked);\r\n            setTimeout(() => {\r\n                this.check.blur();\r\n            }, 0);\r\n        };\r\n        if (params.css) {\r\n            BB.css(this.element, params.css);\r\n        }\r\n    }\r\n\r\n    getValue(): boolean {\r\n        return this.check.checked;\r\n    }\r\n\r\n    getElement(): HTMLElement {\r\n        return this.element;\r\n    }\r\n\r\n    destroy() {\r\n        this.check.onchange = null;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\n\r\nexport const input = function (params: {\r\n    type?: 'button' | 'checkbox' | 'number' | 'text'; // default text\r\n    min?: number;\r\n    max?: number;\r\n    callback: (val: string) => void;\r\n    init: string | number;\r\n    css?: IKeyString;\r\n}) {\r\n    const result = document.createElement('input');\r\n    if (params.type) {\r\n        try {\r\n            result.type = params.type;\r\n        } catch(e) {} // ie can't deal with number\r\n    } else {\r\n        result.type = 'text';\r\n    }\r\n    if (params.min !== undefined) {\r\n        result.min = '' + params.min;\r\n    }\r\n    if (params.max !== undefined) {\r\n        result.max = '' + params.max;\r\n    }\r\n    result.value = '' + params.init;\r\n    if (params.callback) {\r\n        result.onchange = function() {\r\n            params.callback(result.value);\r\n        };\r\n    }\r\n    if (params.css) {\r\n        BB.css(result, params.css);\r\n    }\r\n\r\n    return result;\r\n};","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\n\r\n/**\r\n * A select dropdown\r\n */\r\nexport class Select {\r\n\r\n    private selectEl: HTMLSelectElement;\r\n    private optionArr: ([string, string] | null)[]; // [value, label]\r\n    private changeListener: (event) => void;\r\n    private onChange: (val: string) => void;\r\n\r\n    \r\n    // --- public ---\r\n    constructor (p: {\r\n        isFocusable?: boolean; // default false\r\n        optionArr: ([string, string] | null)[], // [value, label]\r\n        initValue?: string; // default null\r\n        onChange: (val: string) => void;\r\n        css?: IKeyString;\r\n        title?: string;\r\n    }) {\r\n        this.selectEl = BB.el({\r\n            tagName: 'select',\r\n            title: p.title,\r\n            css: {\r\n                cursor: 'pointer',\r\n                fontSize: '15px',\r\n                padding: '3px',\r\n                background: '#fff', // makes safari pay attention to font-size\r\n                //webkitAppearance: 'none'\r\n                colorScheme: 'only light', // chrome doesn't properly invert the text color\r\n            }\r\n        }) as HTMLSelectElement;\r\n        if (p.css) {\r\n            BB.css(this.selectEl, p.css);\r\n        }\r\n\r\n        const isFocusable = p.isFocusable;\r\n        if (!isFocusable) {\r\n            this.selectEl.tabIndex = -1;\r\n        }\r\n        this.optionArr = p.optionArr;\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            if (this.optionArr[i] === null) {\r\n                continue;\r\n            }\r\n            const option = document.createElement('option');\r\n            option.value = this.optionArr[i][0];\r\n            option.textContent = this.optionArr[i][1];\r\n            this.selectEl.append(option);\r\n        }\r\n        this.onChange = p.onChange;\r\n        this.changeListener = (e) => {\r\n            if (!isFocusable) {\r\n                this.selectEl.blur();\r\n            }\r\n            this.onChange(this.selectEl.value);\r\n        };\r\n        this.selectEl.addEventListener('change', this.changeListener);\r\n        this.selectEl.value = 'initValue' in p ? p.initValue : null;\r\n    }\r\n\r\n    setValue (val) {\r\n        this.selectEl.value = val;\r\n    }\r\n\r\n    getValue () {\r\n        return this.selectEl.value;\r\n    }\r\n\r\n    setDeltaValue (delta) {\r\n        let index = 0;\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            if ('' + this.optionArr[i][0] === this.selectEl.value) {\r\n                index = i;\r\n                break;\r\n            }\r\n        }\r\n        index = Math.max(0, Math.min(this.optionArr.length -1, index + delta));\r\n        this.selectEl.value = this.optionArr[index][0];\r\n        this.onChange(this.selectEl.value);\r\n    }\r\n\r\n    getElement () {\r\n        return this.selectEl;\r\n    }\r\n\r\n    destroy = () => {\r\n        this.selectEl.removeEventListener('change', this.changeListener);\r\n    }\r\n    \r\n}\r\n","import {BB} from '../../../bb/bb';\r\n\r\n\r\n/**\r\n * Toggle button with an image\r\n *\r\n * p = {\r\n *     initValue: boolean,\r\n *     title: string,\r\n *     isRadio: boolean, // if true, can't click when active\r\n *     onChange: function(boolean)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const ImageToggle = function(p) {\r\n    let isActive = !!p.initValue;\r\n    const div = BB.el({\r\n        className: 'image-toggle',\r\n        title: p.title,\r\n        css: {\r\n            backgroundImage: \"url('\" + p.image + \"')\"\r\n        },\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            if (p.isRadio && isActive) {\r\n                return;\r\n            }\r\n            isActive = !isActive;\r\n            update();\r\n            p.onChange(isActive);\r\n        },\r\n    });\r\n\r\n    function update() {\r\n        if (isActive) {\r\n            BB.addClassName(div, 'image-toggle-active');\r\n        } else {\r\n            BB.removeClassName(div, 'image-toggle-active');\r\n        }\r\n    }\r\n\r\n    update();\r\n\r\n    // --- interface ---\r\n    this.setValue = function(b) {\r\n        isActive = !!b;\r\n        update();\r\n    };\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.getValue = function() {\r\n        return isActive;\r\n    };\r\n    this.destroy = () => {\r\n        BB.destroyEl(div);\r\n    };\r\n\r\n};","import {BB} from '../../../bb/bb';\r\nimport {ImageToggle} from './image-toggle';\r\n\r\n/**\r\n * Radio input group. each one has an image\r\n *\r\n * p = {\r\n *     optionArr: {\r\n *         id: string,\r\n *         title: string,\r\n *         image: string,\r\n *     }[],\r\n *     initId: string,\r\n *     sizePx: number,\r\n *     onChange: function(id: string): void\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport const ImageRadioList = function(p) {\r\n\r\n    const div = BB.el({\r\n        className: 'image-radio-wrapper',\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n\r\n    let activeIndex;\r\n    const optionArr = [];\r\n\r\n    function select(index, id) {\r\n        activeIndex = index;\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            optionArr[i].setValue(i === activeIndex);\r\n        }\r\n        p.onChange(id);\r\n    }\r\n\r\n    function createOption(index, o) {\r\n        if (o.id === p.initId) {\r\n            activeIndex = index;\r\n        }\r\n        const radioEl = new ImageToggle({\r\n            image: o.image,\r\n            title: o.title,\r\n            initValue: o.id === p.initId,\r\n            isRadio: true,\r\n            onChange: function() {\r\n                select(index, o.id);\r\n            }\r\n        });\r\n        div.appendChild(radioEl.getElement());\r\n\r\n        return radioEl;\r\n\r\n    }\r\n\r\n    for (let i = 0; i < p.optionArr.length; i++) {\r\n        optionArr.push(createOption(i, p.optionArr[i]));\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.getValue = function() {\r\n        return p.optionArr[activeIndex].id;\r\n    };\r\n    this.destroy = () => {\r\n        optionArr.forEach(item => {\r\n            item.destroy();\r\n        })\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport iconImg from 'url:~/src/app/img/ui/brush-pressure.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * small toggle button with a pen icon - representing toggling pressure sensitivity\r\n * @param isChecked - boolean - initial value\r\n * @param changeCallback - function(isChecked boolean) - called on change\r\n * @returns {HTMLElement} - the toggle button\r\n */\r\nexport const penPressureToggle = function(isChecked, changeCallback) {\r\n\r\n    const toggleDiv = BB.el({\r\n        css: {\r\n            cssFloat: 'right',\r\n            borderRadius: '3px',\r\n            width: '18px',\r\n            height: '18px',\r\n            backgroundImage: 'url(\"' + iconImg + '\")',\r\n            backgroundSize: 'contain',\r\n            backgroundRepeat: 'no-repeat',\r\n            cursor: 'pointer',\r\n            boxSizing: 'border-box',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n\r\n    if (!BB.hasPointerEvents) {\r\n        toggleDiv.style.display = 'none';\r\n    }\r\n\r\n    function redraw() {\r\n        if (isChecked) {\r\n            BB.css(toggleDiv, {\r\n                backgroundColor: '#fff',\r\n                opacity: '0.9',\r\n                border: '1px solid var(--active-highlight-color)'\r\n            });\r\n        } else {\r\n            BB.css(toggleDiv, {\r\n                backgroundColor: 'transparent',\r\n                opacity: '0.5',\r\n                border: '1px solid #666'\r\n            });\r\n        }\r\n    }\r\n\r\n    toggleDiv.title = LANG('brush-toggle-pressure');\r\n    toggleDiv.onclick = function() {\r\n        isChecked = !isChecked;\r\n        redraw();\r\n        changeCallback(isChecked);\r\n    };\r\n\r\n    redraw();\r\n    changeCallback(isChecked);\r\n\r\n    return toggleDiv;\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"5H9IS\");","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport {IKlSliderConfig} from '../../kl.types';\r\nimport {languageStrings} from '../../../language/language';\r\n\r\n\r\n\r\n/**\r\n * big slider, e.g. used for brush size\r\n *\r\n * p = {\r\n *      label: 'Size',\r\n *      width: 500,\r\n *      height: 20,\r\n *      theme: 'compact-light',\r\n *      min: 0,\r\n *      max: 100,\r\n *      initValue: 10,\r\n *      resolution: 600, // if you want spline.find to use a different resolution\r\n *      curve: 'quadratic' | [...], // optional. array is BB.SplineInterpolator points. 0-1\r\n *      formatFunc: function(value) { // optional\r\n *          return Math.round(value);\r\n *      },\r\n *      onChange: function(value) {},\r\n *      isChangeOnFinal: true,\r\n *      eventResMs: 123,\r\n *      isEnabled?: boolean, // default = true\r\n * }\r\n *\r\n * Values can be spline interpolated\r\n * On change callback can be debounced\r\n *\r\n * @param p - obj\r\n * @constructor\r\n */\r\nexport const KlSlider = function (p) {\r\n    const _this = this;\r\n    let isEnabled = p.isEnabled !== false;\r\n    let useSpline = !!p.curve;\r\n    let splineInterpolator;\r\n\r\n    if (!p.label || !p.onChange) {\r\n        throw 'PcSlider missing params';\r\n    }\r\n    if (p.min != 0 && p.max != 0 && p.initValue != 0) {\r\n        if (!p.min || !p.max || !p.initValue) {\r\n            throw 'PcSlider broken params';\r\n        }\r\n    }\r\n    if (p.min >= p.max) {\r\n        throw 'PcSlider broken params';\r\n    }\r\n\r\n    const elementWidth = p.width;\r\n    const elementHeight = p.height;\r\n    const resolution = p.resolution ? p.resolution : elementWidth;\r\n    let min = p.min;\r\n    let max = p.max;\r\n    const onChange = p.onChange;\r\n    const isChangeOnFinal = !!p.isChangeOnFinal;\r\n    const formatFunc = p.formatFunc;\r\n    const eventResMs = p.eventResMs;\r\n\r\n    if (useSpline) {\r\n        const curveArr = p.curve === 'quadratic' ? BB.quadraticSplineInput(min, max, 0.1) : p.curve;\r\n        splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n    }\r\n\r\n    function toLinearValue(value) {\r\n        if (useSpline) {\r\n            return splineInterpolator.findX(value, Math.floor(resolution * 1.5));\r\n        }\r\n        return (value - min) / (max - min);\r\n    }\r\n\r\n    function toValue(pLinearValue) {\r\n        let result = min + pLinearValue * (max - min);\r\n        if (useSpline) {\r\n            result = splineInterpolator.interpolate(pLinearValue);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    const div = BB.el({\r\n        className: 'sliderWrapper',\r\n        css: {\r\n            overflow: 'hidden',\r\n            position: 'relative',\r\n            width: elementWidth + 'px',\r\n            height: elementHeight + 'px',\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    const labelCaption = p.label;\r\n    const label = document.createElement('div');\r\n    const control = document.createElement('div');\r\n    const controlInner = document.createElement('div');\r\n    let linearValue = toLinearValue(p.initValue); //0 - 1\r\n\r\n    div.appendChild(control);\r\n    div.appendChild(label);\r\n    control.appendChild(controlInner);\r\n    control.className = 'sliderInner';\r\n\r\n\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n    //control.style.backgroundColor = \"#aaa\";\r\n    label.innerHTML = labelCaption;\r\n\r\n    control.style.position = 'absolute';\r\n    control.style.left = '0';\r\n    control.style.top = '0';\r\n    control.style.width = (linearValue * elementWidth) + 'px';\r\n    control.style.height = elementHeight + 'px';\r\n\r\n    const labelFontSize = elementHeight - 14;\r\n    BB.css(label, {\r\n        position: 'absolute',\r\n        left: '7px',\r\n        top: (elementHeight / 2 - labelFontSize / 2 + 1) + 'px',\r\n        lineHeight: labelFontSize + 'px',\r\n        fontSize: labelFontSize + 'px',\r\n        pointerEvents: 'none'\r\n    });\r\n\r\n    function updateEnable (): void {\r\n        if (isEnabled) {\r\n            BB.css(div, {\r\n                opacity: null,\r\n                pointerEvents: null,\r\n            });\r\n        } else {\r\n            BB.css(div, {\r\n                opacity: '0.5',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n    }\r\n    updateEnable();\r\n\r\n    function getOutsideVal() {\r\n        let result = min + linearValue * (max - min);\r\n        if (useSpline) {\r\n            result = splineInterpolator.interpolate(linearValue);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    function updateLabel() {\r\n        let outVal = toValue(linearValue);\r\n        outVal = formatFunc ? formatFunc(outVal) : parseInt(outVal);\r\n        outVal = outVal.toLocaleString(languageStrings.getCode());\r\n        label.innerHTML = labelCaption + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + outVal + '</span>';\r\n        control.style.width = (linearValue * elementWidth) + 'px';\r\n    }\r\n\r\n    let lastCallbackTime = 0;\r\n    function emit(isFinal) {\r\n        if (!isFinal && isChangeOnFinal) {\r\n            return;\r\n        }\r\n        if (eventResMs && !isFinal) {\r\n            const now = performance.now();\r\n            if (now - lastCallbackTime >= eventResMs) {\r\n                lastCallbackTime = now;\r\n                onChange(getOutsideVal());\r\n            }\r\n        } else {\r\n            onChange(getOutsideVal());\r\n        }\r\n    }\r\n\r\n    let virtualVal;\r\n    function onPointer(event) {\r\n        event.eventPreventDefault();\r\n\r\n        if (!isEnabled) {\r\n            return;\r\n        }\r\n\r\n        if (event.type === 'pointerdown') {\r\n            div.className = 'sliderWrapper sliderWrapperActive';\r\n\r\n            if (event.button === 'left') {\r\n                linearValue = event.relX / elementWidth;\r\n                linearValue = Math.max(0, Math.min(1, linearValue));\r\n                updateLabel();\r\n                emit(false);\r\n            }\r\n            virtualVal = linearValue;\r\n        }\r\n\r\n        if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n            let deltaX = event.dX;\r\n            const deltaY = Math.abs(event.pageY - event.downPageY);\r\n            const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n            deltaX *= factor;\r\n            deltaX /= elementWidth;\r\n\r\n            virtualVal += deltaX;\r\n            linearValue = Math.max(0, Math.min(1, virtualVal));\r\n\r\n            updateLabel();\r\n            emit(false);\r\n        }\r\n\r\n        if (event.type === 'pointerup') {\r\n            div.className = 'sliderWrapper';\r\n            emit(true);\r\n        }\r\n\r\n    }\r\n\r\n    let pointerListener;\r\n    const pointerListenerTimeout = setTimeout(() => {\r\n        pointerListener = new BB.PointerListener({\r\n            target: div,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: onPointer,\r\n            onWheel: function(event) {\r\n                if (useSpline) {\r\n                    linearValue += -event.deltaY * (splineInterpolator.getLastX() - splineInterpolator.getFirstX()) / 40;\r\n                    linearValue = Math.max(splineInterpolator.getFirstX(), Math.min(splineInterpolator.getLastX(), linearValue));\r\n                } else {\r\n                    linearValue += -event.deltaY / 40;\r\n                    linearValue = Math.max(0, Math.min(1, linearValue));\r\n                }\r\n                updateLabel();\r\n                onChange(getOutsideVal());\r\n            }\r\n        });\r\n        updateLabel();\r\n    }, 1);\r\n\r\n\r\n    // --- interface ---\r\n    this.increaseValue = function (f) {\r\n        linearValue = Math.min(1, linearValue + Math.abs(f));\r\n        updateLabel();\r\n        onChange(getOutsideVal());\r\n    };\r\n    this.decreaseValue = function (f) {\r\n        linearValue = Math.max(0, linearValue - Math.abs(f));\r\n        updateLabel();\r\n        onChange(getOutsideVal());\r\n    };\r\n    this.setValue = function(v) {\r\n        linearValue = toLinearValue(v);\r\n        updateLabel();\r\n    };\r\n    this.getValue = function () {\r\n        return getOutsideVal();\r\n    };\r\n    this.update = function(config: IKlSliderConfig): void {\r\n        min = config.min;\r\n        max = config.max;\r\n        useSpline = !!config.curve;\r\n        if (useSpline) {\r\n            const curveArr = config.curve === 'quadratic' ? BB.quadraticSplineInput(min, max, 0.1) : config.curve;\r\n            splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        } else {\r\n            splineInterpolator = null;\r\n        }\r\n        _this.setIsEnabled(!config.isDisabled);\r\n    };\r\n    this.setIsEnabled = function (e: boolean): void {\r\n        isEnabled = !!e;\r\n        updateEnable();\r\n    };\r\n\r\n    this.destroy = function() {\r\n        clearTimeout(pointerListenerTimeout);\r\n        if (pointerListener) {\r\n            pointerListener.destroy();\r\n        }\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    }\r\n\r\n};","\r\n\r\n/**\r\n * to make sliders more finegrained.\r\n * @param deltaY number - how far pointer moved away vertically since down\r\n * @returns {number} the factor 0-1. 0 -> infinite movement for change of 1. 1 -> 1px for change of 1\r\n */\r\nexport const calcSliderFalloffFactor = function(deltaY, isRightButton) {\r\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\r\n    if (isRightButton) {\r\n        result *= 2;\r\n    }\r\n    return 1 / result;\r\n};\r\n","import {BB} from '../../../bb/bb';\r\nimport {input} from '../base-components/input';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n// @ts-ignore\r\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\r\n\r\n/**\r\n * dialog for manually inputting the color\r\n * @param p {color: rgbObj, onClose: function(rgbObj | null)}\r\n * @constructor\r\n */\r\nexport const HexColorDialog = function (p) {\r\n\r\n    let lastValidRgb = new BB.RGB(p.color.r, p.color.g, p.color.b);\r\n\r\n    const div = BB.el({});\r\n\r\n    const previewEl = BB.el({\r\n        css: {\r\n            width: '20px',\r\n            height: '20px',\r\n            marginBottom: '10px',\r\n            boxShadow: 'inset 0 0 0 1px #fff, 0 0 0 1px #000',\r\n            background: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.appendChild(previewEl);\r\n\r\n\r\n    // --- Hex ---\r\n    const hexRowEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginBottom: '15px'\r\n        }\r\n    });\r\n    const hexLabel = BB.el({\r\n        content: LANG('mci-hex'),\r\n        css: {\r\n            width: '60px'\r\n        }\r\n    });\r\n    const hexInput = input({\r\n        init: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n        css: {\r\n            width: '80px'\r\n        },\r\n        callback: function() {\r\n            let rgbObj = BB.ColorConverter.hexToRGB(hexInput.value);\r\n            if (rgbObj === null) {\r\n                rgbObj = lastValidRgb;\r\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n            } else {\r\n                lastValidRgb = rgbObj;\r\n            }\r\n            previewEl.style.background = '#' + BB.ColorConverter.toHexString(rgbObj);\r\n\r\n            for (let i = 0; i < rgbArr.length; i++) {\r\n                rgbArr[i].update();\r\n            }\r\n        }\r\n    });\r\n    const copyButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img src=\"' + copyImg + '\" height=\"20\"/>',\r\n        title: LANG('mci-copy'),\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            hexInput.select();\r\n            document.execCommand('copy');\r\n        }\r\n    });\r\n    hexRowEl.appendChild(hexLabel);\r\n    hexRowEl.appendChild(hexInput);\r\n    hexRowEl.appendChild(copyButton);\r\n    div.appendChild(hexRowEl);\r\n    setTimeout(function () {\r\n        hexInput.focus();\r\n        hexInput.select();\r\n    }, 0);\r\n\r\n\r\n    // --- R G B ---\r\n    function createRgbInputRow(labelStr, attributeStr) {\r\n        const result: any = {};\r\n\r\n        const rowEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '5px',\r\n            }\r\n        });\r\n        const labelEl = BB.el({\r\n            content: labelStr,\r\n            css: {\r\n                width: '60px'\r\n            }\r\n        });\r\n\r\n        const inputEl = input({\r\n            init: lastValidRgb[attributeStr],\r\n            min: 0,\r\n            max: 255,\r\n            type: 'number',\r\n            css: {\r\n                width: '80px'\r\n            },\r\n            callback: function() {\r\n                if (inputEl.value === '' || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\r\n                    result.update();\r\n                    return;\r\n                }\r\n                inputEl.value = '' + Math.round(parseFloat(inputEl.value));\r\n                lastValidRgb[attributeStr] = inputEl.value;\r\n                previewEl.style.background = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n            }\r\n        });\r\n\r\n        rowEl.appendChild(labelEl);\r\n        rowEl.appendChild(inputEl);\r\n        div.appendChild(rowEl);\r\n\r\n\r\n        result.update = function() {\r\n            inputEl.value = lastValidRgb[attributeStr];\r\n        };\r\n        result.destroy = () => {\r\n            inputEl.onchange = null;\r\n        };\r\n        return result;\r\n    }\r\n    const rgbArr = [];\r\n    rgbArr.push(createRgbInputRow(LANG('red'), 'r'));\r\n    rgbArr.push(createRgbInputRow(LANG('green'), 'g'));\r\n    rgbArr.push(createRgbInputRow(LANG('blue'), 'b'));\r\n\r\n\r\n    popup({\r\n        target: document.body,\r\n        message: `<b>${LANG('manual-color-input')}</b>`,\r\n        div: div,\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (resultStr) {\r\n            BB.destroyEl(copyButton);\r\n            rgbArr.forEach(item => item.destroy());\r\n            rgbArr.splice(0, rgbArr.length);\r\n\r\n            p.onClose(resultStr === 'Ok' ? BB.ColorConverter.hexToRGB(hexInput.value) : null);\r\n        }\r\n    });\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"la7yv\");","import {BB} from '../../../bb/bb';\r\nimport {HexColorDialog} from '../modals/color-slider-hex-dialog';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\n// @ts-ignore\r\nimport eyedropperImg from 'url:~/src/app/img/ui/tool-picker.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * big main HS+V color slider\r\n * 2 elements: slider, and colorpreview(output) + eyedropper\r\n *\r\n * p = {\r\n *     width: number,\r\n *     height: number, // hue slider and output height\r\n *     svHeight: number,\r\n *     startValue: rgb, // 0-255\r\n *     onPick: function(rgb)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const KlColorSlider = function (p) {\r\n\r\n    const _this = this;\r\n    let pickCallback = function(result?) {};\r\n    const div = document.createElement('div');\r\n    div.style.position = 'relative';\r\n    div.className = 'colorSlider';\r\n    const outputDiv = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center'\r\n        }\r\n    });\r\n    const width = p.width;\r\n    let svHeight = p.svHeight;\r\n    const height = p.height;\r\n    const emitColor = p.onPick;\r\n\r\n    let primaryColorRGB = {\r\n        r: parseInt(p.startValue.r, 10),\r\n        g: parseInt(p.startValue.g, 10),\r\n        b: parseInt(p.startValue.b, 10)\r\n    };\r\n    let primaryColorHSV = BB.ColorConverter.toHSV(p.startValue); // BB.HSV\r\n    let secondaryColorRGB = {r: 255, g: 255, b: 255};\r\n    let secondaryColorHSV = BB.ColorConverter._RGBtoHSV(secondaryColorRGB); // BB.HSV\r\n\r\n    const svWrapper = BB.el({});\r\n    const svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"> <defs> <linearGradient id=\"value\" gradientTransform=\"rotate(90)\"> <stop offset=\"0\" stop-color=\"rgba(0,0,0,0)\"/> <stop offset=\"100%\" stop-color=\"rgba(0,0,0,1)\"/> </linearGradient> <linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"> <stop offset=\"0\" stop-color=\"#fff\"/> <stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/> </linearGradient> </defs> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\"/></svg>', 'image/svg+xml').documentElement;\r\n    const hueStop = (svSvg as any).getElementById('hue-stop');\r\n    BB.setAttributes(hueStop, {\r\n        'stop-color': '#f0f'\r\n    });\r\n    BB.css(svSvg, {\r\n        width: width + 'px',\r\n        height: svHeight + 'px'\r\n    });\r\n    svWrapper.appendChild(svSvg);\r\n\r\n    const divH = document.createElement('div');\r\n    BB.css(divH, {\r\n        position: 'relative',\r\n        height: height + 'px'\r\n    });\r\n    const divPreview = document.createElement('div');\r\n    const controlH = document.createElement('div');\r\n\r\n    const enabled = true;\r\n\r\n    function updatePrimaryHSV(hsv) {\r\n        if (hsv.s === 0) {\r\n            primaryColorHSV = new BB.HSV(primaryColorHSV.h, hsv.s, hsv.v);\r\n        } else {\r\n            primaryColorHSV = new BB.HSV(hsv.h, hsv.s, hsv.v);\r\n        }\r\n    }\r\n\r\n    function createHueBg(targetEl) {\r\n        const im = new Image();\r\n        BB.css(im, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            display: 'none',\r\n            pointerEvents: 'none'\r\n        });\r\n        const cv = BB.canvas(width, height);\r\n        const ctx = cv.getContext('2d');\r\n        const gradH = ctx.createLinearGradient(0, 0, width, 0);\r\n        for (let i = 0; i < 1; i += 0.01) {\r\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n            let ha = (parseInt('' + col.r)).toString(16);\r\n            let hb = (parseInt('' + col.g)).toString(16);\r\n            let hc = (parseInt('' + col.b)).toString(16);\r\n            if (ha.length === 1)\r\n                ha = '0' + ha;\r\n            if (hb.length === 1)\r\n                hb = '0' + hb;\r\n            if (hc.length === 1)\r\n                hc = '0' + hc;\r\n            gradH.addColorStop(i, '#' + ha + hb + hc);\r\n        }\r\n        ctx.fillStyle = gradH;\r\n        ctx.fillRect(0, 0, width, height);\r\n\r\n        targetEl.appendChild(im);\r\n        im.alt = 'hue';\r\n        im.src = cv.toDataURL('image/png');\r\n        im.style.display = 'block';\r\n    }\r\n\r\n\r\n    function updateSVCanvas() {\r\n        const rgb = BB.ColorConverter.toRGB(new BB.HSV(primaryColorHSV.h, 100, 100));\r\n        BB.setAttributes(hueStop, {\r\n            'stop-color': '#' + BB.ColorConverter.toHexString(rgb)\r\n        });\r\n    }\r\n\r\n    function updateSVPointer() {\r\n\r\n        const left = primaryColorHSV.s / 100 * width - 7;\r\n        const top = (1 - primaryColorHSV.v / 100) * svHeight - 6;\r\n        BB.css(pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px'\r\n        });\r\n    }\r\n\r\n    function setColPreview() {\r\n        divPreview.style.backgroundColor = 'rgb(' + primaryColorRGB.r + ',' + primaryColorRGB.g + ',' + primaryColorRGB.b + ')';\r\n\r\n        if (BB.testIsWhiteBestContrast(primaryColorRGB)) {\r\n            BB.css(pickerButton, {\r\n                filter: 'invert(1)'\r\n            });\r\n            BB.css(hexButton, {\r\n                filter: 'invert(1)'\r\n            });\r\n        } else{\r\n            BB.css(pickerButton, {\r\n                filter: ''\r\n            });\r\n            BB.css(hexButton, {\r\n                filter: ''\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    updateSVCanvas();\r\n    div.style.width = width + 'px';\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    const SVContainer = document.createElement('div');\r\n    BB.css(SVContainer, {\r\n        width: width + 'px',\r\n        height: svHeight + 'px',\r\n        overflow: 'hidden',\r\n        display: 'block',\r\n        position: 'relative',\r\n        cursor: 'crosshair',\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\r\n    });\r\n\r\n    const pointerSV = document.createElement('div');\r\n    BB.css(pointerSV, {\r\n        width: '12px',\r\n        height: '12px',\r\n        borderRadius: '6px',\r\n        position: 'absolute',\r\n        pointerEvents: 'none',\r\n        boxShadow: '0px 0px 0 1px #000, inset 0px 0px 0 1px #fff'\r\n    });\r\n\r\n    SVContainer.appendChild(svWrapper);\r\n    SVContainer.appendChild(pointerSV);\r\n    updateSVPointer();\r\n    div.appendChild(SVContainer);\r\n    div.appendChild(divH);\r\n    outputDiv.appendChild(divPreview);\r\n    BB.css(divPreview, {\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        width: (height * 2.5) + 'px',\r\n        height: height + 'px',\r\n        //position: \"relative\",\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\r\n        colorScheme: 'only light',\r\n    });\r\n\r\n    BB.css(divH, {\r\n        overflow: 'hidden',\r\n        position: 'relative',\r\n        width: width + 'px',\r\n        height: height + 'px',\r\n        cursor: 'ew-resize',\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\r\n        marginTop: '1px',\r\n        marginBottom: '1px'\r\n    });\r\n\r\n    //divH.className = \"svSlider\";\r\n    BB.css(controlH, {\r\n        width: '1px',\r\n        height: height + 'px',\r\n        background: '#000',\r\n        borderLeft: '1px solid #fff',\r\n        position: 'absolute',\r\n        top: '0',\r\n        left: parseInt('' + (primaryColorHSV.h / 360 * width - 1)) + 'px'\r\n    });\r\n\r\n\r\n    const virtualHSV = {\r\n        h: 0,\r\n        s: 0,\r\n        v: 0\r\n    };\r\n    let svPointerListener;\r\n    let hPointerListener;\r\n\r\n\r\n    const pickerButton = BB.el({\r\n        title: LANG('eyedropper') + ' [Alt]',\r\n        className: 'color-picker-preview-button',\r\n        css: {\r\n            width: '30px',\r\n            height: '30px',\r\n            backgroundImage: 'url(' + eyedropperImg + ')',\r\n            backgroundRepeat:  'no-repeat',\r\n            backgroundSize: '70%',\r\n            backgroundPosition: 'center'\r\n        }\r\n    });\r\n    let isPicking = false;\r\n\r\n\r\n    pickerButton.onclick = function () {\r\n        if (isPicking === false) {\r\n            BB.removeClassName(pickerButton, 'color-picker-preview-button-hover');\r\n            BB.addClassName(pickerButton, 'color-picker-preview-button-active');\r\n            isPicking = true;\r\n            pickCallback(true);\r\n        } else {\r\n            pickCallback(false);\r\n            _this.pickingDone();\r\n        }\r\n    };\r\n    const pickerButtonPointerListener = new BB.PointerListener({\r\n        target: pickerButton,\r\n        onEnterLeave: function(isOver) {\r\n            if (isPicking) {\r\n                return;\r\n            }\r\n            if (isOver) {\r\n                BB.addClassName(pickerButton, 'color-picker-preview-button-hover');\r\n            } else {\r\n                BB.removeClassName(pickerButton, 'color-picker-preview-button-hover');\r\n            }\r\n        }\r\n    });\r\n    divPreview.appendChild(pickerButton);\r\n\r\n\r\n    const hexButton = BB.el({\r\n        content: '#',\r\n        className: 'color-picker-preview-button',\r\n        title: LANG('manual-color-input'),\r\n        css: {\r\n            height: '100%',\r\n            width: height + 'px',\r\n            lineHeight: height + 'px',\r\n            fontSize: (height * 0.65) + 'px'\r\n        },\r\n        onClick: function() {\r\n            HexColorDialog({\r\n                color: new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b),\r\n                onClose: function(rgbObj) {\r\n                    if (!rgbObj) {\r\n                        return;\r\n                    }\r\n                    _this.setColor(rgbObj);\r\n                    emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\r\n                }\r\n            });\r\n        }\r\n    });\r\n    const hexButtonPointerListener = new BB.PointerListener({\r\n        target: hexButton,\r\n        onEnterLeave: function(isOver) {\r\n            if (isOver) {\r\n                BB.addClassName(hexButton, 'color-picker-preview-button-hover');\r\n            } else {\r\n                BB.removeClassName(hexButton, 'color-picker-preview-button-hover');\r\n            }\r\n        }\r\n    });\r\n    divPreview.appendChild(hexButton);\r\n\r\n    setColPreview();\r\n\r\n\r\n    setTimeout(function() {\r\n        createHueBg(divH);\r\n        divH.appendChild(controlH);\r\n        svPointerListener = new BB.PointerListener({\r\n            target: svWrapper,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown') {\r\n                    BB.css(SVContainer, {\r\n                        boxShadow: '0px 0px 0px 1px rgb(255,255,255)',\r\n                        zIndex: '1'\r\n                    });\r\n\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.s = event.relX / width * 100;\r\n                        virtualHSV.v = 100 - event.relY / svHeight * 100;\r\n\r\n                        primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n\r\n                        updateSVPointer();\r\n                        setColPreview();\r\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n                    } else {\r\n                        virtualHSV.s = primaryColorHSV.s;\r\n                        virtualHSV.v = primaryColorHSV.v;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                    let factor = 1;\r\n                    if (event.button === 'right') {\r\n                        factor = 0.5;\r\n                    }\r\n\r\n                    virtualHSV.s += event.dX / width * 100 * factor;\r\n                    virtualHSV.v -= event.dY / svHeight * 100 * factor;\r\n\r\n                    primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                    updateSVPointer();\r\n                    setColPreview();\r\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n\r\n                }\r\n\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(SVContainer, {\r\n                        boxShadow: '0 0 0 1px rgb(188, 188, 188)',\r\n                        zIndex: '0'\r\n                    });\r\n                }\r\n\r\n            }\r\n        });\r\n        hPointerListener = new BB.PointerListener({\r\n            target: divH,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n\r\n                if (event.type === 'pointerdown') {\r\n                    BB.css(divH, {\r\n                        boxShadow: '0px 0px 0px 1px rgba(255,255,255,1)'\r\n                    });\r\n\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.h = event.relX / width * 359.99;\r\n\r\n                        primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\r\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                        controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\r\n                        updateSVCanvas();\r\n                        setColPreview();\r\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n                    } else {\r\n                        virtualHSV.h = primaryColorHSV.h;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                    const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                    const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                    virtualHSV.h += event.dX / width * 359.99 * factor;\r\n\r\n                    if (event.button === 'right') {\r\n                        virtualHSV.h = virtualHSV.h % 359.99;\r\n                        if (virtualHSV.h < 0) {\r\n                            virtualHSV.h += 359.99;\r\n                        }\r\n                    }\r\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                    primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\r\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                    controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\r\n                    updateSVCanvas();\r\n                    setColPreview();\r\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n\r\n                }\r\n\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(divH, {\r\n                        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    }, 1);\r\n\r\n\r\n    // --- second color ---\r\n\r\n    const secondaryColorBtn = BB.el({\r\n        parent: outputDiv,\r\n        title: LANG('secondary-color') + ' [X]',\r\n        css: {\r\n            cursor: 'pointer',\r\n            marginLeft: '5px',\r\n            width: '22px',\r\n            height: '22px',\r\n            boxShadow: 'rgb(188, 188, 188) 0px 0px 0px 1px',\r\n            colorScheme: 'only light',\r\n        },\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            swapColors();\r\n        }\r\n    });\r\n    function updateSecondaryColor() {\r\n        secondaryColorBtn.style.backgroundColor = BB.ColorConverter.toRgbStr(secondaryColorRGB);\r\n    }\r\n    function swapColors() {\r\n        // swap hsv\r\n        let tmp: any = secondaryColorHSV;\r\n        secondaryColorHSV = primaryColorHSV;\r\n        updatePrimaryHSV(tmp);\r\n        // swap rgb\r\n        tmp = secondaryColorRGB;\r\n        secondaryColorRGB = primaryColorRGB;\r\n        primaryColorRGB = tmp;\r\n\r\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\r\n        updateSVCanvas();\r\n        updateSVPointer();\r\n        setColPreview();\r\n        updateSecondaryColor();\r\n\r\n        emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\r\n    }\r\n    updateSecondaryColor();\r\n\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.setColor = function (c) {\r\n        primaryColorRGB = {r: parseInt(c.r, 10), g: parseInt(c.g, 10), b: parseInt(c.b, 10)};\r\n        updatePrimaryHSV(BB.ColorConverter.toHSV(c));\r\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\r\n        updateSVCanvas();\r\n        updateSVPointer();\r\n        setColPreview();\r\n    };\r\n\r\n    this.getColor = function () {\r\n        return new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b);\r\n    };\r\n\r\n    this.getSecondaryRGB = function() {\r\n        return new BB.RGB(secondaryColorRGB.r, secondaryColorRGB.g, secondaryColorRGB.b);\r\n    };\r\n\r\n    this.setPickCallback = function (func) {\r\n        pickCallback = func;\r\n    };\r\n\r\n    this.pickingDone = function () {\r\n        if (!isPicking) {\r\n            return;\r\n        }\r\n        isPicking = false;\r\n        BB.removeClassName(pickerButton, 'color-picker-preview-button-active');\r\n    };\r\n\r\n    this.enable = function (e) {\r\n        if (e) {\r\n            div.style.pointerEvents = '';\r\n            div.style.opacity = '1';\r\n            outputDiv.style.pointerEvents = '';\r\n            outputDiv.style.opacity = '1';\r\n        } else {\r\n            div.style.pointerEvents = 'none';\r\n            div.style.opacity = '0.5';\r\n            outputDiv.style.pointerEvents = 'none';\r\n            outputDiv.style.opacity = '0.5';\r\n        }\r\n    };\r\n\r\n    this.setHeight = function (h) {\r\n        h = parseInt('' +(h - height * 2 - 3), 10);\r\n        if (h === svHeight) {\r\n            return;\r\n        }\r\n        svHeight = h;\r\n        BB.css(svSvg, {\r\n            width: width + 'px',\r\n            height: svHeight + 'px'\r\n        });\r\n        SVContainer.style.height = svHeight + 'px';\r\n        updateSVPointer();\r\n    };\r\n\r\n    this.swapColors = function() {\r\n        swapColors();\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.getOutputElement = function() {\r\n        return outputDiv;\r\n    }\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cTtMO\");","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\n\r\n\r\n/**\r\n * a small color slider\r\n *\r\n * params {\r\n * \t width: 200,\r\n * \t heightSV: 200,\r\n * \t heightH: 10,\r\n * \t color: {r,g,b}\r\n * \t callback: function(c){}\r\n * }\r\n *\r\n * @param params\r\n * @constructor\r\n */\r\nexport const KlSmallColorSlider = function (params) {\r\n    const div = document.createElement('div');\r\n    div.oncontextmenu = function(e) {\r\n        e.preventDefault();\r\n    };\r\n    let color = BB.ColorConverter.toHSV(new BB.RGB(params.color.r, params.color.g, params.color.b));\r\n    BB.css(div, {\r\n        width: params.width + 'px',\r\n        position: 'relative',\r\n        overflow: 'hidden',\r\n        userSelect: 'none'\r\n    });\r\n\r\n    const canvasSV = BB.canvas(10, 10);\r\n    canvasSV.style.width = params.width + 'px';\r\n    canvasSV.style.height = params.heightSV + 'px';\r\n    canvasSV.style.cursor = 'crosshair';\r\n\r\n    function updateSV() {\r\n        const ctx = canvasSV.getContext('2d');\r\n        for (let i = 0; i < canvasSV.height; i += 1) {\r\n            const gradient1 = ctx.createLinearGradient(0, 0, canvasSV.width, 0);\r\n\r\n            const colleft = BB.ColorConverter.toRGB(new BB.HSV(color.h, 1, 100 - (i / canvasSV.height * 100.0)));\r\n            const colright = BB.ColorConverter.toRGB(new BB.HSV(color.h, 100, 100 - (i / canvasSV.height * 100.0)));\r\n            gradient1.addColorStop(0, '#' + BB.ColorConverter.toHexString(colleft));\r\n            gradient1.addColorStop(1, '#' + BB.ColorConverter.toHexString(colright));\r\n            ctx.fillStyle = '#ff0000'; //needed for chrome...otherwise alpha problem\r\n            ctx.fillStyle = gradient1;\r\n            ctx.fillRect(0, i, canvasSV.width, 1);\r\n        }\r\n    }\r\n\r\n    updateSV();\r\n\r\n    const canvasH = BB.canvas(params.width, params.heightH);\r\n    canvasH.style.cursor = 'ew-resize';\r\n    (function () {\r\n        const ctx = canvasH.getContext('2d');\r\n\r\n        const gradH = ctx.createLinearGradient(0, 0, params.width, 0);\r\n        for (let i = 0; i < 1; i += 0.01) {\r\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n            gradH.addColorStop(i, 'rgba(' + parseInt('' + col.r) + ', ' + parseInt('' + col.g) + ', ' + parseInt('' + col.b) + ', 1)');\r\n        }\r\n        ctx.fillStyle = gradH;\r\n        ctx.fillRect(0, 0, params.width, params.heightH);\r\n\r\n    })();\r\n    BB.css(canvasSV, {\r\n        width: params.width + 'px',\r\n        height: params.heightSV + 'px',\r\n        overflow: 'hidden',\r\n        position: 'relative'\r\n    });\r\n    canvasSV.style.cssFloat = 'left';\r\n    canvasH.style.cssFloat = 'left';\r\n\r\n    div.appendChild(canvasSV);\r\n    div.appendChild(canvasH);\r\n\r\n    const pointerSV = document.createElement('div');\r\n    BB.css(pointerSV, {\r\n        width: '8px',\r\n        height: '8px',\r\n        borderRadius: '8px',\r\n        position: 'absolute',\r\n        pointerEvents: 'none',\r\n        boxShadow: '0 0 0 1px #000, inset 0 0 0 1px #fff'\r\n    });\r\n    div.appendChild(pointerSV);\r\n\r\n    const pointerH = document.createElement('div');\r\n    BB.css(pointerH, {\r\n        width: '0',\r\n        height: params.heightH + 'px',\r\n        borderLeft: '1px solid #fff',\r\n        borderRight: '1px solid #000',\r\n        position: 'absolute',\r\n        top: params.heightSV + 'px',\r\n        pointerEvents: 'none'\r\n    });\r\n    div.appendChild(pointerH);\r\n\r\n\r\n    function updateSVPointer() {\r\n        const left = color.s / 100 * params.width - 4;\r\n        const top = (1 - color.v / 100) * params.heightSV - 4;\r\n        BB.css(pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px'\r\n        });\r\n        /*if (top < params.heightSV/3) {\r\n        pointerSV.style.border = \"1px solid rgba(0,0,0,1)\";\r\n    } else {\r\n        pointerSV.style.border = \"1px solid rgba(255,255,255,1)\";\r\n    }*/\r\n    }\r\n\r\n    function updateHPointer() {\r\n        pointerH.style.left = (color.h / 359.999 * params.width - 1) + 'px';\r\n    }\r\n\r\n    updateSVPointer();\r\n    updateHPointer();\r\n\r\n    const virtualHSV = {\r\n        h: 0,\r\n        s: 0,\r\n        v: 0\r\n    };\r\n\r\n    let svPointerId = null;\r\n    const svPointerListener = new BB.PointerListener({\r\n        target: canvasSV,\r\n        maxPointers: 1,\r\n        fixScribble: true,\r\n        onPointer: function(event) {\r\n\r\n            if (event.type === 'pointerdown') {\r\n                svPointerId = event.pointerId;\r\n                if (event.button === 'left') {\r\n\r\n                    virtualHSV.s = event.relX / params.width * 100;\r\n                    virtualHSV.v = 100 - event.relY / params.heightSV * 100;\r\n\r\n                    color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\r\n\r\n                    updateSVPointer();\r\n                    params.callback(BB.ColorConverter.toRGB(color));\r\n                } else {\r\n                    virtualHSV.s = color.s;\r\n                    virtualHSV.v = color.v;\r\n                }\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && svPointerId === event.pointerId) {\r\n\r\n                let factor = 1;\r\n                if (event.button === 'right') {\r\n                    factor = 0.5;\r\n                }\r\n\r\n                virtualHSV.s += event.dX / params.width * 100 * factor;\r\n                virtualHSV.v -= event.dY / params.heightSV * 100 * factor;\r\n\r\n                color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\r\n                updateSVPointer();\r\n                params.callback(BB.ColorConverter.toRGB(color));\r\n\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                svPointerId = null;\r\n            }\r\n\r\n        }\r\n    });\r\n\r\n    let hPointerId = null;\r\n    const hPointerListener = new BB.PointerListener({\r\n        target: canvasH,\r\n        maxPointers: 1,\r\n        fixScribble: true,\r\n        onPointer: function(event) {\r\n\r\n            if (event.type === 'pointerdown') {\r\n                hPointerId = event.pointerId;\r\n                if (event.button === 'left') {\r\n\r\n                    virtualHSV.h = event.relX / params.width * 359.99;\r\n\r\n                    color = new BB.HSV(virtualHSV.h, color.s, color.v);\r\n                    updateSV();\r\n                    updateHPointer();\r\n                    params.callback(BB.ColorConverter.toRGB(color));\r\n                } else {\r\n                    virtualHSV.h = color.h;\r\n                }\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && hPointerId === event.pointerId) {\r\n\r\n                const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                virtualHSV.h += event.dX / params.width * 359.99 * factor;\r\n\r\n                if (event.button === 'right') {\r\n                    virtualHSV.h = virtualHSV.h % 359.99;\r\n                    if (virtualHSV.h < 0) {\r\n                        virtualHSV.h += 359.99;\r\n                    }\r\n                }\r\n                virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                color = new BB.HSV(virtualHSV.h, color.s, color.v);\r\n                updateSV();\r\n                updateHPointer();\r\n                params.callback(BB.ColorConverter.toRGB(color));\r\n\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                hPointerId = null;\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    const cleardiv = document.createElement('div');\r\n    cleardiv.style.clear = 'both';\r\n    div.appendChild(cleardiv);\r\n\r\n    // --- interface ---\r\n    this.setColor = function (c) {\r\n        color = BB.ColorConverter.toHSV(new BB.RGB(c.r, c.g, c.b));\r\n        updateSV();\r\n        updateSVPointer();\r\n        updateHPointer();\r\n    };\r\n    this.getColor = function () {\r\n        return BB.ColorConverter.toRGB(color);\r\n    };\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.destroy = function() {\r\n        svPointerListener.destroy();\r\n        hPointerListener.destroy();\r\n    };\r\n    this.end = function() {\r\n        svPointerId = null;\r\n        hPointerId = null;\r\n    };\r\n\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n\r\n/**\r\n * a slider that looks like this\r\n * ------O----\r\n *\r\n * param: {init, width, pointSize, callback(value, isFirst, isLast)}\r\n *\r\n * @param param\r\n * @constructor\r\n */\r\nexport const PointSlider = function(param) {\r\n\r\n    const div = document.createElement('div');\r\n    div.style.position = 'relative';\r\n    const sliderLine = BB.el({});\r\n    const sliderPoint = BB.el({\r\n        css: {\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.appendChild(sliderLine);\r\n    div.appendChild(sliderPoint);\r\n    let sliderPos;\r\n    let isDragging = false;\r\n\r\n    //sliderLine\r\n    {\r\n        BB.css(sliderLine, {\r\n            marginTop: parseInt('' + (param.pointSize / 2 - 1)) + 'px',\r\n            height: '2px',\r\n            background: '#aaa',\r\n            width: param.width + 'px'\r\n        });\r\n    }\r\n    //sliderPoint\r\n    const touchAreaEl = BB.el({ // expand clickable area\r\n        parent: sliderPoint,\r\n        css: {\r\n            // background: 'rgba(255,0,0,0.4)',\r\n            margin: '-7px 0 0 -7px',\r\n            width: 'calc(100% + 14px)',\r\n            height: 'calc(100% + 7px)',\r\n        }\r\n    });\r\n\r\n    function redrawPoint() {\r\n        sliderPoint.style.left = sliderPos + 'px';\r\n        if (isDragging) {\r\n            sliderPoint.style.boxShadow = '0 0 6px rgba(0,0,0,1)';\r\n        } else {\r\n            sliderPoint.style.boxShadow = '0 0 3px rgba(0,0,0,0.8)';\r\n        }\r\n    }\r\n    function getValue() {\r\n        return sliderPos /  (param.width - param.pointSize);\r\n    }\r\n\r\n    let pointerListener;\r\n    {\r\n        let isFirst;\r\n        sliderPos = BB.clamp(param.init * (param.width - param.pointSize), 0, param.width - param.pointSize);\r\n        BB.css(sliderPoint, {\r\n            position: 'absolute',\r\n            top: '0px',\r\n            backgroundColor: '#eaeaea',\r\n            boxShadow: '0 0 3px rgba(0,0,0,0.8)',\r\n            width: param.pointSize + 'px',\r\n            height: param.pointSize + 'px',\r\n            borderRadius: param.pointSize + 'px',\r\n            cursor: 'ew-resize',\r\n            transition: 'box-shadow 0.2s ease-in-out'\r\n        });\r\n        redrawPoint();\r\n        let imaginaryPos;\r\n        pointerListener = new BB.PointerListener({\r\n            target: sliderPoint,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    isFirst = true;\r\n                    isDragging = true;\r\n                    imaginaryPos = sliderPos;\r\n                    redrawPoint();\r\n                    event.eventStopPropagation();\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                    event.eventStopPropagation();\r\n                    imaginaryPos = imaginaryPos + event.dX;\r\n                    sliderPos = parseInt('' + BB.clamp(imaginaryPos, 0, param.width - param.pointSize));\r\n                    redrawPoint();\r\n                    param.callback(getValue(), isFirst, false);\r\n                    isFirst = false;\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    event.eventStopPropagation();\r\n                    isDragging = false;\r\n                    redrawPoint();\r\n                    param.callback(getValue(), false, true);\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    // --- interface ---\r\n    this.getEl = function() {\r\n        return div;\r\n    };\r\n    this.setActive = function(isActive) {\r\n        if (isActive) {\r\n            sliderPoint.style.backgroundColor = '#fff';\r\n        } else {\r\n            sliderPoint.style.backgroundColor = '#eaeaea';\r\n        }\r\n    };\r\n    this.destroy = function() {\r\n        pointerListener.destroy();\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * UI to pick between colors in colorArr. can display full transparent (checkerboard).\r\n * Can't deal with 0.5 alpha.\r\n * Rectangular buttons.\r\n *\r\n * p = {\r\n *     colorArr: rgba[], // duplicates are removed\r\n *     onChange: func(rgbaObj),\r\n *     label: string,\r\n *     initialIndex: int// optional, index before duplicates were removed\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const ColorOptions = function(p) {\r\n    const div = BB.el({\r\n        content: p.label ? p.label : '',\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n\r\n    let selectedIndex = 0;\r\n    const colorArr = [];\r\n    const buttonArr = [];\r\n    const buttonSize = 22;\r\n    const checkerUrl = BB.createCheckerDataUrl(5);\r\n\r\n    // build colorArr while removing duplicates\r\n    for (let i = 0; i < p.colorArr.length; i++) {\r\n        const item = p.colorArr[i];\r\n        let found = false;\r\n        for (let e = 0; e < colorArr.length; e++) {\r\n            const sItem = colorArr[e];\r\n            if (sItem === null || item === null) {\r\n                continue;\r\n            }\r\n            if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\r\n                found = true;\r\n                break;\r\n            }\r\n        }\r\n        if (found) {\r\n            continue;\r\n        }\r\n        colorArr.push(item);\r\n        if ('initialIndex' in p && p.initialIndex === i) {\r\n            selectedIndex = colorArr.length - 1;\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < colorArr.length; i++) {\r\n        (function(i) {\r\n\r\n            const colorButton = BB.el({\r\n                content: colorArr[i] ? '' : 'X',\r\n                css: {\r\n                    width: buttonSize + 'px',\r\n                    height: buttonSize + 'px',\r\n                    backgroundColor: colorArr[i] ? BB.ColorConverter.toRgbaStr(colorArr[i]) : 'transparent',\r\n                    marginLeft: '7px',\r\n                    boxShadow: '0 0 0 1px #aaa',\r\n                    cursor: 'pointer',\r\n                    userSelect: 'none',\r\n                    textAlign: 'center',\r\n                    lineHeight: (buttonSize + 1) + 'px',\r\n                    color: '#aaa'\r\n                }\r\n            });\r\n            if (colorArr[i] && colorArr[i].a === 0) {\r\n                colorButton.style.backgroundImage = 'url(' + checkerUrl + ')';\r\n            }\r\n\r\n            colorButton.onclick = function(e) {\r\n                e.preventDefault();\r\n                selectedIndex = i;\r\n                update();\r\n                p.onChange(colorArr[i]);\r\n            };\r\n\r\n            (colorButton as any).setIsSelected = function(b) {\r\n                if (b) {\r\n                    BB.css(colorButton, {\r\n                        boxShadow: '0 0 0 2px var(--active-highlight-color), 0 0 5px 0 var(--active-highlight-color)',\r\n                        pointerEvents: 'none'\r\n                    });\r\n                } else {\r\n                    BB.css(colorButton, {\r\n                        boxShadow: '0 0 0 1px #aaa',\r\n                        pointerEvents: ''\r\n                    });\r\n                }\r\n            };\r\n\r\n\r\n            div.appendChild(colorButton);\r\n            buttonArr.push(colorButton);\r\n        })(i);\r\n    }\r\n\r\n\r\n    function update() {\r\n        for (let i = 0; i < buttonArr.length; i++) {\r\n            buttonArr[i].setIsSelected(i === selectedIndex);\r\n        }\r\n    }\r\n    update();\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.destroy = () => {\r\n        buttonArr.forEach(item => {\r\n            item.onclick = null;\r\n        });\r\n        buttonArr.splice(0, buttonArr.length);\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * selectable options\r\n * p = {\r\n *     optionArr: {\r\n *          id: string,\r\n *          label: string | HTMLElement\r\n *     }[],\r\n *     initialId?: string,\r\n *     onChange: function(id string): void,\r\n *     changeOnInit?: boolean, // trigger change on creation\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const Options = function(p) {\r\n    const div = BB.el({});\r\n\r\n    const wrapperEl = BB.el({\r\n        parent: div,\r\n        className: 'kl-option-wrapper',\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n\r\n    const optionArr: {\r\n        id: string;\r\n        el: HTMLElement;\r\n    }[] = [];\r\n    let selectedId = 'initialId' in p ? p.initialId : p.optionArr[0].id;\r\n\r\n    function createOption(o) {\r\n        const optionObj = {\r\n            id: o.id,\r\n            el: null,\r\n        };\r\n\r\n        const classArr = ['kl-option'];\r\n        if (p.isSmall) {\r\n            classArr.push('kl-option--small');\r\n        }\r\n        if (typeof o.label !== 'string') {\r\n            classArr.push('kl-option--custom-el');\r\n            BB.css(o.label, {\r\n                display: 'block',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n\r\n        optionObj.el = BB.el({\r\n            parent: wrapperEl,\r\n            content: o.label,\r\n            className: classArr.join(' '),\r\n            onClick: function() {\r\n                if (selectedId !== optionObj.id) {\r\n                    selectedId = optionObj.id;\r\n                    update();\r\n                    p.onChange(selectedId);\r\n                }\r\n            }\r\n        });\r\n\r\n        if (o.title) {\r\n            optionObj.el.title = o.title;\r\n        }\r\n\r\n        optionArr.push(optionObj);\r\n    }\r\n\r\n    function update() {\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            if (optionArr[i].id === selectedId) {\r\n                BB.addClassName(optionArr[i].el, 'kl-option-selected');\r\n            } else {\r\n                BB.removeClassName(optionArr[i].el, 'kl-option-selected');\r\n            }\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < p.optionArr.length; i++) {\r\n        createOption(p.optionArr[i]);\r\n    }\r\n\r\n    update();\r\n\r\n    if (p.changeOnInit) {\r\n        setTimeout(function() {\r\n            p.onChange(selectedId);\r\n        }, 0);\r\n    }\r\n\r\n    function getIndex() {\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            if (optionArr[i].id === selectedId) {\r\n                return i;\r\n            }\r\n        }\r\n    }\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.getValue = function() {\r\n        return selectedId;\r\n    }\r\n    this.next = function() {\r\n        selectedId = optionArr[(getIndex() + 1) % optionArr.length].id;\r\n        update();\r\n        p.onChange(selectedId);\r\n    };\r\n    this.previous = function() {\r\n        selectedId = optionArr[(optionArr.length + getIndex() - 1) % optionArr.length].id;\r\n        update();\r\n        p.onChange(selectedId);\r\n    };\r\n    this.destroy = () => {\r\n        optionArr.forEach(item => {\r\n            BB.destroyEl(item.el);\r\n        });\r\n        optionArr.splice(0, optionArr.length);\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport angleSvg from 'url:~/src/app/img/ui/angle.svg';\r\n\r\n\r\ntype TUiState = 'left' | 'right';\r\n\r\n/**\r\n * display little messages at the top of KlWorkspace\r\n */\r\nexport class StatusOverlay {\r\n\r\n    private el: HTMLDivElement;\r\n    private innerEl: HTMLDivElement;\r\n    private angleIm: HTMLImageElement;\r\n    private innerInnerEl: HTMLDivElement;\r\n    private isWide: boolean;\r\n    private uiState: TUiState;\r\n\r\n    private timeout: number;\r\n    private timeout2: number;\r\n    private timeout3: number;\r\n\r\n    private updateUiState() {\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n        setTimeout(()=>{}, 100);\r\n        if (this.uiState === 'left') {\r\n            this.el.style.left = '271px';\r\n        } else {\r\n            this.el.style.removeProperty('left');\r\n        }\r\n    }\r\n\r\n    private init() {\r\n        this.el = BB.el({\r\n            className: \"top-overlay g-root\",\r\n            onClick: BB.handleClick,\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n        }\r\n\r\n        this.updateUiState();\r\n\r\n        this.innerEl = BB.el({\r\n            className: 'top-overlay-inner',\r\n        }) as HTMLDivElement\r\n\r\n\r\n        this.angleIm = new Image();\r\n        this.angleIm.src = angleSvg;\r\n        BB.css(this.angleIm, {\r\n            verticalAlign: 'bottom',\r\n            width: '20px',\r\n            height: '20px',\r\n            marginLeft: '5px',\r\n            borderRadius: '10px'\r\n        });\r\n\r\n        this.innerInnerEl = document.createElement('div');\r\n        this.innerInnerEl.style.display = 'inline-block';\r\n\r\n        this.innerEl.appendChild(this.innerInnerEl);\r\n        this.innerEl.appendChild(this.angleIm);\r\n        this.el.appendChild(this.innerEl);\r\n        document.body.appendChild(this.el);\r\n        this.el.style.display = \"none\";\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        this.init();\r\n    }\r\n\r\n    setWide(b: boolean) {\r\n        this.isWide = !!b;\r\n\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n            this.el.style.left = '';\r\n        } else {\r\n            this.el.style.removeProperty('width');\r\n            this.el.style.left = this.uiState === 'left' ? '271px' : '';\r\n        }\r\n    }\r\n\r\n    setUiState(state: TUiState) {\r\n        this.uiState = state;\r\n        this.updateUiState();\r\n    }\r\n\r\n    out(msg: string | {type: 'transform', angleDeg: number, scale: number}, doPulse?: boolean) {\r\n\r\n        if (msg && typeof msg === 'object') {\r\n\r\n            if (msg.type === 'transform') {\r\n                this.angleIm.style.display = 'inline-block';\r\n                this.angleIm.style.transform = 'rotate(' + msg.angleDeg + 'deg)';\r\n\r\n                if (msg.angleDeg % 90 === 0) {\r\n                    this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255, 255, 255, 0.7)';\r\n                } else {\r\n                    this.angleIm.style.boxShadow = '';\r\n                }\r\n\r\n                this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + \"%\";\r\n\r\n\r\n            } else {\r\n                this.angleIm.style.display = 'none';\r\n            }\r\n\r\n\r\n\r\n        } else if (typeof msg === 'string') {\r\n            this.angleIm.style.display = 'none';\r\n            this.innerInnerEl.innerHTML = msg;\r\n        }\r\n\r\n        if (doPulse) {\r\n            this.innerEl.style.animation = '';\r\n            setTimeout(\r\n                () => this.innerEl.style.animation = 'top-overlay-pulse 0.5s ease-out',\r\n                20\r\n            );\r\n            if (this.timeout3) {\r\n                clearTimeout(this.timeout3);\r\n            }\r\n            this.timeout3 = window.setTimeout(\r\n                () => this.innerEl.style.animation = '',\r\n                520\r\n            );\r\n        }\r\n\r\n\r\n\r\n        if (this.timeout) {\r\n            clearTimeout(this.timeout);\r\n        }\r\n        if (this.timeout2) {\r\n            clearTimeout(this.timeout2);\r\n        }\r\n        this.el.style.animationName = doPulse ? 'consoleInFast' : \"consoleIn\";\r\n        this.el.style.opacity = \"1\";\r\n        this.timeout = window.setTimeout(() => {\r\n            this.el.style.opacity = \"0\";\r\n            this.el.style.animationName = \"consoleOut\";\r\n            this.timeout2 = window.setTimeout(() => {\r\n                this.el.style.display = \"none\";\r\n                this.timeout2 = 0;\r\n            }, 450);\r\n            this.timeout = 0;\r\n        }, 1200);\r\n        this.el.style.display = \"flex\";\r\n    }\r\n\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iQ1f0\");","import {BB} from '../../../bb/bb';\r\nimport {popup} from './popup';\r\n\r\nexport function exportDialog(parent, image) {\r\n    let boxSize, aboutCloseFunc, aboutDiv, closed, aniToggle, imageContainer, coverImage, coverSize,\r\n        text, holding, aniTimeout, halfBoxSize;\r\n    boxSize = 22 * 2;\r\n    halfBoxSize = 22;\r\n    aboutCloseFunc = function () {\r\n    };\r\n    closed = false;\r\n    aniToggle = false;\r\n    aboutDiv = document.createElement(\"div\");\r\n    BB.css(aboutDiv, {\r\n        width: (7 * boxSize) + \"px\"\r\n    });\r\n\r\n    imageContainer = document.createElement(\"div\");\r\n    coverImage = new Image();\r\n    coverImage.src = image.src;\r\n\r\n    imageContainer.appendChild(coverImage);\r\n    imageContainer.appendChild(image);\r\n\r\n    BB.css(imageContainer, {\r\n        width: (6 * boxSize) + \"px\",\r\n        height: (4 * boxSize) + \"px\",\r\n        marginTop: (boxSize / 2 - 1) + \"px\",\r\n        marginLeft: (boxSize / 2 - 1) + \"px\",\r\n        position: \"relative\",\r\n        overflow: \"hidden\",\r\n        boxShadow: \"0 0 10px 4px rgba(255,255,255, 0)\",\r\n        border: \"1px solid rgba(255, 255, 255, 1)\",\r\n        transition: \"box-shadow 0.7s linear\"\r\n    });\r\n    BB.css(image, {\r\n        position: \"absolute\",\r\n        left: '0',\r\n        top: '0',\r\n        width: (6 * boxSize) + \"px\",\r\n        height: (4 * boxSize) + \"px\",\r\n        opacity: '0'\r\n    });\r\n    coverSize = {\r\n        width: (6 * boxSize),\r\n        height: (6 * boxSize / image.width) * image.height\r\n    };\r\n    if (coverSize.height < (4 * boxSize)) {\r\n        coverSize.height = (4 * boxSize);\r\n        coverSize.width = (coverSize.height / image.height) * image.width;\r\n    }\r\n    BB.css(coverImage, {\r\n        position: \"absolute\",\r\n        top: (2 * boxSize) + \"px\",\r\n        left: (3 * boxSize) + \"px\",\r\n        width: coverSize.width + \"px\",\r\n        height: coverSize.height + \"px\",\r\n        marginLeft: (-coverSize.width / 2) + \"px\",\r\n        marginTop: (-coverSize.height / 2) + \"px\"\r\n    });\r\n\r\n    function animation() {\r\n        if (closed) {\r\n            return;\r\n        }\r\n        aniToggle = !aniToggle;\r\n        if (aniToggle) {\r\n            BB.css(imageContainer, {\r\n                border: \"1px solid rgba(0, 0, 0, 1)\"\r\n            });\r\n        } else {\r\n            BB.css(imageContainer, {\r\n                border: \"1px solid rgba(200, 200, 200, 1)\"\r\n            });\r\n        }\r\n        setTimeout(animation, 510);\r\n    }\r\n\r\n    animation();\r\n\r\n    text = document.createElement(\"div\");\r\n    text.innerHTML = \"Right-Click or Press-Hold on the image, then save.\";\r\n    text.ontouchstart = function () {\r\n        return false;\r\n    };\r\n    BB.css(text, {\r\n        fontSize: (boxSize / 2.5) + \"px\",\r\n        color: \"#666\",\r\n        padding: \"10px\",\r\n        textAlign: \"center\"\r\n    });\r\n\r\n    aboutDiv.appendChild(imageContainer);\r\n    aboutDiv.appendChild(text);\r\n\r\n    holding = false;\r\n    image.ontouchstart = function () {\r\n        BB.css(imageContainer, {\r\n            boxShadow: \"0 0 10px 8px rgba(0,255,255, 1)\"\r\n        });\r\n        holding = true;\r\n        aniTimeout = setTimeout(function () {\r\n            holding = false;\r\n            BB.css(imageContainer, {\r\n                boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\r\n            });\r\n        }, 1500);\r\n    };\r\n    image.ontouchmove = function () {\r\n        BB.css(imageContainer, {\r\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\r\n        });\r\n        holding = false;\r\n        clearTimeout(aniTimeout);\r\n    };\r\n    image.ontouchend = function () {\r\n        BB.css(imageContainer, {\r\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\r\n        });\r\n        holding = false;\r\n        clearTimeout(aniTimeout);\r\n    };\r\n\r\n    popup({\r\n        target: parent,\r\n        message: \"<b>Save Image</b>\",\r\n        div: aboutDiv,\r\n        buttons: [\"Close\"],\r\n        callback: function (result) {\r\n            closed = true;\r\n        }\r\n    });\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * element that lets you crop an image and copy it via right click\r\n *\r\n * param = {\r\n *     width: number,\r\n *     height: number,\r\n *     canvas: image | canvas,\r\n *     isNotCopy: boolean,\r\n *     onChange: function(width, height)\r\n * }\r\n *\r\n * @param param object\r\n * @constructor\r\n */\r\nexport function CropCopy(param) {\r\n    const div = document.createElement('div');\r\n    BB.css(div, {\r\n        position: 'relative',\r\n        height: param.height + 'px',\r\n        width: param.width + 'px',\r\n        overflow: 'hidden',\r\n        colorScheme: 'only light',\r\n    });\r\n    div.style.position = 'relative';\r\n\r\n    let crop;\r\n    function resetCrop() {\r\n        crop = {\r\n            x: 0,\r\n            y: 0,\r\n            width: param.canvas.width,\r\n            height: param.canvas.height\r\n        };\r\n    }\r\n    resetCrop();\r\n\r\n\r\n    function updateCroppedCanvas() {\r\n        croppedCanvas.width = Math.round(crop.width);\r\n        croppedCanvas.height = Math.round(crop.height);\r\n        let ctx = croppedCanvas.getContext('2d');\r\n        ctx.drawImage(param.canvas, Math.round(-crop.x), Math.round(-crop.y));\r\n        if (croppedImage) {\r\n            croppedImage.src = croppedCanvas.toDataURL('image/png');\r\n        }\r\n\r\n        if (param.onChange) {\r\n            param.onChange(croppedCanvas.width, croppedCanvas.height);\r\n        }\r\n    }\r\n    function updateSelectionRect() {\r\n        BB.css(selectionRect, {\r\n            left: (thumbX + crop.x * scaleW) + 'px',\r\n            top: (thumbY + crop.y * scaleH) + 'px',\r\n            width: (crop.width * scaleW) + 'px',\r\n            height: (crop.height * scaleH) + 'px'\r\n        });\r\n        if (param.onChange) {\r\n            param.onChange(Math.round(crop.width), Math.round(crop.height));\r\n        }\r\n    }\r\n    function isInsideSelectionRect(p) {\r\n        let rect = {\r\n            x: Math.round(thumbX + crop.x * scaleW),\r\n            y: Math.round(thumbY + crop.y * scaleH),\r\n            width: Math.round(crop.width * scaleW),\r\n            height: Math.round(crop.height * scaleH)\r\n        };\r\n        return rect.x <= p.x && p.x <= rect.x + rect.width &&\r\n            rect.y <= p.y && p.y <= rect.y + rect.height;\r\n    }\r\n\r\n    const croppedCanvas = BB.canvas();\r\n    let eventTarget = croppedCanvas;\r\n    let croppedImage = null;\r\n    if (!param.isNotCopy) { //navigator.appName === 'Microsoft Internet Explorer') { //i would prefer not using an image\r\n        croppedImage = new Image();\r\n        eventTarget = croppedImage;\r\n    }\r\n    BB.css(eventTarget, {\r\n        height: param.height + 'px',\r\n        width: param.width + 'px'\r\n    });\r\n    div.appendChild(eventTarget);\r\n    updateCroppedCanvas();\r\n\r\n    const padding = 20;\r\n    const previewWrapper = BB.el({\r\n        css: {\r\n            width: param.width + 'px',\r\n            height: param.height + 'px',\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            pointerEvents: 'none'\r\n        }\r\n    });\r\n    div.appendChild(previewWrapper);\r\n    BB.createCheckerDataUrl(4, function(v) {\r\n        previewWrapper.style.backgroundImage = 'url('+v+')';\r\n    });\r\n\r\n    const thumbSize = BB.fitInto(param.canvas.width, param.canvas.height, param.width - padding * 2, param.height - padding * 2, 1);\r\n    const thumbCanvas = BB.canvas(Math.round(thumbSize.width), Math.round(thumbSize.height));\r\n    thumbCanvas.style.imageRendering = 'pixelated';\r\n    const scaleW = thumbCanvas.width / param.canvas.width;\r\n    const scaleH = thumbCanvas.height / param.canvas.height;\r\n    const thumbCtx = thumbCanvas.getContext('2d');\r\n    thumbCtx.imageSmoothingEnabled = false;\r\n    thumbCtx.drawImage(param.canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);\r\n    previewWrapper.appendChild(thumbCanvas);\r\n    const thumbX = parseInt('' + ((param.width - thumbCanvas.width) / 2));\r\n    const thumbY = parseInt('' + ((param.height - thumbCanvas.height) / 2));\r\n    BB.css(thumbCanvas, {\r\n        position: 'absolute',\r\n        left: thumbX + \"px\",\r\n        top: thumbY + \"px\"\r\n    });\r\n\r\n    const selectionRect = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            boxShadow: '0 0 0 1px #fff, 0 0 0 2px #000, 0 0 40px 1px #000',\r\n        }\r\n    });\r\n    previewWrapper.appendChild(selectionRect);\r\n    updateSelectionRect();\r\n\r\n\r\n    function toOriginalSpace(p) {\r\n        return {\r\n            x: BB.clamp((p.x - thumbX) / scaleW, 0, param.canvas.width),\r\n            y: BB.clamp((p.y - thumbY) / scaleH, 0, param.canvas.height),\r\n        };\r\n    }\r\n    //gen crop from thumb-space points\r\n    function genCrop(p1, p2) {\r\n        let topLeftP = {\r\n            x: Math.min(p1.x, p2.x),\r\n            y: Math.min(p1.y, p2.y)\r\n        };\r\n        let bottomRightP = {\r\n            x: Math.max(p1.x, p2.x),\r\n            y: Math.max(p1.y, p2.y)\r\n        };\r\n        let origTopLeftP = toOriginalSpace(topLeftP);\r\n        let origBottomRightP = toOriginalSpace(bottomRightP);\r\n        origTopLeftP.x = Math.floor(origTopLeftP.x);\r\n        origTopLeftP.y = Math.floor(origTopLeftP.y);\r\n        origBottomRightP.x = Math.ceil(origBottomRightP.x);\r\n        origBottomRightP.y = Math.ceil(origBottomRightP.y);\r\n        return {\r\n            x: origTopLeftP.x,\r\n            y: origTopLeftP.y,\r\n            width: origBottomRightP.x - origTopLeftP.x,\r\n            height: origBottomRightP.y - origTopLeftP.y\r\n        };\r\n    }\r\n\r\n    function isReset() {\r\n        return crop.x === 0 && crop.y === 0 && crop.width === param.canvas.width && crop.height === param.canvas.height;\r\n    }\r\n\r\n    let startP;\r\n    let startCrop = null;\r\n    let isDragging = false;\r\n    let didMove = false;\r\n    let updateCropTimeout;\r\n    const pointerListener = new BB.PointerListener({\r\n        target: eventTarget,\r\n        fixScribble: true,\r\n        onPointer: function(event) {\r\n            let fullPos;\r\n            if (event.type === 'pointerdown' && event.button === 'left') {\r\n                event.eventPreventDefault();\r\n                isDragging = true;\r\n                startP = {\r\n                    x: event.relX,\r\n                    y: event.relY\r\n                };\r\n                if (!isReset() && isInsideSelectionRect(startP)) {\r\n                    startCrop = {\r\n                        x: crop.x,\r\n                        y: crop.y,\r\n                        width: crop.width,\r\n                        height: crop.height\r\n                    };\r\n                } else {\r\n                    crop = genCrop(startP, startP);\r\n                }\r\n            } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                event.eventPreventDefault();\r\n                didMove = true;\r\n                if (startCrop) {\r\n                    crop.x = startCrop.x + Math.round((event.relX - startP.x) / scaleW);\r\n                    crop.y = startCrop.y + Math.round((event.relY - startP.y) / scaleH);\r\n                    crop.x = BB.clamp(crop.x, 0, param.canvas.width - crop.width);\r\n                    crop.y = BB.clamp(crop.y, 0, param.canvas.height - crop.height);\r\n                } else {\r\n                    crop = genCrop(startP, {x: event.relX, y: event.relY});\r\n                }\r\n                updateSelectionRect();\r\n            } else if (event.type === 'pointerup' && startP) {\r\n                event.eventPreventDefault();\r\n                isDragging = false;\r\n                startCrop = null;\r\n                startP = null;\r\n                if (crop.width === 0 || crop.height === 0 || !didMove) {\r\n                    resetCrop();\r\n                    updateSelectionRect();\r\n                }\r\n                didMove = false;\r\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e, comboStr) {\r\n            if (isDragging) {\r\n                return;\r\n            }\r\n            let doUpdate = false;\r\n\r\n            let stepSize = Math.max(1, 1 / scaleW);\r\n            let shiftIsPressed = keyListener.isPressed('shift');\r\n\r\n            if (keyStr === 'left') {\r\n                if (shiftIsPressed) {\r\n                    crop.width = BB.clamp(crop.width - stepSize, 1, param.canvas.width - crop.x);\r\n                } else {\r\n                    crop.x = BB.clamp(crop.x - stepSize, 0, param.canvas.width - crop.width);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n            if (keyStr === 'right') {\r\n                if (shiftIsPressed) {\r\n                    crop.width = BB.clamp(crop.width + stepSize, 1, param.canvas.width - crop.x);\r\n                } else {\r\n                    crop.x = BB.clamp(crop.x + stepSize, 0, param.canvas.width - crop.width);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n            if (keyStr === 'up') {\r\n                if (shiftIsPressed) {\r\n                    crop.height = BB.clamp(crop.height - stepSize, 1, param.canvas.height - crop.y);\r\n                } else {\r\n                    crop.y = BB.clamp(crop.y - stepSize, 0, param.canvas.height - crop.height);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n            if (keyStr === 'down') {\r\n                if (shiftIsPressed) {\r\n                    crop.height = BB.clamp(crop.height + stepSize, 1, param.canvas.height - crop.y);\r\n                } else {\r\n                    crop.y = BB.clamp(crop.y + stepSize, 0, param.canvas.height - crop.height);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n\r\n            if (doUpdate) {\r\n                e.preventDefault();\r\n                updateSelectionRect();\r\n                clearTimeout(updateCropTimeout);\r\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 100);\r\n            }\r\n        }\r\n    });\r\n\r\n    this.getEl = function() {\r\n        return div;\r\n    };\r\n    this.reset = function() {\r\n        resetCrop();\r\n        updateCroppedCanvas();\r\n        updateSelectionRect();\r\n    };\r\n    this.destroy = function() {\r\n        eventTarget.style.removeProperty('width');\r\n        eventTarget.style.removeProperty('height');\r\n        keyListener.destroy();\r\n        pointerListener.destroy();\r\n    };\r\n    this.isReset = function() {\r\n        return isReset();\r\n    };\r\n    this.getRect = function() {\r\n        return JSON.parse(JSON.stringify(crop));\r\n    };\r\n    this.getCroppedImage = function() {\r\n        return croppedCanvas;\r\n    };\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {popup} from './popup';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/// <reference path=\"./types.d.ts\" />\r\n\r\n/**\r\n *\r\n * @param parent\r\n * @param fullCanvas\r\n * @param cropCallback\r\n * @param output - BB.Output\r\n * @param showCrop - boolean - show crop button\r\n */\r\nexport function clipboardDialog(parent, fullCanvas, cropCallback, output, showCrop) {\r\n    const div = document.createElement(\"div\");\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n\r\n    let topWrapper = BB.el({\r\n        content: LANG('crop-drag-to-crop'),\r\n        css: {\r\n            textAlign: 'center'\r\n        }\r\n    });\r\n    div.appendChild(topWrapper);\r\n\r\n\r\n    let cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 350,\r\n        canvas: fullCanvas\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n        borderTop: '1px solid #bbb',\r\n        borderBottom: '1px solid #bbb'\r\n    });\r\n    div.appendChild(cropCopy.getEl());\r\n\r\n    function toClipboard() {\r\n        const imgURL = cropCopy.getCroppedImage().toDataURL('image/png');\r\n        setTimeout(async function() {\r\n            try {\r\n                const data = await fetch(imgURL);\r\n                const blob = await data.blob();\r\n                await (navigator.clipboard as any).write([\r\n                    new ClipboardItem({\r\n                        [blob.type]: blob\r\n                    } as any) // todo check is possible?\r\n                ]);\r\n                setTimeout(function() {\r\n                    output.out(LANG('cropcopy-copied'), true);\r\n                }, 200);\r\n            } catch (err) {\r\n                console.error(err.name, err.message);\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, KeyEvent, comboStr) {\r\n            if (comboStr === 'ctrl+c') {\r\n                toClipboard();\r\n                closefunc();\r\n            }\r\n        }\r\n    });\r\n\r\n    let closefunc;\r\n    function blur() {\r\n        closefunc();\r\n    }\r\n    BB.addEventListener(window, \"blur\", blur);\r\n    popup({\r\n        target: parent,\r\n        message: '<b>' + (showCrop ? `${LANG('cropcopy-title-copy')} / ${LANG('cropcopy-title-crop')}` : `${LANG('cropcopy-title-copy')}`) + '</b>',\r\n        div: div,\r\n        style: isSmall ? {} : {\r\n            width: \"500px\"\r\n        },\r\n        buttons: showCrop ? [LANG('cropcopy-btn-copy'), LANG('cropcopy-btn-crop'), 'Cancel'] : [LANG('cropcopy-btn-copy'), 'Cancel'],\r\n        primaries: [LANG('cropcopy-btn-copy')],\r\n        callback: function (result) {\r\n            if (result === LANG('cropcopy-btn-copy')) {\r\n                toClipboard();\r\n            } else if (result === LANG('cropcopy-btn-crop')) {\r\n                let rectObj = cropCopy.getRect();\r\n                cropCallback({\r\n                    left: Math.round(-rectObj.x),\r\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\r\n                    top: Math.round(-rectObj.y),\r\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height)\r\n                });\r\n            }\r\n            BB.removeEventListener(window, \"blur\", blur);\r\n            cropCopy.destroy();\r\n            keyListener.destroy();\r\n        },\r\n        clickOnEnter: LANG('cropcopy-btn-copy'),\r\n        closefunc: function (func) {\r\n            closefunc = func;\r\n        }\r\n    });\r\n}","import {BB} from '../../../bb/bb';\r\nimport {popup} from '../modals/popup';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {Options} from '../base-components/options';\r\nimport {Select} from '../base-components/select';\r\nimport {PointSlider} from '../base-components/point-slider';\r\n// @ts-ignore\r\nimport addLayerImg from 'url:~/src/app/img/ui/add-layer.svg';\r\n// @ts-ignore\r\nimport duplicateLayerImg from 'url:~/src/app/img/ui/duplicate-layer.svg';\r\n// @ts-ignore\r\nimport mergeLayerImg from 'url:~/src/app/img/ui/merge-layers.svg';\r\n// @ts-ignore\r\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\r\n// @ts-ignore\r\nimport renameLayerImg from 'url:~/src/app/img/ui/rename-layer.svg';\r\nimport {KlCanvas, MAX_LAYERS} from '../../canvas/kl-canvas';\r\nimport {IMixMode} from '../../kl.types';\r\nimport {LANG} from '../../../language/language';\r\nimport {translateBlending} from '../../canvas/translate-blending';\r\n\r\n\r\nexport function klLayerManager(p_canvas: KlCanvas, p_func, p_rootDiv) {\r\n    let klCanvas: KlCanvas = p_canvas;\r\n    let layerElArr = [];\r\n    let layerHeight = 35;\r\n    let layerSpacing = 0;\r\n    let width = 250;\r\n    let oldHistoryState;\r\n    let updatefunc = p_func;\r\n    let uiState = 'right'; // 'left | 'right'\r\n\r\n\r\n    let largeThumbDiv = BB.el({\r\n        onClick: BB.handleClick,\r\n        css: {\r\n            position: \"absolute\",\r\n            right: \"280px\",\r\n            top: \"500px\",\r\n            background: \"#aaa\",\r\n            boxShadow: \"1px 1px 3px rgba(0,0,0,0.3)\",\r\n            pointerEvents: \"none\",\r\n            padding: '0',\r\n            border: \"1px solid #aaa\",\r\n            transition: \"opacity 0.3s ease-out\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    BB.createCheckerDataUrl(4, function(url) {\r\n        largeThumbDiv.style.backgroundImage = \"url(\" + url + \")\";\r\n    });\r\n    let largeThumbCanvas = BB.canvas(200, 200);\r\n    largeThumbCanvas.style.display = \"block\";\r\n    largeThumbDiv.appendChild(largeThumbCanvas);\r\n    let largeThumbTimeout, largeThumbInTimeout;\r\n    let largeThumbInDocument = false;\r\n\r\n\r\n    let klCanvasLayerArr = klCanvas.getLayers();\r\n    let selectedSpotIndex = klCanvasLayerArr.length - 1;\r\n    let div = document.createElement(\"div\");\r\n    div.style.marginRight = \"10px\";\r\n    div.style.marginBottom = \"10px\";\r\n    div.style.marginLeft = \"10px\";\r\n    div.style.marginTop = \"10px\";\r\n    div.style.cursor = \"default\";\r\n\r\n    let listdiv = document.createElement(\"div\");\r\n    BB.css(listdiv, {\r\n        width: width + \"px\",\r\n        position: \"relative\"\r\n\r\n    });\r\n\r\n\r\n    function renameLayer(layer) {\r\n        let div = document.createElement('div');\r\n\r\n        let label = BB.el({\r\n            content: LANG('layers-rename-name') + ':',\r\n            css: {\r\n                marginRight: '5px'\r\n            }\r\n        });\r\n\r\n        const row = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n        let input = document.createElement('input');\r\n        input.value = klCanvas.getLayer(layer).name;\r\n        input.setAttribute('data-ignore-focus', 'true');\r\n        const clearBtn = BB.el({\r\n            tagName: 'Button',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/>',\r\n            title: LANG('layers-rename-clear'),\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: () => {\r\n                input.value = '';\r\n                input.focus();\r\n            }\r\n        });\r\n        const suggestions = [\r\n            LANG('layers-rename-sketch'),\r\n            LANG('layers-rename-colors'),\r\n            LANG('layers-rename-lines'),\r\n            LANG('background'),\r\n            LANG('layers-rename-foreground'),\r\n        ];\r\n        const suggestionBtns = [];\r\n        const row2 = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginTop: '5px',\r\n                marginLeft: '-5px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        suggestions.forEach(item => {\r\n            const btn = BB.el({\r\n                parent: row2,\r\n                tagName: 'Button',\r\n                content: item,\r\n                onClick: () => {\r\n                    input.value = btn.textContent;\r\n                },\r\n                css: {\r\n                    margin: '5px 0 0 5px',\r\n                }\r\n            });\r\n            suggestionBtns.push(btn);\r\n        });\r\n\r\n        div.appendChild(label);\r\n        label.append(row, row2);\r\n        row.append(input, clearBtn);\r\n\r\n        setTimeout(function() {\r\n            input.focus();\r\n            input.select();\r\n        }, 10);\r\n\r\n        popup({\r\n            target: p_rootDiv,\r\n            message: `<b>${LANG('layers-rename-title')}</b>`,\r\n            div: div,\r\n            buttons: [LANG('layers-rename'), 'Cancel'],\r\n            primaries: [LANG('layers-rename')],\r\n            callback: function (val) {\r\n                BB.destroyEl(clearBtn);\r\n                suggestionBtns.forEach(item => {\r\n                    BB.destroyEl(item);\r\n                });\r\n                suggestionBtns.splice(0, suggestionBtns.length);\r\n                if (val === LANG('layers-rename')) {\r\n                    if (input.value === klCanvas.getLayer(layer).name) {\r\n                        return;\r\n                    }\r\n                    klCanvas.renameLayer(layer, input.value);\r\n                    createLayerList();\r\n                    klHistory.pause(true);\r\n                    updatefunc(layer);\r\n                    klHistory.pause(false);\r\n                }\r\n            },\r\n            clickOnEnter: LANG('layers-rename')\r\n        });\r\n    }\r\n\r\n\r\n    let layerListEl = BB.el({});\r\n\r\n    (div as any).disableButtons = function(){}; //probably remove\r\n    (div as any).enableButtons = function(){}; //probably remove\r\n    let addnewBtn = document.createElement(\"button\");\r\n    let duplicateBtn = document.createElement(\"button\");\r\n    let mergeBtn = document.createElement(\"button\");\r\n    let removeBtn = document.createElement(\"button\");\r\n    let renameBtn = document.createElement(\"button\");\r\n\r\n    function createButtons() {\r\n        let div = document.createElement(\"div\");\r\n        function async() {\r\n            BB.makeUnfocusable(addnewBtn);\r\n            BB.makeUnfocusable(duplicateBtn);\r\n            BB.makeUnfocusable(mergeBtn);\r\n            BB.makeUnfocusable(removeBtn);\r\n            BB.makeUnfocusable(renameBtn);\r\n\r\n            addnewBtn.style.cssFloat = 'left';\r\n            duplicateBtn.style.cssFloat = 'left';\r\n            mergeBtn.style.cssFloat = 'left';\r\n            removeBtn.style.cssFloat = 'left';\r\n            renameBtn.style.cssFloat = 'left';\r\n\r\n            addnewBtn.title = LANG('layers-new');\r\n            duplicateBtn.title = LANG('layers-duplicate');\r\n            removeBtn.title = LANG('layers-remove');\r\n            mergeBtn.title = LANG('layers-merge');\r\n            renameBtn.title = LANG('layers-rename-title');\r\n\r\n            addnewBtn.style.paddingLeft = \"5px\";\r\n            addnewBtn.style.paddingRight = \"3px\";\r\n\r\n            removeBtn.style.paddingLeft = \"5px\";\r\n            removeBtn.style.paddingRight = \"3px\";\r\n\r\n            duplicateBtn.style.paddingLeft = \"5px\";\r\n            duplicateBtn.style.paddingRight = \"3px\";\r\n\r\n            mergeBtn.style.paddingLeft = \"5px\";\r\n            mergeBtn.style.paddingRight = \"3px\";\r\n\r\n            renameBtn.style.height = \"30px\";\r\n            renameBtn.style.lineHeight = \"20px\";\r\n\r\n            addnewBtn.innerHTML = \"<img src='\" + addLayerImg + \"' height='20'/>\";\r\n            duplicateBtn.innerHTML = \"<img src='\" + duplicateLayerImg + \"' height='20'/>\";\r\n            mergeBtn.innerHTML = \"<img src='\" + mergeLayerImg + \"' height='20'/>\";\r\n            removeBtn.innerHTML = \"<img src='\" + removeLayerImg + \"' height='20'/>\";\r\n            renameBtn.innerHTML = \"<img src='\" + renameLayerImg + \"' height='20'/>\";\r\n            addnewBtn.style.marginRight = \"5px\";\r\n            removeBtn.style.marginRight = \"5px\";\r\n            duplicateBtn.style.marginRight = \"5px\";\r\n            mergeBtn.style.marginRight = \"5px\";\r\n            div.appendChild(addnewBtn);\r\n            div.appendChild(removeBtn);\r\n            div.appendChild(duplicateBtn);\r\n            div.appendChild(mergeBtn);\r\n            div.appendChild(renameBtn);\r\n            div.appendChild(BB.el({\r\n                css: {\r\n                    clear: 'both'\r\n                }\r\n            }));\r\n\r\n            let clearboth = document.createElement(\"div\");\r\n            clearboth.style.clear = \"both\";\r\n            clearboth.style.height = \"10px\";\r\n            div.appendChild(clearboth);\r\n\r\n\r\n            addnewBtn.onclick = function () {\r\n                if (klCanvas.addLayer(selectedSpotIndex) === false) {\r\n                    return;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n\r\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n                    addnewBtn.disabled = true;\r\n                    duplicateBtn.disabled = true;\r\n                }\r\n                removeBtn.disabled = false;\r\n                selectedSpotIndex = selectedSpotIndex + 1;\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n            };\r\n            duplicateBtn.onclick = function () {\r\n                if (klCanvas.duplicateLayer(selectedSpotIndex) === false) {\r\n                    return;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n                    addnewBtn.disabled = true;\r\n                    duplicateBtn.disabled = true;\r\n                }\r\n                removeBtn.disabled = false;\r\n                selectedSpotIndex++;\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n            };\r\n            removeBtn.onclick = function () {\r\n                if (layerElArr.length <= 1) {\r\n                    return;\r\n                }\r\n\r\n                klCanvas.removeLayer(selectedSpotIndex);\r\n                if (selectedSpotIndex > 0) {\r\n                    selectedSpotIndex--;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n                if (klCanvasLayerArr.length === 1) {\r\n                    removeBtn.disabled = true;\r\n                }\r\n                if (klCanvasLayerArr.length < MAX_LAYERS) {\r\n                    addnewBtn.disabled = false;\r\n                    duplicateBtn.disabled = false;\r\n                }\r\n            };\r\n            mergeBtn.onclick = function () {\r\n                if (selectedSpotIndex <= 0) {\r\n                    return;\r\n                }\r\n\r\n                function mergeDialog(p) {\r\n                    let div = document.createElement(\"div\");\r\n                    div.innerHTML = LANG('layers-merge-description');\r\n\r\n                    let options = new Options({\r\n                        optionArr: [\r\n                            {id: p.mixModeStr, label: translateBlending(p.mixModeStr)},\r\n                            {id: 'source-in', label: 'source-in'},\r\n                            {id: 'source-out', label: 'source-out'},\r\n                            {id: 'source-atop', label: 'source-atop'},\r\n                            {id: 'destination-in', label: 'destination-in'},\r\n                            {id: 'destination-out', label: 'destination-out'},\r\n                            {id: 'destination-atop', label: 'destination-atop'},\r\n                            {id: 'xor', label: 'xor'}\r\n                        ],\r\n                        initId: p.mixModeStr,\r\n                        onChange: function(id) {\r\n                            update();\r\n                        },\r\n                        isSmall: true\r\n                    });\r\n                    options.getElement().style.marginTop = '5px';\r\n                    div.appendChild(options.getElement());\r\n\r\n                    const thumbDimensions = BB.fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\r\n                    let preview = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n                    preview.title = LANG('preview');\r\n                    let spacer = document.createElement(\"div\");\r\n                    spacer.innerHTML = \"<br/>\";\r\n                    spacer.style.clear = \"both\";\r\n                    div.appendChild(spacer);\r\n                    div.appendChild(preview);\r\n                    BB.css(preview, {\r\n                        display: \"block\",\r\n                        marginLeft: \"auto\",\r\n                        marginRight: \"auto\",\r\n                        colorScheme: 'only light',\r\n                    });\r\n                    preview.style.boxShadow = \"0 0 3px rgba(0,0,0,0.5)\";\r\n                    BB.createCheckerDataUrl(4, function(url) {\r\n                        preview.style.backgroundImage = \"url(\" + url + \")\";\r\n                    });\r\n\r\n                    let alphaCanvas = BB.copyCanvas(preview);\r\n                    alphaCanvas.getContext(\"2d\").drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\r\n                    BB.convertToAlphaChannelCanvas(alphaCanvas);\r\n\r\n                    function update() {\r\n                        let ctx = preview.getContext(\"2d\");\r\n                        ctx.save();\r\n                        ctx.clearRect(0, 0, preview.width, preview.height);\r\n                        if (preview.width > p.topCanvas.width) {\r\n                            ctx.imageSmoothingEnabled = false;\r\n                        }\r\n                        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\r\n\r\n                        if (options.getValue() === 'as-alpha') {\r\n                            ctx.globalCompositeOperation = 'destination-in';\r\n                            ctx.globalAlpha = p.topOpacity;\r\n                            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\r\n                        } else {\r\n                            ctx.globalCompositeOperation = options.getValue();\r\n                            ctx.globalAlpha = p.topOpacity;\r\n                            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\r\n                        }\r\n                        ctx.restore();\r\n                    }\r\n\r\n                    update();\r\n\r\n\r\n                    let keyListener = new BB.KeyListener({\r\n                        onDown: function(keyStr) {\r\n                            if (keyStr === 'right') {\r\n                                options.next();\r\n                            }\r\n                            if (keyStr === 'left') {\r\n                                options.previous();\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    popup({\r\n                        target: p_rootDiv,\r\n                        message: `<b>${LANG('layers-merge-modal-title')}</b>`,\r\n                        div: div,\r\n                        buttons: [\"Ok\", \"Cancel\"],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: function (val) {\r\n                            keyListener.destroy();\r\n                            options.destroy();\r\n                            if (val === \"Ok\") {\r\n                                p.callback(options.getValue());\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                mergeDialog({\r\n                    topCanvas: klCanvasLayerArr[selectedSpotIndex].context.canvas,\r\n                    bottomCanvas: klCanvasLayerArr[selectedSpotIndex - 1].context.canvas,\r\n                    topOpacity: klCanvas.getLayer(selectedSpotIndex).opacity,\r\n                    mixModeStr: klCanvasLayerArr[selectedSpotIndex].mixModeStr,\r\n                    callback: function (mode) {\r\n                        klCanvas.mergeLayers(selectedSpotIndex, selectedSpotIndex - 1, mode);\r\n                        klCanvasLayerArr = klCanvas.getLayers();\r\n                        selectedSpotIndex--;\r\n                        if (klCanvasLayerArr.length === 1) {\r\n                            removeBtn.disabled = true;\r\n                        }\r\n                        if (klCanvasLayerArr.length < MAX_LAYERS) {\r\n                            addnewBtn.disabled = false;\r\n                            duplicateBtn.disabled = false;\r\n                        }\r\n                        createLayerList();\r\n                        klHistory.pause(true);\r\n                        updatefunc(selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                });\r\n            };\r\n\r\n            renameBtn.onclick = function () {\r\n                renameLayer(selectedSpotIndex);\r\n            };\r\n        }\r\n        setTimeout(async, 1);\r\n        return div;\r\n    }\r\n    div.appendChild(createButtons());\r\n\r\n    let modeWrapper;\r\n    let modeSelect;\r\n    {\r\n        modeWrapper = BB.el({\r\n            content: LANG('layers-blending') + '&nbsp;',\r\n            css: {\r\n                fontSize: '15px'\r\n            }\r\n        });\r\n\r\n        modeSelect = new Select({\r\n            optionArr: [\r\n                'source-over',\r\n                null,\r\n                'darken',\r\n                'multiply',\r\n                'color-burn',\r\n                null,\r\n                'lighten',\r\n                'screen',\r\n                'color-dodge',\r\n                null,\r\n                'overlay',\r\n                'soft-light',\r\n                'hard-light',\r\n                null,\r\n                'difference',\r\n                'exclusion',\r\n                null,\r\n                'hue',\r\n                'saturation',\r\n                'color',\r\n                'luminosity',\r\n            ].map((item: IMixMode) => {\r\n                return item ? [item, translateBlending(item)] : null;\r\n            }),\r\n            onChange: function(val) {\r\n                klCanvas.setMixMode(selectedSpotIndex, val as IMixMode);\r\n                (div as any).update(selectedSpotIndex);\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n\r\n        modeWrapper.appendChild(modeSelect.getElement());\r\n        div.appendChild(modeWrapper);\r\n\r\n    }\r\n\r\n\r\n    function createLayerList() {\r\n        oldHistoryState = klHistory.getState();\r\n        function createLayerEntry(index) {\r\n            let layerName = klCanvas.getLayer(index).name;\r\n            let opacity = klCanvasLayerArr[index].opacity;\r\n            let layercanvas = klCanvasLayerArr[index].context.canvas;\r\n\r\n            let layer = document.createElement(\"div\");\r\n            layer.className = \"layerBox\";\r\n            layerElArr[index] = layer;\r\n            (layer as any).posY = ((klCanvasLayerArr.length - 1) * 35 - index * 35);\r\n            BB.css(layer, {\r\n                width: \"250px\",\r\n                height: \"34px\",\r\n                backgroundColor: \"rgb( 220, 220, 220)\",\r\n                border: \"1px solid #aaa\",\r\n                position: \"absolute\",\r\n                left: \"0 px\",\r\n                top: (layer as any).posY + \"px\",\r\n                transition: \"all 0.1s linear\",\r\n                borderRadius: \"5px\",\r\n                boxSizing: 'border-box'\r\n            });\r\n            let innerLayer = document.createElement(\"div\");\r\n            BB.css(innerLayer, {\r\n                position: \"relative\"\r\n            });\r\n\r\n            let container1 = document.createElement(\"div\");\r\n            BB.css(container1, {\r\n                width: \"250px\",\r\n                height: \"34px\"\r\n            });\r\n            let container2 = document.createElement(\"div\");\r\n            layer.appendChild(innerLayer);\r\n            innerLayer.appendChild(container1);\r\n            innerLayer.appendChild(container2);\r\n\r\n            (layer as any).spot = index;\r\n\r\n            //thumb\r\n            {\r\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\r\n                let thumb = (layer as any).thumb = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n\r\n                let thc = thumb.getContext(\"2d\");\r\n                thc.save();\r\n                if (thumb.width > layercanvas.width) {\r\n                    thc.imageSmoothingEnabled = false;\r\n                }\r\n                thc.drawImage(layercanvas, 0, 0, thumb.width, thumb.height);\r\n                thc.restore();\r\n                BB.css((layer as any).thumb, {\r\n                    position: \"absolute\",\r\n                    left: ((32 - (layer as any).thumb.width) / 2) + \"px\",\r\n                    top: ((32 - (layer as any).thumb.height) / 2) + \"px\",\r\n                    colorScheme: 'only light',\r\n                });\r\n                BB.createCheckerDataUrl(4, function(url) {\r\n                    thumb.style.backgroundImage = \"url(\" + url + \")\";\r\n                });\r\n            }\r\n\r\n            //layerlabel\r\n            {\r\n                (layer as any).label = document.createElement(\"div\");\r\n                (layer as any).lname = layerName;\r\n                (layer as any).label.append((layer as any).lname);\r\n\r\n                BB.css((layer as any).label, {\r\n                    position: \"absolute\",\r\n                    left: (1 + 32 + 5) + \"px\",\r\n                    top: 1 + \"px\",\r\n                    fontSize: \"13px\",\r\n                    width: \"170px\",\r\n                    height: \"20px\",\r\n                    overflow: \"hidden\",\r\n                    color: \"#666\",\r\n                    whiteSpace: 'nowrap'\r\n                });\r\n\r\n                (layer as any).label.ondblclick = function() {\r\n                    renameLayer((layer as any).spot);\r\n                };\r\n            }\r\n            //layerlabel\r\n            {\r\n                (layer as any).opacityLabel = document.createElement(\"div\");\r\n                (layer as any).opacity = opacity;\r\n                (layer as any).opacityLabel.append(parseInt('' + ((layer as any).opacity * 100)) + \"%\");\r\n\r\n                BB.css((layer as any).opacityLabel, {\r\n                    position: \"absolute\",\r\n                    left: (250 - 1 - 5 - 50) + \"px\",\r\n                    top: 1 + \"px\",\r\n                    fontSize: \"13px\",\r\n                    textAlign: \"right\",\r\n                    width: \"50px\",\r\n                    color: \"#666\",\r\n                    transition: \"color 0.2s ease-in-out\"\r\n                });\r\n            }\r\n\r\n            let oldOpacity;\r\n            let opacitySlider = new PointSlider({\r\n                init: (layer as any).opacity,\r\n                width: 204,\r\n                pointSize: 14,\r\n                callback: function(sliderValue, isFirst, isLast) {\r\n                    if (isFirst) {\r\n                        oldOpacity = klCanvas.getLayer((layer as any).spot).opacity;\r\n                        klHistory.pause(true);\r\n                        return;\r\n                    }\r\n                    if (isLast) {\r\n                        klHistory.pause(false);\r\n                        if (oldOpacity !== sliderValue) {\r\n                            klCanvas.layerOpacity((layer as any).spot, sliderValue);\r\n                        }\r\n                        return;\r\n                    }\r\n                    (layer as any).opacityLabel.innerHTML = Math.round(sliderValue * 100) + \"%\";\r\n                    klCanvas.layerOpacity((layer as any).spot, sliderValue);\r\n                }\r\n            });\r\n            BB.css(opacitySlider.getEl(), {\r\n                position: 'absolute',\r\n                left: '39px',\r\n                top: '17px'\r\n            });\r\n            (layer as any).opacitySlider = opacitySlider;\r\n\r\n            //larger layer preview - hover\r\n            BB.setEventListener((layer as any).thumb, 'onpointerover', function (e) {\r\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== 'touch')) { //shouldn't show while dragging\r\n                    return;\r\n                }\r\n\r\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\r\n\r\n                if (largeThumbCanvas.width !== thumbDimensions.width || largeThumbCanvas.height !== thumbDimensions.height) {\r\n                    largeThumbCanvas.width = thumbDimensions.width;\r\n                    largeThumbCanvas.height = thumbDimensions.height;\r\n                }\r\n                let ctx = largeThumbCanvas.getContext(\"2d\");\r\n                ctx.save();\r\n                if (largeThumbCanvas.width > layercanvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.imageSmoothingQuality = 'high';\r\n                ctx.clearRect(0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\r\n                ctx.drawImage(layercanvas, 0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\r\n                ctx.restore();\r\n                BB.css(largeThumbDiv, {\r\n                    top: (e.clientY - largeThumbCanvas.height / 2) + \"px\",\r\n                    opacity: '0'\r\n                });\r\n                if (largeThumbInDocument === false) {\r\n                    document.body.appendChild(largeThumbDiv);\r\n                    largeThumbInDocument = true;\r\n                }\r\n                clearTimeout(largeThumbInTimeout);\r\n                largeThumbInTimeout = setTimeout(function () {\r\n                    BB.css(largeThumbDiv, {\r\n                        opacity: '1'\r\n                    });\r\n                }, 20);\r\n                clearTimeout(largeThumbTimeout);\r\n            });\r\n            BB.setEventListener((layer as any).thumb, 'onpointerout', function () {\r\n                clearTimeout(largeThumbInTimeout);\r\n                BB.css(largeThumbDiv, {\r\n                    opacity: '0'\r\n                });\r\n                clearTimeout(largeThumbTimeout);\r\n                largeThumbTimeout = setTimeout(function () {\r\n                    if (!largeThumbInDocument) {\r\n                        return;\r\n                    }\r\n                    document.body.removeChild(largeThumbDiv);\r\n                    largeThumbInDocument = false;\r\n                }, 300);\r\n            });\r\n\r\n            container1.appendChild((layer as any).thumb);\r\n            container1.appendChild((layer as any).label);\r\n            container1.appendChild((layer as any).opacityLabel);\r\n            container1.appendChild(opacitySlider.getEl());\r\n            let dragstart = false;\r\n            let freshSelection = false;\r\n\r\n            //events for moving layers up and down\r\n            function dragEventHandler(event) {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    BB.css(layer, {\r\n                        transition: \"box-shadow 0.3s ease-in-out\"\r\n                    });\r\n                    //dragContainer.appendChild(layer);\r\n                    layer.style.zIndex = '1';\r\n                    lastpos = (layer as any).spot;\r\n                    freshSelection = false;\r\n                    if (!(layer as any).isSelected) {\r\n                        freshSelection = true;\r\n                        (div as any).activateLayer((layer as any).spot);\r\n                    }\r\n                    dragstart = true;\r\n\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    if (dragstart) {\r\n                        dragstart = false;\r\n                        BB.css(layer, {\r\n                            boxShadow: \"1px 3px 5px rgba(0,0,0,0.4)\"\r\n                        });\r\n                    }\r\n                    (layer as any).posY += event.dY;\r\n                    let corrected = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\r\n                    layer.style.top = corrected + \"px\";\r\n                    updateLayersVerticalPosition((layer as any).spot, posToSpot((layer as any).posY));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(layer, {\r\n                        transition: \"all 0.1s linear\"\r\n                    });\r\n                    setTimeout(function () {\r\n                        BB.css(layer, {\r\n                            boxShadow: \"\"\r\n                        });\r\n                    }, 20);\r\n                    (layer as any).posY = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\r\n                    //regularContainer.appendChild(layer);\r\n                    layer.style.zIndex = \"\";\r\n                    let newSpot = posToSpot((layer as any).posY);\r\n                    let oldSpot = (layer as any).spot;\r\n                    move((layer as any).spot, newSpot);\r\n                    if (oldSpot != newSpot) {\r\n                        klHistory.pause(true);\r\n                        updatefunc(selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                    if (oldSpot === newSpot && freshSelection) {\r\n                        updatefunc(selectedSpotIndex);\r\n                    }\r\n                    freshSelection = false;\r\n                }\r\n            }\r\n\r\n            (layer as any).pointerListener = new BB.PointerListener({\r\n                target: container1,\r\n                maxPointers: 1,\r\n                onPointer: dragEventHandler\r\n            });\r\n\r\n            layerListEl.appendChild(layer);\r\n        }\r\n        layerElArr = [];\r\n        while (layerListEl.firstChild) {\r\n            let child = layerListEl.firstChild;\r\n            (child as any).pointerListener.destroy();\r\n            (child as any).opacitySlider.destroy();\r\n            layerListEl.removeChild(child);\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            createLayerEntry(i);\r\n        }\r\n        (div as any).activateLayer(selectedSpotIndex);\r\n        updateHeight();\r\n    }\r\n\r\n\r\n    listdiv.appendChild(layerListEl);\r\n    div.appendChild(listdiv);\r\n\r\n\r\n    function posToSpot(p) {\r\n        let result = parseInt('' + ((p) / (layerHeight + layerSpacing) + 0.5));\r\n        result = Math.min(klCanvasLayerArr.length - 1, Math.max(0, result));\r\n        result = klCanvasLayerArr.length - result - 1;\r\n        return result;\r\n    }\r\n\r\n    let lastpos = 0;\r\n\r\n    //update css position of all layers that are not being dragged, while dragging\r\n    function updateLayersVerticalPosition(id, newspot) {\r\n        newspot = Math.min(klCanvasLayerArr.length - 1, Math.max(0, newspot));\r\n        if (newspot === lastpos) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            if (layerElArr[i].spot === id) { // <- here\r\n                continue;\r\n            }\r\n            let posy = layerElArr[i].spot;\r\n            if (layerElArr[i].spot > id) {\r\n                posy--;\r\n            }\r\n            if (posy >= newspot) {\r\n                posy++;\r\n            }\r\n            layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\r\n            layerElArr[i].style.top = layerElArr[i].posY + \"px\";\r\n        }\r\n        lastpos = newspot;\r\n    }\r\n\r\n    function move(oldSpotIndex, newSpotIndex) {\r\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) {\r\n            throw 'layermanager - invalid move';\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            (function (i) {\r\n                let posy = layerElArr[i].spot; // <- here\r\n                if (layerElArr[i].spot === oldSpotIndex) {\r\n                    posy = newSpotIndex;\r\n                } else {\r\n                    if (layerElArr[i].spot > oldSpotIndex)\r\n                        posy--;\r\n                    if (posy >= newSpotIndex)\r\n                        posy++;\r\n                }\r\n                layerElArr[i].spot = posy;\r\n                layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\r\n                layerElArr[i].style.top = layerElArr[i].posY + \"px\";\r\n            }(i));\r\n        }\r\n        if (oldSpotIndex === newSpotIndex) {\r\n            return;\r\n        }\r\n        klCanvas.moveLayer(selectedSpotIndex, newSpotIndex - oldSpotIndex);\r\n        klCanvasLayerArr = klCanvas.getLayers();\r\n        selectedSpotIndex = newSpotIndex;\r\n        mergeBtn.disabled = selectedSpotIndex === 0;\r\n    }\r\n\r\n\r\n    //updating the thumbs in interval\r\n    //don't update when: manager not visible || layer didn't change || is drawing\r\n    let updateThumbsInterval = setInterval(function() {\r\n        if (div.style.display !== \"block\") {\r\n            return;\r\n        }\r\n\r\n        let historyState = klHistory.getState();\r\n        if (historyState === oldHistoryState) {\r\n            return;\r\n        }\r\n        oldHistoryState = historyState;\r\n\r\n        for (let i = 0; i < layerElArr.length; i++) {\r\n            if (selectedSpotIndex === layerElArr[i].spot && klCanvasLayerArr[layerElArr[i].spot]) { // second check, because might be out of date\r\n                let ctx = layerElArr[i].thumb.getContext(\"2d\");\r\n                ctx.save();\r\n                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n                if (klCanvasLayerArr[layerElArr[i].spot].context.canvas.width < layerElArr[i].thumb.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.drawImage(klCanvasLayerArr[layerElArr[i].spot].context.canvas, 0, 0, layerElArr[i].thumb.width, layerElArr[i].thumb.height);\r\n                ctx.restore();\r\n            }\r\n        }\r\n\r\n    }, 1);\r\n\r\n    function updateHeight() {\r\n        layerListEl.style.height = (layerElArr.length * 35) + 'px';\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    (div as any).update = function (activeLayerSpotIndex) {\r\n        klCanvasLayerArr = klCanvas.getLayers();\r\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) {\r\n            selectedSpotIndex = activeLayerSpotIndex;\r\n        }\r\n        removeBtn.disabled = klCanvasLayerArr.length === 1;\r\n        if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n            addnewBtn.disabled = true;\r\n            duplicateBtn.disabled = true;\r\n        } else {\r\n            addnewBtn.disabled = false;\r\n            duplicateBtn.disabled = false;\r\n        }\r\n        setTimeout(function() {\r\n            createLayerList();\r\n        }, 1);\r\n    };\r\n    (div as any).getSelected = function () {\r\n        return selectedSpotIndex;\r\n    };\r\n    (div as any).activateLayer = function (spotIndex) {\r\n        if (spotIndex < 0 || spotIndex > layerElArr.length - 1) {\r\n            throw 'invalid spotIndex ' + spotIndex + ', layerElArr.length ' + layerElArr.length;\r\n        }\r\n        selectedSpotIndex = spotIndex;\r\n        modeSelect.setValue(klCanvasLayerArr[selectedSpotIndex].mixModeStr);\r\n        for (let i = 0; i < layerElArr.length; i++) {\r\n            if (selectedSpotIndex === layerElArr[i].spot) {\r\n                layerElArr[i].style.backgroundColor = \"rgb( 250, 250, 250)\";\r\n                layerElArr[i].label.style.color = \"#000\";\r\n                layerElArr[i].style.boxShadow = \"\";\r\n                layerElArr[i].style.border = \"1px solid var(--active-highlight-color)\";\r\n                layerElArr[i].opacitySlider.setActive(true);\r\n                layerElArr[i].isSelected = true;\r\n            } else {\r\n                layerElArr[i].style.backgroundColor = \"rgb( 220, 220, 220)\";\r\n                layerElArr[i].label.style.color = \"#666\";\r\n                layerElArr[i].style.boxShadow = \"\";\r\n                layerElArr[i].style.border = \"1px solid rgb(158, 158, 158)\";\r\n                layerElArr[i].opacitySlider.setActive(false);\r\n                layerElArr[i].isSelected = false;\r\n            }\r\n        }\r\n        mergeBtn.disabled = selectedSpotIndex === 0;\r\n    };\r\n    (div as any).setUiState = function(stateStr) {\r\n        uiState = '' + stateStr;\r\n\r\n        if (uiState === 'left') {\r\n            BB.css(largeThumbDiv, {\r\n                left: '280px',\r\n                right: ''\r\n            });\r\n        } else {\r\n            BB.css(largeThumbDiv, {\r\n                left: '',\r\n                right: '280px'\r\n            });\r\n        }\r\n    };\r\n\r\n    createLayerList();\r\n\r\n    return div;\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1mb1v\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"11KJK\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"floUo\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kino6\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hhQeq\");","import {BB} from '../../bb/bb';\r\nimport {floodFillBits} from '../image-operations/flood-fill';\r\nimport {drawShape} from '../image-operations/shape-tool';\r\nimport {IRenderTextParam, renderText} from '../image-operations/render-text';\r\nimport {IKlProject, IMixMode, IRGB, IShapeToolObject} from '../kl.types';\r\nimport {DecoyKlHistory, KlHistoryInterface} from '../history/kl-history';\r\nimport {drawProject} from './draw-project';\r\nimport {LANG} from '../../language/language';\r\n\r\n\r\nconst allowedMixModes = [\r\n    'source-over',\r\n    'darken',\r\n    'multiply',\r\n    'color-burn',\r\n    'lighten',\r\n    'screen',\r\n    'color-dodge',\r\n    'overlay',\r\n    'soft-light',\r\n    'hard-light',\r\n    'difference',\r\n    'exclusion',\r\n    'hue',\r\n    'saturation',\r\n    'color',\r\n    'luminosity',\r\n];\r\n\r\nexport const MAX_LAYERS = 16;\r\n\r\ninterface KlCanvasLayer extends HTMLCanvasElement {\r\n    name: string;\r\n    mixModeStr: IMixMode;\r\n    opacity: number;\r\n    compositeObj?: {\r\n        draw: (ctx: CanvasRenderingContext2D) => void;\r\n    },\r\n    index: number; // certain brushes need to know\r\n}\r\n\r\n/**\r\n * The image/canvas that the user paints on\r\n * Has layers. layers have names and opacity.\r\n *\r\n * Interacts with the history you specify (for undo/redo)\r\n */\r\nexport class KlCanvas {\r\n\r\n    // todo changeListener consistent concept\r\n    // todo history interaction, consistent concept - currently have to look at code to know if something pushes on history\r\n\r\n    private width: number;\r\n    private height: number;\r\n    private layerCanvasArr: KlCanvasLayer[];\r\n    private pickCanvas: HTMLCanvasElement; // canvas to draw into for color picker\r\n    private history: KlHistoryInterface;\r\n    private changeListenerArr:  (() => void)[]; // subscribers get notified when opacity changes\r\n\r\n\r\n    private init (w: number, h: number): void {\r\n        if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            throw new Error('init - invalid canvas size: ' + w + ', ' + h);\r\n        }\r\n        this.width = w;\r\n        this.height = h;\r\n    }\r\n\r\n    private emitChange (): void {\r\n        // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\r\n        this.changeListenerArr.forEach(item => item());\r\n    }\r\n\r\n    private updateIndices (): void {\r\n        this.layerCanvasArr.forEach((item, index) => {\r\n            item.index = index;\r\n        });\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        params: {\r\n            projectObj: {\r\n                width: number;\r\n                height: number;\r\n                layers: {\r\n                    name: string;\r\n                    opacity: number;\r\n                    image: HTMLImageElement | HTMLCanvasElement; // already loaded!\r\n                }[];\r\n            }\r\n        } | {\r\n            // creates blank KlCanvas, 0 layers\r\n            width: number;\r\n            height: number;\r\n        } | {\r\n            copy: KlCanvas;\r\n        },\r\n        private layerNrOffset: number = 0,\r\n    ) {\r\n        this.layerCanvasArr = [];\r\n        this.pickCanvas = BB.canvas(1, 1);\r\n        this.history = new DecoyKlHistory();\r\n        if ('copy' in params) {\r\n            this.width = 1;\r\n            this.height = 1;\r\n        } else {\r\n            if ('width' in params && 'height' in params) {\r\n                this.width = params.width;\r\n                this.height = params.height;\r\n            } else {\r\n                this.width = 1;\r\n                this.height = 1;\r\n            }\r\n        }\r\n        this.init(this.width, this.height);\r\n\r\n        this.changeListenerArr = [];\r\n\r\n        if ('copy' in params) {\r\n            try {\r\n                this.copy(params.copy);\r\n            } catch (e) {\r\n                this.destroy();\r\n                throw e;\r\n            }\r\n        } else if ('projectObj' in params) {\r\n            const origLayers = [].concat(params.projectObj.layers);\r\n            this.init(params.projectObj.width, params.projectObj.height);\r\n\r\n            if (!origLayers.length) {\r\n                throw new Error('project.layers needs at least 1 layer');\r\n            }\r\n\r\n            for (let i = 0; i < origLayers.length; i++) {\r\n                if (origLayers[i].mixModeStr && !allowedMixModes.includes(origLayers[i].mixModeStr)) {\r\n                    throw new Error('unknown mixModeStr ' + origLayers[i].mixModeStr);\r\n                }\r\n\r\n                this.addLayer();\r\n                this.layerOpacity(i, origLayers[i].opacity);\r\n                this.layerCanvasArr[i].name = origLayers[i].name;\r\n                this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr ? origLayers[i].mixModeStr : 'source-over';\r\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    /**\r\n     * Resets canvas -> 1 layer, 100% opacity,\r\n     * unless layers provided.\r\n     * @param p\r\n     */\r\n    reset (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n            color?: IRGB; // optional - fill color\r\n            image?: HTMLImageElement | HTMLCanvasElement; // image drawn on layer\r\n            layerName?: string; // if via image\r\n            layers?: {\r\n                name: string;\r\n                opacity: number;\r\n                mixModeStr: IMixMode;\r\n                image: HTMLCanvasElement;\r\n            }[];\r\n        }\r\n    ): void | number {\r\n        if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height) ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        this.history.pause(true);\r\n\r\n        this.width = p.width;\r\n        this.height = p.height;\r\n\r\n        this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\r\n\r\n        if (p.layers) {\r\n            for (let i = 0; i < p.layers.length; i++) {\r\n                let item = p.layers[i];\r\n                if (!this.layerCanvasArr[i]) {\r\n                    this.addLayer();\r\n                }\r\n                this.layerCanvasArr[i].name = item.name;\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n                this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : 'source-over';\r\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(item.image, 0, 0);\r\n                this.layerOpacity(i, item.opacity);\r\n            }\r\n        } else {\r\n            this.layerCanvasArr[0].name = p.layerName ? p.layerName : LANG('layers-layer') + \" 1\";\r\n            this.layerCanvasArr[0].width = this.width;\r\n            this.layerCanvasArr[0].height = this.height;\r\n            this.layerCanvasArr[0].mixModeStr = 'source-over';\r\n            this.layerOpacity(0, 1);\r\n            if (p.color) {\r\n                this.layerFill(0, p.color);\r\n            } else if (p.image) {\r\n                this.layerCanvasArr[0].getContext(\"2d\").drawImage(p.image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n\r\n        this.history.pause(false);\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"reset\",\r\n            params: [p] // dont screw with p\r\n        });\r\n\r\n        return this.layerCanvasArr.length - 1;\r\n    }\r\n\r\n    isLayerLimitReached (): boolean {\r\n        return this.layerCanvasArr.length >= MAX_LAYERS;\r\n    }\r\n\r\n    getWidth (): number {\r\n        return this.width;\r\n    }\r\n\r\n    getHeight (): number {\r\n        return this.height;\r\n    }\r\n\r\n    copy (toCopyCanvas: KlCanvas): void {\r\n        if (\r\n            toCopyCanvas.getWidth() < 1 ||\r\n            toCopyCanvas.getHeight() < 1 ||\r\n            isNaN(toCopyCanvas.getWidth()) ||\r\n            isNaN(toCopyCanvas.getHeight())\r\n        ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        // keep existing canvases\r\n\r\n        let origLayers = toCopyCanvas.getLayers();\r\n\r\n        while (this.layerCanvasArr.length > origLayers.length) {\r\n            this.removeLayer(this.layerCanvasArr.length - 1);\r\n        }\r\n\r\n        if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) {\r\n            this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\r\n        }\r\n        for (let i = 0; i < origLayers.length; i++) {\r\n            if (i >= this.layerCanvasArr.length) {\r\n                this.addLayer();\r\n            } else {\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n            }\r\n            this.layerOpacity(i, origLayers[i].opacity);\r\n            this.layerCanvasArr[i].name = origLayers[i].name;\r\n            this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].context.canvas, 0, 0);\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    getLayerCount (): number {\r\n        return this.layerCanvasArr.length;\r\n    }\r\n\r\n    resize (w: number, h: number, algorithm: 'smooth' | 'pixelated' = 'smooth'): boolean {\r\n        if (!w || !h || (w === this.width && h === this.height) || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            return false;\r\n        }\r\n        w = Math.max(w, 1);\r\n        h = Math.max(h, 1);\r\n\r\n        let tmp1, tmp2;\r\n\r\n        if (algorithm === 'pixelated') {\r\n            tmp1 = BB.canvas(w, h);\r\n            let tmp1Ctx = tmp1.getContext('2d');\r\n            tmp1Ctx.imageSmoothingEnabled = false;\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                if (i > 0) {\r\n                    tmp1Ctx.clearRect(0, 0, w, h);\r\n                }\r\n                let layerCanvas = this.layerCanvasArr[i];\r\n                tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\r\n                layerCanvas.width = w;\r\n                layerCanvas.height = h;\r\n                let layerContext = layerCanvas.getContext('2d');\r\n                layerContext.drawImage(tmp1, 0, 0);\r\n            }\r\n\r\n        } else if (algorithm === 'smooth') {\r\n            tmp1 = BB.canvas();\r\n            tmp2 = BB.canvas();\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                BB.resizeCanvas(this.layerCanvasArr[i], w, h, tmp1, tmp2);\r\n            }\r\n        } else {\r\n            throw new Error('unknown resize algorithm');\r\n        }\r\n\r\n        this.width = w;\r\n        this.height = h;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * crop / extend\r\n     * @param p\r\n     */\r\n    resizeCanvas (p: {\r\n        left: number;\r\n        top: number;\r\n        right: number;\r\n        bottom: number;\r\n        fillColor?: IRGB\r\n    }): void {\r\n\r\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\r\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\r\n        const offX = Math.round(p.left);\r\n        const offY = Math.round(p.top);\r\n\r\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) {\r\n            throw new Error('KlCanvas.resizeCanvas - invalid canvas size');\r\n        }\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            const ctemp = BB.canvas(this.width, this.height);\r\n            let layerCanvas = this.layerCanvasArr[i];\r\n            let layerCtx = this.layerCanvasArr[i].getContext(\"2d\");\r\n            ctemp.getContext(\"2d\").drawImage(layerCanvas, 0, 0);\r\n\r\n            this.layerCanvasArr[i].width = newW;\r\n            this.layerCanvasArr[i].height = newH;\r\n\r\n            layerCtx.save();\r\n            if (i === 0 && p.fillColor) {\r\n                layerCtx.fillStyle = BB.ColorConverter.toRgbStr(p.fillColor);\r\n                layerCtx.fillRect(0, 0, newW, newH);\r\n                layerCtx.clearRect(offX, offY, this.width, this.height);\r\n            }\r\n            layerCtx.drawImage(ctemp, offX, offY);\r\n            layerCtx.restore();\r\n        }\r\n        this.width = newW;\r\n        this.height = newH;\r\n    }\r\n\r\n    /**\r\n     * will be inserted on top of selected\r\n     * @param selected\r\n     */\r\n    addLayer (selected?: number): false | number {\r\n        if (this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        let canvas = BB.canvas(this.width, this.height);\r\n        if (!canvas.getContext('2d')) {\r\n            throw new Error('kl-create-canvas-error');\r\n        }\r\n\r\n        (canvas as any).mixModeStr = 'source-over';\r\n\r\n        if (selected === undefined) {\r\n            this.layerCanvasArr[this.layerCanvasArr.length] = canvas as any;\r\n            selected = Math.max(0, this.layerCanvasArr.length - 1);\r\n        } else {\r\n            this.layerCanvasArr.splice(selected + 1, 0, canvas as any);\r\n            selected++;\r\n        }\r\n\r\n        (canvas as any).name = LANG('layers-layer') + \" \" + (this.layerCanvasArr.length + this.layerNrOffset);\r\n        this.history.pause(true);\r\n        this.layerOpacity(selected, 1);\r\n        this.history.pause(false);\r\n        this.updateIndices();\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"addLayer\",\r\n            params: [selected - 1]\r\n        });\r\n        return selected;\r\n    }\r\n\r\n    duplicateLayer (i: number): false | number {\r\n        if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        let canvas = BB.canvas(this.width, this.height);\r\n        this.layerCanvasArr.splice(i + 1, 0, canvas as any);\r\n\r\n        (canvas as any).name = this.layerCanvasArr[i].name + \" \" + LANG('layers-copy');\r\n        (canvas as any).mixModeStr = this.layerCanvasArr[i].mixModeStr;\r\n        canvas.getContext(\"2d\").drawImage(this.layerCanvasArr[i], 0, 0);\r\n        this.history.pause(true);\r\n        this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\r\n        this.history.pause(false);\r\n\r\n        this.updateIndices();\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"duplicateLayer\",\r\n            params: [i]\r\n        });\r\n        return i + 1;\r\n    }\r\n\r\n    getLayerContext (i: number, doReturnNull?: boolean): CanvasRenderingContext2D | null {\r\n        if (this.layerCanvasArr[i]) {\r\n            return this.layerCanvasArr[i].getContext(\"2d\");\r\n        }\r\n        if (doReturnNull) {\r\n            return null;\r\n        }\r\n        throw new Error(\"layer of index \" + i + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n    }\r\n\r\n    removeLayer (i: number): false | number {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr.splice(i, 1);\r\n            this.updateIndices();\r\n        } else {\r\n            return false;\r\n        }\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"removeLayer\",\r\n            params: [i]\r\n        });\r\n\r\n        return Math.max(0, i - 1);\r\n    }\r\n\r\n    renameLayer (i: number, name: string): boolean {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr[i].name = name;\r\n        } else {\r\n            return false;\r\n        }\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"renameLayer\",\r\n            params: [i, name]\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n    layerOpacity (i: number, o: number): void {\r\n        if (!this.layerCanvasArr[i]) {\r\n            return;\r\n        }\r\n        o = Math.max(0, Math.min(1, o));\r\n        this.layerCanvasArr[i].opacity = o;\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"layerOpacity\",\r\n            params: [i, o]\r\n        });\r\n\r\n        this.emitChange();\r\n    }\r\n\r\n    moveLayer (i: number, d: number): void | number {\r\n        if (d === 0) {\r\n            return;\r\n        }\r\n        if (this.layerCanvasArr[i]) {\r\n            const temp = this.layerCanvasArr[i];\r\n            this.layerCanvasArr.splice(i, 1);\r\n            const targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\r\n            this.layerCanvasArr.splice(targetIndex, 0, temp);\r\n            this.updateIndices();\r\n            this.history.push({\r\n                tool: [\"canvas\"],\r\n                action: \"moveLayer\",\r\n                params: [i, d]\r\n            });\r\n            return targetIndex;\r\n        }\r\n    }\r\n\r\n    mergeLayers (layerBottomIndex: number, layerTopIndex: number, mixModeStr: IMixMode | 'as-alpha'): void | number {\r\n        if (\r\n            !this.layerCanvasArr[layerBottomIndex] ||\r\n            !this.layerCanvasArr[layerTopIndex] ||\r\n            layerBottomIndex === layerTopIndex\r\n        ) {\r\n            return;\r\n        }\r\n        //order messed up\r\n        if (layerBottomIndex > layerTopIndex) {\r\n            let temp = layerBottomIndex;\r\n            layerBottomIndex = layerTopIndex;\r\n            layerTopIndex = temp;\r\n        }\r\n\r\n        let topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\r\n        if (topOpacity !== 0 && topOpacity) {\r\n            let ctx = this.layerCanvasArr[layerBottomIndex].getContext(\"2d\");\r\n            ctx.save();\r\n\r\n            if (mixModeStr === 'as-alpha') { // todo remove this?\r\n\r\n                BB.convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\r\n                ctx.globalCompositeOperation = 'destination-in';\r\n                ctx.globalAlpha = topOpacity;\r\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            } else {\r\n\r\n                if (mixModeStr) {\r\n                    ctx.globalCompositeOperation = mixModeStr;\r\n                }\r\n                ctx.globalAlpha = topOpacity;\r\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            }\r\n\r\n            ctx.restore();\r\n\r\n            // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n            // TODO remove if chrome updated\r\n            if (mixModeStr) {\r\n                ctx.save();\r\n                ctx.fillStyle = \"rgba(0,0,0,0.01)\";\r\n                ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n                ctx.restore();\r\n            }\r\n        }\r\n        this.updateIndices();\r\n        this.history.pause(true);\r\n        this.removeLayer(layerTopIndex);\r\n        this.history.pause(false);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"mergeLayers\",\r\n            params: [layerBottomIndex, layerTopIndex, mixModeStr]\r\n        });\r\n\r\n        return layerBottomIndex;\r\n    }\r\n\r\n    rotate (deg: number): void {\r\n        while (deg < 0) {\r\n            deg += 360;\r\n        }\r\n        deg %= 360;\r\n        if (deg % 90 != 0 || deg === 0)\r\n            return;\r\n        let temp = BB.canvas();\r\n        if (deg === 0 || deg === 180) {\r\n            temp.width = this.width;\r\n            temp.height = this.height;\r\n        } else if (deg === 90 || deg === 270) {\r\n            temp.width = this.height;\r\n            temp.height = this.width;\r\n        }\r\n        let ctx = temp.getContext(\"2d\");\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.clearRect(0, 0, temp.width, temp.height);\r\n            ctx.save();\r\n            ctx.translate(temp.width / 2, temp.height / 2);\r\n            ctx.rotate(deg * Math.PI / 180);\r\n            if (deg === 180) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            } else if (deg === 90 || deg === 270) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\r\n            }\r\n            this.layerCanvasArr[i].width = temp.width;\r\n            this.layerCanvasArr[i].height = temp.height;\r\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\r\n            ctx.restore();\r\n        }\r\n        this.width = temp.width;\r\n        this.height = temp.height;\r\n    }\r\n\r\n    flip (isHorizontal: boolean, isVertical: boolean, layerIndex: number): void {\r\n        if (!isHorizontal && !isVertical) {\r\n            return;\r\n        }\r\n\r\n        let temp = BB.canvas(this.width, this.height);\r\n        temp.width = this.width;\r\n        temp.height = this.height;\r\n        let tempCtx = temp.getContext(\"2d\");\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n\r\n            if ( (layerIndex || layerIndex === 0) && i !== layerIndex) {\r\n                continue;\r\n            }\r\n\r\n            tempCtx.save();\r\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\r\n            tempCtx.translate(temp.width / 2, temp.height / 2);\r\n            tempCtx.scale((isHorizontal ? -1 : 1), (isVertical ? -1 : 1));\r\n            tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            tempCtx.restore();\r\n\r\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\r\n        }\r\n    }\r\n\r\n    layerFill (layerIndex: number, colorObj: IRGB, compositeOperation?: string): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.save();\r\n        if (compositeOperation) {\r\n            ctx.globalCompositeOperation = compositeOperation as GlobalCompositeOperation;\r\n        }\r\n        ctx.fillStyle = \"rgba(\" + colorObj.r + \",\" + colorObj.g + \",\" + colorObj.b + \",1)\";\r\n        ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n        // TODO remove if chrome updated\r\n        ctx.save();\r\n        ctx.fillStyle = \"rgba(0,0,0,0.01)\";\r\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n        ctx.restore();\r\n\r\n        /*if (!document.getElementById('testocanvas')) {\r\n            layerCanvasArr[layerIndex].id = 'testocanvas';\r\n            document.body.appendChild(layerCanvasArr[layerIndex]);\r\n            BB.css(layerCanvasArr[layerIndex], {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }\r\n        if (!document.getElementById('testocanvas')) {\r\n            let c = document.createElement('canvas');\r\n            c.width = 1000;\r\n            c.height = 1000;\r\n            let ctx2 = c.getContext('2d');\r\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\r\n            c.id = 'testocanvas';\r\n            document.body.appendChild(c);\r\n            BB.css(c, {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }*/\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"layerFill\",\r\n            params: [layerIndex, colorObj, compositeOperation]\r\n        });\r\n    }\r\n\r\n    floodFill (\r\n        layerIndex: number, // index of layer to be filled\r\n        x: number, // starting point\r\n        y: number,\r\n        rgb: IRGB, // fill color\r\n        opacity: number,\r\n        tolerance: number,\r\n        sampleStr: 'current' | 'all' | 'above',\r\n        grow: number, // int >= 0 - radius around filled area that is to be filled too\r\n        isContiguous: boolean,\r\n    ): void {\r\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) {\r\n            return;\r\n        }\r\n        tolerance = Math.round(tolerance);\r\n\r\n        if (!(['above', 'current', 'all'].includes(sampleStr))) {\r\n            throw new Error('invalid sampleStr');\r\n        }\r\n\r\n        let result;\r\n\r\n        let srcCtx;\r\n        let srcImageData;\r\n        let srcData;\r\n\r\n        let targetCtx;\r\n        let targetImageData;\r\n        let targetData;\r\n\r\n\r\n        if (sampleStr === 'all') {\r\n\r\n            let srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\r\n            srcCtx = srcCanvas.getContext('2d');\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            srcCanvas = null;\r\n            srcCtx = null;\r\n            srcImageData = null;\r\n            srcData = null;\r\n\r\n            targetCtx = this.layerCanvasArr[layerIndex].getContext('2d');\r\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        } else {\r\n            let srcIndex = sampleStr === 'above' ? layerIndex + 1 : layerIndex;\r\n\r\n            if (srcIndex >= this.layerCanvasArr.length) {\r\n                return;\r\n            }\r\n\r\n            srcCtx = this.layerCanvasArr[srcIndex].getContext('2d');\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            if (layerIndex !== srcIndex) {\r\n                srcCtx = null;\r\n                srcImageData = null;\r\n                srcData = null;\r\n            }\r\n\r\n            targetCtx = layerIndex === srcIndex ? srcCtx : this.layerCanvasArr[layerIndex].getContext('2d');\r\n            targetImageData = layerIndex === srcIndex ? srcImageData : targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        }\r\n\r\n        targetData = targetImageData.data;\r\n        if (opacity === 1) {\r\n            for (let i = 0; i < this.width * this.height; i++) {\r\n                if (result.data[i] === 255) {\r\n                    targetData[i * 4] = rgb.r;\r\n                    targetData[i * 4 + 1] = rgb.g;\r\n                    targetData[i * 4 + 2] = rgb.b;\r\n                    targetData[i * 4 + 3] = 255;\r\n                }\r\n            }\r\n        } else {\r\n            for (let i = 0; i < this.width * this.height; i++) {\r\n                if (result.data[i] === 255) {\r\n                    targetData[i * 4] = BB.mix(targetData[i * 4], rgb.r, opacity);\r\n                    targetData[i * 4 + 1] = BB.mix(targetData[i * 4 + 1], rgb.g, opacity);\r\n                    targetData[i * 4 + 2] = BB.mix(targetData[i * 4 + 2], rgb.b, opacity);\r\n                    targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 255, opacity);\r\n                }\r\n            }\r\n        }\r\n        targetCtx.putImageData(targetImageData, 0, 0);\r\n\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [layerIndex, targetImageData]\r\n        });\r\n    }\r\n\r\n    /**\r\n     * draw shape via BB.drawShape\r\n     * @param layerIndex\r\n     * @param shapeObj\r\n     */\r\n    drawShape (layerIndex: number, shapeObj: IShapeToolObject): void {\r\n        drawShape(this.layerCanvasArr[layerIndex].getContext(\"2d\"), shapeObj);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"drawShape\",\r\n            params: [layerIndex, BB.copyObj(shapeObj)],\r\n        });\r\n    }\r\n\r\n    text (layerIndex: number, p: IRenderTextParam): void {\r\n        renderText(this.layerCanvasArr[layerIndex], BB.copyObj(p));\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"text\",\r\n            params: [layerIndex, BB.copyObj(p)],\r\n        });\r\n    }\r\n\r\n    replaceLayer (layerIndex: number, imageData: ImageData): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.putImageData(imageData, 0, 0);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [layerIndex, imageData],\r\n        });\r\n    }\r\n\r\n    clearLayer (layerIndex: number): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"clearLayer\",\r\n            params: [layerIndex]\r\n        });\r\n    }\r\n\r\n    getLayers (): {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                context: item.getContext(\"2d\"),\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayersFast (): {\r\n        canvas: KlCanvasLayer;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                canvas: item,\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayerIndex (canvasObj: HTMLCanvasElement, doReturnNull?: boolean): null | number {\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            if (this.layerCanvasArr[i] === canvasObj) {\r\n                return i;\r\n            }\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error(\"layer not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getLayer (index: number, doReturnNull?: boolean): null | {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        id: number;\r\n    } {\r\n        if (this.layerCanvasArr[index]) {\r\n            return {\r\n                context: this.layerCanvasArr[index].getContext(\"2d\"),\r\n                opacity: this.layerCanvasArr[index].opacity,\r\n                name: this.layerCanvasArr[index].name,\r\n                id: index,\r\n            };\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error(\"layer of index \" + index + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getColorAt (x: number, y: number): IRGB {\r\n        x = Math.floor(x);\r\n        y = Math.floor(y);\r\n        let ctx = this.pickCanvas.getContext(\"2d\");\r\n        ctx.save();\r\n        ctx.imageSmoothingEnabled = false;\r\n        ctx.clearRect(0, 0, 1, 1);\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.globalAlpha = this.layerCanvasArr[i].opacity;\r\n            ctx.globalCompositeOperation = this.layerCanvasArr[i].mixModeStr;\r\n            ctx.drawImage(this.layerCanvasArr[i], -x, -y);\r\n        }\r\n        ctx.restore();\r\n        let imData = ctx.getImageData(0, 0, 1, 1);\r\n        return new BB.RGB(imData.data[0], imData.data[1], imData.data[2]);\r\n    }\r\n\r\n    getCompleteCanvas (factor: number): HTMLCanvasElement {\r\n        return drawProject(this.getProject(), factor);\r\n    }\r\n\r\n    getProject (): IKlProject {\r\n        return {\r\n            width: this.width,\r\n            height: this.height,\r\n            layers: this.layerCanvasArr.map(layer => {\r\n                return {\r\n                    name: layer.name,\r\n                    opacity: layer.opacity,\r\n                    mixModeStr: layer.mixModeStr,\r\n                    image: layer,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    addChangeListener (func: () => void): void {\r\n        if (this.changeListenerArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.changeListenerArr.push(func);\r\n    }\r\n\r\n    removeChangeListener (func: () => void): void {\r\n        for (let i = 0; i < this.changeListenerArr.length; i++) {\r\n            if (this.changeListenerArr[i] === func) {\r\n                this.changeListenerArr.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    setMixMode (layerIndex: number, mixModeStr: IMixMode): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"setMixMode\",\r\n            params: [layerIndex, '' + mixModeStr],\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Set composite drawing step for KlCanvasWorkspace.\r\n     * To apply temporary manipulations to a layer.\r\n     *\r\n     * @param layerIndex\r\n     * @param compositeObj\r\n     */\r\n    setComposite (\r\n        layerIndex: number,\r\n        compositeObj: null | {\r\n            draw: (ctx: CanvasRenderingContext2D) => void;\r\n        }\r\n    ): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].compositeObj = compositeObj;\r\n    }\r\n\r\n    destroy (): void {\r\n        if (this.layerCanvasArr === null) {\r\n            return;\r\n        }\r\n        this.layerCanvasArr.forEach(canvas => {\r\n            BB.freeCanvas(canvas);\r\n        });\r\n        this.layerCanvasArr = null;\r\n    }\r\n\r\n}\r\n","\r\n/**\r\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/ but it implemented tolerance wrong, and had bugs.\r\n * So, my own implementation. can handle tolerance, grow, opacity.\r\n * Needs to be optimized.\r\n */\r\n\r\n/**\r\n * Set values in data within rect to 254, unless they're 255\r\n *\r\n * @param data Uint8Array\r\n * @param width int\r\n * @param x0 int\r\n * @param y0 int\r\n * @param x1 int >x0\r\n * @param y1 int >y0\r\n */\r\nfunction fillRect(data, width, x0, y0, x1, y1) {\r\n    for (let x = x0; x <= x1; x++) {\r\n        for (let y = y0; y <= y1; y++) {\r\n            if (data[y * width + x] === 255) {\r\n                continue;\r\n            }\r\n            data[y * width + x] = 254;\r\n        }\r\n    }\r\n}\r\n\r\nlet mx, my;\r\n\r\n/**\r\n * Get index i moved by dX, dY. in array with dimensions width height.\r\n * Returns null if outside bounds.\r\n *\r\n * @param width int\r\n * @param height int\r\n * @param i int\r\n * @param dX int\r\n * @param dY int\r\n * @returns {null|*}\r\n */\r\nfunction moveIndex(width, height, i, dX, dY) {\r\n    mx = i % width + dX;\r\n    my = Math.floor(i / width) + dY;\r\n\r\n    if (mx < 0 || my < 0 || mx >= width || my >= height) {\r\n        return null;\r\n    }\r\n\r\n    return my * width + mx;\r\n}\r\n\r\n/**\r\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\r\n * returns false if already filled, or i is null\r\n *\r\n * @param srcArr Uint8Array rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param initRgba rgba\r\n * @param tolerance int 0 - 255\r\n * @param i int - srcArr index\r\n * @returns {boolean}\r\n */\r\nfunction testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i) {\r\n    if (i === null || targetArr[i] === 255) {\r\n        return false;\r\n    }\r\n\r\n    if (\r\n        srcArr[i * 4] === initRgba[0] &&\r\n        srcArr[i * 4 + 1] === initRgba[1] &&\r\n        srcArr[i * 4 + 2] === initRgba[2] &&\r\n        srcArr[i * 4 + 3] === initRgba[3]\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    if (\r\n        tolerance > 0 &&\r\n        Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n\r\n/**\r\n *\r\n * @param srcArr Uint8Array rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param px int\r\n * @param py int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n */\r\nfunction floodFill(srcArr, targetArr, width, height, px, py, tolerance, grow, isContiguous) {\r\n\r\n    let initRgba = [\r\n        srcArr[(py * width + px) * 4],\r\n        srcArr[(py * width + px) * 4 + 1],\r\n        srcArr[(py * width + px) * 4 + 2],\r\n        srcArr[(py * width + px) * 4 + 3]\r\n    ];\r\n\r\n    if (isContiguous) {\r\n        let q = [];\r\n        q.push(py * width + px);\r\n        targetArr[py * width + px] = 255;\r\n\r\n        let i, e;\r\n        while (q.length) {\r\n            i = q.pop();\r\n\r\n            // queue up unfilled neighbors\r\n            e = moveIndex(width, height, i, -1, 0); // left\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n\r\n            e = moveIndex(width, height, i, 1, 0); // right\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n\r\n            e = moveIndex(width, height, i, 0, -1); // up\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n\r\n            e = moveIndex(width, height, i, 0, 1); // bottom\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n        }\r\n    } else {\r\n        for (let i = 0; i < width * height; i++) {\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i);\r\n        }\r\n    }\r\n\r\n\r\n    // grow\r\n    if (grow === 0) {\r\n        return;\r\n    }\r\n\r\n    // how does it grow? it finds all pixel at the edge.\r\n    // then depending on what kind of edge it is, it draws a rectangle into target\r\n    // the rectangle has the value 254, or else it mess it all up.\r\n    // after it's all done, replaces it with 255\r\n    let x0, x1, y0, y1;\r\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\r\n    for (let x = 0; x < width; x++) {\r\n        for (let y = 0; y < height; y++) {\r\n            if (targetArr[y * width + x] !== 255) {\r\n                continue;\r\n            }\r\n\r\n            // bounds of rectangle\r\n            x0 = x;\r\n            x1 = x;\r\n            y0 = y;\r\n            y1 = y;\r\n\r\n            l = targetArr[(y) * width + x - 1] !== 255;\r\n            tl = targetArr[(y - 1) * width + x - 1] !== 255;\r\n            t = targetArr[(y - 1) * width + x] !== 255;\r\n            tr = targetArr[(y - 1) * width + x + 1] !== 255;\r\n            r = targetArr[(y) * width + x + 1] !== 255;\r\n            br = targetArr[(y + 1) * width + x + 1] !== 255;\r\n            b = targetArr[(y + 1) * width + x] !== 255;\r\n            bl = targetArr[(y + 1) * width + x - 1] !== 255;\r\n\r\n            if (l) { // left\r\n                x0 = x - grow;\r\n            }\r\n            if (l && tl && t) { // top left\r\n                x0 = x - grow;\r\n                y0 = y - grow;\r\n            }\r\n            if (t) { // top\r\n                y0 = Math.min(y0, y - grow);\r\n            }\r\n            if (t && tr && r) { // top right\r\n                y0 = Math.min(y0, y - grow);\r\n                x1 = x + grow;\r\n            }\r\n            if (r) { // right\r\n                x1 = Math.max(x1, x + 1 * grow);\r\n            }\r\n            if (r && br && b) { // bottom right\r\n                x1 = Math.max(x1, x + 1 * grow);\r\n                y1 = Math.max(y1, y + 1 * grow);\r\n            }\r\n            if (b) { // bottom\r\n                y1 = Math.max(y1, y + 1 * grow);\r\n            }\r\n            if (b && bl && l) { // bottom left\r\n                x0 = Math.min(x0, x - 1 * grow);\r\n                y1 = Math.max(y1, y + 1 * grow);\r\n            }\r\n\r\n            if (!l && !tl && !t && !tr && !r && !br && !b && !bl) {\r\n                continue;\r\n            }\r\n\r\n            fillRect(\r\n                targetArr,\r\n                width,\r\n                Math.max(0, x0),\r\n                Math.max(0, y0),\r\n                Math.min(width - 1, x1),\r\n                Math.min(height - 1, y1)\r\n            );\r\n        }\r\n    }\r\n    for (let i = 0; i < width * height; i++) {\r\n        if (targetArr[i] === 254) {\r\n            targetArr[i] = 255;\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * Does flood fill, and returns that. an array - 0 not filled. 255 filled\r\n *\r\n * returns {\r\n *     data: Uint8Array\r\n * }\r\n *\r\n * @param rgbaArr Uint8Array rgba\r\n * @param width int\r\n * @param height int\r\n * @param x int\r\n * @param y int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n * @returns {{data: Uint8Array}}\r\n */\r\nexport function floodFillBits(rgbaArr, width, height, x, y, tolerance, grow, isContiguous) {\r\n    x = Math.round(x);\r\n    y = Math.round(y);\r\n\r\n    let resultArr = new Uint8Array(new ArrayBuffer(width * height));\r\n\r\n    floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\r\n\r\n    return {\r\n        data: resultArr\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IShapeToolObject} from '../kl.types';\r\n\r\n\r\n/**\r\n * Input processor for shape tool.\r\n * Coordinates are in canvas space.\r\n * angleRad is the angle of the canvas.\r\n *\r\n * @param p - {onShape: func(isDone, x1, y1, x2, y2, angleRad)}\r\n * @constructor\r\n */\r\nexport function ShapeTool(p) {\r\n\r\n    let downX, downY, downAngleRad;\r\n\r\n    this.onDown = function(x, y, angleRad) {\r\n        downX = x;\r\n        downY = y;\r\n        downAngleRad = angleRad;\r\n    };\r\n\r\n    this.onMove = function(x, y) {\r\n        p.onShape(false, downX, downY, x, y, downAngleRad);\r\n    };\r\n\r\n    this.onUp = function(x, y) {\r\n        p.onShape(true, downX, downY, x, y, downAngleRad);\r\n    };\r\n}\r\n\r\n/**\r\n * Draw a shape (rectangle, ellipse, line)\r\n *\r\n * @param ctx\r\n * @param shapeObj\r\n */\r\nexport function drawShape(\r\n    ctx: CanvasRenderingContext2D,\r\n    shapeObj: IShapeToolObject,\r\n) {\r\n\r\n    if (['rect', 'ellipse', 'line'].includes(shapeObj.type)) {\r\n        const lineWidth = Math.round(shapeObj.lineWidth);\r\n        const angleDeg = shapeObj.angleRad * 180 / Math.PI;\r\n\r\n        // --- prep canvas ---\r\n        ctx.save();\r\n        if (shapeObj.opacity) {\r\n            ctx.globalAlpha = shapeObj.opacity;\r\n        }\r\n        if (shapeObj.isEraser) {\r\n            ctx.globalCompositeOperation = 'destination-out';\r\n        }\r\n        ctx.rotate(-shapeObj.angleRad);\r\n        if (shapeObj.fillRgb) {\r\n            ctx.fillStyle = BB.ColorConverter.toRgbStr(shapeObj.fillRgb);\r\n        } else if (shapeObj.strokeRgb) {\r\n            ctx.strokeStyle = BB.ColorConverter.toRgbStr(shapeObj.strokeRgb);\r\n            ctx.lineWidth = lineWidth;\r\n        }\r\n\r\n        let x1 = shapeObj.x1;\r\n        let y1 = shapeObj.y1;\r\n        let x2 = shapeObj.x2;\r\n        let y2 = shapeObj.y2;\r\n\r\n        // --- angle snapping ---\r\n        if (shapeObj.isAngleSnap) {\r\n            let r1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            let r2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            let pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\r\n            let pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\r\n            let rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\r\n            x2 = rotated.x;\r\n            y2 = rotated.y;\r\n\r\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\r\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\r\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\r\n                    x2 = x1;\r\n                } else { // left or right\r\n                    y2 = y1;\r\n                }\r\n            }\r\n        }\r\n\r\n        let x = x1;\r\n        let y = y1;\r\n        let dX = x2 - x1;\r\n        let dY = y2 - y1;\r\n\r\n        // --- 1:1 ratio ---\r\n        if (shapeObj.type !== 'line' && shapeObj.isFixedRatio) {\r\n            let r1 = BB.rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\r\n            let r2 = BB.rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            let rx = r1.x;\r\n            let ry = r1.y;\r\n            let rdX = r2.x - r1.x;\r\n            let rdY = r2.y - r1.y;\r\n\r\n            if (Math.abs(rdX) < Math.abs(rdY)) {\r\n                rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\r\n            } else {\r\n                rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\r\n            }\r\n            r2.x = rx + rdX;\r\n            r2.y = ry + rdY;\r\n\r\n            r1 = BB.rotate(r1.x, r1.y, -shapeObj.angleRad / Math.PI * 180);\r\n            r2 = BB.rotate(r2.x, r2.y, -shapeObj.angleRad / Math.PI * 180);\r\n\r\n            x1 = r1.x;\r\n            y1 = r1.y;\r\n            x2 = r2.x;\r\n            y2 = r2.y;\r\n\r\n            x = x1;\r\n            y = y1;\r\n            dX = x2 - x1;\r\n            dY = y2 - y1;\r\n        }\r\n\r\n        // outwards modifier\r\n        if (shapeObj.isOutwards) {\r\n            x -= dX;\r\n            y -= dY;\r\n            dX *= 2;\r\n            dY *= 2;\r\n\r\n            x1 = x;\r\n            y1 = y;\r\n            x2 = x + dX;\r\n            y2 = y + dY;\r\n        }\r\n\r\n        let p1;\r\n        let p2;\r\n        if (shapeObj.type === 'line') { // --- line ---\r\n\r\n            // rounded\r\n            const x1r = Math.round(x1);\r\n            const y1r = Math.round(y1);\r\n            const x2r = Math.round(x2);\r\n            const y2r = Math.round(y2);\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (lineWidth % 2 === 0) {\r\n\r\n                if (y1r === y2r) {\r\n                    p1 = {\r\n                        x: x1f,\r\n                        y: y1r,\r\n                    };\r\n                    p2 = {\r\n                        x: x2f,\r\n                        y: y2r,\r\n                    };\r\n\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                } else if (x1r === x2r) {\r\n                    p1 = {\r\n                        x: x1r,\r\n                        y: y1f,\r\n                    };\r\n                    p2 = {\r\n                        x: x2r,\r\n                        y: y2f,\r\n                    };\r\n\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                } else {\r\n                    p1 = {\r\n                        x: x1,\r\n                        y: y1,\r\n                    };\r\n                    p2 = {\r\n                        x: x2,\r\n                        y: y2,\r\n                    };\r\n                }\r\n\r\n            } else {\r\n                p1 = {\r\n                    x: x1f,\r\n                    y: y1f,\r\n                };\r\n                p2 = {\r\n                    x: x2f,\r\n                    y: y2f,\r\n                };\r\n                if (y1f === y2f) {\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                    p1.y += 0.5;\r\n                    p2.y += 0.5;\r\n                } else if (x1f === x2f) {\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                    p1.x += 0.5;\r\n                    p2.x += 0.5;\r\n                } else {\r\n                    p1.x = x1;\r\n                    p1.y = y1;\r\n                    p2.x = x2;\r\n                    p2.y = y2;\r\n                }\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            ctx.beginPath();\r\n            ctx.moveTo(p1.x, p1.y);\r\n            ctx.lineTo(p2.x, p2.y);\r\n            ctx.stroke();\r\n\r\n        } else if (shapeObj.type === 'rect') { // --- rect ---\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (angleDeg % 90 === 0) {\r\n                if (shapeObj.fillRgb) {\r\n                    if (x1 % 1 === 0) {\r\n                        x1 += 1;\r\n                    }\r\n                    if (y1 % 1 === 0) {\r\n                        y1 += 1;\r\n                    }\r\n                    if (x2 % 1 === 0) {\r\n                        x2 += 1;\r\n                    }\r\n                    if (y2 % 1 === 0) {\r\n                        y2 += 1;\r\n                    }\r\n\r\n                    p1 = {\r\n                        x: x1 < x2 ? x1f : x2f,\r\n                        y: y1 < y2 ? y1f : y2f,\r\n                    };\r\n                    p2 = {\r\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\r\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y),\r\n                    };\r\n                    p2.x = p1.x + p2.x;\r\n                    p2.y = p1.y + p2.y;\r\n\r\n                } else {\r\n                    if (lineWidth % 2 === 0) {\r\n                        p1 = {\r\n                            x: x1f,\r\n                            y: y1f,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f,\r\n                            y: y2f,\r\n                        };\r\n                    } else {\r\n                        p1 = {\r\n                            x: x1f + 0.5,\r\n                            y: y1f + 0.5,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f + 0.5,\r\n                            y: y2f + 0.5,\r\n                        };\r\n                    }\r\n                }\r\n            } else {\r\n                p1 = {\r\n                    x: x1,\r\n                    y: y1,\r\n                };\r\n                p2 = {\r\n                    x: x2,\r\n                    y: y2,\r\n                };\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2.x = p2.x - p1.x;\r\n            p2.y = p2.y - p1.y;\r\n\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\r\n            } else {\r\n                ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\r\n            }\r\n\r\n        } else {  // --- circle ---\r\n            p1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n            x = p1.x;\r\n            y = p1.y;\r\n            dX = p2.x - p1.x;\r\n            dY = p2.y - p1.y;\r\n\r\n            ctx.beginPath();\r\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fill();\r\n            } else {\r\n                ctx.stroke();\r\n            }\r\n        }\r\n\r\n\r\n        ctx.restore();\r\n\r\n    } else {\r\n        throw new Error('unknown shape');\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {IRect} from '../../bb/bb.types';\r\n\r\nexport interface IRenderTextParam {\r\n    textStr: string; // text to be drawn. can contain newlines\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\r\n    align: 'left' | 'center' | 'right'; // default 'left'\r\n    isBold: boolean; // default false\r\n    isItalic: boolean; // default false\r\n    angleRad: number; // default 0 - rotates around x y\r\n    lineHeight?: number; // pixels\r\n    color: string;\r\n    isDebug?: boolean;\r\n}\r\n\r\n\r\n/**\r\n * Draw text on a canvas.\r\n *\r\n * @param canvas\r\n * @param p\r\n * @returns - bounds. coords relative to p.x p.y\r\n */\r\nexport function renderText(canvas: HTMLCanvasElement, p: IRenderTextParam): IRect {\r\n\r\n    // always at least a space. so bounds aren't just a dot\r\n    let textStr = p.textStr === '' ? ' ' : p.textStr;\r\n\r\n    // --- create el ---\r\n    // create an actual dom element. figure out where exactly each letter is positioned.\r\n    // that way multiline is feasible. canvas can't do multiline or text-align\r\n    let outer = BB.el({\r\n        css: {\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            width: '100000px',\r\n            fontSize: p.size + 'px',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n        }\r\n    });\r\n    let div = BB.el({\r\n        parent: outer,\r\n        css: {\r\n            display: 'inline-block',\r\n            textAlign: p.align ? p.align : 'left',\r\n            fontFamily: p.font ? p.font : 'sans-serif',\r\n            fontSize: p.size + 'px',\r\n            fontWeight: p.isBold ? 'bold' : 'normal',\r\n            fontStyle: p.isItalic ? 'italic' : 'normal',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n\r\n\r\n            opacity: '0',\r\n            pointerEvents: 'none'\r\n        }\r\n    });\r\n    let spanStr = '';\r\n    let replaceObj = {\r\n        \"\\n\": '<br>',\r\n        \" \": '&nbsp;',\r\n        \"\t\": '&nbsp;&nbsp;&nbsp;&nbsp;',\r\n    };\r\n    for (let i = 0; i < textStr.length; i++) {\r\n        if (textStr[i] === \"\\n\") {\r\n            div.appendChild(BB.el({\r\n                tagName: 'span',\r\n                textContent: spanStr,\r\n                css: {\r\n                    whiteSpace: 'pre'\r\n                }\r\n            }));\r\n            spanStr = '';\r\n            div.appendChild(BB.el({\r\n                tagName: 'br'\r\n            }));\r\n            continue;\r\n        }\r\n        spanStr += textStr[i].replace(\"\\t\", '    ');\r\n    }\r\n    div.appendChild(BB.el({\r\n        tagName: 'span',\r\n        textContent: spanStr,\r\n        css: {\r\n            whiteSpace: 'pre'\r\n        }\r\n    }));\r\n    document.body.appendChild(outer);\r\n\r\n\r\n    // --- determine bounds ---\r\n    let bounds = {\r\n        x0: 99999999,\r\n        y0: 99999999,\r\n        x1: 0,\r\n        y1: 0\r\n    }\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        let el = div.children[i] as HTMLElement;\r\n        bounds.x0 = Math.min(bounds.x0, el.offsetLeft);\r\n        bounds.y0 = Math.min(bounds.y0, el.offsetTop);\r\n        bounds.x1 = Math.max(bounds.x1, el.offsetLeft + el.offsetWidth);\r\n        bounds.y1 = Math.max(bounds.y1, el.offsetTop + el.offsetHeight);\r\n    }\r\n\r\n    // --- draw ---\r\n    let ctx = canvas.getContext('2d');\r\n    ctx.save();\r\n\r\n    let font = [];\r\n    if (p.isItalic) {\r\n        font.push('italic');\r\n    }\r\n    if (p.isBold) {\r\n        font.push('bold');\r\n    }\r\n    font.push(p.size + 'px ' + (p.font ? p.font : 'sans-serif'));\r\n    ctx.font = font.join(' ');\r\n    ctx.fillStyle = p.color ? p.color : '#000';\r\n\r\n    let x = p.x;\r\n    let y = p.y;\r\n    if (p.align === 'right') {\r\n        x += -bounds.x1 + bounds.x0;\r\n    }\r\n    if (p.align === 'center') {\r\n        x += (-bounds.x1 + bounds.x0) / 2;\r\n    }\r\n    ctx.translate(p.x, p.y);\r\n    ctx.rotate(p.angleRad ? -p.angleRad : 0);\r\n    ctx.translate(-p.x, -p.y);\r\n    ctx.translate(x, y);\r\n\r\n    // fill\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        let el = div.children[i] as HTMLElement;\r\n\r\n        //ctx.fillText(el.innerText, 0, 0);\r\n        ctx.fillText(el.innerText, el.offsetLeft, el.offsetTop);\r\n    }\r\n\r\n    if (p.isDebug) {\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeRect(0, -p.size * 0.85, bounds.x1, bounds.y1);\r\n        ctx.restore();\r\n        ctx.fillRect(p.x - 1, p.y - 1, 2, 2);\r\n    } else {\r\n        ctx.restore();\r\n    }\r\n\r\n    document.body.removeChild(outer);\r\n\r\n    return {\r\n        x: x - p.x,\r\n        y: y - p.y -p.size * 0.85,\r\n        width: bounds.x1 - bounds.x0,\r\n        height: bounds.y1 - bounds.y0\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IKlProject} from '../kl.types';\r\n\r\nexport function drawProject(project: IKlProject, factor) {\r\n    let resultCanvas = BB.canvas(\r\n        Math.max(1, Math.round(project.width * factor)),\r\n        Math.max(1, Math.round(project.height * factor))\r\n    );\r\n    let ctx = resultCanvas.getContext(\"2d\");\r\n    ctx.save();\r\n    if (factor > 1) {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n    for (let i = 0; i < project.layers.length; i++) {\r\n        if (project.layers[i].opacity === 0) {\r\n            continue;\r\n        }\r\n        ctx.globalAlpha = project.layers[i].opacity;\r\n        ctx.globalCompositeOperation = project.layers[i].mixModeStr ? project.layers[i].mixModeStr : 'source-over';\r\n        ctx.drawImage(project.layers[i].image, 0, 0, resultCanvas.width, resultCanvas.height);\r\n    }\r\n    ctx.restore();\r\n    return resultCanvas;\r\n}","import {IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {TTranslationCode} from '../../../languages/languages';\r\n\r\nexport function translateBlending(blendMode?: IMixMode): string {\r\n    if (!blendMode) {\r\n        return LANG('layers-blend-normal');\r\n    }\r\n\r\n    const codes: {\r\n        [key: string]: TTranslationCode\r\n    } = {\r\n        'source-over': 'layers-blend-normal',\r\n        'darken': 'layers-blend-darken',\r\n        'multiply': 'layers-blend-multiply',\r\n        'color-burn': 'layers-blend-color-burn',\r\n        'lighten': 'layers-blend-lighten',\r\n        'screen': 'layers-blend-screen',\r\n        'color-dodge': 'layers-blend-color-dodge',\r\n        'overlay': 'layers-blend-overlay',\r\n        'soft-light': 'layers-blend-soft-light',\r\n        'hard-light': 'layers-blend-hard-light',\r\n        'difference': 'layers-blend-difference',\r\n        'exclusion': 'layers-blend-exclusion',\r\n        'hue': 'layers-blend-hue',\r\n        'saturation': 'layers-blend-saturation',\r\n        'color': 'layers-blend-color',\r\n        'luminosity': 'layers-blend-luminosity',\r\n    };\r\n\r\n    if (!(blendMode in codes)) {\r\n        throw new Error('unknown blend mode');\r\n    }\r\n    return LANG(codes[blendMode]);\r\n}","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl.types';\r\n\r\n/**\r\n * Overlay for KlCanvasWorkspace.\r\n * - brush circle\r\n * - eyedropper circle\r\n * - compass needle (rotation hud)\r\n */\r\nexport class WorkspaceSvgOverlay {\r\n    private rootElement: SVGElement;\r\n    private brushCircleOuter: SVGElement;\r\n    private brushCircleInner: SVGElement;\r\n    private pickerPreviewBorder: SVGElement;\r\n    private pickerPreviewCol: SVGElement;\r\n    private readonly compassSize: number;\r\n    private compass: SVGElement;\r\n    private compassInner: SVGElement;\r\n    private compassBaseCircle: SVGElement;\r\n    private compassLineCircle: SVGElement;\r\n    private compassUpperTriangle: SVGElement;\r\n    private compassLowerTriangle: SVGElement;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n        }\r\n    ) {\r\n        this.rootElement = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + p.width,\r\n            height: '' + p.height,\r\n        });\r\n        BB.css(this.rootElement, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            pointerEvents: 'none',\r\n            userSelect: 'none'\r\n        });\r\n\r\n        //brush circles\r\n        this.brushCircleOuter = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '10',\r\n            stroke: 'rgba(0,0,0,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.brushCircleInner = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '9',\r\n            stroke: 'rgba(255,255,255,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\r\n\r\n        //color picker preview circle\r\n        this.pickerPreviewBorder = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '22',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewBorder.style.opacity = '0';\r\n        this.pickerPreviewCol = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '20',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewCol.style.opacity = '0';\r\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\r\n\r\n\r\n        //rotation compass\r\n        this.compassSize = 30;\r\n        this.compass = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'translate(' + (p.width/2) + ', ' + (p.height/2) + ')',\r\n        });\r\n        BB.css(this.compass, {\r\n            transition: 'opacity 0.25s ease-in-out',\r\n            opacity: '0',\r\n        });\r\n        this.compassInner = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'rotate(45)',\r\n        });\r\n        this.compassBaseCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'rgba(0,0,0,0.9)',\r\n            stroke: 'none',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + this.compassSize,\r\n        });\r\n        this.compassLineCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'none',\r\n            stroke: 'rgba(255,255,255,0.75)',\r\n            'stroke-width': '1',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + (this.compassSize * 0.9),\r\n        });\r\n        this.compassUpperTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#f00',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,-'+(this.compassSize * 0.9)+' z',\r\n        });\r\n        this.compassLowerTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#fff',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,'+(this.compassSize * 0.9)+' z',\r\n        });\r\n\r\n        this.compassInner.append(\r\n            this.compassBaseCircle,\r\n            this.compassLineCircle,\r\n            this.compassUpperTriangle,\r\n            this.compassLowerTriangle\r\n        );\r\n        this.compass.append(this.compassInner);\r\n        this.rootElement.append(this.compass);\r\n    }\r\n\r\n    getElement (): SVGElement {\r\n        return this.rootElement;\r\n    }\r\n\r\n    setSize (width: number, height: number): void {\r\n        this.rootElement.setAttribute('width', '' + width);\r\n        this.rootElement.setAttribute('height', '' + height);\r\n        this.compass.setAttribute('transform', 'translate(' + (width/2) + ', ' + (height/2) + ')');\r\n    }\r\n\r\n    updateCursor (p: {\r\n        x?: number;\r\n        y?: number;\r\n        radius?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if ('x' in p) {\r\n            this.brushCircleOuter.setAttribute('cx', '' + p.x);\r\n            this.brushCircleInner.setAttribute('cx', '' + p.x);\r\n        }\r\n        if ('y' in p) {\r\n            this.brushCircleOuter.setAttribute('cy', '' + p.y);\r\n            this.brushCircleInner.setAttribute('cy', '' + p.y);\r\n        }\r\n        if ('radius' in p) {\r\n            this.brushCircleOuter.setAttribute('r', '' + Math.max(0, p.radius));\r\n            this.brushCircleInner.setAttribute('r', '' + Math.max(0, p.radius - 1));\r\n        }\r\n        if ('isVisible' in p) {\r\n            this.brushCircleOuter.style.opacity = p.isVisible ? '1' : '0';\r\n            this.brushCircleInner.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateColorPreview (p: {\r\n        x?: number;\r\n        y?: number;\r\n        color?: IRGB;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if ('x' in p) {\r\n            this.pickerPreviewCol.setAttribute('cx', '' + p.x);\r\n            this.pickerPreviewBorder.setAttribute('cx', '' + p.x);\r\n        }\r\n        if ('y' in p) {\r\n            this.pickerPreviewCol.setAttribute('cy', '' + p.y);\r\n            this.pickerPreviewBorder.setAttribute('cy', '' + p.y);\r\n        }\r\n        if ('color' in p) {\r\n            this.pickerPreviewCol.setAttribute('stroke', BB.ColorConverter.toRgbStr(p.color));\r\n            let borderColor = BB.testIsWhiteBestContrast(p.color) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\r\n            this.pickerPreviewBorder.setAttribute('stroke', borderColor);\r\n        }\r\n        if ('isVisible' in p) {\r\n            this.pickerPreviewCol.style.opacity = p.isVisible ? '1' : '0';\r\n            this.pickerPreviewBorder.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateCompass (p: {\r\n        angleDeg?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if ('angleDeg' in p) {\r\n            this.compassInner.setAttribute('transform', 'rotate(' + p.angleDeg + ')');\r\n            this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? '1' : '0';\r\n        }\r\n        if ('isVisible' in p) {\r\n            this.compass.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB, ITransform} from '../kl.types';\r\nimport {WorkspaceSvgOverlay} from './workspace-svg-overlay';\r\nimport {klHistory} from '../history/kl-history';\r\n// @ts-ignore\r\nimport pickerImg from 'url:~/src/app/img/ui/cursor-picker.png';\r\n// @ts-ignore\r\nimport zoomEwImg from 'url:~/src/app/img/ui/cursor-zoom-ew.png';\r\n// @ts-ignore\r\nimport fillImg from 'url:~/src/app/img/ui/cursor-fill.png';\r\n// @ts-ignore\r\nimport textImg from 'url:~/src/app/img/ui/cursor-text.png';\r\nimport {IPressureInput, IVector2D} from '../../bb/bb.types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {KeyListener} from '../../bb/input/key-listener';\r\n\r\nexport interface IViewChangeEvent {\r\n    changed: ('scale' | 'angle')[];\r\n    angle: number;\r\n    scale: number;\r\n}\r\n\r\ntype TModeStr = 'draw' | 'pick' | 'hand' | 'shape' | 'fill' | 'text'; // | 'transform' | 'select'\r\n\r\nconst MIN_SCALE = 1 / 16;\r\nconst MAX_SCALE = 64;\r\nenum TMode {\r\n    Draw,\r\n    Hand,\r\n    HandGrabbing,\r\n    Pick,\r\n    Zoom,\r\n    Rotate,\r\n    Rotating,\r\n    Fill,\r\n    Text,\r\n    Shape,\r\n}\r\nconst ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\r\n\r\n/**\r\n * Work area that displays the KlCanvas.\r\n * - pan, zoom, rotate (also via multi-touch)\r\n * - input modes: drawing, hand, pick, fill, text // transform, select\r\n * - drawing input events\r\n * - view change events\r\n * - eyedropper input events (pick)\r\n * - draws cursor, eyedropper overlay\r\n *\r\n * subscribes to klCanvas changes\r\n * listens to kl history for changes\r\n * and you can manually trigger redraw\r\n */\r\nexport class KlCanvasWorkspace {\r\n\r\n    private rootEl: HTMLElement;\r\n    private klCanvas: KlCanvas;\r\n    private renderTargetCanvas: HTMLCanvasElement;\r\n    private renderTargetCtx: CanvasRenderingContext2D;\r\n    private renderWidth: number;\r\n    private renderHeight: number;\r\n    private compositeCanvas: HTMLCanvasElement; // for drawing klcanvas layer composite\r\n    private compositeCtx: CanvasRenderingContext2D;\r\n    private doResizeCanvas: boolean;\r\n    private oldTransformObj: ITransform;\r\n    private targetTransformObj: ITransform; // animation target\r\n    private highResTransformObj: ITransform; // animated, internal high res\r\n    private renderedTransformObj: ITransform; // same as highRes, but rounded - what's actually displayed\r\n    private cursorPos: IVector2D;\r\n    private usesCssCursor: boolean;\r\n    private bgVisible: boolean;\r\n    private transformIsDirty: boolean;\r\n    private doAnimateTranslate: boolean;\r\n    private svgOverlay: WorkspaceSvgOverlay;\r\n    private emptyCanvas: HTMLCanvasElement;\r\n    private keyListener: KeyListener;\r\n    private currentMode: TMode;\r\n    private globalMode: TMode;\r\n    private renderTime: number; // for debugging - average ms per render()\r\n    private lastDrawEvent: IPressureInput | null; // previous drawing input\r\n    private linetoolProcessor: any; // todo type - BB.EventChain.LinetoolProcessor\r\n    private pointer: IVector2D | null; // position of cursor\r\n    private isDrawing: boolean;\r\n    private inputProcessorObj: any; // todo type\r\n    private currentInputProcessor: any; // todo type\r\n    private angleIsExtraSticky: boolean;\r\n    private pinchZoomer: any; // todo type - BB.EventChain.PinchZoomer\r\n    private mainDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\r\n    private middleDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\r\n    private twoFingerTap: any; // todo type - BB.EventChain.NFingerTapper\r\n    private threeFingerTap: any; // todo type - BB.EventChain.NFingerTapper\r\n    private pointerEventChain: any; // todo type - BB.EventChain.EventChain\r\n    private pointerListener: any; // todo type - BB.PointerListener\r\n    private brushRadius: number;\r\n    private animationFrameRequested: boolean;\r\n    private lastRenderedState: number; // KlHistory state - to detect if there are changes to draw\r\n    private lastRenderTime: number; // ms from performance.now()\r\n    private hideBrushCursorTimeout: number;\r\n    private onViewChange: (e:  IViewChangeEvent) => void;\r\n\r\n    private getRenderedTransform (): ITransform {\r\n        // rounded x & y so canvas is less blurry.\r\n        const result = this.renderedTransformObj;\r\n        result.x = this.highResTransformObj.x;\r\n        result.y = this.highResTransformObj.y;\r\n        result.scale = this.highResTransformObj.scale;\r\n        result.angle = this.highResTransformObj.angle;\r\n\r\n        if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\r\n            result.x = Math.round(result.x);\r\n            result.y = Math.round(result.y);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private updateChangeListener (): void {\r\n        this.klCanvas.addChangeListener(() => {\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n        });\r\n    }\r\n\r\n    private updateCursor (modeInt: TMode, doForce?: boolean): void {\r\n        if (modeInt === this.currentMode && !doForce) {\r\n            return;\r\n        }\r\n        const oldMode = this.currentMode;\r\n        this.currentMode = modeInt;\r\n        this.lastRenderedState = -1;\r\n        if (this.currentMode === TMode.Draw) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        } else if (this.currentMode === TMode.Hand) {\r\n            this.rootEl.style.cursor = 'grab';\r\n        } else if (this.currentMode === TMode.HandGrabbing) {\r\n            this.rootEl.style.cursor = 'grabbing';\r\n        } else if (this.currentMode === TMode.Pick) {\r\n            this.rootEl.style.cursor = \"url('\" + pickerImg + \"') 0 15, crosshair\";\r\n        } else if (this.currentMode === TMode.Zoom) {\r\n            this.rootEl.style.cursor = \"url('\" + zoomEwImg + \"') 7 7, zoom-in\";\r\n        } else if (this.currentMode === TMode.Rotate) {\r\n            this.rootEl.style.cursor = \"grab\";\r\n        } else if (this.currentMode === TMode.Rotating) {\r\n            this.rootEl.style.cursor = \"grabbing\";\r\n        } else if (this.currentMode === TMode.Fill) {\r\n            this.rootEl.style.cursor = \"url('\" + fillImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Text) {\r\n            this.rootEl.style.cursor = \"url('\" + textImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Shape) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        }\r\n\r\n        if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode)) {\r\n            const oldIsHand = [TMode.Hand, TMode.HandGrabbing].includes(oldMode);\r\n            const currentIsHand = [TMode.Hand, TMode.HandGrabbing].includes(this.currentMode);\r\n            if (!oldIsHand && currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n            }\r\n            if (oldIsHand && !currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n            }\r\n        }\r\n\r\n        if (this.currentMode !== TMode.Pick) {\r\n            this.svgOverlay.updateColorPreview({isVisible: false});\r\n        }\r\n    }\r\n\r\n    /**\r\n     * returns false if no change of zoom\r\n     * @param stepNum\r\n     * @param centerX\r\n     * @param centerY\r\n     * @private\r\n     */\r\n    private internalZoomByStep (stepNum: number, centerX: number, centerY: number): boolean {\r\n        const step = Math.log2(this.targetTransformObj.scale);\r\n\r\n        let newStep = step / Math.abs(stepNum);\r\n        newStep += stepNum > 0 ? 1 : -1;\r\n        newStep = Math.round(newStep);\r\n        newStep *= Math.abs(stepNum);\r\n        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, Math.pow(2, newStep)));\r\n\r\n        //has zoomed?\r\n        if (newScale === this.targetTransformObj.scale) {\r\n            return false;\r\n        }\r\n\r\n\r\n        const effectiveFactor = newScale / this.targetTransformObj.scale;\r\n        this.targetTransformObj.scale = newScale;\r\n\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerX, centerY));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerX, -centerY));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.transformIsDirty = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * mixes two transform objects. modifies A\r\n     * @param transformA\r\n     * @param transformB\r\n     * @param blendFactor 0 -> A, 1 -> B\r\n     * @private\r\n     */\r\n    private mixTransformObj (transformA: ITransform, transformB: ITransform, blendFactor: number): void {\r\n        if (transformA.angle === transformB.angle) {\r\n            transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n            transformA.x = BB.mix(transformA.x, transformB.x, blendFactor);\r\n            transformA.y = BB.mix(transformA.y, transformB.y, blendFactor);\r\n            transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n            return;\r\n        }\r\n\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        // --- determine centerPosA, centerPosB ---\r\n        const centerPosA = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2\r\n        }, transformA);\r\n        const centerPosB = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2\r\n        }, transformB);\r\n\r\n        // --- centerPosMixed ---\r\n        transformA.x = BB.mix(centerPosA.x , centerPosB.x, blendFactor);\r\n        transformA.y = BB.mix(centerPosA.y , centerPosB.y, blendFactor);\r\n\r\n        // --- scale and angle ---\r\n        transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n        transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n\r\n        // --- x and y ---\r\n        const mixedPos = this.canvasToWorkspaceCoord({\r\n            x: -w / 2,\r\n            y: -h / 2\r\n        }, transformA);\r\n        transformA.x = mixedPos.x;\r\n        transformA.y = mixedPos.y;\r\n    }\r\n\r\n    private render (): void {\r\n        if (this.doResizeCanvas) {\r\n            this.doResizeCanvas = false;\r\n            this.renderTargetCanvas.width = this.renderWidth;\r\n            this.renderTargetCanvas.height = this.renderHeight;\r\n        }\r\n        this.renderContext(this.renderTargetCtx);\r\n    }\r\n\r\n    /**\r\n     * is the gray background that surrounds canvas visible?\r\n     * @private\r\n     */\r\n    private testBgVisible (): boolean {\r\n        //bring workspace points (corners of workspace) into canvas coordinate system\r\n        //then check if any corner point is outside of the canvas -> that means the bg is visible\r\n\r\n        const workspacePointArr = [\r\n            [0, 0], // top left\r\n            [this.renderWidth, 0], // top right\r\n            [this.renderWidth, this.renderHeight], // bottom right\r\n            [0, this.renderHeight], // bottom left\r\n        ];\r\n\r\n        const art = this.getRenderedTransform();\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        //transform points, then test if outside of canvas\r\n        for (let i = 0; i < workspacePointArr.length; i++) {\r\n            let coords = [workspacePointArr[i][0], workspacePointArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n            if (\r\n                !(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() &&\r\n                    0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())\r\n            ){\r\n                //if not inside -> bg visible\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private renderContext (ctx: CanvasRenderingContext2D): void {\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        const art = this.getRenderedTransform();\r\n\r\n        if (art.scale >= 4 || (art.scale === 1 && art.angle === 0)) {\r\n            ctx.imageSmoothingEnabled = false;\r\n        } else {\r\n            ctx.imageSmoothingEnabled = true;\r\n            ctx.imageSmoothingQuality  = 'low'; // art.scale >= 1 ? 'low' : 'medium';\r\n        }\r\n        //ctx.imageSmoothingEnabled = false;\r\n        //renderTargetCtx.globalCompositeOperation  = 'multiply';\r\n\r\n\r\n\r\n        ctx.save();\r\n        {\r\n            if (this.bgVisible) {\r\n                ctx.fillStyle = 'rgb(158,158,158)'; // 'rgb(185,185,185)';\r\n                ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\r\n            } else {\r\n                ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\r\n            }\r\n\r\n\r\n\r\n            if (this.bgVisible) {\r\n                ctx.save();\r\n\r\n                ctx.translate(art.x, art.y);\r\n                ctx.scale(art.scale, art.scale);\r\n                ctx.rotate(art.angle);\r\n\r\n                ctx.imageSmoothingEnabled = false;\r\n\r\n                //outline\r\n                const borderSize = 1;\r\n                ctx.globalAlpha = 0.2;\r\n                ctx.drawImage(\r\n                    this.emptyCanvas,\r\n                    -borderSize / art.scale,\r\n                    -borderSize / art.scale,\r\n                    w + borderSize * 2 / art.scale,\r\n                    h + borderSize * 2 / art.scale\r\n                );\r\n                ctx.globalAlpha = 1;\r\n\r\n                //erase\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n                ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\r\n\r\n                ctx.restore();\r\n            }\r\n\r\n            /*const region = new Path2D();\r\n            region.rect(80, 10, 20, 130);\r\n            ctx.clip(region);*/\r\n\r\n            ctx.translate(art.x, art.y);\r\n            ctx.scale(art.scale, art.scale);\r\n            ctx.rotate(art.angle);\r\n\r\n            const layerArr = this.klCanvas.getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    ctx.globalAlpha = layerArr[i].opacity;\r\n                    ctx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n\r\n                    if (layerArr[i].canvas.compositeObj) {\r\n                        if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\r\n                            this.compositeCanvas.width = layerArr[i].canvas.width;\r\n                            this.compositeCanvas.height = layerArr[i].canvas.height;\r\n                        } else {\r\n                            this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\r\n                        }\r\n                        this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\r\n                        layerArr[i].canvas.compositeObj.draw(this.compositeCtx);\r\n                        ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\r\n                    } else {\r\n                        ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\r\n                    }\r\n                }\r\n            }\r\n            ctx.globalAlpha = 1;\r\n\r\n\r\n\r\n        }\r\n        ctx.restore();\r\n\r\n        // rotation hud\r\n        if (TMode.Rotate === this.currentMode || TMode.Rotating === this.currentMode) {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: true,\r\n                angleDeg: art.angle / Math.PI * 180\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: false\r\n            });\r\n        }\r\n    }\r\n\r\n    private workspaceToCanvasCoord (p: IVector2D): IVector2D {\r\n        const art = this.getRenderedTransform();\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private canvasToWorkspaceCoord (p: IVector2D, transformObj: ITransform): IVector2D {\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(transformObj.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(transformObj.scale));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private snapAngleRad (angleRad: number, snapDegIncrement: number, maxDistDeg: number): number {\r\n        let angleDeg = angleRad * 180 / Math.PI;\r\n        const modDeg = Math.abs(angleDeg % snapDegIncrement);\r\n        const dist = Math.min(modDeg, snapDegIncrement - modDeg);\r\n\r\n        if (dist <= maxDistDeg) {\r\n            angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\r\n        }\r\n\r\n        return angleDeg / 180 * Math.PI;\r\n    }\r\n\r\n    /**\r\n     * angle always in range [-PI, PI]\r\n     * @param angleRad\r\n     * @private\r\n     */\r\n    private minimizeAngleRad (angleRad: number): number {\r\n        angleRad = angleRad % (2 * Math.PI);\r\n        if (angleRad > Math.PI) {\r\n            angleRad -= 2 * Math.PI;\r\n        } else if (angleRad < -Math.PI) {\r\n            angleRad += 2 * Math.PI;\r\n        }\r\n        return angleRad;\r\n    }\r\n\r\n    private resetInputProcessor (): void {\r\n        this.currentInputProcessor = null;\r\n        this.updateCursor(this.globalMode);\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    private reqFrame (doRedrawCanvas?: boolean): void {\r\n        this.animationFrameRequested = true;\r\n        if (doRedrawCanvas) {\r\n            this.lastRenderedState = -1;\r\n        }\r\n    }\r\n\r\n    private updateLoop (): void {\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState;\r\n\r\n        //handle variable framerate\r\n        const nowTime = performance.now();\r\n        const elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\r\n        this.lastRenderTime = nowTime;\r\n\r\n        if (this.animationFrameRequested || doRender) {\r\n            this.animationFrameRequested = false;\r\n            this.checkChange(elapsedFrames);\r\n        }\r\n    }\r\n\r\n    private checkChange (elapsedFrames: number): void {\r\n\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState ||\r\n            this.highResTransformObj.scale !== this.targetTransformObj.scale ||\r\n            this.highResTransformObj.x !== this.targetTransformObj.x ||\r\n            this.highResTransformObj.y !== this.targetTransformObj.y;\r\n\r\n        //update transform\r\n        if (\r\n            !this.doAnimateTranslate &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else if (\r\n            (this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) &&\r\n            (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            this. doAnimateTranslate = false;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else {\r\n            this.reqFrame(); //probably needs another frame\r\n            const blendFactor = Math.min(1, ANIMATION_SPEED * elapsedFrames);\r\n            this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\r\n            this.bgVisible = true; // spare yourself the calculation\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        }\r\n\r\n        if (this.pointer && this.currentMode == TMode.Draw && !this.usesCssCursor) {\r\n            this.svgOverlay.updateCursor({\r\n                x: this.pointer.x,\r\n                y: this.pointer.y,\r\n                isVisible: true\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCursor({isVisible: false});\r\n        }\r\n\r\n\r\n        if (doRender) {\r\n            //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\r\n            this.lastRenderedState = newState;\r\n            const start = performance.now();\r\n            this.render();\r\n            this.renderTime = BB.mix(this.renderTime, performance.now() - start, 0.05);\r\n        }\r\n        //setTimeout(this.checkChange, 100);\r\n\r\n\r\n\r\n        if (doRender) {\r\n\r\n            //console.log('rendertime ms: ', this.renderTime);\r\n        }\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            klCanvas: any; // todo\r\n            width: number;\r\n            height: number;\r\n            onDraw: (val) => void; // todo\r\n            onPick: (rgb: IRGB, isPointerup: boolean) => void;\r\n            onFill: (canvasX: number, canvasY: number) => void;\r\n            onText: (canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onShape: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onViewChange: (e:  IViewChangeEvent) => void;\r\n            onUndo: () => void;\r\n            onRedo: () => void;\r\n        }\r\n    ) {\r\n        const _this = this;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                right: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                cursor: 'crosshair',\r\n                userSelect: 'none',\r\n                colorScheme: 'only light',\r\n            }\r\n        });\r\n        this.klCanvas = p.klCanvas;\r\n        this.onViewChange = p.onViewChange;\r\n        this.renderTargetCanvas = BB.canvas(p.width, p.height);\r\n        this.renderTargetCtx = this.renderTargetCanvas.getContext('2d');\r\n        this.renderWidth = p.width;\r\n        this.renderHeight = p.height;\r\n        this.compositeCanvas = BB.canvas(1, 1); // for drawing klcanvas layer composite\r\n        this.compositeCtx = this.compositeCanvas.getContext('2d');\r\n        this.doResizeCanvas = false;\r\n        this.oldTransformObj = null;\r\n        this.targetTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0\r\n        };\r\n        this.highResTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0\r\n        };\r\n        this.renderedTransformObj = {\r\n            x: null,\r\n            y: null,\r\n            scale: null,\r\n            angle: null\r\n        };\r\n        this.cursorPos = {\r\n            x: 0,\r\n            y: 0\r\n        };\r\n        this.usesCssCursor = false;\r\n        this.bgVisible = true;\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n\r\n        this.svgOverlay = new WorkspaceSvgOverlay({\r\n            width: p.width,\r\n            height: p.height\r\n        });\r\n\r\n        BB.css(this.renderTargetCanvas, {\r\n            userSelect: 'none',\r\n            pointerEvents: 'none',\r\n        });\r\n        BB.createCheckerDataUrl(8, (url) => {\r\n            this.renderTargetCanvas.style.background = \"url(\" + url + \")\";\r\n        });\r\n        this.rootEl.appendChild(this.renderTargetCanvas);\r\n        this.rootEl.appendChild(this.svgOverlay.getElement());\r\n        BB.addEventListener(this.rootEl, 'touchend', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        BB.addEventListener(this.rootEl, 'contextmenu', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        BB.addEventListener(this.rootEl, 'dragstart', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n\r\n        this.emptyCanvas = BB.canvas(1, 1);\r\n        {\r\n            const ctx = this.emptyCanvas.getContext('2d');\r\n            ctx.fillRect(0, 0, 1, 1);\r\n        }\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n                if (isRepeat) {\r\n                    return;\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n\r\n                } else {\r\n\r\n                    if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'space') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.spaceHand;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ([TMode.Draw, TMode.Hand, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'alt') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.altPicker;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if (['r', 'shift+r'].includes(comboStr)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.rotate;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ('z' === comboStr) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.zoom;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                }\r\n\r\n            },\r\n            onUp: (keyStr, event, oldComboStr) => {\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.currentMode = TMode.Draw;\r\n        this.globalMode = TMode.Draw;\r\n\r\n        this.renderTime = 0;\r\n\r\n        this.lastDrawEvent = null;\r\n\r\n        this.linetoolProcessor = new BB.EventChain.LinetoolProcessor({\r\n            onDraw: (event) => {\r\n                const getMatrix = () => {\r\n                    const art = this.getRenderedTransform();\r\n                    let matrix = BB.Matrix.getIdentity();\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n                    return matrix;\r\n                };\r\n\r\n                if (event.type === 'line' && !this.lastDrawEvent) {\r\n                    const matrix = getMatrix();\r\n                    let coords = [event.x1, event.y1, 0, 1];\r\n                    coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                    this.lastDrawEvent = {\r\n                        x: coords[0],\r\n                        y: coords[1],\r\n                        pressure: event.pressure1\r\n                    };\r\n                    return;\r\n                }\r\n\r\n                if ('x' in event || 'x0' in event) {\r\n\r\n                    const matrix = getMatrix();\r\n\r\n                    if ('x' in event) { //down or move\r\n                        let coords = [event.x, event.y, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x = coords[0];\r\n                        event.y = coords[1];\r\n                    }\r\n                    if ('x0' in event) { //line\r\n                        event.x0 = this.lastDrawEvent.x;\r\n                        event.y0 = this.lastDrawEvent.y;\r\n                        event.pressure0 = this.lastDrawEvent.pressure;\r\n                        let coords = [event.x1, event.y1, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x1 = coords[0];\r\n                        event.y1 = coords[1];\r\n\r\n                        this.lastDrawEvent = {\r\n                            x: event.x1,\r\n                            y: event.y1,\r\n                            pressure: event.pressure1,\r\n                        };\r\n                    }\r\n                }\r\n\r\n\r\n                if (['down', 'move'].includes(event.type)) {\r\n                    this.lastDrawEvent = event;\r\n                }\r\n                p.onDraw(event);\r\n            }\r\n        });\r\n\r\n        this.pointer = null;\r\n        this.isDrawing = false;\r\n\r\n\r\n        this.inputProcessorObj = {\r\n            draw: {\r\n                onPointer: (val) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Draw);\r\n\r\n                    const comboStr = this.keyListener.getComboStr();\r\n\r\n                    const event: any = {\r\n                        scale: this.highResTransformObj.scale\r\n                    };\r\n                    event.shiftIsPressed = comboStr === 'shift';\r\n                    event.pressure = val.pressure;\r\n                    event.isCoalesced = !!val.isCoalesced;\r\n\r\n                    if (val.type === 'pointerdown') {\r\n\r\n                        this.isDrawing = true;\r\n                        event.type = 'down';\r\n\r\n                    } else if (val.button) {\r\n                        event.type = 'move';\r\n\r\n                    } else if (val.type === 'pointerup') {\r\n\r\n                        this.isDrawing = false;\r\n                        event.type = 'up';\r\n\r\n                        this.linetoolProcessor.process(event);\r\n                        this.resetInputProcessor();\r\n                        return;\r\n                    } else {\r\n                        return;\r\n                    }\r\n\r\n                    event.x = val.relX;\r\n                    event.y = val.relY;\r\n\r\n                    this.linetoolProcessor.process(event);\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            fill: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Fill);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            text: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Text);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            shape: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Shape);\r\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        this.isDrawing = true;\r\n                        p.onShape('down', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        p.onShape('move', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.isDrawing = false;\r\n                        p.onShape('up', coord.x, coord.y, this.renderedTransformObj.angle);\r\n                        this.resetInputProcessor();\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            hand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            spaceHand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'space') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                }\r\n            },\r\n            zoom: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Zoom);\r\n\r\n                    if (event.button === 'left' && !event.isCoalesced && event.dX != 0) {\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n\r\n                        this.internalZoomByStep(event.dX / 175, event.downPageX - offsetX, event.downPageY - offsetY);\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'z') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Zoom);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                }\r\n            },\r\n            picker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup'\r\n                        });\r\n\r\n                        if (event.type === 'pointerup') {\r\n                            this.resetInputProcessor();\r\n                        }\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            altPicker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup'\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'alt') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                }\r\n            },\r\n            rotate: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(event.button === 'left' ? TMode.Rotating : TMode.Rotate);\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                    } else if (event.button === 'left' && !event.isCoalesced && this.oldTransformObj) {\r\n\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n                        //rotation done around center\r\n                        const centerObj = {\r\n                            x: this.renderWidth / 2,\r\n                            y: this.renderHeight / 2\r\n                        };\r\n\r\n                        const startAngleRad = BB.Vec2.angle(centerObj, {x: event.downPageX - offsetX, y: event.downPageY - offsetY});\r\n                        const angleRad = BB.Vec2.angle(centerObj, {x: event.pageX - offsetX, y: event.pageY - offsetY});\r\n                        let dAngleRad = angleRad - startAngleRad;\r\n\r\n                        //apply angle\r\n                        this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\r\n                        this.targetTransformObj.angle += dAngleRad;\r\n\r\n                        if (this.keyListener.isPressed('shift')) {\r\n                            this.targetTransformObj.angle = Math.round(this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\r\n                            dAngleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n                        }\r\n\r\n                        this.targetTransformObj.angle = this.minimizeAngleRad(this.targetTransformObj.angle);\r\n\r\n                        //rotate transform.xy\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(dAngleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n\r\n                        this.transformIsDirty = true;\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['angle'],\r\n                            scale: this.targetTransformObj.scale,\r\n                            angle: this.targetTransformObj.angle\r\n                        });\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    const comboStr = this.keyListener.getComboStr();\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        this.currentInputProcessor = null;\r\n\r\n\r\n        this.angleIsExtraSticky = false;\r\n        this.pinchZoomer = new BB.EventChain.PinchZoomer({\r\n            onPinch: (event) => {\r\n\r\n                if (event.type === 'move') {\r\n\r\n                    if (!this.oldTransformObj) {\r\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.angleIsExtraSticky = this.targetTransformObj.angle % (Math.PI / 2) === 0;\r\n                    }\r\n\r\n                    this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\r\n\r\n                    event.scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, this.targetTransformObj.scale * event.scale)) / this.targetTransformObj.scale;\r\n\r\n                    this.targetTransformObj.scale *= event.scale;\r\n                    this.targetTransformObj.angle += event.angleRad;\r\n                    this.targetTransformObj.angle = this.minimizeAngleRad(\r\n                        this.snapAngleRad(\r\n                            this.targetTransformObj.angle,\r\n                            90,\r\n                            this.angleIsExtraSticky ? 12 : 4\r\n                        )\r\n                    );\r\n                    if (this.targetTransformObj.angle % (Math.PI / 2) !== 0) {\r\n                        this.angleIsExtraSticky = false;\r\n                    }\r\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\r\n                    event.angleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n\r\n                    //calc translation\r\n                    {\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX, event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(event.scale));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(event.angleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-event.relX, -event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\r\n\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                    }\r\n\r\n                    this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n\r\n                    //if (event.scale !== 1) {\r\n                    this.onViewChange({\r\n                        changed: ['scale', 'angle'],\r\n                        scale: this.targetTransformObj.scale,\r\n                        angle: this.targetTransformObj.angle\r\n                    });\r\n                    //}\r\n                    this.reqFrame();\r\n                    this.transformIsDirty = true;\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                } else if (event.type === 'end') {\r\n                    this.oldTransformObj = null;\r\n                }\r\n\r\n\r\n            }\r\n        });\r\n\r\n        const onDoubleTap = () => {\r\n            let oldTransform = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n            _this.fitView();\r\n            //_this.resetView(true);\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n\r\n            if (\r\n                oldTransform.scale !== this.targetTransformObj.scale ||\r\n                oldTransform.angle !== this.targetTransformObj.angle\r\n            ) {\r\n                this.onViewChange({\r\n                    changed: ['scale', 'angle'],\r\n                    angle: this.targetTransformObj.angle,\r\n                    scale: this.targetTransformObj.scale\r\n                });\r\n            }\r\n        }\r\n\r\n        this.mainDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper.setAllowedButtonArr(['middle']);\r\n\r\n\r\n        this.twoFingerTap = new BB.EventChain.NFingerTapper({\r\n            fingers: 2,\r\n            onTap: () => {\r\n                p.onUndo();\r\n            }\r\n        });\r\n        this.threeFingerTap = new BB.EventChain.NFingerTapper({\r\n            fingers: 3,\r\n            onTap: () => {\r\n                p.onRedo();\r\n            }\r\n        });\r\n\r\n\r\n        this.pointerEventChain = new BB.EventChain.EventChain({\r\n            chainArr: [\r\n                this.twoFingerTap,\r\n                this.threeFingerTap,\r\n                this.mainDoubleTapper,\r\n                this.middleDoubleTapper,\r\n                this.pinchZoomer,\r\n                new BB.EventChain.OnePointerLimiter(),\r\n                new BB.EventChain.CoalescedExploder()\r\n            ]\r\n        });\r\n        this.pointerEventChain.setChainOut((event) => {\r\n\r\n            this.cursorPos.x = event.relX;\r\n            this.cursorPos.y = event.relY;\r\n            if (event.type === 'pointerup' && event.pointerType === 'touch') {\r\n                this.pointer = null;\r\n                this.lastRenderedState = -1;\r\n                this.reqFrame();\r\n            } else {\r\n                if (!this.pointer) {\r\n                    this.pointer = { x: 0, y: 0 };\r\n                }\r\n                this.pointer.x = event.relX;\r\n                this.pointer.y = event.relY;\r\n            }\r\n\r\n            if (this.currentInputProcessor) {\r\n                this.currentInputProcessor.onPointer(event);\r\n\r\n            } else {\r\n\r\n                let comboStr = this.keyListener.getComboStr();\r\n\r\n                if (this.globalMode === TMode.Draw) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.draw;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Draw);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Hand) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'middle'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Pick) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'right'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Fill) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.fill;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Fill);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Text) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.text;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Text);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Shape) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.shape;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Shape);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n        });\r\n\r\n        //prevent ctrl scroll -> zooming page\r\n        BB.addEventListener(this.rootEl, 'wheel', (event) => {\r\n            event.preventDefault();\r\n        });\r\n\r\n\r\n        setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.rootEl,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    if (e.type === 'pointerdown' && e.button === 'middle') {\r\n                        try {\r\n                            e.eventPreventDefault();\r\n                        } catch (e) {}\r\n                    }\r\n                    /*if (e.type === 'pointermove') {\r\n                        BB.throwOut(JSON.stringify(e));\r\n                    }*/\r\n\r\n                    this.pointerEventChain.chainIn(e)\r\n                },\r\n                onWheel: (wheelEvent) => {\r\n\r\n                    if (this.isDrawing) {\r\n                        return;\r\n                    }\r\n\r\n                    this.reqFrame();\r\n                    let didZoom = this.internalZoomByStep(\r\n                        -wheelEvent.deltaY / (this.keyListener.isPressed('shift') ? 8 : 2),\r\n                        wheelEvent.relX,\r\n                        wheelEvent.relY\r\n                    );\r\n                    if (didZoom) {\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale\r\n                        });\r\n                    }\r\n\r\n                    //updateCursor(TMode.Draw, true);\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                },\r\n                onEnterLeave: (isOver) => {\r\n                    if (!isOver) {\r\n                        if (!this.isDrawing) {\r\n                            this.pointer = null;\r\n                            this.lastRenderedState = -1;\r\n                        }\r\n                    }\r\n                },\r\n                maxPointers: 4\r\n            });\r\n        }, 1);\r\n\r\n        this.brushRadius = 1;\r\n\r\n        this.animationFrameRequested = false;\r\n\r\n\r\n\r\n\r\n        //setup rendering\r\n        this.lastRenderedState = -2;\r\n        this.lastRenderTime = performance.now();\r\n\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n\r\n        this.resetView();\r\n    }\r\n\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setCanvas (klC: KlCanvas): void {\r\n        this.klCanvas = klC;\r\n        this.lastDrawEvent = null;\r\n        this.resetView();\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    /**\r\n     * set size of workspace area in pixels\r\n     * @param width\r\n     * @param height\r\n     */\r\n    setSize (width: number, height: number): void {\r\n        const oldWidth = this.renderWidth;\r\n        const oldHeight = this.renderHeight;\r\n\r\n        if (width === oldWidth && height === oldHeight) {\r\n            return;\r\n        }\r\n\r\n        this.doResizeCanvas = true;\r\n        this.renderWidth = width;\r\n        this.renderHeight = height;\r\n\r\n        this.svgOverlay.setSize(width, height);\r\n\r\n        this.targetTransformObj.x += (width - oldWidth) / 2;\r\n        this.targetTransformObj.y += (height - oldHeight) / 2;\r\n\r\n        this.highResTransformObj.x = this.targetTransformObj.x;\r\n        this.highResTransformObj.y = this.targetTransformObj.y;\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setMode (modeStr: TModeStr): void {\r\n        //only sets the base mode\r\n        if (modeStr === 'draw') {\r\n            this.globalMode = TMode.Draw;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'fill') {\r\n            this.globalMode = TMode.Fill;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'text') {\r\n            this.globalMode = TMode.Text;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'shape') {\r\n            this.globalMode = TMode.Shape;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'hand') {\r\n            this.globalMode = TMode.Hand;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n        }\r\n        if (modeStr === 'pick') {\r\n            this.globalMode = TMode.Pick;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n    }\r\n\r\n    setEnabled (b: boolean): void {\r\n        // todo\r\n    }\r\n\r\n    setCursorSize (diameter: number): void {\r\n        this.brushRadius = diameter / 2;\r\n\r\n        this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n\r\n        if (this.pointer === null) {\r\n            clearTimeout(this.hideBrushCursorTimeout);\r\n\r\n            this.svgOverlay.updateCursor({\r\n                x: this.renderWidth / 2,\r\n                y: this.renderHeight / 2,\r\n                isVisible: true\r\n            });\r\n\r\n            // @ts-ignore\r\n            this.hideBrushCursorTimeout = setTimeout(() => {\r\n                if (this.pointer !== null) {\r\n                    return;\r\n                }\r\n                this.svgOverlay.updateCursor({isVisible: false});\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n    zoomByStep (stepNum: number): void {\r\n        if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) {\r\n            return;\r\n        }\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale'],\r\n            angle: this.targetTransformObj.angle,\r\n            scale: this.targetTransformObj.scale\r\n        });\r\n    }\r\n\r\n    resetView (doAnimate?: boolean): void {\r\n        this.targetTransformObj.scale = 1;\r\n        this.targetTransformObj.angle = 0;\r\n\r\n        this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\r\n        this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\r\n\r\n        if (!doAnimate) {\r\n            this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n        } else {\r\n            this.doAnimateTranslate = true;\r\n            this.transformIsDirty = true;\r\n        }\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n        this.reqFrame();\r\n\r\n        if (doAnimate) {\r\n            this.onViewChange({\r\n                changed: ['scale', 'angle'],\r\n                scale: this.targetTransformObj.scale,\r\n                angle: this.targetTransformObj.angle\r\n            });\r\n        }\r\n    }\r\n\r\n    fitView (): void {\r\n        //fit into view. center. keep angle. margin of 10px\r\n\r\n        //calc width and height of bounds\r\n        const canvasPointsArr = [\r\n            [0, 0], // top left\r\n            [this.klCanvas.getWidth(), 0], // top right\r\n            [this.klCanvas.getWidth(), this.klCanvas.getHeight()], // bottom right\r\n            [0, this.klCanvas.getHeight()], // bottom left\r\n            [this.klCanvas.getWidth() / 2, this.klCanvas.getHeight() / 2], // center\r\n        ];\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle));\r\n\r\n        //rotate points\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            let coords = [canvasPointsArr[i][0], canvasPointsArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n            canvasPointsArr[i][0] = coords[0];\r\n            canvasPointsArr[i][1] = coords[1];\r\n        }\r\n\r\n        const boundsObj = {\r\n            x0: null,\r\n            y0: null,\r\n            x1: null,\r\n            y1: null\r\n        };\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            if (boundsObj.x0 === null || canvasPointsArr[i][0] < boundsObj.x0) {\r\n                boundsObj.x0 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y0 === null || canvasPointsArr[i][1] < boundsObj.y0) {\r\n                boundsObj.y0 = canvasPointsArr[i][1];\r\n            }\r\n            if (boundsObj.x1 === null || canvasPointsArr[i][0] > boundsObj.x1) {\r\n                boundsObj.x1 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y1 === null || canvasPointsArr[i][1] > boundsObj.y1) {\r\n                boundsObj.y1 = canvasPointsArr[i][1];\r\n            }\r\n        }\r\n        const boundsWidth = boundsObj.x1 - boundsObj.x0;\r\n        const boundsHeight = boundsObj.y1 - boundsObj.y0;\r\n\r\n        //fit bounds\r\n        const padding = 40;\r\n        const { width: fitWidth } = BB.fitInto(\r\n            boundsWidth,\r\n            boundsHeight, \r\n            this.renderWidth - padding, \r\n            this.renderHeight - padding, \r\n            1\r\n        );\r\n\r\n        //determine scale\r\n        const factor = fitWidth / boundsWidth;\r\n\r\n        //center\r\n        this.targetTransformObj.x = (this.renderWidth / 2) - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor;\r\n        this.targetTransformObj.y = (this.renderHeight / 2) - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor;\r\n\r\n        this.targetTransformObj.scale = factor;\r\n        this.doAnimateTranslate = true;\r\n        this.transformIsDirty = true;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale', 'angle'],\r\n            scale: this.targetTransformObj.scale,\r\n            angle: this.targetTransformObj.angle\r\n        });\r\n    }\r\n\r\n    setAngle (angleDeg: number, isRelative?: boolean): void {\r\n        //rotation done around center\r\n        const centerObj = {\r\n            x: this.renderWidth / 2,\r\n            y: this.renderHeight / 2\r\n        };\r\n\r\n        const oldAngleRad = this.targetTransformObj.angle;\r\n        const angleRad = angleDeg / 180 * Math.PI;\r\n\r\n        if (isRelative) {\r\n            this.targetTransformObj.angle += angleRad;\r\n        } else {\r\n            this.targetTransformObj.angle = angleRad;\r\n        }\r\n\r\n        this.targetTransformObj.angle = this.minimizeAngleRad(\r\n            this.snapAngleRad(\r\n                this.targetTransformObj.angle,\r\n                90,\r\n                4\r\n            )\r\n        );\r\n\r\n        //rotate transform.xy\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n        this.transformIsDirty = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    /**\r\n     * translate canvas by viewport pixels\r\n     * @param tx\r\n     * @param ty\r\n     */\r\n    translateView (tx: number, ty: number): void {\r\n        const scale = 40;\r\n\r\n        this.targetTransformObj.x += tx * scale;\r\n        this.targetTransformObj.y += ty * scale;\r\n\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    getScale (): number {\r\n        return this.targetTransformObj.scale;\r\n    }\r\n\r\n    getAngleDeg (): number {\r\n        return this.targetTransformObj.angle * 180 / Math.PI;\r\n    }\r\n\r\n    getMaxScale (): number {\r\n        return MAX_SCALE;\r\n    }\r\n\r\n    getMinScale (): number {\r\n        return MIN_SCALE;\r\n    }\r\n\r\n    requestFrame (): void {\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setLastDrawEvent (x: number | null, y?: number, pressure?: number): void {\r\n        if (x === null) {\r\n            this.lastDrawEvent = null;\r\n            return;\r\n        }\r\n\r\n        if (!this.lastDrawEvent) {\r\n            this.lastDrawEvent = {x: 0, y: 0, pressure: 0};\r\n        }\r\n        this.lastDrawEvent.x = x;\r\n        this.lastDrawEvent.y = y;\r\n        this.lastDrawEvent.pressure = pressure;\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1dLwT\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"9wZxU\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hQSEH\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"916ZI\");","import {BB} from '../../bb/bb';\r\nimport {IKlBasicLayer} from '../kl.types';\r\n\r\n/**\r\n * preview of image with layers. can do mix modes and opacity.\r\n * creates a canvas.\r\n *\r\n * p = {\r\n *     width: 123,\r\n *     height: 123,\r\n *     layers: [// can be changed after the fact\r\n *         {\r\n *             image: Canvas,\r\n *             opacity: 1,\r\n *             mixModeStr: 'source-over'\r\n *         }\r\n *     ]\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function KlCanvasPreview(\r\n    p: {\r\n        width: number;\r\n        height: number;\r\n        layers: IKlBasicLayer[];\r\n    }\r\n) {\r\n    const scale = p.width / p.layers[0].image.width;\r\n    const width = scale > 1 ? p.layers[0].image.width : p.width;\r\n    const height = scale > 1 ? p.layers[0].image.height : p.height;\r\n\r\n    let canvas = BB.canvas(width, height);\r\n    canvas.style.backgroundImage = 'url(' + BB.createCheckerDataUrl(8) + ')';\r\n    let ctx = canvas.getContext('2d');\r\n\r\n    BB.css(canvas, {\r\n        width: '100%',\r\n        height: '100%',\r\n        imageRendering: scale > 1 ? 'pixelated' : null,\r\n    });\r\n\r\n    function render() {\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        for (let i = 0; i < p.layers.length; i++) {\r\n            ctx.globalAlpha = p.layers[i].opacity;\r\n            ctx.globalCompositeOperation = p.layers[i].mixModeStr;\r\n            if (canvas.width > p.layers[i].image.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(p.layers[i].image, 0, 0, canvas.width, canvas.height);\r\n        }\r\n        ctx.restore();\r\n    }\r\n\r\n    setTimeout(render, 0);\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return canvas;\r\n    };\r\n\r\n    this.render = function() {\r\n        render();\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport rotateImg from 'url:~/src/app/img/ui/cursor-rotate.png';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {IVector2D} from '../../../bb/bb.types';\r\n\r\nexport interface ITransform {\r\n    x: number; // center of transform region. image space\r\n    y: number;\r\n    width: number; // size of transform region. image space\r\n    height: number;\r\n    angleDeg: number; // angle of transform region. degrees\r\n}\r\n\r\n\r\n/**\r\n * snap entire transform to pixel grid. changes transform\r\n *\r\n * for x y:\r\n * If a dimension has an even size, it be an integer.\r\n * If it's uneven, it's sits exactly half way between two pixels.\r\n *\r\n * @param transform\r\n */\r\nfunction snapToPixel(transform: ITransform): void {\r\n    if (Math.abs(transform.angleDeg) % 90 !== 0) {\r\n        return;\r\n    }\r\n\r\n    transform.width = Math.round(transform.width);\r\n    transform.height = Math.round(transform.height);\r\n    // 0 is original orientation.\r\n    // At 90 and 270 width and height become swapped due to different orientation.\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    transform.x = ((whSwapped ? transform.height : transform.width) % 2 === 0) ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\r\n    transform.y = ((whSwapped ? transform.width : transform.height) % 2 === 0)  ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\r\n}\r\n\r\nfunction copyTransform(transform: ITransform): ITransform {\r\n    return {\r\n        x: transform.x,\r\n        y: transform.y,\r\n        width: transform.width,\r\n        height: transform.height,\r\n        angleDeg: transform.angleDeg,\r\n    };\r\n}\r\n\r\n/**\r\n * image space to transform space\r\n * - origin of transform space is at center of transform bounds.\r\n * - same scale as image space. -> one unit is x: 1/width, y: 1/height\r\n * - up is where transform points up\r\n * - x goes right\r\n * - y goes down\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nfunction toTransformSpace (x: number, y: number, transform: ITransform): IVector2D {\r\n    let px, py;\r\n    px = x - transform.x;\r\n    py = y - transform.y;\r\n\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: px, y: py},\r\n        -transform.angleDeg);\r\n    px = rot.x;\r\n    py = rot.y;\r\n\r\n    return {\r\n        x: px,\r\n        y: py,\r\n    };\r\n}\r\n\r\n/**\r\n * transform space to image space\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nfunction toImageSpace(x: number, y: number, transform: ITransform): IVector2D {\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: x, y: y},\r\n        transform.angleDeg);\r\n    return {\r\n        x: rot.x + transform.x,\r\n        y: rot.y + transform.y,\r\n    };\r\n}\r\n\r\n\r\n\r\n/**\r\n * Free Transform UI\r\n * rotate, scale, translate\r\n *\r\n * - if rotation is multiple of 90 it will snap to pixels, to be more useful for pixel art\r\n * - when rotation goes from non-multiple of 90 to a multiple, it will snap position and width height to pixels\r\n * - transform.x, transform.y can sit between pixels (by 0.5) if width or height is odd number.\r\n *      - this is what complicates things\r\n * - if transform region small, corner grips move out of the way\r\n *\r\n * iX iY, iP.x, iP.y - i indicates image space\r\n * tX tY, tP.x, tP.y - t indicates transform space\r\n *\r\n * Not sure if can be used for navigable canvas. (especially if canvas rotates view)\r\n * Probably can't be extended for distort. Needs a different approach.\r\n *\r\n * --- DOM structure ---\r\n * rootEl {\r\n * \ttransEl [\r\n * \t\tboundsEl\r\n * \t\tedges[]\r\n * \t\tcorners[] - round grips in the corner of transform region\r\n * \t\tangleGrip\r\n * \t]\r\n * }\r\n *\r\n */\r\nexport class FreeTransform {\r\n\r\n    // --- private ---\r\n    private readonly transform: ITransform; // coordinates and dimensions of transformation\r\n    private isConstrained: boolean;\r\n    private ratio: number; // aspect ratio of transform\r\n    private readonly scale: number;\r\n    private readonly scaled = { // scaled coordinates and dimensions for screenspace\r\n        x: 0,\r\n        y: 0,\r\n        width: 0,\r\n        height: 0,\r\n        corners: [{x: 0, y: 0}], // in transform space\r\n    };\r\n    private readonly minSnapDist = 7; // minimal snapping distance in px screenspace\r\n    private snappingEnabled: boolean;\r\n    private readonly snapX: number[];\r\n    private readonly snapY: number[];\r\n    private readonly callback: (transform: ITransform) => void;\r\n\r\n\r\n    private readonly cornerCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n    private readonly gripSize = 14;\r\n    private readonly edgeSize = 10;\r\n\r\n    private readonly rootEl: HTMLElement; // sits at origin of image\r\n    private readonly transEl: HTMLElement; // at middle of transform. rotates\r\n    private readonly boundsEl: HTMLElement; // draggable bounds rectangle with outline\r\n    private readonly corners: {\r\n        i: number; // index in corners array\r\n        el: HTMLElement; // draggable corner circle in DOM\r\n        x: number; // unscaled position (transform space)\r\n        y: number;\r\n        virtualPos: IVector2D; // unscaled temporary position (image space)\r\n        updateDOM: () => void; // update styling in DOM\r\n        pointerListener: any;\r\n    }[] = [];\r\n    private keyListener: KeyListener;\r\n    private boundsPointerListener: any; // BB.PointerListener\r\n    private anglePointerListener: any; // BB.PointerListener\r\n    private readonly edges: { // derive position from corners\r\n        el: HTMLElement;\r\n        updateDOM: () => void;\r\n        pointerListener: any;\r\n    }[] = [];\r\n    private readonly angleGrip: {\r\n        el: HTMLElement,\r\n        x: number; // transform space\r\n        y: number;\r\n        snap: boolean,\r\n        updateDOM: () => void,\r\n    };\r\n\r\n    private updateScaled(): void {\r\n        this.scaled.x = this.transform.x * this.scale;\r\n        this.scaled.y = this.transform.y * this.scale;\r\n        this.scaled.width = this.transform.width * this.scale;\r\n        this.scaled.height = this.transform.height * this.scale;\r\n        this.scaled.corners = this.corners.map((item) => {\r\n            return {x: item.x * this.scale, y: item.y * this.scale};\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\r\n     * both in image space\r\n     *\r\n     * @param iX - image space\r\n     * @param iY - image space\r\n     * @private\r\n     */\r\n    private snapCorner (iX: number, iY: number): IVector2D {\r\n        if (!this.snappingEnabled) {\r\n            return {x: iX, y: iY};\r\n        }\r\n        let dist: number;\r\n        const snap: {\r\n            x: number;\r\n            y: number;\r\n            dist: {\r\n                x: number;\r\n                y: number;\r\n            }\r\n        } = {\r\n            x: null,\r\n            y: null,\r\n            dist: {\r\n                x: null,\r\n                y: null,\r\n            }\r\n        };\r\n        for (let e = 0; e < this.snapX.length; e++) {\r\n            dist = Math.abs(iX - this.snapX[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.x === null || dist < snap.dist.x) {\r\n                    snap.x = this.snapX[e];\r\n                    snap.dist.x = dist;\r\n                }\r\n            }\r\n        }\r\n        for (let e = 0; e < this.snapY.length; e++) {\r\n            dist = Math.abs(iY - this.snapY[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.y === null || dist < snap.dist.y) {\r\n                    snap.y = this.snapY[e];\r\n                    snap.dist.y = dist;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (snap.x === null && snap.y === null) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        return {\r\n            x: snap.x ?? iX,\r\n            y: snap.y ?? iY,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * If constrained return nearest corner pos that fits aspect ratio\r\n     *\r\n     * @param cornerIndex\r\n     * @param iX\r\n     * @param iY\r\n     * @private\r\n     */\r\n    private constrainCorner (cornerIndex: number, iX: number, iY: number): IVector2D {\r\n        if (!this.isConstrained) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        const flip = this.transform.width * this.transform.height < 0 ? -1 : 1;\r\n        return BB.projectPointOnLine(\r\n            {x: this.transform.x, y: this.transform.y},\r\n            toImageSpace(this.ratio, flip * ([0, 2].includes(cornerIndex) ? 1 : -1), this.transform),\r\n            {x: iX, y: iY}\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Update corners according to width height.\r\n     * Not their DOM.\r\n     */\r\n    private updateCornerPositions (): void {\r\n        this.corners[0].x = (-this.transform.width / 2); // top left\r\n        this.corners[0].y = (-this.transform.height / 2);\r\n\r\n        this.corners[1].x = (this.transform.width / 2); // top right\r\n        this.corners[1].y = (-this.transform.height / 2);\r\n\r\n        this.corners[2].x = (this.transform.width / 2); // bottom right\r\n        this.corners[2].y = (this.transform.height / 2);\r\n\r\n        this.corners[3].x = (-this.transform.width / 2); // bottom left\r\n        this.corners[3].y = (this.transform.height / 2);\r\n    }\r\n\r\n    /**\r\n     * If constrained and dragging an edge, restore aspect ratio\r\n     * Updates corner positions.\r\n     *\r\n     * @param widthChanged\r\n     * @param heightChanged\r\n     * @private\r\n     */\r\n    private restoreRatio (widthChanged: boolean, heightChanged: boolean): void {\r\n        if (!this.isConstrained) {\r\n            return;\r\n        }\r\n        const angle90 = Math.abs(this.transform.angleDeg) % 90 === 0;\r\n        const whSwapped = Math.abs(this.transform.angleDeg - 90) % 180 === 0;\r\n        if (heightChanged && !widthChanged) {\r\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\r\n            let newWidth = this.ratio * newHeight;\r\n            if (angle90) {\r\n                newWidth = (whSwapped ? this.transform.y % 1 : this.transform.x % 1) === 0 ?\r\n                    BB.roundEven(newWidth) : BB.roundUneven(newWidth);\r\n            }\r\n            if (this.corners[1].x - this.corners[0].x < 0) {\r\n                newWidth *= -1;\r\n            }\r\n            this.corners[0].x = -newWidth / 2;\r\n            this.corners[3].x = -newWidth / 2;\r\n            this.corners[1].x = newWidth / 2;\r\n            this.corners[2].x = newWidth / 2;\r\n        }\r\n        if (!heightChanged && widthChanged) {\r\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\r\n            let newHeight = newWidth / this.ratio;\r\n            if (angle90) {\r\n                newHeight = (whSwapped ? this.transform.x % 1 : this.transform.y % 1) === 0  ?\r\n                    BB.roundEven(newHeight) : BB.roundUneven(newHeight);\r\n            }\r\n            if (this.corners[3].y - this.corners[0].y < 0) {\r\n                newHeight *= -1;\r\n            }\r\n            this.corners[0].y = -newHeight / 2;\r\n            this.corners[1].y = -newHeight / 2;\r\n            this.corners[2].y = newHeight / 2;\r\n            this.corners[3].y = newHeight / 2;\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * update transform based on corners\r\n     * @private\r\n     */\r\n    private updateTransformViaCorners (): void {\r\n\r\n        // calc transform center in image space\r\n        const rot = BB.rotateAround(\r\n            {x: 0, y: 0},\r\n            {\r\n                x: (this.corners[0].x + this.corners[1].x) / 2,\r\n                y: (this.corners[0].y + this.corners[3].y) / 2,\r\n            },\r\n            this.transform.angleDeg\r\n        );\r\n        this.transform.x = rot.x + this.transform.x;\r\n        this.transform.y = rot.y + this.transform.y;\r\n\r\n        // update size\r\n        this.transform.width = this.corners[1].x - this.corners[0].x;\r\n        this.transform.height = this.corners[3].y - this.corners[0].y;\r\n\r\n        // new center means corners changed their position\r\n        this.updateCornerPositions();\r\n\r\n        this.updateDOM();\r\n    }\r\n\r\n    /**\r\n     * updates DOM according to transform\r\n     * @param skipCallback\r\n     */\r\n    private updateDOM (skipCallback?: boolean) {\r\n        this.updateScaled();\r\n\r\n        BB.css(this.transEl, {\r\n            left: this.scaled.x + \"px\",\r\n            top: this.scaled.y + \"px\",\r\n            transformOrigin: \"0 0\",\r\n            transform: \"rotate(\" + this.transform.angleDeg + \"deg)\",\r\n        });\r\n\r\n        BB.css(this.boundsEl, {\r\n            width: Math.abs(this.scaled.width) + \"px\",\r\n            height: Math.abs(this.scaled.height) + \"px\",\r\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + \"px\",\r\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + \"px\"\r\n        });\r\n\r\n        this.corners[0].updateDOM();\r\n        this.corners[1].updateDOM();\r\n        this.corners[2].updateDOM();\r\n        this.corners[3].updateDOM();\r\n\r\n        this.edges[0].updateDOM();\r\n        this.edges[1].updateDOM();\r\n        this.edges[2].updateDOM();\r\n        this.edges[3].updateDOM();\r\n\r\n\r\n        this.angleGrip.x = 0;\r\n        this.angleGrip.y = (-Math.abs(this.transform.height * this.scale) / 2) - 20;\r\n        this.angleGrip.updateDOM();\r\n        if (!skipCallback) {\r\n            if (this.callback) { // why should updateDOM trigger the callback?\r\n                this.callback(copyTransform(this.transform));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // --- public ---\r\n    constructor (\r\n        params: {\r\n            x: number; // center of transform region. image space\r\n            y: number;\r\n            width: number; // size of transform region. image space\r\n            height: number;\r\n            angleDeg: number; // angle of transform region. degrees\r\n\r\n            isConstrained: boolean; // proportions constrained\r\n            snapX: number[]; // where snapping along X axis. image space\r\n            snapY: number[]; // where snapping along X axis. image space\r\n            scale: number; // ratio of screen-space / image-space\r\n            callback: (transform: ITransform) => void;\r\n        }\r\n    ) {\r\n        this.transform = { // coordinates and dimensions of transformation\r\n            x: params.x,\r\n            y: params.y,\r\n            width: params.width,\r\n            height: params.height,\r\n            angleDeg: params.angleDeg,\r\n        };\r\n\r\n        this.isConstrained = !!params.isConstrained;\r\n\r\n        this.snapX = params.snapX;\r\n        this.snapY = params.snapY;\r\n        this.callback = params.callback;\r\n        this.scale = params.scale;\r\n        this.snappingEnabled = true;\r\n        this.ratio = this.transform.width / this.transform.height;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-free-transform',\r\n            css: {\r\n                userSelect: 'none',\r\n            }\r\n        });\r\n        this.transEl = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                position: 'absolute',\r\n            }\r\n        });\r\n\r\n        this.boundsEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                cursor: 'move',\r\n                boxShadow: 'rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px',\r\n            }\r\n        });\r\n\r\n        const pointerRemainder = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        function resetRemainder() {\r\n            pointerRemainder.x = 0;\r\n            pointerRemainder.y = 0;\r\n        }\r\n        this.keyListener = new BB.KeyListener({});\r\n\r\n        let boundsStartP = {\r\n            x: 0,\r\n            y: 0,\r\n        }\r\n        this.boundsPointerListener = new BB.PointerListener({\r\n            target: this.boundsEl,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointerdown') {\r\n                    boundsStartP = {x: this.transform.x, y: this.transform.y};\r\n                }\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    this.transform.x = boundsStartP.x + (event.pageX - event.downPageX) / this.scale;\r\n                    this.transform.y = boundsStartP.y + (event.pageY - event.downPageY) / this.scale;\r\n\r\n\r\n                    let dist;\r\n                    let snap: any = {};\r\n                    if (this.snappingEnabled) {\r\n                        let i;\r\n                        for (i = 0; i < this.snapX.length; i++) {\r\n                            dist = Math.abs(this.transform.x - this.snapX[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.x || dist < snap.distX) {\r\n                                    snap.x = this.snapX[i];\r\n                                    snap.distX = dist;\r\n                                }\r\n                            }\r\n                        }\r\n                        for (i = 0; i < this.snapY.length; i++) {\r\n                            dist = Math.abs(this.transform.y - this.snapY[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.y || dist < snap.distY) {\r\n                                    snap.y = this.snapY[i];\r\n                                    snap.distY = dist;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        let iP;\r\n                        for (i = 0; i < 4; i++) {\r\n                            iP = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n                            let j;\r\n                            for (j = 0; j < this.snapX.length; j++) {\r\n                                dist = Math.abs(iP.x - this.snapX[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.x || dist < snap.distX) {\r\n                                        snap.x = this.snapX[j] - (iP.x - this.transform.x);\r\n                                        snap.distX = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                            for (j = 0; j < this.snapY.length; j++) {\r\n                                dist = Math.abs(iP.y - this.snapY[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.y || dist < snap.distY) {\r\n                                        snap.y = this.snapY[j] - (iP.y - this.transform.y);\r\n                                        snap.distY = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        let projected = BB.projectPointOnLine(\r\n                            {x: 0, y: boundsStartP.y},\r\n                            {x: 10, y: boundsStartP.y},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        let dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        snap = {};\r\n                        snap.x = projected.x;\r\n                        snap.y = projected.y;\r\n                        snap.distX = dist;\r\n                        snap.distY = dist;\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: 0},\r\n                            {x: boundsStartP.x, y: 10},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap.x = projected.x;\r\n                            snap.y = projected.y;\r\n                            snap.distX = dist;\r\n                            snap.distY = dist;\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y + 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap.x = projected.x;\r\n                            snap.y = projected.y;\r\n                            snap.distX = dist;\r\n                            snap.distY = dist;\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y - 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap.x = projected.x;\r\n                            snap.y = projected.y;\r\n                            snap.distX = dist;\r\n                            snap.distY = dist;\r\n                        }\r\n                    }\r\n                    if (snap.x != undefined) {\r\n                        this.transform.x = snap.x;\r\n                    }\r\n                    if (snap.y != undefined) {\r\n                        this.transform.y = snap.y;\r\n                    }\r\n\r\n                    // snap to pixels\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                    }\r\n\r\n                    this.updateDOM();\r\n                }\r\n            }\r\n        })\r\n\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                const g = this.corners[i] = {\r\n                    i: i,\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.gripSize + 'px',\r\n                            height: this.gripSize + 'px',\r\n                            background: '#fff',\r\n                            /*background: [\r\n                                '#ff0000',\r\n                                '#00ff00',\r\n                                '#0000ff',\r\n                                '#ff00ff',\r\n                            ][i],*/\r\n                            borderRadius: this.gripSize + 'px',\r\n                            position: 'absolute',\r\n                            boxShadow: 'inset 0 0 0 2px #000'\r\n                        }\r\n                    }),\r\n                    x: 0,\r\n                    y: 0,\r\n                    virtualPos: {\r\n                        x: 0,\r\n                        y: 0,\r\n                    },\r\n                    updateDOM: null,\r\n                    pointerListener: null,\r\n                };\r\n                g.updateDOM = () => {\r\n\r\n                    // grip position\r\n                    // if gets small, offset grips, so easier to handle\r\n                    const offsetArr = [[-1, -1], [1, -1], [1, 1], [-1, 1]].map(item => {\r\n                        item[0] *= this.transform.width > 0 ? 1 : -1;\r\n                        item[1] *= this.transform.height > 0 ? 1 : -1;\r\n                        return item;\r\n                    });\r\n                    const tinyOffset = Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20 ? 10 : 0;\r\n\r\n                    BB.css(g.el, {\r\n                        left: (this.scaled.corners[g.i].x - this.gripSize / 2 + offsetArr[i][0] * tinyOffset) + 'px',\r\n                        top: (this.scaled.corners[g.i].y - this.gripSize / 2 + offsetArr[i][1] * tinyOffset) + 'px'\r\n                    });\r\n\r\n\r\n                    // cursor\r\n                    let angle = BB.pointsToAngleDeg(\r\n                        {\r\n                            x: this.transform.x,\r\n                            y: this.transform.y,\r\n                        },\r\n                        toImageSpace(g.x, g.y, this.transform),\r\n                    ) + 135; // offset so nw is 0\r\n                    while (angle < 0) {\r\n                        angle += 360;\r\n                    }\r\n                    let index = Math.round(angle / 45) % this.cornerCursors.length;\r\n                    BB.css(g.el, {\r\n                        cursor: this.cornerCursors[index] + '-resize',\r\n                    });\r\n                };\r\n\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.corners[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            this.corners[i].virtualPos = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n\r\n                        } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                            this.corners[i].virtualPos.x += event.dX / this.scale;\r\n                            this.corners[i].virtualPos.y += event.dY / this.scale;\r\n\r\n                            let iP = {\r\n                                x: this.corners[i].virtualPos.x,\r\n                                y: this.corners[i].virtualPos.y,\r\n                            };\r\n                            iP = this.constrainCorner(i, iP.x, iP.y);\r\n                            if (!this.isConstrained) {\r\n                                iP = this.snapCorner(iP.x, iP.y);\r\n                            }\r\n\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                iP.x = Math.round(iP.x);\r\n                                iP.y = Math.round(iP.y);\r\n                            }\r\n\r\n                            const tP = toTransformSpace(iP.x, iP.y, this.transform);\r\n\r\n                            const dX = tP.x - this.corners[i].x;\r\n                            const dY = tP.y - this.corners[i].y;\r\n                            this.corners[i].x = tP.x;\r\n                            this.corners[i].y = tP.y;\r\n\r\n                            let indexes = [];\r\n                            if (i === 0) { // top left\r\n                                indexes = [3, 1, 2];\r\n                            } else if (i === 1) { // top right\r\n                                indexes = [2, 0, 3];\r\n                            } else if (i === 2) { // bottom right\r\n                                indexes = [1, 3, 0];\r\n                            } else if (i === 3) { // bottom left\r\n                                indexes = [0, 2, 1];\r\n                            }\r\n\r\n                            this.corners[indexes[0]].x = this.corners[i].x;\r\n                            this.corners[indexes[1]].y = this.corners[i].y;\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                this.corners[indexes[2]].x -= dX;\r\n                                this.corners[indexes[2]].y -= dY;\r\n                                this.corners[indexes[1]].x = this.corners[indexes[2]].x;\r\n                                this.corners[indexes[0]].y = this.corners[indexes[2]].y;\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    }\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.updateCornerPositions();\r\n        this.updateScaled();\r\n\r\n        let isInverted: boolean;\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                this.edges[i] = {\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.edgeSize + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                            /*background: [\r\n                                '#ff000044',\r\n                                '#00ff0044',\r\n                                '#0000ff44',\r\n                                '#ff00ff44',\r\n                            ][i],*/\r\n                            position: 'absolute',\r\n                        },\r\n                    }),\r\n                    updateDOM: null,\r\n                    pointerListener: null,\r\n                };\r\n                const g = this.edges[i];\r\n                g.updateDOM = () => {\r\n                    if (i === 0) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: (Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) - this.edgeSize) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 1) {\r\n                        BB.css(g.el, {\r\n                            left: Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    } else if (i === 2) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + 'px',\r\n                            top: Math.max(this.scaled.corners[0].y,this.scaled.corners[3].y) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 3) {\r\n                        BB.css(g.el, {\r\n                            left: (Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) - this.edgeSize) + 'px',\r\n                            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    }\r\n                    let angleOffset = Math.round(this.transform.angleDeg / 45);\r\n                    while (angleOffset < 0)\r\n                        angleOffset += 8;\r\n                    angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\r\n                    g.el.style.cursor = this.cornerCursors[angleOffset] + '-resize';\r\n\r\n                };\r\n\r\n                const isVertical = [0, 2].includes(i);\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.edges[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            if (isVertical) { // top bottom\r\n                                isInverted = this.corners[0].y >= this.corners[3].y;\r\n                            } else { // left right\r\n                                isInverted = this.corners[0].x >= this.corners[1].x;\r\n                            }\r\n                            resetRemainder();\r\n                        }\r\n                        if (event.type === 'pointermove' && event.button === 'left') {\r\n                            const tfD = BB.rotateAround({x: 0, y: 0},\r\n                                {x: event.dX / this.scale, y: event.dY / this.scale},\r\n                                -this.transform.angleDeg);\r\n                            let ti = {\r\n                                dX: tfD.x,\r\n                                dY: tfD.y,\r\n                            };\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                ti = BB.intDxy(pointerRemainder, tfD.x, tfD.y);\r\n                            }\r\n\r\n                            let indexes = [];\r\n                            if (i === 0) { // top\r\n                                indexes = [2, 3, 0, 1];\r\n                            } else if (i === 1) { // right\r\n                                indexes = [0, 3, 1, 2];\r\n                            } else if (i === 2) { // bottom\r\n                                indexes = [0, 1, 2, 3];\r\n                            } else if (i === 3) { // left\r\n                                indexes = [1, 2, 0, 3];\r\n                            }\r\n\r\n                            let dimension = isVertical ? 'y' : 'x';\r\n                            let d = isVertical ? ti.dY : ti.dX;\r\n\r\n                            if (isInverted) {\r\n                                this.corners[indexes[0]][dimension] += d;\r\n                                this.corners[indexes[1]][dimension] += d;\r\n                            } else {\r\n                                this.corners[indexes[2]][dimension] += d;\r\n                                this.corners[indexes[3]][dimension] += d;\r\n                            }\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                if (isInverted) {\r\n                                    this.corners[indexes[2]][dimension] -= d;\r\n                                    this.corners[indexes[3]][dimension] -= d;\r\n                                } else {\r\n                                    this.corners[indexes[0]][dimension] -= d;\r\n                                    this.corners[indexes[1]][dimension] -= d;\r\n                                }\r\n                            }\r\n\r\n                            if (isVertical) { // top bottom\r\n                                this.restoreRatio(false, true);\r\n                            } else { // left right\r\n                                this.restoreRatio(true, false);\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    }\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.angleGrip = {\r\n            el: BB.el({\r\n                css: {\r\n                    cursor: 'url(' + rotateImg + ') 10 10, move',\r\n                    width: this.gripSize + 'px',\r\n                    height: this.gripSize + 'px',\r\n                    background: '#0ff',\r\n                    borderRadius: this.gripSize + 'px',\r\n                    position: 'absolute',\r\n                    boxShadow: 'inset 0 0 0 2px #000',\r\n                },\r\n            }),\r\n            x: 0,\r\n            y: 0,\r\n            snap: false,\r\n            updateDOM: () => {\r\n                BB.css(this.angleGrip.el, {\r\n                    left: (this.angleGrip.x - this.gripSize / 2) + 'px',\r\n                    top: (this.angleGrip.y - this.gripSize / 2) + 'px',\r\n                });\r\n            },\r\n        };\r\n        BB.el({\r\n            parent: this.angleGrip.el,\r\n            css: {\r\n                width: '2px',\r\n                height: '13px',\r\n                left: (this.gripSize / 2 - 1) + 'px',\r\n                top: this.gripSize + 'px',\r\n                background: '#0ff',\r\n                position: 'absolute'\r\n            }\r\n        });\r\n\r\n        this.anglePointerListener = new BB.PointerListener({\r\n            target: this.angleGrip.el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    const bounds = this.rootEl.getBoundingClientRect();\r\n                    const offset = {\r\n                        x: bounds.left - this.rootEl.scrollLeft,\r\n                        y: bounds.top - this.rootEl.scrollTop,\r\n                    };\r\n                    const iP = {x: (event.clientX - offset.x) / this.scale, y: (event.clientY - offset.y) / this.scale};\r\n\r\n                    const a = BB.pointsToAngleDeg({x: this.transform.x, y: this.transform.y}, iP) + 90;\r\n                    this.transform.angleDeg = a;\r\n                    const snapDeg = Math.round(a / 360 * 8) * 45;\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    } else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    }\r\n                    this.updateDOM();\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                        this.updateDOM();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        snapToPixel(this.transform);\r\n        this.updateDOM(true);\r\n        BB.append(this.transEl, [\r\n            this.boundsEl,\r\n            this.edges[0].el,\r\n            this.edges[1].el,\r\n            this.edges[2].el,\r\n            this.edges[3].el,\r\n            this.corners[0].el,\r\n            this.corners[1].el,\r\n            this.corners[2].el,\r\n            this.corners[3].el,\r\n            this.angleGrip.el,\r\n        ]);\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    getTransform (): ITransform {\r\n        return copyTransform(this.transform);\r\n    }\r\n\r\n    setConstrained (b: boolean): void {\r\n        this.isConstrained = !!b;\r\n        if (b && this.transform.width !== 0 && this.transform.height !== 0) {\r\n            this.ratio = Math.abs(this.transform.width / this.transform.height);\r\n        }\r\n    }\r\n\r\n    setSnapping (s: boolean): void {\r\n        this.snappingEnabled = !!s;\r\n    }\r\n\r\n    setPos (p: IVector2D): void {\r\n        this.transform.x = p.x;\r\n        this.transform.y = p.y;\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    move (dX: number, dY: number): void {\r\n        this.transform.x += dX;\r\n        this.transform.y += dY;\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setSize (w: number, h: number): void {\r\n        this.transform.width = w;\r\n        this.transform.height = h;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n        }\r\n        this.updateCornerPositions();\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setAngleDeg (a: number): void {\r\n        this.transform.angleDeg = a;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n            this.updateCornerPositions();\r\n        }\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getRatio (): number {\r\n        return this.ratio;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.keyListener.destroy();\r\n        this.boundsPointerListener.destroy();\r\n        this.corners[0].pointerListener.destroy();\r\n        this.corners[1].pointerListener.destroy();\r\n        this.corners[2].pointerListener.destroy();\r\n        this.corners[3].pointerListener.destroy();\r\n        this.edges[0].pointerListener.destroy();\r\n        this.edges[1].pointerListener.destroy();\r\n        this.edges[2].pointerListener.destroy();\r\n        this.edges[3].pointerListener.destroy();\r\n        this.anglePointerListener.destroy();\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"045N6\");","import {BB} from '../../../bb/bb';\r\nimport {KlCanvasPreview} from '../../canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './free-transform';\r\nimport {IKlBasicLayer, IMixMode} from '../../kl.types';\r\n\r\n/**\r\n * a basic canvas where you can transform one layer(move around, rotate, scale)\r\n *\r\n * @param params\r\n * @returns {HTMLDivElement}\r\n * @constructor\r\n */\r\nexport function FreeTransformCanvas(params: {\r\n    elementWidth: number;\r\n    elementHeight: number;\r\n    imageWidth: number;\r\n    imageHeight: number;\r\n    layers: IKlBasicLayer[];\r\n    transformIndex: number;\r\n}) {\r\n    /*\r\n    div\r\n        innerWrapper\r\n            klCanvasPreview\r\n            transform.div\r\n    */\r\n\r\n    let previewFit = BB.fitInto(\r\n        params.imageWidth,\r\n        params.imageHeight,\r\n        params.elementWidth - 20,\r\n        params.elementHeight - 60,\r\n        1\r\n    );\r\n    let scale = previewFit.width / params.imageWidth;\r\n\r\n    let div = BB.el({\r\n        css: {\r\n            width: params.elementWidth + \"px\",\r\n            height: params.elementHeight + \"px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            userSelect: \"none\",\r\n            position: \"relative\",\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    let innerWrapper = BB.el({\r\n        css: {\r\n            position: 'relative',\r\n            boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n            width: previewFit.width + 'px',\r\n            height: previewFit.height + 'px'\r\n        }\r\n    });\r\n    div.appendChild(innerWrapper);\r\n\r\n    let previewLayerArr = params.layers.map(item => {\r\n        return {\r\n            image: item.image,\r\n            mixModeStr: item.mixModeStr,\r\n            opacity: item.opacity,\r\n        }\r\n    });\r\n    previewLayerArr[previewLayerArr.length - 1].image = BB.canvas(\r\n        scale > 1 ? params.imageWidth : previewFit.width,\r\n        scale > 1 ? params.imageHeight : previewFit.height,\r\n    );\r\n    let klCanvasPreview = new KlCanvasPreview({\r\n        width: previewFit.width,\r\n        height: previewFit.height,\r\n        layers: previewLayerArr\r\n    });\r\n    innerWrapper.appendChild(klCanvasPreview.getElement());\r\n\r\n    let freeTransform;\r\n    let initTransform;\r\n    function updatePreview() {\r\n        if (!freeTransform) {\r\n            return;\r\n        }\r\n\r\n        let transform = freeTransform.getTransform();\r\n        if (scale < 1) {\r\n            transform.x *= scale;\r\n            transform.y *= scale;\r\n            transform.width *= scale;\r\n            transform.height *= scale;\r\n        }\r\n\r\n        let destCanvas = previewLayerArr[params.transformIndex].image;\r\n        let ctx = (destCanvas as HTMLCanvasElement).getContext('2d');\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, destCanvas.width, destCanvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            ctx,\r\n            params.layers[params.transformIndex].image,\r\n            transform,\r\n            null,\r\n            BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n        );\r\n        ctx.restore();\r\n        klCanvasPreview.render();\r\n    }\r\n\r\n    {\r\n        let transformSize = {\r\n            width: params.layers[params.transformIndex].image.width * scale,\r\n            height: params.layers[params.transformIndex].image.height * scale\r\n        };\r\n        if (transformSize.width > previewFit.width || transformSize.height > previewFit.height) {\r\n            transformSize = BB.fitInto(\r\n                params.layers[params.transformIndex].image.width,\r\n                params.layers[params.transformIndex].image.height,\r\n                previewFit.width,\r\n                previewFit.height,\r\n                1\r\n            );\r\n        }\r\n        initTransform = {\r\n            x: params.imageWidth / 2,\r\n            y: params.imageHeight / 2,\r\n            width: params.layers[params.transformIndex].image.width,\r\n            height: params.layers[params.transformIndex].image.height,\r\n        };\r\n        freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: 0,\r\n            isConstrained: true,\r\n            snapX: [0, params.imageWidth],\r\n            snapY: [0, params.imageHeight],\r\n            scale: scale,\r\n            callback: (transform) => {\r\n                updatePreview();\r\n            },\r\n        });\r\n    }\r\n    BB.css(freeTransform.getElement(), {\r\n        position: 'absolute',\r\n        left: '0',\r\n        top: '0'\r\n    });\r\n    innerWrapper.appendChild(freeTransform.getElement());\r\n    setTimeout(updatePreview, 0);\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.move = function(dX, dY) {\r\n        freeTransform.move(dX, dY);\r\n    };\r\n    this.reset = function() {\r\n        let w = params.layers[params.transformIndex].image.width;\r\n        let h = params.layers[params.transformIndex].image.height;\r\n\r\n        freeTransform.setSize(w, h);\r\n        freeTransform.setPos({x: w / 2, y: h / 2});\r\n        freeTransform.setAngleDeg(0);\r\n        updatePreview();\r\n    };\r\n    this.setTransformFit = function() {\r\n\r\n        let fit = BB.fitInto(\r\n            params.layers[params.transformIndex].image.width,\r\n            params.layers[params.transformIndex].image.height,\r\n            params.imageWidth,\r\n            params.imageHeight,\r\n            1\r\n        );\r\n\r\n        freeTransform.setSize(fit.width, fit.height);\r\n        freeTransform.setPos({x: fit.width / 2, y: fit.height / 2});\r\n        freeTransform.setAngleDeg(0);\r\n        updatePreview();\r\n    };\r\n    this.setTransformCenter = function() {\r\n        freeTransform.setPos({x: params.imageWidth / 2, y: params.imageHeight / 2});\r\n        freeTransform.setAngleDeg(0);\r\n        updatePreview();\r\n    };\r\n    //gives you the transformation in the original scale\r\n    this.getTransformation = function () {\r\n        if (!freeTransform) {\r\n            return false;\r\n        }\r\n        return freeTransform.getTransform();\r\n    };\r\n    this.getIsPixelated = () => {\r\n        const transform = freeTransform.getTransform();\r\n        return BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height);\r\n    };\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.destroy = function() {\r\n        freeTransform.destroy();\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/*\r\n\tCropper params\r\n\t{\r\n\t\tx: int, //pos in relation zum bild\r\n\t\ty: int,\r\n\t\tw: int,\r\n\t\th: int,\r\n\t\tscale: float, //zoom\r\n\t\tcallback: function //wenn sich was ndert\r\n\t}\r\n\tthe div that you append this to must be relative\r\n*/\r\nexport function Cropper (params) {\r\n    let x = params.x,\r\n        y = params.y,\r\n        width = params.width,\r\n        height = params.height,\r\n        scale = params.scale,\r\n        callback = params.callback,\r\n        maxW = params.maxW,\r\n        maxH = params.maxH;\r\n    let div = document.createElement(\"div\");\r\n    let gripCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n\r\n    let keyListener = new BB.KeyListener({});\r\n\r\n    BB.css(div, {\r\n        position: \"absolute\",\r\n        left: (x * scale) + \"px\",\r\n        top: (y * scale) + \"px\"\r\n    });\r\n\r\n    let outline = document.createElement(\"div\");\r\n    BB.css(outline, {\r\n        position: \"absolute\",\r\n        border: \"1px dashed #fff\",\r\n        cursor: \"move\"\r\n    });\r\n    (outline as any).update = function () {\r\n        BB.css(outline, {\r\n            left: (grips[0].x * scale - 1) + \"px\",\r\n            top: (grips[0].y * scale - 1) + \"px\",\r\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\r\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\r\n        });\r\n    };\r\n    let pointerRemainder = { // needs to be reset after dragging complete\r\n        x: 0,\r\n        y: 0,\r\n    };\r\n    let outlinePointerListener = new BB.PointerListener({\r\n        target: outline,\r\n        onPointer: function(event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n\r\n                grips[0].x += dX;\r\n                grips[0].y += dY;\r\n                grips[1].x += dX;\r\n                grips[1].y += dY;\r\n                grips[2].x += dX;\r\n                grips[2].y += dY;\r\n                grips[3].x += dX;\r\n                grips[3].y += dY;\r\n\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n\r\n    let thirdsHorizontal = document.createElement(\"div\");\r\n    BB.css(thirdsHorizontal, {\r\n        position: \"absolute\",\r\n        borderTop: \"1px solid #0ff\",\r\n        borderBottom: \"1px solid #0ff\"\r\n    });\r\n    (thirdsHorizontal as any).update = function () {\r\n        BB.css(thirdsHorizontal, {\r\n            left: (grips[0].x * scale) + \"px\",\r\n            top: ((grips[0].y + (grips[2].y - grips[0].y) / 3) * scale) + \"px\",\r\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\r\n            height: ((grips[2].y - grips[0].y) / 3 * scale) + \"px\"\r\n\r\n        });\r\n    };\r\n    let thirdsVertical = document.createElement(\"div\");\r\n    BB.css(thirdsVertical, {\r\n        position: \"absolute\",\r\n        borderLeft: \"1px solid #0ff\",\r\n        borderRight: \"1px solid #0ff\"\r\n    });\r\n    (thirdsVertical as any).update = function () {\r\n        BB.css(thirdsVertical, {\r\n            left: ((grips[0].x + (grips[2].x - grips[0].x) / 3) * scale) + \"px\",\r\n            top: (grips[0].y * scale) + \"px\",\r\n            width: ((grips[2].x - grips[0].x) / 3 * scale) + \"px\",\r\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\r\n\r\n        });\r\n    };\r\n\r\n    const gripSize = 40;\r\n    const gripOverlay = 10;\r\n\r\n    let grips: {\r\n        x: number; // int\r\n        y: number;\r\n    }[] = [ // aka corner coordinates\r\n        {x: 0, y: 0}, // top left\r\n        {x: width, y: 0}, // top right\r\n        {x: width, y: height}, // bottom right\r\n        {x: 0, y: height}, //bottom left\r\n    ];\r\n\r\n    function transformTop(dY) {\r\n        grips[0].y += dY;\r\n        grips[0].y = Math.max(grips[3].y - maxH, Math.min(grips[3].y - 1, grips[0].y));\r\n        grips[1].y = grips[0].y;\r\n    }\r\n    function transformRight(dX) {\r\n        grips[1].x += dX;\r\n        grips[1].x = Math.min(grips[0].x + maxW, Math.max(grips[0].x + 1, grips[1].x));\r\n        grips[2].x = grips[1].x;\r\n    }\r\n    function transformBottom(dY) {\r\n        grips[2].y += dY;\r\n        grips[2].y = Math.min(grips[1].y + maxH, Math.max(grips[1].y + 1, grips[2].y));\r\n        grips[3].y = grips[2].y;\r\n    }\r\n    function transformLeft(dX) {\r\n        grips[0].x += dX;\r\n        grips[0].x = Math.max(grips[1].x - maxW, Math.min(grips[1].x - 1, grips[0].x));\r\n        grips[3].x = grips[0].x;\r\n    }\r\n\r\n    function commit() {\r\n        pointerRemainder.x = 0;\r\n        pointerRemainder.y = 0;\r\n        callback(getTransform());\r\n    }\r\n\r\n\r\n\r\n\r\n    let edges = [];\r\n    for (let i = 0; i < 4; i++) {\r\n        (function (i) {\r\n            edges[i] = document.createElement(\"div\");\r\n            let g = edges[i];\r\n            g.style.width = gripSize + \"px\";\r\n            g.style.height = gripSize + \"px\";\r\n            //g.style.background = \"#0f0\";\r\n            g.style.position = \"absolute\";\r\n            g.update = function () {\r\n                if (i === 0) { //top\r\n                    g.style.left = (grips[0].x * scale + gripOverlay) + \"px\";\r\n                    g.style.top = (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\";\r\n                    g.style.width = ((grips[1].x - grips[0].x) * scale - gripOverlay * 2) + \"px\";\r\n                    g.style.height = (gripSize * 2) + \"px\";\r\n                } else if (i === 1) { //right\r\n                    g.style.left = (grips[1].x * scale - gripOverlay) + \"px\";\r\n                    g.style.top = (grips[1].y * scale + gripOverlay) + \"px\";\r\n                    g.style.width = (gripSize * 2) + \"px\";\r\n                    g.style.height = ((grips[2].y - grips[1].y) * scale - gripOverlay * 2) + \"px\";\r\n                } else if (i === 2) { //bottom\r\n                    g.style.left = (grips[3].x * scale + gripOverlay) + \"px\";\r\n                    g.style.top = (grips[3].y * scale - gripOverlay) + \"px\";\r\n                    g.style.width = ((grips[2].x - grips[3].x) * scale - gripOverlay * 2) + \"px\";\r\n                    g.style.height = (gripSize * 2) + \"px\";\r\n                } else if (i === 3) { //left\r\n                    g.style.left = (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\";\r\n                    g.style.top = (grips[0].y * scale + gripOverlay) + \"px\";\r\n                    g.style.width = (gripSize * 2) + \"px\";\r\n                    g.style.height = ((grips[3].y - grips[0].y) * scale - gripOverlay * 2) + \"px\";\r\n                }\r\n                let angleOffset = i * 2 + 1;\r\n                g.style.cursor = gripCursors[angleOffset] + \"-resize\";\r\n\r\n            };\r\n        })(i);\r\n    }\r\n\r\n    let darken = [];\r\n    for (let i = 0; i < 4; i++) {\r\n        (function (i) {\r\n            darken[i] = document.createElement(\"div\");\r\n            let g = darken[i];\r\n            g.style.position = \"absolute\";\r\n            g.style.background = \"#000\";\r\n            g.style.opacity = \"0.5\";\r\n            g.update = function () {\r\n                if (i === 0) {\r\n                    g.style.left = (grips[0].x * scale) + \"px\";\r\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\r\n                    g.style.width = ((grips[1].x - grips[0].x) * scale) + \"px\";\r\n                    g.style.height = \"8000px\";\r\n                } else if (i === 1) {\r\n                    g.style.left = (grips[1].x * scale) + \"px\";\r\n                    g.style.top = (grips[1].y * scale - 8000) + \"px\";\r\n                    g.style.width = \"8000px\";\r\n                    g.style.height = 16000 + \"px\";\r\n                } else if (i === 2) {\r\n                    g.style.left = (grips[3].x * scale) + \"px\";\r\n                    g.style.top = (grips[3].y * scale) + \"px\";\r\n                    g.style.width = ((grips[2].x - grips[3].x) * scale) + \"px\";\r\n                    g.style.height = \"8000px\";\r\n                } else if (i === 3) {\r\n                    g.style.left = (grips[0].x * scale - 8000) + \"px\";\r\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\r\n                    g.style.width = \"8000px\";\r\n                    g.style.height = 16000 + \"px\";\r\n                }\r\n\r\n            };\r\n        })(i);\r\n    }\r\n\r\n    let edge0PointerListener = new BB.PointerListener({\r\n        target: edges[0],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformTop(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformBottom(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    let edge1PointerListener = new BB.PointerListener({\r\n        target: edges[1],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformRight(dX);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformLeft(-dX);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    let edge2PointerListener = new BB.PointerListener({\r\n        target: edges[2],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformBottom(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformTop(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    let edge3PointerListener = new BB.PointerListener({\r\n        target: edges[3],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformLeft(dX);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformRight(-dX);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    let cornerElArr = [];\r\n    (function() {\r\n        for (let i = 0; i < 4; i++) {\r\n            (function (i) {\r\n                cornerElArr[i] = document.createElement(\"div\");\r\n                let g = cornerElArr[i];\r\n                BB.css(g, {\r\n                    //background: '#f00',\r\n                    width: (gripSize * 2) + 'px',\r\n                    height: (gripSize * 2) + 'px',\r\n                    position: 'absolute'\r\n                });\r\n                g.style.cursor = ['nwse-resize', 'nesw-resize'][i % 2];\r\n                g.update = function () {\r\n                    if (i === 0) { //top left\r\n                        BB.css(g, {\r\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\r\n                            top: (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\"\r\n                        });\r\n                    } else if (i === 1) { //top right\r\n                        BB.css(g, {\r\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\r\n                            top: (grips[1].y * scale - gripSize * 2 + gripOverlay) + \"px\"\r\n                        });\r\n                    } else if (i === 2) { //bottom right\r\n                        BB.css(g, {\r\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\r\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\r\n                        });\r\n                    } else if (i === 3) { //bottom left\r\n                        BB.css(g, {\r\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\r\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\r\n                        });\r\n                    }\r\n                };\r\n            })(i);\r\n        }\r\n    })();\r\n    //top left\r\n    let corner0PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[0],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformLeft(dX);\r\n                transformTop(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformRight(-dX);\r\n                    transformBottom(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    //top right\r\n    let corner1PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[1],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformRight(dX);\r\n                transformTop(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformLeft(-dX);\r\n                    transformBottom(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    //bottom right\r\n    let corner2PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[2],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformRight(dX);\r\n                transformBottom(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformLeft(-dX);\r\n                    transformTop(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    //bottom left\r\n    let corner3PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[3],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformLeft(dX);\r\n                transformBottom(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformRight(-dX);\r\n                    transformTop(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n\r\n\r\n    function getTransform() {\r\n        grips[1].x -= grips[0].x;\r\n        grips[1].y -= grips[0].y;\r\n        grips[2].x -= grips[0].x;\r\n        grips[2].y -= grips[0].y;\r\n        grips[3].x -= grips[0].x;\r\n        grips[3].y -= grips[0].y;\r\n        x += grips[0].x;\r\n        y += grips[0].y;\r\n        grips[0].x = 0;\r\n        grips[0].y = 0;\r\n        return {\r\n            x: x,\r\n            y: y,\r\n            width: grips[1].x,\r\n            height: grips[2].y\r\n        };\r\n    }\r\n\r\n\r\n    div.append(\r\n        darken[1],\r\n        darken[0],\r\n        darken[2],\r\n        darken[3],\r\n        thirdsHorizontal,\r\n        thirdsVertical,\r\n        outline,\r\n\r\n        edges[1],\r\n        edges[0],\r\n        edges[2],\r\n        edges[3],\r\n\r\n        cornerElArr[0],\r\n        cornerElArr[1],\r\n        cornerElArr[2],\r\n        cornerElArr[3],\r\n    );\r\n\r\n\r\n    function update() {\r\n\r\n        edges[0].update();\r\n        edges[1].update();\r\n        edges[2].update();\r\n        edges[3].update();\r\n        cornerElArr[0].update();\r\n        cornerElArr[1].update();\r\n        cornerElArr[2].update();\r\n        cornerElArr[3].update();\r\n        darken[0].update();\r\n        darken[1].update();\r\n        darken[2].update();\r\n        darken[3].update();\r\n        (outline as any).update();\r\n        (thirdsHorizontal as any).update();\r\n        (thirdsVertical as any).update();\r\n    }\r\n\r\n    update();\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getTransform = getTransform;\r\n\r\n    this.setTransform = function (p) {\r\n        x = p.x;\r\n        y = p.y;\r\n        width = p.width;\r\n        height = p.height;\r\n\r\n        BB.css(div, {\r\n            left: (x * scale) + \"px\",\r\n            top: (y * scale) + \"px\"\r\n        });\r\n\r\n        grips[0].x = 0;\r\n        grips[0].y = 0;\r\n        grips[1].x = width;\r\n        grips[1].y = 0;\r\n        grips[2].x = width;\r\n        grips[2].y = height;\r\n        grips[3].x = 0;\r\n        grips[3].y = height;\r\n\r\n        update();\r\n        commit();\r\n    };\r\n\r\n    this.setScale = function (s) {\r\n        scale = s;\r\n        BB.css(div, {\r\n            left: (x * scale) + \"px\",\r\n            top: (y * scale) + \"px\"\r\n        });\r\n        update();\r\n    };\r\n\r\n    this.showThirds = function (b) {\r\n        if (b) {\r\n            thirdsHorizontal.style.display = \"block\";\r\n            thirdsVertical.style.display = \"block\";\r\n        } else {\r\n            thirdsHorizontal.style.display = \"none\";\r\n            thirdsVertical.style.display = \"none\";\r\n        }\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.destroy = function() {\r\n        keyListener.destroy();\r\n        outlinePointerListener.destroy();\r\n        corner0PointerListener.destroy();\r\n        corner1PointerListener.destroy();\r\n        corner2PointerListener.destroy();\r\n        corner3PointerListener.destroy();\r\n        edge0PointerListener.destroy();\r\n        edge1PointerListener.destroy();\r\n        edge2PointerListener.destroy();\r\n        edge3PointerListener.destroy();\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Previews currently active layer\r\n * thumbnail (hover shows bigger preview), layername, opacity\r\n *\r\n * internally listens to kl history. updates when there's a change.\r\n * but you need to update it when the active layer changed. (different canvas object)\r\n *\r\n * update visibility for performance\r\n *\r\n * p = {\r\n *     onClick: function() // when clicking on layer name\r\n *     klRootEl: klRootEl,\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function LayerPreview(p) {\r\n\r\n    // internally redraws with in an interval. checks history is something changed\r\n    // this update will be animated\r\n    // it will not be animated if the resolution changed\r\n    // also redraws when you call updateLayer - not animated\r\n\r\n    // syncs via updateLayer, and internally updates layer opacity via a hack\r\n\r\n    let div = BB.el({});\r\n    let layerObj;\r\n    let isVisible = true;\r\n    const height = 40;\r\n    const canvasSize = height - 10;\r\n    const largeCanvasSize = 300;\r\n    let lastDrawnState = -2;\r\n    let lastDrawnSize = {\r\n        width: 0,\r\n        height: 0\r\n    };\r\n    let animationCanvas = BB.canvas(); // to help animate the transition\r\n    let animationCanvasCtx = animationCanvas.getContext('2d');\r\n    const animationLength = 30;\r\n    let animationCount = 0; // >0 means it's animating\r\n    let largeCanvasIsVisible = false;\r\n    let largeCanvasAnimationTimeout;\r\n    const largeCanvasAnimationDurationMs = 300;\r\n    let uiState = 'right'; // 'left' | 'right'\r\n\r\n\r\n    // --- setup dom ---\r\n    let contentWrapperEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            height: height + 'px',\r\n            color: '#666',\r\n        }\r\n    });\r\n    let canvasWrapperEl = BB.el({\r\n        css: {\r\n            //background: '#f00',\r\n            minWidth: height + 'px',\r\n            height: height + 'px',\r\n            display: 'flex',\r\n            justifyContent: 'center',\r\n            alignItems: 'center'\r\n        }\r\n    });\r\n    let canvas = BB.canvas(canvasSize, canvasSize);\r\n    let canvasCtx = canvas.getContext('2d');\r\n    canvas.title = LANG('layers-active-layer');\r\n    BB.css(canvas, {\r\n        boxShadow: '0 0 0 1px #9e9e9e',\r\n        colorScheme: 'only light',\r\n    });\r\n    let nameWrapper = BB.el({\r\n        css: {\r\n            //background: '#ff0',\r\n            flexGrow: '1',\r\n            paddingLeft: '10px',\r\n            fontSize: '13px',\r\n            overflow: 'hidden',\r\n            position: 'relative'\r\n        }\r\n    });\r\n    let nameLabelEl = BB.el({\r\n        content: '',\r\n        css: {\r\n            cssFloat: 'left',\r\n            whiteSpace: 'nowrap'\r\n        }\r\n    });\r\n    let nameFadeEl = BB.el({\r\n        css: {\r\n            backgroundImage: 'linear-gradient(to right, rgba(221,221,221,0) 0%, rgba(221,221,221,0.8) 100%)',\r\n            position: 'absolute',\r\n            right: \"0\",\r\n            top: \"0\",\r\n            width: \"50px\",\r\n            height: '100%'\r\n        }\r\n    });\r\n    let clickableEl = BB.el({\r\n        css: {\r\n            //background: 'rgba(0,255,0,0.6)',\r\n            position: 'absolute',\r\n            left: \"10px\",\r\n            top: \"0\",\r\n            width: \"90px\",\r\n            height: '100%'\r\n        }\r\n    });\r\n    if (p.onClick) {\r\n        BB.addEventListener(clickableEl,'click', function() {\r\n            p.onClick();\r\n        });\r\n        BB.addEventListener(canvas,'click', function() {\r\n            p.onClick();\r\n        });\r\n    }\r\n    let opacityEl = BB.el({\r\n        content: LANG('opacity') + '<br>100%',\r\n        css: {\r\n            minWidth: '60px',\r\n            fontSize: '12px',\r\n            textAlign: 'center',\r\n            background: '#dddddd',\r\n            color: '#555'\r\n        }\r\n    });\r\n\r\n    const largeCanvasWrapper = BB.el({\r\n        onClick: BB.handleClick,\r\n        css: {\r\n            pointerEvents: 'none',\r\n            background: '#fff',\r\n            position: 'absolute',\r\n            right: '280px',\r\n            top: '10px',\r\n            border: '1px solid #aaa',\r\n            boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\r\n            transition: 'opacity '+largeCanvasAnimationDurationMs+'ms ease-in-out',\r\n            userSelect: 'none',\r\n            display: 'block',\r\n            webkitTouchCallout: 'none',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    let largeCanvas = BB.canvas(largeCanvasSize, largeCanvasSize);\r\n    largeCanvasWrapper.append(largeCanvas);\r\n    let largeCanvasCtx = largeCanvas.getContext('2d');\r\n    BB.css(largeCanvas, {\r\n        display: 'block',\r\n    });\r\n\r\n    div.appendChild(contentWrapperEl);\r\n    contentWrapperEl.appendChild(canvasWrapperEl);\r\n    canvasWrapperEl.appendChild(canvas);\r\n    contentWrapperEl.appendChild(nameWrapper);\r\n    nameWrapper.appendChild(nameLabelEl);\r\n    nameWrapper.appendChild(nameFadeEl);\r\n    nameWrapper.appendChild(clickableEl);\r\n    contentWrapperEl.appendChild(opacityEl);\r\n\r\n\r\n    let animationCanvasCheckerPattern = animationCanvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\r\n    let largeCanvasCheckerPattern = canvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\r\n\r\n\r\n\r\n    // --- update logic ---\r\n\r\n    function animate() {\r\n        if (animationCount === 0) {\r\n            return;\r\n        }\r\n\r\n        animationCount--;\r\n\r\n        canvasCtx.save();\r\n        canvasCtx.globalAlpha = Math.pow((animationLength - animationCount) / animationLength, 2);\r\n        canvasCtx.drawImage(animationCanvas, 0, 0);\r\n        canvasCtx.restore();\r\n\r\n        if (animationCount > 0) {\r\n            requestAnimationFrame(animate);\r\n        }\r\n    }\r\n\r\n    function draw(isInstant) {\r\n\r\n        if (!isVisible) {\r\n            return;\r\n        }\r\n\r\n        nameLabelEl.textContent = layerObj.name;\r\n        opacityEl.innerHTML = LANG('opacity') + '<br>' + Math.round(layerObj.opacity * 100) + '%';\r\n\r\n        let layerCanvas = layerObj.context.canvas;\r\n\r\n        if (layerCanvas.width !== lastDrawnSize.width || layerCanvas.height !== lastDrawnSize.height) {\r\n            let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, canvasSize, canvasSize, 1);\r\n            canvas.width = Math.round(canvasDimensions.width);\r\n            canvas.height = Math.round(canvasDimensions.height);\r\n\r\n            isInstant = true;\r\n        }\r\n\r\n        animationCanvas.width = canvas.width;\r\n        animationCanvas.height = canvas.height;\r\n\r\n        animationCanvasCtx.save();\r\n        animationCanvasCtx.imageSmoothingEnabled = false;\r\n        animationCanvasCtx.fillStyle = animationCanvasCheckerPattern;\r\n        animationCanvasCtx.fillRect(0, 0, animationCanvas.width, animationCanvas.height);\r\n        animationCanvasCtx.drawImage(layerCanvas, 0, 0, animationCanvas.width, animationCanvas.height);\r\n        animationCanvasCtx.restore();\r\n\r\n        if (isInstant) {\r\n            animationCount = 0;\r\n            canvasCtx.save();\r\n            canvasCtx.drawImage(animationCanvas, 0, 0);\r\n            canvasCtx.restore();\r\n\r\n        } else {\r\n            animationCount = animationLength;\r\n            animate();\r\n\r\n        }\r\n\r\n        drawLargeCanvas();\r\n\r\n        lastDrawnState = klHistory.getState();\r\n        lastDrawnSize.width = layerCanvas.width;\r\n        lastDrawnSize.height = layerCanvas.height;\r\n    }\r\n\r\n    function update() {\r\n        draw(true);\r\n    }\r\n\r\n    setInterval(function() {\r\n\r\n        if (!layerObj) {\r\n            return;\r\n        }\r\n\r\n        let currentState = klHistory.getState();\r\n        if (currentState === lastDrawnState) {\r\n            return;\r\n        }\r\n\r\n        //update opacity w hack\r\n        layerObj.opacity = layerObj.context.canvas.opacity;\r\n\r\n        draw(false);\r\n\r\n    }, 2000);\r\n\r\n\r\n    //is always instant\r\n    function drawLargeCanvas() {\r\n\r\n        if (!largeCanvasIsVisible || !layerObj) {\r\n            return;\r\n        }\r\n\r\n        let layerCanvas = layerObj.context.canvas;\r\n\r\n        let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, largeCanvasSize, largeCanvasSize, 1);\r\n        largeCanvas.width = Math.round(canvasDimensions.width);\r\n        largeCanvas.height = Math.round(canvasDimensions.height);\r\n        largeCanvasCtx.save();\r\n        if (largeCanvas.width > layerCanvas.width) {\r\n            largeCanvasCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            largeCanvasCtx.imageSmoothingEnabled = true;\r\n            largeCanvasCtx.imageSmoothingQuality = 'high';\r\n        }\r\n        largeCanvasCtx.fillStyle = largeCanvasCheckerPattern;\r\n        largeCanvasCtx.fillRect(0, 0, largeCanvas.width, largeCanvas.height);\r\n        largeCanvasCtx.drawImage(layerCanvas, 0, 0, largeCanvas.width, largeCanvas.height);\r\n        largeCanvasCtx.restore();\r\n\r\n        const bounds = div.getBoundingClientRect();\r\n        BB.css(largeCanvasWrapper, {\r\n            top: Math.max(10, (bounds.top + height / 2 - largeCanvas.height / 2)) + \"px\"\r\n        });\r\n\r\n    }\r\n\r\n    function removeLargeCanvas() {\r\n        try {\r\n            p.klRootEl.removeChild(largeCanvasWrapper);\r\n        } catch(e) {\r\n\r\n        }\r\n    }\r\n\r\n    function showLargeCanvas(b) {\r\n        if (largeCanvasIsVisible === b) {\r\n            return;\r\n        }\r\n\r\n        clearTimeout(largeCanvasAnimationTimeout);\r\n        largeCanvasIsVisible = b;\r\n\r\n        if (b) {\r\n            largeCanvasAnimationTimeout = setTimeout(function() {\r\n                drawLargeCanvas();\r\n                largeCanvasWrapper.style.opacity = '0';\r\n                p.klRootEl.appendChild(largeCanvasWrapper);\r\n                setTimeout(function() {\r\n                    largeCanvasWrapper.style.opacity = '1';\r\n                }, 20);\r\n            }, 250);\r\n\r\n        } else {\r\n            largeCanvasWrapper.style.opacity = '0';\r\n            largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\r\n        }\r\n\r\n    }\r\n\r\n    let pointerListener = new BB.PointerListener({\r\n        target: canvas,\r\n        onEnterLeave: function(b) {\r\n            showLargeCanvas(b);\r\n        }\r\n    });\r\n\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(b) {\r\n        if (isVisible === b) {\r\n            return;\r\n        }\r\n        isVisible = b;\r\n        contentWrapperEl.style.display = isVisible ? 'flex' : 'none';\r\n        div.style.marginBottom = isVisible ? '' : '10px';\r\n\r\n        let currentState = klHistory.getState();\r\n        if (b && lastDrawnState !== currentState) {\r\n            update();\r\n        }\r\n    };\r\n\r\n    //when the layer might have changed\r\n    this.setLayer = function(klCanvasLayerObj) {\r\n        layerObj = klCanvasLayerObj;\r\n        update();\r\n    };\r\n\r\n    this.setUiState = function(stateStr) {\r\n        uiState = '' + stateStr;\r\n\r\n        if (uiState === 'left') {\r\n            BB.css(largeCanvasWrapper, {\r\n                left: '280px',\r\n                right: ''\r\n            });\r\n        } else {\r\n            BB.css(largeCanvasWrapper, {\r\n                left: '',\r\n                right: '280px'\r\n            });\r\n        }\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * fits image into a size\r\n * params: {\r\n *    image: image,\r\n *    width: int,\r\n *    height: int\r\n * }\r\n *\r\n * methods:\r\n * getDiv()\r\n *\r\n * @param params\r\n * @constructor\r\n */\r\nexport function FittedImage(params) {\r\n    let fit = BB.fitInto(params.image.width, params.image.height, params.width, params.height, 1);\r\n    let w = parseInt('' + fit.width);\r\n    let h = parseInt('' + fit.height);\r\n\r\n    let canvas = BB.canvas(w, h);\r\n\r\n    canvas.getContext(\"2d\").drawImage(params.image, 0, 0, w, h);\r\n    BB.css(canvas, {\r\n        display: \"block\",\r\n        boxShadow: \"0 0 0 1px #aaa\"\r\n    });\r\n\r\n    this.getElement = function() {\r\n        return canvas;\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\nimport {FreeTransformCanvas} from '../components/free-transform-canvas';\r\nimport {popup} from './popup';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {IKlBasicLayer} from '../../kl.types';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showImportAsLayerDialog(\r\n    params: {\r\n        target: HTMLElement;\r\n        klCanvas: KlCanvas;\r\n        importImage: HTMLImageElement | HTMLCanvasElement;\r\n        callback: (\r\n            p?: {x: number, y: number, width:number, height: number, angleDeg: number},\r\n            isPixelated?: boolean\r\n        ) => void;\r\n    }\r\n): void {\r\n\r\n    let div = document.createElement(\"div\");\r\n    BB.appendTextDiv(div, LANG('import-as-layer-description'));\r\n    if (params.klCanvas.isLayerLimitReached()) {\r\n        let noteEl = BB.el({\r\n            content: LANG('import-as-layer-limit-reached'),\r\n            css: {\r\n                background: '#ff0',\r\n                padding: '10px',\r\n                marginTop: '5px',\r\n                marginBottom: '5px',\r\n                border: '1px solid #e7d321',\r\n                borderRadius: '5px'\r\n            }\r\n        });\r\n        div.appendChild(noteEl);\r\n    }\r\n    let isSmall = window.innerWidth < 550;\r\n\r\n    let buttonRowEl = BB.el({\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n    let originalSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: '1:1',\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function() {\r\n            freeTransformCanvas.reset();\r\n        }\r\n    });\r\n    let fitSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('import-as-layer-fit'),\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function() {\r\n            freeTransformCanvas.setTransformFit();\r\n        }\r\n    });\r\n    let centerBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('center'),\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function() {\r\n            freeTransformCanvas.setTransformCenter();\r\n        }\r\n    });\r\n    buttonRowEl.appendChild(originalSizeBtn);\r\n    buttonRowEl.appendChild(fitSizeBtn);\r\n    buttonRowEl.appendChild(centerBtn);\r\n    div.appendChild(buttonRowEl);\r\n\r\n\r\n\r\n    let layers: IKlBasicLayer[] = [];\r\n    {\r\n        let klCanvasLayerArr = params.klCanvas.getLayers();\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            layers.push({\r\n                image: klCanvasLayerArr[i].context.canvas,\r\n                opacity: klCanvasLayerArr[i].opacity,\r\n                mixModeStr: klCanvasLayerArr[i].mixModeStr\r\n            });\r\n        }\r\n    }\r\n    layers.push({\r\n        image: params.importImage,\r\n        opacity: 1,\r\n        mixModeStr: 'source-over'\r\n    });\r\n\r\n\r\n    let freeTransformCanvas = new FreeTransformCanvas({\r\n        elementWidth: isSmall ? 340 : 540,\r\n        elementHeight: isSmall ? 280 : 350,\r\n        imageWidth: params.klCanvas.getLayerContext(0).canvas.width,\r\n        imageHeight: params.klCanvas.getLayerContext(0).canvas.height,\r\n        layers: layers,\r\n        transformIndex: layers.length - 1,\r\n    });\r\n    BB.css(freeTransformCanvas.getElement(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n    });\r\n    div.appendChild(freeTransformCanvas.getElement());\r\n\r\n    function move(x, y) {\r\n        freeTransformCanvas.move(x, y);\r\n    }\r\n\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr) {\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    popup({\r\n        target: params.target,\r\n        message: `<b>${LANG('import-as-layer-title')}</b>`,\r\n        div: div,\r\n        style: isSmall ? null : {\r\n            width: '500px'\r\n        },\r\n        buttons: [\"Ok\", \"Cancel\"],\r\n        clickOnEnter: 'Ok',\r\n        callback: function(buttonStr) {\r\n            keyListener.destroy();\r\n            freeTransformCanvas.destroy();\r\n            BB.destroyEl(originalSizeBtn);\r\n            BB.destroyEl(fitSizeBtn);\r\n            BB.destroyEl(centerBtn);\r\n            if (buttonStr === 'Ok') {\r\n                params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\r\n            } else {\r\n                params.callback();\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Not really generalized. UI when you drag/drop an image into window.\r\n * The moment you create it, it will listen.\r\n *\r\n * @param p object {onDrop: func(files, optionStr), target: DOM Element, enabledTest: func -> bool} - optionStr: 'default'|'layer'|'image'\r\n * @constructor\r\n */\r\nexport function KlImageDropper(p) {\r\n\r\n    //set up DOM\r\n    let rootEl = BB.el({\r\n        content: 'Drop to import',\r\n        css: {\r\n            paddingTop: '100px',\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n            background: 'rgba(50, 50, 50, 0.7)',\r\n            color: '#fff',\r\n            textShadow: '2px 2px #000',\r\n            textAlign: 'center',\r\n            fontSize: '25px'\r\n        }\r\n    });\r\n    let wrapperEl = BB.el({\r\n        css: {\r\n            'marginTop': '50px',\r\n            'display': 'flex',\r\n            'justifyContent': 'center'\r\n        }\r\n    });\r\n    let optionStyle = {\r\n        width: '200px',\r\n        padding: '50px',\r\n        margin: '10px',\r\n        //opacity: 0.5,\r\n        borderRadius: '20px',\r\n        border: '1px dashed #fff',\r\n        background: '#00aefe',\r\n        fontWeight: 'bold'\r\n    };\r\n    let optionLayerEl = BB.el({\r\n        content: 'As Layer',\r\n        css: optionStyle\r\n    });\r\n    let optionImageEl = BB.el({\r\n        content: 'As New Image',\r\n        css: optionStyle\r\n    });\r\n\r\n    rootEl.appendChild(wrapperEl);\r\n    wrapperEl.appendChild(optionLayerEl);\r\n    wrapperEl.appendChild(optionImageEl);\r\n\r\n\r\n    let rootCounter = 0;\r\n    let optionLayerCounter = 0;\r\n    let optionImageCounter = 0;\r\n\r\n    function destroy() {\r\n        rootCounter = 0;\r\n        optionLayerCounter = 0;\r\n        optionImageCounter = 0;\r\n        try {\r\n            p.target.removeChild(rootEl);\r\n        } catch (e) { }\r\n    }\r\n\r\n    function testAcceptType(event) {\r\n        try {\r\n            return !event.dataTransfer.types.includes('text/plain');\r\n        } catch(e) {\r\n\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function updateOptions() {\r\n        let boxShadow = '0 0 20px 4px #fff';\r\n        if (optionLayerCounter > 0) {\r\n            optionLayerEl.style.boxShadow = boxShadow;\r\n            optionImageEl.style.boxShadow = '';\r\n        } else if (optionImageCounter > 0) {\r\n            optionLayerEl.style.boxShadow = '';\r\n            optionImageEl.style.boxShadow = boxShadow;\r\n        } else {\r\n            optionLayerEl.style.boxShadow = '';\r\n            optionImageEl.style.boxShadow = '';\r\n        }\r\n    }\r\n\r\n    BB.addEventListener(optionLayerEl,'dragenter', function() {\r\n        optionLayerCounter++;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionLayerEl,'dragleave', function() {\r\n        optionLayerCounter--;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionImageEl,'dragenter', function() {\r\n        optionImageCounter++;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionImageEl,'dragleave', function() {\r\n        optionImageCounter--;\r\n        updateOptions();\r\n    });\r\n\r\n\r\n    function rootDragOver(event) {\r\n        if (!testAcceptType(event)) {\r\n            return;\r\n        }\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n    }\r\n    function rootDragEnter(event) {\r\n        if (!p.enabledTest() || !testAcceptType(event)) {\r\n            return;\r\n        }\r\n        if (rootCounter === 0) {\r\n            p.target.appendChild(rootEl);\r\n        }\r\n        rootCounter++;\r\n\r\n    }\r\n    function rootDragLeave(event) {\r\n        if (!testAcceptType(event) || rootCounter === 0) {\r\n            return;\r\n        }\r\n        rootCounter = Math.max(0, rootCounter - 1);\r\n        if (rootCounter === 0) {\r\n            p.target.removeChild(rootEl);\r\n        }\r\n\r\n    }\r\n    function rootDrop(event) {\r\n        if (!testAcceptType(event) || event.dataTransfer.files.length === 0) {\r\n            destroy();\r\n            return;\r\n        }\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n\r\n        let optionStr = 'default';\r\n        if (optionLayerCounter > 0) {\r\n            optionStr = 'layer';\r\n        } else if (optionImageCounter > 0) {\r\n            optionStr = 'image';\r\n        }\r\n\r\n        p.onDrop(event.dataTransfer.files, optionStr);\r\n\r\n\r\n        if (rootCounter > 0) {\r\n            p.target.removeChild(rootEl);\r\n        }\r\n        rootCounter = 0;\r\n        optionLayerCounter = 0;\r\n        optionImageCounter = 0;\r\n        updateOptions();\r\n    }\r\n\r\n    BB.addEventListener(window,'dragover', rootDragOver, false);\r\n    BB.addEventListener(window,'dragenter', rootDragEnter, false);\r\n    BB.addEventListener(window,'dragleave', rootDragLeave, false);\r\n    BB.addEventListener(window,'drop', rootDrop, false);\r\n\r\n    // if something goes wrong and you're stuck with overlay\r\n    BB.addEventListener(rootEl, 'pointerdown', function() {\r\n        destroy();\r\n    });\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr) {\r\n            if (rootCounter > 0 && keyStr === 'esc') {\r\n                destroy();\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KlSmallColorSlider} from '../base-components/kl-color-slider-small';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {BrushSettingService} from '../../brushes-ui/brush-setting-service';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Compressed HUD toolspace. When you hold ctrl+alt.\r\n * small color picker, brush settings\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function OverlayToolspace(\r\n    p: {\r\n        brushSettingService: BrushSettingService; // to sync with outside\r\n        enabledTest: () => boolean; // calls to see if it's allowed to show\r\n    }\r\n) {\r\n\r\n    const sizeObj = {\r\n        width: 150,\r\n        svHeight: 90,\r\n        hHeight: 20,\r\n        sliderHeight: 25\r\n    };\r\n\r\n    let isVisible = false;\r\n    const div = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            left: '500px',\r\n            top: '500px',\r\n            background: 'rgb(221, 221, 221)',\r\n            display: 'none',\r\n            border: '1px solid #fff',\r\n            boxShadow: '0 0 10px rgba(0,0,0,0.5)',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    const queuedObj = {\r\n        color: null,\r\n        size: null,\r\n        opacity: null\r\n    };\r\n\r\n\r\n    // --- inputs ---\r\n\r\n    //color selection\r\n    const colorSlider = new KlSmallColorSlider({\r\n        width: sizeObj.width,\r\n        heightSV: sizeObj.svHeight,\r\n        heightH: sizeObj.hHeight,\r\n        color: p.brushSettingService.getColor(),\r\n        callback: function (rgbObj) {\r\n            selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\r\n            p.brushSettingService.setColor(rgbObj, subscriptionFunc);\r\n        }\r\n    });\r\n    const selectedColorEl = BB.el({\r\n        css: {\r\n            width: sizeObj.width + 'px',\r\n            height: sizeObj.hHeight + 'px',\r\n            pointerEvents: 'none'\r\n        }\r\n    });\r\n    {\r\n        const initialColor = p.brushSettingService.getColor();\r\n        selectedColorEl.style.backgroundColor = \"rgb(\" + initialColor.r + \",\" + initialColor.g + \",\" + initialColor.b + \")\";\r\n    }\r\n\r\n    div.appendChild(selectedColorEl);\r\n    div.appendChild(colorSlider.getElement());\r\n\r\n\r\n    function updateColor(rgbObj) {\r\n        colorSlider.setColor(rgbObj);\r\n        selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    //brushsize slider\r\n\r\n    const sizeSlider = new KlSlider({\r\n        label: LANG('brush-size'),\r\n        width: sizeObj.width,\r\n        height: sizeObj.sliderHeight,\r\n        min: 0,\r\n        max: 500,\r\n        initValue: 50,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        onChange: function(v) {\r\n            p.brushSettingService.setSize(v);\r\n        },\r\n        formatFunc: function(v) {\r\n            if (v * 2 < 10) {\r\n                return Math.round(v * 2 * 10) / 10;\r\n            }\r\n            return Math.round(v * 2);\r\n        }\r\n    });\r\n    BB.css(sizeSlider.getElement(), {\r\n        marginTop: '2px'\r\n    });\r\n    div.appendChild(sizeSlider.getElement());\r\n\r\n    const opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: sizeObj.width,\r\n        height: sizeObj.sliderHeight,\r\n        min: 0,\r\n        max: 1,\r\n        initValue: 1,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        onChange: function(v) {\r\n            p.brushSettingService.setOpacity(v);\r\n        },\r\n        formatFunc: function(v) {\r\n            return Math.round(v * 100);\r\n        }\r\n    });\r\n    BB.css(opacitySlider.getElement(), {\r\n        margin: '2px 0'\r\n    });\r\n    div.appendChild(opacitySlider.getElement());\r\n\r\n\r\n\r\n    // --- general setup ---\r\n\r\n    const subscriptionFunc = function(event) {\r\n        if (event.type === 'color') {\r\n            if (!isVisible) {\r\n                queuedObj.color = event.value;\r\n            } else {\r\n                updateColor(event.value);\r\n            }\r\n        }\r\n        if (event.type === 'size') {\r\n            if (!isVisible) {\r\n                queuedObj.size = event.value;\r\n            } else {\r\n                sizeSlider.setValue(event.value);\r\n            }\r\n        }\r\n        if (event.type === 'opacity') {\r\n            if (!isVisible) {\r\n                queuedObj.opacity = event.value;\r\n            } else {\r\n                opacitySlider.setValue(event.value);\r\n            }\r\n        }\r\n        if (event.type === 'sliderConfig') {\r\n            sizeSlider.update(event.value.sizeSlider);\r\n            opacitySlider.update(event.value.opacitySlider);\r\n        }\r\n    };\r\n    p.brushSettingService.subscribe(subscriptionFunc);\r\n    {\r\n        const sliderConfig = p.brushSettingService.getSliderConfig();\r\n        sizeSlider.update(sliderConfig.sizeSlider);\r\n        opacitySlider.update(sliderConfig.opacitySlider);\r\n        sizeSlider.setValue(p.brushSettingService.getSize());\r\n        opacitySlider.setValue(p.brushSettingService.getOpacity());\r\n    }\r\n\r\n    function updateUI() {\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible && mousePos) {\r\n            div.style.left = (mousePos.x - Math.round(sizeObj.width / 2)) + 'px';\r\n            div.style.top = (mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2)) + 'px';\r\n        }\r\n    }\r\n\r\n    let mousePos = null;\r\n    BB.addEventListener(document, 'pointermove', function(event) {\r\n        mousePos = {\r\n            x: event.pageX,\r\n            y: event.pageY,\r\n        };\r\n    });\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, event, comboStr, isRepeat) {\r\n            if (isRepeat) {\r\n                return;\r\n            }\r\n            if (isVisible) {\r\n                isVisible = false;\r\n                updateUI();\r\n                return;\r\n            }\r\n\r\n            if (!p.enabledTest() || !mousePos) {\r\n                return;\r\n            }\r\n\r\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(comboStr)) {\r\n                event.preventDefault();\r\n                isVisible = true;\r\n\r\n                if (queuedObj.color !== null) {\r\n                    updateColor(queuedObj.color);\r\n                    queuedObj.color = null;\r\n                }\r\n                if (queuedObj.size !== null) {\r\n                    sizeSlider.setValue(queuedObj.size);\r\n                    queuedObj.size = null;\r\n                }\r\n                if (queuedObj.opacity !== null) {\r\n                    opacitySlider.setValue(queuedObj.opacity);\r\n                    queuedObj.opacity = null;\r\n                }\r\n\r\n                updateUI();\r\n            }\r\n\r\n        },\r\n        onUp: function(keyStr, event, oldComboStr) {\r\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(oldComboStr) && isVisible) {\r\n                isVisible = false;\r\n                colorSlider.end();\r\n                updateUI();\r\n            }\r\n        },\r\n        onBlur: function() {\r\n            if (isVisible) {\r\n                isVisible = false;\r\n                colorSlider.end();\r\n                updateUI();\r\n            }\r\n        }\r\n    });\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * Topmost row of buttons in toolspace (with the app logo)\r\n *\r\n * p = { // button click callbacks\r\n *      logoImg: img,\r\n *     onLogo: function(),\r\n *     onNew: function(),\r\n *     onImport: function(),\r\n *     onSave: function(),\r\n *     onShare: function(),\r\n *     onHelp: function()\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceTopRow(p) {\r\n    let div = document.createElement('div');\r\n    BB.css(div, {\r\n        height: '36px',\r\n        //background: '#f00',\r\n        display: 'flex',\r\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n    });\r\n\r\n    function createButton(p) {\r\n        let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n        let result = BB.el({\r\n            className: 'toolspace-row-button nohighlight',\r\n            title: p.title,\r\n            onClick: p.onClick,\r\n            css: {\r\n                padding: p.contain ? padding + 'px 0' : ''\r\n            }\r\n        });\r\n        let im = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: p.contain ? 'contain' : '',\r\n                //filter: 'grayscale(1)',\r\n                height: '100%'\r\n            }\r\n        });\r\n        im.style.pointerEvents = 'none';\r\n        result.appendChild(im);\r\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: result,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(result, 'toolspace-row-button-hover');\r\n                } else {\r\n                    BB.removeClassName(result, 'toolspace-row-button-hover');\r\n                }\r\n            }\r\n        });\r\n        return result;\r\n    }\r\n\r\n    let logoButton = createButton({\r\n        onClick: p.onLogo,\r\n        title: LANG('home'),\r\n        image: p.logoImg ? p.logoImg : klecksLogoImg,\r\n        contain: true\r\n    });\r\n    logoButton.style.width = '45px';\r\n    logoButton.style.borderRight = '1px solid rgb(212, 212, 212)';\r\n    let newButton = createButton({\r\n        onClick: p.onNew,\r\n        title: LANG('file-new'),\r\n        image: newImageImg,\r\n        extraPadding: 1,\r\n        contain: true\r\n    });\r\n    let importButton = createButton({\r\n        onClick: p.onImport,\r\n        title: LANG('file-import'),\r\n        image: importImg,\r\n        extraPadding: 1,\r\n        contain: true\r\n    });\r\n    let saveButton = createButton({\r\n        onClick: p.onSave,\r\n        title: LANG('file-save'),\r\n        image: exportImg,\r\n        extraPadding: 1,\r\n        contain: true\r\n    });\r\n\r\n    let shareButton = null;\r\n    if (BB.canShareFiles()) {\r\n        shareButton = createButton({\r\n            onClick: p.onShare,\r\n            title: LANG('file-share'),\r\n            image: shareImg,\r\n            contain: true\r\n        });\r\n    }\r\n    let helpButton = createButton({\r\n        onClick: p.onHelp,\r\n        title: LANG('help'),\r\n        image: helpImg,\r\n        contain: true\r\n    });\r\n\r\n    div.appendChild(logoButton);\r\n    div.appendChild(newButton);\r\n    div.appendChild(importButton);\r\n    div.appendChild(saveButton);\r\n    if (shareButton) {\r\n        div.appendChild(shareButton);\r\n    }\r\n    div.appendChild(helpButton);\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    }\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eHdqz\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3x5dR\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hbDTd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"16iGk\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2ME3z\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hZnSk\");","import {BB} from '../../../bb/bb';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n// @ts-ignore\r\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\r\n// @ts-ignore\r\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\r\n// @ts-ignore\r\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\r\n// @ts-ignore\r\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\r\n// @ts-ignore\r\nimport caretDownImg from 'url:~/src/app/img/ui/caret-down.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Toolrow Dropdown. The button where you select: brush, fill, select, transform, etc.\r\n *\r\n * p = {\r\n *     onChange: func(activeStr)\r\n * }\r\n *\r\n * activeStr = 'draw' | 'fill' | 'text'\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolDropdown(p) {\r\n\r\n    let optionArr = ['draw', 'fill', 'text', 'shape'];\r\n    let imArr = [\r\n        toolPaintImg,\r\n        toolFillImg,\r\n        toolTextImg,\r\n        toolShapeImg\r\n    ];\r\n    let titleArr = [\r\n        `${LANG('tool-brush')} [B]`,\r\n        `${LANG('tool-paint-bucket')} [G]`,\r\n        `${LANG('tool-text')} [T]`,\r\n        `${LANG('tool-shape')} [U]`,\r\n    ];\r\n    let currentActiveIndex = 0;\r\n    let isActive = true;\r\n    let isOpen = false;\r\n\r\n    //preload images\r\n    setTimeout(function() {\r\n        for (let i = 1; i < imArr.length; i++) {\r\n            let im = new Image();\r\n            im.src = imArr[i];\r\n        }\r\n    }, 100);\r\n\r\n    let smallMargin = '6px 0';\r\n    let div = BB.el({\r\n        css: {\r\n            position: 'relative',\r\n            flexGrow: '1'\r\n        }\r\n    });\r\n\r\n    let openTimeout;\r\n    let isDragging = false;\r\n    let startX, startY;\r\n    let pointerListener;\r\n    if (BB.hasPointerEvents) {\r\n        pointerListener = new BB.PointerListener({\r\n            target: div,\r\n            maxPointers: 1,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown') {\r\n                    if (isOpen) {\r\n                        return;\r\n                    }\r\n\r\n                    openTimeout = setTimeout(function() {\r\n                        showDropdown();\r\n                    }, 400);\r\n                    isDragging = true;\r\n                    startX = event.pageX;\r\n                    startY = event.pageY;\r\n\r\n                } else if (event.type === 'pointermove') {\r\n                    if (isDragging && !isOpen && BB.dist(startX, startY, event.pageX, event.pageY) > 5) {\r\n                        clearTimeout(openTimeout);\r\n                        showDropdown();\r\n                    }\r\n\r\n                } else if (event.type === 'pointerup') {\r\n                    clearTimeout(openTimeout);\r\n                    if (isOpen && isDragging) {\r\n                        let target = document.elementFromPoint(event.pageX, event.pageY);\r\n                        for (let i = 0; i < dropdownBtnArr.length; i++) {\r\n                            if (target === dropdownBtnArr[i].wrapper) {\r\n                                closeDropdown();\r\n                                isActive = true;\r\n                                currentActiveIndex = i;\r\n                                updateButton();\r\n                                p.onChange(optionArr[currentActiveIndex]);\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                    isDragging = false;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    let activeButton = BB.el({\r\n        parent: div,\r\n        className: 'toolspace-row-button nohighlight toolspace-row-button-activated',\r\n        title: titleArr[currentActiveIndex],\r\n        onClick: function(e) {\r\n            if (isActive && !isOpen) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                showDropdown();\r\n                return;\r\n            }\r\n\r\n            isActive = true;\r\n            p.onChange(optionArr[currentActiveIndex]);\r\n            if (isOpen) {\r\n                closeDropdown();\r\n            }\r\n        },\r\n        css: {\r\n            padding: '10px 0',\r\n            pointerEvents: 'auto',\r\n            height: '100%',\r\n            boxSizing: 'border-box'\r\n        }\r\n    });\r\n\r\n    let activeButtonIm = BB.el({\r\n        parent: activeButton,\r\n        css: {\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            backgroundSize: 'contain',\r\n            width: 'calc(100% - 7px)',\r\n            height: '100%',\r\n            pointerEvents: 'none',\r\n            opacity: '0.75',\r\n        }\r\n    });\r\n\r\n    let arrowButton = BB.el({\r\n        parent: activeButton,\r\n        css: {\r\n            position: 'absolute',\r\n            right: '1px',\r\n            bottom: '1px',\r\n            width: '18px',\r\n            height: '18px',\r\n            //background: '#aaa',\r\n            //borderRadius: '2px',\r\n            cursor: 'pointer',\r\n\r\n            backgroundImage: 'url(\\'' + caretDownImg + '\\')',\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            backgroundSize: '60%'\r\n        },\r\n        title: 'More Tools',\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            showDropdown();\r\n        }\r\n    });\r\n\r\n\r\n    let overlay = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            //background: 'rgba(255,0,0,0.5)',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0'\r\n        }\r\n    });\r\n    let overlayPointerListener = new BB.PointerListener({\r\n        target: overlay,\r\n        pointers: 1,\r\n        onPointer: function(e) {\r\n            if (e.type === 'pointerdown') {\r\n                e.eventPreventDefault();\r\n                closeDropdown();\r\n            }\r\n        }\r\n    });\r\n\r\n    let dropdownWrapper = BB.el({\r\n        className: 'tool-dropdown-wrapper',\r\n        css: {\r\n            position: 'absolute',\r\n            width: '100%',\r\n            height: (100 * (optionArr.length - 1)) + '%',\r\n            top: '100%',\r\n            left: '0',\r\n            zIndex: '1',\r\n            boxSizing: 'border-box',\r\n            cursor: 'pointer',\r\n            transition: 'height 0.1s ease-in-out, opacity 0.1s ease-in-out',\r\n            borderBottomLeftRadius: '5px',\r\n            borderBottomRightRadius: '5px',\r\n            overflow: 'hidden',\r\n        }\r\n    });\r\n\r\n    let dropdownBtnArr = [];\r\n\r\n    function createDropdownButton(p) {\r\n        let result = {};\r\n\r\n        let wrapper = BB.el({\r\n            parent: dropdownWrapper,\r\n            className: 'tool-dropdown-button',\r\n            title: p.title,\r\n            css: {\r\n                padding: '10px 0',\r\n                height: (100 / (optionArr.length - 1)) + '%',\r\n                boxSizing: 'border-box'\r\n            },\r\n            onClick: function(e) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                p.onClick(p.index, p.id);\r\n            }\r\n        });\r\n        (result as any).wrapper = wrapper;\r\n        let im = BB.el({\r\n            parent: wrapper,\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: 'contain',\r\n                height: '100%',\r\n                pointerEvents: 'none',\r\n                opacity: '0.75'\r\n            }\r\n        });\r\n\r\n        // --- interface ---\r\n        (result as any).show = function(b) {\r\n            wrapper.style.display = b ? 'block' : 'none';\r\n        };\r\n\r\n        (result as any).setIsSmall = function(b) {\r\n            wrapper.style.padding = b ? smallMargin : '10px 0';\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    function onClickDropdownBtn(index, id) {\r\n        closeDropdown();\r\n\r\n        isActive = true;\r\n        currentActiveIndex = index;\r\n\r\n        updateButton();\r\n\r\n        p.onChange(optionArr[currentActiveIndex]);\r\n    }\r\n\r\n    for (let i = 0; i < optionArr.length; i++) {\r\n        dropdownBtnArr.push(createDropdownButton({\r\n            index: i,\r\n            id: optionArr[i],\r\n            image: imArr[i],\r\n            title: titleArr[i],\r\n            onClick: onClickDropdownBtn\r\n        }));\r\n    }\r\n\r\n    function showDropdown() {\r\n        dialogCounter.increase(0.5);\r\n        isOpen = true;\r\n\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            dropdownBtnArr[i].show(currentActiveIndex !== i);\r\n        }\r\n\r\n        arrowButton.style.display = 'none';\r\n        div.style.zIndex = '1';\r\n        document.body.appendChild(overlay);\r\n        div.appendChild(dropdownWrapper);\r\n    }\r\n\r\n    function closeDropdown() {\r\n        dialogCounter.decrease(0.5);\r\n        isOpen = false;\r\n        arrowButton.style.removeProperty('display');\r\n        div.style.removeProperty('z-index');\r\n        document.body.removeChild(overlay);\r\n\r\n        div.removeChild(dropdownWrapper);\r\n    }\r\n\r\n    function updateButton() {\r\n        activeButton.title = titleArr[currentActiveIndex];\r\n        activeButtonIm.style.backgroundImage = 'url(\\'' + imArr[currentActiveIndex] + '\\')';\r\n    }\r\n    updateButton();\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.setIsSmall = function(b) {\r\n        activeButton.style.padding = b ? smallMargin : '10px 0';\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            dropdownBtnArr[i].setIsSmall(b);\r\n        }\r\n        if (b) {\r\n            arrowButton.style.width = '14px';\r\n            arrowButton.style.height = '14px';\r\n        } else {\r\n            arrowButton.style.width = '18px';\r\n            arrowButton.style.height = '18px';\r\n        }\r\n    };\r\n\r\n    this.setActive = function(activeStr) {\r\n        if (optionArr.includes(activeStr)) {\r\n            isActive = true;\r\n            for (let i = 0; i < optionArr.length; i++) {\r\n                if (optionArr[i] === activeStr) {\r\n                    currentActiveIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n            BB.addClassName(activeButton, 'toolspace-row-button-activated');\r\n            updateButton();\r\n        } else {\r\n            isActive = false;\r\n            BB.removeClassName(activeButton, 'toolspace-row-button-activated');\r\n        }\r\n    };\r\n\r\n    this.getActive = function() {\r\n        return optionArr[currentActiveIndex];\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6mHrC\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hS5Hj\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"doX4v\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7NqHO\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dz3mY\");","import {BB} from '../../../bb/bb';\r\nimport {ToolDropdown} from './tool-dropdown';\r\n// @ts-ignore\r\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\r\n// @ts-ignore\r\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\r\n// @ts-ignore\r\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\r\n// @ts-ignore\r\nimport toolUndoImg from 'url:~/src/app/img/ui/tool-undo.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * Row of buttons in toolspace. image-operations (draw, hand), zoom, undo/redo\r\n * Need to do syncing. So tool is correct, and zoom/undo/redo buttons are properly enabled/disabled\r\n * heights: 54px tall, 36px small -> via setIsSmall\r\n *\r\n * p = {\r\n *     onActivate: function(activeStr), // clicking on tool button - activating it\r\n *     onZoomIn: function(),\r\n *     onZoomOut: function(),\r\n *     onUndo: function(),\r\n *     onRedo: function(),\r\n * }\r\n *\r\n * activeStr = 'draw' | 'hand' | 'fill' | 'text'\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceToolRow(p) {\r\n    let div = document.createElement('div');\r\n    BB.css(div, {\r\n        height: '54px',\r\n        //height: '36px',\r\n        display: 'flex',\r\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n    });\r\n\r\n    let currentActiveStr = 'draw'; // 'draw' | 'hand' | 'fill'\r\n\r\n    function setActive(activeStr, doEmit?) {\r\n        if (currentActiveStr === activeStr) {\r\n            return;\r\n        }\r\n\r\n        currentActiveStr = activeStr;\r\n\r\n        toolDropdown.setActive(currentActiveStr);\r\n        if (currentActiveStr === 'hand') {\r\n            BB.addClassName(handButton, 'toolspace-row-button-activated');\r\n        } else {\r\n            BB.removeClassName(handButton, 'toolspace-row-button-activated');\r\n        }\r\n\r\n        if (doEmit) {\r\n            p.onActivate(currentActiveStr);\r\n        }\r\n    }\r\n\r\n    function createButton(p) {\r\n\r\n        let smallMargin = p.doLighten ? '6px 0' : '8px 0';\r\n\r\n        let result = BB.el({\r\n            className: 'toolspace-row-button nohighlight',\r\n            //title: p.title,\r\n            onClick: p.onClick,\r\n            css: {\r\n                padding: p.contain ? '10px 0' : ''\r\n            }\r\n        });\r\n        let im = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: p.contain ? 'contain' : '',\r\n                //filter: 'grayscale(1)',\r\n                height: '100%',\r\n                transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none',\r\n                opacity: p.doLighten ? '0.75' : '1'\r\n            }\r\n        });\r\n        result.appendChild(im);\r\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: result,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(result, 'toolspace-row-button-hover');\r\n                } else {\r\n                    BB.removeClassName(result, 'toolspace-row-button-hover');\r\n                }\r\n            }\r\n        });\r\n        (result as any).setIsSmall = function(b) {\r\n            result.style.padding = p.contain ? (b ? smallMargin : '10px 0') : '';\r\n        }\r\n        return result;\r\n    }\r\n\r\n\r\n    function createTriangleButton(p) { // because IE and Edge don't support clip path\r\n\r\n        let result = document.createElement('div');\r\n        BB.css(result, {\r\n            flexGrow: '1',\r\n            position: 'relative'\r\n        });\r\n\r\n        let svg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '67px', // can't think of a way doing with percentage\r\n            height: '54px',\r\n            viewBox: '0 0 100 100',\r\n            preserveAspectRatio: 'none'\r\n        });\r\n        BB.css(svg, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0'\r\n        });\r\n\r\n        let blurRadius = 10;\r\n        let blurOffsetX = 2;\r\n        let blurOffsetY = 2;\r\n\r\n        let defs = BB.createSvg( { // inset shadow via svg\r\n            elementType: 'defs',\r\n            childrenArr: [\r\n                {\r\n                    elementType: 'filter',\r\n                    id: 'innershadow',\r\n                    x0: '-50%',\r\n                    y0: '-50%',\r\n                    width: '200%',\r\n                    height: '200%',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'feGaussianBlur',\r\n                            in: 'SourceAlpha',\r\n                            stdDeviation: '' + blurRadius,\r\n                            result: 'blur'\r\n                        }, {\r\n                            elementType: 'feOffset',\r\n                            dx: '' + blurOffsetX,\r\n                            dy: '' + blurOffsetY\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'SourceAlpha',\r\n                            operator: 'arithmetic',\r\n                            k2: '-1',\r\n                            k3: '1',\r\n                            result: 'shadowDiff'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feFlood',\r\n                            'flood-color': '#000',\r\n                            'flood-opacity': '0.2'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'shadowDiff',\r\n                            operator: 'in'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'SourceGraphic',\r\n                            operator: 'over',\r\n                            result: 'firstfilter'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feGaussianBlur',\r\n                            in: 'firstfilter',\r\n                            stdDeviation: '' + blurRadius,\r\n                            result: 'blur2'\r\n                        }, {\r\n                            elementType: 'feOffset',\r\n                            dx: '' + blurOffsetX,\r\n                            dy: '' + blurOffsetY\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'firstfilter',\r\n                            operator: 'arithmetic',\r\n                            k2: '-1',\r\n                            k3: '1',\r\n                            result: 'shadowDiff'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feFlood',\r\n                            'flood-color': '#000',\r\n                            'flood-opacity': '0.2'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'shadowDiff',\r\n                            operator: 'in'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'firstfilter',\r\n                            operator: 'over'\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        });\r\n\r\n\r\n        let svgTriangleLeft = BB.createSvg({\r\n            elementType: 'path',\r\n            'vector-effect': 'non-scaling-stroke',\r\n            d: 'M0,0 L 100,0 0,100 z',\r\n            fill: 'rgba(0,0,0,0)',\r\n            class: 'toolspace-svg-triangle-button'\r\n        });\r\n        svgTriangleLeft.onclick = function() {\r\n            p.onLeft();\r\n            BB.removeClassName(svgTriangleLeft, 'toolspace-svg-triangle-button-hover');\r\n        };\r\n\r\n        let svgTriangleRight = BB.createSvg({\r\n            elementType: 'path',\r\n            'vector-effect': 'non-scaling-stroke',\r\n            d: 'M100,100 L 100,0 0,100 z',\r\n            fill: 'rgba(0,0,0,0)',\r\n            class: 'toolspace-svg-triangle-button'\r\n        });\r\n        svgTriangleRight.onclick = function() {\r\n            p.onRight();\r\n            BB.removeClassName(svgTriangleRight, 'toolspace-svg-triangle-button-hover');\r\n        };\r\n\r\n        // because :hover causes problems w touch\r\n        (result as any).leftPointerListener = new BB.PointerListener({\r\n            target: svgTriangleLeft,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(svgTriangleLeft, 'toolspace-svg-triangle-button-hover');\r\n                } else {\r\n                    BB.removeClassName(svgTriangleLeft, 'toolspace-svg-triangle-button-hover');\r\n                }\r\n            }\r\n        });\r\n        (result as any).rightPointerListener = new BB.PointerListener({\r\n            target: svgTriangleRight,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(svgTriangleRight, 'toolspace-svg-triangle-button-hover');\r\n                } else {\r\n                    BB.removeClassName(svgTriangleRight, 'toolspace-svg-triangle-button-hover');\r\n                }\r\n            }\r\n        });\r\n\r\n\r\n        svg.appendChild(defs);\r\n        svg.appendChild(svgTriangleLeft);\r\n        svg.appendChild(svgTriangleRight);\r\n        result.appendChild(svg);\r\n\r\n\r\n        let leftIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '8px',\r\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        result.appendChild(leftIm);\r\n\r\n\r\n        let rightIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                right: '10px',\r\n                bottom: '8px',\r\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        result.appendChild(rightIm);\r\n\r\n\r\n\r\n\r\n\r\n        (result as any).setIsEnabledLeft = function(b) {\r\n            if (b) {\r\n                BB.removeClassName(svgTriangleLeft, 'toolspace-row-button-disabled');\r\n                BB.removeClassName(leftIm, 'toolspace-row-button-disabled');\r\n            } else {\r\n                BB.addClassName(svgTriangleLeft, 'toolspace-row-button-disabled');\r\n                BB.addClassName(leftIm, 'toolspace-row-button-disabled');\r\n            }\r\n        };\r\n        (result as any).setIsEnabledRight = function(b) {\r\n            if (b) {\r\n                BB.removeClassName(svgTriangleRight, 'toolspace-row-button-disabled');\r\n                BB.removeClassName(rightIm, 'toolspace-row-button-disabled');\r\n            } else {\r\n                BB.addClassName(svgTriangleRight, 'toolspace-row-button-disabled');\r\n                BB.addClassName(rightIm, 'toolspace-row-button-disabled');\r\n            }\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    function createTriangleButtonViaClipPath(p) {\r\n        let result = document.createElement('div');\r\n        BB.css(result, {\r\n            flexGrow: '1',\r\n            position: 'relative'\r\n        });\r\n\r\n\r\n        let leftButton = BB.el({\r\n            className: 'toolspace-triangle-button',\r\n            onClick: p.onLeft,\r\n            css: {\r\n                clipPath: 'polygon(0% 0%, 100% 0%, 100% 0%, 0% 100%)'\r\n            }\r\n        });\r\n\r\n        let leftIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '8px',\r\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        leftButton.appendChild(leftIm);\r\n\r\n\r\n\r\n        let rightButton = BB.el({\r\n            className: 'toolspace-triangle-button',\r\n            onClick: p.onRight,\r\n            css: {\r\n                clipPath: 'polygon(0% 100%, 100% 0%, 100% 100%, 0% 100%)'\r\n            }\r\n        });\r\n\r\n        let rightIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                right: '10px',\r\n                bottom: '8px',\r\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        rightButton.appendChild(rightIm);\r\n\r\n\r\n\r\n        result.appendChild(leftButton);\r\n        result.appendChild(rightButton);\r\n\r\n\r\n        // because :hover causes problems w touch\r\n        (result as any).leftPointerListener = new BB.PointerListener({\r\n            target: leftButton,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(leftButton, 'toolspace-row-button-hover');\r\n                } else {\r\n                    BB.removeClassName(leftButton, 'toolspace-row-button-hover');\r\n                }\r\n            }\r\n        });\r\n        (result as any).rightPointerListener = new BB.PointerListener({\r\n            target: rightButton,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(rightButton, 'toolspace-row-button-hover');\r\n                } else {\r\n                    BB.removeClassName(rightButton, 'toolspace-row-button-hover');\r\n                }\r\n            }\r\n        });\r\n\r\n\r\n\r\n        (result as any).setIsEnabledLeft = function(b) {\r\n            if (b) {\r\n                BB.removeClassName(leftButton, 'toolspace-row-button-disabled');\r\n            } else {\r\n                BB.addClassName(leftButton, 'toolspace-row-button-disabled');\r\n            }\r\n        };\r\n        (result as any).setIsEnabledRight = function(b) {\r\n            if (b) {\r\n                BB.removeClassName(rightButton, 'toolspace-row-button-disabled');\r\n            } else {\r\n                BB.addClassName(rightButton, 'toolspace-row-button-disabled');\r\n            }\r\n        };\r\n        return result;\r\n    }\r\n\r\n    /*let brushButton = createButton({\r\n        onClick: function() {\r\n            setActive('draw', true);\r\n        },\r\n        image: 'app/img/ui/paint.png',\r\n        contain: true,\r\n        doLighten: true\r\n    });\r\n    BB.addClassName(brushButton, 'toolspace-row-button-activated');\r\n    div.appendChild(brushButton);*/\r\n\r\n    let toolDropdown = new ToolDropdown({\r\n        onChange: function(activeStr) {\r\n            setActive(activeStr, true);\r\n        }\r\n    });\r\n    div.appendChild(toolDropdown.getElement());\r\n\r\n    let handButton = createButton({\r\n        onClick: function() {\r\n            setActive('hand', true);\r\n        },\r\n        image: toolHandImg,\r\n        contain: true,\r\n        doLighten: true\r\n    });\r\n    handButton.style.borderRight = '1px solid rgb(212, 212, 212)';\r\n    handButton.title = LANG('tool-hand');\r\n    div.appendChild(handButton);\r\n\r\n    let zoomInNOutButton = createTriangleButton({\r\n        onLeft: p.onZoomIn,\r\n        onRight: p.onZoomOut,\r\n        leftImage: toolZoomInImg,\r\n        rightImage: toolZoomOutImg,\r\n    });\r\n    zoomInNOutButton.title = LANG('tool-zoom');\r\n    div.appendChild(zoomInNOutButton);\r\n\r\n    let zoomInButton = createButton({\r\n        onClick: p.onZoomIn,\r\n        image: toolZoomInImg,\r\n        contain: true\r\n    });\r\n    zoomInButton.title = LANG('zoom-in');\r\n    div.appendChild(zoomInButton);\r\n\r\n    let zoomOutButton = createButton({\r\n        onClick: p.onZoomOut,\r\n        image: toolZoomOutImg,\r\n        contain: true\r\n    });\r\n    zoomOutButton.title = LANG('zoom-out');\r\n    div.appendChild(zoomOutButton);\r\n\r\n    let undoNRedoButton = createTriangleButton({\r\n        onLeft: p.onUndo,\r\n        onRight: p.onRedo,\r\n        leftImage: toolUndoImg,\r\n        rightImage: null,\r\n    });\r\n    undoNRedoButton.title = LANG('tool-undo-redo');\r\n    (undoNRedoButton as any).setIsEnabledLeft(false);\r\n    (undoNRedoButton as any).setIsEnabledRight(false);\r\n    div.appendChild(undoNRedoButton);\r\n\r\n    let undoButton = createButton({\r\n        onClick: p.onUndo,\r\n        image: toolUndoImg,\r\n        contain: true\r\n    });\r\n    undoButton.title = LANG('undo');\r\n    BB.addClassName(undoButton, 'toolspace-row-button-disabled');\r\n    div.appendChild(undoButton);\r\n\r\n    let redoButton = createButton({\r\n        onClick: p.onRedo,\r\n        image: toolUndoImg,\r\n        contain: true,\r\n        doMirror: true\r\n    });\r\n    redoButton.title = LANG('redo');\r\n    BB.addClassName(redoButton, 'toolspace-row-button-disabled');\r\n    div.appendChild(redoButton);\r\n\r\n    zoomInButton.style.display = 'none';\r\n    zoomOutButton.style.display = 'none';\r\n    undoButton.style.display = 'none';\r\n    redoButton.style.display = 'none';\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.setIsSmall = function(b) {\r\n        BB.css(div, {\r\n            height: b ? '36px' : '54px'\r\n        });\r\n\r\n        toolDropdown.setIsSmall(b);\r\n        (handButton as any).setIsSmall(b);\r\n        (zoomInButton as any).setIsSmall(b);\r\n        (zoomOutButton as any).setIsSmall(b);\r\n        (undoButton as any).setIsSmall(b);\r\n        (redoButton as any).setIsSmall(b);\r\n\r\n        if (b) {\r\n            zoomInNOutButton.style.display = 'none';\r\n            undoNRedoButton.style.display = 'none';\r\n            zoomInButton.style.display = 'block';\r\n            zoomOutButton.style.display = 'block';\r\n            undoButton.style.display = 'block';\r\n            redoButton.style.display = 'block';\r\n        } else {\r\n            zoomInNOutButton.style.display = 'block';\r\n            undoNRedoButton.style.display = 'block';\r\n            zoomInButton.style.display = 'none';\r\n            zoomOutButton.style.display = 'none';\r\n            undoButton.style.display = 'none';\r\n            redoButton.style.display = 'none';\r\n        }\r\n\r\n    };\r\n\r\n    this.setEnableZoomIn = function(b) {\r\n        if (b) {\r\n            BB.removeClassName(zoomInButton, 'toolspace-row-button-disabled');\r\n        } else {\r\n            BB.addClassName(zoomInButton, 'toolspace-row-button-disabled');\r\n        }\r\n        (zoomInNOutButton as any).setIsEnabledLeft(b);\r\n    };\r\n    this.setEnableZoomOut = function(b) {\r\n        if (b) {\r\n            BB.removeClassName(zoomOutButton, 'toolspace-row-button-disabled');\r\n        } else {\r\n            BB.addClassName(zoomOutButton, 'toolspace-row-button-disabled');\r\n        }\r\n        (zoomInNOutButton as any).setIsEnabledRight(b);\r\n    };\r\n    this.setEnableUndo = function(b) {\r\n        if (b) {\r\n            BB.removeClassName(undoButton, 'toolspace-row-button-disabled');\r\n        } else {\r\n            BB.addClassName(undoButton, 'toolspace-row-button-disabled');\r\n        }\r\n        (undoNRedoButton as any).setIsEnabledLeft(b);\r\n    };\r\n    this.setEnableRedo = function(b) {\r\n        if (b) {\r\n            BB.removeClassName(redoButton, 'toolspace-row-button-disabled');\r\n        } else {\r\n            BB.addClassName(redoButton, 'toolspace-row-button-disabled');\r\n        }\r\n        (undoNRedoButton as any).setIsEnabledRight(b);\r\n    };\r\n    this.setActive = function(activeStr) {\r\n        setActive(activeStr);\r\n    };\r\n    this.getActive = function() {\r\n        return currentActiveStr;\r\n    };\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2gZH2\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"04ZZm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"j9xio\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"AnO0a\");","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../base-components/select';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Ui to select stabilizer level. 4 options. returned as 0-3\r\n *\r\n * p = {\r\n *     smoothing: number, // initial level 0-3\r\n *     onSelect: function(level number) // 0-3, when level changes\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceStabilizerRow(p) {\r\n\r\n    let div = BB.el({\r\n        tagName: 'label',\r\n        content: LANG('stabilizer') + '&nbsp;',\r\n        title: LANG('stabilizer-title'),\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            fontSize: '13px',\r\n            color: 'rgba(0,0,0,0.6)'\r\n        }\r\n    });\r\n\r\n    let strengthSelect = new Select({\r\n        optionArr: [\r\n            ['0', '0'],\r\n            ['1', '1'],\r\n            ['2', '2'],\r\n            ['3', '3'],\r\n            ['4', '4'],\r\n            ['5', '5']\r\n        ],\r\n        initValue: p.smoothing,\r\n        onChange: function(val) {\r\n            p.onSelect(parseInt(val));\r\n        }\r\n    });\r\n    div.appendChild(strengthSelect.getElement());\r\n\r\n    let pointerListener = new BB.PointerListener({\r\n        target: div,\r\n        onWheel: function(e) {\r\n            strengthSelect.setDeltaValue(e.deltaY);\r\n        }\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport invertedBorderImg from 'url:~/src/app/img/ui/inverted-border.svg';\r\n\r\n/**\r\n * row of tabs. uses css class .tabrow-tab\r\n *\r\n * p = {\r\n *     initialId: string, // e.g. 'draw'\r\n *     useAccent: boolean,\r\n *     tabArr: [\r\n *         {\r\n *             id: string, // e.g. 'draw',\r\n *             label: string, // optional\r\n *             image: string, // optional background image\r\n *             title: string, // optional\r\n *             isVisible: boolean, // optional - default is true\r\n *             onOpen: function(),\r\n *             onClose: function(),\r\n *             css: {...},\r\n *         }\r\n *     ]\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function TabRow(p) {\r\n    let _this = this;\r\n    let height = 35;\r\n    let div = BB.el({\r\n        className: 'tabrow',\r\n        css: {\r\n            height: height + 'px'\r\n        }\r\n    });\r\n\r\n    let tabArr = []; //creates its own internal arr\r\n    let openedTabObj = null;\r\n\r\n    const roundSize = 10;\r\n    const roundRight = BB.el({\r\n        css: {\r\n            width: roundSize + 'px',\r\n            height: roundSize + 'px',\r\n            backgroundImage: `url('${invertedBorderImg}')`,\r\n            backgroundSize: 'cover',\r\n            position: 'absolute',\r\n            right: -roundSize + 'px',\r\n            bottom: '0',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n    const roundLeft = BB.el({\r\n        css: {\r\n            width: roundSize + 'px',\r\n            height: roundSize + 'px',\r\n            backgroundImage: `url('${invertedBorderImg}')`,\r\n            backgroundSize: 'cover',\r\n            position: 'absolute',\r\n            left: -roundSize + 'px',\r\n            bottom: '0',\r\n            transform: 'scale(-1,1)',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n\r\n    function createTab(pTabObj, initialId, useAccent) {\r\n        let result: any = {\r\n            id: pTabObj.id,\r\n            isVisible: 'isVisible' in pTabObj ? pTabObj.isVisible : true,\r\n            onOpen: pTabObj.onOpen,\r\n            onClose: pTabObj.onClose,\r\n            update: function(openedTabObj) {\r\n                tabDiv.className = openedTabObj === result ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab';\r\n                tabDiv.style.display = result.isVisible ? 'block' : 'none';\r\n            }\r\n        };\r\n        let tabDiv = BB.el({\r\n            content: 'label' in pTabObj ? pTabObj.label : '',\r\n            title: 'title' in pTabObj ? pTabObj.title : undefined,\r\n            className: initialId === result.id ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab',\r\n            css: {\r\n                lineHeight: height + 'px',\r\n                display: result.isVisible ? 'block' : 'none',\r\n                zIndex: '0',\r\n            },\r\n            onClick: function() {\r\n                if (openedTabObj === result) {\r\n                    return;\r\n                }\r\n                _this.open(result.id);\r\n            }\r\n        });\r\n        result.div = tabDiv;\r\n        if ('image' in pTabObj) {\r\n            BB.css(tabDiv, {\r\n                backgroundImage: 'url(\\'' + pTabObj.image + '\\')',\r\n                backgroundSize: (height - 7) + 'px'\r\n            });\r\n        }\r\n        if ('css' in pTabObj) {\r\n            BB.css(tabDiv, pTabObj.css);\r\n        }\r\n        div.appendChild(tabDiv);\r\n\r\n        let pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: tabDiv,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(tabDiv, 'tabrow-tab-hover');\r\n                } else {\r\n                    BB.removeClassName(tabDiv, 'tabrow-tab-hover');\r\n                }\r\n            }\r\n        });\r\n\r\n        if (initialId === result.id) {\r\n            result.onOpen();\r\n            result.div.appendChild(roundRight);\r\n            result.div.appendChild(roundLeft);\r\n        } else {\r\n            result.onClose();\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    for (let i = 0; i < p.tabArr.length; i++) {\r\n        tabArr.push(createTab(p.tabArr[i], p.initialId, p.useAccent));\r\n    }\r\n\r\n    for (let i = 0; i < tabArr.length; i++) {\r\n        if (tabArr[i].id === p.initialId) {\r\n            openedTabObj = tabArr[i];\r\n        }\r\n    }\r\n    if (openedTabObj === null) {\r\n        throw 'invalid initialId';\r\n    }\r\n\r\n    function update() {\r\n        for (let i = 0; i < tabArr.length; i++) {\r\n            tabArr[i].update(openedTabObj);\r\n        }\r\n    }\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.open = function(tabId) {\r\n        for (let i = 0; i < tabArr.length; i++) {\r\n            if (tabArr[i].id === tabId) {\r\n                if (openedTabObj === tabArr[i]) { // already open\r\n                    return;\r\n                }\r\n                openedTabObj.onClose();\r\n                openedTabObj = tabArr[i];\r\n                openedTabObj.onOpen();\r\n                openedTabObj.div.appendChild(roundRight);\r\n                openedTabObj.div.appendChild(roundLeft);\r\n                update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.open - invalid tabId';\r\n    };\r\n\r\n    this.getOpenedTabId = function() {\r\n        return '' + openedTabObj.id;\r\n    };\r\n\r\n    this.setIsVisible = function(tabId, isVisible) {\r\n        for (let i = 0; i < tabArr.length; i++) {\r\n            if (tabArr[i].id === tabId) {\r\n                tabArr[i].isVisible = !!isVisible;\r\n                update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.setIsVisible - invalid tabId';\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"nTvP2\");","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport angleImg from 'url:~/src/app/img/ui/angle.svg';\r\n// @ts-ignore\r\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Ui, when hand tool tab is open.\r\n *\r\n * p = {\r\n *     scale: number, // initial value\r\n *     angleDeg: number, // initial value\r\n *     onReset: function(),\r\n *     onFit: function(),\r\n *     onAngleChange: function(angleDeg number, isRelative number)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function HandUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n    let scale = p.scale;\r\n    let angleDeg = p.angleDeg;\r\n\r\n    let row1 = BB.el({\r\n        css: {\r\n            marginBottom: '10px',\r\n            display: 'flex'\r\n        }\r\n    });\r\n    let row2 = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            marginBottom: '10px',\r\n        }\r\n    });\r\n    let row3 = BB.el({\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n    div.append(row1, row2, row3);\r\n\r\n\r\n    let scaleEl = BB.el({\r\n        css: {\r\n            width: '55px',\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    row1.appendChild(scaleEl);\r\n\r\n    let angleIm = new Image();\r\n    angleIm.src = angleImg;\r\n    BB.css(angleIm, {\r\n        verticalAlign: 'bottom',\r\n        width: '20px',\r\n        height: '20px',\r\n        marginRight: '5px',\r\n        borderRadius: '10px',\r\n        background: 'rgba(0,0,0,0.2)',\r\n        userSelect: 'none'\r\n    });\r\n    row1.appendChild(angleIm);\r\n\r\n    let angleEl = BB.el({\r\n        css: {\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    row1.appendChild(angleEl);\r\n\r\n\r\n    function update() {\r\n        scaleEl.innerHTML = Math.round(scale * 100) + '%';\r\n        angleEl.innerHTML =  Math.round(angleDeg) + '';\r\n\r\n\r\n        angleIm.style.transform = 'rotate(' + angleDeg + 'deg)';\r\n        if (angleDeg % 90 === 0) {\r\n            angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)';\r\n        } else {\r\n            angleIm.style.boxShadow = '';\r\n        }\r\n    }\r\n    update();\r\n\r\n\r\n    let resetButton = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('hand-reset'),\r\n        onClick: p.onReset\r\n    });\r\n    BB.makeUnfocusable(resetButton);\r\n\r\n    let fitButton = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('hand-fit'),\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: p.onFit\r\n    });\r\n    BB.makeUnfocusable(fitButton);\r\n    row2.append(resetButton, fitButton);\r\n\r\n    let leftRotateButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\r\n        onClick: function() {\r\n            p.onAngleChange(-15, true);\r\n        }\r\n    });\r\n    BB.makeUnfocusable(leftRotateButton);\r\n\r\n    let resetAngleButton = BB.el({\r\n        tagName: 'button',\r\n        content: '0',\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            p.onAngleChange(0);\r\n        }\r\n    });\r\n    BB.makeUnfocusable(resetAngleButton);\r\n\r\n    let rightRotateButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\"/>',\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            p.onAngleChange(15, true);\r\n        }\r\n    });\r\n    BB.makeUnfocusable(rightRotateButton);\r\n    row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\r\n\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            update();\r\n        }\r\n    };\r\n    this.update = function(pScale, pAngleDeg) {\r\n        scale = pScale;\r\n        angleDeg = pAngleDeg;\r\n        if (isVisible) {\r\n            update();\r\n        }\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6toXQ\");","import {BB} from '../../../bb/bb';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {Select} from '../base-components/select';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Paint Bucket tab contents (color slider, opacity slider, etc)\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function FillUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n\r\n    let colorDiv = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginBottom: '10px'\r\n        }\r\n    });\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 0,\r\n        max: 1,\r\n        initValue: 1,\r\n        onChange: function (val) {\r\n        },\r\n        formatFunc: function(v) {\r\n            return Math.round(v * 100);\r\n        }\r\n    });\r\n    div.appendChild(opacitySlider.getElement());\r\n\r\n    let toleranceSlider = new KlSlider({\r\n        label: LANG('bucket-tolerance'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 0,\r\n        max: 255,\r\n        initValue: 255 / 100 * 20,\r\n        onChange: function (val) {\r\n        },\r\n        formatFunc: function(v) {\r\n            return Math.round(v / 255 * 100);\r\n        }\r\n    });\r\n    BB.css(toleranceSlider.getElement(), {\r\n        marginTop: '10px'\r\n    });\r\n    div.appendChild(toleranceSlider.getElement());\r\n\r\n    let selectRow = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n\r\n    let modeWrapper;\r\n    let modeSelect;\r\n    modeWrapper = BB.el({\r\n        content: LANG('bucket-sample') + '&nbsp;',\r\n        title: LANG('bucket-sample-title'),\r\n        css: {\r\n            fontSize: '15px'\r\n        }\r\n    });\r\n    modeSelect = new Select({\r\n        optionArr: [\r\n            ['all', LANG('bucket-sample-all')],\r\n            ['current', LANG('bucket-sample-active')],\r\n            ['above', LANG('bucket-sample-above')]\r\n        ],\r\n        initValue: 'all',\r\n        onChange: function(val) {}\r\n    });\r\n    let modePointerListener = new BB.PointerListener({\r\n        target: modeSelect.getElement(),\r\n        onWheel: function(e) {\r\n            modeSelect.setDeltaValue(e.deltaY);\r\n        }\r\n    });\r\n    modeWrapper.appendChild(modeSelect.getElement());\r\n    selectRow.appendChild(modeWrapper);\r\n\r\n    let growWrapper;\r\n    let growSelect;\r\n    growWrapper = BB.el({\r\n        content: LANG('bucket-grow') + '&nbsp;',\r\n        title: LANG('bucket-grow-title'),\r\n        css: {\r\n            fontSize: '15px',\r\n            marginLeft: '10px'\r\n        }\r\n    });\r\n    growSelect = new Select({\r\n        optionArr: [\r\n            ['0', '0'],\r\n            ['1', '1'],\r\n            ['2', '2'],\r\n            ['3', '3'],\r\n            ['4', '4'],\r\n            ['5', '5'],\r\n            ['6', '6'],\r\n            ['7', '7'],\r\n        ],\r\n        initValue: '0',\r\n        onChange: function(val) {}\r\n    });\r\n    let growPointerListener = new BB.PointerListener({\r\n        target: growSelect.getElement(),\r\n        onWheel: function(e) {\r\n            growSelect.setDeltaValue(e.deltaY);\r\n        }\r\n    });\r\n    growWrapper.appendChild(growSelect.getElement());\r\n    selectRow.appendChild(growWrapper);\r\n\r\n\r\n    let isContiguous = true;\r\n    let contiguousToggle = new Checkbox({\r\n        init: true,\r\n        label: LANG('bucket-contiguous'),\r\n        title: LANG('bucket-contiguous-title'),\r\n        callback: function (b) {\r\n            isContiguous = b;\r\n        },\r\n        css: {\r\n            marginTop: '10px',\r\n            paddingRight: '5px',\r\n            display: 'inline-block',\r\n        }\r\n    });\r\n    div.appendChild(contiguousToggle.getElement());\r\n\r\n\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            colorDiv.appendChild(p.colorSlider.getElement());\r\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\r\n        }\r\n    };\r\n\r\n    this.getTolerance = function() {\r\n        return toleranceSlider.getValue();\r\n    };\r\n\r\n    this.getOpacity = function() {\r\n        return opacitySlider.getValue();\r\n    };\r\n\r\n    /**\r\n     * returns string 'current' | 'all' | 'above'\r\n     */\r\n    this.getSample = function() {\r\n        return modeSelect.getValue();\r\n    };\r\n\r\n    this.getGrow = function() {\r\n        return parseInt(growSelect.getValue(), 10);\r\n    }\r\n\r\n    this.getContiguous = function() {\r\n        return isContiguous;\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Text Tool tab contents (color slider)\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function TextUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n\r\n    let colorDiv = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginBottom: '10px'\r\n        }\r\n    });\r\n\r\n    let hint = BB.el({\r\n        parent: div,\r\n        content: LANG('text-instruction'),\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            colorDiv.appendChild(p.colorSlider.getElement());\r\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\r\n            //update();\r\n        }\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {Options} from '../base-components/options';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Shape Tool tab contents\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ShapeUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n\r\n    let colorDiv = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginBottom: '10px'\r\n        }\r\n    });\r\n\r\n    let previewSize = 35;\r\n    let previewPadding = 8;\r\n    let shape; // 'rect'|'ellipse'|'line'\r\n    let mode; // 'stroke'|'fill'\r\n\r\n\r\n    let rectStrokeSvgRect = BB.createSvg({\r\n        elementType: 'rect',\r\n        x: '' + previewPadding,\r\n        width: '' + (previewSize - previewPadding * 2)\r\n    });\r\n    let rectStrokeSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize\r\n    });\r\n    rectStrokeSvg.appendChild(rectStrokeSvgRect);\r\n    BB.css(rectStrokeSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n    let rectFilledSvgRect = BB.createSvg({\r\n        elementType: 'rect',\r\n        x: '' + previewPadding,\r\n        width: '' + (previewSize - previewPadding * 2)\r\n    });\r\n    let rectFilledSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize\r\n    });\r\n    rectFilledSvg.appendChild(rectFilledSvgRect);\r\n    BB.css(rectFilledSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n\r\n    let ellipseStrokeSvgEllipse = BB.createSvg({\r\n        elementType: 'ellipse',\r\n        cx: '' + (previewSize / 2),\r\n        cy: '' + (previewSize / 2),\r\n        rx: '' + (previewSize / 2 - previewPadding)\r\n    });\r\n    let ellipseStrokeSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize,\r\n    });\r\n    ellipseStrokeSvg.appendChild(ellipseStrokeSvgEllipse);\r\n    BB.css(ellipseStrokeSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n    let ellipseFilledSvgEllipse = BB.createSvg({\r\n        elementType: 'ellipse',\r\n        cx: '' + (previewSize / 2),\r\n        cy: '' + (previewSize / 2),\r\n        rx: '' + (previewSize / 2 - previewPadding)\r\n    });\r\n    let ellipseFilledSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize,\r\n    });\r\n    ellipseFilledSvg.appendChild(ellipseFilledSvgEllipse);\r\n    BB.css(ellipseFilledSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n\r\n    let lineSvgLine = BB.createSvg({\r\n        elementType: 'line',\r\n        x1: '' + previewPadding,\r\n        x2: '' + (previewSize - previewPadding)\r\n    });\r\n    let lineSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize\r\n    });\r\n    lineSvg.appendChild(lineSvgLine);\r\n    BB.css(lineSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n    function updatePreviews() {\r\n        let strokeWidth = BB.clamp(Math.round(lineWidthSlider.getValue() / 10), 1, 10) + 'px';\r\n\r\n        let squish = 1.35;\r\n\r\n        BB.css(rectStrokeSvgRect, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n        BB.css(rectFilledSvgRect, { fill: 'black', stroke: 'none' });\r\n\r\n        BB.css(ellipseStrokeSvgEllipse, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n        BB.css(ellipseFilledSvgEllipse, { fill: 'black', stroke: 'none' });\r\n\r\n        BB.css(\r\n            lineSvgLine,\r\n            { fill: 'none', stroke: 'black', strokeWidth: strokeWidth }\r\n        );\r\n\r\n        if ((fixedToggle as any).getValue()) {\r\n            rectStrokeSvgRect.setAttribute('y', '' + previewPadding);\r\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n            rectFilledSvgRect.setAttribute('y', '' + previewPadding);\r\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n\r\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n        } else {\r\n            rectStrokeSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n            rectFilledSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n\r\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n        }\r\n\r\n        if ((snapToggle as any).getValue()) {\r\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding));\r\n            lineSvgLine.setAttribute('y2', '' + previewPadding);\r\n        } else {\r\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding * squish));\r\n            lineSvgLine.setAttribute('y2', '' + (previewPadding * squish));\r\n        }\r\n    }\r\n\r\n    let row1 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'start'\r\n        }\r\n    });\r\n\r\n    let shapeOptions = new Options({\r\n        optionArr: [\r\n            {\r\n                id: 'rect-stroke',\r\n                label: rectStrokeSvg,\r\n                title: LANG('shape-rect') + ' ' + LANG('shape-stroke'),\r\n            },\r\n            {\r\n                id: 'ellipse-stroke',\r\n                label: ellipseStrokeSvg,\r\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-stroke'),\r\n            },\r\n            {\r\n                id: 'line',\r\n                label: lineSvg,\r\n                title: LANG('shape-line'),\r\n            },\r\n            {\r\n                id: 'rect-fill',\r\n                label: rectFilledSvg,\r\n                title: LANG('shape-rect') + ' ' + LANG('shape-fill'),\r\n            },\r\n            {\r\n                id: 'ellipse-fill',\r\n                label: ellipseFilledSvg,\r\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-fill'),\r\n            },\r\n        ],\r\n        initId: 'rect',\r\n        onChange: function(id) {\r\n            let split = id.split('-');\r\n            shape = split[0];\r\n            mode = split[1];\r\n\r\n            BB.css(fixedToggle.getElement(), {\r\n                display: shape === 'line' ? 'none' : null\r\n            });\r\n            BB.css(snapToggle.getElement(), {\r\n                display: shape === 'line' ? null : 'none'\r\n            });\r\n            BB.css(lineWidthSlider.getElement(), {\r\n                display: (shape !== 'line' && mode === 'fill') ? 'none' : null\r\n            });\r\n        },\r\n        changeOnInit: true\r\n    });\r\n    shapeOptions.getElement().style.width = '120px';\r\n    row1.appendChild(shapeOptions.getElement());\r\n\r\n    let eraserToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('eraser'),\r\n        callback: function(b) {\r\n            updatePreviews();\r\n        }\r\n    });\r\n    row1.appendChild(eraserToggle.getElement());\r\n\r\n    let lineWidthSlider = new KlSlider({\r\n        label: LANG('shape-line-width'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 1,\r\n        max: 200,\r\n        initValue: 4,\r\n        curve: 'quadratic',\r\n        onChange: function (val) {\r\n            updatePreviews();\r\n        },\r\n        formatFunc: function (v) {\r\n            return Math.round(v);\r\n        }\r\n    });\r\n    BB.css(lineWidthSlider.getElement(), {\r\n        marginTop: '10px'\r\n    });\r\n    div.appendChild(lineWidthSlider.getElement());\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 0,\r\n        max: 1,\r\n        initValue: 1,\r\n        onChange: function (val) {\r\n        },\r\n        formatFunc: function (v) {\r\n            return Math.round(v * 100);\r\n        }\r\n    });\r\n    BB.css(opacitySlider.getElement(), {\r\n        marginTop: '10px'\r\n    });\r\n    div.appendChild(opacitySlider.getElement());\r\n\r\n    let row2 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n\r\n    let outwardsToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('shape-outwards'),\r\n        callback: function(b) {},\r\n        css: {\r\n            width: '50%',\r\n            marginRight: '10px',\r\n        }\r\n    });\r\n    row2.appendChild(outwardsToggle.getElement());\r\n\r\n    let fixedToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('shape-fixed'),\r\n        callback: function(b) {\r\n            updatePreviews();\r\n        },\r\n        css: {\r\n            flexGrow: '1',\r\n        }\r\n    });\r\n    row2.appendChild(fixedToggle.getElement());\r\n\r\n    let snapToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('shape-snap'),\r\n        title: LANG('shape-snap-title'),\r\n        callback: function(b) {\r\n            updatePreviews();\r\n        },\r\n        css: {\r\n            flexGrow: '1',\r\n        }\r\n    });\r\n    row2.appendChild(snapToggle.getElement());\r\n\r\n\r\n\r\n    updatePreviews();\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            colorDiv.appendChild(p.colorSlider.getElement());\r\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\r\n            //update();\r\n        }\r\n    };\r\n\r\n    this.getShape = function() {\r\n        return shape;\r\n    };\r\n\r\n    this.getMode = function() {\r\n        return mode;\r\n    };\r\n\r\n    this.getIsEraser = function() {\r\n        return (eraserToggle as any).getValue();\r\n    };\r\n\r\n    this.getOpacity = function() {\r\n        return opacitySlider.getValue();\r\n    };\r\n\r\n    this.getLineWidth = function() {\r\n        return lineWidthSlider.getValue();\r\n    };\r\n\r\n    this.getIsOutwards = function() {\r\n        return (outwardsToggle as any).getValue();\r\n    };\r\n\r\n    this.getIsFixed = function() {\r\n        return (fixedToggle as any).getValue();\r\n    };\r\n\r\n    this.getIsSnap = function() {\r\n        return (snapToggle as any).getValue();\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../base-components/select';\r\nimport {ColorOptions} from '../base-components/color-options';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * P = {\r\n *     currentColor: RGB, // current color\r\n *     secondaryColor: RGB,\r\n *     maxCanvasSize: number,\r\n *     canvasWidth: number, // current canvas size\r\n *     canvasHeight: number, // current canvas size\r\n *     workspaceWidth: number,\r\n *     workspaceHeight: number,\r\n *     onConfirm: function(width number, height number, color RGBA),\r\n *     onCancel: function()\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function newImageDialog(p) {\r\n\r\n    let currentColor = p.currentColor;\r\n    let secondaryColor = p.secondaryColor;\r\n    let maxCanvasSize = p.maxCanvasSize;\r\n    let canvasWidth = p.canvasWidth;\r\n    let canvasHeight = p.canvasHeight;\r\n    let workspaceWidth = p.workspaceWidth;\r\n    let workspaceHeight = p.workspaceHeight;\r\n    let onConfirm = p.onConfirm;\r\n    let onCancel = p.onCancel;\r\n\r\n\r\n    function createRatioSize(ratioX, ratioY, width, height, padding) {\r\n        return BB.fitInto(ratioX, ratioY, Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding), 1);\r\n    }\r\n\r\n    let newImDiv = document.createElement(\"div\");\r\n    let widthWrapper = document.createElement(\"div\");\r\n    let heightWrapper = document.createElement(\"div\");\r\n    let widthInput = document.createElement(\"input\");\r\n    let widthUnit = document.createElement(\"div\");\r\n    let heightInput = document.createElement(\"input\");\r\n    let heightUnit = document.createElement(\"div\");\r\n    widthWrapper.style.position = \"relative\";\r\n    widthWrapper.style.width = \"145px\";\r\n    widthWrapper.style.height = \"35px\";\r\n    widthWrapper.style.lineHeight = \"30px\";\r\n    heightWrapper.style.width = \"145px\";\r\n    heightWrapper.style.height = \"35px\";\r\n    heightWrapper.style.lineHeight = \"30px\";\r\n\r\n    widthUnit.innerText = LANG('new-px');\r\n    widthUnit.style.color = '#888';\r\n    widthUnit.style.fontSize = \"12px\";\r\n    widthUnit.style.marginLeft = \"5px\";\r\n    widthUnit.style.cssFloat = \"right\";\r\n\r\n    heightUnit.innerText = LANG('new-px');\r\n    heightUnit.style.color = '#888';\r\n    heightUnit.style.fontSize = \"12px\";\r\n    heightUnit.style.marginLeft = \"5px\";\r\n    heightUnit.style.cssFloat = \"right\";\r\n\r\n    widthInput.setAttribute('data-ignore-focus', 'true');\r\n    heightInput.setAttribute('data-ignore-focus', 'true');\r\n\r\n    widthInput.type = 'number';\r\n    widthInput.min = '1';\r\n    widthInput.max = maxCanvasSize;\r\n    widthInput.style.cssFloat = \"right\";\r\n    widthInput.style.width = \"70px\";\r\n\r\n    heightInput.type = 'number';\r\n    heightInput.min = '1';\r\n    heightInput.max = maxCanvasSize;\r\n    heightInput.style.cssFloat = \"right\";\r\n    heightInput.style.width = \"70px\";\r\n    widthInput.value = canvasWidth;\r\n    heightInput.value = canvasHeight;\r\n    widthInput.onclick = function () {\r\n        (this as any).focus();\r\n        updateRatio();\r\n    };\r\n    heightInput.onclick = function () {\r\n        (this as any).focus();\r\n        updateRatio();\r\n    };\r\n    widthWrapper.appendChild(widthUnit);\r\n    widthWrapper.appendChild(widthInput);\r\n    BB.appendTextDiv(widthWrapper, LANG('width') + \": \");\r\n    heightWrapper.appendChild(heightUnit);\r\n    heightWrapper.appendChild(heightInput);\r\n    BB.appendTextDiv(heightWrapper, LANG('height') + \": \");\r\n    let ratioWrapper = document.createElement(\"div\");\r\n    ratioWrapper.style.marginTop = '5px';\r\n    ratioWrapper.style.color = '#888';\r\n\r\n    let templateWrapper = document.createElement(\"div\");\r\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\r\n    let presetFitBtn = document.createElement(\"button\");\r\n    templateWrapper.style.marginBottom = \"10px\";\r\n    let presetCurrentBtn = document.createElement(\"button\");\r\n    let presetSquareBtn = document.createElement(\"button\");\r\n    let presetLandscapeBtn = document.createElement(\"button\");\r\n    let presetPortraitBtn = document.createElement(\"button\");\r\n    let presetOversizeBtn = document.createElement(\"button\");\r\n\r\n    presetCurrentBtn.textContent = LANG('new-current');\r\n    presetFitBtn.textContent = LANG('new-fit');\r\n    presetOversizeBtn.textContent = LANG('new-oversize');\r\n    presetLandscapeBtn.textContent = LANG('new-landscape');\r\n    presetPortraitBtn.textContent = LANG('new-portrait');\r\n    presetSquareBtn.textContent = LANG('new-square');\r\n\r\n    presetCurrentBtn.style.marginRight = \"5px\";\r\n    presetFitBtn.style.marginRight = \"5px\";\r\n    presetOversizeBtn.style.marginRight = \"5px\";\r\n    presetLandscapeBtn.style.marginTop = \"5px\";\r\n    presetLandscapeBtn.style.marginRight = \"5px\";\r\n    presetPortraitBtn.style.marginTop = \"5px\";\r\n    presetPortraitBtn.style.marginRight = \"5px\";\r\n\r\n    templateWrapper.appendChild(presetCurrentBtn);\r\n    templateWrapper.appendChild(presetFitBtn);\r\n    templateWrapper.appendChild(presetOversizeBtn);\r\n    templateWrapper.appendChild(presetSquareBtn);\r\n    templateWrapper.appendChild(presetLandscapeBtn);\r\n    templateWrapper.appendChild(presetPortraitBtn);\r\n\r\n    let templatePadding = 50;\r\n\r\n    presetCurrentBtn.onclick = function () {\r\n        widthInput.value = canvasWidth;\r\n        heightInput.value = canvasHeight;\r\n        updateRatio();\r\n    };\r\n    presetFitBtn.onclick = function () {\r\n        widthInput.value = workspaceWidth;\r\n        heightInput.value = workspaceHeight;\r\n        updateRatio();\r\n    };\r\n    presetOversizeBtn.onclick = function () {\r\n        widthInput.value = workspaceWidth + 500;\r\n        heightInput.value = workspaceHeight + 500;\r\n        updateRatio();\r\n    };\r\n    presetSquareBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetLandscapeBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetPortraitBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n\r\n    let select = new Select({\r\n        isFocusable: true,\r\n        optionArr: [\r\n            ['screen', LANG('new-screen')],\r\n            ['16 9', LANG('new-video') + ' 16:9'],\r\n            ['3 2', '3:2'],\r\n            ['5 3', '5:3'],\r\n            ['2 1', '2:1'],\r\n            ['paper', LANG('new-din-paper') + ' 2:1'],\r\n            ['9 16', '9:16'],\r\n            ['2 3', '2:3'],\r\n            ['3 5', '3:5'],\r\n            ['1 2', '1:2'],\r\n            ['1 1.4142135623730951', '1:2']\r\n        ],\r\n        onChange: function(val) {\r\n            if (val === 'screen') {\r\n                widthInput.value = '' + window.screen.width;\r\n                heightInput.value = '' + window.screen.height;\r\n            } else if (val === 'paper') {\r\n                let sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            } else {\r\n                let split = val.split(' ');\r\n                let sizeObj = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            }\r\n            updateRatio();\r\n            select.setValue(null);\r\n        }\r\n    });\r\n    setTimeout(() => {\r\n        // safari: not empty without also setting it to null via timeout\r\n        select.setValue(null);\r\n    }, 0);\r\n    BB.css(select.getElement(), {\r\n        width: '80px',\r\n    });\r\n    templateWrapper.appendChild(select.getElement());\r\n\r\n\r\n\r\n    let backgroundRGBA = {r: 255, g: 255, b: 255, a: 1};\r\n\r\n    let colorOptionsArr = [\r\n        {r: 255, g: 255, b: 255, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 0}\r\n    ];\r\n    colorOptionsArr.push({\r\n        r: currentColor.r,\r\n        g: currentColor.g,\r\n        b: currentColor.b,\r\n        a: 1\r\n    });\r\n    colorOptionsArr.push({\r\n        r: secondaryColor.r,\r\n        g: secondaryColor.g,\r\n        b: secondaryColor.b,\r\n        a: 1\r\n    });\r\n\r\n    let colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        onChange: function(rgbaObj) {\r\n            backgroundRGBA = rgbaObj;\r\n            preview.style.backgroundColor = \"rgba(\" + rgbaObj.r + \",\" + rgbaObj.g + \",\" + rgbaObj.b + \", \" + rgbaObj.a + \")\";\r\n        }\r\n    });\r\n\r\n    let previewWrapper = document.createElement(\"div\");\r\n    BB.css(previewWrapper, {\r\n        boxSizing: 'border-box',\r\n        width: '340px',\r\n        height: '140px',\r\n        display: 'table',\r\n        backgroundColor: '#9e9e9e',\r\n        padding: '10px',\r\n        marginTop: '10px',\r\n        boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\r\n        marginLeft: '-20px',\r\n        colorScheme: 'only light',\r\n    });\r\n    let preview = document.createElement(\"div\");\r\n    BB.css(preview, {\r\n        width: 200 + \"px\",\r\n        height: 100 + \"px\",\r\n        backgroundColor: \"#fff\",\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n        color: \"#aaa\",\r\n        fontSize: \"16px\",\r\n        fontWeight: \"bold\",\r\n        textAlign: \"center\",\r\n        verticalAlign: \"center\",\r\n        display: \"table\",\r\n        overflow: \"hidden\",\r\n        boxShadow: \"0px 0px 3px rgba(0,0,0,0.5)\"\r\n    });\r\n    let previewcell = document.createElement(\"div\");\r\n    previewcell.style.display = \"table-cell\";\r\n    previewcell.style.verticalAlign = \"middle\";\r\n    previewcell.appendChild(preview);\r\n    previewWrapper.appendChild(previewcell);\r\n    let cell = BB.appendTextDiv(preview, \"\");\r\n    //let ratio = BB.appendTextDiv(cell, \"1:2\");\r\n    cell.style.display = \"table-cell\";\r\n    cell.style.verticalAlign = \"middle\";\r\n    let prevW = parseInt(widthInput.value);\r\n    let prevH = parseInt(heightInput.value);\r\n\r\n    function updateRatio() {\r\n        widthInput.value = '' + Math.min(maxCanvasSize, parseInt(widthInput.value));\r\n        heightInput.value = '' + Math.min(maxCanvasSize, parseInt(heightInput.value));\r\n\r\n        function HCF(u, v) {\r\n            let U = u, V = v;\r\n            while (true) {\r\n                if (!(U %= V))\r\n                    return V;\r\n                if (!(V %= U))\r\n                    return U;\r\n            }\r\n        }\r\n\r\n        let w = parseInt(widthInput.value);\r\n        let h = parseInt(heightInput.value);\r\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\r\n            if (w > maxCanvasSize)\r\n                w = maxCanvasSize;\r\n            else if (h > maxCanvasSize)\r\n                h = maxCanvasSize;\r\n\r\n            widthInput.value = '' + w;\r\n            heightInput.value = '' + h;\r\n        }\r\n\r\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\r\n        let commonRatios = [\r\n            [1, 2], [2, 1],\r\n            [2, 3], [3, 2],\r\n            [3, 4], [4, 3],\r\n            [4, 5], [5, 4],\r\n            [16, 9], [9, 16],\r\n            [3, 2], [2, 3],\r\n            [5, 3], [3, 5],\r\n            [2, 1], [1, 2],\r\n            [1.414, 1], [1, 1.414],\r\n        ];\r\n        let reducedArr = BB.reduce(w, h);\r\n        let closestRatio = null;\r\n        let closestDistance = null;\r\n        for (let i = 0; i < commonRatios.length; i++) {\r\n            if (i === 0 || Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\r\n                closestRatio = commonRatios[i];\r\n                closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\r\n            }\r\n        }\r\n        //display ratio\r\n        if (closestDistance > 0 && closestDistance < 0.005) {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ~' + closestRatio[0] + ':' + closestRatio[1];\r\n        } else {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ' + reducedArr[0] + ':' + reducedArr[1];\r\n        }\r\n\r\n        prevW = w;\r\n        prevH = h;\r\n        let realw = w;\r\n        let T = HCF(w, h);\r\n        w /= T;\r\n        h /= T;\r\n        w *= 260;\r\n        h *= 260;\r\n        if (w > 260) {\r\n            h = 260 / w * h;\r\n            w = 260;\r\n        }\r\n        if (h > 100) {\r\n            w = 100 / h * w;\r\n            h = 100;\r\n\r\n        }\r\n\r\n        preview.style.width = w + \"px\";\r\n        preview.style.height = h + \"px\";\r\n        BB.createCheckerDataUrl(parseInt('' + (30 * (w / realw))), function (url) {\r\n            previewWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n    }\r\n\r\n    widthInput.onchange = function () {\r\n        if (widthInput.value === '' || parseInt(widthInput.value) < 0) {\r\n            widthInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    widthInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    heightInput.onchange = function () {\r\n        if (heightInput.value === '' || parseFloat(heightInput.value) < 0) {\r\n            heightInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    heightInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    updateRatio();\r\n\r\n    newImDiv.appendChild(templateWrapper);\r\n    let secondRow = BB.el({\r\n        parent: newImDiv,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'flex-end'\r\n        }\r\n    });\r\n    let secondRowLeft = BB.el({\r\n        parent: secondRow\r\n    });\r\n    secondRowLeft.appendChild(widthWrapper);\r\n    secondRowLeft.appendChild(heightWrapper);\r\n    secondRowLeft.appendChild(ratioWrapper);\r\n    secondRow.appendChild(colorOptions.getElement());\r\n\r\n    newImDiv.appendChild(previewWrapper);\r\n\r\n    popup({\r\n        target: document.body,\r\n        message: `<b>${LANG('new-title')}</b>`,\r\n        div: newImDiv,\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (result) {\r\n            widthInput.onclick = null;\r\n            heightInput.onclick = null;\r\n            presetCurrentBtn.onclick = null;\r\n            presetFitBtn.onclick = null;\r\n            presetOversizeBtn.onclick = null;\r\n            presetSquareBtn.onclick = null;\r\n            presetLandscapeBtn.onclick = null;\r\n            presetPortraitBtn.onclick = null;\r\n            widthInput.onchange = null;\r\n            widthInput.onkeyup = null;\r\n            heightInput.onchange = null;\r\n            heightInput.onkeyup = null;\r\n            select.destroy();\r\n            colorOptions.destroy();\r\n\r\n            if (result === \"Cancel\" || parseInt(widthInput.value) <= 0 || parseInt(heightInput.value) <= 0 || isNaN(parseInt(widthInput.value)) || isNaN(parseInt(heightInput.value))) {\r\n                onCancel();\r\n                return;\r\n            }\r\n            onConfirm(parseInt(widthInput.value), parseInt(heightInput.value), backgroundRGBA);\r\n        },\r\n        clickOnEnter: 'Ok'\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport collapseImg from 'url:~/src/app/img/ui/ui-collapse.svg';\r\nimport {LANG} from \"../../../language/language\";\r\n\r\n/**\r\n * button that allows to collapse toolspace (for mobile)\r\n *\r\n * p = {\r\n *     onChange: function()\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceCollapser(p) {\r\n    let isOpen = true;\r\n    let directionStr = 'right'; // 'left' | 'right'\r\n\r\n    function update() {\r\n        if (directionStr === 'left') {\r\n            icon.style.transform = isOpen ? 'rotate(180deg)' : '';\r\n        } else {\r\n            icon.style.transform = isOpen ? '' : 'rotate(180deg)';\r\n        }\r\n    }\r\n\r\n    let div = BB.el({\r\n        css: {\r\n            width: '36px',\r\n            height: '36px',\r\n            background: 'rgba(100, 100, 100, 0.9)',\r\n            color: '#fff',\r\n            position: 'absolute',\r\n            top: '0',\r\n            textAlign: 'center',\r\n            lineHeight: '36px',\r\n            cursor: 'pointer',\r\n            userSelect: 'none',\r\n            padding: '6px',\r\n            boxSizing: 'border-box'\r\n        },\r\n        title: LANG('toggle-show-tools'),\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            isOpen = !isOpen;\r\n            update();\r\n            p.onChange();\r\n        }\r\n    });\r\n\r\n    let icon = BB.el({\r\n        parent: div,\r\n        css: {\r\n            backgroundImage: `url(${collapseImg})`,\r\n            width: '100%',\r\n            height: '100%',\r\n            backgroundSize: 'contain',\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    // --- interface ---\r\n    this.isOpen = function() {\r\n        return isOpen;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param dirStr\r\n     */\r\n    this.setDirection = function(dirStr) {\r\n        directionStr = dirStr;\r\n        update();\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"b1UMP\");","import {BB} from '../../../bb/bb';\r\nimport {renderText} from '../../image-operations/render-text';\r\nimport {ColorOptions} from '../base-components/color-options';\r\nimport {Select} from '../base-components/select';\r\nimport {ImageRadioList} from '../base-components/image-radio-list';\r\nimport {ImageToggle} from '../base-components/image-toggle';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {popup} from './popup';\r\n// @ts-ignore\r\nimport alignLeftImg from 'url:~/src/app/img/ui/align-left.svg';\r\n// @ts-ignore\r\nimport alignCenterImg from 'url:~/src/app/img/ui/align-center.svg';\r\n// @ts-ignore\r\nimport alignRightImg from 'url:~/src/app/img/ui/align-right.svg';\r\n// @ts-ignore\r\nimport typoItalicImg from 'url:~/src/app/img/ui/typo-italic.svg';\r\n// @ts-ignore\r\nimport typoBoldImg from 'url:~/src/app/img/ui/typo-bold.svg';\r\n// @ts-ignore\r\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\r\n// @ts-ignore\r\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\r\nimport {IRGB} from '../../kl.types';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Text Tool dialog\r\n *\r\n * confirmP = {\r\n *     x: number,\r\n *     y: number,\r\n *     textStr: string,\r\n *     align: 'left' | 'center' | 'right',\r\n *     isItalic: boolean,\r\n *     isBold: boolean,\r\n *     color: rgb,\r\n *     size: number, // px\r\n *     font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy',\r\n *     opacity: number, // 0 - 1\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function textToolDialog(\r\n    p: {\r\n        klCanvas: KlCanvas;\r\n        layerIndex: number;\r\n        x: number;\r\n        y: number;\r\n        angleRad: number;\r\n        color: IRGB;\r\n        secondaryColor: IRGB;\r\n        size: number; // px\r\n        align: 'left' | 'center' | 'right'; // default 'left'\r\n        isBold: boolean; // default false\r\n        isItalic: boolean; // default false\r\n        font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\r\n        opacity: number; // 0 - 1; default 1\r\n        onConfirm: (confirmP) => void;\r\n    }\r\n) {\r\n\r\n    let div = BB.el({});\r\n\r\n    let isSmallWidth = window.innerWidth < 550;\r\n    let isSmallHeight = window.innerHeight < 630;\r\n\r\n    // --- preview ---\r\n    // Text drawn on klCanvas-sized canvas: textCanvas\r\n    // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\r\n    //      they are transformed. canvas size of final preview\r\n    // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\r\n    // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\r\n\r\n    let width = isSmallWidth ? 340 : 540;\r\n    let height = isSmallWidth ? (isSmallHeight ? 210 : 260) : (isSmallHeight ? 230 : 350);\r\n    let scale = 1;\r\n\r\n    let layerArr = p.klCanvas.getLayersFast();\r\n    let textCanvas = BB.canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\r\n    let textCtx = textCanvas.getContext('2d');\r\n    let targetCanvas = BB.canvas(width, height);\r\n    let targetCtx = targetCanvas.getContext('2d');\r\n    let layersCanvas = BB.canvas(width, height);\r\n    let layersCtx = layersCanvas.getContext('2d');\r\n    let previewCanvas = BB.canvas(width, height); // the one that is visible\r\n    let previewCtx = previewCanvas.getContext('2d');\r\n    BB.css(previewCanvas, {\r\n        display: 'block'\r\n    });\r\n    let previewWrapper = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'relative',\r\n            width: width + 'px',\r\n            marginLeft: '-20px',\r\n            cursor: 'move',\r\n            colorScheme: 'only light',\r\n            touchAction: 'none',\r\n        },\r\n        onClick: function() {\r\n            textInput.focus();\r\n        }\r\n    });\r\n    BB.el({ // inset shadow on preview\r\n        parent: previewWrapper,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n    previewWrapper.appendChild(previewCanvas);\r\n    let checkerPattern = previewCtx.createPattern(BB.createCheckerCanvas(8), 'repeat');\r\n    let emptyCanvas = BB.canvas(1, 1);\r\n    {\r\n        let ctx = emptyCanvas.getContext('2d');\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    }\r\n\r\n    function updatePreview() {\r\n\r\n        // try to draw very much like klCanvasWorkspace\r\n\r\n        // --- draw text ---\r\n        textCtx.clearRect(0, 0, textCanvas.width, textCanvas.height);\r\n        let colorRGBA = {\r\n            ...p.color,\r\n            a: opacitySlider.getValue(),\r\n        };\r\n        let bounds = renderText(textCanvas, {\r\n            x: p.x,\r\n            y: p.y,\r\n            textStr: textInput.value,\r\n            align: alignRadioList.getValue(),\r\n            isItalic: italicToggle.getValue(),\r\n            isBold: boldToggle.getValue(),\r\n            size: parseFloat(sizeInput.value),\r\n            font: fontSelect.getValue(),\r\n            color: BB.ColorConverter.toRgbaStr(colorRGBA),\r\n            angleRad: p.angleRad\r\n        });\r\n\r\n\r\n        // --- determine transformation of viewport ---\r\n        // text should always be visible\r\n        bounds.width = Math.max(bounds.width, 1);\r\n        bounds.height = Math.max(bounds.height, 1);\r\n        let rotatedXY = BB.rotate(bounds.x, bounds.y, -p.angleRad / Math.PI * 180);\r\n        let rotatedWH = BB.rotate(bounds.width, bounds.height, -p.angleRad / Math.PI * 180);\r\n        let centerX = p.x + rotatedXY.x + rotatedWH.x / 2;\r\n        let centerY = p.y + rotatedXY.y + rotatedWH.y / 2;\r\n\r\n        let padding = 100;\r\n        let fitBounds = BB.fitInto(bounds.width, bounds.height, width - padding, height - padding);\r\n        scale = Math.min(1, fitBounds.width / bounds.width);\r\n        scale = Math.min(4, scale * Math.pow(2, zoomFac));\r\n\r\n\r\n        // --- compose text and target layer ---\r\n        targetCtx.save();\r\n\r\n        if (scale >= 4) {\r\n            targetCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            targetCtx.imageSmoothingEnabled = true;\r\n            targetCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n        }\r\n\r\n        targetCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        targetCtx.translate(width / 2, height / 2);\r\n        targetCtx.scale(scale, scale);\r\n        targetCtx.rotate(p.angleRad);\r\n        targetCtx.drawImage(layerArr[p.layerIndex].canvas, -centerX, -centerY);\r\n        targetCtx.drawImage(textCanvas, -centerX, -centerY);\r\n        targetCtx.restore();\r\n\r\n\r\n        // --- layers ---\r\n        layersCtx.save();\r\n\r\n        layersCtx.fillStyle = 'rgb(158,158,158)';\r\n        layersCtx.fillRect(0, 0, width, height);\r\n\r\n        { // bg\r\n            layersCtx.save();\r\n\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n\r\n            layersCtx.imageSmoothingEnabled = false;\r\n\r\n            //outline\r\n            let borderSize = 1 / scale;\r\n            layersCtx.globalAlpha = 0.2;\r\n            layersCtx.drawImage(emptyCanvas, -centerX - borderSize, -centerY - borderSize, textCanvas.width + borderSize * 2, textCanvas.height + borderSize * 2);\r\n            layersCtx.globalAlpha = 1;\r\n\r\n            //erase\r\n            layersCtx.globalCompositeOperation = 'destination-out';\r\n            layersCtx.drawImage(emptyCanvas, -centerX, -centerY, textCanvas.width, textCanvas.height);\r\n\r\n            layersCtx.restore();\r\n        }\r\n\r\n        { // individual layers\r\n\r\n            if (scale >= 4) {\r\n                layersCtx.imageSmoothingEnabled = false;\r\n            } else {\r\n                layersCtx.imageSmoothingEnabled = true;\r\n                layersCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n            }\r\n\r\n            // layers below\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (var i = 0; i < p.layerIndex; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n            // target layer\r\n            layersCtx.globalAlpha = layerArr[p.layerIndex].opacity;\r\n            layersCtx.globalCompositeOperation = layerArr[p.layerIndex].mixModeStr;\r\n            layersCtx.drawImage(targetCanvas, 0, 0);\r\n\r\n            // layers above\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (let i = p.layerIndex + 1; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n        }\r\n\r\n        layersCtx.restore();\r\n\r\n\r\n\r\n        // --- final composite ---\r\n        previewCtx.save();\r\n        previewCtx.fillStyle = checkerPattern;\r\n        previewCtx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        previewCtx.drawImage(layersCanvas, 0, 0);\r\n        previewCtx.restore();\r\n\r\n        // bounds\r\n        previewCtx.save();\r\n        previewCtx.globalCompositeOperation = 'difference';\r\n        previewCtx.strokeStyle = '#fff';\r\n        previewCtx.lineWidth = 1;\r\n        // centerX = p.x + bounds.x + bounds.width / 2;\r\n        // centerY = p.y + bounds.y + bounds.height / 2;\r\n        previewCtx.strokeRect(\r\n            Math.round(width / 2 - (bounds.width / 2) * scale),\r\n            Math.round(height / 2 - (bounds.height / 2) * scale),\r\n            Math.round(bounds.width * scale),\r\n            Math.round(bounds.height * scale)\r\n        );\r\n        previewCtx.restore();\r\n\r\n    }\r\n\r\n    function move(x, y) {\r\n        let rotated = BB.rotate(x, y, -p.angleRad / Math.PI * 180);\r\n        p.x += rotated.x / scale;\r\n        p.y += rotated.y / scale;\r\n        updatePreview();\r\n    }\r\n\r\n    let previewPointerListener = new BB.PointerListener({\r\n        target: previewCanvas,\r\n        pointers: 1,\r\n        onPointer: function(e) {\r\n            if (e.type === 'pointermove' && e.button) {\r\n                e.eventPreventDefault();\r\n                move(-e.dX, -e.dY);\r\n            }\r\n        },\r\n        onWheel: function(e) {\r\n            changeZoomFac(-e.deltaY);\r\n        }\r\n    });\r\n\r\n    const wheelPrevent = (event) => {\r\n        event.preventDefault();\r\n    }\r\n    BB.addEventListener(previewCanvas, 'wheel', wheelPrevent);\r\n\r\n\r\n\r\n    let row1 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n    let row2n3Wrapper = BB.el({\r\n        parent: div,\r\n        css: isSmallWidth ? {} : {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between'\r\n        }\r\n    });\r\n    let row2 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginTop: '5px'\r\n        }\r\n    });\r\n    let row3 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n            marginTop: '5px',\r\n            width: isSmallWidth ? '' : '300px'\r\n        }\r\n    });\r\n\r\n    // --- row 1 ---\r\n\r\n    // color\r\n    let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n    let colorOptionsArr = [\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 255, g: 255, b: 255, a: 1}\r\n    ];\r\n    colorOptionsArr.unshift({\r\n        r: p.secondaryColor.r,\r\n        g: p.secondaryColor.g,\r\n        b: p.secondaryColor.b,\r\n        a: 1,\r\n    });\r\n    colorOptionsArr.unshift({\r\n        r: p.color.r,\r\n        g: p.color.g,\r\n        b: p.color.b,\r\n        a: 1,\r\n    });\r\n\r\n    let colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        initialIndex: 0,\r\n        onChange: function(rgbaObj) {\r\n            p.color = rgbaObj;\r\n            updatePreview();\r\n        }\r\n    });\r\n    colorOptions.getElement().title = LANG('text-color');\r\n    colorOptions.getElement().style.marginLeft = '-5px';\r\n    row1.appendChild(colorOptions.getElement());\r\n\r\n\r\n    let zoomFac = 0;\r\n    function changeZoomFac(d) {\r\n        zoomFac = Math.min(2, Math.max(-2, zoomFac + d));\r\n        updatePreview();\r\n        zoomInBtn.disabled = !canZoom(1);\r\n        zoomOutBtn.disabled = !canZoom(-1);\r\n    }\r\n    function canZoom(d) {\r\n        return zoomFac !== Math.min(2, Math.max(-2, zoomFac + d));\r\n    }\r\n\r\n    let zoomWrapper = BB.el({\r\n        parent: row1,\r\n        css: {\r\n\r\n        }\r\n    })\r\n\r\n    let zoomInBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomInImg}\">`,\r\n        title: LANG('zoom-in'),\r\n        tagName: 'button',\r\n        onClick: function() {\r\n            changeZoomFac(1);\r\n        },\r\n        css: {\r\n            fontWeight: 'bold'\r\n        }\r\n    }) as HTMLButtonElement;\r\n    let zoomOutBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomOutImg}\">`,\r\n        title: LANG('zoom-out'),\r\n        tagName: 'button',\r\n        onClick: function() {\r\n            changeZoomFac(-1);\r\n        },\r\n        css: {\r\n            fontWeight: 'bold',\r\n            marginLeft: '5px'\r\n        }\r\n    }) as HTMLButtonElement;\r\n\r\n\r\n\r\n    // --- row 2 ---\r\n    let sizeInput = BB.el({\r\n        parent: row2,\r\n        tagName: 'input',\r\n        title: LANG('text-size'),\r\n        custom: {\r\n            type: 'number',\r\n            min: 1,\r\n            max: 10000,\r\n            value: p.size\r\n        },\r\n        css: {\r\n            width: '60px'\r\n        },\r\n        onChange: function() {\r\n            sizeInput.value = '' + Math.max(1, Math.min(10000, parseInt(sizeInput.value)));\r\n            updatePreview();\r\n        }\r\n    }) as HTMLInputElement;\r\n    let sizePointerListener = new BB.PointerListener({\r\n        target: sizeInput,\r\n        onWheel: function(e) {\r\n            sizeInput.value = '' + Math.max(1, Math.min(1000, parseInt(sizeInput.value) - e.deltaY));\r\n            updatePreview();\r\n        }\r\n    });\r\n\r\n    let modeWrapper;\r\n    let fontSelect;\r\n    let fontPointerListener;\r\n    {\r\n        modeWrapper = BB.el({\r\n            css: {\r\n                fontSize: '15px',\r\n                marginLeft: '10px'\r\n            }\r\n        });\r\n        fontSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['sans-serif', 'Sans-serif'],\r\n                ['serif', 'Serif'],\r\n                ['monospace', 'Monospace'],\r\n                ['cursive', 'Cursive'],\r\n                ['fantasy', 'Fantasy'],\r\n            ],\r\n            initValue: p.font,\r\n            onChange: function(val) {\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        modeWrapper.appendChild(fontSelect.getElement());\r\n        row2.appendChild(modeWrapper);\r\n\r\n        fontPointerListener = new BB.PointerListener({\r\n            target: fontSelect.getElement(),\r\n            onWheel: function(e) {\r\n                fontSelect.setDeltaValue(e.deltaY);\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n    // --- row 3 ---\r\n\r\n    let alignRadioList = new ImageRadioList({\r\n        optionArr: [\r\n            {\r\n                id: 'left',\r\n                title: LANG('text-left'),\r\n                image: alignLeftImg,\r\n            },\r\n            {\r\n                id: 'center',\r\n                title: LANG('text-center'),\r\n                image: alignCenterImg,\r\n            },\r\n            {\r\n                id: 'right',\r\n                title: LANG('text-right'),\r\n                image: alignRightImg,\r\n            }\r\n        ],\r\n        initId: p.align,\r\n        onChange: function(id) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(alignRadioList.getElement());\r\n\r\n    let italicToggle = new ImageToggle({\r\n        image: typoItalicImg,\r\n        title: LANG('text-italic'),\r\n        initValue: p.isItalic,\r\n        onChange: function(b) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(italicToggle.getElement());\r\n\r\n    let boldToggle = new ImageToggle({\r\n        image: typoBoldImg,\r\n        title: LANG('text-bold'),\r\n        initValue: p.isBold,\r\n        onChange: function(b) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(boldToggle.getElement());\r\n\r\n\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 150,\r\n        height: 30,\r\n        min: 0,\r\n        max: 1,\r\n        initValue: p.opacity,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        onChange: function(v) {\r\n            updatePreview();\r\n        },\r\n        formatFunc: function(v) {\r\n            return Math.round(v * 100);\r\n        }\r\n    });\r\n    row3.appendChild(opacitySlider.getElement());\r\n\r\n\r\n\r\n    let textInput = BB.el({\r\n        parent: div,\r\n        tagName: 'textarea',\r\n        custom: {\r\n            placeholder: LANG('text-placeholder'),\r\n            'data-ignore-focus': 'true',\r\n        },\r\n        css: {\r\n            whiteSpace: 'nowrap',\r\n            overflow: 'auto',\r\n            width: '100%',\r\n            height: '70px',\r\n            resize: 'vertical',\r\n            marginTop: '10px'\r\n        },\r\n        onChange: function() {\r\n            updatePreview();\r\n        }\r\n    }) as HTMLTextAreaElement;\r\n    textInput.addEventListener('input', updatePreview);\r\n    setTimeout(function() {\r\n        textInput.focus();\r\n        textInput.select();\r\n    });\r\n    let closefunc;\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e, comboStr) {\r\n            if (BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    // prevent mobile keyboards scrolling page\r\n    function onScroll() {\r\n        window.scrollTo(0, 0);\r\n    }\r\n    window.addEventListener('scroll', onScroll);\r\n\r\n\r\n    popup({\r\n        target: document.body,\r\n        message: `<b>${LANG('text-title')}</b>`,\r\n        div: div,\r\n        buttons: [\"Ok\", \"Cancel\"],\r\n        style: isSmallWidth ? {} : {\r\n            width: '500px'\r\n        },\r\n        callback: function(val) {\r\n            let result = {\r\n                x: p.x,\r\n                y: p.y,\r\n                textStr: textInput.value,\r\n                align: alignRadioList.getValue(),\r\n                isItalic: italicToggle.getValue(),\r\n                isBold: boldToggle.getValue(),\r\n                color: p.color,\r\n                size: sizeInput.value,\r\n                font: fontSelect.getValue(),\r\n                opacity: opacitySlider.getValue()\r\n            };\r\n\r\n            window.removeEventListener('scroll', onScroll);\r\n            textInput.removeEventListener('input', updatePreview);\r\n            BB.destroyEl(textInput);\r\n            previewPointerListener.destroy();\r\n            sizePointerListener.destroy();\r\n            fontPointerListener.destroy();\r\n            BB.removeEventListener(previewCanvas, 'wheel', wheelPrevent);\r\n            BB.destroyEl(previewWrapper);\r\n            BB.destroyEl(zoomInBtn);\r\n            BB.destroyEl(zoomOutBtn);\r\n            BB.destroyEl(sizeInput);\r\n            colorOptions.destroy();\r\n            fontSelect.destroy();\r\n            keyListener.destroy();\r\n            alignRadioList.destroy();\r\n            italicToggle.destroy();\r\n            boldToggle.destroy();\r\n            opacitySlider.destroy();\r\n            if (val === 'Ok') {\r\n                p.onConfirm(result);\r\n            }\r\n        },\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        ignoreBackground: true,\r\n        closefunc: function (func) {\r\n            closefunc = func;\r\n        },\r\n    });\r\n\r\n    updatePreview();\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"lvwQ5\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"imAvm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dC0sF\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h3hPo\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1pAeY\");","import {BB} from '../../../bb/bb';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n *\r\n * p = {\r\n *     image: convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas},\r\n *     maxSize: number,\r\n *     target: htmlElement,\r\n *     callback: func(\r\n *         {\r\n *             type: 'as-image',\r\n *             image: image | canvas,\r\n *         } | {\r\n *             type: 'as-image-psd',\r\n *             image: convertedPsd,\r\n *             cropObj: {x: number, y: number, width: number, height: number}\r\n *         } | {\r\n *             type: 'as-layer',\r\n *             image: image | canvas,\r\n *         } | {\r\n *             type: 'cancel',\r\n *         }\r\n *     )\r\n * }\r\n *\r\n * @param p {}\r\n */\r\nexport function showImportImageDialog(p) {\r\n    const div = BB.el({});\r\n\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n    const style = isSmall ? {} : { width: '500px' };\r\n    let resolutionEl;\r\n    const cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 400,\r\n        canvas: p.image.canvas,\r\n        isNotCopy: true,\r\n        onChange: function(width, height) {\r\n            if (!resolutionEl) {\r\n                return;\r\n            }\r\n            updateResolution(width, height);\r\n        }\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginLeft: '-20px',\r\n        borderTop: '1px solid #bbb',\r\n        borderBottom: '1px solid #bbb'\r\n    });\r\n    cropCopy.getEl().title = LANG('crop-drag-to-crop');\r\n    div.appendChild(cropCopy.getEl());\r\n\r\n\r\n    resolutionEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginTop: '10px',\r\n            textAlign: 'center',\r\n            color: '#888',\r\n            lineHeight: '20px',\r\n        }\r\n    });\r\n    function updateResolution(w: number, h: number) {\r\n        const fit = BB.fitInto(w, h, p.maxSize, p.maxSize);\r\n\r\n        if (fit.width < w) {\r\n            resolutionEl.innerHTML = `<span style=\"color:#f00\">${w} X ${h}</span>  ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\r\n            resolutionEl.title = LANG('import-too-large');\r\n        } else {\r\n            resolutionEl.innerHTML = `${w} X ${h}`;\r\n            resolutionEl.title = '';\r\n        }\r\n    }\r\n    updateResolution(p.image.width, p.image.height);\r\n\r\n\r\n    let doFlatten = false;\r\n    function showWarnings(psdWarningArr) {\r\n        let contentArr = [];\r\n        let warningMap = {\r\n            'mask': 'Masks not supported. Mask was applied.',\r\n            'clipping': 'Clipping not supported. Clipping layers were merged.',\r\n            'group': 'Groups not supported. Layers were ungrouped.',\r\n            'adjustment': 'Adjustment layers not supported.',\r\n            'layer-effect': 'Layer effects not supported.',\r\n            'smart-object': 'Smart objects not supported.',\r\n            'blend-mode': 'Unsupported layer blend mode.',\r\n            'bits-per-channel': 'Unsupported color depth. Only 8bit per channel supported.',\r\n        };\r\n        for (let i = 0; i < psdWarningArr.length; i++) {\r\n            contentArr.push('- ' + warningMap[psdWarningArr[i]]);\r\n        }\r\n        alert(contentArr.join(\"\\n\"));\r\n    }\r\n\r\n    let flattenCheckbox;\r\n    if (p.image.type === 'psd') {\r\n        const noteStyle = {\r\n            background: 'rgba(255,255,0,0.5)',\r\n            padding: '10px',\r\n            marginTop: '5px',\r\n            marginBottom: '5px',\r\n            border: '1px solid #e7d321',\r\n            borderRadius: '5px'\r\n        };\r\n        if (p.image.layers) {\r\n            flattenCheckbox = new Checkbox({\r\n                init: doFlatten,\r\n                label: LANG('import-flatten'),\r\n                callback: function(b) {\r\n                    doFlatten = b;\r\n                }\r\n            });\r\n            div.appendChild(flattenCheckbox.getElement());\r\n\r\n            if (p.image.warningArr) {\r\n                const noteEl = BB.el({\r\n                    content: LANG('import-psd-limited-support'),\r\n                    css: noteStyle\r\n                });\r\n                noteEl.appendChild(BB.el({\r\n                    tagName: 'a',\r\n                    content: 'Details',\r\n                    onClick: function() {\r\n                        showWarnings(p.image.warningArr);\r\n                    }\r\n                }));\r\n                div.appendChild(noteEl);\r\n            }\r\n        } else {\r\n            const noteEl = BB.el({\r\n                content: LANG('import-psd-unsupported'),\r\n                css: noteStyle\r\n            });\r\n            div.appendChild(noteEl);\r\n        }\r\n    }\r\n\r\n    function callback(result) {\r\n        const croppedImage = cropCopy.getCroppedImage();\r\n        const cropRect = cropCopy.getRect();\r\n        cropCopy.destroy();\r\n        if (flattenCheckbox) {\r\n            flattenCheckbox.destroy();\r\n        }\r\n\r\n        if (result === LANG('import-btn-as-layer')) {\r\n            p.callback({\r\n                type: 'as-layer',\r\n                image: croppedImage\r\n            });\r\n\r\n        } else if (result === LANG('import-btn-as-image')) {\r\n            if (p.image.type === 'psd') {\r\n                if (doFlatten) {\r\n                    p.image.layers = null;\r\n                }\r\n                p.callback({\r\n                    type: 'as-image-psd',\r\n                    image: p.image,\r\n                    cropObj: cropRect\r\n                });\r\n            } else if (p.image.type === 'image') {\r\n                p.callback({\r\n                    type: 'as-image',\r\n                    image: croppedImage\r\n                });\r\n            }\r\n        } else {\r\n            p.callback({\r\n                type: 'cancel'\r\n            });\r\n        }\r\n    }\r\n    popup({\r\n        target: p.target,\r\n        message: `<b>${LANG('import-title')}</b>`,\r\n        div: div,\r\n        style,\r\n        buttons: [LANG('import-btn-as-layer'), LANG('import-btn-as-image'), \"Cancel\"],\r\n        callback: callback,\r\n        autoFocus: 'As Image'\r\n    });\r\n}","import {createCanvas} from '../../bb/base/create-canvas';\r\nimport {Psd} from 'ag-psd/dist/psd';\r\nimport {IKlProject, IKlPsd, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {MAX_LAYERS} from '../canvas/kl-canvas';\r\n\r\nlet kl2PsdMap;\r\nlet psd2KlMap;\r\n\r\nfunction init() {\r\n    if (kl2PsdMap) {\r\n        return;\r\n    }\r\n\r\n    kl2PsdMap = {\r\n        'source-over': 'normal',\r\n\r\n        'darken': 'darken',\r\n        'multiply': 'multiply',\r\n        'color-burn': 'color burn',\r\n\r\n        'lighten': 'lighten',\r\n        'screen': 'screen',\r\n        'color-dodge': 'color dodge',\r\n\r\n        'overlay': 'overlay',\r\n        'soft-light': 'soft light',\r\n        'hard-light': 'hard light',\r\n\r\n        'difference': 'difference',\r\n        'exclusion': 'exclusion',\r\n\r\n        'hue': 'hue',\r\n        'saturation': 'saturation',\r\n        'color': 'color',\r\n        'luminosity': 'luminosity',\r\n    };\r\n\r\n    psd2KlMap = {};\r\n    let keys = Object.keys(kl2PsdMap);\r\n    for (let i = 0; i < keys.length; i++) {\r\n        psd2KlMap[kl2PsdMap[keys[i]]] = keys[i];\r\n    }\r\n}\r\n\r\nexport function blendPsdToKl(str: string): IMixMode {\r\n    init();\r\n    return psd2KlMap[str];\r\n}\r\n\r\nexport function blendKlToPsd(str: string): string {\r\n    init();\r\n    return kl2PsdMap[str];\r\n}\r\n\r\n\r\n/**\r\n * Converts ag-psd object into something that KlCanvas can represent\r\n * @param psdObj\r\n */\r\nexport function readPsd(psdObj: Psd): IKlPsd {\r\n    let result: IKlPsd = {\r\n        type: 'psd',\r\n        canvas: psdObj.canvas,\r\n        width: psdObj.width,\r\n        height: psdObj.height\r\n    };\r\n\r\n    function addWarning(warningStr) {\r\n        if (!result.warningArr) {\r\n            result.warningArr = [];\r\n        }\r\n        if (result.warningArr.includes(warningStr)) {\r\n            return;\r\n        }\r\n        result.warningArr.push(warningStr);\r\n    }\r\n\r\n    function getMixModeStr(blendMode): IMixMode {\r\n        let mixModeStr: IMixMode = blendPsdToKl(blendMode);\r\n        if (!mixModeStr) {\r\n            addWarning('blend-mode');\r\n            mixModeStr = 'source-over';\r\n        }\r\n        return mixModeStr;\r\n    }\r\n\r\n    if (psdObj.bitsPerChannel !== 8) {\r\n        addWarning('bits-per-channel');\r\n    }\r\n\r\n    if (!psdObj.children) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    // count resulting layers\r\n    let maxLayers = MAX_LAYERS;\r\n    let layerCount = 0;\r\n    function countWithinGroup(groupObj) {\r\n        let result = 0;\r\n        if (groupObj.blendMode) {\r\n            let mixModeStr = blendPsdToKl(groupObj.blendMode);\r\n            if (mixModeStr && mixModeStr !== 'source-over') {\r\n                return 1;\r\n            }\r\n        }\r\n        for (let i = 0; i < groupObj.children.length; i++) {\r\n            let item = groupObj.children[i];\r\n            if (item.clipping || item.adjustment) {\r\n                continue;\r\n            }\r\n\r\n            if (item.children) {\r\n                addWarning('group');\r\n                result += countWithinGroup(item);\r\n            } else {\r\n                result++;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    layerCount += countWithinGroup(psdObj);\r\n    if (layerCount > maxLayers) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    result.layers = [];\r\n\r\n    function prepareMask(maskCanvas, defaultColor) {\r\n        const groupMaskCtx = maskCanvas.getContext('2d');\r\n        let imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n        if (defaultColor === 0) {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = imData.data[i];\r\n            }\r\n        } else {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = 255 - imData.data[i];\r\n            }\r\n        }\r\n        groupMaskCtx.putImageData(imData, 0, 0);\r\n    }\r\n\r\n    function convertGroup(psdGroupObj): {\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n        opacity: number;\r\n        image: HTMLCanvasElement;\r\n    }[] {\r\n\r\n        let resultArr: {\r\n            name: string;\r\n            mixModeStr: IMixMode;\r\n            opacity: number;\r\n            image: HTMLCanvasElement;\r\n        }[] = [];\r\n        let groupOpacity = psdGroupObj.hidden ? 0 : psdGroupObj.opacity;\r\n        let groupMixModeStr = getMixModeStr(psdGroupObj.blendMode);\r\n        let groupCanvas;\r\n        let groupCtx;\r\n        if (groupMixModeStr !== 'source-over') {\r\n            groupCanvas = createCanvas(result.width, result.height);\r\n            groupCtx = groupCanvas.getContext('2d');\r\n        }\r\n\r\n\r\n        // prepare group mask\r\n        if (psdGroupObj.mask) {\r\n            addWarning('mask');\r\n            prepareMask(psdGroupObj.mask.canvas, psdGroupObj.mask.defaultColor);\r\n        }\r\n\r\n\r\n        for (let i = 0; i < psdGroupObj.children.length; i++) {\r\n            let item = psdGroupObj.children[i];\r\n            if (item.clipping) {\r\n                continue;\r\n            }\r\n            if (item.adjustment) {\r\n                addWarning('adjustment');\r\n                continue;\r\n            }\r\n\r\n            let hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\r\n            if (hasClipping) {\r\n                addWarning('clipping');\r\n            }\r\n\r\n            if (item.children) {\r\n                let innerArr = convertGroup(item);\r\n\r\n                for (let e = 0; e < innerArr.length; e++) {\r\n                    let innerItem = innerArr[e];\r\n                    let innerCtx = innerItem.image.getContext('2d');\r\n\r\n                    // clipping\r\n                    if (hasClipping) {\r\n                        let clippingCanvas = createCanvas(result.width, result.height);\r\n                        let clippingCtx = clippingCanvas.getContext('2d');\r\n                        clippingCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                        for (let f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++) {\r\n                            let clippingItem = psdGroupObj.children[f];\r\n                            if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                                continue;\r\n                            }\r\n                            clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                            clippingCtx.globalAlpha = clippingItem.opacity;\r\n                            clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\r\n                        }\r\n\r\n                        innerCtx.globalCompositeOperation = 'source-atop';\r\n                        innerCtx.drawImage(clippingCanvas, 0, 0);\r\n                    }\r\n\r\n\r\n\r\n                    // group mask\r\n                    if (psdGroupObj.mask) {\r\n                        innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                        innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n                    }\r\n\r\n                    if (groupCanvas) {\r\n                        groupCtx.globalCompositeOperation = innerItem.mixModeStr;\r\n                        groupCtx.globalAlpha = innerItem.opacity;\r\n                        groupCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                    } else {\r\n                        innerItem.opacity = innerItem.opacity * groupOpacity;\r\n                        resultArr.push(innerItem);\r\n                    }\r\n                }\r\n\r\n                continue;\r\n            }\r\n\r\n            let canvas = createCanvas(result.width, result.height);\r\n            let ctx = canvas.getContext('2d');\r\n            if (item.canvas) { // if a layer is empty it has no canvas\r\n                ctx.drawImage(item.canvas, item.left, item.top);\r\n            }\r\n\r\n            // effects\r\n            if (item.effects) {\r\n                addWarning('layer-effect');\r\n            }\r\n\r\n            // mask\r\n            if (item.mask) {\r\n                addWarning('mask');\r\n                prepareMask(item.mask.canvas, item.mask.defaultColor);\r\n\r\n                ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\r\n            }\r\n\r\n            // clipping\r\n            if (hasClipping) {\r\n                let clippingCanvas = createCanvas(item.right - item.left, item.bottom - item.top);\r\n                let clippingCtx = clippingCanvas.getContext('2d');\r\n                clippingCtx.drawImage(item.canvas, 0, 0);\r\n\r\n                for (let e = i + 1; e < psdGroupObj.children.length && psdGroupObj.children[e].clipping; e++) {\r\n                    let clippingItem = psdGroupObj.children[e];\r\n                    if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                        continue;\r\n                    }\r\n                    clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                    clippingCtx.globalAlpha = clippingItem.opacity;\r\n                    clippingCtx.drawImage(clippingItem.canvas, clippingItem.left - item.left, clippingItem.top - item.top);\r\n                }\r\n\r\n                ctx.globalCompositeOperation = 'source-atop';\r\n                ctx.drawImage(clippingCanvas, item.left, item.top);\r\n            }\r\n\r\n            // group mask\r\n            if (psdGroupObj.mask) {\r\n                ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n            }\r\n\r\n            if (groupCanvas) {\r\n                if (groupOpacity > 0) {\r\n                    groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\r\n                    groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\r\n                    groupCtx.drawImage(canvas, 0, 0);\r\n                }\r\n\r\n            } else {\r\n                resultArr.push({\r\n                    name: item.name,\r\n                    opacity: (item.hidden ? 0 : item.opacity) * groupOpacity,\r\n                    mixModeStr: getMixModeStr(item.blendMode),\r\n                    image: canvas,\r\n                });\r\n            }\r\n        }\r\n\r\n        if (groupCanvas) {\r\n            resultArr = [\r\n                {\r\n                    name: psdGroupObj.name,\r\n                    opacity: groupOpacity,\r\n                    mixModeStr: groupMixModeStr,\r\n                    image: groupCanvas,\r\n                }\r\n            ];\r\n        }\r\n\r\n        return resultArr;\r\n    }\r\n\r\n    result.layers = convertGroup({\r\n        name: 'root',\r\n        opacity: 1,\r\n        blendMode: 'normal',\r\n        children: psdObj.children\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\nexport function klPsdToKlProject(klPsd: IKlPsd): IKlProject {\r\n    // only share references to Canvas elements\r\n    const result: IKlProject = {\r\n        width: klPsd.width,\r\n        height: klPsd.height,\r\n        layers: [],\r\n    };\r\n    if (klPsd.layers) {\r\n        result.layers = result.layers.concat(klPsd.layers.map(item => {\r\n            return {\r\n                name: item.name,\r\n                opacity: item.opacity,\r\n                mixModeStr: item.mixModeStr,\r\n                image: item.image,\r\n            };\r\n        }));\r\n    } else {\r\n        // flattened\r\n        result.layers.push({\r\n            name: LANG('background'),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over',\r\n            image: klPsd.canvas,\r\n        });\r\n    }\r\n    return result;\r\n}","//browser storage indexedDB\r\n\r\n\r\nimport {IKlStorageProject} from '../kl.types';\r\n\r\nconst indexedDbIsSupported = !!window.indexedDB;\r\nlet dbNameStr = 'Klecks';\r\nconst storageNameStr = 'ProjectStore';\r\n\r\nexport function setDbName(name: string) {\r\n    dbNameStr = '' + name;\r\n}\r\n\r\n/**\r\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\r\n * with index 'id'\r\n *\r\n * @param actionFunction function(storeObj) - what you want to execute during transaction\r\n * @param successCallback function() - on succesful transaction\r\n * @param errorCallback function(errorStr) - on error\r\n */\r\nfunction execIndexedDBTransaction(actionFunction, successCallback, errorCallback) {\r\n\r\n    let hasFinished = false;\r\n\r\n    function onSuccess() {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        successCallback();\r\n    }\r\n\r\n    function onError(errorStr) {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        errorCallback(errorStr);\r\n    }\r\n\r\n    if (!indexedDbIsSupported) {\r\n        setTimeout(function () {\r\n            onError('no indexed db available');\r\n        }, 0);\r\n        return;\r\n    }\r\n    let requestObj;\r\n\r\n    try {\r\n        requestObj = window.indexedDB.open(dbNameStr, 1);\r\n    } catch (e) {\r\n        onError(e.message);\r\n        return;\r\n    }\r\n\r\n    requestObj.onupgradeneeded = function (e) {\r\n        try {\r\n            let db = requestObj.result;\r\n            let store = db.createObjectStore(storageNameStr, {keyPath: 'id'});\r\n            store.createIndex('id', 'id', {unique: true});\r\n        } catch (e) {\r\n            onError(e.message);\r\n        }\r\n    };\r\n    requestObj.onerror = function (e) {\r\n        onError('indexedDB.open failed, ' + requestObj.error);\r\n    };\r\n    requestObj.onsuccess = function (e) {\r\n        let databaseObj;\r\n        let transactionObj;\r\n        let storeObj;\r\n\r\n        try {\r\n            databaseObj = requestObj.result;\r\n            if (!databaseObj.objectStoreNames.contains(storageNameStr)) {\r\n                //someone maybe messed with the db, or creation failed earlier\r\n                //it's broken -> destroy\r\n                window.indexedDB.deleteDatabase(dbNameStr);\r\n                onError('object store ' + storageNameStr + ' missing. destroying db');\r\n                return;\r\n            }\r\n            transactionObj = databaseObj.transaction(storageNameStr, 'readwrite');\r\n            storeObj = transactionObj.objectStore(storageNameStr);\r\n            storeObj.index('id');\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        databaseObj.onerror = function (e) {\r\n            onError('database error, ' + databaseObj.error);\r\n        };\r\n\r\n        try {\r\n            actionFunction(storeObj);\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        transactionObj.oncomplete = function () {\r\n            onSuccess();\r\n            databaseObj.close();\r\n        };\r\n        transactionObj.onerror = function () {\r\n            onError('transaction error, ' + transactionObj.error);\r\n        };\r\n    };\r\n}\r\n\r\n/**\r\n * getKlProjectObj {\r\n *     width: int,\r\n *     height: int,\r\n *     layers: {\r\n *        name: string,\r\n *        opacity: float (0 - 1),\r\n *        mixModeStr: string,\r\n *        image: image object                <--------- image already loaded!\r\n *     }[]\r\n * }\r\n *\r\n * @param successCallback function - called when succesfully queried. passes KlProjectObj\r\n * @param errorCallback - function(errorStr) - called when error during query\r\n */\r\nexport function getKlProjectObj(successCallback, errorCallback) {\r\n    if (indexedDbIsSupported) {\r\n        let query;\r\n        execIndexedDBTransaction(function (storeObj) {\r\n            query = storeObj.get(1);\r\n        }, function () {\r\n            successCallback(query.result);\r\n        }, function (errorStr) {\r\n            errorCallback('execIndexedDBTransaction error, ' + errorStr);\r\n        });\r\n    } else {\r\n        successCallback(null);\r\n    }\r\n}\r\n\r\n/**\r\n * stores a klProjectObj into id = 1 in database:dbNameStr > storage: storageNameStr\r\n *\r\n * KlProjectObj {\r\n *     width: int,\r\n *     height: int,\r\n *     layers: {\r\n *        name: string,\r\n *        opacity: float (0 - 1),\r\n *        mixModeStr: string,\r\n *        blob: blob object                 <--------- blob!\r\n *     }[]\r\n * }\r\n *\r\n * @param storageProject IKlStorageProject - project to be stored\r\n * @param successCallback function() - on successful transaction\r\n * @param errorCallback function(errorStr) - on error\r\n */\r\nexport function storeKlProjectObj(storageProject: IKlStorageProject, successCallback, errorCallback) {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.put(storageProject);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (errorStr) {\r\n        errorCallback(errorStr);\r\n    });\r\n\r\n}\r\n\r\n/**\r\n * removes id = 1 from database:dbNameStr > storage: storageNameStr\r\n *\r\n * @param successCallback function() - on successful transaction\r\n * @param errorCallback function(error) - on error\r\n */\r\nexport function clear(successCallback, errorCallback) {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.delete(1);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (error) {\r\n        errorCallback(error);\r\n    });\r\n\r\n}\r\n","import {IFilter} from '../kl.types';\r\n// @ts-ignore\r\nimport glBrightnessContrastImg from 'url:~/src/app/img/ui/edit-brightness-contrast.svg';\r\n// @ts-ignore\r\nimport cropExtendImg from 'url:~/src/app/img/ui/edit-crop.svg';\r\n// @ts-ignore\r\nimport glCurvesImg from 'url:~/src/app/img/ui/edit-curves.svg';\r\n// @ts-ignore\r\nimport flipImg from 'url:~/src/app/img/ui/edit-flip.svg';\r\n// @ts-ignore\r\nimport glHueSaturationImg from 'url:~/src/app/img/ui/edit-hue-saturation.svg';\r\n// @ts-ignore\r\nimport invertImg from 'url:~/src/app/img/ui/edit-invert.png';\r\n// @ts-ignore\r\nimport glPerspectiveImg from 'url:~/src/app/img/ui/edit-perspective.svg';\r\n// @ts-ignore\r\nimport resizeImg from 'url:~/src/app/img/ui/edit-resize.svg';\r\n// @ts-ignore\r\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\r\n// @ts-ignore\r\nimport glTiltShiftImg from 'url:~/src/app/img/ui/edit-tilt-shift.png';\r\n// @ts-ignore\r\nimport toAlphaImg from 'url:~/src/app/img/ui/edit-to-alpha.svg';\r\n// @ts-ignore\r\nimport transformImg from 'url:~/src/app/img/ui/edit-transform.svg';\r\n// @ts-ignore\r\nimport glBlurImg from 'url:~/src/app/img/ui/edit-triangle-blur.png';\r\n// @ts-ignore\r\nimport glUnsharpMaskImg from 'url:~/src/app/img/ui/edit-unsharp-mask.png';\r\n// @ts-ignore\r\nimport aImg from 'url:~/src/app/img/ui/';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\n\r\nexport const filterLibStatus = {\r\n    isLoaded: false,\r\n};\r\nexport const filterLib: {\r\n    [key:string]: IFilter;\r\n} = {\r\n    glBrightnessContrast: {\r\n        lang: {name: 'filter-bright-contrast-title', button: 'filter-bright-contrast'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        webgl: true,\r\n        updateContext: true,\r\n        icon: glBrightnessContrastImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    cropExtend: {\r\n        lang: {name: 'filter-crop-title', button: 'filter-crop-extend'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: cropExtendImg,\r\n        webgl: false,\r\n        neededWithWebGL: true,\r\n        updateContext: true,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    glCurves: {\r\n        lang: {name: 'filter-curves-title', button: 'filter-curves'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: glCurvesImg,\r\n        webgl: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    flip: {\r\n        lang: {name: 'filter-flip-title', button: 'filter-flip'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: flipImg,\r\n        webgl: false,\r\n        neededWithWebGL: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    glHueSaturation: {\r\n        lang: {name: 'filter-hue-sat-title', button: 'filter-hue-sat'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: glHueSaturationImg,\r\n        webgl: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    invert: {\r\n        lang: {name: 'filter-invert', button: 'filter-invert'},\r\n        name: '',\r\n        icon: invertImg,\r\n        webgl: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        isInstant: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    glPerspective: {\r\n        lang: {name: 'filter-perspective-title', button: 'filter-perspective'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: glPerspectiveImg,\r\n        webgl: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    resize: {\r\n        lang: {name: 'filter-resize-title', button: 'filter-resize'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: resizeImg,\r\n        webgl: false,\r\n        neededWithWebGL: true,\r\n        updateContext: true,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    rotate: {\r\n        lang: {name: 'filter-rotate-title', button: 'filter-rotate'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: rotateImg,\r\n        webgl: false,\r\n        neededWithWebGL: true,\r\n        updateContext: true,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    glTiltShift: {\r\n        lang: {name: 'filter-tilt-shift-title', button: 'filter-tilt-shift'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: glTiltShiftImg,\r\n        webgl: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    toAlpha: {\r\n        lang: {name: 'filter-to-alpha-title', button: 'filter-to-alpha'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: toAlphaImg,\r\n        webgl: true,\r\n        updateContext: false,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    transform: {\r\n        lang: {name: 'filter-transform-title', button: 'filter-transform'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: transformImg,\r\n        webgl: false,\r\n        neededWithWebGL: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        ieFails: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    glBlur: {\r\n        lang: {name: 'filter-triangle-blur-title', button: 'filter-triangle-blur'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: glBlurImg,\r\n        webgl: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    glUnsharpMask: {\r\n        lang: {name: 'filter-unsharp-mask-title', button: 'filter-unsharp-mask'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: glUnsharpMaskImg,\r\n        webgl: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    }\r\n};\r\n\r\nfunction updateNames() {\r\n    const keys = Object.keys(filterLib);\r\n    keys.forEach(item => {\r\n        filterLib[item].name = LANG(filterLib[item].lang.name);\r\n        filterLib[item].buttonLabel = LANG(filterLib[item].lang.button);\r\n    });\r\n}\r\nupdateNames();\r\n\r\nlanguageStrings.subscribe(() => {\r\n    updateNames();\r\n});","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"5tPq3\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cazOx\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"245NA\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1hkCG\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"k2eFf\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"krKGd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ehfxY\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"beOjS\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"Gk9bV\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"csed7\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"equSE\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h1dN3\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"LfAXI\");","import {PenBrush} from './pen-brush';\r\nimport {BlendBrush} from './blend-brush';\r\nimport {SketchyBrush} from './sketchy-brush';\r\nimport {PixelBrush} from './pixel-brush';\r\nimport {EraserBrush} from './eraser-brush';\r\nimport {SmudgeBrush} from './smudge-brush';\r\nimport {ChemyBrush} from './chemy-brush';\r\n\r\nexport const brushes = {\r\n    PenBrush,\r\n    BlendBrush,\r\n    SketchyBrush,\r\n    PixelBrush,\r\n    ChemyBrush,\r\n    SmudgeBrush,\r\n    EraserBrush,\r\n}","import {BB} from '../../bb/bb';\r\nimport {alphaImArr} from './brushes-common';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\n\r\nexport function PenBrush() {\r\n\r\n    let context;\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n\r\n    let settingColor, settingSize = 2, settingSpacing = 0.8489, settingOpacity = 1;\r\n    let settingColorStr;\r\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\r\n    let settingLockLayerAlpha = false;\r\n    let ALPHA_CIRCLE = 0, ALPHA_CHALK = 1, ALPHA_CAL = 2, ALPHA_SQUARE = 3;\r\n    let settingAlphaId = ALPHA_CIRCLE;\r\n\r\n    let lineToolLastDot;\r\n    let lastInput = {x: 0, y: 0, pressure: 0};\r\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\r\n\r\n    let isDrawing = false;\r\n    let alphaOpacityArr = [1, 0.9, 1, 1];\r\n\r\n    //mipmapping\r\n    let alphaCanvas128 = BB.canvas(128, 128);\r\n    let alphaCanvas64 = BB.canvas(64, 64);\r\n    let alphaCanvas32 = BB.canvas(32, 32);\r\n\r\n    let bezierLine = null;\r\n\r\n    let twoPI = Math.PI * 2;\r\n    let hasDrawnDot = false; // current stroke has drawn at least one dot\r\n    let inputArr: {x: number, y: number, pressure: number}[];\r\n\r\n    // pressure: 0-1\r\n    function calcOpacity(pressure: number) {\r\n        return settingOpacity * (settingHasOpacityPressure ? pressure * pressure : 1);\r\n    }\r\n\r\n    function updateAlphaCanvas() {\r\n        if (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE) {\r\n            return;\r\n        }\r\n\r\n        let instructionArr = [\r\n            [alphaCanvas128, 128],\r\n            [alphaCanvas64, 64],\r\n            [alphaCanvas32, 32]\r\n        ];\r\n\r\n        let ctx;\r\n\r\n        for (let i = 0; i < instructionArr.length; i++) {\r\n            ctx = (instructionArr[i][0] as any).getContext(\"2d\");\r\n\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.fillStyle = \"rgba(\" + settingColor.r + \", \" + settingColor.g + \", \" + settingColor.b + \", \" + alphaOpacityArr[settingAlphaId] + \")\";\r\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.globalCompositeOperation = \"destination-in\";\r\n            ctx.imageSmoothingQuality = 'high';\r\n            ctx.drawImage(alphaImArr[settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.restore();\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     * @param angle\r\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\r\n     */\r\n    function drawDot(x, y, size, opacity, angle?, before?) {\r\n        if (size <= 0) {\r\n            return;\r\n        }\r\n\r\n        if (settingLockLayerAlpha) {\r\n            context.globalCompositeOperation = \"source-atop\";\r\n        }\r\n\r\n        if (!before || before[3] !== opacity) {\r\n            context.globalAlpha = opacity;\r\n        }\r\n\r\n        if (!before && (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE)) {\r\n            context.fillStyle = settingColorStr;\r\n        }\r\n\r\n        if (settingAlphaId === ALPHA_CIRCLE) {\r\n            context.beginPath();\r\n            context.arc(x, y, size, 0, twoPI);\r\n            context.closePath();\r\n            context.fill();\r\n            hasDrawnDot = true;\r\n\r\n        } else if (settingAlphaId === ALPHA_SQUARE) {\r\n            if (angle !== undefined) {\r\n                context.save();\r\n                context.translate(x, y);\r\n                context.rotate(angle / 180 * Math.PI);\r\n                context.fillRect(-size, -size, size * 2, size * 2);\r\n                context.restore();\r\n                hasDrawnDot = true;\r\n            }\r\n\r\n        } else { // other brush alphas\r\n            context.save();\r\n            context.translate(x, y);\r\n            let targetMipmap = alphaCanvas128;\r\n            if (size <= 32 && size > 16) {\r\n                targetMipmap = alphaCanvas64;\r\n            } else if (size <= 16) {\r\n                targetMipmap = alphaCanvas32;\r\n            }\r\n            context.scale(size, size);\r\n            if (settingAlphaId === ALPHA_CHALK) {\r\n                context.rotate(((x + y) * 53123) % twoPI); // without mod it sometimes looks different\r\n            }\r\n            context.drawImage(targetMipmap, -1, -1, 2, 2);\r\n\r\n            context.restore();\r\n            hasDrawnDot = true;\r\n        }\r\n    }\r\n\r\n    function continueLine(x, y, size, pressure) {\r\n        if (bezierLine === null) {\r\n            bezierLine = new BB.BezierLine();\r\n            bezierLine.add(lastInput.x, lastInput.y, 0, function(){});\r\n        }\r\n\r\n        let drawArr = []; //draw instructions. will be all drawn at once\r\n\r\n        function dotCallback(val) {\r\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\r\n            let localOpacity = calcOpacity(localPressure);\r\n            let localSize = Math.max(0.1, settingSize * (settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        }\r\n\r\n        let localSpacing = size * settingSpacing;\r\n        if (x === null) {\r\n            bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        context.save();\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            let item = drawArr[i];\r\n            drawDot(item[0], item[1], item[2], item[3], item[4], before);\r\n            before = item;\r\n        }\r\n        context.restore();\r\n    }\r\n\r\n    //------------------ interface ---------------------------------------------------\r\n\r\n\r\n    this.startLine = function (x, y, p) {\r\n        historyEntry = {\r\n            tool: [\"brush\", \"PenBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [settingHasOpacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setAlpha\",\r\n            params: [settingAlphaId]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        let localOpacity = calcOpacity(p);\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, p * settingSize) : Math.max(0.1, settingSize);\r\n\r\n        hasDrawnDot = false;\r\n\r\n        isDrawing = true;\r\n        context.save();\r\n        drawDot(x, y, localSize, localOpacity);\r\n        context.restore();\r\n\r\n        lineToolLastDot = localSize * settingSpacing;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n        lastInput2.pressure = p;\r\n\r\n        inputArr = [{\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        }];\r\n\r\n        historyEntry.actions.push({\r\n            action: \"startLine\",\r\n            params: [x, y, p]\r\n        });\r\n    };\r\n\r\n    this.goLine = function (x, y, p) {\r\n        if (!isDrawing) {\r\n            return;\r\n        }\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [x, y, p]\r\n        });\r\n\r\n        let pressure = BB.clamp(p, 0, 1);\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n\r\n        context.save();\r\n        continueLine(x, y, localSize, lastInput.pressure);\r\n\r\n        /*context.fillStyle = 'red';\r\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\r\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/\r\n\r\n        context.restore();\r\n\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput2.pressure = lastInput.pressure;\r\n        lastInput.pressure = pressure;\r\n\r\n        inputArr.push({\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        });\r\n    };\r\n\r\n    this.endLine = function (x, y) {\r\n\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n        context.save();\r\n        continueLine(null, null, localSize, lastInput.pressure);\r\n        context.restore();\r\n\r\n        isDrawing = false;\r\n\r\n        if (settingAlphaId === ALPHA_SQUARE && !hasDrawnDot) {\r\n            // find max pressure input, use that one\r\n            let maxInput = inputArr[0];\r\n            inputArr.forEach(item => {\r\n                if (item.pressure > maxInput.pressure) {\r\n                    maxInput = item;\r\n                }\r\n            })\r\n\r\n            context.save();\r\n            let p = BB.clamp(maxInput.pressure, 0, 1);\r\n            let localOpacity = calcOpacity(p);\r\n            drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\r\n            context.restore();\r\n        }\r\n\r\n        bezierLine = null;\r\n\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: [x, y]\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n\r\n        hasDrawnDot = false;\r\n        inputArr = [];\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = settingSize * settingSpacing;\r\n        lineToolLastDot = settingSize * settingSpacing;\r\n        context.save();\r\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\r\n        }\r\n        context.restore();\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"PenBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [settingHasOpacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setAlpha\",\r\n            params: [settingAlphaId]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    //IS\r\n    this.isDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n    //SET\r\n    this.setAlpha = function (a) {\r\n        if (settingAlphaId === a) {\r\n            return;\r\n        }\r\n        settingAlphaId = a;\r\n        updateAlphaCanvas();\r\n    };\r\n    this.setColor = function (c) {\r\n        if (settingColor === c) {\r\n            return;\r\n        }\r\n        settingColor = {r: c.r, g: c.g, b: c.b};\r\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\r\n        updateAlphaCanvas();\r\n    };\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSize = function (s) {\r\n        settingSize = s;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        settingOpacity = o;\r\n    };\r\n    this.setSpacing = function (s) {\r\n        settingSpacing = s;\r\n    };\r\n    this.sizePressure = function (b) {\r\n        settingHasSizePressure = b;\r\n    };\r\n    this.opacityPressure = function (b) {\r\n        settingHasOpacityPressure = b;\r\n    };\r\n    this.setLockAlpha = function (b) {\r\n        settingLockLayerAlpha = b;\r\n    };\r\n    //GET\r\n    this.getSpacing = function () {\r\n        return settingSpacing;\r\n    };\r\n    this.getSize = function () {\r\n        return settingSize;\r\n    };\r\n    this.getOpacity = function () {\r\n        return settingOpacity;\r\n    };\r\n    this.getLockAlpha = function (b) {\r\n        return settingLockLayerAlpha;\r\n    };\r\n}","import {genBrushAlpha01, genBrushAlpha02} from './alphas/brush-alphas';\r\n\r\nexport const alphaImArr = []; //used by default brush\r\nalphaImArr[1] = genBrushAlpha01(128);\r\nalphaImArr[2] = genBrushAlpha02(128);","import {BB} from '../../../bb/bb';\r\nimport {noise} from '../../../bb/math/perlin';\r\nimport {IVector2D} from '../../../bb/bb.types';\r\n\r\n// chalk\r\nexport function genBrushAlpha01(w: number): HTMLCanvasElement {\r\n\r\n    const scaleFac = w / 500;\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    const ctx = canvas.getContext('2d');\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            let i = (y * w + x) * 4;\r\n\r\n            // base noise\r\n            const sFac2 = scaleFac + noise.simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\r\n            let noisePattern = 100 + (noise.simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\r\n            noisePattern -= (noise.simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\r\n\r\n            // fade out in circular shape\r\n            const centerDist = BB.dist(w / 2, h / 2, x, y);\r\n            let falloff = BB.clamp(\r\n                1 - ((centerDist - (w / 2.5)) / (w / 14) + noise.simplex2(x / 22 / sFac2, y / 22 / sFac2)),\r\n                0,\r\n                1);\r\n            noisePattern = noisePattern * falloff;\r\n\r\n            // make the middle darker\r\n            const falloff2 = BB.clamp(1 - centerDist / w, 0, 1) * 2;\r\n            noisePattern = noisePattern * falloff2;\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = BB.clamp(noisePattern, 0, 255);\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}\r\n\r\n// https://www.shadertoy.com/view/3tdSDj\r\nfunction udSegment( p: IVector2D, a: IVector2D, b: IVector2D ) {\r\n    let ba = BB.Vec2.sub(b, a);\r\n    let pa = BB.Vec2.sub(p, a);\r\n    let h = BB.clamp( BB.Vec2.dot(pa,ba) / BB.Vec2.dot(ba,ba), 0.0, 1.0 );\r\n    return BB.Vec2.len(BB.Vec2.sub(pa, BB.Vec2.mul(ba, h)));\r\n}\r\n\r\n// calligraphy\r\nexport function genBrushAlpha02(w: number): HTMLCanvasElement {\r\n\r\n    const pDist = 1 / 4;\r\n    let centerSize = 2 / 3;\r\n    let transitionSize = 1 / 3;\r\n    centerSize *= pDist;\r\n    transitionSize *= pDist;\r\n    const p1 = {x: pDist * w, y: w - (w * pDist)};\r\n    const p2 = {x: w - (w * pDist), y: pDist * w};\r\n\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    let ctx = canvas.getContext('2d');\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            const i = (y * w + x) * 4;\r\n\r\n            let col = udSegment({x: x, y: y}, p1, p2);\r\n\r\n            col = BB.clamp(\r\n                255 - ((col - (w * centerSize)) / (w * transitionSize) * 255),\r\n                0,\r\n                255\r\n            );\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = col;\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}","/*\r\n * A speed-improved perlin and simplex noise algorithms for 2D.\r\n *\r\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\n * Better rank ordering method by Stefan Gustavson in 2012.\r\n * Converted to Javascript by Joseph Gentle.\r\n *\r\n * Version 2012-03-09\r\n *\r\n * This code was placed in the public domain by its original author,\r\n * Stefan Gustavson. You may use it as you see fit, but\r\n * attribution is appreciated.\r\n *\r\n */\r\n\r\nconst myModule = {} as any;\r\n\r\n\r\nfunction Grad(x, y, z) {\r\n    this.x = x; this.y = y; this.z = z;\r\n}\r\n\r\nGrad.prototype.dot2 = function(x, y) {\r\n    return this.x*x + this.y*y;\r\n};\r\n/*\r\nGrad.prototype.dot3 = function(x, y, z) {\r\n    return this.x*x + this.y*y + this.z*z;\r\n};*/\r\n\r\nlet grad3 = [new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),\r\n    new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),\r\n    new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];\r\n\r\nlet p = [151,160,137,91,90,15,\r\n    131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,\r\n    190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,\r\n    88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,\r\n    77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,\r\n    102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,\r\n    135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,\r\n    5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,\r\n    223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,\r\n    129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,\r\n    251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,\r\n    49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,\r\n    138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\r\n// To remove the need for index wrapping, double the permutation table length\r\nlet perm = new Array(512);\r\nlet gradP = new Array(512);\r\n\r\n// This isn't a very good seeding function, but it works ok. It supports 2^16\r\n// different seed values. Write something better if you need more seeds.\r\nmyModule.seed = function(seed) {\r\n    if (seed > 0 && seed < 1) {\r\n        // Scale the seed out\r\n        seed *= 65536;\r\n    }\r\n\r\n    seed = Math.floor(seed);\r\n    if (seed < 256) {\r\n        seed |= seed << 8;\r\n    }\r\n\r\n    for (let i = 0; i < 256; i++) {\r\n        let v;\r\n        if (i & 1) {\r\n            v = p[i] ^ (seed & 255);\r\n        } else {\r\n            v = p[i] ^ ((seed>>8) & 255);\r\n        }\r\n\r\n        perm[i] = perm[i + 256] = v;\r\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\r\n    }\r\n};\r\n\r\nmyModule.seed(0);\r\n\r\n/*\r\nfor (let i=0; i<256; i++) {\r\n  perm[i] = perm[i + 256] = p[i];\r\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\r\n}*/\r\n\r\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\r\nlet F2 = 0.5*(Math.sqrt(3)-1);\r\nlet G2 = (3-Math.sqrt(3))/6;\r\n\r\n/*let F3 = 1/3;\r\nlet G3 = 1/6;*/\r\n\r\n// 2D simplex noise\r\nmyModule.simplex2 = function(xin, yin) {\r\n    let n0, n1, n2; // Noise contributions from the three corners\r\n    // Skew the input space to determine which simplex cell we're in\r\n    let s = (xin+yin)*F2; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    let t = (i+j)*G2;\r\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin-j+t;\r\n    // For the 2D case, the simplex shape is an equilateral triangle.\r\n    // Determine which simplex we are in.\r\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n    if (x0>y0) { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n        i1=1; j1=0;\r\n    } else {    // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n        i1=0; j1=1;\r\n    }\r\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n    // c = (3-sqrt(3))/6\r\n    let x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n    let y1 = y0 - j1 + G2;\r\n    let x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n    let y2 = y0 - 1 + 2 * G2;\r\n    // Work out the hashed gradient indices of the three simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    let gi0 = gradP[i+perm[j]];\r\n    let gi1 = gradP[i+i1+perm[j+j1]];\r\n    let gi2 = gradP[i+1+perm[j+1]];\r\n    // Calculate the contribution from the three corners\r\n    let t0 = 0.5 - x0*x0-y0*y0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot2(x0, y0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.5 - x1*x1-y1*y1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\r\n    }\r\n    let t2 = 0.5 - x2*x2-y2*y2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 70 * (n0 + n1 + n2);\r\n};\r\n/*\r\n// 3D simplex noise\r\nmyModule.simplex3 = function(xin, yin, zin) {\r\n    let n0, n1, n2, n3; // Noise contributions from the four corners\r\n\r\n    // Skew the input space to determine which simplex cell we're in\r\n    let s = (xin+yin+zin)*F3; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    let k = Math.floor(zin+s);\r\n\r\n    let t = (i+j+k)*G3;\r\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin-j+t;\r\n    let z0 = zin-k+t;\r\n\r\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n    // Determine which simplex we are in.\r\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n    if (x0 >= y0) {\r\n        if (y0 >= z0)      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; }\r\n        else if (x0 >= z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; }\r\n        else              { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; }\r\n    } else {\r\n        if (y0 < z0)      { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; }\r\n        else if (x0 < z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; }\r\n        else             { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; }\r\n    }\r\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n    // c = 1/6.\r\n    let x1 = x0 - i1 + G3; // Offsets for second corner\r\n    let y1 = y0 - j1 + G3;\r\n    let z1 = z0 - k1 + G3;\r\n\r\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\r\n    let y2 = y0 - j2 + 2 * G3;\r\n    let z2 = z0 - k2 + 2 * G3;\r\n\r\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\r\n    let y3 = y0 - 1 + 3 * G3;\r\n    let z3 = z0 - 1 + 3 * G3;\r\n\r\n    // Work out the hashed gradient indices of the four simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    k &= 255;\r\n    let gi0 = gradP[i+   perm[j+   perm[k   ]]];\r\n    let gi1 = gradP[i+i1+perm[j+j1+perm[k+k1]]];\r\n    let gi2 = gradP[i+i2+perm[j+j2+perm[k+k2]]];\r\n    let gi3 = gradP[i+ 1+perm[j+ 1+perm[k+ 1]]];\r\n\r\n    // Calculate the contribution from the four corners\r\n    let t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\r\n    }\r\n    let t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\r\n    }\r\n    let t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\r\n    if (t3<0) {\r\n        n3 = 0;\r\n    } else {\r\n        t3 *= t3;\r\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 32 * (n0 + n1 + n2 + n3);\r\n\r\n};\r\n*/\r\n// ##### Perlin noise stuff\r\n/*\r\nfunction fade(t) {\r\n    return t*t*t*(t*(t*6-15)+10);\r\n}\r\n\r\nfunction lerp(a, b, t) {\r\n    return (1-t)*a + t*b;\r\n}\r\n\r\n// 2D Perlin Noise\r\nmyModule.perlin2 = function(x, y) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y);\r\n    // Get relative xy coordinates of point within that cell\r\n    x = x - X; y = y - Y;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255;\r\n\r\n    // Calculate noise contributions from each of the four corners\r\n    let n00 = gradP[X+perm[Y]].dot2(x, y);\r\n    let n01 = gradP[X+perm[Y+1]].dot2(x, y-1);\r\n    let n10 = gradP[X+1+perm[Y]].dot2(x-1, y);\r\n    let n11 = gradP[X+1+perm[Y+1]].dot2(x-1, y-1);\r\n\r\n    // Compute the fade curve value for x\r\n    let u = fade(x);\r\n\r\n    // Interpolate the four results\r\n    return lerp(\r\n        lerp(n00, n10, u),\r\n        lerp(n01, n11, u),\r\n        fade(y));\r\n};*/\r\n/*\r\n// 3D Perlin Noise\r\nmyModule.perlin3 = function(x, y, z) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y), Z = Math.floor(z);\r\n    // Get relative xyz coordinates of point within that cell\r\n    x = x - X; y = y - Y; z = z - Z;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255; Z = Z & 255;\r\n\r\n    // Calculate noise contributions from each of the eight corners\r\n    let n000 = gradP[X+  perm[Y+  perm[Z  ]]].dot3(x,   y,     z);\r\n    let n001 = gradP[X+  perm[Y+  perm[Z+1]]].dot3(x,   y,   z-1);\r\n    let n010 = gradP[X+  perm[Y+1+perm[Z  ]]].dot3(x,   y-1,   z);\r\n    let n011 = gradP[X+  perm[Y+1+perm[Z+1]]].dot3(x,   y-1, z-1);\r\n    let n100 = gradP[X+1+perm[Y+  perm[Z  ]]].dot3(x-1,   y,   z);\r\n    let n101 = gradP[X+1+perm[Y+  perm[Z+1]]].dot3(x-1,   y, z-1);\r\n    let n110 = gradP[X+1+perm[Y+1+perm[Z  ]]].dot3(x-1, y-1,   z);\r\n    let n111 = gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1, y-1, z-1);\r\n\r\n    // Compute the fade curve value for x, y, z\r\n    let u = fade(x);\r\n    let v = fade(y);\r\n    let w = fade(z);\r\n\r\n    // Interpolate\r\n    return lerp(\r\n        lerp(\r\n            lerp(n000, n100, u),\r\n            lerp(n001, n101, u), w),\r\n        lerp(\r\n            lerp(n010, n110, u),\r\n            lerp(n011, n111, u), w),\r\n        v);\r\n};*/\r\n\r\nexport const noise = myModule;","import {BB} from '../../bb/bb';\r\nimport {IRGB, IRGBA} from '../kl.types';\r\nimport {IBounds, IPressureInput} from '../../bb/bb.types';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\n\r\nconst cellSize = 256;\r\n\r\ninterface IDrawBufferItem {\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    opacity: number;\r\n    x1: number;\r\n    y1: number;\r\n    x2: number;\r\n    y2: number;\r\n    r: number;\r\n    g: number;\r\n    b: number;\r\n}\r\n\r\n// faster than using BB.clamp somehow (in chrome)\r\nfunction clamp(num, min, max) {\r\n    return num <= min\r\n        ? min\r\n        : num >= max\r\n            ? max\r\n            : num\r\n}\r\n\r\nexport class BlendBrush {\r\n\r\n    private isTesting: boolean = false; // testing mode - context only gets updated when line is finished\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private color: IRGB;\r\n    private size: number = 29; // radius - 0.5 - 99999\r\n    private opacity: number = 0.6; // 0-1\r\n    private blending: number = 0.65; // 0-1\r\n\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingSizePressure: boolean = true;\r\n    private settingOpacityPressure: boolean = false;\r\n\r\n    private blendCol: IRGBA = {r: 0, g: 0, b: 0, a: 1}; // todo docs\r\n    private blendMix: number = 0.45; // todo docs\r\n    private mixr: number; // todo docs\r\n    private mixg: number; // todo docs\r\n    private mixb: number; // todo docs\r\n    private localColOld: IRGBA; // todo docs\r\n\r\n    private isDrawing: boolean = false;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private bezierLine: any; // todo type\r\n\r\n    private history: KlHistoryInterface | null;\r\n    private historyEntry: IHistoryEntry;\r\n    private redrawBounds: IBounds;\r\n    private cells: (ImageData | null)[];\r\n    private drawBuffer: IDrawBufferItem[];\r\n\r\n    private updateRedrawBounds (bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    private getCellsWidth(): number {\r\n        return Math.ceil(this.context.canvas.width / cellSize);\r\n    }\r\n\r\n    /**\r\n     * draw changed cells (changed by brushstroke) onto context\r\n     * @private\r\n     */\r\n    private drawChangedCells(): void {\r\n        const cells = this.cells.map(item => null);\r\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\r\n        touchedCells.forEach((isTouched, index) => {\r\n            if (isTouched) {\r\n                cells[index] = this.cells[index];\r\n            }\r\n        });\r\n        this.drawCells(cells);\r\n        this.redrawBounds = null;\r\n    }\r\n\r\n    private getTouchedCells(bounds: IBounds): boolean[] {\r\n        const touchedCells = this.cells.map(item => false);\r\n        const cellsW = this.getCellsWidth();\r\n        bounds = {\r\n            x1: Math.floor(bounds.x1 / cellSize),\r\n            y1: Math.floor(bounds.y1 / cellSize),\r\n            x2: Math.floor(bounds.x2 / cellSize),\r\n            y2: Math.floor(bounds.y2 / cellSize),\r\n        };\r\n        for (let i = bounds.x1; i <= bounds.x2; i++) {\r\n            for (let e = bounds.y1; e <= bounds.y2; e++) {\r\n                touchedCells[e * cellsW + i] = true;\r\n            }\r\n        }\r\n        return touchedCells;\r\n    }\r\n\r\n    /**\r\n     * Slice up bounds accordings to cells\r\n     * @param bounds\r\n     * @private\r\n     */\r\n    private sliceBounds(bounds: IBounds): {index: number; bounds: IBounds}[] {\r\n        const cellsW = this.getCellsWidth();\r\n        const result: {index: number; bounds: IBounds}[] = [];\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n\r\n        touchedCells.forEach((cell, i) => {\r\n            if (!cell) {\r\n                return;\r\n            }\r\n\r\n            const cellOffsetX = (i % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(i / cellsW) * cellSize;\r\n            const cellWidth = this.cells[i].width;\r\n            const cellHeight = this.cells[i].height;\r\n\r\n            const inCellBounds = {\r\n                x1: Math.max(0, bounds.x1 - cellOffsetX),\r\n                y1: Math.max(0, bounds.y1 - cellOffsetY),\r\n                x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\r\n                y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY),\r\n            }\r\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) {\r\n                return;\r\n            }\r\n            result.push({\r\n                index: i,\r\n                bounds: inCellBounds,\r\n            });\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    private copyFromCanvas(bounds: IBounds) {\r\n        if (!bounds) {\r\n            return;\r\n        }\r\n\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n        const cellsW = this.getCellsWidth();\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.cells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * cellSize + cellSize, this.context.canvas.width) - 1) % cellSize + 1;\r\n            const h = (Math.min(y * cellSize + cellSize, this.context.canvas.height) - 1) % cellSize + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = tmpCanvas.getContext('2d');\r\n            tmpCtx.drawImage(this.context.canvas, -x * cellSize, -y * cellSize);\r\n\r\n            this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\r\n        });\r\n    }\r\n\r\n    private getAverage (x, y, size): IRGBA {\r\n\r\n        size = Math.max(0.5, size * 0.75);\r\n        const x1 = Math.max(0, Math.floor(x - size));\r\n        const y1 = Math.max(0, Math.floor(y - size));\r\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return {\r\n                r: 0,\r\n                g: 0,\r\n                b: 0,\r\n                a: 0,\r\n            };\r\n        }\r\n\r\n        let ar = 0, ag = 0, ab = 0, aa = 0, alpha;\r\n\r\n        const slicedBounds = this.sliceBounds({ x1, y1, x2, y2 });\r\n        slicedBounds.forEach(slice => {\r\n            const width = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n            const bounds = slice.bounds;\r\n\r\n            for (let i = bounds.y1; i <= bounds.y2; i += 4) {\r\n                for (let e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 4 * 4) {\r\n                    alpha = data[e2 + 3];\r\n                    ar += data[e2] * alpha;\r\n                    ag += data[e2 + 1] * alpha;\r\n                    ab += data[e2 + 2] * alpha;\r\n                    aa += alpha;\r\n                }\r\n            }\r\n        });\r\n\r\n        if (aa !== 0) {\r\n            ar /= aa;\r\n            ag /= aa;\r\n            ab /= aa;\r\n            aa = Math.min(1, aa);\r\n        }\r\n        return {\r\n            r: ar,\r\n            g: ag,\r\n            b: ab,\r\n            a: aa\r\n        };\r\n    }\r\n\r\n    private prepDot (x: number, y: number, size: number): IBounds {\r\n        size = Math.max(0.5, size);\r\n        let x1 = Math.max(0, Math.floor(x - size));\r\n        let y1 = Math.max(0, Math.floor(y - size));\r\n        let x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        let y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return null;\r\n        }\r\n        return { x1, y1, x2, y2 };\r\n    }\r\n\r\n    private drawDot (params: IDrawBufferItem): void {\r\n        // array with random numbers. faster than Math.random()\r\n        let randI = 0;\r\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n        const randArr = [];\r\n        for (let i = 0; i < randLen; i++) {\r\n            randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n        }\r\n\r\n        // thin lines take more than just 1 sample\r\n        const sampleArr = [8,4,4,4,2,2,2,2,2,2]; // <0.5, 0.5, 1, 1.5, etc.\r\n        const samples = sampleArr[Math.floor(params.size * 2)];\r\n        const samplesSquared: number = samples ? samples * samples : 0;\r\n        const sampleOffsets = [];\r\n        if (samples) {\r\n            let i = 0;\r\n            for (let n = 0; n < samples; n++) {\r\n                for (let m = 0; m < samples; m++, i += 2) {\r\n                    sampleOffsets[i] = (n + 1) / samples; // x offset\r\n                    sampleOffsets[i + 1] = (m + 1) / samples; // y offset\r\n                }\r\n            }\r\n        }\r\n\r\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\r\n        // to optimize calculations\r\n        const invSharpness = 1 - sharpness;\r\n        const sharpnessSubtrahend = sharpness / invSharpness;\r\n        const sizeSquared = params.size * params.size;\r\n        const distDivisor = sizeSquared * invSharpness / params.opacity;\r\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\r\n\r\n\r\n        const slicedBounds = this.sliceBounds({\r\n            x1: params.x1,\r\n            y1: params.y1,\r\n            x2: params.x2,\r\n            y2: params.y2,\r\n        });\r\n\r\n        const cellsW = this.getCellsWidth();\r\n        slicedBounds.forEach(slice => {\r\n            const cellOffsetX = (slice.index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(slice.index / cellsW) * cellSize;\r\n            const cellWidth = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n\r\n            // i - y index within cell\r\n            // e - x index within cell\r\n\r\n            // e2 - index in image data\r\n\r\n            // ri - y index within image relative to dot-center\r\n            // re - x index within image relative to dot-center\r\n\r\n            for (let i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++) {\r\n                for (\r\n                    let e = slice.bounds.x1,\r\n                        e2 = i * cellWidth * 4 + slice.bounds.x1 * 4,\r\n                        re = e + cellOffsetX - params.x;\r\n                    e <= slice.bounds.x2;\r\n                    e++,\r\n                        e2 += 4,\r\n                        re++\r\n                ) {\r\n                    // O = over -> brush-dot\r\n                    // U = under -> image\r\n\r\n                    let alphaO = 0;\r\n                    if (samplesSquared) {\r\n                        for (let f = 0; f < sampleOffsets.length; f += 2) {\r\n                            const dist = BB.lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\r\n                            if (dist >= sizeSquared) {\r\n                                continue;\r\n                            }\r\n                            alphaO += clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                        }\r\n                        if (!alphaO) {\r\n                            continue;\r\n                        }\r\n                        alphaO /= samplesSquared;\r\n                    } else {\r\n                        // technically needs + 0.5 offset, but not noticeable with large brush\r\n                        const dist = Math.pow(re, 2) + Math.pow(ri, 2);\r\n                        if (dist >= sizeSquared) {\r\n                            continue;\r\n                        }\r\n                        alphaO = clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                    }\r\n\r\n                    const invAlphaO = 1 - alphaO;\r\n                    const alphaU =data[e2 + 3] / 255;\r\n\r\n                    if (this.settingLockLayerAlpha) {\r\n                        const underR = (params.r * alphaO) + ((data[e2]) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1]) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2]) * invAlphaO);\r\n                        if (alphaU) {\r\n                            data[e2] = Math.floor(underR + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB + randArr[randI]);\r\n                        }\r\n                    } else {\r\n                        const underR = (params.r * alphaO) + ((data[e2] * alphaU) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1] * alphaU) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2] * alphaU) * invAlphaO);\r\n\r\n                        let newAlpha = 1 - invAlphaO * (1 - alphaU);\r\n                        data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\r\n                        if (newAlpha) {\r\n                            data[e2] = Math.floor(underR / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB / (newAlpha) + randArr[randI]);\r\n                        }\r\n                    }\r\n                    randI = (randI + 1) % randLen;\r\n\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    private calcSpacing (size: number): number {\r\n        return BB.mix(\r\n            (size * 2) / 2, // until size 5.3\r\n            (size * 2) / 9, // at size 24\r\n            BB.clamp((size - 2.7) / (12 - 2.7), 0, 1)\r\n        );\r\n    }\r\n\r\n    private continueLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n\r\n        this.drawBuffer = [];\r\n\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (this.settingSizePressure) ? Math.max(1, p * this.size) : Math.max(1, this.size);\r\n\r\n        let bdist = this.calcSpacing(localSize);\r\n\r\n        let avgX = x;\r\n        let avgY = y;\r\n        if (x === null) {\r\n            avgX = this.lastInput.x;\r\n            avgY = this.lastInput.y;\r\n        }\r\n\r\n        let localColNew;\r\n\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            let average;\r\n            if (isCoalesced) {\r\n                average = {r: this.localColOld.r, g: this.localColOld.g, b: this.localColOld.b, a: 0};\r\n            } else {\r\n                const avgParams = [avgX, avgY, ((this.settingSizePressure) ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size))];\r\n                const bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\r\n                this.copyFromCanvas(bounds);\r\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\r\n            }\r\n            localColNew = {r: 0, g: 0, b: 0, a: 0};\r\n\r\n            if (average.a > 0 && this.blendCol.a === 0) {\r\n                this.blendCol.r = average.r;\r\n                this.blendCol.g = average.g;\r\n                this.blendCol.b = average.b;\r\n                this.blendCol.a = average.a;\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n\r\n            } else {\r\n                if (average.a === 0) {\r\n                    average.r = this.color.r;\r\n                    average.g = this.color.g;\r\n                    average.b = this.color.b;\r\n                    average.a = 1 - this.blending;\r\n                }\r\n\r\n                this.blendCol.r = BB.mix(this.blendCol.r, BB.mix(this.blendCol.r, average.r, this.blendMix), average.a);\r\n                this.blendCol.g = BB.mix(this.blendCol.g, BB.mix(this.blendCol.g, average.g, this.blendMix), average.a);\r\n                this.blendCol.b = BB.mix(this.blendCol.b, BB.mix(this.blendCol.b, average.b, this.blendMix), average.a);\r\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n            }\r\n\r\n        }\r\n\r\n\r\n        const bezierCallback = (val) => {\r\n            if (this.blending >= 1 && this.blendCol.a <= 0) {\r\n                return;\r\n            }\r\n            let factor = val.t;\r\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (this.settingOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\r\n            localSize = (this.settingSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\r\n            if (this.blending != 0) {\r\n                this.mixr = BB.mix(this.localColOld.r, localColNew.r, factor);\r\n                this.mixg = BB.mix(this.localColOld.g, localColNew.g, factor);\r\n                this.mixb = BB.mix(this.localColOld.b, localColNew.b, factor);\r\n            }\r\n            if (this.blending === 1 && this.localColOld.a === 0) {\r\n                this.mixr = localColNew.r;\r\n                this.mixg = localColNew.g;\r\n                this.mixb = localColNew.b;\r\n            }\r\n            const bounds = this.prepDot(val.x, val.y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: val.x,\r\n                    y: val.y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                })\r\n            }\r\n        };\r\n\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.localColOld = localColNew;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.size;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.size = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.opacity = o;\r\n    }\r\n\r\n    getBlending (): number {\r\n        return this.blending;\r\n    }\r\n\r\n    setBlending (b: number) {\r\n        this.blending = b;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.color = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setSizePressure (b: boolean): void {\r\n        this.settingSizePressure = !!b;\r\n    }\r\n\r\n    setOpacityPressure (b: boolean): void {\r\n        this.settingOpacityPressure = !!b;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setIsTesting (b: boolean): void {\r\n        this.isTesting = !!b;\r\n    }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: [\"brush\", \"BlendBrush\"],\r\n            actions: []\r\n        };\r\n\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n\r\n        this.isDrawing = true;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        let localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            this.copyFromCanvas(this.prepDot(x, y, localSize));\r\n\r\n            let average = this.getAverage(\r\n                x,\r\n                y,\r\n                ((this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size))\r\n            );\r\n            if (average.a === 0) {\r\n                this.blendCol = {\r\n                    r: this.color.r,\r\n                    g: this.color.g,\r\n                    b: this.color.b,\r\n                    a: 1 - this.blending,\r\n                };\r\n            } else {\r\n                this.blendCol = {\r\n                    r: average.r,\r\n                    g: average.g,\r\n                    b: average.b,\r\n                    a: average.a,\r\n                };\r\n            }\r\n\r\n            this.mixr = this.blendCol.r;\r\n            this.mixg = this.blendCol.g;\r\n            this.mixb = this.blendCol.b;\r\n        }\r\n\r\n        this.localColOld = {r: this.mixr, g: this.mixg, b: this.mixb, a: this.blendCol.a};\r\n\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        if (this.blending < 1 || this.blendCol.a > 0) {\r\n            const bounds = this.prepDot(x, y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x,\r\n                    y: y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                })\r\n            }\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.bezierLine = new BB.BezierLine();\r\n        this.bezierLine.add(x, y, 0, function () {\r\n        });\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    endLine (): void {\r\n        if (this.bezierLine) {\r\n            this.continueLine(null, null, this.lastInput.pressure, false);\r\n        }\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.drawChangedCells();\r\n        }\r\n\r\n        if (this.historyEntry && this.history && this.cells.find(item => !!item)) {\r\n            this.historyEntry.actions.push({\r\n                action: \"drawCells\",\r\n                params: [this.cells],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n\r\n    /**\r\n     * draw cells onto context\r\n     * @param cells\r\n     */\r\n    drawCells (cells: (ImageData | null)[]): void {\r\n        const cellsW = this.getCellsWidth();\r\n        cells.forEach((imageData, index) => {\r\n            if (!imageData) {\r\n                return;\r\n            }\r\n            const cellOffsetX = (index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(index / cellsW) * cellSize;\r\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\r\n        });\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\r\n        let average = this.getAverage(x1, y1, Math.max(0.1, this.size));\r\n\r\n        if (average.a === 0) {\r\n            this.blendCol = {\r\n                r: this.color.r,\r\n                g: this.color.g,\r\n                b: this.color.b,\r\n                a: 1 - this.blending,\r\n            };\r\n        } else {\r\n            this.blendCol = {\r\n                r: average.r,\r\n                g: average.g,\r\n                b: average.b,\r\n                a: average.a,\r\n            };\r\n        }\r\n\r\n        this.mixr = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixg = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixb = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\r\n\r\n\r\n        const p = 1;\r\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        const bdist = this.calcSpacing(localSize);\r\n        for (let loopDist = 0; loopDist <= mouseDist; loopDist += bdist) {\r\n            const bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\r\n            if (bounds) {\r\n                this.copyFromCanvas(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x1 + eX * loopDist,\r\n                    y: y1 + eY * loopDist,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                })\r\n            }\r\n        }\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        if (this.history && this.cells.find(item => !!item)) {\r\n            this.drawCells(this.cells);\r\n            this.historyEntry = {\r\n                tool: [\"brush\", \"BlendBrush\"],\r\n                actions: [{\r\n                    action: \"drawCells\",\r\n                    params: [this.cells],\r\n                }],\r\n            };\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\nconst sampleCanvas = BB.canvas(32, 32);\r\nconst sampleCtx = sampleCanvas.getContext('2d');\r\n\r\nexport function SketchyBrush() {\r\n    let context;\r\n    let settingColor;\r\n\r\n    let settingSize = 1, settingOpacity = 0.2;\r\n    let settingBlending = 0.5;\r\n    let settingScale = 1;\r\n\r\n    let lastX, lastY;\r\n    let isDrawing = false;\r\n    let lastInput = {x: 0, y: 0, pressure: 0};\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n    let sketchySeed = 0;\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSeed = function (s) {\r\n        sketchySeed = parseInt(s);\r\n    };\r\n    this.getSeed = function () {\r\n        return parseInt('' + sketchySeed);\r\n    };\r\n\r\n    function rand() {\r\n        sketchySeed++;\r\n        return Math.sin(6324634.2345 * Math.cos(sketchySeed * 5342.3423)) * 0.5 + 0.5;\r\n    }\r\n\r\n    let points = [];\r\n    let count = 0;\r\n    let mixmode = [\r\n        function (c1, c2) {\r\n            return c1;\r\n        },\r\n        function (c1, c2) {\r\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\r\n            result.r *= c2.r / 255;\r\n            result.g *= c2.g / 255;\r\n            result.b *= c2.b / 255;\r\n            return result;\r\n        },\r\n        function (c1, c2) {\r\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\r\n            result.r *= c2.r / 255;\r\n            result.g *= c2.g / 255;\r\n            result.b *= c2.b / 255;\r\n            return result;\r\n        }\r\n    ];\r\n\r\n    this.getSize = function () {\r\n        return settingSize / 2;\r\n    };\r\n    this.setColor = function (c) {\r\n        settingColor = c;\r\n    };\r\n    this.getOpacity = function () {\r\n        return settingOpacity;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        settingOpacity = o;\r\n    };\r\n    this.getBlending = function () {\r\n        return settingBlending;\r\n    };\r\n    this.setBlending = function (b) {\r\n        settingBlending = b;\r\n    };\r\n    this.setSize = function (s) {\r\n        settingSize = s * 2;\r\n    };\r\n    this.getScale = function () {\r\n        return settingScale;\r\n    };\r\n    this.setScale = function (s) {\r\n        settingScale = s;\r\n    };\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.startLine = function (x, y, pressure, shift) {\r\n        if (shift && lastInput.x) {\r\n            let lx = lastInput.x, ly = lastInput.y;\r\n            isDrawing = true;\r\n            //this.goLine(x,y,pressure);\r\n            this.endLine();\r\n        } else {\r\n            isDrawing = true;\r\n            lastX = x;\r\n            lastY = y;\r\n            lastInput.x = x;\r\n            lastInput.y = y;\r\n            historyEntry = {\r\n                tool: [\"brush\", \"SketchyBrush\"],\r\n                actions: []\r\n            };\r\n            historyEntry.actions.push({\r\n                action: \"setScale\",\r\n                params: [settingScale]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setSize\",\r\n                params: [settingSize / 2]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setOpacity\",\r\n                params: [settingOpacity]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setColor\",\r\n                params: [settingColor]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setBlending\",\r\n                params: [settingBlending]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"startLine\",\r\n                params: [x, y, pressure]\r\n            });\r\n        }\r\n\r\n    };\r\n    this.goLine = function (p_x, p_y, pressure, preMixedColor) {\r\n        if (!isDrawing || (p_x === lastInput.x && p_y === lastInput.y)) {\r\n            return;\r\n        }\r\n\r\n        let e, b, a, g;\r\n        let x = parseInt(p_x);\r\n        let y = parseInt(p_y);\r\n        points.push([x, y]);\r\n\r\n        let mixr = settingColor.r;\r\n        let mixg = settingColor.g;\r\n        let mixb = settingColor.b;\r\n\r\n        if (preMixedColor !== null) {\r\n            mixr = preMixedColor.r;\r\n            mixg = preMixedColor.g;\r\n            mixb = preMixedColor.b;\r\n        } else {\r\n            if (settingBlending !== 0) {\r\n                if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < context.canvas.width - 1 && y - 5 < context.canvas.height - 1) {\r\n                    mixr = 0;\r\n                    mixg = 0;\r\n                    mixb = 0;\r\n                    let mixx = Math.min(context.canvas.width - 1, Math.max(0, x - 5));\r\n                    let mixy = Math.min(context.canvas.height - 1, Math.max(0, y - 5));\r\n                    let mixw = Math.min(context.canvas.width - 1, Math.max(0, x + 5));\r\n                    let mixh = Math.min(context.canvas.height - 1, Math.max(0, y + 5));\r\n                    mixw -= mixx;\r\n                    mixh -= mixy;\r\n\r\n                    if (mixw > 0 && mixh > 0) {\r\n                        let imdat = context.getImageData(mixx, mixy, mixw, mixh);\r\n                        let countmix = 0;\r\n                        for (let i = 0; i < imdat.data.length; i += 4) {\r\n                            mixr += imdat.data[i + 0];\r\n                            mixg += imdat.data[i + 1];\r\n                            mixb += imdat.data[i + 2];\r\n                            countmix++;\r\n                        }\r\n                        mixr /= countmix;\r\n                        mixg /= countmix;\r\n                        mixb /= countmix;\r\n                    }\r\n\r\n                    let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\r\n                    mixr = parseInt('' + BB.mix(settingColor.r, mixed.r, settingBlending));\r\n                    mixg = parseInt('' + BB.mix(settingColor.g, mixed.g, settingBlending));\r\n                    mixb = parseInt('' + BB.mix(settingColor.b, mixed.b, settingBlending));\r\n                }\r\n            }\r\n        }\r\n\r\n        context.save();\r\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\r\n        context.lineWidth = settingSize;\r\n\r\n        context.beginPath();\r\n        context.moveTo(lastX, lastY);\r\n        context.lineTo(x, y);\r\n\r\n        for (e = 0; e < points.length; e++) {\r\n            b = points[e][0] - points[count][0];\r\n            a = points[e][1] - points[count][1];\r\n            g = b * b + a * a;\r\n            if (g < 4000 * settingScale * settingScale && rand() > g / 2000 / settingScale / settingScale) {\r\n                context.moveTo(points[count][0] + (b * 0.3), points[count][1] + (a * 0.3));\r\n                context.lineTo(points[e][0] - (b * 0.3), points[e][1] - (a * 0.3));\r\n            }\r\n        }\r\n\r\n        context.stroke();\r\n        context.restore();\r\n\r\n\r\n        count++;\r\n        lastX = x;\r\n        lastY = y;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [p_x, p_y, pressure, {r: mixr, g: mixg, b: mixb}]\r\n        });\r\n    };\r\n    this.endLine = function () {\r\n        isDrawing = false;\r\n        count = 0;\r\n        points = [];\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: []\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n\r\n        context.save();\r\n        context.lineWidth = settingSize;\r\n\r\n        let mixr = settingColor.r, mixg = settingColor.g, mixb = settingColor.b;\r\n        if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < context.canvas.width - 1 && y1 - 5 < context.canvas.height - 1) {\r\n            mixr = 0;\r\n            mixg = 0;\r\n            mixb = 0;\r\n            let mixx = Math.min(context.canvas.width - 1, Math.max(0, x1 - 5));\r\n            let mixy = Math.min(context.canvas.height - 1, Math.max(0, y1 - 5));\r\n            let mixw = Math.min(context.canvas.width - 1, Math.max(0, x1 + 5));\r\n            let mixh = Math.min(context.canvas.height - 1, Math.max(0, y1 + 5));\r\n            mixw -= mixx;\r\n            mixh -= mixy;\r\n            if (mixw > 0 && mixh > 0) {\r\n                let w = Math.min(sampleCanvas.width, mixw);\r\n                let h = Math.min(sampleCanvas.height, mixh);\r\n                sampleCtx.save();\r\n                sampleCtx.globalCompositeOperation = 'copy';\r\n                sampleCtx.drawImage(context.canvas, mixx, mixy, mixw, mixh, 0, 0, w, h);\r\n                sampleCtx.restore();\r\n\r\n                let imdat = sampleCtx.getImageData(mixx, mixy, mixw, mixh);\r\n                let countmix = 0;\r\n                for (let i = 0; i < imdat.data.length; i += 4) {\r\n                    mixr += imdat.data[i + 0];\r\n                    mixg += imdat.data[i + 1];\r\n                    mixb += imdat.data[i + 2];\r\n                    countmix++;\r\n                }\r\n                mixr /= countmix;\r\n                mixg /= countmix;\r\n                mixb /= countmix;\r\n            }\r\n        }\r\n        let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\r\n        mixr = parseInt('' + (settingBlending * mixed.r + settingColor.r * (1 - settingBlending)));\r\n        mixg = parseInt('' + (settingBlending * mixed.g + settingColor.g * (1 - settingBlending)));\r\n        mixb = parseInt('' + (settingBlending * mixed.b + settingColor.b * (1 - settingBlending)));\r\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\r\n        context.beginPath();\r\n        context.moveTo(x1, y1);\r\n        context.lineTo(x2, y2);\r\n        context.stroke();\r\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\r\n        context.restore();\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"SketchyBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"setScale\",\r\n            params: [settingScale]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize / 2]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setBlending\",\r\n            params: [settingBlending]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    this.isDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\nexport function PixelBrush() {\r\n\r\n    let context;\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n\r\n    let settingColor, settingSize = 0.5, settingSpacing = 0.9, settingOpacity = 1;\r\n    let settingColorStr;\r\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\r\n    let settingLockLayerAlpha = false;\r\n    let settingIsEraser = false;\r\n    let settingUseDither = true;\r\n\r\n    let lineToolLastDot;\r\n    let lastInput = {x: 0, y: 0, pressure: 0};\r\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\r\n\r\n    let isDrawing = false;\r\n    let bezierLine = null;\r\n    let twoPI = Math.PI * 2;\r\n\r\n\r\n    let ditherCanvas = BB.canvas(4, 4);\r\n    let ditherCtx = ditherCanvas.getContext('2d');\r\n    let ditherPattern;\r\n    let ditherArr = [\r\n        [3, 2],\r\n        [1, 0],\r\n        [3, 0],\r\n        [1, 2],\r\n        [2, 1],\r\n        [0, 3],\r\n        [0, 1],\r\n        [2, 3],\r\n\r\n        [2, 0],\r\n        [0, 2],\r\n        [0, 0],\r\n        [2, 2],\r\n        [1, 1],\r\n        [3, 3],\r\n        [3, 1],\r\n        [1, 3]\r\n    ];\r\n\r\n    function updateDither() {\r\n        ditherCtx.clearRect(0, 0, 4, 4);\r\n        ditherCtx.fillStyle = settingIsEraser ? '#fff' : settingColorStr;\r\n        for (let i = 0; i < Math.max(1, Math.round(settingOpacity * ditherArr.length)); i++) {\r\n            ditherCtx.fillRect(ditherArr[i][0], ditherArr[i][1], 1, 1);\r\n        }\r\n        ditherPattern = context.createPattern(ditherCanvas, 'repeat');\r\n    }\r\n\r\n\r\n    /**\r\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\r\n     * @param p1\r\n     * @param p2\r\n     * @param p3\r\n     * @param p4\r\n     * @param maxAngleRad\r\n     */\r\n    function cubicCurveOverThreshold(p1, p2, p3, p4, max) {\r\n        let d = BB.Vec2.nor({\r\n            x: p4.x - p1.x,\r\n            y: p4.y - p1.y\r\n        });\r\n        let d2 = BB.Vec2.nor({\r\n            x: p2.x - p1.x,\r\n            y: p2.y - p1.y\r\n        });\r\n        let d3 = BB.Vec2.nor({\r\n            x: p4.x - p3.x,\r\n            y: p4.y - p3.y\r\n        });\r\n        let a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\r\n        let a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\r\n\r\n        return Math.max(BB.Vec2.dist(d, d2), BB.Vec2.dist(d, d3)) > max;\r\n    }\r\n\r\n    //bresenheim line drawing\r\n    function plotLine(x0, y0, x1, y1, skipFirst) {\r\n        context.save();\r\n\r\n        if (settingIsEraser) {\r\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            } else {\r\n                context.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        } else {\r\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        }\r\n        context.globalAlpha = settingUseDither ? 1 : settingOpacity;\r\n\r\n        x0 = Math.floor(x0);\r\n        y0 = Math.floor(y0);\r\n        x1 = Math.floor(x1);\r\n        y1 = Math.floor(y1);\r\n\r\n        let dX = Math.abs(x1 - x0);\r\n        let sX = x0 < x1 ? 1 : -1;\r\n        let dY = -Math.abs(y1 - y0);\r\n        let sY = y0 < y1 ? 1 : -1;\r\n        let err = dX + dY;\r\n        while (true) {\r\n            if (skipFirst) {\r\n                skipFirst = false;\r\n            } else {\r\n                context.fillRect(x0, y0, 1, 1);\r\n            }\r\n            if (x0 === x1 && y0 === y1) {\r\n                break;\r\n            }\r\n            let e2 = 2 * err;\r\n            if (e2 >= dY) {\r\n                err += dY;\r\n                x0 += sX;\r\n            }\r\n            if (e2 <= dX) {\r\n                err += dX;\r\n                y0 += sY;\r\n            }\r\n        }\r\n\r\n        context.restore();\r\n    }\r\n\r\n    function plotCubicBezierLine(p1, p2, p3, p4) {\r\n\r\n        let isOverThreshold = cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\r\n\r\n        p1.x = Math.floor(p1.x);\r\n        p1.y = Math.floor(p1.y);\r\n        p4.x = Math.floor(p4.x);\r\n        p4.y = Math.floor(p4.y);\r\n\r\n        let dist = BB.dist(p1.x, p1.y, p4.x, p4.y);\r\n        if (!isOverThreshold || dist < 7) {\r\n            plotLine(p1.x, p1.y, p4.x, p4.y, true);\r\n            return;\r\n        }\r\n\r\n        let n = Math.max(2, Math.round(dist / 4));\r\n        let pointArr = [];\r\n        for (let i = 0; i <= n; i++) {\r\n            let t = i / n;\r\n            let a = Math.pow(1 - t, 3);\r\n            let b = 3 * t * Math.pow(1 - t, 2);\r\n            let c = 3 * Math.pow(t, 2) * (1 - t);\r\n            let d = Math.pow(t, 3);\r\n            pointArr.push({\r\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\r\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            plotLine(\r\n                Math.round(pointArr[i].x),\r\n                Math.round(pointArr[i].y),\r\n                Math.round(pointArr[i + 1].x),\r\n                Math.round(pointArr[i + 1].y),\r\n                true\r\n            );\r\n        }\r\n    }\r\n\r\n    function drawDot(x, y, size, opacity, angle?) {\r\n        context.save();\r\n        if (settingIsEraser) {\r\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            } else {\r\n                context.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        } else {\r\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        }\r\n        context.globalAlpha = settingUseDither ? 1 : opacity;\r\n        context.fillRect(\r\n            Math.round(x + -size),\r\n            Math.round(y + -size),\r\n            Math.round(size * 2),\r\n            Math.round(size * 2)\r\n        );\r\n        context.restore();\r\n    }\r\n\r\n\r\n    function continueLine(x, y, size, pressure) {\r\n        if (bezierLine === null) {\r\n            bezierLine = new BB.BezierLine();\r\n            bezierLine.add(lastInput.x, lastInput.y, 0, function () {\r\n            });\r\n        }\r\n\r\n        context.save();\r\n\r\n        function dotCallback(val) {\r\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\r\n            let localOpacity = settingOpacity * (settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            let localSize = Math.max(0.5, settingSize * (settingHasSizePressure ? localPressure : 1));\r\n            drawDot(val.x, val.y, localSize, localOpacity, val.angle);\r\n        }\r\n\r\n        function controlCallback(controlObj) {\r\n            plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\r\n        }\r\n\r\n        if (Math.round(settingSize * 2) === 1) {\r\n            if (x === null) {\r\n                bezierLine.addFinal(4, null, controlCallback);\r\n            } else {\r\n                bezierLine.add(x, y, 4, null, controlCallback);\r\n            }\r\n\r\n        } else {\r\n            let localSpacing = size * settingSpacing;\r\n\r\n            if (x === null) {\r\n                bezierLine.addFinal(localSpacing, dotCallback);\r\n            } else {\r\n                bezierLine.add(x, y, localSpacing, dotCallback);\r\n            }\r\n        }\r\n\r\n        context.restore();\r\n    }\r\n\r\n    //------------------ interface ---------------------------------------------------\r\n\r\n\r\n    this.startLine = function (x, y, p) {\r\n        historyEntry = {\r\n            tool: [\"brush\", \"PixelBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setIsEraser\",\r\n            params: [settingIsEraser]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setUseDither\",\r\n            params: [settingUseDither]\r\n        });\r\n\r\n        if (settingUseDither) {\r\n            updateDither();\r\n        }\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localOpacity = settingHasOpacityPressure ? (settingOpacity * p * p) : settingOpacity;\r\n        let localSize = settingHasSizePressure ? Math.max(0.5, p * settingSize) : Math.max(0.5, settingSize);\r\n\r\n        isDrawing = true;\r\n        drawDot(x, y, localSize, localOpacity);\r\n        lineToolLastDot = localSize * settingSpacing;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n        lastInput2 = BB.copyObj(lastInput);\r\n\r\n        historyEntry.actions.push({\r\n            action: \"startLine\",\r\n            params: [x, y, p]\r\n        });\r\n    };\r\n\r\n    this.goLine = function (x, y, p) {\r\n        if (!isDrawing) {\r\n            return;\r\n        }\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [x, y, p]\r\n        });\r\n\r\n        //debug\r\n        //drawDot(x, y, 1, 0.5);\r\n\r\n        let pressure = BB.clamp(p, 0, 1);\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n\r\n        continueLine(x, y, localSize, lastInput.pressure);\r\n\r\n        lastInput2 = BB.copyObj(lastInput);\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = pressure;\r\n    };\r\n\r\n    this.endLine = function (x, y) {\r\n\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n        continueLine(null, null, localSize, lastInput.pressure);\r\n\r\n        //debug\r\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\r\n        //drawDot(x, y, 10, 0.1);\r\n\r\n        isDrawing = false;\r\n\r\n        bezierLine = null;\r\n\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: [x, y]\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (settingUseDither) {\r\n            updateDither();\r\n        }\r\n\r\n        if (Math.round(settingSize * 2) === 1) {\r\n            plotLine(x1, y1, x2, y2, true);\r\n        } else {\r\n            let angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\r\n            let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n            let eX = (x2 - x1) / mouseDist;\r\n            let eY = (y2 - y1) / mouseDist;\r\n            let loopDist;\r\n            let bdist = settingSize * settingSpacing;\r\n            lineToolLastDot = settingSize * settingSpacing;\r\n            for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n                drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\r\n            }\r\n        }\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"PixelBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setIsEraser\",\r\n            params: [settingIsEraser]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setUseDither\",\r\n            params: [settingUseDither]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    //IS\r\n    this.isDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n    //SET\r\n    this.setColor = function (c) {\r\n        if (settingColor === c) {\r\n            return;\r\n        }\r\n        settingColor = c;\r\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\r\n    };\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSize = function (s) {\r\n        settingSize = s;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        settingOpacity = o;\r\n    };\r\n    this.setSpacing = function (s) {\r\n        settingSpacing = s;\r\n    };\r\n    this.sizePressure = function (b) {\r\n        settingHasSizePressure = b;\r\n    };\r\n    this.opacityPressure = function (b) {\r\n        settingHasOpacityPressure = b;\r\n    };\r\n    this.setLockAlpha = function (b) {\r\n        settingLockLayerAlpha = b;\r\n    };\r\n    this.setIsEraser = function (b) {\r\n        settingIsEraser = !!b;\r\n    };\r\n    this.setUseDither = function (b) {\r\n        settingUseDither = !!b;\r\n    };\r\n    //GET\r\n    this.getSpacing = function () {\r\n        return settingSpacing;\r\n    };\r\n    this.getSize = function () {\r\n        return settingSize;\r\n    };\r\n    this.getOpacity = function () {\r\n        return settingOpacity;\r\n    };\r\n    this.getLockAlpha = function () {\r\n        return settingLockLayerAlpha;\r\n    };\r\n    this.getIsEraser = function () {\r\n        return settingIsEraser;\r\n    };\r\n    this.getUseDither = function () {\r\n        return settingUseDither;\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\nexport function EraserBrush() {\r\n    let context;\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n\r\n    let size = 30, spacing = 0.4, opacity = 1;\r\n    let sizePressure = true, opacityPressure = false;\r\n    let lastDot, lastInput = {x: 0, y: 0, pressure: 0};\r\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\r\n    let started = false;\r\n\r\n    let bezierLine;\r\n    let isBaseLayer = false;\r\n    let isTransparentBG = false;\r\n\r\n    function drawDot(x, y, size, opacity) {\r\n\r\n        context.save();\r\n        if (isBaseLayer) {\r\n            if (isTransparentBG) {\r\n                context.globalCompositeOperation = \"destination-out\";\r\n            } else {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        } else {\r\n            context.globalCompositeOperation = \"destination-out\";\r\n        }\r\n        let radgrad = context.createRadialGradient(size, size, 0, size, size, size);\r\n        let sharpness = Math.pow(opacity, 2);\r\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\r\n        let oFac = Math.max(0, Math.min(1, opacity));\r\n        let localOpacity = 2 * oFac - oFac * oFac;\r\n        radgrad.addColorStop(sharpness, \"rgba(255, 255, 255, \" + localOpacity + \")\");\r\n        radgrad.addColorStop(1, \"rgba(255, 255, 255, 0)\");\r\n        context.fillStyle = radgrad;\r\n        context.translate(x - size, y - size);\r\n        context.fillRect(0, 0, size * 2, size * 2);\r\n        context.restore();\r\n    }\r\n\r\n    function continueLine(x, y, p) {\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\r\n\r\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * localSize * spacing);\r\n\r\n        function bezierCallback(val) {\r\n            let factor = val.t;\r\n            localPressure = lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (opacityPressure) ? (opacity * localPressure * localPressure) : opacity;\r\n            localSize = (sizePressure) ? Math.max(0.1, localPressure * size) : Math.max(0.1, size);\r\n\r\n            drawDot(val.x, val.y, localSize, localOpacity);\r\n        }\r\n\r\n        if (x === null) {\r\n            bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n    }\r\n\r\n\r\n    this.startLine = function (x, y, p) {\r\n        historyEntry = {\r\n            tool: [\"brush\", \"EraserBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [opacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [sizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [size]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [opacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setTransparentBG\",\r\n            params: [isTransparentBG]\r\n        });\r\n\r\n        isBaseLayer = 0 === context.canvas.index;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localOpacity = (opacityPressure) ? (opacity * p * p) : opacity;\r\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\r\n\r\n        started = true;\r\n        if (localSize > 1) {\r\n            drawDot(x, y, localSize, localOpacity);\r\n        }\r\n        lastDot = localSize * spacing;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n        lastInput2 = BB.copyObj(lastInput);\r\n\r\n        bezierLine = new BB.BezierLine();\r\n        bezierLine.add(x, y, 0, function () {\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"startLine\",\r\n            params: [x, y, p]\r\n        });\r\n    };\r\n    this.goLine = function (x, y, p) {\r\n        if (!started) {\r\n            return;\r\n        }\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [x, y, p]\r\n        });\r\n\r\n        continueLine(x, y, lastInput.pressure);\r\n\r\n        lastInput2 = BB.copyObj(lastInput);\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n    };\r\n    this.endLine = function () {\r\n\r\n        if (bezierLine) {\r\n            continueLine(null, null, lastInput.pressure);\r\n        }\r\n\r\n        started = false;\r\n        bezierLine = undefined;\r\n\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: []\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n\r\n        isBaseLayer = 0 === context.canvas.index;\r\n\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n\r\n        if (started || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * size * spacing);\r\n        lastDot = 0;\r\n        for (loopDist = lastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, size, opacity);\r\n        }\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"EraserBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [opacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [sizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [size]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [opacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setTransparentBG\",\r\n            params: [isTransparentBG]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    //IS\r\n    this.isDrawing = function () {\r\n        return started;\r\n    };\r\n    //SET\r\n    /*this.setAlpha = function(a) {\r\n        lastInput = {};\r\n        alpha = a;\r\n        updateAlphaCanvas();\r\n    };*/\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSize = function (s) {\r\n        size = s;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        opacity = o;\r\n    };\r\n    this.sizePressure = function (b) {\r\n        sizePressure = b;\r\n    };\r\n    this.opacityPressure = function (b) {\r\n        opacityPressure = b;\r\n    };\r\n    this.setTransparentBG = function (b) {\r\n        isTransparentBG = b == true;\r\n    };\r\n    //GET\r\n    this.getSize = function () {\r\n        return size;\r\n    };\r\n    this.getOpacity = function () {\r\n        return opacity;\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb.types';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB} from '../kl.types';\r\n\r\n// let statCount = 1;\r\n// let statAcc = 0;\r\n// stats on win10, chrome, size 100, opacity 80, smudge()\r\n// unoptimized: 1 ms\r\n// minimal: 0.09 ms\r\n// minimal + circle: 0.5ms\r\n// minimal + circle + ix, iy: 0.23ms\r\n// unoptimized + ix, iy: 0.64 ms\r\n// unoptimized + ix, iy + sans rounding: 0.61 ms\r\n// ix, iy + sans rounding + sans random: 0.32ms\r\n// ix, iy + sans rounding + fast random: 0.46 ms\r\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\r\n\r\nconst CELL_SIZE = 256;\r\n\r\ninterface ISmudgeParams {\r\n    aP: IVector2D;\r\n    bP: IVector2D;\r\n    size: {\r\n        w: number;\r\n        h: number;\r\n    };\r\n    brush: {\r\n        center: IVector2D,\r\n        size: number;\r\n        opacity: number;\r\n        alphaLock: boolean;\r\n    };\r\n}\r\n\r\n\r\n/**\r\n * determine bounds of smudge\r\n * @param imWidth\r\n * @param imHeight\r\n * @param aP\r\n * @param bP\r\n * @param size\r\n */\r\nfunction prepSmudge(\r\n    imWidth: number,\r\n    imHeight: number,\r\n    aP: IVector2D, // top left of source, integers\r\n    bP: IVector2D, // top left of dest, integers\r\n    size: {w: number; h: number}, // size of both rectangles, integers\r\n): {\r\n    aP: IVector2D,\r\n    bP: IVector2D,\r\n    size: {w: number; h: number},\r\n} {\r\n\r\n    if (aP.x === bP.x && aP.y === bP.y) {\r\n        return null;\r\n    }\r\n\r\n    aP = BB.copyObj(aP);\r\n    bP = BB.copyObj(bP);\r\n    size = BB.copyObj(size);\r\n\r\n    // corner behavior\r\n    // cut down rectangles, if a or b go outside\r\n    // i.e. if user drags partially or fully outside the canvas\r\n    {\r\n        let top = 0;\r\n        let right = 0;\r\n        let bottom = 0;\r\n        let left = 0;\r\n\r\n        if (aP.x < 0) {\r\n            left = -aP.x;\r\n        }\r\n        if (aP.y < 0) {\r\n            top = -aP.y;\r\n        }\r\n        if (bP.x < 0) {\r\n            left = Math.max(left, -bP.x);\r\n        }\r\n        if (bP.y < 0) {\r\n            top = Math.max(top, -bP.y);\r\n        }\r\n        if (aP.x + size.w > imWidth) {\r\n            right = aP.x + size.w - imWidth;\r\n        }\r\n        if (aP.y + size.h > imHeight) {\r\n            bottom = aP.y + size.h - imHeight;\r\n        }\r\n        if (bP.x + size.w > imWidth) {\r\n            right = Math.max(right, bP.x + size.w - imWidth);\r\n        }\r\n        if (bP.y + size.h > imHeight) {\r\n            bottom = Math.max(bottom, bP.y + size.h - imHeight);\r\n        }\r\n\r\n        aP.x += left;\r\n        bP.x += left;\r\n        aP.y += top;\r\n        bP.y += top;\r\n\r\n        size.w = size.w - left - right;\r\n        size.h = size.h - top - bottom;\r\n        if (size.w <= 0 || size.h <= 0) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    return {\r\n        aP: {\r\n            x: aP.x,\r\n            y: aP.y,\r\n        },\r\n        bP: {\r\n            x: bP.x,\r\n            y: bP.y,\r\n        },\r\n        size: {\r\n            w: size.w,\r\n            h: size.h,\r\n        }\r\n    };\r\n}\r\n\r\n// faster than using BB.clamp somehow (in chrome)\r\nfunction clamp(num, min, max) {\r\n    return num <= min\r\n        ? min\r\n        : num >= max\r\n            ? max\r\n            : num\r\n}\r\n\r\n/**\r\n * Pixel operations that do the smudging via ImageData\r\n * @param imageData\r\n * @param p\r\n */\r\nfunction smudge(imageData: ImageData, p : ISmudgeParams): void {\r\n\r\n    p = BB.copyObj(p);\r\n\r\n    const cSize = p.brush.size;\r\n    const cX = p.brush.center.x;\r\n    const cY = p.brush.center.y;\r\n\r\n    /*if (statCount % 1000 === 0) {\r\n        console.log(statAcc / 1000);\r\n        statAcc = 0;\r\n    }\r\n    let start = performance.now();*/\r\n\r\n\r\n    // determine offset\r\n    let aIndex = p.aP.y * imageData.width + p.aP.x;\r\n    let bIndex = p.bP.y * imageData.width + p.bP.x;\r\n    const offset = (bIndex - aIndex) * 4;\r\n\r\n    // array with random numbers. faster than Math.random()\r\n    let randI = 0;\r\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n    const randArr = [];\r\n    for (let i = 0; i < randLen; i++) {\r\n        randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n    }\r\n\r\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\r\n\r\n    const pixel = (ai, bi, ix, iy) => {\r\n\r\n        const dist = BB.dist(cX, cY, ix, iy);\r\n        const fac = 1 - p.brush.opacity * (1 - clamp((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\r\n\r\n        if (fac === 1) {\r\n            return;\r\n        }\r\n\r\n        if (!imageData.data[ai + 3]) {\r\n\r\n        } else if (!imageData.data[bi + 3]) { // don't mix if target fully transparent. pixel might have a strange color.\r\n            imageData.data[bi] = imageData.data[ai + 0];\r\n            imageData.data[bi + 1] = imageData.data[ai + 1];\r\n            imageData.data[bi + 2] = imageData.data[ai + 2];\r\n        } else {\r\n\r\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\r\n            // not totally accurate. TODO same compositing as blend brush\r\n            let fac2;\r\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) {\r\n                fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\r\n            } else {\r\n                fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\r\n            }\r\n\r\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\r\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\r\n            // No +0.5, because it cancels out with rand.\r\n            imageData.data[bi] = Math.floor(BB.mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\r\n            imageData.data[bi + 1] = Math.floor(BB.mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\r\n            imageData.data[bi + 2] = Math.floor(BB.mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\r\n\r\n            randI = (randI + 1) % randLen;\r\n        }\r\n        // Always mix alpha. unless alpha lock\r\n        if (!p.brush.alphaLock) {\r\n            imageData.data[bi + 3] = Math.floor(BB.mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\r\n        }\r\n\r\n    };\r\n\r\n    const bx1 = p.bP.x * 4;\r\n    const bx2 = bx1 + (p.size.w - 1) * 4;\r\n\r\n    // transfer of pixels depends on direction of smudging if there is overlap\r\n    if (p.aP.y < p.bP.y) {\r\n        for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else if (p.aP.y > p.bP.y) {\r\n        for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else {\r\n        if (p.aP.x < p.bP.x) {\r\n            for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        } else {\r\n            for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x; x < bx2 + yStart; x += 4, x2 += 4, ix++) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //statCount++;\r\n    //statAcc += performance.now() - start;\r\n}\r\n\r\nexport class SmudgeBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IHistoryEntry;\r\n\r\n    private settingColor: IRGB = {r: 0, g: 0, b: 0};\r\n    private settingSize: number = 35;\r\n    private settingSpacing: number = 0.20446882736951905;\r\n    private settingOpacity: number = 0.8;\r\n    private settingColorStr: string;\r\n    private settingHasSizePressure: boolean = false;\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingLockLayerAlpha: boolean = false;\r\n\r\n    private lineToolLastDot: number;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastDot: IVector2D;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private bezierLine: any = null; // todo type BezierLine\r\n\r\n    private redrawBounds: IBounds;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    private copyImageData: ImageData;\r\n\r\n    private drawBuffer: ISmudgeParams[] = [];\r\n\r\n    private copiedCells: boolean[];\r\n\r\n    updateRedrawBounds(bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    updateCompleteRedrawBounds (x1, y1, x2, y2): void {\r\n        this.completeRedrawBounds = BB.updateBounds(\r\n            this.completeRedrawBounds,\r\n            { x1, y1, x2, y2 }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    copyFromCanvas(): void {\r\n\r\n        const touchedCells = this.copiedCells.map(item => false);\r\n\r\n        const bounds: IBounds[] = [];\r\n        const cellsW = Math.ceil(this.copyImageData.width / CELL_SIZE);\r\n\r\n        if (!this.redrawBounds) {\r\n            return;\r\n        }\r\n        bounds.push({\r\n            x1: Math.floor(this.redrawBounds.x1 / CELL_SIZE),\r\n            y1: Math.floor(this.redrawBounds.y1 / CELL_SIZE),\r\n            x2: Math.floor(this.redrawBounds.x2 / CELL_SIZE),\r\n            y2: Math.floor(this.redrawBounds.y2 / CELL_SIZE),\r\n        });\r\n        bounds.forEach(item => {\r\n            for (let i = item.x1; i <= item.x2; i++) {\r\n                for (let e = item.y1; e <= item.y2; e++) {\r\n                    touchedCells[e * cellsW + i] = true;\r\n                }\r\n            }\r\n        });\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.copiedCells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            this.copiedCells[i] = true;\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * CELL_SIZE + CELL_SIZE, this.copyImageData.width) - 1) % CELL_SIZE + 1;\r\n            const h = (Math.min(y * CELL_SIZE + CELL_SIZE, this.copyImageData.height) - 1) % CELL_SIZE + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = tmpCanvas.getContext('2d');\r\n            tmpCtx.drawImage(this.context.canvas, -x * CELL_SIZE, -y * CELL_SIZE);\r\n\r\n            const data = tmpCtx.getImageData(0, 0, w, h);\r\n\r\n            for (let i = 0; i < h; i++) {\r\n                for (let e = 0, e2 = i * w * 4, e3 = ((y * CELL_SIZE + i) * this.copyImageData.width + x * CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4) {\r\n                    this.copyImageData.data[e3] = data.data[e2];\r\n                    this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\r\n                    this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\r\n                    this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * fill drawBuffer with params about to be drawn\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     */\r\n    prepDot (x: number, y: number, size: number, opacity: number): void {\r\n        if (!this.lastDot) {\r\n            this.lastDot = {\r\n                x: x,\r\n                y: y,\r\n            };\r\n            return;\r\n        }\r\n\r\n        size = Math.round(size);\r\n\r\n\r\n        const w = Math.round(size * 2);\r\n        const h = Math.round(size * 2);\r\n\r\n        const bounds = prepSmudge(\r\n            this.copyImageData.width,\r\n            this.copyImageData.height,\r\n            {\r\n                x: Math.round(this.lastDot.x - size),\r\n                y: Math.round(this.lastDot.y - size),\r\n            },\r\n            {\r\n                x: Math.round(x - size),\r\n                y: Math.round(y - size),\r\n            },\r\n            {\r\n                w,\r\n                h,\r\n            },\r\n        );\r\n\r\n        if (bounds) {\r\n            const params: ISmudgeParams = {\r\n                aP: bounds.aP,\r\n                bP: bounds.bP,\r\n                size: bounds.size,\r\n                brush: {\r\n                    center: { x, y },\r\n                    size,\r\n                    opacity,\r\n                    alphaLock: this.settingLockLayerAlpha,\r\n                }\r\n            };\r\n            this.updateRedrawBounds({\r\n                x1: params.bP.x,\r\n                y1: params.bP.y,\r\n                x2: params.bP.x + params.brush.size * 2,\r\n                y2: params.bP.y + params.brush.size * 2,\r\n            });\r\n            this.drawBuffer.push(params);\r\n        }\r\n\r\n        this.lastDot = {\r\n            x: x,\r\n            y: y,\r\n        };\r\n    }\r\n\r\n    continueLine (x: number, y: number, size: number, pressure: number): void {\r\n        this.drawBuffer = [];\r\n\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function(){});\r\n        }\r\n\r\n        const drawArr = []; //draw instructions. will be all drawn at once\r\n\r\n        const dotCallback = (val): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        };\r\n\r\n        const localSpacing = size * this.settingSpacing / 3;\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            const item = drawArr[i];\r\n            this.prepDot(item[0], item[1], item[2], item[3]);\r\n            before = item;\r\n        }\r\n\r\n        this.copyFromCanvas();\r\n\r\n        for (let i = 0; i < this.drawBuffer.length; i++) {\r\n            smudge(this.copyImageData, this.drawBuffer[i]);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor () { }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: [\"brush\", \"SmudgeBrush\"],\r\n            actions: []\r\n        };\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.lastDot = null;\r\n        this.isDrawing = true;\r\n\r\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\r\n        const totalCells = Math.ceil(this.context.canvas.width / CELL_SIZE) * Math.ceil(this.context.canvas.height / CELL_SIZE);\r\n        this.copiedCells = '0'.repeat(totalCells).split('').map(item => false);\r\n\r\n        this.prepDot(x, y, localSize, localOpacity);\r\n\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2.pressure = p;\r\n\r\n        this.completeRedrawBounds = null;\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        this.redrawBounds = null;\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput2.pressure = this.lastInput.pressure;\r\n        this.lastInput.pressure = pressure;\r\n    }\r\n\r\n    endLine (): void {\r\n        this.redrawBounds = null;\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.context.save();\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n        this.context.restore();\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        if (this.historyEntry && this.completeRedrawBounds) {\r\n            let historyIm: ImageData | HTMLCanvasElement = this.copyImageData;\r\n            if (!(\r\n                this.completeRedrawBounds.x1 === 0 &&\r\n                this.completeRedrawBounds.y1 === 0 &&\r\n                this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 &&\r\n                this.completeRedrawBounds.y2 >= this.context.canvas.height - 1\r\n            )) {\r\n\r\n                // temp canvas to prevent main canvas from getting slowed down in chrome\r\n                const tmpCanvas = BB.canvas(\r\n                    this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                    this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n                );\r\n                const tmpCtx = tmpCanvas.getContext('2d');\r\n                tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n                historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\r\n            }\r\n            this.historyEntry.actions.push({\r\n                action: \"drawImage\",\r\n                params: [\r\n                    historyIm,\r\n                    this.completeRedrawBounds.x1,\r\n                    this.completeRedrawBounds.y1,\r\n                ],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n        this.copyImageData = null;\r\n    }\r\n\r\n    drawImage (im: ImageData | HTMLCanvasElement, x: number, y: number): void {\r\n        if (im instanceof ImageData) {\r\n            this.context.putImageData(im, x, y);\r\n        } else {\r\n            this.context.clearRect(x, y, im.width, im.height);\r\n            this.context.drawImage(im, x, y);\r\n        }\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        return;\r\n        /*\r\n        // todo\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = settingSize * settingSpacing;\r\n        lineToolLastDot = settingSize * settingSpacing;\r\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\r\n        }\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"SmudgeBrush\"],\r\n            actions: []\r\n        };\r\n        // todo\r\n        history.add(historyEntry);*/\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) {\r\n            return;\r\n        }\r\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\r\n        this.settingColorStr = BB.ColorConverter.toRgbStr(this.settingColor);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = !!b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = !!b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl.types';\r\nimport {IBounds} from '../../bb/bb.types';\r\nimport {KlHistoryInterface} from '../history/kl-history';\r\n\r\ntype TChemyMode = 'fill' | 'stroke';\r\n\r\nexport class ChemyBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private settingColor: IRGB;\r\n    private settingSize: number = 0.25; // radius - 0.5 - 99999\r\n    private settingOpacity: number = 1; // 0-1\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingIsEraser: boolean = false;\r\n    private settingMode: TChemyMode = 'fill';\r\n    private settingDistort: number = 0; // 0 - 1\r\n    private settingXSymmetry: boolean = false;\r\n    private settingYSymmetry: boolean = false;\r\n    private settingGradient: boolean = false;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private history: KlHistoryInterface;\r\n\r\n    private copyCanvas: HTMLCanvasElement;\r\n    private path: {x: number, y: number}[];\r\n    private minY: number;\r\n    private maxY: number;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    updateCompleteRedrawBounds (x, y): void {\r\n        let bounds = { x1: x, y1: y, x2: x, y2: y};\r\n        if (this.settingXSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: -x + this.copyCanvas.width,\r\n                    y1: y,\r\n                    x2: -x + this.copyCanvas.width,\r\n                    y2: y,\r\n                }\r\n                );\r\n        }\r\n        if (this.settingYSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: x,\r\n                    y1: -y + this.copyCanvas.height,\r\n                    x2: x,\r\n                    y2: -y + this.copyCanvas.height,\r\n                }\r\n            );\r\n        }\r\n        const buffer = this.settingMode === 'stroke' ? this.settingSize + 1 : 1;\r\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\r\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\r\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\r\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\r\n\r\n        this.completeRedrawBounds = BB.updateBounds(this.completeRedrawBounds, bounds);\r\n    }\r\n\r\n    private drawShape (): void {\r\n        this.context.save();\r\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\r\n        this.context.drawImage(this.copyCanvas, 0, 0);\r\n\r\n        let color = {...this.settingColor};\r\n        if (this.settingIsEraser) {\r\n            color.r = 255;\r\n            color.g = 255;\r\n            color.b = 255;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = \"source-atop\";\r\n            } else {\r\n                this.context.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        } else {\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        }\r\n\r\n        if (this.path) {\r\n\r\n            // path\r\n            const path = new Path2D();\r\n            this.path.forEach((item, index) => {\r\n                if (index === 0) {\r\n                    path.moveTo(item.x, item.y);\r\n                } else {\r\n                    path.lineTo(item.x, item.y);\r\n                }\r\n            });\r\n\r\n            let style: string | CanvasGradient = BB.ColorConverter.toRgbaStr({\r\n                r: color.r,\r\n                g: color.g,\r\n                b: color.b,\r\n                a: this.settingOpacity,\r\n            });\r\n            if (this.settingGradient) {\r\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\r\n                const gradient = this.context.createLinearGradient(\r\n                    0, startAtTop ? this.minY : this.maxY,\r\n                    0, startAtTop ? this.maxY : this.minY,\r\n                );\r\n                gradient.addColorStop(\r\n                    0,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: this.settingOpacity,\r\n                    })\r\n                );\r\n                gradient.addColorStop(\r\n                    1,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: 0,\r\n                    })\r\n                );\r\n                style = gradient;\r\n            }\r\n\r\n            // setup params\r\n            if (this.settingMode === 'fill') {\r\n                this.context.fillStyle = style;\r\n\r\n            } else {\r\n                this.context.lineWidth = this.settingSize * 2;\r\n                this.context.lineJoin = 'bevel';\r\n                this.context.strokeStyle = style;\r\n            }\r\n\r\n            // draw\r\n            const draw = () => {\r\n                if (this.settingMode === 'fill') {\r\n                    this.context.fill(path);\r\n                } else {\r\n                    this.context.stroke(path);\r\n                }\r\n            };\r\n\r\n            draw();\r\n            if (this.settingXSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(this.context.canvas.width / 2, 0);\r\n                this.context.scale(-1, 1);\r\n                this.context.translate(-this.context.canvas.width / 2, 0);\r\n                draw();\r\n                this.context.restore();\r\n            }\r\n            if (this.settingYSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(0, this.context.canvas.height / 2);\r\n                this.context.scale(1, -1);\r\n                this.context.translate(0, -this.context.canvas.height / 2);\r\n                draw();\r\n                this.context.restore();\r\n                if (this.settingXSymmetry) {\r\n                    this.context.save();\r\n                    this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\r\n                    this.context.scale(-1, -1);\r\n                    this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\r\n                    draw();\r\n                    this.context.restore();\r\n                }\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingMode === 'stroke' ? this.settingSize : 0;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.settingColor = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setMode (mode: TChemyMode): void {\r\n        this.settingMode = mode;\r\n    }\r\n\r\n    getMode (): TChemyMode {\r\n        return this.settingMode;\r\n    }\r\n\r\n    setDistort (distort: number): void {\r\n        this.settingDistort = BB.clamp(distort, 0, 1);\r\n    }\r\n\r\n    getDistort (): number {\r\n        return this.settingDistort;\r\n    }\r\n\r\n    setXSymmetry (b: boolean): void {\r\n        this.settingXSymmetry = !!b;\r\n    }\r\n\r\n    getXSymmetry (): boolean {\r\n        return this.settingXSymmetry;\r\n    }\r\n\r\n    setYSymmetry (b: boolean): void {\r\n        this.settingYSymmetry = !!b;\r\n    }\r\n\r\n    getYSymmetry (): boolean {\r\n        return this.settingYSymmetry;\r\n    }\r\n\r\n    setGradient (b: boolean): void {\r\n        this.settingGradient = !!b;\r\n    }\r\n\r\n    getGradient (): boolean {\r\n        return this.settingGradient;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.settingIsEraser;\r\n    }\r\n\r\n    setIsEraser (b: boolean): void {\r\n        this.settingIsEraser = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    startLine (x: number, y: number): void {\r\n        this.isDrawing = true;\r\n        this.path = [{x, y}];\r\n        this.minY = y;\r\n        this.maxY = y;\r\n        this.copyCanvas = BB.canvas(this.context.canvas.width, this.context.canvas.height);\r\n        this.copyCanvas.getContext('2d').drawImage(this.context.canvas, 0, 0);\r\n        this.completeRedrawBounds = null;\r\n        this.updateCompleteRedrawBounds(x, y);\r\n    }\r\n\r\n    goLine (x: number, y: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        let pos = { x, y };\r\n        if (this.settingDistort > 0) {\r\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\r\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\r\n        }\r\n\r\n        this.minY = Math.min(this.minY, pos.y);\r\n        this.maxY = Math.max(this.maxY, pos.y);\r\n        this.path.push(pos);\r\n        this.updateCompleteRedrawBounds(x, y);\r\n        this.drawShape();\r\n    }\r\n\r\n    endLine (): void {\r\n        this.isDrawing = false;\r\n        this.completeRedrawBounds = BB.boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\r\n        if (this.path.length > 1 && this.completeRedrawBounds) {\r\n            const historyCanvas = BB.canvas(\r\n                this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n            );\r\n            const historyCtx = historyCanvas.getContext('2d');\r\n            historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n            this.history.push({\r\n                tool: [\"brush\", \"ChemyBrush\"],\r\n                actions: [\r\n                    {\r\n                        action: \"drawImage\",\r\n                        params: [\r\n                            historyCanvas, // faster than getting image data (measured on 2018 lenovo chromebook)\r\n                            this.completeRedrawBounds.x1,\r\n                            this.completeRedrawBounds.y1,\r\n                        ],\r\n                    }\r\n                ]\r\n            });\r\n        }\r\n        this.path = null;\r\n        this.copyCanvas = null;\r\n    }\r\n\r\n    drawImage (im: HTMLCanvasElement, x: number, y: number): void {\r\n        this.context.save();\r\n        this.context.clearRect(x, y, im.width, im.height);\r\n        this.context.drawImage(im, x, y);\r\n        this.context.restore();\r\n    }\r\n\r\n    drawLineSegment (x1, y1, x2, y2): void {\r\n        // might make sense for stroke\r\n    }\r\n}\r\n","import {penBrushUi} from './pen-brush-ui';\r\nimport {blendBrushUi} from './blend-brush-ui';\r\nimport {sketchyBrushUi} from './sketchy-brush-ui';\r\nimport {pixelBrushUi} from './pixel-brush-ui';\r\nimport {eraserBrushUi} from './eraser-brush-ui';\r\nimport {smudgeBrushUi} from './smudge-brush-ui';\r\nimport {chemyBrushUi} from './chemy-brush-ui';\r\nimport {IBrushUi} from '../kl.types';\r\n\r\n/**\r\n * UI for brushes.\r\n * Each brush ui carries the brush with it.\r\n * So if you want to draw, you do it through the UI. should be changed sometime.\r\n */\r\n\r\nexport const brushesUI: {\r\n    [key: string]: IBrushUi;\r\n} = {\r\n    penBrush: penBrushUi,\r\n    blendBrush: blendBrushUi,\r\n    sketchyBrush: sketchyBrushUi,\r\n    pixelBrush: pixelBrushUi,\r\n    chemyBrush: chemyBrushUi,\r\n    smudgeBrush: smudgeBrushUi,\r\n    eraserBrush: eraserBrushUi,\r\n};\r\n","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pen.svg';\r\nimport {genBrushAlpha01, genBrushAlpha02} from '../brushes/alphas/brush-alphas';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const penBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pen'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 0,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    let alphaNames = [\r\n        LANG('brush-pen-circle'),\r\n        LANG('brush-pen-chalk'),\r\n        LANG('brush-pen-calligraphy'),\r\n        LANG('brush-pen-square'),\r\n    ];\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pen');\r\n        alphaNames = [\r\n            LANG('brush-pen-circle'),\r\n            LANG('brush-pen-chalk'),\r\n            LANG('brush-pen-calligraphy'),\r\n            LANG('brush-pen-square'),\r\n        ];\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.PenBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        let alphas = [];\r\n        let currentAlpha = 0;\r\n        for (let i = 0; i < 4; i++) {\r\n            (function (i) {\r\n                let alpha = BB.el({\r\n                    title: alphaNames[i],\r\n                    onClick: () => {\r\n                        alphaClick(i);\r\n                    }\r\n                });\r\n                let canvas = BB.canvas(70, 70);\r\n                let ctx = canvas.getContext('2d');\r\n                if (i === 0 || i === 3) {\r\n                    if (i === 0) {\r\n                        ctx.beginPath();\r\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\r\n                        ctx.closePath();\r\n                        ctx.fill();\r\n                    } else {\r\n                        ctx.fillRect(5, 5, 60, 60);\r\n                    }\r\n                } else if (i === 1) {\r\n                    ctx.drawImage(genBrushAlpha01(60), 5, 5);\r\n                } else if (i === 2) {\r\n                    ctx.drawImage(genBrushAlpha02(60), 5, 5);\r\n                }\r\n                alpha.style.backgroundImage = 'url(' + canvas.toDataURL('image/png') + ')';\r\n\r\n                alphas.push(alpha);\r\n            }(i));\r\n        }\r\n\r\n        function updateAlphas() {\r\n            for (let i = 0; i < alphas.length; i++) {\r\n                if (i === currentAlpha) {\r\n                    alphas[i].className = 'brush-alpha-selected';\r\n                } else {\r\n                    alphas[i].className = 'brush-alpha';\r\n                }\r\n            }\r\n        }\r\n\r\n        updateAlphas();\r\n\r\n        function alphaClick(id) {\r\n            currentAlpha = id;\r\n            brush.setAlpha(id);\r\n            updateAlphas();\r\n        }\r\n\r\n        let lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('brush-lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('brush-lock-alpha-title'),\r\n            css: {\r\n                cssFloat: 'right',\r\n                textAlign: 'right',\r\n            }\r\n        });\r\n\r\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                initValue: brush.getSize(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                curve: brushInterface.sizeSlider.curve,\r\n                formatFunc: function (v) {\r\n                    v *= 2;\r\n                    if (v < 10) {\r\n                        return Math.round(v * 10) / 10;\r\n                    } else {\r\n                        return Math.round(v);\r\n                    }\r\n                }\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                initValue: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n                curve: brushInterface.opacitySlider.curve,\r\n                formatFunc: function(v) {\r\n                    return Math.round(v * 100);\r\n                }\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                })\r\n            );\r\n\r\n            let alphaWrapper = document.createElement(\"div\");\r\n            for (let i = 0; i < alphas.length; i++) {\r\n                alphaWrapper.appendChild(alphas[i]);\r\n            }\r\n            alphaWrapper.style.marginTop = \"10px\";\r\n            div.appendChild(alphaWrapper);\r\n            alphaWrapper.appendChild(lockAlphaToggle.getElement());\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.increaseValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.decreaseValue(f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","\r\nexport const eventResMs = 20;","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iiCd6\");","import {BB} from '../../bb/bb';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-blend.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const blendBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-blend'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-blend');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.BlendBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                initValue: 58 / 2,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                curve: brushInterface.sizeSlider.curve,\r\n                formatFunc: function (v) {\r\n                    v *= 2;\r\n                    return Math.round(v);\r\n                }\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                initValue: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n                formatFunc: function(v) {\r\n                    return Math.round(v * 100);\r\n                }\r\n            });\r\n            let blendingSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 225,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                initValue: brush.getBlending() * 100,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val / 100);\r\n                }\r\n            });\r\n            blendingSlider.getElement().style.marginTop = \"10px\";\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.setSizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.setOpacityPressure(b);\r\n            });\r\n\r\n            let lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('brush-lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('brush-lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                    display: 'inline-block',\r\n                }\r\n            });\r\n\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                }),\r\n                blendingSlider.getElement(),\r\n                lockAlphaToggle.getElement()\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.increaseValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.decreaseValue(f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y, p, isCoalesced);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6fRlX\");","import {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-sketchy.png';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const sketchyBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-sketchy'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 10\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-sketchy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.SketchyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                initValue: brush.getSize(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setSize(val);\r\n                    p.onSizeChange(brush.getSize());\r\n                },\r\n                formatFunc: function (v) {\r\n                    v *= 2;\r\n                    if (v < 10) {\r\n                        return Math.round(v * 10) / 10;\r\n                    } else {\r\n                        return Math.round(v);\r\n                    }\r\n                }\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                initValue: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n                formatFunc: function(v) {\r\n                    return Math.round(v * 100);\r\n                }\r\n            });\r\n            let blendSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                initValue: brush.getBlending() * 100,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val / 100);\r\n                }\r\n            });\r\n            let scaleSlider = new KlSlider({\r\n                label: LANG('brush-sketchy-scale'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 1,\r\n                max: 20,\r\n                initValue: brush.getScale(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setScale(val);\r\n                }\r\n            });\r\n            opacitySlider.getElement().style.marginTop = \"10px\";\r\n            blendSlider.getElement().style.marginTop = \"10px\";\r\n            scaleSlider.getElement().style.marginTop = \"10px\";\r\n            div.appendChild(sizeSlider.getElement());\r\n            div.appendChild(opacitySlider.getElement());\r\n            div.appendChild(blendSlider.getElement());\r\n            div.appendChild(scaleSlider.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.increaseValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.decreaseValue(f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, pressure) {\r\n            brush.startLine(x, y, pressure);\r\n        };\r\n        this.goLine = function (x, y, pressure) {\r\n            brush.goLine(x, y, pressure, null);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getSeed = function () {\r\n            return parseInt(brush.getSeed());\r\n        };\r\n        this.setSeed = function (s) {\r\n            brush.setSeed(parseInt(s));\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hC7PC\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pixel.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const pixelBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pixel'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 0,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pixel');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.PixelBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        let lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('brush-lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('brush-lock-alpha-title'),\r\n            css: {\r\n                marginRight: '10px',\r\n            }\r\n        });\r\n\r\n        let eraserToggle = new Checkbox({\r\n            init: brush.getIsEraser(),\r\n            label: LANG('eraser'),\r\n            callback: function (b) {\r\n                brush.setIsEraser(b);\r\n            },\r\n            css: {\r\n                marginRight: '10px',\r\n            }\r\n        });\r\n\r\n        let ditherToggle = new Checkbox({\r\n            init: brush.getUseDither(),\r\n            label: LANG('brush-pixel-dither'),\r\n            callback: function (b) {\r\n                brush.setUseDither(b);\r\n            }\r\n        });\r\n\r\n        let spacingSpline = new BB.SplineInterpolator([[0.5, 0.45], [100, 4]]);\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                initValue: brush.getSize(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    val = Math.round(val * 2) / 2;\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                curve: brushInterface.sizeSlider.curve,\r\n                formatFunc: function (v) {\r\n                    v *= 2;\r\n                    return Math.round(v);\r\n                }\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                initValue: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n                curve: brushInterface.opacitySlider.curve,\r\n                formatFunc: function(v) {\r\n                    return Math.round(v * 100);\r\n                }\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                opacitySlider.getElement()\r\n            );\r\n\r\n            let toggleRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px'\r\n                }\r\n            });\r\n\r\n            toggleRow.appendChild(lockAlphaToggle.getElement());\r\n            toggleRow.appendChild(eraserToggle.getElement());\r\n            toggleRow.appendChild(ditherToggle.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.increaseValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.decreaseValue(f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eZgVv\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-eraser.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const eraserBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('eraser') + ' [E]',\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 200,\r\n            curve: BB.quadraticSplineInput(0.5, 200, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('eraser') + ' [E]';\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.EraserBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n        let isTransparentBg = false;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                initValue: 30,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                curve: brushInterface.sizeSlider.curve,\r\n                formatFunc: function (v) {\r\n                    v *= 2;\r\n                    if (v < 10) {\r\n                        return Math.round(v * 10) / 10;\r\n                    } else {\r\n                        return Math.round(v);\r\n                    }\r\n                }\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                initValue: 1,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n                formatFunc: function(v) {\r\n                    return Math.round(v * 100);\r\n                }\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                })\r\n            );\r\n\r\n            let transparencyToggle = new Checkbox({\r\n                init: false,\r\n                label: LANG('brush-eraser-transparent-bg'),\r\n                callback: function (b) {\r\n                    isTransparentBg = b;\r\n                    brush.setTransparentBG(b);\r\n                },\r\n                css: {\r\n                    marginTop: \"10px\",\r\n                }\r\n            });\r\n            div.appendChild(transparencyToggle.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        function drawDot(x, y) {\r\n            brush.drawDot(x, y);\r\n        }\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.increaseValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.decreaseValue(f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            //brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.getIsTransparentBg = function () {\r\n            return isTransparentBg;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        }\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fPZin\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-smudge.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const smudgeBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-smudge'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 0,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-smudge');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.SmudgeBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        let lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('brush-lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('brush-lock-alpha-title'),\r\n        });\r\n\r\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                initValue: brush.getSize(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                curve: brushInterface.sizeSlider.curve,\r\n                formatFunc: function (v) {\r\n                    v *= 2;\r\n                    if (v < 10) {\r\n                        return Math.round(v * 10) / 10;\r\n                    } else {\r\n                        return Math.round(v);\r\n                    }\r\n                }\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                initValue: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n                curve: brushInterface.opacitySlider.curve,\r\n                formatFunc: function(v) {\r\n                    return Math.round(v * 100);\r\n                }\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(false, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                })\r\n            );\r\n\r\n            let bottomRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            bottomRow.append(lockAlphaToggle.getElement());\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.increaseValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.decreaseValue(f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fp7H1\");","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-chemy.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {BoxToggle} from '../ui/base-components/box-toggle';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const chemyBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-chemy'),\r\n        sizeSlider: {\r\n            min: 0.25,\r\n            max: 25,\r\n            curve: BB.quadraticSplineInput(0.25, 25, 0.1),\r\n            isDisabled: true,\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-chemy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement(\"div\"); // the gui\r\n        const brush = new brushes.ChemyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                initValue: brush.getSize(),\r\n                eventResMs: eventResMs,\r\n                isEnabled: brush.getMode() === 'stroke',\r\n                onChange: function (val) {\r\n                    setSize(val);\r\n                    p.onSizeChange(brush.getSize());\r\n                },\r\n                curve: brushInterface.sizeSlider.curve,\r\n                formatFunc: function (v) {\r\n                    v *= 2;\r\n                    return v < 5 ? (Math.round(v * 10) / 10) : Math.round(v);\r\n                }\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                initValue: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n                formatFunc: function(v) {\r\n                    return Math.round(v * 100);\r\n                }\r\n            });\r\n\r\n            BB.css(opacitySlider.getElement(), {\r\n                marginTop: '10px',\r\n            });\r\n\r\n            let eraserToggle = new Checkbox({\r\n                init: brush.getIsEraser(),\r\n                label: LANG('eraser'),\r\n                callback: function (b) {\r\n                    brush.setIsEraser(b);\r\n                },\r\n                css: {\r\n                    marginTop: '10px',\r\n                    marginLeft: '10px',\r\n                }\r\n            });\r\n\r\n            const lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('brush-lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('brush-lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n\r\n            const toggleRow = BB.el({\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n\r\n            const iconSize = 35;\r\n            const padding = 8;\r\n            const actualIconSize = iconSize - padding * 2;\r\n            const halfSize = actualIconSize / 2;\r\n\r\n            const modeOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'fill',\r\n                        label: BB.createSvg({\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: '#000',\r\n                                    style: `transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-fill'),\r\n                    },\r\n                    {\r\n                        id: 'stroke',\r\n                        label: BB.createSvg({\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: 'none',\r\n                                    stroke: '#000',\r\n                                    style: `stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-stroke'),\r\n                    }\r\n                ],\r\n                initId: brush.getMode(),\r\n                onChange: (id: string): void => {\r\n                    brush.setMode(id as 'stroke' | 'fill');\r\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === 'fill';\r\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\r\n                    sizeSlider.setValue(brush.getSize());\r\n                    p.onSizeChange(brush.getSize());\r\n                    p.onConfigChange();\r\n                }\r\n            });\r\n\r\n            const mirrorXToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`,\r\n                        },\r\n                    ]\r\n                }),\r\n                title: LANG('brush-chemy-mirror-x'),\r\n                init: brush.getXSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setXSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const mirrorYToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`,\r\n                        },\r\n                    ]\r\n                }),\r\n                title: LANG('brush-chemy-mirror-y'),\r\n                init: brush.getYSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setYSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const gradientToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'defs',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'linearGradient',\r\n                                    id: 'gradient',\r\n                                    x1: '0',\r\n                                    y1: '0',\r\n                                    x2: '0',\r\n                                    y2: '1',\r\n                                    childrenArr: [\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '0%',\r\n                                            'stop-color': 'rgba(0,0,0,0)',\r\n                                        },\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '100%',\r\n                                            'stop-color': 'rgba(0,0,0,1)',\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            elementType: 'rect',\r\n                            fill: \"url('#gradient')\",\r\n                            x: '' + padding,\r\n                            y: '' + padding,\r\n                            width: '' + actualIconSize,\r\n                            height: '' + actualIconSize,\r\n                        },\r\n                    ]\r\n                }),\r\n                title: LANG('brush-chemy-gradient'),\r\n                init: brush.getGradient(),\r\n                onChange: (b) => {\r\n                    brush.setGradient(b);\r\n                },\r\n            });\r\n\r\n            BB.css(mirrorXToggle.getElement(), {\r\n                marginLeft: '10px',\r\n            });\r\n            {\r\n                const margin = {\r\n                    marginLeft: '4px',\r\n                };\r\n                BB.css(mirrorYToggle.getElement(), margin);\r\n                BB.css(gradientToggle.getElement(), margin);\r\n            }\r\n\r\n            toggleRow.append(\r\n                modeOptions.getElement(),\r\n                mirrorXToggle.getElement(),\r\n                mirrorYToggle.getElement(),\r\n                gradientToggle.getElement(),\r\n            );\r\n\r\n            div.append(\r\n                sizeSlider.getElement(),\r\n                opacitySlider.getElement(),\r\n                toggleRow,\r\n                BB.el({\r\n                    content: [\r\n                        lockAlphaToggle.getElement(),\r\n                        eraserToggle.getElement(),\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                    }\r\n                })\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.increaseValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.decreaseValue(f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eX098\");","import {BB} from '../../../bb/bb';\r\n\r\nexport class BoxToggle {\r\n    el: HTMLElement;\r\n    value: boolean;\r\n\r\n    update (): void {\r\n        if (this.value) {\r\n            BB.addClassName(this.el, 'kl-box-toggle--active');\r\n        } else {\r\n            BB.removeClassName(this.el, 'kl-box-toggle--active');\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            label: string | HTMLElement | SVGElement;\r\n            title?: string;\r\n            init?: boolean;\r\n            onChange: (b: boolean) => void;\r\n        }\r\n    ) {\r\n        this.value = !!p.init;\r\n        this.el = BB.el({\r\n            content: p.label,\r\n            title: p.title,\r\n            className: (typeof p.label === 'string') ? 'kl-box-toggle' : 'kl-box-toggle kl-box-toggle--custom-el',\r\n            onClick: () => {\r\n                this.value = !this.value;\r\n                this.update();\r\n                p.onChange(this.value);\r\n            },\r\n            css: {\r\n                cursor: 'pointer',\r\n            }\r\n        });\r\n        if (typeof p.label !== 'string') {\r\n            BB.css(p.label, {\r\n                display: 'block',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n        this.update();\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.value;\r\n    }\r\n\r\n    setValue (b: boolean): void {\r\n        this.value = !!b;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.el);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {Popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showIframePopup(url, isEmbed) {\r\n    if (!isEmbed && (window.innerHeight < 500 || window.innerWidth < 700)) {\r\n        window.open(url);\r\n        return;\r\n    }\r\n\r\n    let iframe = BB.el({\r\n        tagName: 'iframe',\r\n        custom: {\r\n            src: url,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            height: '100%'\r\n        }\r\n    }) as HTMLIFrameElement;\r\n    let titleEl = BB.el({});\r\n\r\n    let linkEl;\r\n    if (!isEmbed) {\r\n        linkEl = BB.el({\r\n            tagName: 'a',\r\n            parent: titleEl,\r\n            content: LANG('modal-new-tab'),\r\n            custom: {\r\n                href: 'help',\r\n                target: '_blank',\r\n            },\r\n            onClick: function() {\r\n                popup.close();\r\n            }\r\n        }) as HTMLAnchorElement;\r\n        iframe.onload = function() {\r\n            BB.setAttributes(linkEl, {\r\n                href: '' + iframe.contentWindow.location,\r\n            });\r\n        };\r\n    }\r\n\r\n\r\n    let popup = new Popup({\r\n        title: titleEl,\r\n        content: iframe,\r\n        width: 880,\r\n        isMaxHeight: true,\r\n        onClose: () => {\r\n            if (linkEl) {\r\n                BB.destroyEl(linkEl);\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nexport class RadioList {\r\n\r\n    el: HTMLDivElement;\r\n    inputs: HTMLInputElement[] = [];\r\n\r\n    constructor({name, init, items, ignoreFocus}: {\r\n        name: string;\r\n        init?: string;\r\n        items: {\r\n            label: string;\r\n            value: string;\r\n        }[],\r\n        ignoreFocus?: boolean; // default false\r\n    }) {\r\n        this.el = BB.el({\r\n            className: 'kl-radio'\r\n        }) as HTMLDivElement;\r\n\r\n        items.forEach(item => {\r\n            let label = BB.el({\r\n                tagName: 'label'\r\n            });\r\n            let input = BB.el({\r\n                tagName: 'input',\r\n                parent: label,\r\n                custom: {\r\n                    name: name,\r\n                    value: item.value,\r\n                    type: 'radio',\r\n                }\r\n            }) as HTMLInputElement;\r\n            if (ignoreFocus) {\r\n                input.setAttribute('data-ignore-focus', 'true');\r\n            }\r\n            if (init === item.value) {\r\n                input.checked = true;\r\n            }\r\n            label.append(item.label);\r\n            this.el.append(label);\r\n            this.inputs.push(input);\r\n        });\r\n    }\r\n\r\n\r\n    getValue(): string {\r\n        for (let i = 0; i < this.inputs.length; i++) {\r\n            if (this.inputs[i].checked) {\r\n                return this.inputs[i].value;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getElement() {\r\n        return this.el;\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n// @ts-ignore\r\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\r\nimport {IKlProject} from '../../kl.types';\r\nimport {showIframePopup} from '../modals/show-iframe-popup';\r\nimport {SaveReminder} from './save-reminder';\r\nimport {IProjectStoreListener, ProjectStore} from '../../storage/project-store';\r\nimport {KL} from '../../kl';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport class BrowserStorageUi {\r\n\r\n    private previewEl: HTMLDivElement;\r\n    private infoEl: HTMLDivElement;\r\n    private ageEl: HTMLDivElement;\r\n    private storeEl: HTMLButtonElement;\r\n    private clearEl: HTMLButtonElement;\r\n    private storeListener: IProjectStoreListener;\r\n\r\n    private timestamp: number;\r\n\r\n    private updateAge() {\r\n        if (!this.timestamp) {\r\n            return;\r\n        }\r\n        let age = new Date().getTime() - this.timestamp;\r\n        let ageStr;\r\n        age = Math.floor(age / 1000 / 60);\r\n        ageStr = LANG('file-storage-min-ago').replace('{x}', '' + age);\r\n        if (age > 60) {\r\n            age = Math.floor(age / 60);\r\n            ageStr = LANG('file-storage-hours-ago').replace('{x}', '' + age);\r\n            if (age > 24) {\r\n                age = Math.floor(age / 24);\r\n                ageStr = LANG('file-storage-days-ago').replace('{x}', '' + age);\r\n                if (age > 31) {\r\n                    ageStr = LANG('file-storage-month-ago');\r\n                }\r\n            }\r\n        }\r\n        this.ageEl.textContent = ageStr;\r\n    }\r\n\r\n    private resetButtons() {\r\n        if (this.timestamp) {\r\n            this.storeEl.textContent = LANG('file-storage-overwrite');\r\n            this.storeEl.disabled = false;\r\n            this.clearEl.disabled = false;\r\n        } else {\r\n            this.storeEl.textContent = LANG('file-storage-store');\r\n            this.storeEl.disabled = false;\r\n            this.clearEl.disabled = true;\r\n        }\r\n    }\r\n\r\n    private updateThumb(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.timestamp = timestamp;\r\n        if (this.timestamp) {\r\n            BB.css(thumbnail, {\r\n                display: 'block',\r\n                maxWidth: 'calc(100% - 2px)',\r\n                maxHeight: 'calc(100% - 2px)',\r\n                margin: '0 auto',\r\n                background: \"url('\" + BB.createCheckerCanvas(4).toDataURL('image/png') + \"')\",\r\n                boxShadow: '0 0 0 1px #aaa',\r\n                pointerEvents: 'none',\r\n            });\r\n            this.previewEl.innerHTML = '';\r\n            this.updateAge();\r\n            this.previewEl.append(thumbnail, this.ageEl);\r\n        } else {\r\n            this.previewEl.innerHTML = LANG('file-storage-empty');\r\n        }\r\n        this.resetButtons();\r\n    }\r\n\r\n    private async store() {\r\n        this.storeEl.textContent = LANG('file-storage-storing');\r\n        this.storeEl.disabled = true;\r\n        this.clearEl.disabled = true;\r\n        await new Promise((resolve) => {\r\n            setTimeout(() => resolve(null), 20);\r\n        });\r\n        try {\r\n            await this.projectStore.store(this.getProject());\r\n            this.saveReminder.reset();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: [\r\n                    `${LANG('file-storage-failed-1')}<ul>`,\r\n                    `<li>${LANG('file-storage-failed-2')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-3')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-4')}</li>`,\r\n                    `</ul>`,\r\n                ].join(''),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to store browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    private async clear() {\r\n        this.storeEl.disabled = true;\r\n        this.clearEl.disabled = true;\r\n        try {\r\n            await this.projectStore.clear();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: LANG('file-storage-failed-clear'),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to clear browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    element: HTMLDivElement;\r\n\r\n    constructor (\r\n        private projectStore: ProjectStore,\r\n        private getProject: () => IKlProject,\r\n        private saveReminder: SaveReminder,\r\n        private klRootEl: HTMLDivElement,\r\n        private options?: { hideClearButton?: boolean },\r\n    ) {\r\n        this.element = BB.el({\r\n            css: {\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 0fr',\r\n                gridTemplateRows: '0fr 0fr 0fr',\r\n                gap: '0 0',\r\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"',\r\n            }\r\n        }) as HTMLDivElement;\r\n\r\n\r\n        const title = BB.el({\r\n            parent: this.element,\r\n            content: LANG('file-storage'),\r\n            css: {\r\n                gridArea: 'title',\r\n                display: 'flex',\r\n                margin: '-5px 0',\r\n                //background: '#f00',\r\n            }\r\n        });\r\n\r\n        this.infoEl = BB.el({\r\n            parent: title,\r\n            content: '?',\r\n            title: LANG('file-storage-about'),\r\n            css: {\r\n                cursor: 'pointer',\r\n                marginLeft: '5px',\r\n                width: '19px',\r\n                height: '19px',\r\n                borderRadius: '100%',\r\n                textAlign: 'center',\r\n                lineHeight: '19px',\r\n                fontWeight: 'bold',\r\n                boxShadow: 'inset 0 0 0 1px #000',\r\n            },\r\n            onClick: () => {\r\n                showIframePopup('./help/#help-browser-storage', false);\r\n            }\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.projectStore.isBroken()) {\r\n            BB.el({\r\n                parent: this.element,\r\n                content: \" \" + LANG('file-storage-cant-access'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            return;\r\n        }\r\n\r\n        this.previewEl = BB.el({\r\n            parent: this.element,\r\n            title: LANG('file-storage-thumb-title'),\r\n            css: {\r\n                gridArea: 'preview',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                marginTop: '10px',\r\n                position: 'relative',\r\n                boxShadow: 'inset 0 0 0 1px #aaa',\r\n                background: '#cdcdcd',\r\n                color: '#545454',\r\n                colorScheme: 'only light',\r\n                minHeight: '67px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        this.ageEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                right: '0',\r\n                bottom: '0',\r\n                width: '100%',\r\n                textAlign: 'center',\r\n                background: 'rgba(0,0,0,0.7)',\r\n                color: '#fff',\r\n                textSize: '13px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        this.storeEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'gridButton',\r\n            content: LANG('file-storage-store'),\r\n            css: {\r\n                gridArea: 'store',\r\n                //background: '#00f',\r\n            },\r\n            custom: {\r\n                tabIndex: -1,\r\n            },\r\n            onClick: () => this.store(),\r\n        }) as HTMLButtonElement;\r\n        this.storeEl.tabIndex = -1;\r\n        this.clearEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'gridButton',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/> ' + LANG('file-storage-clear'),\r\n            css: {\r\n                gridArea: 'clear',\r\n                //background: '#ff0',\r\n            },\r\n            custom: {\r\n                tabIndex: -1,\r\n            },\r\n            onClick: () => this.clear(),\r\n        }) as HTMLButtonElement;\r\n\r\n        if (this.options?.hideClearButton) {\r\n            this.clearEl.style.display = 'none';\r\n        }\r\n\r\n        this.storeListener = {\r\n            onUpdate: (timestamp, thumbnail) => {\r\n                this.updateThumb(timestamp, thumbnail);\r\n            },\r\n        };\r\n        this.projectStore.subscribe(this.storeListener);\r\n\r\n        setInterval(() => this.updateAge(), 1000 * 60);\r\n\r\n        (async () => {\r\n            try {\r\n                const readResult = await this.projectStore.read();\r\n                if (readResult) {\r\n                    this.updateThumb(readResult.timestamp, readResult.thumbnail);\r\n                } else {\r\n                    this.updateThumb();\r\n                }\r\n            } catch (e) {\r\n                setTimeout(() => {\r\n                    throw new Error('storage-ui: failed initial read browser storage, ' + e);\r\n                }, 0);\r\n            }\r\n        })();\r\n    }\r\n\r\n\r\n    getElement() {\r\n        return this.element;\r\n    }\r\n\r\n    show () {\r\n        // todo\r\n    }\r\n\r\n    hide () {\r\n        // todo\r\n    }\r\n\r\n    destroy() {\r\n        BB.destroyEl(this.infoEl);\r\n        BB.destroyEl(this.storeEl);\r\n        BB.destroyEl(this.clearEl);\r\n        this.projectStore.unsubscribe(this.storeListener);\r\n    }\r\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\r\nimport {ProjectConverter} from './project-converter';\r\nimport {clear, getKlProjectObj, storeKlProjectObj} from './indexed-db';\r\nimport {LocalStorage} from '../../bb/base/local-storage';\r\n\r\n\r\nexport interface IProjectStoreListener {\r\n    onUpdate: (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) => void,\r\n}\r\n\r\nfunction makeAsync(func): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n        func(resolve, reject);\r\n    });\r\n}\r\n\r\n/**\r\n * simplified interface for storing projects into browser storage\r\n */\r\nexport class ProjectStore {\r\n\r\n    private listeners: IProjectStoreListener[] = [];\r\n    private accessHasFailed: boolean = false;\r\n\r\n    async lowLevelStore (project: IKlStorageProject): Promise<any> {\r\n        await new Promise((resolve, reject) => {\r\n            storeKlProjectObj(project, resolve, reject);\r\n        });\r\n    }\r\n\r\n    async lowLevelRead (): Promise<IKlStorageProject> {\r\n        return await makeAsync(getKlProjectObj) as IKlStorageProject;\r\n    }\r\n\r\n    async lowLevelClear (): Promise<any> {\r\n        await makeAsync(clear);\r\n    }\r\n\r\n\r\n\r\n    private emit(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.listeners.forEach(item => {\r\n            item.onUpdate(timestamp, thumbnail);\r\n        });\r\n    }\r\n\r\n    private updateTimestamp() {\r\n        LocalStorage.setItem('indexedDbUpdatedAt', '' + new Date().getTime());\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== 'indexedDbUpdatedAt' || this.listeners.length === 0) {\r\n                return;\r\n            }\r\n            try {\r\n                ( async () => {\r\n                    const readResult = await this.read();\r\n                    if (readResult) {\r\n                        this.emit(readResult.timestamp, readResult.thumbnail);\r\n                    } else {\r\n                        this.emit();\r\n                    }\r\n                })();\r\n            } catch (e) {\r\n                if (e.message.indexOf('db-error') === 0) {\r\n                    this.accessHasFailed = true;\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    async read(): Promise<{\r\n        project: IKlProject,\r\n        timestamp: number,\r\n        thumbnail: HTMLImageElement | HTMLCanvasElement\r\n    } | null> {\r\n        let storageProject;\r\n        try {\r\n            storageProject = await this.lowLevelRead();\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        if (!storageProject) {\r\n            return null;\r\n        }\r\n        let result;\r\n        try {\r\n            result = await ProjectConverter.readStorageProject(storageProject);\r\n        } catch (e) {\r\n            throw new Error('format-error: ' + e);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    async store(project: IKlProject): Promise<void> {\r\n        try {\r\n            const storageProject = ProjectConverter.createStorageProject(project);\r\n            await this.lowLevelStore(storageProject);\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        {\r\n            // immediately test if it can be read\r\n            const storageProject = await this.lowLevelRead();\r\n            let readResult = null;\r\n            try {\r\n                readResult = await ProjectConverter.readStorageProject(storageProject);\r\n            } catch (e) {\r\n                await this.lowLevelClear();\r\n                this.updateTimestamp();\r\n                setTimeout(() => this.emit(), 0);\r\n                throw new Error('format-error: ' + e);\r\n            }\r\n            this.updateTimestamp();\r\n            setTimeout(() => this.emit(readResult.timestamp, readResult.thumbnail), 0);\r\n        }\r\n    }\r\n\r\n    async clear(): Promise<void> {\r\n        await this.lowLevelClear();\r\n        this.updateTimestamp();\r\n        setTimeout(() => this.emit(), 0);\r\n    }\r\n\r\n    subscribe(listener: IProjectStoreListener) {\r\n        if (this.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        this.listeners.push(listener);\r\n    }\r\n\r\n    unsubscribe(listener: IProjectStoreListener) {\r\n        for (let i = 0; i < this.listeners.length; i++) {\r\n            if (listener === this.listeners[i]) {\r\n                this.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    isBroken() {\r\n        return this.accessHasFailed;\r\n    }\r\n\r\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\r\nimport {BB} from '../../bb/bb';\r\nimport {drawProject} from '../canvas/draw-project';\r\nimport {base64ToBlob} from './base-64-to-blob';\r\n\r\n\r\nconst thumbSize = 240;\r\n\r\nfunction loadImage(blob: Blob): Promise<HTMLImageElement> {\r\n    return new Promise<HTMLImageElement>((resolve, reject) => {\r\n        const im = new Image();\r\n        try {\r\n            im.src = BB.imageBlobToUrl(blob);\r\n        } catch (e) {\r\n            reject('imageBlobToUrl, ' + e.message);\r\n            return;\r\n        }\r\n        im.onload = () => {\r\n            URL.revokeObjectURL(im.src);\r\n            resolve(im);\r\n        }\r\n        im.onabort = function () {\r\n            reject('layer image failed loading');\r\n        };\r\n        im.onerror = function () {\r\n            reject('layer image failed loading');\r\n        };\r\n    });\r\n}\r\n\r\n/**\r\n * for:\r\n * - preparing project to be stored in ProjectStore\r\n * - reading a project that came out of the ProjectStore\r\n */\r\nexport class ProjectConverter {\r\n\r\n    private static createThumbnail(project): HTMLCanvasElement {\r\n        const size = BB.fitInto(project.width, project.height, thumbSize, thumbSize);\r\n        const factor = size.width / project.width;\r\n        return drawProject(project, factor);\r\n    }\r\n\r\n    static createStorageProject(project: IKlProject): IKlStorageProject {\r\n        return {\r\n            id: 1,\r\n            timestamp: new Date().getTime(),\r\n            thumbnail: base64ToBlob(ProjectConverter.createThumbnail(project).toDataURL('image/png')),\r\n            width: project.width,\r\n            height: project.height,\r\n            layers: project.layers.map(item => {\r\n                let blob;\r\n                if (item.image instanceof HTMLCanvasElement) {\r\n                    blob = base64ToBlob((item.image as HTMLCanvasElement).toDataURL('image/png'));\r\n                } else {\r\n                    // todo image\r\n                    throw new Error('Not implemented');\r\n                }\r\n                return {\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                    blob,\r\n                }\r\n            }),\r\n        };\r\n    }\r\n\r\n    static async readStorageProject(storageProject: IKlStorageProject): Promise<{\r\n        project: IKlProject,\r\n        timestamp: number,\r\n        thumbnail: HTMLImageElement | HTMLCanvasElement\r\n    }> {\r\n        if (\r\n            !storageProject.width || !storageProject.height ||\r\n            isNaN(storageProject.width) || isNaN(storageProject.height) ||\r\n            storageProject.width < 1 || storageProject.height < 1\r\n        ) {\r\n            throw new Error('readStorageProject invalid canvas size: ' + storageProject.width + ', ' + storageProject.height);\r\n        }\r\n        const project: IKlProject = {\r\n            width: storageProject.width,\r\n            height: storageProject.height,\r\n            layers: (await Promise.all(storageProject.layers.map(layer => loadImage(layer.blob))))\r\n                .map((image, i) => {\r\n                    return {\r\n                        name: storageProject.layers[i].name,\r\n                        opacity: storageProject.layers[i].opacity,\r\n                        mixModeStr: storageProject.layers[i].mixModeStr,\r\n                        image,\r\n                    };\r\n                }),\r\n        };\r\n\r\n        let thumbnail;\r\n        if (storageProject.thumbnail) {\r\n            thumbnail = await loadImage(storageProject.thumbnail);\r\n        } else {\r\n            thumbnail = ProjectConverter.createThumbnail(project);\r\n        }\r\n\r\n        return {\r\n            project: project,\r\n            timestamp: storageProject.timestamp,\r\n            thumbnail: thumbnail,\r\n        };\r\n    }\r\n\r\n}","\r\nexport function base64ToBlob(base64Str: string): Blob {\r\n    let parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n    let binStr = atob(parts[3]);\r\n    let buf = new ArrayBuffer(binStr.length);\r\n    let view = new Uint8Array(buf);\r\n    for (let i = 0; i < view.length; i++) {\r\n        view[i] = binStr.charCodeAt(i);\r\n    }\r\n    return new Blob([view], {'type': parts[1]});\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\n// @ts-ignore\r\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\r\nimport {BrowserStorageUi} from '../components/browser-storage-ui';\r\nimport {IKlProject} from '../../kl.types';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport type exportType = 'png' | 'layers' | 'psd';\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport class FileTab {\r\n\r\n    private readonly div: HTMLDivElement;\r\n    private importButton: HTMLInputElement;\r\n    private fileBrowserStorage: BrowserStorageUi;\r\n\r\n    constructor(\r\n        klRootEl,\r\n        projectStore: ProjectStore,\r\n        getProject: () => IKlProject,\r\n        private exportType,\r\n        onExportTypeChange,\r\n        onFileSelect,\r\n        onSaveImageToComputer,\r\n        onNewImage,\r\n        onShareImage,\r\n        onUpload,\r\n        onCopyToClipboard,\r\n        saveReminder: SaveReminder,\r\n    ) {\r\n        const _this = this;\r\n        this.div = document.createElement(\"div\");\r\n\r\n        const asyncCreation = () => {\r\n            let filemenu = document.createElement(\"div\");\r\n            let newButton = document.createElement(\"button\");\r\n            let saveButton = document.createElement(\"button\");\r\n            let shareButton = document.createElement(\"button\");\r\n            let uploadImgurButton = document.createElement(\"button\");\r\n            let clipboardButton = document.createElement(\"button\");\r\n\r\n            newButton.style.cssFloat = 'left';\r\n            BB.css(saveButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n            });\r\n            BB.css(clipboardButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n            });\r\n\r\n            newButton.tabIndex = -1;\r\n            saveButton.tabIndex = -1;\r\n            shareButton.tabIndex = -1;\r\n            uploadImgurButton.tabIndex = -1;\r\n            clipboardButton.tabIndex = -1;\r\n\r\n            newButton.innerHTML = `<img src='${newImageImg}' alt='icon' height='20'/>${LANG('file-new')}`;\r\n            saveButton.innerHTML = `<img src='${exportImg}' alt='icon' height='20'/>${LANG('file-save')}`;\r\n            shareButton.innerHTML = `<img src='${shareImg}' alt='icon' height='20'/>${LANG('file-share')}`;\r\n            uploadImgurButton.innerHTML = `<img style='float:left' src='${uploadImg}' height='20' alt='icon'/>${LANG('file-upload')}`;\r\n            clipboardButton.innerHTML = `<img src='${copyImg}' alt='icon' height='20'/>${LANG('file-copy')}`;\r\n            clipboardButton.title = LANG('file-copy-title');\r\n            newButton.className = \"gridButton\";\r\n            saveButton.className = \"gridButton\";\r\n            shareButton.className = \"gridButton\";\r\n            uploadImgurButton.className = \"gridButton\";\r\n            clipboardButton.className = \"gridButton\";\r\n\r\n\r\n            this.importButton = document.createElement(\"input\");\r\n            this.importButton.tabIndex = -1;\r\n            this.importButton.type = \"file\";\r\n            this.importButton.multiple = true;\r\n            this.importButton.accept = \"image\";\r\n            (this.importButton as any).size = \"71\";\r\n            this.importButton.textContent = \"Import\";\r\n            let importWrapper: any = this.importButton;\r\n\r\n            function createImportButton() {\r\n                importWrapper = document.createElement(\"div\");\r\n                importWrapper.className = \"gridButton\";\r\n                importWrapper.style.position = \"relative\";\r\n                importWrapper.style.cursor = \"pointer\";\r\n                importWrapper.style.cssFloat = \"left\";\r\n\r\n                let innerMask = document.createElement(\"div\");\r\n                innerMask.style.width = \"120px\";\r\n                innerMask.style.height = \"28px\";\r\n                innerMask.style.overflow = \"hidden\";\r\n                innerMask.style.cursor = \"pointer\";\r\n                innerMask.style.position = \"relative\";\r\n\r\n                importWrapper.appendChild(innerMask);\r\n                innerMask.appendChild(_this.importButton);\r\n\r\n                let importFakeButton = document.createElement(\"button\");\r\n                importFakeButton.innerHTML = \"<img style='float:left' height='20' src='\" + importImg + \"' alt='icon'/>\" + LANG('file-import');\r\n                importFakeButton.tabIndex = -1;\r\n\r\n                BB.css(importFakeButton, {\r\n                    width: \"120px\",\r\n                    display: \"box\",\r\n                    position: \"absolute\",\r\n                    left: '0',\r\n                    top: '0',\r\n                    cursor: \"pointer\"\r\n                });\r\n                BB.css(_this.importButton, {\r\n                    display: 'none'\r\n                });\r\n                importWrapper.appendChild(importFakeButton);\r\n\r\n                importFakeButton.onclick = function() {\r\n                    _this.importButton.click();\r\n                }\r\n            }\r\n\r\n            createImportButton();\r\n\r\n            this.importButton.onchange = function (e) {\r\n                onFileSelect(_this.importButton.files, 'default');\r\n                _this.importButton.value = \"\";\r\n\r\n            };\r\n\r\n\r\n            // --- export filetype dropdown ---\r\n            let exportTypeWrapper;\r\n            let exportTypeSelect;\r\n            {\r\n                exportTypeWrapper = BB.el({\r\n                    css: {\r\n                        fontSize: '15px',\r\n                        marginLeft: '10px',\r\n                        marginTop: '10px',\r\n                        cssFloat: 'left',\r\n                        width: 'calc(50% - 15px)',\r\n                        height: '30px'\r\n                    }\r\n                });\r\n                exportTypeSelect = new KL.Select({\r\n                    optionArr: [\r\n                        ['png', LANG('file-save-png')],\r\n                        ['psd', LANG('file-save-psd')],\r\n                        ['layers', LANG('file-save-layers')],\r\n                    ],\r\n                    initValue: exportType,\r\n                    onChange: function(val) {\r\n                        exportType = val;\r\n                        onExportTypeChange(exportType);\r\n                        onSaveImageToComputer();\r\n                    }\r\n                });\r\n                BB.css(exportTypeSelect.getElement(), {\r\n                    width: '120px',\r\n                    height: '30px'\r\n                });\r\n                exportTypeWrapper.appendChild(exportTypeSelect.getElement());\r\n\r\n            }\r\n\r\n\r\n\r\n            newButton.onclick = onNewImage;\r\n            saveButton.onclick = function () {\r\n                onSaveImageToComputer();\r\n            };\r\n            shareButton.onclick = function() {\r\n                shareButton.disabled = true;\r\n                onShareImage(() => {\r\n                    shareButton.disabled = false;\r\n                });\r\n            };\r\n            uploadImgurButton.onclick = function () {\r\n                onUpload();\r\n            };\r\n\r\n            clipboardButton.onclick = function() {\r\n                clipboardButton.blur();\r\n                onCopyToClipboard();\r\n            };\r\n\r\n            let saveNote = document.createElement(\"div\");\r\n            saveNote.textContent = \" \" + LANG('file-no-autosave');\r\n            BB.css(saveNote, {\r\n                textAlign: \"center\",\r\n                marginTop: \"10px\",\r\n                background: \"rgb(243, 243, 161)\",\r\n                padding: \"5px 0px\",\r\n                color: 'rgba(0,0,0,0.65)',\r\n                fontSize: '15px',\r\n            });\r\n\r\n            function createSpacer() {\r\n                let el = document.createElement(\"div\");\r\n                let clearer = document.createElement(\"div\");\r\n                let line = document.createElement(\"div\");\r\n                el.appendChild(clearer);\r\n                el.appendChild(line);\r\n                BB.css(clearer, {\r\n                    clear: 'both'\r\n                });\r\n                BB.css(line, {\r\n                    marginLeft: \"10px\",\r\n                    marginRight: \"10px\",\r\n                    marginTop: \"10px\",\r\n                    borderBottom: \"1px solid rgba(0,0,0,0.2)\",\r\n                    clear: 'both'\r\n                });\r\n                return el;\r\n            }\r\n\r\n            _this.fileBrowserStorage = new BrowserStorageUi(projectStore, getProject, saveReminder, klRootEl);\r\n            BB.css(_this.fileBrowserStorage.getElement(), {\r\n                //background: 'red',\r\n                margin: '10px',\r\n            });\r\n\r\n\r\n            //actual structure\r\n            BB.append(filemenu, [\r\n                saveNote,\r\n                newButton,\r\n                importWrapper,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                saveButton,\r\n                exportTypeWrapper,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                clipboardButton,\r\n                BB.canShareFiles() ? shareButton : null,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                createSpacer(),\r\n                _this.fileBrowserStorage.getElement(),\r\n                createSpacer(),\r\n                uploadImgurButton,\r\n            ]);\r\n\r\n            this.div.appendChild(filemenu);\r\n        };\r\n\r\n        setTimeout(asyncCreation, 1);\r\n    }\r\n\r\n    refresh() {\r\n    }\r\n\r\n    getElement() {\r\n        return this.div;\r\n    }\r\n\r\n    setIsVisible(isVisible: boolean) {\r\n        if (isVisible) {\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    triggerImport() {\r\n        this.importButton.click();\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2oHM2\");","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\nimport {StatusOverlay} from '../components/status-overlay';\r\nimport {KlCanvasWorkspace} from '../../canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\nexport class FilterTab {\r\n\r\n    private readonly div: HTMLDivElement;\r\n    private isInit = false;\r\n\r\n    constructor (\r\n        private klRootEl,\r\n        private klColorSlider,\r\n        private layerManager,\r\n        private setCurrentLayer,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private handUi,\r\n        private getCurrentColor,\r\n        private getKlMaxCanvasSize,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx,\r\n        private isEmbed: boolean,\r\n        private statusOverlay: StatusOverlay,\r\n    ) {\r\n        this.div = document.createElement(\"div\");\r\n    }\r\n\r\n    private init() {\r\n        const _this = this;\r\n        let hasWebGl = BB.hasWebGl();\r\n        let filters = KL.filterLib;\r\n        let buttons = [];\r\n\r\n        BB.BbLog.emit({\r\n            type: 'init-filters',\r\n        });\r\n\r\n        if (!KL.filterLibStatus.isLoaded) {\r\n            throw new Error('filters not loaded');\r\n        }\r\n\r\n        function createButton(filterKey, filterArr) {\r\n            let button = document.createElement(\"button\");\r\n            let buttonLabel = filterArr[filterKey].buttonLabel ? filterArr[filterKey].buttonLabel : filterArr[filterKey].name;\r\n            let im = '<img height=\"20\" width=\"18\" src=\"' + filterArr[filterKey].icon + '\" alt=\"icon\" />';\r\n            button.innerHTML = im + buttonLabel;\r\n            button.className = \"gridButton\";\r\n            BB.css(button, {\r\n                lineHeight: '20px',\r\n                fontSize: '12px',\r\n            });\r\n            button.tabIndex = -1;\r\n            button.onclick = function () {\r\n\r\n                function finishedDialog(result, filterDialog) {\r\n                    if (result == \"Cancel\") {\r\n                        if (filterDialog.destroy) {\r\n                            filterDialog.destroy();\r\n                        }\r\n                        return;\r\n                    }\r\n                    let input;\r\n                    try {\r\n                        input = filterDialog.getInput(); // also destroys\r\n                    } catch (e) {\r\n                        if (e.message.indexOf('.getInput is not a function') !== -1) {\r\n                            throw 'filterDialog.getInput is not a function, filter: ' + filterArr[filterKey].name;\r\n                        } else {\r\n                            throw e;\r\n                        }\r\n                    }\r\n                    applyFilter(input);\r\n                }\r\n\r\n                if (!('apply' in filterArr[filterKey])) {\r\n                    alert('Application not fully loaded');\r\n                    return;\r\n                }\r\n\r\n                function applyFilter(input) {\r\n                    let filterResult = filterArr[filterKey].apply({\r\n                        context: _this.getCurrentLayerCtx(),\r\n                        canvas: _this.getKlCanvas(),\r\n                        history: klHistory,\r\n                        input: input\r\n                    });\r\n                    if (filterResult === false) {\r\n                        alert(\"Couldn't apply the edit action\");\r\n                    }\r\n                    if (filterArr[filterKey].updateContext === true) {\r\n                        _this.setCurrentLayer(_this.getKlCanvas().getLayer(_this.layerManager.getSelected()));\r\n                    }\r\n                    if (filterArr[filterKey].updatePos === true) {\r\n                        _this.klCanvasWorkspace.resetView();\r\n                        _this.handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                    _this.layerManager.update();\r\n                }\r\n\r\n                if (filterArr[filterKey].isInstant){\r\n                    button.blur();\r\n                    applyFilter(null);\r\n                    _this.statusOverlay.out('\"' + filterArr[filterKey].name + '\" ' + LANG('filter-applied'), true);\r\n                } else {\r\n                    let secondaryColorRGB = _this.klColorSlider.getSecondaryRGB();\r\n                    let filterDialog = filterArr[filterKey].getDialog({\r\n                        context: _this.getCurrentLayerCtx(),\r\n                        canvas: _this.getKlCanvas(),\r\n                        maxWidth: _this.getKlMaxCanvasSize(),\r\n                        maxHeight: _this.getKlMaxCanvasSize(),\r\n                        currentColorRgb: {r: _this.getCurrentColor().r, g: _this.getCurrentColor().g, b: _this.getCurrentColor().b},\r\n                        secondaryColorRgb: {r: secondaryColorRGB.r, g: secondaryColorRGB.g, b: secondaryColorRGB.b}\r\n                    });\r\n\r\n                    if (!filterDialog) {\r\n                        return;\r\n                        //alert('Error: could not perform action');\r\n                        //throw('filter['+filterKey+'].getDialog returned '+filterDialog+'. ctx:' + currentLayerCtx + ' klCanvas:' + klCanvas);\r\n                    }\r\n\r\n                    let closefunc;\r\n                    filterDialog.errorCallback = function(e) {\r\n                        setTimeout(function() {\r\n                            alert('Error: could not perform action');\r\n                            throw e;\r\n                        }, 0);\r\n                        closefunc();\r\n                    };\r\n\r\n\r\n                    let style: IKeyString = {};\r\n                    if ('width' in filterDialog) {\r\n                        style.width = filterDialog.width + 'px'\r\n                    }\r\n\r\n                    KL.popup({\r\n                        target: _this.klRootEl,\r\n                        message: \"<b>\" + filterArr[filterKey].name + \"</b>\",\r\n                        div: filterDialog.element,\r\n                        style: style,\r\n                        buttons: [\"Ok\", \"Cancel\"],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: function(result) {\r\n                            finishedDialog(result, filterDialog);\r\n                        },\r\n                        closefunc: function (func) {\r\n                            closefunc = func;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            buttons[buttons.length] = button;\r\n            return button;\r\n        }\r\n\r\n        function createDisabledButton(filterKey, filterArr) {\r\n            if (!filterArr[filterKey].webgl && !filterArr[filterKey].ieFails) {\r\n                return;\r\n            }\r\n            if (filterArr[filterKey].ieFails && navigator.appName !== 'Microsoft Internet Explorer') {\r\n                return;\r\n            }\r\n            let buttonLabel = filterArr[filterKey].buttonLabel ? filterArr[filterKey].buttonLabel : filterArr[filterKey].name;\r\n            let button = document.createElement(\"button\");\r\n            let im = '<img style=\"opacity: 0.5\" src=\"img/' + filterArr[filterKey].icon + '\" />';\r\n            let name = filterArr[filterKey].name;\r\n            if (name.length > 11) {\r\n                name = \"<span style='font-size: 12px'>\" + buttonLabel + \"</span>\";\r\n            }\r\n            button.innerHTML = im + name;\r\n            button.className = \"gridButton\";\r\n            button.disabled = true;\r\n            return button;\r\n        }\r\n\r\n        function addGroup(groupArr, filterArr, targetEl) {\r\n            for (let filterKey in filterArr) {\r\n                if (filterArr.hasOwnProperty[filterKey] || !groupArr.includes(filterKey)) {\r\n                    continue;\r\n                }\r\n                if (_this.isEmbed && !filterArr[filterKey].inEmbed) {\r\n                    continue;\r\n                }\r\n                if ((filterArr[filterKey].webgl && hasWebGl)\r\n                    || (filterArr[filterKey].neededWithWebGL)\r\n                    || (!filterArr[filterKey].webgl && !hasWebGl)\r\n                    && !(filterArr[filterKey].ieFails && navigator.appName == 'Microsoft Internet Explorer')) {\r\n\r\n                    targetEl.appendChild(createButton(filterKey, filterArr));\r\n\r\n                } else {\r\n                    targetEl.appendChild(createDisabledButton(filterKey, filterArr));\r\n                    filterArr[filterKey] = undefined;\r\n                }\r\n            }\r\n        }\r\n\r\n        let groupA = [\r\n            'cropExtend',\r\n            'flip',\r\n            'glPerspective',\r\n            'resize',\r\n            'rotate',\r\n            'transform'\r\n        ];\r\n        let groupB = [];\r\n        for (let filterKey in filters) {\r\n            if (filters.hasOwnProperty[filterKey] || groupA.includes(filterKey)) {\r\n                continue;\r\n            }\r\n            groupB.push(filterKey);\r\n        }\r\n\r\n        addGroup(groupA, filters, _this.div);\r\n        let hrEl = document.createElement(\"div\");\r\n        hrEl.className = \"gridHr\";\r\n        _this.div.appendChild(hrEl);\r\n        addGroup(groupB, filters, _this.div);\r\n\r\n\r\n        if (!hasWebGl) {\r\n            let webglnote = BB.appendTextDiv(_this.div, \"Some actions are disabled because WebGL isn't working.\");\r\n            webglnote.style.margin = \"10px\";\r\n            BB.css(webglnote, {\r\n                fontSize: \"11px\",\r\n                color: \"#555\",\r\n                background: \"#ffe\",\r\n                padding: \"10px\",\r\n                borderRadius: \"10px\",\r\n                textAlign: \"center\"\r\n            });\r\n        }\r\n\r\n        this.isInit = true;\r\n    }\r\n\r\n    getElement() {\r\n        return this.div;\r\n    }\r\n\r\n    show() {\r\n        if (!this.isInit) {\r\n            this.init();\r\n        }\r\n        this.div.style.display = 'block';\r\n    }\r\n\r\n    hide() {\r\n        this.div.style.display = 'none';\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\n// @ts-ignore\r\nimport loadingImg from 'url:~/src/app/img/ui/loading.gif';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {base64ToBlob} from '../../storage/base-64-to-blob';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\nasync function upload(canvas, title, description, type: 'png' | 'jpeg', imgurKey: string): Promise<{deletehash: string}> {\r\n    let img = base64ToBlob(canvas.toDataURL(\"image/\" + type));\r\n\r\n    let w = window.open();\r\n    let label = w.document.createElement(\"div\");\r\n    let gif = w.document.createElement(\"img\");\r\n    gif.src = loadingImg;\r\n    label.appendChild(gif);\r\n    BB.css(gif, {\r\n        filter: \"invert(1)\"\r\n    });\r\n    w.document.body.style.backgroundColor = \"#121211\";\r\n    w.document.body.style.backgroundImage = \"linear-gradient(#2b2b2b 0%, #121211 50%)\";\r\n    w.document.body.style.backgroundRepeat = \"no-repeat\";\r\n    let labelText = w.document.createElement(\"div\");\r\n    labelText.style.marginTop = \"10px\";\r\n    label.appendChild(labelText);\r\n    labelText.textContent = LANG('upload-uploading');\r\n\r\n    w.document.body.appendChild(label);\r\n    BB.css(label, {\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n        marginTop: \"100px\",\r\n        fontFamily: \"Arial, sans-serif\",\r\n        fontSize: \"20px\",\r\n        textAlign: \"center\",\r\n        transition: \"opacity 0.3s ease-in-out\",\r\n        opacity: '0',\r\n        color: \"#ccc\"\r\n    });\r\n    setTimeout(function () {\r\n        label.style.opacity = '1';\r\n    }, 20);\r\n\r\n    let response;\r\n    try {\r\n        const formData = new FormData();\r\n        formData.append('title', title);\r\n        formData.append('description', description);\r\n        formData.append('image', img);\r\n        response = await fetch('https://api.imgur.com/3/image',  {\r\n            method: 'POST',\r\n            headers: {\r\n                Authorization: 'Client-ID ' + imgurKey,\r\n            },\r\n            body: formData\r\n        });\r\n\r\n    } catch (e) {\r\n        w.close();\r\n        throw new Error(e);\r\n    }\r\n    if (!response.ok) {\r\n        w.close();\r\n        throw new Error();\r\n    }\r\n    let data = (await response.json()).data;\r\n\r\n    w.location.href = (data as any).link.replace(/\\.(jpg|png)/, '');\r\n\r\n    return data;\r\n}\r\n\r\n\r\nexport function imgurUpload(klCanvas: KlCanvas, klRootEl, saveReminder: SaveReminder, imgurKey: string) {\r\n    if (!imgurKey) {\r\n        throw new Error('imgur key missing');\r\n    }\r\n\r\n    let inputTitle = document.createElement(\"input\");\r\n    inputTitle.type = \"text\";\r\n    inputTitle.value = LANG('upload-title-untitled');\r\n    let inputDescription = BB.el({\r\n        tagName: 'textarea',\r\n        custom: {\r\n            rows: 2,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            maxWidth: '100%',\r\n        },\r\n    }) as HTMLTextAreaElement;\r\n\r\n    let labelTitle = document.createElement(\"div\");\r\n    labelTitle.textContent = LANG('upload-name') + \":\";\r\n    let labelDescription = BB.el({\r\n        content: LANG('upload-caption') + ':',\r\n        css: {\r\n            marginTop: '10px',\r\n        }\r\n    });\r\n\r\n    let tos = document.createElement(\"div\");\r\n    tos.innerHTML = `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${LANG('upload-tos')}</a> ${LANG('upload-tos-2')}`;\r\n\r\n    const typeRadio = new KL.RadioList({\r\n        name: 'filetype',\r\n        init: 'jpeg',\r\n        items: [\r\n            { label: 'JPG', value: 'jpeg' },\r\n            { label: 'PNG', value: 'png' },\r\n        ],\r\n        ignoreFocus: true,\r\n    });\r\n    BB.css(typeRadio.getElement(), {\r\n        marginBottom: '10px',\r\n    });\r\n\r\n\r\n    let outDiv = document.createElement(\"div\");\r\n    let infoHint = document.createElement(\"div\");\r\n    infoHint.className = \"info-hint\";\r\n    infoHint.textContent = LANG('upload-link-notice');\r\n    outDiv.append(\r\n        infoHint,\r\n        typeRadio.getElement(),\r\n        labelTitle,\r\n        inputTitle,\r\n        labelDescription,\r\n        inputDescription,\r\n        tos\r\n    );\r\n    KL.popup({\r\n        target: klRootEl,\r\n        message: `<b>${LANG('upload-title')}</b>`,\r\n        type: \"upload\",\r\n        div: outDiv,\r\n        buttons: [LANG('upload-submit'), \"Cancel\"],\r\n        clickOnEnter: LANG('upload-submit'),\r\n        primaries: [LANG('upload-submit')],\r\n        autoFocus: LANG('upload-submit'),\r\n        callback: async function (val) {\r\n            if (val === LANG('upload-submit') || val === \"Yes\" || val === \"Ok\") {\r\n                try {\r\n                    const result = await upload(\r\n                        klCanvas.getCompleteCanvas(1),\r\n                        inputTitle.value,\r\n                        inputDescription.value,\r\n                        typeRadio.getValue() as 'png' | 'jpeg',\r\n                        imgurKey,\r\n                    );\r\n\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: \"ok\",\r\n                        message: `<h3>${LANG('upload-success')}</h3><br>${LANG('upload-delete')}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/<b>delete</b>/${result.deletehash}</a><br><br>`,\r\n                        buttons: [\"Ok\"]\r\n                    });\r\n                    saveReminder.reset();\r\n\r\n                } catch(e) {\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: \"error\",\r\n                        message: LANG('upload-failed'),\r\n                        buttons: [\"Ok\"]\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iGeXe\");","import {BB} from '../../bb/bb';\r\n\r\nlet agPsdLazy;\r\nexport async function loadAgPsd() {\r\n    if (!agPsdLazy) {\r\n        agPsdLazy = await import('ag-psd');\r\n        BB.BbLog.emit({\r\n            type: 'loaded-agpsd',\r\n        });\r\n    }\r\n    return agPsdLazy;\r\n}","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kNYzr\"))).then(() => parcelRequire('2m2jt'));","import {KL} from '../../kl';\r\nimport {BB} from '../../../bb/bb';\r\nimport {KlHistoryInterface} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\nimport {BrowserStorageUi} from './browser-storage-ui';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {IKlProject} from '../../kl.types';\r\n\r\n\r\nconst reminderTimelimitMs = 1000 * 60 * 20; // 20 minutes\r\nconst unsavedActionsLimit = 100; // number of actions user did since last save\r\n\r\n\r\n/**\r\n * remind user of saving, keep user aware of save state\r\n */\r\nexport class SaveReminder {\r\n    private lastSavedActionNumber: number = null;\r\n    private lastSavedAt: number;\r\n\r\n    private lastReminderShownAt: number;\r\n    private unsavedInterval;\r\n    private closeFunc: () => void;\r\n\r\n    showPopup (): void {\r\n        if (!this.projectStore || !this.getProject) {\r\n            throw new Error('projectStore and getProject need to be set');\r\n        }\r\n\r\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\r\n\r\n        const contentEl = BB.el({});\r\n\r\n        contentEl.append(\r\n            BB.el({\r\n                content: LANG(\r\n                    'save-reminder-text',\r\n                    {\r\n                        a: '<strong>' + min,\r\n                        b: '</strong>',\r\n                    }\r\n                ),\r\n                css: {\r\n                    marginBottom: '20px',\r\n                }\r\n            }),\r\n        );\r\n\r\n        const psdWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n            }\r\n        });\r\n        const storageWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n                paddingBottom: '0',\r\n            }\r\n        });\r\n        contentEl.append(psdWrapper, storageWrapper);\r\n\r\n\r\n        const psdBtn = BB.el({\r\n            tagName: 'button',\r\n            className: 'kl-button',\r\n            content: LANG('save-reminder-save-psd'),\r\n            onClick: () => this.onSaveAsPsd(),\r\n        });\r\n        psdWrapper.append(\r\n            psdBtn,\r\n            BB.el({\r\n                content: LANG('save-reminder-psd-layers'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            }),\r\n        );\r\n\r\n\r\n        const storageUi = new BrowserStorageUi(\r\n            this.projectStore,\r\n            this.getProject,\r\n            this,\r\n            document.body as any,\r\n            {\r\n                hideClearButton: true,\r\n            }\r\n        );\r\n        storageWrapper.append(storageUi.getElement());\r\n\r\n\r\n        KL.popup({\r\n            target: document.body,\r\n            message: `<b>${LANG('save-reminder-title')}</b>`,\r\n            div: contentEl,\r\n            ignoreBackground: true,\r\n            callback: () => {\r\n                storageUi.destroy();\r\n                BB.destroyEl(psdBtn);\r\n                this.closeFunc = null;\r\n                this.lastReminderShownAt = performance.now();\r\n            },\r\n            closefunc: (f) => {\r\n                this.closeFunc = f;\r\n            }\r\n        });\r\n        setTimeout(() => {\r\n            psdBtn.focus();\r\n        }, 40);\r\n    }\r\n\r\n    constructor (\r\n        private history: KlHistoryInterface,\r\n        private showReminder: boolean,\r\n        private changeTitle: boolean,\r\n        private onSaveAsPsd: () => void,\r\n        private isDrawing: () => boolean,\r\n        private projectStore: ProjectStore | null, // needed if showReminder\r\n        private getProject: (() => IKlProject) | null, // needed if showReminder\r\n        private title: string = 'Klecks',\r\n    ) { }\r\n\r\n    init (): void {\r\n        if (this.lastSavedActionNumber !== null) { // already initialized\r\n            return;\r\n        }\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n\r\n        if (this.showReminder) {\r\n            setInterval(() => {\r\n                if (document.visibilityState !== 'visible') {\r\n                    return;\r\n                }\r\n\r\n                let unsavedActions = Math.abs(this.history.getActionNumber() - this.lastSavedActionNumber);\r\n\r\n                if (\r\n                    KL.dialogCounter.get() === 0 &&\r\n                    !this.isDrawing() &&\r\n                    this.lastReminderShownAt + reminderTimelimitMs < performance.now() &&\r\n                    unsavedActions >= unsavedActionsLimit\r\n                ) {\r\n                    this.showPopup();\r\n                }\r\n            }, 1000 * 5);\r\n        }\r\n\r\n        // confirmation dialog when closing tab\r\n        function onBeforeUnload(e) {\r\n            e.preventDefault();\r\n            e.returnValue = '';\r\n        }\r\n\r\n        this.history.addListener(() => {\r\n            let actionNumber = this.history.getActionNumber();\r\n            if (this.lastSavedActionNumber !== actionNumber) {\r\n                BB.setEventListener(window, 'onbeforeunload', onBeforeUnload);\r\n            } else {\r\n                BB.setEventListener(window, 'onbeforeunload', null);\r\n            }\r\n        });\r\n\r\n        if (this.changeTitle) {\r\n            document.addEventListener(\"visibilitychange\", () => {\r\n                if (document.visibilityState === 'visible') {\r\n                    document.title = this.title;\r\n                    clearInterval(this.unsavedInterval);\r\n                } else {\r\n                    let actionNumber = this.history.getActionNumber();\r\n                    if (this.lastSavedActionNumber !== actionNumber) {\r\n                        document.title = LANG('unsaved') + ' - ' + this.title;\r\n                        let state = 0;\r\n                        this.unsavedInterval = setInterval(() => {\r\n                            state = (state + 1) % 2;\r\n                            if (state === 1) {\r\n                                document.title = LANG('unsaved') + '  ' + this.title;\r\n                            } else {\r\n                                document.title = LANG('unsaved') + ' - ' + this.title;\r\n                            }\r\n                        }, 1000 * 60 * 3);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    reset (): void {\r\n        if (this.lastSavedActionNumber === null) { // not initialized\r\n            return;\r\n        }\r\n\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n        BB.setEventListener(window, 'onbeforeunload', null);\r\n\r\n        if (this.closeFunc) {\r\n            this.closeFunc();\r\n        }\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {KL} from '../kl';\r\nimport {saveAs} from 'file-saver';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\n\r\nexport class SaveToComputer {\r\n\r\n    constructor(\r\n        private saveReminder,\r\n        private klRootEl,\r\n        private getExportType,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private filenameBase: string,\r\n    ) {}\r\n\r\n    save(format?: 'psd' | 'layers' | 'png') {\r\n        const _this = this;\r\n\r\n        _this.saveReminder.reset();\r\n\r\n\r\n        function saveImage(canvas, filename, mimeType) {\r\n            let parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n            //assume base64 encoding\r\n            let binStr = atob(parts[3]);\r\n            //convert to binary in ArrayBuffer\r\n            let buf = new ArrayBuffer(binStr.length);\r\n            let view = new Uint8Array(buf);\r\n            for (let i = 0; i < view.length; i++) {\r\n                view[i] = binStr.charCodeAt(i);\r\n            }\r\n            let blob = new Blob([view], {'type': parts[1]});\r\n            saveAs(blob, filename);\r\n        }\r\n\r\n        if (!format) {\r\n            format = _this.getExportType();\r\n        }\r\n\r\n        if (format === 'png') {\r\n            let extension = 'png';\r\n            let mimeType = 'image/png';\r\n            let filename = BB.getDate() + this.filenameBase + \".\" + extension;\r\n            let fullCanvas = _this.getKlCanvas().getCompleteCanvas(1);\r\n\r\n            /*fullCanvas.toBlob(function(blob) {\r\n                if (blob === null) {\r\n                    throw 'save image error, blob is null';\r\n                }\r\n                saveAs(blob, filename);\r\n            }, mimetype);*/\r\n\r\n            //using old code, because saving somehow doesn't work for ipad before ios 13\r\n            //and it doesn't even throw an exception\r\n            try {\r\n                saveImage(fullCanvas, filename, mimeType);\r\n            } catch (error) { //fallback for old browsers\r\n                let im = new Image();\r\n                im.width = _this.getKlCanvas().getWidth();\r\n                im.height = _this.getKlCanvas().getHeight();\r\n                im.src = fullCanvas.toDataURL(mimeType);\r\n                KL.exportDialog(_this.klRootEl, im);\r\n            }\r\n        } else if (format === 'layers') {\r\n            let extension = 'png';\r\n            let mimeType = 'image/png';\r\n            let fileBase = BB.getDate() + this.filenameBase;\r\n            let layerArr = _this.getKlCanvas().getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                let item = layerArr[i];\r\n                let fnameArr = [\r\n                    fileBase,\r\n                    '_',\r\n                    ('' + (i + 1)).padStart(2, '0'),\r\n                    '_',\r\n                    item.name,\r\n                    '.',\r\n                    extension\r\n                ];\r\n                saveImage(item.canvas, fnameArr.join(''), mimeType);\r\n            }\r\n        } else if (format === 'psd') {\r\n\r\n            let layerArr = _this.getKlCanvas().getLayersFast();\r\n\r\n            let psdConfig = {\r\n                width: _this.getKlCanvas().getWidth(),\r\n                height: _this.getKlCanvas().getHeight(),\r\n                children: [],\r\n                canvas: _this.getKlCanvas().getCompleteCanvas(1)\r\n            };\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                let item = layerArr[i];\r\n                psdConfig.children.push({\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    canvas: item.canvas,\r\n                    blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n                    left: 0,\r\n                    top: 0\r\n                });\r\n            }\r\n\r\n            KL.loadAgPsd().then((agPsdLazy) => {\r\n                let buffer = agPsdLazy.writePsdBuffer(psdConfig);\r\n                let blob = new Blob([buffer], { type: 'application/octet-stream' });\r\n                saveAs(blob, BB.getDate() + this.filenameBase + '.psd');\r\n            }).catch(() => {\r\n                alert('Error: failed to load PSD library');\r\n            });\r\n\r\n        }\r\n\r\n    }\r\n\r\n}","/*\n* FileSaver.js\n* A saveAs() FileSaver implementation.\n*\n* By Eli Grey, http://eligrey.com\n*\n* License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)\n* source  : http://purl.eligrey.com/github/FileSaver.js\n*/\n\n// The one and only way of getting global scope in all environments\n// https://stackoverflow.com/q/3277182/1008999\nvar _global = typeof window === 'object' && window.window === window\n  ? window : typeof self === 'object' && self.self === self\n  ? self : typeof global === 'object' && global.global === global\n  ? global\n  : this\n\nfunction bom (blob, opts) {\n  if (typeof opts === 'undefined') opts = { autoBom: false }\n  else if (typeof opts !== 'object') {\n    console.warn('Deprecated: Expected third argument to be a object')\n    opts = { autoBom: !opts }\n  }\n\n  // prepend BOM for UTF-8 XML and text/* types (including HTML)\n  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n  if (opts.autoBom && /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n    return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type })\n  }\n  return blob\n}\n\nfunction download (url, name, opts) {\n  var xhr = new XMLHttpRequest()\n  xhr.open('GET', url)\n  xhr.responseType = 'blob'\n  xhr.onload = function () {\n    saveAs(xhr.response, name, opts)\n  }\n  xhr.onerror = function () {\n    console.error('could not download file')\n  }\n  xhr.send()\n}\n\nfunction corsEnabled (url) {\n  var xhr = new XMLHttpRequest()\n  // use sync to avoid popup blocker\n  xhr.open('HEAD', url, false)\n  try {\n    xhr.send()\n  } catch (e) {}\n  return xhr.status >= 200 && xhr.status <= 299\n}\n\n// `a.click()` doesn't work for all browsers (#465)\nfunction click (node) {\n  try {\n    node.dispatchEvent(new MouseEvent('click'))\n  } catch (e) {\n    var evt = document.createEvent('MouseEvents')\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,\n                          20, false, false, false, false, 0, null)\n    node.dispatchEvent(evt)\n  }\n}\n\n// Detect WebView inside a native macOS app by ruling out all browsers\n// We just need to check for 'Safari' because all other browsers (besides Firefox) include that too\n// https://www.whatismybrowser.com/guides/the-latest-user-agent/macos\nvar isMacOSWebView = _global.navigator && /Macintosh/.test(navigator.userAgent) && /AppleWebKit/.test(navigator.userAgent) && !/Safari/.test(navigator.userAgent)\n\nvar saveAs = _global.saveAs || (\n  // probably in some web worker\n  (typeof window !== 'object' || window !== _global)\n    ? function saveAs () { /* noop */ }\n\n  // Use download attribute first if possible (#193 Lumia mobile) unless this is a macOS WebView\n  : ('download' in HTMLAnchorElement.prototype && !isMacOSWebView)\n  ? function saveAs (blob, name, opts) {\n    var URL = _global.URL || _global.webkitURL\n    var a = document.createElement('a')\n    name = name || blob.name || 'download'\n\n    a.download = name\n    a.rel = 'noopener' // tabnabbing\n\n    // TODO: detect chrome extensions & packaged apps\n    // a.target = '_blank'\n\n    if (typeof blob === 'string') {\n      // Support regular links\n      a.href = blob\n      if (a.origin !== location.origin) {\n        corsEnabled(a.href)\n          ? download(blob, name, opts)\n          : click(a, a.target = '_blank')\n      } else {\n        click(a)\n      }\n    } else {\n      // Support blobs\n      a.href = URL.createObjectURL(blob)\n      setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s\n      setTimeout(function () { click(a) }, 0)\n    }\n  }\n\n  // Use msSaveOrOpenBlob as a second approach\n  : 'msSaveOrOpenBlob' in navigator\n  ? function saveAs (blob, name, opts) {\n    name = name || blob.name || 'download'\n\n    if (typeof blob === 'string') {\n      if (corsEnabled(blob)) {\n        download(blob, name, opts)\n      } else {\n        var a = document.createElement('a')\n        a.href = blob\n        a.target = '_blank'\n        setTimeout(function () { click(a) })\n      }\n    } else {\n      navigator.msSaveOrOpenBlob(bom(blob, opts), name)\n    }\n  }\n\n  // Fallback to using FileReader and a popup\n  : function saveAs (blob, name, opts, popup) {\n    // Open a popup immediately do go around popup blocker\n    // Mostly only available on user interaction and the fileReader is async so...\n    popup = popup || open('', '_blank')\n    if (popup) {\n      popup.document.title =\n      popup.document.body.innerText = 'downloading...'\n    }\n\n    if (typeof blob === 'string') return download(blob, name, opts)\n\n    var force = blob.type === 'application/octet-stream'\n    var isSafari = /constructor/i.test(_global.HTMLElement) || _global.safari\n    var isChromeIOS = /CriOS\\/[\\d]+/.test(navigator.userAgent)\n\n    if ((isChromeIOS || (force && isSafari) || isMacOSWebView) && typeof FileReader !== 'undefined') {\n      // Safari doesn't allow downloading of blob URLs\n      var reader = new FileReader()\n      reader.onloadend = function () {\n        var url = reader.result\n        url = isChromeIOS ? url : url.replace(/^data:[^;]*;/, 'data:attachment/file;')\n        if (popup) popup.location.href = url\n        else location = url\n        popup = null // reverse-tabnabbing #460\n      }\n      reader.readAsDataURL(blob)\n    } else {\n      var URL = _global.URL || _global.webkitURL\n      var url = URL.createObjectURL(blob)\n      if (popup) popup.location = url\n      else location.href = url\n      popup = null // reverse-tabnabbing #460\n      setTimeout(function () { URL.revokeObjectURL(url) }, 4E4) // 40s\n    }\n  }\n)\n\n_global.saveAs = saveAs.saveAs = saveAs\n\nif (typeof module !== 'undefined') {\n  module.exports = saveAs;\n}\n","import {KL} from '../kl';\r\nimport {IHistoryBroadcast, IHistoryEntry, klHistory} from './kl-history';\r\nimport {KlCanvasWorkspace} from '../canvas-ui/kl-canvas-workspace';\r\nimport {IFilterApply, IInitState} from '../kl.types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\n\r\nexport class UndoRedoCatchup {\r\n\r\n    private doIgnore = false;\r\n\r\n    /**\r\n     * Prevent multiple undo / redo getting triggered at once.\r\n     * Might be confusing if main thread is choking.\r\n     */\r\n    private ignoreTest (): boolean {\r\n        if (this.doIgnore) {\r\n            return false;\r\n        }\r\n        this.doIgnore = true;\r\n        setTimeout(() => {\r\n            this.doIgnore = false;\r\n        }, 0);\r\n        return true;\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        private brushUiObj,\r\n        private layerPreview,\r\n        private layerManager,\r\n        private handUi,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private getInitState: () => IInitState,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx,\r\n        private setCurrentLayerCtx,\r\n        private getCurrentBrush,\r\n    ) { }\r\n\r\n    undo (): boolean {\r\n        if (!this.ignoreTest()) {\r\n            return false;\r\n        }\r\n\r\n        if (!klHistory.canUndo()) { // || workspace.isPainting()) {\r\n            return false;\r\n        }\r\n        const actions: IHistoryEntry[] = klHistory.undo();\r\n        klHistory.pause(true);\r\n        const initState: IInitState = this.getInitState();\r\n        const oldSize = {w: this.getKlCanvas().getWidth(), h: this.getKlCanvas().getHeight()};\r\n        this.getKlCanvas().copy(initState.canvas);\r\n        let layerIndex = initState.focus;\r\n        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\r\n        const brushes: any = {};\r\n        for (let b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\r\n        for (let i = 0; i < actions.length; i++) {\r\n            ((i) => {\r\n                if (actions[i].tool[0] === \"brush\") {\r\n                    const b = brushes[actions[i].tool[1]];\r\n                    if (actions[i].actions) {\r\n                        for (let e = 0; e < actions[i].actions.length; e++) {\r\n                            const p = actions[i].actions[e].params;\r\n                            b[actions[i].actions[e].action].apply(b, p);\r\n                        }\r\n                    } else {\r\n                        const p = actions[i].params;\r\n                        b[actions[i].action].apply(b, p);\r\n                    }\r\n                } else if (actions[i].tool[0] === \"canvas\") {\r\n                    const p = actions[i].params;\r\n                    const id = this.getKlCanvas()[actions[i].action].apply(this.getKlCanvas(), p);\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"filter\") {\r\n                    const p = [{\r\n                        context: this.getCurrentLayerCtx(),\r\n                        canvas: this.getKlCanvas(),\r\n                        input: actions[i].params[0].input,\r\n                        history: new KL.DecoyKlHistory(),\r\n                    } as IFilterApply];\r\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\r\n\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\r\n                    layerIndex = actions[i].params[0];\r\n                    this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(actions[i].params[0]));\r\n                    for (let b in brushes) {\r\n                        if (brushes.hasOwnProperty(b)) {\r\n                            brushes[b].setContext(this.getCurrentLayerCtx());\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\r\n                    const id = this.getKlCanvas().addLayer();\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        if (actions[i].params[1]) {\r\n                            this.getKlCanvas().renameLayer(layerIndex, actions[i].params[1]);\r\n                        }\r\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\r\n                }\r\n            })(i);\r\n        }\r\n        if (oldSize.w !== this.getKlCanvas().getWidth() || oldSize.h !== this.getKlCanvas().getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        this.layerManager.update(layerIndex);\r\n        this.layerPreview.setLayer(this.getKlCanvas().getLayer(layerIndex));\r\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n\r\n        klHistory.pause(false);\r\n        return true;\r\n    }\r\n\r\n    redo (): boolean {\r\n        if (!this.ignoreTest()) {\r\n            return false;\r\n        }\r\n\r\n        if (!klHistory.canRedo()) {\r\n            return false;\r\n        }\r\n        const actions = klHistory.redo();\r\n        klHistory.pause(true);\r\n        const oldSize = {w: this.getKlCanvas().getWidth(), h: this.getKlCanvas().getHeight()};\r\n        let layerIndex;\r\n        const brushes: any = {};\r\n        for (let b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(this.brushUiObj.sketchyBrush.getSeed());\r\n        for (let i = 0; i < actions.length; i++) {\r\n            ((i) => {\r\n                if (actions[i].tool[0] === \"brush\") {\r\n                    const b = brushes[actions[i].tool[1]];\r\n                    if (actions[i].actions) {\r\n                        for (let e = 0; e < actions[i].actions.length; e++) {\r\n                            const p = actions[i].actions[e].params;\r\n                            b[actions[i].actions[e].action].apply(b, p);\r\n                        }\r\n                    } else {\r\n                        const p = actions[i].params;\r\n                        b[actions[i].action].apply(b, p);\r\n                    }\r\n                } else if (actions[i].tool[0] === \"canvas\") {\r\n                    const p = actions[i].params;\r\n                    const id = this.getKlCanvas()[actions[i].action].apply(this.getKlCanvas(), p);\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"filter\") {\r\n                    const p = [{\r\n                        context: this.getCurrentLayerCtx(),\r\n                        canvas: this.getKlCanvas(),\r\n                        input: actions[i].params[0].input,\r\n                        history: new KL.DecoyKlHistory(),\r\n                    } as IFilterApply];\r\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\r\n\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\r\n                    layerIndex = actions[i].params[0];\r\n                    this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(actions[i].params[0]));\r\n                    for (let b in brushes) {\r\n                        if (brushes.hasOwnProperty(b)) {\r\n                            brushes[b].setContext(this.getCurrentLayerCtx());\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\r\n                    const id = this.getKlCanvas().addLayer();\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        if (actions[i].params[1]) {\r\n                            this.getKlCanvas().renameLayer(layerIndex, actions[i].params[1]);\r\n                        }\r\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\r\n                }\r\n            })(i);\r\n        }\r\n\r\n        if (oldSize.w !== this.getKlCanvas().getWidth() || oldSize.h !== this.getKlCanvas().getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        const currentLayerIndex = this.getKlCanvas().getLayerIndex(this.getCurrentLayerCtx().canvas);\r\n        this.layerManager.update(currentLayerIndex);\r\n        this.layerPreview.setLayer(this.getKlCanvas().getLayer(currentLayerIndex));\r\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n        klHistory.pause(false);\r\n\r\n        return true;\r\n    }\r\n\r\n    catchup (logParam: IHistoryBroadcast | null): void {\r\n        // const start = performance.now();\r\n        //play catch up (the version that is a few steps behind)\r\n        if (logParam && logParam.bufferUpdate) {\r\n            const initState: IInitState = this.getInitState();\r\n\r\n            const brushes = initState.brushes;\r\n            const actions = [logParam.bufferUpdate];\r\n            let localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\r\n            const canvas = initState.canvas;\r\n            let layerIndex = initState.focus;\r\n            ((i) => {\r\n                if (actions[i].tool[0] === \"brush\") {\r\n                    let b = brushes[actions[i].tool[1]];\r\n                    if (actions[i].actions) {\r\n                        for (let e = 0; e < actions[i].actions.length; e++) {\r\n                            const p = actions[i].actions[e].params;\r\n                            b[actions[i].actions[e].action].apply(b, p);\r\n                        }\r\n                    } else {\r\n                        const p = actions[i].params;\r\n                        b[actions[i].action].apply(b, p);\r\n                    }\r\n                } else if (actions[i].tool[0] === \"canvas\") {\r\n                    const p = actions[i].params;\r\n                    const id = canvas[actions[i].action].apply(canvas, p);\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        localCurrentLayerCtx = canvas.getLayerContext(layerIndex);\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(localCurrentLayerCtx);\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"filter\") {\r\n                    const p = [{\r\n                        context: localCurrentLayerCtx,\r\n                        canvas: canvas,\r\n                        input: actions[i].params[0].input,\r\n                        history: new KL.DecoyKlHistory(),\r\n                    } as IFilterApply];\r\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\r\n\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\r\n                    layerIndex = actions[i].params[0];\r\n                    localCurrentLayerCtx = canvas.getLayerContext(actions[i].params[0]);\r\n                    for (let b in brushes) {\r\n                        if (brushes.hasOwnProperty(b)) {\r\n                            brushes[b].setContext(localCurrentLayerCtx);\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\r\n                    const id = canvas.addLayer();\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        if (actions[i].params[1]) {\r\n                            this.getKlCanvas().renameLayer(layerIndex, actions[i].params[1]);\r\n                        }\r\n                        localCurrentLayerCtx = canvas.getLayerContext(layerIndex);\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(localCurrentLayerCtx);\r\n                            }\r\n                        }\r\n                    }\r\n                    localCurrentLayerCtx.drawImage(actions[i].params[0], 0, 0);\r\n                }\r\n            })(0);\r\n            initState.focus = layerIndex;\r\n        }\r\n        // console.log('catchup', performance.now() - start);\r\n    }\r\n\r\n\r\n}","import {IRGB, ISliderConfig} from '../kl.types';\r\n\r\nexport type TBrushSettingEmit = { type: 'color'; value: IRGB } |\r\n    { type: 'opacity'; value: number } |\r\n    { type: 'size'; value: number } |\r\n    { type: 'sliderConfig'; value: ISliderConfig };\r\n\r\nexport type TBrushSettingSubscriber = (p : TBrushSettingEmit) => void;\r\n\r\n/**\r\n * Central place to update brush settings, and to subscribe to changes.\r\n */\r\nexport class BrushSettingService {\r\n\r\n    private static instance: BrushSettingService;\r\n    subscriberArr: TBrushSettingSubscriber[] = [];\r\n\r\n    private emit (obj: TBrushSettingEmit, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (this.subscriberArr[i] === skipSubscriber) {\r\n                continue;\r\n            }\r\n            this.subscriberArr[i](obj);\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        private onSetColor: (rgb: IRGB) => void,\r\n        private onSetSize: (size: number) => void,\r\n        private onSetOpacity: (opacity: number) => void,\r\n        private onGetColor: () => IRGB,\r\n        private onGetSize: () => number,\r\n        private onGetOpacity: () => number,\r\n        private onGetSliderConfig: () => ISliderConfig,\r\n    ) {\r\n        if (BrushSettingService.instance) {\r\n            throw new Error('BrushSettingService already instantiated');\r\n        }\r\n        BrushSettingService.instance = this;\r\n    }\r\n\r\n    emitColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'color',\r\n                value: color\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSize (size: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'size',\r\n                value: size\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'opacity',\r\n                value: opacity\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSliderConfig (sliderConfig: ISliderConfig, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.emit(\r\n            {\r\n                type: 'sliderConfig',\r\n                value: sliderConfig\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    /**\r\n     * set current brush color\r\n     * @param color\r\n     * @param skipSubscriber\r\n     */\r\n    setColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetColor(color);\r\n        this.emitColor(color, skipSubscriber);\r\n    }\r\n\r\n    /**\r\n     * set current brush size\r\n     * @param size\r\n     * @param skipSubscriber\r\n     */\r\n    setSize (size: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetSize(size);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * set current opacity\r\n     * @param opacity\r\n     * @param skipSubscriber\r\n     */\r\n    setOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetOpacity(opacity);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * get current brush color\r\n     */\r\n    getColor (): IRGB {\r\n        return this.onGetColor();\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.onGetSize();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.onGetOpacity();\r\n    }\r\n\r\n    getSliderConfig (): ISliderConfig {\r\n        return this.onGetSliderConfig();\r\n    }\r\n\r\n    /**\r\n     * subscribe to changes\r\n     * @param func\r\n     */\r\n    subscribe (func: TBrushSettingSubscriber): void {\r\n        if (this.subscriberArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.subscriberArr.push(func);\r\n    }\r\n\r\n    unsubscribe (func: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (func === this.subscriberArr[i]) {\r\n                this.subscriberArr.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG, languageStrings, LS_LANGUAGE_KEY} from '../../../language/language';\r\nimport {KL} from '../../kl';\r\nimport {languages} from '../../../../languages/languages';\r\nimport {Popup} from '../modals/popup';\r\n// @ts-ignore\r\nimport bitbofLogoImg from 'url:~/src/app/img/bitbof-logo.svg';\r\n// @ts-ignore\r\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\r\n// @ts-ignore\r\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\r\nimport {LocalStorage} from '../../../bb/base/local-storage';\r\n\r\nexport class SettingsTab {\r\n\r\n    private el: HTMLElement;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        onLeftRight: () => void,\r\n        customAbout?: HTMLElement,\r\n    ) {\r\n\r\n\r\n\r\n\r\n        // ---- language ----\r\n        const language = languageStrings.getLanguage();\r\n\r\n        this.el = BB.el({\r\n            content: `\r\n${LANG('settings-language')}: ${language.name} (${language.code})\r\n            `,\r\n            css: {\r\n                margin: '10px',\r\n            }\r\n        });\r\n\r\n        const preferredLanguageRow = BB.el({\r\n            content: LANG('settings-preferred-language') + ':<br>',\r\n            css: {\r\n                marginTop: '10px',\r\n            }\r\n        });\r\n        const options: [string, string][] = [\r\n            ['auto', LANG('auto')] as [string, string]\r\n        ].concat(\r\n            languages.map(item => {\r\n                return [item.code, item.name + ` (${item.code})`];\r\n            })\r\n        );\r\n        const languageSelect = new KL.Select({\r\n            initValue: LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto',\r\n            optionArr: options,\r\n            onChange: (val) => {\r\n                if (val === 'auto') {\r\n                    LocalStorage.removeItem(LS_LANGUAGE_KEY);\r\n                } else {\r\n                    LocalStorage.setItem(LS_LANGUAGE_KEY, val);\r\n                }\r\n                languageHint.style.display = 'block';\r\n            },\r\n        });\r\n        const languageHint = BB.el({\r\n            content: LANG('settings-language-reload'),\r\n            css: {\r\n                display: 'none',\r\n                marginTop: '5px',\r\n            }\r\n        });\r\n\r\n        preferredLanguageRow.append(\r\n            languageSelect.getElement(),\r\n            languageHint,\r\n        );\r\n\r\n        this.el.append(preferredLanguageRow);\r\n\r\n        // ---- flip ui ----\r\n        BB.el({\r\n            tagName: 'button',\r\n            parent: this.el,\r\n            content: '<img height=\"20\" width=\"18\" src=\"' + uiSwapImg + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + LANG('switch-ui-left-right'),\r\n            onClick: () => onLeftRight(),\r\n            css: {\r\n                marginTop: '20px',\r\n            },\r\n            custom: {\r\n                tabIndex: '-1',\r\n            }\r\n        });\r\n\r\n\r\n        // ---- about ----\r\n        this.el.append(BB.el({className: 'gridHr', css: {margin: '10px 0'}}));\r\n\r\n        function makeLicenses() {\r\n            return BB.el({\r\n                tagName: 'a',\r\n                content: LANG('licenses'),\r\n                onClick: () => {\r\n                    import('./licenses').then(result => {\r\n                        new Popup({\r\n                            title: BB.el({\r\n                                content: LANG('licenses'),\r\n                            }),\r\n                            content: BB.el({\r\n                                content: BB.el({\r\n                                    content: result.licenses.replace(/\\n/g, '<br>'),\r\n                                    css: {\r\n                                        padding: '20px',\r\n                                    }\r\n                                }),\r\n                                css: {\r\n                                    height: '100%',\r\n                                    overflowY: 'scroll',\r\n                                }\r\n                            }),\r\n                            width: 800,\r\n                            isMaxHeight: true,\r\n                        });\r\n                    });\r\n                },\r\n            });\r\n        }\r\n\r\n        if (customAbout) {\r\n            this.el.append(customAbout);\r\n            if (!customAbout.innerHTML) {\r\n                const minimalAbout = BB.el({\r\n                    parent: customAbout,\r\n                    css: {\r\n                       textAlign: 'center',\r\n                   }\r\n                });\r\n                minimalAbout.append(\r\n                    BB.el({\r\n                        content: `<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2022<br>`,\r\n                    }),\r\n                    makeLicenses(),\r\n                );\r\n            }\r\n        } else {\r\n            const versionEl = BB.el({\r\n                parent: this.el,\r\n                css: {\r\n                    textAlign: 'center',\r\n                },\r\n                content: `\r\n<img alt=\"Klecks\" height=\"25\" src=\"${klecksLogoImg}\"><br>\r\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2022<br>`\r\n            });\r\n\r\n            versionEl.append(\r\n                makeLicenses(),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('donate'),\r\n                    custom: {\r\n                        href: 'https://kleki.com/donate/',\r\n                        target: '_blank',\r\n                    }\r\n                }),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('source-code'),\r\n                    custom: {\r\n                        href: 'https://klecks.org',\r\n                        target: '_blank',\r\n                    }\r\n                }),\r\n            );\r\n\r\n\r\n        }\r\n\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== LS_LANGUAGE_KEY) {\r\n                return;\r\n            }\r\n            languageSelect.setValue(\r\n                LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'\r\n            );\r\n        });\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kSWIa\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"4FMUg\");","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"79hnx\"))).then(() => parcelRequire('jNQF2'));","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport caretImg from 'url:~/src/app/img/ui/caret-down.svg';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\nimport {LANG} from '../../../language/language';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n\r\n/**\r\n * Scroll buttons at the top and bottom of toolspace\r\n * Show up when window is very small.\r\n * Allow user to scroll up and down toolspace.\r\n */\r\nexport class ToolspaceScroller {\r\n\r\n    private toolspace: HTMLElement;\r\n    private upBtn: HTMLElement;\r\n    private downBtn: HTMLElement;\r\n    private downInterval: any;\r\n    private upInterval: any;\r\n\r\n    private update(): void {\r\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) { // small buffer where it's not worth it\r\n            if (!this.upInterval) {\r\n                this.upBtn.style.display = this.toolspace.scrollTop === 0 ? 'none' : 'block';\r\n            }\r\n            if (!this.downInterval) {\r\n                this.downBtn.style.display = (\r\n                    this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ?\r\n                        'none' : 'block'\r\n                );\r\n            }\r\n        } else {\r\n            this.upBtn.style.display = 'none';\r\n            this.downBtn.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n    constructor(p: {toolspace: HTMLElement, uiState: 'left' | 'right'}) {\r\n        this.toolspace = p.toolspace;\r\n        this.upBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                top: '0',\r\n                transform: 'rotate(180deg)',\r\n            }\r\n        });\r\n        this.downBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                bottom: '0',\r\n            }\r\n        });\r\n        this.updateUiState(p.uiState);\r\n\r\n        const upListener = new BB.PointerListener({\r\n            target: this.upBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.upInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, -13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.upInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.upInterval = null;\r\n                        this.update()\r\n                    }, 50);\r\n                }\r\n            },\r\n        });\r\n        const downListener = new BB.PointerListener({\r\n            target: this.downBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.downInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, 13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.downInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.downInterval = null;\r\n                        this.update()\r\n                    }, 50);\r\n                }\r\n            }\r\n        });\r\n\r\n        const wheelListener = (e: WheelEvent) => {\r\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\r\n            this.update();\r\n        };\r\n        this.upBtn.addEventListener('wheel', wheelListener);\r\n        this.downBtn.addEventListener('wheel', wheelListener);\r\n\r\n        this.update();\r\n\r\n        const observer = new MutationObserver(() => this.update());\r\n        observer.observe(\r\n            this.toolspace,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n        window.addEventListener('resize', () => this.update());\r\n\r\n        // hide if in dialog because that can have its own scrollbar\r\n        dialogCounter.subscribe((v) => {\r\n            // ignores the 0.5 by tool dropdown\r\n            this.upBtn.style.opacity = v >= 1 ? '0' : '';\r\n            this.downBtn.style.opacity = v >= 1 ? '0' : '';\r\n        });\r\n    }\r\n\r\n    updateUiState (uiState: 'left' | 'right'): void {\r\n        BB.css(this.upBtn, {\r\n            left: uiState === 'left' ? '0' : null,\r\n            right: uiState === 'right' ? '0' : null,\r\n        });\r\n        BB.css(this.downBtn, {\r\n            left: uiState === 'left' ? '0' : null,\r\n            right: uiState === 'right' ? '0' : null,\r\n        });\r\n    }\r\n}","/**\r\n * Topmost row of buttons in toolspace\r\n *\r\n * p = { // button click callbacks\r\n *     onSubmit: function(),\r\n *     onLeftRight: function(),\r\n *     onHelp: function()\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nimport {BB} from \"../bb/bb\";\r\n// @ts-ignore\r\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\r\n// @ts-ignore\r\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\r\nimport {LANG} from '../language/language';\r\n\r\nexport class ToolspaceTopRow {\r\n    el: HTMLDivElement;\r\n\r\n    constructor(p: {onSubmit: () => void, onLeftRight: () => void, onHelp: () => void}) {\r\n        let div = document.createElement('div');\r\n        this.el = div;\r\n        BB.css(div, {\r\n            height: '36px',\r\n            //background: '#f00',\r\n            display: 'flex',\r\n            backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n        });\r\n\r\n        function createButton(p) {\r\n            let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n            let result = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.content ? '' : (p.contain ? padding + 'px 0' : ''),\r\n                }\r\n            });\r\n            if (p.content) {\r\n                result.appendChild(p.content);\r\n            } else {\r\n                let im = BB.el({\r\n                    css: {\r\n                        backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                        backgroundRepeat: 'no-repeat',\r\n                        backgroundPosition: 'center',\r\n                        backgroundSize: p.contain ? 'contain' : '',\r\n                        //filter: 'grayscale(1)',\r\n                        height: '100%'\r\n                    }\r\n                });\r\n                im.style.pointerEvents = 'none';\r\n                result.appendChild(im);\r\n            }\r\n            (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: result,\r\n                onEnterLeave: function(isOver) {\r\n                    if (isOver) {\r\n                        BB.addClassName(result, 'toolspace-row-button-hover');\r\n                    } else {\r\n                        BB.removeClassName(result, 'toolspace-row-button-hover');\r\n                    }\r\n                }\r\n            });\r\n            return result;\r\n        }\r\n\r\n        let submitButton = createButton({\r\n            onClick: p.onSubmit,\r\n            title: LANG('submit-title'),\r\n            content: BB.el({\r\n                content: LANG('submit'),\r\n                className: 'toolspace-row-button__submit',\r\n                css: {\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    width: '100%',\r\n                    height: '100%'\r\n                }\r\n            }),\r\n            contain: true\r\n        });\r\n        submitButton.style.width = '45px';\r\n\r\n        let helpButton = createButton({\r\n            onClick: p.onHelp,\r\n            title: LANG('help'),\r\n            image: helpImg,\r\n            contain: true\r\n        });\r\n\r\n        let leftRightButton = createButton({\r\n            onClick: p.onLeftRight,\r\n            title: LANG('switch-ui-left-right'),\r\n            image: uiSwapImg,\r\n            contain: true\r\n        });\r\n\r\n        div.appendChild(submitButton);\r\n        div.appendChild(leftRightButton);\r\n        div.appendChild(helpButton);\r\n    }\r\n\r\n    getElement() {\r\n        return this.el;\r\n    }\r\n}\r\n","import {filterLib, filterLibStatus} from './filters';\r\nimport {glBrightnessContrast} from './gl-brightness-contrast';\r\nimport {cropExtend} from './crop-extend';\r\nimport {glCurves} from './gl-curves';\r\nimport {flip} from './flip';\r\nimport {glHueSaturation} from './gl-hue-saturation';\r\nimport {invert} from './invert';\r\nimport {glPerspective} from './gl-perspective';\r\nimport {resize} from './resize';\r\nimport {rotate} from './rotate';\r\nimport {glTiltShift} from './gl-tilt-shift';\r\nimport {transform} from './transform';\r\nimport {glBlur} from './gl-blur';\r\nimport {glUnsharpMask} from './gl-unsharp-mask';\r\nimport {toAlpha} from './to-alpha';\r\n\r\nlet embed: boolean;\r\nfunction importFilter(libObj, moduleObj): void {\r\n    if (moduleObj.getDialog) {\r\n        libObj.getDialog = moduleObj.getDialog;\r\n    }\r\n    libObj.apply = moduleObj.apply;\r\n}\r\n\r\n\r\nexport function importFilters(isEmbed?: boolean) {\r\n    if (filterLibStatus.isLoaded) {\r\n        return;\r\n    }\r\n    embed = isEmbed\r\n\r\n    importFilter(filterLib.glBrightnessContrast, glBrightnessContrast);\r\n    importFilter(filterLib.cropExtend, cropExtend);\r\n    importFilter(filterLib.glCurves, glCurves);\r\n    importFilter(filterLib.flip, flip);\r\n    importFilter(filterLib.glHueSaturation, glHueSaturation);\r\n    importFilter(filterLib.invert, invert);\r\n    importFilter(filterLib.glPerspective, glPerspective);\r\n    importFilter(filterLib.resize, resize);\r\n    importFilter(filterLib.rotate, rotate);\r\n    importFilter(filterLib.glTiltShift, glTiltShift);\r\n    importFilter(filterLib.transform, transform);\r\n    importFilter(filterLib.glBlur, glBlur);\r\n    importFilter(filterLib.glUnsharpMask, glUnsharpMask);\r\n    importFilter(filterLib.toAlpha, toAlpha);\r\n\r\n    filterLibStatus.isLoaded = true;\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const glBrightnessContrast = {\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n\r\n        let context = params.context; //2d context of canvas\r\n        let canvas = params.canvas; //the klCanvas and dom element\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n\r\n        function finishInit() {\r\n\r\n            let brightness = 0, contrast = 0;\r\n            div.innerHTML = LANG('filter-bright-contrast-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let brightnessSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-brightness'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                initValue: (brightness + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brightness = val / 50 - 1;\r\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                }\r\n            });\r\n            let contrastSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-contrast'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                initValue: (contrast + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    contrast = val / 50 - 1;\r\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                }\r\n            });\r\n            brightnessSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(brightnessSlider.getElement());\r\n            div.appendChild(contrastSlider.getElement());\r\n\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                brightnessSlider.destroy();\r\n                contrastSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    brightness: brightness,\r\n                    contrast: contrast\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let brightness = params.input.brightness;\r\n        let contrast = params.input.contrast;\r\n        let history = params.history;\r\n        if (!context || brightness === null || contrast === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glBrightnessContrast\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n\r\n        return true;\r\n    }\r\n}","\r\nexport const eventResMs = 60;","import {fx} from '../../../script-vendor/glfx';\r\n\r\nlet fxCanvas = null\r\ntry {\r\n    fxCanvas = fx.canvas();\r\n} catch (e) {\r\n}\r\n\r\nexport function getSharedFx() {\r\n    if (!fxCanvas || fxCanvas._.gl.isContextLost()) {\r\n        try {\r\n            fxCanvas = fx.canvas();\r\n        } catch (e) {\r\n        }\r\n    }\r\n    return fxCanvas;\r\n}","/*\r\n * glfx.script\r\n * http://evanw.github.com/glfx.js/\r\n *\r\n * Copyright 2011 Evan Wallace\r\n * Released under the MIT license\r\n *\r\n * modifications by bitbof\r\n */\r\nexport const fx = (function() {\r\nlet exports: any = {};\r\n\r\n// src/OES_texture_float_linear-polyfill.script\r\n// From: https://github.com/evanw/OES_texture_float_linear-polyfill\r\n(function() {\r\n  // Uploads a 2x2 floating-point texture where one pixel is 2 and the other\r\n  // three pixels are 0. Linear filtering is only supported if a sample taken\r\n  // from the center of that texture is (2 + 0 + 0 + 0) / 4 = 0.5.\r\n  function supportsOESTextureFloatLinear(gl) {\r\n    // Need floating point textures in the first place\r\n    if (!gl.getExtension('OES_texture_float')) {\r\n      return false;\r\n    }\r\n\r\n    // Create a render target\r\n    let framebuffer = gl.createFramebuffer();\r\n    let byteTexture = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, byteTexture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, byteTexture, 0);\r\n\r\n    // Create a simple floating-point texture with value of 0.5 in the center\r\n    let rgba = [\r\n      2, 0, 0, 0,\r\n      0, 0, 0, 0,\r\n      0, 0, 0, 0,\r\n      0, 0, 0, 0\r\n    ];\r\n    let floatTexture = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, floatTexture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, gl.FLOAT, new Float32Array(rgba));\r\n\r\n    // Create the test shader\r\n    let program = gl.createProgram();\r\n    let vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n    let fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n    gl.shaderSource(vertexShader, '\\\r\n      attribute vec2 vertex;\\\r\n      void main() {\\\r\n        gl_Position = vec4(vertex, 0.0, 1.0);\\\r\n      }\\\r\n    ');\r\n    gl.shaderSource(fragmentShader, '\\\r\n      uniform sampler2D texture;\\\r\n      void main() {\\\r\n        gl_FragColor = texture2D(texture, vec2(0.5));\\\r\n      }\\\r\n    ');\r\n    gl.compileShader(vertexShader);\r\n    gl.compileShader(fragmentShader);\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n    gl.linkProgram(program);\r\n\r\n    // Create a buffer containing a single point\r\n    let buffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0]), gl.STREAM_DRAW);\r\n    gl.enableVertexAttribArray(0);\r\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\r\n\r\n    // Render the point and read back the rendered pixel\r\n    let pixel = new Uint8Array(4);\r\n    gl.useProgram(program);\r\n    gl.viewport(0, 0, 1, 1);\r\n    gl.bindTexture(gl.TEXTURE_2D, floatTexture);\r\n    gl.drawArrays(gl.POINTS, 0, 1);\r\n    gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixel);\r\n\r\n    // The center sample will only have a value of 0.5 if linear filtering works\r\n    return pixel[0] === 127 || pixel[0] === 128;\r\n  }\r\n\r\n  // The constructor for the returned extension object\r\n  function OESTextureFloatLinear() {\r\n  }\r\n\r\n  // Cache the extension so it's specific to each context like extensions should be\r\n  function getOESTextureFloatLinear(gl) {\r\n    if (gl.$OES_texture_float_linear$ === void 0) {\r\n      Object.defineProperty(gl, '$OES_texture_float_linear$', {\r\n        enumerable: false,\r\n        configurable: false,\r\n        writable: false,\r\n        value: new OESTextureFloatLinear()\r\n      });\r\n    }\r\n    return gl.$OES_texture_float_linear$;\r\n  }\r\n\r\n  // This replaces the real getExtension()\r\n  function getExtension(name) {\r\n    return name === 'OES_texture_float_linear'\r\n      ? getOESTextureFloatLinear(this)\r\n      : oldGetExtension.call(this, name);\r\n  }\r\n\r\n  // This replaces the real getSupportedExtensions()\r\n  function getSupportedExtensions() {\r\n    let extensions = oldGetSupportedExtensions.call(this);\r\n    if (extensions.indexOf('OES_texture_float_linear') === -1) {\r\n      extensions.push('OES_texture_float_linear');\r\n    }\r\n    return extensions;\r\n  }\r\n\r\n  // Get a WebGL context\r\n  try {\r\n    let gl = document.createElement('canvas').getContext('experimental-webgl');\r\n  } catch (e) {\r\n  }\r\n\r\n  // Don't install the polyfill if the browser already supports it or doesn't have WebGL\r\n  if (!gl || (gl as any).getSupportedExtensions().indexOf('OES_texture_float_linear') !== -1) {\r\n    return;\r\n  }\r\n\r\n  // Install the polyfill if linear filtering works with floating-point textures\r\n  let oldGetExtension;\r\n  let oldGetSupportedExtensions;\r\n  if (supportsOESTextureFloatLinear(gl)) {\r\n    oldGetExtension = WebGLRenderingContext.prototype.getExtension;\r\n    oldGetSupportedExtensions = WebGLRenderingContext.prototype.getSupportedExtensions;\r\n    WebGLRenderingContext.prototype.getExtension = getExtension;\r\n    WebGLRenderingContext.prototype.getSupportedExtensions = getSupportedExtensions;\r\n  }\r\n}());\r\n\r\n// src/core\\canvas.script\r\nvar gl;\r\n\r\nfunction clamp(lo, value, hi) {\r\n    return Math.max(lo, Math.min(value, hi));\r\n}\r\n\r\nfunction wrapTexture(texture) {\r\n    return {\r\n        _: texture,\r\n        loadContentsOf: function(element) {\r\n            // Make sure that we're using the correct global WebGL context\r\n            gl = this._.gl;\r\n            this._.loadContentsOf(element);\r\n        },\r\n        destroy: function() {\r\n            // Make sure that we're using the correct global WebGL context\r\n            gl = this._.gl;\r\n            this._.destroy();\r\n        }\r\n    };\r\n}\r\n\r\nfunction texture(element) {\r\n    return wrapTexture(Texture.fromElement(element));\r\n}\r\n\r\nfunction initialize(width, height) {\r\n    let type = gl.UNSIGNED_BYTE;\r\n\r\n    // Go for floating point buffer textures if we can, it'll make the bokeh\r\n    // filter look a lot better. Note that on Windows, ANGLE does not let you\r\n    // render to a floating-point texture when linear filtering is enabled.\r\n    // See http://crbug.com/172278 for more information.\r\n    if (gl.getExtension('OES_texture_float') && gl.getExtension('OES_texture_float_linear')) {\r\n        let testTexture = new Texture(100, 100, gl.RGBA, gl.FLOAT);\r\n        try {\r\n            // Only use gl.FLOAT if we can render to it\r\n            testTexture.drawTo(function() { type = gl.FLOAT; });\r\n        } catch (e) {\r\n        }\r\n        testTexture.destroy();\r\n    }\r\n\r\n    if (this._.texture) this._.texture.destroy();\r\n    if (this._.spareTexture) this._.spareTexture.destroy();\r\n    this.width = width;\r\n    this.height = height;\r\n    this._.texture = new Texture(width, height, gl.RGBA, type);\r\n    this._.spareTexture = new Texture(width, height, gl.RGBA, type);\r\n    this._.extraTexture = this._.extraTexture || new Texture(0, 0, gl.RGBA, type);\r\n    this._.flippedShader = this._.flippedShader || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\\\r\n        }\\\r\n    ', 'flippedShader');\r\n    this._.isInitialized = true;\r\n}\r\n\r\n/*\r\n   Draw a texture to the canvas, with an optional width and height to scale to.\r\n   If no width and height are given then the original texture width and height\r\n   are used.\r\n*/\r\nfunction draw(texture, width, height) {\r\n    if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\r\n        initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\r\n    }\r\n\r\n    texture._.use();\r\n    this._.texture.drawTo(function() {\r\n        Shader.getDefaultShader().drawRect();\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\nfunction update() {\r\n    this._.texture.use();\r\n    this._.flippedShader.drawRect();\r\n    return this;\r\n}\r\n\r\nfunction simpleShader(shader, uniforms, textureIn, textureOut) {\r\n    (textureIn || this._.texture).use();\r\n    this._.spareTexture.drawTo(function() {\r\n        shader.uniforms(uniforms).drawRect();\r\n    });\r\n    this._.spareTexture.swapWith(textureOut || this._.texture);\r\n}\r\n\r\nfunction replace(node) {\r\n    node.parentNode.insertBefore(this, node);\r\n    node.parentNode.removeChild(node);\r\n    return this;\r\n}\r\n\r\nfunction contents() {\r\n    let texture = new Texture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\r\n    this._.texture.use();\r\n    texture.drawTo(function() {\r\n        Shader.getDefaultShader().drawRect();\r\n    });\r\n    return wrapTexture(texture);\r\n}\r\n\r\n/*\r\n   Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\r\n   Length of the array will be width * height * 4.\r\n*/\r\nfunction getPixelArray() {\r\n    let w = this._.texture.width;\r\n    let h = this._.texture.height;\r\n    let array = new Uint8Array(w * h * 4);\r\n    this._.texture.drawTo(function() {\r\n        gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\r\n    });\r\n    return array;\r\n}\r\n\r\nfunction wrap(func) {\r\n    return function() {\r\n        // Make sure that we're using the correct global WebGL context\r\n        gl = this._.gl;\r\n\r\n        // Now that the context has been switched, we can call the wrapped function\r\n        return func.apply(this, arguments);\r\n    };\r\n}\r\n\r\nexports.canvas = function() {\r\n    let canvas: any = document.createElement('canvas');\r\n    try {\r\n        gl = canvas.getContext('experimental-webgl', { premultipliedAlpha: false });\r\n    } catch (e) {\r\n        gl = null;\r\n    }\r\n    if (!gl) {\r\n        throw 'This browser does not support WebGL';\r\n    }\r\n    canvas._ = {\r\n        gl: gl,\r\n        isInitialized: false,\r\n        texture: null,\r\n        spareTexture: null,\r\n        flippedShader: null\r\n    };\r\n\r\n    // Core methods\r\n    canvas.texture = wrap(texture);\r\n    canvas.draw = wrap(draw);\r\n    canvas.update = wrap(update);\r\n    canvas.replace = wrap(replace);\r\n    canvas.contents = wrap(contents);\r\n    canvas.getPixelArray = wrap(getPixelArray);\r\n\r\n    // Filter methods\r\n    canvas.brightnessContrast = wrap(brightnessContrast);\r\n    canvas.hexagonalPixelate = wrap(hexagonalPixelate);\r\n    canvas.hueSaturation = wrap(hueSaturation);\r\n    canvas.colorHalftone = wrap(colorHalftone);\r\n    canvas.triangleBlur = wrap(triangleBlur);\r\n    canvas.unsharpMask = wrap(unsharpMask);\r\n    canvas.perspective = wrap(perspective);\r\n    canvas.matrixWarp = wrap(matrixWarp);\r\n    canvas.bulgePinch = wrap(bulgePinch);\r\n    canvas.tiltShift = wrap(tiltShift);\r\n    canvas.dotScreen = wrap(dotScreen);\r\n    canvas.edgeWork = wrap(edgeWork);\r\n    canvas.lensBlur = wrap(lensBlur);\r\n    canvas.zoomBlur = wrap(zoomBlur);\r\n    canvas.noise = wrap(noise);\r\n    canvas.denoise = wrap(denoise);\r\n    canvas.curves = wrap(curves);\r\n    canvas.swirl = wrap(swirl);\r\n    canvas.ink = wrap(ink);\r\n    canvas.vignette = wrap(vignette);\r\n    canvas.vibrance = wrap(vibrance);\r\n    canvas.sepia = wrap(sepia);\r\n    canvas.invert = wrap(invert);\r\n    canvas.toAlpha = wrap(toAlpha);\r\n\r\n    return canvas;\r\n};\r\nexports.splineInterpolate = splineInterpolate;\r\n\r\n// src/core\\matrix.script\r\n// from javax.media.jai.PerspectiveTransform\r\n\r\nfunction getSquareToQuad(x0, y0, x1, y1, x2, y2, x3, y3) {\r\n    let dx1 = x1 - x2;\r\n    let dy1 = y1 - y2;\r\n    let dx2 = x3 - x2;\r\n    let dy2 = y3 - y2;\r\n    let dx3 = x0 - x1 + x2 - x3;\r\n    let dy3 = y0 - y1 + y2 - y3;\r\n    let det = dx1*dy2 - dx2*dy1;\r\n    let a = (dx3*dy2 - dx2*dy3) / det;\r\n    let b = (dx1*dy3 - dx3*dy1) / det;\r\n    return [\r\n        x1 - x0 + a*x1, y1 - y0 + a*y1, a,\r\n        x3 - x0 + b*x3, y3 - y0 + b*y3, b,\r\n        x0, y0, 1\r\n    ];\r\n}\r\n\r\nfunction getInverse(m) {\r\n    let a = m[0], b = m[1], c = m[2];\r\n    let d = m[3], e = m[4], f = m[5];\r\n    let g = m[6], h = m[7], i = m[8];\r\n    let det = a*e*i - a*f*h - b*d*i + b*f*g + c*d*h - c*e*g;\r\n    return [\r\n        (e*i - f*h) / det, (c*h - b*i) / det, (b*f - c*e) / det,\r\n        (f*g - d*i) / det, (a*i - c*g) / det, (c*d - a*f) / det,\r\n        (d*h - e*g) / det, (b*g - a*h) / det, (a*e - b*d) / det\r\n    ];\r\n}\r\n\r\nfunction multiply(a, b) {\r\n    return [\r\n        a[0]*b[0] + a[1]*b[3] + a[2]*b[6],\r\n        a[0]*b[1] + a[1]*b[4] + a[2]*b[7],\r\n        a[0]*b[2] + a[1]*b[5] + a[2]*b[8],\r\n        a[3]*b[0] + a[4]*b[3] + a[5]*b[6],\r\n        a[3]*b[1] + a[4]*b[4] + a[5]*b[7],\r\n        a[3]*b[2] + a[4]*b[5] + a[5]*b[8],\r\n        a[6]*b[0] + a[7]*b[3] + a[8]*b[6],\r\n        a[6]*b[1] + a[7]*b[4] + a[8]*b[7],\r\n        a[6]*b[2] + a[7]*b[5] + a[8]*b[8]\r\n    ];\r\n}\r\n\r\n// src/core\\shader.script\r\nvar Shader = (function() {\r\n    function isArray(obj) {\r\n        return Object.prototype.toString.call(obj) == '[object Array]';\r\n    }\r\n\r\n    function isNumber(obj) {\r\n        return Object.prototype.toString.call(obj) == '[object Number]';\r\n    }\r\n\r\n    function compileSource(type, source, nameStr) {\r\n        let shader = gl.createShader(type);\r\n        gl.shaderSource(shader, source);\r\n        gl.compileShader(shader);\r\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n            throw 'compile error: ' + nameStr + ' - ' + gl.getShaderInfoLog(shader);\r\n        }\r\n        return shader;\r\n    }\r\n\r\n    let defaultVertexSource = '\\\r\n    attribute vec2 vertex;\\\r\n    attribute vec2 _texCoord;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        texCoord = _texCoord;\\\r\n        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\r\n    }';\r\n\r\n    let defaultFragmentSource = '\\\r\n    uniform sampler2D texture;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        gl_FragColor = texture2D(texture, texCoord);\\\r\n    }';\r\n\r\n    // added test 2020-04-27 bitbof\r\n    let floatPrecision = null;\r\n    function testPrecisionSupport(precisionType) {\r\n        let format = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, precisionType);\r\n        return format !== null && format.precision !== 0;\r\n    }\r\n\r\n    function Shader(vertexSource?, fragmentSource?, nameStr?) {\r\n        this.vertexAttribute = null;\r\n        this.texCoordAttribute = null;\r\n        this.program = gl.createProgram();\r\n        vertexSource = vertexSource || defaultVertexSource;\r\n        fragmentSource = fragmentSource || defaultFragmentSource;\r\n        if (floatPrecision === null) {\r\n            floatPrecision = testPrecisionSupport(gl.HIGH_FLOAT) ? 'highp' : (testPrecisionSupport(gl.MEDIUM_FLOAT) ? 'mediump' : 'lowp');\r\n        }\r\n        fragmentSource = 'precision ' + floatPrecision + ' float;' + fragmentSource; // annoying requirement is annoying\r\n        gl.attachShader(this.program, compileSource(gl.VERTEX_SHADER, vertexSource, nameStr + '(vertex)'));\r\n        gl.attachShader(this.program, compileSource(gl.FRAGMENT_SHADER, fragmentSource, nameStr + '(fragment)'));\r\n        gl.linkProgram(this.program);\r\n        if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\r\n            throw 'link error: ' + gl.getProgramInfoLog(this.program);\r\n        }\r\n    }\r\n\r\n    Shader.prototype.destroy = function() {\r\n        gl.deleteProgram(this.program);\r\n        this.program = null;\r\n    };\r\n\r\n    Shader.prototype.uniforms = function(uniforms) {\r\n        gl.useProgram(this.program);\r\n        for (var name in uniforms) {\r\n            if (!uniforms.hasOwnProperty(name)) continue;\r\n            let location = gl.getUniformLocation(this.program, name);\r\n            if (location === null) continue; // will be null if the uniform isn't used in the shader\r\n            let value = uniforms[name];\r\n            if (isArray(value)) {\r\n                switch (value.length) {\r\n                    case 1: gl.uniform1fv(location, new Float32Array(value)); break;\r\n                    case 2: gl.uniform2fv(location, new Float32Array(value)); break;\r\n                    case 3: gl.uniform3fv(location, new Float32Array(value)); break;\r\n                    case 4: gl.uniform4fv(location, new Float32Array(value)); break;\r\n                    case 9: gl.uniformMatrix3fv(location, false, new Float32Array(value)); break;\r\n                    case 16: gl.uniformMatrix4fv(location, false, new Float32Array(value)); break;\r\n                    default: throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\r\n                }\r\n            } else if (isNumber(value)) {\r\n                gl.uniform1f(location, value);\r\n            } else {\r\n                throw 'attempted to set uniform \"' + name + '\" to invalid value ' + (value || 'undefined').toString();\r\n            }\r\n        }\r\n        // allow chaining\r\n        return this;\r\n    };\r\n\r\n    // textures are uniforms too but for some reason can't be specified by gl.uniform1f,\r\n    // even though floating point numbers represent the integers 0 through 7 exactly\r\n    Shader.prototype.textures = function(textures) {\r\n        gl.useProgram(this.program);\r\n        for (var name in textures) {\r\n            if (!textures.hasOwnProperty(name)) continue;\r\n            gl.uniform1i(gl.getUniformLocation(this.program, name), textures[name]);\r\n        }\r\n        // allow chaining\r\n        return this;\r\n    };\r\n\r\n    Shader.prototype.drawRect = function(left, top, right, bottom) {\r\n        let undefined;\r\n        let viewport = gl.getParameter(gl.VIEWPORT);\r\n        top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\r\n        left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\r\n        right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\r\n        bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\r\n        if (gl.vertexBuffer == null) {\r\n            gl.vertexBuffer = gl.createBuffer();\r\n        }\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([ left, top, left, bottom, right, top, right, bottom ]), gl.STATIC_DRAW);\r\n        if (gl.texCoordBuffer == null) {\r\n            gl.texCoordBuffer = gl.createBuffer();\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([ 0, 0, 0, 1, 1, 0, 1, 1 ]), gl.STATIC_DRAW);\r\n        }\r\n        if (this.vertexAttribute == null) {\r\n            this.vertexAttribute = gl.getAttribLocation(this.program, 'vertex');\r\n            gl.enableVertexAttribArray(this.vertexAttribute);\r\n        }\r\n        if (this.texCoordAttribute == null) {\r\n            this.texCoordAttribute = gl.getAttribLocation(this.program, '_texCoord');\r\n            gl.enableVertexAttribArray(this.texCoordAttribute);\r\n        }\r\n        gl.useProgram(this.program);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n        gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n        gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    };\r\n\r\n    Shader.getDefaultShader = function() {\r\n        gl.defaultShader = gl.defaultShader || new Shader();\r\n        return gl.defaultShader;\r\n    };\r\n\r\n    return Shader;\r\n})();\r\n\r\n// src/core\\spline.script\r\n// from SplineInterpolator.cs in the Paint.NET source code\r\n\r\nfunction SplineInterpolator(points) {\r\n    let n = points.length;\r\n    this.xa = [];\r\n    this.ya = [];\r\n    this.u = [];\r\n    this.y2 = [];\r\n\r\n    points.sort(function(a, b) {\r\n        return a[0] - b[0];\r\n    });\r\n    for (var i = 0; i < n; i++) {\r\n        this.xa.push(points[i][0]);\r\n        this.ya.push(points[i][1]);\r\n    }\r\n\r\n    this.u[0] = 0;\r\n    this.y2[0] = 0;\r\n\r\n    for (var i = 1; i < n - 1; ++i) {\r\n        // This is the decomposition loop of the tridiagonal algorithm. \r\n        // y2 and u are used for temporary storage of the decomposed factors.\r\n        let wx = this.xa[i + 1] - this.xa[i - 1];\r\n        let sig = (this.xa[i] - this.xa[i - 1]) / wx;\r\n        let p = sig * this.y2[i - 1] + 2.0;\r\n\r\n        this.y2[i] = (sig - 1.0) / p;\r\n\r\n        let ddydx = \r\n            (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) - \r\n            (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\r\n\r\n        this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\r\n    }\r\n\r\n    this.y2[n - 1] = 0;\r\n\r\n    // This is the backsubstitution loop of the tridiagonal algorithm\r\n    for (var i = n - 2; i >= 0; --i) {\r\n        this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\r\n    }\r\n}\r\n\r\nSplineInterpolator.prototype.interpolate = function(x) {\r\n    let n = this.ya.length;\r\n    let klo = 0;\r\n    let khi = n - 1;\r\n\r\n    // We will find the right place in the table by means of\r\n    // bisection. This is optimal if sequential calls to this\r\n    // routine are at random values of x. If sequential calls\r\n    // are in order, and closely spaced, one would do better\r\n    // to store previous values of klo and khi.\r\n    while (khi - klo > 1) {\r\n        let k = (khi + klo) >> 1;\r\n\r\n        if (this.xa[k] > x) {\r\n            khi = k; \r\n        } else {\r\n            klo = k;\r\n        }\r\n    }\r\n\r\n    let h = this.xa[khi] - this.xa[klo];\r\n    let a = (this.xa[khi] - x) / h;\r\n    let b = (x - this.xa[klo]) / h;\r\n\r\n    // Cubic spline polynomial is now evaluated.\r\n    return a * this.ya[klo] + b * this.ya[khi] + \r\n        ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\r\n};\r\n\r\n// src/core\\texture.script\r\nvar Texture = (function() {\r\n    Texture.fromElement = function(element) {\r\n        let texture = new Texture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\r\n        texture.loadContentsOf(element);\r\n        return texture;\r\n    };\r\n\r\n    function Texture(width, height, format, type) {\r\n        this.gl = gl;\r\n        this.id = gl.createTexture();\r\n        this.width = width;\r\n        this.height = height;\r\n        this.format = format;\r\n        this.type = type;\r\n\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        if (width && height) gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n    }\r\n\r\n    Texture.prototype.loadContentsOf = function(element) {\r\n        this.width = element.width || element.videoWidth;\r\n        this.height = element.height || element.videoHeight;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\r\n    };\r\n\r\n    Texture.prototype.initFromBytes = function(width, height, data) {\r\n        this.width = width;\r\n        this.height = height;\r\n        this.format = gl.RGBA;\r\n        this.type = gl.UNSIGNED_BYTE;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\r\n    };\r\n\r\n    Texture.prototype.destroy = function() {\r\n        gl.deleteTexture(this.id);\r\n        this.id = null;\r\n    };\r\n\r\n    Texture.prototype.use = function(unit) {\r\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n    };\r\n\r\n    Texture.prototype.unuse = function(unit) {\r\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n        gl.bindTexture(gl.TEXTURE_2D, null);\r\n    };\r\n\r\n    Texture.prototype.ensureFormat = function(width, height, format, type) {\r\n        // allow passing an existing texture instead of individual arguments\r\n        if (arguments.length == 1) {\r\n            let texture = arguments[0];\r\n            width = texture.width;\r\n            height = texture.height;\r\n            format = texture.format;\r\n            type = texture.type;\r\n        }\r\n\r\n        // change the format only if required\r\n        if (width != this.width || height != this.height || format != this.format || type != this.type) {\r\n            this.width = width;\r\n            this.height = height;\r\n            this.format = format;\r\n            this.type = type;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n        }\r\n    };\r\n\r\n    Texture.prototype.drawTo = function(callback) {\r\n        // start rendering to this texture\r\n        gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\r\n        if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\r\n            throw new Error('incomplete framebuffer');\r\n        }\r\n        gl.viewport(0, 0, this.width, this.height);\r\n\r\n        // do the drawing\r\n        callback();\r\n\r\n        // stop rendering to this texture\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    };\r\n\r\n    let canvas = null;\r\n\r\n    function getCanvas(texture) {\r\n        if (canvas == null) canvas = document.createElement('canvas');\r\n        canvas.width = texture.width;\r\n        canvas.height = texture.height;\r\n        let c = canvas.getContext('2d');\r\n        c.clearRect(0, 0, canvas.width, canvas.height);\r\n        return c;\r\n    }\r\n\r\n    Texture.prototype.fillUsingCanvas = function(callback) {\r\n        callback(getCanvas(this));\r\n        this.format = gl.RGBA;\r\n        this.type = gl.UNSIGNED_BYTE;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, canvas);\r\n        return this;\r\n    };\r\n\r\n    Texture.prototype.toImage = function(image) {\r\n        this.use();\r\n        Shader.getDefaultShader().drawRect();\r\n        let size = this.width * this.height * 4;\r\n        let pixels = new Uint8Array(size);\r\n        let c = getCanvas(this);\r\n        let data = c.createImageData(this.width, this.height);\r\n        gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n        for (var i = 0; i < size; i++) {\r\n            data.data[i] = pixels[i];\r\n        }\r\n        c.putImageData(data, 0, 0);\r\n        image.src = canvas.toDataURL();\r\n    };\r\n\r\n    Texture.prototype.swapWith = function(other) {\r\n        let temp;\r\n        temp = other.id; other.id = this.id; this.id = temp;\r\n        temp = other.width; other.width = this.width; this.width = temp;\r\n        temp = other.height; other.height = this.height; this.height = temp;\r\n        temp = other.format; other.format = this.format; this.format = temp;\r\n    };\r\n\r\n    return Texture;\r\n})();\r\n\r\n// src/filters\\common.script\r\nfunction warpShader(uniforms, warp) {\r\n    return new Shader(null, uniforms + '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        vec2 coord = texCoord * texSize;\\\r\n        ' + warp + '\\\r\n        gl_FragColor = texture2D(texture, coord / texSize);\\\r\n        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\r\n        if (coord != clampedCoord) {\\\r\n            /* fade to transparent if we are outside the image */\\\r\n            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\r\n        }\\\r\n    }', 'warp');\r\n}\r\n\r\n// returns a random number between 0 and 1\r\nvar randomShaderFunc = '\\\r\n    float random(vec3 scale, float seed) {\\\r\n        /* use the fragment position for a different seed per-pixel */\\\r\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\r\n    }\\\r\n';\r\n\r\n// src/filters\\adjust\\brightnesscontrast.script\r\n/**\r\n * @filter           Brightness / Contrast\r\n * @description      Provides additive brightness and multiplicative contrast control.\r\n * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\r\n * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n */\r\nfunction brightnessContrast(brightness, contrast) {\r\n    gl.brightnessContrast = gl.brightnessContrast || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float brightness;\\\r\n        uniform float contrast;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.rgb += brightness;\\\r\n            if (contrast > 0.0) {\\\r\n                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\r\n            } else {\\\r\n                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\r\n            }\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'brightnessContrast');\r\n\r\n    simpleShader.call(this, gl.brightnessContrast, {\r\n        brightness: clamp(-1, brightness, 1),\r\n        contrast: clamp(-1, contrast, 1)\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\curves.script\r\nfunction splineInterpolate(points) {\r\n    let interpolator = new SplineInterpolator(points);\r\n    let array = [];\r\n    for (var i = 0; i < 256; i++) {\r\n        array.push(clamp(0, Math.floor(interpolator.interpolate(i / 255) * 256), 255));\r\n    }\r\n    return array;\r\n}\r\n\r\n/**\r\n * @filter      Curves\r\n * @description A powerful mapping tool that transforms the colors in the image\r\n *              by an arbitrary function. The function is interpolated between\r\n *              a set of 2D points using splines. The curves filter can take\r\n *              either one or three arguments which will apply the mapping to\r\n *              either luminance or RGB values, respectively.\r\n * @param red   A list of points that define the function for the red channel.\r\n *              Each point is a list of two values: the value before the mapping\r\n *              and the value after the mapping, both in the range 0 to 1. For\r\n *              example, [[0,1], [1,0]] would invert the red channel while\r\n *              [[0,0], [1,1]] would leave the red channel unchanged. If green\r\n *              and blue are omitted then this argument also applies to the\r\n *              green and blue channels.\r\n * @param green (optional) A list of points that define the function for the green\r\n *              channel (just like for red).\r\n * @param blue  (optional) A list of points that define the function for the blue\r\n *              channel (just like for red).\r\n */\r\nfunction curves(red, green, blue) {\r\n    // Create the ramp texture\r\n    red = splineInterpolate(red);\r\n    if (arguments.length == 1) {\r\n        green = blue = red;\r\n    } else {\r\n        green = splineInterpolate(green);\r\n        blue = splineInterpolate(blue);\r\n    }\r\n    let array = [];\r\n    for (var i = 0; i < 256; i++) {\r\n        array.splice(array.length, 0, red[i], green[i], blue[i], 255);\r\n    }\r\n    this._.extraTexture.initFromBytes(256, 1, array);\r\n    this._.extraTexture.use(1);\r\n\r\n    gl.curves = gl.curves || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform sampler2D map;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.r = texture2D(map, vec2(color.r)).r;\\\r\n            color.g = texture2D(map, vec2(color.g)).g;\\\r\n            color.b = texture2D(map, vec2(color.b)).b;\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'curves');\r\n\r\n    gl.curves.textures({\r\n        map: 1\r\n    });\r\n    simpleShader.call(this, gl.curves, {});\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\denoise.script\r\n/**\r\n * @filter         Denoise\r\n * @description    Smooths over grainy noise in dark images using an 9x9 box filter\r\n *                 weighted by color intensity, similar to a bilateral filter.\r\n * @param exponent The exponent of the color intensity difference, should be greater\r\n *                 than zero. A value of zero just gives an 9x9 box blur and high values\r\n *                 give the original image, but ideal values are usually around 10-20.\r\n */\r\nfunction denoise(exponent) {\r\n    // Do a 9x9 bilateral box filter\r\n    gl.denoise = gl.denoise || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float exponent;\\\r\n        uniform float strength;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 center = texture2D(texture, texCoord);\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            for (float x = -4.0; x <= 4.0; x += 1.0) {\\\r\n                for (float y = -4.0; y <= 4.0; y += 1.0) {\\\r\n                    vec4 sample = texture2D(texture, texCoord + vec2(x, y) / texSize);\\\r\n                    float weight = 1.0 - abs(dot(sample.rgb - center.rgb, vec3(0.25)));\\\r\n                    weight = pow(weight, exponent);\\\r\n                    color += sample * weight;\\\r\n                    total += weight;\\\r\n                }\\\r\n            }\\\r\n            gl_FragColor = color / total;\\\r\n        }\\\r\n    ', 'denoise');\r\n\r\n    // Perform two iterations for stronger results\r\n    for (var i = 0; i < 2; i++) {\r\n        simpleShader.call(this, gl.denoise, {\r\n            exponent: Math.max(0, exponent),\r\n            texSize: [this.width, this.height]\r\n        });\r\n    }\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\huesaturation.script\r\n/**\r\n * @filter           Hue / Saturation\r\n * @description      Provides rotational hue and multiplicative saturation control. RGB color space\r\n *                   can be imagined as a cube where the axes are the red, green, and blue color\r\n *                   values. Hue changing works by rotating the color vector around the grayscale\r\n *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\r\n *                   Saturation is implemented by scaling all color channel values either toward\r\n *                   or away from the average color channel value.\r\n * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\r\n *                   and 1 is 180 degree rotation in the positive direction)\r\n * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n */\r\nfunction hueSaturation(hue, saturation) {\r\n    gl.hueSaturation = gl.hueSaturation || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float hue;\\\r\n        uniform float saturation;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\r\n            float angle = hue * 3.14159265;\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\r\n            float len = length(color.rgb);\\\r\n            color.rgb = vec3(\\\r\n                dot(color.rgb, weights.xyz),\\\r\n                dot(color.rgb, weights.zxy),\\\r\n                dot(color.rgb, weights.yzx)\\\r\n            );\\\r\n            \\\r\n            /* saturation adjustment */\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            if (saturation > 0.0) {\\\r\n                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\r\n            } else {\\\r\n                color.rgb += (average - color.rgb) * (-saturation);\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'hueSaturation');\r\n\r\n    simpleShader.call(this, gl.hueSaturation, {\r\n        hue: clamp(-1, hue, 1),\r\n        saturation: clamp(-1, saturation, 1)\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\noise.script\r\n/**\r\n * @filter         Noise\r\n * @description    Adds black and white noise to the image.\r\n * @param amount   0 to 1 (0 for no effect, 1 for maximum noise)\r\n */\r\nfunction noise(amount) {\r\n    gl.noise = gl.noise || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        float rand(vec2 co) {\\\r\n            return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\\\r\n        }\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            float diff = (rand(texCoord) - 0.5) * amount;\\\r\n            color.r += diff;\\\r\n            color.g += diff;\\\r\n            color.b += diff;\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'noise');\r\n\r\n    simpleShader.call(this, gl.noise, {\r\n        amount: clamp(0, amount, 1)\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\sepia.script\r\n/**\r\n * @filter         Sepia\r\n * @description    Gives the image a reddish-brown monochrome tint that imitates an old photograph.\r\n * @param amount   0 to 1 (0 for no effect, 1 for full sepia coloring)\r\n */\r\nfunction sepia(amount) {\r\n    gl.sepia = gl.sepia || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float r = color.r;\\\r\n            float g = color.g;\\\r\n            float b = color.b;\\\r\n            \\\r\n            color.r = min(1.0, (r * (1.0 - (0.607 * amount))) + (g * (0.769 * amount)) + (b * (0.189 * amount)));\\\r\n            color.g = min(1.0, (r * 0.349 * amount) + (g * (1.0 - (0.314 * amount))) + (b * 0.168 * amount));\\\r\n            color.b = min(1.0, (r * 0.272 * amount) + (g * 0.534 * amount) + (b * (1.0 - (0.869 * amount))));\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'sepia');\r\n\r\n    simpleShader.call(this, gl.sepia, {\r\n        amount: clamp(0, amount, 1)\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\unsharpmask.script\r\n/**\r\n * @filter         Unsharp Mask\r\n * @description    A form of image sharpening that amplifies high-frequencies in the image. It\r\n *                 is implemented by scaling pixels away from the average of their neighbors.\r\n * @param radius   The blur radius that calculates the average of the neighboring pixels.\r\n * @param strength A scale factor where 0 is no effect and higher values cause a stronger effect.\r\n */\r\nfunction unsharpMask(radius, strength) {\r\n    gl.unsharpMask = gl.unsharpMask || new Shader(null, '\\\r\n        uniform sampler2D blurredTexture;\\\r\n        uniform sampler2D originalTexture;\\\r\n        uniform float strength;\\\r\n        uniform float threshold;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 blurred = texture2D(blurredTexture, texCoord);\\\r\n            vec4 original = texture2D(originalTexture, texCoord);\\\r\n            gl_FragColor = mix(blurred, original, 1.0 + strength);\\\r\n        }\\\r\n    ', 'unsharpMask');\r\n\r\n    // Store a copy of the current texture in the second texture unit\r\n    this._.extraTexture.ensureFormat(this._.texture);\r\n    this._.texture.use();\r\n    this._.extraTexture.drawTo(function() {\r\n        Shader.getDefaultShader().drawRect();\r\n    });\r\n\r\n    // Blur the current texture, then use the stored texture to detect edges\r\n    this._.extraTexture.use(1);\r\n    this.triangleBlur(radius);\r\n    gl.unsharpMask.textures({\r\n        originalTexture: 1\r\n    });\r\n    simpleShader.call(this, gl.unsharpMask, {\r\n        strength: strength\r\n    });\r\n    this._.extraTexture.unuse(1);\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\vibrance.script\r\n/**\r\n * @filter       Vibrance\r\n * @description  Modifies the saturation of desaturated colors, leaving saturated colors unmodified.\r\n * @param amount -1 to 1 (-1 is minimum vibrance, 0 is no change, and 1 is maximum vibrance)\r\n */\r\nfunction vibrance(amount) {\r\n    gl.vibrance = gl.vibrance || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            float mx = max(color.r, max(color.g, color.b));\\\r\n            float amt = (mx - average) * (-amount * 3.0);\\\r\n            color.rgb = mix(color.rgb, vec3(mx), amt);\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'vibrance');\r\n\r\n    simpleShader.call(this, gl.vibrance, {\r\n        amount: clamp(-1, amount, 1)\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\vignette.script\r\n/**\r\n * @filter         Vignette\r\n * @description    Adds a simulated lens edge darkening effect.\r\n * @param size     0 to 1 (0 for center of frame, 1 for edge of frame)\r\n * @param amount   0 to 1 (0 for no effect, 1 for maximum lens darkening)\r\n */\r\nfunction vignette(size, amount) {\r\n    gl.vignette = gl.vignette || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float size;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            float dist = distance(texCoord, vec2(0.5, 0.5));\\\r\n            color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount + size));\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'vignette');\r\n\r\n    simpleShader.call(this, gl.vignette, {\r\n        size: clamp(0, size, 1),\r\n        amount: clamp(0, amount, 1)\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\blur\\lensblur.script\r\n/**\r\n * @filter           Lens Blur\r\n * @description      Imitates a camera capturing the image out of focus by using a blur that generates\r\n *                   the large shapes known as bokeh. The polygonal shape of real bokeh is due to the\r\n *                   blades of the aperture diaphragm when it isn't fully open. This blur renders\r\n *                   bokeh from a 6-bladed diaphragm because the computation is more efficient. It\r\n *                   can be separated into three rhombi, each of which is just a skewed box blur.\r\n *                   This filter makes use of the floating point texture WebGL extension to implement\r\n *                   the brightness parameter, so there will be severe visual artifacts if brightness\r\n *                   is non-zero and the floating point texture extension is not available. The\r\n *                   idea was from John White's SIGGRAPH 2011 talk but this effect has an additional\r\n *                   brightness parameter that fakes what would otherwise come from a HDR source.\r\n * @param radius     the radius of the hexagonal disk convolved with the image\r\n * @param brightness -1 to 1 (the brightness of the bokeh, negative values will create dark bokeh)\r\n * @param angle      the rotation of the bokeh in radians\r\n */\r\nfunction lensBlur(radius, brightness, angle) {\r\n    // All averaging is done on values raised to a power to make more obvious bokeh\r\n    // (we will raise the average to the inverse power at the end to compensate).\r\n    // Without this the image looks almost like a normal blurred image. This hack is\r\n    // obviously not realistic, but to accurately simulate this we would need a high\r\n    // dynamic range source photograph which we don't have.\r\n    gl.lensBlurPrePass = gl.lensBlurPrePass || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float power;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color = pow(color, vec4(power));\\\r\n            gl_FragColor = vec4(color);\\\r\n        }\\\r\n    ', 'lensBlurPrePass');\r\n\r\n    let common = '\\\r\n        uniform sampler2D texture0;\\\r\n        uniform sampler2D texture1;\\\r\n        uniform vec2 delta0;\\\r\n        uniform vec2 delta1;\\\r\n        uniform float power;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        vec4 sample(vec2 delta) {\\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(delta, 151.7182), 0.0);\\\r\n            \\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            for (float t = 0.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset) / 30.0;\\\r\n                color += texture2D(texture0, texCoord + delta * percent);\\\r\n                total += 1.0;\\\r\n            }\\\r\n            return color / total;\\\r\n        }\\\r\n    ';\r\n\r\n    gl.lensBlur0 = gl.lensBlur0 || new Shader(null, common + '\\\r\n        void main() {\\\r\n            gl_FragColor = sample(delta0);\\\r\n        }\\\r\n    ', 'lensBlur0');\r\n    gl.lensBlur1 = gl.lensBlur1 || new Shader(null, common + '\\\r\n        void main() {\\\r\n            gl_FragColor = (sample(delta0) + sample(delta1)) * 0.5;\\\r\n        }\\\r\n    ', 'lensBlur1');\r\n    gl.lensBlur2 = gl.lensBlur2 || new Shader(null, common + '\\\r\n        void main() {\\\r\n            vec4 color = (sample(delta0) + 2.0 * texture2D(texture1, texCoord)) / 3.0;\\\r\n            gl_FragColor = pow(color, vec4(power));\\\r\n        }\\\r\n    ', 'lensBlur2').textures({ texture1: 1 });\r\n\r\n    // Generate\r\n    let dir = [];\r\n    for (var i = 0; i < 3; i++) {\r\n        let a = angle + i * Math.PI * 2 / 3;\r\n        dir.push([radius * Math.sin(a) / this.width, radius * Math.cos(a) / this.height]);\r\n    }\r\n    let power = Math.pow(10, clamp(-1, brightness, 1));\r\n\r\n    // Remap the texture values, which will help make the bokeh effect\r\n    simpleShader.call(this, gl.lensBlurPrePass, {\r\n        power: power\r\n    });\r\n\r\n    // Blur two rhombi in parallel into extraTexture\r\n    this._.extraTexture.ensureFormat(this._.texture);\r\n    simpleShader.call(this, gl.lensBlur0, {\r\n        delta0: dir[0]\r\n    }, this._.texture, this._.extraTexture);\r\n    simpleShader.call(this, gl.lensBlur1, {\r\n        delta0: dir[1],\r\n        delta1: dir[2]\r\n    }, this._.extraTexture, this._.extraTexture);\r\n\r\n    // Blur the last rhombus and combine with extraTexture\r\n    simpleShader.call(this, gl.lensBlur0, {\r\n        delta0: dir[1]\r\n    });\r\n    this._.extraTexture.use(1);\r\n    simpleShader.call(this, gl.lensBlur2, {\r\n        power: 1 / power,\r\n        delta0: dir[2]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\blur\\tiltshift.script\r\n/**\r\n * @filter               Tilt Shift\r\n * @description          Simulates the shallow depth of field normally encountered in close-up\r\n *                       photography, which makes the scene seem much smaller than it actually\r\n *                       is. This filter assumes the scene is relatively planar, in which case\r\n *                       the part of the scene that is completely in focus can be described by\r\n *                       a line (the intersection of the focal plane and the scene). An example\r\n *                       of a planar scene might be looking at a road from above at a downward\r\n *                       angle. The image is then blurred with a blur radius that starts at zero\r\n *                       on the line and increases further from the line.\r\n * @param startX         The x coordinate of the start of the line segment.\r\n * @param startY         The y coordinate of the start of the line segment.\r\n * @param endX           The x coordinate of the end of the line segment.\r\n * @param endY           The y coordinate of the end of the line segment.\r\n * @param blurRadius     The maximum radius of the pyramid blur.\r\n * @param gradientRadius The distance from the line at which the maximum blur radius is reached.\r\n */\r\nfunction tiltShift(startX, startY, endX, endY, blurRadius, gradientRadius) {\r\n    gl.tiltShift = gl.tiltShift || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float blurRadius;\\\r\n        uniform float gradientRadius;\\\r\n        uniform vec2 start;\\\r\n        uniform vec2 end;\\\r\n        uniform vec2 delta;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\\\r\n            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'tiltShift');\r\n\r\n    let dx = endX - startX;\r\n    let dy = endY - startY;\r\n    let d = Math.sqrt(dx * dx + dy * dy);\r\n    simpleShader.call(this, gl.tiltShift, {\r\n        blurRadius: blurRadius,\r\n        gradientRadius: gradientRadius,\r\n        start: [startX, startY],\r\n        end: [endX, endY],\r\n        delta: [dx / d, dy / d],\r\n        texSize: [this.width, this.height]\r\n    });\r\n    simpleShader.call(this, gl.tiltShift, {\r\n        blurRadius: blurRadius,\r\n        gradientRadius: gradientRadius,\r\n        start: [startX, startY],\r\n        end: [endX, endY],\r\n        delta: [-dy / d, dx / d],\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\blur\\triangleblur.script\r\n/**\r\n * @filter       Triangle Blur\r\n * @description  This is the most basic blur filter, which convolves the image with a\r\n *               pyramid filter. The pyramid filter is separable and is applied as two\r\n *               perpendicular triangle filters.\r\n * @param radius The radius of the pyramid convolved with the image.\r\n */\r\nfunction triangleBlur(radius) {\r\n    gl.triangleBlur = gl.triangleBlur || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta * percent);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'triangleBlur');\r\n\r\n    simpleShader.call(this, gl.triangleBlur, {\r\n        delta: [radius / this.width, 0]\r\n    });\r\n    simpleShader.call(this, gl.triangleBlur, {\r\n        delta: [0, radius / this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\blur\\zoomblur.script\r\n/**\r\n * @filter         Zoom Blur\r\n * @description    Blurs the image away from a certain point, which looks like radial motion blur.\r\n * @param centerX  The x coordinate of the blur origin.\r\n * @param centerY  The y coordinate of the blur origin.\r\n * @param strength The strength of the blur. Values in the range 0 to 1 are usually sufficient,\r\n *                 where 0 doesn't change the image and 1 creates a highly blurred image.\r\n */\r\nfunction zoomBlur(centerX, centerY, strength) {\r\n    gl.zoomBlur = gl.zoomBlur || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float strength;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            vec2 toCenter = center - texCoord * texSize;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = 0.0; t <= 40.0; t++) {\\\r\n                float percent = (t + offset) / 40.0;\\\r\n                float weight = 4.0 * (percent - percent * percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + toCenter * percent * strength / texSize);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'zoomBlur');\r\n\r\n    simpleShader.call(this, gl.zoomBlur, {\r\n        center: [centerX, centerY],\r\n        strength: strength,\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\fun\\colorhalftone.script\r\n/**\r\n * @filter        Color Halftone\r\n * @description   Simulates a CMYK halftone rendering of the image by multiplying pixel values\r\n *                with a four rotated 2D sine wave patterns, one each for cyan, magenta, yellow,\r\n *                and black.\r\n * @param centerX The x coordinate of the pattern origin.\r\n * @param centerY The y coordinate of the pattern origin.\r\n * @param angle   The rotation of the pattern in radians.\r\n * @param size    The diameter of a dot in pixels.\r\n */\r\nfunction colorHalftone(centerX, centerY, angle, size) {\r\n    gl.colorHalftone = gl.colorHalftone || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float angle;\\\r\n        uniform float scale;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        \\\r\n        float pattern(float angle) {\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec2 tex = texCoord * texSize - center;\\\r\n            vec2 point = vec2(\\\r\n                c * tex.x - s * tex.y,\\\r\n                s * tex.x + c * tex.y\\\r\n            ) * scale;\\\r\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\r\n        }\\\r\n        \\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            vec3 cmy = 1.0 - color.rgb;\\\r\n            float k = min(cmy.x, min(cmy.y, cmy.z));\\\r\n            cmy = (cmy - k) / (1.0 - k);\\\r\n            cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(angle + 0.26179), pattern(angle + 1.30899), pattern(angle)), 0.0, 1.0);\\\r\n            k = clamp(k * 10.0 - 5.0 + pattern(angle + 0.78539), 0.0, 1.0);\\\r\n            gl_FragColor = vec4(1.0 - cmy - k, color.a);\\\r\n        }\\\r\n    ', 'colorHalftone');\r\n\r\n    simpleShader.call(this, gl.colorHalftone, {\r\n        center: [centerX, centerY],\r\n        angle: angle,\r\n        scale: Math.PI / size,\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\fun\\dotscreen.script\r\n/**\r\n * @filter        Dot Screen\r\n * @description   Simulates a black and white halftone rendering of the image by multiplying\r\n *                pixel values with a rotated 2D sine wave pattern.\r\n * @param centerX The x coordinate of the pattern origin.\r\n * @param centerY The y coordinate of the pattern origin.\r\n * @param angle   The rotation of the pattern in radians.\r\n * @param size    The diameter of a dot in pixels.\r\n */\r\nfunction dotScreen(centerX, centerY, angle, size) {\r\n    gl.dotScreen = gl.dotScreen || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float angle;\\\r\n        uniform float scale;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        \\\r\n        float pattern() {\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec2 tex = texCoord * texSize - center;\\\r\n            vec2 point = vec2(\\\r\n                c * tex.x - s * tex.y,\\\r\n                s * tex.x + c * tex.y\\\r\n            ) * scale;\\\r\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\r\n        }\\\r\n        \\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\\\r\n        }\\\r\n    ', 'dotScreen');\r\n\r\n    simpleShader.call(this, gl.dotScreen, {\r\n        center: [centerX, centerY],\r\n        angle: angle,\r\n        scale: Math.PI / size,\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\fun\\edgework.script\r\n/**\r\n * @filter       Edge Work\r\n * @description  Picks out different frequencies in the image by subtracting two\r\n *               copies of the image blurred with different radii.\r\n * @param radius The radius of the effect in pixels.\r\n */\r\nfunction edgeWork(radius) {\r\n    gl.edgeWork1 = gl.edgeWork1 || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec2 color = vec2(0.0);\\\r\n            vec2 total = vec2(0.0);\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec3 sample = texture2D(texture, texCoord + delta * percent).rgb;\\\r\n                float average = (sample.r + sample.g + sample.b) / 3.0;\\\r\n                color.x += average * weight;\\\r\n                total.x += weight;\\\r\n                if (abs(t) < 15.0) {\\\r\n                    weight = weight * 2.0 - 1.0;\\\r\n                    color.y += average * weight;\\\r\n                    total.y += weight;\\\r\n                }\\\r\n            }\\\r\n            gl_FragColor = vec4(color / total, 0.0, 1.0);\\\r\n        }\\\r\n    ', 'edgeWork1');\r\n    gl.edgeWork2 = gl.edgeWork2 || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec2 color = vec2(0.0);\\\r\n            vec2 total = vec2(0.0);\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec2 sample = texture2D(texture, texCoord + delta * percent).xy;\\\r\n                color.x += sample.x * weight;\\\r\n                total.x += weight;\\\r\n                if (abs(t) < 15.0) {\\\r\n                    weight = weight * 2.0 - 1.0;\\\r\n                    color.y += sample.y * weight;\\\r\n                    total.y += weight;\\\r\n                }\\\r\n            }\\\r\n            float c = clamp(10000.0 * (color.y / total.y - color.x / total.x) + 0.5, 0.0, 1.0);\\\r\n            gl_FragColor = vec4(c, c, c, 1.0);\\\r\n        }\\\r\n    ', 'edgeWork2');\r\n\r\n    simpleShader.call(this, gl.edgeWork1, {\r\n        delta: [radius / this.width, 0]\r\n    });\r\n    simpleShader.call(this, gl.edgeWork2, {\r\n        delta: [0, radius / this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\fun\\hexagonalpixelate.script\r\n/**\r\n * @filter        Hexagonal Pixelate\r\n * @description   Renders the image using a pattern of hexagonal tiles. Tile colors\r\n *                are nearest-neighbor sampled from the centers of the tiles.\r\n * @param centerX The x coordinate of the pattern center.\r\n * @param centerY The y coordinate of the pattern center.\r\n * @param scale   The width of an individual tile, in pixels.\r\n */\r\nfunction hexagonalPixelate(centerX, centerY, scale) {\r\n    gl.hexagonalPixelate = gl.hexagonalPixelate || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float scale;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec2 tex = (texCoord * texSize - center) / scale;\\\r\n            tex.y /= 0.866025404;\\\r\n            tex.x -= tex.y * 0.5;\\\r\n            \\\r\n            vec2 a;\\\r\n            if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) a = vec2(floor(tex.x), floor(tex.y));\\\r\n            else a = vec2(ceil(tex.x), ceil(tex.y));\\\r\n            vec2 b = vec2(ceil(tex.x), floor(tex.y));\\\r\n            vec2 c = vec2(floor(tex.x), ceil(tex.y));\\\r\n            \\\r\n            vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\\\r\n            vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\\\r\n            vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\\\r\n            vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\\\r\n            \\\r\n            float alen = length(TEX - A);\\\r\n            float blen = length(TEX - B);\\\r\n            float clen = length(TEX - C);\\\r\n            \\\r\n            vec2 choice;\\\r\n            if (alen < blen) {\\\r\n                if (alen < clen) choice = a;\\\r\n                else choice = c;\\\r\n            } else {\\\r\n                if (blen < clen) choice = b;\\\r\n                else choice = c;\\\r\n            }\\\r\n            \\\r\n            choice.x += choice.y * 0.5;\\\r\n            choice.y *= 0.866025404;\\\r\n            choice *= scale / texSize;\\\r\n            gl_FragColor = texture2D(texture, choice + center / texSize);\\\r\n        }\\\r\n    ', 'hexagonalPixelate');\r\n\r\n    simpleShader.call(this, gl.hexagonalPixelate, {\r\n        center: [centerX, centerY],\r\n        scale: scale,\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\fun\\ink.script\r\n/**\r\n * @filter         Ink\r\n * @description    Simulates outlining the image in ink by darkening edges stronger than a\r\n *                 certain threshold. The edge detection value is the difference of two\r\n *                 copies of the image, each blurred using a blur of a different radius.\r\n * @param strength The multiplicative scale of the ink edges. Values in the range 0 to 1\r\n *                 are usually sufficient, where 0 doesn't change the image and 1 adds lots\r\n *                 of black edges. Negative strength values will create white ink edges\r\n *                 instead of black ones.\r\n */\r\nfunction ink(strength) {\r\n    gl.ink = gl.ink || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float strength;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec2 dx = vec2(1.0 / texSize.x, 0.0);\\\r\n            vec2 dy = vec2(0.0, 1.0 / texSize.y);\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float bigTotal = 0.0;\\\r\n            float smallTotal = 0.0;\\\r\n            vec3 bigAverage = vec3(0.0);\\\r\n            vec3 smallAverage = vec3(0.0);\\\r\n            for (float x = -2.0; x <= 2.0; x += 1.0) {\\\r\n                for (float y = -2.0; y <= 2.0; y += 1.0) {\\\r\n                    vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\\\r\n                    bigAverage += sample;\\\r\n                    bigTotal += 1.0;\\\r\n                    if (abs(x) + abs(y) < 2.0) {\\\r\n                        smallAverage += sample;\\\r\n                        smallTotal += 1.0;\\\r\n                    }\\\r\n                }\\\r\n            }\\\r\n            vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\\\r\n            gl_FragColor = vec4(color.rgb - dot(edge, edge) * strength * 100000.0, color.a);\\\r\n        }\\\r\n    ', 'ink');\r\n\r\n    simpleShader.call(this, gl.ink, {\r\n        strength: strength * strength * strength * strength * strength,\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\warp\\bulgepinch.script\r\n/**\r\n * @filter         Bulge / Pinch\r\n * @description    Bulges or pinches the image in a circle.\r\n * @param centerX  The x coordinate of the center of the circle of effect.\r\n * @param centerY  The y coordinate of the center of the circle of effect.\r\n * @param radius   The radius of the circle of effect.\r\n * @param strength -1 to 1 (-1 is strong pinch, 0 is no effect, 1 is strong bulge)\r\n */\r\nfunction bulgePinch(centerX, centerY, radius, strength) {\r\n    gl.bulgePinch = gl.bulgePinch || warpShader('\\\r\n        uniform float radius;\\\r\n        uniform float strength;\\\r\n        uniform vec2 center;\\\r\n    ', '\\\r\n        coord -= center;\\\r\n        float distance = length(coord);\\\r\n        if (distance < radius) {\\\r\n            float percent = distance / radius;\\\r\n            if (strength > 0.0) {\\\r\n                coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);\\\r\n            } else {\\\r\n                coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);\\\r\n            }\\\r\n        }\\\r\n        coord += center;\\\r\n    ');\r\n\r\n    simpleShader.call(this, gl.bulgePinch, {\r\n        radius: radius,\r\n        strength: clamp(-1, strength, 1),\r\n        center: [centerX, centerY],\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\warp\\matrixwarp.script\r\n/**\r\n * @filter                Matrix Warp\r\n * @description           Transforms an image by a 2x2 or 3x3 matrix. The coordinates used in\r\n *                        the transformation are (x, y) for a 2x2 matrix or (x, y, 1) for a\r\n *                        3x3 matrix, where x and y are in units of pixels.\r\n * @param matrix          A 2x2 or 3x3 matrix represented as either a list or a list of lists.\r\n *                        For example, the 3x3 matrix [[2,0,0],[0,3,0],[0,0,1]] can also be\r\n *                        represented as [2,0,0,0,3,0,0,0,1] or just [2,0,0,3].\r\n * @param inverse         A boolean value that, when true, applies the inverse transformation\r\n *                        instead. (optional, defaults to false)\r\n * @param useTextureSpace A boolean value that, when true, uses texture-space coordinates\r\n *                        instead of screen-space coordinates. Texture-space coordinates range\r\n *                        from -1 to 1 instead of 0 to width - 1 or height - 1, and are easier\r\n *                        to use for simple operations like flipping and rotating.\r\n */\r\nfunction matrixWarp(matrix, inverse, useTextureSpace) {\r\n    gl.matrixWarp = gl.matrixWarp || warpShader('\\\r\n        uniform mat3 matrix;\\\r\n        uniform bool useTextureSpace;\\\r\n    ', '\\\r\n        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;\\\r\n        vec3 warp = matrix * vec3(coord, 1.0);\\\r\n        coord = warp.xy / warp.z;\\\r\n        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;\\\r\n    ');\r\n\r\n    // Flatten all members of matrix into one big list\r\n    matrix = Array.prototype.concat.apply([], matrix);\r\n\r\n    // Extract a 3x3 matrix out of the arguments\r\n    if (matrix.length == 4) {\r\n        matrix = [\r\n            matrix[0], matrix[1], 0,\r\n            matrix[2], matrix[3], 0,\r\n            0, 0, 1\r\n        ];\r\n    } else if (matrix.length != 9) {\r\n        throw 'can only warp with 2x2 or 3x3 matrix';\r\n    }\r\n\r\n    simpleShader.call(this, gl.matrixWarp, {\r\n        matrix: inverse ? getInverse(matrix) : matrix,\r\n        texSize: [this.width, this.height],\r\n        useTextureSpace: useTextureSpace | 0\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\warp\\perspective.script\r\n/**\r\n * @filter       Perspective\r\n * @description  Warps one quadrangle to another with a perspective transform. This can be used to\r\n *               make a 2D image look 3D or to recover a 2D image captured in a 3D environment.\r\n * @param before The x and y coordinates of four points before the transform in a flat list. This\r\n *               would look like [ax, ay, bx, by, cx, cy, dx, dy] for four points (ax, ay), (bx, by),\r\n *               (cx, cy), and (dx, dy).\r\n * @param after  The x and y coordinates of four points after the transform in a flat list, just\r\n *               like the other argument.\r\n */\r\nfunction perspective(before, after) {\r\n    let a = getSquareToQuad.apply(null, after);\r\n    let b = getSquareToQuad.apply(null, before);\r\n    let c = multiply(getInverse(a), b);\r\n    return this.matrixWarp(c);\r\n}\r\n\r\n// src/filters\\warp\\swirl.script\r\n/**\r\n * @filter        Swirl\r\n * @description   Warps a circular region of the image in a swirl.\r\n * @param centerX The x coordinate of the center of the circular region.\r\n * @param centerY The y coordinate of the center of the circular region.\r\n * @param radius  The radius of the circular region.\r\n * @param angle   The angle in radians that the pixels in the center of\r\n *                the circular region will be rotated by.\r\n */\r\nfunction swirl(centerX, centerY, radius, angle) {\r\n    gl.swirl = gl.swirl || warpShader('\\\r\n        uniform float radius;\\\r\n        uniform float angle;\\\r\n        uniform vec2 center;\\\r\n    ', '\\\r\n        coord -= center;\\\r\n        float distance = length(coord);\\\r\n        if (distance < radius) {\\\r\n            float percent = (radius - distance) / radius;\\\r\n            float theta = percent * percent * angle;\\\r\n            float s = sin(theta);\\\r\n            float c = cos(theta);\\\r\n            coord = vec2(\\\r\n                coord.x * c - coord.y * s,\\\r\n                coord.x * s + coord.y * c\\\r\n            );\\\r\n        }\\\r\n        coord += center;\\\r\n    ');\r\n\r\n    simpleShader.call(this, gl.swirl, {\r\n        radius: radius,\r\n        center: [centerX, centerY],\r\n        angle: angle,\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n/**\r\n * @filter        Invert\r\n * @description   Inverts color of each pixel\r\n */\r\nfunction invert() {\r\n    gl.invert = gl.invert || new Shader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        gl_FragColor = vec4(1.0 - color.r, 1.0 - color.g, 1.0 - color.b, color.a);\\\r\n    }\\\r\n', 'invert');\r\n\r\n    simpleShader.call(this, gl.invert, {\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n/**\r\n * @filter        To Alpha\r\n * @description   Generates alpha channel from luminance (r+g+b)\r\n * @param isInverted    boolean - invert luminance\r\n * @param replaceRGBA    rgba - color to replace rgb with. if a = 0 -> keep orig color\r\n */\r\nfunction toAlpha(isInverted, replaceRGBA) {\r\n    gl.toAlpha = gl.toAlpha || new Shader(null, '\\\r\n    uniform bool isInverted;\\\r\n    uniform vec4 replace;\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        float alpha = (color.r + color.g + color.b) / 3.0;\\\r\n        if (isInverted) alpha = 1.0 - alpha;\\\r\n        alpha = min(color.a, alpha);\\\r\n        if (replace.a > 0.0) color = replace;\\\r\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha);\\\r\n    }\\\r\n', 'toAlpha');\r\n\r\n    simpleShader.call(this, gl.toAlpha, {\r\n        isInverted: isInverted ? 1 : 0,\r\n        replace: replaceRGBA ? [replaceRGBA.r / 255, replaceRGBA.g / 255, replaceRGBA.b / 255, replaceRGBA.a] : [0,0,0,0],\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n\r\nreturn exports;\r\n})();\r\n","import {BB} from '../../bb/bb';\r\nimport {input} from '../ui/base-components/input';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {Cropper} from '../ui/components/cropper';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const cropExtend = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        const canvas = params.canvas;\r\n        if (!canvas)\r\n            return false;\r\n        const tempCanvas = BB.canvas();\r\n        {\r\n            let fit = BB.fitInto(canvas.getWidth(), canvas.getHeight(), 560, 400, 1);\r\n            let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n            let previewFactor = w / canvas.getWidth();\r\n            tempCanvas.width = w;\r\n            tempCanvas.height = h;\r\n            tempCanvas.style.display = 'block';\r\n            tempCanvas.getContext(\"2d\").drawImage(canvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n        }\r\n\r\n        const div = document.createElement(\"div\");\r\n        const result: any = {\r\n            element: div\r\n        };\r\n        div.innerHTML = LANG('filter-crop-description') + \"<br/><br/>\";\r\n        let left = 0, right = 0, top = 0, bottom = 0;\r\n        let leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\r\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n        let scale;\r\n\r\n\r\n\r\n        // --- input elements ---\r\n\r\n        const lrWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'}\r\n        });\r\n        const tbWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'}\r\n        });\r\n        div.appendChild(lrWrapper);\r\n        div.appendChild(tbWrapper);\r\n\r\n        const leftInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -canvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                leftChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n        const rightInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -canvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px'},\r\n            callback: function(v) {\r\n                rightChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n        const topInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -canvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                topChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n        const bottomInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -canvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px'},\r\n            callback: function(v) {\r\n                bottomChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            width: '60px'\r\n        };\r\n        lrWrapper.append(\r\n            BB.el({content: LANG('filter-crop-left') + ':', css: labelStyle}),\r\n            leftInput,\r\n            BB.el({content: LANG('filter-crop-right') + ':', css: labelStyle}),\r\n            rightInput\r\n        );\r\n        tbWrapper.append(\r\n            BB.el({content: LANG('filter-crop-top') + ':', css: labelStyle}),\r\n            topInput,\r\n            BB.el({content: LANG('filter-crop-bottom') + ':', css: labelStyle}),\r\n            bottomInput\r\n        );\r\n\r\n        function updateInput() {\r\n            left = parseInt(leftInput.value);\r\n            right = parseInt(rightInput.value);\r\n            top = parseInt(topInput.value);\r\n            bottom = parseInt(bottomInput.value);\r\n            let newWidth = canvas.getWidth() + left + right;\r\n            let newHeight = canvas.getHeight() + top + bottom;\r\n\r\n            if (newWidth <= 0) {\r\n                if (leftChanged) {\r\n                    left = -canvas.getWidth() - right + 1;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -canvas.getWidth() - left + 1;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = 1;\r\n            }\r\n            if (newWidth > maxWidth) {\r\n                if (leftChanged) {\r\n                    left = -canvas.getWidth() - right + maxWidth;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -canvas.getWidth() - left + maxWidth;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = maxWidth;\r\n            }\r\n            if (newHeight <= 0) {\r\n                if (topChanged) {\r\n                    top = -canvas.getHeight() - bottom + 1;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -canvas.getHeight() - top + 1;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = 1;\r\n            }\r\n            if (newHeight > maxHeight) {\r\n                if (topChanged) {\r\n                    top = -canvas.getHeight() - bottom + maxHeight;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -canvas.getHeight() - top + maxHeight;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = maxHeight;\r\n            }\r\n            cropper.setTransform({\r\n                x: -left,\r\n                y: -top,\r\n                width: newWidth,\r\n                height: newHeight\r\n            });\r\n\r\n\r\n            leftChanged = false;\r\n            rightChanged = false;\r\n            topChanged = false;\r\n            bottomChanged = false;\r\n        }\r\n\r\n        let useRuleOfThirds = true;\r\n        let ruleOThirdsCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-crop-rule-thirds'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                useRuleOfThirds = b;\r\n                cropper.showThirds(useRuleOfThirds);\r\n            }\r\n        });\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both'\r\n            }\r\n        }));\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 0};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 0},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n            {r: 0, g: 0, b: 0, a: 1}\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('filter-crop-fill'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function(rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                updateBg(rgbaObj);\r\n            }\r\n        });\r\n\r\n\r\n        const flexRow = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between'\r\n            }\r\n        });\r\n        div.appendChild(flexRow);\r\n        flexRow.appendChild(ruleOThirdsCheckbox.getElement());\r\n        flexRow.appendChild(colorOptions.getElement());\r\n\r\n\r\n        // when input field changed, or dragging in preview finished\r\n        // adjusts the zoom\r\n        function update(transform) {\r\n            const fit = BB.fitInto(transform.width, transform.height, 260, 180, 1);\r\n            scale = fit.width / transform.width;\r\n\r\n            const offset = BB.centerWithin(340, 220, fit.width, fit.height);\r\n\r\n            tempCanvas.style.width = canvas.getWidth() * scale + \"px\";\r\n            tempCanvas.style.height = canvas.getHeight() * scale + \"px\";\r\n\r\n            offsetWrapper.style.left = (offset.x - transform.x * scale) + \"px\";\r\n            offsetWrapper.style.top = (offset.y - transform.y * scale) + \"px\";\r\n\r\n            left = parseInt('' + -transform.x);\r\n            top = parseInt('' + -transform.y);\r\n            right = parseInt('' + (transform.x + transform.width - canvas.getWidth()));\r\n            bottom = parseInt('' + (transform.y + transform.height - canvas.getHeight()));\r\n            leftInput.value = '' + left;\r\n            topInput.value = '' + top;\r\n            rightInput.value = '' + right;\r\n            bottomInput.value = '' + bottom;\r\n\r\n            BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                previewWrapper.style.background = \"url(\" + url + \")\";\r\n                if (selectedRgbaObj.a !== 0) {\r\n                    tempCanvas.style.background = \"url(\" + url + \")\";\r\n                }\r\n            });\r\n            previewWrapper.style.backgroundPosition = (offset.x) + \"px \" + (offset.y) + \"px\";\r\n\r\n            cropper.setScale(scale);\r\n        }\r\n\r\n        const previewWrapper = BB.el({\r\n            css: {\r\n                width: \"340px\",\r\n                marginTop: '10px',\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                position: \"relative\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                userSelect: 'none',\r\n                colorScheme: 'only light',\r\n                touchAction: 'none',\r\n            }\r\n        });\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        const bgColorOverlay = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0'\r\n            }\r\n        });\r\n        previewWrapper.appendChild(bgColorOverlay);\r\n\r\n        const offsetWrapper = document.createElement(\"div\");\r\n        offsetWrapper.style.position = \"absolute\";\r\n        offsetWrapper.style.left = \"0px\";\r\n        offsetWrapper.style.top = \"0px\";\r\n        previewWrapper.appendChild(offsetWrapper);\r\n\r\n\r\n        const canvasWrapper = BB.appendTextDiv(offsetWrapper, \"\");\r\n        canvasWrapper.appendChild(tempCanvas);\r\n        //tempCanvas.style.width = w + \"px\";\r\n        //tempCanvas.style.height = h + \"px\";\r\n        tempCanvas.style.boxShadow = \"0 0 3px 1px rgba(0,0,0,0.5)\";\r\n        tempCanvas.style.position = \"absolute\";\r\n        tempCanvas.style.left = \"0px\";\r\n        tempCanvas.style.top = \"0px\";\r\n\r\n        div.appendChild(previewWrapper);\r\n        const cropper = new Cropper({\r\n            x: 0,\r\n            y: 0,\r\n            width: canvas.getWidth(),\r\n            height: canvas.getHeight(),\r\n            scale: scale,\r\n            callback: update,\r\n            maxW: maxWidth,\r\n            maxH: maxHeight\r\n        });\r\n        update(cropper.getTransform());\r\n        offsetWrapper.appendChild(cropper.getElement());\r\n\r\n        function updateBg(rgbaObj) {\r\n\r\n            let borderColor;\r\n            if (rgbaObj.a === 0) {\r\n                borderColor = 'rgba(0,0,0,0.5)';\r\n                bgColorOverlay.style.background = '';\r\n                tempCanvas.style.background = '';\r\n            } else {\r\n                borderColor = (rgbaObj.r + rgbaObj.g + rgbaObj.b < 255 * 3 / 2) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\r\n                bgColorOverlay.style.background = BB.ColorConverter.toRgbStr(rgbaObj);\r\n\r\n                BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                    tempCanvas.style.background = \"url(\" + url + \")\";\r\n                });\r\n            }\r\n            tempCanvas.style.boxShadow = \"0 0 3px 1px \" + borderColor;\r\n        }\r\n\r\n        result.destroy = () => {\r\n            cropper.destroy();\r\n            ruleOThirdsCheckbox.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return {\r\n                left: left,\r\n                right: right,\r\n                top: top,\r\n                bottom: bottom,\r\n                fillColor: selectedRgbaObj.a === 0 ? null : selectedRgbaObj\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const canvas = params.canvas;\r\n        const history = params.history;\r\n        if (!canvas || !history || isNaN(params.input.left) || isNaN(params.input.right) || isNaN(params.input.top) || isNaN(params.input.bottom)) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        canvas.resizeCanvas(params.input);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"cropExtend\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: JSON.parse(JSON.stringify(params.input))\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const glCurves = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div,\r\n        };\r\n        let klCanvasPreview;\r\n\r\n        function finishInit() {\r\n\r\n            let previewFactor = w / context.canvas.width;\r\n            let brightness = 0, contrast = 0;\r\n\r\n            div.innerHTML = LANG('filter-curves-description') + \"<br/><br/>\";\r\n\r\n            let curves = {\r\n                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n            };\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n                    if (klCanvasPreview) {\r\n                        klCanvasPreview.render();\r\n                    }\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            let modeButtons;\r\n\r\n            function CurvesInput(p) {\r\n                let div = document.createElement(\"div\");\r\n                div.oncontextmenu = function () {\r\n                    return false;\r\n                };\r\n                div.style.position = \"relative\";\r\n                div.style.marginBottom = \"10px\";\r\n                let mode = \"All\";\r\n                let curves = p.curves;\r\n                modeButtons = new Options( {\r\n                    optionArr: [\r\n                        {\r\n                            id: 'All',\r\n                            label: LANG('filter-curves-all')\r\n                        },\r\n                        {\r\n                            id: 'Red',\r\n                            label: LANG('red')\r\n                        },\r\n                        {\r\n                            id: 'Green',\r\n                            label: LANG('green')\r\n                        },\r\n                        {\r\n                            id: 'Blue',\r\n                            label: LANG('blue')\r\n                        },\r\n                    ],\r\n                    initialId: 'All',\r\n                    onChange: function(id) {\r\n                        mode = id;\r\n                        if (mode === \"All\") {\r\n                            curves = {\r\n                                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                            };\r\n                        }\r\n                        let curve = curves.r;\r\n                        if (mode === \"Green\") {\r\n                            curve = curves.g;\r\n                        }\r\n                        if (mode === \"Blue\") {\r\n                            curve = curves.b;\r\n                        }\r\n                        (p0 as any).setPos(0, areah - curve[0][1] * areah);\r\n                        (p1 as any).setPos(curve[1][0] * areaw, areah - curve[1][1] * areah);\r\n                        (p2 as any).setPos(curve[2][0] * areaw, areah - curve[2][1] * areah);\r\n                        (p3 as any).setPos(areaw, areah - curve[3][1] * areah);\r\n\r\n                        update();\r\n                    }\r\n                });\r\n                div.appendChild(modeButtons.getElement());\r\n\r\n                let curveArea = document.createElement(\"div\");\r\n                BB.css(curveArea, {\r\n                    position: 'relative',\r\n                    marginTop: '10px',\r\n                    colorScheme: 'only light',\r\n                })\r\n                div.appendChild(curveArea);\r\n\r\n                let areaw = 300, areah = 100;\r\n                let canvas = BB.canvas(areaw, areah);\r\n                BB.css(canvas, {\r\n                    background: \"#c6c6c6\",\r\n                    boxShadow: \"0 0 0 1px rgba(0,0,0,0.3)\"\r\n                });\r\n                let ctx = canvas.getContext(\"2d\");\r\n                curveArea.appendChild(canvas);\r\n\r\n                let points = {\r\n                    r: [],\r\n                    g: [],\r\n                    b: []\r\n                };\r\n\r\n                function fit(v) {\r\n                    return Math.max(0, Math.min(1, v));\r\n                }\r\n\r\n                function createPoint(x, y, callback, lock?) {\r\n                    let gripSize = 14;\r\n                    let internalY = y, internalX = x;\r\n                    let point = document.createElement(\"div\");\r\n                    BB.css(point, {\r\n                        position: \"absolute\",\r\n                        left: (x - gripSize / 2) + \"px\",\r\n                        top: (y - gripSize / 2) + \"px\",\r\n                        width: gripSize + \"px\",\r\n                        height: gripSize + \"px\",\r\n                        background: \"#fff\",\r\n                        cursor: \"move\",\r\n                        borderRadius: gripSize + \"px\",\r\n                        boxShadow: \"inset 0 0 0 2px #000\",\r\n                        userSelect: 'none',\r\n                        touchAction: 'none',\r\n                    });\r\n\r\n                    function update() {\r\n                        BB.css(point, {\r\n                            left: (x - gripSize / 2) + \"px\",\r\n                            top: (y - gripSize / 2) + \"px\"\r\n                        });\r\n                    }\r\n\r\n                    (point as any).pointerListener = new BB.PointerListener({\r\n                        target: point,\r\n                        maxPointers: 1,\r\n                        onPointer: function(event) {\r\n                            event.eventPreventDefault();\r\n                            if (event.type === 'pointerdown') {\r\n                                internalX = x;\r\n                                internalY = y;\r\n                            }\r\n                            if (event.button === 'left' && event.type === 'pointermove') {\r\n                                if (!lock) {\r\n                                    internalX += event.dX;\r\n                                }\r\n                                x = Math.max(0, Math.min(areaw, internalX));\r\n                                internalY += event.dY;\r\n                                y = Math.max(0, Math.min(areah, internalY));\r\n                                update();\r\n                                callback({\r\n                                    x: x,\r\n                                    y: y\r\n                                });\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    curveArea.appendChild(point);\r\n\r\n                    (point as any).setPos = function (newX, newY) {\r\n                        x = newX;\r\n                        y = newY;\r\n                        internalY = y;\r\n                        internalX = x;\r\n                        BB.css(point, {\r\n                            left: (x - gripSize / 2) + \"px\",\r\n                            top: (y - gripSize / 2) + \"px\"\r\n                        });\r\n                    };\r\n\r\n                    return point;\r\n                }\r\n\r\n                function updateControl(i, x, y) {\r\n                    if (mode === \"All\") {\r\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                    if (mode === \"Red\") {\r\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                    if (mode === \"Green\") {\r\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                    if (mode === \"Blue\") {\r\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                }\r\n\r\n                let p0 = createPoint(0, areah, function (val) {\r\n                    updateControl(0, val.x, val.y);\r\n                    update();\r\n                }, true);\r\n                let p1 = createPoint(areaw / 3, areah / 3 * 2, function (val) {\r\n                    updateControl(1, val.x, val.y);\r\n                    update();\r\n                });\r\n                let p2 = createPoint(areaw / 3 * 2, areah / 3, function (val) {\r\n                    updateControl(2, val.x, val.y);\r\n                    update();\r\n                });\r\n                let p3 = createPoint(areaw, 0, function (val) {\r\n                    updateControl(3, val.x, val.y);\r\n                    update();\r\n                }, true);\r\n\r\n\r\n                function update() {\r\n                    canvas.width = canvas.width;\r\n                    ctx = canvas.getContext(\"2d\");\r\n\r\n                    let outCurves = {\r\n                        r: [],\r\n                        g: [],\r\n                        b: []\r\n                    };\r\n                    for (let i = 0; i < curves.r.length; i++) {\r\n                        outCurves.r.push(curves.r[i]);\r\n                        outCurves.g.push(curves.g[i]);\r\n                        outCurves.b.push(curves.b[i]);\r\n                    }\r\n\r\n                    function drawCurve(curve) {\r\n                        ctx.beginPath();\r\n                        let spline = new BB.SplineInterpolator(curve);\r\n                        for (let i = 0; i < 100; i++) {\r\n                            let y = spline.interpolate(i / 100);\r\n                            y = Math.max(0, Math.min(1, y));\r\n\r\n                            if (i === 0) {\r\n                                ctx.moveTo(i / 100 * areaw, areah - y * areah);\r\n                            } else {\r\n                                ctx.lineTo(i / 100 * areaw, areah - y * areah);\r\n                            }\r\n                        }\r\n                        ctx.stroke();\r\n                    }\r\n\r\n                    ctx.save();\r\n                    if (mode === \"All\") {\r\n                        ctx.strokeStyle = \"black\";\r\n                        drawCurve(outCurves.r);\r\n                    } else {\r\n                        ctx.globalAlpha = 0.5;\r\n                        ctx.strokeStyle = \"red\";\r\n                        drawCurve(outCurves.r);\r\n                        ctx.strokeStyle = \"green\";\r\n                        drawCurve(outCurves.g);\r\n                        ctx.strokeStyle = \"blue\";\r\n                        drawCurve(outCurves.b);\r\n                    }\r\n                    ctx.restore();\r\n                    p.callback(outCurves);\r\n                }\r\n\r\n                update();\r\n\r\n\r\n                this.getDiv = function () {\r\n                    return div;\r\n                };\r\n                this.destroy = function() {\r\n                    (p0 as any).pointerListener.destroy();\r\n                    (p1 as any).pointerListener.destroy();\r\n                    (p2 as any).pointerListener.destroy();\r\n                    (p3 as any).pointerListener.destroy();\r\n                };\r\n            }\r\n\r\n            let input = new CurvesInput({\r\n                curves: curves,\r\n                callback: function (val) {\r\n                    curves = val;\r\n                    update();\r\n                }\r\n            });\r\n\r\n\r\n            div.appendChild(input.getDiv());\r\n\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            result.destroy = () => {\r\n                input.destroy();\r\n                texture.destroy();\r\n                modeButtons.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    curves: curves\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let curves = params.input.curves;\r\n        let history = params.history;\r\n        if (!context || curves === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glCurves\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const flip = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        let isHorizontal = true;\r\n        let isVertical = false;\r\n        let doFlipCanvas = true;\r\n        div.innerHTML = LANG('filter-flip-description') + \"<br/><br/>\";\r\n\r\n\r\n        let horizontalCheckbox = new Checkbox({\r\n            init: isHorizontal,\r\n            label: LANG('filter-flip-horizontal') + ' ',\r\n            allowTab: true,\r\n            callback: function(v) {\r\n                isHorizontal = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n        let verticalCheckbox = new Checkbox({\r\n            init: isVertical,\r\n            label: LANG('filter-flip-vertical') + ' ',\r\n            allowTab: true,\r\n            callback: function(v) {\r\n                isVertical = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n        div.appendChild(horizontalCheckbox.getElement());\r\n        div.appendChild(verticalCheckbox.getElement());\r\n\r\n\r\n\r\n\r\n\r\n        let fcOption = document.createElement(\"div\");\r\n        BB.setEventListener(fcOption, 'onpointerdown', function () {\r\n            return false;\r\n        });\r\n        fcOption.textContent = LANG('filter-flip-image');\r\n        fcOption.style.width = \"150px\";\r\n        fcOption.style.height = \"30px\";\r\n        fcOption.style.paddingTop = \"10px\";\r\n        fcOption.style.textAlign = \"center\";\r\n        fcOption.style.cssFloat = \"left\";\r\n        fcOption.style.paddingBottom = \"0px\";\r\n        fcOption.style.borderTopLeftRadius = \"10px\";\r\n        fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n        fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n        fcOption.style.backgroundSize = '8%';\r\n        fcOption.style.backgroundColor = \"#9e9e9e\";\r\n\r\n        let flOption = document.createElement(\"div\");\r\n        BB.setEventListener(flOption, 'onpointerdown', function () {\r\n            return false;\r\n        });\r\n        flOption.textContent = LANG('filter-flip-layer');\r\n        flOption.style.width = \"150px\";\r\n        flOption.style.height = \"30px\";\r\n        flOption.style.paddingTop = \"10px\";\r\n        flOption.style.textAlign = \"center\";\r\n        flOption.style.cssFloat = \"left\";\r\n        flOption.style.paddingBottom = \"0px\";\r\n        flOption.style.borderTopRightRadius = \"10px\";\r\n        flOption.style.cursor = \"pointer\";\r\n        flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n        flOption.style.backgroundSize = '8%';\r\n\r\n        BB.setEventListener(fcOption, 'onpointerover', function () {\r\n            if (doFlipCanvas === false)\r\n                fcOption.style.backgroundColor = \"#ccc\";\r\n        });\r\n        BB.setEventListener(fcOption, 'onpointerout', function () {\r\n            if (doFlipCanvas === false)\r\n                fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n        });\r\n        BB.setEventListener(flOption, 'onpointerover', function () {\r\n            if (doFlipCanvas === true)\r\n                flOption.style.backgroundColor = \"#ccc\";\r\n        });\r\n        BB.setEventListener(flOption, 'onpointerout', function () {\r\n            if (doFlipCanvas === true)\r\n                flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n        });\r\n\r\n        fcOption.onclick = function () {\r\n            doFlipCanvas = true;\r\n\r\n            flOption.style.background = \"\";\r\n            flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            flOption.style.boxShadow = \"\";\r\n            flOption.style.cursor = \"pointer\";\r\n\r\n            fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n            fcOption.style.backgroundSize = '8%';\r\n            fcOption.style.backgroundColor = \"#9e9e9e\";\r\n            fcOption.style.cursor = \"default\";\r\n            fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n\r\n            updatePreview();\r\n        };\r\n        flOption.onclick = function () {\r\n            doFlipCanvas = false;\r\n\r\n            fcOption.style.background = \"\";\r\n            fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            fcOption.style.boxShadow = \"\";\r\n            fcOption.style.cursor = \"pointer\";\r\n\r\n            flOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n            flOption.style.backgroundSize = '8%';\r\n            flOption.style.backgroundColor = \"#9e9e9e\";\r\n            flOption.style.cursor = \"default\";\r\n            flOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n\r\n            updatePreview();\r\n        };\r\n\r\n        let optionWrapper = document.createElement(\"div\");\r\n        optionWrapper.appendChild(fcOption);\r\n        optionWrapper.appendChild(flOption);\r\n        div.appendChild(optionWrapper);\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(Math.round(w), Math.round(h)),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over' as IMixMode,\r\n        };\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: [previewLayer]\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        function updatePreview() {\r\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\r\n\r\n            if (doFlipCanvas) {\r\n                if (isHorizontal) {\r\n                    ctx.translate(previewLayer.image.width, 0);\r\n                    ctx.scale(-1, 1);\r\n                }\r\n                if (isVertical) {\r\n                    ctx.translate(0, previewLayer.image.height);\r\n                    ctx.scale(1, -1);\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < layers.length; i++) {\r\n                ctx.save();\r\n                if (!doFlipCanvas && selectedLayerIndex === i) {\r\n                    if (isHorizontal) {\r\n                        ctx.translate(previewLayer.image.width, 0);\r\n                        ctx.scale(-1, 1);\r\n                    }\r\n                    if (isVertical) {\r\n                        ctx.translate(0, previewLayer.image.height);\r\n                        ctx.scale(1, -1);\r\n                    }\r\n                }\r\n                if (ctx.canvas.width > layers[i].context.canvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.globalAlpha = layers[i].opacity;\r\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\r\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\r\n                ctx.restore();\r\n            }\r\n            klCanvasPreview.render();\r\n            ctx.restore();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            horizontalCheckbox.destroy();\r\n            verticalCheckbox.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return {\r\n                horizontal: isHorizontal,\r\n                vertical: isVertical,\r\n                flipCanvas: doFlipCanvas\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        let history = params.history;\r\n        let horizontal = params.input.horizontal;\r\n        let vertical = params.input.vertical;\r\n        let flipCanvas = params.input.flipCanvas;\r\n        if (!context || !canvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        canvas.flip(horizontal, vertical, flipCanvas ? null : canvas.getLayerIndex(context.canvas));\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: [\"filter\", \"flip\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const glPerspective = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let isSmall = window.innerWidth < 550;\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n\r\n        let pointerListenerArr = [];\r\n\r\n        function finishInit() {\r\n            div.innerHTML = LANG('filter-perspective-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n            let ba, bb, bc, bd; //before\r\n            let aa, ab, ac, ad; //after\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).perspective(\r\n                        [ba.x, ba.y, bb.x, bb.y, bc.x, bc.y, bd.x, bd.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        }),\r\n                        [aa.x, aa.y, ab.x, ab.y, ac.x, ac.y, ad.x, ad.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        })\r\n                    ).update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob(x, y, callback?) {\r\n                let nobSize = 14;\r\n                let div = document.createElement(\"div\");\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                BB.css(div, {\r\n                    width: nobSize + \"px\",\r\n                    height: nobSize + \"px\",\r\n                    backgroundColor: \"#fff\",\r\n                    boxShadow: \"inset 0 0 0 2px #000\",\r\n                    borderRadius: nobSize + \"px\",\r\n                    position: \"absolute\",\r\n                    cursor: \"move\",\r\n                    left: ((div as any).x - nobSize / 2) + \"px\",\r\n                    top: ((div as any).y - nobSize / 2) + \"px\",\r\n                    userSelect: 'none',\r\n                    touchAction: 'none',\r\n                });\r\n\r\n                let pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    maxPointers: 1,\r\n                    onPointer: function(event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                            if (callback) {\r\n                                callback();\r\n                            }\r\n                            update();\r\n                        }\r\n                    }\r\n                });\r\n                (div as any).copy = function (p) {\r\n                    (div as any).x = p.x;\r\n                    (div as any).y = p.y;\r\n                    div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                    div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                };\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            function updateAfter() {\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            }\r\n\r\n            ba = nob(0, 0, updateAfter);\r\n            bb = nob(displayW, 0, updateAfter);\r\n            bc = nob(displayW, displayH, updateAfter);\r\n            bd = nob(0, displayH, updateAfter);\r\n            aa = nob(0, 0);\r\n            ab = nob(displayW, 0);\r\n            ac = nob(displayW, displayH);\r\n            ad = nob(0, displayH);\r\n\r\n            let before = false;\r\n            let beforeOption = document.createElement(\"div\");\r\n            BB.setEventListener(beforeOption, 'onpointerdown', function () {\r\n                return false;\r\n            });\r\n            beforeOption.textContent = LANG('filter-perspective-before');\r\n            beforeOption.style.width = \"150px\";\r\n            beforeOption.style.height = \"30px\";\r\n            beforeOption.style.marginLeft = isSmall ? '0' : \"100px\";\r\n            beforeOption.style.paddingTop = \"10px\";\r\n            beforeOption.style.textAlign = \"center\";\r\n            beforeOption.style.cssFloat = \"left\";\r\n            beforeOption.style.paddingBottom = \"0px\";\r\n            beforeOption.style.borderTopLeftRadius = \"10px\";\r\n            beforeOption.style.cursor = \"pointer\";\r\n            beforeOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            beforeOption.style.backgroundSize = '8%';\r\n\r\n            let afterOption = document.createElement(\"div\");\r\n            BB.setEventListener(afterOption, 'onpointerdown', function () {\r\n                return false;\r\n            });\r\n            afterOption.textContent = LANG('filter-perspective-after');\r\n            afterOption.style.width = \"150px\";\r\n            afterOption.style.height = \"30px\";\r\n            afterOption.style.paddingTop = \"10px\";\r\n            afterOption.style.textAlign = \"center\";\r\n            afterOption.style.cssFloat = \"left\";\r\n            afterOption.style.paddingBottom = \"0px\";\r\n            afterOption.style.borderTopRightRadius = \"10px\";\r\n            afterOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n            afterOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n            afterOption.style.backgroundSize = '8%';\r\n            afterOption.style.backgroundColor = \"#9e9e9e\";\r\n\r\n\r\n            BB.setEventListener(beforeOption, 'onpointerover', function () {\r\n                if (before === false)\r\n                    beforeOption.style.backgroundColor = \"#ccc\";\r\n            });\r\n            BB.setEventListener(beforeOption, 'onpointerout', function () {\r\n                if (before === false)\r\n                    beforeOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            });\r\n            BB.setEventListener(afterOption, 'onpointerover', function () {\r\n                if (before === true)\r\n                    afterOption.style.backgroundColor = \"#ccc\";\r\n            });\r\n            BB.setEventListener(afterOption, 'onpointerout', function () {\r\n                if (before === true)\r\n                    afterOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            });\r\n\r\n            beforeOption.onclick = function () {\r\n\r\n                beforeOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n                beforeOption.style.backgroundSize = '8%';\r\n                beforeOption.style.backgroundColor = \"#9e9e9e\";\r\n                beforeOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n                beforeOption.style.cursor = \"default\";\r\n\r\n                afterOption.style.background = \"\";\r\n                afterOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n                afterOption.style.boxShadow = \"\";\r\n                afterOption.style.cursor = \"pointer\";\r\n\r\n                aa.style.display = \"none\";\r\n                ab.style.display = \"none\";\r\n                ac.style.display = \"none\";\r\n                ad.style.display = \"none\";\r\n\r\n                ba.style.display = \"block\";\r\n                bb.style.display = \"block\";\r\n                bc.style.display = \"block\";\r\n                bd.style.display = \"block\";\r\n                ba.copy(aa);\r\n                bb.copy(ab);\r\n                bc.copy(ac);\r\n                bd.copy(ad);\r\n                before = true;\r\n                update();\r\n            };\r\n            afterOption.onclick = function () {\r\n                before = false;\r\n\r\n                afterOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n                afterOption.style.backgroundSize = '8%';\r\n                afterOption.style.backgroundColor = \"#9e9e9e\";\r\n                afterOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n                afterOption.style.cursor = \"default\";\r\n\r\n                beforeOption.style.background = \"\";\r\n                beforeOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n                beforeOption.style.boxShadow = \"\";\r\n                beforeOption.style.cursor = \"pointer\";\r\n\r\n                ba.style.display = \"none\";\r\n                bb.style.display = \"none\";\r\n                bc.style.display = \"none\";\r\n                bd.style.display = \"none\";\r\n\r\n                aa.style.display = \"block\";\r\n                ab.style.display = \"block\";\r\n                ac.style.display = \"block\";\r\n                ad.style.display = \"block\";\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            };\r\n\r\n            let optionWrapper = document.createElement(\"div\");\r\n            optionWrapper.appendChild(beforeOption);\r\n            optionWrapper.appendChild(afterOption);\r\n            div.appendChild(optionWrapper);\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n            BB.css(previewWrapper, {\r\n                width: isSmall ? '340px' : '540px',\r\n                marginLeft: \"-20px\",\r\n                height: isSmall ? '260px' : '300px',\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    let canvas = i === selectedLayerIndex ? glCanvas : layers[i].context.canvas;\r\n                    previewLayerArr.push({\r\n                        image: canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.appendChild(aa);\r\n            previewInnerWrapper.appendChild(ab);\r\n            previewInnerWrapper.appendChild(ac);\r\n            previewInnerWrapper.appendChild(ad);\r\n\r\n            ba.style.display = \"none\";\r\n            bb.style.display = \"none\";\r\n            bc.style.display = \"none\";\r\n            bd.style.display = \"none\";\r\n            previewInnerWrapper.appendChild(ba);\r\n            previewInnerWrapper.appendChild(bb);\r\n            previewInnerWrapper.appendChild(bc);\r\n            previewInnerWrapper.appendChild(bd);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n            update();\r\n            result.destroy = () => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    before: [\r\n                        ba.x / displayPreviewFactor,\r\n                        ba.y / displayPreviewFactor,\r\n\r\n                        bb.x / displayPreviewFactor,\r\n                        bb.y / displayPreviewFactor,\r\n\r\n                        bc.x / displayPreviewFactor,\r\n                        bc.y / displayPreviewFactor,\r\n\r\n                        bd.x / displayPreviewFactor,\r\n                        bd.y / displayPreviewFactor,\r\n                    ],\r\n                    after: [\r\n                        aa.x / displayPreviewFactor,\r\n                        aa.y / displayPreviewFactor,\r\n\r\n                        ab.x / displayPreviewFactor,\r\n                        ab.y / displayPreviewFactor,\r\n\r\n                        ac.x / displayPreviewFactor,\r\n                        ac.y / displayPreviewFactor,\r\n\r\n                        ad.x / displayPreviewFactor,\r\n                        ad.y / displayPreviewFactor,\r\n                    ]\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let before = params.input.before;\r\n        let after = params.input.after;\r\n        if (!context || !before || !after || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        let w = context.canvas.width;\r\n        let h = context.canvas.height;\r\n        glCanvas.draw(texture).perspective(before, after).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glPerspective\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eFiVD\");","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const glHueSaturation = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height,280, 200,  1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        function finishInit() {\r\n            let hue = 0, Saturation = 0;\r\n            div.innerHTML = LANG('filter-hue-sat-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let hueSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-hue'),\r\n                width: 300,\r\n                height: 30,\r\n                min: -100,\r\n                max: 100,\r\n                initValue: hue * 100,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    hue = val / 100;\r\n                    glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\r\n                    klCanvasPreview.render();\r\n                }\r\n            });\r\n            let saturationSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-saturation'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                initValue: (Saturation + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    Saturation = val / 50 - 1;\r\n                    glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\r\n                    klCanvasPreview.render();\r\n                }\r\n            });\r\n            hueSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(hueSlider.getElement());\r\n            div.appendChild(saturationSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                hueSlider.destroy();\r\n                saturationSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    hue: hue,\r\n                    Saturation: Saturation\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let hue = params.input.hue;\r\n        let history = params.history;\r\n        let Saturation = params.input.Saturation;\r\n        if (!context || hue === null || Saturation === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glHueSaturation\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply} from '../kl.types';\r\n\r\nexport const invert = {\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false;\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).invert().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"invert\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {Select} from '../ui/base-components/select';\r\n// @ts-ignore\r\nimport constrainImg from 'url:~/src/app/img/ui/constrain.svg';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const resize = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        //BB.centerWithin\r\n        let canvas = params.canvas;\r\n        if (!canvas)\r\n            return false;\r\n\r\n        let fit = BB.fitInto( canvas.getWidth(), canvas.getHeight(), 280, 200,1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let previewFactor = w / canvas.getWidth();\r\n        let tempCanvas = canvas.getCompleteCanvas(1);\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        let newWidth = canvas.getWidth(), newHeight = canvas.getHeight();\r\n\r\n        div.innerHTML = LANG('filter-resize-description') + \"<br/><br/>\";\r\n\r\n\r\n        let maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n\r\n        let widthWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            }\r\n        });\r\n        let heightWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            }\r\n        });\r\n        let widthInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxWidth,\r\n                value: '' + canvas.getWidth(),\r\n            }\r\n        }) as HTMLInputElement;\r\n        let heightInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxHeight,\r\n                value: '' + canvas.getHeight(),\r\n            }\r\n        }) as HTMLInputElement;\r\n        widthInput.onclick = function () {\r\n            (this as any).focus();\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onclick = function () {\r\n            (this as any).focus();\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthInput.onchange = function () {\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onchange = function () {\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthWrapper.append(LANG('width') + \": \", widthInput);\r\n        heightWrapper.append(LANG('height') + \": \", heightInput);\r\n        let inputWrapper = BB.el({\r\n            css: {\r\n                background: \"url(\" + constrainImg + \") no-repeat 140px 5px\",\r\n                backgroundSize: '50px 52px',\r\n            }\r\n        });\r\n        inputWrapper.append(widthWrapper, heightWrapper);\r\n        div.appendChild(inputWrapper);\r\n\r\n        //contrain checkbox\r\n        let heightChanged = false, widthChanged = false;\r\n        let ratio = canvas.getWidth() / canvas.getHeight();\r\n\r\n        function updateConstrain() {\r\n            if (isConstrained) {\r\n                widthInput.value = '' + canvas.getWidth();\r\n                heightInput.value = '' + canvas.getHeight();\r\n                inputWrapper.style.background = \"url(\" + constrainImg + \") no-repeat 140px 5px\";\r\n                inputWrapper.style.backgroundSize = '50px 52px';\r\n                update();\r\n            } else {\r\n                inputWrapper.style.background = \"\";\r\n            }\r\n        }\r\n\r\n        let isConstrained = true;\r\n        let constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isConstrained = b;\r\n                updateConstrain();\r\n            }\r\n        });\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both'\r\n            }\r\n        }));\r\n\r\n\r\n        let algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')]\r\n            ],\r\n            title: LANG('scaling-algorithm'),\r\n            initValue: 'smooth',\r\n            onChange: function() {\r\n                update();\r\n            },\r\n        });\r\n\r\n        let secondRowElement = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between'\r\n            }\r\n        });\r\n        secondRowElement.appendChild(constrainCheckbox.getElement());\r\n        secondRowElement.appendChild(algorithmSelect.getElement());\r\n\r\n        let previewCanvas = BB.canvas(w, h);\r\n        previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n\r\n        let previewCtx = previewCanvas.getContext('2d');\r\n\r\n\r\n        function draw() {\r\n            if (algorithmSelect.getValue() === 'smooth') {\r\n                previewCanvas.style.imageRendering = previewFactor > 1 ? 'pixelated' : '';\r\n\r\n                previewCanvas.width = canvas.getWidth();\r\n                previewCanvas.height = canvas.getHeight();\r\n\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingQuality = 'high';\r\n                previewCtx.drawImage(tempCanvas, 0, 0);\r\n                BB.resizeCanvas(previewCanvas, newWidth, newHeight);\r\n                previewCtx.restore();\r\n\r\n            } else {\r\n                previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n                previewCanvas.width = newWidth;\r\n                previewCanvas.height = newHeight;\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingEnabled = false;\r\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\r\n                previewCtx.restore();\r\n            }\r\n\r\n        }\r\n\r\n        function update() {\r\n            if ((widthInput.value.length === 0 && widthChanged) || (heightInput.value.length === 0 && heightChanged)) {\r\n                heightChanged = false;\r\n                widthChanged = false;\r\n                return;\r\n            }\r\n            widthInput.value = '' + Math.max(1, parseInt(widthInput.value));\r\n            heightInput.value = '' + Math.max(1, parseInt(heightInput.value));\r\n            if (isConstrained) {\r\n                if (heightChanged) {\r\n                    widthInput.value = '' + parseInt('' + (parseInt(heightInput.value) * ratio));\r\n                }\r\n                if (widthChanged) {\r\n                    heightInput.value = '' + parseInt('' + (parseInt(widthInput.value) / ratio));\r\n                }\r\n\r\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\r\n                    let fit = BB.fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\r\n                    widthInput.value = '' + parseInt('' + fit.width);\r\n                    heightInput.value = '' + parseInt('' + fit.height);\r\n                }\r\n            }\r\n\r\n            if (parseInt(widthInput.value) > maxWidth) {\r\n                widthInput.value = '' + maxWidth;\r\n            }\r\n            if (parseInt(heightInput.value) > maxHeight) {\r\n                heightInput.value = '' + maxHeight;\r\n            }\r\n\r\n            heightChanged = false;\r\n            widthChanged = false;\r\n\r\n            newWidth = parseInt(widthInput.value);\r\n            newHeight = parseInt(heightInput.value);\r\n\r\n            let preview = BB.fitInto(newWidth, newHeight, 280, 200, 1);\r\n            let previewW = parseInt('' + preview.width), previewH = parseInt('' + preview.height);\r\n            previewFactor = previewW / newWidth;\r\n\r\n            let offset = BB.centerWithin(340, 220, previewW, previewH);\r\n\r\n            draw();\r\n\r\n            previewCanvas.style.width = Math.max(1, previewW) + \"px\";\r\n            previewCanvas.style.height = Math.max(1, previewH) + \"px\";\r\n            canvasWrapper.style.left = offset.x + \"px\";\r\n            canvasWrapper.style.top = offset.y + \"px\";\r\n            canvasWrapper.style.width = Math.max(1, previewW) + \"px\";\r\n            canvasWrapper.style.height = Math.max(1, previewH) + \"px\";\r\n        }\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            display: \"table\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n\r\n        let canvasWrapper = BB.appendTextDiv(previewWrapper, \"\");\r\n        canvasWrapper.appendChild(previewCanvas);\r\n        canvasWrapper.style.width = w + \"px\";\r\n        canvasWrapper.style.height = h + \"px\";\r\n        canvasWrapper.style.position = \"absolute\";\r\n        canvasWrapper.style.overflow = \"hidden\";\r\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\r\n        canvasWrapper.style.overflow = \"hidden\";\r\n        BB.createCheckerDataUrl(8, function (url) {\r\n            previewWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n\r\n        div.appendChild(previewWrapper);\r\n        update();\r\n\r\n        result.destroy = () => {\r\n            constrainCheckbox.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return {\r\n                width: newWidth,\r\n                height: newHeight,\r\n                algorithm: algorithmSelect.getValue()\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let canvas = params.canvas;\r\n        let history = params.history;\r\n        let width = params.input.width;\r\n        let height = params.input.height;\r\n        let algorithm = params.input.algorithm;\r\n        if (!canvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        canvas.resize(width, height, algorithm);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"resize\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const glTiltShift = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let previewFactor = w / context.canvas.width;\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        let pointerListenerArr = [];\r\n\r\n        function finishInit() {\r\n            let blur = 20, gradient = 200;\r\n            div.innerHTML = LANG('filter-tilt-shift-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n            let fa, fb; // focus line\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).tiltShift(\r\n                        fa.x / displayPreviewFactor * previewFactor,\r\n                        fa.y / displayPreviewFactor * previewFactor,\r\n                        fb.x / displayPreviewFactor * previewFactor,\r\n                        fb.y / displayPreviewFactor * previewFactor,\r\n                        blur * previewFactor,\r\n                        gradient * previewFactor\r\n                    ).update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob(x, y) {\r\n                let nobSize = 14;\r\n                let div = BB.el({\r\n                    css: {\r\n                        width: nobSize + \"px\",\r\n                        height: nobSize + \"px\",\r\n                        backgroundColor: '#fff',\r\n                        boxShadow: \"inset 0 0 0 2px #000\",\r\n                        borderRadius: nobSize + \"px\",\r\n                        position: \"absolute\",\r\n                        cursor: 'move',\r\n                        left: (x - nobSize / 2) + \"px\",\r\n                        top: (y - nobSize / 2) + \"px\",\r\n                        userSelect: 'none',\r\n                        touchAction: 'none',\r\n                    }\r\n                });\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                let pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    maxPointers: 1,\r\n                    onPointer: function(event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                            update();\r\n                        }\r\n                    }\r\n                });\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            fa = nob(parseInt('' + (displayW / 6)), parseInt('' + (displayH / 2)));\r\n            fb = nob(parseInt('' + (displayW - displayW / 6)), parseInt('' + (displayH - displayH / 3)));\r\n\r\n            let blurSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-blur'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                initValue: blur,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    blur = val;\r\n                    update();\r\n                }\r\n            });\r\n            blurSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(blurSlider.getElement());\r\n            let gradientSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-gradient'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1000,\r\n                initValue: gradient,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    gradient = val;\r\n                    update();\r\n                }\r\n            });\r\n            div.appendChild(gradientSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.appendChild(fa);\r\n            previewInnerWrapper.appendChild(fb);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n            update();\r\n            result.destroy = () => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                blurSlider.destroy();\r\n                gradientSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    a: {x: fa.x / displayPreviewFactor, y: fa.y / displayPreviewFactor},\r\n                    b: {x: fb.x / displayPreviewFactor, y: fb.y / displayPreviewFactor},\r\n                    blur: blur,\r\n                    gradient: gradient\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let a = params.input.a;\r\n        let b = params.input.b;\r\n        let blur = params.input.blur;\r\n        let gradient = params.input.gradient;\r\n        if (!context || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).tiltShift(a.x, a.y, b.x, b.y, blur, gradient).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glTiltShift\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const rotate = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let canvas = params.canvas;\r\n        if (!canvas)\r\n            return false;\r\n\r\n        let fit = BB.fitInto(canvas.getWidth(), canvas.getHeight(), 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let previewFactor = w / canvas.getWidth();\r\n        let tempCanvas = BB.canvas(w, h);\r\n        tempCanvas.style.display = 'block';\r\n        tempCanvas.getContext(\"2d\").drawImage(canvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        let deg = 0;\r\n        div.innerHTML = LANG('filter-rotate-description') + \"<br/><br/>\";\r\n\r\n        let first = true;\r\n\r\n        function update() {\r\n            (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg)\";\r\n            (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg)\";\r\n            (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg)\";\r\n            (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg)\";\r\n            if (Math.abs(deg % 180) === 90) {\r\n                //height has to fit width because of rotation\r\n                let fit = BB.fitInto(h, w, 280, 200, 1);\r\n                let scale = parseInt('' + fit.height) / w;\r\n                (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n                (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n                (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n                (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n            }\r\n        }\r\n\r\n        let btnPlus = document.createElement(\"button\");\r\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        let btnMinus = document.createElement(\"button\");\r\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        btnMinus.style.marginRight = '5px';\r\n\r\n\r\n        btnPlus.onclick = function () {\r\n            deg += 90;\r\n            update();\r\n        };\r\n        btnMinus.onclick = function () {\r\n            deg -= 90;\r\n            update();\r\n        };\r\n\r\n        div.appendChild(btnMinus);\r\n        div.appendChild(btnPlus);\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            display: \"table\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewcell = document.createElement(\"div\");\r\n        previewcell.style.display = \"table-cell\";\r\n        previewcell.style.verticalAlign = \"middle\";\r\n        let canvasWrapper = BB.appendTextDiv(previewcell, \"\");\r\n        canvasWrapper.appendChild(tempCanvas);\r\n        previewWrapper.appendChild(previewcell);\r\n        canvasWrapper.style.width = w + \"px\";\r\n        canvasWrapper.style.height = h + \"px\";\r\n        canvasWrapper.style.marginLeft = \"auto\";\r\n        canvasWrapper.style.marginRight = \"auto\";\r\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\r\n        canvasWrapper.style.overflow = \"hidden\";\r\n        BB.createCheckerDataUrl(4, function (url) {\r\n            canvasWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n        canvasWrapper.style.transition = \"all 0.2s ease-out\";\r\n\r\n        div.appendChild(previewWrapper);\r\n        update();\r\n\r\n        result.getInput = function () {\r\n            return {\r\n                deg: deg\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let canvas = params.canvas;\r\n        let history = params.history;\r\n        let deg = params.input.deg;\r\n        if (!canvas || !history)\r\n            return false;\r\n        history.pause(true);\r\n        canvas.rotate(deg);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"rotate\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2BZYe\");","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {FreeTransform, ITransform} from '../ui/components/free-transform';\r\nimport {Select} from '../ui/base-components/select';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\ninterface IFilterTransformInput {\r\n    bounds: {x: number, y: number, width: number, height: number};\r\n    transform: ITransform;\r\n    isPixelated: boolean;\r\n}\r\n\r\nexport const transform = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let i;\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let isSmall = window.innerWidth < 550;\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n        let freeTransform: FreeTransform;\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        // determine bounds and initial transformation\r\n        let boundsObj: {\r\n            x: number;\r\n            y: number;\r\n            width: number;\r\n            height: number;\r\n        } = { x: 0, y: 0, width: 0, height: 0 };\r\n        {\r\n            let tempBounds: any = {\r\n                x1: null,\r\n                y1: null,\r\n                x2: null,\r\n                y2: null\r\n            };\r\n            let imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\r\n\r\n            if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\r\n                tempBounds.x1 = 0;\r\n                tempBounds.y1 = 0;\r\n                tempBounds.x2 = context.canvas.width - 1;\r\n                tempBounds.y2 = context.canvas.height - 1;\r\n            } else {\r\n                for (i = 3; i < imdat.data.length; i += 4) {\r\n                    if (imdat.data[i] > 0 ) {\r\n                        let x = ((i - 3) / 4) %  context.canvas.width;\r\n                        let y = Math.floor((i - 3) / 4 / context.canvas.width);\r\n                        if (tempBounds.x1 > x || tempBounds.x1 === null) {\r\n                            tempBounds.x1 = x;\r\n                        }\r\n                        if (tempBounds.y1 === null) {\r\n                            tempBounds.y1 = y;\r\n                        }\r\n                        if (tempBounds.x2 < x || tempBounds.x2 === null) {\r\n                            tempBounds.x2 = x;\r\n                        }\r\n                        if (tempBounds.y2 < y || tempBounds.y2 === null) {\r\n                            tempBounds.y2 = y;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if (tempBounds.x1 === null || tempBounds.y1 === null) {\r\n                alert(LANG('filter-transform-empty'));\r\n                return false;\r\n            }\r\n            boundsObj.x = tempBounds.x1;\r\n            boundsObj.y = tempBounds.y1;\r\n            boundsObj.width = tempBounds.x2 - tempBounds.x1 + 1;\r\n            boundsObj.height = tempBounds.y2 - tempBounds.y1 + 1;\r\n        }\r\n\r\n        const initTransform = {\r\n            x: boundsObj.x + boundsObj.width / 2,\r\n            y: boundsObj.y + boundsObj.height / 2,\r\n            width: boundsObj.width,\r\n            height: boundsObj.height,\r\n            angleDeg: 0,\r\n        };\r\n\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        div.innerHTML = LANG('filter-transform-description');\r\n\r\n        let keyListener = new BB.KeyListener({\r\n            onDown: function(keyStr) {\r\n                if (BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n\r\n                if (keyStr === 'left') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'right') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'up') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'down') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n            }\r\n\r\n        });\r\n\r\n        let leftWrapper = document.createElement(\"div\");\r\n        let rightWrapper = document.createElement(\"div\");\r\n        let rotWrapper = document.createElement(\"div\");\r\n        let inputY = document.createElement(\"input\");\r\n        let inputX = document.createElement(\"input\");\r\n        let inputR = document.createElement(\"input\");\r\n        leftWrapper.style.width = \"100px\";\r\n        leftWrapper.style.height = \"30px\";\r\n        rightWrapper.style.width = \"100px\";\r\n        rightWrapper.style.height = \"30px\";\r\n        rightWrapper.style.display = \"inline-block\";\r\n        leftWrapper.style.display = \"inline-block\";\r\n        rotWrapper.style.display = \"inline-block\";\r\n        rotWrapper.style.width = \"150px\";\r\n        rotWrapper.style.height = \"30px\";\r\n        inputY.type = \"number\";\r\n        inputX.type = \"number\";\r\n        inputR.type = \"number\";\r\n        inputX.style.width = 70 + \"px\";\r\n        inputY.style.width = 70 + \"px\";\r\n        inputR.style.width = 70 + \"px\";\r\n        inputY.value = '0';\r\n        inputX.value = '0';\r\n        inputR.value = '0';\r\n        inputY.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputX.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputR.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputY.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputY.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        leftWrapper.append(\"X: \", inputX);\r\n        rightWrapper.append(\"Y: \", inputY);\r\n        rotWrapper.append(LANG('filter-transform-rotation') + ': ', inputR);\r\n        if (!isSmall) {\r\n            const inputRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\r\n        }\r\n\r\n        // buttons\r\n        const actionBtnCss = {\r\n            marginLeft: '10px',\r\n            marginTop: '10px',\r\n        };\r\n        const buttonRow = BB.el ({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginLeft: '-10px',\r\n            }\r\n        });\r\n        const flipXBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' X',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(-t.width, t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const flipYBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' Y',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(t.width, -t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotLeftBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '-90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg -= 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotRightBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '+90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg += 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleDoubleBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                if (constrainCheckbox.getValue()) {\r\n                    freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\r\n                } else {\r\n                    freeTransform.setSize(t.width * 2, t.height * 2);\r\n                }\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleHalfBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '1/2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const centerBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('center'),\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setPos({ x: context.canvas.width / 2, y: context.canvas.height / 2 });\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n\r\n\r\n\r\n\r\n\r\n        let isConstrained = true;\r\n        let constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-constrain'),\r\n            title: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isConstrained = b;\r\n                freeTransform.setConstrained(isConstrained);\r\n            },\r\n            css: {\r\n                display: 'inline-block'\r\n            }\r\n        });\r\n        let isSnapping = false;\r\n        let snappingCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-snap'),\r\n            title: LANG('filter-transform-snap-title'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isSnapping = b;\r\n                freeTransform.setSnapping(isSnapping);\r\n            },\r\n            css: {\r\n                display: 'inline-block',\r\n                marginLeft: '10px',\r\n            }\r\n        });\r\n        const checkboxWrapper = BB.el({});\r\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\r\n\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n                height: '10px'\r\n            }\r\n        }));\r\n\r\n        const bottomRow = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n            }\r\n        });\r\n\r\n        let algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')]\r\n            ],\r\n            initValue: 'smooth',\r\n            title: LANG('scaling-algorithm'),\r\n            onChange: function() {\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        BB.css(previewWrapper, {\r\n            width: isSmall ? '340px' : '540px',\r\n            marginLeft: \"-20px\",\r\n            height: isSmall ? '260px' : '300px',\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayerArr: IKlBasicLayer[] = [];\r\n        {\r\n            for (let i = 0; i < layers.length; i++) {\r\n                let canvas;\r\n                if (i === selectedLayerIndex) {\r\n                    canvas = BB.canvas(parseInt('' + w), parseInt('' + h));\r\n                    let ctx = canvas.getContext('2d');\r\n                    ctx.drawImage(layers[i].context.canvas, 0, 0, canvas.width, canvas.height);\r\n                } else {\r\n                    canvas = layers[i].context.canvas;\r\n                }\r\n                previewLayerArr.push({\r\n                    image: canvas,\r\n                    opacity: layers[i].opacity,\r\n                    mixModeStr: layers[i].mixModeStr\r\n                });\r\n            }\r\n        }\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: parseInt('' + displayW),\r\n            height: parseInt('' + displayH),\r\n            layers: previewLayerArr\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + displayW) + 'px',\r\n                height: parseInt('' + displayH) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        let lastDrawnTransformStr;\r\n        function updatePreview(doForce: boolean = false) {\r\n            if (!freeTransform) {\r\n                return;\r\n            }\r\n            let transform = freeTransform.getTransform();\r\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) {\r\n                return;\r\n            }\r\n            lastDrawnTransformStr = JSON.stringify(transform);\r\n            if (displayPreviewFactor < 1) {\r\n                transform.x *= displayPreviewFactor;\r\n                transform.y *= displayPreviewFactor;\r\n                transform.width *= displayPreviewFactor;\r\n                transform.height *= displayPreviewFactor;\r\n            }\r\n            let transformLayerCanvas = previewLayerArr[selectedLayerIndex].image as HTMLCanvasElement;\r\n            let ctx = transformLayerCanvas.getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, transformLayerCanvas.width, transformLayerCanvas.height);\r\n            BB.drawTransformedImageWithBounds(\r\n                ctx,\r\n                layers[selectedLayerIndex].context.canvas,\r\n                transform,\r\n                boundsObj,\r\n                algorithmSelect.getValue() === 'pixelated' ||\r\n                BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            );\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: initTransform.angleDeg,\r\n            isConstrained: true,\r\n            snapX: [0, context.canvas.width],\r\n            snapY: [0, context.canvas.height],\r\n            callback: function (t) {\r\n                inputX.value = '' + Math.round(t.x - initTransform.x);\r\n                inputY.value = '' + Math.round(t.y - initTransform.y);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            scale: displayPreviewFactor\r\n        });\r\n        BB.css(freeTransform.getElement(), {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0'\r\n        });\r\n        previewInnerWrapper.appendChild(freeTransform.getElement());\r\n\r\n        function onInputsChanged() {\r\n            freeTransform.setPos({\r\n                x: parseInt(inputX.value) + initTransform.x,\r\n                y: parseInt(inputY.value) + initTransform.y}\r\n            );\r\n            freeTransform.setAngleDeg(parseInt(inputR.value));\r\n            updatePreview();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            keyListener.destroy();\r\n            freeTransform.destroy();\r\n            constrainCheckbox.destroy();\r\n            snappingCheckbox.destroy();\r\n            BB.destroyEl(flipXBtn);\r\n            BB.destroyEl(flipYBtn);\r\n            BB.destroyEl(scaleRotLeftBtn);\r\n            BB.destroyEl(scaleRotRightBtn);\r\n            BB.destroyEl(scaleDoubleBtn);\r\n            BB.destroyEl(scaleHalfBtn);\r\n            BB.destroyEl(centerBtn);\r\n        };\r\n        result.getInput = function () {\r\n            const transform = freeTransform.getTransform();\r\n            let input = {\r\n                transform,\r\n                bounds: boundsObj,\r\n                isPixelated: algorithmSelect.getValue() === 'pixelated' ||\r\n                    BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            } as IFilterTransformInput;\r\n            result.destroy();\r\n            return JSON.parse(JSON.stringify(input));\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const input: IFilterTransformInput = params.input;\r\n\r\n        let copyCanvas = BB.copyCanvas(context.canvas);\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            context,\r\n            copyCanvas,\r\n            input.transform,\r\n            input.bounds,\r\n            input.isPixelated,\r\n        );\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"transform\"],\r\n            action: \"apply\",\r\n            params: [{input}],\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const glBlur = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let canvas = params.canvas;\r\n        let context = params.context;\r\n        if (!canvas || !context) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let previewFactor = w / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n\r\n        function finishInit() {\r\n            let radius = 10;\r\n            div.innerHTML = LANG('filter-triangle-blur-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 1,\r\n                max: 200,\r\n                initValue: radius,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    radius = val;\r\n                    glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                    klCanvasPreview.render();\r\n                }\r\n            });\r\n            div.appendChild(radiusSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                texture.destroy();\r\n                radiusSlider.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let radius = params.input.radius;\r\n        if (!context || !radius || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).triangleBlur(radius).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glBlur\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const glUnsharpMask = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let previewFactor = w / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        function finishInit() {\r\n            let radius = 2, strength = 5.1 / 10;\r\n            div.innerHTML = LANG('filter-unsharp-mask-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                initValue: 2,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    radius = val;\r\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 50], [1, 200]]\r\n            });\r\n            let strengthSlider = new KlSlider({\r\n                label: LANG('filter-unsharp-mask-strength'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 50,\r\n                initValue: 5.1,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    strength = val / 10;\r\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 10], [1, 50]]\r\n            });\r\n            radiusSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(radiusSlider.getElement());\r\n            div.appendChild(strengthSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                radiusSlider.destroy();\r\n                strengthSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius,\r\n                    strength: strength\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let radius = params.input.radius;\r\n        let strength = params.input.strength;\r\n        if (!context || radius === null || strength === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).unsharpMask(radius, strength).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glUnsharpMask\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const toAlpha = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        function finishInit() {\r\n            let radius = 2, strength = 5.1 / 10;\r\n            div.appendChild(BB.el({\r\n                content: LANG('filter-to-alpha-description'),\r\n                css: {\r\n                    marginBottom: '5px'\r\n                }\r\n            }));\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            function updatePreview() {\r\n                glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n                klCanvasPreview.render();\r\n            }\r\n\r\n            // source\r\n            let sourceId = 'inverted-luminance';\r\n            let sourceOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'inverted-luminance',\r\n                        label: LANG('filter-to-alpha-inverted-lum')\r\n                    },\r\n                    {\r\n                        id: 'luminance',\r\n                        label: LANG('filter-to-alpha-lum')\r\n                    }\r\n                ],\r\n                initialId: sourceId,\r\n                onChange: function(id) {\r\n                    sourceId = id;\r\n                    updatePreview();\r\n                }\r\n            });\r\n            div.appendChild(sourceOptions.getElement());\r\n\r\n            // color\r\n            let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n            let colorOptionsArr = [\r\n                null,\r\n                {r: 0, g: 0, b: 0, a: 1},\r\n                {r: 255, g: 255, b: 255, a: 1}\r\n            ];\r\n            colorOptionsArr.push({\r\n                r: params.currentColorRgb.r,\r\n                g: params.currentColorRgb.g,\r\n                b: params.currentColorRgb.b,\r\n                a: 1,\r\n            });\r\n            colorOptionsArr.push({\r\n                r: params.secondaryColorRgb.r,\r\n                g: params.secondaryColorRgb.g,\r\n                b: params.secondaryColorRgb.b,\r\n                a: 1,\r\n            });\r\n\r\n            let colorOptions = new ColorOptions({\r\n                label: LANG('filter-to-alpha-replace'),\r\n                colorArr: colorOptionsArr,\r\n                initialIndex: 1,\r\n                onChange: function(rgbaObj) {\r\n                    selectedRgbaObj = rgbaObj;\r\n                    updatePreview();\r\n                }\r\n            });\r\n            colorOptions.getElement().style.marginTop = '10px';\r\n            div.appendChild(colorOptions.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            setTimeout(function() { //ie has a problem otherwise...\r\n                try {\r\n                    updatePreview();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }, 1);\r\n\r\n            result.destroy = () => {\r\n                texture.destroy();\r\n                sourceOptions.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    sourceId: sourceId,\r\n                    selectedRgbaObj: selectedRgbaObj\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let sourceId = params.input.sourceId;\r\n        let selectedRgbaObj = params.input.selectedRgbaObj;\r\n        if (!context || !sourceId || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"toAlpha\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {KL} from '../kl';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\n\r\nexport async function klCanvasToPsdBlob(klCanvas: KlCanvas): Promise<Blob> {\r\n    let layerArr = klCanvas.getLayersFast();\r\n\r\n    let psdConfig = {\r\n        width: klCanvas.getWidth(),\r\n        height: klCanvas.getHeight(),\r\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\r\n        children: []\r\n    };\r\n    for (let i = 0; i < layerArr.length; i++) {\r\n        // todo - can be optimized if layer mostly empty\r\n        let item = layerArr[i];\r\n        psdConfig.children.push({\r\n            name: item.name,\r\n            opacity: item.opacity,\r\n            canvas: item.canvas,\r\n            blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n            left: 0,\r\n            top: 0\r\n        });\r\n    }\r\n\r\n    let agPsd = await import('ag-psd');\r\n    let buffer = agPsd.writePsdBuffer(psdConfig);\r\n    return new Blob([buffer], { type: 'application/octet-stream' });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"k9Nks\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"bBxqy\");"],"names":["$d2fa9a947070c225$export$a84540bc8b694b2d","p","klApp","agPsd","onProjectReady","project","isInitialized","Error","saveReminder","$5ngYX","SaveReminder","$gWfkn","klHistory","isDrawing","$3C7jC","KlApp","bottomBar","aboutEl","embed","url","embedUrl","onSubmit","init","loadingScreenEl","parentNode","removeChild","loadingScreenTextEl","document","body","appendChild","getEl","e","textContent","className","console","error","psdQueue","getElementById","$1mH1z","LANG","this","openProject","initError","getPNG","getPSD","$4gaLD","asyncToGenerator","$parcel$interopDefault","$cijLd","mark","_callee","readPSDs","psds","length","readItem","item","psd","readPsd","blob","$941rU","klPsdToKlProject","callback","forEach","parcelRequire","_ctx","sent","shift","push","Element","prototype","Object","defineProperty","value","x","y","scrollLeft","scrollTop","window","getItem","setItem","removeItem","t1","e1","Array","slice","call","arguments","n","createDocumentFragment","t","Node","createTextNode","String","Document","DocumentFragment","hasOwnProperty","configurable","enumerable","writable","insertBefore","firstChild","padStart","repeat","$cf5d938ee512ebca$export$96f6458b62e4c2c","pProject","pOptions","ref","translateSmoothing","s","sizeWatcher","val","brushSettingService","emitSize","klCanvasWorkspace","setCursorSize","importFinishedLoading","importedImage","filename","optionStr","getResizedDimensions","width","height","w","parseInt","h","klMaxCanvasSize","importAsImage","canvas","resizedDimensions","tempCanvas","$eWjiX","BB","getContext","drawImage","resizeCanvas","klCanvas","reset","image","layerName","layerManager","update","setCurrentLayer","getLayer","resetView","getScale","getAngleDeg","importAsImagePsd","convertedPsdObj","cropObj1","crop","targetCanvas","cropCanvas","cropObj","cropCanvas1","layers","i","i1","item1","layerIndex","showImportAsLayerDialog","klRootEl","transformObj","isPixelated","pause","addLayer","getLayers","renameLayer","activeLayerIndex","activeLayerContext","getLayerContext","drawTransformedImageWithBounds","tool","action","params","copyCanvas","isNaN","popup","target","type","message","buttons","$hrnUX","KL","showImportImageDialog","maxSize","res","importAsLayer","files","showWarningPsdFlattened","file","name","split","extension","toLowerCase","f1","maxResolution","size","doShowLoader","loaderIsOpen","result","closeLoader","f","FileReader","readerResult","loadAgPsd","then","agPsdLazy","replace","convertedPsd","PSD","skipLayerImageData","skipThumbnail","catch","alert","match","URL","webkitURL","createObjectURL","im","Image","src","loadImage","hasUnsupportedFile","collapseThreshold","getElement","style","display","setDirection","uiState","toolspaceCollapser","isOpen","css","left","right","setSize","Math","max","uiWidth","toolWidth","uiHeight","setWide","statusOverlay","toolspace","borderLeft","borderRight","setUiState","updateCollapse","toolspaceScroller","updateUiState","layer","currentLayerCtx","context","currentBrush","setContext","layerPreview","setLayer","newImageDialog","currentColor","klColorSlider","getSecondaryRGB","getWidth","getHeight","innerWidth","color","a","handUi","onCancel","shareImage","shareCanvas","getCompleteCanvas","fileName","getDate","filenameBase","title","mainTabRow","activeStr","toolspaceToolRow","getActive","oldTabId","getOpenedTabId","keysArr","keys","draw","hand","fill","shape","setIsVisible","open","showCrop","clipboardDialog","inputObj","top","bottom","input","history","filterLib","cropExtend","apply","updateBottomBar","isVisible","innerHeight","toolspaceInner","scrollHeight","bottomBarWrapper","min","screen","$6l0gQ","LocalStorage","app","projectStore","createElement","exportType","KlCanvas","projectObj","setHistory","initState","layerFill","g","b","copy","focus","getLayerCount","brushes","destroy","RGB","currentBrushId","lastNonEraserBrushId","BrushSettingService","setColor","copyObj","opacity","setOpacity","getColor","brushUiObj","getSize","getOpacity","sizeSlider","brushesUI","opacitySlider","lineSmoothing","EventChain","LineSmoothing","smoothing","LineSanitizer","lineSanitizer","setChainOut","event","pointerEvents","startLine","pressure","requestFrame","goLine","isCoalesced","setLastDrawEvent","endLine","getBrush","drawLineSegment","x0","y0","x1","y1","textToolSettings","align","isBold","isItalic","KlCanvasWorkspace","drawEventChain","chainIn","rgbObj","isDragDone","pickingDone","setMode","canvasX","canvasY","getLayerIndex","floodFill","fillUi","getTolerance","getSample","getGrow","getContiguous","angleRad","dialogCounter","get","textToolDialog","font","colorRGBA","text","textStr","ColorConverter","toRgbaStr","typeStr","shapeTool","onDown","onMove","onUp","onViewChange","viewChangeObj","changed","includes","out","scale","angleDeg","angle","PI","setEnableZoomIn","getMaxScale","setEnableZoomOut","getMinScale","onUndo","canUndo","undoRedoCatchup","undo","canRedo","redo","KeyListener","keyStr","comboStr","isInputFocused","getIsDrawing","zoomByStep","keyListener","isPressed","fitView","preventDefault","sameKeys","prev","next","store","getProject","t0","success","stop","copyToClipboard","comboOnlyContains","translateView","setAngle","decreaseSize","increaseSize","eraserBrush","getIsTransparentBg","clearLayer","r","setActive","updateMainTabVisibility","brushTabRow","swapColors","KlImageDropper","onDrop","handleFileSelect","enabledTest","addEventListener","pasteEvent","clipboardData","undefined","items","indexOf","getAsFile","retrieveImageFromClipboardAsBlob","imageBlob","img","onload","revokeObjectURL","URLObj","getAsString","pasteStr","trim","onerror","log","crossOrigin","hexToRGB","b1","Ui","onSizeChange","onOpacityChange","emitOpacity","onConfigChange","emitSliderConfig","ui","padding","position","StatusOverlay","el","parent","oncontextmenu","onclick","handleClick","ToolspaceCollapser","overlayToolspace","setTimeout","OverlayToolspace","append","backgroundColor","toolspaceTopRow","$85H3x","ToolspaceTopRow","showIframePopup","wrap","abrupt","overlay","onLeftRight","updateUi","logoImg","onLogo","$5ebUJ","onNew","showNewImageDialog","onImport","fileTab","triggerImport","onSave","saveToComputer","save","onShare","addClassName","marginBottom","ToolspaceToolRow","onZoomIn","onZoomOut","onRedo","setIsSmall","addListener","setEnableUndo","setEnableRedo","KlColorSlider","startValue","onPick","p_color","emitColor","setHeight","setPickCallback","doPick","brushDiv","colorDiv","flexWrap","justifyContent","alignItems","toolspaceStabilizerRow","ToolspaceStabilizerRow","onSelect","v","setSmoothing","getOutputElement","TabRow","tooltip","brushId","enable","onClose","keyArr","createTab","b2","HandUi","onFit","onAngleChange","isRelative","FillUi","colorSlider","TextUi","ShapeUi","ShapeTool","isDone","x2","y2","shapeObj","shapeUi","getShape","isOutwards","getIsOutwards","getIsEraser","strokeRgb","lineWidth","getLineWidth","isAngleSnap","getIsSnap","isFixedRatio","getIsFixed","getMode","fillRgb","setComposite","drawShape","ctx","klLayerManager","LayerPreview","onClick","filterTab","FilterTab","UndoRedoCatchup","clctx","catchup","SaveToComputer","FileTab","imgurUpload","imgurKey","SettingsTab","$fxAg2","onOpen","minWidth","id","$2dTGs","$fuF9j","$adBnR","textUi","$cafM1","$23J3k","label","show","hide","$eIlXd","settingsTab","MutationObserver","observe","attributes","childList","subtree","ToolspaceScroller","resize","scrollY","scrollTo","_ref","swapUiLeftRight","saveAsPsd","_this","userSelect","_this1","ResizeObserver","windowResizeWatcher","e2","$iUR3L","importFilters","$9cbe98d1fb398012$export$6e4a713ddcda1e5e","$dAXbp","$3P46L","$7pyBK","$705qg","drawProject","$aSJRf","WorkspaceSvgOverlay","$7bo3M","$lV6Vy","KlCanvasPreview","$i5nyl","filterLibStatus","$kyVjY","$6rdi0","renderText","$h20yl","floodFillBits","$30Cml","$3ujzu","setDbName","$9BlwZ","indexedDb","ProjectStore","$6mTnI","$lkluh","$eyygR","calcSliderFalloffFactor","$l4PqG","Checkbox","$lXqiv","$c4LUw","Select","$21VAD","ImageToggle","$jKOQl","ImageRadioList","$gmlbk","RadioList","$bHZQg","penPressureToggle","$fCJWy","KlSlider","$llzZ0","HexColorDialog","$lfHl9","$h7i9r","KlSmallColorSlider","$kzhsD","PointSlider","$bd9hB","ColorOptions","$9A7OD","Options","$iskOY","BoxToggle","$iDHln","$bmB93","CropCopy","$hRdOL","FreeTransform","$cNhNm","FreeTransformCanvas","$kEeSq","Cropper","$32CBv","$kqmpc","FittedImage","$j1kEL","$13r5y","$9p4Zp","$8jqzp","ToolDropdown","$84zxV","$9Kxky","$1Ax5m","$e4sAN","$1uc3b","BrowserStorageUi","$9pcu9","$iVHpg","$i8UFO","$ekHRj","Popup","exportDialog","$auloj","$isYih","$8ebuX","$76Qvv","$keKW3","$kDGzx","$5ENro","$khi8I","$dJXmR","$iS9xS","$9J17G","$eK8ID","$2umOB","$bIgqE","$5rdL4","DecoyKlHistory","$b60fce38973759d6$var$historyInstance","$b60fce38973759d6$export$2a772a91f059c0f9","key","l","$b60fce38973759d6$export$1a1044741a812c67","state","dataArr","listeners","pauseStack","maxState","actionNumber","pop","maxBefore","broadcast","bufferUpdate","$9fd01211d0fde0a8$export$63b4813c5280c707","close","isClosed","clearSelection","focusEl","tagName","select","rootRootEl","decrease","destroyEl","xButton","bgEl","removeEventListener","rootEl","wheelPrevent","btnElArr","splice","increase","overflow","minHeight","flexDirection","scrollContent","ignoreBackground","zIndex","concat","$fh18w","titleHeight","lineHeight","background","boxShadow","content","div","marginRight","boxClasses","join","flex","boxEl","clickOnEnterBtn","stopPropagation","click","autoFocus","buttonRowEl","marginTop","marginLeft","buttonName","iconUrl","btnClasses","primaries","$c0kqC","iconImg","custom","btn","clickOnEnter","closefunc","onscroll","clearInterval","updatePos","elW","popupEl","offsetWidth","elH","offsetHeight","animationName","animationDuration","animationTimingFunction","isCssMinMaxSupported","borderRadius","titleEl","paddingLeft","tabindex","contentEl","$dd0d395ff14a3e11$export$17eb8275e0c4cab8","$dd0d395ff14a3e11$export$f5386afdb763a67e","count","emit","listener","$05ec456c8871d48f$export$921068d8846a1559","eventUsesHighResTimeStamp","$6J2My","mouseEventHasMovement","hasPointerEvents","hasWebGl","getVisitor","canShareFiles","insertAfter","$7jh4K","setAttributes","removeClassName","fitInto","centerWithin","gcd","reduce","decToFraction","imageBlobToUrl","dateDayDifference","createSvg","BbLog","$i0uIf","mix","$eg83P","dist","distSquared","lenSquared","pointsToAngleRad","pointsToAngleDeg","clamp","rotate","rotateAround","Matrix","$kVHNC","Vec2","$4toIY","intDxy","roundEven","roundUneven","updateBounds","boundsInArea","projectPointOnLine","$af1iA","PointLine","BezierLine","SplineInterpolator","quadraticSplineInput","$eelgW","createCanvas","$eIcQa","testShouldPixelate","drawTransformedImageOnCanvas","createCheckerCanvas","createCheckerDataUrl","convertToAlphaChannelCanvas","freeCanvas","HSV","$dJ1E2","CMYK","testIsWhiteBestContrast","appendTextDiv","$72Jv0","makeUnfocusable","$h4olN","setEventListener","$idV3L","PointerListener","$04lDo","$exufe","$cdd5ef6b176accd6$export$d031894fc27e45","DomEl","$cdd5ef6b176accd6$export$3f65cefe8380dbea","options","$cdd5ef6b176accd6$export$8ff9f68337b520c0","hasWebgl","visitor","test","$878b1f179a521546$export$b7d78993b74f766d","navigator","userAgent","$878b1f179a521546$export$4ec3bfbae69fbb50","Event","timeStamp","$878b1f179a521546$export$ebcc19037a7ab076","mouseEvent","MouseEvent","$878b1f179a521546$export$b7b64c480b083ae0","PointerEvent","$878b1f179a521546$export$9cbe517943afd6db","premultipliedAlpha","$878b1f179a521546$export$96cd70eaafd80100","chrome","gl","JSON","parse","stringify","$878b1f179a521546$export$fe0a7220ab4eecad","offsetLeft","$878b1f179a521546$export$558f5e20caee48c2","$44dda2e48e48a872$export$cd3d1f114b139967","$2bd9b7b9bc92046d$export$c4f94c8b3850a5a9","referenceNode","newNode","nextSibling","$2bd9b7b9bc92046d$export$fe58198efe02b173","counter","check","complete","$2bd9b7b9bc92046d$export$dbf350e5966cf602","styleObj","alignContent","webkitUserSelect","$2bd9b7b9bc92046d$export$74da2cba014bdc09","attrObj","setAttribute","$2bd9b7b9bc92046d$export$5cf2b5b76bc9d0c","classStr","classAttr","getAttribute","splitArr","$2bd9b7b9bc92046d$export$1789407f05ca7654","$2bd9b7b9bc92046d$export$10d8903dec122b9d","els","fragment","$2bd9b7b9bc92046d$export$fa55905620c22535","aw","ah","bw","bh","$2bd9b7b9bc92046d$export$76d0c1a172b67a61","$2bd9b7b9bc92046d$export$aa350b96d91cd94","date","Date","getFullYear","getMonth","toString","getHours","getMinutes","$2bd9b7b9bc92046d$export$f81847884871263e","$2bd9b7b9bc92046d$export$533b26079ad0b4b","numerator","denominator","$2bd9b7b9bc92046d$export$8215e6b900906daa","decimalNumber","len","pow","$2bd9b7b9bc92046d$export$5063ec57a23c4f2e","blobObj","Blob","constructor","fauxBlob","encoding","data","$2bd9b7b9bc92046d$export$1093707c159148e8","dateA","dateB","setHours","getTime","$2bd9b7b9bc92046d$export$af0d87255f3cfd7e","obj","$2bd9b7b9bc92046d$export$331c30fd60da0115","mimetype","err","toBlob","filesArray","File","share","$2bd9b7b9bc92046d$export$b981489921ee18cd","clickEvent","allowClick","$2bd9b7b9bc92046d$export$c54fe3b9ecaa84cf","createElementNS","elementType","childrenArr","$74d1f29ad2137b2c$var$globalKey","emitDown","c","d","listenerArr","emitUp","keyDown","code","keyCode","keyToKeyStrObj","isDownObj","comboArr","codeIsDownObj","keyUp","oldComboStr","blur","eventArr","keyToKeyStrArr","i2","keyStrToKeyObj","space","alt","ctrl","cmd","enter","esc","backspace","delete","sqbr_open","sqbr_close","u","z","plus","minus","up","down","home","end","code1","add","first","remove","last","getIsDown","getCombo","$74d1f29ad2137b2c$export$f17908c5de22d32e","onBlur","keyStrArr","$74d1f29ad2137b2c$export$e9f65b0175de4c03","comboAStr","comboBStr","sort","pointerArr","pressureNormalizeAvgCount","pressureNormalizeAvgPressure","pressureNormalizeIsComplete","pressureNormalizeFactor","$893e90c2dcf687ac$var$WheelCleaner","endSequenceTimeout","delta","deltaY","round","sequenceUnit","pageX","pageY","clientX","clientY","endSequence","toEmitDelta","knownUnitArr","sequenceLength","process","clearTimeout","deltaMode","absDelta","abs","$893e90c2dcf687ac$export$9371bd96776f4e82","getDragObj","pointerId","dragObjArr","removeDragObj","removedDragObj","dragPointerIdArr","normalizePressure","correctPointerEvent","corrected","correctedObj","pointerType","movementX","movementY","timeStampOffset","button","coalescedArr","eventStopPropagation","customPressure","isFirefox","coalescedEventArr","getCoalescedEvents","getPointer","pointerObj","lastPageX","lastPageY","addPointer","totalLastX","totalLastY","eventItem","correctedEvent","targetElement","getBoundingClientRect","bounds","eventPreventDefault","coalescedItem","relX","relY","dX","dY","time","createTouchOutEvent","touchListItem","touchEvent","identifier","destroyDocumentListeners","onGlobalPointerMove","onGlobalPointerUp","onGlobalPointerLeave","onPointerEnter","isOverCounter","onEnterLeaveCallback","onPointerLeave","onPointermove","tempLastPointerType","lastPointerType","maxPointers","didSkip","outEvent","createPointerOutEvent","dragObj","downPageX","downPageY","buttonsToStr","clearTouchTimeout","setTouchTimeout","lastTimeStamp","outEvent1","onPointerCallback","touchTimeout","fakeEvent","performance","now","onTouchTimeout","onPointer","onWheelCallback","onWheel","onEnterLeave","wheelEvent","timing","navigationStart","onPointerdown","wheelCleaner","touchArr","changedTouches","touchObj","onTouchmove","onTouchend","$9a5bdb07e7a7c42f$export$2c9e8a9632a706b2","$9a5bdb07e7a7c42f$export$6c4a311cc157c764","ax","ay","bx","by","sqrt","$9a5bdb07e7a7c42f$export$499eb56409f6cbc2","$9a5bdb07e7a7c42f$export$a4f99f99d3e99cfa","$9a5bdb07e7a7c42f$export$627023b405ba5028","p1","p2","atan2","$9a5bdb07e7a7c42f$export$c03a8450eabc2532","$9a5bdb07e7a7c42f$export$7d15b64cf5a3a4c4","num","$9a5bdb07e7a7c42f$export$bb628a54ab399bc9","deg","theta","cs","cos","sn","sin","$9a5bdb07e7a7c42f$export$95ec0760d3d00713","center","point","rot","$9a5bdb07e7a7c42f$export$bbf9af158036c5e9","remainder","fDx","fDy","$9a5bdb07e7a7c42f$export$94cce7adf2ec2d08","above","ceil","below","floor","$9a5bdb07e7a7c42f$export$f373b6a7b0c159a","$9a5bdb07e7a7c42f$export$f4467a4f41373bc7","$9a5bdb07e7a7c42f$export$bbb91bbc54e7d9ac","$12950380ec51f25d$export$649a211db9812745","continueChain","chainArr","chainOut","func","$12950380ec51f25d$export$db3963a21c01d803","fail","sequenceArr","timeoutObj","maxUntilSecondDown","eventQueueArr","lastSequenceItem","onDoubleTap","setupTimeout","timeoutStr","targetFunc","timeMS","diff","nowTime","minSilenceBeforeDurationMs","maxPressedDurationMs","maxPressedDistancePx","maxInbetweenDistancePx","maxUpToUpDurationMs","maxUntilSecondDownDurationMs","minSilenceAfterMs","allowedPointerTypeArr","allowedButtonArr","pointersDownIdArr","lastUpTime","isDown","isUp","processEvent","setAllowedPointerTypeArr","arr","setAllowedButtonArr","firstDownTime","firstLastDownTimeout","tapTimeout","fingerArr","lastEventTime","fingers","maxFirstLastFingerDownMs","downTime","tempLastEventTime","maxTapMs","fingerObj","fingerObj1","i3","allAreUp","i4","onTap","gestureObj1","doSwallow","secondFingerTimeout","touchPointerArr","isInProgress","continuePinch","index","otherPointerIdArr","downRelX","untilSecondFingerDurationMs","i6","i7","endPinch","touchPointerObj","i5","downRelY","firstFingerMaxDistancePx","gestureObj","pincherArr","actionObj","startDist","distance","startAngle","onPinch","beginPinch","$12950380ec51f25d$export$fe11e0afe623a677","eventCopy","pointers","downPointerId","ignorePointerIdArr","pressure0","pressure1","eventQueue","shiftIsPressed","direction","downEvent","onDraw","i8","$12950380ec51f25d$export$91dcf4209534d21f","lastMixedInput","inputX","inputY","inputPressure","$3f0e2f35371c9852$export$dd0873c0fb3ccff6","resultCanvas","$3f0e2f35371c9852$export$1555f643cc9a976","transform","scaleX","scaleY","whSwapped","$3f0e2f35371c9852$export$ded2b43392504635","destCtx","transformImage","pixelated","imageSmoothingEnabled","imageSmoothingQuality","translate","restore","$3f0e2f35371c9852$export$425a419ef9fc761f","baseCanvas","angleDegree","cache","$3f0e2f35371c9852$export$754559b36e94ea2f","fillStyle","fillRect","$3f0e2f35371c9852$export$42af33c76b681867","size1","create","toDataURL","$3f0e2f35371c9852$export$59b33278b5b2fc8a","tmp1","tmp2","oldW","oldH","newW","newH","ew","eh","base2","oldWidthEx","log2","oldHeightEx","newWidthEx","newHeightEx","buffer1","buffer2","bufferCtx","globalCompositeOperation","currentWidth","currentHeight","newWidth","newHeight","tmp","canvasCtx","tmp1Ctx","$3f0e2f35371c9852$export$5a7576952c826b4f","imdat","getImageData","putImageData","$3f0e2f35371c9852$export$2384aff49c9b73c2","clearRect","multiplyMatrixAndPoint","$e4df33b4b16105d5$export$5b12bf1653c0dd85","getIdentity","matrix","multiplyMatrices","matrixA","matrixB","row0","row1","row2","row3","result0","result1","result2","result3","createTranslationMatrix","createRotationMatrix","createScaleMatrix","$531c9f41f98b7ec0$export$ac4bca90992eed1","sub","nor","mul","dot","aArr","bArr","map","m","$77ae015f37ebe4f1$export$b4c5b177db876445","lineStart","lineEnd","$77ae015f37ebe4f1$export$8b36a4a83269a640","segmentArr","points","getAtDist","getLength","fac","lastAngle","pointArr","lastSpacing","spacing","controlsCallback","lastPoint","dir","lastDot","pointM1","pointM2","pointM3","curvePoints","p3","p4","resolution","getBezierPoints","pointLine","tempSpacing","lastCallbackPoint","dAngle","addFinal","newP","xa","ya","wx","sig","ddydx","getFirstX","getLastX","interpolate","klo","khi","k","$77ae015f37ebe4f1$export$80967b1eb9fd6eb4","findX","$5e7aac2fa49b6b1f$export$d2edaecd208aed43","$5e7aac2fa49b6b1f$export$8f9ece5a47764b93","$5e7aac2fa49b6b1f$export$89d3f85304bf0767","$5e7aac2fa49b6b1f$export$fb7efcd2e153af6e","_RGBtoHSV","minVal","maxVal","del_R","del_G","del_B","_HSVtoRGB","var_h","var_i","var_1","var_2","var_3","var_r","var_g","var_b","_CMYKtoRGB","_RGBtoCMYK","toRGB","o","toHSV","toCMYK","toHexString","ha","hb","hc","toRgbStr","rgbaObj","hexStr","exec","$5e7aac2fa49b6b1f$export$5cf396345d1238ae","$cfe3aa45a75894cc$export$7868464f598ba79d","innerHTML","$cfe3aa45a75894cc$export$906dfdb7df31ccfc","getAll","activeElement","$cfe3aa45a75894cc$export$a3d02541b0ebf605","getSelection","sel","empty","removeAllRanges","selection","preventFocus","$cfe3aa45a75894cc$export$6bd63bfceaafae0c","didFocusRelated","relatedTarget","currentTarget","$cfe3aa45a75894cc$export$c3da0dad1b44eea9","$cfe3aa45a75894cc$var$els","isArray","onChange","customKeyArr","$cfe3aa45a75894cc$export$b1da1db524e22115","$0d0e99c175410ac4$export$9860cd9e09e6f8ba","msg","$9e5fd8359d8b22f2$export$19fffca37ef3e106","localStorage","module","exports","getBundleURL","resolve","$d82e0c66c1aaca81$export$48513f6b9f8ce62d","element","innerEl","checked","doHighlight","allowTab","tabIndex","onchange","$aa0ec58519fa7d10$export$b7e3ae3d7c15e42e","$eb01976a4bab51ce$export$ef9b1a59e592288f","selectEl","changeListener","cursor","fontSize","colorScheme","isFocusable","optionArr","option","initValue","$5cde84e643fb89d6$export$b6d053cded550773","isActive","backgroundImage","isRadio","setValue","getValue","$459eb3dcb08ae3f8$export$7cc1012a658e6ad8","activeIndex","createOption","initId","radioEl","$12a3b74a8702bb1f$export$77219f67585650fa","isChecked","changeCallback","redraw","toggleDiv","border","cssFloat","$e1Rnq","backgroundSize","backgroundRepeat","boxSizing","$cf8be10874d1afb1$export$a1855b925e534de7","splineInterpolator","toLinearValue","useSpline","updateEnable","isEnabled","getOutsideVal","linearValue","updateLabel","pLinearValue","outVal","formatFunc","toLocaleString","languageStrings","getCode","labelCaption","control","elementWidth","isFinal","isChangeOnFinal","eventResMs","lastCallbackTime","virtualVal","deltaX","curve","elementHeight","curveArr","controlInner","labelFontSize","pointerListener","pointerListenerTimeout","fixScribble","increaseValue","decreaseValue","config","setIsEnabled","isDisabled","$0c2dd884393cffca$export$f8e41e222e32615d","isRightButton","$dada52d673c8c4ac$export$cc42e119007cb939","createRgbInputRow","labelStr","attributeStr","rowEl","labelEl","inputEl","lastValidRgb","parseFloat","previewEl","hexInput","hexRowEl","hexLabel","rgbArr","copyButton","$fcsnL","execCommand","resultStr","$9eeb6c00ea2d3242$export$4e5102252876c5d7","updatePrimaryHSV","hsv","primaryColorHSV","updateSVCanvas","rgb","hueStop","updateSVPointer","svHeight","pointerSV","setColPreview","divPreview","primaryColorRGB","pickerButton","filter","hexButton","updateSecondaryColor","secondaryColorBtn","secondaryColorRGB","secondaryColorHSV","controlH","pickCallback","outputDiv","svWrapper","svSvg","DOMParser","parseFromString","documentElement","divH","SVContainer","virtualHSV","$1nsGS","backgroundPosition","isPicking","isOver","targetEl","cv","gradH","createLinearGradient","col","addColorStop","createHueBg","factor","$3ac3f56275b45315$export$dcd33f7653c95f09","updateSV","canvasSV","gradient1","colleft","colright","heightSV","updateHPointer","pointerH","canvasH","heightH","svPointerId","svPointerListener","hPointerId","hPointerListener","cleardiv","clear","$0b17443c34517974$export$ac00cea56cec3037","param","redrawPoint","sliderPoint","sliderPos","isDragging","pointSize","sliderLine","isFirst","imaginaryPos","margin","transition","$a19b2655062f09b7$export$24ba9b81662d4366","buttonArr","setIsSelected","selectedIndex","colorArr","checkerUrl","found","sItem","initialIndex","colorButton","buttonSize","textAlign","$c8511e371b1e3768$export$c019608e5b5bb4cb","optionObj","classArr","isSmall","wrapperEl","selectedId","getIndex","initialId","changeOnInit","previous","$c1a93a3cd82636c9$export$5ee0af1d5c87e856","removeProperty","isWide","angleIm","$bv5Zj","verticalAlign","innerInnerEl","doPulse","animation","timeout3","timeout","timeout2","$81ac8fccf3fa43c3$export$8e17099f54853f0e","aboutDiv","closed","aniToggle","imageContainer","coverImage","coverSize","aniTimeout","boxSize","ontouchstart","ontouchmove","ontouchend","$01fcd0ed15aa4018$export$40175a5948a88a57","resetCrop","updateCroppedCanvas","croppedCanvas","croppedImage","updateSelectionRect","selectionRect","thumbX","scaleW","thumbY","scaleH","toOriginalSpace","genCrop","topLeftP","bottomRightP","origTopLeftP","origBottomRightP","isReset","eventTarget","isNotCopy","previewWrapper","thumbSize","thumbCanvas","imageRendering","thumbCtx","startP","updateCropTimeout","startCrop","didMove","rect","doUpdate","stepSize","getRect","getCroppedImage","$ffd40240385bb9f9$export$32b89bc9bb92706a","fullCanvas","cropCallback","output","toClipboard","imgURL","cropCopy","fetch","clipboard","write","ClipboardItem","topWrapper","borderTop","borderBottom","KeyEvent","rectObj","$aacd8170d7ccb1c6$export$56cc6eb0b4c43d97","p_canvas","p_func","p_rootDiv","oldHistoryState","row","clearBtn","$8yL1I","suggestions","suggestionBtns","createLayerList","updatefunc","createLayerEntry","klCanvasLayerArr","layercanvas","layerElArr","posY","innerLayer","container1","container2","spot","oldOpacity","thumbDimensions","thumb","thc","lname","whiteSpace","ondblclick","opacityLabel","sliderValue","isLast","layerOpacity","largeThumbCanvas","largeThumbDiv","largeThumbInDocument","largeThumbInTimeout","largeThumbTimeout","dragstart","freshSelection","lastpos","isSelected","div1","activateLayer","updateLayersVerticalPosition","posToSpot","newSpot","oldSpot","move","selectedSpotIndex","layerListEl","getState","child","updateHeight","layerHeight","layerSpacing","newspot","posy","oldSpotIndex","newSpotIndex","moveLayer","mergeBtn","disabled","listdiv","disableButtons","enableButtons","div2","modeWrapper","modeSelect","addnewBtn","duplicateBtn","removeBtn","renameBtn","paddingRight","$d42vI","$dKwR8","$3VpTB","$g91IK","clearboth","MAX_LAYERS","duplicateLayer","removeLayer","mixModeStr","$bBcC4","translateBlending","topCanvas","preview","spacer","alphaCanvas","bottomCanvas","globalAlpha","topOpacity","mergeDialog","mode","mergeLayers","setMixMode","setInterval","historyState","activeLayerSpotIndex","getSelected","spotIndex","stateStr","$0621fc8724f6bfac$var$allowedMixModes","$0621fc8724f6bfac$export$9f4f73b1bd7c2f26","$0621fc8724f6bfac$export$4a819bde91671014","layerNrOffset","layerCanvasArr","pickCanvas","changeListenerArr","origLayers","updateIndices","toCopyCanvas","algorithm","layerCanvas","layerContext","offX","offY","ctemp","layerCtx","fillColor","selected","isLayerLimitReached","doReturnNull","emitChange","temp","targetIndex","layerBottomIndex","layerTopIndex","isHorizontal","isVertical","tempCtx","colorObj","compositeOperation","tolerance","sampleStr","grow","isContiguous","srcData","targetCtx","targetImageData","srcCanvas","srcImageData","srcCtx","srcIndex","targetData","imageData","canvasObj","$7069db2f5e23d00f$var$fillRect","$7069db2f5e23d00f$var$mx","$7069db2f5e23d00f$var$my","$7069db2f5e23d00f$var$moveIndex","$7069db2f5e23d00f$var$testAndFill","srcArr","targetArr","initRgba","px","py","q","tl","tr","br","bl","$01d7180c5d1d0fdf$export$27550cc14d7ae85a","downX","downY","downAngleRad","onShape","$01d7180c5d1d0fdf$export$71b514a25c47df50","isEraser","strokeStyle","r1","r2","pAngleDeg","pAngleDegSnapped","rotated","r11","r21","rx","ry","rdX","rdY","x1r","y1r","x2r","y2r","x1f","y1f","x2f","y2f","beginPath","moveTo","lineTo","stroke","x1f1","y1f1","x2f1","y2f1","strokeRect","ellipse","$fdc12d72a3df9be9$export$482c90f94eb9717c","outer","fontFamily","fontWeight","fontStyle","spanStr","children","offsetTop","el1","fillText","innerText","isDebug","$089586a542a12f27$export$5f63a7b18dc4503a","$2f1281ced73ab1dc$export$6e1bedb2a6cdff30","blendMode","codes","darken","multiply","lighten","difference","exclusion","hue","saturation","luminosity","$d256278b259ca979$export$6b9252711ea5997f","rootElement","brushCircleOuter","brushCircleInner","pickerPreviewBorder","pickerPreviewCol","compassSize","compass","compassInner","compassBaseCircle","cx","cy","compassLineCircle","compassUpperTriangle","compassLowerTriangle","radius","borderColor","TMode","$d492af58f4721011$var$MIN_SCALE","$d492af58f4721011$var$TMode","$d492af58f4721011$export$6eaf6f7c0cc177fc","renderTargetCanvas","renderTargetCtx","renderWidth","renderHeight","compositeCanvas","compositeCtx","doResizeCanvas","oldTransformObj","targetTransformObj","highResTransformObj","renderedTransformObj","cursorPos","usesCssCursor","bgVisible","transformIsDirty","doAnimateTranslate","svgOverlay","emptyCanvas","isRepeat","currentInputProcessor","onKeyDown","Draw","Pick","Fill","Text","Shape","globalMode","inputProcessorObj","spaceHand","Hand","altPicker","zoom","onKeyUp","updateChangeListener","currentMode","renderTime","lastDrawEvent","linetoolProcessor","LinetoolProcessor","getMatrix","art","_this2","getRenderedTransform","matrix2","coords","matrix1","coords1","coords2","pointer","reqFrame","updateCursor","getComboStr","resetInputProcessor","coord","workspaceToCanvasCoord","onFill","onText","HandGrabbing","Zoom","offsetX","offsetY","internalZoomByStep","lastRenderedState","picker","pickedColor","getColorAt","updateColorPreview","Rotating","Rotate","centerObj","startAngleRad","dAngleRad","minimizeAngleRad","origin","angleIsExtraSticky","pinchZoomer","PinchZoomer","snapAngleRad","oldTransform","mainDoubleTapper","DoubleTapper","middleDoubleTapper","twoFingerTap","NFingerTapper","threeFingerTap","pointerEventChain","OnePointerLimiter","CoalescedExploder","_this3","brushRadius","animationFrameRequested","lastRenderTime","updateLoop","addChangeListener","modeInt","doForce","oldMode","$hNEwm","$iOLNv","$3zTyb","$kFdtJ","oldIsHand","currentIsHand","stepNum","centerX","centerY","newStep","newScale","effectiveFactor","transformA","transformB","blendFactor","centerPosA","canvasToWorkspaceCoord","centerPosB","mixedPos","workspacePointArr","borderSize","layerArr","getLayersFast","compositeObj","updateCompass","snapDegIncrement","maxDistDeg","modDeg","doRedrawCanvas","requestAnimationFrame","newState","elapsedFrames","doRender","checkChange","testBgVisible","render","start","klC","oldWidth","oldHeight","modeStr","diameter","hideBrushCursorTimeout","doAnimate","canvasPointsArr","boundsObj","boundsWidth","boundsHeight","oldAngleRad","tx","ty","$6faa9d948ec87f40$export$e258ade1648009b7","$0370167ee97a20d9$var$snapToPixel","$0370167ee97a20d9$var$copyTransform","$0370167ee97a20d9$var$toTransformSpace","$0370167ee97a20d9$var$toImageSpace","$0370167ee97a20d9$export$79a74567acf241b0","classCallCheck","scaled","corners","minSnapDist","cornerCursors","gripSize","edgeSize","edges","isConstrained","snapX","snapY","snappingEnabled","ratio","transEl","boundsStartP","snap","iP","distX","distY","j","projected","dist1","updateCornerPositions","updateDOM","virtualPos","offsetArr","tinyOffset","constrainCorner","snapCorner","tP","indexes","updateTransformViaCorners","angleOffset","isInverted","pointerRemainder","tfD","ti","dimension","restoreRatio","angleGrip","$lQMok","anglePointerListener","offset","snapDeg","iX","iY","_x","_y","cornerIndex","flip","widthChanged","heightChanged","angle90","newHeight1","skipCallback","transformOrigin","boundsEl","$48f5d87739d28bf9$export$205c2dd29f8a66b5","updatePreview","freeTransform","getTransform","destCanvas","previewLayerArr","transformIndex","initTransform","klCanvasPreview","imageWidth","imageHeight","previewFit","innerWrapper","transformSize","setPos","setAngleDeg","fit","setTransformCenter","getTransformation","getIsPixelated","$de496a1759b04ed9$export$71ed2b85d4ca43d3","transformTop","grips","maxH","transformRight","maxW","transformBottom","transformLeft","commit","cornerElArr","outline","thirdsHorizontal","thirdsVertical","gripCursors","outlinePointerListener","gripOverlay","edge0PointerListener","edge1PointerListener","edge2PointerListener","edge3PointerListener","corner0PointerListener","corner1PointerListener","corner2PointerListener","corner3PointerListener","setTransform","setScale","showThirds","$18e69c7d4cb991e8$export$d25420b53e16716f","layerObj","largeCanvasAnimationTimeout","isInstant","nameLabelEl","opacityEl","lastDrawnSize","canvasDimensions","canvasSize","animationCanvas","animationCanvasCtx","animationCanvasCheckerPattern","animationCount","animationLength","animate","drawLargeCanvas","lastDrawnState","largeCanvasIsVisible","largeCanvasSize","largeCanvas","largeCanvasCtx","largeCanvasCheckerPattern","largeCanvasWrapper","removeLargeCanvas","largeCanvasAnimationDurationMs","contentWrapperEl","canvasWrapperEl","nameWrapper","flexGrow","nameFadeEl","clickableEl","webkitTouchCallout","createPattern","showLargeCanvas","currentState","klCanvasLayerObj","$a29ff52bf33e0691$export$83ae33786c7b4ee5","$e3dfa43019bc3f08$export$962af7e240721d88","freeTransformCanvas","noteEl","originalSizeBtn","fitSizeBtn","setTransformFit","centerBtn","importImage","buttonStr","$01cb8095758db224$export$e789742143ba5b1","rootCounter","optionLayerCounter","optionImageCounter","testAcceptType","dataTransfer","types","updateOptions","optionLayerEl","optionImageEl","paddingTop","textShadow","optionStyle","$d6fe881e8fc421ac$export$9f0da9b942594e99","updateColor","selectedColorEl","updateUI","mousePos","sizeObj","hHeight","sliderHeight","queuedObj","subscriptionFunc","initialColor","subscribe","sliderConfig","getSliderConfig","$6003e73b8cbb69e2$export$665d2c76b1eb8459","createButton","extraPadding","contain","logoButton","$8oUiM","newButton","$1gUFn","importButton","$gswMe","saveButton","$lLh5u","shareButton","$5xpQb","helpButton","onHelp","$kS5uZ","$18c597dee53260ff$export$a0a40f8a0b8fee15","createDropdownButton","wrapper","dropdownWrapper","smallMargin","onClickDropdownBtn","closeDropdown","currentActiveIndex","updateButton","showDropdown","dropdownBtnArr","arrowButton","activeButton","titleArr","activeButtonIm","imArr","openTimeout","startX","startY","elementFromPoint","$gzZrf","borderBottomLeftRadius","borderBottomRightRadius","$a372d78c806cd0cc$export$c744a22bef9e0b97","doEmit","currentActiveStr","toolDropdown","handButton","onActivate","doLighten","doMirror","createTriangleButton","svg","viewBox","preserveAspectRatio","defs","in","stdDeviation","dx","dy","in2","operator","k2","k3","svgTriangleLeft","class","onLeft","svgTriangleRight","onRight","leftPointerListener","rightPointerListener","leftIm","leftImage","rightIm","rightImage","setIsEnabledLeft","setIsEnabledRight","zoomInNOutButton","$3KoFh","$eWf2I","zoomInButton","zoomOutButton","undoNRedoButton","$fc34V","undoButton","redoButton","$90c04b5ac185bf3d$export$8162a66cd18867a7","strengthSelect","setDeltaValue","$d04d72b97d637d65$export$3c6d17ed0106bfb9","pTabObj","useAccent","openedTabObj","tabDiv","openedTabObj1","roundRight","roundLeft","tabArr","roundSize","$4m0AU","tabId","$9934467c988b088a$export$cf20160367bae46c","scaleEl","angleEl","resetButton","onReset","fitButton","leftRotateButton","$2n4Fs","resetAngleButton","rightRotateButton","pIsVisible","pScale","$51d47356d698ffec$export$1e63e3b0645421a2","toleranceSlider","selectRow","growWrapper","growSelect","contiguousToggle","$d06987f550ff485e$export$32a22540e4b2f123","$45c003c723de07b5$export$a9387b1d4260d39c","updatePreviews","strokeWidth","lineWidthSlider","squish","rectStrokeSvgRect","rectFilledSvgRect","ellipseStrokeSvgEllipse","ellipseFilledSvgEllipse","lineSvgLine","fixedToggle","previewPadding","previewSize","snapToggle","rectStrokeSvg","rectFilledSvg","ellipseStrokeSvg","ellipseFilledSvg","lineSvg","shapeOptions","eraserToggle","outwardsToggle","$4fb68589de8a8c9a$export$f77a89101d7d6586","createRatioSize","ratioX","ratioY","maxCanvasSize","updateRatio","widthInput","heightInput","commonRatios","reducedArr","closestRatio","closestDistance","ratioWrapper","realw","T","U","V","HCF","secondaryColor","canvasWidth","canvasHeight","workspaceWidth","workspaceHeight","onConfirm","newImDiv","widthWrapper","heightWrapper","widthUnit","heightUnit","templateWrapper","presetFitBtn","presetCurrentBtn","presetSquareBtn","presetLandscapeBtn","presetPortraitBtn","presetOversizeBtn","sizeObj1","backgroundRGBA","colorOptionsArr","colorOptions","previewcell","cell","onkeyup","secondRow","secondRowLeft","$3f73fb4b1b574d52$export$5b91f641162972fc","icon","directionStr","$jiQkU","dirStr","$cd9e7df6e228ea45$export$e263e067d6140649","textCtx","textCanvas","objectSpread","textInput","alignRadioList","italicToggle","boldToggle","sizeInput","fontSelect","rotatedXY","rotatedWH","fitBounds","zoomFac","previewCanvas","layersCtx","previewCtx","checkerPattern","layersCanvas","changeZoomFac","zoomInBtn","canZoom","zoomOutBtn","onScroll","isSmallWidth","isSmallHeight","touchAction","previewPointerListener","row2n3Wrapper","unshift","fontPointerListener","zoomWrapper","sizePointerListener","$2dqOY","$rk4vM","$hucjG","$cZa2s","$03Zd8","placeholder","$c8d2eb7d799b314c$export$1bf16d9bd59fd8f9","resolutionEl","updateResolution","flattenCheckbox","doFlatten","noteStyle","warningArr","psdWarningArr","contentArr","warningMap","mask","clipping","group","adjustment","showWarnings","noteEl1","cropRect","$4c230b0de5e1a470$var$kl2PsdMap","$4c230b0de5e1a470$var$psd2KlMap","$4c230b0de5e1a470$var$init","$4c230b0de5e1a470$export$6df36f0c42d2440f","str","$4c230b0de5e1a470$export$4e3b1f7d3ad623b4","$4c230b0de5e1a470$export$3d649861c4b13fa2","psdObj","addWarning","warningStr","getMixModeStr","prepareMask","maskCanvas","defaultColor","groupMaskCtx","imData","bitsPerChannel","maxLayers","layerCount","countWithinGroup","groupObj","convertGroup","psdGroupObj","groupCanvas","groupCtx","resultArr","groupOpacity","hidden","groupMixModeStr","hasClipping","innerArr","innerItem","innerCtx","clippingCanvas","clippingCtx","clippingItem","effects","clippingCanvas1","clippingCtx1","clippingItem1","$4c230b0de5e1a470$export$56493bf279c387b3","klPsd","$41164c8aeaf53227$var$indexedDbIsSupported","indexedDB","$41164c8aeaf53227$var$dbNameStr","$41164c8aeaf53227$var$storageNameStr","$41164c8aeaf53227$export$1347f8be1f25c479","$41164c8aeaf53227$var$execIndexedDBTransaction","actionFunction","successCallback","errorCallback","onError","errorStr","hasFinished","requestObj","createObjectStore","keyPath","createIndex","unique","databaseObj","objectStoreNames","contains","deleteDatabase","storeObj","transactionObj","transaction","objectStore","e3","oncomplete","$41164c8aeaf53227$export$1448a0dd0d3fde8e","query","$41164c8aeaf53227$export$21ade4eb935254aa","storageProject","put","$41164c8aeaf53227$export$42ffd38884aecdac","$805be15a1e91c0ee$export$7a4e0b62a5d854bc","isLoaded","$805be15a1e91c0ee$export$395d33c8e06b92c9","glBrightnessContrast","lang","buttonLabel","webgl","updateContext","$8k5kH","getDialog","inEmbed","$4UkHZ","neededWithWebGL","glCurves","$e7LnL","$iI5sC","glHueSaturation","$eySuj","invert","$iPRwU","glPerspective","$krmR4","$92iBR","glTiltShift","$bFASM","toAlpha","$9m6gZ","$4fkq2","ieFails","glBlur","$dPWA8","glUnsharpMask","$cQHFd","$805be15a1e91c0ee$var$updateNames","$42ac5b30ad65dabb$export$7d68cd8857639377","PenBrush","$68QTJ","BlendBrush","$5PSXS","SketchyBrush","$ewgr9","PixelBrush","$kic4a","ChemyBrush","$6Nq1H","SmudgeBrush","$ltaBP","EraserBrush","$7cUpm","$3f0923cd3c55ea92$export$6f96c8f9e6ae7341","historyEntry1","settingColor","settingColorStr","lineToolLastDot","inputArr","calcOpacity","settingOpacity","settingHasOpacityPressure","updateAlphaCanvas","settingAlphaId","ALPHA_CIRCLE","ALPHA_SQUARE","instructionArr","alphaCanvas128","alphaCanvas64","alphaCanvas32","alphaOpacityArr","$5CF7D","alphaImArr","drawDot","before","settingLockLayerAlpha","arc","twoPI","closePath","hasDrawnDot","targetMipmap","ALPHA_CHALK","bezierLine","lastInput","dotCallback","localPressure","lastInput2","localOpacity","localSize","settingSize","settingHasSizePressure","drawArr","localSpacing","settingSpacing","actions","maxInput","loopDist","mouseDist","eY","bdist","eX","historyEntry","setAlpha","setSpacing","sizePressure","opacityPressure","setLockAlpha","getSpacing","$ff6c1f784f50f5d5$export$d116ae91f77f1f19","$74D3O","genBrushAlpha01","genBrushAlpha02","$f875015ce1aeb4d3$export$74a44bbc21d06a28","scaleFac","createImageData","sFac2","$gZSR2","noise","simplex2","noisePattern","centerDist","$f875015ce1aeb4d3$var$udSegment","ba","pa","$f875015ce1aeb4d3$export$eaa218d5d17c8f1c","pDist","centerSize","transitionSize","$dfc47a34ad9bc378$var$myModule","$dfc47a34ad9bc378$var$Grad","dot2","$dfc47a34ad9bc378$var$grad3","$dfc47a34ad9bc378$var$p","$dfc47a34ad9bc378$var$perm","$dfc47a34ad9bc378$var$gradP","seed","$dfc47a34ad9bc378$var$F2","$dfc47a34ad9bc378$var$G2","xin","yin","j1","gi0","gi1","gi2","$02d77b8dd5755328$var$cellSize","$02d77b8dd5755328$var$clamp","$02d77b8dd5755328$export$9659db8d01dd5313","isTesting","blending","settingSizePressure","settingOpacityPressure","blendCol","blendMix","redrawBounds","cells","getTouchedCells","isTouched","touchedCells","cellsW","getCellsWidth","cellOffsetX","cellOffsetY","cellWidth","cellHeight","inCellBounds","tmpCtx","alpha","ar","ag","ab","aa","sliceBounds","randI","randLen","randArr","random","samples","samplesSquared","sampleOffsets","sharpness","invSharpness","sharpnessSubtrahend","sizeSquared","distDivisor","alphaMinuend","slicedBounds","ri","re","alphaO","alphaU","underR","invAlphaO","underG","underB","underR1","underG1","underB1","newAlpha","drawBuffer","calcSpacing","avgX","avgY","mixr","mixg","mixb","average","localColOld","avgParams","prepDot","copyFromCanvas","getAverage","localColNew","updateRedrawBounds","totalCells","drawChangedCells","continueLine","find","$c214fbe9e4fc15b0$var$sampleCanvas","$c214fbe9e4fc15b0$var$sampleCtx","$c214fbe9e4fc15b0$export$566f9061f0f5ba33","lastX","lastY","settingBlending","settingScale","sketchySeed","setSeed","getSeed","mixmode","c1","c2","getBlending","setBlending","p_x","p_y","preMixedColor","mixx","mixy","mixw","mixh","countmix","mixed","$58b45953679baa4a$export$4de5ef8eecde6f12","ditherPattern","updateDither","ditherCtx","settingIsEraser","ditherArr","ditherCanvas","plotLine","skipFirst","settingUseDither","sX","sY","plotCubicBezierLine","isOverThreshold","d2","d3","cubicCurveOverThreshold","controlCallback","controlObj","setIsEraser","setUseDither","getLockAlpha","$fc1a683099fb2d61$export$fe52c90afd1cf5ba","isBaseLayer","isTransparentBG","radgrad","createRadialGradient","oFac","opacity1","bezierCallback","started","setTransparentBG","$78ad817c60f81b7c$var$CELL_SIZE","$78ad817c60f81b7c$var$smudge","cSize","brush","cX","cY","aP","bP","aIndex","ai","bi","ix","iy","softnessPx","fac2","alphaLock","bx1","iy4","yStart","bx2","ix4","pixel","iy1","yStart1","x21","ix1","iy2","yStart2","x3","x22","ix2","y3","iy3","yStart3","x4","x23","ix3","$78ad817c60f81b7c$export$c9f800961903deab","completeRedrawBounds","copiedCells","copyImageData","imWidth","imHeight","$78ad817c60f81b7c$var$prepSmudge","ImageData","updateCompleteRedrawBounds","historyIm","tmpCanvas","$348fcce123898af9$export$38b08aa4ea8f61c6","settingMode","settingDistort","settingXSymmetry","settingYSymmetry","settingGradient","buffer","path","Path2D","startAtTop","gradient","minY","maxY","lineJoin","distort","pos","historyCanvas","$7de2f0eab7a9ead7$export$f1561c72be54c6a7","penBrush","$cVFne","penBrushUi","blendBrush","$9mjXI","blendBrushUi","sketchyBrush","$iYbUv","sketchyBrushUi","pixelBrush","$brjBD","pixelBrushUi","chemyBrush","$vCnsd","chemyBrushUi","smudgeBrush","$dS2qM","smudgeBrushUi","$9rc5F","eraserBrushUi","brushInterface","alphaNames","$8b6ca25eb0830594$export$a0d4983f3b0b5c8e","$7gVvp","updateAlphas","alphas","currentAlpha","spacingSpline","lockAlphaToggle","$7NTKy","pressureSizeToggle","pressureOpacityToggle","alphaWrapper","$e8a5c017c49bb311$export$5ec472fd0ce20d84","$2e3c50106ba150d5$export$156bb4fe8f4bcb4b","$cQSIC","blendingSlider","setSizePressure","setOpacityPressure","$94537af75923b9e3$export$ffae56164d1bde68","$bteky","blendSlider","scaleSlider","$9519e739bc9666ee$export$d001f3406562d07","$4PDnu","ditherToggle","getUseDither","toggleRow","$d6fc2ded7d9d56db$export$cf481ecf227135a8","$984eq","isTransparentBg","transparencyToggle","$1045b9bae2ffbbb4$export$84831662ba707e7a","$3QgTy","$18456e8104a5a825$export$80819a93636ebb04","$18kre","actualIconSize","iconSize","modeOptions","mirrorXToggle","halfSize","getXSymmetry","setXSymmetry","mirrorYToggle","getYSymmetry","setYSymmetry","gradientToggle","getGradient","setGradient","$14dc4cf18966a4f4$export$2358c75ad3c15b2d","$6f92981a32875bca$export$5334e08b3589fc5c","isEmbed","linkEl","iframe","href","contentWindow","location","isMaxHeight","$142eacf53b1eb43d$export$3dff5655255b5729","ignoreFocus","inputs","$0e681e75eb3cab30$export$9c72cf485ef46673","gridTemplateColumns","gridTemplateRows","gap","gridTemplateAreas","gridArea","infoEl","isBroken","ageEl","textSize","storeEl","clearEl","hideClearButton","storeListener","onUpdate","timestamp","thumbnail","updateThumb","updateAge","readResult","read","ageStr","age","maxWidth","maxHeight","resetButtons","Promise","bind","unsubscribe","$14b343f2c12ca9c5$var$makeAsync","reject","$14b343f2c12ca9c5$export$93d91060b9af7e2a","accessHasFailed","storeKlProjectObj","getKlProjectObj","lowLevelRead","$3hwQ7","ProjectConverter","readStorageProject","storageProject1","createStorageProject","lowLevelStore","lowLevelClear","updateTimestamp","$3ee249752703e788$var$loadImage","onabort","$3ee249752703e788$export$f3c1ac6650038646","$2wCWz","base64ToBlob","createThumbnail","HTMLCanvasElement","all","t2","$e3587a28373f51f9$export$b3fb17ae4345ac8f","base64Str","parts","binStr","atob","buf","ArrayBuffer","view","Uint8Array","charCodeAt","$01ce2e23a2667e77$export$a2647fbf5f056b0a","onExportTypeChange","onFileSelect","onSaveImageToComputer","onNewImage","onShareImage","onUpload","onCopyToClipboard","createSpacer","clearer","line","filemenu","uploadImgurButton","clipboardButton","$4xKQD","multiple","accept","exportTypeWrapper","exportTypeSelect","importWrapper","innerMask","importFakeButton","createImportButton","saveNote","fileBrowserStorage","refresh","$0d10046ca7f6fbd0$export$3f17d740ad471e50","getCurrentColor","getKlMaxCanvasSize","getKlCanvas","getCurrentLayerCtx","isInit","filterKey","filterArr","applyFilter","filterDialog1","currentColorRgb","secondaryColorRgb","filterDialog","getInput","finishedDialog","createDisabledButton","appName","addGroup","groupArr","filters","groupA","groupB","filterKey1","hrEl","webglnote","$6349b006a6604e1b$var$upload","description","_upload","gif","labelText","response","formData","$j8sUl","FormData","method","headers","Authorization","ok","json","link","$6349b006a6604e1b$export$b1dd62fa0b5f32f5","inputTitle","inputDescription","rows","labelTitle","labelDescription","tos","typeRadio","outDiv","infoHint","deletehash","$ae23cd0c3e53f398$var$agPsdLazy","$ae23cd0c3e53f398$export$ab3d838b1d336b38","_loadAgPsd","$06e8423858d08972$export$befc6437ad34b28a","showReminder","changeTitle","onSaveAsPsd","lastSavedActionNumber","lastSavedAt","psdWrapper","storageWrapper","paddingBottom","psdBtn","storageUi","closeFunc","lastReminderShownAt","onBeforeUnload","returnValue","getActionNumber","visibilityState","unsavedActions","showPopup","unsavedInterval","$956d06d740fc5053$export$75e7b60500bb415b","getExportType","format","saveImage","mimeType","$98ax7","saveAs","mimeType2","filename1","fnameArr","fileBase","layerArr1","psdConfig","blendKlToPsd","writePsdBuffer","XMLHttpRequest","responseType","g1","send","d1","a2","status","dispatchEvent","createEvent","initMouseEvent","self","$parcel$global","global","a1","HTMLAnchorElement","download","rel","msSaveOrOpenBlob","autoBom","warn","HTMLElement","safari","onloadend","readAsDataURL","define","amd","FileSaver","$48534f13b7192dff$export$5cebd3bb2d68229a","getInitState","setCurrentLayerCtx","getCurrentBrush","doIgnore","ignoreTest","oldSize","b4","id1","b3","b8","p5","b5","p6","b6","id2","b7","currentLayerIndex","logParam","localCurrentLayerCtx","p7","p8","b9","p9","b10","id3","b11","$53cc60fd413705d6$export$272bfd3ef9ef2f48","onSetColor","onSetSize","onSetOpacity","onGetColor","onGetSize","onGetOpacity","onGetSliderConfig","subscriberArr","instance","skipSubscriber","$5562b5b6c391a7ca$export$5d396b237bd33221","customAbout","makeLicenses","licenses","overflowY","language","getLanguage","preferredLanguageRow","$fgfvl","languages","languageSelect","LS_LANGUAGE_KEY","languageHint","$7OLuX","$6qSiv","$951e508110f8a437$export$42a534af7eb650e8","upBtn","downBtn","upInterval","scrollBy","downInterval","wheelListener","$b37f5cd553722692$export$665d2c76b1eb8459","submitButton","leftRightButton","$4bb0d03ef02dc0c0$var$importFilter","libObj","moduleObj","$4bb0d03ef02dc0c0$export$4283b00eae4a6956","$99EgS","$5deND","$4d8c6","$5Ta9b","$gMKRz","$7z464","$diAhN","$c1rJJ","$2elec","$gACTl","$dIv7c","$1NZ3i","$cJB4E","$gTwOE","$1e763c481ba6cf00$export$80884bc1ac80aa1d","selectedLayerIndex","brightness","contrast","glCanvas","$5RaQo","getSharedFx","texture","brightnessSlider","$cH2YE","brightnessContrast","contrastSlider","previewInnerWrapper","$fca35583bfaa35b6$export$5ec472fd0ce20d84","$0e6e34a2063e157d$var$fxCanvas","$TEtAx","fx","$0e6e34a2063e157d$export$8c4423af32b21158","_","isContextLost","$5eb53faa48338ac6$export$68ae324f2f6c6252","lo","hi","wrapTexture","loadContentsOf","gl1","texture1","Texture1","fromElement","initialize","UNSIGNED_BYTE","getExtension","testTexture","RGBA","FLOAT","drawTo","spareTexture","extraTexture","flippedShader","Shader1","use","getDefaultShader","drawRect","simpleShader","shader","uniforms","textureIn","textureOut","swapWith","node","contents","getPixelArray","array","readPixels","dx1","dy1","dx2","dy2","dx3","dy3","det","warpShader","warp","interpolator","curves","red","green","blue","splineInterpolate","initFromBytes","textures","denoise","exponent","texSize","hueSaturation","amount","sepia","unsharpMask","strength","ensureFormat","triangleBlur","unuse","vibrance","vignette","lensBlur","lensBlurPrePass","randomShaderFunc","lensBlur0","common","lensBlur1","lensBlur2","power","delta0","delta1","tiltShift","endX","endY","blurRadius","gradientRadius","zoomBlur","colorHalftone","dotScreen","edgeWork1","edgeWork2","hexagonalPixelate","replaceRGBA","oldGetExtension","oldGetSupportedExtensions","OESTextureFloatLinear","getSupportedExtensions","framebuffer","createFramebuffer","byteTexture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","floatTexture","LINEAR","Float32Array","program","createProgram","vertexShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","shaderSource","compileShader","attachShader","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STREAM_DRAW","enableVertexAttribArray","vertexAttribPointer","useProgram","viewport","drawArrays","POINTS","supportsOESTextureFloatLinear","WebGLRenderingContext","$OES_texture_float_linear$","extensions","perspective","matrixWarp","bulgePinch","edgeWork","swirl","ink","compileSource","testPrecisionSupport","Shader","defaultFragmentSource","source","nameStr","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","precisionType","getShaderPrecisionFormat","precision","vertexSource","fragmentSource","vertexAttribute","texCoordAttribute","defaultVertexSource","floatPrecision","HIGH_FLOAT","MEDIUM_FLOAT","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","getUniformLocation","uniform1fv","uniform2fv","uniform3fv","uniform4fv","uniformMatrix3fv","uniformMatrix4fv","isNumber","uniform1f","uniform1i","getParameter","VIEWPORT","vertexBuffer","STATIC_DRAW","texCoordBuffer","defaultShader","Texture","videoWidth","videoHeight","unit","activeTexture","TEXTURE0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","getCanvas","pixels","other","$21fb62da4f6e89f8$export$4630dcf80f8ceb88","leftInput","rightInput","topInput","bottomInput","leftChanged","rightChanged","fit1","previewFactor","topChanged","bottomChanged","updateInput","labelStyle","ruleOThirdsCheckbox","useRuleOfThirds","cropper","selectedRgbaObj","updateBg","flexRow","bgColorOverlay","offsetWrapper","register","$e250f451a2faf8b3$export$2e9081b953703a77","canvas1","ctx1","curves1","modeButtons","p0","areah","areaw","update2","curveArea","createPoint","lock","internalY","internalX","newX","newY","updateControl","outCurves","drawCurve","getDiv","$ae0fd60a73f3b8a4$export$8a83211c878a3f1f","previewLayer","doFlipCanvas","horizontalCheckbox","verticalCheckbox","fcOption","borderTopLeftRadius","$1RI49","flOption","borderTopRightRadius","optionWrapper","horizontal","vertical","flipCanvas","Saturation","hueSlider","saturationSlider","$d23471d9289cfec2$export$6897c284b6f9f4dc","$ed63f0c6c7ca7574$export$358acb0cd681f612","displayH","displayW","bb","bc","bd","ac","ad","nob","updateAfter","beforeOption","afterOption","pointerListenerArr","displayPreviewFactor","after","nobSize","$2405b4796fda9858$export$4380c87abf28fdf","algorithmSelect","canvasWrapper","previewH","inputWrapper","$jfTWC","constrainCheckbox","secondRowElement","$5b99ea702a5304d2$export$bb628a54ab399bc9","WebkitTransform","MozTransform","OTransform","msTransform","btnPlus","btnMinus","$e3bfa9cf59911118$export$83a0900d4b9a8022","fa","fb","blurSlider","gradientSlider","$dc2850290325f029$export$51186ad6e864892a","lastDrawnTransformStr","transformLayerCanvas","onInputsChanged","inputR","tempBounds","rotWrapper","leftWrapper","rightWrapper","buttonRow","flipYBtn","actionBtnCss","scaleRotLeftBtn","scaleRotRightBtn","scaleDoubleBtn","getRatio","setConstrained","isSnapping","setSnapping","snappingCheckbox","bottomRow","checkboxWrapper","flipXBtn","scaleHalfBtn","radiusSlider"],"version":3,"file":"main-embed.043e8b08.js.map"}