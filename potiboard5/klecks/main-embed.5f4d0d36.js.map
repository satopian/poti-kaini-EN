{"mappings":"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","sources":["src/app/script/main-embed.ts","src/app/script/polyfills.ts","node_modules/mdn-polyfills/Node.prototype.append.js","node_modules/mdn-polyfills/Node.prototype.prepend.js","node_modules/mdn-polyfills/String.prototype.padStart.js","src/app/script/app/kl-app.ts","src/app/script/klecks/kl.ts","src/app/script/klecks/history/kl-history.ts","src/app/script/klecks/ui/modals/popup.ts","src/app/script/klecks/ui/modals/modal-count.ts","src/app/script/bb/bb.ts","src/app/script/bb/input/event-listener.ts","src/app/script/bb/base/browser.ts","src/app/script/bb/base/create-canvas.ts","src/app/script/bb/base/base.ts","src/app/script/bb/input/key-listener.ts","src/app/script/bb/input/pointer-listener.ts","src/app/script/bb/math/math.ts","src/app/script/bb/input/event-chain.ts","src/app/script/bb/base/canvas.ts","src/app/script/bb/math/matrix.ts","src/app/script/bb/math/vec2.ts","src/app/script/bb/math/line.ts","src/app/script/bb/color/color.ts","src/app/script/bb/base/ui.ts","src/app/script/bb/base/bb-log.ts","<<jsx-config-pragma.js>>","src/app/script/bb/base/local-storage.ts","node_modules/@parcel/runtime-js/lib/runtime-34832b43d0ebd3bf.js","node_modules/@parcel/runtime-js/lib/runtime-a96f6567e6dac4f3.js","src/app/script/klecks/ui/base-components/checkbox.ts","src/app/script/klecks/ui/base-components/input.ts","src/app/script/klecks/ui/base-components/select.ts","src/app/script/klecks/ui/base-components/image-toggle.ts","src/app/script/klecks/ui/base-components/image-radio-list.ts","src/app/script/klecks/ui/base-components/pen-pressure-toggle.ts","node_modules/@parcel/runtime-js/lib/runtime-065238818b5d6d26.js","src/app/script/klecks/ui/base-components/kl-slider.ts","src/app/script/klecks/ui/base-components/slider-falloff.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-ce95b2abc71314b0.js","src/app/script/klecks/ui/base-components/kl-color-slider.ts","node_modules/@parcel/runtime-js/lib/runtime-e7bece06ac3b91da.js","src/app/script/klecks/ui/base-components/kl-color-slider-small.ts","src/app/script/klecks/ui/base-components/point-slider.ts","src/app/script/klecks/ui/base-components/color-options.ts","src/app/script/klecks/ui/base-components/options.ts","src/app/script/klecks/ui/components/status-overlay.ts","node_modules/@parcel/runtime-js/lib/runtime-76fc4a9796871f89.js","src/app/script/klecks/ui/modals/export-dialog-deprecated.ts","src/app/script/klecks/ui/components/crop-copy.ts","src/app/script/klecks/ui/modals/clipboard-dialog.ts","src/app/script/klecks/ui/tool-tabs/kl-layer-manager.ts","node_modules/@parcel/runtime-js/lib/runtime-9e9c6514323b50ff.js","node_modules/@parcel/runtime-js/lib/runtime-f141aefb87a862aa.js","node_modules/@parcel/runtime-js/lib/runtime-e93ed5f4a72fe388.js","node_modules/@parcel/runtime-js/lib/runtime-e1e96fa0dcd63695.js","node_modules/@parcel/runtime-js/lib/runtime-2d2417fe7f53ff5b.js","src/app/script/klecks/canvas/kl-canvas.ts","src/app/script/klecks/image-operations/flood-fill.ts","src/app/script/klecks/image-operations/shape-tool.ts","src/app/script/klecks/image-operations/render-text.ts","src/app/script/klecks/canvas/draw-project.ts","src/app/script/klecks/canvas/translate-blending.ts","src/app/script/klecks/canvas-ui/workspace-svg-overlay.ts","src/app/script/klecks/canvas-ui/kl-canvas-workspace.ts","node_modules/@parcel/runtime-js/lib/runtime-ce6158b179cda36d.js","node_modules/@parcel/runtime-js/lib/runtime-9180b336d2c14eb8.js","node_modules/@parcel/runtime-js/lib/runtime-e98ceba16f4f3e8c.js","node_modules/@parcel/runtime-js/lib/runtime-1c4e2d66dbd3cd26.js","src/app/script/klecks/canvas-ui/canvas-preview.ts","src/app/script/klecks/ui/components/free-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-7b1b46c773a5d5de.js","src/app/script/klecks/ui/components/free-transform-canvas.ts","src/app/script/klecks/ui/components/cropper.ts","src/app/script/klecks/ui/components/layer-preview.ts","src/app/script/klecks/ui/components/fitted-image.ts","src/app/script/klecks/ui/modals/show-import-as-layer-dialog.ts","src/app/script/klecks/ui/components/kl-image-dropper.ts","src/app/script/klecks/ui/components/overlay-toolspace.ts","src/app/script/klecks/ui/components/toolspace-top-row.ts","node_modules/@parcel/runtime-js/lib/runtime-c595ccae60beff87.js","node_modules/@parcel/runtime-js/lib/runtime-e5d7180bbee5b536.js","node_modules/@parcel/runtime-js/lib/runtime-6c52a4e8d76ec49b.js","node_modules/@parcel/runtime-js/lib/runtime-fa73233744fc505c.js","node_modules/@parcel/runtime-js/lib/runtime-b34e92e9fb9b8c68.js","node_modules/@parcel/runtime-js/lib/runtime-8a2022a1c05c8770.js","src/app/script/klecks/ui/components/tool-dropdown.ts","node_modules/@parcel/runtime-js/lib/runtime-760df77bff0950f0.js","node_modules/@parcel/runtime-js/lib/runtime-ff3da4d7dabee86d.js","node_modules/@parcel/runtime-js/lib/runtime-297f8366ec2375c9.js","node_modules/@parcel/runtime-js/lib/runtime-d831990ac91a582d.js","node_modules/@parcel/runtime-js/lib/runtime-621488e8bcab6d4d.js","src/app/script/klecks/ui/components/toolspace-tool-row.ts","node_modules/@parcel/runtime-js/lib/runtime-7355152122a84936.js","node_modules/@parcel/runtime-js/lib/runtime-81519c452bdfbaa9.js","node_modules/@parcel/runtime-js/lib/runtime-3fc59c96423b70ad.js","node_modules/@parcel/runtime-js/lib/runtime-1eef10cb07c9c851.js","src/app/script/klecks/ui/components/toolspace-stabilizer-row.ts","src/app/script/klecks/ui/components/tab-row.ts","node_modules/@parcel/runtime-js/lib/runtime-b9f67aff2ffaa235.js","src/app/script/klecks/ui/tool-tabs/hand-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-4486cf75fca81822.js","src/app/script/klecks/ui/tool-tabs/fill-ui.ts","src/app/script/klecks/ui/tool-tabs/text-ui.ts","src/app/script/klecks/ui/tool-tabs/shape-ui.ts","src/app/script/klecks/ui/modals/new-image-dialog.ts","src/app/script/klecks/ui/components/toolspace-collapser.ts","node_modules/@parcel/runtime-js/lib/runtime-3ca3a85d3436a84f.js","src/app/script/klecks/ui/modals/text-tool-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-47401ec572d2cfcf.js","node_modules/@parcel/runtime-js/lib/runtime-6476cf999a0e75d3.js","node_modules/@parcel/runtime-js/lib/runtime-4ee49cef2a1bfd51.js","node_modules/@parcel/runtime-js/lib/runtime-01d9fe07522d7373.js","node_modules/@parcel/runtime-js/lib/runtime-8450ca7f4e68dde7.js","src/app/script/klecks/ui/modals/show-import-image-dialog.ts","src/app/script/klecks/storage/psd.ts","src/app/script/klecks/storage/indexed-db.ts","src/app/script/klecks/filters/filters.ts","node_modules/@parcel/runtime-js/lib/runtime-08ec85fc3ea564e8.js","node_modules/@parcel/runtime-js/lib/runtime-c105dce751d9b16c.js","node_modules/@parcel/runtime-js/lib/runtime-272cd0cc0051d99c.js","node_modules/@parcel/runtime-js/lib/runtime-d623cec3e031c802.js","node_modules/@parcel/runtime-js/lib/runtime-4aa563d1de55ad17.js","node_modules/@parcel/runtime-js/lib/runtime-acf5209c71eb3497.js","node_modules/@parcel/runtime-js/lib/runtime-726a62492af9f94e.js","node_modules/@parcel/runtime-js/lib/runtime-f1cff4f2714da535.js","node_modules/@parcel/runtime-js/lib/runtime-06b47f2ffca8a188.js","node_modules/@parcel/runtime-js/lib/runtime-866a2902b0cdf580.js","node_modules/@parcel/runtime-js/lib/runtime-3b4878106cdf1b9c.js","node_modules/@parcel/runtime-js/lib/runtime-02847deebefdd0a7.js","node_modules/@parcel/runtime-js/lib/runtime-3dce3f08da564a07.js","node_modules/@parcel/runtime-js/lib/runtime-0e43c74fde652ea0.js","src/app/script/klecks/brushes/brushes.ts","src/app/script/klecks/brushes/pen-brush.ts","src/app/script/klecks/brushes/brushes-common.ts","src/app/script/klecks/brushes/alphas/brush-alphas.ts","src/app/script/bb/math/perlin.ts","src/app/script/klecks/brushes/blend-brush.ts","src/app/script/klecks/brushes/sketchy-brush.ts","src/app/script/klecks/brushes/pixel-brush.ts","src/app/script/klecks/brushes/eraser-brush.ts","src/app/script/klecks/brushes/smudge-brush.ts","src/app/script/klecks/brushes/chemy-brush.ts","src/app/script/klecks/brushes-ui/brushes-ui.ts","src/app/script/klecks/brushes-ui/pen-brush-ui.ts","src/app/script/klecks/brushes-ui/brushes-consts.ts","node_modules/@parcel/runtime-js/lib/runtime-f5fee83b55dfe524.js","src/app/script/klecks/brushes-ui/blend-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-c1ff462122383f3a.js","src/app/script/klecks/brushes-ui/sketchy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-c362cafb743e4bf7.js","src/app/script/klecks/brushes-ui/pixel-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-9083363aed84d015.js","src/app/script/klecks/brushes-ui/eraser-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-72d61ca9dbc6379a.js","src/app/script/klecks/brushes-ui/smudge-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-2e54934a27c8b910.js","src/app/script/klecks/brushes-ui/chemy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-a3466c6b7be08d45.js","src/app/script/klecks/ui/base-components/box-toggle.ts","src/app/script/klecks/ui/modals/show-iframe-popup.ts","src/app/script/klecks/ui/base-components/radio-list.ts","src/app/script/klecks/ui/components/browser-storage-ui.ts","src/app/script/klecks/storage/project-store.ts","src/app/script/klecks/storage/project-converter.ts","src/app/script/klecks/storage/base-64-to-blob.ts","src/app/script/klecks/ui/tool-tabs/file-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-174f5efa9e6f0131.js","src/app/script/klecks/ui/tool-tabs/filter-tab.ts","src/app/script/klecks/ui/modals/imgur-upload.ts","node_modules/@parcel/runtime-js/lib/runtime-257b8f01a8ca9ad6.js","src/app/script/klecks/storage/ag-psd-wrapper.ts","node_modules/@parcel/runtime-js/lib/runtime-5ea32053680ef652.js","src/app/script/klecks/ui/components/save-reminder.ts","src/app/script/klecks/storage/save-to-computer.ts","node_modules/file-saver/src/FileSaver.js","src/app/script/klecks/history/undo-redo-catchup.ts","src/app/script/klecks/brushes-ui/brush-setting-service.ts","src/app/script/klecks/ui/tool-tabs/settings-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-3e3712af4386deba.js","node_modules/@parcel/runtime-js/lib/runtime-050615743b2088cc.js","node_modules/@parcel/runtime-js/lib/runtime-4135c6b241ed0f39.js","src/app/script/klecks/ui/components/toolspace-scroller.ts","src/app/script/embed/toolspace-top-row.ts","src/app/script/klecks/filters/filters-lazy.ts","src/app/script/klecks/filters/gl-brightness-contrast.ts","src/app/script/klecks/filters/filters-consts.ts","src/app/script/klecks/filters/shared-gl-fx.ts","src/app/script-vendor/glfx.ts","src/app/script/klecks/filters/crop-extend.ts","src/app/script/klecks/filters/gl-curves.ts","src/app/script/klecks/filters/flip.ts","node_modules/@parcel/runtime-js/lib/runtime-0b614230dd5a2fbc.js","src/app/script/klecks/filters/gl-hue-saturation.ts","src/app/script/klecks/filters/invert.ts","src/app/script/klecks/filters/gl-perspective.ts","src/app/script/klecks/filters/resize.ts","node_modules/@parcel/runtime-js/lib/runtime-c388461235ee692d.js","src/app/script/klecks/filters/rotate.ts","src/app/script/klecks/filters/gl-tilt-shift.ts","src/app/script/klecks/filters/transform.ts","src/app/script/klecks/filters/gl-blur.ts","src/app/script/klecks/filters/gl-unsharp-mask.ts","src/app/script/klecks/filters/to-alpha.ts","src/app/script/klecks/filters/grid.ts","src/app/script/klecks/image-operations/draw-grid.ts","src/app/script/klecks/storage/kl-canvas-to-psd-blob.ts","node_modules/@parcel/runtime-js/lib/runtime-fe04d655c2a3180f.js","node_modules/@parcel/runtime-js/lib/runtime-f15ea15a7900b9a3.js"],"sourcesContent":["import './polyfills';\r\nimport {KlApp} from './app/kl-app';\r\nimport {IKlProject} from './klecks/kl.types';\r\nimport {SaveReminder} from './klecks/ui/components/save-reminder';\r\nimport {klHistory} from './klecks/history/kl-history';\r\nimport {klPsdToKlProject, readPsd} from './klecks/storage/psd';\r\nimport {LANG} from './language/language';\r\n\r\nexport interface IEmbedParams {\r\n    project?: IKlProject,\r\n    psdBlob?: Blob,\r\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    embedUrl: string;\r\n    logoImg?: any;\r\n    bottomBar?: HTMLElement;\r\n    aboutEl?: HTMLElement;\r\n}\r\n\r\nexport interface IReadPSD {\r\n    blob: Blob;\r\n    callback: (k: IKlProject) => void;\r\n}\r\n\r\nexport function Embed(p: IEmbedParams) {\r\n\r\n    let isInitialized: boolean = false;\r\n    let klApp;\r\n    const psdQueue: IReadPSD[] = []; // queue of psds waiting while ag-psd is loading\r\n    let agPsd: any | 'error';\r\n\r\n    let loadingScreenEl = document.getElementById(\"loading-screen\");\r\n    let loadingScreenTextEl = document.getElementById(\"loading-screen-text\");\r\n    if (loadingScreenTextEl) {\r\n        loadingScreenTextEl.textContent = LANG('embed-init-waiting');\r\n    }\r\n\r\n    function onProjectReady(project: IKlProject) {\r\n        try {\r\n            if (isInitialized) {\r\n                throw new Error('Already called openProject');\r\n            }\r\n            isInitialized = true;\r\n\r\n            const saveReminder = new SaveReminder(\r\n                klHistory,\r\n                false,\r\n                false,\r\n                () => {},\r\n                () => klApp ? klApp.isDrawing() : false,\r\n                null,\r\n                null,\r\n            );\r\n            klApp = new KlApp(\r\n                project,\r\n                {\r\n                    saveReminder,\r\n                    bottomBar: p.bottomBar,\r\n                    aboutEl: p.aboutEl,\r\n                    embed: {\r\n                        url: p.embedUrl,\r\n                        onSubmit: p.onSubmit,\r\n                    }\r\n                }\r\n            );\r\n            saveReminder.init();\r\n\r\n            if (loadingScreenEl && loadingScreenEl.parentNode) {\r\n                loadingScreenEl.parentNode.removeChild(loadingScreenEl);\r\n            }\r\n            loadingScreenEl = null;\r\n            loadingScreenTextEl = null;\r\n\r\n            document.body.appendChild(klApp.getEl());\r\n        } catch (e) {\r\n            if (loadingScreenTextEl) {\r\n                loadingScreenTextEl.textContent = ' ' + e;\r\n            }\r\n            if (loadingScreenEl) {\r\n                loadingScreenEl.className += 'loading-screen-error';\r\n            }\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    if (p.project) {\r\n        onProjectReady(p.project);\r\n    }\r\n    this.openProject = onProjectReady;\r\n    this.initError = (error: string) => {\r\n        if (loadingScreenTextEl) {\r\n            loadingScreenTextEl.textContent = ' ' + error;\r\n        }\r\n        if (loadingScreenEl) {\r\n            loadingScreenEl.className += 'loading-screen-error';\r\n        }\r\n    };\r\n    this.getPNG = (): Blob => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return klApp.getPNG();\r\n    };\r\n    this.getPSD = async (): Promise<Blob> => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return await klApp.getPSD();\r\n    };\r\n    this.readPSDs = (psds: IReadPSD[]) => {\r\n        if (psds.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const readItem = (item: IReadPSD) => {\r\n            try {\r\n                const psd = agPsd.readPsd(item.blob);\r\n                const project = klPsdToKlProject(readPsd(psd));\r\n                item.callback(project);\r\n            } catch (e) {\r\n                console.error('failed to read psd', e);\r\n                item.callback(null);\r\n            }\r\n        };\r\n\r\n        if (!agPsd) {\r\n            if (psdQueue.length === 0) {\r\n                // load ag-psd\r\n                (async () => {\r\n                    try {\r\n                        agPsd = await import('ag-psd');\r\n                    } catch (e) {\r\n                        agPsd = 'error';\r\n                    }\r\n                    while (psdQueue.length) {\r\n                        readItem(psdQueue.shift());\r\n                    }\r\n                })();\r\n            }\r\n            psds.forEach(item => {\r\n                psdQueue.push(item);\r\n            });\r\n        } else {\r\n            psds.forEach(readItem);\r\n        }\r\n    };\r\n}","// import 'core-js';\r\nimport 'mdn-polyfills/Node.prototype.append';\r\nimport 'mdn-polyfills/Node.prototype.prepend';\r\nimport 'mdn-polyfills/String.prototype.padStart';\r\n\r\nif (!('scrollTo' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollTo', {\r\n        value: function (x, y) {\r\n            this.scrollLeft = x;\r\n            this.scrollTop = y;\r\n        }\r\n    });\r\n}\r\n\r\nif (!('scrollBy' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollBy', {\r\n        value: function (x, y) {\r\n            this.scrollLeft += x;\r\n            this.scrollTop += y;\r\n        }\r\n    });\r\n}\r\n\r\n// sometimes Android WebView has no localStorage\r\nif (!('localStorage' in window)) {\r\n    try {\r\n        window['localStorage'] = {\r\n            getItem: () => null,\r\n            setItem: () => {},\r\n            removeItem: () => {},\r\n        } as any;\r\n    } catch (e) {\r\n        // maybe it doesn't let me set this\r\n    }\r\n}","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"append\")||Object.defineProperty(e,\"append\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(n,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"prepend\")||Object.defineProperty(e,\"prepend\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","String.prototype.padStart||(String.prototype.padStart=function(t,n){return t>>=0,n=String(n||\" \"),this.length>t?String(this):((t-=this.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(this))});\n","import {KL} from '../klecks/kl';\r\nimport {klHistory} from '../klecks/history/kl-history';\r\nimport {BB} from '../bb/bb';\r\nimport {showIframePopup} from '../klecks/ui/modals/show-iframe-popup';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\nimport {exportType} from '../klecks/ui/tool-tabs/file-tab';\r\nimport {ToolspaceTopRow} from \"../embed/toolspace-top-row\";\r\nimport {IInitState, IKlProject, IKlPsd} from '../klecks/kl.types';\r\nimport {importFilters} from '../klecks/filters/filters-lazy';\r\nimport {base64ToBlob} from '../klecks/storage/base-64-to-blob';\r\nimport {klCanvasToPsdBlob} from '../klecks/storage/kl-canvas-to-psd-blob';\r\nimport {ProjectStore} from '../klecks/storage/project-store';\r\nimport {SaveReminder} from \"../klecks/ui/components/save-reminder\";\r\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\r\nimport {LANG} from '../language/language';\r\n// @ts-ignore\r\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\r\n// @ts-ignore\r\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\r\n// @ts-ignore\r\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\r\n// @ts-ignore\r\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\r\n// @ts-ignore\r\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\r\n// @ts-ignore\r\nimport tabSettingsImg from 'url:~/src/app/img/ui/tab-settings.svg';\r\n// @ts-ignore\r\nimport tabLayersImg from 'url:~/src/app/img/ui/tab-layers.svg';\r\nimport {LocalStorage} from '../bb/base/local-storage';\r\n\r\n\r\ninterface IKlAppOptions {\r\n    saveReminder?: SaveReminder;\r\n    projectStore?: ProjectStore;\r\n    logoImg?: any; // app logo\r\n    bottomBar?: HTMLElement; // row at bottom of toolspace\r\n    embed?: {\r\n        url: string;\r\n        onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    };\r\n    app?: {\r\n        filenameBase?: string; // part of filename when downloading drawing\r\n        imgurKey?: string; // for imgur uploads\r\n    };\r\n    aboutEl?: HTMLElement; // replaces info about Klecks in settings tab\r\n}\r\n\r\nimportFilters();\r\n\r\nexport function KlApp(pProject: IKlProject | null, pOptions: IKlAppOptions) {\r\n    // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\r\n    // but not larger than 4096 - a fairly arbitrary decision\r\n    let klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\r\n    let collapseThreshold = 820;\r\n    let uiState: 'left' | 'right' = (pOptions.embed ? 'left' : (LocalStorage.getItem('uiState') ? LocalStorage.getItem('uiState') : 'right')) as any;\r\n    const filenameBase = pOptions.app?.filenameBase ? pOptions.app.filenameBase : 'Klecks';\r\n    const projectStore = pOptions.projectStore;\r\n    let klRootEl = document.createElement(\"div\");\r\n    klRootEl.className = 'g-root';\r\n    let uiWidth: number = Math.max(0, window.innerWidth);\r\n    let uiHeight: number = Math.max(0, window.innerHeight);\r\n    const toolWidth = 271;\r\n    let exportType: exportType = 'png';\r\n    let klCanvas: KlCanvas = new KL.KlCanvas(\r\n        pProject ? {\r\n            projectObj: pProject\r\n        } : {\r\n            width: Math.max(10, Math.min(klMaxCanvasSize, window.innerWidth < collapseThreshold ? uiWidth : uiWidth - toolWidth)),\r\n            height: Math.max(10, Math.min(klMaxCanvasSize, uiHeight)),\r\n        }, pOptions.embed ? -1 : 0);\r\n    klCanvas.setHistory(klHistory);\r\n    let initState: IInitState = null;\r\n    let mainTabRow;\r\n\r\n    if (!pOptions.saveReminder) {\r\n        pOptions.saveReminder = {init: () => {}, reset: () => {}} as SaveReminder;\r\n    }\r\n\r\n    function translateSmoothing(s: number): number {\r\n        if (s == 1) {\r\n            return 1 - 0.5;\r\n        }\r\n        if (s == 2) {\r\n            return 1 - 0.16;\r\n        }\r\n        if (s == 3) {\r\n            return 1 - 0.035;\r\n        }\r\n        if (s == 4) {\r\n            return 1 - 0.0175;\r\n        }\r\n        if (s == 5) {\r\n            return 1 - 0.00875;\r\n        }\r\n        return s;\r\n    }\r\n\r\n    let isFirstImage = true;\r\n\r\n    if (pProject) {\r\n        pProject.layers.forEach(layer => {\r\n            layer.image = null;\r\n        });\r\n        pProject = null;\r\n    } else {\r\n        klHistory.pause(true);\r\n        klCanvas.addLayer();\r\n        klCanvas.layerFill(0, { r: 255, g: 255, b: 255});\r\n        klHistory.pause(false);\r\n    }\r\n    try {\r\n        initState = {\r\n            canvas: new KL.KlCanvas({copy: klCanvas}, pOptions.embed ? -1 : 0),\r\n            focus: klCanvas.getLayerCount() - 1,\r\n            brushes: {},\r\n        };\r\n    } catch (e) {\r\n        if (e.message === 'kl-create-canvas-error') {\r\n            klCanvas.destroy();\r\n        }\r\n        throw e;\r\n    }\r\n    for (let b in KL.brushes) {\r\n        if (KL.brushes.hasOwnProperty(b)) {\r\n            initState.brushes[b] = new KL.brushes[b]();\r\n            if (initState.canvas) {\r\n                initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    let currentColor = new BB.RGB(0, 0, 0);\r\n    let currentBrush, currentBrushId;\r\n    let lastNonEraserBrushId = 0;\r\n    let currentLayerCtx = klCanvas.getLayerContext(klCanvas.getLayerCount() - 1);\r\n\r\n    function sizeWatcher(val) {\r\n        brushSettingService.emitSize(val);\r\n        if (klCanvasWorkspace) {\r\n            klCanvasWorkspace.setCursorSize(val * 2);\r\n        }\r\n    }\r\n\r\n    const brushSettingService = new KL.BrushSettingService(\r\n        (color) => {\r\n            klColorSlider.setColor(color);\r\n            currentBrush.setColor(color);\r\n            currentColor = BB.copyObj(color);\r\n        },\r\n        (size) => {\r\n            currentBrush.setSize(size);\r\n            klCanvasWorkspace.setCursorSize(size * 2);\r\n        },\r\n        (opacity) => {\r\n            currentBrush.setOpacity(opacity);\r\n        },\r\n        () => klColorSlider.getColor(),\r\n        () => brushUiObj[currentBrushId].getSize(),\r\n        () => brushUiObj[currentBrushId].getOpacity(),\r\n        () => {\r\n            return {\r\n                sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\r\n            };\r\n        }\r\n    );\r\n\r\n    let lineSmoothing = new BB.EventChain.LineSmoothing({\r\n        smoothing: translateSmoothing(1),\r\n    });\r\n    let lineSanitizer = new BB.EventChain.LineSanitizer();\r\n\r\n    let drawEventChain = new BB.EventChain.EventChain({\r\n        chainArr: [\r\n            lineSanitizer,\r\n            lineSmoothing\r\n        ],\r\n    });\r\n\r\n    drawEventChain.setChainOut(function(event) {\r\n        if (event.type === 'down') {\r\n            toolspace.style.pointerEvents = 'none';\r\n            currentBrush.startLine(event.x, event.y, event.pressure);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'move') {\r\n            currentBrush.goLine(event.x, event.y, event.pressure, false, event.isCoalesced)\r\n            klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'up') {\r\n            toolspace.style.pointerEvents = '';\r\n            currentBrush.endLine();\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'line') {\r\n            currentBrush.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n    });\r\n\r\n    let textToolSettings = {\r\n        size: 20,\r\n        align: 'left' as ('left' | 'center' | 'right'),\r\n        isBold: false,\r\n        isItalic: false,\r\n        font: 'sans-serif' as ('serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'),\r\n        opacity: 1\r\n    };\r\n\r\n    const klCanvasWorkspace: KlCanvasWorkspace = new KL.KlCanvasWorkspace({\r\n        klCanvas: klCanvas,\r\n        width: Math.max(0, uiWidth - toolWidth),\r\n        height: uiHeight,\r\n        onDraw: drawEventChain.chainIn,\r\n        onPick: function(rgbObj, isDragDone) {\r\n            brushSettingService.setColor(rgbObj);\r\n            if (isDragDone) {\r\n                klColorSlider.pickingDone();\r\n                klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\r\n            }\r\n        },\r\n        onFill: function(canvasX, canvasY) {\r\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n            klCanvas.floodFill(layerIndex, canvasX, canvasY, klColorSlider.getColor(), fillUi.getOpacity(), fillUi.getTolerance(), fillUi.getSample(), fillUi.getGrow(), fillUi.getContiguous());\r\n            klCanvasWorkspace.requestFrame();\r\n        },\r\n        onText: function(canvasX, canvasY, angleRad) {\r\n            if (KL.dialogCounter.get() > 0) {\r\n                return;\r\n            }\r\n\r\n            KL.textToolDialog({\r\n                klCanvas: klCanvas,\r\n                layerIndex: klCanvas.getLayerIndex(currentLayerCtx.canvas),\r\n                x: canvasX,\r\n                y: canvasY,\r\n                angleRad: angleRad,\r\n                color: klColorSlider.getColor(),\r\n                secondaryColor: klColorSlider.getSecondaryRGB(),\r\n                size: textToolSettings.size,\r\n                align: textToolSettings.align,\r\n                isBold: textToolSettings.isBold,\r\n                isItalic: textToolSettings.isItalic,\r\n                font: textToolSettings.font,\r\n                opacity: textToolSettings.opacity,\r\n                onConfirm: function(val) {\r\n\r\n                    let colorRGBA = val.color;\r\n                    colorRGBA.a = val.opacity;\r\n\r\n                    textToolSettings.size = val.size;\r\n                    textToolSettings.align = val.align;\r\n                    textToolSettings.isBold = val.isBold;\r\n                    textToolSettings.isItalic = val.isItalic;\r\n                    textToolSettings.font = val.font;\r\n                    textToolSettings.opacity = val.opacity;\r\n\r\n                    let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                    klCanvas.text(layerIndex, {\r\n                        textStr: val.textStr,\r\n                        x: val.x,\r\n                        y: val.y,\r\n                        size: val.size,\r\n                        font: val.font,\r\n                        align: val.align,\r\n                        isBold: val.isBold,\r\n                        isItalic: val.isItalic,\r\n                        angleRad: angleRad,\r\n                        color: BB.ColorConverter.toRgbaStr(colorRGBA)\r\n                    });\r\n                    klCanvasWorkspace.requestFrame();\r\n                }\r\n            });\r\n\r\n        },\r\n        onShape: function(typeStr, canvasX, canvasY, angleRad) {\r\n            if (typeStr === 'down') {\r\n                shapeTool.onDown(canvasX, canvasY, angleRad);\r\n            }\r\n            if (typeStr === 'move') {\r\n                shapeTool.onMove(canvasX, canvasY);\r\n            }\r\n            if (typeStr === 'up') {\r\n                shapeTool.onUp(canvasX, canvasY);\r\n            }\r\n        },\r\n\r\n        onViewChange: function(viewChangeObj) {\r\n\r\n            if (viewChangeObj.changed.includes('scale')) {\r\n                statusOverlay.out({\r\n                    type: 'transform',\r\n                    scale: viewChangeObj.scale,\r\n                    angleDeg: viewChangeObj.angle * 180 / Math.PI\r\n                });\r\n            }\r\n\r\n            toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== klCanvasWorkspace.getMaxScale());\r\n            toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== klCanvasWorkspace.getMinScale());\r\n\r\n            handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\r\n        },\r\n        onUndo: function() {\r\n            if (klHistory.canUndo()) {\r\n                if (undoRedoCatchup.undo()) {\r\n                    statusOverlay.out(LANG('undo'), true);\r\n                }\r\n            }\r\n        },\r\n        onRedo: function() {\r\n            if (klHistory.canRedo()) {\r\n                if (undoRedoCatchup.redo()) {\r\n                    statusOverlay.out(LANG('redo'), true);\r\n                }\r\n            }\r\n        },\r\n    });\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, event, comboStr) {\r\n            if (KL.dialogCounter.get() > 0) {\r\n                return;\r\n            }\r\n            if (BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n\r\n            let isDrawing = lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\r\n            if (isDrawing) {\r\n                return;\r\n            }\r\n\r\n            if (comboStr === 'plus') {\r\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n            }\r\n            if (comboStr === 'minus') {\r\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n            }\r\n            if (comboStr === 'home') {\r\n                klCanvasWorkspace.fitView();\r\n            }\r\n            if (comboStr === 'end') {\r\n                klCanvasWorkspace.resetView(true);\r\n            }\r\n            if (['ctrl+z', 'cmd+z'].includes(comboStr)) {\r\n                event.preventDefault();\r\n                undoRedoCatchup.undo();\r\n            }\r\n            if (\r\n                ['ctrl+y', 'cmd+y'].includes(comboStr) ||\r\n                (\r\n                    (\r\n                        BB.sameKeys('ctrl+shift+z', comboStr) ||\r\n                        BB.sameKeys('cmd+shift+z', comboStr)\r\n                    ) && keyStr === 'z'\r\n                )\r\n            ) {\r\n                event.preventDefault();\r\n                undoRedoCatchup.redo();\r\n            }\r\n            if (!pOptions.embed) {\r\n                if (['ctrl+s', 'cmd+s'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    saveToComputer.save();\r\n                }\r\n                if (['ctrl+shift+s', 'cmd+shift+s'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n\r\n                    (async () => {\r\n                        let success = true;\r\n                        try {\r\n                            await projectStore.store(klCanvas.getProject());\r\n                        } catch (e) {\r\n                            success = false;\r\n                            setTimeout(() => {\r\n                                throw new Error('keyboard-shortcut: failed to store browser storage, ' + e);\r\n                            }, 0);\r\n                            statusOverlay.out(' ' + LANG('file-storage-failed'), true);\r\n                        }\r\n                        if (success) {\r\n                            pOptions.saveReminder.reset();\r\n                            statusOverlay.out(LANG('file-storage-stored'), true);\r\n                        }\r\n                    })();\r\n                }\r\n                if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    copyToClipboard(true);\r\n                }\r\n            }\r\n            if (['ctrl+a', 'cmd+a'].includes(comboStr)) {\r\n                event.preventDefault();\r\n            }\r\n\r\n\r\n            if (keyListener.comboOnlyContains(['left', 'right', 'up', 'down'])) {\r\n                if (keyStr === 'left') {\r\n                    klCanvasWorkspace.translateView(1, 0);\r\n                }\r\n                if (keyStr === 'right') {\r\n                    klCanvasWorkspace.translateView(-1, 0);\r\n                }\r\n                if (keyStr === 'up') {\r\n                    klCanvasWorkspace.translateView(0, 1);\r\n                }\r\n                if (keyStr === 'down') {\r\n                    klCanvasWorkspace.translateView(0, -1);\r\n                }\r\n            }\r\n\r\n\r\n            if (['r+left','r+right'].includes(comboStr)) {\r\n                if (keyStr === 'left') {\r\n                    klCanvasWorkspace.setAngle(-15, true);\r\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n                }\r\n                if (keyStr === 'right') {\r\n                    klCanvasWorkspace.setAngle(15, true);\r\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n                }\r\n            }\r\n            if (['r+up'].includes(comboStr)) {\r\n                klCanvasWorkspace.setAngle(0);\r\n                handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n            }\r\n\r\n\r\n            if (comboStr === 'sqbr_open') {\r\n                currentBrush.decreaseSize(0.03 / klCanvasWorkspace.getScale());\r\n            }\r\n            if (comboStr === 'sqbr_close') {\r\n                currentBrush.increaseSize(0.03 / klCanvasWorkspace.getScale());\r\n            }\r\n            if (comboStr === 'enter') {\r\n                klCanvas.layerFill(klCanvas.getLayerIndex(currentLayerCtx.canvas), klColorSlider.getColor());\r\n                statusOverlay.out(LANG('filled'), true);\r\n            }\r\n            if (['delete', 'backspace'].includes(comboStr)) {\r\n                let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                if (layerIndex === 0 && !brushUiObj.eraserBrush.getIsTransparentBg()) {\r\n                    klCanvas.layerFill(layerIndex, {r: 255, g: 255, b: 255}, 'source-in');\r\n                } else {\r\n                    klCanvas.clearLayer(layerIndex);\r\n                }\r\n                statusOverlay.out(LANG('cleared-layer'), true);\r\n            }\r\n            if (comboStr === 'e') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('draw');\r\n                toolspaceToolRow.setActive('draw');\r\n                mainTabRow.open('draw');\r\n                updateMainTabVisibility();\r\n                brushTabRow.open('eraserBrush');\r\n            }\r\n            if (comboStr === 'b') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('draw');\r\n                toolspaceToolRow.setActive('draw');\r\n                mainTabRow.open('draw');\r\n                updateMainTabVisibility();\r\n                brushTabRow.open(lastNonEraserBrushId);\r\n            }\r\n            if (comboStr === 'g') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('fill');\r\n                toolspaceToolRow.setActive('fill');\r\n                mainTabRow.open('fill');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 't') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('text');\r\n                toolspaceToolRow.setActive('text');\r\n                mainTabRow.open('text');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 'u') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('shape');\r\n                toolspaceToolRow.setActive('shape');\r\n                mainTabRow.open('shape');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 'x') {\r\n                event.preventDefault();\r\n                klColorSlider.swapColors();\r\n            }\r\n\r\n\r\n        },\r\n        onUp: function(keyStr, event) {\r\n        }\r\n    });\r\n\r\n    /**\r\n     *\r\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\r\n     * @param filename - string e.g. 'drawing.psd'\r\n     * @param optionStr? - 'default' | 'layer' | 'image'\r\n     */\r\n    function importFinishedLoading(\r\n        importedImage: IKlPsd | {\r\n            type: 'image';\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLCanvasElement | HTMLImageElement;\r\n        },\r\n        filename: string,\r\n        optionStr: 'default' | 'layer' | 'image',\r\n    ) {\r\n        if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                type: \"error\",\r\n                message: LANG('import-broken-file'),\r\n                buttons: [\"Ok\"],\r\n            });\r\n            return;\r\n        }\r\n\r\n        function getResizedDimensions(width, height) {\r\n            let w = parseInt(width);\r\n            let h = parseInt(height);\r\n            if (w > klMaxCanvasSize) {\r\n                h = klMaxCanvasSize / w * h;\r\n                w = klMaxCanvasSize;\r\n            }\r\n            if (h > klMaxCanvasSize) {\r\n                w = klMaxCanvasSize / h * w;\r\n                h = klMaxCanvasSize;\r\n            }\r\n            w = parseInt('' + w);\r\n            h = parseInt('' + h);\r\n            return {\r\n                width: w,\r\n                height: h\r\n            }\r\n        }\r\n\r\n        function importAsImage(canvas) {\r\n            let resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\r\n\r\n            //resize first\r\n            let tempCanvas = BB.canvas(canvas.width, canvas.height);\r\n            let tempCanvasCtx = tempCanvas.getContext('2d');\r\n            tempCanvasCtx.drawImage(canvas, 0, 0);\r\n\r\n            BB.resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\r\n\r\n            klCanvas.reset({\r\n                width: resizedDimensions.width,\r\n                height: resizedDimensions.height,\r\n                image: tempCanvas,\r\n                layerName: filename\r\n            });\r\n\r\n            layerManager.update(0);\r\n            setCurrentLayer(klCanvas.getLayer(0));\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n            isFirstImage = false;\r\n        }\r\n\r\n        /**\r\n         *\r\n         * @param convertedPsdObj - if flattened then without layers\r\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\r\n         */\r\n        function importAsImagePsd(convertedPsdObj: IKlPsd, cropObj?) {\r\n\r\n            // crop\r\n            function crop(targetCanvas, cropCanvas, cropObj) {\r\n                cropCanvas.width = cropCanvas.width;\r\n                cropCanvas.getContext('2d').drawImage(targetCanvas, -cropObj.x, -cropObj.y);\r\n                targetCanvas.width = cropObj.width;\r\n                targetCanvas.height = cropObj.height;\r\n                targetCanvas.getContext('2d').drawImage(cropCanvas, 0, 0);\r\n            }\r\n            if (cropObj && (cropObj.width !== convertedPsdObj.width ||cropObj.height !== convertedPsdObj.height)) {\r\n                let cropCanvas = BB.canvas(cropObj.width, cropObj.height);\r\n                convertedPsdObj.width = cropObj.width;\r\n                convertedPsdObj.height = cropObj.height;\r\n\r\n                if (!convertedPsdObj.layers) {\r\n                    crop(convertedPsdObj.canvas, cropCanvas, cropObj);\r\n                }\r\n                if (convertedPsdObj.layers) {\r\n                    for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                        let item = convertedPsdObj.layers[i];\r\n                        crop(item.image, cropCanvas, cropObj);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // resize\r\n            let resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\r\n            convertedPsdObj.width = resizedDimensions.width;\r\n            convertedPsdObj.height = resizedDimensions.height;\r\n            if (!convertedPsdObj.layers) {\r\n                BB.resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\r\n            }\r\n            if (convertedPsdObj.layers) {\r\n                for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                    let item = convertedPsdObj.layers[i];\r\n                    BB.resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\r\n                }\r\n            }\r\n\r\n            let layerIndex;\r\n            if (convertedPsdObj.layers) {\r\n                layerIndex = klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    layers: convertedPsdObj.layers\r\n                });\r\n            } else {\r\n                layerIndex = klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    image: convertedPsdObj.canvas\r\n                });\r\n            }\r\n            layerManager.update(layerIndex);\r\n            setCurrentLayer(klCanvas.getLayer(layerIndex));\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n            isFirstImage = false;\r\n        }\r\n\r\n        function importAsLayer(canvas) {\r\n            KL.showImportAsLayerDialog({\r\n                target: klRootEl,\r\n                klCanvas: klCanvas,\r\n                importImage: canvas,\r\n                callback: function(transformObj, isPixelated: boolean) {\r\n                    if (!transformObj) {\r\n                        return;\r\n                    }\r\n\r\n                    klHistory.pause(true);\r\n                    klCanvas.addLayer();\r\n                    let layers = klCanvas.getLayers();\r\n                    let activeLayerIndex = layers.length - 1;\r\n                    if (filename) {\r\n                        klCanvas.renameLayer(activeLayerIndex, filename);\r\n                    }\r\n                    let activeLayerContext = klCanvas.getLayerContext(activeLayerIndex);\r\n                    BB.drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, null, isPixelated);\r\n                    setCurrentLayer(klCanvas.getLayer(activeLayerIndex));\r\n                    layerManager.update(activeLayerIndex);\r\n\r\n                    klHistory.pause(false);\r\n\r\n                    klHistory.push({\r\n                        tool: [\"misc\"],\r\n                        action: \"importImage\",\r\n                        params: [BB.copyCanvas(activeLayerContext.canvas), filename]\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n\r\n        if (optionStr === 'default' || !optionStr) {\r\n            KL.showImportImageDialog({\r\n                image: importedImage,\r\n                target: klRootEl,\r\n                maxSize: klMaxCanvasSize,\r\n                callback: function(res) {\r\n                    if (res.type === 'as-image') {\r\n                        importAsImage(res.image);\r\n                    } else if (res.type === 'as-image-psd') {\r\n                        importAsImagePsd(res.image, res.cropObj);\r\n                    } else if (res.type === 'as-layer') {\r\n                        importAsLayer(res.image);\r\n                    } else if (res.type === 'cancel') {\r\n                        // nothing to do\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        if (optionStr === 'layer') {\r\n            importAsLayer(importedImage.canvas);\r\n        }\r\n        if (optionStr === 'image') {\r\n            if (importedImage.type === 'psd') {\r\n                importAsImagePsd(importedImage);\r\n            } else {\r\n                importAsImage(importedImage.canvas);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    function onPaste(e) {\r\n        if (KL.dialogCounter.get() > 0) {\r\n            return;\r\n        }\r\n\r\n        function retrieveImageFromClipboardAsBlob(pasteEvent, callback) {\r\n            if (pasteEvent.clipboardData == false) {\r\n                if (typeof (callback) == \"function\") {\r\n                    callback(undefined);\r\n                }\r\n            }\r\n\r\n            let items = pasteEvent.clipboardData.items;\r\n\r\n            if (items == undefined) {\r\n                if (typeof (callback) == \"function\") {\r\n                    callback(undefined);\r\n                }\r\n            } else {\r\n                for (let i = 0; i < items.length; i++) {\r\n                    if (items[i].type.indexOf(\"image\") == -1) {\r\n                        continue;\r\n                    }\r\n                    let blob = items[i].getAsFile();\r\n\r\n                    if (typeof (callback) == \"function\") {\r\n                        callback(blob);\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (e.clipboardData.files[0]) {\r\n            retrieveImageFromClipboardAsBlob(e, function (imageBlob) {\r\n                // If there's an image, display it in the canvas\r\n                if (imageBlob) {\r\n                    let img = new Image();\r\n                    img.onload = function () {\r\n                        URL.revokeObjectURL(img.src);\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img\r\n                        }, null, 'default');\r\n                    };\r\n                    let URLObj = window.URL || window.webkitURL;\r\n                    img.src = URLObj.createObjectURL(imageBlob);\r\n                }\r\n            });\r\n        } else if (e.clipboardData.items[0]) {\r\n            e.clipboardData.items[0].getAsString(function(pasteStr) {\r\n                pasteStr = pasteStr.trim();\r\n                if (pasteStr.match(/^https?/)) {\r\n                    // url\r\n                    let img = new Image();\r\n                    img.onload = function () {\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img\r\n                        }, null, 'default');\r\n                    };\r\n                    img.onerror = function (e) {\r\n                        console.log('error loading', e);\r\n                    };\r\n                    img.crossOrigin = 'Anonymous';\r\n                    img.src = pasteStr;\r\n\r\n                } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\r\n                    // url\r\n                    let rgbObj = BB.ColorConverter.hexToRGB(pasteStr.replace('#', ''));\r\n                    brushSettingService.setColor(rgbObj);\r\n                }\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    function handleFileSelect(files, optionStr) {\r\n\r\n        function showWarningPsdFlattened() {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                type: \"warning\",\r\n                message: LANG('import-psd-unsupported') + \"<br /><br />\",\r\n                buttons: [\"Ok\"],\r\n            });\r\n        }\r\n\r\n        let hasUnsupportedFile = false;\r\n        for (let i = 0, file; file = files[i]; i++) {\r\n            let extension = file.name.split(\".\");\r\n            extension = extension[extension.length - 1].toLowerCase();\r\n            if (extension === \"psd\") {\r\n\r\n                (function(f) {\r\n                    let loaderSizeBytes = 1024 * 1024 * 25; // 25mb\r\n                    let maxSizeBytes = 1024 * 1024 * 1024; // 1gb\r\n                    let maxResolution = 4096;\r\n\r\n                    if (f.size >= maxSizeBytes) { // pretty likely to break stuff\r\n                        KL.popup({\r\n                            target: klRootEl,\r\n                            type: \"error\",\r\n                            message: \"File too big. Unable to import.<br /><br />\",\r\n                            buttons: [\"Ok\"],\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    let doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\r\n                    let loaderIsOpen = true;\r\n                    let closeLoader;\r\n\r\n                    if (doShowLoader) {\r\n                        KL.popup({\r\n                            target: klRootEl,\r\n                            message: LANG('import-opening'),\r\n                            callback: function (result) {\r\n                                loaderIsOpen = false;\r\n                                closeLoader = null;\r\n                            },\r\n                            closefunc: function (f) {\r\n                                closeLoader = f;\r\n                            }\r\n                        });\r\n                    }\r\n\r\n\r\n                    let reader = new FileReader();\r\n                    reader.onload = function (readerResult) {\r\n\r\n                        KL.loadAgPsd().then(function(agPsdLazy) {\r\n\r\n                            if (doShowLoader && !loaderIsOpen) {\r\n                                return;\r\n                            }\r\n\r\n                            try {\r\n                                let psd;\r\n\r\n                                // first pass, only read metadata\r\n                                psd = agPsdLazy.readPsd(\r\n                                    (readerResult.target.result as any),\r\n                                    {\r\n                                        skipLayerImageData: true,\r\n                                        skipThumbnail: true,\r\n                                        skipCompositeImageData: true\r\n                                    });\r\n                                if (psd.width > maxResolution || psd.height > maxResolution) {\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    KL.popup({\r\n                                        target: klRootEl,\r\n                                        type: \"error\",\r\n                                        //message: \"Image exceeds maximum dimensions of \" + maxResolution + \" x \" + maxResolution + \" pixels. Unable to import.\"\r\n                                        message: LANG('import-psd-too-large').replace(/{x}/g, '' + maxResolution)\r\n                                            + \"<br /><br />\"\r\n                                            + LANG('import-psd-size') + \": \" + psd.width + \" x \" + psd.height + ' pixels'\r\n                                            + \"<br /><br />\"\r\n                                        ,\r\n                                        buttons: [\"Ok\"],\r\n                                    });\r\n                                    return;\r\n                                }\r\n\r\n\r\n                                // second pass, now load actual data.\r\n                                psd = null;\r\n\r\n                                try {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any));\r\n                                } catch (e) {\r\n                                    //console.log('failed regular psd import', e);\r\n                                }\r\n                                if (psd) {\r\n                                    //console.log('psd', psd);\r\n                                    let convertedPsd = KL.PSD.readPsd(psd);\r\n                                    //console.log('converted', convertedPsd);\r\n                                    if (optionStr === 'image' && convertedPsd.error) {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    importFinishedLoading(convertedPsd, f.name, optionStr);\r\n                                } else {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any), { skipLayerImageData: true, skipThumbnail: true });\r\n                                    if (optionStr === 'image') {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    importFinishedLoading({\r\n                                        type: 'psd',\r\n                                        width: psd.width,\r\n                                        height: psd.height,\r\n                                        canvas: psd.canvas,\r\n                                        error: true\r\n                                    }, f.name, optionStr);\r\n                                }\r\n\r\n\r\n                            } catch (e) {\r\n                                if (closeLoader) {\r\n                                    closeLoader();\r\n                                }\r\n                                KL.popup({\r\n                                    target: klRootEl,\r\n                                    type: \"error\",\r\n                                    message: \"Failed to load PSD.<br /><br />\",\r\n                                    buttons: [\"Ok\"],\r\n                                });\r\n                            }\r\n                        }).catch(() => {\r\n                            closeLoader();\r\n                            alert('Error: failed to load PSD library');\r\n                        });\r\n\r\n                    };\r\n                    reader.readAsArrayBuffer(f);\r\n                })(file);\r\n\r\n            } else if (file.type.match('image.*')) {\r\n                (function (f) {\r\n                    window.URL = window.URL || window.webkitURL;\r\n                    let url = window.URL.createObjectURL(f);\r\n                    let im = new Image();\r\n                    im.src = url;\r\n                    BB.loadImage(im, function () {\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: im.width,\r\n                            height: im.height,\r\n                            canvas: im\r\n                        }, f.name, optionStr);\r\n                    });\r\n                })(file);\r\n            } else {\r\n                hasUnsupportedFile = true;\r\n            }\r\n        }\r\n        if (hasUnsupportedFile) {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                message: LANG('import-unsupported-file'),\r\n                type: 'error',\r\n                buttons: ['OK'],\r\n            });\r\n        }\r\n    }\r\n\r\n    if (!pOptions.embed) {\r\n        new KL.KlImageDropper({\r\n            target: document.body,\r\n            onDrop: function(files, optionStr) {\r\n                if (KL.dialogCounter.get() > 0) {\r\n                    return;\r\n                }\r\n                handleFileSelect(files, optionStr);\r\n            },\r\n            enabledTest: function() {\r\n                return KL.dialogCounter.get() === 0;\r\n            }\r\n        });\r\n\r\n        BB.addEventListener(window, 'paste', onPaste, false);\r\n    }\r\n\r\n    const brushUiObj: any = {};\r\n\r\n    // create brush UIs\r\n    for (let b in KL.brushesUI) {\r\n        if (KL.brushesUI.hasOwnProperty(b)) {\r\n            let ui = new KL.brushesUI[b].Ui({\r\n                onSizeChange: sizeWatcher,\r\n                onOpacityChange: function(opacity) {\r\n                    brushSettingService.emitOpacity(opacity);\r\n                },\r\n                onConfigChange: () => {\r\n                    brushSettingService.emitSliderConfig({\r\n                        sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                        opacitySlider: KL.brushesUI[currentBrushId].opacitySlider\r\n                    });\r\n                }\r\n            });\r\n            brushUiObj[b] = ui;\r\n            ui.getElement().style.padding = 10 + 'px';\r\n        }\r\n    }\r\n\r\n\r\n    BB.css(klRootEl, {\r\n        position: 'absolute',\r\n        left: '0',\r\n        top: '0',\r\n        right: '0',\r\n        bottom: '0'\r\n    });\r\n\r\n    let statusOverlay = new KL.StatusOverlay();\r\n\r\n    const toolspace = BB.el({});\r\n    const toolspaceInner = BB.el({\r\n        parent: toolspace,\r\n    });\r\n    toolspace.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n    toolspace.onclick = BB.handleClick;\r\n\r\n\r\n    let toolspaceCollapser = new KL.ToolspaceCollapser({\r\n        onChange: function() {\r\n            updateCollapse();\r\n        }\r\n    });\r\n    function updateCollapse() {\r\n\r\n        //collapser\r\n        if (uiWidth < collapseThreshold) {\r\n            toolspaceCollapser.getElement().style.display = 'block';\r\n\r\n            toolspaceCollapser.setDirection(uiState);\r\n            if (toolspaceCollapser.isOpen()) {\r\n                if (uiState === 'left') {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '271px',\r\n                        right: '',\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '271px'\r\n                    });\r\n                } else {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '271px'\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                }\r\n                toolspace.style.display = 'block';\r\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\r\n                statusOverlay.setWide(false);\r\n\r\n            } else {\r\n                if (uiState === 'left') {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '0',\r\n                        right: '',\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                } else {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '0'\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                }\r\n                toolspace.style.display = 'none';\r\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth), uiHeight);\r\n                statusOverlay.setWide(true);\r\n\r\n            }\r\n\r\n        } else {\r\n            toolspaceCollapser.getElement().style.display = 'none';\r\n            if (uiState === 'left') {\r\n                BB.css(klCanvasWorkspace.getElement(), {\r\n                    left: '271px'\r\n                });\r\n            } else {\r\n                BB.css(klCanvasWorkspace.getElement(), {\r\n                    left: '0'\r\n                });\r\n            }\r\n            toolspace.style.display = 'block';\r\n            klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\r\n            statusOverlay.setWide(false);\r\n\r\n        }\r\n    }\r\n    updateCollapse();\r\n\r\n    function updateUi() {\r\n        if (uiState === 'left') {\r\n            BB.css(toolspace, {\r\n                left: '0',\r\n                right: '',\r\n                borderLeft: 'none',\r\n                borderRight: '1px solid rgb(135, 135, 135)'\r\n            });\r\n            BB.css(klCanvasWorkspace.getElement(), {\r\n                left: '271px'\r\n            });\r\n        } else {\r\n            BB.css(toolspace, {\r\n                left: '',\r\n                right: '0',\r\n                borderLeft: '1px solid rgb(135, 135, 135)',\r\n                borderRight: 'none'\r\n            });\r\n            BB.css(klCanvasWorkspace.getElement(), {\r\n                left: '0'\r\n            });\r\n        }\r\n        statusOverlay.setUiState(uiState);\r\n        layerPreview.setUiState('' + uiState);\r\n        layerManager.setUiState('' + uiState);\r\n        updateCollapse();\r\n        toolspaceScroller.updateUiState(uiState);\r\n    }\r\n\r\n\r\n\r\n    let overlayToolspace;\r\n    setTimeout(function() {\r\n        overlayToolspace = new KL.OverlayToolspace({\r\n            enabledTest: function() {\r\n                return KL.dialogCounter.get() === 0 && !lineSanitizer.getIsDrawing();\r\n            },\r\n            brushSettingService,\r\n        });\r\n        klRootEl.appendChild(overlayToolspace.getElement());\r\n    }, 0);\r\n\r\n    BB.append(klRootEl, [klCanvasWorkspace.getElement(), toolspace, toolspaceCollapser.getElement()]);\r\n\r\n    BB.css(toolspace, {\r\n        position: \"absolute\",\r\n        right: '0',\r\n        top: '0',\r\n        bottom: '0',\r\n        width: (toolWidth - 1) + \"px\",\r\n\r\n        overflow: \"hidden\",\r\n        backgroundColor: \"#ddd\",\r\n        borderLeft: \"1px solid rgb(135, 135, 135)\",\r\n        userSelect: 'none',\r\n        touchAction: 'none'\r\n    });\r\n\r\n    let toolspaceTopRow;\r\n    if (pOptions.embed) {\r\n        toolspaceTopRow = new ToolspaceTopRow({\r\n            onHelp: () => {\r\n                showIframePopup(pOptions.embed.url + '/help.html', !!pOptions.embed);\r\n            },\r\n            onSubmit: () => {\r\n                KL.popup({\r\n                    target: klRootEl,\r\n                    message: LANG('submit-prompt'),\r\n                    buttons: [LANG('submit'), 'Cancel'],\r\n                    callback: async (result) => {\r\n                        if (result !== LANG('submit')) {\r\n                            return;\r\n                        }\r\n\r\n                        let overlay = BB.el({\r\n                            parent: klRootEl,\r\n                            className: 'upload-overlay',\r\n                            content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\r\n                        });\r\n\r\n                        pOptions.embed.onSubmit(\r\n                            () => {\r\n                                pOptions.saveReminder.reset();\r\n                                klRootEl.removeChild(overlay);\r\n                            },\r\n                            () => {\r\n                                klRootEl.removeChild(overlay);\r\n                            });\r\n                    }\r\n                });\r\n            },\r\n            onLeftRight: () => {\r\n                uiState = uiState === 'left' ? 'right' : 'left';\r\n                updateUi();\r\n            },\r\n        });\r\n    } else {\r\n        toolspaceTopRow = new KL.ToolspaceTopRow({\r\n            logoImg: pOptions.logoImg,\r\n            onLogo: function() {\r\n                showIframePopup('./home/', !!pOptions.embed);\r\n            },\r\n            onNew: function() {\r\n                showNewImageDialog();\r\n            },\r\n            onImport: function() {\r\n                fileTab.triggerImport();\r\n            },\r\n            onSave: function() {\r\n                saveToComputer.save();\r\n            },\r\n            onShare: function() {\r\n                shareImage();\r\n            },\r\n            onHelp: function() {\r\n                showIframePopup('./help/', !!pOptions.embed);\r\n            },\r\n        });\r\n    }\r\n    toolspaceTopRow.getElement().classList.add('toolspace-row-shadow');\r\n    toolspaceTopRow.getElement().style.marginBottom = '10px';\r\n    toolspaceInner.appendChild(toolspaceTopRow.getElement());\r\n\r\n    let toolspaceToolRow = new KL.ToolspaceToolRow({\r\n        onActivate: function(activeStr) {\r\n            if (activeStr === 'draw') {\r\n                klCanvasWorkspace.setMode('draw');\r\n            } else if (activeStr === 'hand') {\r\n                klCanvasWorkspace.setMode('hand');\r\n            } else if (activeStr === 'fill') {\r\n                klCanvasWorkspace.setMode('fill');\r\n            } else if (activeStr === 'text') {\r\n                klCanvasWorkspace.setMode('text');\r\n            } else if (activeStr === 'shape') {\r\n                klCanvasWorkspace.setMode('shape');\r\n            } else {\r\n                throw new Error('unknown activeStr');\r\n            }\r\n            mainTabRow.open(activeStr);\r\n            updateMainTabVisibility();\r\n            klColorSlider.pickingDone();\r\n        },\r\n        onZoomIn: function() {\r\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n        },\r\n        onZoomOut: function() {\r\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n        },\r\n        onUndo: function() {\r\n            undoRedoCatchup.undo();\r\n        },\r\n        onRedo: function() {\r\n            undoRedoCatchup.redo();\r\n        }\r\n    });\r\n    toolspaceToolRow.setIsSmall(uiHeight < 540);\r\n    klHistory.addListener(function() {\r\n        toolspaceToolRow.setEnableUndo(klHistory.canUndo());\r\n        toolspaceToolRow.setEnableRedo(klHistory.canRedo());\r\n    });\r\n    toolspaceToolRow.getElement().classList.add('toolspace-row-shadow');\r\n    toolspaceInner.appendChild(toolspaceToolRow.getElement());\r\n\r\n    let klColorSlider;\r\n\r\n    function setCurrentBrush(brushId) {\r\n        if (brushId !== 'eraserBrush') {\r\n            lastNonEraserBrushId = brushId;\r\n        }\r\n\r\n        if (klColorSlider) {\r\n            if (brushId === 'eraserBrush') {\r\n                klColorSlider.enable(false);\r\n            } else {\r\n                klColorSlider.enable(true);\r\n            }\r\n        }\r\n\r\n        currentBrushId = brushId;\r\n        currentBrush = brushUiObj[brushId];\r\n        currentBrush.setColor(currentColor);\r\n        currentBrush.setContext(currentLayerCtx);\r\n        klCanvasWorkspace.setMode('draw');\r\n        toolspaceToolRow.setActive('draw');\r\n        updateMainTabVisibility();\r\n    }\r\n\r\n    function setCurrentLayer(layer) { //BrushContext(p_context) {\r\n        currentLayerCtx = layer.context;\r\n        currentBrush.setContext(layer.context);\r\n        layerPreview.setLayer(layer);\r\n    }\r\n\r\n    function setBrushColor(p_color) {\r\n        currentColor = p_color;\r\n        currentBrush.setColor(p_color);\r\n        brushSettingService.emitColor(p_color);\r\n        klColorSlider.pickingDone();\r\n    }\r\n\r\n    klColorSlider = new KL.KlColorSlider({\r\n        width: 250,\r\n        height: 30,\r\n        svHeight: 100,\r\n        startValue: new BB.RGB(0, 0, 0),\r\n        onPick: setBrushColor\r\n    });\r\n    klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\r\n    klColorSlider.setPickCallback(function (doPick) {\r\n\r\n        if (doPick) {\r\n            klCanvasWorkspace.setMode('pick');\r\n        } else {\r\n            klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\r\n            updateMainTabVisibility();\r\n        }\r\n\r\n    });\r\n    let brushDiv = document.createElement(\"div\");\r\n    let colorDiv = document.createElement(\"div\");\r\n    BB.css(colorDiv, {\r\n        margin: '10px',\r\n        display: 'flex',\r\n        flexWrap: 'wrap',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'flex-end'\r\n    });\r\n    let toolspaceStabilizerRow = new KL.ToolspaceStabilizerRow({\r\n        smoothing: 1,\r\n        onSelect: function(v) {\r\n            lineSmoothing.setSmoothing(translateSmoothing(v));\r\n        }\r\n    });\r\n\r\n\r\n    brushDiv.appendChild(colorDiv);\r\n    BB.append(\r\n        colorDiv,\r\n        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n    );\r\n\r\n    let brushTabRow = new KL.TabRow({\r\n        initialId: 'penBrush',\r\n        useAccent: true,\r\n        tabArr: (function () {\r\n            let result = [];\r\n\r\n            function createTab(keyStr) {\r\n                return {\r\n                    id: keyStr,\r\n                    image: KL.brushesUI[keyStr].image,\r\n                    title: KL.brushesUI[keyStr].tooltip,\r\n                    onOpen: function() {\r\n                        brushUiObj[keyStr].getElement().style.display = 'block';\r\n                        setCurrentBrush(keyStr);\r\n                        klColorSlider.pickingDone();\r\n                        brushSettingService.emitSliderConfig({\r\n                            sizeSlider: KL.brushesUI[keyStr].sizeSlider,\r\n                            opacitySlider: KL.brushesUI[keyStr].opacitySlider\r\n                        });\r\n                        sizeWatcher(brushUiObj[keyStr].getSize());\r\n                        brushSettingService.emitOpacity(brushUiObj[keyStr].getOpacity());\r\n                    },\r\n                    onClose: function() {\r\n                        brushUiObj[keyStr].getElement().style.display = 'none';\r\n                    }\r\n                };\r\n            }\r\n\r\n            let keyArr = Object.keys(brushUiObj);\r\n            for (let i = 0; i < keyArr.length; i++) {\r\n                result.push(createTab(keyArr[i]));\r\n            }\r\n            return result;\r\n        })()\r\n    });\r\n    brushDiv.appendChild(brushTabRow.getElement());\r\n    for (let b in KL.brushesUI) {\r\n        if (KL.brushesUI.hasOwnProperty(b)) {\r\n            brushDiv.appendChild(brushUiObj[b].getElement());\r\n        }\r\n    }\r\n\r\n    const handUi = new KL.HandUi({\r\n        scale: 1,\r\n        angleDeg: 0,\r\n        onReset: function() {\r\n            klCanvasWorkspace.resetView(true);\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n        onFit: function() {\r\n            klCanvasWorkspace.fitView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n        onAngleChange: function(angleDeg, isRelative) {\r\n            klCanvasWorkspace.setAngle(angleDeg, isRelative);\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n    });\r\n\r\n    let fillUi = new KL.FillUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let textUi = new KL.TextUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let shapeUi = new KL.ShapeUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let shapeTool = new KL.ShapeTool({\r\n        onShape: function(isDone, x1, y1, x2, y2, angleRad) {\r\n\r\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n\r\n            let shapeObj: any = {\r\n                type: shapeUi.getShape(),\r\n                x1: x1,\r\n                y1: y1,\r\n                x2: x2,\r\n                y2: y2,\r\n                angleRad: angleRad,\r\n                isOutwards: shapeUi.getIsOutwards(),\r\n                opacity: shapeUi.getOpacity(),\r\n                isEraser: shapeUi.getIsEraser()\r\n            };\r\n            if (shapeUi.getShape() === 'line') {\r\n                shapeObj.strokeRgb = klColorSlider.getColor();\r\n                shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed('shift');\r\n            } else {\r\n                shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed('shift');\r\n                if (shapeUi.getMode() === 'stroke') {\r\n                    shapeObj.strokeRgb = klColorSlider.getColor();\r\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                } else {\r\n                    shapeObj.fillRgb = klColorSlider.getColor();\r\n                }\r\n            }\r\n\r\n            if (isDone) {\r\n                klCanvas.setComposite(layerIndex, null);\r\n                klCanvas.drawShape(layerIndex, shapeObj);\r\n            } else {\r\n                klCanvas.setComposite(layerIndex, {\r\n                    draw: function(ctx) {\r\n                        KL.drawShape(ctx, shapeObj);\r\n                    }\r\n                });\r\n            }\r\n            klCanvasWorkspace.requestFrame();\r\n\r\n        }\r\n    });\r\n\r\n    const layerManager = KL.klLayerManager(klCanvas, function (val) {\r\n        setCurrentLayer(klCanvas.getLayer(val));\r\n        klHistory.push({\r\n            tool: [\"misc\"],\r\n            action: \"focusLayer\",\r\n            params: [val]\r\n        });\r\n    }, klRootEl) as any;\r\n    const layerPreview = new KL.LayerPreview({\r\n        klRootEl: klRootEl,\r\n        onClick: function () {\r\n            mainTabRow.open('layers');\r\n        }\r\n    });\r\n    layerPreview.setIsVisible(uiHeight >= 579);\r\n    layerPreview.setLayer(klCanvas.getLayer(klCanvas.getLayerIndex(currentLayerCtx.canvas)));\r\n\r\n    const filterTab = new KL.FilterTab(\r\n        klRootEl,\r\n        klColorSlider,\r\n        layerManager,\r\n        setCurrentLayer,\r\n        klCanvasWorkspace,\r\n        handUi,\r\n        () => { //get current color\r\n            return currentColor;\r\n        },\r\n        () => { // get max canvas size\r\n            return klMaxCanvasSize;\r\n        },\r\n        () => { // get kl canvas\r\n            return klCanvas;\r\n        },\r\n        () => { // get current layer ctx\r\n            return currentLayerCtx;\r\n        },\r\n        !!pOptions.embed,\r\n        statusOverlay,\r\n    );\r\n\r\n    const undoRedoCatchup = new KL.UndoRedoCatchup(\r\n        brushUiObj,\r\n        layerPreview,\r\n        layerManager,\r\n        handUi,\r\n        klCanvasWorkspace,\r\n        () => {\r\n            if (!initState) {\r\n                throw new Error('initState not initialized');\r\n            }\r\n            return initState;\r\n        },\r\n        () => klCanvas,\r\n        () => currentLayerCtx,\r\n        (clctx) => {\r\n            currentLayerCtx = clctx;\r\n        },\r\n        () => currentBrush,\r\n    );\r\n    klHistory.addListener((p) => {\r\n        undoRedoCatchup.catchup(p);\r\n    });\r\n\r\n    function showNewImageDialog() {\r\n        KL.newImageDialog({\r\n            currentColor: currentColor,\r\n            secondaryColor: klColorSlider.getSecondaryRGB(),\r\n            maxCanvasSize: klMaxCanvasSize,\r\n            canvasWidth: klCanvas.getWidth(),\r\n            canvasHeight: klCanvas.getHeight(),\r\n            workspaceWidth: window.innerWidth < collapseThreshold ? uiWidth : uiWidth - toolWidth,\r\n            workspaceHeight: uiHeight,\r\n            onConfirm: function(width, height, color) {\r\n                klCanvas.reset({\r\n                    width: width,\r\n                    height: height,\r\n                    color: color.a === 1 ? color : null\r\n                });\r\n\r\n                layerManager.update(0);\r\n                setCurrentLayer(klCanvas.getLayer(0));\r\n                klCanvasWorkspace.resetView();\r\n                handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n                isFirstImage = false;\r\n            },\r\n            onCancel: function() {}\r\n        });\r\n    }\r\n\r\n    function shareImage(callback?) {\r\n        BB.shareCanvas({\r\n            canvas: klCanvas.getCompleteCanvas(1),\r\n            fileName: BB.getDate() + filenameBase + '.png',\r\n            title: BB.getDate() + filenameBase + '.png',\r\n            callback: callback ? callback : function() {}\r\n        });\r\n    }\r\n\r\n    const saveToComputer = new KL.SaveToComputer(\r\n        pOptions.saveReminder,\r\n        klRootEl,\r\n        () => exportType,\r\n        () => klCanvas,\r\n        filenameBase,\r\n    );\r\n\r\n    const fileTab = pOptions.embed ? null : new KL.FileTab(\r\n        klRootEl,\r\n        projectStore,\r\n        () => klCanvas.getProject(),\r\n        exportType,\r\n        (type) => {\r\n            exportType = type;\r\n        },\r\n        handleFileSelect,\r\n        () => {\r\n            saveToComputer.save();\r\n        },\r\n        showNewImageDialog,\r\n        shareImage,\r\n        () => { // on upload\r\n            KL.imgurUpload(klCanvas, klRootEl, pOptions.saveReminder, pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : null, );\r\n        },\r\n        copyToClipboard,\r\n        pOptions.saveReminder,\r\n    );\r\n\r\n    const settingsTab = new KL.SettingsTab(\r\n        () => {\r\n            uiState = uiState === 'left' ? 'right' : 'left';\r\n            updateUi();\r\n            if (!pOptions.embed) {\r\n                LocalStorage.setItem('uiState', uiState);\r\n            }\r\n        },\r\n        pOptions.aboutEl\r\n    );\r\n\r\n    mainTabRow = new KL.TabRow({\r\n        initialId: 'draw',\r\n        tabArr: [\r\n            {\r\n                id: 'draw',\r\n                title: LANG('tool-brush'),\r\n                image: toolPaintImg,\r\n                onOpen: function() {\r\n                    if (currentBrushId === 'eraserBrush') {\r\n                        klColorSlider.enable(false);\r\n                    }\r\n                    BB.append(\r\n                        colorDiv,\r\n                        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n                    );\r\n                    brushDiv.style.display = 'block';\r\n                },\r\n                onClose: function() {\r\n                    brushDiv.style.display = 'none';\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'hand',\r\n                title: LANG('tool-hand'),\r\n                image: toolHandImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    handUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    handUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'fill',\r\n                title: LANG('tool-paint-bucket'),\r\n                image: toolFillImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    fillUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    fillUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'text',\r\n                title: LANG('tool-text'),\r\n                image: toolTextImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    textUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    textUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'shape',\r\n                title: LANG('tool-shape'),\r\n                image: toolShapeImg,\r\n                isVisible: false,\r\n                onOpen: function() {\r\n                    klColorSlider.enable(true);\r\n                    shapeUi.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    shapeUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'layers',\r\n                title: LANG('tab-layers'),\r\n                image: tabLayersImg,\r\n                onOpen: function() {\r\n                    layerManager.update();\r\n                    layerManager.style.display = 'block';\r\n                },\r\n                onClose: function() {\r\n                    layerManager.style.display = 'none';\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'edit',\r\n                label: LANG('tab-edit'),\r\n                onOpen: function() {\r\n                    filterTab.show();\r\n                },\r\n                onClose: function() {\r\n                    filterTab.hide();\r\n                },\r\n                css: {\r\n                    padding: '0 7px',\r\n                },\r\n            },\r\n            {\r\n                id: 'file',\r\n                label: LANG('tab-file'),\r\n                isVisible: !!fileTab,\r\n                onOpen: function() {\r\n                    if (!fileTab) {\r\n                        return;\r\n                    }\r\n                    fileTab.getElement().style.display = 'block';\r\n                    fileTab.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    if (!fileTab) {\r\n                        return;\r\n                    }\r\n                    fileTab.getElement().style.display = 'none';\r\n                    fileTab.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    padding: '0 7px',\r\n                },\r\n            },\r\n            {\r\n                id: 'settings',\r\n                title: LANG('tab-settings'),\r\n                image: tabSettingsImg,\r\n                onOpen: function() {\r\n                    settingsTab.getElement().style.display = 'block';\r\n                    // settingsTab.setIsVisible(true);\r\n                },\r\n                onClose: function() {\r\n                    settingsTab.getElement().style.display = 'none';\r\n                    // settingsTab.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            }\r\n        ]\r\n    });\r\n    function updateMainTabVisibility() {\r\n        if (!mainTabRow) {\r\n            return;\r\n        }\r\n\r\n        let toolObj = {\r\n            'draw': {},\r\n            'hand': {},\r\n            'fill': {},\r\n            'text': {},\r\n            'shape': {}\r\n        };\r\n\r\n        let activeStr = toolspaceToolRow.getActive();\r\n        let oldTabId = mainTabRow.getOpenedTabId();\r\n\r\n        let keysArr = Object.keys(toolObj);\r\n        for (let i = 0; i < keysArr.length; i++) {\r\n            if (activeStr === keysArr[i]) {\r\n                mainTabRow.setIsVisible(keysArr[i], true);\r\n            } else {\r\n                mainTabRow.setIsVisible(keysArr[i], false);\r\n                if (oldTabId === keysArr[i]) {\r\n                    mainTabRow.open(activeStr);\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    function copyToClipboard(showCrop?) {\r\n        KL.clipboardDialog(klRootEl, klCanvas.getCompleteCanvas(1), function (inputObj) {\r\n            if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) {\r\n                return;\r\n            }\r\n            //do a crop\r\n            let p = {\r\n                context: currentLayerCtx,\r\n                canvas: klCanvas,\r\n                input: inputObj, //{left,right,top,bottom}\r\n                history: klHistory\r\n            };\r\n            KL.filterLib.cropExtend.apply(p);\r\n            layerManager.update();\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        }, statusOverlay, showCrop);\r\n    }\r\n\r\n    const bottomBarWrapper = BB.el({\r\n        css: {\r\n            width: \"270px\",\r\n            position: \"absolute\",\r\n            bottom: '0',\r\n            left: '0'\r\n        },\r\n    });\r\n    if (pOptions.bottomBar) {\r\n        bottomBarWrapper.append(pOptions.bottomBar);\r\n        const observer = new MutationObserver(() => updateBottomBar());\r\n        observer.observe(\r\n            toolspaceInner,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n    }\r\n    function updateBottomBar() {\r\n        if (!pOptions.bottomBar) {\r\n            return;\r\n        }\r\n        const threshold = 617; //590\r\n        const isVisible = (\r\n            threshold < window.innerHeight &&\r\n            toolspaceInner.scrollHeight + 50 < window.innerHeight\r\n        );\r\n        bottomBarWrapper.style.display = isVisible ? '' : 'none';\r\n    }\r\n\r\n\r\n\r\n    BB.append(toolspaceInner, [\r\n        layerPreview.getElement(),\r\n        mainTabRow.getElement(),\r\n        brushDiv,\r\n        handUi.getElement(),\r\n        fillUi.getElement(),\r\n        textUi.getElement(),\r\n        shapeUi.getElement(),\r\n        layerManager,\r\n        filterTab.getElement(),\r\n        fileTab ? fileTab.getElement() : null,\r\n        settingsTab.getElement(),\r\n        BB.el({\r\n            css: {\r\n                height: '10px', // a bit of spacing at the bottom\r\n            }\r\n        }),\r\n        bottomBarWrapper ? bottomBarWrapper : null\r\n    ]);\r\n\r\n    const toolspaceScroller = new KL.ToolspaceScroller({\r\n        toolspace,\r\n        uiState,\r\n    });\r\n\r\n    // --- interface ---\r\n\r\n    this.getEl = () => {\r\n        return klRootEl;\r\n    };\r\n\r\n    this.resize = (w, h) => {\r\n\r\n        // iPad scrolls down when increasing text zoom\r\n        if (window.scrollY > 0) {\r\n            window.scrollTo(0, 0);\r\n        }\r\n\r\n        if (uiWidth === Math.max(0, w) && uiHeight === Math.max(0, h)) {\r\n            return;\r\n        }\r\n\r\n        uiWidth = Math.max(0, w);\r\n        uiHeight = Math.max(0, h);\r\n\r\n        updateCollapse();\r\n        updateBottomBar();\r\n\r\n        layerPreview.setIsVisible(uiHeight >= 579);\r\n        klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\r\n        toolspaceToolRow.setIsSmall(uiHeight < 540);\r\n    };\r\n\r\n    this.out = (msg) => {\r\n        statusOverlay.out(msg);\r\n    };\r\n\r\n    this.getPNG = function(): Blob {\r\n        return base64ToBlob(klCanvas.getCompleteCanvas(1).toDataURL('image/png'));\r\n    };\r\n\r\n    this.getPSD = async function() {\r\n        return await klCanvasToPsdBlob(klCanvas);\r\n    };\r\n\r\n    this.getProject = () => klCanvas.getProject();\r\n\r\n    this.swapUiLeftRight = () => {\r\n        uiState = uiState === 'left' ? 'right' : 'left';\r\n        if (!pOptions.embed) {\r\n            LocalStorage.setItem('uiState', uiState);\r\n        }\r\n        updateUi();\r\n    };\r\n\r\n    this.saveAsPsd = () => {\r\n        saveToComputer.save('psd');\r\n    };\r\n\r\n    this.isDrawing = () => {\r\n        return lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\r\n    };\r\n\r\n    // --- end interface ---\r\n\r\n    this.resize(uiWidth, uiHeight);\r\n    updateUi();\r\n\r\n    {\r\n        BB.addEventListener(window, 'resize', () => {\r\n            this.resize(window.innerWidth, window.innerHeight);\r\n        });\r\n        BB.addEventListener(window, 'orientationchange', () => {\r\n            this.resize(window.innerWidth, window.innerHeight);\r\n        });\r\n\r\n        // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\r\n        // Workaround: place a div in the body that fills the window, and use a ResizeObserver\r\n        const windowResizeWatcher = BB.el({\r\n            parent: document.body,\r\n            css: {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n                pointerEvents: 'none',\r\n                zIndex: '-1',\r\n                userSelect: 'none',\r\n            }\r\n        });\r\n        try {\r\n            // Not all browsers support ResizeObserver. Not critical though.\r\n            const observer = new ResizeObserver(() => this.resize(window.innerWidth, window.innerHeight));\r\n            observer.observe(windowResizeWatcher);\r\n        } catch (e) {\r\n            windowResizeWatcher.parentNode.removeChild(windowResizeWatcher);\r\n        }\r\n\r\n        // prevent ctrl scroll -> zooming page\r\n        BB.addEventListener(this.getEl(), 'wheel', (event) => {\r\n            event.preventDefault();\r\n        });\r\n        //maybe prevent zooming on safari mac os - I can't test it\r\n        const prevent = (e) => {\r\n            e.preventDefault();\r\n        }\r\n        window.addEventListener('gesturestart', prevent);\r\n        window.addEventListener('gesturechange', prevent);\r\n        window.addEventListener('gestureend', prevent);\r\n    }\r\n}","import {DecoyKlHistory, klHistory} from './history/kl-history';\r\nimport {Popup, popup} from './ui/modals/popup';\r\nimport {dialogCounter} from './ui/modals/modal-count';\r\nimport {Checkbox} from './ui/base-components/checkbox';\r\nimport {input} from './ui/base-components/input';\r\nimport {Select} from './ui/base-components/select';\r\nimport {ImageToggle} from './ui/base-components/image-toggle';\r\nimport {ImageRadioList} from './ui/base-components/image-radio-list';\r\nimport {penPressureToggle} from './ui/base-components/pen-pressure-toggle';\r\nimport {KlSlider} from './ui/base-components/kl-slider';\r\nimport {calcSliderFalloffFactor} from './ui/base-components/slider-falloff';\r\nimport {HexColorDialog} from './ui/modals/color-slider-hex-dialog';\r\nimport {KlColorSlider} from './ui/base-components/kl-color-slider';\r\nimport {KlSmallColorSlider} from './ui/base-components/kl-color-slider-small';\r\nimport {PointSlider} from './ui/base-components/point-slider';\r\nimport {ColorOptions} from './ui/base-components/color-options';\r\nimport {Options} from './ui/base-components/options';\r\nimport {StatusOverlay} from './ui/components/status-overlay';\r\nimport {exportDialog} from './ui/modals/export-dialog-deprecated';\r\nimport {CropCopy} from './ui/components/crop-copy';\r\nimport {clipboardDialog} from './ui/modals/clipboard-dialog';\r\nimport {klLayerManager} from './ui/tool-tabs/kl-layer-manager';\r\nimport {WorkspaceSvgOverlay} from './canvas-ui/workspace-svg-overlay';\r\nimport {KlCanvasWorkspace} from './canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvasPreview} from './canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './ui/components/free-transform';\r\nimport {FreeTransformCanvas} from './ui/components/free-transform-canvas';\r\nimport {Cropper} from './ui/components/cropper';\r\nimport {LayerPreview} from './ui/components/layer-preview';\r\nimport {FittedImage} from './ui/components/fitted-image';\r\nimport {showImportAsLayerDialog} from './ui/modals/show-import-as-layer-dialog';\r\nimport {KlImageDropper} from './ui/components/kl-image-dropper';\r\nimport {OverlayToolspace} from './ui/components/overlay-toolspace';\r\nimport {ToolspaceTopRow} from './ui/components/toolspace-top-row';\r\nimport {ToolDropdown} from './ui/components/tool-dropdown';\r\nimport {ToolspaceToolRow} from './ui/components/toolspace-tool-row';\r\nimport {ToolspaceStabilizerRow} from './ui/components/toolspace-stabilizer-row';\r\nimport {TabRow} from './ui/components/tab-row';\r\nimport {HandUi} from './ui/tool-tabs/hand-ui';\r\nimport {FillUi} from './ui/tool-tabs/fill-ui';\r\nimport {TextUi} from './ui/tool-tabs/text-ui';\r\nimport {ShapeUi} from './ui/tool-tabs/shape-ui';\r\nimport {newImageDialog} from './ui/modals/new-image-dialog';\r\nimport {ToolspaceCollapser} from './ui/components/toolspace-collapser';\r\nimport {renderText} from './image-operations/render-text';\r\nimport {textToolDialog} from './ui/modals/text-tool-dialog';\r\nimport {showImportImageDialog} from './ui/modals/show-import-image-dialog';\r\nimport {floodFillBits} from './image-operations/flood-fill';\r\nimport * as PSD from './storage/psd';\r\nimport {drawShape, ShapeTool} from './image-operations/shape-tool';\r\nimport {KlCanvas} from './canvas/kl-canvas';\r\nimport * as indexedDb from './storage/indexed-db';\r\nimport {filterLib, filterLibStatus} from './filters/filters';\r\nimport {brushes} from './brushes/brushes';\r\nimport {brushesUI} from './brushes-ui/brushes-ui';\r\nimport {showIframePopup} from './ui/modals/show-iframe-popup';\r\nimport {RadioList} from './ui/base-components/radio-list';\r\nimport {BrowserStorageUi} from './ui/components/browser-storage-ui';\r\nimport {drawProject} from './canvas/draw-project';\r\nimport {ProjectStore} from './storage/project-store';\r\nimport {FileTab} from \"./ui/tool-tabs/file-tab\";\r\nimport {FilterTab} from \"./ui/tool-tabs/filter-tab\";\r\nimport {imgurUpload} from \"./ui/modals/imgur-upload\";\r\nimport {loadAgPsd} from \"./storage/ag-psd-wrapper\";\r\nimport {SaveReminder} from \"./ui/components/save-reminder\";\r\nimport {SaveToComputer} from \"./storage/save-to-computer\";\r\nimport {UndoRedoCatchup} from \"./history/undo-redo-catchup\";\r\nimport {setDbName} from './storage/indexed-db';\r\nimport {BrushSettingService} from './brushes-ui/brush-setting-service';\r\nimport {BoxToggle} from './ui/base-components/box-toggle';\r\nimport {SettingsTab} from './ui/tool-tabs/settings-tab';\r\nimport {ToolspaceScroller} from './ui/components/toolspace-scroller';\r\n\r\n/**\r\n * paint tool functionality\r\n */\r\nexport const KL = {\r\n\r\n    // --- brushes ---\r\n    brushes,\r\n    brushesUI,\r\n    BrushSettingService,\r\n\r\n    // --- canvas ---\r\n    KlCanvas,\r\n    drawProject,\r\n\r\n    // --- canvas ui ---\r\n    WorkspaceSvgOverlay,\r\n    KlCanvasWorkspace,\r\n    KlCanvasPreview,\r\n\r\n    // --- filters ---\r\n    filterLibStatus,\r\n    filterLib,\r\n\r\n    // --- history ---\r\n    UndoRedoCatchup,\r\n\r\n    // --- image operations ---\r\n    renderText,\r\n    floodFillBits,\r\n    ShapeTool,\r\n    drawShape,\r\n\r\n    // --- storage ---\r\n    PSD,\r\n    setDbName,\r\n    indexedDb,\r\n    ProjectStore,\r\n    loadAgPsd,\r\n    SaveToComputer,\r\n\r\n    // --- ui - base components ---\r\n    calcSliderFalloffFactor,\r\n    Checkbox,\r\n    input,\r\n    Select,\r\n    ImageToggle,\r\n    ImageRadioList,\r\n    RadioList,\r\n    penPressureToggle,\r\n    KlSlider,\r\n    HexColorDialog,\r\n    KlColorSlider,\r\n    KlSmallColorSlider,\r\n    PointSlider,\r\n    ColorOptions,\r\n    Options,\r\n    BoxToggle,\r\n\r\n    // --- ui - components ---\r\n    StatusOverlay,\r\n    CropCopy,\r\n    FreeTransform,\r\n    FreeTransformCanvas,\r\n    Cropper,\r\n    LayerPreview,\r\n    FittedImage,\r\n    KlImageDropper,\r\n    OverlayToolspace,\r\n    ToolspaceTopRow,\r\n    ToolDropdown,\r\n    ToolspaceToolRow,\r\n    ToolspaceStabilizerRow,\r\n    TabRow,\r\n    ToolspaceCollapser,\r\n    BrowserStorageUi,\r\n    SaveReminder,\r\n    ToolspaceScroller,\r\n\r\n    // --- ui - modals ---\r\n    dialogCounter,\r\n    popup,\r\n    Popup,\r\n    exportDialog,\r\n    clipboardDialog,\r\n    showImportAsLayerDialog,\r\n    newImageDialog,\r\n    textToolDialog,\r\n    showImportImageDialog,\r\n    showIframePopup,\r\n    imgurUpload,\r\n\r\n    // --- ui - tool tabs ---\r\n    HandUi,\r\n    FillUi,\r\n    TextUi,\r\n    ShapeUi,\r\n    FileTab,\r\n    FilterTab,\r\n    SettingsTab,\r\n    klLayerManager,\r\n\r\n\r\n    klHistory,\r\n    DecoyKlHistory,\r\n};","\r\nexport interface IHistoryEntry {\r\n    tool: string[];\r\n    action?: string;\r\n    params?: any[];\r\n\r\n    actions?: {\r\n        action: string;\r\n        params: any[];\r\n    }[]\r\n}\r\n\r\nexport interface IHistoryBroadcast {\r\n    bufferUpdate: IHistoryEntry;\r\n}\r\n\r\nexport type IHistoryListener = (p: IHistoryBroadcast | null) => void;\r\n\r\nlet historyInstance: boolean = false;\r\n\r\nexport interface KlHistoryInterface {\r\n    pause (b: boolean): void;\r\n    addListener (l: IHistoryListener): void;\r\n    push (e: IHistoryEntry): void;\r\n    undo (): (IHistoryEntry | null)[];\r\n    redo (): (IHistoryEntry | null)[];\r\n    getAll (): (IHistoryEntry | null)[];\r\n    canRedo (): boolean;\r\n    canUndo (): boolean;\r\n    getState (): number;\r\n    getActionNumber (): number;\r\n}\r\n\r\nexport class DecoyKlHistory implements KlHistoryInterface {\r\n    pause (b: boolean): void {}\r\n    addListener (l: IHistoryListener): void {}\r\n    push (e: IHistoryEntry): void {}\r\n    undo (): (IHistoryEntry | null)[] { return []; }\r\n    redo (): (IHistoryEntry | null)[] { return []; }\r\n    getAll (): (IHistoryEntry | null)[] { return []; }\r\n    canRedo (): boolean { return false; }\r\n    canUndo (): boolean { return false; }\r\n    getState (): number { return 0; }\r\n    getActionNumber (): number { return 0; }\r\n}\r\n\r\nexport class KlHistory implements KlHistoryInterface {\r\n\r\n    private state: number; // on .push state increments by one\r\n    private dataArr: (IHistoryEntry | null)[]; // null if beyond max undo to trigger garbage collection\r\n    private listeners: IHistoryListener[];\r\n    private pauseStack: number; // how often paused without unpause\r\n    private readonly max: number = 20; // max number undo steps\r\n    private maxState: number; // can't go backwards -> max state is the buffer image(klCanvas)\r\n    private actionNumber: number; // current action the user is on. untouched document = -1 because dataArr.length is 0\r\n    \r\n    private broadcast (p: IHistoryBroadcast | null): void {\r\n        setTimeout(() => {\r\n            for (let i = 0; i < this.listeners.length; i++) {\r\n                this.listeners[i](p);\r\n            }\r\n            this.state++;\r\n        }, 1);\r\n    }\r\n    \r\n    // ---- public ----\r\n    \r\n    constructor () {\r\n        if (historyInstance) {\r\n            throw new Error('klHistory already instantiated');\r\n        }\r\n        historyInstance = true;\r\n        this.state = 0;\r\n        this.dataArr = [];\r\n        this.listeners = [];\r\n        this.pauseStack = 0;\r\n        this.maxState = -1;\r\n        this.actionNumber = -1;\r\n    }\r\n\r\n    /**\r\n     * you need pause because there are sometimes actions that would cause other\r\n     * undo steps\r\n     * for example a filter that does something crazy with two layers and then merges them\r\n     * you want that to be one undo step, and prevent merging from causing its undo step.\r\n     * so while that filter is doing its magic you should pause possible undo steps that\r\n     * that are caused by a part of its code(in this example: merging layers)\r\n     *\r\n     * @param b\r\n     */\r\n    pause (b: boolean): void {\r\n        if (b === false) {\r\n            this.pauseStack = Math.max(0, this.pauseStack - 1);\r\n        } else {\r\n            this.pauseStack++;\r\n        }\r\n    }\r\n\r\n    addListener (l: IHistoryListener): void {\r\n        this.listeners.push(l);\r\n    }\r\n\r\n    push (e: IHistoryEntry): void {\r\n        if (this.pauseStack > 0) {\r\n            return;\r\n        }\r\n        while (this.actionNumber < this.dataArr.length - 1) {\r\n            this.dataArr.pop();\r\n        }\r\n\r\n        //taking care of actions that shouldn't cause a new undo step\r\n        const top = this.dataArr[this.dataArr.length - 1];\r\n        if (e.action === 'layerOpacity' && top && top.action === 'layerOpacity' && top.params[0] === e.params[0]) {\r\n            this.dataArr[this.dataArr.length - 1] = e;\r\n            this.state++; //still needs to increment because something changed\r\n            return;\r\n        }\r\n        if (e.action === 'focusLayer' && top && top.action === 'focusLayer') {\r\n            this.dataArr[this.dataArr.length - 1] = e;\r\n            this.state++;\r\n            return;\r\n        }\r\n\r\n\r\n        this.dataArr[this.dataArr.length] = e;\r\n        this.actionNumber = this.dataArr.length - 1;\r\n        const maxBefore = this.maxState;\r\n        this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\r\n        if (maxBefore < this.maxState) {\r\n            this.broadcast({bufferUpdate: this.dataArr[this.maxState]});\r\n        } else {\r\n            this.broadcast(null);\r\n        }\r\n        if (this.maxState >= 0) {\r\n            this.dataArr[this.maxState] = null; //to free some memory...imported images take a lot of space\r\n        }\r\n    }\r\n\r\n    undo (): (IHistoryEntry | null)[] {\r\n        let result;\r\n        if (this.canUndo()) {\r\n            result = [];\r\n            for (let i = this.maxState + 1; i < this.actionNumber; i++) {\r\n                result.push(this.dataArr[i]);\r\n            }\r\n            this.actionNumber--;\r\n            this.broadcast(null);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    redo (): (IHistoryEntry | null)[] {\r\n        const result = [];\r\n        if (this.canRedo()) {\r\n            this.actionNumber++;\r\n            result.push(this.dataArr[this.actionNumber]);\r\n            this.broadcast(null);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    getAll (): (IHistoryEntry | null)[] {\r\n        return [].concat(this.dataArr);\r\n    }\r\n\r\n    canRedo (): boolean {\r\n        return this.actionNumber < this.dataArr.length - 1;\r\n    }\r\n\r\n    canUndo (): boolean {\r\n        return this.actionNumber > this.maxState;\r\n    }\r\n\r\n    getState (): number {\r\n        return this.state;\r\n    }\r\n\r\n    /**\r\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\r\n     */\r\n    getActionNumber (): number {\r\n        return (this.actionNumber + 1);\r\n    }\r\n    \r\n}\r\n\r\nexport const klHistory = new KlHistory();\r\n","import {dialogCounter} from './modal-count';\r\nimport {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport checkImg from 'url:~/src/app/img/ui/check.svg';\r\n// @ts-ignore\r\nimport cancelImg from 'url:~/src/app/img/ui/cancel.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\n\r\nwindow.onscroll = (e) => {\r\n    e.preventDefault();\r\n}\r\n\r\nexport function popup (\r\n    p: {\r\n        target: HTMLElement;\r\n        div?: HTMLElement; // node with content\r\n        message: string; // can be html\r\n        callback?: (result: string) => void;\r\n        buttons?: string[]; // \"Ok\", and \"Cancel\" will be automatically translated\r\n        primaries?: string[];\r\n        type?: 'error' | 'warning' | 'upload' | 'ok'; // todo\r\n        closefunc?: (f: () => void) => void; // returns a function you can call to close (Cancel) the dialog\r\n        style?: IKeyString;\r\n        clickOnEnter?: string; // name of button - will be clicked if enter key pressed\r\n        autoFocus?: false | string; // name of  to automatically focus - default 'Ok' - false -> none\r\n        ignoreBackground?: boolean; // deafult false; if true clicking on background doesn't close\r\n    }\r\n): void {\r\n    dialogCounter.increase();\r\n    let isClosed = false;\r\n\r\n\r\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\r\n    const rootRootEl = BB.el({\r\n        parent: document.body,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            overflow: 'hidden',\r\n        }\r\n    });\r\n    const rootEl = BB.el({\r\n        parent: rootRootEl,\r\n        className: 'kl-popup',\r\n    });\r\n\r\n    const scrollContent = BB.el({\r\n        parent: rootEl,\r\n        css: {\r\n            width: '100%',\r\n            minHeight: '100%',\r\n            // padding: '10px 0',\r\n            position: 'relative',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n        }\r\n    });\r\n\r\n    const bgEl = BB.el({\r\n        parent: scrollContent,\r\n        onClick: () => {\r\n            if (p.ignoreBackground) {\r\n                return;\r\n            }\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            zIndex: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n        }\r\n    });\r\n\r\n    const titleHeight = 40;\r\n    const xButton = BB.el({\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: () => {\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            position: 'absolute',\r\n            right: '0',\r\n            top: '0',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        }\r\n    });\r\n\r\n    const boxClasses = ['kl-popup-box'];\r\n    boxClasses.push('kl-popup-box--sm');\r\n    const boxEl = BB.el({\r\n        content: [\r\n            xButton,\r\n            BB.el({\r\n                content:p.message,\r\n                css: {\r\n                    marginBottom: p.div ? '10px' : null,\r\n                    marginRight: '15px',\r\n                }\r\n            }),\r\n            p.div,\r\n        ],\r\n        className: boxClasses.join(' '),\r\n        css: p.style ? p.style : null,\r\n    });\r\n\r\n    scrollContent.append(\r\n        BB.el({\r\n            css: {\r\n                flex: '0.5',\r\n            }\r\n        }),\r\n        boxEl,\r\n        BB.el({\r\n            css: {\r\n                flex: '1',\r\n            }\r\n        })\r\n    );\r\n\r\n    if (p.type === 'error') {\r\n        boxEl.classList.add('poperror');\r\n    }\r\n    if (p.type === 'ok') {\r\n        boxEl.classList.add('popok');\r\n    }\r\n    if (p.type === 'warning') {\r\n        boxEl.classList.add('popwarning');\r\n    }\r\n    if (p.type === 'upload') {\r\n        boxEl.classList.add('popupload');\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e, comboStr) {\r\n            if (isClosed) {\r\n                return;\r\n            }\r\n            if (clickOnEnterBtn && comboStr === 'enter' && !BB.isInputFocused()) {\r\n                e.stopPropagation();\r\n                setTimeout(function() {\r\n                    clickOnEnterBtn.click();\r\n                }, 10);\r\n            }\r\n            if (comboStr === 'esc') {\r\n                e.stopPropagation();\r\n                close('Cancel');\r\n            }\r\n        }\r\n    });\r\n    // prevent ctrl scroll -> zooming page\r\n    const wheelPrevent = (event) => {\r\n        if (keyListener.isPressed('ctrl')) {\r\n            event.preventDefault();\r\n        }\r\n    };\r\n    BB.addEventListener(rootEl, 'wheel', wheelPrevent);\r\n    rootEl.onclick = BB.handleClick;\r\n\r\n    let autoFocus = null;\r\n    if (p.autoFocus) {\r\n        autoFocus = p.autoFocus;\r\n    } else if (p.autoFocus === false) {\r\n        autoFocus = null;\r\n    } else {\r\n        autoFocus = 'Ok';\r\n    }\r\n\r\n    const buttonRowEl = p.buttons && p.buttons.length > 0 ? BB.el({\r\n        parent: boxEl,\r\n        css: {\r\n            display: 'flex',\r\n            flexWrap: 'wrap',\r\n            justifyContent: 'flex-end',\r\n            marginTop: '12px', // 8px already via buttons\r\n            marginLeft: '-8px',\r\n        }\r\n    }) : null;\r\n    let clickOnEnterBtn;\r\n    const btnElArr = [];\r\n    if (p.buttons) {\r\n        p.buttons.forEach(buttonName => {\r\n            const btnClasses = ['kl-popup__btn'];\r\n            if (buttonName === 'Ok' || (p.primaries && p.primaries.includes(buttonName))) {\r\n                btnClasses.push('kl-button-primary');\r\n            }\r\n            let iconUrl;\r\n            let label = buttonName;\r\n            if (buttonName === 'Ok') {\r\n                label = LANG('modal-ok');\r\n                iconUrl = checkImg;\r\n            }\r\n            if (buttonName === 'Cancel') {\r\n                label = LANG('modal-cancel');\r\n                iconUrl = cancelImg;\r\n            }\r\n            let iconImg = null;\r\n            if (iconUrl) {\r\n                iconImg = BB.el({\r\n                    tagName: 'img',\r\n                    custom: {\r\n                        src: iconUrl,\r\n                        height: '17',\r\n                    }\r\n                });\r\n            }\r\n            const btn = BB.el({\r\n                parent: buttonRowEl,\r\n                tagName: 'button',\r\n                className: btnClasses.join(' '),\r\n                content: [iconImg, label],\r\n                onClick: () => {\r\n                    close(buttonName);\r\n                },\r\n            });\r\n            btnElArr.push(btn);\r\n            if (autoFocus === buttonName) {\r\n                setTimeout(() => {\r\n                    btn.focus();\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 10);\r\n                setTimeout(() => {\r\n                    // safari needs a separate timeout\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 20);\r\n            }\r\n            if (buttonName === p.clickOnEnter) {\r\n                clickOnEnterBtn = btn;\r\n            }\r\n        });\r\n    }\r\n\r\n    function close (value: string) {\r\n        if (isClosed) {\r\n            return;\r\n        }\r\n\r\n        isClosed = true;\r\n        BB.clearSelection();\r\n        {\r\n            /*\r\n            Unfocus anything that is focused.\r\n\r\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\r\n            that isn't its direct parent, then Firefox will keep anything attached to this\r\n            Input in memory. It will not be garbage collected until a new Input is focused.\r\n\r\n            Workaround: Temporarily create an input, focus it, detach it.\r\n             */\r\n            const focusEl = BB.el({\r\n                parent: document.body,\r\n                tagName: 'input',\r\n                css: {\r\n                    opacity: '0',\r\n                    width: '0',\r\n                    height: '0',\r\n                }\r\n            }) as HTMLInputElement;\r\n            setTimeout(() => {\r\n                focusEl.select();\r\n                focusEl.focus();\r\n                focusEl.parentNode.removeChild(focusEl);\r\n            }, 10);\r\n        }\r\n        document.body.removeChild(rootRootEl);\r\n        dialogCounter.decrease();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        keyListener.destroy();\r\n        BB.removeEventListener(rootEl, 'wheel', wheelPrevent);\r\n        rootEl.onclick = null;\r\n        btnElArr.forEach(item => {\r\n            BB.destroyEl(item);\r\n        });\r\n        btnElArr.splice(0, btnElArr.length);\r\n\r\n        if (p.callback) {\r\n            p.callback(value);\r\n        }\r\n    }\r\n\r\n    if (p.closefunc) {\r\n        p.closefunc(function () {\r\n            close('Cancel');\r\n        });\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * popups that fill whole height, with some padding.\r\n * currently only used for iframe popups.\r\n *\r\n * p = {\r\n *      title: DOM Element | string, // optional (todo allow string)\r\n *      icon: 'ok', // optional todo\r\n *      content: DOM Element, // optional\r\n *      buttonArr: [ // optional todo\r\n *          'Ok',\r\n *          'Cancel'\r\n *      ],\r\n *      autoFocus: string | false, //todo\r\n *      clickOnEnter: string, //todo\r\n *      onClose: function(result: string), // optional (todo result)\r\n *\r\n *      //size and position\r\n *      width: 500,\r\n *      isMaxHeight: boolean //todo, currently always true\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const Popup = function(p) {\r\n    dialogCounter.increase();\r\n    const parent = document.body;\r\n    const div = BB.el({\r\n        parent: parent,\r\n        className: 'g-root',\r\n        css: {\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            bottom: '0',\r\n            right: '0',\r\n            background: 'rgba(0, 0, 0, 0.45)',\r\n            overflow: 'auto',\r\n            animationName: 'consoleIn',\r\n            animationDuration: '0.3s',\r\n            animationTimingFunction: 'ease-out'\r\n        }\r\n    });\r\n    div.onclick = BB.handleClick;\r\n\r\n    let updateInterval;\r\n\r\n    function close() {\r\n        dialogCounter.decrease();\r\n        div.onclick = null;\r\n        parent.removeChild(div);\r\n        clearInterval(updateInterval);\r\n        window.removeEventListener('resize', updatePos);\r\n        keyListener.destroy();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        if (p.onClose) {\r\n            p.onClose();\r\n        }\r\n    }\r\n\r\n    //background element registering clicks\r\n    const bgEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            bottom: '0',\r\n            right: '0'\r\n        },\r\n        onClick: close\r\n    });\r\n\r\n    //the actual popup box\r\n    const popupEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'absolute',\r\n            width: (BB.isCssMinMaxSupported() ?\r\n                'min(calc(100% - 40px), ' + (p.width ? p.width : 400) + 'px)' :\r\n                (p.width ? p.width : 400) + 'px'),\r\n            height: 'calc(100% - 40px)',\r\n            background: '#eee',\r\n            borderRadius: '10px',\r\n            overflow: 'hidden',\r\n            boxShadow: 'rgba(0, 0, 0, 0.25) 0px 5px 60px'\r\n        }\r\n    });\r\n\r\n    //x and y position via script. flex not powerful enough imo\r\n    function updatePos() {\r\n        const elW = popupEl.offsetWidth;\r\n        const elH = popupEl.offsetHeight;\r\n\r\n        BB.css(popupEl, {\r\n            left: Math.max(0, (window.innerWidth - elW) / 2) + 'px',\r\n            top: Math.max(20, (window.innerHeight - elH) / 2 - (elH * 0.20)) + 'px'\r\n        });\r\n    }\r\n    //todo also update when popup changes size - resizeobserver and fallback\r\n    //updateInterval = setInterval(updatePos, 100);\r\n    updatePos();\r\n    window.addEventListener('resize', updatePos);\r\n\r\n    //title row in popup\r\n    const titleHeight = 40;\r\n    const titleEl = BB.el({\r\n        parent: popupEl,\r\n        css: {\r\n            height: titleHeight + 'px',\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            paddingLeft: (titleHeight / 2) + 'px'\r\n        }\r\n    });\r\n    if (p.title) {\r\n        titleEl.appendChild(p.title);\r\n    }\r\n    const xButton = BB.el({\r\n        parent: titleEl,\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: close,\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        },\r\n        custom: {\r\n            tabindex: '0',\r\n        }\r\n    });\r\n\r\n    const contentEl = BB.el({\r\n        parent: popupEl,\r\n        css: {\r\n            height: 'calc(100% - ' + titleHeight + 'px)'\r\n        }\r\n    });\r\n    if (p.content) {\r\n        contentEl.appendChild(p.content);\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e) {\r\n            if (keyStr === 'esc') {\r\n                e.stopPropagation();\r\n                close();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n    this.close = function() {\r\n        close();\r\n    };\r\n};","\r\n// not the best\r\n\r\n/**\r\n * how many modals are open\r\n */\r\n\r\nexport class DialogCounter {\r\n    private listeners: ((v: number) => void)[] = [];\r\n    private count = 0;\r\n\r\n    private emit (): void {\r\n        this.listeners.forEach(item => {\r\n            item(this.count);\r\n        });\r\n    }\r\n\r\n    increase (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count += v;\r\n        } else {\r\n            this.count++;\r\n        }\r\n        this.emit();\r\n    }\r\n    decrease (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count -= v;\r\n        } else {\r\n            this.count--;\r\n        }\r\n        this.emit();\r\n    }\r\n    get (): number {\r\n        return this.count;\r\n    }\r\n    subscribe (listener: (v: number) => void): void {\r\n        this.listeners.push(listener);\r\n    }\r\n}\r\n\r\nexport const dialogCounter = new DialogCounter();\r\n","import * as BBEventListener from './input/event-listener';\r\nimport {\r\n    append, centerWithin, copyObj, createSvg,\r\n    css, dateDayDifference, decToFraction,\r\n    fitInto, gcd, getDate,\r\n    handleClick, imageBlobToUrl,\r\n    insertAfter, loadImage,\r\n    reduce,\r\n    setAttributes, shareCanvas\r\n} from './base/base';\r\nimport {\r\n    canShareFiles,\r\n    eventUsesHighResTimeStamp,\r\n    getVisitor,\r\n    hasPointerEvents,\r\n    hasWebGl,\r\n    isCssMinMaxSupported,\r\n    mouseEventHasMovement\r\n} from './base/browser';\r\nimport {KeyListener, sameKeys} from './input/key-listener';\r\nimport {PointerListener} from './input/pointer-listener';\r\nimport * as EventChain from './input/event-chain';\r\nimport {\r\n    convertToAlphaChannelCanvas,\r\n    copyCanvas,\r\n    createCheckerCanvas, createCheckerDataUrl,\r\n    drawTransformedImageOnCanvas,\r\n    drawTransformedImageWithBounds, freeCanvas, resizeCanvas, testShouldPixelate\r\n} from './base/canvas';\r\nimport {Matrix} from './math/matrix';\r\nimport {Vec2} from './math/vec2';\r\nimport {BezierLine, PointLine, projectPointOnLine, quadraticSplineInput, SplineInterpolator} from './math/line';\r\nimport {CMYK, ColorConverter, HSV, RGB, testIsWhiteBestContrast} from './color/color';\r\nimport {appendTextDiv, clearSelection, destroyEl, el, isInputFocused, makeUnfocusable} from './base/ui';\r\nimport {\r\n    pointsToAngleDeg,\r\n    clamp,\r\n    dist,\r\n    mix,\r\n    pointsToAngleRad,\r\n    rotate,\r\n    rotateAround,\r\n    intDxy,\r\n    roundEven, roundUneven, distSquared, lenSquared, updateBounds, boundsInArea\r\n} from './math/math';\r\nimport {createCanvas} from './base/create-canvas';\r\nimport {BbLog} from './base/bb-log';\r\nimport {LocalStorage} from './base/local-storage';\r\n\r\nexport const BB = {\r\n\r\n    // ---- browser ----\r\n    eventUsesHighResTimeStamp,\r\n    mouseEventHasMovement,\r\n    hasPointerEvents,\r\n    hasWebGl,\r\n    getVisitor,\r\n    isCssMinMaxSupported,\r\n    canShareFiles,\r\n\r\n    // ---- base ----\r\n    insertAfter,\r\n    loadImage,\r\n    css,\r\n    setAttributes,\r\n    append,\r\n    fitInto,\r\n    centerWithin,\r\n    getDate,\r\n    gcd,\r\n    reduce,\r\n    decToFraction,\r\n    imageBlobToUrl,\r\n    dateDayDifference,\r\n    copyObj,\r\n    shareCanvas,\r\n    handleClick,\r\n    createSvg,\r\n    BbLog,\r\n    LocalStorage,\r\n\r\n    // ---- math ----\r\n    mix,\r\n    dist,\r\n    distSquared,\r\n    lenSquared,\r\n    pointsToAngleRad,\r\n    pointsToAngleDeg,\r\n    clamp,\r\n    rotate,\r\n    rotateAround,\r\n    Matrix,\r\n    Vec2,\r\n    intDxy,\r\n    roundEven,\r\n    roundUneven,\r\n    updateBounds,\r\n    boundsInArea,\r\n\r\n    // ---- line ----\r\n    projectPointOnLine,\r\n    PointLine,\r\n    BezierLine,\r\n    SplineInterpolator,\r\n    quadraticSplineInput,\r\n\r\n    // ---- canvas ----\r\n    canvas: createCanvas,\r\n    copyCanvas,\r\n    testShouldPixelate,\r\n    drawTransformedImageWithBounds,\r\n    drawTransformedImageOnCanvas,\r\n    createCheckerCanvas,\r\n    createCheckerDataUrl,\r\n    resizeCanvas,\r\n    convertToAlphaChannelCanvas,\r\n    freeCanvas,\r\n\r\n    // ---- color ----\r\n    HSV,\r\n    RGB,\r\n    CMYK,\r\n    ColorConverter,\r\n    testIsWhiteBestContrast,\r\n\r\n    // ---- UI ----\r\n    appendTextDiv,\r\n    clearSelection,\r\n    makeUnfocusable,\r\n    el,\r\n    destroyEl,\r\n    isInputFocused: isInputFocused,\r\n\r\n\r\n    // ---- events / input ----\r\n\r\n    addEventListener: BBEventListener.addEventListener,\r\n    removeEventListener: BBEventListener.removeEventListener,\r\n    setEventListener: BBEventListener.setEventListener,\r\n\r\n    KeyListener,\r\n    PointerListener,\r\n    sameKeys,\r\n\r\n    EventChain,\r\n\r\n};\r\n","import {hasPointerEvents} from '../base/browser';\r\n\r\nconst listenerFuncObj = {}; // for debugging\r\n\r\nexport const setEventListener = function (DomEl, type, listener) {\r\n    if (!hasPointerEvents) {\r\n        type = type.replace('pointer', 'mouse');\r\n    }\r\n    DomEl[type] = listener;\r\n};\r\n\r\nexport const addEventListener = function (DomEl, type, listener, options?) {\r\n    if (!hasPointerEvents) {\r\n        type = type.replace('pointer', 'mouse');\r\n    }\r\n    /*if (!(type in listenerFuncObj)) {\r\n        listenerFuncObj[type] = [];\r\n    }\r\n    listenerFuncObj[type].push(listener);*/\r\n    DomEl.addEventListener(type, listener, options);\r\n};\r\n\r\nexport const removeEventListener = function (DomEl, type, listener, options?) {\r\n    if (!hasPointerEvents) {\r\n        type = type.replace('pointer', 'mouse');\r\n    }\r\n    /*if (type in listenerFuncObj) {\r\n        for (let i = 0; i < listenerFuncObj[type].length; i++) {\r\n            if (listenerFuncObj[type][i] === listener) {\r\n                listenerFuncObj[type].splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }*/\r\n    DomEl.removeEventListener(type, listener, options);\r\n};","import {createCanvas} from './create-canvas';\r\n\r\nexport const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\r\n\r\nexport const eventUsesHighResTimeStamp = (function() {\r\n\r\n    let eventUsesHighResTimeStamp: boolean | null = null;\r\n    if (document.body) {\r\n        (function() {\r\n            const event = new Event('');\r\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\r\n        })();\r\n    } else {\r\n        window.addEventListener('DOMContentLoaded', function(event) {\r\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\r\n        });\r\n    }\r\n\r\n    return function(): boolean {\r\n        if (eventUsesHighResTimeStamp === null) {\r\n            throw 'eventUsesHighResTimeStamp not initialized';\r\n        }\r\n        return eventUsesHighResTimeStamp;\r\n    }\r\n})();\r\n\r\nexport const mouseEventHasMovement = (() => {\r\n\r\n    // no support: IE, Safari, Safari iOS\r\n    // supported but broken: Firefox\r\n\r\n    if (!('MouseEvent' in window)) {\r\n        return false;\r\n    }\r\n    let mouseEvent;\r\n    try {\r\n        mouseEvent = new MouseEvent('mousemove'); // browsers not supporting the constructor don't have it\r\n    } catch (e) {\r\n        return false;\r\n    }\r\n    if (!('movementX' in mouseEvent)) {\r\n        return false; // likely safari\r\n    }\r\n    return !isFirefox;\r\n})();\r\n\r\nexport const hasPointerEvents = !!window.PointerEvent;\r\n\r\nexport const hasWebGl = (function() {\r\n\r\n    const hasWebgl = (function() {\r\n        const canvas = createCanvas();\r\n        try {\r\n            canvas.getContext('experimental-webgl', { premultipliedAlpha: false });\r\n            return true;\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    })();\r\n\r\n    return function() {\r\n        return hasWebgl;\r\n    }\r\n})();\r\n\r\nexport const getVisitor = (function () {\r\n    const visitor = {\r\n        chrome: false,\r\n        gl: false\r\n    };\r\n    //Chrome\r\n    if ((window as any).chrome && (window as any).chrome.app) {\r\n        visitor.chrome = true;\r\n    }\r\n    //WebGL\r\n    visitor.gl = hasWebGl();\r\n    return function () {\r\n        return JSON.parse(JSON.stringify(visitor));\r\n    }\r\n})();\r\n\r\nexport const isCssMinMaxSupported = (function() {\r\n    let result: boolean | null = null;\r\n\r\n    function test() {\r\n        const div = document.createElement('div');\r\n        div.style.position = 'absolute';\r\n        div.style.top = '0';\r\n        div.style.left = 'max(0px, 25px)';\r\n        document.body.appendChild(div);\r\n        setTimeout(function() {\r\n            result = div.offsetLeft === 25;\r\n            document.body.removeChild(div);\r\n        }, 25);\r\n    }\r\n\r\n    if (document.body) {\r\n        test();\r\n    } else {\r\n        window.addEventListener('DOMContentLoaded', function() {\r\n            test();\r\n        });\r\n    }\r\n\r\n    return function(): boolean {\r\n        if (result === null) {\r\n            throw new Error('isCssMinMaxSupported not initialized');\r\n        }\r\n        return result;\r\n    };\r\n})();\r\n\r\nexport const canShareFiles = function(): boolean {\r\n    return 'share' in navigator && 'canShare' in navigator;\r\n};","/*window['canvases'] = [];\r\n\r\nwindow['printCanvases'] = () => {\r\n    let total = 0;\r\n\r\n    console.log(window['canvases'].map(item => {\r\n        total += item.width * item.height;\r\n        return {w: item.width, h: item.height};\r\n    }));\r\n\r\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\r\n};*/\r\n\r\nexport function createCanvas(w?: number, h?: number): HTMLCanvasElement {\r\n    const result = document.createElement('canvas');\r\n    if (w && h) {\r\n        result.width = w;\r\n        result.height = h;\r\n    }\r\n    // window['canvases'].push(result);\r\n    return result;\r\n}","import {IKeyString, ISize2D, ISVG, IVector2D} from '../BB.types';\r\n\r\nexport function insertAfter (referenceNode: Element, newNode: Element): void {\r\n    if (referenceNode.parentNode) {\r\n        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\r\n    }\r\n}\r\n\r\nexport function loadImage (im: HTMLImageElement, callback: () => void): void {\r\n    let counter = 0;\r\n\r\n    function check() {\r\n        if (counter === 1000) {\r\n            alert(\"couldn't load\");\r\n            return;\r\n        }\r\n        if (im.complete) {\r\n            counter++;\r\n            callback();\r\n        } else {\r\n            setTimeout(check, 1);\r\n        }\r\n    }\r\n\r\n    check();\r\n}\r\n\r\nexport function css (el: HTMLElement | SVGElement, styleObj: IKeyString): void {\r\n    const keyArr = Object.keys(styleObj);\r\n    let keyStr: string;\r\n    const style = (el.style as unknown) as IKeyString;\r\n    for (let i = 0; i < keyArr.length; i++) {\r\n        keyStr = keyArr[i];\r\n        style[keyStr] = styleObj[keyStr];\r\n        style.alignContent = 'true';\r\n        if (keyStr === 'userSelect') {\r\n            style.webkitUserSelect = styleObj[keyStr]; // safari\r\n        }\r\n    }\r\n}\r\n\r\nexport function setAttributes (el: HTMLElement, attrObj: IKeyString): void {\r\n    const keyArr = Object.keys(attrObj);\r\n    let keyStr;\r\n    for (let i = 0; i < keyArr.length; i++) {\r\n        keyStr = keyArr[i];\r\n        el.setAttribute(keyStr, attrObj[keyStr]);\r\n    }\r\n}\r\n\r\n/**\r\n * appendChild with an array\r\n * @param target\r\n * @param els\r\n */\r\nexport function append(target: HTMLElement, els: (HTMLElement | string | null)[]) {\r\n    const fragment = document.createDocumentFragment();\r\n    els.forEach(item => item ? fragment.append(item) : null);\r\n    target.append(fragment);\r\n}\r\n\r\n/**\r\n * a needs to fit into b\r\n * @param aw\r\n * @param ah\r\n * @param bw\r\n * @param bh\r\n * @param min\r\n */\r\nexport function fitInto (aw: number, ah: number, bw: number, bh: number, min?: number): ISize2D {\r\n    let width = aw * bw, height = ah * bw;\r\n    if (width > bw) {\r\n        height = bw / width * height;\r\n        width = bw;\r\n    }\r\n    if (height > bh) {\r\n        width = bh / height * width;\r\n        height = bh;\r\n    }\r\n    if (min) {\r\n        width = Math.max(min, width);\r\n        height = Math.max(min, height);\r\n    }\r\n    return {width, height};\r\n}\r\n\r\n/**\r\n * center b in a\r\n * @param aw\r\n * @param ah\r\n * @param bw\r\n * @param bh\r\n */\r\nexport function centerWithin (aw: number, ah: number, bw: number, bh: number): IVector2D {\r\n    return {\r\n        x: aw / 2 - bw / 2,\r\n        y: ah / 2 - bh / 2\r\n    };\r\n}\r\n\r\nexport function getDate (): string {\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\r\n    const day = date.getDate().toString().padStart(2, '0');\r\n    const minutes = (date.getHours() * 60 + date.getMinutes()).toString(36).padStart(3, '0');\r\n\r\n    return year + '_' + month + '_' + day + '_' + minutes + '_';\r\n}\r\n\r\nexport function gcd (a: number, b: number): number {\r\n    return b ? gcd(b, a % b) : a;\r\n}\r\n\r\nexport function reduce (numerator: number, denominator: number): [number, number] {\r\n    const g = gcd(numerator, denominator);\r\n    return [numerator / g, denominator / g];\r\n}\r\n\r\nexport function decToFraction (decimalNumber: number): [number, number] {\r\n    const len = decimalNumber.toString().length - 2;\r\n    const denominator = Math.pow(10, len);\r\n    const numerator = decimalNumber * denominator;\r\n    return reduce(numerator, denominator);\r\n}\r\n\r\n/**\r\n * blobObj isn't always a Blob, but rather an object, because Blob doesn't exist.\r\n * @param blobObj\r\n * @returns {string}\r\n */\r\nexport function imageBlobToUrl(blobObj: Blob): string {\r\n    if (!blobObj) {\r\n        throw new Error('blobObj is undefined or null');\r\n    }\r\n    if (window.Blob && blobObj instanceof Blob) {\r\n        return URL.createObjectURL(blobObj); // object url\r\n    } else if (blobObj.constructor.name === 'Object') {\r\n        const fauxBlob = (blobObj as unknown) as {type: string, encoding: string, data: string};\r\n        return 'data:' + fauxBlob.type + ';' + fauxBlob.encoding + ',' + fauxBlob.data; // data url\r\n    } else {\r\n        throw new Error('unknown blob format');\r\n    }\r\n}\r\n\r\nexport function dateDayDifference (dateA: string | Date, dateB: string | Date): number {\r\n    dateA = new Date(dateA);\r\n    dateB = new Date(dateB);\r\n    dateA.setHours(0, 0, 0, 0);\r\n    dateB.setHours(0, 0, 0, 0);\r\n    return (dateB.getTime() - dateA.getTime()) / (1000 * 60 * 60 * 24);\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\r\nexport function copyObj (obj: any): any {\r\n    return JSON.parse(JSON.stringify(obj));\r\n}\r\n\r\n/**\r\n * triggers Web Share API - share feature on mobile devices\r\n * Only works if they support file sharing - e.g. Safari can't do this yet\r\n * only call if BB.canShareFiles() -> true\r\n *\r\n * p = {\r\n *     canvas: Canvas,\r\n *     fileName: string,\r\n *     title: string\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function shareCanvas (p: {canvas: HTMLCanvasElement, fileName:string, title: string, callback: () => void}): void {\r\n    const mimetype = 'image/png';\r\n    const err = () => alert('sharing not supported');\r\n    p.canvas.toBlob(function(blob) {\r\n        if (blob === null) {\r\n            err();\r\n            p.callback();\r\n            return;\r\n        }\r\n        try {\r\n            const filesArray = [new File([blob], p.fileName, {type: mimetype})];\r\n            navigator.share({\r\n                title: p.title,\r\n                files: filesArray,\r\n            } as any)\r\n                .then(r => {\r\n\r\n                })\r\n                .catch(e => {\r\n                    err();\r\n            });\r\n        } catch(e) {\r\n            err();\r\n        }\r\n        p.callback();\r\n    }, mimetype);\r\n}\r\n\r\n/**\r\n * Prevent ipad from zooming in when double tapping. iPadOS 13 bug.\r\n * Give it your click event\r\n *\r\n * @param clickEvent\r\n * @returns {boolean}\r\n */\r\nexport function handleClick (clickEvent: MouseEvent): boolean {\r\n    const target: HTMLElement | null = clickEvent.target as HTMLElement;\r\n    if (!target) {\r\n        return false;\r\n    }\r\n    if (['A', 'LABEL', 'INPUT'].includes(target.tagName) || (target as any).allowClick) {\r\n        return true;\r\n    }\r\n    clickEvent.preventDefault();\r\n    return false;\r\n}\r\n\r\n\r\n/**\r\n * @param el {elementType: string, childrenArr: []el, ...svg attributes...}\r\n * @returns svg element tree\r\n */\r\nexport function createSvg (el: ISVG): SVGElement {\r\n    const result = document.createElementNS('http://www.w3.org/2000/svg', el.elementType);\r\n    const keyArr = Object.keys(el);\r\n    let keyStr;\r\n    for (let i = 0; i < keyArr.length; i++) {\r\n        keyStr = keyArr[i];\r\n        if (keyStr === 'childrenArr') {\r\n            for (let e = 0; e < el.childrenArr.length; e++) {\r\n                result.appendChild(createSvg(el.childrenArr[e]));\r\n            }\r\n        } else if (keyStr !== 'elementType') {\r\n            result.setAttribute(keyStr, el[keyStr] as string);\r\n        }\r\n    }\r\n    return result;\r\n}","import {addEventListener, removeEventListener} from './event-listener';\r\n\r\n\r\nconst globalKey = (() => {\r\n\r\n    const keyStrToKeyObj = { // keyStr not to contain a '+', because that's used for the comboStr\r\n        'space': [' ', 'Spacebar'], // Spacebar in IE\r\n        'alt': ['Alt', 'AltGraph'],\r\n        'shift': 'Shift',\r\n        'ctrl': 'Control',\r\n        'cmd': ['Meta', 'MetaLeft', 'MetaRight'],\r\n        'enter': 'Enter',\r\n        'esc': 'Escape',\r\n        'backspace': 'Backspace',\r\n        'delete': 'Delete',\r\n        'sqbr_open': '[',\r\n        'sqbr_close': ']',\r\n        'a': ['a', 'A'],\r\n        'b': ['b', 'B'],\r\n        'c': ['c', 'C'],\r\n        'e': ['e', 'E'],\r\n        'f': ['f', 'F'],\r\n        'g': ['g', 'G'],\r\n        'r': ['r', 'R'], // when holding shift\r\n        's': ['s', 'S'],\r\n        't': ['t', 'T'],\r\n        'u': ['u', 'U'],\r\n        'x': ['x', 'X'],\r\n        'y': ['y', 'Y'],\r\n        'z': ['z', 'Z'],\r\n        'plus': '+',\r\n        'minus': '-',\r\n        'left': 'ArrowLeft',\r\n        'right': 'ArrowRight',\r\n        'up': 'ArrowUp',\r\n        'down': 'ArrowDown',\r\n        'home': 'Home',\r\n        'end': 'End'\r\n    };\r\n    const keyToKeyStrArr = Object.keys(keyStrToKeyObj);\r\n    const isDownObj = {};\r\n    const keyToKeyStrObj = {}; // event.key to keyStr { ArrowLeft: 'left', ... }\r\n    let comboArr = [];\r\n    //a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\r\n    let codeIsDownObj = {}; // { KeyE: 'e', KeyF: null } - null not down, string, the associated keyStr\r\n    const listenerArr = [];\r\n\r\n    for (let i = 0; i < keyToKeyStrArr.length; i++) {\r\n        isDownObj[keyToKeyStrArr[i]] = false;\r\n\r\n        const code = keyStrToKeyObj[keyToKeyStrArr[i]];\r\n        if (typeof code === 'string') {\r\n            keyToKeyStrObj[keyStrToKeyObj[keyToKeyStrArr[i]]] = keyToKeyStrArr[i];\r\n        } else {\r\n            for (let e = 0; e < code.length; e++) {\r\n                keyToKeyStrObj[code[e]] = keyToKeyStrArr[i];\r\n            }\r\n        }\r\n    }\r\n\r\n    function emitDown(a, b, c, d?) {\r\n        listenerArr.forEach(item => {\r\n            if (!item[0]) {\r\n                return;\r\n            }\r\n            item[0](a, b, c, d);\r\n        });\r\n    }\r\n\r\n    function emitUp(a, b, c) {\r\n        listenerArr.forEach(item => {\r\n            if (!item[1]) {\r\n                return;\r\n            }\r\n            item[1](a, b, c);\r\n        });\r\n    }\r\n\r\n    function emitBlur() {\r\n        listenerArr.forEach(item => {\r\n            if (!item[2]) {\r\n                return;\r\n            }\r\n            item[2]();\r\n        });\r\n    }\r\n\r\n    function keyDown(e) {\r\n        const key = e.key;\r\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\r\n\r\n        if (key in keyToKeyStrObj) {\r\n            const keyStr = keyToKeyStrObj[key];\r\n            if (isDownObj[keyStr]) {\r\n                emitDown(keyStr, e, comboArr.join('+'), true);\r\n                return;\r\n            }\r\n            isDownObj[keyStr] = true;\r\n            codeIsDownObj[code] = keyStr;\r\n\r\n            //add to combo\r\n            comboArr.push(keyStr);\r\n\r\n            emitDown(keyStr, e, comboArr.join('+'));\r\n        }\r\n    }\r\n\r\n\r\n    function keyUp(e) {\r\n        const key = e.key;\r\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\r\n        const oldComboStr = comboArr.join('+');\r\n\r\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\r\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\r\n        if ([\r\n            'Meta', 'MetaLeft', 'MetaRight',\r\n            'OSLeft', 'OSRight', // Firefox\r\n        ].includes(code)) {\r\n            blur(null);\r\n            return;\r\n        }\r\n\r\n        if (code in codeIsDownObj && codeIsDownObj[code] !== null) {\r\n            const keyStr = codeIsDownObj[code];\r\n            isDownObj[keyStr] = false;\r\n            codeIsDownObj[code] = null;\r\n\r\n            //remove from combo\r\n            for (let i = 0; i < comboArr.length; i++) {\r\n                if (comboArr[i] == keyStr) {\r\n                    comboArr.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n\r\n            emitUp(keyStr, e, oldComboStr);\r\n        }\r\n    }\r\n\r\n    function blur(event) {\r\n        const oldComboStr = comboArr.join('+');\r\n        comboArr = [];\r\n        codeIsDownObj = {};\r\n\r\n        const eventArr = [];\r\n        for (let i = 0; i < keyToKeyStrArr.length; i++) {\r\n            if (isDownObj[keyToKeyStrArr[i]]) {\r\n                isDownObj[keyToKeyStrArr[i]] = false;\r\n                eventArr.push(keyToKeyStrArr[i]);\r\n            }\r\n        }\r\n        for (let i = 0; i < eventArr.length; i++) {\r\n            emitUp(\r\n                eventArr[i],\r\n                {\r\n                    preventDefault: function () {},\r\n                    stopPropagation: function () {},\r\n                },\r\n                oldComboStr,\r\n            );\r\n        }\r\n        emitBlur();\r\n    }\r\n\r\n\r\n\r\n    return {\r\n        add: (keyListener) => {\r\n            if (listenerArr.includes(keyListener)) {\r\n                return;\r\n            }\r\n            const first = listenerArr.length === 0;\r\n            listenerArr.push(keyListener);\r\n\r\n            if (first) {\r\n                addEventListener(document, 'keydown', keyDown);\r\n                addEventListener(document, 'keyup', keyUp);\r\n                addEventListener(window, 'blur', blur);\r\n            }\r\n        },\r\n        remove: (keyListener) => {\r\n            if (!listenerArr.includes(keyListener)) {\r\n                return;\r\n            }\r\n            const last = listenerArr.length === 1;\r\n            for (let i = 0; i < listenerArr.length; i++) {\r\n                if (listenerArr[i] === keyListener) {\r\n                    listenerArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n            if (last) {\r\n                removeEventListener(document, 'keydown', keyDown);\r\n                removeEventListener(document, 'keyup', keyUp);\r\n                removeEventListener(window, 'blur', blur);\r\n            }\r\n        },\r\n        getIsDown: () => {\r\n            return isDownObj;\r\n        },\r\n        getCombo: () => {\r\n            return comboArr;\r\n        },\r\n    };\r\n})();\r\n\r\n\r\n\r\n/**\r\n * Listens to key events in window. Makes combos easier - e.g. ctrl + z\r\n *\r\n * keyStr - see in implementation - my representation of a key. e.g. 'r' can be 'r' and 'R'\r\n * comboStr - string joins currently pressed keyStr with a +\r\n *              e.g. 'ctrl+z'\r\n *\r\n */\r\nexport class KeyListener {\r\n\r\n    private readonly onDown;\r\n    private readonly onUp;\r\n    private readonly onBlur;\r\n    private readonly ref;\r\n\r\n    constructor (\r\n        p: {\r\n            onDown?: (keyStr: string, e: KeyboardEvent, comboStr: string, isRepeat?: boolean) => void;\r\n            onUp?: (keyStr: string, e: KeyboardEvent, oldComboStr: string) => void;\r\n            onBlur?: () => void;\r\n        },\r\n    ) {\r\n        this.onDown = p.onDown;\r\n        this.onUp = p.onUp;\r\n        this.onBlur = p.onBlur;\r\n        this.ref = [this.onDown, this.onUp, this.onBlur];\r\n        globalKey.add(this.ref);\r\n    }\r\n\r\n    isPressed (keyStr: string): boolean {\r\n        if (!(keyStr in globalKey.getIsDown())) {\r\n            throw 'key \"' + keyStr + '\" not found';\r\n        }\r\n        return globalKey.getIsDown()[keyStr];\r\n    }\r\n\r\n    getComboStr (): string {\r\n        return globalKey.getCombo().join('+');\r\n    }\r\n\r\n    comboOnlyContains (keyStrArr: string[]): boolean {\r\n        for (let i = 0; i < globalKey.getCombo().length; i++) {\r\n            if (!keyStrArr.includes(globalKey.getCombo()[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    destroy (): void {\r\n        globalKey.remove(this.ref);\r\n    }\r\n}\r\n\r\nexport function sameKeys(comboAStr: string, comboBStr: string): boolean {\r\n    return comboAStr.split('+').sort().join('+')=== comboBStr.split('+').sort().join('+');\r\n}","import {addEventListener, removeEventListener} from './event-listener';\r\n\r\n\r\n/**\r\n * Filters wheel events. removes swipe scrolling and pinch scrolling that trackpads do. (as best as it can)\r\n * Normalizes regular scrolls.\r\n *\r\n * Why:\r\n * - trackpad scrolling is different from old school mouse scrolling\r\n * - but there is not way to learn from the browser if it's trackpad scrolling\r\n * - browsers don't even give access to the raw swiping or pinching movement, but some abstraction on top, making the scrolling\r\n *      continue an arbitrary amount, at an arbitrary scale\r\n * - each browser does this differently. So you can't offer a coherent experience\r\n *\r\n * - also trackpads are painful to draw with. So supporting a trackpad-based workflow makes not much sense.\r\n *\r\n * @param callback - func({deltaY: number, pageX: number, pageY: number, clientX: number, clientY: number}\r\n * @constructor\r\n */\r\nimport {eventUsesHighResTimeStamp, hasPointerEvents, isFirefox} from '../base/browser';\r\nimport {mix} from '../math/math';\r\n\r\nconst WheelCleaner = function (callback) {\r\n    const sequenceTimeoutMs = 200;\r\n\r\n    const knownUnitArr = [100];\r\n    let sequenceLength = 0;\r\n    let sequenceUnit = null;\r\n    let endSequenceTimeout;\r\n    let toEmitDelta = null;\r\n    let position = null;\r\n\r\n\r\n    function emit(delta) {\r\n        callback({\r\n            deltaY: Math.round(delta / sequenceUnit),\r\n            pageX: position.pageX,\r\n            pageY: position.pageY,\r\n            clientX: position.clientX,\r\n            clientY: position.clientY,\r\n        });\r\n    }\r\n\r\n    function endSequence() {\r\n        if (toEmitDelta !== null) {\r\n            emit(toEmitDelta);\r\n            toEmitDelta = null;\r\n        }\r\n        if (sequenceUnit !== null && !(knownUnitArr.includes(sequenceUnit))) {\r\n            knownUnitArr.push(sequenceUnit);\r\n        }\r\n        sequenceLength = 0;\r\n        sequenceUnit = null;\r\n    }\r\n\r\n    // --- interface ---\r\n    this.process = function (event) {\r\n\r\n        position = {\r\n            pageX: event.pageX,\r\n            pageY: event.pageY,\r\n            clientX: event.clientX,\r\n            clientY: event.clientY,\r\n        };\r\n\r\n        clearTimeout(endSequenceTimeout);\r\n        endSequenceTimeout = setTimeout(endSequence, sequenceTimeoutMs);\r\n\r\n        //prep delta\r\n        let delta = event.deltaY;\r\n        if ('deltaMode' in event && event.deltaMode === 1) {\r\n            delta *= 100 / 3;\r\n        }\r\n        const absDelta = Math.abs(delta);\r\n\r\n\r\n        if (sequenceLength > 0 && sequenceUnit === null) {\r\n            //previously determined dirty sequence\r\n            toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n        //sequence begins\r\n        if (sequenceLength === 0) {\r\n            sequenceLength++;\r\n            if (absDelta < 50) {\r\n                //dirty - probably a swipe scroll or pinch scroll on trackpad\r\n                return;\r\n            }\r\n\r\n            sequenceUnit = absDelta;\r\n            if (knownUnitArr.includes(sequenceUnit)) {\r\n                //we know this unit - emit right away\r\n                emit(delta);\r\n            } else {\r\n                //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\r\n                toEmitDelta = delta;\r\n            }\r\n            return;\r\n        }\r\n\r\n        //sequence continues\r\n        if (absDelta === 0) {\r\n            //ignore zero scroll\r\n            return;\r\n        }\r\n        if (\r\n            absDelta === sequenceUnit ||\r\n            (absDelta / sequenceUnit) % 1 < 0.0001// a multiple\r\n        ) {\r\n            //fine\r\n        } else if ((sequenceUnit / absDelta) % 1 < 0.0001) {\r\n            //unit was actually a multiple - update it\r\n            sequenceUnit = absDelta;\r\n\r\n        } else if (absDelta !== sequenceUnit) {\r\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\r\n            sequenceUnit = null;\r\n            toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n\r\n        if (toEmitDelta !== null) {\r\n            emit(toEmitDelta);\r\n            toEmitDelta = null;\r\n        }\r\n        emit(delta);\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * PointerListener - for pointer events, wheel events. uses fallbacks. ideally consistent behavior across browsers\r\n * Has some workarounds for browser specific bugs. As browsers get better, this constructor should get smaller\r\n *\r\n * p = {\r\n *     target: DOM element,\r\n *     onPointer: func (pointerEvent), //optional\r\n *     onWheel: func (wheelEvent), //optional\r\n *     onEnterLeave: func (isOver: boolean), //optional\r\n *     maxPointers: int (1 - n), //default is 1\r\n *     fixScribble: boolean, // fix ipad scribble issue\r\n * }\r\n *\r\n * pointerEvent = {\r\n *     type: 'pointerdown'|'pointermove'|'pointerup',\r\n *     pointerId: long,\r\n *     pointerType: 'touch'|'mouse'|'pen',\r\n *     pageX: number,\r\n *     pageY: number,\r\n *     clientX: number,\r\n *     clientY: number,\r\n *     relX: number, //position relative to top left of target\r\n *     relY: number,\r\n *     dX: number, //movementX not supported by safari on iOS, so need my own\r\n *     dY: number,\r\n *     downPageX: number, //where was pointer when down-event occurred - set for down|move|up\r\n *     downPageY: number,\r\n *     coalescedArr: Array of {\r\n *         pageX: number,\r\n *         pageY: number,\r\n *         clientX: number,\r\n *         clientY: number,\r\n *         relX: number, //position relative to top left of target\r\n *         relY: number,\r\n *         dX: number,\r\n *         dY: number,\r\n *         time: number// same timescale as performance.now() - might be exact same number as in parent\r\n *     },\r\n *     time: number, // same timescale as performance.now()\r\n *     button: 'left'|'middle'|'right',\r\n *     pressure: number (0-1), // always 1 for touch and mouse\r\n *     eventPreventDefault: function(),\r\n *     eventStopPropagation: function(),\r\n * }\r\n *\r\n * wheelEvent = {\r\n *     deltaY: number, // increments of 1\r\n *     pageX: number,\r\n *     pageY: number,\r\n *     relX: number,\r\n *     relY: number,\r\n * }\r\n *\r\n * isOver(): boolean - if pointer over the target\r\n *\r\n * @param p\r\n */\r\nexport const PointerListener = (function () {\r\n\r\n    //keeping track of pointers for movement fallback\r\n    const pointerArr = [];\r\n\r\n    function addPointer(event) {\r\n        const pointerObj = {\r\n            pointerId: event.pointerId,\r\n            lastPageX: null,\r\n            lastPageY: null\r\n        };\r\n        pointerArr.push(pointerObj);\r\n\r\n        if (pointerArr.length > 15) {\r\n            pointerArr.shift();\r\n        }\r\n\r\n        return pointerObj;\r\n    }\r\n\r\n    function getPointer(event) {\r\n        for (let i = pointerArr.length - 1; i >= 0; i--) {\r\n            if (event.pointerId === pointerArr[i].pointerId) {\r\n                return pointerArr[i];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    let pressureNormalizeAvgCount = 0;\r\n    let pressureNormalizeAvgPressure = null;\r\n    let pressureNormalizeIsComplete = false;\r\n    let pressureNormalizeFactor = 1;\r\n\r\n    return function (p) {\r\n        const targetElement = p.target;\r\n        const onPointerCallback = p.onPointer;\r\n        const onWheelCallback = p.onWheel;\r\n        const onEnterLeaveCallback = p.onEnterLeave;\r\n        const maxPointers = 'maxPointers' in p ? p.maxPointers : 1;\r\n        const buttonsToStr = { // translation\r\n            '1': 'left',\r\n            '2': 'right',\r\n            '4': 'middle'\r\n        };\r\n        const wheelCleaner = new WheelCleaner(function (wheelEvent) {\r\n            if (isDestroyed) {\r\n                return;\r\n            }\r\n            if (onWheelCallback) {\r\n                const bounds = targetElement.getBoundingClientRect();\r\n                wheelEvent.relX = wheelEvent.clientX - bounds.left + targetElement.scrollLeft;\r\n                wheelEvent.relY = wheelEvent.clientY - bounds.top + targetElement.scrollTop;\r\n                onWheelCallback(wheelEvent);\r\n            }\r\n        });\r\n        let isDestroyed = false;\r\n\r\n        const timeStampOffset = eventUsesHighResTimeStamp() ? 0 : -performance.timing.navigationStart;\r\n\r\n\r\n        //to circumvent a chrome input glitch\r\n        let lastPointerType = '';\r\n        let didSkip = false;\r\n\r\n\r\n        /*\r\n        pointers that are pressing a button\r\n        dragObj = {\r\n            pointerId: long,\r\n            pointerType: 'mouse'|'pen'|'touch',\r\n            downPageX: number, //where was pointer when down-event occurred\r\n            downPageY: number,\r\n            button: long,\r\n            lastPageX: number, //pageX in previous event - only for touch events, because they don't have movementX/Y\r\n            lastPageY: number,\r\n            lastTimeStamp: number\r\n        }\r\n         */\r\n        const dragObjArr = [];\r\n        const dragPointerIdArr = [];\r\n\r\n        function getDragObj(pointerId) {\r\n            for (let i = 0; i < dragObjArr.length; i++) {\r\n                if (pointerId === dragObjArr[i].pointerId) {\r\n                    return dragObjArr[i];\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        function removeDragObj(pointerId) {\r\n            let removedDragObj = null;\r\n            for (let i = 0; i < dragPointerIdArr.length; i++) {\r\n                if (dragPointerIdArr[i] === pointerId) {\r\n                    removedDragObj = dragObjArr[i];\r\n                    dragObjArr.splice(i, 1);\r\n                    dragPointerIdArr.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n            return removedDragObj;\r\n        }\r\n\r\n\r\n        function normalizePressure(pressure, type?) {\r\n            if (pressure === 0 || pressure === 1) {\r\n                return pressure;\r\n            }\r\n\r\n            // was this there to prevent some glitch?\r\n            /*if (pressureNormalizeIsComplete && type === 'pointerdown' && pressure !== 1) {\r\n                pressure *= 0.004;\r\n            }*/\r\n\r\n            if (pressureNormalizeAvgCount < 60) {\r\n                if (pressureNormalizeAvgCount === 0) {\r\n                    pressureNormalizeAvgPressure = pressure;\r\n                } else {\r\n                    pressureNormalizeAvgPressure = mix(pressure, pressureNormalizeAvgPressure, 0.95);\r\n                }\r\n                pressureNormalizeAvgCount++;\r\n            } else if (!pressureNormalizeIsComplete) {\r\n                pressureNormalizeIsComplete = true;\r\n                //BB.throwOut('avg pressure decision!' + pressureNormalizeAvgPressure);\r\n                if (pressureNormalizeAvgPressure < 0.13) { // absurd pressure needed\r\n                    pressureNormalizeFactor = 2.3;\r\n                }\r\n            }\r\n\r\n\r\n            return Math.pow(pressure, 1 / pressureNormalizeFactor);\r\n        }\r\n\r\n\r\n        /**\r\n         *\r\n         * More trustworthy pointer attributes. that behave the same across browsers.\r\n         * returns a new object. this object also gets attached to the orig event. -> event.corrected\r\n         *\r\n         * @param event\r\n         * @returns {{pointerId: number, timeStamp: number, button, buttons, pointerType: (string|string|any), movementY: number, movementX: number, pressure, coalescedArr: [], pageY, pageX, clientX, clientY, eventPreventDefault: func, eventStopPropagation: func}\r\n         */\r\n        function correctPointerEvent(event) {\r\n            if (event.corrected) {\r\n                return event.corrected;\r\n            }\r\n\r\n            /*if (event.type === 'pointermove' && !window.hidePressureOut) {\r\n                if (event.type === 'pointermove') {\r\n                    BB.throwOut(event.pressure + ' ' + event.pointerType);\r\n                }\r\n            }*/\r\n\r\n            const correctedObj = {\r\n                pointerId: event.pointerId,\r\n                pointerType: event.pointerType,\r\n                pageX: event.pageX,\r\n                pageY: event.pageY,\r\n                clientX: event.clientX,\r\n                clientY: event.clientY,\r\n                movementX: event.movementX,\r\n                movementY: event.movementY,\r\n                timeStamp: event.timeStamp + timeStampOffset,\r\n                pressure: normalizePressure(event.pressure, event.type),\r\n                buttons: event.buttons,\r\n                button: event.button,\r\n                coalescedArr: [],\r\n                eventPreventDefault: function () {\r\n                    event.preventDefault();\r\n                },\r\n                eventStopPropagation: function () {\r\n                    event.stopPropagation();\r\n                }\r\n            };\r\n            event.corrected = correctedObj;\r\n\r\n            let customPressure = null;\r\n            if ('pointerId' in event) {\r\n                if ('pressure' in event && event.buttons !== 0 && (['mouse'].includes(event.pointerType) || (event.pointerType === 'touch' && event.pressure === 0))) {\r\n                    correctedObj.pressure = 1;\r\n                    customPressure = 1;\r\n                }\r\n            } else {\r\n                correctedObj.pointerId = 0;\r\n                correctedObj.pointerType = 'mouse';\r\n                correctedObj.pressure = event.buttons !== 0 ? 1 : 0;\r\n                customPressure = correctedObj.pressure;\r\n            }\r\n\r\n            if (isFirefox && event.pointerType != 'mouse' && event.type === 'pointermove' && event.buttons === 0) { // once again firefox\r\n                correctedObj.buttons = 1; //todo wrong if no buttons actually pressed\r\n            }\r\n\r\n            let coalescedEventArr = [];\r\n            if ('getCoalescedEvents' in event) {\r\n                coalescedEventArr = event.getCoalescedEvents();\r\n            }\r\n\r\n            // chrome somehow movementX not same scale as pageX. todo: only chrome?\r\n            // so make my own\r\n\r\n            let pointerObj = getPointer(correctedObj);\r\n            if (pointerObj === null) {\r\n                pointerObj = addPointer(correctedObj);\r\n            }\r\n\r\n            const totalLastX = pointerObj.lastPageX;\r\n            const totalLastY = pointerObj.lastPageY;\r\n\r\n            for (let i = 0; i < coalescedEventArr.length; i++) {\r\n                const eventItem = coalescedEventArr[i];\r\n\r\n                correctedObj.coalescedArr.push({\r\n                    pageX: eventItem.pageX,\r\n                    pageY: eventItem.pageY,\r\n                    clientX: eventItem.clientX,\r\n                    clientY: eventItem.clientY,\r\n                    movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\r\n                    movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\r\n                    timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : (eventItem.timeStamp + timeStampOffset), // 0 in firefox\r\n                    pressure: customPressure === null ? normalizePressure(eventItem.pressure) : customPressure\r\n                });\r\n\r\n                pointerObj.lastPageX = eventItem.pageX;\r\n                pointerObj.lastPageY = eventItem.pageY;\r\n            }\r\n\r\n            pointerObj.lastPageX = correctedObj.pageX;\r\n            pointerObj.lastPageY = correctedObj.pageY;\r\n            correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\r\n            correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\r\n\r\n            return correctedObj;\r\n\r\n        }\r\n\r\n        /**\r\n         * creates a value for onPointer, from a pointer event handler\r\n         *\r\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\r\n         * @param correctedEvent - corrected pointer event from correctPointerEvent()\r\n         * @param custom - object for setting custom attributes\r\n         * @returns {{pointerId: number, pointerType: *, dX: (*), relY: number, dY: (*), relX: number, type: *, event: *, pageY: *, pageX: *}}\r\n         */\r\n        function createPointerOutEvent(typeStr, correctedEvent, custom?) {\r\n\r\n            const bounds = targetElement.getBoundingClientRect();\r\n            const result: any = {\r\n                type: typeStr,\r\n                pointerId: correctedEvent.pointerId,\r\n                pointerType: correctedEvent.pointerType,\r\n                pageX: correctedEvent.pageX,\r\n                pageY: correctedEvent.pageY,\r\n                clientX: correctedEvent.clientX,\r\n                clientY: correctedEvent.clientY,\r\n                relX: correctedEvent.clientX - bounds.left + targetElement.scrollLeft,\r\n                relY: correctedEvent.clientY - bounds.top + targetElement.scrollTop,\r\n                dX: correctedEvent.movementX,\r\n                dY: correctedEvent.movementY,\r\n                time: correctedEvent.timeStamp,\r\n                eventPreventDefault: correctedEvent.eventPreventDefault,\r\n                eventStopPropagation: correctedEvent.eventStopPropagation\r\n            };\r\n\r\n            if (typeStr === 'pointermove') {\r\n                result.coalescedArr = [];\r\n                if (correctedEvent.coalescedArr.length > 1) {\r\n                    let coalescedItem;\r\n                    for (let i = 0; i < correctedEvent.coalescedArr.length; i++) {\r\n                        coalescedItem = correctedEvent.coalescedArr[i];\r\n                        result.coalescedArr.push({\r\n                            pageX: coalescedItem.pageX,\r\n                            pageY: coalescedItem.pageY,\r\n                            clientX: coalescedItem.clientX,\r\n                            clientY: coalescedItem.clientY,\r\n                            relX: coalescedItem.clientX - bounds.left + targetElement.scrollLeft,\r\n                            relY: coalescedItem.clientY - bounds.top + targetElement.scrollTop,\r\n                            dX: coalescedItem.movementX,\r\n                            dY: coalescedItem.movementY,\r\n                            time: coalescedItem.timeStamp\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (custom) {\r\n                const keyArr = Object.keys(custom);\r\n                for (let i = 0; i < keyArr.length; i++) {\r\n                    result[keyArr[i]] = custom[keyArr[i]];\r\n                }\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        /**\r\n         * creates a value for onPointer, from a fallback touch event handler\r\n         *\r\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\r\n         * @param touchListItem - element from changed touch list\r\n         * @param touchEvent - touch event\r\n         * @param custom - object for setting custom attributes\r\n         * @returns {{pointerId: number, pointerType: string, relY: number, relX: number, type: *, event: *, pageY: *, pageX: *}}\r\n         */\r\n        function createTouchOutEvent(typeStr, touchListItem, touchEvent, custom) {\r\n            const bounds = targetElement.getBoundingClientRect();\r\n            const result: any = {\r\n                type: typeStr,\r\n                pointerId: touchListItem.identifier,\r\n                pointerType: 'touch',\r\n                pageX: touchListItem.pageX,\r\n                pageY: touchListItem.pageY,\r\n                clientX: touchListItem.clientX,\r\n                clientY: touchListItem.clientY,\r\n                relX: touchListItem.pageX - bounds.left + targetElement.scrollLeft,\r\n                relY: touchListItem.pageY - bounds.top + targetElement.scrollTop,\r\n                time: touchEvent.timeStamp + timeStampOffset,\r\n                eventPreventDefault: function() { touchEvent.preventDefault(); },\r\n                eventStopPropagation: function() { touchEvent.stopPropagation(); }\r\n            };\r\n\r\n            if (typeStr === 'pointermove') {\r\n                result.coalescedArr = [];\r\n            }\r\n\r\n            const keyArr = Object.keys(custom);\r\n            for (let i = 0; i < keyArr.length; i++) {\r\n                result[keyArr[i]] = custom[keyArr[i]];\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        function setupDocumentListeners() {\r\n            addEventListener(document, 'pointermove', onGlobalPointerMove);\r\n            addEventListener(document, 'pointerup', onGlobalPointerUp);\r\n            addEventListener(document, 'pointerleave', onGlobalPointerLeave);\r\n        }\r\n\r\n        function destroyDocumentListeners() {\r\n            removeEventListener(document, 'pointermove', onGlobalPointerMove);\r\n            removeEventListener(document, 'pointerup', onGlobalPointerUp);\r\n            removeEventListener(document, 'pointerleave', onGlobalPointerLeave);\r\n        }\r\n\r\n        let isOverCounter = 0; // might be multiple pointers\r\n        function onPointerEnter() {\r\n            isOverCounter++;\r\n            if (onEnterLeaveCallback) {\r\n                onEnterLeaveCallback(true);\r\n            }\r\n        }\r\n\r\n        function onPointerLeave() {\r\n            isOverCounter--;\r\n            if (onEnterLeaveCallback) {\r\n                onEnterLeaveCallback(false);\r\n            }\r\n        }\r\n\r\n        function onPointermove(event) {\r\n            event = correctPointerEvent(event);\r\n\r\n            const tempLastPointerType = lastPointerType;\r\n            lastPointerType = event.pointerType;\r\n\r\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || event.pointerType === 'touch') {\r\n                didSkip = false;\r\n                return;\r\n            }\r\n\r\n            // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\r\n            if (!didSkip && event.pointerType === 'mouse' && tempLastPointerType === 'pen') {\r\n                didSkip = true;\r\n                return;\r\n            }\r\n            didSkip = false;\r\n\r\n            const outEvent = createPointerOutEvent('pointermove', event);\r\n            onPointerCallback(outEvent);\r\n\r\n        }\r\n\r\n        function onPointerdown(event) {\r\n            //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' pointerdown');\r\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || !([1, 2, 4].includes(event.buttons))) {\r\n                //BB.throwOut('pointerdown ignored');\r\n                return;\r\n            }\r\n\r\n\r\n            //set up global listeners\r\n            if (dragObjArr.length === 0) {\r\n                setupDocumentListeners();\r\n            }\r\n            const dragObj = {\r\n                pointerId: event.pointerId,\r\n                pointerType: event.pointerType,\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY,\r\n                buttons: event.buttons,\r\n                lastPageX: event.pageX,\r\n                lastPageY: event.pageY,\r\n                lastTimeStamp: event.timeStamp\r\n            };\r\n            dragObjArr.push(dragObj);\r\n            setTouchTimeout(dragObj);\r\n            dragPointerIdArr.push(event.pointerId);\r\n\r\n            const outEvent = createPointerOutEvent('pointerdown', event, {\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY,\r\n                button: buttonsToStr[event.buttons],\r\n                pressure: event.pressure\r\n            });\r\n\r\n            onPointerCallback(outEvent);\r\n        }\r\n\r\n\r\n        function onGlobalPointerMove(event) {\r\n            //BB.throwOut('pointermove ' + event.pointerId);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\r\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\r\n                return;\r\n            }\r\n\r\n            const dragObj = getDragObj(event.pointerId);\r\n            clearTouchTimeout(dragObj);\r\n\r\n            //if pointer changes button its pressing -> turn into pointerup\r\n            if (event.buttons !== dragObj.buttons) {\r\n                //pointer up\r\n\r\n                //remove listener\r\n                if (dragObjArr.length === 1) {\r\n                    destroyDocumentListeners();\r\n                }\r\n                removeDragObj(event.pointerId);\r\n\r\n                const outEvent = createPointerOutEvent('pointerup', event, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY\r\n                });\r\n                onPointerCallback(outEvent);\r\n                return;\r\n\r\n            }\r\n\r\n            setTouchTimeout(dragObj);\r\n\r\n            // ipad likes to do this\r\n            if (\r\n                event.pointerType === 'pen' &&\r\n                event.pageX === dragObj.lastPageX &&\r\n                event.pageY === dragObj.lastPageY &&\r\n                event.timeStamp === dragObj.lastTimeStamp\r\n            ) {\r\n                //ignore\r\n                return;\r\n            }\r\n\r\n            const outEvent = createPointerOutEvent('pointermove', event, {\r\n                downPageX: dragObj.downPageX,\r\n                downPageY: dragObj.downPageY,\r\n                button: buttonsToStr[event.buttons],\r\n                pressure: event.pressure\r\n            });\r\n\r\n            dragObj.lastPageX = event.pageX;\r\n            dragObj.lastPageY = event.pageY;\r\n            dragObj.lastTimeStamp = event.timeStamp;\r\n\r\n            onPointerCallback(outEvent);\r\n\r\n        }\r\n\r\n        function onGlobalPointerUp(event) {\r\n            //BB.throwOut('pointerup ' + event.pointerId);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\r\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\r\n                return;\r\n            }\r\n\r\n            //remove listener\r\n            if (dragObjArr.length === 1) {\r\n                destroyDocumentListeners();\r\n            }\r\n            const dragObj = removeDragObj(event.pointerId);\r\n            clearTouchTimeout(dragObj);\r\n\r\n            const outEvent = createPointerOutEvent('pointerup', event, {\r\n                downPageX: dragObj.downPageX,\r\n                downPageY: dragObj.downPageY\r\n            });\r\n            onPointerCallback(outEvent);\r\n\r\n        }\r\n\r\n        function onGlobalPointerLeave(event) {\r\n            //BB.throwOut('pointerleave ' + event.pointerId);\r\n            event = correctPointerEvent(event);\r\n            ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\r\n            if (!(dragPointerIdArr.includes(event.pointerId))) { //} || event.target !== document) {\r\n                return;\r\n            }\r\n\r\n            //remove listener\r\n            if (dragObjArr.length === 1) {\r\n                destroyDocumentListeners();\r\n            }\r\n            const dragObj = removeDragObj(event.pointerId);\r\n            clearTouchTimeout(dragObj);\r\n\r\n            const outEvent = createPointerOutEvent('pointerup', event, {\r\n                downPageX: dragObj.downPageX,\r\n                downPageY: dragObj.downPageY\r\n            });\r\n            onPointerCallback(outEvent);\r\n        }\r\n\r\n\r\n        /*\r\n        --- ipad pointer event glitch damage control ---\r\n\r\n        ipad pointer events are glitchy. doesn't always fire pointerup.\r\n        - when two fingers get really close to each other\r\n        - when finger moves out and back in bottom\r\n\r\n        This artificially fires a pointerup\r\n        */\r\n        function onTouchTimeout(dragObj) {\r\n\r\n            //create fake event\r\n            const fakeEvent = {\r\n                pointerId: dragObj.pointerId,\r\n                pointerType: dragObj.pointerType,\r\n                type: 'pointerup',\r\n                timeStamp: performance.now(),\r\n                pageX: 0,\r\n                pageY: 0,\r\n                clientX: 0,\r\n                clientY: 0,\r\n                preventDefault: function () {\r\n                },\r\n                stopPropagation: function () {\r\n                }\r\n            };\r\n\r\n            //call onGlobalPointerUp with it\r\n            onGlobalPointerUp(fakeEvent);\r\n        }\r\n\r\n        function setTouchTimeout(dragObj) {\r\n            if (dragObj.pointerType !== 'touch') {\r\n                return;\r\n            }\r\n            dragObj.touchTimeout = setTimeout(function () {\r\n                onTouchTimeout(dragObj);\r\n            }, 2500); // 2.5 seconds\r\n        }\r\n\r\n        function clearTouchTimeout(dragObj) {\r\n            if (!dragObj.touchTimeout) {\r\n                return;\r\n            }\r\n            clearTimeout(dragObj.touchTimeout);\r\n            dragObj.touchTimeout = null;\r\n        }\r\n\r\n\r\n        if (onEnterLeaveCallback) {\r\n            addEventListener(targetElement, 'pointerenter', onPointerEnter);\r\n            addEventListener(targetElement, 'pointerleave', onPointerLeave);\r\n        }\r\n        if (onPointerCallback) {\r\n            addEventListener(targetElement, 'pointermove', onPointermove);\r\n            addEventListener(targetElement, 'pointerdown', onPointerdown);\r\n        }\r\n        if (onWheelCallback) {\r\n            addEventListener(targetElement, 'wheel', wheelCleaner.process);\r\n        }\r\n\r\n\r\n        let onTouchstart;\r\n        let onTouchmove;\r\n        let onTouchend;\r\n\r\n        // --- touch fallback ---\r\n        if (!(hasPointerEvents)) {\r\n\r\n            onTouchstart = function (event) {\r\n                ////console.log('onTouchstart', event, event.changedTouches.length);\r\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\r\n\r\n                const touchArr = event.changedTouches;\r\n                for (let i = 0; i < touchArr.length && dragObjArr.length < maxPointers; i++) {\r\n                    const touchObj = touchArr[i];\r\n\r\n                    //set up global listeners\r\n                    if (dragObjArr.length === 0) {\r\n                        addEventListener(document, 'touchmove', onTouchmove);\r\n                        addEventListener(document, 'touchend', onTouchend);\r\n                        addEventListener(document, 'touchcancel', onTouchend);\r\n                    }\r\n                    dragObjArr.push({\r\n                        pointerId: touchObj.identifier,\r\n                        downPageX: touchObj.pageX,\r\n                        downPageY: touchObj.pageY,\r\n                        buttons: 1,\r\n                        lastPageX: touchObj.pageX,\r\n                        lastPageY: touchObj.pageY,\r\n                    });\r\n                    dragPointerIdArr.push(touchObj.identifier);\r\n\r\n                    const outEvent = createTouchOutEvent('pointerdown', touchObj, event, {\r\n                        dX: 0,\r\n                        dY: 0,\r\n                        downPageX: touchObj.downPageX,\r\n                        downPageY: touchObj.downPageY,\r\n                        button: 'left',\r\n                        pressure: 1\r\n                    });\r\n                    onPointerCallback(outEvent);\r\n                }\r\n\r\n            }\r\n\r\n            onTouchmove = function (event) {\r\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\r\n\r\n\r\n                const touchArr = event.changedTouches;\r\n                for (let i = 0; i < touchArr.length; i++) {\r\n                    const touchObj = touchArr[i];\r\n\r\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\r\n                        continue;\r\n                    }\r\n                    const dragObj = getDragObj(touchObj.identifier);\r\n\r\n                    const outEvent = createTouchOutEvent('pointermove', touchObj, event, {\r\n                        dX: touchObj.pageX - dragObj.lastPageX,\r\n                        dY: touchObj.pageY - dragObj.lastPageY,\r\n                        downPageX: dragObj.downPageX,\r\n                        downPageY: dragObj.downPageY,\r\n                        button: 'left',\r\n                        isCoalesced: false,\r\n                        pressure: 1\r\n                    });\r\n                    dragObj.lastPageX = touchObj.pageX;\r\n                    dragObj.lastPageY = touchObj.pageY;\r\n                    onPointerCallback(outEvent);\r\n\r\n                }\r\n\r\n            }\r\n\r\n            onTouchend = function (event) {\r\n                if (event.type !== 'touchcancel') {\r\n                    event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\r\n                }\r\n\r\n\r\n                const touchArr = event.changedTouches;\r\n                for (let i = 0; i < touchArr.length; i++) {\r\n                    const touchObj = touchArr[i];\r\n\r\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\r\n                        continue;\r\n                    }\r\n\r\n                    //remove listener\r\n                    if (dragObjArr.length === 1) {\r\n                        removeEventListener(document, 'touchmove', onTouchmove);\r\n                        removeEventListener(document, 'touchend', onTouchend);\r\n                        removeEventListener(document, 'touchcancel', onTouchend);\r\n                    }\r\n                    const dragObj = removeDragObj(touchObj.identifier);\r\n\r\n                    const outEvent = createTouchOutEvent('pointerup', touchObj, event, {\r\n                        dX: touchObj.pageX - dragObj.lastPageX,\r\n                        dY: touchObj.pageY - dragObj.lastPageY,\r\n                        downPageX: dragObj.downPageX,\r\n                        downPageY: dragObj.downPageY,\r\n                    });\r\n\r\n                    onPointerCallback(outEvent);\r\n                }\r\n\r\n            }\r\n\r\n            if (onPointerCallback) {\r\n                addEventListener(targetElement, 'touchstart', onTouchstart);\r\n            }\r\n\r\n        } else if (p.fixScribble) {\r\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\r\n            onTouchmove = function(e) {\r\n                e.preventDefault();\r\n            }\r\n            addEventListener(targetElement, 'touchmove', onTouchmove);\r\n\r\n        }\r\n\r\n\r\n        // --- interface ---\r\n\r\n        this.isOver = function () {\r\n            return isOverCounter > 0;\r\n        };\r\n\r\n        this.destroy = function () {\r\n            if (isDestroyed) {\r\n                return;\r\n            }\r\n            isDestroyed = true;\r\n            removeEventListener(targetElement, 'pointerenter', onPointerEnter);\r\n            removeEventListener(targetElement, 'pointerleave', onPointerLeave);\r\n            removeEventListener(targetElement, 'pointermove', onPointermove);\r\n            removeEventListener(targetElement, 'pointerdown', onPointerdown);\r\n            removeEventListener(targetElement, 'wheel', wheelCleaner.process);\r\n            if (dragObjArr.length > 0) {\r\n                destroyDocumentListeners();\r\n            }\r\n\r\n            if (!(hasPointerEvents)) {\r\n                removeEventListener(targetElement, 'touchstart', onTouchstart);\r\n                if (dragObjArr.length > 0) {\r\n                    removeEventListener(document, 'touchmove', onTouchmove);\r\n                    removeEventListener(document, 'touchend', onTouchend);\r\n                    removeEventListener(document, 'touchcancel', onTouchend);\r\n                }\r\n            } else {\r\n                removeEventListener(targetElement, 'touchmove', onTouchmove);\r\n            }\r\n        };\r\n\r\n    }\r\n})();","import {IBounds, IVector2D} from '../BB.types';\r\n\r\nexport function mix (a: number, b: number, f: number): number {\r\n    return a * (1 - f) + b * f;\r\n}\r\n\r\nexport function dist (ax: number, ay: number, bx: number, by: number): number {\r\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\r\n}\r\n\r\nexport function distSquared (ax: number, ay: number, bx: number, by: number): number {\r\n    // faster because no square-root\r\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\r\n}\r\n\r\nexport function lenSquared (x: number, y: number): number {\r\n    // faster because no square-root\r\n    return x * x + y * y;\r\n}\r\n\r\nexport function pointsToAngleRad (p1: IVector2D, p2: IVector2D): number {\r\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n}\r\n\r\nexport function pointsToAngleDeg (p1: IVector2D, p2: IVector2D): number {\r\n    return pointsToAngleRad(p1, p2) * 180 / Math.PI;\r\n}\r\n\r\nexport function clamp (num: number, min: number, max: number): number {\r\n    return num <= min\r\n        ? min\r\n        : num >= max\r\n            ? max\r\n            : num;\r\n}\r\n\r\nexport function rotate (x: number, y: number, deg: number): IVector2D {\r\n    const theta = deg * (Math.PI / 180);\r\n    const cs = Math.cos(theta);\r\n    const sn = Math.sin(theta);\r\n\r\n    return {\r\n        x: x * cs - y * sn,\r\n        y: x * sn + y * cs\r\n    };\r\n}\r\n\r\nexport function rotateAround (center: IVector2D, point: IVector2D, deg: number): IVector2D {\r\n    const rot = rotate(point.x - center.x, point.y - center.y, deg);\r\n    rot.x += center.x;\r\n    rot.y += center.y;\r\n    return rot;\r\n}\r\n\r\nexport function intDxy(remainder: IVector2D, fDx: number, fDy: number) {\r\n    remainder.x += fDx;\r\n    remainder.y += fDy;\r\n    const dX = Math.round(remainder.x);\r\n    const dY = Math.round(remainder.y);\r\n    remainder.x -= dX;\r\n    remainder.y -= dY;\r\n    return {\r\n        dX,\r\n        dY,\r\n    };\r\n}\r\n\r\n/**\r\n * return closest even number\r\n * @param f\r\n */\r\nexport function roundEven(f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f;\r\n        }\r\n        return f + 1;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 0) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * return closest uneven number\r\n * @param f\r\n */\r\nexport function roundUneven(f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f + 1;\r\n        }\r\n        return f;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 1) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * update target so it includes bounds\r\n * @param target\r\n * @param bounds\r\n */\r\nexport function updateBounds (target: IBounds, bounds: IBounds): IBounds {\r\n    if (!bounds) {\r\n        return target;\r\n    }\r\n    if (!target) {\r\n        target = { x1: bounds.x1, y1: bounds.y1, x2: bounds.x2, y2: bounds.y2 };\r\n    } else {\r\n        target.x1 = Math.min(target.x1, bounds.x1);\r\n        target.y1 = Math.min(target.y1, bounds.y1);\r\n        target.x2 = Math.max(target.x2, bounds.x2);\r\n        target.y2 = Math.max(target.y2, bounds.y2);\r\n    }\r\n    return target;\r\n}\r\n\r\n/**\r\n * determine overlap of bounds with width&height\r\n */\r\nexport function boundsInArea (bounds: IBounds, width: number, height: number): IBounds | null {\r\n    let x1 = Math.max(0, bounds.x1);\r\n    let y1 = Math.max(0, bounds.y1);\r\n    let x2 = Math.min(width - 1, bounds.x2);\r\n    let y2 = Math.min(height - 1, bounds.y2);\r\n    if (x1 > x2 || y1 > y2) {\r\n        return null;\r\n    }\r\n    return { x1, y1, x2, y2 };\r\n}","import {clamp, dist, mix, pointsToAngleRad} from '../math/math';\r\n\r\n\r\ntype ChainOutFunc = (event?) => void;\r\n\r\n/**\r\n * for chaining event processing. useful for gestures (double tap, pinch zoom, max pointer filter).\r\n * each element in the chain might hold back the events, swallow them, or transform them\r\n *\r\n * p = {\r\n *     chainArr: ChainElement[]\r\n * }\r\n *\r\n * chainIn(event): null - feed an event into the chain\r\n * setChainOut(func): void - func(event) <- called when passed through chain\r\n * ^ each ChainElement needs these methods too\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const EventChain = function (p) {\r\n\r\n    const chainArr = p.chainArr;\r\n    let chainOut: ChainOutFunc = () => undefined;\r\n\r\n    function continueChain(i, event) {\r\n        for (; i < chainArr.length; i++) {\r\n            event = chainArr[i].chainIn(event);\r\n            if (event === null) {\r\n                return null;\r\n            }\r\n        }\r\n        chainOut(event);\r\n        return null;\r\n    }\r\n\r\n    for (let i = 0; i < chainArr.length; i++) {\r\n        (function (i) {\r\n            chainArr[i].setChainOut(function (event) {\r\n                continueChain(i + 1, event);\r\n            });\r\n        })(i);\r\n    }\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n        return continueChain(0, event);\r\n    };\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Detects double taps.\r\n *\r\n * p = {\r\n *     onDoubleTap: function({pageX: number, pageY: number}) - fires when double tap occurs\r\n * }\r\n *\r\n * chainIn\r\n * setChainOut\r\n * setAllowedPointerTypeArr(string[]): void - which pointer types are allowed\r\n * setAllowedButtonArr(string[]): void - which buttons are allowed\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const DoubleTapper = function (p) {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n    const minSilenceBeforeDurationMs = 400;\r\n    const maxPressedDurationMs = 300;\r\n    const maxPressedDistancePx = 10;\r\n    const maxInbetweenDistancePx = 19;\r\n    const maxUpToUpDurationMs = 500;\r\n    const maxUntilSecondDownDurationMs = 300;\r\n    const minSilenceAfterMs = 250;\r\n\r\n    let allowedPointerTypeArr = ['touch', 'mouse', 'pen'];\r\n    let allowedButtonArr = ['left'];\r\n\r\n    let sequenceArr = [];\r\n    const pointersDownIdArr = [];\r\n    let lastUpTime = 0;\r\n    let nowTime = 0;\r\n\r\n    let eventQueueArr = [];\r\n\r\n\r\n    function fail() {\r\n        if (sequenceArr.length === 0) { // no gesture started -> can be ignored\r\n            return;\r\n        }\r\n        clearTimeout(timeoutObj.fail);\r\n        clearTimeout(timeoutObj.maxUntilSecondDown);\r\n        clearTimeout(timeoutObj.success);\r\n        timeoutObj.fail = null;\r\n        timeoutObj.maxUntilSecondDown = null;\r\n        timeoutObj.success = null;\r\n\r\n\r\n        for (let i = 0; i < eventQueueArr.length; i++) {\r\n            chainOut(eventQueueArr[i]);\r\n        }\r\n        eventQueueArr = [];\r\n\r\n        sequenceArr = [];\r\n    }\r\n\r\n    // double tap achieved\r\n    function success() {\r\n        timeoutObj.fail = null;\r\n        timeoutObj.success = null;\r\n        eventQueueArr = []; // events get swallowed\r\n        const lastSequenceItem = sequenceArr[sequenceArr.length - 1];\r\n        sequenceArr = [];\r\n        p.onDoubleTap({pageX: lastSequenceItem.pageX, pageY: lastSequenceItem.pageY});\r\n    }\r\n\r\n\r\n    const timeoutObj = {\r\n        fail: null,\r\n        maxUntilSecondDown: null,\r\n        success: null\r\n    };\r\n\r\n    //returns false if time already up. otherwise sets up timeout\r\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\r\n        const diff = timeMS - nowTime;\r\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\r\n        return true;\r\n    }\r\n\r\n\r\n    /**\r\n     * @param event object - a pointer event from BB.PointerListener\r\n     */\r\n    function processEvent(event) {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\r\n                if (pointersDownIdArr[i] === event.pointerId) {\r\n                    pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!allowedPointerTypeArr.includes(event.pointerType)) { //wrong input type -> fail\r\n            //console.log('wrong input type -> fail');\r\n            fail();\r\n            return;\r\n        }\r\n\r\n        nowTime = performance.now();\r\n        const lastSequenceItem = sequenceArr.length > 0 ? sequenceArr[sequenceArr.length - 1] : null;\r\n        if (event.type === 'pointerup') {\r\n            lastUpTime = event.time;\r\n        }\r\n\r\n        if (event.type === 'pointerdown') {\r\n            if (pointersDownIdArr.length > 1) { // more than one pointer down -> fail\r\n                //console.log('more than one pointer down -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (timeoutObj.success !== null) { // silence-after not achieved -> fail\r\n                //console.log('silence-after not achieved -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (sequenceArr.length === 0 && nowTime - lastUpTime < minSilenceBeforeDurationMs) { // silence before not achieved -> fail\r\n                //console.log('silence before not achieved -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (!allowedButtonArr.includes(event.button)) { // wrong button -> fail\r\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\r\n                fail();\r\n                return;\r\n            }\r\n            if (lastSequenceItem && lastSequenceItem.isDown || sequenceArr.length > 2) { // jumbled -> fail\r\n                //console.log('jumbled -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (lastSequenceItem) {\r\n                const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n                if (distance > maxInbetweenDistancePx) { //moved too much -> reset\r\n                    //console.log('maxInbetweenDistancePx -> reset');\r\n                    fail();\r\n\r\n                    if (nowTime - lastSequenceItem.time < minSilenceBeforeDurationMs) { //silence before not achieved -> fail\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            sequenceArr.push({\r\n                isDown: true,\r\n                time: nowTime,\r\n                position: [event.pageX, event.pageY],\r\n                pointerId: event.pointerId\r\n            });\r\n            //maxUntilSecondDown\r\n\r\n            if (sequenceArr.length > 1) {\r\n                clearTimeout(timeoutObj.maxUntilSecondDown);\r\n            } else if (!setupTimeout('maxUntilSecondDown', fail, event.time + maxUntilSecondDownDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n\r\n            clearTimeout(timeoutObj.fail);\r\n            if (!setupTimeout('fail', fail, event.time + maxPressedDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointermove' && lastSequenceItem.pointerId === event.pointerId) {\r\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                console.log('another pointer mixing in -> fail');\r\n                fail();\r\n                return;\r\n            }*/\r\n            const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n            if (distance > maxPressedDistancePx) { //moved too much -> fail\r\n                //console.log('maxPressedDistancePx -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointerup') {\r\n            if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                fail();\r\n                return;\r\n            }\r\n            if (nowTime >= lastSequenceItem.time + maxPressedDurationMs) { //pressed too long -> fail\r\n                fail();\r\n                return;\r\n            }\r\n            clearTimeout(timeoutObj.fail);\r\n\r\n            if (sequenceArr.length < 3) {\r\n                if (!setupTimeout('fail', fail, event.time + maxUpToUpDurationMs)) {\r\n                    fail();\r\n                    return;\r\n                }\r\n\r\n                sequenceArr = [\r\n                    lastSequenceItem,\r\n                    {\r\n                        isUp: true,\r\n                        time: nowTime,\r\n                        position: [event.pageX, event.pageY]\r\n                    }\r\n                ];\r\n                return;\r\n            }\r\n\r\n            if (nowTime < sequenceArr[1].time + maxUpToUpDurationMs) {\r\n                // double tap almost success\r\n                // only needs silence\r\n                sequenceArr.push({\r\n                    pageX: event.pageX,\r\n                    pageY: event.pageY\r\n                });\r\n                if (!setupTimeout('success', success, event.time + minSilenceAfterMs)) {\r\n                    fail();\r\n                }\r\n            } else { // time up -> fail\r\n                fail();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        processEvent(event);\r\n\r\n        if (sequenceArr.length === 0) { //existing events can not become a double tap\r\n            fail();\r\n            return event;\r\n        }\r\n        // events might become a double tap -> queue\r\n        eventQueueArr.push(event);\r\n        return null;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n\r\n    this.setAllowedPointerTypeArr = function (arr) {\r\n        allowedPointerTypeArr = arr;\r\n    };\r\n\r\n    this.setAllowedButtonArr = function (arr) {\r\n        allowedButtonArr = arr;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Detects a single tap, done with N 'touch' pointers\r\n *\r\n * p = {\r\n *      fingers: number - number of fingers\r\n *      onTap: function() - fires when tap occurs\r\n * }\r\n *\r\n * chainIn\r\n * setChainOut\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const NFingerTapper = function (p) {\r\n\r\n    const fingers = p.fingers;\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    const minSilenceBeforeDurationMs = 50; //250;\r\n    const maxTapMs = 500;\r\n    const maxFirstLastFingerDownMs = 250;\r\n    const maxPressedDistancePx = 12; //5 + fingers * 5;\r\n    const silenceAfterDurationMs = 250;\r\n\r\n\r\n    /*\r\n        fingerObj = {\r\n            pointerId: number,\r\n            downTime: number,\r\n            downPageX: number,\r\n            downPageY: number,\r\n            isUp: boolean\r\n        }\r\n     */\r\n    let fingerArr = [];\r\n    let firstDownTime;\r\n    let eventQueueArr = [];\r\n    let lastEventTime = 0;\r\n    const pointersDownIdArr = [];\r\n\r\n    function fail() {\r\n        if (eventQueueArr.length === 0) {\r\n            return;\r\n        }\r\n        clearTimeout(timeoutObj.firstLastDownTimeout);\r\n        clearTimeout(timeoutObj.tapTimeout);\r\n        for (let i = 0; i < eventQueueArr.length; i++) {\r\n            chainOut(eventQueueArr[i]);\r\n        }\r\n        eventQueueArr = [];\r\n        fingerArr = [];\r\n    }\r\n\r\n    function success() {\r\n        clearTimeout(timeoutObj.firstLastDownTimeout);\r\n        clearTimeout(timeoutObj.tapTimeout);\r\n        eventQueueArr = []; // events get swallowed\r\n        fingerArr = [];\r\n        p.onTap();\r\n    }\r\n\r\n    let nowTime;\r\n    const timeoutObj = {\r\n        firstLastDownTimeout: null,\r\n        tapTimeout: null\r\n    };\r\n\r\n    function setupTimeout(timeoutStr, timeMS) {\r\n        const diff = timeMS - nowTime;\r\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        timeoutObj[timeoutStr] = setTimeout(fail, diff);\r\n        return true;\r\n    }\r\n\r\n    function processEvent(event) {\r\n\r\n        const tempLastEventTime = lastEventTime;\r\n        lastEventTime = event.time;\r\n\r\n        if (event.type === 'pointerdown') {\r\n            pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\r\n                if (pointersDownIdArr[i] === event.pointerId) {\r\n                    pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (event.pointerType !== 'touch') {\r\n            if (fingerArr.length > 0) { // already in gesture -> fail\r\n                fail();\r\n            }\r\n            return;\r\n        }\r\n\r\n        nowTime = performance.now();\r\n\r\n        if (event.type === 'pointerdown') {\r\n            //console.log('down');\r\n            if (fingerArr.length + 1 !== pointersDownIdArr.length) { // failed before, and some fingers are still down -> fail\r\n                fail();\r\n                return;\r\n            }\r\n            if (fingerArr.length === fingers) { // too many fingers down -> fail\r\n                //console.log(fingers + ': too many fingers down -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (fingerArr.length > 0 && event.time - maxFirstLastFingerDownMs > fingerArr[0].downTime) { // took too long to touch with all fingers -> fail\r\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n            if (fingerArr.length === 0 && event.time - minSilenceBeforeDurationMs < tempLastEventTime) { // not enough silence before -> fail\r\n                //console.log(fingers + ': not enough silence before -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            if (fingerArr.length === 0) {\r\n                firstDownTime = event.time;\r\n\r\n                if (!setupTimeout('firstLastDownTimeout', event.time + maxFirstLastFingerDownMs) || !setupTimeout('tapTimeout', event.time + maxTapMs)) { // timeouts already up -> fail\r\n                    fail();\r\n                    return;\r\n                }\r\n\r\n            }\r\n            fingerArr.push({\r\n                pointerId: event.pointerId,\r\n                downTime: event.time,\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY\r\n            });\r\n            return;\r\n\r\n        }\r\n\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            for (let i = 0; i < fingerArr.length; i++) {\r\n                if (fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) { // finger not part of the tap is on screen -> fail\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\r\n                fail();\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'pointerup') {\r\n\r\n            if (fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            //console.log('up', event.pageX, event.pageY);\r\n            if (fingerArr.length !== fingers) { // not enough fingers -> fail\r\n                //console.log(fingers + ': not enough fingers -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            let i = 0;\r\n            for (; i < fingerArr.length; i++) {\r\n                if (fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) {\r\n                //do nothing\r\n                return;\r\n            }\r\n\r\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\r\n                //console.log(fingerArr);\r\n                fail();\r\n                return;\r\n            }\r\n\r\n            fingerObj.isUp = true;\r\n\r\n            let allAreUp = true;\r\n            for (let i = 0; i < fingerArr.length; i++) {\r\n                if (!fingerArr[i].isUp) {\r\n                    allAreUp = false;\r\n                    break;\r\n                }\r\n            }\r\n            //console.log('fingerArr', fingerArr);\r\n\r\n            if (allAreUp) { // success\r\n                success();\r\n                return true;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        const result = processEvent(event);\r\n\r\n        //console.log(fingerArr.length);\r\n\r\n        if (result === true) {\r\n            //tap success -> event gets swallowed\r\n            return null;\r\n        }\r\n        if (fingerArr.length === 0) {\r\n            return event;\r\n        } else {\r\n            eventQueueArr.push(event);\r\n        }\r\n\r\n        return null;\r\n\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Detects a pinch zooming (2 touch pointers). If one finger lifts, then will use the remaining.\r\n * Further pointers are ignored, but their events get swallowed during the pinching.\r\n * pinching ends when ALL pointers are lifted.\r\n * Events passed through if no pinching.\r\n *\r\n * p = {\r\n *      onPinch: function({type: 'end'} | {\r\n *          type: 'move',\r\n *          relX: number,\r\n *          relY: number,\r\n *          downRelX: number,\r\n *          downRelY: number,\r\n *          angleDeg: number,\r\n *          scale: number\r\n *      }) - fires when pinching occurs\r\n * }\r\n *\r\n * chainIn\r\n * setChainOut\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const PinchZoomer = function (p) {\r\n\r\n    const firstFingerMaxDistancePx = 10;\r\n    const untilSecondFingerDurationMs = 250;\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n    const pointersDownIdArr = [];\r\n    /*\r\n    gestureObj = {\r\n        touchPointerArr: Array of {\r\n            pointerId: number,\r\n            relX: number,\r\n            relY: number,\r\n            downRelX: number, // only for first\r\n            downRelY: number\r\n        },\r\n        otherPointerIdArr: number[],\r\n        isInProgress: boolean\r\n    }\r\n    */\r\n    let gestureObj = null;\r\n    let eventQueueArr = [];\r\n\r\n\r\n    function end() {\r\n        gestureObj = null;\r\n        eventQueueArr = [];\r\n    }\r\n\r\n    function fail(doSwallow?) {\r\n        if (!gestureObj) { // no gesture happening -> ignore\r\n            return;\r\n        }\r\n\r\n        clearTimeout(timeoutObj.secondFingerTimeout);\r\n        if (!doSwallow) {\r\n            for (let i = 0; i < eventQueueArr.length; i++) {\r\n                chainOut(eventQueueArr[i]);\r\n            }\r\n        }\r\n        end();\r\n    }\r\n\r\n\r\n    let nowTime;\r\n    const timeoutObj = {\r\n        secondFingerTimeout: null\r\n    };\r\n\r\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\r\n        const diff = timeMS - nowTime;\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\r\n        return true;\r\n    }\r\n\r\n\r\n    function processEvent(event) {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            pointersDownIdArr.push(event.pointerId);\r\n\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\r\n                if (pointersDownIdArr[i] === event.pointerId) {\r\n                    pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        //pass through scenarios\r\n        if (\r\n            !gestureObj && (\r\n                event.pointerType !== 'touch' || // wrong pointer type\r\n                (event.type === 'pointermove' && pointersDownIdArr.length > 0) || // failed before\r\n                pointersDownIdArr.length > 1 || // failed before\r\n                event.type === 'pointerup' // failed before\r\n            )\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        nowTime = performance.now();\r\n\r\n\r\n        //pointer down\r\n        if (event.type === 'pointerdown') {\r\n\r\n            if (gestureObj) {\r\n                if (event.pointerType === 'touch') { // touch finger down - as nth pointer\r\n\r\n                    gestureObj.touchPointerArr.push({\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY\r\n                    });\r\n\r\n                    if (gestureObj.isInProgress) {\r\n                        continuePinch(gestureObj, {\r\n                            type: 'down',\r\n                            index: gestureObj.touchPointerArr.length - 1\r\n                        });\r\n                    } else {\r\n                        clearTimeout(timeoutObj.secondFingerTimeout);\r\n                        gestureObj.isInProgress = true;\r\n                        beginPinch(gestureObj);\r\n                    }\r\n                    return;\r\n\r\n                } else { // non-touch finger down - as nth pointer\r\n\r\n                    if (gestureObj.isInProgress) {\r\n                        gestureObj.otherPointerIdArr.push(event.pointerId);\r\n                    } else { // second pointer wrong type -> fail\r\n                        fail();\r\n                    }\r\n                    return;\r\n                }\r\n\r\n\r\n            } else {\r\n                // first finger down - can only be touch if no gestureObj\r\n                gestureObj = {\r\n                    touchPointerArr: [{\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY,\r\n                        downRelX: event.relX,\r\n                        downRelY: event.relY\r\n                    }],\r\n                    otherPointerIdArr: [],\r\n                    isInProgress: false\r\n                };\r\n                if (!setupTimeout('secondFingerTimeout', function () {\r\n                    fail();\r\n                }, event.time + untilSecondFingerDurationMs)) { // time ran out -> fail\r\n                    fail();\r\n                    return;\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n\r\n        //pointer move\r\n        if (event.type === 'pointermove' && event.pointerType === 'touch') {\r\n            //gesture object should always exist here\r\n\r\n            let touchPointerObj = null;\r\n            let i = 0;\r\n            for (; i < gestureObj.touchPointerArr.length; i++) {\r\n                if (event.pointerId === gestureObj.touchPointerArr[i].pointerId) {\r\n                    touchPointerObj = gestureObj.touchPointerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n\r\n            //null should not be possible\r\n\r\n            touchPointerObj.relX = event.relX;\r\n            touchPointerObj.relY = event.relY;\r\n\r\n            if (!gestureObj.isInProgress) { // only one finger down & pinching hasn't started\r\n                const distance = dist(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\r\n                if (distance > firstFingerMaxDistancePx) { // moved too much -> fail\r\n                    fail();\r\n                    return;\r\n                }\r\n\r\n            } else {\r\n                if (i < 2) { // only first two touches can affect pinching\r\n                    continuePinch(gestureObj, {\r\n                        type: 'move',\r\n                        index: i\r\n                    });\r\n                }\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n\r\n        //pointer up\r\n        if (event.type === 'pointerup') {\r\n            //gesture object should always exist here\r\n\r\n            if (event.pointerType === 'touch') {\r\n                let i = 0;\r\n                for (; i < gestureObj.touchPointerArr.length; i++) {\r\n                    if (gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\r\n                        gestureObj.touchPointerArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n                if (gestureObj.touchPointerArr.length > 0) {\r\n                    continuePinch(gestureObj, {\r\n                        type: 'up',\r\n                        index: i\r\n                    });\r\n                }\r\n\r\n            } else { // non-touch\r\n                for (let i = 0; i < gestureObj.otherPointerIdArr.length; i++) {\r\n                    if (gestureObj.otherPointerIdArr[i] === event.pointerId) {\r\n                        gestureObj.otherPointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            //all fingers lifted?\r\n            if (gestureObj.touchPointerArr.length === 0 && gestureObj.otherPointerIdArr.length === 0) {\r\n                if (gestureObj.isInProgress) { // lifted last finger -> end of pinching\r\n                    end();\r\n                    endPinch();\r\n                } else { // lifted finger again before pinching started -> fail\r\n                    fail();\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    // --- actual pinch transform logic ---\r\n\r\n    let pincherArr = [];\r\n\r\n    function beginPinch(gestureObj) {\r\n\r\n        for (let i = 0; i < gestureObj.touchPointerArr.length; i++) {\r\n            const pointerObj = gestureObj.touchPointerArr[i];\r\n            pincherArr.push({\r\n                pointerId: pointerObj.pointerId,\r\n                relX: pointerObj.relX,\r\n                relY: pointerObj.relY,\r\n                downRelX: pointerObj.relX,\r\n                downRelY: pointerObj.relY\r\n            });\r\n        }\r\n\r\n        const event: any = {\r\n            type: 'move',\r\n            angleRad: 0,\r\n            scale: 1\r\n        };\r\n\r\n        if (pincherArr.length === 1) {\r\n            event.relX = pincherArr[0].downRelX;\r\n            event.relY = pincherArr[0].downRelY;\r\n        } else {\r\n            event.relX = 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX);\r\n            event.relY = 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY);\r\n        }\r\n        event.downRelX = event.relX;\r\n        event.downRelY = event.relY;\r\n\r\n        p.onPinch(event);\r\n\r\n    }\r\n\r\n    //actionObj = {type: 'down'|'move'|'up', index: number}\r\n    function continuePinch(gestureObj, actionObj) {\r\n\r\n        if (actionObj.index > 1) { // only first two pointers matter\r\n            return;\r\n        }\r\n\r\n        if (actionObj.type === 'move') {\r\n\r\n            let event;\r\n            pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\r\n            pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\r\n\r\n            if (pincherArr.length === 1) {\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: pincherArr[0].downRelX,\r\n                    downRelY: pincherArr[0].downRelY,\r\n                    relX: pincherArr[0].relX,\r\n                    relY: pincherArr[0].relY,\r\n                    angleRad: 0,\r\n                    scale: 1\r\n                };\r\n\r\n            } else {\r\n\r\n                const startDist = dist(pincherArr[0].downRelX, pincherArr[0].downRelY, pincherArr[1].downRelX, pincherArr[1].downRelY);\r\n                const distance = dist(pincherArr[0].relX, pincherArr[0].relY, pincherArr[1].relX, pincherArr[1].relY);\r\n\r\n                const startAngle = pointsToAngleRad({\r\n                    x: pincherArr[0].downRelX,\r\n                    y: pincherArr[0].downRelY\r\n                }, {x: pincherArr[1].downRelX, y: pincherArr[1].downRelY});\r\n                const angle = pointsToAngleRad({\r\n                    x: pincherArr[0].relX,\r\n                    y: pincherArr[0].relY\r\n                }, {x: pincherArr[1].relX, y: pincherArr[1].relY});\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX),\r\n                    downRelY: 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY),\r\n                    relX: 0.5 * (pincherArr[0].relX + pincherArr[1].relX),\r\n                    relY: 0.5 * (pincherArr[0].relY + pincherArr[1].relY),\r\n                    angleRad: angle - startAngle,\r\n                    scale: distance / startDist\r\n                };\r\n\r\n            }\r\n\r\n            p.onPinch(event);\r\n\r\n        } else if (actionObj.type === 'down' || actionObj.type === 'up') {\r\n            endPinch();\r\n            beginPinch(gestureObj);\r\n        }\r\n\r\n    }\r\n\r\n    function endPinch() {\r\n        pincherArr = [];\r\n        p.onPinch({\r\n            type: 'end'\r\n        });\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n        processEvent(event);\r\n        if (gestureObj) {\r\n            if (!gestureObj.isInProgress) { // might still fail -> into queue\r\n                eventQueueArr.push(event);\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n        return null;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * A ChainElement. Splits up coalesced events into their own pointermove events. Otherwise regular pass through.\r\n *\r\n * @constructor\r\n */\r\nexport const CoalescedExploder = function () {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (event.coalescedArr.length > 0) {\r\n\r\n                let eventCopy = JSON.parse(JSON.stringify(event));\r\n                eventCopy.coalescedArr = [];\r\n                let coalescedItem;\r\n\r\n                for (let i = 0; i < event.coalescedArr.length; i++) {\r\n\r\n                    if (i > 0) {\r\n                        eventCopy = JSON.parse(JSON.stringify(event));\r\n                    }\r\n                    coalescedItem = event.coalescedArr[i];\r\n\r\n                    eventCopy.pageX = coalescedItem.pageX;\r\n                    eventCopy.pageY = coalescedItem.pageY;\r\n                    eventCopy.relX = coalescedItem.relX;\r\n                    eventCopy.relY = coalescedItem.relY;\r\n                    eventCopy.dX = coalescedItem.dX;\r\n                    eventCopy.dY = coalescedItem.dY;\r\n                    eventCopy.time = coalescedItem.time;\r\n                    if (i < event.coalescedArr.length - 1) {\r\n                        eventCopy.isCoalesced = true;\r\n                    }\r\n\r\n                    chainOut(eventCopy);\r\n                }\r\n\r\n            } else {\r\n                return event;\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n};\r\n\r\nexport const OnePointerLimiter = function (pointers?) {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    let downPointerId = null;\r\n    const ignorePointerIdArr = [];\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n\r\n        if (ignorePointerIdArr.includes(event.pointerId)) {\r\n            if (event.type === 'pointerup') {\r\n                for (let i = 0; i < ignorePointerIdArr.length; i++) {\r\n                    if (ignorePointerIdArr[i] === event.pointerId) {\r\n                        ignorePointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        if (downPointerId === null) {\r\n            if (event.type === 'pointerdown') {\r\n                downPointerId = event.pointerId;\r\n            }\r\n            return event;\r\n\r\n        } else {\r\n            if (event.pointerId !== downPointerId) {\r\n                if (event.type === 'pointerdown') {\r\n                    ignorePointerIdArr.push(event.pointerId);\r\n                }\r\n                return null;\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                downPointerId = null;\r\n            }\r\n            return event;\r\n        }\r\n\r\n        return null;\r\n\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n\r\n};\r\n\r\n\r\n/**\r\n * Not really and event chain element. but pretty similar.\r\n *\r\n * Processes draw input events. When shift held -> linetool\r\n * line events - what KlCanvasWorkspace passes onDraw(e)\r\n *\r\n * p = {\r\n *     onDraw: function(drawEvent)\r\n * }\r\n *\r\n * pass input in with process(drawEvent)\r\n *\r\n * modifies draw event to include such events:\r\n * {\r\n *     type: 'line',\r\n *     x0: null, // you have to fill that in\r\n *     y0: null, // you have to fill that in\r\n *     pressure0: null, // you have to fill that in\r\n *     x1: number,\r\n *     y1: number,\r\n *     pressure1: number\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const LinetoolProcessor = function (p) {\r\n\r\n    let downEvent = null;\r\n    let eventQueue = [];\r\n    let direction = null;\r\n    const DIR_X = 0, DIR_Y = 1;\r\n\r\n    this.process = function (event) {\r\n        if (event.type === 'down') {\r\n            downEvent = event;\r\n            direction = null;\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                p.onDraw({\r\n                    type: 'line',\r\n                    x0: null,\r\n                    y0: null,\r\n                    pressure0: null,\r\n                    x1: event.x,\r\n                    y1: event.y,\r\n                    pressure1: event.pressure\r\n                });\r\n\r\n                eventQueue.push(event);\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'move') {\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                if (direction === null) {\r\n                    const dX = Math.abs(event.x - downEvent.x);\r\n                    const dY = Math.abs(event.y - downEvent.y);\r\n\r\n                    if (dX > 5 || dY > 5) {\r\n                        direction = dX > dY ? DIR_X : DIR_Y;\r\n\r\n                        for (let i = 0; i < eventQueue.length; i++) {\r\n                            const e = eventQueue[i];\r\n                            if (direction === DIR_X) {\r\n                                e.y = downEvent.y;\r\n                            } else {\r\n                                e.x = downEvent.x;\r\n                            }\r\n                            p.onDraw(JSON.parse(JSON.stringify(e)));\r\n                        }\r\n                        eventQueue = [];\r\n                    }\r\n                }\r\n\r\n                if (direction === null) {\r\n                    eventQueue.push(event);\r\n                    return;\r\n                }\r\n\r\n                if (direction === DIR_X) {\r\n                    event.y = downEvent.y;\r\n                } else {\r\n                    event.x = downEvent.x;\r\n                }\r\n\r\n            } else {\r\n                if (eventQueue.length > 0) {\r\n                    for (let i = 0; i < eventQueue.length; i++) {\r\n                        p.onDraw(JSON.parse(JSON.stringify(eventQueue[i])));\r\n                    }\r\n                    eventQueue = [];\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'up') {\r\n            eventQueue = [];\r\n        }\r\n\r\n        p.onDraw(JSON.parse(JSON.stringify(event)));\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * cleans up DrawEvents. More trustworthy events. EventChain element\r\n *\r\n * that events can only go line this: down -> n x move -> up\r\n * so, sanitizes this: down, down, down. becomes only one down. the other downs are ignored/swallowed\r\n * @constructor\r\n */\r\nexport const LineSanitizer = function () {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n\r\n    let isDrawing = false;\r\n\r\n    // --- interface ---\r\n    this.chainIn = function (event) {\r\n\r\n        if (event.type === 'down') {\r\n            if (isDrawing) {\r\n                //console.log('line sanitizer - down, but already drawing');\r\n                chainOut({\r\n                    type: 'up',\r\n                    scale: event.scale,\r\n                    shiftIsPressed: event.shiftIsPressed,\r\n                    isCoalesced: false\r\n                });\r\n            } else {\r\n                isDrawing = true;\r\n            }\r\n        }\r\n        if (!isDrawing && (event.type === 'move' || event.type === 'up')) {\r\n            //console.log('line sanitizer - ' + event.type + ' but not drawing');\r\n            return null;\r\n        }\r\n\r\n        if (event.type === 'up' && isDrawing) {\r\n            isDrawing = false;\r\n        }\r\n\r\n        return event;\r\n    };\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n    this.getIsDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * Line smoothing. EventChain element. Smoothing via blending new position with old position.\r\n * for onDraw events from KlCanvasWorkspace.\r\n *\r\n * p = {\r\n *     smoothing: number, // 0-1, 0: no smoothing, 1: 100% smoothing -> would never catch up\r\n * }\r\n *\r\n * smoothing > 0: will fire DrawEvents in interval when no new move events\r\n *\r\n * type: 'line' Events are just passed through.\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const LineSmoothing = function (p) {\r\n\r\n    let chainOut: ChainOutFunc = function () {\r\n    };\r\n    let smoothing = clamp(p.smoothing, 0, 1);\r\n    let lastMixedInput;\r\n    let interval;\r\n    let timeout;\r\n\r\n    // --- interface ---\r\n\r\n    this.chainIn = function (event) {\r\n        event = JSON.parse(JSON.stringify(event));\r\n        clearTimeout(timeout);\r\n        clearInterval(interval);\r\n\r\n        if (event.type === 'down') {\r\n            lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure\r\n            };\r\n        }\r\n\r\n        if (event.type === 'move') {\r\n\r\n            const inputX = event.x;\r\n            const inputY = event.y;\r\n            const inputPressure = event.pressure;\r\n\r\n            event.x = mix(event.x, lastMixedInput.x, smoothing);\r\n            event.y = mix(event.y, lastMixedInput.y, smoothing);\r\n            event.pressure = mix(event.pressure, lastMixedInput.pressure, smoothing);\r\n            lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure\r\n            };\r\n\r\n            if (smoothing > 0) {\r\n                timeout = setTimeout(function () {\r\n                    interval = setInterval(function () {\r\n                        event = JSON.parse(JSON.stringify(event));\r\n\r\n                        event.x = mix(inputX, lastMixedInput.x, smoothing);\r\n                        event.y = mix(inputY, lastMixedInput.y, smoothing);\r\n                        event.pressure = mix(inputPressure, lastMixedInput.pressure, smoothing);\r\n                        lastMixedInput = {\r\n                            x: event.x,\r\n                            y: event.y,\r\n                            pressure: event.pressure\r\n                        };\r\n\r\n                        chainOut(event);\r\n                    }, 35);\r\n                }, 80);\r\n            }\r\n\r\n        }\r\n\r\n        return event;\r\n    };\r\n\r\n    this.setChainOut = function (func) {\r\n        chainOut = func;\r\n    };\r\n\r\n    this.setSmoothing = function (s) {\r\n        smoothing = clamp(s, 0, 1);\r\n    };\r\n};\r\n","import {IKeyString} from '../BB.types';\r\nimport {createCanvas} from './create-canvas';\r\n\r\nexport function copyCanvas(canvas: HTMLCanvasElement): HTMLCanvasElement {\r\n    const resultCanvas = createCanvas(canvas.width, canvas.height);\r\n    const ctx = resultCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.drawImage(canvas, 0, 0);\r\n    return resultCanvas;\r\n}\r\n\r\n/**\r\n * Determine if should disable imageSmoothing for transformation.\r\n * ImageSmoothing can make images blurry even when they're in the original scale and aligned with the pixelgrid.\r\n */\r\nexport function testShouldPixelate(\r\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\r\n    scaleX: number,\r\n    scaleY: number,\r\n): boolean {\r\n    if (\r\n        ![1, -1].includes(scaleX) || ![1, -1].includes(scaleY) ||\r\n        transform.width % 1 !== 0 || transform.height % 1 !== 0 ||\r\n        Math.abs(transform.angleDeg) % 90 !== 0\r\n    ) {\r\n        return false;\r\n    }\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    const width = whSwapped ? transform.height : transform.width;\r\n    const height = whSwapped ? transform.width : transform.height;\r\n    return (\r\n            (Math.abs(width) % 2 === 0 && transform.x % 1 === 0) ||\r\n            (Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5)\r\n        ) &&\r\n        (\r\n            (Math.abs(height) % 2 === 0 && transform.y % 1 === 0) ||\r\n            (Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5)\r\n        );\r\n}\r\n\r\n\r\n/**\r\n * @param destCtx - the canvas that will be drawn on\r\n * @param transformImage - image that will be drawn on canvas\r\n * @param transform - {x, y, width, height, angle} - x and y are center of transformImage\r\n * @param bounds object - optional {x, y, width, height} - crop of transformImage in transformImage image space\r\n * @param pixelated\r\n */\r\nexport function drawTransformedImageWithBounds(\r\n    destCtx: CanvasRenderingContext2D,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\r\n    bounds?: {x: number, y: number, width: number, height: number},\r\n    pixelated?: boolean,\r\n): void {\r\n    if (!bounds) {\r\n        bounds = {\r\n            x: 0,\r\n            y: 0,\r\n            width: transformImage.width,\r\n            height: transformImage.height\r\n        };\r\n    }\r\n\r\n    destCtx.save();\r\n    if (pixelated) {\r\n        destCtx.imageSmoothingEnabled = false;\r\n    } else {\r\n        destCtx.imageSmoothingEnabled = true;\r\n        destCtx.imageSmoothingQuality = 'high';\r\n    }\r\n\r\n    destCtx.translate(transform.x, transform.y);\r\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\r\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\r\n    destCtx.drawImage(\r\n        transformImage,\r\n        bounds.x, bounds.y, bounds.width, bounds.height,\r\n        -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\r\n\r\n    destCtx.restore();\r\n}\r\n\r\n/**\r\n * all transformations are optional\r\n * center is the point around which will be scaled and rotated\r\n *\r\n * @param baseCanvas canvas - the canvas that will be drawn on\r\n * @param transformImage image|canvas - image that will be drawn on canvas\r\n * @param transformObj {center: {x, y}, scale: {x, y}, translate: {x, y}, angleDegree}\r\n */\r\nexport function drawTransformedImageOnCanvas(\r\n    baseCanvas: HTMLCanvasElement,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transformObj: {\r\n        center: {x: number, y: number},\r\n        scale: {x: number, y: number},\r\n        translate: {x: number, y: number},\r\n        angleDegree: number,\r\n    },\r\n): void {\r\n    transformObj = JSON.parse(JSON.stringify(transformObj));\r\n    if (!transformObj.center) {\r\n        transformObj.center = {\r\n            x: transformImage.width / 2,\r\n            y: transformImage.height / 2\r\n        }\r\n    }\r\n    if (!transformObj.scale) {\r\n        transformObj.scale = {\r\n            x: 1,\r\n            y: 1\r\n        };\r\n    }\r\n    if (!transformObj.angleDegree) {\r\n        transformObj.angleDegree = 0;\r\n    }\r\n    if (!transformObj.translate) {\r\n        transformObj.translate = {\r\n            x: 0,\r\n            y: 0\r\n        };\r\n    }\r\n\r\n    const ctx = baseCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.save();\r\n    if (\r\n        Math.abs(transformObj.scale.x - 1) >  0.000001 ||\r\n        Math.abs(transformObj.scale.y - 1) > 0.000001 ||\r\n        Math.abs(transformObj.angleDegree % 90) > 0.000001\r\n    ) {\r\n        ctx.imageSmoothingEnabled = true;\r\n        ctx.imageSmoothingQuality = 'high';\r\n    } else {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n\r\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\r\n    ctx.translate(transformObj.center.x, transformObj.center.y);\r\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\r\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\r\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\r\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\r\n\r\n    ctx.restore();\r\n}\r\n\r\nexport const createCheckerCanvas = function(size: number): HTMLCanvasElement {\r\n    const canvas = createCanvas();\r\n    let ctx;\r\n    if (size < 1) {\r\n        canvas.width = 1;\r\n        canvas.height = 1;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = 'rgb(128, 128, 128)';\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    } else if (size > 200) {\r\n        canvas.width = 401;\r\n        canvas.height = 401;\r\n    } else {\r\n        canvas.width = size * 2;\r\n        canvas.height = size * 2;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = 'rgb(255, 255, 255)';\r\n        ctx.fillRect(0, 0, size * 2, size * 2);\r\n        ctx.fillStyle = 'rgb(200, 200, 200)';\r\n        ctx.fillRect(0, 0, size, size);\r\n        ctx.fillRect(size, size, size * 2, size * 2);\r\n    }\r\n    return canvas;\r\n};\r\n\r\nexport const createCheckerDataUrl = (function () {\r\n    const cache: IKeyString = { // previously created dataUrls\r\n        '8': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC',\r\n        '4': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC'\r\n    };\r\n\r\n    return function (size: number, callback?: (s: string) => void) {\r\n        function create(size: number): string {\r\n            size = parseInt('' + size);\r\n            if (cache['' + size]) {\r\n                return cache['' + size];\r\n            }\r\n            const canvas = createCheckerCanvas(size);\r\n            const result = canvas.toDataURL('image/png');\r\n            cache['' + size] = result;\r\n            return result;\r\n        }\r\n\r\n        if (callback) { //async\r\n            setTimeout(function () {\r\n                callback(create(size));\r\n            }, 1);\r\n        } else { //sync\r\n            return create(size);\r\n        }\r\n    };\r\n})();\r\n\r\n/**\r\n * smooth resize image\r\n * @param canvas canvas - will be resized (modified)\r\n * @param w\r\n * @param h\r\n * @param tmp1 canvas - optional, provide to save resources\r\n * @param tmp2 canvas - optional, provide to save resources\r\n */\r\nexport function resizeCanvas(\r\n    canvas: HTMLCanvasElement,\r\n    w: number,\r\n    h: number,\r\n    tmp1?: HTMLCanvasElement,\r\n    tmp2?: HTMLCanvasElement,\r\n): void {\r\n\r\n    //determine base 2 exponents of old and new size\r\n    function getBase2Obj(oldW: number, oldH: number, newW: number, newH: number) {\r\n        const result = {\r\n            oldWidthEx: Math.round(Math.log2(oldW)),\r\n            oldHeightEx: Math.round(Math.log2(oldH)),\r\n            newWidthEx: Math.ceil(Math.log2(newW)),\r\n            newHeightEx: Math.ceil(Math.log2(newH))\r\n        };\r\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\r\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\r\n        return result;\r\n    }\r\n\r\n    if (!w || !h || (w === canvas.width && h === canvas.height)) {\r\n        return;\r\n    }\r\n    w = Math.max(w, 1);\r\n    h = Math.max(h, 1);\r\n    if (w <= canvas.width && h <= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp2 = !tmp2 ? createCanvas() : tmp2;\r\n\r\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\r\n\r\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\r\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\r\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\r\n        tmp1.getContext('2d')!.save();\r\n        tmp2.getContext('2d')!.save();\r\n\r\n        let ew, eh;\r\n        let buffer1 = tmp1, buffer2 = tmp2;\r\n\r\n        ew = base2.oldWidthEx;\r\n        eh = base2.oldHeightEx;\r\n\r\n        let bufferCtx = buffer2.getContext('2d')!;\r\n        bufferCtx.imageSmoothingEnabled = true;\r\n        bufferCtx.imageSmoothingQuality  = 'high';\r\n        bufferCtx.globalCompositeOperation  = 'copy';\r\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\r\n\r\n        let currentWidth = buffer2.width;\r\n        let currentHeight = buffer2.height;\r\n\r\n        //stepwise half the size\r\n        for (; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--) {\r\n            bufferCtx = buffer1.getContext('2d')!;\r\n            bufferCtx.imageSmoothingEnabled = true;\r\n            bufferCtx.imageSmoothingQuality  = 'high';\r\n            bufferCtx.globalCompositeOperation  = 'copy';\r\n\r\n            const newWidth = (ew > base2.newWidthEx) ? currentWidth / 2 : currentWidth;\r\n            const newHeight = (eh > base2.newHeightEx) ? currentHeight / 2 : currentHeight;\r\n\r\n            //buffer also needs to be properly sized, unfortunately\r\n            buffer1.width = newWidth;\r\n            buffer1.height = newHeight;\r\n\r\n            bufferCtx.drawImage(\r\n                buffer2,\r\n                0, 0,\r\n                currentWidth, currentHeight,\r\n                0, 0,\r\n                newWidth, newHeight\r\n            );\r\n            currentWidth = newWidth;\r\n            currentHeight = newHeight;\r\n\r\n            //swap\r\n            const tmp = buffer1;\r\n            buffer1 = buffer2;\r\n            buffer2 = tmp;\r\n        }\r\n\r\n        //when no longer can be halved, bring to target size\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        const canvasCtx = canvas.getContext('2d')!;\r\n        canvasCtx.save();\r\n        canvasCtx.imageSmoothingEnabled = true;\r\n        canvasCtx.imageSmoothingQuality  = 'high';\r\n        canvasCtx.drawImage(\r\n            buffer2,\r\n            0, 0,\r\n            currentWidth, currentHeight,\r\n            0, 0,\r\n            w, h\r\n        );\r\n        canvasCtx.restore();\r\n        tmp1.getContext('2d')!.restore();\r\n        tmp2.getContext('2d')!.restore();\r\n\r\n    } else if (w >= canvas.width && h >= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp1.width = w;\r\n        tmp1.height = h;\r\n        const tmp1Ctx = tmp1.getContext('2d')!;\r\n        tmp1Ctx.save();\r\n        tmp1Ctx.imageSmoothingEnabled = true;\r\n        tmp1Ctx.imageSmoothingQuality  = 'high';\r\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\r\n        tmp1Ctx.restore();\r\n\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        canvas.getContext('2d')!.drawImage(tmp1, 0, 0);\r\n\r\n    } else {\r\n        resizeCanvas(canvas, w, canvas.height, tmp1, tmp2);\r\n        resizeCanvas(canvas, w, h, tmp1, tmp2);\r\n    }\r\n}\r\n\r\n/**\r\n * puts naive greyscale version of image into alpha channel.\r\n * only writes a, doesn't write rgb\r\n * @param canvas\r\n */\r\nexport function convertToAlphaChannelCanvas(canvas: HTMLCanvasElement): void {\r\n    const imdat = canvas.getContext('2d')!.getImageData(0, 0, canvas.width, canvas.height);\r\n    for (let i = 0; i < imdat.data.length; i += 4) {\r\n        if (imdat.data[i + 3] === 0) {\r\n            continue;\r\n        }\r\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\r\n    }\r\n    canvas.getContext('2d')!.putImageData(imdat, 0, 0);\r\n}\r\n\r\n/**\r\n * Sometimes garbage collection is too slow, and canvases use up too much memory,\r\n * or there is a hard to fix memory leak.\r\n * This function manually makes the canvas use as little memory as possible.\r\n */\r\nexport function freeCanvas(canvas: HTMLCanvasElement): void {\r\n    canvas.width = 1;\r\n    canvas.height = 1;\r\n    const ctx = canvas.getContext('2d');\r\n    ctx && ctx.clearRect(0, 0, 1, 1);\r\n}","export const Matrix = (function () {\r\n\r\n    // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\r\n    // yes not optimized - but it's not used for physics simulations.\r\n\r\n    // const perfTotal = 0;\r\n\r\n    // point  matrix\r\n    function multiplyMatrixAndPoint(matrix, point) {\r\n        const result = [\r\n            (point[0] * matrix[0]) + (point[1] * matrix[4]) + (point[2] * matrix[8]) + (point[3] * matrix[12]), // x\r\n            (point[0] * matrix[1]) + (point[1] * matrix[5]) + (point[2] * matrix[9]) + (point[3] * matrix[13]), // y\r\n            (point[0] * matrix[2]) + (point[1] * matrix[6]) + (point[2] * matrix[10]) + (point[3] * matrix[14]), // z\r\n            (point[0] * matrix[3]) + (point[1] * matrix[7]) + (point[2] * matrix[11]) + (point[3] * matrix[15]) // w\r\n        ];\r\n        return result;\r\n    }\r\n\r\n    //matrixB  matrixA\r\n    function multiplyMatrices(matrixA, matrixB) {\r\n\r\n        // Slice the second matrix up into rows\r\n        const row0 = [matrixB[0], matrixB[1], matrixB[2], matrixB[3]];\r\n        const row1 = [matrixB[4], matrixB[5], matrixB[6], matrixB[7]];\r\n        const row2 = [matrixB[8], matrixB[9], matrixB[10], matrixB[11]];\r\n        const row3 = [matrixB[12], matrixB[13], matrixB[14], matrixB[15]];\r\n\r\n        // Multiply each row by matrixA\r\n        const result0 = multiplyMatrixAndPoint(matrixA, row0);\r\n        const result1 = multiplyMatrixAndPoint(matrixA, row1);\r\n        const result2 = multiplyMatrixAndPoint(matrixA, row2);\r\n        const result3 = multiplyMatrixAndPoint(matrixA, row3);\r\n\r\n        // Turn the result rows back into a single matrix\r\n        return [\r\n            result0[0], result0[1], result0[2], result0[3],\r\n            result1[0], result1[1], result1[2], result1[3],\r\n            result2[0], result2[1], result2[2], result2[3],\r\n            result3[0], result3[1], result3[2], result3[3]\r\n        ];\r\n    }\r\n\r\n    function createTranslationMatrix(x, y) {\r\n        return [\r\n            1, 0, 0, 0,\r\n            0, 1, 0, 0,\r\n            0, 0, 1, 0,\r\n            x, y, 0, 1\r\n        ];\r\n    }\r\n\r\n    function createRotationMatrix(angleRad) {\r\n        //let angleRad = angleDeg / 360 * 2 * Math.PI;\r\n        return [\r\n            Math.cos(-angleRad), -Math.sin(-angleRad), 0, 0,\r\n            Math.sin(-angleRad), Math.cos(-angleRad), 0, 0,\r\n            0, 0, 1, 0,\r\n            0, 0, 0, 1\r\n        ];\r\n    }\r\n\r\n    function createScaleMatrix(f) {\r\n        return [\r\n            f, 0, 0, 0,\r\n            0, f, 0, 0,\r\n            0, 0, 1, 0,\r\n            0, 0, 0, 1\r\n        ];\r\n    }\r\n\r\n    return {\r\n        getIdentity: function () {\r\n            return [\r\n                1, 0, 0, 0,\r\n                0, 1, 0, 0,\r\n                0, 0, 1, 0,\r\n                0, 0, 0, 1\r\n            ];\r\n        },\r\n        multiplyMatrixAndPoint: multiplyMatrixAndPoint,\r\n        multiplyMatrices: multiplyMatrices,\r\n        createTranslationMatrix: createTranslationMatrix,\r\n        createRotationMatrix: createRotationMatrix,\r\n        createScaleMatrix: createScaleMatrix\r\n    };\r\n})();","import {IVector2D} from '../BB.types';\r\n\r\nexport const Vec2 = {\r\n    add: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x + p2.x, y: p1.y + p2.y};\r\n    },\r\n    sub: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x - p2.x, y: p1.y - p2.y};\r\n    },\r\n    nor: function (p: IVector2D): IVector2D {\r\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n        return {x: p.x / len, y: p.y / len};\r\n    },\r\n    len: function (p: IVector2D): number {\r\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n    },\r\n    dist: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Vec2.len(Vec2.sub(p1, p2));\r\n    },\r\n    mul: function (p: IVector2D, s: number): IVector2D {\r\n        return {x: p.x * s, y: p.y * s};\r\n    },\r\n    angle: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n    },\r\n    dot: function(a: IVector2D, b: IVector2D): number {\r\n        const aArr = [a.x, a.y];\r\n        const bArr = [b.x, b.y];\r\n        return aArr.map((x, i) => aArr[i] * bArr[i]).reduce((m, n) => m + n);\r\n    }\r\n};","import {Vec2} from './vec2';\r\nimport {pointsToAngleDeg, clamp, dist, mix} from './math';\r\nimport {IVector2D} from \"../bb.types\";\r\n\r\n/**\r\n * project p onto line\r\n * @param lineStart\r\n * @param lineEnd\r\n * @param p\r\n */\r\nexport const projectPointOnLine = function (lineStart: IVector2D, lineEnd: IVector2D, p: IVector2D): IVector2D {\r\n    let x, y;\r\n    if (lineStart.x === lineEnd.x) {\r\n        x = lineStart.x;\r\n        y = p.y;\r\n\r\n        return {\r\n            x: x,\r\n            y: y\r\n        };\r\n    }\r\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\r\n    const b = lineStart.y - (m * lineStart.x);\r\n\r\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\r\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\r\n\r\n    return {\r\n        x: x,\r\n        y: y\r\n    };\r\n};\r\n\r\n\r\n\r\n/**\r\n * Operations on a line made up of points\r\n *\r\n * getAtDist(dist) - point when traveling *dist* along the line\r\n * getLength - gives you total length of line\r\n *\r\n * @param params object - {points: [{x:float, y:float}, ...]}\r\n * @constructor\r\n */\r\nexport const PointLine = function (params) {\r\n    const segmentArr = [];\r\n    const _this = this;\r\n\r\n    for (let i = 0; i < params.points.length; i++) {\r\n        (function (i) {\r\n            let length = undefined;\r\n            if (i < params.points.length - 1) {\r\n                length = dist(params.points[i].x, params.points[i].y, params.points[i + 1].x, params.points[i + 1].y);\r\n            }\r\n            segmentArr[i] = {\r\n                x: params.points[i].x,\r\n                y: params.points[i].y,\r\n                length: length\r\n            };\r\n        })(i);\r\n    }\r\n\r\n    /**\r\n     * @param dist number - distance in pixels, > 0\r\n     * @returns {{x: number, y: number}}\r\n     */\r\n    this.getAtDist = function (dist) {\r\n        let remainder = Math.min(_this.getLength(), dist);\r\n        let i = 0;\r\n\r\n        for (; remainder > segmentArr[i].length && i < segmentArr.length - 2; i++) {\r\n            remainder -= segmentArr[i].length;\r\n        }\r\n\r\n        const fac = Math.min(1, Math.max(0, remainder / segmentArr[i].length));\r\n\r\n        return {\r\n            x: (segmentArr[i].x * (1 - fac) + segmentArr[i + 1].x * fac),\r\n            y: (segmentArr[i].y * (1 - fac) + segmentArr[i + 1].y * fac)\r\n        };\r\n    };\r\n    this.getLength = function () {\r\n        let result = 0;\r\n        for (let i = 0; i < segmentArr.length - 1; i++) {\r\n            result += segmentArr[i].length;\r\n        }\r\n        return result;\r\n    };\r\n};\r\n\r\n/**\r\n * Each instance is one line made up of bezier interpolated segments.\r\n * You feed it points. It calculates control points on its own, and the resulting curve.\r\n *\r\n * @constructor\r\n */\r\nexport const BezierLine = function () {\r\n    const _this = this;\r\n    const pointArr = [];\r\n    let lastDot = 0;\r\n    let lastPoint;\r\n    let lastCallbackPoint;\r\n    let lastAngle;\r\n    let lastSpacing = null;\r\n\r\n    /**\r\n     * creates bezier curve from control points\r\n     *\r\n     * @param p1 - control point 1 {x: float, y: float}\r\n     * @param p2 - control point 2 {x: float, y: float}\r\n     * @param p3 - control point 3 {x: float, y: float}\r\n     * @param p4 - control point 4 {x: float, y: float}\r\n     * @param resolution - int\r\n     * @returns {Array} - bezier curve made up of points {x: float, y: float}\r\n     */\r\n    function getBezierPoints(p1, p2, p3, p4, resolution) {\r\n        const curvePoints = [];\r\n        let t, result;\r\n        for (let i = 0; i <= resolution; i++) {\r\n            t = i / resolution;\r\n            result = {};\r\n            result.x = Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x;\r\n            result.y = Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y;\r\n            curvePoints[curvePoints.length] = result;\r\n        }\r\n        return curvePoints;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * add now point to line\r\n     * line will go until the previous point\r\n     *\r\n     * @param x - coord of new point\r\n     * @param y - coord of new point\r\n     * @param spacing - space between each step\r\n     * @param callback - calls for each step - x, y, t - t is 0-1 how far along\r\n     * @param controlsCallback - calls that callback with the bezier control points p1, p2, p3, p4 - each {x: float, y: float}\r\n     */\r\n    this.add = function (x, y, spacing, callback, controlsCallback) {\r\n        if (lastPoint && x === lastPoint.x && y === lastPoint.y) {\r\n            return;\r\n        }\r\n        lastPoint = {x: x, y: y};\r\n        pointArr[pointArr.length] = {\r\n            x: x,\r\n            y: y,\r\n            spacing: spacing\r\n        };\r\n\r\n        //calculate directions\r\n        if (pointArr.length === 1) {\r\n            lastSpacing = spacing;\r\n            return;\r\n        } else if (pointArr.length === 2) {\r\n            pointArr[0].dir = Vec2.nor(Vec2.sub(pointArr[1], pointArr[0]));\r\n            lastDot = spacing;\r\n            lastSpacing = spacing;\r\n            return;\r\n        } else {\r\n            const pointM1 = pointArr[pointArr.length - 1];\r\n            const pointM2 = pointArr[pointArr.length - 2];\r\n            const pointM3 = pointArr[pointArr.length - 3];\r\n            pointM2.dir = Vec2.nor(Vec2.sub(pointM1, pointM3));\r\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) {\r\n                //when xy -3 == -1\r\n                pointM2.dir = JSON.parse(JSON.stringify(pointM3.dir));\r\n            }\r\n        }\r\n\r\n        //get bezier curve\r\n        const a = pointArr[pointArr.length - 3];\r\n        const b = pointArr[pointArr.length - 2];\r\n        const p1 = a;\r\n        const p2 = Vec2.add(a, Vec2.mul(a.dir, Vec2.dist(a, b) / 4));\r\n        const p3 = Vec2.sub(b, Vec2.mul(b.dir, Vec2.dist(a, b) / 4));\r\n        const p4 = b;\r\n\r\n\r\n        let pointLine;\r\n        if (callback) {\r\n            let curvePoints;\r\n            curvePoints = getBezierPoints(p1, p2, p3, p4, 20);\r\n            pointLine = new PointLine({points: curvePoints});\r\n        } else {\r\n            pointLine = new PointLine({points: [p1, p4]});\r\n        }\r\n\r\n        //interate over curve with spacing and callback\r\n        const len = pointLine.getLength();\r\n        let tempSpacing = mix(lastSpacing, spacing, clamp(lastDot / len, 0, 1));\r\n        let d = lastDot;\r\n        for (; d <= len; d += tempSpacing) {\r\n            tempSpacing = mix(lastSpacing, spacing, clamp(d / len, 0, 1));\r\n            const point = pointLine.getAtDist(d);\r\n            const angle = lastCallbackPoint ? pointsToAngleDeg(lastCallbackPoint, point) : undefined;\r\n            if (callback) {\r\n                callback({\r\n                    x: point.x,\r\n                    y: point.y,\r\n                    t: d / len,\r\n                    angle: angle,\r\n                    dAngle: lastCallbackPoint ? angle - lastAngle : 0\r\n                });\r\n            }\r\n            lastCallbackPoint = point;\r\n            lastAngle = angle;\r\n        }\r\n\r\n        if (callback) {\r\n            lastDot = d - len;\r\n        } else {\r\n            lastDot = 0;\r\n            controlsCallback({p1: p1, p2: p2, p3: p3, p4: p4});\r\n        }\r\n\r\n        lastSpacing = spacing;\r\n    };\r\n\r\n    this.addFinal = function(spacing, callback, controlsCallback) {\r\n        if (pointArr.length < 2) {\r\n            return;\r\n        }\r\n\r\n        const p1 = pointArr[pointArr.length - 2];\r\n        const p2 = pointArr[pointArr.length - 1];\r\n\r\n        const newP = Vec2.add(p2, Vec2.sub(p2, p1));\r\n\r\n        _this.add(newP.x, newP.y, spacing, callback, controlsCallback);\r\n    };\r\n\r\n};\r\n\r\n/**\r\n * from glfx.script by evanW:\r\n * from SplineInterpolator.cs in the Paint.NET source code\r\n *\r\n * points go 0 - 1. I think.\r\n *\r\n * @param points\r\n * @constructor\r\n */\r\nexport const SplineInterpolator = function (points) {\r\n    const n = points.length;\r\n    this.xa = [];\r\n    this.ya = [];\r\n    this.u = [];\r\n    this.y2 = [];\r\n    let i;\r\n\r\n    const first = points[0][0];\r\n    const last = points[points.length - 1][0];\r\n\r\n    points.sort(function (a, b) {\r\n        return a[0] - b[0];\r\n    });\r\n    for (i = 0; i < n; i++) {\r\n        this.xa.push(points[i][0]);\r\n        this.ya.push(points[i][1]);\r\n    }\r\n\r\n    this.u[0] = 0;\r\n    this.y2[0] = 0;\r\n\r\n    for (i = 1; i < n - 1; ++i) {\r\n        // This is the decomposition loop of the tridiagonal algorithm.\r\n        // y2 and u are used for temporary storage of the decomposed factors.\r\n        const wx = this.xa[i + 1] - this.xa[i - 1];\r\n        const sig = (this.xa[i] - this.xa[i - 1]) / wx;\r\n        const p = sig * this.y2[i - 1] + 2.0;\r\n\r\n        this.y2[i] = (sig - 1.0) / p;\r\n\r\n        const ddydx =\r\n            (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\r\n            (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\r\n\r\n        this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\r\n    }\r\n\r\n    this.y2[n - 1] = 0;\r\n\r\n    // This is the backsubstitution loop of the tridiagonal algorithm\r\n    for (i = n - 2; i >= 0; --i) {\r\n        this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\r\n    }\r\n\r\n    this.getFirstX = function () {\r\n        return first;\r\n    };\r\n    this.getLastX = function () {\r\n        return last;\r\n    };\r\n};\r\n\r\nSplineInterpolator.prototype.interpolate = function (x) {\r\n    const n = this.ya.length;\r\n    let klo = 0;\r\n    let khi = n - 1;\r\n\r\n    // We will find the right place in the table by means of\r\n    // bisection. This is optimal if sequential calls to this\r\n    // routine are at random values of x. If sequential calls\r\n    // are in order, and closely spaced, one would do better\r\n    // to store previous values of klo and khi.\r\n    while (khi - klo > 1) {\r\n        const k = (khi + klo) >> 1;\r\n\r\n        if (this.xa[k] > x) {\r\n            khi = k;\r\n        } else {\r\n            klo = k;\r\n        }\r\n    }\r\n\r\n    const h = this.xa[khi] - this.xa[klo];\r\n    const a = (this.xa[khi] - x) / h;\r\n    const b = (x - this.xa[klo]) / h;\r\n\r\n    // Cubic spline polynomial is now evaluated.\r\n    return a * this.ya[klo] + b * this.ya[khi] +\r\n        ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\r\n};\r\n\r\n/**\r\n * find x to y. simply by stepping through. suboptimal, so don't call often.\r\n * searches in x 0-1 range\r\n *\r\n * @param y\r\n * @param resolution\r\n */\r\nSplineInterpolator.prototype.findX = function (y, resolution) {\r\n    let x = null;\r\n    let dist = null;\r\n    for (let i = 0; i <= resolution; i++) {\r\n        const tempX = i / resolution;\r\n        const tempY = this.interpolate(tempX);\r\n        if (x === null) {\r\n            x = tempX;\r\n            dist = Math.abs(tempY - y);\r\n            continue;\r\n        }\r\n\r\n        const tempDist = Math.abs(tempY - y);\r\n\r\n        if (tempDist < dist) {\r\n            x = tempX;\r\n            dist = tempDist;\r\n        } else {\r\n            //distance increasing\r\n            break;\r\n        }\r\n    }\r\n    return x;\r\n};\r\n\r\n/**\r\n * input for a spline, following curve of quadratic function x^2 [0 - 1]\r\n * returns [[0, startVal], ..., [1, endVal]]\r\n * @param startVal\r\n * @param endVal\r\n * @param stepSize\r\n * @returns {[]}\r\n */\r\nexport const quadraticSplineInput = function (startVal, endVal, stepSize) {\r\n    function round(v, dec) {\r\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\r\n    }\r\n\r\n    const resultArr = [];\r\n    for (let i = 0; i <= 1; i += stepSize) {\r\n        resultArr.push([round(i, 4), round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)]);\r\n    }\r\n    return resultArr;\r\n};","\r\n\r\n\r\n// based on js color conversion http://www.webtoolkit.info/\r\n\r\n\r\nexport class HSV {\r\n    h: number;\r\n    s: number;\r\n    v: number;\r\n    constructor(h: number, s: number, v: number) {\r\n        this.h = Math.max(0, Math.min(360, h));\r\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\r\n        this.v = Math.max(0, Math.min(100, v));\r\n    }\r\n}\r\n\r\nexport class RGB {\r\n    r : number;\r\n    g: number;\r\n    b: number;\r\n    constructor(r: number, g: number, b: number) {\r\n        this.r = Math.max(0, Math.min(255, r));\r\n        this.g = Math.max(0, Math.min(255, g));\r\n        this.b = Math.max(0, Math.min(255, b));\r\n    }\r\n}\r\n\r\nexport class CMYK {\r\n    c: number;\r\n    m: number;\r\n    y: number;\r\n    k: number;\r\n    constructor(c: number, m: number, y: number, k: number) {\r\n        this.c = Math.max(0, Math.min(100, c));\r\n        this.m = Math.max(0, Math.min(100, m));\r\n        this.y = Math.max(0, Math.min(100, y));\r\n        this.k = Math.max(0, Math.min(100, k));\r\n    }\r\n}\r\n\r\nexport const ColorConverter = {\r\n\r\n    _RGBtoHSV: function (RGB: RGB): HSV {\r\n        const result = new HSV(0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        const minVal = Math.min(r, g, b);\r\n        const maxVal = Math.max(r, g, b);\r\n        const delta = maxVal - minVal;\r\n\r\n        result.v = maxVal;\r\n\r\n        if (delta == 0) {\r\n            result.h = 0;\r\n            result.s = 0;\r\n        } else {\r\n            result.s = delta / maxVal;\r\n            const del_R = (((maxVal - r) / 6) + (delta / 2)) / delta;\r\n            const del_G = (((maxVal - g) / 6) + (delta / 2)) / delta;\r\n            const del_B = (((maxVal - b) / 6) + (delta / 2)) / delta;\r\n\r\n            if (r == maxVal) {\r\n                result.h = del_B - del_G;\r\n            } else if (g == maxVal) {\r\n                result.h = (1 / 3) + del_R - del_B;\r\n            } else if (b == maxVal) {\r\n                result.h = (2 / 3) + del_G - del_R;\r\n            }\r\n\r\n            if (result.h < 0) {\r\n                result.h += 1;\r\n            }\r\n            if (result.h > 1) {\r\n                result.h -= 1;\r\n            }\r\n        }\r\n\r\n        result.h = Math.round(result.h * 360);\r\n        result.s = Math.round(result.s * 100);\r\n        result.v = Math.round(result.v * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    _HSVtoRGB: function (HSV: HSV): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\r\n\r\n        const h = (HSV.h / 360) % 1;\r\n        const s = HSV.s / 100;\r\n        const v = HSV.v / 100;\r\n\r\n        if (s == 0) {\r\n            result.r = v * 255;\r\n            result.g = v * 255;\r\n            result.b = v * 255;\r\n        } else {\r\n            var_h = h * 6;\r\n            var_i = Math.floor(var_h);\r\n            var_1 = v * (1 - s);\r\n            var_2 = v * (1 - s * (var_h - var_i));\r\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\r\n\r\n            if (var_i == 0) {\r\n                var_r = v;\r\n                var_g = var_3;\r\n                var_b = var_1\r\n            } else if (var_i == 1) {\r\n                var_r = var_2;\r\n                var_g = v;\r\n                var_b = var_1\r\n            } else if (var_i == 2) {\r\n                var_r = var_1;\r\n                var_g = v;\r\n                var_b = var_3\r\n            } else if (var_i == 3) {\r\n                var_r = var_1;\r\n                var_g = var_2;\r\n                var_b = v\r\n            } else if (var_i == 4) {\r\n                var_r = var_3;\r\n                var_g = var_1;\r\n                var_b = v\r\n            } else {\r\n                var_r = v;\r\n                var_g = var_1;\r\n                var_b = var_2\r\n            }\r\n\r\n            result.r = var_r * 255;\r\n            result.g = var_g * 255;\r\n            result.b = var_b * 255;\r\n\r\n            result.r = Math.round(result.r);\r\n            result.g = Math.round(result.g);\r\n            result.b = Math.round(result.b);\r\n        }\r\n\r\n        return result;\r\n    },\r\n\r\n    _CMYKtoRGB: function (CMYK: CMYK): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        const c = CMYK.c / 100;\r\n        const m = CMYK.m / 100;\r\n        const y = CMYK.y / 100;\r\n        const k = CMYK.k / 100;\r\n\r\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\r\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\r\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\r\n\r\n        result.r = Math.round(result.r * 255);\r\n        result.g = Math.round(result.g * 255);\r\n        result.b = Math.round(result.b * 255);\r\n\r\n        return result;\r\n    },\r\n\r\n    _RGBtoCMYK: function (RGB: RGB): CMYK {\r\n        const result = new CMYK(0, 0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\r\n        result.c = (1 - r - result.k) / (1 - result.k);\r\n        result.m = (1 - g - result.k) / (1 - result.k);\r\n        result.y = (1 - b - result.k) / (1 - result.k);\r\n\r\n        result.c = Math.round(result.c * 100);\r\n        result.m = Math.round(result.m * 100);\r\n        result.y = Math.round(result.y * 100);\r\n        result.k = Math.round(result.k * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    toRGB: function (o: RGB | HSV | CMYK): RGB {\r\n        if (o instanceof RGB) {\r\n            return o;\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._HSVtoRGB(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._CMYKtoRGB(o);\r\n        }\r\n    },\r\n\r\n    toHSV: function (o: RGB | HSV | CMYK): HSV {\r\n        if (o instanceof HSV) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoHSV(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._RGBtoHSV(this._CMYKtoRGB(o));\r\n        }\r\n    },\r\n\r\n    toCMYK: function (o: RGB | HSV | CMYK): CMYK {\r\n        if (o instanceof CMYK) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoCMYK(o);\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._RGBtoCMYK(this._HSVtoRGB(o));\r\n        }\r\n    },\r\n    toHexString: function (o: RGB): string {\r\n        if (o instanceof RGB) {\r\n            let ha = (parseInt('' + o.r)).toString(16);\r\n            let hb = (parseInt('' + o.g)).toString(16);\r\n            let hc = (parseInt('' + o.b)).toString(16);\r\n            if (ha.length == 1)\r\n                ha = '0' + ha;\r\n            if (hb.length == 1)\r\n                hb = '0' + hb;\r\n            if (hc.length == 1)\r\n                hc = '0' + hc;\r\n            return ha + hb + hc;\r\n        }\r\n    },\r\n    toRgbStr: function(rgbObj: {r: number, g: number, b: number}): string {\r\n        return 'rgb(' + Math.round(rgbObj.r) + ', ' + Math.round(rgbObj.g) + ', ' + Math.round(rgbObj.b) + ')';\r\n    },\r\n    toRgbaStr: function(rgbaObj: {r: number, g: number, b: number, a: number}): string {\r\n        return 'rgba(' + Math.round(rgbaObj.r) + ', ' + Math.round(rgbaObj.g) + ', ' + Math.round(rgbaObj.b) + ', ' + rgbaObj.a + ')';\r\n    },\r\n    hexToRGB: function(hexStr: string): RGB | null {\r\n        hexStr = hexStr.trim();\r\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\r\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n        hexStr = hexStr.replace(shorthandRegex, function(m, r, g, b) {\r\n            return r + r + g + g + b + b;\r\n        });\r\n\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\r\n        return result ? new RGB(\r\n            parseInt(result[1], 16),\r\n            parseInt(result[2], 16),\r\n            parseInt(result[3], 16)\r\n        ) : null;\r\n    }\r\n\r\n};\r\n\r\nexport function testIsWhiteBestContrast(rgbObj: {r: number, g: number, b: number}): boolean {\r\n    return (rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114) < 125;\r\n}","import {addEventListener} from '../input/event-listener';\r\nimport {css} from './base';\r\nimport {BB} from '../bb';\r\n\r\n\r\nexport function appendTextDiv(target: HTMLElement, text: string): HTMLDivElement {\r\n    const div = document.createElement('div');\r\n    div.innerHTML = text;\r\n    target.appendChild(div);\r\n    return div;\r\n}\r\n\r\n/**\r\n * Is an input element focused.\r\n * Set attribute \"data-ignore-focus\" to \"true\" if its focus should be ignored.\r\n *\r\n * @param getAll - check all, even those with \"data-ignore-focus\" = \"true\"\r\n */\r\nexport function isInputFocused(getAll: boolean = false): boolean {\r\n    let result = document.activeElement && ['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName);\r\n    if (getAll) {\r\n        return result;\r\n    } else {\r\n        return result && !document.activeElement.getAttribute('data-ignore-focus');\r\n    }\r\n}\r\n\r\n/**\r\n * clears text selection in window\r\n */\r\nexport function clearSelection(): void {\r\n    if (window.getSelection) {\r\n        const sel = window.getSelection();\r\n        if (sel) {\r\n            if (sel.empty) {\r\n                sel.empty();\r\n            } else if (sel.removeAllRanges) {\r\n                sel.removeAllRanges();\r\n            }\r\n        }\r\n    } else if ('selection' in document) {\r\n        (document as any).selection.empty();\r\n    }\r\n}\r\n\r\n/**\r\n * prevents being able to focus element.\r\n * warning: it creates a listener\r\n *\r\n * @param el - dom element\r\n */\r\nexport const makeUnfocusable = (function() {\r\n\r\n    function preventFocus(event: MouseEvent) {\r\n        event.preventDefault();\r\n        let didFocusRelated = false;\r\n        if (event.relatedTarget) {\r\n            try {\r\n                (event.relatedTarget as HTMLElement).focus();\r\n                didFocusRelated = true;\r\n            } catch(e) {\r\n                console.error('failed to focus');\r\n            }\r\n        }\r\n        if (!didFocusRelated) {\r\n            (event.currentTarget as HTMLElement).blur();\r\n        }\r\n    }\r\n\r\n    return function(el) {\r\n        el.setAttribute('tabindex', '-1');\r\n        addEventListener(el, 'focus', preventFocus);\r\n    };\r\n})();\r\n\r\n\r\nconst els: {\r\n    el: HTMLElement;\r\n    listeners: [string, any][];\r\n}[] = [];\r\n// window['els'] = els;\r\n\r\n/**\r\n *\r\n * Create DOM element - div by default\r\n * params = {\r\n * \t    parent: someOtherDiv,\r\n * \t    css: {\r\n * \t\t    width: \"500px\",\r\n * \t\t    backgroundColor: \"#fff\"\r\n * \t    },\r\n * \t    content: \"test\", //or  content: [divA, divB, divC]   or content: someDiv\r\n * \t    className: \"bla\",\r\n *      id: \"bla\"\r\n * }\r\n *\r\n *  If onClick or onChange is used, then BB.destroyEl MUST be called\r\n *  to prevent a memory leak.\r\n *\r\n * @param params\r\n */\r\nexport function el(\r\n    params: {\r\n        parent?: HTMLElement,\r\n        css?: { [key: string]: string },\r\n        custom?: { [key: string]: any },\r\n        content?: string | (HTMLElement | string | null)[] | HTMLElement | SVGElement,\r\n        textContent?: string,\r\n        className?: string,\r\n        title?: string,\r\n        id?: string,\r\n        tagName?: string,\r\n        onClick?: (e: Event) => void,\r\n        onChange?: (e: Event) => void,\r\n    }\r\n): HTMLElement {\r\n    const div = document.createElement(params.tagName ? params.tagName : 'div');\r\n    if (params.css) {\r\n        css(div, params.css);\r\n    }\r\n\r\n    if (params.content) {\r\n        if (typeof params.content === typeof 'aa') {\r\n            div.innerHTML = params.content as string;\r\n\r\n        } else if (Array.isArray(params.content)) {\r\n            BB.append(div, params.content);\r\n\r\n        } else {\r\n            div.appendChild(params.content as HTMLElement);\r\n\r\n        }\r\n    }\r\n    if (params.textContent) {\r\n        div.textContent = params.textContent;\r\n    }\r\n    if (params.className) {\r\n        div.className = params.className;\r\n    }\r\n    if (params.id) {\r\n        div.id = params.id;\r\n    }\r\n    if (params.parent) {\r\n        params.parent.appendChild(div);\r\n    }\r\n    if ('title' in params && params.title !== undefined) {\r\n        div.title = params.title;\r\n    }\r\n    const listeners = [];\r\n    if ('onClick' in params) {\r\n        addEventListener(div, 'click', params.onClick);\r\n        listeners.push(['click', params.onClick]);\r\n    }\r\n    if ('onChange' in params) {\r\n        addEventListener(div, 'change', params.onChange);\r\n        listeners.push(['change', params.onChange]);\r\n    }\r\n    if (listeners.length > 0) {\r\n        els.push({\r\n            el: div,\r\n            listeners: listeners,\r\n        })\r\n        /*div.style.backgroundColor = '#ff0';\r\n        div.style.border = '1px solid #ff0';*/\r\n    }\r\n    if ('custom' in params) {\r\n        const customKeyArr = Object.keys(params.custom);\r\n        for (let i = 0; i < customKeyArr.length; i++) {\r\n            div.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\r\n        }\r\n    }\r\n    return div;\r\n}\r\n\r\n/**\r\n * removes event listeners for Elements created via el()\r\n * @param el\r\n */\r\nexport function destroyEl(el: HTMLElement) {\r\n    for (let i = 0; i < els.length; i++) {\r\n        const item = els[i];\r\n        if (item.el === el) {\r\n            item.listeners.forEach(item => {\r\n                el.removeEventListener(item[0], item[1]);\r\n            });\r\n            els.splice(i, 1);\r\n            return;\r\n        }\r\n    }\r\n    // not found\r\n    return;\r\n}\r\n","\r\nexport class BbLog {\r\n\r\n    private static listeners: any[] = [];\r\n\r\n    constructor() {\r\n    }\r\n\r\n    static subscribe(listener) {\r\n        if (BbLog.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        BbLog.listeners.push(listener);\r\n    }\r\n\r\n    static unsubscribe(listener) {\r\n        for (let i = 0; i < BbLog.listeners.length; i++) {\r\n            if (listener === BbLog.listeners[i]) {\r\n                BbLog.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    static emit (msg) {\r\n        BbLog.listeners.forEach(item => {\r\n            item(msg);\r\n        });\r\n    }\r\n}",null,"/**\r\n * LocalStorage wrapper that does not throw exceptions.\r\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\r\n */\r\nexport class LocalStorage {\r\n\r\n    private static error;\r\n\r\n    static getItem (key: string): string {\r\n        let result = null;\r\n        try {\r\n            result = localStorage.getItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static setItem (key: string, value: string): void {\r\n        try {\r\n            localStorage.setItem(key, value);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static removeItem (key: string): void {\r\n        try {\r\n            localStorage.removeItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static getError (): any {\r\n        return this.error;\r\n    }\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"l7FYj\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kbyFQ\");","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Checkbox - with label\r\n */\r\nexport class Checkbox {\r\n\r\n    private element: HTMLElement;\r\n    private check: HTMLInputElement;\r\n\r\n    // --- public ---\r\n\r\n    constructor (params: {\r\n        init?: boolean; // default false\r\n        label: string;\r\n        callback: (boolean) => void;\r\n        allowTab?: boolean; // default false\r\n        title?: string;\r\n        doHighlight?: boolean; // default false\r\n        css?: any;\r\n    }) {\r\n        this.element = BB.el({\r\n            className: 'kl-checkbox'\r\n        });\r\n\r\n        const innerEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'label',\r\n            className: 'kl-checkbox__inner'\r\n        });\r\n\r\n        this.check = BB.el({\r\n            parent: innerEl,\r\n            tagName: 'input',\r\n            css: {\r\n                marginLeft: '0',\r\n                display: 'inline-block'\r\n            },\r\n            custom: {\r\n                type: 'checkbox'\r\n            }\r\n        }) as HTMLInputElement;\r\n        this.check.checked = params.init;\r\n        if (params.doHighlight && this.check.checked) {\r\n            this.element.classList.add('kl-checkbox--highlight');\r\n        }\r\n        if (!params.allowTab) {\r\n            this.check.tabIndex = -1;\r\n        }\r\n\r\n        if (params.title) {\r\n            innerEl.title = params.title;\r\n        }\r\n\r\n        const label = document.createElement('div');\r\n        label.style.display = 'inline-block';\r\n        label.innerHTML = params.label;\r\n        (label as any).allowClick = true;\r\n        innerEl.appendChild(label);\r\n\r\n        this.check.onchange = () => {\r\n            if (params.doHighlight) {\r\n                this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\r\n            }\r\n            params.callback(this.check.checked);\r\n            setTimeout(() => {\r\n                this.check.blur();\r\n            }, 0);\r\n        };\r\n        if (params.css) {\r\n            BB.css(this.element, params.css);\r\n        }\r\n    }\r\n\r\n    getValue(): boolean {\r\n        return this.check.checked;\r\n    }\r\n\r\n    getElement(): HTMLElement {\r\n        return this.element;\r\n    }\r\n\r\n    destroy() {\r\n        this.check.onchange = null;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\n\r\nexport const input = function (params: {\r\n    type?: 'button' | 'checkbox' | 'number' | 'text'; // default text\r\n    min?: number;\r\n    max?: number;\r\n    callback: (val: string) => void;\r\n    init: string | number;\r\n    css?: IKeyString;\r\n}) {\r\n    const result = document.createElement('input');\r\n    if (params.type) {\r\n        try {\r\n            result.type = params.type;\r\n        } catch(e) {} // ie can't deal with number\r\n    } else {\r\n        result.type = 'text';\r\n    }\r\n    if (params.min !== undefined) {\r\n        result.min = '' + params.min;\r\n    }\r\n    if (params.max !== undefined) {\r\n        result.max = '' + params.max;\r\n    }\r\n    result.value = '' + params.init;\r\n    if (params.callback) {\r\n        result.onchange = function() {\r\n            params.callback(result.value);\r\n        };\r\n    }\r\n    if (params.css) {\r\n        BB.css(result, params.css);\r\n    }\r\n\r\n    return result;\r\n};","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\n\r\n/**\r\n * A select dropdown\r\n */\r\nexport class Select {\r\n\r\n    private selectEl: HTMLSelectElement;\r\n    private optionArr: ([string, string] | null)[]; // [value, label]\r\n    private changeListener: (event) => void;\r\n    private onChange: (val: string) => void;\r\n\r\n    \r\n    // --- public ---\r\n    constructor (p: {\r\n        isFocusable?: boolean; // default false\r\n        optionArr: ([string, string] | null)[], // [value, label]\r\n        initValue?: string; // default null\r\n        onChange: (val: string) => void;\r\n        css?: IKeyString;\r\n        title?: string;\r\n    }) {\r\n        this.selectEl = BB.el({\r\n            tagName: 'select',\r\n            title: p.title,\r\n            css: {\r\n                cursor: 'pointer',\r\n                fontSize: '15px',\r\n                padding: '3px',\r\n                background: '#fff', // makes safari pay attention to font-size\r\n                //webkitAppearance: 'none'\r\n                colorScheme: 'only light', // chrome doesn't properly invert the text color\r\n            }\r\n        }) as HTMLSelectElement;\r\n        if (p.css) {\r\n            BB.css(this.selectEl, p.css);\r\n        }\r\n\r\n        const isFocusable = p.isFocusable;\r\n        if (!isFocusable) {\r\n            this.selectEl.tabIndex = -1;\r\n        }\r\n        this.optionArr = p.optionArr;\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            if (this.optionArr[i] === null) {\r\n                continue;\r\n            }\r\n            const option = document.createElement('option');\r\n            option.value = this.optionArr[i][0];\r\n            option.textContent = this.optionArr[i][1];\r\n            this.selectEl.append(option);\r\n        }\r\n        this.onChange = p.onChange;\r\n        this.changeListener = (e) => {\r\n            if (!isFocusable) {\r\n                this.selectEl.blur();\r\n            }\r\n            this.onChange(this.selectEl.value);\r\n        };\r\n        this.selectEl.addEventListener('change', this.changeListener);\r\n        this.selectEl.value = 'initValue' in p ? p.initValue : null;\r\n    }\r\n\r\n    setValue (val) {\r\n        this.selectEl.value = val;\r\n    }\r\n\r\n    getValue () {\r\n        return this.selectEl.value;\r\n    }\r\n\r\n    setDeltaValue (delta) {\r\n        let index = 0;\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            if ('' + this.optionArr[i][0] === this.selectEl.value) {\r\n                index = i;\r\n                break;\r\n            }\r\n        }\r\n        index = Math.max(0, Math.min(this.optionArr.length -1, index + delta));\r\n        this.selectEl.value = this.optionArr[index][0];\r\n        this.onChange(this.selectEl.value);\r\n    }\r\n\r\n    getElement () {\r\n        return this.selectEl;\r\n    }\r\n\r\n    destroy = () => {\r\n        this.selectEl.removeEventListener('change', this.changeListener);\r\n    }\r\n    \r\n}\r\n","import {BB} from '../../../bb/bb';\r\n\r\n\r\n/**\r\n * Toggle button with an image\r\n *\r\n * p = {\r\n *     initValue: boolean,\r\n *     title: string,\r\n *     isRadio: boolean, // if true, can't click when active\r\n *     onChange: function(boolean)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const ImageToggle = function(p) {\r\n    let isActive = !!p.initValue;\r\n    const div = BB.el({\r\n        className: 'image-toggle',\r\n        title: p.title,\r\n        css: {\r\n            backgroundImage: \"url('\" + p.image + \"')\"\r\n        },\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            if (p.isRadio && isActive) {\r\n                return;\r\n            }\r\n            isActive = !isActive;\r\n            update();\r\n            p.onChange(isActive);\r\n        },\r\n    });\r\n\r\n    function update() {\r\n        div.classList.toggle('image-toggle-active', isActive);\r\n    }\r\n\r\n    update();\r\n\r\n    // --- interface ---\r\n    this.setValue = function(b) {\r\n        isActive = !!b;\r\n        update();\r\n    };\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.getValue = function() {\r\n        return isActive;\r\n    };\r\n    this.destroy = () => {\r\n        BB.destroyEl(div);\r\n    };\r\n\r\n};","import {BB} from '../../../bb/bb';\r\nimport {ImageToggle} from './image-toggle';\r\n\r\n/**\r\n * Radio input group. each one has an image\r\n *\r\n * p = {\r\n *     optionArr: {\r\n *         id: string,\r\n *         title: string,\r\n *         image: string,\r\n *     }[],\r\n *     initId: string,\r\n *     sizePx: number,\r\n *     onChange: function(id: string): void\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport const ImageRadioList = function(p) {\r\n\r\n    const div = BB.el({\r\n        className: 'image-radio-wrapper',\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n\r\n    let activeIndex;\r\n    const optionArr = [];\r\n\r\n    function select(index, id) {\r\n        activeIndex = index;\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            optionArr[i].setValue(i === activeIndex);\r\n        }\r\n        p.onChange(id);\r\n    }\r\n\r\n    function createOption(index, o) {\r\n        if (o.id === p.initId) {\r\n            activeIndex = index;\r\n        }\r\n        const radioEl = new ImageToggle({\r\n            image: o.image,\r\n            title: o.title,\r\n            initValue: o.id === p.initId,\r\n            isRadio: true,\r\n            onChange: function() {\r\n                select(index, o.id);\r\n            }\r\n        });\r\n        div.appendChild(radioEl.getElement());\r\n\r\n        return radioEl;\r\n\r\n    }\r\n\r\n    for (let i = 0; i < p.optionArr.length; i++) {\r\n        optionArr.push(createOption(i, p.optionArr[i]));\r\n    }\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.getValue = function() {\r\n        return p.optionArr[activeIndex].id;\r\n    };\r\n    this.destroy = () => {\r\n        optionArr.forEach(item => {\r\n            item.destroy();\r\n        })\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport iconImg from 'url:~/src/app/img/ui/brush-pressure.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * small toggle button with a pen icon - representing toggling pressure sensitivity\r\n * @param isChecked - boolean - initial value\r\n * @param changeCallback - function(isChecked boolean) - called on change\r\n * @returns {HTMLElement} - the toggle button\r\n */\r\nexport const penPressureToggle = function(isChecked, changeCallback) {\r\n\r\n    const toggleDiv = BB.el({\r\n        css: {\r\n            cssFloat: 'right',\r\n            borderRadius: '3px',\r\n            width: '18px',\r\n            height: '18px',\r\n            backgroundImage: 'url(\"' + iconImg + '\")',\r\n            backgroundSize: 'contain',\r\n            backgroundRepeat: 'no-repeat',\r\n            cursor: 'pointer',\r\n            boxSizing: 'border-box',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n\r\n    if (!BB.hasPointerEvents) {\r\n        toggleDiv.style.display = 'none';\r\n    }\r\n\r\n    function redraw() {\r\n        if (isChecked) {\r\n            BB.css(toggleDiv, {\r\n                backgroundColor: '#fff',\r\n                opacity: '0.9',\r\n                border: '1px solid var(--active-highlight-color)'\r\n            });\r\n        } else {\r\n            BB.css(toggleDiv, {\r\n                backgroundColor: 'transparent',\r\n                opacity: '0.5',\r\n                border: '1px solid #666'\r\n            });\r\n        }\r\n    }\r\n\r\n    toggleDiv.title = LANG('brush-toggle-pressure');\r\n    toggleDiv.onclick = function() {\r\n        isChecked = !isChecked;\r\n        redraw();\r\n        changeCallback(isChecked);\r\n    };\r\n\r\n    redraw();\r\n    changeCallback(isChecked);\r\n\r\n    return toggleDiv;\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"5H9IS\");","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport {IKlSliderConfig} from '../../kl.types';\r\nimport {languageStrings} from '../../../language/language';\r\n\r\n\r\n\r\n/**\r\n * big slider, e.g. used for brush size\r\n *\r\n * p = {\r\n *      label: 'Size',\r\n *      width: 500,\r\n *      height: 20,\r\n *      theme: 'compact-light',\r\n *      min: 0,\r\n *      max: 100,\r\n *      initValue: 10,\r\n *      resolution: 600, // if you want spline.find to use a different resolution\r\n *      curve: 'quadratic' | [...], // optional. array is BB.SplineInterpolator points. 0-1\r\n *      formatFunc: function(value) { // optional\r\n *          return Math.round(value);\r\n *      },\r\n *      onChange: function(value) {},\r\n *      isChangeOnFinal: true,\r\n *      eventResMs: 123,\r\n *      isEnabled?: boolean, // default = true\r\n * }\r\n *\r\n * Values can be spline interpolated\r\n * On change callback can be debounced\r\n *\r\n * @param p - obj\r\n * @constructor\r\n */\r\nexport const KlSlider = function (p) {\r\n    const _this = this;\r\n    let isEnabled = p.isEnabled !== false;\r\n    let useSpline = !!p.curve;\r\n    let splineInterpolator;\r\n\r\n    if (!p.label || !p.onChange) {\r\n        throw 'PcSlider missing params';\r\n    }\r\n    if (p.min != 0 && p.max != 0 && p.initValue != 0) {\r\n        if (!p.min || !p.max || !p.initValue) {\r\n            throw 'PcSlider broken params';\r\n        }\r\n    }\r\n    if (p.min >= p.max) {\r\n        throw 'PcSlider broken params';\r\n    }\r\n\r\n    const elementWidth = p.width;\r\n    const elementHeight = p.height;\r\n    const resolution = p.resolution ? p.resolution : elementWidth;\r\n    let min = p.min;\r\n    let max = p.max;\r\n    const onChange = p.onChange;\r\n    const isChangeOnFinal = !!p.isChangeOnFinal;\r\n    const formatFunc = p.formatFunc;\r\n    const eventResMs = p.eventResMs;\r\n\r\n    if (useSpline) {\r\n        const curveArr = p.curve === 'quadratic' ? BB.quadraticSplineInput(min, max, 0.1) : p.curve;\r\n        splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n    }\r\n\r\n    function toLinearValue(value) {\r\n        if (useSpline) {\r\n            return splineInterpolator.findX(value, Math.floor(resolution * 1.5));\r\n        }\r\n        return (value - min) / (max - min);\r\n    }\r\n\r\n    function toValue(pLinearValue) {\r\n        let result = min + pLinearValue * (max - min);\r\n        if (useSpline) {\r\n            result = splineInterpolator.interpolate(pLinearValue);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    const div = BB.el({\r\n        className: 'sliderWrapper',\r\n        css: {\r\n            overflow: 'hidden',\r\n            position: 'relative',\r\n            width: elementWidth + 'px',\r\n            height: elementHeight + 'px',\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    const labelCaption = p.label;\r\n    const label = document.createElement('div');\r\n    const control = document.createElement('div');\r\n    const controlInner = document.createElement('div');\r\n    let linearValue = toLinearValue(p.initValue); //0 - 1\r\n\r\n    div.appendChild(control);\r\n    div.appendChild(label);\r\n    control.appendChild(controlInner);\r\n    control.className = 'sliderInner';\r\n\r\n\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n    //control.style.backgroundColor = \"#aaa\";\r\n    label.innerHTML = labelCaption;\r\n\r\n    control.style.position = 'absolute';\r\n    control.style.left = '0';\r\n    control.style.top = '0';\r\n    control.style.width = (linearValue * elementWidth) + 'px';\r\n    control.style.height = elementHeight + 'px';\r\n\r\n    const labelFontSize = elementHeight - 14;\r\n    BB.css(label, {\r\n        position: 'absolute',\r\n        left: '7px',\r\n        top: (elementHeight / 2 - labelFontSize / 2 + 1) + 'px',\r\n        lineHeight: labelFontSize + 'px',\r\n        fontSize: labelFontSize + 'px',\r\n        pointerEvents: 'none'\r\n    });\r\n\r\n    function updateEnable (): void {\r\n        if (isEnabled) {\r\n            BB.css(div, {\r\n                opacity: null,\r\n                pointerEvents: null,\r\n            });\r\n        } else {\r\n            BB.css(div, {\r\n                opacity: '0.5',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n    }\r\n    updateEnable();\r\n\r\n    function getOutsideVal() {\r\n        let result = min + linearValue * (max - min);\r\n        if (useSpline) {\r\n            result = splineInterpolator.interpolate(linearValue);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    function updateLabel() {\r\n        let outVal = toValue(linearValue);\r\n        outVal = formatFunc ? formatFunc(outVal) : parseInt(outVal);\r\n        outVal = outVal.toLocaleString(languageStrings.getCode());\r\n        label.innerHTML = labelCaption + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + outVal + '</span>';\r\n        control.style.width = (linearValue * elementWidth) + 'px';\r\n    }\r\n\r\n    let lastCallbackTime = 0;\r\n    function emit(isFinal) {\r\n        if (!isFinal && isChangeOnFinal) {\r\n            return;\r\n        }\r\n        if (eventResMs && !isFinal) {\r\n            const now = performance.now();\r\n            if (now - lastCallbackTime >= eventResMs) {\r\n                lastCallbackTime = now;\r\n                onChange(getOutsideVal());\r\n            }\r\n        } else {\r\n            onChange(getOutsideVal());\r\n        }\r\n    }\r\n\r\n    let virtualVal;\r\n    function onPointer(event) {\r\n        event.eventPreventDefault();\r\n\r\n        if (!isEnabled) {\r\n            return;\r\n        }\r\n\r\n        if (event.type === 'pointerdown') {\r\n            div.className = 'sliderWrapper sliderWrapperActive';\r\n\r\n            if (event.button === 'left') {\r\n                linearValue = event.relX / elementWidth;\r\n                linearValue = Math.max(0, Math.min(1, linearValue));\r\n                updateLabel();\r\n                emit(false);\r\n            }\r\n            virtualVal = linearValue;\r\n        }\r\n\r\n        if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n            let deltaX = event.dX;\r\n            const deltaY = Math.abs(event.pageY - event.downPageY);\r\n            const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n            deltaX *= factor;\r\n            deltaX /= elementWidth;\r\n\r\n            virtualVal += deltaX;\r\n            linearValue = Math.max(0, Math.min(1, virtualVal));\r\n\r\n            updateLabel();\r\n            emit(false);\r\n        }\r\n\r\n        if (event.type === 'pointerup') {\r\n            div.className = 'sliderWrapper';\r\n            emit(true);\r\n        }\r\n\r\n    }\r\n\r\n    let pointerListener;\r\n    const pointerListenerTimeout = setTimeout(() => {\r\n        pointerListener = new BB.PointerListener({\r\n            target: div,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: onPointer,\r\n            onWheel: function(event) {\r\n                if (useSpline) {\r\n                    linearValue += -event.deltaY * (splineInterpolator.getLastX() - splineInterpolator.getFirstX()) / 40;\r\n                    linearValue = Math.max(splineInterpolator.getFirstX(), Math.min(splineInterpolator.getLastX(), linearValue));\r\n                } else {\r\n                    linearValue += -event.deltaY / 40;\r\n                    linearValue = Math.max(0, Math.min(1, linearValue));\r\n                }\r\n                updateLabel();\r\n                onChange(getOutsideVal());\r\n            }\r\n        });\r\n        updateLabel();\r\n    }, 1);\r\n\r\n\r\n    // --- interface ---\r\n    this.increaseValue = function (f) {\r\n        linearValue = Math.min(1, linearValue + Math.abs(f));\r\n        updateLabel();\r\n        onChange(getOutsideVal());\r\n    };\r\n    this.decreaseValue = function (f) {\r\n        linearValue = Math.max(0, linearValue - Math.abs(f));\r\n        updateLabel();\r\n        onChange(getOutsideVal());\r\n    };\r\n    this.setValue = function(v) {\r\n        linearValue = toLinearValue(v);\r\n        updateLabel();\r\n    };\r\n    this.getValue = function () {\r\n        return getOutsideVal();\r\n    };\r\n    this.update = function(config: IKlSliderConfig): void {\r\n        min = config.min;\r\n        max = config.max;\r\n        useSpline = !!config.curve;\r\n        if (useSpline) {\r\n            const curveArr = config.curve === 'quadratic' ? BB.quadraticSplineInput(min, max, 0.1) : config.curve;\r\n            splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        } else {\r\n            splineInterpolator = null;\r\n        }\r\n        _this.setIsEnabled(!config.isDisabled);\r\n    };\r\n    this.setIsEnabled = function (e: boolean): void {\r\n        isEnabled = !!e;\r\n        updateEnable();\r\n    };\r\n\r\n    this.destroy = function() {\r\n        clearTimeout(pointerListenerTimeout);\r\n        if (pointerListener) {\r\n            pointerListener.destroy();\r\n        }\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    }\r\n\r\n};","\r\n\r\n/**\r\n * to make sliders more finegrained.\r\n * @param deltaY number - how far pointer moved away vertically since down\r\n * @returns {number} the factor 0-1. 0 -> infinite movement for change of 1. 1 -> 1px for change of 1\r\n */\r\nexport const calcSliderFalloffFactor = function(deltaY, isRightButton) {\r\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\r\n    if (isRightButton) {\r\n        result *= 2;\r\n    }\r\n    return 1 / result;\r\n};\r\n","import {BB} from '../../../bb/bb';\r\nimport {input} from '../base-components/input';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n// @ts-ignore\r\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\r\n\r\n/**\r\n * dialog for manually inputting the color\r\n * @param p {color: rgbObj, onClose: function(rgbObj | null)}\r\n * @constructor\r\n */\r\nexport const HexColorDialog = function (p) {\r\n\r\n    let lastValidRgb = new BB.RGB(p.color.r, p.color.g, p.color.b);\r\n\r\n    const div = BB.el({});\r\n\r\n    const previewEl = BB.el({\r\n        css: {\r\n            width: '20px',\r\n            height: '20px',\r\n            marginBottom: '10px',\r\n            boxShadow: 'inset 0 0 0 1px #fff, 0 0 0 1px #000',\r\n            background: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.appendChild(previewEl);\r\n\r\n\r\n    // --- Hex ---\r\n    const hexRowEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginBottom: '15px'\r\n        }\r\n    });\r\n    const hexLabel = BB.el({\r\n        content: LANG('mci-hex'),\r\n        css: {\r\n            width: '60px'\r\n        }\r\n    });\r\n    const hexInput = input({\r\n        init: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n        css: {\r\n            width: '80px'\r\n        },\r\n        callback: function() {\r\n            let rgbObj = BB.ColorConverter.hexToRGB(hexInput.value);\r\n            if (rgbObj === null) {\r\n                rgbObj = lastValidRgb;\r\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n            } else {\r\n                lastValidRgb = rgbObj;\r\n            }\r\n            previewEl.style.background = '#' + BB.ColorConverter.toHexString(rgbObj);\r\n\r\n            for (let i = 0; i < rgbArr.length; i++) {\r\n                rgbArr[i].update();\r\n            }\r\n        }\r\n    });\r\n    const copyButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img src=\"' + copyImg + '\" height=\"20\"/>',\r\n        title: LANG('mci-copy'),\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            hexInput.select();\r\n            document.execCommand('copy');\r\n        }\r\n    });\r\n    hexRowEl.appendChild(hexLabel);\r\n    hexRowEl.appendChild(hexInput);\r\n    hexRowEl.appendChild(copyButton);\r\n    div.appendChild(hexRowEl);\r\n    setTimeout(function () {\r\n        hexInput.focus();\r\n        hexInput.select();\r\n    }, 0);\r\n\r\n\r\n    // --- R G B ---\r\n    function createRgbInputRow(labelStr, attributeStr) {\r\n        const result: any = {};\r\n\r\n        const rowEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '5px',\r\n            }\r\n        });\r\n        const labelEl = BB.el({\r\n            content: labelStr,\r\n            css: {\r\n                width: '60px'\r\n            }\r\n        });\r\n\r\n        const inputEl = input({\r\n            init: lastValidRgb[attributeStr],\r\n            min: 0,\r\n            max: 255,\r\n            type: 'number',\r\n            css: {\r\n                width: '80px'\r\n            },\r\n            callback: function() {\r\n                if (inputEl.value === '' || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\r\n                    result.update();\r\n                    return;\r\n                }\r\n                inputEl.value = '' + Math.round(parseFloat(inputEl.value));\r\n                lastValidRgb[attributeStr] = inputEl.value;\r\n                previewEl.style.background = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n            }\r\n        });\r\n\r\n        rowEl.appendChild(labelEl);\r\n        rowEl.appendChild(inputEl);\r\n        div.appendChild(rowEl);\r\n\r\n\r\n        result.update = function() {\r\n            inputEl.value = lastValidRgb[attributeStr];\r\n        };\r\n        result.destroy = () => {\r\n            inputEl.onchange = null;\r\n        };\r\n        return result;\r\n    }\r\n    const rgbArr = [];\r\n    rgbArr.push(createRgbInputRow(LANG('red'), 'r'));\r\n    rgbArr.push(createRgbInputRow(LANG('green'), 'g'));\r\n    rgbArr.push(createRgbInputRow(LANG('blue'), 'b'));\r\n\r\n\r\n    popup({\r\n        target: document.body,\r\n        message: `<b>${LANG('manual-color-input')}</b>`,\r\n        div: div,\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (resultStr) {\r\n            BB.destroyEl(copyButton);\r\n            rgbArr.forEach(item => item.destroy());\r\n            rgbArr.splice(0, rgbArr.length);\r\n\r\n            p.onClose(resultStr === 'Ok' ? BB.ColorConverter.hexToRGB(hexInput.value) : null);\r\n        }\r\n    });\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"la7yv\");","import {BB} from '../../../bb/bb';\r\nimport {HexColorDialog} from '../modals/color-slider-hex-dialog';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\n// @ts-ignore\r\nimport eyedropperImg from 'url:~/src/app/img/ui/tool-picker.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * big main HS+V color slider\r\n * 2 elements: slider, and colorpreview(output) + eyedropper\r\n *\r\n * p = {\r\n *     width: number,\r\n *     height: number, // hue slider and output height\r\n *     svHeight: number,\r\n *     startValue: rgb, // 0-255\r\n *     onPick: function(rgb)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const KlColorSlider = function (p) {\r\n\r\n    const _this = this;\r\n    let pickCallback = function(result?) {};\r\n    const div = document.createElement('div');\r\n    div.style.position = 'relative';\r\n    div.className = 'colorSlider';\r\n    const outputDiv = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center'\r\n        }\r\n    });\r\n    const width = p.width;\r\n    let svHeight = p.svHeight;\r\n    const height = p.height;\r\n    const emitColor = p.onPick;\r\n\r\n    let primaryColorRGB = {\r\n        r: parseInt(p.startValue.r, 10),\r\n        g: parseInt(p.startValue.g, 10),\r\n        b: parseInt(p.startValue.b, 10)\r\n    };\r\n    let primaryColorHSV = BB.ColorConverter.toHSV(p.startValue); // BB.HSV\r\n    let secondaryColorRGB = {r: 255, g: 255, b: 255};\r\n    let secondaryColorHSV = BB.ColorConverter._RGBtoHSV(secondaryColorRGB); // BB.HSV\r\n\r\n    const svWrapper = BB.el({});\r\n    const svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"> <defs> <linearGradient id=\"value\" gradientTransform=\"rotate(90)\"> <stop offset=\"0\" stop-color=\"rgba(0,0,0,0)\"/> <stop offset=\"100%\" stop-color=\"rgba(0,0,0,1)\"/> </linearGradient> <linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"> <stop offset=\"0\" stop-color=\"#fff\"/> <stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/> </linearGradient> </defs> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\"/></svg>', 'image/svg+xml').documentElement;\r\n    const hueStop = (svSvg as any).getElementById('hue-stop');\r\n    BB.setAttributes(hueStop, {\r\n        'stop-color': '#f0f'\r\n    });\r\n    BB.css(svSvg, {\r\n        width: width + 'px',\r\n        height: svHeight + 'px'\r\n    });\r\n    svWrapper.appendChild(svSvg);\r\n\r\n    const divH = document.createElement('div');\r\n    BB.css(divH, {\r\n        position: 'relative',\r\n        height: height + 'px'\r\n    });\r\n    const divPreview = document.createElement('div');\r\n    const controlH = document.createElement('div');\r\n\r\n    const enabled = true;\r\n\r\n    function updatePrimaryHSV(hsv) {\r\n        if (hsv.s === 0) {\r\n            primaryColorHSV = new BB.HSV(primaryColorHSV.h, hsv.s, hsv.v);\r\n        } else {\r\n            primaryColorHSV = new BB.HSV(hsv.h, hsv.s, hsv.v);\r\n        }\r\n    }\r\n\r\n    function createHueBg(targetEl) {\r\n        const im = new Image();\r\n        BB.css(im, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            display: 'none',\r\n            pointerEvents: 'none'\r\n        });\r\n        const cv = BB.canvas(width, height);\r\n        const ctx = cv.getContext('2d');\r\n        const gradH = ctx.createLinearGradient(0, 0, width, 0);\r\n        for (let i = 0; i < 1; i += 0.01) {\r\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n            let ha = (parseInt('' + col.r)).toString(16);\r\n            let hb = (parseInt('' + col.g)).toString(16);\r\n            let hc = (parseInt('' + col.b)).toString(16);\r\n            if (ha.length === 1)\r\n                ha = '0' + ha;\r\n            if (hb.length === 1)\r\n                hb = '0' + hb;\r\n            if (hc.length === 1)\r\n                hc = '0' + hc;\r\n            gradH.addColorStop(i, '#' + ha + hb + hc);\r\n        }\r\n        ctx.fillStyle = gradH;\r\n        ctx.fillRect(0, 0, width, height);\r\n\r\n        targetEl.appendChild(im);\r\n        im.alt = 'hue';\r\n        im.src = cv.toDataURL('image/png');\r\n        im.style.display = 'block';\r\n    }\r\n\r\n\r\n    function updateSVCanvas() {\r\n        const rgb = BB.ColorConverter.toRGB(new BB.HSV(primaryColorHSV.h, 100, 100));\r\n        BB.setAttributes(hueStop, {\r\n            'stop-color': '#' + BB.ColorConverter.toHexString(rgb)\r\n        });\r\n    }\r\n\r\n    function updateSVPointer() {\r\n\r\n        const left = primaryColorHSV.s / 100 * width - 7;\r\n        const top = (1 - primaryColorHSV.v / 100) * svHeight - 6;\r\n        BB.css(pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px'\r\n        });\r\n    }\r\n\r\n    function setColPreview() {\r\n        divPreview.style.backgroundColor = 'rgb(' + primaryColorRGB.r + ',' + primaryColorRGB.g + ',' + primaryColorRGB.b + ')';\r\n\r\n        if (BB.testIsWhiteBestContrast(primaryColorRGB)) {\r\n            BB.css(pickerButton, {\r\n                filter: 'invert(1)'\r\n            });\r\n            BB.css(hexButton, {\r\n                filter: 'invert(1)'\r\n            });\r\n        } else{\r\n            BB.css(pickerButton, {\r\n                filter: ''\r\n            });\r\n            BB.css(hexButton, {\r\n                filter: ''\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    updateSVCanvas();\r\n    div.style.width = width + 'px';\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    const SVContainer = document.createElement('div');\r\n    BB.css(SVContainer, {\r\n        width: width + 'px',\r\n        height: svHeight + 'px',\r\n        overflow: 'hidden',\r\n        display: 'block',\r\n        position: 'relative',\r\n        cursor: 'crosshair',\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\r\n    });\r\n\r\n    const pointerSV = document.createElement('div');\r\n    BB.css(pointerSV, {\r\n        width: '12px',\r\n        height: '12px',\r\n        borderRadius: '6px',\r\n        position: 'absolute',\r\n        pointerEvents: 'none',\r\n        boxShadow: '0px 0px 0 1px #000, inset 0px 0px 0 1px #fff'\r\n    });\r\n\r\n    SVContainer.appendChild(svWrapper);\r\n    SVContainer.appendChild(pointerSV);\r\n    updateSVPointer();\r\n    div.appendChild(SVContainer);\r\n    div.appendChild(divH);\r\n    outputDiv.appendChild(divPreview);\r\n    BB.css(divPreview, {\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        width: (height * 2.5) + 'px',\r\n        height: height + 'px',\r\n        //position: \"relative\",\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\r\n        colorScheme: 'only light',\r\n    });\r\n\r\n    BB.css(divH, {\r\n        overflow: 'hidden',\r\n        position: 'relative',\r\n        width: width + 'px',\r\n        height: height + 'px',\r\n        cursor: 'ew-resize',\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\r\n        marginTop: '1px',\r\n        marginBottom: '1px'\r\n    });\r\n\r\n    //divH.className = \"svSlider\";\r\n    BB.css(controlH, {\r\n        width: '1px',\r\n        height: height + 'px',\r\n        background: '#000',\r\n        borderLeft: '1px solid #fff',\r\n        position: 'absolute',\r\n        top: '0',\r\n        left: parseInt('' + (primaryColorHSV.h / 360 * width - 1)) + 'px'\r\n    });\r\n\r\n\r\n    const virtualHSV = {\r\n        h: 0,\r\n        s: 0,\r\n        v: 0\r\n    };\r\n    let svPointerListener;\r\n    let hPointerListener;\r\n\r\n\r\n    const pickerButton = BB.el({\r\n        title: LANG('eyedropper') + ' [Alt]',\r\n        className: 'color-picker-preview-button',\r\n        css: {\r\n            width: '30px',\r\n            height: '30px',\r\n            backgroundImage: 'url(' + eyedropperImg + ')',\r\n            backgroundRepeat:  'no-repeat',\r\n            backgroundSize: '70%',\r\n            backgroundPosition: 'center'\r\n        }\r\n    });\r\n    let isPicking = false;\r\n\r\n\r\n    pickerButton.onclick = function () {\r\n        if (isPicking === false) {\r\n            pickerButton.classList.remove('color-picker-preview-button-hover');\r\n            pickerButton.classList.add('color-picker-preview-button-active');\r\n            isPicking = true;\r\n            pickCallback(true);\r\n        } else {\r\n            pickCallback(false);\r\n            _this.pickingDone();\r\n        }\r\n    };\r\n    const pickerButtonPointerListener = new BB.PointerListener({\r\n        target: pickerButton,\r\n        onEnterLeave: function(isOver) {\r\n            if (isPicking) {\r\n                return;\r\n            }\r\n            pickerButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n        }\r\n    });\r\n    divPreview.appendChild(pickerButton);\r\n\r\n\r\n    const hexButton = BB.el({\r\n        content: '#',\r\n        className: 'color-picker-preview-button',\r\n        title: LANG('manual-color-input'),\r\n        css: {\r\n            height: '100%',\r\n            width: height + 'px',\r\n            lineHeight: height + 'px',\r\n            fontSize: (height * 0.65) + 'px'\r\n        },\r\n        onClick: function() {\r\n            HexColorDialog({\r\n                color: new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b),\r\n                onClose: function(rgbObj) {\r\n                    if (!rgbObj) {\r\n                        return;\r\n                    }\r\n                    _this.setColor(rgbObj);\r\n                    emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\r\n                }\r\n            });\r\n        }\r\n    });\r\n    const hexButtonPointerListener = new BB.PointerListener({\r\n        target: hexButton,\r\n        onEnterLeave: function(isOver) {\r\n            hexButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n        }\r\n    });\r\n    divPreview.appendChild(hexButton);\r\n\r\n    setColPreview();\r\n\r\n\r\n    setTimeout(function() {\r\n        createHueBg(divH);\r\n        divH.appendChild(controlH);\r\n        svPointerListener = new BB.PointerListener({\r\n            target: svWrapper,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown') {\r\n                    BB.css(SVContainer, {\r\n                        boxShadow: '0px 0px 0px 1px rgb(255,255,255)',\r\n                        zIndex: '1'\r\n                    });\r\n\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.s = event.relX / width * 100;\r\n                        virtualHSV.v = 100 - event.relY / svHeight * 100;\r\n\r\n                        primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n\r\n                        updateSVPointer();\r\n                        setColPreview();\r\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n                    } else {\r\n                        virtualHSV.s = primaryColorHSV.s;\r\n                        virtualHSV.v = primaryColorHSV.v;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                    let factor = 1;\r\n                    if (event.button === 'right') {\r\n                        factor = 0.5;\r\n                    }\r\n\r\n                    virtualHSV.s += event.dX / width * 100 * factor;\r\n                    virtualHSV.v -= event.dY / svHeight * 100 * factor;\r\n\r\n                    primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                    updateSVPointer();\r\n                    setColPreview();\r\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n\r\n                }\r\n\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(SVContainer, {\r\n                        boxShadow: '0 0 0 1px rgb(188, 188, 188)',\r\n                        zIndex: '0'\r\n                    });\r\n                }\r\n\r\n            }\r\n        });\r\n        hPointerListener = new BB.PointerListener({\r\n            target: divH,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n\r\n                if (event.type === 'pointerdown') {\r\n                    BB.css(divH, {\r\n                        boxShadow: '0px 0px 0px 1px rgba(255,255,255,1)'\r\n                    });\r\n\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.h = event.relX / width * 359.99;\r\n\r\n                        primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\r\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                        controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\r\n                        updateSVCanvas();\r\n                        setColPreview();\r\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n                    } else {\r\n                        virtualHSV.h = primaryColorHSV.h;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                    const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                    const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                    virtualHSV.h += event.dX / width * 359.99 * factor;\r\n\r\n                    if (event.button === 'right') {\r\n                        virtualHSV.h = virtualHSV.h % 359.99;\r\n                        if (virtualHSV.h < 0) {\r\n                            virtualHSV.h += 359.99;\r\n                        }\r\n                    }\r\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                    primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\r\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                    controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\r\n                    updateSVCanvas();\r\n                    setColPreview();\r\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n\r\n                }\r\n\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(divH, {\r\n                        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    }, 1);\r\n\r\n\r\n    // --- second color ---\r\n\r\n    const secondaryColorBtn = BB.el({\r\n        parent: outputDiv,\r\n        title: LANG('secondary-color') + ' [X]',\r\n        css: {\r\n            cursor: 'pointer',\r\n            marginLeft: '5px',\r\n            width: '22px',\r\n            height: '22px',\r\n            boxShadow: 'rgb(188, 188, 188) 0px 0px 0px 1px',\r\n            colorScheme: 'only light',\r\n        },\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            swapColors();\r\n        }\r\n    });\r\n    function updateSecondaryColor() {\r\n        secondaryColorBtn.style.backgroundColor = BB.ColorConverter.toRgbStr(secondaryColorRGB);\r\n    }\r\n    function swapColors() {\r\n        // swap hsv\r\n        let tmp: any = secondaryColorHSV;\r\n        secondaryColorHSV = primaryColorHSV;\r\n        updatePrimaryHSV(tmp);\r\n        // swap rgb\r\n        tmp = secondaryColorRGB;\r\n        secondaryColorRGB = primaryColorRGB;\r\n        primaryColorRGB = tmp;\r\n\r\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\r\n        updateSVCanvas();\r\n        updateSVPointer();\r\n        setColPreview();\r\n        updateSecondaryColor();\r\n\r\n        emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\r\n    }\r\n    updateSecondaryColor();\r\n\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.setColor = function (c) {\r\n        primaryColorRGB = {r: parseInt(c.r, 10), g: parseInt(c.g, 10), b: parseInt(c.b, 10)};\r\n        updatePrimaryHSV(BB.ColorConverter.toHSV(c));\r\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\r\n        updateSVCanvas();\r\n        updateSVPointer();\r\n        setColPreview();\r\n    };\r\n\r\n    this.getColor = function () {\r\n        return new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b);\r\n    };\r\n\r\n    this.getSecondaryRGB = function() {\r\n        return new BB.RGB(secondaryColorRGB.r, secondaryColorRGB.g, secondaryColorRGB.b);\r\n    };\r\n\r\n    this.setPickCallback = function (func) {\r\n        pickCallback = func;\r\n    };\r\n\r\n    this.pickingDone = function () {\r\n        if (!isPicking) {\r\n            return;\r\n        }\r\n        isPicking = false;\r\n        pickerButton.classList.remove('color-picker-preview-button-active');\r\n    };\r\n\r\n    this.enable = function (e) {\r\n        if (e) {\r\n            div.style.pointerEvents = '';\r\n            div.style.opacity = '1';\r\n            outputDiv.style.pointerEvents = '';\r\n            outputDiv.style.opacity = '1';\r\n        } else {\r\n            div.style.pointerEvents = 'none';\r\n            div.style.opacity = '0.5';\r\n            outputDiv.style.pointerEvents = 'none';\r\n            outputDiv.style.opacity = '0.5';\r\n        }\r\n    };\r\n\r\n    this.setHeight = function (h) {\r\n        h = parseInt('' +(h - height * 2 - 3), 10);\r\n        if (h === svHeight) {\r\n            return;\r\n        }\r\n        svHeight = h;\r\n        BB.css(svSvg, {\r\n            width: width + 'px',\r\n            height: svHeight + 'px'\r\n        });\r\n        SVContainer.style.height = svHeight + 'px';\r\n        updateSVPointer();\r\n    };\r\n\r\n    this.swapColors = function() {\r\n        swapColors();\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.getOutputElement = function() {\r\n        return outputDiv;\r\n    }\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cTtMO\");","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\n\r\n\r\n/**\r\n * a small color slider\r\n *\r\n * params {\r\n * \t width: 200,\r\n * \t heightSV: 200,\r\n * \t heightH: 10,\r\n * \t color: {r,g,b}\r\n * \t callback: function(c){}\r\n * }\r\n *\r\n * @param params\r\n * @constructor\r\n */\r\nexport const KlSmallColorSlider = function (params) {\r\n    const div = document.createElement('div');\r\n    div.oncontextmenu = function(e) {\r\n        e.preventDefault();\r\n    };\r\n    let color = BB.ColorConverter.toHSV(new BB.RGB(params.color.r, params.color.g, params.color.b));\r\n    BB.css(div, {\r\n        width: params.width + 'px',\r\n        position: 'relative',\r\n        overflow: 'hidden',\r\n        userSelect: 'none'\r\n    });\r\n\r\n    const canvasSV = BB.canvas(10, 10);\r\n    canvasSV.style.width = params.width + 'px';\r\n    canvasSV.style.height = params.heightSV + 'px';\r\n    canvasSV.style.cursor = 'crosshair';\r\n\r\n    function updateSV() {\r\n        const ctx = canvasSV.getContext('2d');\r\n        for (let i = 0; i < canvasSV.height; i += 1) {\r\n            const gradient1 = ctx.createLinearGradient(0, 0, canvasSV.width, 0);\r\n\r\n            const colleft = BB.ColorConverter.toRGB(new BB.HSV(color.h, 1, 100 - (i / canvasSV.height * 100.0)));\r\n            const colright = BB.ColorConverter.toRGB(new BB.HSV(color.h, 100, 100 - (i / canvasSV.height * 100.0)));\r\n            gradient1.addColorStop(0, '#' + BB.ColorConverter.toHexString(colleft));\r\n            gradient1.addColorStop(1, '#' + BB.ColorConverter.toHexString(colright));\r\n            ctx.fillStyle = '#ff0000'; //needed for chrome...otherwise alpha problem\r\n            ctx.fillStyle = gradient1;\r\n            ctx.fillRect(0, i, canvasSV.width, 1);\r\n        }\r\n    }\r\n\r\n    updateSV();\r\n\r\n    const canvasH = BB.canvas(params.width, params.heightH);\r\n    canvasH.style.cursor = 'ew-resize';\r\n    (function () {\r\n        const ctx = canvasH.getContext('2d');\r\n\r\n        const gradH = ctx.createLinearGradient(0, 0, params.width, 0);\r\n        for (let i = 0; i < 1; i += 0.01) {\r\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n            gradH.addColorStop(i, 'rgba(' + parseInt('' + col.r) + ', ' + parseInt('' + col.g) + ', ' + parseInt('' + col.b) + ', 1)');\r\n        }\r\n        ctx.fillStyle = gradH;\r\n        ctx.fillRect(0, 0, params.width, params.heightH);\r\n\r\n    })();\r\n    BB.css(canvasSV, {\r\n        width: params.width + 'px',\r\n        height: params.heightSV + 'px',\r\n        overflow: 'hidden',\r\n        position: 'relative'\r\n    });\r\n    canvasSV.style.cssFloat = 'left';\r\n    canvasH.style.cssFloat = 'left';\r\n\r\n    div.appendChild(canvasSV);\r\n    div.appendChild(canvasH);\r\n\r\n    const pointerSV = document.createElement('div');\r\n    BB.css(pointerSV, {\r\n        width: '8px',\r\n        height: '8px',\r\n        borderRadius: '8px',\r\n        position: 'absolute',\r\n        pointerEvents: 'none',\r\n        boxShadow: '0 0 0 1px #000, inset 0 0 0 1px #fff'\r\n    });\r\n    div.appendChild(pointerSV);\r\n\r\n    const pointerH = document.createElement('div');\r\n    BB.css(pointerH, {\r\n        width: '0',\r\n        height: params.heightH + 'px',\r\n        borderLeft: '1px solid #fff',\r\n        borderRight: '1px solid #000',\r\n        position: 'absolute',\r\n        top: params.heightSV + 'px',\r\n        pointerEvents: 'none'\r\n    });\r\n    div.appendChild(pointerH);\r\n\r\n\r\n    function updateSVPointer() {\r\n        const left = color.s / 100 * params.width - 4;\r\n        const top = (1 - color.v / 100) * params.heightSV - 4;\r\n        BB.css(pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px'\r\n        });\r\n        /*if (top < params.heightSV/3) {\r\n        pointerSV.style.border = \"1px solid rgba(0,0,0,1)\";\r\n    } else {\r\n        pointerSV.style.border = \"1px solid rgba(255,255,255,1)\";\r\n    }*/\r\n    }\r\n\r\n    function updateHPointer() {\r\n        pointerH.style.left = (color.h / 359.999 * params.width - 1) + 'px';\r\n    }\r\n\r\n    updateSVPointer();\r\n    updateHPointer();\r\n\r\n    const virtualHSV = {\r\n        h: 0,\r\n        s: 0,\r\n        v: 0\r\n    };\r\n\r\n    let svPointerId = null;\r\n    const svPointerListener = new BB.PointerListener({\r\n        target: canvasSV,\r\n        maxPointers: 1,\r\n        fixScribble: true,\r\n        onPointer: function(event) {\r\n\r\n            if (event.type === 'pointerdown') {\r\n                svPointerId = event.pointerId;\r\n                if (event.button === 'left') {\r\n\r\n                    virtualHSV.s = event.relX / params.width * 100;\r\n                    virtualHSV.v = 100 - event.relY / params.heightSV * 100;\r\n\r\n                    color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\r\n\r\n                    updateSVPointer();\r\n                    params.callback(BB.ColorConverter.toRGB(color));\r\n                } else {\r\n                    virtualHSV.s = color.s;\r\n                    virtualHSV.v = color.v;\r\n                }\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && svPointerId === event.pointerId) {\r\n\r\n                let factor = 1;\r\n                if (event.button === 'right') {\r\n                    factor = 0.5;\r\n                }\r\n\r\n                virtualHSV.s += event.dX / params.width * 100 * factor;\r\n                virtualHSV.v -= event.dY / params.heightSV * 100 * factor;\r\n\r\n                color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\r\n                updateSVPointer();\r\n                params.callback(BB.ColorConverter.toRGB(color));\r\n\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                svPointerId = null;\r\n            }\r\n\r\n        }\r\n    });\r\n\r\n    let hPointerId = null;\r\n    const hPointerListener = new BB.PointerListener({\r\n        target: canvasH,\r\n        maxPointers: 1,\r\n        fixScribble: true,\r\n        onPointer: function(event) {\r\n\r\n            if (event.type === 'pointerdown') {\r\n                hPointerId = event.pointerId;\r\n                if (event.button === 'left') {\r\n\r\n                    virtualHSV.h = event.relX / params.width * 359.99;\r\n\r\n                    color = new BB.HSV(virtualHSV.h, color.s, color.v);\r\n                    updateSV();\r\n                    updateHPointer();\r\n                    params.callback(BB.ColorConverter.toRGB(color));\r\n                } else {\r\n                    virtualHSV.h = color.h;\r\n                }\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && hPointerId === event.pointerId) {\r\n\r\n                const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                virtualHSV.h += event.dX / params.width * 359.99 * factor;\r\n\r\n                if (event.button === 'right') {\r\n                    virtualHSV.h = virtualHSV.h % 359.99;\r\n                    if (virtualHSV.h < 0) {\r\n                        virtualHSV.h += 359.99;\r\n                    }\r\n                }\r\n                virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                color = new BB.HSV(virtualHSV.h, color.s, color.v);\r\n                updateSV();\r\n                updateHPointer();\r\n                params.callback(BB.ColorConverter.toRGB(color));\r\n\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                hPointerId = null;\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    const cleardiv = document.createElement('div');\r\n    cleardiv.style.clear = 'both';\r\n    div.appendChild(cleardiv);\r\n\r\n    // --- interface ---\r\n    this.setColor = function (c) {\r\n        color = BB.ColorConverter.toHSV(new BB.RGB(c.r, c.g, c.b));\r\n        updateSV();\r\n        updateSVPointer();\r\n        updateHPointer();\r\n    };\r\n    this.getColor = function () {\r\n        return BB.ColorConverter.toRGB(color);\r\n    };\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.destroy = function() {\r\n        svPointerListener.destroy();\r\n        hPointerListener.destroy();\r\n    };\r\n    this.end = function() {\r\n        svPointerId = null;\r\n        hPointerId = null;\r\n    };\r\n\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n\r\n/**\r\n * a slider that looks like this\r\n * ------O----\r\n *\r\n * param: {init, width, pointSize, callback(value, isFirst, isLast)}\r\n *\r\n * @param param\r\n * @constructor\r\n */\r\nexport const PointSlider = function(param) {\r\n\r\n    const div = document.createElement('div');\r\n    div.style.position = 'relative';\r\n    const sliderLine = BB.el({});\r\n    const sliderPoint = BB.el({\r\n        css: {\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.appendChild(sliderLine);\r\n    div.appendChild(sliderPoint);\r\n    let sliderPos;\r\n    let isDragging = false;\r\n\r\n    //sliderLine\r\n    {\r\n        BB.css(sliderLine, {\r\n            marginTop: parseInt('' + (param.pointSize / 2 - 1)) + 'px',\r\n            height: '2px',\r\n            background: '#aaa',\r\n            width: param.width + 'px'\r\n        });\r\n    }\r\n    //sliderPoint\r\n    const touchAreaEl = BB.el({ // expand clickable area\r\n        parent: sliderPoint,\r\n        css: {\r\n            // background: 'rgba(255,0,0,0.4)',\r\n            margin: '-7px 0 0 -7px',\r\n            width: 'calc(100% + 14px)',\r\n            height: 'calc(100% + 7px)',\r\n        }\r\n    });\r\n\r\n    function redrawPoint() {\r\n        sliderPoint.style.left = sliderPos + 'px';\r\n        if (isDragging) {\r\n            sliderPoint.style.boxShadow = '0 0 6px rgba(0,0,0,1)';\r\n        } else {\r\n            sliderPoint.style.boxShadow = '0 0 3px rgba(0,0,0,0.8)';\r\n        }\r\n    }\r\n    function getValue() {\r\n        return sliderPos /  (param.width - param.pointSize);\r\n    }\r\n\r\n    let pointerListener;\r\n    {\r\n        let isFirst;\r\n        sliderPos = BB.clamp(param.init * (param.width - param.pointSize), 0, param.width - param.pointSize);\r\n        BB.css(sliderPoint, {\r\n            position: 'absolute',\r\n            top: '0px',\r\n            backgroundColor: '#eaeaea',\r\n            boxShadow: '0 0 3px rgba(0,0,0,0.8)',\r\n            width: param.pointSize + 'px',\r\n            height: param.pointSize + 'px',\r\n            borderRadius: param.pointSize + 'px',\r\n            cursor: 'ew-resize',\r\n            transition: 'box-shadow 0.2s ease-in-out'\r\n        });\r\n        redrawPoint();\r\n        let imaginaryPos;\r\n        pointerListener = new BB.PointerListener({\r\n            target: sliderPoint,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    isFirst = true;\r\n                    isDragging = true;\r\n                    imaginaryPos = sliderPos;\r\n                    redrawPoint();\r\n                    event.eventStopPropagation();\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                    event.eventStopPropagation();\r\n                    imaginaryPos = imaginaryPos + event.dX;\r\n                    sliderPos = parseInt('' + BB.clamp(imaginaryPos, 0, param.width - param.pointSize));\r\n                    redrawPoint();\r\n                    param.callback(getValue(), isFirst, false);\r\n                    isFirst = false;\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    event.eventStopPropagation();\r\n                    isDragging = false;\r\n                    redrawPoint();\r\n                    param.callback(getValue(), false, true);\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    // --- interface ---\r\n    this.getEl = function() {\r\n        return div;\r\n    };\r\n    this.setActive = function(isActive) {\r\n        if (isActive) {\r\n            sliderPoint.style.backgroundColor = '#fff';\r\n        } else {\r\n            sliderPoint.style.backgroundColor = '#eaeaea';\r\n        }\r\n    };\r\n    this.destroy = function() {\r\n        pointerListener.destroy();\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * UI to pick between colors in colorArr. can display full transparent (checkerboard).\r\n * Can't deal with 0.5 alpha.\r\n * Rectangular buttons.\r\n *\r\n * p = {\r\n *     colorArr: rgba[], // duplicates are removed\r\n *     onChange: func(rgbaObj),\r\n *     label: string,\r\n *     initialIndex: int// optional, index before duplicates were removed\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const ColorOptions = function(p) {\r\n    const div = BB.el({\r\n        content: p.label ? p.label : '',\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n\r\n    let selectedIndex = 0;\r\n    const colorArr = [];\r\n    const buttonArr = [];\r\n    const buttonSize = 22;\r\n    const checkerUrl = BB.createCheckerDataUrl(5);\r\n\r\n    // build colorArr while removing duplicates\r\n    for (let i = 0; i < p.colorArr.length; i++) {\r\n        const item = p.colorArr[i];\r\n        let found = false;\r\n        for (let e = 0; e < colorArr.length; e++) {\r\n            const sItem = colorArr[e];\r\n            if (sItem === null || item === null) {\r\n                continue;\r\n            }\r\n            if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\r\n                found = true;\r\n                break;\r\n            }\r\n        }\r\n        if (found) {\r\n            continue;\r\n        }\r\n        colorArr.push(item);\r\n        if ('initialIndex' in p && p.initialIndex === i) {\r\n            selectedIndex = colorArr.length - 1;\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < colorArr.length; i++) {\r\n        (function(i) {\r\n\r\n            const colorButton = BB.el({\r\n                content: colorArr[i] ? '' : 'X',\r\n                css: {\r\n                    width: buttonSize + 'px',\r\n                    height: buttonSize + 'px',\r\n                    backgroundColor: colorArr[i] ? BB.ColorConverter.toRgbaStr(colorArr[i]) : 'transparent',\r\n                    marginLeft: '7px',\r\n                    boxShadow: '0 0 0 1px #aaa',\r\n                    cursor: 'pointer',\r\n                    userSelect: 'none',\r\n                    textAlign: 'center',\r\n                    lineHeight: (buttonSize + 1) + 'px',\r\n                    color: '#aaa'\r\n                }\r\n            });\r\n            if (colorArr[i] && colorArr[i].a === 0) {\r\n                colorButton.style.backgroundImage = 'url(' + checkerUrl + ')';\r\n            }\r\n\r\n            colorButton.onclick = function(e) {\r\n                e.preventDefault();\r\n                selectedIndex = i;\r\n                update();\r\n                p.onChange(colorArr[i]);\r\n            };\r\n\r\n            (colorButton as any).setIsSelected = function(b) {\r\n                if (b) {\r\n                    BB.css(colorButton, {\r\n                        boxShadow: '0 0 0 2px var(--active-highlight-color), 0 0 5px 0 var(--active-highlight-color)',\r\n                        pointerEvents: 'none'\r\n                    });\r\n                } else {\r\n                    BB.css(colorButton, {\r\n                        boxShadow: '0 0 0 1px #aaa',\r\n                        pointerEvents: ''\r\n                    });\r\n                }\r\n            };\r\n\r\n\r\n            div.appendChild(colorButton);\r\n            buttonArr.push(colorButton);\r\n        })(i);\r\n    }\r\n\r\n\r\n    function update() {\r\n        for (let i = 0; i < buttonArr.length; i++) {\r\n            buttonArr[i].setIsSelected(i === selectedIndex);\r\n        }\r\n    }\r\n    update();\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.destroy = () => {\r\n        buttonArr.forEach(item => {\r\n            item.onclick = null;\r\n        });\r\n        buttonArr.splice(0, buttonArr.length);\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * selectable options\r\n * p = {\r\n *     optionArr: {\r\n *          id: string,\r\n *          label: string | HTMLElement\r\n *     }[],\r\n *     initialId?: string,\r\n *     onChange: function(id string): void,\r\n *     changeOnInit?: boolean, // trigger change on creation\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const Options = function(p) {\r\n    const div = BB.el({});\r\n\r\n    const wrapperEl = BB.el({\r\n        parent: div,\r\n        className: 'kl-option-wrapper',\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n\r\n    const optionArr: {\r\n        id: string;\r\n        el: HTMLElement;\r\n    }[] = [];\r\n    let selectedId = 'initialId' in p ? p.initialId : p.optionArr[0].id;\r\n\r\n    function createOption(o) {\r\n        const optionObj = {\r\n            id: o.id,\r\n            el: null,\r\n        };\r\n\r\n        const classArr = ['kl-option'];\r\n        if (p.isSmall) {\r\n            classArr.push('kl-option--small');\r\n        }\r\n        if (typeof o.label !== 'string') {\r\n            classArr.push('kl-option--custom-el');\r\n            BB.css(o.label, {\r\n                display: 'block',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n\r\n        optionObj.el = BB.el({\r\n            parent: wrapperEl,\r\n            content: o.label,\r\n            className: classArr.join(' '),\r\n            onClick: function() {\r\n                if (selectedId !== optionObj.id) {\r\n                    selectedId = optionObj.id;\r\n                    update();\r\n                    p.onChange(selectedId);\r\n                }\r\n            }\r\n        });\r\n\r\n        if (o.title) {\r\n            optionObj.el.title = o.title;\r\n        }\r\n\r\n        optionArr.push(optionObj);\r\n    }\r\n\r\n    function update() {\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            optionArr[i].el.classList.toggle('kl-option-selected', optionArr[i].id === selectedId);\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < p.optionArr.length; i++) {\r\n        createOption(p.optionArr[i]);\r\n    }\r\n\r\n    update();\r\n\r\n    if (p.changeOnInit) {\r\n        setTimeout(function() {\r\n            p.onChange(selectedId);\r\n        }, 0);\r\n    }\r\n\r\n    function getIndex() {\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            if (optionArr[i].id === selectedId) {\r\n                return i;\r\n            }\r\n        }\r\n    }\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.getValue = function() {\r\n        return selectedId;\r\n    }\r\n    this.next = function() {\r\n        selectedId = optionArr[(getIndex() + 1) % optionArr.length].id;\r\n        update();\r\n        p.onChange(selectedId);\r\n    };\r\n    this.previous = function() {\r\n        selectedId = optionArr[(optionArr.length + getIndex() - 1) % optionArr.length].id;\r\n        update();\r\n        p.onChange(selectedId);\r\n    };\r\n    this.destroy = () => {\r\n        optionArr.forEach(item => {\r\n            BB.destroyEl(item.el);\r\n        });\r\n        optionArr.splice(0, optionArr.length);\r\n    };\r\n};","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport angleSvg from 'url:~/src/app/img/ui/angle.svg';\r\n\r\n\r\ntype TUiState = 'left' | 'right';\r\n\r\n/**\r\n * display little messages at the top of KlWorkspace\r\n */\r\nexport class StatusOverlay {\r\n\r\n    private el: HTMLDivElement;\r\n    private innerEl: HTMLDivElement;\r\n    private angleIm: HTMLImageElement;\r\n    private innerInnerEl: HTMLDivElement;\r\n    private isWide: boolean;\r\n    private uiState: TUiState;\r\n\r\n    private timeout: number;\r\n    private timeout2: number;\r\n    private timeout3: number;\r\n\r\n    private updateUiState() {\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n        setTimeout(()=>{}, 100);\r\n        if (this.uiState === 'left') {\r\n            this.el.style.left = '271px';\r\n        } else {\r\n            this.el.style.removeProperty('left');\r\n        }\r\n    }\r\n\r\n    private init() {\r\n        this.el = BB.el({\r\n            className: \"top-overlay g-root\",\r\n            onClick: BB.handleClick,\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n        }\r\n\r\n        this.updateUiState();\r\n\r\n        this.innerEl = BB.el({\r\n            className: 'top-overlay-inner',\r\n        }) as HTMLDivElement\r\n\r\n\r\n        this.angleIm = new Image();\r\n        this.angleIm.src = angleSvg;\r\n        BB.css(this.angleIm, {\r\n            verticalAlign: 'bottom',\r\n            width: '20px',\r\n            height: '20px',\r\n            marginLeft: '5px',\r\n            borderRadius: '10px'\r\n        });\r\n\r\n        this.innerInnerEl = document.createElement('div');\r\n        this.innerInnerEl.style.display = 'inline-block';\r\n\r\n        this.innerEl.appendChild(this.innerInnerEl);\r\n        this.innerEl.appendChild(this.angleIm);\r\n        this.el.appendChild(this.innerEl);\r\n        document.body.appendChild(this.el);\r\n        this.el.style.display = \"none\";\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        this.init();\r\n    }\r\n\r\n    setWide(b: boolean) {\r\n        this.isWide = !!b;\r\n\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n            this.el.style.left = '';\r\n        } else {\r\n            this.el.style.removeProperty('width');\r\n            this.el.style.left = this.uiState === 'left' ? '271px' : '';\r\n        }\r\n    }\r\n\r\n    setUiState(state: TUiState) {\r\n        this.uiState = state;\r\n        this.updateUiState();\r\n    }\r\n\r\n    out(msg: string | {type: 'transform', angleDeg: number, scale: number}, doPulse?: boolean) {\r\n\r\n        if (msg && typeof msg === 'object') {\r\n\r\n            if (msg.type === 'transform') {\r\n                this.angleIm.style.display = 'inline-block';\r\n                this.angleIm.style.transform = 'rotate(' + msg.angleDeg + 'deg)';\r\n\r\n                if (msg.angleDeg % 90 === 0) {\r\n                    this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255, 255, 255, 0.7)';\r\n                } else {\r\n                    this.angleIm.style.boxShadow = '';\r\n                }\r\n\r\n                this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + \"%\";\r\n\r\n\r\n            } else {\r\n                this.angleIm.style.display = 'none';\r\n            }\r\n\r\n\r\n\r\n        } else if (typeof msg === 'string') {\r\n            this.angleIm.style.display = 'none';\r\n            this.innerInnerEl.innerHTML = msg;\r\n        }\r\n\r\n        if (doPulse) {\r\n            this.innerEl.style.animation = '';\r\n            setTimeout(\r\n                () => this.innerEl.style.animation = 'top-overlay-pulse 0.5s ease-out',\r\n                20\r\n            );\r\n            if (this.timeout3) {\r\n                clearTimeout(this.timeout3);\r\n            }\r\n            this.timeout3 = window.setTimeout(\r\n                () => this.innerEl.style.animation = '',\r\n                520\r\n            );\r\n        }\r\n\r\n\r\n\r\n        if (this.timeout) {\r\n            clearTimeout(this.timeout);\r\n        }\r\n        if (this.timeout2) {\r\n            clearTimeout(this.timeout2);\r\n        }\r\n        this.el.style.animationName = doPulse ? 'consoleInFast' : \"consoleIn\";\r\n        this.el.style.opacity = \"1\";\r\n        this.timeout = window.setTimeout(() => {\r\n            this.el.style.opacity = \"0\";\r\n            this.el.style.animationName = \"consoleOut\";\r\n            this.timeout2 = window.setTimeout(() => {\r\n                this.el.style.display = \"none\";\r\n                this.timeout2 = 0;\r\n            }, 450);\r\n            this.timeout = 0;\r\n        }, 1200);\r\n        this.el.style.display = \"flex\";\r\n    }\r\n\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iQ1f0\");","import {BB} from '../../../bb/bb';\r\nimport {popup} from './popup';\r\n\r\nexport function exportDialog(parent, image) {\r\n    let boxSize, aboutCloseFunc, aboutDiv, closed, aniToggle, imageContainer, coverImage, coverSize,\r\n        text, holding, aniTimeout, halfBoxSize;\r\n    boxSize = 22 * 2;\r\n    halfBoxSize = 22;\r\n    aboutCloseFunc = function () {\r\n    };\r\n    closed = false;\r\n    aniToggle = false;\r\n    aboutDiv = document.createElement(\"div\");\r\n    BB.css(aboutDiv, {\r\n        width: (7 * boxSize) + \"px\"\r\n    });\r\n\r\n    imageContainer = document.createElement(\"div\");\r\n    coverImage = new Image();\r\n    coverImage.src = image.src;\r\n\r\n    imageContainer.appendChild(coverImage);\r\n    imageContainer.appendChild(image);\r\n\r\n    BB.css(imageContainer, {\r\n        width: (6 * boxSize) + \"px\",\r\n        height: (4 * boxSize) + \"px\",\r\n        marginTop: (boxSize / 2 - 1) + \"px\",\r\n        marginLeft: (boxSize / 2 - 1) + \"px\",\r\n        position: \"relative\",\r\n        overflow: \"hidden\",\r\n        boxShadow: \"0 0 10px 4px rgba(255,255,255, 0)\",\r\n        border: \"1px solid rgba(255, 255, 255, 1)\",\r\n        transition: \"box-shadow 0.7s linear\"\r\n    });\r\n    BB.css(image, {\r\n        position: \"absolute\",\r\n        left: '0',\r\n        top: '0',\r\n        width: (6 * boxSize) + \"px\",\r\n        height: (4 * boxSize) + \"px\",\r\n        opacity: '0'\r\n    });\r\n    coverSize = {\r\n        width: (6 * boxSize),\r\n        height: (6 * boxSize / image.width) * image.height\r\n    };\r\n    if (coverSize.height < (4 * boxSize)) {\r\n        coverSize.height = (4 * boxSize);\r\n        coverSize.width = (coverSize.height / image.height) * image.width;\r\n    }\r\n    BB.css(coverImage, {\r\n        position: \"absolute\",\r\n        top: (2 * boxSize) + \"px\",\r\n        left: (3 * boxSize) + \"px\",\r\n        width: coverSize.width + \"px\",\r\n        height: coverSize.height + \"px\",\r\n        marginLeft: (-coverSize.width / 2) + \"px\",\r\n        marginTop: (-coverSize.height / 2) + \"px\"\r\n    });\r\n\r\n    function animation() {\r\n        if (closed) {\r\n            return;\r\n        }\r\n        aniToggle = !aniToggle;\r\n        if (aniToggle) {\r\n            BB.css(imageContainer, {\r\n                border: \"1px solid rgba(0, 0, 0, 1)\"\r\n            });\r\n        } else {\r\n            BB.css(imageContainer, {\r\n                border: \"1px solid rgba(200, 200, 200, 1)\"\r\n            });\r\n        }\r\n        setTimeout(animation, 510);\r\n    }\r\n\r\n    animation();\r\n\r\n    text = document.createElement(\"div\");\r\n    text.innerHTML = \"Right-Click or Press-Hold on the image, then save.\";\r\n    text.ontouchstart = function () {\r\n        return false;\r\n    };\r\n    BB.css(text, {\r\n        fontSize: (boxSize / 2.5) + \"px\",\r\n        color: \"#666\",\r\n        padding: \"10px\",\r\n        textAlign: \"center\"\r\n    });\r\n\r\n    aboutDiv.appendChild(imageContainer);\r\n    aboutDiv.appendChild(text);\r\n\r\n    holding = false;\r\n    image.ontouchstart = function () {\r\n        BB.css(imageContainer, {\r\n            boxShadow: \"0 0 10px 8px rgba(0,255,255, 1)\"\r\n        });\r\n        holding = true;\r\n        aniTimeout = setTimeout(function () {\r\n            holding = false;\r\n            BB.css(imageContainer, {\r\n                boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\r\n            });\r\n        }, 1500);\r\n    };\r\n    image.ontouchmove = function () {\r\n        BB.css(imageContainer, {\r\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\r\n        });\r\n        holding = false;\r\n        clearTimeout(aniTimeout);\r\n    };\r\n    image.ontouchend = function () {\r\n        BB.css(imageContainer, {\r\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\r\n        });\r\n        holding = false;\r\n        clearTimeout(aniTimeout);\r\n    };\r\n\r\n    popup({\r\n        target: parent,\r\n        message: \"<b>Save Image</b>\",\r\n        div: aboutDiv,\r\n        buttons: [\"Close\"],\r\n        callback: function (result) {\r\n            closed = true;\r\n        }\r\n    });\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * element that lets you crop an image and copy it via right click\r\n *\r\n * param = {\r\n *     width: number,\r\n *     height: number,\r\n *     canvas: image | canvas,\r\n *     isNotCopy: boolean,\r\n *     onChange: function(width, height)\r\n * }\r\n *\r\n * @param param object\r\n * @constructor\r\n */\r\nexport function CropCopy(param) {\r\n    const div = document.createElement('div');\r\n    BB.css(div, {\r\n        position: 'relative',\r\n        height: param.height + 'px',\r\n        width: param.width + 'px',\r\n        overflow: 'hidden',\r\n        colorScheme: 'only light',\r\n    });\r\n    div.style.position = 'relative';\r\n\r\n    let crop;\r\n    function resetCrop() {\r\n        crop = {\r\n            x: 0,\r\n            y: 0,\r\n            width: param.canvas.width,\r\n            height: param.canvas.height\r\n        };\r\n    }\r\n    resetCrop();\r\n\r\n\r\n    function updateCroppedCanvas() {\r\n        croppedCanvas.width = Math.round(crop.width);\r\n        croppedCanvas.height = Math.round(crop.height);\r\n        let ctx = croppedCanvas.getContext('2d');\r\n        ctx.drawImage(param.canvas, Math.round(-crop.x), Math.round(-crop.y));\r\n        if (croppedImage) {\r\n            croppedImage.src = croppedCanvas.toDataURL('image/png');\r\n        }\r\n\r\n        if (param.onChange) {\r\n            param.onChange(croppedCanvas.width, croppedCanvas.height);\r\n        }\r\n    }\r\n    function updateSelectionRect() {\r\n        BB.css(selectionRect, {\r\n            left: (thumbX + crop.x * scaleW) + 'px',\r\n            top: (thumbY + crop.y * scaleH) + 'px',\r\n            width: (crop.width * scaleW) + 'px',\r\n            height: (crop.height * scaleH) + 'px'\r\n        });\r\n        if (param.onChange) {\r\n            param.onChange(Math.round(crop.width), Math.round(crop.height));\r\n        }\r\n    }\r\n    function isInsideSelectionRect(p) {\r\n        let rect = {\r\n            x: Math.round(thumbX + crop.x * scaleW),\r\n            y: Math.round(thumbY + crop.y * scaleH),\r\n            width: Math.round(crop.width * scaleW),\r\n            height: Math.round(crop.height * scaleH)\r\n        };\r\n        return rect.x <= p.x && p.x <= rect.x + rect.width &&\r\n            rect.y <= p.y && p.y <= rect.y + rect.height;\r\n    }\r\n\r\n    const croppedCanvas = BB.canvas();\r\n    let eventTarget = croppedCanvas;\r\n    let croppedImage = null;\r\n    if (!param.isNotCopy) { //navigator.appName === 'Microsoft Internet Explorer') { //i would prefer not using an image\r\n        croppedImage = new Image();\r\n        eventTarget = croppedImage;\r\n    }\r\n    BB.css(eventTarget, {\r\n        height: param.height + 'px',\r\n        width: param.width + 'px'\r\n    });\r\n    div.appendChild(eventTarget);\r\n    updateCroppedCanvas();\r\n\r\n    const padding = 20;\r\n    const previewWrapper = BB.el({\r\n        css: {\r\n            width: param.width + 'px',\r\n            height: param.height + 'px',\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            pointerEvents: 'none'\r\n        }\r\n    });\r\n    div.appendChild(previewWrapper);\r\n    BB.createCheckerDataUrl(4, function(v) {\r\n        previewWrapper.style.backgroundImage = 'url('+v+')';\r\n    });\r\n\r\n    const thumbSize = BB.fitInto(param.canvas.width, param.canvas.height, param.width - padding * 2, param.height - padding * 2, 1);\r\n    const thumbCanvas = BB.canvas(Math.round(thumbSize.width), Math.round(thumbSize.height));\r\n    thumbCanvas.style.imageRendering = 'pixelated';\r\n    const scaleW = thumbCanvas.width / param.canvas.width;\r\n    const scaleH = thumbCanvas.height / param.canvas.height;\r\n    const thumbCtx = thumbCanvas.getContext('2d');\r\n    thumbCtx.imageSmoothingEnabled = false;\r\n    thumbCtx.drawImage(param.canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);\r\n    previewWrapper.appendChild(thumbCanvas);\r\n    const thumbX = parseInt('' + ((param.width - thumbCanvas.width) / 2));\r\n    const thumbY = parseInt('' + ((param.height - thumbCanvas.height) / 2));\r\n    BB.css(thumbCanvas, {\r\n        position: 'absolute',\r\n        left: thumbX + \"px\",\r\n        top: thumbY + \"px\"\r\n    });\r\n\r\n    const selectionRect = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            boxShadow: '0 0 0 1px #fff, 0 0 0 2px #000, 0 0 40px 1px #000',\r\n        }\r\n    });\r\n    previewWrapper.appendChild(selectionRect);\r\n    updateSelectionRect();\r\n\r\n\r\n    function toOriginalSpace(p) {\r\n        return {\r\n            x: BB.clamp((p.x - thumbX) / scaleW, 0, param.canvas.width),\r\n            y: BB.clamp((p.y - thumbY) / scaleH, 0, param.canvas.height),\r\n        };\r\n    }\r\n    //gen crop from thumb-space points\r\n    function genCrop(p1, p2) {\r\n        let topLeftP = {\r\n            x: Math.min(p1.x, p2.x),\r\n            y: Math.min(p1.y, p2.y)\r\n        };\r\n        let bottomRightP = {\r\n            x: Math.max(p1.x, p2.x),\r\n            y: Math.max(p1.y, p2.y)\r\n        };\r\n        let origTopLeftP = toOriginalSpace(topLeftP);\r\n        let origBottomRightP = toOriginalSpace(bottomRightP);\r\n        origTopLeftP.x = Math.floor(origTopLeftP.x);\r\n        origTopLeftP.y = Math.floor(origTopLeftP.y);\r\n        origBottomRightP.x = Math.ceil(origBottomRightP.x);\r\n        origBottomRightP.y = Math.ceil(origBottomRightP.y);\r\n        return {\r\n            x: origTopLeftP.x,\r\n            y: origTopLeftP.y,\r\n            width: origBottomRightP.x - origTopLeftP.x,\r\n            height: origBottomRightP.y - origTopLeftP.y\r\n        };\r\n    }\r\n\r\n    function isReset() {\r\n        return crop.x === 0 && crop.y === 0 && crop.width === param.canvas.width && crop.height === param.canvas.height;\r\n    }\r\n\r\n    let startP;\r\n    let startCrop = null;\r\n    let isDragging = false;\r\n    let didMove = false;\r\n    let updateCropTimeout;\r\n    const pointerListener = new BB.PointerListener({\r\n        target: eventTarget,\r\n        fixScribble: true,\r\n        onPointer: function(event) {\r\n            let fullPos;\r\n            if (event.type === 'pointerdown' && event.button === 'left') {\r\n                event.eventPreventDefault();\r\n                isDragging = true;\r\n                startP = {\r\n                    x: event.relX,\r\n                    y: event.relY\r\n                };\r\n                if (!isReset() && isInsideSelectionRect(startP)) {\r\n                    startCrop = {\r\n                        x: crop.x,\r\n                        y: crop.y,\r\n                        width: crop.width,\r\n                        height: crop.height\r\n                    };\r\n                } else {\r\n                    crop = genCrop(startP, startP);\r\n                }\r\n            } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                event.eventPreventDefault();\r\n                didMove = true;\r\n                if (startCrop) {\r\n                    crop.x = startCrop.x + Math.round((event.relX - startP.x) / scaleW);\r\n                    crop.y = startCrop.y + Math.round((event.relY - startP.y) / scaleH);\r\n                    crop.x = BB.clamp(crop.x, 0, param.canvas.width - crop.width);\r\n                    crop.y = BB.clamp(crop.y, 0, param.canvas.height - crop.height);\r\n                } else {\r\n                    crop = genCrop(startP, {x: event.relX, y: event.relY});\r\n                }\r\n                updateSelectionRect();\r\n            } else if (event.type === 'pointerup' && startP) {\r\n                event.eventPreventDefault();\r\n                isDragging = false;\r\n                startCrop = null;\r\n                startP = null;\r\n                if (crop.width === 0 || crop.height === 0 || !didMove) {\r\n                    resetCrop();\r\n                    updateSelectionRect();\r\n                }\r\n                didMove = false;\r\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e, comboStr) {\r\n            if (isDragging) {\r\n                return;\r\n            }\r\n            let doUpdate = false;\r\n\r\n            let stepSize = Math.max(1, 1 / scaleW);\r\n            let shiftIsPressed = keyListener.isPressed('shift');\r\n\r\n            if (keyStr === 'left') {\r\n                if (shiftIsPressed) {\r\n                    crop.width = BB.clamp(crop.width - stepSize, 1, param.canvas.width - crop.x);\r\n                } else {\r\n                    crop.x = BB.clamp(crop.x - stepSize, 0, param.canvas.width - crop.width);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n            if (keyStr === 'right') {\r\n                if (shiftIsPressed) {\r\n                    crop.width = BB.clamp(crop.width + stepSize, 1, param.canvas.width - crop.x);\r\n                } else {\r\n                    crop.x = BB.clamp(crop.x + stepSize, 0, param.canvas.width - crop.width);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n            if (keyStr === 'up') {\r\n                if (shiftIsPressed) {\r\n                    crop.height = BB.clamp(crop.height - stepSize, 1, param.canvas.height - crop.y);\r\n                } else {\r\n                    crop.y = BB.clamp(crop.y - stepSize, 0, param.canvas.height - crop.height);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n            if (keyStr === 'down') {\r\n                if (shiftIsPressed) {\r\n                    crop.height = BB.clamp(crop.height + stepSize, 1, param.canvas.height - crop.y);\r\n                } else {\r\n                    crop.y = BB.clamp(crop.y + stepSize, 0, param.canvas.height - crop.height);\r\n                }\r\n                doUpdate = true;\r\n            }\r\n\r\n            if (doUpdate) {\r\n                e.preventDefault();\r\n                updateSelectionRect();\r\n                clearTimeout(updateCropTimeout);\r\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 100);\r\n            }\r\n        }\r\n    });\r\n\r\n    this.getEl = function() {\r\n        return div;\r\n    };\r\n    this.reset = function() {\r\n        resetCrop();\r\n        updateCroppedCanvas();\r\n        updateSelectionRect();\r\n    };\r\n    this.destroy = function() {\r\n        eventTarget.style.removeProperty('width');\r\n        eventTarget.style.removeProperty('height');\r\n        keyListener.destroy();\r\n        pointerListener.destroy();\r\n    };\r\n    this.isReset = function() {\r\n        return isReset();\r\n    };\r\n    this.getRect = function() {\r\n        return JSON.parse(JSON.stringify(crop));\r\n    };\r\n    this.getCroppedImage = function() {\r\n        return croppedCanvas;\r\n    };\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {popup} from './popup';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/// <reference path=\"./types.d.ts\" />\r\n\r\n/**\r\n *\r\n * @param parent\r\n * @param fullCanvas\r\n * @param cropCallback\r\n * @param output - BB.Output\r\n * @param showCrop - boolean - show crop button\r\n */\r\nexport function clipboardDialog(parent, fullCanvas, cropCallback, output, showCrop) {\r\n\r\n    let clipboardItemIsSupported = false;\r\n    try {\r\n        clipboardItemIsSupported = !!ClipboardItem;\r\n    } catch (e) {}\r\n\r\n    const div = document.createElement(\"div\");\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n\r\n    let topWrapper = BB.el({\r\n        content: LANG('crop-drag-to-crop') + (clipboardItemIsSupported ? '' : '<br>' + LANG('cropcopy-click-hold')),\r\n        css: {\r\n            textAlign: 'center'\r\n        }\r\n    });\r\n    div.appendChild(topWrapper);\r\n\r\n\r\n    let cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 350,\r\n        canvas: fullCanvas,\r\n        clipboardItemIsSupported\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n        borderTop: '1px solid #bbb',\r\n        borderBottom: '1px solid #bbb'\r\n    });\r\n    div.appendChild(cropCopy.getEl());\r\n\r\n    function toClipboard() {\r\n        const imgURL = cropCopy.getCroppedImage().toDataURL('image/png');\r\n        setTimeout(async function() {\r\n            try {\r\n                const data = await fetch(imgURL);\r\n                const blob = await data.blob();\r\n                await (navigator.clipboard as any).write([\r\n                    new ClipboardItem({\r\n                        [blob.type]: blob\r\n                    } as any) // todo check is possible?\r\n                ]);\r\n                setTimeout(function() {\r\n                    output.out(LANG('cropcopy-copied'), true);\r\n                }, 200);\r\n            } catch (err) {\r\n                console.error(err.name, err.message);\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, KeyEvent, comboStr) {\r\n            if (comboStr === 'ctrl+c') {\r\n                toClipboard();\r\n                closefunc();\r\n            }\r\n        }\r\n    });\r\n\r\n    let closefunc;\r\n    function blur() {\r\n        closefunc();\r\n    }\r\n    BB.addEventListener(window, \"blur\", blur);\r\n\r\n    const buttonArr = [];\r\n    if (clipboardItemIsSupported) {\r\n        buttonArr.push(LANG('cropcopy-btn-copy'));\r\n    }\r\n    if (showCrop) {\r\n        buttonArr.push(LANG('cropcopy-btn-crop'));\r\n    }\r\n    buttonArr.push('Cancel');\r\n\r\n    popup({\r\n        target: parent,\r\n        message: '<b>' + (showCrop ? `${LANG('cropcopy-title-copy')} / ${LANG('cropcopy-title-crop')}` : `${LANG('cropcopy-title-copy')}`) + '</b>',\r\n        div: div,\r\n        style: isSmall ? {} : {\r\n            width: \"500px\"\r\n        },\r\n        buttons: buttonArr,\r\n        primaries: [LANG('cropcopy-btn-copy')],\r\n        callback: function (result) {\r\n            if (result === LANG('cropcopy-btn-copy')) {\r\n                toClipboard();\r\n            } else if (result === LANG('cropcopy-btn-crop')) {\r\n                let rectObj = cropCopy.getRect();\r\n                cropCallback({\r\n                    left: Math.round(-rectObj.x),\r\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\r\n                    top: Math.round(-rectObj.y),\r\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height)\r\n                });\r\n            }\r\n            BB.removeEventListener(window, \"blur\", blur);\r\n            cropCopy.destroy();\r\n            keyListener.destroy();\r\n        },\r\n        clickOnEnter: LANG('cropcopy-btn-copy'),\r\n        closefunc: function (func) {\r\n            closefunc = func;\r\n        }\r\n    });\r\n}","import {BB} from '../../../bb/bb';\r\nimport {popup} from '../modals/popup';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {Options} from '../base-components/options';\r\nimport {Select} from '../base-components/select';\r\nimport {PointSlider} from '../base-components/point-slider';\r\n// @ts-ignore\r\nimport addLayerImg from 'url:~/src/app/img/ui/add-layer.svg';\r\n// @ts-ignore\r\nimport duplicateLayerImg from 'url:~/src/app/img/ui/duplicate-layer.svg';\r\n// @ts-ignore\r\nimport mergeLayerImg from 'url:~/src/app/img/ui/merge-layers.svg';\r\n// @ts-ignore\r\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\r\n// @ts-ignore\r\nimport renameLayerImg from 'url:~/src/app/img/ui/rename-layer.svg';\r\nimport {KlCanvas, MAX_LAYERS} from '../../canvas/kl-canvas';\r\nimport {IMixMode} from '../../kl.types';\r\nimport {LANG} from '../../../language/language';\r\nimport {translateBlending} from '../../canvas/translate-blending';\r\n\r\n\r\nexport function klLayerManager(p_canvas: KlCanvas, p_func, p_rootDiv) {\r\n    let klCanvas: KlCanvas = p_canvas;\r\n    let layerElArr = [];\r\n    let layerHeight = 35;\r\n    let layerSpacing = 0;\r\n    let width = 250;\r\n    let oldHistoryState;\r\n    let updatefunc = p_func;\r\n    let uiState = 'right'; // 'left | 'right'\r\n\r\n\r\n    let largeThumbDiv = BB.el({\r\n        onClick: BB.handleClick,\r\n        css: {\r\n            position: \"absolute\",\r\n            right: \"280px\",\r\n            top: \"500px\",\r\n            background: \"#aaa\",\r\n            boxShadow: \"1px 1px 3px rgba(0,0,0,0.3)\",\r\n            pointerEvents: \"none\",\r\n            padding: '0',\r\n            border: \"1px solid #aaa\",\r\n            transition: \"opacity 0.3s ease-out\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    BB.createCheckerDataUrl(4, function(url) {\r\n        largeThumbDiv.style.backgroundImage = \"url(\" + url + \")\";\r\n    });\r\n    let largeThumbCanvas = BB.canvas(200, 200);\r\n    largeThumbCanvas.style.display = \"block\";\r\n    largeThumbDiv.appendChild(largeThumbCanvas);\r\n    let largeThumbTimeout, largeThumbInTimeout;\r\n    let largeThumbInDocument = false;\r\n\r\n\r\n    let klCanvasLayerArr = klCanvas.getLayers();\r\n    let selectedSpotIndex = klCanvasLayerArr.length - 1;\r\n    let div = document.createElement(\"div\");\r\n    div.style.marginRight = \"10px\";\r\n    div.style.marginBottom = \"10px\";\r\n    div.style.marginLeft = \"10px\";\r\n    div.style.marginTop = \"10px\";\r\n    div.style.cursor = \"default\";\r\n\r\n    let listdiv = document.createElement(\"div\");\r\n    BB.css(listdiv, {\r\n        width: width + \"px\",\r\n        position: \"relative\"\r\n\r\n    });\r\n\r\n\r\n    function renameLayer(layer) {\r\n        let div = document.createElement('div');\r\n\r\n        let label = BB.el({\r\n            content: LANG('layers-rename-name') + ':',\r\n            css: {\r\n                marginRight: '5px'\r\n            }\r\n        });\r\n\r\n        const row = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n        let input = document.createElement('input');\r\n        input.value = klCanvas.getLayer(layer).name;\r\n        input.setAttribute('data-ignore-focus', 'true');\r\n        const clearBtn = BB.el({\r\n            tagName: 'Button',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/>',\r\n            title: LANG('layers-rename-clear'),\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: () => {\r\n                input.value = '';\r\n                input.focus();\r\n            }\r\n        });\r\n        const suggestions = [\r\n            LANG('layers-rename-sketch'),\r\n            LANG('layers-rename-colors'),\r\n            LANG('layers-rename-lines'),\r\n            LANG('background'),\r\n            LANG('layers-rename-foreground'),\r\n        ];\r\n        const suggestionBtns = [];\r\n        const row2 = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginTop: '5px',\r\n                marginLeft: '-5px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        suggestions.forEach(item => {\r\n            const btn = BB.el({\r\n                parent: row2,\r\n                tagName: 'Button',\r\n                content: item,\r\n                onClick: () => {\r\n                    input.value = btn.textContent;\r\n                },\r\n                css: {\r\n                    margin: '5px 0 0 5px',\r\n                }\r\n            });\r\n            suggestionBtns.push(btn);\r\n        });\r\n\r\n        div.appendChild(label);\r\n        label.append(row, row2);\r\n        row.append(input, clearBtn);\r\n\r\n        setTimeout(function() {\r\n            input.focus();\r\n            input.select();\r\n        }, 10);\r\n\r\n        popup({\r\n            target: p_rootDiv,\r\n            message: `<b>${LANG('layers-rename-title')}</b>`,\r\n            div: div,\r\n            buttons: [LANG('layers-rename'), 'Cancel'],\r\n            primaries: [LANG('layers-rename')],\r\n            callback: function (val) {\r\n                BB.destroyEl(clearBtn);\r\n                suggestionBtns.forEach(item => {\r\n                    BB.destroyEl(item);\r\n                });\r\n                suggestionBtns.splice(0, suggestionBtns.length);\r\n                if (val === LANG('layers-rename')) {\r\n                    if (input.value === klCanvas.getLayer(layer).name) {\r\n                        return;\r\n                    }\r\n                    klCanvas.renameLayer(layer, input.value);\r\n                    createLayerList();\r\n                    klHistory.pause(true);\r\n                    updatefunc(layer);\r\n                    klHistory.pause(false);\r\n                }\r\n            },\r\n            clickOnEnter: LANG('layers-rename')\r\n        });\r\n    }\r\n\r\n\r\n    let layerListEl = BB.el({});\r\n\r\n    (div as any).disableButtons = function(){}; //probably remove\r\n    (div as any).enableButtons = function(){}; //probably remove\r\n    let addnewBtn = document.createElement(\"button\");\r\n    let duplicateBtn = document.createElement(\"button\");\r\n    let mergeBtn = document.createElement(\"button\");\r\n    let removeBtn = document.createElement(\"button\");\r\n    let renameBtn = document.createElement(\"button\");\r\n\r\n    function createButtons() {\r\n        let div = document.createElement(\"div\");\r\n        function async() {\r\n            BB.makeUnfocusable(addnewBtn);\r\n            BB.makeUnfocusable(duplicateBtn);\r\n            BB.makeUnfocusable(mergeBtn);\r\n            BB.makeUnfocusable(removeBtn);\r\n            BB.makeUnfocusable(renameBtn);\r\n\r\n            addnewBtn.style.cssFloat = 'left';\r\n            duplicateBtn.style.cssFloat = 'left';\r\n            mergeBtn.style.cssFloat = 'left';\r\n            removeBtn.style.cssFloat = 'left';\r\n            renameBtn.style.cssFloat = 'left';\r\n\r\n            addnewBtn.title = LANG('layers-new');\r\n            duplicateBtn.title = LANG('layers-duplicate');\r\n            removeBtn.title = LANG('layers-remove');\r\n            mergeBtn.title = LANG('layers-merge');\r\n            renameBtn.title = LANG('layers-rename-title');\r\n\r\n            addnewBtn.style.paddingLeft = \"5px\";\r\n            addnewBtn.style.paddingRight = \"3px\";\r\n\r\n            removeBtn.style.paddingLeft = \"5px\";\r\n            removeBtn.style.paddingRight = \"3px\";\r\n\r\n            duplicateBtn.style.paddingLeft = \"5px\";\r\n            duplicateBtn.style.paddingRight = \"3px\";\r\n\r\n            mergeBtn.style.paddingLeft = \"5px\";\r\n            mergeBtn.style.paddingRight = \"3px\";\r\n\r\n            renameBtn.style.height = \"30px\";\r\n            renameBtn.style.lineHeight = \"20px\";\r\n\r\n            addnewBtn.innerHTML = \"<img src='\" + addLayerImg + \"' height='20'/>\";\r\n            duplicateBtn.innerHTML = \"<img src='\" + duplicateLayerImg + \"' height='20'/>\";\r\n            mergeBtn.innerHTML = \"<img src='\" + mergeLayerImg + \"' height='20'/>\";\r\n            removeBtn.innerHTML = \"<img src='\" + removeLayerImg + \"' height='20'/>\";\r\n            renameBtn.innerHTML = \"<img src='\" + renameLayerImg + \"' height='20'/>\";\r\n            addnewBtn.style.marginRight = \"5px\";\r\n            removeBtn.style.marginRight = \"5px\";\r\n            duplicateBtn.style.marginRight = \"5px\";\r\n            mergeBtn.style.marginRight = \"5px\";\r\n            div.appendChild(addnewBtn);\r\n            div.appendChild(removeBtn);\r\n            div.appendChild(duplicateBtn);\r\n            div.appendChild(mergeBtn);\r\n            div.appendChild(renameBtn);\r\n            div.appendChild(BB.el({\r\n                css: {\r\n                    clear: 'both'\r\n                }\r\n            }));\r\n\r\n            let clearboth = document.createElement(\"div\");\r\n            clearboth.style.clear = \"both\";\r\n            clearboth.style.height = \"10px\";\r\n            div.appendChild(clearboth);\r\n\r\n\r\n            addnewBtn.onclick = function () {\r\n                if (klCanvas.addLayer(selectedSpotIndex) === false) {\r\n                    return;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n\r\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n                    addnewBtn.disabled = true;\r\n                    duplicateBtn.disabled = true;\r\n                }\r\n                removeBtn.disabled = false;\r\n                selectedSpotIndex = selectedSpotIndex + 1;\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n            };\r\n            duplicateBtn.onclick = function () {\r\n                if (klCanvas.duplicateLayer(selectedSpotIndex) === false) {\r\n                    return;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n                    addnewBtn.disabled = true;\r\n                    duplicateBtn.disabled = true;\r\n                }\r\n                removeBtn.disabled = false;\r\n                selectedSpotIndex++;\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n            };\r\n            removeBtn.onclick = function () {\r\n                if (layerElArr.length <= 1) {\r\n                    return;\r\n                }\r\n\r\n                klCanvas.removeLayer(selectedSpotIndex);\r\n                if (selectedSpotIndex > 0) {\r\n                    selectedSpotIndex--;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n                if (klCanvasLayerArr.length === 1) {\r\n                    removeBtn.disabled = true;\r\n                }\r\n                if (klCanvasLayerArr.length < MAX_LAYERS) {\r\n                    addnewBtn.disabled = false;\r\n                    duplicateBtn.disabled = false;\r\n                }\r\n            };\r\n            mergeBtn.onclick = function () {\r\n                if (selectedSpotIndex <= 0) {\r\n                    return;\r\n                }\r\n\r\n                function mergeDialog(p) {\r\n                    let div = document.createElement(\"div\");\r\n                    div.innerHTML = LANG('layers-merge-description');\r\n\r\n                    let options = new Options({\r\n                        optionArr: [\r\n                            {id: p.mixModeStr, label: translateBlending(p.mixModeStr)},\r\n                            {id: 'source-in', label: 'source-in'},\r\n                            {id: 'source-out', label: 'source-out'},\r\n                            {id: 'source-atop', label: 'source-atop'},\r\n                            {id: 'destination-in', label: 'destination-in'},\r\n                            {id: 'destination-out', label: 'destination-out'},\r\n                            {id: 'destination-atop', label: 'destination-atop'},\r\n                            {id: 'xor', label: 'xor'}\r\n                        ],\r\n                        initId: p.mixModeStr,\r\n                        onChange: function(id) {\r\n                            update();\r\n                        },\r\n                        isSmall: true\r\n                    });\r\n                    options.getElement().style.marginTop = '5px';\r\n                    div.appendChild(options.getElement());\r\n\r\n                    const thumbDimensions = BB.fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\r\n                    let preview = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n                    preview.title = LANG('preview');\r\n                    let spacer = document.createElement(\"div\");\r\n                    spacer.innerHTML = \"<br/>\";\r\n                    spacer.style.clear = \"both\";\r\n                    div.appendChild(spacer);\r\n                    div.appendChild(preview);\r\n                    BB.css(preview, {\r\n                        display: \"block\",\r\n                        marginLeft: \"auto\",\r\n                        marginRight: \"auto\",\r\n                        colorScheme: 'only light',\r\n                    });\r\n                    preview.style.boxShadow = \"0 0 3px rgba(0,0,0,0.5)\";\r\n                    BB.createCheckerDataUrl(4, function(url) {\r\n                        preview.style.backgroundImage = \"url(\" + url + \")\";\r\n                    });\r\n\r\n                    let alphaCanvas = BB.copyCanvas(preview);\r\n                    alphaCanvas.getContext(\"2d\").drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\r\n                    BB.convertToAlphaChannelCanvas(alphaCanvas);\r\n\r\n                    function update() {\r\n                        let ctx = preview.getContext(\"2d\");\r\n                        ctx.save();\r\n                        ctx.clearRect(0, 0, preview.width, preview.height);\r\n                        if (preview.width > p.topCanvas.width) {\r\n                            ctx.imageSmoothingEnabled = false;\r\n                        }\r\n                        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\r\n\r\n                        if (options.getValue() === 'as-alpha') {\r\n                            ctx.globalCompositeOperation = 'destination-in';\r\n                            ctx.globalAlpha = p.topOpacity;\r\n                            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\r\n                        } else {\r\n                            ctx.globalCompositeOperation = options.getValue();\r\n                            ctx.globalAlpha = p.topOpacity;\r\n                            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\r\n                        }\r\n                        ctx.restore();\r\n                    }\r\n\r\n                    update();\r\n\r\n\r\n                    let keyListener = new BB.KeyListener({\r\n                        onDown: function(keyStr) {\r\n                            if (keyStr === 'right') {\r\n                                options.next();\r\n                            }\r\n                            if (keyStr === 'left') {\r\n                                options.previous();\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    popup({\r\n                        target: p_rootDiv,\r\n                        message: `<b>${LANG('layers-merge-modal-title')}</b>`,\r\n                        div: div,\r\n                        buttons: [\"Ok\", \"Cancel\"],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: function (val) {\r\n                            keyListener.destroy();\r\n                            options.destroy();\r\n                            if (val === \"Ok\") {\r\n                                p.callback(options.getValue());\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                mergeDialog({\r\n                    topCanvas: klCanvasLayerArr[selectedSpotIndex].context.canvas,\r\n                    bottomCanvas: klCanvasLayerArr[selectedSpotIndex - 1].context.canvas,\r\n                    topOpacity: klCanvas.getLayer(selectedSpotIndex).opacity,\r\n                    mixModeStr: klCanvasLayerArr[selectedSpotIndex].mixModeStr,\r\n                    callback: function (mode) {\r\n                        klCanvas.mergeLayers(selectedSpotIndex, selectedSpotIndex - 1, mode);\r\n                        klCanvasLayerArr = klCanvas.getLayers();\r\n                        selectedSpotIndex--;\r\n                        if (klCanvasLayerArr.length === 1) {\r\n                            removeBtn.disabled = true;\r\n                        }\r\n                        if (klCanvasLayerArr.length < MAX_LAYERS) {\r\n                            addnewBtn.disabled = false;\r\n                            duplicateBtn.disabled = false;\r\n                        }\r\n                        createLayerList();\r\n                        klHistory.pause(true);\r\n                        updatefunc(selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                });\r\n            };\r\n\r\n            renameBtn.onclick = function () {\r\n                renameLayer(selectedSpotIndex);\r\n            };\r\n        }\r\n        setTimeout(async, 1);\r\n        return div;\r\n    }\r\n    div.appendChild(createButtons());\r\n\r\n    let modeWrapper;\r\n    let modeSelect;\r\n    {\r\n        modeWrapper = BB.el({\r\n            content: LANG('layers-blending') + '&nbsp;',\r\n            css: {\r\n                fontSize: '15px'\r\n            }\r\n        });\r\n\r\n        modeSelect = new Select({\r\n            optionArr: [\r\n                'source-over',\r\n                null,\r\n                'darken',\r\n                'multiply',\r\n                'color-burn',\r\n                null,\r\n                'lighten',\r\n                'screen',\r\n                'color-dodge',\r\n                null,\r\n                'overlay',\r\n                'soft-light',\r\n                'hard-light',\r\n                null,\r\n                'difference',\r\n                'exclusion',\r\n                null,\r\n                'hue',\r\n                'saturation',\r\n                'color',\r\n                'luminosity',\r\n            ].map((item: IMixMode) => {\r\n                return item ? [item, translateBlending(item)] : null;\r\n            }),\r\n            onChange: function(val) {\r\n                klCanvas.setMixMode(selectedSpotIndex, val as IMixMode);\r\n                (div as any).update(selectedSpotIndex);\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n\r\n        modeWrapper.appendChild(modeSelect.getElement());\r\n        div.appendChild(modeWrapper);\r\n\r\n    }\r\n\r\n\r\n    function createLayerList() {\r\n        oldHistoryState = klHistory.getState();\r\n        function createLayerEntry(index) {\r\n            let layerName = klCanvas.getLayer(index).name;\r\n            let opacity = klCanvasLayerArr[index].opacity;\r\n            let layercanvas = klCanvasLayerArr[index].context.canvas;\r\n\r\n            let layer = document.createElement(\"div\");\r\n            layer.className = \"layerBox\";\r\n            layerElArr[index] = layer;\r\n            (layer as any).posY = ((klCanvasLayerArr.length - 1) * 35 - index * 35);\r\n            BB.css(layer, {\r\n                width: \"250px\",\r\n                height: \"34px\",\r\n                backgroundColor: \"rgb( 220, 220, 220)\",\r\n                border: \"1px solid #aaa\",\r\n                position: \"absolute\",\r\n                left: \"0 px\",\r\n                top: (layer as any).posY + \"px\",\r\n                transition: \"all 0.1s linear\",\r\n                borderRadius: \"5px\",\r\n                boxSizing: 'border-box'\r\n            });\r\n            let innerLayer = document.createElement(\"div\");\r\n            BB.css(innerLayer, {\r\n                position: \"relative\"\r\n            });\r\n\r\n            let container1 = document.createElement(\"div\");\r\n            BB.css(container1, {\r\n                width: \"250px\",\r\n                height: \"34px\"\r\n            });\r\n            let container2 = document.createElement(\"div\");\r\n            layer.appendChild(innerLayer);\r\n            innerLayer.appendChild(container1);\r\n            innerLayer.appendChild(container2);\r\n\r\n            (layer as any).spot = index;\r\n\r\n            //thumb\r\n            {\r\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\r\n                let thumb = (layer as any).thumb = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n\r\n                let thc = thumb.getContext(\"2d\");\r\n                thc.save();\r\n                if (thumb.width > layercanvas.width) {\r\n                    thc.imageSmoothingEnabled = false;\r\n                }\r\n                thc.drawImage(layercanvas, 0, 0, thumb.width, thumb.height);\r\n                thc.restore();\r\n                BB.css((layer as any).thumb, {\r\n                    position: \"absolute\",\r\n                    left: ((32 - (layer as any).thumb.width) / 2) + \"px\",\r\n                    top: ((32 - (layer as any).thumb.height) / 2) + \"px\",\r\n                    colorScheme: 'only light',\r\n                });\r\n                BB.createCheckerDataUrl(4, function(url) {\r\n                    thumb.style.backgroundImage = \"url(\" + url + \")\";\r\n                });\r\n            }\r\n\r\n            //layerlabel\r\n            {\r\n                (layer as any).label = document.createElement(\"div\");\r\n                (layer as any).lname = layerName;\r\n                (layer as any).label.append((layer as any).lname);\r\n\r\n                BB.css((layer as any).label, {\r\n                    position: \"absolute\",\r\n                    left: (1 + 32 + 5) + \"px\",\r\n                    top: 1 + \"px\",\r\n                    fontSize: \"13px\",\r\n                    width: \"170px\",\r\n                    height: \"20px\",\r\n                    overflow: \"hidden\",\r\n                    color: \"#666\",\r\n                    whiteSpace: 'nowrap'\r\n                });\r\n\r\n                (layer as any).label.ondblclick = function() {\r\n                    renameLayer((layer as any).spot);\r\n                };\r\n            }\r\n            //layerlabel\r\n            {\r\n                (layer as any).opacityLabel = document.createElement(\"div\");\r\n                (layer as any).opacity = opacity;\r\n                (layer as any).opacityLabel.append(parseInt('' + ((layer as any).opacity * 100)) + \"%\");\r\n\r\n                BB.css((layer as any).opacityLabel, {\r\n                    position: \"absolute\",\r\n                    left: (250 - 1 - 5 - 50) + \"px\",\r\n                    top: 1 + \"px\",\r\n                    fontSize: \"13px\",\r\n                    textAlign: \"right\",\r\n                    width: \"50px\",\r\n                    color: \"#666\",\r\n                    transition: \"color 0.2s ease-in-out\"\r\n                });\r\n            }\r\n\r\n            let oldOpacity;\r\n            let opacitySlider = new PointSlider({\r\n                init: (layer as any).opacity,\r\n                width: 204,\r\n                pointSize: 14,\r\n                callback: function(sliderValue, isFirst, isLast) {\r\n                    if (isFirst) {\r\n                        oldOpacity = klCanvas.getLayer((layer as any).spot).opacity;\r\n                        klHistory.pause(true);\r\n                        return;\r\n                    }\r\n                    if (isLast) {\r\n                        klHistory.pause(false);\r\n                        if (oldOpacity !== sliderValue) {\r\n                            klCanvas.layerOpacity((layer as any).spot, sliderValue);\r\n                        }\r\n                        return;\r\n                    }\r\n                    (layer as any).opacityLabel.innerHTML = Math.round(sliderValue * 100) + \"%\";\r\n                    klCanvas.layerOpacity((layer as any).spot, sliderValue);\r\n                }\r\n            });\r\n            BB.css(opacitySlider.getEl(), {\r\n                position: 'absolute',\r\n                left: '39px',\r\n                top: '17px'\r\n            });\r\n            (layer as any).opacitySlider = opacitySlider;\r\n\r\n            //larger layer preview - hover\r\n            BB.setEventListener((layer as any).thumb, 'onpointerover', function (e) {\r\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== 'touch')) { //shouldn't show while dragging\r\n                    return;\r\n                }\r\n\r\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\r\n\r\n                if (largeThumbCanvas.width !== thumbDimensions.width || largeThumbCanvas.height !== thumbDimensions.height) {\r\n                    largeThumbCanvas.width = thumbDimensions.width;\r\n                    largeThumbCanvas.height = thumbDimensions.height;\r\n                }\r\n                let ctx = largeThumbCanvas.getContext(\"2d\");\r\n                ctx.save();\r\n                if (largeThumbCanvas.width > layercanvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.imageSmoothingQuality = 'high';\r\n                ctx.clearRect(0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\r\n                ctx.drawImage(layercanvas, 0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\r\n                ctx.restore();\r\n                BB.css(largeThumbDiv, {\r\n                    top: (e.clientY - largeThumbCanvas.height / 2) + \"px\",\r\n                    opacity: '0'\r\n                });\r\n                if (largeThumbInDocument === false) {\r\n                    document.body.appendChild(largeThumbDiv);\r\n                    largeThumbInDocument = true;\r\n                }\r\n                clearTimeout(largeThumbInTimeout);\r\n                largeThumbInTimeout = setTimeout(function () {\r\n                    BB.css(largeThumbDiv, {\r\n                        opacity: '1'\r\n                    });\r\n                }, 20);\r\n                clearTimeout(largeThumbTimeout);\r\n            });\r\n            BB.setEventListener((layer as any).thumb, 'onpointerout', function () {\r\n                clearTimeout(largeThumbInTimeout);\r\n                BB.css(largeThumbDiv, {\r\n                    opacity: '0'\r\n                });\r\n                clearTimeout(largeThumbTimeout);\r\n                largeThumbTimeout = setTimeout(function () {\r\n                    if (!largeThumbInDocument) {\r\n                        return;\r\n                    }\r\n                    document.body.removeChild(largeThumbDiv);\r\n                    largeThumbInDocument = false;\r\n                }, 300);\r\n            });\r\n\r\n            container1.appendChild((layer as any).thumb);\r\n            container1.appendChild((layer as any).label);\r\n            container1.appendChild((layer as any).opacityLabel);\r\n            container1.appendChild(opacitySlider.getEl());\r\n            let dragstart = false;\r\n            let freshSelection = false;\r\n\r\n            //events for moving layers up and down\r\n            function dragEventHandler(event) {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    BB.css(layer, {\r\n                        transition: \"box-shadow 0.3s ease-in-out\"\r\n                    });\r\n                    //dragContainer.appendChild(layer);\r\n                    layer.style.zIndex = '1';\r\n                    lastpos = (layer as any).spot;\r\n                    freshSelection = false;\r\n                    if (!(layer as any).isSelected) {\r\n                        freshSelection = true;\r\n                        (div as any).activateLayer((layer as any).spot);\r\n                    }\r\n                    dragstart = true;\r\n\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    if (dragstart) {\r\n                        dragstart = false;\r\n                        BB.css(layer, {\r\n                            boxShadow: \"1px 3px 5px rgba(0,0,0,0.4)\"\r\n                        });\r\n                    }\r\n                    (layer as any).posY += event.dY;\r\n                    let corrected = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\r\n                    layer.style.top = corrected + \"px\";\r\n                    updateLayersVerticalPosition((layer as any).spot, posToSpot((layer as any).posY));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(layer, {\r\n                        transition: \"all 0.1s linear\"\r\n                    });\r\n                    setTimeout(function () {\r\n                        BB.css(layer, {\r\n                            boxShadow: \"\"\r\n                        });\r\n                    }, 20);\r\n                    (layer as any).posY = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\r\n                    //regularContainer.appendChild(layer);\r\n                    layer.style.zIndex = \"\";\r\n                    let newSpot = posToSpot((layer as any).posY);\r\n                    let oldSpot = (layer as any).spot;\r\n                    move((layer as any).spot, newSpot);\r\n                    if (oldSpot != newSpot) {\r\n                        klHistory.pause(true);\r\n                        updatefunc(selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                    if (oldSpot === newSpot && freshSelection) {\r\n                        updatefunc(selectedSpotIndex);\r\n                    }\r\n                    freshSelection = false;\r\n                }\r\n            }\r\n\r\n            (layer as any).pointerListener = new BB.PointerListener({\r\n                target: container1,\r\n                maxPointers: 1,\r\n                onPointer: dragEventHandler\r\n            });\r\n\r\n            layerListEl.appendChild(layer);\r\n        }\r\n        layerElArr = [];\r\n        while (layerListEl.firstChild) {\r\n            let child = layerListEl.firstChild;\r\n            (child as any).pointerListener.destroy();\r\n            (child as any).opacitySlider.destroy();\r\n            layerListEl.removeChild(child);\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            createLayerEntry(i);\r\n        }\r\n        (div as any).activateLayer(selectedSpotIndex);\r\n        updateHeight();\r\n    }\r\n\r\n\r\n    listdiv.appendChild(layerListEl);\r\n    div.appendChild(listdiv);\r\n\r\n\r\n    function posToSpot(p) {\r\n        let result = parseInt('' + ((p) / (layerHeight + layerSpacing) + 0.5));\r\n        result = Math.min(klCanvasLayerArr.length - 1, Math.max(0, result));\r\n        result = klCanvasLayerArr.length - result - 1;\r\n        return result;\r\n    }\r\n\r\n    let lastpos = 0;\r\n\r\n    //update css position of all layers that are not being dragged, while dragging\r\n    function updateLayersVerticalPosition(id, newspot) {\r\n        newspot = Math.min(klCanvasLayerArr.length - 1, Math.max(0, newspot));\r\n        if (newspot === lastpos) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            if (layerElArr[i].spot === id) { // <- here\r\n                continue;\r\n            }\r\n            let posy = layerElArr[i].spot;\r\n            if (layerElArr[i].spot > id) {\r\n                posy--;\r\n            }\r\n            if (posy >= newspot) {\r\n                posy++;\r\n            }\r\n            layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\r\n            layerElArr[i].style.top = layerElArr[i].posY + \"px\";\r\n        }\r\n        lastpos = newspot;\r\n    }\r\n\r\n    function move(oldSpotIndex, newSpotIndex) {\r\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) {\r\n            throw 'layermanager - invalid move';\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            (function (i) {\r\n                let posy = layerElArr[i].spot; // <- here\r\n                if (layerElArr[i].spot === oldSpotIndex) {\r\n                    posy = newSpotIndex;\r\n                } else {\r\n                    if (layerElArr[i].spot > oldSpotIndex)\r\n                        posy--;\r\n                    if (posy >= newSpotIndex)\r\n                        posy++;\r\n                }\r\n                layerElArr[i].spot = posy;\r\n                layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\r\n                layerElArr[i].style.top = layerElArr[i].posY + \"px\";\r\n            }(i));\r\n        }\r\n        if (oldSpotIndex === newSpotIndex) {\r\n            return;\r\n        }\r\n        klCanvas.moveLayer(selectedSpotIndex, newSpotIndex - oldSpotIndex);\r\n        klCanvasLayerArr = klCanvas.getLayers();\r\n        selectedSpotIndex = newSpotIndex;\r\n        mergeBtn.disabled = selectedSpotIndex === 0;\r\n    }\r\n\r\n\r\n    //updating the thumbs in interval\r\n    //don't update when: manager not visible || layer didn't change || is drawing\r\n    let updateThumbsInterval = setInterval(function() {\r\n        if (div.style.display !== \"block\") {\r\n            return;\r\n        }\r\n\r\n        let historyState = klHistory.getState();\r\n        if (historyState === oldHistoryState) {\r\n            return;\r\n        }\r\n        oldHistoryState = historyState;\r\n\r\n        for (let i = 0; i < layerElArr.length; i++) {\r\n            if (selectedSpotIndex === layerElArr[i].spot && klCanvasLayerArr[layerElArr[i].spot]) { // second check, because might be out of date\r\n                let ctx = layerElArr[i].thumb.getContext(\"2d\");\r\n                ctx.save();\r\n                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n                if (klCanvasLayerArr[layerElArr[i].spot].context.canvas.width < layerElArr[i].thumb.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.drawImage(klCanvasLayerArr[layerElArr[i].spot].context.canvas, 0, 0, layerElArr[i].thumb.width, layerElArr[i].thumb.height);\r\n                ctx.restore();\r\n            }\r\n        }\r\n\r\n    }, 1);\r\n\r\n    function updateHeight() {\r\n        layerListEl.style.height = (layerElArr.length * 35) + 'px';\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    (div as any).update = function (activeLayerSpotIndex) {\r\n        klCanvasLayerArr = klCanvas.getLayers();\r\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) {\r\n            selectedSpotIndex = activeLayerSpotIndex;\r\n        }\r\n        removeBtn.disabled = klCanvasLayerArr.length === 1;\r\n        if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n            addnewBtn.disabled = true;\r\n            duplicateBtn.disabled = true;\r\n        } else {\r\n            addnewBtn.disabled = false;\r\n            duplicateBtn.disabled = false;\r\n        }\r\n        setTimeout(function() {\r\n            createLayerList();\r\n        }, 1);\r\n    };\r\n    (div as any).getSelected = function () {\r\n        return selectedSpotIndex;\r\n    };\r\n    (div as any).activateLayer = function (spotIndex) {\r\n        if (spotIndex < 0 || spotIndex > layerElArr.length - 1) {\r\n            throw 'invalid spotIndex ' + spotIndex + ', layerElArr.length ' + layerElArr.length;\r\n        }\r\n        selectedSpotIndex = spotIndex;\r\n        modeSelect.setValue(klCanvasLayerArr[selectedSpotIndex].mixModeStr);\r\n        for (let i = 0; i < layerElArr.length; i++) {\r\n            if (selectedSpotIndex === layerElArr[i].spot) {\r\n                layerElArr[i].style.backgroundColor = \"rgb( 250, 250, 250)\";\r\n                layerElArr[i].label.style.color = \"#000\";\r\n                layerElArr[i].style.boxShadow = \"\";\r\n                layerElArr[i].style.border = \"1px solid var(--active-highlight-color)\";\r\n                layerElArr[i].opacitySlider.setActive(true);\r\n                layerElArr[i].isSelected = true;\r\n            } else {\r\n                layerElArr[i].style.backgroundColor = \"rgb( 220, 220, 220)\";\r\n                layerElArr[i].label.style.color = \"#666\";\r\n                layerElArr[i].style.boxShadow = \"\";\r\n                layerElArr[i].style.border = \"1px solid rgb(158, 158, 158)\";\r\n                layerElArr[i].opacitySlider.setActive(false);\r\n                layerElArr[i].isSelected = false;\r\n            }\r\n        }\r\n        mergeBtn.disabled = selectedSpotIndex === 0;\r\n    };\r\n    (div as any).setUiState = function(stateStr) {\r\n        uiState = '' + stateStr;\r\n\r\n        if (uiState === 'left') {\r\n            BB.css(largeThumbDiv, {\r\n                left: '280px',\r\n                right: ''\r\n            });\r\n        } else {\r\n            BB.css(largeThumbDiv, {\r\n                left: '',\r\n                right: '280px'\r\n            });\r\n        }\r\n    };\r\n\r\n    createLayerList();\r\n\r\n    return div;\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1mb1v\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"11KJK\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"floUo\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kino6\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hhQeq\");","import {BB} from '../../bb/bb';\r\nimport {floodFillBits} from '../image-operations/flood-fill';\r\nimport {drawShape} from '../image-operations/shape-tool';\r\nimport {IRenderTextParam, renderText} from '../image-operations/render-text';\r\nimport {IKlProject, IMixMode, IRGB, IShapeToolObject} from '../kl.types';\r\nimport {DecoyKlHistory, KlHistoryInterface} from '../history/kl-history';\r\nimport {drawProject} from './draw-project';\r\nimport {LANG} from '../../language/language';\r\n\r\n\r\nconst allowedMixModes = [\r\n    'source-over',\r\n    'darken',\r\n    'multiply',\r\n    'color-burn',\r\n    'lighten',\r\n    'screen',\r\n    'color-dodge',\r\n    'overlay',\r\n    'soft-light',\r\n    'hard-light',\r\n    'difference',\r\n    'exclusion',\r\n    'hue',\r\n    'saturation',\r\n    'color',\r\n    'luminosity',\r\n];\r\n\r\nexport const MAX_LAYERS = 16;\r\n\r\ninterface KlCanvasLayer extends HTMLCanvasElement {\r\n    name: string;\r\n    mixModeStr: IMixMode;\r\n    opacity: number;\r\n    compositeObj?: {\r\n        draw: (ctx: CanvasRenderingContext2D) => void;\r\n    },\r\n    index: number; // certain brushes need to know\r\n}\r\n\r\n/**\r\n * The image/canvas that the user paints on\r\n * Has layers. layers have names and opacity.\r\n *\r\n * Interacts with the history you specify (for undo/redo)\r\n */\r\nexport class KlCanvas {\r\n\r\n    // todo changeListener consistent concept\r\n    // todo history interaction, consistent concept - currently have to look at code to know if something pushes on history\r\n\r\n    private width: number;\r\n    private height: number;\r\n    private layerCanvasArr: KlCanvasLayer[];\r\n    private pickCanvas: HTMLCanvasElement; // canvas to draw into for color picker\r\n    private history: KlHistoryInterface;\r\n    private changeListenerArr:  (() => void)[]; // subscribers get notified when opacity changes\r\n\r\n\r\n    private init (w: number, h: number): void {\r\n        if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            throw new Error('init - invalid canvas size: ' + w + ', ' + h);\r\n        }\r\n        this.width = w;\r\n        this.height = h;\r\n    }\r\n\r\n    private emitChange (): void {\r\n        // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\r\n        this.changeListenerArr.forEach(item => item());\r\n    }\r\n\r\n    private updateIndices (): void {\r\n        this.layerCanvasArr.forEach((item, index) => {\r\n            item.index = index;\r\n        });\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        params: {\r\n            projectObj: {\r\n                width: number;\r\n                height: number;\r\n                layers: {\r\n                    name: string;\r\n                    opacity: number;\r\n                    image: HTMLImageElement | HTMLCanvasElement; // already loaded!\r\n                }[];\r\n            }\r\n        } | {\r\n            // creates blank KlCanvas, 0 layers\r\n            width: number;\r\n            height: number;\r\n        } | {\r\n            copy: KlCanvas;\r\n        },\r\n        private layerNrOffset: number = 0,\r\n    ) {\r\n        this.layerCanvasArr = [];\r\n        this.pickCanvas = BB.canvas(1, 1);\r\n        this.history = new DecoyKlHistory();\r\n        if ('copy' in params) {\r\n            this.width = 1;\r\n            this.height = 1;\r\n        } else {\r\n            if ('width' in params && 'height' in params) {\r\n                this.width = params.width;\r\n                this.height = params.height;\r\n            } else {\r\n                this.width = 1;\r\n                this.height = 1;\r\n            }\r\n        }\r\n        this.init(this.width, this.height);\r\n\r\n        this.changeListenerArr = [];\r\n\r\n        if ('copy' in params) {\r\n            try {\r\n                this.copy(params.copy);\r\n            } catch (e) {\r\n                this.destroy();\r\n                throw e;\r\n            }\r\n        } else if ('projectObj' in params) {\r\n            const origLayers = [].concat(params.projectObj.layers);\r\n            this.init(params.projectObj.width, params.projectObj.height);\r\n\r\n            if (!origLayers.length) {\r\n                throw new Error('project.layers needs at least 1 layer');\r\n            }\r\n\r\n            for (let i = 0; i < origLayers.length; i++) {\r\n                if (origLayers[i].mixModeStr && !allowedMixModes.includes(origLayers[i].mixModeStr)) {\r\n                    throw new Error('unknown mixModeStr ' + origLayers[i].mixModeStr);\r\n                }\r\n\r\n                this.addLayer();\r\n                this.layerOpacity(i, origLayers[i].opacity);\r\n                this.layerCanvasArr[i].name = origLayers[i].name;\r\n                this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr ? origLayers[i].mixModeStr : 'source-over';\r\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    /**\r\n     * Resets canvas -> 1 layer, 100% opacity,\r\n     * unless layers provided.\r\n     * @param p\r\n     */\r\n    reset (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n            color?: IRGB; // optional - fill color\r\n            image?: HTMLImageElement | HTMLCanvasElement; // image drawn on layer\r\n            layerName?: string; // if via image\r\n            layers?: {\r\n                name: string;\r\n                opacity: number;\r\n                mixModeStr: IMixMode;\r\n                image: HTMLCanvasElement;\r\n            }[];\r\n        }\r\n    ): void | number {\r\n        if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height) ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        this.history.pause(true);\r\n\r\n        this.width = p.width;\r\n        this.height = p.height;\r\n\r\n        this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\r\n\r\n        if (p.layers) {\r\n            for (let i = 0; i < p.layers.length; i++) {\r\n                let item = p.layers[i];\r\n                if (!this.layerCanvasArr[i]) {\r\n                    this.addLayer();\r\n                }\r\n                this.layerCanvasArr[i].name = item.name;\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n                this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : 'source-over';\r\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(item.image, 0, 0);\r\n                this.layerOpacity(i, item.opacity);\r\n            }\r\n        } else {\r\n            this.layerCanvasArr[0].name = p.layerName ? p.layerName : LANG('layers-layer') + \" 1\";\r\n            this.layerCanvasArr[0].width = this.width;\r\n            this.layerCanvasArr[0].height = this.height;\r\n            this.layerCanvasArr[0].mixModeStr = 'source-over';\r\n            this.layerOpacity(0, 1);\r\n            if (p.color) {\r\n                this.layerFill(0, p.color);\r\n            } else if (p.image) {\r\n                this.layerCanvasArr[0].getContext(\"2d\").drawImage(p.image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n\r\n        this.history.pause(false);\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"reset\",\r\n            params: [p] // dont screw with p\r\n        });\r\n\r\n        return this.layerCanvasArr.length - 1;\r\n    }\r\n\r\n    isLayerLimitReached (): boolean {\r\n        return this.layerCanvasArr.length >= MAX_LAYERS;\r\n    }\r\n\r\n    getWidth (): number {\r\n        return this.width;\r\n    }\r\n\r\n    getHeight (): number {\r\n        return this.height;\r\n    }\r\n\r\n    copy (toCopyCanvas: KlCanvas): void {\r\n        if (\r\n            toCopyCanvas.getWidth() < 1 ||\r\n            toCopyCanvas.getHeight() < 1 ||\r\n            isNaN(toCopyCanvas.getWidth()) ||\r\n            isNaN(toCopyCanvas.getHeight())\r\n        ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        // keep existing canvases\r\n\r\n        let origLayers = toCopyCanvas.getLayers();\r\n\r\n        while (this.layerCanvasArr.length > origLayers.length) {\r\n            this.removeLayer(this.layerCanvasArr.length - 1);\r\n        }\r\n\r\n        if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) {\r\n            this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\r\n        }\r\n        for (let i = 0; i < origLayers.length; i++) {\r\n            if (i >= this.layerCanvasArr.length) {\r\n                this.addLayer();\r\n            } else {\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n            }\r\n            this.layerOpacity(i, origLayers[i].opacity);\r\n            this.layerCanvasArr[i].name = origLayers[i].name;\r\n            this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].context.canvas, 0, 0);\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    getLayerCount (): number {\r\n        return this.layerCanvasArr.length;\r\n    }\r\n\r\n    resize (w: number, h: number, algorithm: 'smooth' | 'pixelated' = 'smooth'): boolean {\r\n        if (!w || !h || (w === this.width && h === this.height) || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            return false;\r\n        }\r\n        w = Math.max(w, 1);\r\n        h = Math.max(h, 1);\r\n\r\n        let tmp1, tmp2;\r\n\r\n        if (algorithm === 'pixelated') {\r\n            tmp1 = BB.canvas(w, h);\r\n            let tmp1Ctx = tmp1.getContext('2d');\r\n            tmp1Ctx.imageSmoothingEnabled = false;\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                if (i > 0) {\r\n                    tmp1Ctx.clearRect(0, 0, w, h);\r\n                }\r\n                let layerCanvas = this.layerCanvasArr[i];\r\n                tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\r\n                layerCanvas.width = w;\r\n                layerCanvas.height = h;\r\n                let layerContext = layerCanvas.getContext('2d');\r\n                layerContext.drawImage(tmp1, 0, 0);\r\n            }\r\n\r\n        } else if (algorithm === 'smooth') {\r\n            tmp1 = BB.canvas();\r\n            tmp2 = BB.canvas();\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                BB.resizeCanvas(this.layerCanvasArr[i], w, h, tmp1, tmp2);\r\n            }\r\n        } else {\r\n            throw new Error('unknown resize algorithm');\r\n        }\r\n\r\n        this.width = w;\r\n        this.height = h;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * crop / extend\r\n     * @param p\r\n     */\r\n    resizeCanvas (p: {\r\n        left: number;\r\n        top: number;\r\n        right: number;\r\n        bottom: number;\r\n        fillColor?: IRGB\r\n    }): void {\r\n\r\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\r\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\r\n        const offX = Math.round(p.left);\r\n        const offY = Math.round(p.top);\r\n\r\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) {\r\n            throw new Error('KlCanvas.resizeCanvas - invalid canvas size');\r\n        }\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            const ctemp = BB.canvas(this.width, this.height);\r\n            let layerCanvas = this.layerCanvasArr[i];\r\n            let layerCtx = this.layerCanvasArr[i].getContext(\"2d\");\r\n            ctemp.getContext(\"2d\").drawImage(layerCanvas, 0, 0);\r\n\r\n            this.layerCanvasArr[i].width = newW;\r\n            this.layerCanvasArr[i].height = newH;\r\n\r\n            layerCtx.save();\r\n            if (i === 0 && p.fillColor) {\r\n                layerCtx.fillStyle = BB.ColorConverter.toRgbStr(p.fillColor);\r\n                layerCtx.fillRect(0, 0, newW, newH);\r\n                layerCtx.clearRect(offX, offY, this.width, this.height);\r\n            }\r\n            layerCtx.drawImage(ctemp, offX, offY);\r\n            layerCtx.restore();\r\n        }\r\n        this.width = newW;\r\n        this.height = newH;\r\n    }\r\n\r\n    /**\r\n     * will be inserted on top of selected\r\n     * @param selected\r\n     */\r\n    addLayer (selected?: number): false | number {\r\n        if (this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        let canvas = BB.canvas(this.width, this.height);\r\n        if (!canvas.getContext('2d')) {\r\n            throw new Error('kl-create-canvas-error');\r\n        }\r\n\r\n        (canvas as any).mixModeStr = 'source-over';\r\n\r\n        if (selected === undefined) {\r\n            this.layerCanvasArr[this.layerCanvasArr.length] = canvas as any;\r\n            selected = Math.max(0, this.layerCanvasArr.length - 1);\r\n        } else {\r\n            this.layerCanvasArr.splice(selected + 1, 0, canvas as any);\r\n            selected++;\r\n        }\r\n\r\n        (canvas as any).name = LANG('layers-layer') + \" \" + (this.layerCanvasArr.length + this.layerNrOffset);\r\n        this.history.pause(true);\r\n        this.layerOpacity(selected, 1);\r\n        this.history.pause(false);\r\n        this.updateIndices();\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"addLayer\",\r\n            params: [selected - 1]\r\n        });\r\n        return selected;\r\n    }\r\n\r\n    duplicateLayer (i: number): false | number {\r\n        if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        let canvas = BB.canvas(this.width, this.height);\r\n        this.layerCanvasArr.splice(i + 1, 0, canvas as any);\r\n\r\n        (canvas as any).name = this.layerCanvasArr[i].name + \" \" + LANG('layers-copy');\r\n        (canvas as any).mixModeStr = this.layerCanvasArr[i].mixModeStr;\r\n        canvas.getContext(\"2d\").drawImage(this.layerCanvasArr[i], 0, 0);\r\n        this.history.pause(true);\r\n        this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\r\n        this.history.pause(false);\r\n\r\n        this.updateIndices();\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"duplicateLayer\",\r\n            params: [i]\r\n        });\r\n        return i + 1;\r\n    }\r\n\r\n    getLayerContext (i: number, doReturnNull?: boolean): CanvasRenderingContext2D | null {\r\n        if (this.layerCanvasArr[i]) {\r\n            return this.layerCanvasArr[i].getContext(\"2d\");\r\n        }\r\n        if (doReturnNull) {\r\n            return null;\r\n        }\r\n        throw new Error(\"layer of index \" + i + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n    }\r\n\r\n    removeLayer (i: number): false | number {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr.splice(i, 1);\r\n            this.updateIndices();\r\n        } else {\r\n            return false;\r\n        }\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"removeLayer\",\r\n            params: [i]\r\n        });\r\n\r\n        return Math.max(0, i - 1);\r\n    }\r\n\r\n    renameLayer (i: number, name: string): boolean {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr[i].name = name;\r\n        } else {\r\n            return false;\r\n        }\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"renameLayer\",\r\n            params: [i, name]\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n    layerOpacity (i: number, o: number): void {\r\n        if (!this.layerCanvasArr[i]) {\r\n            return;\r\n        }\r\n        o = Math.max(0, Math.min(1, o));\r\n        this.layerCanvasArr[i].opacity = o;\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"layerOpacity\",\r\n            params: [i, o]\r\n        });\r\n\r\n        this.emitChange();\r\n    }\r\n\r\n    moveLayer (i: number, d: number): void | number {\r\n        if (d === 0) {\r\n            return;\r\n        }\r\n        if (this.layerCanvasArr[i]) {\r\n            const temp = this.layerCanvasArr[i];\r\n            this.layerCanvasArr.splice(i, 1);\r\n            const targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\r\n            this.layerCanvasArr.splice(targetIndex, 0, temp);\r\n            this.updateIndices();\r\n            this.history.push({\r\n                tool: [\"canvas\"],\r\n                action: \"moveLayer\",\r\n                params: [i, d]\r\n            });\r\n            return targetIndex;\r\n        }\r\n    }\r\n\r\n    mergeLayers (layerBottomIndex: number, layerTopIndex: number, mixModeStr: IMixMode | 'as-alpha'): void | number {\r\n        if (\r\n            !this.layerCanvasArr[layerBottomIndex] ||\r\n            !this.layerCanvasArr[layerTopIndex] ||\r\n            layerBottomIndex === layerTopIndex\r\n        ) {\r\n            return;\r\n        }\r\n        //order messed up\r\n        if (layerBottomIndex > layerTopIndex) {\r\n            let temp = layerBottomIndex;\r\n            layerBottomIndex = layerTopIndex;\r\n            layerTopIndex = temp;\r\n        }\r\n\r\n        let topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\r\n        if (topOpacity !== 0 && topOpacity) {\r\n            let ctx = this.layerCanvasArr[layerBottomIndex].getContext(\"2d\");\r\n            ctx.save();\r\n\r\n            if (mixModeStr === 'as-alpha') { // todo remove this?\r\n\r\n                BB.convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\r\n                ctx.globalCompositeOperation = 'destination-in';\r\n                ctx.globalAlpha = topOpacity;\r\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            } else {\r\n\r\n                if (mixModeStr) {\r\n                    ctx.globalCompositeOperation = mixModeStr;\r\n                }\r\n                ctx.globalAlpha = topOpacity;\r\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            }\r\n\r\n            ctx.restore();\r\n\r\n            // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n            // TODO remove if chrome updated\r\n            if (mixModeStr) {\r\n                ctx.save();\r\n                ctx.fillStyle = \"rgba(0,0,0,0.01)\";\r\n                ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n                ctx.restore();\r\n            }\r\n        }\r\n        this.updateIndices();\r\n        this.history.pause(true);\r\n        this.removeLayer(layerTopIndex);\r\n        this.history.pause(false);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"mergeLayers\",\r\n            params: [layerBottomIndex, layerTopIndex, mixModeStr]\r\n        });\r\n\r\n        return layerBottomIndex;\r\n    }\r\n\r\n    rotate (deg: number): void {\r\n        while (deg < 0) {\r\n            deg += 360;\r\n        }\r\n        deg %= 360;\r\n        if (deg % 90 != 0 || deg === 0)\r\n            return;\r\n        let temp = BB.canvas();\r\n        if (deg === 0 || deg === 180) {\r\n            temp.width = this.width;\r\n            temp.height = this.height;\r\n        } else if (deg === 90 || deg === 270) {\r\n            temp.width = this.height;\r\n            temp.height = this.width;\r\n        }\r\n        let ctx = temp.getContext(\"2d\");\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.clearRect(0, 0, temp.width, temp.height);\r\n            ctx.save();\r\n            ctx.translate(temp.width / 2, temp.height / 2);\r\n            ctx.rotate(deg * Math.PI / 180);\r\n            if (deg === 180) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            } else if (deg === 90 || deg === 270) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\r\n            }\r\n            this.layerCanvasArr[i].width = temp.width;\r\n            this.layerCanvasArr[i].height = temp.height;\r\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\r\n            ctx.restore();\r\n        }\r\n        this.width = temp.width;\r\n        this.height = temp.height;\r\n    }\r\n\r\n    flip (isHorizontal: boolean, isVertical: boolean, layerIndex: number): void {\r\n        if (!isHorizontal && !isVertical) {\r\n            return;\r\n        }\r\n\r\n        let temp = BB.canvas(this.width, this.height);\r\n        temp.width = this.width;\r\n        temp.height = this.height;\r\n        let tempCtx = temp.getContext(\"2d\");\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n\r\n            if ( (layerIndex || layerIndex === 0) && i !== layerIndex) {\r\n                continue;\r\n            }\r\n\r\n            tempCtx.save();\r\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\r\n            tempCtx.translate(temp.width / 2, temp.height / 2);\r\n            tempCtx.scale((isHorizontal ? -1 : 1), (isVertical ? -1 : 1));\r\n            tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            tempCtx.restore();\r\n\r\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\r\n        }\r\n    }\r\n\r\n    layerFill (layerIndex: number, colorObj: IRGB, compositeOperation?: string): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.save();\r\n        if (compositeOperation) {\r\n            ctx.globalCompositeOperation = compositeOperation as GlobalCompositeOperation;\r\n        }\r\n        ctx.fillStyle = \"rgba(\" + colorObj.r + \",\" + colorObj.g + \",\" + colorObj.b + \",1)\";\r\n        ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n        // TODO remove if chrome updated\r\n        ctx.save();\r\n        ctx.fillStyle = \"rgba(0,0,0,0.01)\";\r\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n        ctx.restore();\r\n\r\n        /*if (!document.getElementById('testocanvas')) {\r\n            layerCanvasArr[layerIndex].id = 'testocanvas';\r\n            document.body.appendChild(layerCanvasArr[layerIndex]);\r\n            BB.css(layerCanvasArr[layerIndex], {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }\r\n        if (!document.getElementById('testocanvas')) {\r\n            let c = document.createElement('canvas');\r\n            c.width = 1000;\r\n            c.height = 1000;\r\n            let ctx2 = c.getContext('2d');\r\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\r\n            c.id = 'testocanvas';\r\n            document.body.appendChild(c);\r\n            BB.css(c, {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }*/\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"layerFill\",\r\n            params: [layerIndex, colorObj, compositeOperation]\r\n        });\r\n    }\r\n\r\n    floodFill (\r\n        layerIndex: number, // index of layer to be filled\r\n        x: number, // starting point\r\n        y: number,\r\n        rgb: IRGB, // fill color\r\n        opacity: number,\r\n        tolerance: number,\r\n        sampleStr: 'current' | 'all' | 'above',\r\n        grow: number, // int >= 0 - radius around filled area that is to be filled too\r\n        isContiguous: boolean,\r\n    ): void {\r\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) {\r\n            return;\r\n        }\r\n        tolerance = Math.round(tolerance);\r\n\r\n        if (!(['above', 'current', 'all'].includes(sampleStr))) {\r\n            throw new Error('invalid sampleStr');\r\n        }\r\n\r\n        let result;\r\n\r\n        let srcCtx;\r\n        let srcImageData;\r\n        let srcData;\r\n\r\n        let targetCtx;\r\n        let targetImageData;\r\n        let targetData;\r\n\r\n\r\n        if (sampleStr === 'all') {\r\n\r\n            let srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\r\n            srcCtx = srcCanvas.getContext('2d');\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            srcCanvas = null;\r\n            srcCtx = null;\r\n            srcImageData = null;\r\n            srcData = null;\r\n\r\n            targetCtx = this.layerCanvasArr[layerIndex].getContext('2d');\r\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        } else {\r\n            let srcIndex = sampleStr === 'above' ? layerIndex + 1 : layerIndex;\r\n\r\n            if (srcIndex >= this.layerCanvasArr.length) {\r\n                return;\r\n            }\r\n\r\n            srcCtx = this.layerCanvasArr[srcIndex].getContext('2d');\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            if (layerIndex !== srcIndex) {\r\n                srcCtx = null;\r\n                srcImageData = null;\r\n                srcData = null;\r\n            }\r\n\r\n            targetCtx = layerIndex === srcIndex ? srcCtx : this.layerCanvasArr[layerIndex].getContext('2d');\r\n            targetImageData = layerIndex === srcIndex ? srcImageData : targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        }\r\n\r\n        targetData = targetImageData.data;\r\n        if (opacity === 1) {\r\n            for (let i = 0; i < this.width * this.height; i++) {\r\n                if (result.data[i] === 255) {\r\n                    targetData[i * 4] = rgb.r;\r\n                    targetData[i * 4 + 1] = rgb.g;\r\n                    targetData[i * 4 + 2] = rgb.b;\r\n                    targetData[i * 4 + 3] = 255;\r\n                }\r\n            }\r\n        } else {\r\n            for (let i = 0; i < this.width * this.height; i++) {\r\n                if (result.data[i] === 255) {\r\n                    targetData[i * 4] = BB.mix(targetData[i * 4], rgb.r, opacity);\r\n                    targetData[i * 4 + 1] = BB.mix(targetData[i * 4 + 1], rgb.g, opacity);\r\n                    targetData[i * 4 + 2] = BB.mix(targetData[i * 4 + 2], rgb.b, opacity);\r\n                    targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 255, opacity);\r\n                }\r\n            }\r\n        }\r\n        targetCtx.putImageData(targetImageData, 0, 0);\r\n\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [layerIndex, targetImageData]\r\n        });\r\n    }\r\n\r\n    /**\r\n     * draw shape via BB.drawShape\r\n     * @param layerIndex\r\n     * @param shapeObj\r\n     */\r\n    drawShape (layerIndex: number, shapeObj: IShapeToolObject): void {\r\n        if (shapeObj.x1 === shapeObj.x2 && shapeObj.y1 === shapeObj.y2) {\r\n            return;\r\n        }\r\n        drawShape(this.layerCanvasArr[layerIndex].getContext(\"2d\"), shapeObj);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"drawShape\",\r\n            params: [layerIndex, BB.copyObj(shapeObj)],\r\n        });\r\n    }\r\n\r\n    text (layerIndex: number, p: IRenderTextParam): void {\r\n        renderText(this.layerCanvasArr[layerIndex], BB.copyObj(p));\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"text\",\r\n            params: [layerIndex, BB.copyObj(p)],\r\n        });\r\n    }\r\n\r\n    replaceLayer (layerIndex: number, imageData: ImageData): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.putImageData(imageData, 0, 0);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [layerIndex, imageData],\r\n        });\r\n    }\r\n\r\n    clearLayer (layerIndex: number): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"clearLayer\",\r\n            params: [layerIndex]\r\n        });\r\n    }\r\n\r\n    getLayers (): {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                context: item.getContext(\"2d\"),\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayersFast (): {\r\n        canvas: KlCanvasLayer;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                canvas: item,\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayerIndex (canvasObj: HTMLCanvasElement, doReturnNull?: boolean): null | number {\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            if (this.layerCanvasArr[i] === canvasObj) {\r\n                return i;\r\n            }\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error(\"layer not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getLayer (index: number, doReturnNull?: boolean): null | {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        id: number;\r\n    } {\r\n        if (this.layerCanvasArr[index]) {\r\n            return {\r\n                context: this.layerCanvasArr[index].getContext(\"2d\"),\r\n                opacity: this.layerCanvasArr[index].opacity,\r\n                name: this.layerCanvasArr[index].name,\r\n                id: index,\r\n            };\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error(\"layer of index \" + index + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getColorAt (x: number, y: number): IRGB {\r\n        x = Math.floor(x);\r\n        y = Math.floor(y);\r\n        let ctx = this.pickCanvas.getContext(\"2d\");\r\n        ctx.save();\r\n        ctx.imageSmoothingEnabled = false;\r\n        ctx.clearRect(0, 0, 1, 1);\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.globalAlpha = this.layerCanvasArr[i].opacity;\r\n            ctx.globalCompositeOperation = this.layerCanvasArr[i].mixModeStr;\r\n            ctx.drawImage(this.layerCanvasArr[i], -x, -y);\r\n        }\r\n        ctx.restore();\r\n        let imData = ctx.getImageData(0, 0, 1, 1);\r\n        return new BB.RGB(imData.data[0], imData.data[1], imData.data[2]);\r\n    }\r\n\r\n    getCompleteCanvas (factor: number): HTMLCanvasElement {\r\n        return drawProject(this.getProject(), factor);\r\n    }\r\n\r\n    getProject (): IKlProject {\r\n        return {\r\n            width: this.width,\r\n            height: this.height,\r\n            layers: this.layerCanvasArr.map(layer => {\r\n                return {\r\n                    name: layer.name,\r\n                    opacity: layer.opacity,\r\n                    mixModeStr: layer.mixModeStr,\r\n                    image: layer,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    addChangeListener (func: () => void): void {\r\n        if (this.changeListenerArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.changeListenerArr.push(func);\r\n    }\r\n\r\n    removeChangeListener (func: () => void): void {\r\n        for (let i = 0; i < this.changeListenerArr.length; i++) {\r\n            if (this.changeListenerArr[i] === func) {\r\n                this.changeListenerArr.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    setMixMode (layerIndex: number, mixModeStr: IMixMode): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"setMixMode\",\r\n            params: [layerIndex, '' + mixModeStr],\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Set composite drawing step for KlCanvasWorkspace.\r\n     * To apply temporary manipulations to a layer.\r\n     *\r\n     * @param layerIndex\r\n     * @param compositeObj\r\n     */\r\n    setComposite (\r\n        layerIndex: number,\r\n        compositeObj: null | {\r\n            draw: (ctx: CanvasRenderingContext2D) => void;\r\n        }\r\n    ): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].compositeObj = compositeObj;\r\n    }\r\n\r\n    destroy (): void {\r\n        if (this.layerCanvasArr === null) {\r\n            return;\r\n        }\r\n        this.layerCanvasArr.forEach(canvas => {\r\n            BB.freeCanvas(canvas);\r\n        });\r\n        this.layerCanvasArr = null;\r\n    }\r\n\r\n}\r\n","\r\n/**\r\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/ but it implemented tolerance wrong, and had bugs.\r\n * So, my own implementation. can handle tolerance, grow, opacity.\r\n * Needs to be optimized.\r\n */\r\n\r\n/**\r\n * Set values in data within rect to 254, unless they're 255\r\n *\r\n * @param data Uint8Array\r\n * @param width int\r\n * @param x0 int\r\n * @param y0 int\r\n * @param x1 int >x0\r\n * @param y1 int >y0\r\n */\r\nfunction fillRect(data, width, x0, y0, x1, y1) {\r\n    for (let x = x0; x <= x1; x++) {\r\n        for (let y = y0; y <= y1; y++) {\r\n            if (data[y * width + x] === 255) {\r\n                continue;\r\n            }\r\n            data[y * width + x] = 254;\r\n        }\r\n    }\r\n}\r\n\r\nlet mx, my;\r\n\r\n/**\r\n * Get index i moved by dX, dY. in array with dimensions width height.\r\n * Returns null if outside bounds.\r\n *\r\n * @param width int\r\n * @param height int\r\n * @param i int\r\n * @param dX int\r\n * @param dY int\r\n * @returns {null|*}\r\n */\r\nfunction moveIndex(width, height, i, dX, dY) {\r\n    mx = i % width + dX;\r\n    my = Math.floor(i / width) + dY;\r\n\r\n    if (mx < 0 || my < 0 || mx >= width || my >= height) {\r\n        return null;\r\n    }\r\n\r\n    return my * width + mx;\r\n}\r\n\r\n/**\r\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\r\n * returns false if already filled, or i is null\r\n *\r\n * @param srcArr Uint8Array rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param initRgba rgba\r\n * @param tolerance int 0 - 255\r\n * @param i int - srcArr index\r\n * @returns {boolean}\r\n */\r\nfunction testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i) {\r\n    if (i === null || targetArr[i] === 255) {\r\n        return false;\r\n    }\r\n\r\n    if (\r\n        srcArr[i * 4] === initRgba[0] &&\r\n        srcArr[i * 4 + 1] === initRgba[1] &&\r\n        srcArr[i * 4 + 2] === initRgba[2] &&\r\n        srcArr[i * 4 + 3] === initRgba[3]\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    if (\r\n        tolerance > 0 &&\r\n        Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n\r\n/**\r\n *\r\n * @param srcArr Uint8Array rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param px int\r\n * @param py int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n */\r\nfunction floodFill(srcArr, targetArr, width, height, px, py, tolerance, grow, isContiguous) {\r\n\r\n    let initRgba = [\r\n        srcArr[(py * width + px) * 4],\r\n        srcArr[(py * width + px) * 4 + 1],\r\n        srcArr[(py * width + px) * 4 + 2],\r\n        srcArr[(py * width + px) * 4 + 3]\r\n    ];\r\n\r\n    if (isContiguous) {\r\n        let q = [];\r\n        q.push(py * width + px);\r\n        targetArr[py * width + px] = 255;\r\n\r\n        let i, e;\r\n        while (q.length) {\r\n            i = q.pop();\r\n\r\n            // queue up unfilled neighbors\r\n            e = moveIndex(width, height, i, -1, 0); // left\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n\r\n            e = moveIndex(width, height, i, 1, 0); // right\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n\r\n            e = moveIndex(width, height, i, 0, -1); // up\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n\r\n            e = moveIndex(width, height, i, 0, 1); // bottom\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\r\n        }\r\n    } else {\r\n        for (let i = 0; i < width * height; i++) {\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i);\r\n        }\r\n    }\r\n\r\n\r\n    // grow\r\n    if (grow === 0) {\r\n        return;\r\n    }\r\n\r\n    // how does it grow? it finds all pixel at the edge.\r\n    // then depending on what kind of edge it is, it draws a rectangle into target\r\n    // the rectangle has the value 254, or else it mess it all up.\r\n    // after it's all done, replaces it with 255\r\n    let x0, x1, y0, y1;\r\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\r\n    for (let x = 0; x < width; x++) {\r\n        for (let y = 0; y < height; y++) {\r\n            if (targetArr[y * width + x] !== 255) {\r\n                continue;\r\n            }\r\n\r\n            // bounds of rectangle\r\n            x0 = x;\r\n            x1 = x;\r\n            y0 = y;\r\n            y1 = y;\r\n\r\n            l = targetArr[(y) * width + x - 1] !== 255;\r\n            tl = targetArr[(y - 1) * width + x - 1] !== 255;\r\n            t = targetArr[(y - 1) * width + x] !== 255;\r\n            tr = targetArr[(y - 1) * width + x + 1] !== 255;\r\n            r = targetArr[(y) * width + x + 1] !== 255;\r\n            br = targetArr[(y + 1) * width + x + 1] !== 255;\r\n            b = targetArr[(y + 1) * width + x] !== 255;\r\n            bl = targetArr[(y + 1) * width + x - 1] !== 255;\r\n\r\n            if (l) { // left\r\n                x0 = x - grow;\r\n            }\r\n            if (l && tl && t) { // top left\r\n                x0 = x - grow;\r\n                y0 = y - grow;\r\n            }\r\n            if (t) { // top\r\n                y0 = Math.min(y0, y - grow);\r\n            }\r\n            if (t && tr && r) { // top right\r\n                y0 = Math.min(y0, y - grow);\r\n                x1 = x + grow;\r\n            }\r\n            if (r) { // right\r\n                x1 = Math.max(x1, x + 1 * grow);\r\n            }\r\n            if (r && br && b) { // bottom right\r\n                x1 = Math.max(x1, x + 1 * grow);\r\n                y1 = Math.max(y1, y + 1 * grow);\r\n            }\r\n            if (b) { // bottom\r\n                y1 = Math.max(y1, y + 1 * grow);\r\n            }\r\n            if (b && bl && l) { // bottom left\r\n                x0 = Math.min(x0, x - 1 * grow);\r\n                y1 = Math.max(y1, y + 1 * grow);\r\n            }\r\n\r\n            if (!l && !tl && !t && !tr && !r && !br && !b && !bl) {\r\n                continue;\r\n            }\r\n\r\n            fillRect(\r\n                targetArr,\r\n                width,\r\n                Math.max(0, x0),\r\n                Math.max(0, y0),\r\n                Math.min(width - 1, x1),\r\n                Math.min(height - 1, y1)\r\n            );\r\n        }\r\n    }\r\n    for (let i = 0; i < width * height; i++) {\r\n        if (targetArr[i] === 254) {\r\n            targetArr[i] = 255;\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * Does flood fill, and returns that. an array - 0 not filled. 255 filled\r\n *\r\n * returns {\r\n *     data: Uint8Array\r\n * }\r\n *\r\n * @param rgbaArr Uint8Array rgba\r\n * @param width int\r\n * @param height int\r\n * @param x int\r\n * @param y int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n * @returns {{data: Uint8Array}}\r\n */\r\nexport function floodFillBits(rgbaArr, width, height, x, y, tolerance, grow, isContiguous) {\r\n    x = Math.round(x);\r\n    y = Math.round(y);\r\n\r\n    let resultArr = new Uint8Array(new ArrayBuffer(width * height));\r\n\r\n    floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\r\n\r\n    return {\r\n        data: resultArr\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IShapeToolObject} from '../kl.types';\r\n\r\n\r\n/**\r\n * Input processor for shape tool.\r\n * Coordinates are in canvas space.\r\n * angleRad is the angle of the canvas.\r\n *\r\n * @param p - {onShape: func(isDone, x1, y1, x2, y2, angleRad)}\r\n * @constructor\r\n */\r\nexport function ShapeTool(p) {\r\n\r\n    let downX, downY, downAngleRad;\r\n\r\n    this.onDown = function(x, y, angleRad) {\r\n        downX = x;\r\n        downY = y;\r\n        downAngleRad = angleRad;\r\n    };\r\n\r\n    this.onMove = function(x, y) {\r\n        p.onShape(false, downX, downY, x, y, downAngleRad);\r\n    };\r\n\r\n    this.onUp = function(x, y) {\r\n        p.onShape(true, downX, downY, x, y, downAngleRad);\r\n    };\r\n}\r\n\r\n/**\r\n * Draw a shape (rectangle, ellipse, line)\r\n *\r\n * @param ctx\r\n * @param shapeObj\r\n */\r\nexport function drawShape(\r\n    ctx: CanvasRenderingContext2D,\r\n    shapeObj: IShapeToolObject,\r\n) {\r\n\r\n    if (['rect', 'ellipse', 'line'].includes(shapeObj.type)) {\r\n        const lineWidth = Math.round(shapeObj.lineWidth);\r\n        const angleDeg = shapeObj.angleRad * 180 / Math.PI;\r\n\r\n        // --- prep canvas ---\r\n        ctx.save();\r\n        if (shapeObj.opacity) {\r\n            ctx.globalAlpha = shapeObj.opacity;\r\n        }\r\n        if (shapeObj.isEraser) {\r\n            ctx.globalCompositeOperation = 'destination-out';\r\n        }\r\n        ctx.rotate(-shapeObj.angleRad);\r\n        if (shapeObj.fillRgb) {\r\n            ctx.fillStyle = BB.ColorConverter.toRgbStr(shapeObj.fillRgb);\r\n        } else if (shapeObj.strokeRgb) {\r\n            ctx.strokeStyle = BB.ColorConverter.toRgbStr(shapeObj.strokeRgb);\r\n            ctx.lineWidth = lineWidth;\r\n        }\r\n\r\n        let x1 = shapeObj.x1;\r\n        let y1 = shapeObj.y1;\r\n        let x2 = shapeObj.x2;\r\n        let y2 = shapeObj.y2;\r\n\r\n        // --- angle snapping ---\r\n        if (shapeObj.isAngleSnap) {\r\n            let r1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            let r2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            let pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\r\n            let pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\r\n            let rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\r\n            x2 = rotated.x;\r\n            y2 = rotated.y;\r\n\r\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\r\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\r\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\r\n                    x2 = x1;\r\n                } else { // left or right\r\n                    y2 = y1;\r\n                }\r\n            }\r\n        }\r\n\r\n        let x = x1;\r\n        let y = y1;\r\n        let dX = x2 - x1;\r\n        let dY = y2 - y1;\r\n\r\n        // --- 1:1 ratio ---\r\n        if (shapeObj.type !== 'line' && shapeObj.isFixedRatio) {\r\n            let r1 = BB.rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\r\n            let r2 = BB.rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            let rx = r1.x;\r\n            let ry = r1.y;\r\n            let rdX = r2.x - r1.x;\r\n            let rdY = r2.y - r1.y;\r\n\r\n            if (Math.abs(rdX) < Math.abs(rdY)) {\r\n                rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\r\n            } else {\r\n                rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\r\n            }\r\n            r2.x = rx + rdX;\r\n            r2.y = ry + rdY;\r\n\r\n            r1 = BB.rotate(r1.x, r1.y, -shapeObj.angleRad / Math.PI * 180);\r\n            r2 = BB.rotate(r2.x, r2.y, -shapeObj.angleRad / Math.PI * 180);\r\n\r\n            x1 = r1.x;\r\n            y1 = r1.y;\r\n            x2 = r2.x;\r\n            y2 = r2.y;\r\n\r\n            x = x1;\r\n            y = y1;\r\n            dX = x2 - x1;\r\n            dY = y2 - y1;\r\n        }\r\n\r\n        // outwards modifier\r\n        if (shapeObj.isOutwards) {\r\n            x -= dX;\r\n            y -= dY;\r\n            dX *= 2;\r\n            dY *= 2;\r\n\r\n            x1 = x;\r\n            y1 = y;\r\n            x2 = x + dX;\r\n            y2 = y + dY;\r\n        }\r\n\r\n        let p1;\r\n        let p2;\r\n        if (shapeObj.type === 'line') { // --- line ---\r\n\r\n            // rounded\r\n            const x1r = Math.round(x1);\r\n            const y1r = Math.round(y1);\r\n            const x2r = Math.round(x2);\r\n            const y2r = Math.round(y2);\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (lineWidth % 2 === 0) {\r\n\r\n                if (y1r === y2r) {\r\n                    p1 = {\r\n                        x: x1f,\r\n                        y: y1r,\r\n                    };\r\n                    p2 = {\r\n                        x: x2f,\r\n                        y: y2r,\r\n                    };\r\n\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                } else if (x1r === x2r) {\r\n                    p1 = {\r\n                        x: x1r,\r\n                        y: y1f,\r\n                    };\r\n                    p2 = {\r\n                        x: x2r,\r\n                        y: y2f,\r\n                    };\r\n\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                } else {\r\n                    p1 = {\r\n                        x: x1,\r\n                        y: y1,\r\n                    };\r\n                    p2 = {\r\n                        x: x2,\r\n                        y: y2,\r\n                    };\r\n                }\r\n\r\n            } else {\r\n                p1 = {\r\n                    x: x1f,\r\n                    y: y1f,\r\n                };\r\n                p2 = {\r\n                    x: x2f,\r\n                    y: y2f,\r\n                };\r\n                if (y1f === y2f) {\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                    p1.y += 0.5;\r\n                    p2.y += 0.5;\r\n                } else if (x1f === x2f) {\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                    p1.x += 0.5;\r\n                    p2.x += 0.5;\r\n                } else {\r\n                    p1.x = x1;\r\n                    p1.y = y1;\r\n                    p2.x = x2;\r\n                    p2.y = y2;\r\n                }\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            ctx.beginPath();\r\n            ctx.moveTo(p1.x, p1.y);\r\n            ctx.lineTo(p2.x, p2.y);\r\n            ctx.stroke();\r\n\r\n        } else if (shapeObj.type === 'rect') { // --- rect ---\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (angleDeg % 90 === 0) {\r\n                if (shapeObj.fillRgb) {\r\n                    if (x1 % 1 === 0) {\r\n                        x1 += 1;\r\n                    }\r\n                    if (y1 % 1 === 0) {\r\n                        y1 += 1;\r\n                    }\r\n                    if (x2 % 1 === 0) {\r\n                        x2 += 1;\r\n                    }\r\n                    if (y2 % 1 === 0) {\r\n                        y2 += 1;\r\n                    }\r\n\r\n                    p1 = {\r\n                        x: x1 < x2 ? x1f : x2f,\r\n                        y: y1 < y2 ? y1f : y2f,\r\n                    };\r\n                    p2 = {\r\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\r\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y),\r\n                    };\r\n                    p2.x = p1.x + p2.x;\r\n                    p2.y = p1.y + p2.y;\r\n\r\n                } else {\r\n                    if (lineWidth % 2 === 0) {\r\n                        p1 = {\r\n                            x: x1f,\r\n                            y: y1f,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f,\r\n                            y: y2f,\r\n                        };\r\n                    } else {\r\n                        p1 = {\r\n                            x: x1f + 0.5,\r\n                            y: y1f + 0.5,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f + 0.5,\r\n                            y: y2f + 0.5,\r\n                        };\r\n                    }\r\n                }\r\n            } else {\r\n                p1 = {\r\n                    x: x1,\r\n                    y: y1,\r\n                };\r\n                p2 = {\r\n                    x: x2,\r\n                    y: y2,\r\n                };\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2.x = p2.x - p1.x;\r\n            p2.y = p2.y - p1.y;\r\n\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\r\n            } else {\r\n                ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\r\n            }\r\n\r\n        } else {  // --- circle ---\r\n            p1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n            x = p1.x;\r\n            y = p1.y;\r\n            dX = p2.x - p1.x;\r\n            dY = p2.y - p1.y;\r\n\r\n            ctx.beginPath();\r\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fill();\r\n            } else {\r\n                ctx.stroke();\r\n            }\r\n        }\r\n\r\n\r\n        ctx.restore();\r\n\r\n    } else {\r\n        throw new Error('unknown shape');\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {IRect} from '../../bb/bb.types';\r\n\r\nexport interface IRenderTextParam {\r\n    textStr: string; // text to be drawn. can contain newlines\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\r\n    align: 'left' | 'center' | 'right'; // default 'left'\r\n    isBold: boolean; // default false\r\n    isItalic: boolean; // default false\r\n    angleRad: number; // default 0 - rotates around x y\r\n    lineHeight?: number; // pixels\r\n    color: string;\r\n    isDebug?: boolean;\r\n}\r\n\r\n\r\n/**\r\n * Draw text on a canvas.\r\n *\r\n * @param canvas\r\n * @param p\r\n * @returns - bounds. coords relative to p.x p.y\r\n */\r\nexport function renderText(canvas: HTMLCanvasElement, p: IRenderTextParam): IRect {\r\n\r\n    // always at least a space. so bounds aren't just a dot\r\n    let textStr = p.textStr === '' ? ' ' : p.textStr;\r\n\r\n    // --- create el ---\r\n    // create an actual dom element. figure out where exactly each letter is positioned.\r\n    // that way multiline is feasible. canvas can't do multiline or text-align\r\n    let outer = BB.el({\r\n        css: {\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            width: '100000px',\r\n            fontSize: p.size + 'px',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n        }\r\n    });\r\n    let div = BB.el({\r\n        parent: outer,\r\n        css: {\r\n            display: 'inline-block',\r\n            textAlign: p.align ? p.align : 'left',\r\n            fontFamily: p.font ? p.font : 'sans-serif',\r\n            fontSize: p.size + 'px',\r\n            fontWeight: p.isBold ? 'bold' : 'normal',\r\n            fontStyle: p.isItalic ? 'italic' : 'normal',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n\r\n\r\n            opacity: '0',\r\n            pointerEvents: 'none'\r\n        }\r\n    });\r\n    let spanStr = '';\r\n    let replaceObj = {\r\n        \"\\n\": '<br>',\r\n        \" \": '&nbsp;',\r\n        \"\t\": '&nbsp;&nbsp;&nbsp;&nbsp;',\r\n    };\r\n    for (let i = 0; i < textStr.length; i++) {\r\n        if (textStr[i] === \"\\n\") {\r\n            div.appendChild(BB.el({\r\n                tagName: 'span',\r\n                textContent: spanStr,\r\n                css: {\r\n                    whiteSpace: 'pre'\r\n                }\r\n            }));\r\n            spanStr = '';\r\n            div.appendChild(BB.el({\r\n                tagName: 'br'\r\n            }));\r\n            continue;\r\n        }\r\n        spanStr += textStr[i].replace(\"\\t\", '    ');\r\n    }\r\n    div.appendChild(BB.el({\r\n        tagName: 'span',\r\n        textContent: spanStr,\r\n        css: {\r\n            whiteSpace: 'pre'\r\n        }\r\n    }));\r\n    document.body.appendChild(outer);\r\n\r\n\r\n    // --- determine bounds ---\r\n    let bounds = {\r\n        x0: 99999999,\r\n        y0: 99999999,\r\n        x1: 0,\r\n        y1: 0\r\n    }\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        let el = div.children[i] as HTMLElement;\r\n        bounds.x0 = Math.min(bounds.x0, el.offsetLeft);\r\n        bounds.y0 = Math.min(bounds.y0, el.offsetTop);\r\n        bounds.x1 = Math.max(bounds.x1, el.offsetLeft + el.offsetWidth);\r\n        bounds.y1 = Math.max(bounds.y1, el.offsetTop + el.offsetHeight);\r\n    }\r\n\r\n    // --- draw ---\r\n    let ctx = canvas.getContext('2d');\r\n    ctx.save();\r\n\r\n    let font = [];\r\n    if (p.isItalic) {\r\n        font.push('italic');\r\n    }\r\n    if (p.isBold) {\r\n        font.push('bold');\r\n    }\r\n    font.push(p.size + 'px ' + (p.font ? p.font : 'sans-serif'));\r\n    ctx.font = font.join(' ');\r\n    ctx.fillStyle = p.color ? p.color : '#000';\r\n\r\n    let x = p.x;\r\n    let y = p.y;\r\n    if (p.align === 'right') {\r\n        x += -bounds.x1 + bounds.x0;\r\n    }\r\n    if (p.align === 'center') {\r\n        x += (-bounds.x1 + bounds.x0) / 2;\r\n    }\r\n    ctx.translate(p.x, p.y);\r\n    ctx.rotate(p.angleRad ? -p.angleRad : 0);\r\n    ctx.translate(-p.x, -p.y);\r\n    ctx.translate(x, y);\r\n\r\n    // fill\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        let el = div.children[i] as HTMLElement;\r\n\r\n        //ctx.fillText(el.innerText, 0, 0);\r\n        ctx.fillText(el.innerText, el.offsetLeft, el.offsetTop);\r\n    }\r\n\r\n    if (p.isDebug) {\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeRect(0, -p.size * 0.85, bounds.x1, bounds.y1);\r\n        ctx.restore();\r\n        ctx.fillRect(p.x - 1, p.y - 1, 2, 2);\r\n    } else {\r\n        ctx.restore();\r\n    }\r\n\r\n    document.body.removeChild(outer);\r\n\r\n    return {\r\n        x: x - p.x,\r\n        y: y - p.y -p.size * 0.85,\r\n        width: bounds.x1 - bounds.x0,\r\n        height: bounds.y1 - bounds.y0\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IKlProject} from '../kl.types';\r\n\r\nexport function drawProject(project: IKlProject, factor) {\r\n    let resultCanvas = BB.canvas(\r\n        Math.max(1, Math.round(project.width * factor)),\r\n        Math.max(1, Math.round(project.height * factor))\r\n    );\r\n    let ctx = resultCanvas.getContext(\"2d\");\r\n    ctx.save();\r\n    if (factor > 1) {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n    for (let i = 0; i < project.layers.length; i++) {\r\n        if (project.layers[i].opacity === 0) {\r\n            continue;\r\n        }\r\n        ctx.globalAlpha = project.layers[i].opacity;\r\n        ctx.globalCompositeOperation = project.layers[i].mixModeStr ? project.layers[i].mixModeStr : 'source-over';\r\n        ctx.drawImage(project.layers[i].image, 0, 0, resultCanvas.width, resultCanvas.height);\r\n    }\r\n    ctx.restore();\r\n    return resultCanvas;\r\n}","import {IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {TTranslationCode} from '../../../languages/languages';\r\n\r\nexport function translateBlending(blendMode?: IMixMode): string {\r\n    if (!blendMode) {\r\n        return LANG('layers-blend-normal');\r\n    }\r\n\r\n    const codes: {\r\n        [key: string]: TTranslationCode\r\n    } = {\r\n        'source-over': 'layers-blend-normal',\r\n        'darken': 'layers-blend-darken',\r\n        'multiply': 'layers-blend-multiply',\r\n        'color-burn': 'layers-blend-color-burn',\r\n        'lighten': 'layers-blend-lighten',\r\n        'screen': 'layers-blend-screen',\r\n        'color-dodge': 'layers-blend-color-dodge',\r\n        'overlay': 'layers-blend-overlay',\r\n        'soft-light': 'layers-blend-soft-light',\r\n        'hard-light': 'layers-blend-hard-light',\r\n        'difference': 'layers-blend-difference',\r\n        'exclusion': 'layers-blend-exclusion',\r\n        'hue': 'layers-blend-hue',\r\n        'saturation': 'layers-blend-saturation',\r\n        'color': 'layers-blend-color',\r\n        'luminosity': 'layers-blend-luminosity',\r\n    };\r\n\r\n    if (!(blendMode in codes)) {\r\n        throw new Error('unknown blend mode');\r\n    }\r\n    return LANG(codes[blendMode]);\r\n}","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl.types';\r\n\r\n/**\r\n * Overlay for KlCanvasWorkspace.\r\n * - brush circle\r\n * - eyedropper circle\r\n * - compass needle (rotation hud)\r\n */\r\nexport class WorkspaceSvgOverlay {\r\n    private rootElement: SVGElement;\r\n    private brushCircleOuter: SVGElement;\r\n    private brushCircleInner: SVGElement;\r\n    private pickerPreviewBorder: SVGElement;\r\n    private pickerPreviewCol: SVGElement;\r\n    private readonly compassSize: number;\r\n    private compass: SVGElement;\r\n    private compassInner: SVGElement;\r\n    private compassBaseCircle: SVGElement;\r\n    private compassLineCircle: SVGElement;\r\n    private compassUpperTriangle: SVGElement;\r\n    private compassLowerTriangle: SVGElement;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n        }\r\n    ) {\r\n        this.rootElement = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + p.width,\r\n            height: '' + p.height,\r\n        });\r\n        BB.css(this.rootElement, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            pointerEvents: 'none',\r\n            userSelect: 'none'\r\n        });\r\n\r\n        //brush circles\r\n        this.brushCircleOuter = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '10',\r\n            stroke: 'rgba(0,0,0,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.brushCircleInner = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '9',\r\n            stroke: 'rgba(255,255,255,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\r\n\r\n        //color picker preview circle\r\n        this.pickerPreviewBorder = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '22',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewBorder.style.opacity = '0';\r\n        this.pickerPreviewCol = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '20',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewCol.style.opacity = '0';\r\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\r\n\r\n\r\n        //rotation compass\r\n        this.compassSize = 30;\r\n        this.compass = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'translate(' + (p.width/2) + ', ' + (p.height/2) + ')',\r\n        });\r\n        BB.css(this.compass, {\r\n            transition: 'opacity 0.25s ease-in-out',\r\n            opacity: '0',\r\n        });\r\n        this.compassInner = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'rotate(45)',\r\n        });\r\n        this.compassBaseCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'rgba(0,0,0,0.9)',\r\n            stroke: 'none',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + this.compassSize,\r\n        });\r\n        this.compassLineCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'none',\r\n            stroke: 'rgba(255,255,255,0.75)',\r\n            'stroke-width': '1',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + (this.compassSize * 0.9),\r\n        });\r\n        this.compassUpperTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#f00',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,-'+(this.compassSize * 0.9)+' z',\r\n        });\r\n        this.compassLowerTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#fff',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,'+(this.compassSize * 0.9)+' z',\r\n        });\r\n\r\n        this.compassInner.append(\r\n            this.compassBaseCircle,\r\n            this.compassLineCircle,\r\n            this.compassUpperTriangle,\r\n            this.compassLowerTriangle\r\n        );\r\n        this.compass.append(this.compassInner);\r\n        this.rootElement.append(this.compass);\r\n    }\r\n\r\n    getElement (): SVGElement {\r\n        return this.rootElement;\r\n    }\r\n\r\n    setSize (width: number, height: number): void {\r\n        this.rootElement.setAttribute('width', '' + width);\r\n        this.rootElement.setAttribute('height', '' + height);\r\n        this.compass.setAttribute('transform', 'translate(' + (width/2) + ', ' + (height/2) + ')');\r\n    }\r\n\r\n    updateCursor (p: {\r\n        x?: number;\r\n        y?: number;\r\n        radius?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if ('x' in p) {\r\n            this.brushCircleOuter.setAttribute('cx', '' + p.x);\r\n            this.brushCircleInner.setAttribute('cx', '' + p.x);\r\n        }\r\n        if ('y' in p) {\r\n            this.brushCircleOuter.setAttribute('cy', '' + p.y);\r\n            this.brushCircleInner.setAttribute('cy', '' + p.y);\r\n        }\r\n        if ('radius' in p) {\r\n            this.brushCircleOuter.setAttribute('r', '' + Math.max(0, p.radius));\r\n            this.brushCircleInner.setAttribute('r', '' + Math.max(0, p.radius - 1));\r\n        }\r\n        if ('isVisible' in p) {\r\n            this.brushCircleOuter.style.opacity = p.isVisible ? '1' : '0';\r\n            this.brushCircleInner.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateColorPreview (p: {\r\n        x?: number;\r\n        y?: number;\r\n        color?: IRGB;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if ('x' in p) {\r\n            this.pickerPreviewCol.setAttribute('cx', '' + p.x);\r\n            this.pickerPreviewBorder.setAttribute('cx', '' + p.x);\r\n        }\r\n        if ('y' in p) {\r\n            this.pickerPreviewCol.setAttribute('cy', '' + p.y);\r\n            this.pickerPreviewBorder.setAttribute('cy', '' + p.y);\r\n        }\r\n        if ('color' in p) {\r\n            this.pickerPreviewCol.setAttribute('stroke', BB.ColorConverter.toRgbStr(p.color));\r\n            let borderColor = BB.testIsWhiteBestContrast(p.color) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\r\n            this.pickerPreviewBorder.setAttribute('stroke', borderColor);\r\n        }\r\n        if ('isVisible' in p) {\r\n            this.pickerPreviewCol.style.opacity = p.isVisible ? '1' : '0';\r\n            this.pickerPreviewBorder.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateCompass (p: {\r\n        angleDeg?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if ('angleDeg' in p) {\r\n            this.compassInner.setAttribute('transform', 'rotate(' + p.angleDeg + ')');\r\n            this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? '1' : '0';\r\n        }\r\n        if ('isVisible' in p) {\r\n            this.compass.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB, ITransform} from '../kl.types';\r\nimport {WorkspaceSvgOverlay} from './workspace-svg-overlay';\r\nimport {klHistory} from '../history/kl-history';\r\n// @ts-ignore\r\nimport pickerImg from 'url:~/src/app/img/ui/cursor-picker.png';\r\n// @ts-ignore\r\nimport zoomEwImg from 'url:~/src/app/img/ui/cursor-zoom-ew.png';\r\n// @ts-ignore\r\nimport fillImg from 'url:~/src/app/img/ui/cursor-fill.png';\r\n// @ts-ignore\r\nimport textImg from 'url:~/src/app/img/ui/cursor-text.png';\r\nimport {IPressureInput, IVector2D} from '../../bb/bb.types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {KeyListener} from '../../bb/input/key-listener';\r\n\r\nexport interface IViewChangeEvent {\r\n    changed: ('scale' | 'angle')[];\r\n    angle: number;\r\n    scale: number;\r\n}\r\n\r\ntype TModeStr = 'draw' | 'pick' | 'hand' | 'shape' | 'fill' | 'text'; // | 'transform' | 'select'\r\n\r\nconst MIN_SCALE = 1 / 16;\r\nconst MAX_SCALE = 64;\r\nenum TMode {\r\n    Draw,\r\n    Hand,\r\n    HandGrabbing,\r\n    Pick,\r\n    Zoom,\r\n    Rotate,\r\n    Rotating,\r\n    Fill,\r\n    Text,\r\n    Shape,\r\n}\r\nconst ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\r\n\r\n/**\r\n * Work area that displays the KlCanvas.\r\n * - pan, zoom, rotate (also via multi-touch)\r\n * - input modes: drawing, hand, pick, fill, text // transform, select\r\n * - drawing input events\r\n * - view change events\r\n * - eyedropper input events (pick)\r\n * - draws cursor, eyedropper overlay\r\n *\r\n * subscribes to klCanvas changes\r\n * listens to kl history for changes\r\n * and you can manually trigger redraw\r\n */\r\nexport class KlCanvasWorkspace {\r\n\r\n    private rootEl: HTMLElement;\r\n    private klCanvas: KlCanvas;\r\n    private renderTargetCanvas: HTMLCanvasElement;\r\n    private renderTargetCtx: CanvasRenderingContext2D;\r\n    private renderWidth: number;\r\n    private renderHeight: number;\r\n    private compositeCanvas: HTMLCanvasElement; // for drawing klcanvas layer composite\r\n    private compositeCtx: CanvasRenderingContext2D;\r\n    private doResizeCanvas: boolean;\r\n    private oldTransformObj: ITransform;\r\n    private targetTransformObj: ITransform; // animation target\r\n    private highResTransformObj: ITransform; // animated, internal high res\r\n    private renderedTransformObj: ITransform; // same as highRes, but rounded - what's actually displayed\r\n    private cursorPos: IVector2D;\r\n    private usesCssCursor: boolean;\r\n    private bgVisible: boolean;\r\n    private transformIsDirty: boolean;\r\n    private doAnimateTranslate: boolean;\r\n    private svgOverlay: WorkspaceSvgOverlay;\r\n    private emptyCanvas: HTMLCanvasElement;\r\n    private keyListener: KeyListener;\r\n    private currentMode: TMode;\r\n    private globalMode: TMode;\r\n    private renderTime: number; // for debugging - average ms per render()\r\n    private lastDrawEvent: IPressureInput | null; // previous drawing input\r\n    private linetoolProcessor: any; // todo type - BB.EventChain.LinetoolProcessor\r\n    private pointer: IVector2D | null; // position of cursor\r\n    private isDrawing: boolean;\r\n    private inputProcessorObj: any; // todo type\r\n    private currentInputProcessor: any; // todo type\r\n    private angleIsExtraSticky: boolean;\r\n    private pinchZoomer: any; // todo type - BB.EventChain.PinchZoomer\r\n    private mainDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\r\n    private middleDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\r\n    private twoFingerTap: any; // todo type - BB.EventChain.NFingerTapper\r\n    private threeFingerTap: any; // todo type - BB.EventChain.NFingerTapper\r\n    private pointerEventChain: any; // todo type - BB.EventChain.EventChain\r\n    private pointerListener: any; // todo type - BB.PointerListener\r\n    private brushRadius: number;\r\n    private animationFrameRequested: boolean;\r\n    private lastRenderedState: number; // KlHistory state - to detect if there are changes to draw\r\n    private lastRenderTime: number; // ms from performance.now()\r\n    private hideBrushCursorTimeout: number;\r\n    private onViewChange: (e:  IViewChangeEvent) => void;\r\n\r\n    private getRenderedTransform (): ITransform {\r\n        // rounded x & y so canvas is less blurry.\r\n        const result = this.renderedTransformObj;\r\n        result.x = this.highResTransformObj.x;\r\n        result.y = this.highResTransformObj.y;\r\n        result.scale = this.highResTransformObj.scale;\r\n        result.angle = this.highResTransformObj.angle;\r\n\r\n        if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\r\n            result.x = Math.round(result.x);\r\n            result.y = Math.round(result.y);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private updateChangeListener (): void {\r\n        this.klCanvas.addChangeListener(() => {\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n        });\r\n    }\r\n\r\n    private updateCursor (modeInt: TMode, doForce?: boolean): void {\r\n        if (modeInt === this.currentMode && !doForce) {\r\n            return;\r\n        }\r\n        const oldMode = this.currentMode;\r\n        this.currentMode = modeInt;\r\n        this.lastRenderedState = -1;\r\n        if (this.currentMode === TMode.Draw) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        } else if (this.currentMode === TMode.Hand) {\r\n            this.rootEl.style.cursor = 'grab';\r\n        } else if (this.currentMode === TMode.HandGrabbing) {\r\n            this.rootEl.style.cursor = 'grabbing';\r\n        } else if (this.currentMode === TMode.Pick) {\r\n            this.rootEl.style.cursor = \"url('\" + pickerImg + \"') 0 15, crosshair\";\r\n        } else if (this.currentMode === TMode.Zoom) {\r\n            this.rootEl.style.cursor = \"url('\" + zoomEwImg + \"') 7 7, zoom-in\";\r\n        } else if (this.currentMode === TMode.Rotate) {\r\n            this.rootEl.style.cursor = \"grab\";\r\n        } else if (this.currentMode === TMode.Rotating) {\r\n            this.rootEl.style.cursor = \"grabbing\";\r\n        } else if (this.currentMode === TMode.Fill) {\r\n            this.rootEl.style.cursor = \"url('\" + fillImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Text) {\r\n            this.rootEl.style.cursor = \"url('\" + textImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Shape) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        }\r\n\r\n        if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode)) {\r\n            const oldIsHand = [TMode.Hand, TMode.HandGrabbing].includes(oldMode);\r\n            const currentIsHand = [TMode.Hand, TMode.HandGrabbing].includes(this.currentMode);\r\n            if (!oldIsHand && currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n            }\r\n            if (oldIsHand && !currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n            }\r\n        }\r\n\r\n        if (this.currentMode !== TMode.Pick) {\r\n            this.svgOverlay.updateColorPreview({isVisible: false});\r\n        }\r\n    }\r\n\r\n    /**\r\n     * returns false if no change of zoom\r\n     * @param stepNum\r\n     * @param centerX\r\n     * @param centerY\r\n     * @private\r\n     */\r\n    private internalZoomByStep (stepNum: number, centerX: number, centerY: number): boolean {\r\n        const step = Math.log2(this.targetTransformObj.scale);\r\n\r\n        let newStep = step / Math.abs(stepNum);\r\n        newStep += stepNum > 0 ? 1 : -1;\r\n        newStep = Math.round(newStep);\r\n        newStep *= Math.abs(stepNum);\r\n        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, Math.pow(2, newStep)));\r\n\r\n        //has zoomed?\r\n        if (newScale === this.targetTransformObj.scale) {\r\n            return false;\r\n        }\r\n\r\n\r\n        const effectiveFactor = newScale / this.targetTransformObj.scale;\r\n        this.targetTransformObj.scale = newScale;\r\n\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerX, centerY));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerX, -centerY));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.transformIsDirty = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * mixes two transform objects. modifies A\r\n     * @param transformA\r\n     * @param transformB\r\n     * @param blendFactor 0 -> A, 1 -> B\r\n     * @private\r\n     */\r\n    private mixTransformObj (transformA: ITransform, transformB: ITransform, blendFactor: number): void {\r\n        if (transformA.angle === transformB.angle) {\r\n            transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n            transformA.x = BB.mix(transformA.x, transformB.x, blendFactor);\r\n            transformA.y = BB.mix(transformA.y, transformB.y, blendFactor);\r\n            transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n            return;\r\n        }\r\n\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        // --- determine centerPosA, centerPosB ---\r\n        const centerPosA = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2\r\n        }, transformA);\r\n        const centerPosB = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2\r\n        }, transformB);\r\n\r\n        // --- centerPosMixed ---\r\n        transformA.x = BB.mix(centerPosA.x , centerPosB.x, blendFactor);\r\n        transformA.y = BB.mix(centerPosA.y , centerPosB.y, blendFactor);\r\n\r\n        // --- scale and angle ---\r\n        transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n        transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n\r\n        // --- x and y ---\r\n        const mixedPos = this.canvasToWorkspaceCoord({\r\n            x: -w / 2,\r\n            y: -h / 2\r\n        }, transformA);\r\n        transformA.x = mixedPos.x;\r\n        transformA.y = mixedPos.y;\r\n    }\r\n\r\n    private render (): void {\r\n        if (this.doResizeCanvas) {\r\n            this.doResizeCanvas = false;\r\n            this.renderTargetCanvas.width = this.renderWidth;\r\n            this.renderTargetCanvas.height = this.renderHeight;\r\n        }\r\n        this.renderContext(this.renderTargetCtx);\r\n    }\r\n\r\n    /**\r\n     * is the gray background that surrounds canvas visible?\r\n     * @private\r\n     */\r\n    private testBgVisible (): boolean {\r\n        //bring workspace points (corners of workspace) into canvas coordinate system\r\n        //then check if any corner point is outside of the canvas -> that means the bg is visible\r\n\r\n        const workspacePointArr = [\r\n            [0, 0], // top left\r\n            [this.renderWidth, 0], // top right\r\n            [this.renderWidth, this.renderHeight], // bottom right\r\n            [0, this.renderHeight], // bottom left\r\n        ];\r\n\r\n        const art = this.getRenderedTransform();\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        //transform points, then test if outside of canvas\r\n        for (let i = 0; i < workspacePointArr.length; i++) {\r\n            let coords = [workspacePointArr[i][0], workspacePointArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n            if (\r\n                !(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() &&\r\n                    0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())\r\n            ){\r\n                //if not inside -> bg visible\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private renderContext (ctx: CanvasRenderingContext2D): void {\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        const art = this.getRenderedTransform();\r\n\r\n        if (art.scale >= 4 || (art.scale === 1 && art.angle === 0)) {\r\n            ctx.imageSmoothingEnabled = false;\r\n        } else {\r\n            ctx.imageSmoothingEnabled = true;\r\n            ctx.imageSmoothingQuality  = 'low'; // art.scale >= 1 ? 'low' : 'medium';\r\n        }\r\n        //ctx.imageSmoothingEnabled = false;\r\n        //renderTargetCtx.globalCompositeOperation  = 'multiply';\r\n\r\n\r\n\r\n        ctx.save();\r\n        {\r\n            if (this.bgVisible) {\r\n                ctx.fillStyle = 'rgb(158,158,158)'; // 'rgb(185,185,185)';\r\n                ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\r\n            } else {\r\n                ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\r\n            }\r\n\r\n\r\n\r\n            if (this.bgVisible) {\r\n                ctx.save();\r\n\r\n                ctx.translate(art.x, art.y);\r\n                ctx.scale(art.scale, art.scale);\r\n                ctx.rotate(art.angle);\r\n\r\n                ctx.imageSmoothingEnabled = false;\r\n\r\n                //outline\r\n                const borderSize = 1;\r\n                ctx.globalAlpha = 0.2;\r\n                ctx.drawImage(\r\n                    this.emptyCanvas,\r\n                    -borderSize / art.scale,\r\n                    -borderSize / art.scale,\r\n                    w + borderSize * 2 / art.scale,\r\n                    h + borderSize * 2 / art.scale\r\n                );\r\n                ctx.globalAlpha = 1;\r\n\r\n                //erase\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n                ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\r\n\r\n                ctx.restore();\r\n            }\r\n\r\n            /*const region = new Path2D();\r\n            region.rect(80, 10, 20, 130);\r\n            ctx.clip(region);*/\r\n\r\n            ctx.translate(art.x, art.y);\r\n            ctx.scale(art.scale, art.scale);\r\n            ctx.rotate(art.angle);\r\n\r\n            const layerArr = this.klCanvas.getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    ctx.globalAlpha = layerArr[i].opacity;\r\n                    ctx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n\r\n                    if (layerArr[i].canvas.compositeObj) {\r\n                        if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\r\n                            this.compositeCanvas.width = layerArr[i].canvas.width;\r\n                            this.compositeCanvas.height = layerArr[i].canvas.height;\r\n                        } else {\r\n                            this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\r\n                        }\r\n                        this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\r\n                        layerArr[i].canvas.compositeObj.draw(this.compositeCtx);\r\n                        ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\r\n                    } else {\r\n                        ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\r\n                    }\r\n                }\r\n            }\r\n            ctx.globalAlpha = 1;\r\n\r\n\r\n\r\n        }\r\n        ctx.restore();\r\n\r\n        // rotation hud\r\n        if (TMode.Rotate === this.currentMode || TMode.Rotating === this.currentMode) {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: true,\r\n                angleDeg: art.angle / Math.PI * 180\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: false\r\n            });\r\n        }\r\n    }\r\n\r\n    private workspaceToCanvasCoord (p: IVector2D): IVector2D {\r\n        const art = this.getRenderedTransform();\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private canvasToWorkspaceCoord (p: IVector2D, transformObj: ITransform): IVector2D {\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(transformObj.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(transformObj.scale));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private snapAngleRad (angleRad: number, snapDegIncrement: number, maxDistDeg: number): number {\r\n        let angleDeg = angleRad * 180 / Math.PI;\r\n        const modDeg = Math.abs(angleDeg % snapDegIncrement);\r\n        const dist = Math.min(modDeg, snapDegIncrement - modDeg);\r\n\r\n        if (dist <= maxDistDeg) {\r\n            angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\r\n        }\r\n\r\n        return angleDeg / 180 * Math.PI;\r\n    }\r\n\r\n    /**\r\n     * angle always in range [-PI, PI]\r\n     * @param angleRad\r\n     * @private\r\n     */\r\n    private minimizeAngleRad (angleRad: number): number {\r\n        angleRad = angleRad % (2 * Math.PI);\r\n        if (angleRad > Math.PI) {\r\n            angleRad -= 2 * Math.PI;\r\n        } else if (angleRad < -Math.PI) {\r\n            angleRad += 2 * Math.PI;\r\n        }\r\n        return angleRad;\r\n    }\r\n\r\n    private resetInputProcessor (): void {\r\n        this.currentInputProcessor = null;\r\n        this.updateCursor(this.globalMode);\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    private reqFrame (doRedrawCanvas?: boolean): void {\r\n        this.animationFrameRequested = true;\r\n        if (doRedrawCanvas) {\r\n            this.lastRenderedState = -1;\r\n        }\r\n    }\r\n\r\n    private updateLoop (): void {\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState;\r\n\r\n        //handle variable framerate\r\n        const nowTime = performance.now();\r\n        const elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\r\n        this.lastRenderTime = nowTime;\r\n\r\n        if (this.animationFrameRequested || doRender) {\r\n            this.animationFrameRequested = false;\r\n            this.checkChange(elapsedFrames);\r\n        }\r\n    }\r\n\r\n    private checkChange (elapsedFrames: number): void {\r\n\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState ||\r\n            this.highResTransformObj.scale !== this.targetTransformObj.scale ||\r\n            this.highResTransformObj.x !== this.targetTransformObj.x ||\r\n            this.highResTransformObj.y !== this.targetTransformObj.y;\r\n\r\n        //update transform\r\n        if (\r\n            !this.doAnimateTranslate &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else if (\r\n            (this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) &&\r\n            (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            this. doAnimateTranslate = false;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else {\r\n            this.reqFrame(); //probably needs another frame\r\n            const blendFactor = Math.min(1, ANIMATION_SPEED * elapsedFrames);\r\n            this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\r\n            this.bgVisible = true; // spare yourself the calculation\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        }\r\n\r\n        if (this.pointer && this.currentMode == TMode.Draw && !this.usesCssCursor) {\r\n            this.svgOverlay.updateCursor({\r\n                x: this.pointer.x,\r\n                y: this.pointer.y,\r\n                isVisible: true\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCursor({isVisible: false});\r\n        }\r\n\r\n\r\n        if (doRender) {\r\n            //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\r\n            this.lastRenderedState = newState;\r\n            const start = performance.now();\r\n            this.render();\r\n            this.renderTime = BB.mix(this.renderTime, performance.now() - start, 0.05);\r\n        }\r\n        //setTimeout(this.checkChange, 100);\r\n\r\n\r\n\r\n        if (doRender) {\r\n\r\n            //console.log('rendertime ms: ', this.renderTime);\r\n        }\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            klCanvas: any; // todo\r\n            width: number;\r\n            height: number;\r\n            onDraw: (val) => void; // todo\r\n            onPick: (rgb: IRGB, isPointerup: boolean) => void;\r\n            onFill: (canvasX: number, canvasY: number) => void;\r\n            onText: (canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onShape: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onViewChange: (e:  IViewChangeEvent) => void;\r\n            onUndo: () => void;\r\n            onRedo: () => void;\r\n        }\r\n    ) {\r\n        const _this = this;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                right: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                cursor: 'crosshair',\r\n                userSelect: 'none',\r\n                colorScheme: 'only light',\r\n            }\r\n        });\r\n        this.klCanvas = p.klCanvas;\r\n        this.onViewChange = p.onViewChange;\r\n        this.renderTargetCanvas = BB.canvas(p.width, p.height);\r\n        this.renderTargetCtx = this.renderTargetCanvas.getContext('2d');\r\n        this.renderWidth = p.width;\r\n        this.renderHeight = p.height;\r\n        this.compositeCanvas = BB.canvas(1, 1); // for drawing klcanvas layer composite\r\n        this.compositeCtx = this.compositeCanvas.getContext('2d');\r\n        this.doResizeCanvas = false;\r\n        this.oldTransformObj = null;\r\n        this.targetTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0\r\n        };\r\n        this.highResTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0\r\n        };\r\n        this.renderedTransformObj = {\r\n            x: null,\r\n            y: null,\r\n            scale: null,\r\n            angle: null\r\n        };\r\n        this.cursorPos = {\r\n            x: 0,\r\n            y: 0\r\n        };\r\n        this.usesCssCursor = false;\r\n        this.bgVisible = true;\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n\r\n        this.svgOverlay = new WorkspaceSvgOverlay({\r\n            width: p.width,\r\n            height: p.height\r\n        });\r\n\r\n        BB.css(this.renderTargetCanvas, {\r\n            userSelect: 'none',\r\n            pointerEvents: 'none',\r\n        });\r\n        BB.createCheckerDataUrl(8, (url) => {\r\n            this.renderTargetCanvas.style.background = \"url(\" + url + \")\";\r\n        });\r\n        this.rootEl.appendChild(this.renderTargetCanvas);\r\n        this.rootEl.appendChild(this.svgOverlay.getElement());\r\n        BB.addEventListener(this.rootEl, 'touchend', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        BB.addEventListener(this.rootEl, 'contextmenu', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        BB.addEventListener(this.rootEl, 'dragstart', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n\r\n        this.emptyCanvas = BB.canvas(1, 1);\r\n        {\r\n            const ctx = this.emptyCanvas.getContext('2d');\r\n            ctx.fillRect(0, 0, 1, 1);\r\n        }\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n                if (isRepeat) {\r\n                    return;\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n\r\n                } else {\r\n\r\n                    if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'space') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.spaceHand;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ([TMode.Draw, TMode.Hand, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'alt') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.altPicker;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if (['r', 'shift+r'].includes(comboStr)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.rotate;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ('z' === comboStr) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.zoom;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                }\r\n\r\n            },\r\n            onUp: (keyStr, event, oldComboStr) => {\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.currentMode = TMode.Draw;\r\n        this.globalMode = TMode.Draw;\r\n\r\n        this.renderTime = 0;\r\n\r\n        this.lastDrawEvent = null;\r\n\r\n        this.linetoolProcessor = new BB.EventChain.LinetoolProcessor({\r\n            onDraw: (event) => {\r\n                const getMatrix = () => {\r\n                    const art = this.getRenderedTransform();\r\n                    let matrix = BB.Matrix.getIdentity();\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n                    return matrix;\r\n                };\r\n\r\n                if (event.type === 'line' && !this.lastDrawEvent) {\r\n                    const matrix = getMatrix();\r\n                    let coords = [event.x1, event.y1, 0, 1];\r\n                    coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                    this.lastDrawEvent = {\r\n                        x: coords[0],\r\n                        y: coords[1],\r\n                        pressure: event.pressure1\r\n                    };\r\n                    return;\r\n                }\r\n\r\n                if ('x' in event || 'x0' in event) {\r\n\r\n                    const matrix = getMatrix();\r\n\r\n                    if ('x' in event) { //down or move\r\n                        let coords = [event.x, event.y, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x = coords[0];\r\n                        event.y = coords[1];\r\n                    }\r\n                    if ('x0' in event) { //line\r\n                        event.x0 = this.lastDrawEvent.x;\r\n                        event.y0 = this.lastDrawEvent.y;\r\n                        event.pressure0 = this.lastDrawEvent.pressure;\r\n                        let coords = [event.x1, event.y1, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x1 = coords[0];\r\n                        event.y1 = coords[1];\r\n\r\n                        this.lastDrawEvent = {\r\n                            x: event.x1,\r\n                            y: event.y1,\r\n                            pressure: event.pressure1,\r\n                        };\r\n                    }\r\n                }\r\n\r\n\r\n                if (['down', 'move'].includes(event.type)) {\r\n                    this.lastDrawEvent = event;\r\n                }\r\n                p.onDraw(event);\r\n            }\r\n        });\r\n\r\n        this.pointer = null;\r\n        this.isDrawing = false;\r\n\r\n\r\n        this.inputProcessorObj = {\r\n            draw: {\r\n                onPointer: (val) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Draw);\r\n\r\n                    const comboStr = this.keyListener.getComboStr();\r\n\r\n                    const event: any = {\r\n                        scale: this.highResTransformObj.scale\r\n                    };\r\n                    event.shiftIsPressed = comboStr === 'shift';\r\n                    event.pressure = val.pressure;\r\n                    event.isCoalesced = !!val.isCoalesced;\r\n\r\n                    if (val.type === 'pointerdown') {\r\n\r\n                        this.isDrawing = true;\r\n                        event.type = 'down';\r\n\r\n                    } else if (val.button) {\r\n                        event.type = 'move';\r\n\r\n                    } else if (val.type === 'pointerup') {\r\n\r\n                        this.isDrawing = false;\r\n                        event.type = 'up';\r\n\r\n                        this.linetoolProcessor.process(event);\r\n                        this.resetInputProcessor();\r\n                        return;\r\n                    } else {\r\n                        return;\r\n                    }\r\n\r\n                    event.x = val.relX;\r\n                    event.y = val.relY;\r\n\r\n                    this.linetoolProcessor.process(event);\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            fill: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Fill);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            text: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Text);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            shape: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Shape);\r\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        this.isDrawing = true;\r\n                        p.onShape('down', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        p.onShape('move', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.isDrawing = false;\r\n                        p.onShape('up', coord.x, coord.y, this.renderedTransformObj.angle);\r\n                        this.resetInputProcessor();\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            hand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            spaceHand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'space') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                }\r\n            },\r\n            zoom: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Zoom);\r\n\r\n                    if (event.button === 'left' && !event.isCoalesced && event.dX != 0) {\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n\r\n                        this.internalZoomByStep(event.dX / 175, event.downPageX - offsetX, event.downPageY - offsetY);\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'z') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Zoom);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                }\r\n            },\r\n            picker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup'\r\n                        });\r\n\r\n                        if (event.type === 'pointerup') {\r\n                            this.resetInputProcessor();\r\n                        }\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                }\r\n            },\r\n            altPicker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup'\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'alt') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                }\r\n            },\r\n            rotate: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(event.button === 'left' ? TMode.Rotating : TMode.Rotate);\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                    } else if (event.button === 'left' && !event.isCoalesced && this.oldTransformObj) {\r\n\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n                        //rotation done around center\r\n                        const centerObj = {\r\n                            x: this.renderWidth / 2,\r\n                            y: this.renderHeight / 2\r\n                        };\r\n\r\n                        const startAngleRad = BB.Vec2.angle(centerObj, {x: event.downPageX - offsetX, y: event.downPageY - offsetY});\r\n                        const angleRad = BB.Vec2.angle(centerObj, {x: event.pageX - offsetX, y: event.pageY - offsetY});\r\n                        let dAngleRad = angleRad - startAngleRad;\r\n\r\n                        //apply angle\r\n                        this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\r\n                        this.targetTransformObj.angle += dAngleRad;\r\n\r\n                        if (this.keyListener.isPressed('shift')) {\r\n                            this.targetTransformObj.angle = Math.round(this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\r\n                            dAngleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n                        }\r\n\r\n                        this.targetTransformObj.angle = this.minimizeAngleRad(this.targetTransformObj.angle);\r\n\r\n                        //rotate transform.xy\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(dAngleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n\r\n                        this.transformIsDirty = true;\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['angle'],\r\n                            scale: this.targetTransformObj.scale,\r\n                            angle: this.targetTransformObj.angle\r\n                        });\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    const comboStr = this.keyListener.getComboStr();\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        this.currentInputProcessor = null;\r\n\r\n\r\n        this.angleIsExtraSticky = false;\r\n        this.pinchZoomer = new BB.EventChain.PinchZoomer({\r\n            onPinch: (event) => {\r\n\r\n                if (event.type === 'move') {\r\n\r\n                    if (!this.oldTransformObj) {\r\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n                        this.angleIsExtraSticky = this.targetTransformObj.angle % (Math.PI / 2) === 0;\r\n                    }\r\n\r\n                    this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\r\n\r\n                    event.scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, this.targetTransformObj.scale * event.scale)) / this.targetTransformObj.scale;\r\n\r\n                    this.targetTransformObj.scale *= event.scale;\r\n                    this.targetTransformObj.angle += event.angleRad;\r\n                    this.targetTransformObj.angle = this.minimizeAngleRad(\r\n                        this.snapAngleRad(\r\n                            this.targetTransformObj.angle,\r\n                            90,\r\n                            this.angleIsExtraSticky ? 12 : 4\r\n                        )\r\n                    );\r\n                    if (this.targetTransformObj.angle % (Math.PI / 2) !== 0) {\r\n                        this.angleIsExtraSticky = false;\r\n                    }\r\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\r\n                    event.angleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n\r\n                    //calc translation\r\n                    {\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX, event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(event.scale));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(event.angleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-event.relX, -event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\r\n\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                    }\r\n\r\n                    this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n\r\n                    //if (event.scale !== 1) {\r\n                    this.onViewChange({\r\n                        changed: ['scale', 'angle'],\r\n                        scale: this.targetTransformObj.scale,\r\n                        angle: this.targetTransformObj.angle\r\n                    });\r\n                    //}\r\n                    this.reqFrame();\r\n                    this.transformIsDirty = true;\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                } else if (event.type === 'end') {\r\n                    this.oldTransformObj = null;\r\n                }\r\n\r\n\r\n            }\r\n        });\r\n\r\n        const onDoubleTap = () => {\r\n            let oldTransform = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n            _this.fitView();\r\n            //_this.resetView(true);\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n\r\n            if (\r\n                oldTransform.scale !== this.targetTransformObj.scale ||\r\n                oldTransform.angle !== this.targetTransformObj.angle\r\n            ) {\r\n                this.onViewChange({\r\n                    changed: ['scale', 'angle'],\r\n                    angle: this.targetTransformObj.angle,\r\n                    scale: this.targetTransformObj.scale\r\n                });\r\n            }\r\n        }\r\n\r\n        this.mainDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper.setAllowedButtonArr(['middle']);\r\n\r\n\r\n        this.twoFingerTap = new BB.EventChain.NFingerTapper({\r\n            fingers: 2,\r\n            onTap: () => {\r\n                p.onUndo();\r\n            }\r\n        });\r\n        this.threeFingerTap = new BB.EventChain.NFingerTapper({\r\n            fingers: 3,\r\n            onTap: () => {\r\n                p.onRedo();\r\n            }\r\n        });\r\n\r\n\r\n        this.pointerEventChain = new BB.EventChain.EventChain({\r\n            chainArr: [\r\n                this.twoFingerTap,\r\n                this.threeFingerTap,\r\n                this.mainDoubleTapper,\r\n                this.middleDoubleTapper,\r\n                this.pinchZoomer,\r\n                new BB.EventChain.OnePointerLimiter(),\r\n                new BB.EventChain.CoalescedExploder()\r\n            ]\r\n        });\r\n        this.pointerEventChain.setChainOut((event) => {\r\n\r\n            this.cursorPos.x = event.relX;\r\n            this.cursorPos.y = event.relY;\r\n            if (event.type === 'pointerup' && event.pointerType === 'touch') {\r\n                this.pointer = null;\r\n                this.lastRenderedState = -1;\r\n                this.reqFrame();\r\n            } else {\r\n                if (!this.pointer) {\r\n                    this.pointer = { x: 0, y: 0 };\r\n                }\r\n                this.pointer.x = event.relX;\r\n                this.pointer.y = event.relY;\r\n            }\r\n\r\n            if (this.currentInputProcessor) {\r\n                this.currentInputProcessor.onPointer(event);\r\n\r\n            } else {\r\n\r\n                let comboStr = this.keyListener.getComboStr();\r\n\r\n                if (this.globalMode === TMode.Draw) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.draw;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Draw);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Hand) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'middle'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Pick) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'right'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Fill) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.fill;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Fill);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Text) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.text;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Text);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Shape) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.shape;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Shape);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n        });\r\n\r\n        //prevent ctrl scroll -> zooming page\r\n        BB.addEventListener(this.rootEl, 'wheel', (event) => {\r\n            event.preventDefault();\r\n        });\r\n\r\n\r\n        setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.rootEl,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    if (e.type === 'pointerdown' && e.button === 'middle') {\r\n                        try {\r\n                            e.eventPreventDefault();\r\n                        } catch (e) {}\r\n                    }\r\n                    /*if (e.type === 'pointermove') {\r\n                        BB.throwOut(JSON.stringify(e));\r\n                    }*/\r\n\r\n                    this.pointerEventChain.chainIn(e)\r\n                },\r\n                onWheel: (wheelEvent) => {\r\n\r\n                    if (this.isDrawing) {\r\n                        return;\r\n                    }\r\n\r\n                    this.reqFrame();\r\n                    let didZoom = this.internalZoomByStep(\r\n                        -wheelEvent.deltaY / (this.keyListener.isPressed('shift') ? 8 : 2),\r\n                        wheelEvent.relX,\r\n                        wheelEvent.relY\r\n                    );\r\n                    if (didZoom) {\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale\r\n                        });\r\n                    }\r\n\r\n                    //updateCursor(TMode.Draw, true);\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                },\r\n                onEnterLeave: (isOver) => {\r\n                    if (!isOver) {\r\n                        if (!this.isDrawing) {\r\n                            this.pointer = null;\r\n                            this.lastRenderedState = -1;\r\n                        }\r\n                    }\r\n                },\r\n                maxPointers: 4\r\n            });\r\n        }, 1);\r\n\r\n        this.brushRadius = 1;\r\n\r\n        this.animationFrameRequested = false;\r\n\r\n\r\n\r\n\r\n        //setup rendering\r\n        this.lastRenderedState = -2;\r\n        this.lastRenderTime = performance.now();\r\n\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n\r\n        this.resetView();\r\n    }\r\n\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setCanvas (klC: KlCanvas): void {\r\n        this.klCanvas = klC;\r\n        this.lastDrawEvent = null;\r\n        this.resetView();\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    /**\r\n     * set size of workspace area in pixels\r\n     * @param width\r\n     * @param height\r\n     */\r\n    setSize (width: number, height: number): void {\r\n        const oldWidth = this.renderWidth;\r\n        const oldHeight = this.renderHeight;\r\n\r\n        if (width === oldWidth && height === oldHeight) {\r\n            return;\r\n        }\r\n\r\n        this.doResizeCanvas = true;\r\n        this.renderWidth = width;\r\n        this.renderHeight = height;\r\n\r\n        this.svgOverlay.setSize(width, height);\r\n\r\n        this.targetTransformObj.x += (width - oldWidth) / 2;\r\n        this.targetTransformObj.y += (height - oldHeight) / 2;\r\n\r\n        this.highResTransformObj.x = this.targetTransformObj.x;\r\n        this.highResTransformObj.y = this.targetTransformObj.y;\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setMode (modeStr: TModeStr): void {\r\n        //only sets the base mode\r\n        if (modeStr === 'draw') {\r\n            this.globalMode = TMode.Draw;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'fill') {\r\n            this.globalMode = TMode.Fill;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'text') {\r\n            this.globalMode = TMode.Text;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'shape') {\r\n            this.globalMode = TMode.Shape;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'hand') {\r\n            this.globalMode = TMode.Hand;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n        }\r\n        if (modeStr === 'pick') {\r\n            this.globalMode = TMode.Pick;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n    }\r\n\r\n    setEnabled (b: boolean): void {\r\n        // todo\r\n    }\r\n\r\n    setCursorSize (diameter: number): void {\r\n        this.brushRadius = diameter / 2;\r\n\r\n        this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n\r\n        if (this.pointer === null) {\r\n            clearTimeout(this.hideBrushCursorTimeout);\r\n\r\n            this.svgOverlay.updateCursor({\r\n                x: this.renderWidth / 2,\r\n                y: this.renderHeight / 2,\r\n                isVisible: true\r\n            });\r\n\r\n            // @ts-ignore\r\n            this.hideBrushCursorTimeout = setTimeout(() => {\r\n                if (this.pointer !== null) {\r\n                    return;\r\n                }\r\n                this.svgOverlay.updateCursor({isVisible: false});\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n    zoomByStep (stepNum: number): void {\r\n        if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) {\r\n            return;\r\n        }\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale'],\r\n            angle: this.targetTransformObj.angle,\r\n            scale: this.targetTransformObj.scale\r\n        });\r\n    }\r\n\r\n    resetView (doAnimate?: boolean): void {\r\n        this.targetTransformObj.scale = 1;\r\n        this.targetTransformObj.angle = 0;\r\n\r\n        this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\r\n        this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\r\n\r\n        if (!doAnimate) {\r\n            this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n        } else {\r\n            this.doAnimateTranslate = true;\r\n            this.transformIsDirty = true;\r\n        }\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n        this.reqFrame();\r\n\r\n        if (doAnimate) {\r\n            this.onViewChange({\r\n                changed: ['scale', 'angle'],\r\n                scale: this.targetTransformObj.scale,\r\n                angle: this.targetTransformObj.angle\r\n            });\r\n        }\r\n    }\r\n\r\n    fitView (): void {\r\n        //fit into view. center. snap angle. margin of 10px\r\n\r\n        this.targetTransformObj.angle = this.snapAngleRad(this.targetTransformObj.angle, 90, 90);\r\n\r\n        //calc width and height of bounds\r\n        const canvasPointsArr = [\r\n            [0, 0], // top left\r\n            [this.klCanvas.getWidth(), 0], // top right\r\n            [this.klCanvas.getWidth(), this.klCanvas.getHeight()], // bottom right\r\n            [0, this.klCanvas.getHeight()], // bottom left\r\n            [this.klCanvas.getWidth() / 2, this.klCanvas.getHeight() / 2], // center\r\n        ];\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle));\r\n\r\n        //rotate points\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            let coords = [canvasPointsArr[i][0], canvasPointsArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n            canvasPointsArr[i][0] = coords[0];\r\n            canvasPointsArr[i][1] = coords[1];\r\n        }\r\n\r\n        const boundsObj = {\r\n            x0: null,\r\n            y0: null,\r\n            x1: null,\r\n            y1: null\r\n        };\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            if (boundsObj.x0 === null || canvasPointsArr[i][0] < boundsObj.x0) {\r\n                boundsObj.x0 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y0 === null || canvasPointsArr[i][1] < boundsObj.y0) {\r\n                boundsObj.y0 = canvasPointsArr[i][1];\r\n            }\r\n            if (boundsObj.x1 === null || canvasPointsArr[i][0] > boundsObj.x1) {\r\n                boundsObj.x1 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y1 === null || canvasPointsArr[i][1] > boundsObj.y1) {\r\n                boundsObj.y1 = canvasPointsArr[i][1];\r\n            }\r\n        }\r\n        const boundsWidth = boundsObj.x1 - boundsObj.x0;\r\n        const boundsHeight = boundsObj.y1 - boundsObj.y0;\r\n\r\n        //fit bounds\r\n        const padding = 40;\r\n        const { width: fitWidth } = BB.fitInto(\r\n            boundsWidth,\r\n            boundsHeight, \r\n            this.renderWidth - padding, \r\n            this.renderHeight - padding, \r\n            1\r\n        );\r\n\r\n        //determine scale\r\n        const factor = fitWidth / boundsWidth;\r\n\r\n        //center\r\n        this.targetTransformObj.x = (this.renderWidth / 2) - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor;\r\n        this.targetTransformObj.y = (this.renderHeight / 2) - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor;\r\n\r\n        this.targetTransformObj.scale = factor;\r\n        this.doAnimateTranslate = true;\r\n        this.transformIsDirty = true;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale', 'angle'],\r\n            scale: this.targetTransformObj.scale,\r\n            angle: this.targetTransformObj.angle\r\n        });\r\n    }\r\n\r\n    setAngle (angleDeg: number, isRelative?: boolean): void {\r\n        //rotation done around center\r\n        const centerObj = {\r\n            x: this.renderWidth / 2,\r\n            y: this.renderHeight / 2\r\n        };\r\n\r\n        const oldAngleRad = this.targetTransformObj.angle;\r\n        const angleRad = angleDeg / 180 * Math.PI;\r\n\r\n        if (isRelative) {\r\n            this.targetTransformObj.angle += angleRad;\r\n        } else {\r\n            this.targetTransformObj.angle = angleRad;\r\n        }\r\n\r\n        this.targetTransformObj.angle = this.minimizeAngleRad(\r\n            this.snapAngleRad(\r\n                this.targetTransformObj.angle,\r\n                90,\r\n                4\r\n            )\r\n        );\r\n\r\n        //rotate transform.xy\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\r\n        this.transformIsDirty = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    /**\r\n     * translate canvas by viewport pixels\r\n     * @param tx\r\n     * @param ty\r\n     */\r\n    translateView (tx: number, ty: number): void {\r\n        const scale = 40;\r\n\r\n        this.targetTransformObj.x += tx * scale;\r\n        this.targetTransformObj.y += ty * scale;\r\n\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    getScale (): number {\r\n        return this.targetTransformObj.scale;\r\n    }\r\n\r\n    getAngleDeg (): number {\r\n        return this.targetTransformObj.angle * 180 / Math.PI;\r\n    }\r\n\r\n    getMaxScale (): number {\r\n        return MAX_SCALE;\r\n    }\r\n\r\n    getMinScale (): number {\r\n        return MIN_SCALE;\r\n    }\r\n\r\n    requestFrame (): void {\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setLastDrawEvent (x: number | null, y?: number, pressure?: number): void {\r\n        if (x === null) {\r\n            this.lastDrawEvent = null;\r\n            return;\r\n        }\r\n\r\n        if (!this.lastDrawEvent) {\r\n            this.lastDrawEvent = {x: 0, y: 0, pressure: 0};\r\n        }\r\n        this.lastDrawEvent.x = x;\r\n        this.lastDrawEvent.y = y;\r\n        this.lastDrawEvent.pressure = pressure;\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1dLwT\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"9wZxU\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hQSEH\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"916ZI\");","import {BB} from '../../bb/bb';\r\nimport {IKlBasicLayer} from '../kl.types';\r\n\r\n/**\r\n * preview of image with layers. can do mix modes and opacity.\r\n * creates a canvas.\r\n *\r\n * p = {\r\n *     width: 123,\r\n *     height: 123,\r\n *     layers: [// can be changed after the fact\r\n *         {\r\n *             image: Canvas,\r\n *             opacity: 1,\r\n *             mixModeStr: 'source-over'\r\n *         }\r\n *     ]\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function KlCanvasPreview(\r\n    p: {\r\n        width: number;\r\n        height: number;\r\n        layers: IKlBasicLayer[];\r\n    }\r\n) {\r\n    const scale = p.width / p.layers[0].image.width;\r\n    const width = scale > 1 ? p.layers[0].image.width : p.width;\r\n    const height = scale > 1 ? p.layers[0].image.height : p.height;\r\n\r\n    let canvas = BB.canvas(width, height);\r\n    canvas.style.backgroundImage = 'url(' + BB.createCheckerDataUrl(8) + ')';\r\n    let ctx = canvas.getContext('2d');\r\n\r\n    BB.css(canvas, {\r\n        width: '100%',\r\n        height: '100%',\r\n        imageRendering: scale > 1 ? 'pixelated' : null,\r\n    });\r\n\r\n    function render() {\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        for (let i = 0; i < p.layers.length; i++) {\r\n            ctx.globalAlpha = p.layers[i].opacity;\r\n            ctx.globalCompositeOperation = p.layers[i].mixModeStr;\r\n            if (canvas.width > p.layers[i].image.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(p.layers[i].image, 0, 0, canvas.width, canvas.height);\r\n        }\r\n        ctx.restore();\r\n    }\r\n\r\n    setTimeout(render, 0);\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return canvas;\r\n    };\r\n\r\n    this.render = function() {\r\n        render();\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport rotateImg from 'url:~/src/app/img/ui/cursor-rotate.png';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {IVector2D} from '../../../bb/bb.types';\r\n\r\nexport interface ITransform {\r\n    x: number; // center of transform region. image space\r\n    y: number;\r\n    width: number; // size of transform region. image space\r\n    height: number;\r\n    angleDeg: number; // angle of transform region. degrees\r\n}\r\n\r\n\r\n/**\r\n * snap entire transform to pixel grid. changes transform\r\n *\r\n * for x y:\r\n * If a dimension has an even size, it be an integer.\r\n * If it's uneven, it's sits exactly half way between two pixels.\r\n *\r\n * @param transform\r\n */\r\nfunction snapToPixel(transform: ITransform): void {\r\n    if (Math.abs(transform.angleDeg) % 90 !== 0) {\r\n        return;\r\n    }\r\n\r\n    transform.width = Math.round(transform.width);\r\n    transform.height = Math.round(transform.height);\r\n    // 0 is original orientation.\r\n    // At 90 and 270 width and height become swapped due to different orientation.\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    transform.x = ((whSwapped ? transform.height : transform.width) % 2 === 0) ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\r\n    transform.y = ((whSwapped ? transform.width : transform.height) % 2 === 0)  ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\r\n}\r\n\r\nfunction copyTransform(transform: ITransform): ITransform {\r\n    return {\r\n        x: transform.x,\r\n        y: transform.y,\r\n        width: transform.width,\r\n        height: transform.height,\r\n        angleDeg: transform.angleDeg,\r\n    };\r\n}\r\n\r\n/**\r\n * image space to transform space\r\n * - origin of transform space is at center of transform bounds.\r\n * - same scale as image space. -> one unit is x: 1/width, y: 1/height\r\n * - up is where transform points up\r\n * - x goes right\r\n * - y goes down\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nfunction toTransformSpace (x: number, y: number, transform: ITransform): IVector2D {\r\n    let px, py;\r\n    px = x - transform.x;\r\n    py = y - transform.y;\r\n\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: px, y: py},\r\n        -transform.angleDeg);\r\n    px = rot.x;\r\n    py = rot.y;\r\n\r\n    return {\r\n        x: px,\r\n        y: py,\r\n    };\r\n}\r\n\r\n/**\r\n * transform space to image space\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nfunction toImageSpace(x: number, y: number, transform: ITransform): IVector2D {\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: x, y: y},\r\n        transform.angleDeg);\r\n    return {\r\n        x: rot.x + transform.x,\r\n        y: rot.y + transform.y,\r\n    };\r\n}\r\n\r\n\r\n\r\n/**\r\n * Free Transform UI\r\n * rotate, scale, translate\r\n *\r\n * - if rotation is multiple of 90 it will snap to pixels, to be more useful for pixel art\r\n * - when rotation goes from non-multiple of 90 to a multiple, it will snap position and width height to pixels\r\n * - transform.x, transform.y can sit between pixels (by 0.5) if width or height is odd number.\r\n *      - this is what complicates things\r\n * - if transform region small, corner grips move out of the way\r\n *\r\n * iX iY, iP.x, iP.y - i indicates image space\r\n * tX tY, tP.x, tP.y - t indicates transform space\r\n *\r\n * Not sure if can be used for navigable canvas. (especially if canvas rotates view)\r\n * Probably can't be extended for distort. Needs a different approach.\r\n *\r\n * --- DOM structure ---\r\n * rootEl {\r\n * \ttransEl [\r\n * \t\tboundsEl\r\n * \t\tedges[]\r\n * \t\tcorners[] - round grips in the corner of transform region\r\n * \t\tangleGrip\r\n * \t]\r\n * }\r\n *\r\n */\r\nexport class FreeTransform {\r\n\r\n    // --- private ---\r\n    private readonly transform: ITransform; // coordinates and dimensions of transformation\r\n    private isConstrained: boolean;\r\n    private ratio: number; // aspect ratio of transform\r\n    private readonly scale: number;\r\n    private readonly scaled = { // scaled coordinates and dimensions for screenspace\r\n        x: 0,\r\n        y: 0,\r\n        width: 0,\r\n        height: 0,\r\n        corners: [{x: 0, y: 0}], // in transform space\r\n    };\r\n    private readonly minSnapDist = 7; // minimal snapping distance in px screenspace\r\n    private snappingEnabled: boolean;\r\n    private readonly snapX: number[];\r\n    private readonly snapY: number[];\r\n    private readonly callback: (transform: ITransform) => void;\r\n\r\n\r\n    private readonly cornerCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n    private readonly gripSize = 14;\r\n    private readonly edgeSize = 10;\r\n\r\n    private readonly rootEl: HTMLElement; // sits at origin of image\r\n    private readonly transEl: HTMLElement; // at middle of transform. rotates\r\n    private readonly boundsEl: HTMLElement; // draggable bounds rectangle with outline\r\n    private readonly corners: {\r\n        i: number; // index in corners array\r\n        el: HTMLElement; // draggable corner circle in DOM\r\n        x: number; // unscaled position (transform space)\r\n        y: number;\r\n        virtualPos: IVector2D; // unscaled temporary position (image space)\r\n        updateDOM: () => void; // update styling in DOM\r\n        pointerListener: any;\r\n    }[] = [];\r\n    private keyListener: KeyListener;\r\n    private boundsPointerListener: any; // BB.PointerListener\r\n    private anglePointerListener: any; // BB.PointerListener\r\n    private readonly edges: { // derive position from corners\r\n        el: HTMLElement;\r\n        updateDOM: () => void;\r\n        pointerListener: any;\r\n    }[] = [];\r\n    private readonly angleGrip: {\r\n        el: HTMLElement,\r\n        x: number; // transform space\r\n        y: number;\r\n        snap: boolean,\r\n        updateDOM: () => void,\r\n    };\r\n\r\n    private updateScaled(): void {\r\n        this.scaled.x = this.transform.x * this.scale;\r\n        this.scaled.y = this.transform.y * this.scale;\r\n        this.scaled.width = this.transform.width * this.scale;\r\n        this.scaled.height = this.transform.height * this.scale;\r\n        this.scaled.corners = this.corners.map((item) => {\r\n            return {x: item.x * this.scale, y: item.y * this.scale};\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\r\n     * both in image space\r\n     *\r\n     * @param iX - image space\r\n     * @param iY - image space\r\n     * @private\r\n     */\r\n    private snapCorner (iX: number, iY: number): IVector2D {\r\n        if (!this.snappingEnabled) {\r\n            return {x: iX, y: iY};\r\n        }\r\n        let dist: number;\r\n        const snap: {\r\n            x: number;\r\n            y: number;\r\n            dist: {\r\n                x: number;\r\n                y: number;\r\n            }\r\n        } = {\r\n            x: null,\r\n            y: null,\r\n            dist: {\r\n                x: null,\r\n                y: null,\r\n            }\r\n        };\r\n        for (let e = 0; e < this.snapX.length; e++) {\r\n            dist = Math.abs(iX - this.snapX[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.x === null || dist < snap.dist.x) {\r\n                    snap.x = this.snapX[e];\r\n                    snap.dist.x = dist;\r\n                }\r\n            }\r\n        }\r\n        for (let e = 0; e < this.snapY.length; e++) {\r\n            dist = Math.abs(iY - this.snapY[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.y === null || dist < snap.dist.y) {\r\n                    snap.y = this.snapY[e];\r\n                    snap.dist.y = dist;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (snap.x === null && snap.y === null) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        return {\r\n            x: snap.x ?? iX,\r\n            y: snap.y ?? iY,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * If constrained return nearest corner pos that fits aspect ratio\r\n     *\r\n     * @param cornerIndex\r\n     * @param iX\r\n     * @param iY\r\n     * @private\r\n     */\r\n    private constrainCorner (cornerIndex: number, iX: number, iY: number): IVector2D {\r\n        if (!this.isConstrained) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        const flip = this.transform.width * this.transform.height < 0 ? -1 : 1;\r\n        return BB.projectPointOnLine(\r\n            {x: this.transform.x, y: this.transform.y},\r\n            toImageSpace(this.ratio, flip * ([0, 2].includes(cornerIndex) ? 1 : -1), this.transform),\r\n            {x: iX, y: iY}\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Update corners according to width height.\r\n     * Not their DOM.\r\n     */\r\n    private updateCornerPositions (): void {\r\n        this.corners[0].x = (-this.transform.width / 2); // top left\r\n        this.corners[0].y = (-this.transform.height / 2);\r\n\r\n        this.corners[1].x = (this.transform.width / 2); // top right\r\n        this.corners[1].y = (-this.transform.height / 2);\r\n\r\n        this.corners[2].x = (this.transform.width / 2); // bottom right\r\n        this.corners[2].y = (this.transform.height / 2);\r\n\r\n        this.corners[3].x = (-this.transform.width / 2); // bottom left\r\n        this.corners[3].y = (this.transform.height / 2);\r\n    }\r\n\r\n    /**\r\n     * If constrained and dragging an edge, restore aspect ratio\r\n     * Updates corner positions.\r\n     *\r\n     * @param widthChanged\r\n     * @param heightChanged\r\n     * @private\r\n     */\r\n    private restoreRatio (widthChanged: boolean, heightChanged: boolean): void {\r\n        if (!this.isConstrained) {\r\n            return;\r\n        }\r\n        const angle90 = Math.abs(this.transform.angleDeg) % 90 === 0;\r\n        const whSwapped = Math.abs(this.transform.angleDeg - 90) % 180 === 0;\r\n        if (heightChanged && !widthChanged) {\r\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\r\n            let newWidth = this.ratio * newHeight;\r\n            if (angle90) {\r\n                newWidth = (whSwapped ? this.transform.y % 1 : this.transform.x % 1) === 0 ?\r\n                    BB.roundEven(newWidth) : BB.roundUneven(newWidth);\r\n            }\r\n            if (this.corners[1].x - this.corners[0].x < 0) {\r\n                newWidth *= -1;\r\n            }\r\n            this.corners[0].x = -newWidth / 2;\r\n            this.corners[3].x = -newWidth / 2;\r\n            this.corners[1].x = newWidth / 2;\r\n            this.corners[2].x = newWidth / 2;\r\n        }\r\n        if (!heightChanged && widthChanged) {\r\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\r\n            let newHeight = newWidth / this.ratio;\r\n            if (angle90) {\r\n                newHeight = (whSwapped ? this.transform.x % 1 : this.transform.y % 1) === 0  ?\r\n                    BB.roundEven(newHeight) : BB.roundUneven(newHeight);\r\n            }\r\n            if (this.corners[3].y - this.corners[0].y < 0) {\r\n                newHeight *= -1;\r\n            }\r\n            this.corners[0].y = -newHeight / 2;\r\n            this.corners[1].y = -newHeight / 2;\r\n            this.corners[2].y = newHeight / 2;\r\n            this.corners[3].y = newHeight / 2;\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * update transform based on corners\r\n     * @private\r\n     */\r\n    private updateTransformViaCorners (): void {\r\n\r\n        // calc transform center in image space\r\n        const rot = BB.rotateAround(\r\n            {x: 0, y: 0},\r\n            {\r\n                x: (this.corners[0].x + this.corners[1].x) / 2,\r\n                y: (this.corners[0].y + this.corners[3].y) / 2,\r\n            },\r\n            this.transform.angleDeg\r\n        );\r\n        this.transform.x = rot.x + this.transform.x;\r\n        this.transform.y = rot.y + this.transform.y;\r\n\r\n        // update size\r\n        this.transform.width = this.corners[1].x - this.corners[0].x;\r\n        this.transform.height = this.corners[3].y - this.corners[0].y;\r\n\r\n        // new center means corners changed their position\r\n        this.updateCornerPositions();\r\n\r\n        this.updateDOM();\r\n    }\r\n\r\n    /**\r\n     * updates DOM according to transform\r\n     * @param skipCallback\r\n     */\r\n    private updateDOM (skipCallback?: boolean) {\r\n        this.updateScaled();\r\n\r\n        BB.css(this.transEl, {\r\n            left: this.scaled.x + \"px\",\r\n            top: this.scaled.y + \"px\",\r\n            transformOrigin: \"0 0\",\r\n            transform: \"rotate(\" + this.transform.angleDeg + \"deg)\",\r\n        });\r\n\r\n        BB.css(this.boundsEl, {\r\n            width: Math.abs(this.scaled.width) + \"px\",\r\n            height: Math.abs(this.scaled.height) + \"px\",\r\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + \"px\",\r\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + \"px\"\r\n        });\r\n\r\n        this.corners[0].updateDOM();\r\n        this.corners[1].updateDOM();\r\n        this.corners[2].updateDOM();\r\n        this.corners[3].updateDOM();\r\n\r\n        this.edges[0].updateDOM();\r\n        this.edges[1].updateDOM();\r\n        this.edges[2].updateDOM();\r\n        this.edges[3].updateDOM();\r\n\r\n\r\n        this.angleGrip.x = 0;\r\n        this.angleGrip.y = (-Math.abs(this.transform.height * this.scale) / 2) - 20;\r\n        this.angleGrip.updateDOM();\r\n        if (!skipCallback) {\r\n            if (this.callback) { // why should updateDOM trigger the callback?\r\n                this.callback(copyTransform(this.transform));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // --- public ---\r\n    constructor (\r\n        params: {\r\n            x: number; // center of transform region. image space\r\n            y: number;\r\n            width: number; // size of transform region. image space\r\n            height: number;\r\n            angleDeg: number; // angle of transform region. degrees\r\n\r\n            isConstrained: boolean; // proportions constrained\r\n            snapX: number[]; // where snapping along X axis. image space\r\n            snapY: number[]; // where snapping along X axis. image space\r\n            scale: number; // ratio of screen-space / image-space\r\n            callback: (transform: ITransform) => void;\r\n        }\r\n    ) {\r\n        this.transform = { // coordinates and dimensions of transformation\r\n            x: params.x,\r\n            y: params.y,\r\n            width: params.width,\r\n            height: params.height,\r\n            angleDeg: params.angleDeg,\r\n        };\r\n\r\n        this.isConstrained = !!params.isConstrained;\r\n\r\n        this.snapX = params.snapX;\r\n        this.snapY = params.snapY;\r\n        this.callback = params.callback;\r\n        this.scale = params.scale;\r\n        this.snappingEnabled = true;\r\n        this.ratio = this.transform.width / this.transform.height;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-free-transform',\r\n            css: {\r\n                userSelect: 'none',\r\n            }\r\n        });\r\n        this.transEl = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                position: 'absolute',\r\n            }\r\n        });\r\n\r\n        this.boundsEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                cursor: 'move',\r\n                boxShadow: 'rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px',\r\n            }\r\n        });\r\n\r\n        const pointerRemainder = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        function resetRemainder() {\r\n            pointerRemainder.x = 0;\r\n            pointerRemainder.y = 0;\r\n        }\r\n        this.keyListener = new BB.KeyListener({});\r\n\r\n        let boundsStartP = {\r\n            x: 0,\r\n            y: 0,\r\n        }\r\n        this.boundsPointerListener = new BB.PointerListener({\r\n            target: this.boundsEl,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointerdown') {\r\n                    boundsStartP = {x: this.transform.x, y: this.transform.y};\r\n                }\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    this.transform.x = boundsStartP.x + (event.pageX - event.downPageX) / this.scale;\r\n                    this.transform.y = boundsStartP.y + (event.pageY - event.downPageY) / this.scale;\r\n\r\n\r\n                    let dist;\r\n                    let snap: any = {};\r\n                    if (this.snappingEnabled) {\r\n                        let i;\r\n                        for (i = 0; i < this.snapX.length; i++) {\r\n                            dist = Math.abs(this.transform.x - this.snapX[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.x || dist < snap.distX) {\r\n                                    snap.x = this.snapX[i];\r\n                                    snap.distX = dist;\r\n                                }\r\n                            }\r\n                        }\r\n                        for (i = 0; i < this.snapY.length; i++) {\r\n                            dist = Math.abs(this.transform.y - this.snapY[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.y || dist < snap.distY) {\r\n                                    snap.y = this.snapY[i];\r\n                                    snap.distY = dist;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        let iP;\r\n                        for (i = 0; i < 4; i++) {\r\n                            iP = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n                            let j;\r\n                            for (j = 0; j < this.snapX.length; j++) {\r\n                                dist = Math.abs(iP.x - this.snapX[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.x || dist < snap.distX) {\r\n                                        snap.x = this.snapX[j] - (iP.x - this.transform.x);\r\n                                        snap.distX = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                            for (j = 0; j < this.snapY.length; j++) {\r\n                                dist = Math.abs(iP.y - this.snapY[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.y || dist < snap.distY) {\r\n                                        snap.y = this.snapY[j] - (iP.y - this.transform.y);\r\n                                        snap.distY = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        let projected = BB.projectPointOnLine(\r\n                            {x: 0, y: boundsStartP.y},\r\n                            {x: 10, y: boundsStartP.y},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        let dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        snap = {};\r\n                        snap.x = projected.x;\r\n                        snap.y = projected.y;\r\n                        snap.distX = dist;\r\n                        snap.distY = dist;\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: 0},\r\n                            {x: boundsStartP.x, y: 10},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap.x = projected.x;\r\n                            snap.y = projected.y;\r\n                            snap.distX = dist;\r\n                            snap.distY = dist;\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y + 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap.x = projected.x;\r\n                            snap.y = projected.y;\r\n                            snap.distX = dist;\r\n                            snap.distY = dist;\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y - 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap.x = projected.x;\r\n                            snap.y = projected.y;\r\n                            snap.distX = dist;\r\n                            snap.distY = dist;\r\n                        }\r\n                    }\r\n                    if (snap.x != undefined) {\r\n                        this.transform.x = snap.x;\r\n                    }\r\n                    if (snap.y != undefined) {\r\n                        this.transform.y = snap.y;\r\n                    }\r\n\r\n                    // snap to pixels\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                    }\r\n\r\n                    this.updateDOM();\r\n                }\r\n            }\r\n        })\r\n\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                const g = this.corners[i] = {\r\n                    i: i,\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.gripSize + 'px',\r\n                            height: this.gripSize + 'px',\r\n                            background: '#fff',\r\n                            /*background: [\r\n                                '#ff0000',\r\n                                '#00ff00',\r\n                                '#0000ff',\r\n                                '#ff00ff',\r\n                            ][i],*/\r\n                            borderRadius: this.gripSize + 'px',\r\n                            position: 'absolute',\r\n                            boxShadow: 'inset 0 0 0 2px #000'\r\n                        }\r\n                    }),\r\n                    x: 0,\r\n                    y: 0,\r\n                    virtualPos: {\r\n                        x: 0,\r\n                        y: 0,\r\n                    },\r\n                    updateDOM: null,\r\n                    pointerListener: null,\r\n                };\r\n                g.updateDOM = () => {\r\n\r\n                    // grip position\r\n                    // if gets small, offset grips, so easier to handle\r\n                    const offsetArr = [[-1, -1], [1, -1], [1, 1], [-1, 1]].map(item => {\r\n                        item[0] *= this.transform.width > 0 ? 1 : -1;\r\n                        item[1] *= this.transform.height > 0 ? 1 : -1;\r\n                        return item;\r\n                    });\r\n                    const tinyOffset = Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20 ? 10 : 0;\r\n\r\n                    BB.css(g.el, {\r\n                        left: (this.scaled.corners[g.i].x - this.gripSize / 2 + offsetArr[i][0] * tinyOffset) + 'px',\r\n                        top: (this.scaled.corners[g.i].y - this.gripSize / 2 + offsetArr[i][1] * tinyOffset) + 'px'\r\n                    });\r\n\r\n\r\n                    // cursor\r\n                    let angle = BB.pointsToAngleDeg(\r\n                        {\r\n                            x: this.transform.x,\r\n                            y: this.transform.y,\r\n                        },\r\n                        toImageSpace(g.x, g.y, this.transform),\r\n                    ) + 135; // offset so nw is 0\r\n                    while (angle < 0) {\r\n                        angle += 360;\r\n                    }\r\n                    let index = Math.round(angle / 45) % this.cornerCursors.length;\r\n                    BB.css(g.el, {\r\n                        cursor: this.cornerCursors[index] + '-resize',\r\n                    });\r\n                };\r\n\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.corners[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            this.corners[i].virtualPos = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n\r\n                        } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                            this.corners[i].virtualPos.x += event.dX / this.scale;\r\n                            this.corners[i].virtualPos.y += event.dY / this.scale;\r\n\r\n                            let iP = {\r\n                                x: this.corners[i].virtualPos.x,\r\n                                y: this.corners[i].virtualPos.y,\r\n                            };\r\n                            iP = this.constrainCorner(i, iP.x, iP.y);\r\n                            if (!this.isConstrained) {\r\n                                iP = this.snapCorner(iP.x, iP.y);\r\n                            }\r\n\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                iP.x = Math.round(iP.x);\r\n                                iP.y = Math.round(iP.y);\r\n                            }\r\n\r\n                            const tP = toTransformSpace(iP.x, iP.y, this.transform);\r\n\r\n                            const dX = tP.x - this.corners[i].x;\r\n                            const dY = tP.y - this.corners[i].y;\r\n                            this.corners[i].x = tP.x;\r\n                            this.corners[i].y = tP.y;\r\n\r\n                            let indexes = [];\r\n                            if (i === 0) { // top left\r\n                                indexes = [3, 1, 2];\r\n                            } else if (i === 1) { // top right\r\n                                indexes = [2, 0, 3];\r\n                            } else if (i === 2) { // bottom right\r\n                                indexes = [1, 3, 0];\r\n                            } else if (i === 3) { // bottom left\r\n                                indexes = [0, 2, 1];\r\n                            }\r\n\r\n                            this.corners[indexes[0]].x = this.corners[i].x;\r\n                            this.corners[indexes[1]].y = this.corners[i].y;\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                this.corners[indexes[2]].x -= dX;\r\n                                this.corners[indexes[2]].y -= dY;\r\n                                this.corners[indexes[1]].x = this.corners[indexes[2]].x;\r\n                                this.corners[indexes[0]].y = this.corners[indexes[2]].y;\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    }\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.updateCornerPositions();\r\n        this.updateScaled();\r\n\r\n        let isInverted: boolean;\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                this.edges[i] = {\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.edgeSize + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                            /*background: [\r\n                                '#ff000044',\r\n                                '#00ff0044',\r\n                                '#0000ff44',\r\n                                '#ff00ff44',\r\n                            ][i],*/\r\n                            position: 'absolute',\r\n                        },\r\n                    }),\r\n                    updateDOM: null,\r\n                    pointerListener: null,\r\n                };\r\n                const g = this.edges[i];\r\n                g.updateDOM = () => {\r\n                    if (i === 0) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: (Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) - this.edgeSize) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 1) {\r\n                        BB.css(g.el, {\r\n                            left: Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    } else if (i === 2) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + 'px',\r\n                            top: Math.max(this.scaled.corners[0].y,this.scaled.corners[3].y) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 3) {\r\n                        BB.css(g.el, {\r\n                            left: (Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) - this.edgeSize) + 'px',\r\n                            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    }\r\n                    let angleOffset = Math.round(this.transform.angleDeg / 45);\r\n                    while (angleOffset < 0)\r\n                        angleOffset += 8;\r\n                    angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\r\n                    g.el.style.cursor = this.cornerCursors[angleOffset] + '-resize';\r\n\r\n                };\r\n\r\n                const isVertical = [0, 2].includes(i);\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.edges[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            if (isVertical) { // top bottom\r\n                                isInverted = this.corners[0].y >= this.corners[3].y;\r\n                            } else { // left right\r\n                                isInverted = this.corners[0].x >= this.corners[1].x;\r\n                            }\r\n                            resetRemainder();\r\n                        }\r\n                        if (event.type === 'pointermove' && event.button === 'left') {\r\n                            const tfD = BB.rotateAround({x: 0, y: 0},\r\n                                {x: event.dX / this.scale, y: event.dY / this.scale},\r\n                                -this.transform.angleDeg);\r\n                            let ti = {\r\n                                dX: tfD.x,\r\n                                dY: tfD.y,\r\n                            };\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                ti = BB.intDxy(pointerRemainder, tfD.x, tfD.y);\r\n                            }\r\n\r\n                            let indexes = [];\r\n                            if (i === 0) { // top\r\n                                indexes = [2, 3, 0, 1];\r\n                            } else if (i === 1) { // right\r\n                                indexes = [0, 3, 1, 2];\r\n                            } else if (i === 2) { // bottom\r\n                                indexes = [0, 1, 2, 3];\r\n                            } else if (i === 3) { // left\r\n                                indexes = [1, 2, 0, 3];\r\n                            }\r\n\r\n                            let dimension = isVertical ? 'y' : 'x';\r\n                            let d = isVertical ? ti.dY : ti.dX;\r\n\r\n                            if (isInverted) {\r\n                                this.corners[indexes[0]][dimension] += d;\r\n                                this.corners[indexes[1]][dimension] += d;\r\n                            } else {\r\n                                this.corners[indexes[2]][dimension] += d;\r\n                                this.corners[indexes[3]][dimension] += d;\r\n                            }\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                if (isInverted) {\r\n                                    this.corners[indexes[2]][dimension] -= d;\r\n                                    this.corners[indexes[3]][dimension] -= d;\r\n                                } else {\r\n                                    this.corners[indexes[0]][dimension] -= d;\r\n                                    this.corners[indexes[1]][dimension] -= d;\r\n                                }\r\n                            }\r\n\r\n                            if (isVertical) { // top bottom\r\n                                this.restoreRatio(false, true);\r\n                            } else { // left right\r\n                                this.restoreRatio(true, false);\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    }\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.angleGrip = {\r\n            el: BB.el({\r\n                css: {\r\n                    cursor: 'url(' + rotateImg + ') 10 10, move',\r\n                    width: this.gripSize + 'px',\r\n                    height: this.gripSize + 'px',\r\n                    background: '#0ff',\r\n                    borderRadius: this.gripSize + 'px',\r\n                    position: 'absolute',\r\n                    boxShadow: 'inset 0 0 0 2px #000',\r\n                },\r\n            }),\r\n            x: 0,\r\n            y: 0,\r\n            snap: false,\r\n            updateDOM: () => {\r\n                BB.css(this.angleGrip.el, {\r\n                    left: (this.angleGrip.x - this.gripSize / 2) + 'px',\r\n                    top: (this.angleGrip.y - this.gripSize / 2) + 'px',\r\n                });\r\n            },\r\n        };\r\n        BB.el({\r\n            parent: this.angleGrip.el,\r\n            css: {\r\n                width: '2px',\r\n                height: '13px',\r\n                left: (this.gripSize / 2 - 1) + 'px',\r\n                top: this.gripSize + 'px',\r\n                background: '#0ff',\r\n                position: 'absolute'\r\n            }\r\n        });\r\n\r\n        this.anglePointerListener = new BB.PointerListener({\r\n            target: this.angleGrip.el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    const bounds = this.rootEl.getBoundingClientRect();\r\n                    const offset = {\r\n                        x: bounds.left - this.rootEl.scrollLeft,\r\n                        y: bounds.top - this.rootEl.scrollTop,\r\n                    };\r\n                    const iP = {x: (event.clientX - offset.x) / this.scale, y: (event.clientY - offset.y) / this.scale};\r\n\r\n                    const a = BB.pointsToAngleDeg({x: this.transform.x, y: this.transform.y}, iP) + 90;\r\n                    this.transform.angleDeg = a;\r\n                    const snapDeg = Math.round(a / 360 * 8) * 45;\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    } else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    }\r\n                    this.updateDOM();\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                        this.updateDOM();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        snapToPixel(this.transform);\r\n        this.updateDOM(true);\r\n        BB.append(this.transEl, [\r\n            this.boundsEl,\r\n            this.edges[0].el,\r\n            this.edges[1].el,\r\n            this.edges[2].el,\r\n            this.edges[3].el,\r\n            this.corners[0].el,\r\n            this.corners[1].el,\r\n            this.corners[2].el,\r\n            this.corners[3].el,\r\n            this.angleGrip.el,\r\n        ]);\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    getTransform (): ITransform {\r\n        return copyTransform(this.transform);\r\n    }\r\n\r\n    setConstrained (b: boolean): void {\r\n        this.isConstrained = !!b;\r\n        if (b && this.transform.width !== 0 && this.transform.height !== 0) {\r\n            this.ratio = Math.abs(this.transform.width / this.transform.height);\r\n        }\r\n    }\r\n\r\n    setSnapping (s: boolean): void {\r\n        this.snappingEnabled = !!s;\r\n    }\r\n\r\n    setPos (p: IVector2D): void {\r\n        this.transform.x = p.x;\r\n        this.transform.y = p.y;\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    move (dX: number, dY: number): void {\r\n        this.transform.x += dX;\r\n        this.transform.y += dY;\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setSize (w: number, h: number): void {\r\n        this.transform.width = w;\r\n        this.transform.height = h;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n        }\r\n        this.updateCornerPositions();\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setAngleDeg (a: number): void {\r\n        this.transform.angleDeg = a;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n            this.updateCornerPositions();\r\n        }\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getRatio (): number {\r\n        return this.ratio;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.keyListener.destroy();\r\n        this.boundsPointerListener.destroy();\r\n        this.corners[0].pointerListener.destroy();\r\n        this.corners[1].pointerListener.destroy();\r\n        this.corners[2].pointerListener.destroy();\r\n        this.corners[3].pointerListener.destroy();\r\n        this.edges[0].pointerListener.destroy();\r\n        this.edges[1].pointerListener.destroy();\r\n        this.edges[2].pointerListener.destroy();\r\n        this.edges[3].pointerListener.destroy();\r\n        this.anglePointerListener.destroy();\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"045N6\");","import {BB} from '../../../bb/bb';\r\nimport {KlCanvasPreview} from '../../canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './free-transform';\r\nimport {IKlBasicLayer, IMixMode} from '../../kl.types';\r\n\r\n/**\r\n * a basic canvas where you can transform one layer(move around, rotate, scale)\r\n *\r\n * @param params\r\n * @returns {HTMLDivElement}\r\n * @constructor\r\n */\r\nexport function FreeTransformCanvas(params: {\r\n    elementWidth: number;\r\n    elementHeight: number;\r\n    imageWidth: number;\r\n    imageHeight: number;\r\n    layers: IKlBasicLayer[];\r\n    transformIndex: number;\r\n}) {\r\n    /*\r\n    div\r\n        innerWrapper\r\n            klCanvasPreview\r\n            transform.div\r\n    */\r\n\r\n    let previewFit = BB.fitInto(\r\n        params.imageWidth,\r\n        params.imageHeight,\r\n        params.elementWidth - 20,\r\n        params.elementHeight - 60,\r\n        1\r\n    );\r\n    let scale = previewFit.width / params.imageWidth;\r\n\r\n    let div = BB.el({\r\n        css: {\r\n            width: params.elementWidth + \"px\",\r\n            height: params.elementHeight + \"px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            userSelect: \"none\",\r\n            position: \"relative\",\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    let innerWrapper = BB.el({\r\n        css: {\r\n            position: 'relative',\r\n            boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n            width: previewFit.width + 'px',\r\n            height: previewFit.height + 'px'\r\n        }\r\n    });\r\n    div.appendChild(innerWrapper);\r\n\r\n    let previewLayerArr = params.layers.map(item => {\r\n        return {\r\n            image: item.image,\r\n            mixModeStr: item.mixModeStr,\r\n            opacity: item.opacity,\r\n        }\r\n    });\r\n    previewLayerArr[previewLayerArr.length - 1].image = BB.canvas(\r\n        scale > 1 ? params.imageWidth : previewFit.width,\r\n        scale > 1 ? params.imageHeight : previewFit.height,\r\n    );\r\n    let klCanvasPreview = new KlCanvasPreview({\r\n        width: previewFit.width,\r\n        height: previewFit.height,\r\n        layers: previewLayerArr\r\n    });\r\n    innerWrapper.appendChild(klCanvasPreview.getElement());\r\n\r\n    let freeTransform;\r\n    let initTransform;\r\n    function updatePreview() {\r\n        if (!freeTransform) {\r\n            return;\r\n        }\r\n\r\n        let transform = freeTransform.getTransform();\r\n        if (scale < 1) {\r\n            transform.x *= scale;\r\n            transform.y *= scale;\r\n            transform.width *= scale;\r\n            transform.height *= scale;\r\n        }\r\n\r\n        let destCanvas = previewLayerArr[params.transformIndex].image;\r\n        let ctx = (destCanvas as HTMLCanvasElement).getContext('2d');\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, destCanvas.width, destCanvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            ctx,\r\n            params.layers[params.transformIndex].image,\r\n            transform,\r\n            null,\r\n            BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n        );\r\n        ctx.restore();\r\n        klCanvasPreview.render();\r\n    }\r\n\r\n    {\r\n        let transformSize = {\r\n            width: params.layers[params.transformIndex].image.width * scale,\r\n            height: params.layers[params.transformIndex].image.height * scale\r\n        };\r\n        if (transformSize.width > previewFit.width || transformSize.height > previewFit.height) {\r\n            transformSize = BB.fitInto(\r\n                params.layers[params.transformIndex].image.width,\r\n                params.layers[params.transformIndex].image.height,\r\n                previewFit.width,\r\n                previewFit.height,\r\n                1\r\n            );\r\n        }\r\n        initTransform = {\r\n            x: params.imageWidth / 2,\r\n            y: params.imageHeight / 2,\r\n            width: params.layers[params.transformIndex].image.width,\r\n            height: params.layers[params.transformIndex].image.height,\r\n        };\r\n        freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: 0,\r\n            isConstrained: true,\r\n            snapX: [0, params.imageWidth],\r\n            snapY: [0, params.imageHeight],\r\n            scale: scale,\r\n            callback: (transform) => {\r\n                updatePreview();\r\n            },\r\n        });\r\n    }\r\n    BB.css(freeTransform.getElement(), {\r\n        position: 'absolute',\r\n        left: '0',\r\n        top: '0'\r\n    });\r\n    innerWrapper.appendChild(freeTransform.getElement());\r\n    setTimeout(updatePreview, 0);\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.move = function(dX, dY) {\r\n        freeTransform.move(dX, dY);\r\n    };\r\n    this.reset = function() {\r\n        let w = params.layers[params.transformIndex].image.width;\r\n        let h = params.layers[params.transformIndex].image.height;\r\n\r\n        freeTransform.setSize(w, h);\r\n        freeTransform.setPos({x: w / 2, y: h / 2});\r\n        freeTransform.setAngleDeg(0);\r\n        updatePreview();\r\n    };\r\n    this.setTransformFit = function() {\r\n\r\n        let fit = BB.fitInto(\r\n            params.layers[params.transformIndex].image.width,\r\n            params.layers[params.transformIndex].image.height,\r\n            params.imageWidth,\r\n            params.imageHeight,\r\n            1\r\n        );\r\n\r\n        freeTransform.setSize(fit.width, fit.height);\r\n        freeTransform.setPos({x: fit.width / 2, y: fit.height / 2});\r\n        freeTransform.setAngleDeg(0);\r\n        updatePreview();\r\n    };\r\n    this.setTransformCenter = function() {\r\n        freeTransform.setPos({x: params.imageWidth / 2, y: params.imageHeight / 2});\r\n        freeTransform.setAngleDeg(0);\r\n        updatePreview();\r\n    };\r\n    //gives you the transformation in the original scale\r\n    this.getTransformation = function () {\r\n        if (!freeTransform) {\r\n            return false;\r\n        }\r\n        return freeTransform.getTransform();\r\n    };\r\n    this.getIsPixelated = () => {\r\n        const transform = freeTransform.getTransform();\r\n        return BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height);\r\n    };\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.destroy = function() {\r\n        freeTransform.destroy();\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/*\r\n\tCropper params\r\n\t{\r\n\t\tx: int, //pos in relation zum bild\r\n\t\ty: int,\r\n\t\tw: int,\r\n\t\th: int,\r\n\t\tscale: float, //zoom\r\n\t\tcallback: function //wenn sich was ndert\r\n\t}\r\n\tthe div that you append this to must be relative\r\n*/\r\nexport function Cropper (params) {\r\n    let x = params.x,\r\n        y = params.y,\r\n        width = params.width,\r\n        height = params.height,\r\n        scale = params.scale,\r\n        callback = params.callback,\r\n        maxW = params.maxW,\r\n        maxH = params.maxH;\r\n    let div = document.createElement(\"div\");\r\n    let gripCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n\r\n    let keyListener = new BB.KeyListener({});\r\n\r\n    BB.css(div, {\r\n        position: \"absolute\",\r\n        left: (x * scale) + \"px\",\r\n        top: (y * scale) + \"px\"\r\n    });\r\n\r\n    let outline = document.createElement(\"div\");\r\n    BB.css(outline, {\r\n        position: \"absolute\",\r\n        border: \"1px dashed #fff\",\r\n        cursor: \"move\"\r\n    });\r\n    (outline as any).update = function () {\r\n        BB.css(outline, {\r\n            left: (grips[0].x * scale - 1) + \"px\",\r\n            top: (grips[0].y * scale - 1) + \"px\",\r\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\r\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\r\n        });\r\n    };\r\n    let pointerRemainder = { // needs to be reset after dragging complete\r\n        x: 0,\r\n        y: 0,\r\n    };\r\n    let outlinePointerListener = new BB.PointerListener({\r\n        target: outline,\r\n        onPointer: function(event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n\r\n                grips[0].x += dX;\r\n                grips[0].y += dY;\r\n                grips[1].x += dX;\r\n                grips[1].y += dY;\r\n                grips[2].x += dX;\r\n                grips[2].y += dY;\r\n                grips[3].x += dX;\r\n                grips[3].y += dY;\r\n\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n\r\n    let thirdsHorizontal = document.createElement(\"div\");\r\n    BB.css(thirdsHorizontal, {\r\n        position: \"absolute\",\r\n        borderTop: \"1px solid #0ff\",\r\n        borderBottom: \"1px solid #0ff\"\r\n    });\r\n    (thirdsHorizontal as any).update = function () {\r\n        BB.css(thirdsHorizontal, {\r\n            left: (grips[0].x * scale) + \"px\",\r\n            top: ((grips[0].y + (grips[2].y - grips[0].y) / 3) * scale) + \"px\",\r\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\r\n            height: ((grips[2].y - grips[0].y) / 3 * scale) + \"px\"\r\n\r\n        });\r\n    };\r\n    let thirdsVertical = document.createElement(\"div\");\r\n    BB.css(thirdsVertical, {\r\n        position: \"absolute\",\r\n        borderLeft: \"1px solid #0ff\",\r\n        borderRight: \"1px solid #0ff\"\r\n    });\r\n    (thirdsVertical as any).update = function () {\r\n        BB.css(thirdsVertical, {\r\n            left: ((grips[0].x + (grips[2].x - grips[0].x) / 3) * scale) + \"px\",\r\n            top: (grips[0].y * scale) + \"px\",\r\n            width: ((grips[2].x - grips[0].x) / 3 * scale) + \"px\",\r\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\r\n\r\n        });\r\n    };\r\n\r\n    const gripSize = 40;\r\n    const gripOverlay = 10;\r\n\r\n    let grips: {\r\n        x: number; // int\r\n        y: number;\r\n    }[] = [ // aka corner coordinates\r\n        {x: 0, y: 0}, // top left\r\n        {x: width, y: 0}, // top right\r\n        {x: width, y: height}, // bottom right\r\n        {x: 0, y: height}, //bottom left\r\n    ];\r\n\r\n    function transformTop(dY) {\r\n        grips[0].y += dY;\r\n        grips[0].y = Math.max(grips[3].y - maxH, Math.min(grips[3].y - 1, grips[0].y));\r\n        grips[1].y = grips[0].y;\r\n    }\r\n    function transformRight(dX) {\r\n        grips[1].x += dX;\r\n        grips[1].x = Math.min(grips[0].x + maxW, Math.max(grips[0].x + 1, grips[1].x));\r\n        grips[2].x = grips[1].x;\r\n    }\r\n    function transformBottom(dY) {\r\n        grips[2].y += dY;\r\n        grips[2].y = Math.min(grips[1].y + maxH, Math.max(grips[1].y + 1, grips[2].y));\r\n        grips[3].y = grips[2].y;\r\n    }\r\n    function transformLeft(dX) {\r\n        grips[0].x += dX;\r\n        grips[0].x = Math.max(grips[1].x - maxW, Math.min(grips[1].x - 1, grips[0].x));\r\n        grips[3].x = grips[0].x;\r\n    }\r\n\r\n    function commit() {\r\n        pointerRemainder.x = 0;\r\n        pointerRemainder.y = 0;\r\n        callback(getTransform());\r\n    }\r\n\r\n\r\n\r\n\r\n    let edges = [];\r\n    for (let i = 0; i < 4; i++) {\r\n        (function (i) {\r\n            edges[i] = document.createElement(\"div\");\r\n            let g = edges[i];\r\n            g.style.width = gripSize + \"px\";\r\n            g.style.height = gripSize + \"px\";\r\n            //g.style.background = \"#0f0\";\r\n            g.style.position = \"absolute\";\r\n            g.update = function () {\r\n                if (i === 0) { //top\r\n                    g.style.left = (grips[0].x * scale + gripOverlay) + \"px\";\r\n                    g.style.top = (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\";\r\n                    g.style.width = ((grips[1].x - grips[0].x) * scale - gripOverlay * 2) + \"px\";\r\n                    g.style.height = (gripSize * 2) + \"px\";\r\n                } else if (i === 1) { //right\r\n                    g.style.left = (grips[1].x * scale - gripOverlay) + \"px\";\r\n                    g.style.top = (grips[1].y * scale + gripOverlay) + \"px\";\r\n                    g.style.width = (gripSize * 2) + \"px\";\r\n                    g.style.height = ((grips[2].y - grips[1].y) * scale - gripOverlay * 2) + \"px\";\r\n                } else if (i === 2) { //bottom\r\n                    g.style.left = (grips[3].x * scale + gripOverlay) + \"px\";\r\n                    g.style.top = (grips[3].y * scale - gripOverlay) + \"px\";\r\n                    g.style.width = ((grips[2].x - grips[3].x) * scale - gripOverlay * 2) + \"px\";\r\n                    g.style.height = (gripSize * 2) + \"px\";\r\n                } else if (i === 3) { //left\r\n                    g.style.left = (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\";\r\n                    g.style.top = (grips[0].y * scale + gripOverlay) + \"px\";\r\n                    g.style.width = (gripSize * 2) + \"px\";\r\n                    g.style.height = ((grips[3].y - grips[0].y) * scale - gripOverlay * 2) + \"px\";\r\n                }\r\n                let angleOffset = i * 2 + 1;\r\n                g.style.cursor = gripCursors[angleOffset] + \"-resize\";\r\n\r\n            };\r\n        })(i);\r\n    }\r\n\r\n    let darken = [];\r\n    for (let i = 0; i < 4; i++) {\r\n        (function (i) {\r\n            darken[i] = document.createElement(\"div\");\r\n            let g = darken[i];\r\n            g.style.position = \"absolute\";\r\n            g.style.background = \"#000\";\r\n            g.style.opacity = \"0.5\";\r\n            g.update = function () {\r\n                if (i === 0) {\r\n                    g.style.left = (grips[0].x * scale) + \"px\";\r\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\r\n                    g.style.width = ((grips[1].x - grips[0].x) * scale) + \"px\";\r\n                    g.style.height = \"8000px\";\r\n                } else if (i === 1) {\r\n                    g.style.left = (grips[1].x * scale) + \"px\";\r\n                    g.style.top = (grips[1].y * scale - 8000) + \"px\";\r\n                    g.style.width = \"8000px\";\r\n                    g.style.height = 16000 + \"px\";\r\n                } else if (i === 2) {\r\n                    g.style.left = (grips[3].x * scale) + \"px\";\r\n                    g.style.top = (grips[3].y * scale) + \"px\";\r\n                    g.style.width = ((grips[2].x - grips[3].x) * scale) + \"px\";\r\n                    g.style.height = \"8000px\";\r\n                } else if (i === 3) {\r\n                    g.style.left = (grips[0].x * scale - 8000) + \"px\";\r\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\r\n                    g.style.width = \"8000px\";\r\n                    g.style.height = 16000 + \"px\";\r\n                }\r\n\r\n            };\r\n        })(i);\r\n    }\r\n\r\n    let edge0PointerListener = new BB.PointerListener({\r\n        target: edges[0],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformTop(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformBottom(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    let edge1PointerListener = new BB.PointerListener({\r\n        target: edges[1],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformRight(dX);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformLeft(-dX);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    let edge2PointerListener = new BB.PointerListener({\r\n        target: edges[2],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformBottom(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformTop(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    let edge3PointerListener = new BB.PointerListener({\r\n        target: edges[3],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformLeft(dX);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformRight(-dX);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    let cornerElArr = [];\r\n    (function() {\r\n        for (let i = 0; i < 4; i++) {\r\n            (function (i) {\r\n                cornerElArr[i] = document.createElement(\"div\");\r\n                let g = cornerElArr[i];\r\n                BB.css(g, {\r\n                    //background: '#f00',\r\n                    width: (gripSize * 2) + 'px',\r\n                    height: (gripSize * 2) + 'px',\r\n                    position: 'absolute'\r\n                });\r\n                g.style.cursor = ['nwse-resize', 'nesw-resize'][i % 2];\r\n                g.update = function () {\r\n                    if (i === 0) { //top left\r\n                        BB.css(g, {\r\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\r\n                            top: (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\"\r\n                        });\r\n                    } else if (i === 1) { //top right\r\n                        BB.css(g, {\r\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\r\n                            top: (grips[1].y * scale - gripSize * 2 + gripOverlay) + \"px\"\r\n                        });\r\n                    } else if (i === 2) { //bottom right\r\n                        BB.css(g, {\r\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\r\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\r\n                        });\r\n                    } else if (i === 3) { //bottom left\r\n                        BB.css(g, {\r\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\r\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\r\n                        });\r\n                    }\r\n                };\r\n            })(i);\r\n        }\r\n    })();\r\n    //top left\r\n    let corner0PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[0],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformLeft(dX);\r\n                transformTop(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformRight(-dX);\r\n                    transformBottom(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    //top right\r\n    let corner1PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[1],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformRight(dX);\r\n                transformTop(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformLeft(-dX);\r\n                    transformBottom(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    //bottom right\r\n    let corner2PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[2],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformRight(dX);\r\n                transformBottom(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformLeft(-dX);\r\n                    transformTop(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n    //bottom left\r\n    let corner3PointerListener = new BB.PointerListener({\r\n        target: cornerElArr[3],\r\n        fixScribble: true,\r\n        onPointer: function (event) {\r\n            event.eventPreventDefault();\r\n            if (event.type === 'pointermove' && event.button === 'left') {\r\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\r\n                transformLeft(dX);\r\n                transformBottom(dY);\r\n                if (keyListener.isPressed('shift')) {\r\n                    transformRight(-dX);\r\n                    transformTop(-dY);\r\n                }\r\n                update();\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                commit();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n\r\n\r\n    function getTransform() {\r\n        grips[1].x -= grips[0].x;\r\n        grips[1].y -= grips[0].y;\r\n        grips[2].x -= grips[0].x;\r\n        grips[2].y -= grips[0].y;\r\n        grips[3].x -= grips[0].x;\r\n        grips[3].y -= grips[0].y;\r\n        x += grips[0].x;\r\n        y += grips[0].y;\r\n        grips[0].x = 0;\r\n        grips[0].y = 0;\r\n        return {\r\n            x: x,\r\n            y: y,\r\n            width: grips[1].x,\r\n            height: grips[2].y\r\n        };\r\n    }\r\n\r\n\r\n    div.append(\r\n        darken[1],\r\n        darken[0],\r\n        darken[2],\r\n        darken[3],\r\n        thirdsHorizontal,\r\n        thirdsVertical,\r\n        outline,\r\n\r\n        edges[1],\r\n        edges[0],\r\n        edges[2],\r\n        edges[3],\r\n\r\n        cornerElArr[0],\r\n        cornerElArr[1],\r\n        cornerElArr[2],\r\n        cornerElArr[3],\r\n    );\r\n\r\n\r\n    function update() {\r\n\r\n        edges[0].update();\r\n        edges[1].update();\r\n        edges[2].update();\r\n        edges[3].update();\r\n        cornerElArr[0].update();\r\n        cornerElArr[1].update();\r\n        cornerElArr[2].update();\r\n        cornerElArr[3].update();\r\n        darken[0].update();\r\n        darken[1].update();\r\n        darken[2].update();\r\n        darken[3].update();\r\n        (outline as any).update();\r\n        (thirdsHorizontal as any).update();\r\n        (thirdsVertical as any).update();\r\n    }\r\n\r\n    update();\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getTransform = getTransform;\r\n\r\n    this.setTransform = function (p) {\r\n        x = p.x;\r\n        y = p.y;\r\n        width = p.width;\r\n        height = p.height;\r\n\r\n        BB.css(div, {\r\n            left: (x * scale) + \"px\",\r\n            top: (y * scale) + \"px\"\r\n        });\r\n\r\n        grips[0].x = 0;\r\n        grips[0].y = 0;\r\n        grips[1].x = width;\r\n        grips[1].y = 0;\r\n        grips[2].x = width;\r\n        grips[2].y = height;\r\n        grips[3].x = 0;\r\n        grips[3].y = height;\r\n\r\n        update();\r\n        commit();\r\n    };\r\n\r\n    this.setScale = function (s) {\r\n        scale = s;\r\n        BB.css(div, {\r\n            left: (x * scale) + \"px\",\r\n            top: (y * scale) + \"px\"\r\n        });\r\n        update();\r\n    };\r\n\r\n    this.showThirds = function (b) {\r\n        if (b) {\r\n            thirdsHorizontal.style.display = \"block\";\r\n            thirdsVertical.style.display = \"block\";\r\n        } else {\r\n            thirdsHorizontal.style.display = \"none\";\r\n            thirdsVertical.style.display = \"none\";\r\n        }\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.destroy = function() {\r\n        keyListener.destroy();\r\n        outlinePointerListener.destroy();\r\n        corner0PointerListener.destroy();\r\n        corner1PointerListener.destroy();\r\n        corner2PointerListener.destroy();\r\n        corner3PointerListener.destroy();\r\n        edge0PointerListener.destroy();\r\n        edge1PointerListener.destroy();\r\n        edge2PointerListener.destroy();\r\n        edge3PointerListener.destroy();\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Previews currently active layer\r\n * thumbnail (hover shows bigger preview), layername, opacity\r\n *\r\n * internally listens to kl history. updates when there's a change.\r\n * but you need to update it when the active layer changed. (different canvas object)\r\n *\r\n * update visibility for performance\r\n *\r\n * p = {\r\n *     onClick: function() // when clicking on layer name\r\n *     klRootEl: klRootEl,\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function LayerPreview(p) {\r\n\r\n    // internally redraws with in an interval. checks history is something changed\r\n    // this update will be animated\r\n    // it will not be animated if the resolution changed\r\n    // also redraws when you call updateLayer - not animated\r\n\r\n    // syncs via updateLayer, and internally updates layer opacity via a hack\r\n\r\n    let div = BB.el({});\r\n    let layerObj;\r\n    let isVisible = true;\r\n    const height = 40;\r\n    const canvasSize = height - 10;\r\n    const largeCanvasSize = 300;\r\n    let lastDrawnState = -2;\r\n    let lastDrawnSize = {\r\n        width: 0,\r\n        height: 0\r\n    };\r\n    let animationCanvas = BB.canvas(); // to help animate the transition\r\n    let animationCanvasCtx = animationCanvas.getContext('2d');\r\n    const animationLength = 30;\r\n    let animationCount = 0; // >0 means it's animating\r\n    let largeCanvasIsVisible = false;\r\n    let largeCanvasAnimationTimeout;\r\n    const largeCanvasAnimationDurationMs = 300;\r\n    let uiState = 'right'; // 'left' | 'right'\r\n\r\n\r\n    // --- setup dom ---\r\n    let contentWrapperEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            height: height + 'px',\r\n            color: '#666',\r\n        }\r\n    });\r\n    let canvasWrapperEl = BB.el({\r\n        css: {\r\n            //background: '#f00',\r\n            minWidth: height + 'px',\r\n            height: height + 'px',\r\n            display: 'flex',\r\n            justifyContent: 'center',\r\n            alignItems: 'center'\r\n        }\r\n    });\r\n    let canvas = BB.canvas(canvasSize, canvasSize);\r\n    let canvasCtx = canvas.getContext('2d');\r\n    canvas.title = LANG('layers-active-layer');\r\n    BB.css(canvas, {\r\n        boxShadow: '0 0 0 1px #9e9e9e',\r\n        colorScheme: 'only light',\r\n    });\r\n    let nameWrapper = BB.el({\r\n        css: {\r\n            //background: '#ff0',\r\n            flexGrow: '1',\r\n            paddingLeft: '10px',\r\n            fontSize: '13px',\r\n            overflow: 'hidden',\r\n            position: 'relative'\r\n        }\r\n    });\r\n    let nameLabelEl = BB.el({\r\n        content: '',\r\n        css: {\r\n            cssFloat: 'left',\r\n            whiteSpace: 'nowrap'\r\n        }\r\n    });\r\n    let nameFadeEl = BB.el({\r\n        css: {\r\n            backgroundImage: 'linear-gradient(to right, rgba(221,221,221,0) 0%, rgba(221,221,221,0.8) 100%)',\r\n            position: 'absolute',\r\n            right: \"0\",\r\n            top: \"0\",\r\n            width: \"50px\",\r\n            height: '100%'\r\n        }\r\n    });\r\n    let clickableEl = BB.el({\r\n        css: {\r\n            //background: 'rgba(0,255,0,0.6)',\r\n            position: 'absolute',\r\n            left: \"10px\",\r\n            top: \"0\",\r\n            width: \"90px\",\r\n            height: '100%'\r\n        }\r\n    });\r\n    if (p.onClick) {\r\n        BB.addEventListener(clickableEl,'click', function() {\r\n            p.onClick();\r\n        });\r\n        BB.addEventListener(canvas,'click', function() {\r\n            p.onClick();\r\n        });\r\n    }\r\n    let opacityEl = BB.el({\r\n        content: LANG('opacity') + '<br>100%',\r\n        css: {\r\n            minWidth: '60px',\r\n            fontSize: '12px',\r\n            textAlign: 'center',\r\n            background: '#dddddd',\r\n            color: '#555'\r\n        }\r\n    });\r\n\r\n    const largeCanvasWrapper = BB.el({\r\n        onClick: BB.handleClick,\r\n        css: {\r\n            pointerEvents: 'none',\r\n            background: '#fff',\r\n            position: 'absolute',\r\n            right: '280px',\r\n            top: '10px',\r\n            border: '1px solid #aaa',\r\n            boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\r\n            transition: 'opacity '+largeCanvasAnimationDurationMs+'ms ease-in-out',\r\n            userSelect: 'none',\r\n            display: 'block',\r\n            webkitTouchCallout: 'none',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    let largeCanvas = BB.canvas(largeCanvasSize, largeCanvasSize);\r\n    largeCanvasWrapper.append(largeCanvas);\r\n    let largeCanvasCtx = largeCanvas.getContext('2d');\r\n    BB.css(largeCanvas, {\r\n        display: 'block',\r\n    });\r\n\r\n    div.appendChild(contentWrapperEl);\r\n    contentWrapperEl.appendChild(canvasWrapperEl);\r\n    canvasWrapperEl.appendChild(canvas);\r\n    contentWrapperEl.appendChild(nameWrapper);\r\n    nameWrapper.appendChild(nameLabelEl);\r\n    nameWrapper.appendChild(nameFadeEl);\r\n    nameWrapper.appendChild(clickableEl);\r\n    contentWrapperEl.appendChild(opacityEl);\r\n\r\n\r\n    let animationCanvasCheckerPattern = animationCanvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\r\n    let largeCanvasCheckerPattern = canvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\r\n\r\n\r\n\r\n    // --- update logic ---\r\n\r\n    function animate() {\r\n        if (animationCount === 0) {\r\n            return;\r\n        }\r\n\r\n        animationCount--;\r\n\r\n        canvasCtx.save();\r\n        canvasCtx.globalAlpha = Math.pow((animationLength - animationCount) / animationLength, 2);\r\n        canvasCtx.drawImage(animationCanvas, 0, 0);\r\n        canvasCtx.restore();\r\n\r\n        if (animationCount > 0) {\r\n            requestAnimationFrame(animate);\r\n        }\r\n    }\r\n\r\n    function draw(isInstant) {\r\n\r\n        if (!isVisible) {\r\n            return;\r\n        }\r\n\r\n        nameLabelEl.textContent = layerObj.name;\r\n        opacityEl.innerHTML = LANG('opacity') + '<br>' + Math.round(layerObj.opacity * 100) + '%';\r\n\r\n        let layerCanvas = layerObj.context.canvas;\r\n\r\n        if (layerCanvas.width !== lastDrawnSize.width || layerCanvas.height !== lastDrawnSize.height) {\r\n            let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, canvasSize, canvasSize, 1);\r\n            canvas.width = Math.round(canvasDimensions.width);\r\n            canvas.height = Math.round(canvasDimensions.height);\r\n\r\n            isInstant = true;\r\n        }\r\n\r\n        animationCanvas.width = canvas.width;\r\n        animationCanvas.height = canvas.height;\r\n\r\n        animationCanvasCtx.save();\r\n        animationCanvasCtx.imageSmoothingEnabled = false;\r\n        animationCanvasCtx.fillStyle = animationCanvasCheckerPattern;\r\n        animationCanvasCtx.fillRect(0, 0, animationCanvas.width, animationCanvas.height);\r\n        animationCanvasCtx.drawImage(layerCanvas, 0, 0, animationCanvas.width, animationCanvas.height);\r\n        animationCanvasCtx.restore();\r\n\r\n        if (isInstant) {\r\n            animationCount = 0;\r\n            canvasCtx.save();\r\n            canvasCtx.drawImage(animationCanvas, 0, 0);\r\n            canvasCtx.restore();\r\n\r\n        } else {\r\n            animationCount = animationLength;\r\n            animate();\r\n\r\n        }\r\n\r\n        drawLargeCanvas();\r\n\r\n        lastDrawnState = klHistory.getState();\r\n        lastDrawnSize.width = layerCanvas.width;\r\n        lastDrawnSize.height = layerCanvas.height;\r\n    }\r\n\r\n    function update() {\r\n        draw(true);\r\n    }\r\n\r\n    setInterval(function() {\r\n\r\n        if (!layerObj) {\r\n            return;\r\n        }\r\n\r\n        let currentState = klHistory.getState();\r\n        if (currentState === lastDrawnState) {\r\n            return;\r\n        }\r\n\r\n        //update opacity w hack\r\n        layerObj.opacity = layerObj.context.canvas.opacity;\r\n\r\n        draw(false);\r\n\r\n    }, 2000);\r\n\r\n\r\n    //is always instant\r\n    function drawLargeCanvas() {\r\n\r\n        if (!largeCanvasIsVisible || !layerObj) {\r\n            return;\r\n        }\r\n\r\n        let layerCanvas = layerObj.context.canvas;\r\n\r\n        let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, largeCanvasSize, largeCanvasSize, 1);\r\n        largeCanvas.width = Math.round(canvasDimensions.width);\r\n        largeCanvas.height = Math.round(canvasDimensions.height);\r\n        largeCanvasCtx.save();\r\n        if (largeCanvas.width > layerCanvas.width) {\r\n            largeCanvasCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            largeCanvasCtx.imageSmoothingEnabled = true;\r\n            largeCanvasCtx.imageSmoothingQuality = 'high';\r\n        }\r\n        largeCanvasCtx.fillStyle = largeCanvasCheckerPattern;\r\n        largeCanvasCtx.fillRect(0, 0, largeCanvas.width, largeCanvas.height);\r\n        largeCanvasCtx.drawImage(layerCanvas, 0, 0, largeCanvas.width, largeCanvas.height);\r\n        largeCanvasCtx.restore();\r\n\r\n        const bounds = div.getBoundingClientRect();\r\n        BB.css(largeCanvasWrapper, {\r\n            top: Math.max(10, (bounds.top + height / 2 - largeCanvas.height / 2)) + \"px\"\r\n        });\r\n\r\n    }\r\n\r\n    function removeLargeCanvas() {\r\n        try {\r\n            p.klRootEl.removeChild(largeCanvasWrapper);\r\n        } catch(e) {\r\n\r\n        }\r\n    }\r\n\r\n    function showLargeCanvas(b) {\r\n        if (largeCanvasIsVisible === b) {\r\n            return;\r\n        }\r\n\r\n        clearTimeout(largeCanvasAnimationTimeout);\r\n        largeCanvasIsVisible = b;\r\n\r\n        if (b) {\r\n            largeCanvasAnimationTimeout = setTimeout(function() {\r\n                drawLargeCanvas();\r\n                largeCanvasWrapper.style.opacity = '0';\r\n                p.klRootEl.appendChild(largeCanvasWrapper);\r\n                setTimeout(function() {\r\n                    largeCanvasWrapper.style.opacity = '1';\r\n                }, 20);\r\n            }, 250);\r\n\r\n        } else {\r\n            largeCanvasWrapper.style.opacity = '0';\r\n            largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\r\n        }\r\n\r\n    }\r\n\r\n    let pointerListener = new BB.PointerListener({\r\n        target: canvas,\r\n        onEnterLeave: function(b) {\r\n            showLargeCanvas(b);\r\n        }\r\n    });\r\n\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(b) {\r\n        if (isVisible === b) {\r\n            return;\r\n        }\r\n        isVisible = b;\r\n        contentWrapperEl.style.display = isVisible ? 'flex' : 'none';\r\n        div.style.marginBottom = isVisible ? '' : '10px';\r\n\r\n        let currentState = klHistory.getState();\r\n        if (b && lastDrawnState !== currentState) {\r\n            update();\r\n        }\r\n    };\r\n\r\n    //when the layer might have changed\r\n    this.setLayer = function(klCanvasLayerObj) {\r\n        layerObj = klCanvasLayerObj;\r\n        update();\r\n    };\r\n\r\n    this.setUiState = function(stateStr) {\r\n        uiState = '' + stateStr;\r\n\r\n        if (uiState === 'left') {\r\n            BB.css(largeCanvasWrapper, {\r\n                left: '280px',\r\n                right: ''\r\n            });\r\n        } else {\r\n            BB.css(largeCanvasWrapper, {\r\n                left: '',\r\n                right: '280px'\r\n            });\r\n        }\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * fits image into a size\r\n * params: {\r\n *    image: image,\r\n *    width: int,\r\n *    height: int\r\n * }\r\n *\r\n * methods:\r\n * getDiv()\r\n *\r\n * @param params\r\n * @constructor\r\n */\r\nexport function FittedImage(params) {\r\n    let fit = BB.fitInto(params.image.width, params.image.height, params.width, params.height, 1);\r\n    let w = parseInt('' + fit.width);\r\n    let h = parseInt('' + fit.height);\r\n\r\n    let canvas = BB.canvas(w, h);\r\n\r\n    canvas.getContext(\"2d\").drawImage(params.image, 0, 0, w, h);\r\n    BB.css(canvas, {\r\n        display: \"block\",\r\n        boxShadow: \"0 0 0 1px #aaa\"\r\n    });\r\n\r\n    this.getElement = function() {\r\n        return canvas;\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\nimport {FreeTransformCanvas} from '../components/free-transform-canvas';\r\nimport {popup} from './popup';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {IKlBasicLayer} from '../../kl.types';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showImportAsLayerDialog(\r\n    params: {\r\n        target: HTMLElement;\r\n        klCanvas: KlCanvas;\r\n        importImage: HTMLImageElement | HTMLCanvasElement;\r\n        callback: (\r\n            p?: {x: number, y: number, width:number, height: number, angleDeg: number},\r\n            isPixelated?: boolean\r\n        ) => void;\r\n    }\r\n): void {\r\n\r\n    let div = document.createElement(\"div\");\r\n    BB.appendTextDiv(div, LANG('import-as-layer-description'));\r\n    if (params.klCanvas.isLayerLimitReached()) {\r\n        let noteEl = BB.el({\r\n            content: LANG('import-as-layer-limit-reached'),\r\n            css: {\r\n                background: '#ff0',\r\n                padding: '10px',\r\n                marginTop: '5px',\r\n                marginBottom: '5px',\r\n                border: '1px solid #e7d321',\r\n                borderRadius: '5px'\r\n            }\r\n        });\r\n        div.appendChild(noteEl);\r\n    }\r\n    let isSmall = window.innerWidth < 550;\r\n\r\n    let buttonRowEl = BB.el({\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n    let originalSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: '1:1',\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function() {\r\n            freeTransformCanvas.reset();\r\n        }\r\n    });\r\n    let fitSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('import-as-layer-fit'),\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function() {\r\n            freeTransformCanvas.setTransformFit();\r\n        }\r\n    });\r\n    let centerBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('center'),\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function() {\r\n            freeTransformCanvas.setTransformCenter();\r\n        }\r\n    });\r\n    buttonRowEl.appendChild(originalSizeBtn);\r\n    buttonRowEl.appendChild(fitSizeBtn);\r\n    buttonRowEl.appendChild(centerBtn);\r\n    div.appendChild(buttonRowEl);\r\n\r\n\r\n\r\n    let layers: IKlBasicLayer[] = [];\r\n    {\r\n        let klCanvasLayerArr = params.klCanvas.getLayers();\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            layers.push({\r\n                image: klCanvasLayerArr[i].context.canvas,\r\n                opacity: klCanvasLayerArr[i].opacity,\r\n                mixModeStr: klCanvasLayerArr[i].mixModeStr\r\n            });\r\n        }\r\n    }\r\n    layers.push({\r\n        image: params.importImage,\r\n        opacity: 1,\r\n        mixModeStr: 'source-over'\r\n    });\r\n\r\n\r\n    let freeTransformCanvas = new FreeTransformCanvas({\r\n        elementWidth: isSmall ? 340 : 540,\r\n        elementHeight: isSmall ? 280 : 350,\r\n        imageWidth: params.klCanvas.getLayerContext(0).canvas.width,\r\n        imageHeight: params.klCanvas.getLayerContext(0).canvas.height,\r\n        layers: layers,\r\n        transformIndex: layers.length - 1,\r\n    });\r\n    BB.css(freeTransformCanvas.getElement(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n    });\r\n    div.appendChild(freeTransformCanvas.getElement());\r\n\r\n    function move(x, y) {\r\n        freeTransformCanvas.move(x, y);\r\n    }\r\n\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr) {\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    popup({\r\n        target: params.target,\r\n        message: `<b>${LANG('import-as-layer-title')}</b>`,\r\n        div: div,\r\n        style: isSmall ? null : {\r\n            width: '500px'\r\n        },\r\n        buttons: [\"Ok\", \"Cancel\"],\r\n        clickOnEnter: 'Ok',\r\n        callback: function(buttonStr) {\r\n            keyListener.destroy();\r\n            freeTransformCanvas.destroy();\r\n            BB.destroyEl(originalSizeBtn);\r\n            BB.destroyEl(fitSizeBtn);\r\n            BB.destroyEl(centerBtn);\r\n            if (buttonStr === 'Ok') {\r\n                params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\r\n            } else {\r\n                params.callback();\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Not really generalized. UI when you drag/drop an image into window.\r\n * The moment you create it, it will listen.\r\n *\r\n * @param p object {onDrop: func(files, optionStr), target: DOM Element, enabledTest: func -> bool} - optionStr: 'default'|'layer'|'image'\r\n * @constructor\r\n */\r\nexport function KlImageDropper(p) {\r\n\r\n    //set up DOM\r\n    let rootEl = BB.el({\r\n        content: 'Drop to import',\r\n        css: {\r\n            paddingTop: '100px',\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n            background: 'rgba(50, 50, 50, 0.7)',\r\n            color: '#fff',\r\n            textShadow: '2px 2px #000',\r\n            textAlign: 'center',\r\n            fontSize: '25px'\r\n        }\r\n    });\r\n    let wrapperEl = BB.el({\r\n        css: {\r\n            'marginTop': '50px',\r\n            'display': 'flex',\r\n            'justifyContent': 'center'\r\n        }\r\n    });\r\n    let optionStyle = {\r\n        width: '200px',\r\n        padding: '50px',\r\n        margin: '10px',\r\n        //opacity: 0.5,\r\n        borderRadius: '20px',\r\n        border: '1px dashed #fff',\r\n        background: '#00aefe',\r\n        fontWeight: 'bold'\r\n    };\r\n    let optionLayerEl = BB.el({\r\n        content: 'As Layer',\r\n        css: optionStyle\r\n    });\r\n    let optionImageEl = BB.el({\r\n        content: 'As New Image',\r\n        css: optionStyle\r\n    });\r\n\r\n    rootEl.appendChild(wrapperEl);\r\n    wrapperEl.appendChild(optionLayerEl);\r\n    wrapperEl.appendChild(optionImageEl);\r\n\r\n\r\n    let rootCounter = 0;\r\n    let optionLayerCounter = 0;\r\n    let optionImageCounter = 0;\r\n\r\n    function destroy() {\r\n        rootCounter = 0;\r\n        optionLayerCounter = 0;\r\n        optionImageCounter = 0;\r\n        try {\r\n            p.target.removeChild(rootEl);\r\n        } catch (e) { }\r\n    }\r\n\r\n    function testAcceptType(event) {\r\n        try {\r\n            return !event.dataTransfer.types.includes('text/plain');\r\n        } catch(e) {\r\n\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function updateOptions() {\r\n        let boxShadow = '0 0 20px 4px #fff';\r\n        if (optionLayerCounter > 0) {\r\n            optionLayerEl.style.boxShadow = boxShadow;\r\n            optionImageEl.style.boxShadow = '';\r\n        } else if (optionImageCounter > 0) {\r\n            optionLayerEl.style.boxShadow = '';\r\n            optionImageEl.style.boxShadow = boxShadow;\r\n        } else {\r\n            optionLayerEl.style.boxShadow = '';\r\n            optionImageEl.style.boxShadow = '';\r\n        }\r\n    }\r\n\r\n    BB.addEventListener(optionLayerEl,'dragenter', function() {\r\n        optionLayerCounter++;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionLayerEl,'dragleave', function() {\r\n        optionLayerCounter--;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionImageEl,'dragenter', function() {\r\n        optionImageCounter++;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionImageEl,'dragleave', function() {\r\n        optionImageCounter--;\r\n        updateOptions();\r\n    });\r\n\r\n\r\n    function rootDragOver(event) {\r\n        if (!testAcceptType(event)) {\r\n            return;\r\n        }\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n    }\r\n    function rootDragEnter(event) {\r\n        if (!p.enabledTest() || !testAcceptType(event)) {\r\n            return;\r\n        }\r\n        if (rootCounter === 0) {\r\n            p.target.appendChild(rootEl);\r\n        }\r\n        rootCounter++;\r\n\r\n    }\r\n    function rootDragLeave(event) {\r\n        if (!testAcceptType(event) || rootCounter === 0) {\r\n            return;\r\n        }\r\n        rootCounter = Math.max(0, rootCounter - 1);\r\n        if (rootCounter === 0) {\r\n            p.target.removeChild(rootEl);\r\n        }\r\n\r\n    }\r\n    function rootDrop(event) {\r\n        if (!testAcceptType(event) || event.dataTransfer.files.length === 0) {\r\n            destroy();\r\n            return;\r\n        }\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n\r\n        let optionStr = 'default';\r\n        if (optionLayerCounter > 0) {\r\n            optionStr = 'layer';\r\n        } else if (optionImageCounter > 0) {\r\n            optionStr = 'image';\r\n        }\r\n\r\n        p.onDrop(event.dataTransfer.files, optionStr);\r\n\r\n\r\n        if (rootCounter > 0) {\r\n            p.target.removeChild(rootEl);\r\n        }\r\n        rootCounter = 0;\r\n        optionLayerCounter = 0;\r\n        optionImageCounter = 0;\r\n        updateOptions();\r\n    }\r\n\r\n    BB.addEventListener(window,'dragover', rootDragOver, false);\r\n    BB.addEventListener(window,'dragenter', rootDragEnter, false);\r\n    BB.addEventListener(window,'dragleave', rootDragLeave, false);\r\n    BB.addEventListener(window,'drop', rootDrop, false);\r\n\r\n    // if something goes wrong and you're stuck with overlay\r\n    BB.addEventListener(rootEl, 'pointerdown', function() {\r\n        destroy();\r\n    });\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr) {\r\n            if (rootCounter > 0 && keyStr === 'esc') {\r\n                destroy();\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KlSmallColorSlider} from '../base-components/kl-color-slider-small';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {BrushSettingService} from '../../brushes-ui/brush-setting-service';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Compressed HUD toolspace. When you hold ctrl+alt.\r\n * small color picker, brush settings\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function OverlayToolspace(\r\n    p: {\r\n        brushSettingService: BrushSettingService; // to sync with outside\r\n        enabledTest: () => boolean; // calls to see if it's allowed to show\r\n    }\r\n) {\r\n\r\n    const sizeObj = {\r\n        width: 150,\r\n        svHeight: 90,\r\n        hHeight: 20,\r\n        sliderHeight: 25\r\n    };\r\n\r\n    let isVisible = false;\r\n    const div = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            left: '500px',\r\n            top: '500px',\r\n            background: 'rgb(221, 221, 221)',\r\n            display: 'none',\r\n            border: '1px solid #fff',\r\n            boxShadow: '0 0 10px rgba(0,0,0,0.5)',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    const queuedObj = {\r\n        color: null,\r\n        size: null,\r\n        opacity: null\r\n    };\r\n\r\n\r\n    // --- inputs ---\r\n\r\n    //color selection\r\n    const colorSlider = new KlSmallColorSlider({\r\n        width: sizeObj.width,\r\n        heightSV: sizeObj.svHeight,\r\n        heightH: sizeObj.hHeight,\r\n        color: p.brushSettingService.getColor(),\r\n        callback: function (rgbObj) {\r\n            selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\r\n            p.brushSettingService.setColor(rgbObj, subscriptionFunc);\r\n        }\r\n    });\r\n    const selectedColorEl = BB.el({\r\n        css: {\r\n            width: sizeObj.width + 'px',\r\n            height: sizeObj.hHeight + 'px',\r\n            pointerEvents: 'none'\r\n        }\r\n    });\r\n    {\r\n        const initialColor = p.brushSettingService.getColor();\r\n        selectedColorEl.style.backgroundColor = \"rgb(\" + initialColor.r + \",\" + initialColor.g + \",\" + initialColor.b + \")\";\r\n    }\r\n\r\n    div.appendChild(selectedColorEl);\r\n    div.appendChild(colorSlider.getElement());\r\n\r\n\r\n    function updateColor(rgbObj) {\r\n        colorSlider.setColor(rgbObj);\r\n        selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    //brushsize slider\r\n\r\n    const sizeSlider = new KlSlider({\r\n        label: LANG('brush-size'),\r\n        width: sizeObj.width,\r\n        height: sizeObj.sliderHeight,\r\n        min: 0,\r\n        max: 500,\r\n        initValue: 50,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        onChange: function(v) {\r\n            p.brushSettingService.setSize(v);\r\n        },\r\n        formatFunc: function(v) {\r\n            if (v * 2 < 10) {\r\n                return Math.round(v * 2 * 10) / 10;\r\n            }\r\n            return Math.round(v * 2);\r\n        }\r\n    });\r\n    BB.css(sizeSlider.getElement(), {\r\n        marginTop: '2px'\r\n    });\r\n    div.appendChild(sizeSlider.getElement());\r\n\r\n    const opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: sizeObj.width,\r\n        height: sizeObj.sliderHeight,\r\n        min: 0,\r\n        max: 1,\r\n        initValue: 1,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        onChange: function(v) {\r\n            p.brushSettingService.setOpacity(v);\r\n        },\r\n        formatFunc: function(v) {\r\n            return Math.round(v * 100);\r\n        }\r\n    });\r\n    BB.css(opacitySlider.getElement(), {\r\n        margin: '2px 0'\r\n    });\r\n    div.appendChild(opacitySlider.getElement());\r\n\r\n\r\n\r\n    // --- general setup ---\r\n\r\n    const subscriptionFunc = function(event) {\r\n        if (event.type === 'color') {\r\n            if (!isVisible) {\r\n                queuedObj.color = event.value;\r\n            } else {\r\n                updateColor(event.value);\r\n            }\r\n        }\r\n        if (event.type === 'size') {\r\n            if (!isVisible) {\r\n                queuedObj.size = event.value;\r\n            } else {\r\n                sizeSlider.setValue(event.value);\r\n            }\r\n        }\r\n        if (event.type === 'opacity') {\r\n            if (!isVisible) {\r\n                queuedObj.opacity = event.value;\r\n            } else {\r\n                opacitySlider.setValue(event.value);\r\n            }\r\n        }\r\n        if (event.type === 'sliderConfig') {\r\n            sizeSlider.update(event.value.sizeSlider);\r\n            opacitySlider.update(event.value.opacitySlider);\r\n        }\r\n    };\r\n    p.brushSettingService.subscribe(subscriptionFunc);\r\n    {\r\n        const sliderConfig = p.brushSettingService.getSliderConfig();\r\n        sizeSlider.update(sliderConfig.sizeSlider);\r\n        opacitySlider.update(sliderConfig.opacitySlider);\r\n        sizeSlider.setValue(p.brushSettingService.getSize());\r\n        opacitySlider.setValue(p.brushSettingService.getOpacity());\r\n    }\r\n\r\n    function updateUI() {\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible && mousePos) {\r\n            div.style.left = (mousePos.x - Math.round(sizeObj.width / 2)) + 'px';\r\n            div.style.top = (mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2)) + 'px';\r\n        }\r\n    }\r\n\r\n    let mousePos = null;\r\n    BB.addEventListener(document, 'pointermove', function(event) {\r\n        mousePos = {\r\n            x: event.pageX,\r\n            y: event.pageY,\r\n        };\r\n    });\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, event, comboStr, isRepeat) {\r\n            if (isRepeat) {\r\n                return;\r\n            }\r\n            if (isVisible) {\r\n                isVisible = false;\r\n                updateUI();\r\n                return;\r\n            }\r\n\r\n            if (!p.enabledTest() || !mousePos) {\r\n                return;\r\n            }\r\n\r\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(comboStr)) {\r\n                event.preventDefault();\r\n                isVisible = true;\r\n\r\n                if (queuedObj.color !== null) {\r\n                    updateColor(queuedObj.color);\r\n                    queuedObj.color = null;\r\n                }\r\n                if (queuedObj.size !== null) {\r\n                    sizeSlider.setValue(queuedObj.size);\r\n                    queuedObj.size = null;\r\n                }\r\n                if (queuedObj.opacity !== null) {\r\n                    opacitySlider.setValue(queuedObj.opacity);\r\n                    queuedObj.opacity = null;\r\n                }\r\n\r\n                updateUI();\r\n            }\r\n\r\n        },\r\n        onUp: function(keyStr, event, oldComboStr) {\r\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(oldComboStr) && isVisible) {\r\n                isVisible = false;\r\n                colorSlider.end();\r\n                updateUI();\r\n            }\r\n        },\r\n        onBlur: function() {\r\n            if (isVisible) {\r\n                isVisible = false;\r\n                colorSlider.end();\r\n                updateUI();\r\n            }\r\n        }\r\n    });\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * Topmost row of buttons in toolspace (with the app logo)\r\n *\r\n * p = { // button click callbacks\r\n *      logoImg: img,\r\n *     onLogo: function(),\r\n *     onNew: function(),\r\n *     onImport: function(),\r\n *     onSave: function(),\r\n *     onShare: function(),\r\n *     onHelp: function()\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceTopRow(p) {\r\n    let div = document.createElement('div');\r\n    BB.css(div, {\r\n        height: '36px',\r\n        //background: '#f00',\r\n        display: 'flex',\r\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n    });\r\n\r\n    function createButton(p) {\r\n        let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n        let result = BB.el({\r\n            className: 'toolspace-row-button nohighlight',\r\n            title: p.title,\r\n            onClick: p.onClick,\r\n            css: {\r\n                padding: p.contain ? padding + 'px 0' : ''\r\n            }\r\n        });\r\n        let im = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: p.contain ? 'contain' : '',\r\n                //filter: 'grayscale(1)',\r\n                height: '100%'\r\n            }\r\n        });\r\n        im.style.pointerEvents = 'none';\r\n        result.appendChild(im);\r\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: result,\r\n            onEnterLeave: function(isOver) {\r\n                result.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n        return result;\r\n    }\r\n\r\n    let logoButton = createButton({\r\n        onClick: p.onLogo,\r\n        title: LANG('home'),\r\n        image: p.logoImg ? p.logoImg : klecksLogoImg,\r\n        contain: true\r\n    });\r\n    logoButton.style.width = '45px';\r\n    logoButton.style.borderRight = '1px solid rgb(212, 212, 212)';\r\n    let newButton = createButton({\r\n        onClick: p.onNew,\r\n        title: LANG('file-new'),\r\n        image: newImageImg,\r\n        extraPadding: 1,\r\n        contain: true\r\n    });\r\n    let importButton = createButton({\r\n        onClick: p.onImport,\r\n        title: LANG('file-import'),\r\n        image: importImg,\r\n        extraPadding: 1,\r\n        contain: true\r\n    });\r\n    let saveButton = createButton({\r\n        onClick: p.onSave,\r\n        title: LANG('file-save'),\r\n        image: exportImg,\r\n        extraPadding: 1,\r\n        contain: true\r\n    });\r\n\r\n    let shareButton = null;\r\n    if (BB.canShareFiles()) {\r\n        shareButton = createButton({\r\n            onClick: p.onShare,\r\n            title: LANG('file-share'),\r\n            image: shareImg,\r\n            contain: true\r\n        });\r\n    }\r\n    let helpButton = createButton({\r\n        onClick: p.onHelp,\r\n        title: LANG('help'),\r\n        image: helpImg,\r\n        contain: true\r\n    });\r\n\r\n    div.appendChild(logoButton);\r\n    div.appendChild(newButton);\r\n    div.appendChild(importButton);\r\n    div.appendChild(saveButton);\r\n    if (shareButton) {\r\n        div.appendChild(shareButton);\r\n    }\r\n    div.appendChild(helpButton);\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    }\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eHdqz\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3x5dR\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hbDTd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"16iGk\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2ME3z\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hZnSk\");","import {BB} from '../../../bb/bb';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n// @ts-ignore\r\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\r\n// @ts-ignore\r\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\r\n// @ts-ignore\r\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\r\n// @ts-ignore\r\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\r\n// @ts-ignore\r\nimport caretDownImg from 'url:~/src/app/img/ui/caret-down.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Toolrow Dropdown. The button where you select: brush, fill, select, transform, etc.\r\n *\r\n * p = {\r\n *     onChange: func(activeStr)\r\n * }\r\n *\r\n * activeStr = 'draw' | 'fill' | 'text'\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolDropdown(p) {\r\n\r\n    let optionArr = ['draw', 'fill', 'text', 'shape'];\r\n    let imArr = [\r\n        toolPaintImg,\r\n        toolFillImg,\r\n        toolTextImg,\r\n        toolShapeImg\r\n    ];\r\n    let titleArr = [\r\n        `${LANG('tool-brush')} [B]`,\r\n        `${LANG('tool-paint-bucket')} [G]`,\r\n        `${LANG('tool-text')} [T]`,\r\n        `${LANG('tool-shape')} [U]`,\r\n    ];\r\n    let currentActiveIndex = 0;\r\n    let isActive = true;\r\n    let isOpen = false;\r\n\r\n    //preload images\r\n    setTimeout(function() {\r\n        for (let i = 1; i < imArr.length; i++) {\r\n            let im = new Image();\r\n            im.src = imArr[i];\r\n        }\r\n    }, 100);\r\n\r\n    let smallMargin = '6px 0';\r\n    let div = BB.el({\r\n        css: {\r\n            position: 'relative',\r\n            flexGrow: '1'\r\n        }\r\n    });\r\n\r\n    let openTimeout;\r\n    let isDragging = false;\r\n    let startX, startY;\r\n    let pointerListener;\r\n    if (BB.hasPointerEvents) {\r\n        pointerListener = new BB.PointerListener({\r\n            target: div,\r\n            maxPointers: 1,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown') {\r\n                    if (isOpen) {\r\n                        return;\r\n                    }\r\n\r\n                    openTimeout = setTimeout(function() {\r\n                        showDropdown();\r\n                    }, 400);\r\n                    isDragging = true;\r\n                    startX = event.pageX;\r\n                    startY = event.pageY;\r\n\r\n                } else if (event.type === 'pointermove') {\r\n                    if (isDragging && !isOpen && BB.dist(startX, startY, event.pageX, event.pageY) > 5) {\r\n                        clearTimeout(openTimeout);\r\n                        showDropdown();\r\n                    }\r\n\r\n                } else if (event.type === 'pointerup') {\r\n                    clearTimeout(openTimeout);\r\n                    if (isOpen && isDragging) {\r\n                        let target = document.elementFromPoint(event.pageX, event.pageY);\r\n                        for (let i = 0; i < dropdownBtnArr.length; i++) {\r\n                            if (target === dropdownBtnArr[i].wrapper) {\r\n                                closeDropdown();\r\n                                isActive = true;\r\n                                currentActiveIndex = i;\r\n                                updateButton();\r\n                                p.onChange(optionArr[currentActiveIndex]);\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                    isDragging = false;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    let activeButton = BB.el({\r\n        parent: div,\r\n        className: 'toolspace-row-button nohighlight toolspace-row-button-activated',\r\n        title: titleArr[currentActiveIndex],\r\n        onClick: function(e) {\r\n            if (isActive && !isOpen) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                showDropdown();\r\n                return;\r\n            }\r\n\r\n            isActive = true;\r\n            p.onChange(optionArr[currentActiveIndex]);\r\n            if (isOpen) {\r\n                closeDropdown();\r\n            }\r\n        },\r\n        css: {\r\n            padding: '10px 0',\r\n            pointerEvents: 'auto',\r\n            height: '100%',\r\n            boxSizing: 'border-box'\r\n        }\r\n    });\r\n\r\n    let activeButtonIm = BB.el({\r\n        parent: activeButton,\r\n        css: {\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            backgroundSize: 'contain',\r\n            width: 'calc(100% - 7px)',\r\n            height: '100%',\r\n            pointerEvents: 'none',\r\n            opacity: '0.75',\r\n        }\r\n    });\r\n\r\n    let arrowButton = BB.el({\r\n        parent: activeButton,\r\n        css: {\r\n            position: 'absolute',\r\n            right: '1px',\r\n            bottom: '1px',\r\n            width: '18px',\r\n            height: '18px',\r\n            //background: '#aaa',\r\n            //borderRadius: '2px',\r\n            cursor: 'pointer',\r\n\r\n            backgroundImage: 'url(\\'' + caretDownImg + '\\')',\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            backgroundSize: '60%'\r\n        },\r\n        title: 'More Tools',\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            showDropdown();\r\n        }\r\n    });\r\n\r\n\r\n    let overlay = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            //background: 'rgba(255,0,0,0.5)',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0'\r\n        }\r\n    });\r\n    let overlayPointerListener = new BB.PointerListener({\r\n        target: overlay,\r\n        pointers: 1,\r\n        onPointer: function(e) {\r\n            if (e.type === 'pointerdown') {\r\n                e.eventPreventDefault();\r\n                closeDropdown();\r\n            }\r\n        }\r\n    });\r\n\r\n    let dropdownWrapper = BB.el({\r\n        className: 'tool-dropdown-wrapper',\r\n        css: {\r\n            position: 'absolute',\r\n            width: '100%',\r\n            height: (100 * (optionArr.length - 1)) + '%',\r\n            top: '100%',\r\n            left: '0',\r\n            zIndex: '1',\r\n            boxSizing: 'border-box',\r\n            cursor: 'pointer',\r\n            transition: 'height 0.1s ease-in-out, opacity 0.1s ease-in-out',\r\n            borderBottomLeftRadius: '5px',\r\n            borderBottomRightRadius: '5px',\r\n            overflow: 'hidden',\r\n        }\r\n    });\r\n\r\n    let dropdownBtnArr = [];\r\n\r\n    function createDropdownButton(p) {\r\n        let result = {};\r\n\r\n        let wrapper = BB.el({\r\n            parent: dropdownWrapper,\r\n            className: 'tool-dropdown-button',\r\n            title: p.title,\r\n            css: {\r\n                padding: '10px 0',\r\n                height: (100 / (optionArr.length - 1)) + '%',\r\n                boxSizing: 'border-box'\r\n            },\r\n            onClick: function(e) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                p.onClick(p.index, p.id);\r\n            }\r\n        });\r\n        (result as any).wrapper = wrapper;\r\n        let im = BB.el({\r\n            parent: wrapper,\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: 'contain',\r\n                height: '100%',\r\n                pointerEvents: 'none',\r\n                opacity: '0.75'\r\n            }\r\n        });\r\n\r\n        // --- interface ---\r\n        (result as any).show = function(b) {\r\n            wrapper.style.display = b ? 'block' : 'none';\r\n        };\r\n\r\n        (result as any).setIsSmall = function(b) {\r\n            wrapper.style.padding = b ? smallMargin : '10px 0';\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    function onClickDropdownBtn(index, id) {\r\n        closeDropdown();\r\n\r\n        isActive = true;\r\n        currentActiveIndex = index;\r\n\r\n        updateButton();\r\n\r\n        p.onChange(optionArr[currentActiveIndex]);\r\n    }\r\n\r\n    for (let i = 0; i < optionArr.length; i++) {\r\n        dropdownBtnArr.push(createDropdownButton({\r\n            index: i,\r\n            id: optionArr[i],\r\n            image: imArr[i],\r\n            title: titleArr[i],\r\n            onClick: onClickDropdownBtn\r\n        }));\r\n    }\r\n\r\n    function showDropdown() {\r\n        dialogCounter.increase(0.5);\r\n        isOpen = true;\r\n\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            dropdownBtnArr[i].show(currentActiveIndex !== i);\r\n        }\r\n\r\n        arrowButton.style.display = 'none';\r\n        div.style.zIndex = '1';\r\n        document.body.appendChild(overlay);\r\n        div.appendChild(dropdownWrapper);\r\n    }\r\n\r\n    function closeDropdown() {\r\n        dialogCounter.decrease(0.5);\r\n        isOpen = false;\r\n        arrowButton.style.removeProperty('display');\r\n        div.style.removeProperty('z-index');\r\n        document.body.removeChild(overlay);\r\n\r\n        div.removeChild(dropdownWrapper);\r\n    }\r\n\r\n    function updateButton() {\r\n        activeButton.title = titleArr[currentActiveIndex];\r\n        activeButtonIm.style.backgroundImage = 'url(\\'' + imArr[currentActiveIndex] + '\\')';\r\n    }\r\n    updateButton();\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.setIsSmall = function(b) {\r\n        activeButton.style.padding = b ? smallMargin : '10px 0';\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            dropdownBtnArr[i].setIsSmall(b);\r\n        }\r\n        if (b) {\r\n            arrowButton.style.width = '14px';\r\n            arrowButton.style.height = '14px';\r\n        } else {\r\n            arrowButton.style.width = '18px';\r\n            arrowButton.style.height = '18px';\r\n        }\r\n    };\r\n\r\n    this.setActive = function(activeStr) {\r\n        if (optionArr.includes(activeStr)) {\r\n            isActive = true;\r\n            for (let i = 0; i < optionArr.length; i++) {\r\n                if (optionArr[i] === activeStr) {\r\n                    currentActiveIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n            activeButton.classList.add('toolspace-row-button-activated');\r\n            updateButton();\r\n        } else {\r\n            isActive = false;\r\n            activeButton.classList.remove('toolspace-row-button-activated');\r\n        }\r\n    };\r\n\r\n    this.getActive = function() {\r\n        return optionArr[currentActiveIndex];\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6mHrC\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hS5Hj\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"doX4v\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7NqHO\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dz3mY\");","import {BB} from '../../../bb/bb';\r\nimport {ToolDropdown} from './tool-dropdown';\r\n// @ts-ignore\r\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\r\n// @ts-ignore\r\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\r\n// @ts-ignore\r\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\r\n// @ts-ignore\r\nimport toolUndoImg from 'url:~/src/app/img/ui/tool-undo.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * Row of buttons in toolspace. image-operations (draw, hand), zoom, undo/redo\r\n * Need to do syncing. So tool is correct, and zoom/undo/redo buttons are properly enabled/disabled\r\n * heights: 54px tall, 36px small -> via setIsSmall\r\n *\r\n * p = {\r\n *     onActivate: function(activeStr), // clicking on tool button - activating it\r\n *     onZoomIn: function(),\r\n *     onZoomOut: function(),\r\n *     onUndo: function(),\r\n *     onRedo: function(),\r\n * }\r\n *\r\n * activeStr = 'draw' | 'hand' | 'fill' | 'text'\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceToolRow(p) {\r\n    let div = document.createElement('div');\r\n    BB.css(div, {\r\n        height: '54px',\r\n        //height: '36px',\r\n        display: 'flex',\r\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n    });\r\n\r\n    let currentActiveStr = 'draw'; // 'draw' | 'hand' | 'fill'\r\n\r\n    function setActive(activeStr, doEmit?) {\r\n        if (currentActiveStr === activeStr) {\r\n            return;\r\n        }\r\n\r\n        currentActiveStr = activeStr;\r\n\r\n        toolDropdown.setActive(currentActiveStr);\r\n        handButton.classList.toggle('toolspace-row-button-activated', currentActiveStr === 'hand');\r\n\r\n        if (doEmit) {\r\n            p.onActivate(currentActiveStr);\r\n        }\r\n    }\r\n\r\n    function createButton(p) {\r\n\r\n        let smallMargin = p.doLighten ? '6px 0' : '8px 0';\r\n\r\n        let result = BB.el({\r\n            className: 'toolspace-row-button nohighlight',\r\n            //title: p.title,\r\n            onClick: p.onClick,\r\n            css: {\r\n                padding: p.contain ? '10px 0' : ''\r\n            }\r\n        });\r\n        let im = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: p.contain ? 'contain' : '',\r\n                //filter: 'grayscale(1)',\r\n                height: '100%',\r\n                transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none',\r\n                opacity: p.doLighten ? '0.75' : '1'\r\n            }\r\n        });\r\n        result.appendChild(im);\r\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: result,\r\n            onEnterLeave: function(isOver) {\r\n                result.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n        (result as any).setIsSmall = function(b) {\r\n            result.style.padding = p.contain ? (b ? smallMargin : '10px 0') : '';\r\n        }\r\n        return result;\r\n    }\r\n\r\n\r\n    function createTriangleButton(p) { // because IE and Edge don't support clip path\r\n\r\n        let result = document.createElement('div');\r\n        BB.css(result, {\r\n            flexGrow: '1',\r\n            position: 'relative'\r\n        });\r\n\r\n        let svg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '67px', // can't think of a way doing with percentage\r\n            height: '54px',\r\n            viewBox: '0 0 100 100',\r\n            preserveAspectRatio: 'none'\r\n        });\r\n        BB.css(svg, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0'\r\n        });\r\n\r\n        let blurRadius = 10;\r\n        let blurOffsetX = 2;\r\n        let blurOffsetY = 2;\r\n\r\n        let defs = BB.createSvg( { // inset shadow via svg\r\n            elementType: 'defs',\r\n            childrenArr: [\r\n                {\r\n                    elementType: 'filter',\r\n                    id: 'innershadow',\r\n                    x0: '-50%',\r\n                    y0: '-50%',\r\n                    width: '200%',\r\n                    height: '200%',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'feGaussianBlur',\r\n                            in: 'SourceAlpha',\r\n                            stdDeviation: '' + blurRadius,\r\n                            result: 'blur'\r\n                        }, {\r\n                            elementType: 'feOffset',\r\n                            dx: '' + blurOffsetX,\r\n                            dy: '' + blurOffsetY\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'SourceAlpha',\r\n                            operator: 'arithmetic',\r\n                            k2: '-1',\r\n                            k3: '1',\r\n                            result: 'shadowDiff'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feFlood',\r\n                            'flood-color': '#000',\r\n                            'flood-opacity': '0.2'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'shadowDiff',\r\n                            operator: 'in'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'SourceGraphic',\r\n                            operator: 'over',\r\n                            result: 'firstfilter'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feGaussianBlur',\r\n                            in: 'firstfilter',\r\n                            stdDeviation: '' + blurRadius,\r\n                            result: 'blur2'\r\n                        }, {\r\n                            elementType: 'feOffset',\r\n                            dx: '' + blurOffsetX,\r\n                            dy: '' + blurOffsetY\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'firstfilter',\r\n                            operator: 'arithmetic',\r\n                            k2: '-1',\r\n                            k3: '1',\r\n                            result: 'shadowDiff'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feFlood',\r\n                            'flood-color': '#000',\r\n                            'flood-opacity': '0.2'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'shadowDiff',\r\n                            operator: 'in'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'firstfilter',\r\n                            operator: 'over'\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        });\r\n\r\n\r\n        let svgTriangleLeft = BB.createSvg({\r\n            elementType: 'path',\r\n            'vector-effect': 'non-scaling-stroke',\r\n            d: 'M0,0 L 100,0 0,100 z',\r\n            fill: 'rgba(0,0,0,0)',\r\n            class: 'toolspace-svg-triangle-button'\r\n        });\r\n        svgTriangleLeft.onclick = function() {\r\n            p.onLeft();\r\n            svgTriangleLeft.classList.remove('toolspace-svg-triangle-button-hover');\r\n        };\r\n\r\n        let svgTriangleRight = BB.createSvg({\r\n            elementType: 'path',\r\n            'vector-effect': 'non-scaling-stroke',\r\n            d: 'M100,100 L 100,0 0,100 z',\r\n            fill: 'rgba(0,0,0,0)',\r\n            class: 'toolspace-svg-triangle-button'\r\n        });\r\n        svgTriangleRight.onclick = function() {\r\n            p.onRight();\r\n            svgTriangleRight.classList.remove('toolspace-svg-triangle-button-hover');\r\n        };\r\n\r\n        // because :hover causes problems w touch\r\n        (result as any).leftPointerListener = new BB.PointerListener({\r\n            target: svgTriangleLeft,\r\n            onEnterLeave: function(isOver) {\r\n                svgTriangleLeft.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n            }\r\n        });\r\n        (result as any).rightPointerListener = new BB.PointerListener({\r\n            target: svgTriangleRight,\r\n            onEnterLeave: function(isOver) {\r\n                svgTriangleRight.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n            }\r\n        });\r\n\r\n\r\n        svg.appendChild(defs);\r\n        svg.appendChild(svgTriangleLeft);\r\n        svg.appendChild(svgTriangleRight);\r\n        result.appendChild(svg);\r\n\r\n\r\n        let leftIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '8px',\r\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        result.appendChild(leftIm);\r\n\r\n\r\n        let rightIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                right: '10px',\r\n                bottom: '8px',\r\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        result.appendChild(rightIm);\r\n\r\n\r\n\r\n\r\n\r\n        (result as any).setIsEnabledLeft = function(b) {\r\n            svgTriangleLeft.classList.toggle('toolspace-row-button-disabled', !b);\r\n            leftIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n        (result as any).setIsEnabledRight = function(b) {\r\n            svgTriangleRight.classList.toggle('toolspace-row-button-disabled', !b);\r\n            rightIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    function createTriangleButtonViaClipPath(p) {\r\n        let result = document.createElement('div');\r\n        BB.css(result, {\r\n            flexGrow: '1',\r\n            position: 'relative'\r\n        });\r\n\r\n\r\n        let leftButton = BB.el({\r\n            className: 'toolspace-triangle-button',\r\n            onClick: p.onLeft,\r\n            css: {\r\n                clipPath: 'polygon(0% 0%, 100% 0%, 100% 0%, 0% 100%)'\r\n            }\r\n        });\r\n\r\n        let leftIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '8px',\r\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        leftButton.appendChild(leftIm);\r\n\r\n\r\n\r\n        let rightButton = BB.el({\r\n            className: 'toolspace-triangle-button',\r\n            onClick: p.onRight,\r\n            css: {\r\n                clipPath: 'polygon(0% 100%, 100% 0%, 100% 100%, 0% 100%)'\r\n            }\r\n        });\r\n\r\n        let rightIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                right: '10px',\r\n                bottom: '8px',\r\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        rightButton.appendChild(rightIm);\r\n\r\n\r\n\r\n        result.appendChild(leftButton);\r\n        result.appendChild(rightButton);\r\n\r\n\r\n        // because :hover causes problems w touch\r\n        (result as any).leftPointerListener = new BB.PointerListener({\r\n            target: leftButton,\r\n            onEnterLeave: function(isOver) {\r\n                leftButton.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n        (result as any).rightPointerListener = new BB.PointerListener({\r\n            target: rightButton,\r\n            onEnterLeave: function(isOver) {\r\n                rightButton.classList.toggle('toolspace-row-button-hover', isOver);\r\n            }\r\n        });\r\n\r\n\r\n\r\n        (result as any).setIsEnabledLeft = function(b) {\r\n            leftButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n        (result as any).setIsEnabledRight = function(b) {\r\n            rightButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        };\r\n        return result;\r\n    }\r\n\r\n    let toolDropdown = new ToolDropdown({\r\n        onChange: function(activeStr) {\r\n            setActive(activeStr, true);\r\n        }\r\n    });\r\n    div.appendChild(toolDropdown.getElement());\r\n\r\n    let handButton = createButton({\r\n        onClick: function() {\r\n            setActive('hand', true);\r\n        },\r\n        image: toolHandImg,\r\n        contain: true,\r\n        doLighten: true\r\n    });\r\n    handButton.style.borderRight = '1px solid rgb(212, 212, 212)';\r\n    handButton.title = LANG('tool-hand');\r\n    div.appendChild(handButton);\r\n\r\n    let zoomInNOutButton = createTriangleButton({\r\n        onLeft: p.onZoomIn,\r\n        onRight: p.onZoomOut,\r\n        leftImage: toolZoomInImg,\r\n        rightImage: toolZoomOutImg,\r\n    });\r\n    zoomInNOutButton.title = LANG('tool-zoom');\r\n    div.appendChild(zoomInNOutButton);\r\n\r\n    let zoomInButton = createButton({\r\n        onClick: p.onZoomIn,\r\n        image: toolZoomInImg,\r\n        contain: true\r\n    });\r\n    zoomInButton.title = LANG('zoom-in');\r\n    div.appendChild(zoomInButton);\r\n\r\n    let zoomOutButton = createButton({\r\n        onClick: p.onZoomOut,\r\n        image: toolZoomOutImg,\r\n        contain: true\r\n    });\r\n    zoomOutButton.title = LANG('zoom-out');\r\n    div.appendChild(zoomOutButton);\r\n\r\n    let undoNRedoButton = createTriangleButton({\r\n        onLeft: p.onUndo,\r\n        onRight: p.onRedo,\r\n        leftImage: toolUndoImg,\r\n        rightImage: null,\r\n    });\r\n    undoNRedoButton.title = LANG('tool-undo-redo');\r\n    (undoNRedoButton as any).setIsEnabledLeft(false);\r\n    (undoNRedoButton as any).setIsEnabledRight(false);\r\n    div.appendChild(undoNRedoButton);\r\n\r\n    let undoButton = createButton({\r\n        onClick: p.onUndo,\r\n        image: toolUndoImg,\r\n        contain: true\r\n    });\r\n    undoButton.title = LANG('undo');\r\n    undoButton.classList.add('toolspace-row-button-disabled');\r\n    div.appendChild(undoButton);\r\n\r\n    let redoButton = createButton({\r\n        onClick: p.onRedo,\r\n        image: toolUndoImg,\r\n        contain: true,\r\n        doMirror: true\r\n    });\r\n    redoButton.title = LANG('redo');\r\n    redoButton.classList.add('toolspace-row-button-disabled');\r\n    div.appendChild(redoButton);\r\n\r\n    zoomInButton.style.display = 'none';\r\n    zoomOutButton.style.display = 'none';\r\n    undoButton.style.display = 'none';\r\n    redoButton.style.display = 'none';\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.setIsSmall = function(b) {\r\n        BB.css(div, {\r\n            height: b ? '36px' : '54px'\r\n        });\r\n\r\n        toolDropdown.setIsSmall(b);\r\n        (handButton as any).setIsSmall(b);\r\n        (zoomInButton as any).setIsSmall(b);\r\n        (zoomOutButton as any).setIsSmall(b);\r\n        (undoButton as any).setIsSmall(b);\r\n        (redoButton as any).setIsSmall(b);\r\n\r\n        if (b) {\r\n            zoomInNOutButton.style.display = 'none';\r\n            undoNRedoButton.style.display = 'none';\r\n            zoomInButton.style.display = 'block';\r\n            zoomOutButton.style.display = 'block';\r\n            undoButton.style.display = 'block';\r\n            redoButton.style.display = 'block';\r\n        } else {\r\n            zoomInNOutButton.style.display = 'block';\r\n            undoNRedoButton.style.display = 'block';\r\n            zoomInButton.style.display = 'none';\r\n            zoomOutButton.style.display = 'none';\r\n            undoButton.style.display = 'none';\r\n            redoButton.style.display = 'none';\r\n        }\r\n\r\n    };\r\n\r\n    this.setEnableZoomIn = function(b) {\r\n        zoomInButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (zoomInNOutButton as any).setIsEnabledLeft(b);\r\n    };\r\n    this.setEnableZoomOut = function(b) {\r\n        zoomOutButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (zoomInNOutButton as any).setIsEnabledRight(b);\r\n    };\r\n    this.setEnableUndo = function(b) {\r\n        undoButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (undoNRedoButton as any).setIsEnabledLeft(b);\r\n    };\r\n    this.setEnableRedo = function(b) {\r\n        redoButton.classList.toggle('toolspace-row-button-disabled', !b);\r\n        (undoNRedoButton as any).setIsEnabledRight(b);\r\n    };\r\n    this.setActive = function(activeStr) {\r\n        setActive(activeStr);\r\n    };\r\n    this.getActive = function() {\r\n        return currentActiveStr;\r\n    };\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2gZH2\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"04ZZm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"j9xio\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"AnO0a\");","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../base-components/select';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Ui to select stabilizer level. 4 options. returned as 0-3\r\n *\r\n * p = {\r\n *     smoothing: number, // initial level 0-3\r\n *     onSelect: function(level number) // 0-3, when level changes\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceStabilizerRow(p) {\r\n\r\n    let div = BB.el({\r\n        tagName: 'label',\r\n        content: LANG('stabilizer') + '&nbsp;',\r\n        title: LANG('stabilizer-title'),\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            fontSize: '13px',\r\n            color: 'rgba(0,0,0,0.6)'\r\n        }\r\n    });\r\n\r\n    let strengthSelect = new Select({\r\n        optionArr: [\r\n            ['0', '0'],\r\n            ['1', '1'],\r\n            ['2', '2'],\r\n            ['3', '3'],\r\n            ['4', '4'],\r\n            ['5', '5']\r\n        ],\r\n        initValue: p.smoothing,\r\n        onChange: function(val) {\r\n            p.onSelect(parseInt(val));\r\n        }\r\n    });\r\n    div.appendChild(strengthSelect.getElement());\r\n\r\n    let pointerListener = new BB.PointerListener({\r\n        target: div,\r\n        onWheel: function(e) {\r\n            strengthSelect.setDeltaValue(e.deltaY);\r\n        }\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport invertedBorderImg from 'url:~/src/app/img/ui/inverted-border.svg';\r\n\r\n/**\r\n * row of tabs. uses css class .tabrow-tab\r\n *\r\n * p = {\r\n *     initialId: string, // e.g. 'draw'\r\n *     useAccent: boolean,\r\n *     tabArr: [\r\n *         {\r\n *             id: string, // e.g. 'draw',\r\n *             label: string, // optional\r\n *             image: string, // optional background image\r\n *             title: string, // optional\r\n *             isVisible: boolean, // optional - default is true\r\n *             onOpen: function(),\r\n *             onClose: function(),\r\n *             css: {...},\r\n *         }\r\n *     ]\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function TabRow(p) {\r\n    let _this = this;\r\n    let height = 35;\r\n    let div = BB.el({\r\n        className: 'tabrow',\r\n        css: {\r\n            height: height + 'px'\r\n        }\r\n    });\r\n\r\n    let tabArr = []; //creates its own internal arr\r\n    let openedTabObj = null;\r\n\r\n    const roundSize = 10;\r\n    const roundRight = BB.el({\r\n        css: {\r\n            width: roundSize + 'px',\r\n            height: roundSize + 'px',\r\n            backgroundImage: `url('${invertedBorderImg}')`,\r\n            backgroundSize: 'cover',\r\n            position: 'absolute',\r\n            right: -roundSize + 'px',\r\n            bottom: '0',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n    const roundLeft = BB.el({\r\n        css: {\r\n            width: roundSize + 'px',\r\n            height: roundSize + 'px',\r\n            backgroundImage: `url('${invertedBorderImg}')`,\r\n            backgroundSize: 'cover',\r\n            position: 'absolute',\r\n            left: -roundSize + 'px',\r\n            bottom: '0',\r\n            transform: 'scale(-1,1)',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n\r\n    function createTab(pTabObj, initialId, useAccent) {\r\n        let result: any = {\r\n            id: pTabObj.id,\r\n            isVisible: 'isVisible' in pTabObj ? pTabObj.isVisible : true,\r\n            onOpen: pTabObj.onOpen,\r\n            onClose: pTabObj.onClose,\r\n            update: function(openedTabObj) {\r\n                tabDiv.className = openedTabObj === result ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab';\r\n                tabDiv.style.display = result.isVisible ? 'block' : 'none';\r\n            }\r\n        };\r\n        let tabDiv = BB.el({\r\n            content: 'label' in pTabObj ? pTabObj.label : '',\r\n            title: 'title' in pTabObj ? pTabObj.title : undefined,\r\n            className: initialId === result.id ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab',\r\n            css: {\r\n                lineHeight: height + 'px',\r\n                display: result.isVisible ? 'block' : 'none',\r\n                zIndex: '0',\r\n            },\r\n            onClick: function() {\r\n                if (openedTabObj === result) {\r\n                    return;\r\n                }\r\n                _this.open(result.id);\r\n            }\r\n        });\r\n        result.div = tabDiv;\r\n        if ('image' in pTabObj) {\r\n            BB.css(tabDiv, {\r\n                backgroundImage: 'url(\\'' + pTabObj.image + '\\')',\r\n                backgroundSize: (height - 7) + 'px'\r\n            });\r\n        }\r\n        if ('css' in pTabObj) {\r\n            BB.css(tabDiv, pTabObj.css);\r\n        }\r\n        div.appendChild(tabDiv);\r\n\r\n        let pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: tabDiv,\r\n            onEnterLeave: function(isOver) {\r\n                tabDiv.classList.toggle('tabrow-tab-hover', isOver);\r\n            }\r\n        });\r\n\r\n        if (initialId === result.id) {\r\n            result.onOpen();\r\n            result.div.appendChild(roundRight);\r\n            result.div.appendChild(roundLeft);\r\n        } else {\r\n            result.onClose();\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    for (let i = 0; i < p.tabArr.length; i++) {\r\n        tabArr.push(createTab(p.tabArr[i], p.initialId, p.useAccent));\r\n    }\r\n\r\n    for (let i = 0; i < tabArr.length; i++) {\r\n        if (tabArr[i].id === p.initialId) {\r\n            openedTabObj = tabArr[i];\r\n        }\r\n    }\r\n    if (openedTabObj === null) {\r\n        throw 'invalid initialId';\r\n    }\r\n\r\n    function update() {\r\n        for (let i = 0; i < tabArr.length; i++) {\r\n            tabArr[i].update(openedTabObj);\r\n        }\r\n    }\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.open = function(tabId) {\r\n        for (let i = 0; i < tabArr.length; i++) {\r\n            if (tabArr[i].id === tabId) {\r\n                if (openedTabObj === tabArr[i]) { // already open\r\n                    return;\r\n                }\r\n                openedTabObj.onClose();\r\n                openedTabObj = tabArr[i];\r\n                openedTabObj.onOpen();\r\n                openedTabObj.div.appendChild(roundRight);\r\n                openedTabObj.div.appendChild(roundLeft);\r\n                update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.open - invalid tabId';\r\n    };\r\n\r\n    this.getOpenedTabId = function() {\r\n        return '' + openedTabObj.id;\r\n    };\r\n\r\n    this.setIsVisible = function(tabId, isVisible) {\r\n        for (let i = 0; i < tabArr.length; i++) {\r\n            if (tabArr[i].id === tabId) {\r\n                tabArr[i].isVisible = !!isVisible;\r\n                update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.setIsVisible - invalid tabId';\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"nTvP2\");","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport angleImg from 'url:~/src/app/img/ui/angle.svg';\r\n// @ts-ignore\r\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Ui, when hand tool tab is open.\r\n *\r\n * p = {\r\n *     scale: number, // initial value\r\n *     angleDeg: number, // initial value\r\n *     onReset: function(),\r\n *     onFit: function(),\r\n *     onAngleChange: function(angleDeg number, isRelative number)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function HandUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n    let scale = p.scale;\r\n    let angleDeg = p.angleDeg;\r\n\r\n    let row1 = BB.el({\r\n        css: {\r\n            marginBottom: '10px',\r\n            display: 'flex'\r\n        }\r\n    });\r\n    let row2 = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            marginBottom: '10px',\r\n        }\r\n    });\r\n    let row3 = BB.el({\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n    div.append(row1, row2, row3);\r\n\r\n\r\n    let scaleEl = BB.el({\r\n        css: {\r\n            width: '55px',\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    row1.appendChild(scaleEl);\r\n\r\n    let angleIm = new Image();\r\n    angleIm.src = angleImg;\r\n    BB.css(angleIm, {\r\n        verticalAlign: 'bottom',\r\n        width: '20px',\r\n        height: '20px',\r\n        marginRight: '5px',\r\n        borderRadius: '10px',\r\n        background: 'rgba(0,0,0,0.2)',\r\n        userSelect: 'none'\r\n    });\r\n    row1.appendChild(angleIm);\r\n\r\n    let angleEl = BB.el({\r\n        css: {\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    row1.appendChild(angleEl);\r\n\r\n\r\n    function update() {\r\n        scaleEl.innerHTML = Math.round(scale * 100) + '%';\r\n        angleEl.innerHTML =  Math.round(angleDeg) + '';\r\n\r\n\r\n        angleIm.style.transform = 'rotate(' + angleDeg + 'deg)';\r\n        if (angleDeg % 90 === 0) {\r\n            angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)';\r\n        } else {\r\n            angleIm.style.boxShadow = '';\r\n        }\r\n    }\r\n    update();\r\n\r\n\r\n    let resetButton = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('hand-reset'),\r\n        onClick: p.onReset\r\n    });\r\n    BB.makeUnfocusable(resetButton);\r\n\r\n    let fitButton = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('hand-fit'),\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: p.onFit\r\n    });\r\n    BB.makeUnfocusable(fitButton);\r\n    row2.append(resetButton, fitButton);\r\n\r\n    let leftRotateButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\r\n        onClick: function() {\r\n            p.onAngleChange(-15, true);\r\n        }\r\n    });\r\n    BB.makeUnfocusable(leftRotateButton);\r\n\r\n    let resetAngleButton = BB.el({\r\n        tagName: 'button',\r\n        content: '0',\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            p.onAngleChange(0);\r\n        }\r\n    });\r\n    BB.makeUnfocusable(resetAngleButton);\r\n\r\n    let rightRotateButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\"/>',\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            p.onAngleChange(15, true);\r\n        }\r\n    });\r\n    BB.makeUnfocusable(rightRotateButton);\r\n    row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\r\n\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            update();\r\n        }\r\n    };\r\n    this.update = function(pScale, pAngleDeg) {\r\n        scale = pScale;\r\n        angleDeg = pAngleDeg;\r\n        if (isVisible) {\r\n            update();\r\n        }\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6toXQ\");","import {BB} from '../../../bb/bb';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {Select} from '../base-components/select';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Paint Bucket tab contents (color slider, opacity slider, etc)\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function FillUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n\r\n    let colorDiv = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginBottom: '10px'\r\n        }\r\n    });\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 0,\r\n        max: 1,\r\n        initValue: 1,\r\n        onChange: function (val) {\r\n        },\r\n        formatFunc: function(v) {\r\n            return Math.round(v * 100);\r\n        }\r\n    });\r\n    div.appendChild(opacitySlider.getElement());\r\n\r\n    let toleranceSlider = new KlSlider({\r\n        label: LANG('bucket-tolerance'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 0,\r\n        max: 255,\r\n        initValue: 255 / 100 * 20,\r\n        onChange: function (val) {\r\n        },\r\n        formatFunc: function(v) {\r\n            return Math.round(v / 255 * 100);\r\n        }\r\n    });\r\n    BB.css(toleranceSlider.getElement(), {\r\n        marginTop: '10px'\r\n    });\r\n    div.appendChild(toleranceSlider.getElement());\r\n\r\n    let selectRow = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n\r\n    let modeWrapper;\r\n    let modeSelect;\r\n    modeWrapper = BB.el({\r\n        content: LANG('bucket-sample') + '&nbsp;',\r\n        title: LANG('bucket-sample-title'),\r\n        css: {\r\n            fontSize: '15px'\r\n        }\r\n    });\r\n    modeSelect = new Select({\r\n        optionArr: [\r\n            ['all', LANG('bucket-sample-all')],\r\n            ['current', LANG('bucket-sample-active')],\r\n            ['above', LANG('bucket-sample-above')]\r\n        ],\r\n        initValue: 'all',\r\n        onChange: function(val) {}\r\n    });\r\n    let modePointerListener = new BB.PointerListener({\r\n        target: modeSelect.getElement(),\r\n        onWheel: function(e) {\r\n            modeSelect.setDeltaValue(e.deltaY);\r\n        }\r\n    });\r\n    modeWrapper.appendChild(modeSelect.getElement());\r\n    selectRow.appendChild(modeWrapper);\r\n\r\n    let growWrapper;\r\n    let growSelect;\r\n    growWrapper = BB.el({\r\n        content: LANG('bucket-grow') + '&nbsp;',\r\n        title: LANG('bucket-grow-title'),\r\n        css: {\r\n            fontSize: '15px',\r\n            marginLeft: '10px'\r\n        }\r\n    });\r\n    growSelect = new Select({\r\n        optionArr: [\r\n            ['0', '0'],\r\n            ['1', '1'],\r\n            ['2', '2'],\r\n            ['3', '3'],\r\n            ['4', '4'],\r\n            ['5', '5'],\r\n            ['6', '6'],\r\n            ['7', '7'],\r\n        ],\r\n        initValue: '0',\r\n        onChange: function(val) {}\r\n    });\r\n    let growPointerListener = new BB.PointerListener({\r\n        target: growSelect.getElement(),\r\n        onWheel: function(e) {\r\n            growSelect.setDeltaValue(e.deltaY);\r\n        }\r\n    });\r\n    growWrapper.appendChild(growSelect.getElement());\r\n    selectRow.appendChild(growWrapper);\r\n\r\n\r\n    let isContiguous = true;\r\n    let contiguousToggle = new Checkbox({\r\n        init: true,\r\n        label: LANG('bucket-contiguous'),\r\n        title: LANG('bucket-contiguous-title'),\r\n        callback: function (b) {\r\n            isContiguous = b;\r\n        },\r\n        css: {\r\n            marginTop: '10px',\r\n            paddingRight: '5px',\r\n            display: 'inline-block',\r\n        }\r\n    });\r\n    div.appendChild(contiguousToggle.getElement());\r\n\r\n\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            colorDiv.appendChild(p.colorSlider.getElement());\r\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\r\n        }\r\n    };\r\n\r\n    this.getTolerance = function() {\r\n        return toleranceSlider.getValue();\r\n    };\r\n\r\n    this.getOpacity = function() {\r\n        return opacitySlider.getValue();\r\n    };\r\n\r\n    /**\r\n     * returns string 'current' | 'all' | 'above'\r\n     */\r\n    this.getSample = function() {\r\n        return modeSelect.getValue();\r\n    };\r\n\r\n    this.getGrow = function() {\r\n        return parseInt(growSelect.getValue(), 10);\r\n    }\r\n\r\n    this.getContiguous = function() {\r\n        return isContiguous;\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Text Tool tab contents (color slider)\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function TextUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n\r\n    let colorDiv = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginBottom: '10px'\r\n        }\r\n    });\r\n\r\n    let hint = BB.el({\r\n        parent: div,\r\n        content: LANG('text-instruction'),\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            colorDiv.appendChild(p.colorSlider.getElement());\r\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\r\n            //update();\r\n        }\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {Options} from '../base-components/options';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Shape Tool tab contents\r\n *\r\n * p = {\r\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ShapeUi(p) {\r\n    let div = BB.el({\r\n        css: {\r\n            margin: '10px'\r\n        }\r\n    });\r\n    let isVisible = true;\r\n\r\n    let colorDiv = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginBottom: '10px'\r\n        }\r\n    });\r\n\r\n    let previewSize = 35;\r\n    let previewPadding = 8;\r\n    let shape; // 'rect'|'ellipse'|'line'\r\n    let mode; // 'stroke'|'fill'\r\n\r\n\r\n    let rectStrokeSvgRect = BB.createSvg({\r\n        elementType: 'rect',\r\n        x: '' + previewPadding,\r\n        width: '' + (previewSize - previewPadding * 2)\r\n    });\r\n    let rectStrokeSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize\r\n    });\r\n    rectStrokeSvg.appendChild(rectStrokeSvgRect);\r\n    BB.css(rectStrokeSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n    let rectFilledSvgRect = BB.createSvg({\r\n        elementType: 'rect',\r\n        x: '' + previewPadding,\r\n        width: '' + (previewSize - previewPadding * 2)\r\n    });\r\n    let rectFilledSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize\r\n    });\r\n    rectFilledSvg.appendChild(rectFilledSvgRect);\r\n    BB.css(rectFilledSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n\r\n    let ellipseStrokeSvgEllipse = BB.createSvg({\r\n        elementType: 'ellipse',\r\n        cx: '' + (previewSize / 2),\r\n        cy: '' + (previewSize / 2),\r\n        rx: '' + (previewSize / 2 - previewPadding)\r\n    });\r\n    let ellipseStrokeSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize,\r\n    });\r\n    ellipseStrokeSvg.appendChild(ellipseStrokeSvgEllipse);\r\n    BB.css(ellipseStrokeSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n    let ellipseFilledSvgEllipse = BB.createSvg({\r\n        elementType: 'ellipse',\r\n        cx: '' + (previewSize / 2),\r\n        cy: '' + (previewSize / 2),\r\n        rx: '' + (previewSize / 2 - previewPadding)\r\n    });\r\n    let ellipseFilledSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize,\r\n    });\r\n    ellipseFilledSvg.appendChild(ellipseFilledSvgEllipse);\r\n    BB.css(ellipseFilledSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n\r\n    let lineSvgLine = BB.createSvg({\r\n        elementType: 'line',\r\n        x1: '' + previewPadding,\r\n        x2: '' + (previewSize - previewPadding)\r\n    });\r\n    let lineSvg = BB.createSvg({\r\n        elementType: 'svg',\r\n        width: '' + previewSize,\r\n        height: '' + previewSize\r\n    });\r\n    lineSvg.appendChild(lineSvgLine);\r\n    BB.css(lineSvg, {\r\n        display: 'block'\r\n    });\r\n\r\n    function updatePreviews() {\r\n        let strokeWidth = BB.clamp(Math.round(lineWidthSlider.getValue() / 10), 1, 10) + 'px';\r\n\r\n        let squish = 1.35;\r\n\r\n        BB.css(rectStrokeSvgRect, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n        BB.css(rectFilledSvgRect, { fill: 'black', stroke: 'none' });\r\n\r\n        BB.css(ellipseStrokeSvgEllipse, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n        BB.css(ellipseFilledSvgEllipse, { fill: 'black', stroke: 'none' });\r\n\r\n        BB.css(\r\n            lineSvgLine,\r\n            { fill: 'none', stroke: 'black', strokeWidth: strokeWidth }\r\n        );\r\n\r\n        if ((fixedToggle as any).getValue()) {\r\n            rectStrokeSvgRect.setAttribute('y', '' + previewPadding);\r\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n            rectFilledSvgRect.setAttribute('y', '' + previewPadding);\r\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n\r\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n        } else {\r\n            rectStrokeSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n            rectFilledSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n\r\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n        }\r\n\r\n        if ((snapToggle as any).getValue()) {\r\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding));\r\n            lineSvgLine.setAttribute('y2', '' + previewPadding);\r\n        } else {\r\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding * squish));\r\n            lineSvgLine.setAttribute('y2', '' + (previewPadding * squish));\r\n        }\r\n    }\r\n\r\n    let row1 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'start'\r\n        }\r\n    });\r\n\r\n    let shapeOptions = new Options({\r\n        optionArr: [\r\n            {\r\n                id: 'rect-stroke',\r\n                label: rectStrokeSvg,\r\n                title: LANG('shape-rect') + ' ' + LANG('shape-stroke'),\r\n            },\r\n            {\r\n                id: 'ellipse-stroke',\r\n                label: ellipseStrokeSvg,\r\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-stroke'),\r\n            },\r\n            {\r\n                id: 'line',\r\n                label: lineSvg,\r\n                title: LANG('shape-line'),\r\n            },\r\n            {\r\n                id: 'rect-fill',\r\n                label: rectFilledSvg,\r\n                title: LANG('shape-rect') + ' ' + LANG('shape-fill'),\r\n            },\r\n            {\r\n                id: 'ellipse-fill',\r\n                label: ellipseFilledSvg,\r\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-fill'),\r\n            },\r\n        ],\r\n        initId: 'rect',\r\n        onChange: function(id) {\r\n            let split = id.split('-');\r\n            shape = split[0];\r\n            mode = split[1];\r\n\r\n            BB.css(fixedToggle.getElement(), {\r\n                display: shape === 'line' ? 'none' : null\r\n            });\r\n            BB.css(snapToggle.getElement(), {\r\n                display: shape === 'line' ? null : 'none'\r\n            });\r\n            BB.css(lineWidthSlider.getElement(), {\r\n                display: (shape !== 'line' && mode === 'fill') ? 'none' : null\r\n            });\r\n        },\r\n        changeOnInit: true\r\n    });\r\n    shapeOptions.getElement().style.width = '120px';\r\n    row1.appendChild(shapeOptions.getElement());\r\n\r\n    let eraserToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('eraser'),\r\n        callback: function(b) {\r\n            updatePreviews();\r\n        }\r\n    });\r\n    row1.appendChild(eraserToggle.getElement());\r\n\r\n    let lineWidthSlider = new KlSlider({\r\n        label: LANG('shape-line-width'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 1,\r\n        max: 200,\r\n        initValue: 4,\r\n        curve: 'quadratic',\r\n        onChange: function (val) {\r\n            updatePreviews();\r\n        },\r\n        formatFunc: function (v) {\r\n            return Math.round(v);\r\n        }\r\n    });\r\n    BB.css(lineWidthSlider.getElement(), {\r\n        marginTop: '10px'\r\n    });\r\n    div.appendChild(lineWidthSlider.getElement());\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 250,\r\n        height: 30,\r\n        min: 0,\r\n        max: 1,\r\n        initValue: 1,\r\n        onChange: function (val) {\r\n        },\r\n        formatFunc: function (v) {\r\n            return Math.round(v * 100);\r\n        }\r\n    });\r\n    BB.css(opacitySlider.getElement(), {\r\n        marginTop: '10px'\r\n    });\r\n    div.appendChild(opacitySlider.getElement());\r\n\r\n    let row2 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n\r\n    let outwardsToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('shape-outwards'),\r\n        callback: function(b) {},\r\n        css: {\r\n            width: '50%',\r\n            marginRight: '10px',\r\n        }\r\n    });\r\n    row2.appendChild(outwardsToggle.getElement());\r\n\r\n    let fixedToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('shape-fixed'),\r\n        callback: function(b) {\r\n            updatePreviews();\r\n        },\r\n        css: {\r\n            flexGrow: '1',\r\n        }\r\n    });\r\n    row2.appendChild(fixedToggle.getElement());\r\n\r\n    let snapToggle = new Checkbox({\r\n        init: false,\r\n        label: LANG('shape-snap'),\r\n        title: LANG('shape-snap-title'),\r\n        callback: function(b) {\r\n            updatePreviews();\r\n        },\r\n        css: {\r\n            flexGrow: '1',\r\n        }\r\n    });\r\n    row2.appendChild(snapToggle.getElement());\r\n\r\n\r\n\r\n    updatePreviews();\r\n\r\n    // --- interface ---\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.setIsVisible = function(pIsVisible) {\r\n        isVisible = !!pIsVisible;\r\n        div.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            colorDiv.appendChild(p.colorSlider.getElement());\r\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\r\n            //update();\r\n        }\r\n    };\r\n\r\n    this.getShape = function() {\r\n        return shape;\r\n    };\r\n\r\n    this.getMode = function() {\r\n        return mode;\r\n    };\r\n\r\n    this.getIsEraser = function() {\r\n        return (eraserToggle as any).getValue();\r\n    };\r\n\r\n    this.getOpacity = function() {\r\n        return opacitySlider.getValue();\r\n    };\r\n\r\n    this.getLineWidth = function() {\r\n        return lineWidthSlider.getValue();\r\n    };\r\n\r\n    this.getIsOutwards = function() {\r\n        return (outwardsToggle as any).getValue();\r\n    };\r\n\r\n    this.getIsFixed = function() {\r\n        return (fixedToggle as any).getValue();\r\n    };\r\n\r\n    this.getIsSnap = function() {\r\n        return (snapToggle as any).getValue();\r\n    };\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../base-components/select';\r\nimport {ColorOptions} from '../base-components/color-options';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * P = {\r\n *     currentColor: RGB, // current color\r\n *     secondaryColor: RGB,\r\n *     maxCanvasSize: number,\r\n *     canvasWidth: number, // current canvas size\r\n *     canvasHeight: number, // current canvas size\r\n *     workspaceWidth: number,\r\n *     workspaceHeight: number,\r\n *     onConfirm: function(width number, height number, color RGBA),\r\n *     onCancel: function()\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function newImageDialog(p) {\r\n\r\n    let currentColor = p.currentColor;\r\n    let secondaryColor = p.secondaryColor;\r\n    let maxCanvasSize = p.maxCanvasSize;\r\n    let canvasWidth = p.canvasWidth;\r\n    let canvasHeight = p.canvasHeight;\r\n    let workspaceWidth = p.workspaceWidth;\r\n    let workspaceHeight = p.workspaceHeight;\r\n    let onConfirm = p.onConfirm;\r\n    let onCancel = p.onCancel;\r\n\r\n\r\n    function createRatioSize(ratioX, ratioY, width, height, padding) {\r\n        return BB.fitInto(ratioX, ratioY, Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding), 1);\r\n    }\r\n\r\n    let newImDiv = document.createElement(\"div\");\r\n    let widthWrapper = document.createElement(\"div\");\r\n    let heightWrapper = document.createElement(\"div\");\r\n    let widthInput = document.createElement(\"input\");\r\n    let widthUnit = document.createElement(\"div\");\r\n    let heightInput = document.createElement(\"input\");\r\n    let heightUnit = document.createElement(\"div\");\r\n    widthWrapper.style.position = \"relative\";\r\n    widthWrapper.style.width = \"145px\";\r\n    widthWrapper.style.height = \"35px\";\r\n    widthWrapper.style.lineHeight = \"30px\";\r\n    heightWrapper.style.width = \"145px\";\r\n    heightWrapper.style.height = \"35px\";\r\n    heightWrapper.style.lineHeight = \"30px\";\r\n\r\n    widthUnit.innerText = LANG('new-px');\r\n    widthUnit.style.color = '#888';\r\n    widthUnit.style.fontSize = \"12px\";\r\n    widthUnit.style.marginLeft = \"5px\";\r\n    widthUnit.style.cssFloat = \"right\";\r\n\r\n    heightUnit.innerText = LANG('new-px');\r\n    heightUnit.style.color = '#888';\r\n    heightUnit.style.fontSize = \"12px\";\r\n    heightUnit.style.marginLeft = \"5px\";\r\n    heightUnit.style.cssFloat = \"right\";\r\n\r\n    widthInput.setAttribute('data-ignore-focus', 'true');\r\n    heightInput.setAttribute('data-ignore-focus', 'true');\r\n\r\n    widthInput.type = 'number';\r\n    widthInput.min = '1';\r\n    widthInput.max = maxCanvasSize;\r\n    widthInput.style.cssFloat = \"right\";\r\n    widthInput.style.width = \"70px\";\r\n\r\n    heightInput.type = 'number';\r\n    heightInput.min = '1';\r\n    heightInput.max = maxCanvasSize;\r\n    heightInput.style.cssFloat = \"right\";\r\n    heightInput.style.width = \"70px\";\r\n    widthInput.value = canvasWidth;\r\n    heightInput.value = canvasHeight;\r\n    widthInput.onclick = function () {\r\n        (this as any).focus();\r\n        updateRatio();\r\n    };\r\n    heightInput.onclick = function () {\r\n        (this as any).focus();\r\n        updateRatio();\r\n    };\r\n    widthWrapper.appendChild(widthUnit);\r\n    widthWrapper.appendChild(widthInput);\r\n    BB.appendTextDiv(widthWrapper, LANG('width') + \": \");\r\n    heightWrapper.appendChild(heightUnit);\r\n    heightWrapper.appendChild(heightInput);\r\n    BB.appendTextDiv(heightWrapper, LANG('height') + \": \");\r\n    let ratioWrapper = document.createElement(\"div\");\r\n    ratioWrapper.style.marginTop = '5px';\r\n    ratioWrapper.style.color = '#888';\r\n\r\n    let templateWrapper = document.createElement(\"div\");\r\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\r\n    let presetFitBtn = document.createElement(\"button\");\r\n    templateWrapper.style.marginBottom = \"10px\";\r\n    let presetCurrentBtn = document.createElement(\"button\");\r\n    let presetSquareBtn = document.createElement(\"button\");\r\n    let presetLandscapeBtn = document.createElement(\"button\");\r\n    let presetPortraitBtn = document.createElement(\"button\");\r\n    let presetOversizeBtn = document.createElement(\"button\");\r\n\r\n    presetCurrentBtn.textContent = LANG('new-current');\r\n    presetFitBtn.textContent = LANG('new-fit');\r\n    presetOversizeBtn.textContent = LANG('new-oversize');\r\n    presetLandscapeBtn.textContent = LANG('new-landscape');\r\n    presetPortraitBtn.textContent = LANG('new-portrait');\r\n    presetSquareBtn.textContent = LANG('new-square');\r\n\r\n    presetCurrentBtn.style.marginRight = \"5px\";\r\n    presetFitBtn.style.marginRight = \"5px\";\r\n    presetOversizeBtn.style.marginRight = \"5px\";\r\n    presetLandscapeBtn.style.marginTop = \"5px\";\r\n    presetLandscapeBtn.style.marginRight = \"5px\";\r\n    presetPortraitBtn.style.marginTop = \"5px\";\r\n    presetPortraitBtn.style.marginRight = \"5px\";\r\n\r\n    templateWrapper.appendChild(presetCurrentBtn);\r\n    templateWrapper.appendChild(presetFitBtn);\r\n    templateWrapper.appendChild(presetOversizeBtn);\r\n    templateWrapper.appendChild(presetSquareBtn);\r\n    templateWrapper.appendChild(presetLandscapeBtn);\r\n    templateWrapper.appendChild(presetPortraitBtn);\r\n\r\n    let templatePadding = 50;\r\n\r\n    presetCurrentBtn.onclick = function () {\r\n        widthInput.value = canvasWidth;\r\n        heightInput.value = canvasHeight;\r\n        updateRatio();\r\n    };\r\n    presetFitBtn.onclick = function () {\r\n        widthInput.value = workspaceWidth;\r\n        heightInput.value = workspaceHeight;\r\n        updateRatio();\r\n    };\r\n    presetOversizeBtn.onclick = function () {\r\n        widthInput.value = workspaceWidth + 500;\r\n        heightInput.value = workspaceHeight + 500;\r\n        updateRatio();\r\n    };\r\n    presetSquareBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetLandscapeBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetPortraitBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n\r\n    let select = new Select({\r\n        isFocusable: true,\r\n        optionArr: [\r\n            ['screen', LANG('new-screen')],\r\n            ['16 9', LANG('new-video') + ' 16:9'],\r\n            ['3 2', '3:2'],\r\n            ['5 3', '5:3'],\r\n            ['2 1', '2:1'],\r\n            ['paper', LANG('new-din-paper') + ' 2:1'],\r\n            ['9 16', '9:16'],\r\n            ['2 3', '2:3'],\r\n            ['3 5', '3:5'],\r\n            ['1 2', '1:2'],\r\n            ['1 1.4142135623730951', '1:2']\r\n        ],\r\n        onChange: function(val) {\r\n            if (val === 'screen') {\r\n                widthInput.value = '' + window.screen.width;\r\n                heightInput.value = '' + window.screen.height;\r\n            } else if (val === 'paper') {\r\n                let sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            } else {\r\n                let split = val.split(' ');\r\n                let sizeObj = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            }\r\n            updateRatio();\r\n            select.setValue(null);\r\n        }\r\n    });\r\n    setTimeout(() => {\r\n        // safari: not empty without also setting it to null via timeout\r\n        select.setValue(null);\r\n    }, 0);\r\n    BB.css(select.getElement(), {\r\n        width: '80px',\r\n    });\r\n    templateWrapper.appendChild(select.getElement());\r\n\r\n\r\n\r\n    let backgroundRGBA = {r: 255, g: 255, b: 255, a: 1};\r\n\r\n    let colorOptionsArr = [\r\n        {r: 255, g: 255, b: 255, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 0}\r\n    ];\r\n    colorOptionsArr.push({\r\n        r: currentColor.r,\r\n        g: currentColor.g,\r\n        b: currentColor.b,\r\n        a: 1\r\n    });\r\n    colorOptionsArr.push({\r\n        r: secondaryColor.r,\r\n        g: secondaryColor.g,\r\n        b: secondaryColor.b,\r\n        a: 1\r\n    });\r\n\r\n    let colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        onChange: function(rgbaObj) {\r\n            backgroundRGBA = rgbaObj;\r\n            preview.style.backgroundColor = \"rgba(\" + rgbaObj.r + \",\" + rgbaObj.g + \",\" + rgbaObj.b + \", \" + rgbaObj.a + \")\";\r\n        }\r\n    });\r\n\r\n    let previewWrapper = document.createElement(\"div\");\r\n    BB.css(previewWrapper, {\r\n        boxSizing: 'border-box',\r\n        width: '340px',\r\n        height: '140px',\r\n        display: 'table',\r\n        backgroundColor: '#9e9e9e',\r\n        padding: '10px',\r\n        marginTop: '10px',\r\n        boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\r\n        marginLeft: '-20px',\r\n        colorScheme: 'only light',\r\n    });\r\n    let preview = document.createElement(\"div\");\r\n    BB.css(preview, {\r\n        width: 200 + \"px\",\r\n        height: 100 + \"px\",\r\n        backgroundColor: \"#fff\",\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n        color: \"#aaa\",\r\n        fontSize: \"16px\",\r\n        fontWeight: \"bold\",\r\n        textAlign: \"center\",\r\n        verticalAlign: \"center\",\r\n        display: \"table\",\r\n        overflow: \"hidden\",\r\n        boxShadow: \"0px 0px 3px rgba(0,0,0,0.5)\"\r\n    });\r\n    let previewcell = document.createElement(\"div\");\r\n    previewcell.style.display = \"table-cell\";\r\n    previewcell.style.verticalAlign = \"middle\";\r\n    previewcell.appendChild(preview);\r\n    previewWrapper.appendChild(previewcell);\r\n    let cell = BB.appendTextDiv(preview, \"\");\r\n    //let ratio = BB.appendTextDiv(cell, \"1:2\");\r\n    cell.style.display = \"table-cell\";\r\n    cell.style.verticalAlign = \"middle\";\r\n    let prevW = parseInt(widthInput.value);\r\n    let prevH = parseInt(heightInput.value);\r\n\r\n    function updateRatio() {\r\n        widthInput.value = '' + Math.min(maxCanvasSize, parseInt(widthInput.value));\r\n        heightInput.value = '' + Math.min(maxCanvasSize, parseInt(heightInput.value));\r\n\r\n        function HCF(u, v) {\r\n            let U = u, V = v;\r\n            while (true) {\r\n                if (!(U %= V))\r\n                    return V;\r\n                if (!(V %= U))\r\n                    return U;\r\n            }\r\n        }\r\n\r\n        let w = parseInt(widthInput.value);\r\n        let h = parseInt(heightInput.value);\r\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\r\n            if (w > maxCanvasSize)\r\n                w = maxCanvasSize;\r\n            else if (h > maxCanvasSize)\r\n                h = maxCanvasSize;\r\n\r\n            widthInput.value = '' + w;\r\n            heightInput.value = '' + h;\r\n        }\r\n\r\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\r\n        let commonRatios = [\r\n            [1, 2], [2, 1],\r\n            [2, 3], [3, 2],\r\n            [3, 4], [4, 3],\r\n            [4, 5], [5, 4],\r\n            [16, 9], [9, 16],\r\n            [3, 2], [2, 3],\r\n            [5, 3], [3, 5],\r\n            [2, 1], [1, 2],\r\n            [1.414, 1], [1, 1.414],\r\n        ];\r\n        let reducedArr = BB.reduce(w, h);\r\n        let closestRatio = null;\r\n        let closestDistance = null;\r\n        for (let i = 0; i < commonRatios.length; i++) {\r\n            if (i === 0 || Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\r\n                closestRatio = commonRatios[i];\r\n                closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\r\n            }\r\n        }\r\n        //display ratio\r\n        if (closestDistance > 0 && closestDistance < 0.005) {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ~' + closestRatio[0] + ':' + closestRatio[1];\r\n        } else {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ' + reducedArr[0] + ':' + reducedArr[1];\r\n        }\r\n\r\n        prevW = w;\r\n        prevH = h;\r\n        let realw = w;\r\n        let T = HCF(w, h);\r\n        w /= T;\r\n        h /= T;\r\n        w *= 260;\r\n        h *= 260;\r\n        if (w > 260) {\r\n            h = 260 / w * h;\r\n            w = 260;\r\n        }\r\n        if (h > 100) {\r\n            w = 100 / h * w;\r\n            h = 100;\r\n\r\n        }\r\n\r\n        preview.style.width = w + \"px\";\r\n        preview.style.height = h + \"px\";\r\n        BB.createCheckerDataUrl(parseInt('' + (30 * (w / realw))), function (url) {\r\n            previewWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n    }\r\n\r\n    widthInput.onchange = function () {\r\n        if (widthInput.value === '' || parseInt(widthInput.value) < 0) {\r\n            widthInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    widthInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    heightInput.onchange = function () {\r\n        if (heightInput.value === '' || parseFloat(heightInput.value) < 0) {\r\n            heightInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    heightInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    updateRatio();\r\n\r\n    newImDiv.appendChild(templateWrapper);\r\n    let secondRow = BB.el({\r\n        parent: newImDiv,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'flex-end'\r\n        }\r\n    });\r\n    let secondRowLeft = BB.el({\r\n        parent: secondRow\r\n    });\r\n    secondRowLeft.appendChild(widthWrapper);\r\n    secondRowLeft.appendChild(heightWrapper);\r\n    secondRowLeft.appendChild(ratioWrapper);\r\n    secondRow.appendChild(colorOptions.getElement());\r\n\r\n    newImDiv.appendChild(previewWrapper);\r\n\r\n    popup({\r\n        target: document.body,\r\n        message: `<b>${LANG('new-title')}</b>`,\r\n        div: newImDiv,\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (result) {\r\n            widthInput.onclick = null;\r\n            heightInput.onclick = null;\r\n            presetCurrentBtn.onclick = null;\r\n            presetFitBtn.onclick = null;\r\n            presetOversizeBtn.onclick = null;\r\n            presetSquareBtn.onclick = null;\r\n            presetLandscapeBtn.onclick = null;\r\n            presetPortraitBtn.onclick = null;\r\n            widthInput.onchange = null;\r\n            widthInput.onkeyup = null;\r\n            heightInput.onchange = null;\r\n            heightInput.onkeyup = null;\r\n            select.destroy();\r\n            colorOptions.destroy();\r\n\r\n            if (result === \"Cancel\" || parseInt(widthInput.value) <= 0 || parseInt(heightInput.value) <= 0 || isNaN(parseInt(widthInput.value)) || isNaN(parseInt(heightInput.value))) {\r\n                onCancel();\r\n                return;\r\n            }\r\n            onConfirm(parseInt(widthInput.value), parseInt(heightInput.value), backgroundRGBA);\r\n        },\r\n        clickOnEnter: 'Ok'\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport collapseImg from 'url:~/src/app/img/ui/ui-collapse.svg';\r\nimport {LANG} from \"../../../language/language\";\r\n\r\n/**\r\n * button that allows to collapse toolspace (for mobile)\r\n *\r\n * p = {\r\n *     onChange: function()\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceCollapser(p) {\r\n    let isOpen = true;\r\n    let directionStr = 'right'; // 'left' | 'right'\r\n\r\n    function update() {\r\n        if (directionStr === 'left') {\r\n            icon.style.transform = isOpen ? 'rotate(180deg)' : '';\r\n        } else {\r\n            icon.style.transform = isOpen ? '' : 'rotate(180deg)';\r\n        }\r\n    }\r\n\r\n    let div = BB.el({\r\n        css: {\r\n            width: '36px',\r\n            height: '36px',\r\n            background: 'rgba(100, 100, 100, 0.9)',\r\n            color: '#fff',\r\n            position: 'absolute',\r\n            top: '0',\r\n            textAlign: 'center',\r\n            lineHeight: '36px',\r\n            cursor: 'pointer',\r\n            userSelect: 'none',\r\n            padding: '6px',\r\n            boxSizing: 'border-box'\r\n        },\r\n        title: LANG('toggle-show-tools'),\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            isOpen = !isOpen;\r\n            update();\r\n            p.onChange();\r\n        }\r\n    });\r\n\r\n    let icon = BB.el({\r\n        parent: div,\r\n        css: {\r\n            backgroundImage: `url(${collapseImg})`,\r\n            width: '100%',\r\n            height: '100%',\r\n            backgroundSize: 'contain',\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            userSelect: 'none'\r\n        }\r\n    });\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    // --- interface ---\r\n    this.isOpen = function() {\r\n        return isOpen;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param dirStr\r\n     */\r\n    this.setDirection = function(dirStr) {\r\n        directionStr = dirStr;\r\n        update();\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"b1UMP\");","import {BB} from '../../../bb/bb';\r\nimport {renderText} from '../../image-operations/render-text';\r\nimport {ColorOptions} from '../base-components/color-options';\r\nimport {Select} from '../base-components/select';\r\nimport {ImageRadioList} from '../base-components/image-radio-list';\r\nimport {ImageToggle} from '../base-components/image-toggle';\r\nimport {KlSlider} from '../base-components/kl-slider';\r\nimport {popup} from './popup';\r\n// @ts-ignore\r\nimport alignLeftImg from 'url:~/src/app/img/ui/align-left.svg';\r\n// @ts-ignore\r\nimport alignCenterImg from 'url:~/src/app/img/ui/align-center.svg';\r\n// @ts-ignore\r\nimport alignRightImg from 'url:~/src/app/img/ui/align-right.svg';\r\n// @ts-ignore\r\nimport typoItalicImg from 'url:~/src/app/img/ui/typo-italic.svg';\r\n// @ts-ignore\r\nimport typoBoldImg from 'url:~/src/app/img/ui/typo-bold.svg';\r\n// @ts-ignore\r\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\r\n// @ts-ignore\r\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\r\nimport {IRGB} from '../../kl.types';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Text Tool dialog\r\n *\r\n * confirmP = {\r\n *     x: number,\r\n *     y: number,\r\n *     textStr: string,\r\n *     align: 'left' | 'center' | 'right',\r\n *     isItalic: boolean,\r\n *     isBold: boolean,\r\n *     color: rgb,\r\n *     size: number, // px\r\n *     font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy',\r\n *     opacity: number, // 0 - 1\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function textToolDialog(\r\n    p: {\r\n        klCanvas: KlCanvas;\r\n        layerIndex: number;\r\n        x: number;\r\n        y: number;\r\n        angleRad: number;\r\n        color: IRGB;\r\n        secondaryColor: IRGB;\r\n        size: number; // px\r\n        align: 'left' | 'center' | 'right'; // default 'left'\r\n        isBold: boolean; // default false\r\n        isItalic: boolean; // default false\r\n        font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\r\n        opacity: number; // 0 - 1; default 1\r\n        onConfirm: (confirmP) => void;\r\n    }\r\n) {\r\n\r\n    let div = BB.el({});\r\n\r\n    let isSmallWidth = window.innerWidth < 550;\r\n    let isSmallHeight = window.innerHeight < 630;\r\n\r\n    // --- preview ---\r\n    // Text drawn on klCanvas-sized canvas: textCanvas\r\n    // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\r\n    //      they are transformed. canvas size of final preview\r\n    // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\r\n    // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\r\n\r\n    let width = isSmallWidth ? 340 : 540;\r\n    let height = isSmallWidth ? (isSmallHeight ? 210 : 260) : (isSmallHeight ? 230 : 350);\r\n    let scale = 1;\r\n\r\n    let layerArr = p.klCanvas.getLayersFast();\r\n    let textCanvas = BB.canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\r\n    let textCtx = textCanvas.getContext('2d');\r\n    let targetCanvas = BB.canvas(width, height);\r\n    let targetCtx = targetCanvas.getContext('2d');\r\n    let layersCanvas = BB.canvas(width, height);\r\n    let layersCtx = layersCanvas.getContext('2d');\r\n    let previewCanvas = BB.canvas(width, height); // the one that is visible\r\n    let previewCtx = previewCanvas.getContext('2d');\r\n    BB.css(previewCanvas, {\r\n        display: 'block'\r\n    });\r\n    let previewWrapper = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'relative',\r\n            width: width + 'px',\r\n            marginLeft: '-20px',\r\n            cursor: 'move',\r\n            colorScheme: 'only light',\r\n            touchAction: 'none',\r\n        },\r\n        onClick: function() {\r\n            textInput.focus();\r\n        }\r\n    });\r\n    BB.el({ // inset shadow on preview\r\n        parent: previewWrapper,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n    previewWrapper.appendChild(previewCanvas);\r\n    let checkerPattern = previewCtx.createPattern(BB.createCheckerCanvas(8), 'repeat');\r\n    let emptyCanvas = BB.canvas(1, 1);\r\n    {\r\n        let ctx = emptyCanvas.getContext('2d');\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    }\r\n\r\n    function updatePreview() {\r\n\r\n        // try to draw very much like klCanvasWorkspace\r\n\r\n        // --- draw text ---\r\n        textCtx.clearRect(0, 0, textCanvas.width, textCanvas.height);\r\n        let colorRGBA = {\r\n            ...p.color,\r\n            a: opacitySlider.getValue(),\r\n        };\r\n        let bounds = renderText(textCanvas, {\r\n            x: p.x,\r\n            y: p.y,\r\n            textStr: textInput.value,\r\n            align: alignRadioList.getValue(),\r\n            isItalic: italicToggle.getValue(),\r\n            isBold: boldToggle.getValue(),\r\n            size: parseFloat(sizeInput.value),\r\n            font: fontSelect.getValue(),\r\n            color: BB.ColorConverter.toRgbaStr(colorRGBA),\r\n            angleRad: p.angleRad\r\n        });\r\n\r\n\r\n        // --- determine transformation of viewport ---\r\n        // text should always be visible\r\n        bounds.width = Math.max(bounds.width, 1);\r\n        bounds.height = Math.max(bounds.height, 1);\r\n        let rotatedXY = BB.rotate(bounds.x, bounds.y, -p.angleRad / Math.PI * 180);\r\n        let rotatedWH = BB.rotate(bounds.width, bounds.height, -p.angleRad / Math.PI * 180);\r\n        let centerX = p.x + rotatedXY.x + rotatedWH.x / 2;\r\n        let centerY = p.y + rotatedXY.y + rotatedWH.y / 2;\r\n\r\n        let padding = 100;\r\n        let fitBounds = BB.fitInto(bounds.width, bounds.height, width - padding, height - padding);\r\n        scale = Math.min(1, fitBounds.width / bounds.width);\r\n        scale = Math.min(4, scale * Math.pow(2, zoomFac));\r\n\r\n\r\n        // --- compose text and target layer ---\r\n        targetCtx.save();\r\n\r\n        if (scale >= 4) {\r\n            targetCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            targetCtx.imageSmoothingEnabled = true;\r\n            targetCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n        }\r\n\r\n        targetCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        targetCtx.translate(width / 2, height / 2);\r\n        targetCtx.scale(scale, scale);\r\n        targetCtx.rotate(p.angleRad);\r\n        targetCtx.drawImage(layerArr[p.layerIndex].canvas, -centerX, -centerY);\r\n        targetCtx.drawImage(textCanvas, -centerX, -centerY);\r\n        targetCtx.restore();\r\n\r\n\r\n        // --- layers ---\r\n        layersCtx.save();\r\n\r\n        layersCtx.fillStyle = 'rgb(158,158,158)';\r\n        layersCtx.fillRect(0, 0, width, height);\r\n\r\n        { // bg\r\n            layersCtx.save();\r\n\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n\r\n            layersCtx.imageSmoothingEnabled = false;\r\n\r\n            //outline\r\n            let borderSize = 1 / scale;\r\n            layersCtx.globalAlpha = 0.2;\r\n            layersCtx.drawImage(emptyCanvas, -centerX - borderSize, -centerY - borderSize, textCanvas.width + borderSize * 2, textCanvas.height + borderSize * 2);\r\n            layersCtx.globalAlpha = 1;\r\n\r\n            //erase\r\n            layersCtx.globalCompositeOperation = 'destination-out';\r\n            layersCtx.drawImage(emptyCanvas, -centerX, -centerY, textCanvas.width, textCanvas.height);\r\n\r\n            layersCtx.restore();\r\n        }\r\n\r\n        { // individual layers\r\n\r\n            if (scale >= 4) {\r\n                layersCtx.imageSmoothingEnabled = false;\r\n            } else {\r\n                layersCtx.imageSmoothingEnabled = true;\r\n                layersCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n            }\r\n\r\n            // layers below\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (var i = 0; i < p.layerIndex; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n            // target layer\r\n            layersCtx.globalAlpha = layerArr[p.layerIndex].opacity;\r\n            layersCtx.globalCompositeOperation = layerArr[p.layerIndex].mixModeStr;\r\n            layersCtx.drawImage(targetCanvas, 0, 0);\r\n\r\n            // layers above\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (let i = p.layerIndex + 1; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n        }\r\n\r\n        layersCtx.restore();\r\n\r\n\r\n\r\n        // --- final composite ---\r\n        previewCtx.save();\r\n        previewCtx.fillStyle = checkerPattern;\r\n        previewCtx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        previewCtx.drawImage(layersCanvas, 0, 0);\r\n        previewCtx.restore();\r\n\r\n        // bounds\r\n        previewCtx.save();\r\n        previewCtx.globalCompositeOperation = 'difference';\r\n        previewCtx.strokeStyle = '#fff';\r\n        previewCtx.lineWidth = 1;\r\n        // centerX = p.x + bounds.x + bounds.width / 2;\r\n        // centerY = p.y + bounds.y + bounds.height / 2;\r\n        previewCtx.strokeRect(\r\n            Math.round(width / 2 - (bounds.width / 2) * scale),\r\n            Math.round(height / 2 - (bounds.height / 2) * scale),\r\n            Math.round(bounds.width * scale),\r\n            Math.round(bounds.height * scale)\r\n        );\r\n        previewCtx.restore();\r\n\r\n    }\r\n\r\n    function move(x, y) {\r\n        let rotated = BB.rotate(x, y, -p.angleRad / Math.PI * 180);\r\n        p.x += rotated.x / scale;\r\n        p.y += rotated.y / scale;\r\n        updatePreview();\r\n    }\r\n\r\n    let previewPointerListener = new BB.PointerListener({\r\n        target: previewCanvas,\r\n        pointers: 1,\r\n        onPointer: function(e) {\r\n            if (e.type === 'pointermove' && e.button) {\r\n                e.eventPreventDefault();\r\n                move(-e.dX, -e.dY);\r\n            }\r\n        },\r\n        onWheel: function(e) {\r\n            changeZoomFac(-e.deltaY);\r\n        }\r\n    });\r\n\r\n    const wheelPrevent = (event) => {\r\n        event.preventDefault();\r\n    }\r\n    BB.addEventListener(previewCanvas, 'wheel', wheelPrevent);\r\n\r\n\r\n\r\n    let row1 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n    let row2n3Wrapper = BB.el({\r\n        parent: div,\r\n        css: isSmallWidth ? {} : {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between'\r\n        }\r\n    });\r\n    let row2 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginTop: '5px'\r\n        }\r\n    });\r\n    let row3 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n            marginTop: '5px',\r\n            width: isSmallWidth ? '' : '300px'\r\n        }\r\n    });\r\n\r\n    // --- row 1 ---\r\n\r\n    // color\r\n    let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n    let colorOptionsArr = [\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 255, g: 255, b: 255, a: 1}\r\n    ];\r\n    colorOptionsArr.unshift({\r\n        r: p.secondaryColor.r,\r\n        g: p.secondaryColor.g,\r\n        b: p.secondaryColor.b,\r\n        a: 1,\r\n    });\r\n    colorOptionsArr.unshift({\r\n        r: p.color.r,\r\n        g: p.color.g,\r\n        b: p.color.b,\r\n        a: 1,\r\n    });\r\n\r\n    let colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        initialIndex: 0,\r\n        onChange: function(rgbaObj) {\r\n            p.color = rgbaObj;\r\n            updatePreview();\r\n        }\r\n    });\r\n    colorOptions.getElement().title = LANG('text-color');\r\n    colorOptions.getElement().style.marginLeft = '-5px';\r\n    row1.appendChild(colorOptions.getElement());\r\n\r\n\r\n    let zoomFac = 0;\r\n    function changeZoomFac(d) {\r\n        zoomFac = Math.min(2, Math.max(-2, zoomFac + d));\r\n        updatePreview();\r\n        zoomInBtn.disabled = !canZoom(1);\r\n        zoomOutBtn.disabled = !canZoom(-1);\r\n    }\r\n    function canZoom(d) {\r\n        return zoomFac !== Math.min(2, Math.max(-2, zoomFac + d));\r\n    }\r\n\r\n    let zoomWrapper = BB.el({\r\n        parent: row1,\r\n        css: {\r\n\r\n        }\r\n    })\r\n\r\n    let zoomInBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomInImg}\">`,\r\n        title: LANG('zoom-in'),\r\n        tagName: 'button',\r\n        onClick: function() {\r\n            changeZoomFac(1);\r\n        },\r\n        css: {\r\n            fontWeight: 'bold'\r\n        }\r\n    }) as HTMLButtonElement;\r\n    let zoomOutBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomOutImg}\">`,\r\n        title: LANG('zoom-out'),\r\n        tagName: 'button',\r\n        onClick: function() {\r\n            changeZoomFac(-1);\r\n        },\r\n        css: {\r\n            fontWeight: 'bold',\r\n            marginLeft: '5px'\r\n        }\r\n    }) as HTMLButtonElement;\r\n\r\n\r\n\r\n    // --- row 2 ---\r\n    let sizeInput = BB.el({\r\n        parent: row2,\r\n        tagName: 'input',\r\n        title: LANG('text-size'),\r\n        custom: {\r\n            type: 'number',\r\n            min: 1,\r\n            max: 10000,\r\n            value: p.size\r\n        },\r\n        css: {\r\n            width: '60px'\r\n        },\r\n        onChange: function() {\r\n            sizeInput.value = '' + Math.max(1, Math.min(10000, parseInt(sizeInput.value)));\r\n            updatePreview();\r\n        }\r\n    }) as HTMLInputElement;\r\n    let sizePointerListener = new BB.PointerListener({\r\n        target: sizeInput,\r\n        onWheel: function(e) {\r\n            sizeInput.value = '' + Math.max(1, Math.min(1000, parseInt(sizeInput.value) - e.deltaY));\r\n            updatePreview();\r\n        }\r\n    });\r\n\r\n    let modeWrapper;\r\n    let fontSelect;\r\n    let fontPointerListener;\r\n    {\r\n        modeWrapper = BB.el({\r\n            css: {\r\n                fontSize: '15px',\r\n                marginLeft: '10px'\r\n            }\r\n        });\r\n        fontSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['sans-serif', 'Sans-serif'],\r\n                ['serif', 'Serif'],\r\n                ['monospace', 'Monospace'],\r\n                ['cursive', 'Cursive'],\r\n                ['fantasy', 'Fantasy'],\r\n            ],\r\n            initValue: p.font,\r\n            onChange: function(val) {\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        modeWrapper.appendChild(fontSelect.getElement());\r\n        row2.appendChild(modeWrapper);\r\n\r\n        fontPointerListener = new BB.PointerListener({\r\n            target: fontSelect.getElement(),\r\n            onWheel: function(e) {\r\n                fontSelect.setDeltaValue(e.deltaY);\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n    // --- row 3 ---\r\n\r\n    let alignRadioList = new ImageRadioList({\r\n        optionArr: [\r\n            {\r\n                id: 'left',\r\n                title: LANG('text-left'),\r\n                image: alignLeftImg,\r\n            },\r\n            {\r\n                id: 'center',\r\n                title: LANG('text-center'),\r\n                image: alignCenterImg,\r\n            },\r\n            {\r\n                id: 'right',\r\n                title: LANG('text-right'),\r\n                image: alignRightImg,\r\n            }\r\n        ],\r\n        initId: p.align,\r\n        onChange: function(id) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(alignRadioList.getElement());\r\n\r\n    let italicToggle = new ImageToggle({\r\n        image: typoItalicImg,\r\n        title: LANG('text-italic'),\r\n        initValue: p.isItalic,\r\n        onChange: function(b) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(italicToggle.getElement());\r\n\r\n    let boldToggle = new ImageToggle({\r\n        image: typoBoldImg,\r\n        title: LANG('text-bold'),\r\n        initValue: p.isBold,\r\n        onChange: function(b) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(boldToggle.getElement());\r\n\r\n\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 150,\r\n        height: 30,\r\n        min: 0,\r\n        max: 1,\r\n        initValue: p.opacity,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        onChange: function(v) {\r\n            updatePreview();\r\n        },\r\n        formatFunc: function(v) {\r\n            return Math.round(v * 100);\r\n        }\r\n    });\r\n    row3.appendChild(opacitySlider.getElement());\r\n\r\n\r\n\r\n    let textInput = BB.el({\r\n        parent: div,\r\n        tagName: 'textarea',\r\n        custom: {\r\n            placeholder: LANG('text-placeholder'),\r\n            'data-ignore-focus': 'true',\r\n        },\r\n        css: {\r\n            whiteSpace: 'nowrap',\r\n            overflow: 'auto',\r\n            width: '100%',\r\n            height: '70px',\r\n            resize: 'vertical',\r\n            marginTop: '10px'\r\n        },\r\n        onChange: function() {\r\n            updatePreview();\r\n        }\r\n    }) as HTMLTextAreaElement;\r\n    textInput.addEventListener('input', updatePreview);\r\n    setTimeout(function() {\r\n        textInput.focus();\r\n        textInput.select();\r\n    });\r\n    let closefunc;\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr, e, comboStr) {\r\n            if (BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    // prevent mobile keyboards scrolling page\r\n    function onScroll() {\r\n        window.scrollTo(0, 0);\r\n    }\r\n    window.addEventListener('scroll', onScroll);\r\n\r\n\r\n    popup({\r\n        target: document.body,\r\n        message: `<b>${LANG('text-title')}</b>`,\r\n        div: div,\r\n        buttons: [\"Ok\", \"Cancel\"],\r\n        style: isSmallWidth ? {} : {\r\n            width: '500px'\r\n        },\r\n        callback: function(val) {\r\n            let result = {\r\n                x: p.x,\r\n                y: p.y,\r\n                textStr: textInput.value,\r\n                align: alignRadioList.getValue(),\r\n                isItalic: italicToggle.getValue(),\r\n                isBold: boldToggle.getValue(),\r\n                color: p.color,\r\n                size: sizeInput.value,\r\n                font: fontSelect.getValue(),\r\n                opacity: opacitySlider.getValue()\r\n            };\r\n\r\n            window.removeEventListener('scroll', onScroll);\r\n            textInput.removeEventListener('input', updatePreview);\r\n            BB.destroyEl(textInput);\r\n            previewPointerListener.destroy();\r\n            sizePointerListener.destroy();\r\n            fontPointerListener.destroy();\r\n            BB.removeEventListener(previewCanvas, 'wheel', wheelPrevent);\r\n            BB.destroyEl(previewWrapper);\r\n            BB.destroyEl(zoomInBtn);\r\n            BB.destroyEl(zoomOutBtn);\r\n            BB.destroyEl(sizeInput);\r\n            colorOptions.destroy();\r\n            fontSelect.destroy();\r\n            keyListener.destroy();\r\n            alignRadioList.destroy();\r\n            italicToggle.destroy();\r\n            boldToggle.destroy();\r\n            opacitySlider.destroy();\r\n            if (val === 'Ok') {\r\n                p.onConfirm(result);\r\n            }\r\n        },\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        ignoreBackground: true,\r\n        closefunc: function (func) {\r\n            closefunc = func;\r\n        },\r\n    });\r\n\r\n    updatePreview();\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"lvwQ5\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"imAvm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dC0sF\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h3hPo\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1pAeY\");","import {BB} from '../../../bb/bb';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {Checkbox} from '../base-components/checkbox';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n *\r\n * p = {\r\n *     image: convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas},\r\n *     maxSize: number,\r\n *     target: htmlElement,\r\n *     callback: func(\r\n *         {\r\n *             type: 'as-image',\r\n *             image: image | canvas,\r\n *         } | {\r\n *             type: 'as-image-psd',\r\n *             image: convertedPsd,\r\n *             cropObj: {x: number, y: number, width: number, height: number}\r\n *         } | {\r\n *             type: 'as-layer',\r\n *             image: image | canvas,\r\n *         } | {\r\n *             type: 'cancel',\r\n *         }\r\n *     )\r\n * }\r\n *\r\n * @param p {}\r\n */\r\nexport function showImportImageDialog(p) {\r\n    const div = BB.el({});\r\n\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n    const style = isSmall ? {} : { width: '500px' };\r\n    let resolutionEl;\r\n    const cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 400,\r\n        canvas: p.image.canvas,\r\n        isNotCopy: true,\r\n        onChange: function(width, height) {\r\n            if (!resolutionEl) {\r\n                return;\r\n            }\r\n            updateResolution(width, height);\r\n        }\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginLeft: '-20px',\r\n        borderTop: '1px solid #bbb',\r\n        borderBottom: '1px solid #bbb'\r\n    });\r\n    cropCopy.getEl().title = LANG('crop-drag-to-crop');\r\n    div.appendChild(cropCopy.getEl());\r\n\r\n\r\n    resolutionEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginTop: '10px',\r\n            textAlign: 'center',\r\n            color: '#888',\r\n            lineHeight: '20px',\r\n        }\r\n    });\r\n    function updateResolution(w: number, h: number) {\r\n        const fit = BB.fitInto(w, h, p.maxSize, p.maxSize);\r\n\r\n        if (fit.width < w) {\r\n            resolutionEl.innerHTML = `<span style=\"color:#f00\">${w} X ${h}</span>  ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\r\n            resolutionEl.title = LANG('import-too-large');\r\n        } else {\r\n            resolutionEl.innerHTML = `${w} X ${h}`;\r\n            resolutionEl.title = '';\r\n        }\r\n    }\r\n    updateResolution(p.image.width, p.image.height);\r\n\r\n\r\n    let doFlatten = false;\r\n    function showWarnings(psdWarningArr) {\r\n        let contentArr = [];\r\n        let warningMap = {\r\n            'mask': 'Masks not supported. Mask was applied.',\r\n            'clipping': 'Clipping not supported. Clipping layers were merged.',\r\n            'group': 'Groups not supported. Layers were ungrouped.',\r\n            'adjustment': 'Adjustment layers not supported.',\r\n            'layer-effect': 'Layer effects not supported.',\r\n            'smart-object': 'Smart objects not supported.',\r\n            'blend-mode': 'Unsupported layer blend mode.',\r\n            'bits-per-channel': 'Unsupported color depth. Only 8bit per channel supported.',\r\n        };\r\n        for (let i = 0; i < psdWarningArr.length; i++) {\r\n            contentArr.push('- ' + warningMap[psdWarningArr[i]]);\r\n        }\r\n        alert(contentArr.join(\"\\n\"));\r\n    }\r\n\r\n    let flattenCheckbox;\r\n    if (p.image.type === 'psd') {\r\n        const noteStyle = {\r\n            background: 'rgba(255,255,0,0.5)',\r\n            padding: '10px',\r\n            marginTop: '5px',\r\n            marginBottom: '5px',\r\n            border: '1px solid #e7d321',\r\n            borderRadius: '5px'\r\n        };\r\n        if (p.image.layers) {\r\n            flattenCheckbox = new Checkbox({\r\n                init: doFlatten,\r\n                label: LANG('import-flatten'),\r\n                callback: function(b) {\r\n                    doFlatten = b;\r\n                }\r\n            });\r\n            div.appendChild(flattenCheckbox.getElement());\r\n\r\n            if (p.image.warningArr) {\r\n                const noteEl = BB.el({\r\n                    content: LANG('import-psd-limited-support'),\r\n                    css: noteStyle\r\n                });\r\n                noteEl.appendChild(BB.el({\r\n                    tagName: 'a',\r\n                    content: 'Details',\r\n                    onClick: function() {\r\n                        showWarnings(p.image.warningArr);\r\n                    }\r\n                }));\r\n                div.appendChild(noteEl);\r\n            }\r\n        } else {\r\n            const noteEl = BB.el({\r\n                content: LANG('import-psd-unsupported'),\r\n                css: noteStyle\r\n            });\r\n            div.appendChild(noteEl);\r\n        }\r\n    }\r\n\r\n    function callback(result) {\r\n        const croppedImage = cropCopy.getCroppedImage();\r\n        const cropRect = cropCopy.getRect();\r\n        cropCopy.destroy();\r\n        if (flattenCheckbox) {\r\n            flattenCheckbox.destroy();\r\n        }\r\n\r\n        if (result === LANG('import-btn-as-layer')) {\r\n            p.callback({\r\n                type: 'as-layer',\r\n                image: croppedImage\r\n            });\r\n\r\n        } else if (result === LANG('import-btn-as-image')) {\r\n            if (p.image.type === 'psd') {\r\n                if (doFlatten) {\r\n                    p.image.layers = null;\r\n                }\r\n                p.callback({\r\n                    type: 'as-image-psd',\r\n                    image: p.image,\r\n                    cropObj: cropRect\r\n                });\r\n            } else if (p.image.type === 'image') {\r\n                p.callback({\r\n                    type: 'as-image',\r\n                    image: croppedImage\r\n                });\r\n            }\r\n        } else {\r\n            p.callback({\r\n                type: 'cancel'\r\n            });\r\n        }\r\n    }\r\n    popup({\r\n        target: p.target,\r\n        message: `<b>${LANG('import-title')}</b>`,\r\n        div: div,\r\n        style,\r\n        buttons: [LANG('import-btn-as-layer'), LANG('import-btn-as-image'), \"Cancel\"],\r\n        callback: callback,\r\n        autoFocus: 'As Image'\r\n    });\r\n}","import {createCanvas} from '../../bb/base/create-canvas';\r\nimport {Psd} from 'ag-psd/dist/psd';\r\nimport {IKlProject, IKlPsd, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {MAX_LAYERS} from '../canvas/kl-canvas';\r\n\r\nlet kl2PsdMap;\r\nlet psd2KlMap;\r\n\r\nfunction init() {\r\n    if (kl2PsdMap) {\r\n        return;\r\n    }\r\n\r\n    kl2PsdMap = {\r\n        'source-over': 'normal',\r\n\r\n        'darken': 'darken',\r\n        'multiply': 'multiply',\r\n        'color-burn': 'color burn',\r\n\r\n        'lighten': 'lighten',\r\n        'screen': 'screen',\r\n        'color-dodge': 'color dodge',\r\n\r\n        'overlay': 'overlay',\r\n        'soft-light': 'soft light',\r\n        'hard-light': 'hard light',\r\n\r\n        'difference': 'difference',\r\n        'exclusion': 'exclusion',\r\n\r\n        'hue': 'hue',\r\n        'saturation': 'saturation',\r\n        'color': 'color',\r\n        'luminosity': 'luminosity',\r\n    };\r\n\r\n    psd2KlMap = {};\r\n    let keys = Object.keys(kl2PsdMap);\r\n    for (let i = 0; i < keys.length; i++) {\r\n        psd2KlMap[kl2PsdMap[keys[i]]] = keys[i];\r\n    }\r\n}\r\n\r\nexport function blendPsdToKl(str: string): IMixMode {\r\n    init();\r\n    return psd2KlMap[str];\r\n}\r\n\r\nexport function blendKlToPsd(str: string): string {\r\n    init();\r\n    return kl2PsdMap[str];\r\n}\r\n\r\n\r\n/**\r\n * Converts ag-psd object into something that KlCanvas can represent\r\n * @param psdObj\r\n */\r\nexport function readPsd(psdObj: Psd): IKlPsd {\r\n    let result: IKlPsd = {\r\n        type: 'psd',\r\n        canvas: psdObj.canvas,\r\n        width: psdObj.width,\r\n        height: psdObj.height\r\n    };\r\n\r\n    function addWarning(warningStr) {\r\n        if (!result.warningArr) {\r\n            result.warningArr = [];\r\n        }\r\n        if (result.warningArr.includes(warningStr)) {\r\n            return;\r\n        }\r\n        result.warningArr.push(warningStr);\r\n    }\r\n\r\n    function getMixModeStr(blendMode): IMixMode {\r\n        let mixModeStr: IMixMode = blendPsdToKl(blendMode);\r\n        if (!mixModeStr) {\r\n            addWarning('blend-mode');\r\n            mixModeStr = 'source-over';\r\n        }\r\n        return mixModeStr;\r\n    }\r\n\r\n    if (psdObj.bitsPerChannel !== 8) {\r\n        addWarning('bits-per-channel');\r\n    }\r\n\r\n    if (!psdObj.children) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    // count resulting layers\r\n    let maxLayers = MAX_LAYERS;\r\n    let layerCount = 0;\r\n    function countWithinGroup(groupObj) {\r\n        let result = 0;\r\n        if (groupObj.blendMode) {\r\n            let mixModeStr = blendPsdToKl(groupObj.blendMode);\r\n            if (mixModeStr && mixModeStr !== 'source-over') {\r\n                return 1;\r\n            }\r\n        }\r\n        for (let i = 0; i < groupObj.children.length; i++) {\r\n            let item = groupObj.children[i];\r\n            if (item.clipping || item.adjustment) {\r\n                continue;\r\n            }\r\n\r\n            if (item.children) {\r\n                addWarning('group');\r\n                result += countWithinGroup(item);\r\n            } else {\r\n                result++;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    layerCount += countWithinGroup(psdObj);\r\n    if (layerCount > maxLayers) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    result.layers = [];\r\n\r\n    function prepareMask(maskCanvas, defaultColor) {\r\n        const groupMaskCtx = maskCanvas.getContext('2d');\r\n        let imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n        if (defaultColor === 0) {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = imData.data[i];\r\n            }\r\n        } else {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = 255 - imData.data[i];\r\n            }\r\n        }\r\n        groupMaskCtx.putImageData(imData, 0, 0);\r\n    }\r\n\r\n    function convertGroup(psdGroupObj): {\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n        opacity: number;\r\n        image: HTMLCanvasElement;\r\n    }[] {\r\n\r\n        let resultArr: {\r\n            name: string;\r\n            mixModeStr: IMixMode;\r\n            opacity: number;\r\n            image: HTMLCanvasElement;\r\n        }[] = [];\r\n        let groupOpacity = psdGroupObj.hidden ? 0 : psdGroupObj.opacity;\r\n        let groupMixModeStr = getMixModeStr(psdGroupObj.blendMode);\r\n        let groupCanvas;\r\n        let groupCtx;\r\n        if (groupMixModeStr !== 'source-over') {\r\n            groupCanvas = createCanvas(result.width, result.height);\r\n            groupCtx = groupCanvas.getContext('2d');\r\n        }\r\n\r\n\r\n        // prepare group mask\r\n        if (psdGroupObj.mask) {\r\n            addWarning('mask');\r\n            prepareMask(psdGroupObj.mask.canvas, psdGroupObj.mask.defaultColor);\r\n        }\r\n\r\n\r\n        for (let i = 0; i < psdGroupObj.children.length; i++) {\r\n            let item = psdGroupObj.children[i];\r\n            if (item.clipping) {\r\n                continue;\r\n            }\r\n            if (item.adjustment) {\r\n                addWarning('adjustment');\r\n                continue;\r\n            }\r\n\r\n            let hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\r\n            if (hasClipping) {\r\n                addWarning('clipping');\r\n            }\r\n\r\n            if (item.children) {\r\n                let innerArr = convertGroup(item);\r\n\r\n                for (let e = 0; e < innerArr.length; e++) {\r\n                    let innerItem = innerArr[e];\r\n                    let innerCtx = innerItem.image.getContext('2d');\r\n\r\n                    // clipping\r\n                    if (hasClipping) {\r\n                        let clippingCanvas = createCanvas(result.width, result.height);\r\n                        let clippingCtx = clippingCanvas.getContext('2d');\r\n                        clippingCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                        for (let f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++) {\r\n                            let clippingItem = psdGroupObj.children[f];\r\n                            if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                                continue;\r\n                            }\r\n                            clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                            clippingCtx.globalAlpha = clippingItem.opacity;\r\n                            clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\r\n                        }\r\n\r\n                        innerCtx.globalCompositeOperation = 'source-atop';\r\n                        innerCtx.drawImage(clippingCanvas, 0, 0);\r\n                    }\r\n\r\n\r\n\r\n                    // group mask\r\n                    if (psdGroupObj.mask) {\r\n                        innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                        innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n                    }\r\n\r\n                    if (groupCanvas) {\r\n                        groupCtx.globalCompositeOperation = innerItem.mixModeStr;\r\n                        groupCtx.globalAlpha = innerItem.opacity;\r\n                        groupCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                    } else {\r\n                        innerItem.opacity = innerItem.opacity * groupOpacity;\r\n                        resultArr.push(innerItem);\r\n                    }\r\n                }\r\n\r\n                continue;\r\n            }\r\n\r\n            let canvas = createCanvas(result.width, result.height);\r\n            let ctx = canvas.getContext('2d');\r\n            if (item.canvas) { // if a layer is empty it has no canvas\r\n                ctx.drawImage(item.canvas, item.left, item.top);\r\n            }\r\n\r\n            // effects\r\n            if (item.effects) {\r\n                addWarning('layer-effect');\r\n            }\r\n\r\n            // mask\r\n            if (item.mask) {\r\n                addWarning('mask');\r\n                prepareMask(item.mask.canvas, item.mask.defaultColor);\r\n\r\n                ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\r\n            }\r\n\r\n            // clipping\r\n            if (hasClipping) {\r\n                let clippingCanvas = createCanvas(item.right - item.left, item.bottom - item.top);\r\n                let clippingCtx = clippingCanvas.getContext('2d');\r\n                clippingCtx.drawImage(item.canvas, 0, 0);\r\n\r\n                for (let e = i + 1; e < psdGroupObj.children.length && psdGroupObj.children[e].clipping; e++) {\r\n                    let clippingItem = psdGroupObj.children[e];\r\n                    if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                        continue;\r\n                    }\r\n                    clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                    clippingCtx.globalAlpha = clippingItem.opacity;\r\n                    clippingCtx.drawImage(clippingItem.canvas, clippingItem.left - item.left, clippingItem.top - item.top);\r\n                }\r\n\r\n                ctx.globalCompositeOperation = 'source-atop';\r\n                ctx.drawImage(clippingCanvas, item.left, item.top);\r\n            }\r\n\r\n            // group mask\r\n            if (psdGroupObj.mask) {\r\n                ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n            }\r\n\r\n            if (groupCanvas) {\r\n                if (groupOpacity > 0) {\r\n                    groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\r\n                    groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\r\n                    groupCtx.drawImage(canvas, 0, 0);\r\n                }\r\n\r\n            } else {\r\n                resultArr.push({\r\n                    name: item.name,\r\n                    opacity: (item.hidden ? 0 : item.opacity) * groupOpacity,\r\n                    mixModeStr: getMixModeStr(item.blendMode),\r\n                    image: canvas,\r\n                });\r\n            }\r\n        }\r\n\r\n        if (groupCanvas) {\r\n            resultArr = [\r\n                {\r\n                    name: psdGroupObj.name,\r\n                    opacity: groupOpacity,\r\n                    mixModeStr: groupMixModeStr,\r\n                    image: groupCanvas,\r\n                }\r\n            ];\r\n        }\r\n\r\n        return resultArr;\r\n    }\r\n\r\n    result.layers = convertGroup({\r\n        name: 'root',\r\n        opacity: 1,\r\n        blendMode: 'normal',\r\n        children: psdObj.children\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\nexport function klPsdToKlProject(klPsd: IKlPsd): IKlProject {\r\n    // only share references to Canvas elements\r\n    const result: IKlProject = {\r\n        width: klPsd.width,\r\n        height: klPsd.height,\r\n        layers: [],\r\n    };\r\n    if (klPsd.layers) {\r\n        result.layers = result.layers.concat(klPsd.layers.map(item => {\r\n            return {\r\n                name: item.name,\r\n                opacity: item.opacity,\r\n                mixModeStr: item.mixModeStr,\r\n                image: item.image,\r\n            };\r\n        }));\r\n    } else {\r\n        // flattened\r\n        result.layers.push({\r\n            name: LANG('background'),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over',\r\n            image: klPsd.canvas,\r\n        });\r\n    }\r\n    return result;\r\n}","//browser storage indexedDB\r\n\r\n\r\nimport {IKlStorageProject} from '../kl.types';\r\n\r\nconst indexedDbIsSupported = !!window.indexedDB;\r\nlet dbNameStr = 'Klecks';\r\nconst storageNameStr = 'ProjectStore';\r\n\r\nexport function setDbName(name: string) {\r\n    dbNameStr = '' + name;\r\n}\r\n\r\n/**\r\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\r\n * with index 'id'\r\n *\r\n * @param actionFunction function(storeObj) - what you want to execute during transaction\r\n * @param successCallback function() - on succesful transaction\r\n * @param errorCallback function(errorStr) - on error\r\n */\r\nfunction execIndexedDBTransaction(actionFunction, successCallback, errorCallback) {\r\n\r\n    let hasFinished = false;\r\n\r\n    function onSuccess() {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        successCallback();\r\n    }\r\n\r\n    function onError(errorStr) {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        errorCallback(errorStr);\r\n    }\r\n\r\n    if (!indexedDbIsSupported) {\r\n        setTimeout(function () {\r\n            onError('no indexed db available');\r\n        }, 0);\r\n        return;\r\n    }\r\n    let requestObj;\r\n\r\n    try {\r\n        requestObj = window.indexedDB.open(dbNameStr, 1);\r\n    } catch (e) {\r\n        onError(e.message);\r\n        return;\r\n    }\r\n\r\n    requestObj.onupgradeneeded = function (e) {\r\n        try {\r\n            let db = requestObj.result;\r\n            let store = db.createObjectStore(storageNameStr, {keyPath: 'id'});\r\n            store.createIndex('id', 'id', {unique: true});\r\n        } catch (e) {\r\n            onError(e.message);\r\n        }\r\n    };\r\n    requestObj.onerror = function (e) {\r\n        onError('indexedDB.open failed, ' + requestObj.error);\r\n    };\r\n    requestObj.onsuccess = function (e) {\r\n        let databaseObj;\r\n        let transactionObj;\r\n        let storeObj;\r\n\r\n        try {\r\n            databaseObj = requestObj.result;\r\n            if (!databaseObj.objectStoreNames.contains(storageNameStr)) {\r\n                //someone maybe messed with the db, or creation failed earlier\r\n                //it's broken -> destroy\r\n                window.indexedDB.deleteDatabase(dbNameStr);\r\n                onError('object store ' + storageNameStr + ' missing. destroying db');\r\n                return;\r\n            }\r\n            transactionObj = databaseObj.transaction(storageNameStr, 'readwrite');\r\n            storeObj = transactionObj.objectStore(storageNameStr);\r\n            storeObj.index('id');\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        databaseObj.onerror = function (e) {\r\n            onError('database error, ' + databaseObj.error);\r\n        };\r\n\r\n        try {\r\n            actionFunction(storeObj);\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        transactionObj.oncomplete = function () {\r\n            onSuccess();\r\n            databaseObj.close();\r\n        };\r\n        transactionObj.onerror = function () {\r\n            onError('transaction error, ' + transactionObj.error);\r\n        };\r\n    };\r\n}\r\n\r\n/**\r\n * getKlProjectObj {\r\n *     width: int,\r\n *     height: int,\r\n *     layers: {\r\n *        name: string,\r\n *        opacity: float (0 - 1),\r\n *        mixModeStr: string,\r\n *        image: image object                <--------- image already loaded!\r\n *     }[]\r\n * }\r\n *\r\n * @param successCallback function - called when succesfully queried. passes KlProjectObj\r\n * @param errorCallback - function(errorStr) - called when error during query\r\n */\r\nexport function getKlProjectObj(successCallback, errorCallback) {\r\n    if (indexedDbIsSupported) {\r\n        let query;\r\n        execIndexedDBTransaction(function (storeObj) {\r\n            query = storeObj.get(1);\r\n        }, function () {\r\n            successCallback(query.result);\r\n        }, function (errorStr) {\r\n            errorCallback('execIndexedDBTransaction error, ' + errorStr);\r\n        });\r\n    } else {\r\n        successCallback(null);\r\n    }\r\n}\r\n\r\n/**\r\n * stores a klProjectObj into id = 1 in database:dbNameStr > storage: storageNameStr\r\n *\r\n * KlProjectObj {\r\n *     width: int,\r\n *     height: int,\r\n *     layers: {\r\n *        name: string,\r\n *        opacity: float (0 - 1),\r\n *        mixModeStr: string,\r\n *        blob: blob object                 <--------- blob!\r\n *     }[]\r\n * }\r\n *\r\n * @param storageProject IKlStorageProject - project to be stored\r\n * @param successCallback function() - on successful transaction\r\n * @param errorCallback function(errorStr) - on error\r\n */\r\nexport function storeKlProjectObj(storageProject: IKlStorageProject, successCallback, errorCallback) {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.put(storageProject);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (errorStr) {\r\n        errorCallback(errorStr);\r\n    });\r\n\r\n}\r\n\r\n/**\r\n * removes id = 1 from database:dbNameStr > storage: storageNameStr\r\n *\r\n * @param successCallback function() - on successful transaction\r\n * @param errorCallback function(error) - on error\r\n */\r\nexport function clear(successCallback, errorCallback) {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.delete(1);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (error) {\r\n        errorCallback(error);\r\n    });\r\n\r\n}\r\n","import {IFilter} from '../kl.types';\r\n// @ts-ignore\r\nimport glBrightnessContrastImg from 'url:~/src/app/img/ui/edit-brightness-contrast.svg';\r\n// @ts-ignore\r\nimport cropExtendImg from 'url:~/src/app/img/ui/edit-crop.svg';\r\n// @ts-ignore\r\nimport glCurvesImg from 'url:~/src/app/img/ui/edit-curves.svg';\r\n// @ts-ignore\r\nimport flipImg from 'url:~/src/app/img/ui/edit-flip.svg';\r\n// @ts-ignore\r\nimport glHueSaturationImg from 'url:~/src/app/img/ui/edit-hue-saturation.svg';\r\n// @ts-ignore\r\nimport invertImg from 'url:~/src/app/img/ui/edit-invert.png';\r\n// @ts-ignore\r\nimport glPerspectiveImg from 'url:~/src/app/img/ui/edit-perspective.svg';\r\n// @ts-ignore\r\nimport resizeImg from 'url:~/src/app/img/ui/edit-resize.svg';\r\n// @ts-ignore\r\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\r\n// @ts-ignore\r\nimport glTiltShiftImg from 'url:~/src/app/img/ui/edit-tilt-shift.png';\r\n// @ts-ignore\r\nimport toAlphaImg from 'url:~/src/app/img/ui/edit-to-alpha.svg';\r\n// @ts-ignore\r\nimport transformImg from 'url:~/src/app/img/ui/edit-transform.svg';\r\n// @ts-ignore\r\nimport glBlurImg from 'url:~/src/app/img/ui/edit-triangle-blur.png';\r\n// @ts-ignore\r\nimport glUnsharpMaskImg from 'url:~/src/app/img/ui/edit-unsharp-mask.png';\r\n// @ts-ignore\r\nimport gridImg from 'url:~/src/app/img/ui/edit-grid.svg';\r\n// @ts-ignore\r\nimport aImg from 'url:~/src/app/img/ui/';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\n\r\nexport const filterLibStatus = {\r\n    isLoaded: false,\r\n};\r\nexport const filterLib: {\r\n    [key:string]: IFilter;\r\n} = {\r\n    glBrightnessContrast: {\r\n        lang: {name: 'filter-bright-contrast-title', button: 'filter-bright-contrast'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        webgl: true,\r\n        updateContext: true,\r\n        icon: glBrightnessContrastImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    cropExtend: {\r\n        lang: {name: 'filter-crop-title', button: 'filter-crop-extend'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: cropExtendImg,\r\n        webgl: false,\r\n        neededWithWebGL: true,\r\n        updateContext: true,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    glCurves: {\r\n        lang: {name: 'filter-curves-title', button: 'filter-curves'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: glCurvesImg,\r\n        webgl: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    flip: {\r\n        lang: {name: 'filter-flip-title', button: 'filter-flip'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: flipImg,\r\n        webgl: false,\r\n        neededWithWebGL: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    glHueSaturation: {\r\n        lang: {name: 'filter-hue-sat-title', button: 'filter-hue-sat'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: glHueSaturationImg,\r\n        webgl: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    invert: {\r\n        lang: {name: 'filter-invert', button: 'filter-invert'},\r\n        name: '',\r\n        icon: invertImg,\r\n        webgl: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        isInstant: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    glPerspective: {\r\n        lang: {name: 'filter-perspective-title', button: 'filter-perspective'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: glPerspectiveImg,\r\n        webgl: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    resize: {\r\n        lang: {name: 'filter-resize-title', button: 'filter-resize'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: resizeImg,\r\n        webgl: false,\r\n        neededWithWebGL: true,\r\n        updateContext: true,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    rotate: {\r\n        lang: {name: 'filter-rotate-title', button: 'filter-rotate'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: rotateImg,\r\n        webgl: false,\r\n        neededWithWebGL: true,\r\n        updateContext: true,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    glTiltShift: {\r\n        lang: {name: 'filter-tilt-shift-title', button: 'filter-tilt-shift'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: glTiltShiftImg,\r\n        webgl: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    toAlpha: {\r\n        lang: {name: 'filter-to-alpha-title', button: 'filter-to-alpha'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: toAlphaImg,\r\n        webgl: true,\r\n        updateContext: false,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    transform: {\r\n        lang: {name: 'filter-transform-title', button: 'filter-transform'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: transformImg,\r\n        webgl: false,\r\n        neededWithWebGL: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        ieFails: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    glBlur: {\r\n        lang: {name: 'filter-triangle-blur-title', button: 'filter-triangle-blur'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: glBlurImg,\r\n        webgl: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    glUnsharpMask: {\r\n        lang: {name: 'filter-unsharp-mask-title', button: 'filter-unsharp-mask'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: glUnsharpMaskImg,\r\n        webgl: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    grid: {\r\n        lang: {name: 'filter-grid', button: 'filter-grid'},\r\n        name: '',\r\n        buttonLabel: '',\r\n        icon: gridImg,\r\n        webgl: false,\r\n        neededWithWebGL: true,\r\n        updateContext: true,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    }\r\n};\r\n\r\nfunction updateNames() {\r\n    const keys = Object.keys(filterLib);\r\n    keys.forEach(item => {\r\n        filterLib[item].name = LANG(filterLib[item].lang.name);\r\n        filterLib[item].buttonLabel = LANG(filterLib[item].lang.button);\r\n    });\r\n}\r\nupdateNames();\r\n\r\nlanguageStrings.subscribe(() => {\r\n    updateNames();\r\n});","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"5tPq3\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cazOx\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"245NA\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1hkCG\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"k2eFf\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"krKGd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ehfxY\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"beOjS\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"Gk9bV\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"csed7\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"equSE\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h1dN3\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"LfAXI\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cB6q6\");","import {PenBrush} from './pen-brush';\r\nimport {BlendBrush} from './blend-brush';\r\nimport {SketchyBrush} from './sketchy-brush';\r\nimport {PixelBrush} from './pixel-brush';\r\nimport {EraserBrush} from './eraser-brush';\r\nimport {SmudgeBrush} from './smudge-brush';\r\nimport {ChemyBrush} from './chemy-brush';\r\n\r\nexport const brushes = {\r\n    PenBrush,\r\n    BlendBrush,\r\n    SketchyBrush,\r\n    PixelBrush,\r\n    ChemyBrush,\r\n    SmudgeBrush,\r\n    EraserBrush,\r\n}","import {BB} from '../../bb/bb';\r\nimport {alphaImArr} from './brushes-common';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\n\r\nexport function PenBrush() {\r\n\r\n    let context;\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n\r\n    let settingColor, settingSize = 2, settingSpacing = 0.8489, settingOpacity = 1;\r\n    let settingColorStr;\r\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\r\n    let settingLockLayerAlpha = false;\r\n    let ALPHA_CIRCLE = 0, ALPHA_CHALK = 1, ALPHA_CAL = 2, ALPHA_SQUARE = 3;\r\n    let settingAlphaId = ALPHA_CIRCLE;\r\n\r\n    let lineToolLastDot;\r\n    let lastInput = {x: 0, y: 0, pressure: 0};\r\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\r\n\r\n    let isDrawing = false;\r\n    let alphaOpacityArr = [1, 0.9, 1, 1];\r\n\r\n    //mipmapping\r\n    let alphaCanvas128 = BB.canvas(128, 128);\r\n    let alphaCanvas64 = BB.canvas(64, 64);\r\n    let alphaCanvas32 = BB.canvas(32, 32);\r\n\r\n    let bezierLine = null;\r\n\r\n    let twoPI = Math.PI * 2;\r\n    let hasDrawnDot = false; // current stroke has drawn at least one dot\r\n    let inputArr: {x: number, y: number, pressure: number}[];\r\n\r\n    // pressure: 0-1\r\n    function calcOpacity(pressure: number) {\r\n        return settingOpacity * (settingHasOpacityPressure ? pressure * pressure : 1);\r\n    }\r\n\r\n    function updateAlphaCanvas() {\r\n        if (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE) {\r\n            return;\r\n        }\r\n\r\n        let instructionArr = [\r\n            [alphaCanvas128, 128],\r\n            [alphaCanvas64, 64],\r\n            [alphaCanvas32, 32]\r\n        ];\r\n\r\n        let ctx;\r\n\r\n        for (let i = 0; i < instructionArr.length; i++) {\r\n            ctx = (instructionArr[i][0] as any).getContext(\"2d\");\r\n\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.fillStyle = \"rgba(\" + settingColor.r + \", \" + settingColor.g + \", \" + settingColor.b + \", \" + alphaOpacityArr[settingAlphaId] + \")\";\r\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.globalCompositeOperation = \"destination-in\";\r\n            ctx.imageSmoothingQuality = 'high';\r\n            ctx.drawImage(alphaImArr[settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.restore();\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     * @param angle\r\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\r\n     */\r\n    function drawDot(x, y, size, opacity, angle?, before?) {\r\n        if (size <= 0) {\r\n            return;\r\n        }\r\n\r\n        if (settingLockLayerAlpha) {\r\n            context.globalCompositeOperation = \"source-atop\";\r\n        }\r\n\r\n        if (!before || before[3] !== opacity) {\r\n            context.globalAlpha = opacity;\r\n        }\r\n\r\n        if (!before && (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE)) {\r\n            context.fillStyle = settingColorStr;\r\n        }\r\n\r\n        if (settingAlphaId === ALPHA_CIRCLE) {\r\n            context.beginPath();\r\n            context.arc(x, y, size, 0, twoPI);\r\n            context.closePath();\r\n            context.fill();\r\n            hasDrawnDot = true;\r\n\r\n        } else if (settingAlphaId === ALPHA_SQUARE) {\r\n            if (angle !== undefined) {\r\n                context.save();\r\n                context.translate(x, y);\r\n                context.rotate(angle / 180 * Math.PI);\r\n                context.fillRect(-size, -size, size * 2, size * 2);\r\n                context.restore();\r\n                hasDrawnDot = true;\r\n            }\r\n\r\n        } else { // other brush alphas\r\n            context.save();\r\n            context.translate(x, y);\r\n            let targetMipmap = alphaCanvas128;\r\n            if (size <= 32 && size > 16) {\r\n                targetMipmap = alphaCanvas64;\r\n            } else if (size <= 16) {\r\n                targetMipmap = alphaCanvas32;\r\n            }\r\n            context.scale(size, size);\r\n            if (settingAlphaId === ALPHA_CHALK) {\r\n                context.rotate(((x + y) * 53123) % twoPI); // without mod it sometimes looks different\r\n            }\r\n            context.drawImage(targetMipmap, -1, -1, 2, 2);\r\n\r\n            context.restore();\r\n            hasDrawnDot = true;\r\n        }\r\n    }\r\n\r\n    function continueLine(x, y, size, pressure) {\r\n        if (bezierLine === null) {\r\n            bezierLine = new BB.BezierLine();\r\n            bezierLine.add(lastInput.x, lastInput.y, 0, function(){});\r\n        }\r\n\r\n        let drawArr = []; //draw instructions. will be all drawn at once\r\n\r\n        function dotCallback(val) {\r\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\r\n            let localOpacity = calcOpacity(localPressure);\r\n            let localSize = Math.max(0.1, settingSize * (settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        }\r\n\r\n        let localSpacing = size * settingSpacing;\r\n        if (x === null) {\r\n            bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        context.save();\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            let item = drawArr[i];\r\n            drawDot(item[0], item[1], item[2], item[3], item[4], before);\r\n            before = item;\r\n        }\r\n        context.restore();\r\n    }\r\n\r\n    //------------------ interface ---------------------------------------------------\r\n\r\n\r\n    this.startLine = function (x, y, p) {\r\n        historyEntry = {\r\n            tool: [\"brush\", \"PenBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [settingHasOpacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setAlpha\",\r\n            params: [settingAlphaId]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        let localOpacity = calcOpacity(p);\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, p * settingSize) : Math.max(0.1, settingSize);\r\n\r\n        hasDrawnDot = false;\r\n\r\n        isDrawing = true;\r\n        context.save();\r\n        drawDot(x, y, localSize, localOpacity);\r\n        context.restore();\r\n\r\n        lineToolLastDot = localSize * settingSpacing;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n        lastInput2.pressure = p;\r\n\r\n        inputArr = [{\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        }];\r\n\r\n        historyEntry.actions.push({\r\n            action: \"startLine\",\r\n            params: [x, y, p]\r\n        });\r\n    };\r\n\r\n    this.goLine = function (x, y, p) {\r\n        if (!isDrawing) {\r\n            return;\r\n        }\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [x, y, p]\r\n        });\r\n\r\n        let pressure = BB.clamp(p, 0, 1);\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n\r\n        context.save();\r\n        continueLine(x, y, localSize, lastInput.pressure);\r\n\r\n        /*context.fillStyle = 'red';\r\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\r\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/\r\n\r\n        context.restore();\r\n\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput2.pressure = lastInput.pressure;\r\n        lastInput.pressure = pressure;\r\n\r\n        inputArr.push({\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        });\r\n    };\r\n\r\n    this.endLine = function (x, y) {\r\n\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n        context.save();\r\n        continueLine(null, null, localSize, lastInput.pressure);\r\n        context.restore();\r\n\r\n        isDrawing = false;\r\n\r\n        if (settingAlphaId === ALPHA_SQUARE && !hasDrawnDot) {\r\n            // find max pressure input, use that one\r\n            let maxInput = inputArr[0];\r\n            inputArr.forEach(item => {\r\n                if (item.pressure > maxInput.pressure) {\r\n                    maxInput = item;\r\n                }\r\n            })\r\n\r\n            context.save();\r\n            let p = BB.clamp(maxInput.pressure, 0, 1);\r\n            let localOpacity = calcOpacity(p);\r\n            drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\r\n            context.restore();\r\n        }\r\n\r\n        bezierLine = null;\r\n\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: [x, y]\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n\r\n        hasDrawnDot = false;\r\n        inputArr = [];\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = settingSize * settingSpacing;\r\n        lineToolLastDot = settingSize * settingSpacing;\r\n        context.save();\r\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\r\n        }\r\n        context.restore();\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"PenBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [settingHasOpacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setAlpha\",\r\n            params: [settingAlphaId]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    //IS\r\n    this.isDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n    //SET\r\n    this.setAlpha = function (a) {\r\n        if (settingAlphaId === a) {\r\n            return;\r\n        }\r\n        settingAlphaId = a;\r\n        updateAlphaCanvas();\r\n    };\r\n    this.setColor = function (c) {\r\n        if (settingColor === c) {\r\n            return;\r\n        }\r\n        settingColor = {r: c.r, g: c.g, b: c.b};\r\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\r\n        updateAlphaCanvas();\r\n    };\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSize = function (s) {\r\n        settingSize = s;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        settingOpacity = o;\r\n    };\r\n    this.setSpacing = function (s) {\r\n        settingSpacing = s;\r\n    };\r\n    this.sizePressure = function (b) {\r\n        settingHasSizePressure = b;\r\n    };\r\n    this.opacityPressure = function (b) {\r\n        settingHasOpacityPressure = b;\r\n    };\r\n    this.setLockAlpha = function (b) {\r\n        settingLockLayerAlpha = b;\r\n    };\r\n    //GET\r\n    this.getSpacing = function () {\r\n        return settingSpacing;\r\n    };\r\n    this.getSize = function () {\r\n        return settingSize;\r\n    };\r\n    this.getOpacity = function () {\r\n        return settingOpacity;\r\n    };\r\n    this.getLockAlpha = function (b) {\r\n        return settingLockLayerAlpha;\r\n    };\r\n}","import {genBrushAlpha01, genBrushAlpha02} from './alphas/brush-alphas';\r\n\r\nexport const alphaImArr = []; //used by default brush\r\nalphaImArr[1] = genBrushAlpha01(128);\r\nalphaImArr[2] = genBrushAlpha02(128);","import {BB} from '../../../bb/bb';\r\nimport {noise} from '../../../bb/math/perlin';\r\nimport {IVector2D} from '../../../bb/bb.types';\r\n\r\n// chalk\r\nexport function genBrushAlpha01(w: number): HTMLCanvasElement {\r\n\r\n    const scaleFac = w / 500;\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    const ctx = canvas.getContext('2d');\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            let i = (y * w + x) * 4;\r\n\r\n            // base noise\r\n            const sFac2 = scaleFac + noise.simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\r\n            let noisePattern = 100 + (noise.simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\r\n            noisePattern -= (noise.simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\r\n\r\n            // fade out in circular shape\r\n            const centerDist = BB.dist(w / 2, h / 2, x, y);\r\n            let falloff = BB.clamp(\r\n                1 - ((centerDist - (w / 2.5)) / (w / 14) + noise.simplex2(x / 22 / sFac2, y / 22 / sFac2)),\r\n                0,\r\n                1);\r\n            noisePattern = noisePattern * falloff;\r\n\r\n            // make the middle darker\r\n            const falloff2 = BB.clamp(1 - centerDist / w, 0, 1) * 2;\r\n            noisePattern = noisePattern * falloff2;\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = BB.clamp(noisePattern, 0, 255);\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}\r\n\r\n// https://www.shadertoy.com/view/3tdSDj\r\nfunction udSegment( p: IVector2D, a: IVector2D, b: IVector2D ) {\r\n    let ba = BB.Vec2.sub(b, a);\r\n    let pa = BB.Vec2.sub(p, a);\r\n    let h = BB.clamp( BB.Vec2.dot(pa,ba) / BB.Vec2.dot(ba,ba), 0.0, 1.0 );\r\n    return BB.Vec2.len(BB.Vec2.sub(pa, BB.Vec2.mul(ba, h)));\r\n}\r\n\r\n// calligraphy\r\nexport function genBrushAlpha02(w: number): HTMLCanvasElement {\r\n\r\n    const pDist = 1 / 4;\r\n    let centerSize = 2 / 3;\r\n    let transitionSize = 1 / 3;\r\n    centerSize *= pDist;\r\n    transitionSize *= pDist;\r\n    const p1 = {x: pDist * w, y: w - (w * pDist)};\r\n    const p2 = {x: w - (w * pDist), y: pDist * w};\r\n\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    let ctx = canvas.getContext('2d');\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            const i = (y * w + x) * 4;\r\n\r\n            let col = udSegment({x: x, y: y}, p1, p2);\r\n\r\n            col = BB.clamp(\r\n                255 - ((col - (w * centerSize)) / (w * transitionSize) * 255),\r\n                0,\r\n                255\r\n            );\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = col;\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}","/*\r\n * A speed-improved perlin and simplex noise algorithms for 2D.\r\n *\r\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\n * Better rank ordering method by Stefan Gustavson in 2012.\r\n * Converted to Javascript by Joseph Gentle.\r\n *\r\n * Version 2012-03-09\r\n *\r\n * This code was placed in the public domain by its original author,\r\n * Stefan Gustavson. You may use it as you see fit, but\r\n * attribution is appreciated.\r\n *\r\n */\r\n\r\nconst myModule = {} as any;\r\n\r\n\r\nfunction Grad(x, y, z) {\r\n    this.x = x; this.y = y; this.z = z;\r\n}\r\n\r\nGrad.prototype.dot2 = function(x, y) {\r\n    return this.x*x + this.y*y;\r\n};\r\n/*\r\nGrad.prototype.dot3 = function(x, y, z) {\r\n    return this.x*x + this.y*y + this.z*z;\r\n};*/\r\n\r\nlet grad3 = [new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),\r\n    new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),\r\n    new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];\r\n\r\nlet p = [151,160,137,91,90,15,\r\n    131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,\r\n    190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,\r\n    88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,\r\n    77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,\r\n    102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,\r\n    135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,\r\n    5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,\r\n    223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,\r\n    129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,\r\n    251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,\r\n    49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,\r\n    138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\r\n// To remove the need for index wrapping, double the permutation table length\r\nlet perm = new Array(512);\r\nlet gradP = new Array(512);\r\n\r\n// This isn't a very good seeding function, but it works ok. It supports 2^16\r\n// different seed values. Write something better if you need more seeds.\r\nmyModule.seed = function(seed) {\r\n    if (seed > 0 && seed < 1) {\r\n        // Scale the seed out\r\n        seed *= 65536;\r\n    }\r\n\r\n    seed = Math.floor(seed);\r\n    if (seed < 256) {\r\n        seed |= seed << 8;\r\n    }\r\n\r\n    for (let i = 0; i < 256; i++) {\r\n        let v;\r\n        if (i & 1) {\r\n            v = p[i] ^ (seed & 255);\r\n        } else {\r\n            v = p[i] ^ ((seed>>8) & 255);\r\n        }\r\n\r\n        perm[i] = perm[i + 256] = v;\r\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\r\n    }\r\n};\r\n\r\nmyModule.seed(0);\r\n\r\n/*\r\nfor (let i=0; i<256; i++) {\r\n  perm[i] = perm[i + 256] = p[i];\r\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\r\n}*/\r\n\r\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\r\nlet F2 = 0.5*(Math.sqrt(3)-1);\r\nlet G2 = (3-Math.sqrt(3))/6;\r\n\r\n/*let F3 = 1/3;\r\nlet G3 = 1/6;*/\r\n\r\n// 2D simplex noise\r\nmyModule.simplex2 = function(xin, yin) {\r\n    let n0, n1, n2; // Noise contributions from the three corners\r\n    // Skew the input space to determine which simplex cell we're in\r\n    let s = (xin+yin)*F2; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    let t = (i+j)*G2;\r\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin-j+t;\r\n    // For the 2D case, the simplex shape is an equilateral triangle.\r\n    // Determine which simplex we are in.\r\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n    if (x0>y0) { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n        i1=1; j1=0;\r\n    } else {    // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n        i1=0; j1=1;\r\n    }\r\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n    // c = (3-sqrt(3))/6\r\n    let x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n    let y1 = y0 - j1 + G2;\r\n    let x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n    let y2 = y0 - 1 + 2 * G2;\r\n    // Work out the hashed gradient indices of the three simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    let gi0 = gradP[i+perm[j]];\r\n    let gi1 = gradP[i+i1+perm[j+j1]];\r\n    let gi2 = gradP[i+1+perm[j+1]];\r\n    // Calculate the contribution from the three corners\r\n    let t0 = 0.5 - x0*x0-y0*y0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot2(x0, y0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.5 - x1*x1-y1*y1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\r\n    }\r\n    let t2 = 0.5 - x2*x2-y2*y2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 70 * (n0 + n1 + n2);\r\n};\r\n/*\r\n// 3D simplex noise\r\nmyModule.simplex3 = function(xin, yin, zin) {\r\n    let n0, n1, n2, n3; // Noise contributions from the four corners\r\n\r\n    // Skew the input space to determine which simplex cell we're in\r\n    let s = (xin+yin+zin)*F3; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    let k = Math.floor(zin+s);\r\n\r\n    let t = (i+j+k)*G3;\r\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin-j+t;\r\n    let z0 = zin-k+t;\r\n\r\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n    // Determine which simplex we are in.\r\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n    if (x0 >= y0) {\r\n        if (y0 >= z0)      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; }\r\n        else if (x0 >= z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; }\r\n        else              { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; }\r\n    } else {\r\n        if (y0 < z0)      { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; }\r\n        else if (x0 < z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; }\r\n        else             { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; }\r\n    }\r\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n    // c = 1/6.\r\n    let x1 = x0 - i1 + G3; // Offsets for second corner\r\n    let y1 = y0 - j1 + G3;\r\n    let z1 = z0 - k1 + G3;\r\n\r\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\r\n    let y2 = y0 - j2 + 2 * G3;\r\n    let z2 = z0 - k2 + 2 * G3;\r\n\r\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\r\n    let y3 = y0 - 1 + 3 * G3;\r\n    let z3 = z0 - 1 + 3 * G3;\r\n\r\n    // Work out the hashed gradient indices of the four simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    k &= 255;\r\n    let gi0 = gradP[i+   perm[j+   perm[k   ]]];\r\n    let gi1 = gradP[i+i1+perm[j+j1+perm[k+k1]]];\r\n    let gi2 = gradP[i+i2+perm[j+j2+perm[k+k2]]];\r\n    let gi3 = gradP[i+ 1+perm[j+ 1+perm[k+ 1]]];\r\n\r\n    // Calculate the contribution from the four corners\r\n    let t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\r\n    }\r\n    let t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\r\n    }\r\n    let t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\r\n    if (t3<0) {\r\n        n3 = 0;\r\n    } else {\r\n        t3 *= t3;\r\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 32 * (n0 + n1 + n2 + n3);\r\n\r\n};\r\n*/\r\n// ##### Perlin noise stuff\r\n/*\r\nfunction fade(t) {\r\n    return t*t*t*(t*(t*6-15)+10);\r\n}\r\n\r\nfunction lerp(a, b, t) {\r\n    return (1-t)*a + t*b;\r\n}\r\n\r\n// 2D Perlin Noise\r\nmyModule.perlin2 = function(x, y) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y);\r\n    // Get relative xy coordinates of point within that cell\r\n    x = x - X; y = y - Y;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255;\r\n\r\n    // Calculate noise contributions from each of the four corners\r\n    let n00 = gradP[X+perm[Y]].dot2(x, y);\r\n    let n01 = gradP[X+perm[Y+1]].dot2(x, y-1);\r\n    let n10 = gradP[X+1+perm[Y]].dot2(x-1, y);\r\n    let n11 = gradP[X+1+perm[Y+1]].dot2(x-1, y-1);\r\n\r\n    // Compute the fade curve value for x\r\n    let u = fade(x);\r\n\r\n    // Interpolate the four results\r\n    return lerp(\r\n        lerp(n00, n10, u),\r\n        lerp(n01, n11, u),\r\n        fade(y));\r\n};*/\r\n/*\r\n// 3D Perlin Noise\r\nmyModule.perlin3 = function(x, y, z) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y), Z = Math.floor(z);\r\n    // Get relative xyz coordinates of point within that cell\r\n    x = x - X; y = y - Y; z = z - Z;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255; Z = Z & 255;\r\n\r\n    // Calculate noise contributions from each of the eight corners\r\n    let n000 = gradP[X+  perm[Y+  perm[Z  ]]].dot3(x,   y,     z);\r\n    let n001 = gradP[X+  perm[Y+  perm[Z+1]]].dot3(x,   y,   z-1);\r\n    let n010 = gradP[X+  perm[Y+1+perm[Z  ]]].dot3(x,   y-1,   z);\r\n    let n011 = gradP[X+  perm[Y+1+perm[Z+1]]].dot3(x,   y-1, z-1);\r\n    let n100 = gradP[X+1+perm[Y+  perm[Z  ]]].dot3(x-1,   y,   z);\r\n    let n101 = gradP[X+1+perm[Y+  perm[Z+1]]].dot3(x-1,   y, z-1);\r\n    let n110 = gradP[X+1+perm[Y+1+perm[Z  ]]].dot3(x-1, y-1,   z);\r\n    let n111 = gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1, y-1, z-1);\r\n\r\n    // Compute the fade curve value for x, y, z\r\n    let u = fade(x);\r\n    let v = fade(y);\r\n    let w = fade(z);\r\n\r\n    // Interpolate\r\n    return lerp(\r\n        lerp(\r\n            lerp(n000, n100, u),\r\n            lerp(n001, n101, u), w),\r\n        lerp(\r\n            lerp(n010, n110, u),\r\n            lerp(n011, n111, u), w),\r\n        v);\r\n};*/\r\n\r\nexport const noise = myModule;","import {BB} from '../../bb/bb';\r\nimport {IRGB, IRGBA} from '../kl.types';\r\nimport {IBounds, IPressureInput} from '../../bb/bb.types';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\n\r\nconst cellSize = 256;\r\n\r\ninterface IDrawBufferItem {\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    opacity: number;\r\n    x1: number;\r\n    y1: number;\r\n    x2: number;\r\n    y2: number;\r\n    r: number;\r\n    g: number;\r\n    b: number;\r\n}\r\n\r\n// faster than using BB.clamp somehow (in chrome)\r\nfunction clamp(num, min, max) {\r\n    return num <= min\r\n        ? min\r\n        : num >= max\r\n            ? max\r\n            : num\r\n}\r\n\r\nexport class BlendBrush {\r\n\r\n    private isTesting: boolean = false; // testing mode - context only gets updated when line is finished\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private color: IRGB;\r\n    private size: number = 29; // radius - 0.5 - 99999\r\n    private opacity: number = 0.6; // 0-1\r\n    private blending: number = 0.65; // 0-1\r\n\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingSizePressure: boolean = true;\r\n    private settingOpacityPressure: boolean = false;\r\n\r\n    private blendCol: IRGBA = {r: 0, g: 0, b: 0, a: 1}; // todo docs\r\n    private blendMix: number = 0.45; // todo docs\r\n    private mixr: number; // todo docs\r\n    private mixg: number; // todo docs\r\n    private mixb: number; // todo docs\r\n    private localColOld: IRGBA; // todo docs\r\n\r\n    private isDrawing: boolean = false;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private bezierLine: any; // todo type\r\n\r\n    private history: KlHistoryInterface | null;\r\n    private historyEntry: IHistoryEntry;\r\n    private redrawBounds: IBounds;\r\n    private cells: (ImageData | null)[];\r\n    private drawBuffer: IDrawBufferItem[];\r\n\r\n    private updateRedrawBounds (bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    private getCellsWidth(): number {\r\n        return Math.ceil(this.context.canvas.width / cellSize);\r\n    }\r\n\r\n    /**\r\n     * draw changed cells (changed by brushstroke) onto context\r\n     * @private\r\n     */\r\n    private drawChangedCells(): void {\r\n        const cells = this.cells.map(item => null);\r\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\r\n        touchedCells.forEach((isTouched, index) => {\r\n            if (isTouched) {\r\n                cells[index] = this.cells[index];\r\n            }\r\n        });\r\n        this.drawCells(cells);\r\n        this.redrawBounds = null;\r\n    }\r\n\r\n    private getTouchedCells(bounds: IBounds): boolean[] {\r\n        const touchedCells = this.cells.map(item => false);\r\n        const cellsW = this.getCellsWidth();\r\n        bounds = {\r\n            x1: Math.floor(bounds.x1 / cellSize),\r\n            y1: Math.floor(bounds.y1 / cellSize),\r\n            x2: Math.floor(bounds.x2 / cellSize),\r\n            y2: Math.floor(bounds.y2 / cellSize),\r\n        };\r\n        for (let i = bounds.x1; i <= bounds.x2; i++) {\r\n            for (let e = bounds.y1; e <= bounds.y2; e++) {\r\n                touchedCells[e * cellsW + i] = true;\r\n            }\r\n        }\r\n        return touchedCells;\r\n    }\r\n\r\n    /**\r\n     * Slice up bounds accordings to cells\r\n     * @param bounds\r\n     * @private\r\n     */\r\n    private sliceBounds(bounds: IBounds): {index: number; bounds: IBounds}[] {\r\n        const cellsW = this.getCellsWidth();\r\n        const result: {index: number; bounds: IBounds}[] = [];\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n\r\n        touchedCells.forEach((cell, i) => {\r\n            if (!cell) {\r\n                return;\r\n            }\r\n\r\n            const cellOffsetX = (i % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(i / cellsW) * cellSize;\r\n            const cellWidth = this.cells[i].width;\r\n            const cellHeight = this.cells[i].height;\r\n\r\n            const inCellBounds = {\r\n                x1: Math.max(0, bounds.x1 - cellOffsetX),\r\n                y1: Math.max(0, bounds.y1 - cellOffsetY),\r\n                x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\r\n                y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY),\r\n            }\r\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) {\r\n                return;\r\n            }\r\n            result.push({\r\n                index: i,\r\n                bounds: inCellBounds,\r\n            });\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    private copyFromCanvas(bounds: IBounds) {\r\n        if (!bounds) {\r\n            return;\r\n        }\r\n\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n        const cellsW = this.getCellsWidth();\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.cells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * cellSize + cellSize, this.context.canvas.width) - 1) % cellSize + 1;\r\n            const h = (Math.min(y * cellSize + cellSize, this.context.canvas.height) - 1) % cellSize + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = tmpCanvas.getContext('2d');\r\n            tmpCtx.drawImage(this.context.canvas, -x * cellSize, -y * cellSize);\r\n\r\n            this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\r\n        });\r\n    }\r\n\r\n    private getAverage (x, y, size): IRGBA {\r\n\r\n        size = Math.max(0.5, size * 0.75);\r\n        const x1 = Math.max(0, Math.floor(x - size));\r\n        const y1 = Math.max(0, Math.floor(y - size));\r\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return {\r\n                r: 0,\r\n                g: 0,\r\n                b: 0,\r\n                a: 0,\r\n            };\r\n        }\r\n\r\n        let ar = 0, ag = 0, ab = 0, aa = 0, alpha;\r\n\r\n        const slicedBounds = this.sliceBounds({ x1, y1, x2, y2 });\r\n        slicedBounds.forEach(slice => {\r\n            const width = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n            const bounds = slice.bounds;\r\n\r\n            for (let i = bounds.y1; i <= bounds.y2; i += 4) {\r\n                for (let e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 4 * 4) {\r\n                    alpha = data[e2 + 3];\r\n                    ar += data[e2] * alpha;\r\n                    ag += data[e2 + 1] * alpha;\r\n                    ab += data[e2 + 2] * alpha;\r\n                    aa += alpha;\r\n                }\r\n            }\r\n        });\r\n\r\n        if (aa !== 0) {\r\n            ar /= aa;\r\n            ag /= aa;\r\n            ab /= aa;\r\n            aa = Math.min(1, aa);\r\n        }\r\n        return {\r\n            r: ar,\r\n            g: ag,\r\n            b: ab,\r\n            a: aa\r\n        };\r\n    }\r\n\r\n    private prepDot (x: number, y: number, size: number): IBounds {\r\n        size = Math.max(0.5, size);\r\n        let x1 = Math.max(0, Math.floor(x - size));\r\n        let y1 = Math.max(0, Math.floor(y - size));\r\n        let x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        let y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return null;\r\n        }\r\n        return { x1, y1, x2, y2 };\r\n    }\r\n\r\n    private drawDot (params: IDrawBufferItem): void {\r\n        // array with random numbers. faster than Math.random()\r\n        let randI = 0;\r\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n        const randArr = [];\r\n        for (let i = 0; i < randLen; i++) {\r\n            randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n        }\r\n\r\n        // thin lines take more than just 1 sample\r\n        const sampleArr = [8,4,4,4,2,2,2,2,2,2]; // <0.5, 0.5, 1, 1.5, etc.\r\n        const samples = sampleArr[Math.floor(params.size * 2)];\r\n        const samplesSquared: number = samples ? samples * samples : 0;\r\n        const sampleOffsets = [];\r\n        if (samples) {\r\n            let i = 0;\r\n            for (let n = 0; n < samples; n++) {\r\n                for (let m = 0; m < samples; m++, i += 2) {\r\n                    sampleOffsets[i] = (n + 1) / samples; // x offset\r\n                    sampleOffsets[i + 1] = (m + 1) / samples; // y offset\r\n                }\r\n            }\r\n        }\r\n\r\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\r\n        // to optimize calculations\r\n        const invSharpness = 1 - sharpness;\r\n        const sharpnessSubtrahend = sharpness / invSharpness;\r\n        const sizeSquared = params.size * params.size;\r\n        const distDivisor = sizeSquared * invSharpness / params.opacity;\r\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\r\n\r\n\r\n        const slicedBounds = this.sliceBounds({\r\n            x1: params.x1,\r\n            y1: params.y1,\r\n            x2: params.x2,\r\n            y2: params.y2,\r\n        });\r\n\r\n        const cellsW = this.getCellsWidth();\r\n        slicedBounds.forEach(slice => {\r\n            const cellOffsetX = (slice.index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(slice.index / cellsW) * cellSize;\r\n            const cellWidth = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n\r\n            // i - y index within cell\r\n            // e - x index within cell\r\n\r\n            // e2 - index in image data\r\n\r\n            // ri - y index within image relative to dot-center\r\n            // re - x index within image relative to dot-center\r\n\r\n            for (let i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++) {\r\n                for (\r\n                    let e = slice.bounds.x1,\r\n                        e2 = i * cellWidth * 4 + slice.bounds.x1 * 4,\r\n                        re = e + cellOffsetX - params.x;\r\n                    e <= slice.bounds.x2;\r\n                    e++,\r\n                        e2 += 4,\r\n                        re++\r\n                ) {\r\n                    // O = over -> brush-dot\r\n                    // U = under -> image\r\n\r\n                    let alphaO = 0;\r\n                    if (samplesSquared) {\r\n                        for (let f = 0; f < sampleOffsets.length; f += 2) {\r\n                            const dist = BB.lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\r\n                            if (dist >= sizeSquared) {\r\n                                continue;\r\n                            }\r\n                            alphaO += clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                        }\r\n                        if (!alphaO) {\r\n                            continue;\r\n                        }\r\n                        alphaO /= samplesSquared;\r\n                    } else {\r\n                        // technically needs + 0.5 offset, but not noticeable with large brush\r\n                        const dist = Math.pow(re, 2) + Math.pow(ri, 2);\r\n                        if (dist >= sizeSquared) {\r\n                            continue;\r\n                        }\r\n                        alphaO = clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                    }\r\n\r\n                    const invAlphaO = 1 - alphaO;\r\n                    const alphaU =data[e2 + 3] / 255;\r\n\r\n                    if (this.settingLockLayerAlpha) {\r\n                        const underR = (params.r * alphaO) + ((data[e2]) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1]) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2]) * invAlphaO);\r\n                        if (alphaU) {\r\n                            data[e2] = Math.floor(underR + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB + randArr[randI]);\r\n                        }\r\n                    } else {\r\n                        const underR = (params.r * alphaO) + ((data[e2] * alphaU) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1] * alphaU) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2] * alphaU) * invAlphaO);\r\n\r\n                        let newAlpha = 1 - invAlphaO * (1 - alphaU);\r\n                        data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\r\n                        if (newAlpha) {\r\n                            data[e2] = Math.floor(underR / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB / (newAlpha) + randArr[randI]);\r\n                        }\r\n                    }\r\n                    randI = (randI + 1) % randLen;\r\n\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    private calcSpacing (size: number): number {\r\n        return BB.mix(\r\n            (size * 2) / 2, // until size 5.3\r\n            (size * 2) / 9, // at size 24\r\n            BB.clamp((size - 2.7) / (12 - 2.7), 0, 1)\r\n        );\r\n    }\r\n\r\n    private continueLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n\r\n        this.drawBuffer = [];\r\n\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (this.settingSizePressure) ? Math.max(1, p * this.size) : Math.max(1, this.size);\r\n\r\n        let bdist = this.calcSpacing(localSize);\r\n\r\n        let avgX = x;\r\n        let avgY = y;\r\n        if (x === null) {\r\n            avgX = this.lastInput.x;\r\n            avgY = this.lastInput.y;\r\n        }\r\n\r\n        let localColNew;\r\n\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            let average;\r\n            if (isCoalesced) {\r\n                average = {r: this.localColOld.r, g: this.localColOld.g, b: this.localColOld.b, a: 0};\r\n            } else {\r\n                const avgParams = [avgX, avgY, ((this.settingSizePressure) ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size))];\r\n                const bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\r\n                this.copyFromCanvas(bounds);\r\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\r\n            }\r\n            localColNew = {r: 0, g: 0, b: 0, a: 0};\r\n\r\n            if (average.a > 0 && this.blendCol.a === 0) {\r\n                this.blendCol.r = average.r;\r\n                this.blendCol.g = average.g;\r\n                this.blendCol.b = average.b;\r\n                this.blendCol.a = average.a;\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n\r\n            } else {\r\n                if (average.a === 0) {\r\n                    average.r = this.color.r;\r\n                    average.g = this.color.g;\r\n                    average.b = this.color.b;\r\n                    average.a = 1 - this.blending;\r\n                }\r\n\r\n                this.blendCol.r = BB.mix(this.blendCol.r, BB.mix(this.blendCol.r, average.r, this.blendMix), average.a);\r\n                this.blendCol.g = BB.mix(this.blendCol.g, BB.mix(this.blendCol.g, average.g, this.blendMix), average.a);\r\n                this.blendCol.b = BB.mix(this.blendCol.b, BB.mix(this.blendCol.b, average.b, this.blendMix), average.a);\r\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n            }\r\n\r\n        }\r\n\r\n\r\n        const bezierCallback = (val) => {\r\n            if (this.blending >= 1 && this.blendCol.a <= 0) {\r\n                return;\r\n            }\r\n            let factor = val.t;\r\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (this.settingOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\r\n            localSize = (this.settingSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\r\n            if (this.blending != 0) {\r\n                this.mixr = BB.mix(this.localColOld.r, localColNew.r, factor);\r\n                this.mixg = BB.mix(this.localColOld.g, localColNew.g, factor);\r\n                this.mixb = BB.mix(this.localColOld.b, localColNew.b, factor);\r\n            }\r\n            if (this.blending === 1 && this.localColOld.a === 0) {\r\n                this.mixr = localColNew.r;\r\n                this.mixg = localColNew.g;\r\n                this.mixb = localColNew.b;\r\n            }\r\n            const bounds = this.prepDot(val.x, val.y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: val.x,\r\n                    y: val.y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                })\r\n            }\r\n        };\r\n\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.localColOld = localColNew;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.size;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.size = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.opacity = o;\r\n    }\r\n\r\n    getBlending (): number {\r\n        return this.blending;\r\n    }\r\n\r\n    setBlending (b: number) {\r\n        this.blending = b;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.color = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setSizePressure (b: boolean): void {\r\n        this.settingSizePressure = !!b;\r\n    }\r\n\r\n    setOpacityPressure (b: boolean): void {\r\n        this.settingOpacityPressure = !!b;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setIsTesting (b: boolean): void {\r\n        this.isTesting = !!b;\r\n    }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: [\"brush\", \"BlendBrush\"],\r\n            actions: []\r\n        };\r\n\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n\r\n        this.isDrawing = true;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        let localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            this.copyFromCanvas(this.prepDot(x, y, localSize));\r\n\r\n            let average = this.getAverage(\r\n                x,\r\n                y,\r\n                ((this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size))\r\n            );\r\n            if (average.a === 0) {\r\n                this.blendCol = {\r\n                    r: this.color.r,\r\n                    g: this.color.g,\r\n                    b: this.color.b,\r\n                    a: 1 - this.blending,\r\n                };\r\n            } else {\r\n                this.blendCol = {\r\n                    r: average.r,\r\n                    g: average.g,\r\n                    b: average.b,\r\n                    a: average.a,\r\n                };\r\n            }\r\n\r\n            this.mixr = this.blendCol.r;\r\n            this.mixg = this.blendCol.g;\r\n            this.mixb = this.blendCol.b;\r\n        }\r\n\r\n        this.localColOld = {r: this.mixr, g: this.mixg, b: this.mixb, a: this.blendCol.a};\r\n\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        if (this.blending < 1 || this.blendCol.a > 0) {\r\n            const bounds = this.prepDot(x, y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x,\r\n                    y: y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                })\r\n            }\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.bezierLine = new BB.BezierLine();\r\n        this.bezierLine.add(x, y, 0, function () {\r\n        });\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    endLine (): void {\r\n        if (this.bezierLine) {\r\n            this.continueLine(null, null, this.lastInput.pressure, false);\r\n        }\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.drawChangedCells();\r\n        }\r\n\r\n        if (this.historyEntry && this.history && this.cells.find(item => !!item)) {\r\n            this.historyEntry.actions.push({\r\n                action: \"drawCells\",\r\n                params: [this.cells],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n\r\n    /**\r\n     * draw cells onto context\r\n     * @param cells\r\n     */\r\n    drawCells (cells: (ImageData | null)[]): void {\r\n        const cellsW = this.getCellsWidth();\r\n        cells.forEach((imageData, index) => {\r\n            if (!imageData) {\r\n                return;\r\n            }\r\n            const cellOffsetX = (index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(index / cellsW) * cellSize;\r\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\r\n        });\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\r\n        let average = this.getAverage(x1, y1, Math.max(0.1, this.size));\r\n\r\n        if (average.a === 0) {\r\n            this.blendCol = {\r\n                r: this.color.r,\r\n                g: this.color.g,\r\n                b: this.color.b,\r\n                a: 1 - this.blending,\r\n            };\r\n        } else {\r\n            this.blendCol = {\r\n                r: average.r,\r\n                g: average.g,\r\n                b: average.b,\r\n                a: average.a,\r\n            };\r\n        }\r\n\r\n        this.mixr = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixg = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixb = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\r\n\r\n\r\n        const p = 1;\r\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        const bdist = this.calcSpacing(localSize);\r\n        for (let loopDist = 0; loopDist <= mouseDist; loopDist += bdist) {\r\n            const bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\r\n            if (bounds) {\r\n                this.copyFromCanvas(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x1 + eX * loopDist,\r\n                    y: y1 + eY * loopDist,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                })\r\n            }\r\n        }\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        if (this.history && this.cells.find(item => !!item)) {\r\n            this.drawCells(this.cells);\r\n            this.historyEntry = {\r\n                tool: [\"brush\", \"BlendBrush\"],\r\n                actions: [{\r\n                    action: \"drawCells\",\r\n                    params: [this.cells],\r\n                }],\r\n            };\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\nconst sampleCanvas = BB.canvas(32, 32);\r\nconst sampleCtx = sampleCanvas.getContext('2d');\r\n\r\nexport function SketchyBrush() {\r\n    let context;\r\n    let settingColor;\r\n\r\n    let settingSize = 1, settingOpacity = 0.2;\r\n    let settingBlending = 0.5;\r\n    let settingScale = 1;\r\n\r\n    let lastX, lastY;\r\n    let isDrawing = false;\r\n    let lastInput = {x: 0, y: 0, pressure: 0};\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n    let sketchySeed = 0;\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSeed = function (s) {\r\n        sketchySeed = parseInt(s);\r\n    };\r\n    this.getSeed = function () {\r\n        return parseInt('' + sketchySeed);\r\n    };\r\n\r\n    function rand() {\r\n        sketchySeed++;\r\n        return Math.sin(6324634.2345 * Math.cos(sketchySeed * 5342.3423)) * 0.5 + 0.5;\r\n    }\r\n\r\n    let points = [];\r\n    let count = 0;\r\n    let mixmode = [\r\n        function (c1, c2) {\r\n            return c1;\r\n        },\r\n        function (c1, c2) {\r\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\r\n            result.r *= c2.r / 255;\r\n            result.g *= c2.g / 255;\r\n            result.b *= c2.b / 255;\r\n            return result;\r\n        },\r\n        function (c1, c2) {\r\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\r\n            result.r *= c2.r / 255;\r\n            result.g *= c2.g / 255;\r\n            result.b *= c2.b / 255;\r\n            return result;\r\n        }\r\n    ];\r\n\r\n    this.getSize = function () {\r\n        return settingSize / 2;\r\n    };\r\n    this.setColor = function (c) {\r\n        settingColor = c;\r\n    };\r\n    this.getOpacity = function () {\r\n        return settingOpacity;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        settingOpacity = o;\r\n    };\r\n    this.getBlending = function () {\r\n        return settingBlending;\r\n    };\r\n    this.setBlending = function (b) {\r\n        settingBlending = b;\r\n    };\r\n    this.setSize = function (s) {\r\n        settingSize = s * 2;\r\n    };\r\n    this.getScale = function () {\r\n        return settingScale;\r\n    };\r\n    this.setScale = function (s) {\r\n        settingScale = s;\r\n    };\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.startLine = function (x, y, pressure, shift) {\r\n        if (shift && lastInput.x) {\r\n            let lx = lastInput.x, ly = lastInput.y;\r\n            isDrawing = true;\r\n            //this.goLine(x,y,pressure);\r\n            this.endLine();\r\n        } else {\r\n            isDrawing = true;\r\n            lastX = x;\r\n            lastY = y;\r\n            lastInput.x = x;\r\n            lastInput.y = y;\r\n            historyEntry = {\r\n                tool: [\"brush\", \"SketchyBrush\"],\r\n                actions: []\r\n            };\r\n            historyEntry.actions.push({\r\n                action: \"setScale\",\r\n                params: [settingScale]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setSize\",\r\n                params: [settingSize / 2]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setOpacity\",\r\n                params: [settingOpacity]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setColor\",\r\n                params: [settingColor]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"setBlending\",\r\n                params: [settingBlending]\r\n            });\r\n            historyEntry.actions.push({\r\n                action: \"startLine\",\r\n                params: [x, y, pressure]\r\n            });\r\n        }\r\n\r\n    };\r\n    this.goLine = function (p_x, p_y, pressure, preMixedColor) {\r\n        if (!isDrawing || (p_x === lastInput.x && p_y === lastInput.y)) {\r\n            return;\r\n        }\r\n\r\n        let e, b, a, g;\r\n        let x = parseInt(p_x);\r\n        let y = parseInt(p_y);\r\n        points.push([x, y]);\r\n\r\n        let mixr = settingColor.r;\r\n        let mixg = settingColor.g;\r\n        let mixb = settingColor.b;\r\n\r\n        if (preMixedColor !== null) {\r\n            mixr = preMixedColor.r;\r\n            mixg = preMixedColor.g;\r\n            mixb = preMixedColor.b;\r\n        } else {\r\n            if (settingBlending !== 0) {\r\n                if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < context.canvas.width - 1 && y - 5 < context.canvas.height - 1) {\r\n                    mixr = 0;\r\n                    mixg = 0;\r\n                    mixb = 0;\r\n                    let mixx = Math.min(context.canvas.width - 1, Math.max(0, x - 5));\r\n                    let mixy = Math.min(context.canvas.height - 1, Math.max(0, y - 5));\r\n                    let mixw = Math.min(context.canvas.width - 1, Math.max(0, x + 5));\r\n                    let mixh = Math.min(context.canvas.height - 1, Math.max(0, y + 5));\r\n                    mixw -= mixx;\r\n                    mixh -= mixy;\r\n\r\n                    if (mixw > 0 && mixh > 0) {\r\n                        let imdat = context.getImageData(mixx, mixy, mixw, mixh);\r\n                        let countmix = 0;\r\n                        for (let i = 0; i < imdat.data.length; i += 4) {\r\n                            mixr += imdat.data[i + 0];\r\n                            mixg += imdat.data[i + 1];\r\n                            mixb += imdat.data[i + 2];\r\n                            countmix++;\r\n                        }\r\n                        mixr /= countmix;\r\n                        mixg /= countmix;\r\n                        mixb /= countmix;\r\n                    }\r\n\r\n                    let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\r\n                    mixr = parseInt('' + BB.mix(settingColor.r, mixed.r, settingBlending));\r\n                    mixg = parseInt('' + BB.mix(settingColor.g, mixed.g, settingBlending));\r\n                    mixb = parseInt('' + BB.mix(settingColor.b, mixed.b, settingBlending));\r\n                }\r\n            }\r\n        }\r\n\r\n        context.save();\r\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\r\n        context.lineWidth = settingSize;\r\n\r\n        context.beginPath();\r\n        context.moveTo(lastX, lastY);\r\n        context.lineTo(x, y);\r\n\r\n        for (e = 0; e < points.length; e++) {\r\n            b = points[e][0] - points[count][0];\r\n            a = points[e][1] - points[count][1];\r\n            g = b * b + a * a;\r\n            if (g < 4000 * settingScale * settingScale && rand() > g / 2000 / settingScale / settingScale) {\r\n                context.moveTo(points[count][0] + (b * 0.3), points[count][1] + (a * 0.3));\r\n                context.lineTo(points[e][0] - (b * 0.3), points[e][1] - (a * 0.3));\r\n            }\r\n        }\r\n\r\n        context.stroke();\r\n        context.restore();\r\n\r\n\r\n        count++;\r\n        lastX = x;\r\n        lastY = y;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [p_x, p_y, pressure, {r: mixr, g: mixg, b: mixb}]\r\n        });\r\n    };\r\n    this.endLine = function () {\r\n        isDrawing = false;\r\n        count = 0;\r\n        points = [];\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: []\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n\r\n        context.save();\r\n        context.lineWidth = settingSize;\r\n\r\n        let mixr = settingColor.r, mixg = settingColor.g, mixb = settingColor.b;\r\n        if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < context.canvas.width - 1 && y1 - 5 < context.canvas.height - 1) {\r\n            mixr = 0;\r\n            mixg = 0;\r\n            mixb = 0;\r\n            let mixx = Math.min(context.canvas.width - 1, Math.max(0, x1 - 5));\r\n            let mixy = Math.min(context.canvas.height - 1, Math.max(0, y1 - 5));\r\n            let mixw = Math.min(context.canvas.width - 1, Math.max(0, x1 + 5));\r\n            let mixh = Math.min(context.canvas.height - 1, Math.max(0, y1 + 5));\r\n            mixw -= mixx;\r\n            mixh -= mixy;\r\n            if (mixw > 0 && mixh > 0) {\r\n                let w = Math.min(sampleCanvas.width, mixw);\r\n                let h = Math.min(sampleCanvas.height, mixh);\r\n                sampleCtx.save();\r\n                sampleCtx.globalCompositeOperation = 'copy';\r\n                sampleCtx.drawImage(context.canvas, mixx, mixy, mixw, mixh, 0, 0, w, h);\r\n                sampleCtx.restore();\r\n\r\n                let imdat = sampleCtx.getImageData(mixx, mixy, mixw, mixh);\r\n                let countmix = 0;\r\n                for (let i = 0; i < imdat.data.length; i += 4) {\r\n                    mixr += imdat.data[i + 0];\r\n                    mixg += imdat.data[i + 1];\r\n                    mixb += imdat.data[i + 2];\r\n                    countmix++;\r\n                }\r\n                mixr /= countmix;\r\n                mixg /= countmix;\r\n                mixb /= countmix;\r\n            }\r\n        }\r\n        let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\r\n        mixr = parseInt('' + (settingBlending * mixed.r + settingColor.r * (1 - settingBlending)));\r\n        mixg = parseInt('' + (settingBlending * mixed.g + settingColor.g * (1 - settingBlending)));\r\n        mixb = parseInt('' + (settingBlending * mixed.b + settingColor.b * (1 - settingBlending)));\r\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\r\n        context.beginPath();\r\n        context.moveTo(x1, y1);\r\n        context.lineTo(x2, y2);\r\n        context.stroke();\r\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\r\n        context.restore();\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"SketchyBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"setScale\",\r\n            params: [settingScale]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize / 2]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setBlending\",\r\n            params: [settingBlending]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    this.isDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\nexport function PixelBrush() {\r\n\r\n    let context;\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n\r\n    let settingColor, settingSize = 0.5, settingSpacing = 0.9, settingOpacity = 1;\r\n    let settingColorStr;\r\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\r\n    let settingLockLayerAlpha = false;\r\n    let settingIsEraser = false;\r\n    let settingUseDither = true;\r\n\r\n    let lineToolLastDot;\r\n    let lastInput = {x: 0, y: 0, pressure: 0};\r\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\r\n\r\n    let isDrawing = false;\r\n    let bezierLine = null;\r\n    let twoPI = Math.PI * 2;\r\n\r\n\r\n    let ditherCanvas = BB.canvas(4, 4);\r\n    let ditherCtx = ditherCanvas.getContext('2d');\r\n    let ditherPattern;\r\n    let ditherArr = [\r\n        [3, 2],\r\n        [1, 0],\r\n        [3, 0],\r\n        [1, 2],\r\n        [2, 1],\r\n        [0, 3],\r\n        [0, 1],\r\n        [2, 3],\r\n\r\n        [2, 0],\r\n        [0, 2],\r\n        [0, 0],\r\n        [2, 2],\r\n        [1, 1],\r\n        [3, 3],\r\n        [3, 1],\r\n        [1, 3]\r\n    ];\r\n\r\n    function updateDither() {\r\n        ditherCtx.clearRect(0, 0, 4, 4);\r\n        ditherCtx.fillStyle = settingIsEraser ? '#fff' : settingColorStr;\r\n        for (let i = 0; i < Math.max(1, Math.round(settingOpacity * ditherArr.length)); i++) {\r\n            ditherCtx.fillRect(ditherArr[i][0], ditherArr[i][1], 1, 1);\r\n        }\r\n        ditherPattern = context.createPattern(ditherCanvas, 'repeat');\r\n    }\r\n\r\n\r\n    /**\r\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\r\n     * @param p1\r\n     * @param p2\r\n     * @param p3\r\n     * @param p4\r\n     * @param maxAngleRad\r\n     */\r\n    function cubicCurveOverThreshold(p1, p2, p3, p4, max) {\r\n        let d = BB.Vec2.nor({\r\n            x: p4.x - p1.x,\r\n            y: p4.y - p1.y\r\n        });\r\n        let d2 = BB.Vec2.nor({\r\n            x: p2.x - p1.x,\r\n            y: p2.y - p1.y\r\n        });\r\n        let d3 = BB.Vec2.nor({\r\n            x: p4.x - p3.x,\r\n            y: p4.y - p3.y\r\n        });\r\n        let a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\r\n        let a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\r\n\r\n        return Math.max(BB.Vec2.dist(d, d2), BB.Vec2.dist(d, d3)) > max;\r\n    }\r\n\r\n    //bresenheim line drawing\r\n    function plotLine(x0, y0, x1, y1, skipFirst) {\r\n        context.save();\r\n\r\n        if (settingIsEraser) {\r\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            } else {\r\n                context.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        } else {\r\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        }\r\n        context.globalAlpha = settingUseDither ? 1 : settingOpacity;\r\n\r\n        x0 = Math.floor(x0);\r\n        y0 = Math.floor(y0);\r\n        x1 = Math.floor(x1);\r\n        y1 = Math.floor(y1);\r\n\r\n        let dX = Math.abs(x1 - x0);\r\n        let sX = x0 < x1 ? 1 : -1;\r\n        let dY = -Math.abs(y1 - y0);\r\n        let sY = y0 < y1 ? 1 : -1;\r\n        let err = dX + dY;\r\n        while (true) {\r\n            if (skipFirst) {\r\n                skipFirst = false;\r\n            } else {\r\n                context.fillRect(x0, y0, 1, 1);\r\n            }\r\n            if (x0 === x1 && y0 === y1) {\r\n                break;\r\n            }\r\n            let e2 = 2 * err;\r\n            if (e2 >= dY) {\r\n                err += dY;\r\n                x0 += sX;\r\n            }\r\n            if (e2 <= dX) {\r\n                err += dX;\r\n                y0 += sY;\r\n            }\r\n        }\r\n\r\n        context.restore();\r\n    }\r\n\r\n    function plotCubicBezierLine(p1, p2, p3, p4) {\r\n\r\n        let isOverThreshold = cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\r\n\r\n        p1.x = Math.floor(p1.x);\r\n        p1.y = Math.floor(p1.y);\r\n        p4.x = Math.floor(p4.x);\r\n        p4.y = Math.floor(p4.y);\r\n\r\n        let dist = BB.dist(p1.x, p1.y, p4.x, p4.y);\r\n        if (!isOverThreshold || dist < 7) {\r\n            plotLine(p1.x, p1.y, p4.x, p4.y, true);\r\n            return;\r\n        }\r\n\r\n        let n = Math.max(2, Math.round(dist / 4));\r\n        let pointArr = [];\r\n        for (let i = 0; i <= n; i++) {\r\n            let t = i / n;\r\n            let a = Math.pow(1 - t, 3);\r\n            let b = 3 * t * Math.pow(1 - t, 2);\r\n            let c = 3 * Math.pow(t, 2) * (1 - t);\r\n            let d = Math.pow(t, 3);\r\n            pointArr.push({\r\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\r\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            plotLine(\r\n                Math.round(pointArr[i].x),\r\n                Math.round(pointArr[i].y),\r\n                Math.round(pointArr[i + 1].x),\r\n                Math.round(pointArr[i + 1].y),\r\n                true\r\n            );\r\n        }\r\n    }\r\n\r\n    function drawDot(x, y, size, opacity, angle?) {\r\n        context.save();\r\n        if (settingIsEraser) {\r\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            } else {\r\n                context.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        } else {\r\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\r\n            if (settingLockLayerAlpha) {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        }\r\n        context.globalAlpha = settingUseDither ? 1 : opacity;\r\n        context.fillRect(\r\n            Math.round(x + -size),\r\n            Math.round(y + -size),\r\n            Math.round(size * 2),\r\n            Math.round(size * 2)\r\n        );\r\n        context.restore();\r\n    }\r\n\r\n\r\n    function continueLine(x, y, size, pressure) {\r\n        if (bezierLine === null) {\r\n            bezierLine = new BB.BezierLine();\r\n            bezierLine.add(lastInput.x, lastInput.y, 0, function () {\r\n            });\r\n        }\r\n\r\n        context.save();\r\n\r\n        function dotCallback(val) {\r\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\r\n            let localOpacity = settingOpacity * (settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            let localSize = Math.max(0.5, settingSize * (settingHasSizePressure ? localPressure : 1));\r\n            drawDot(val.x, val.y, localSize, localOpacity, val.angle);\r\n        }\r\n\r\n        function controlCallback(controlObj) {\r\n            plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\r\n        }\r\n\r\n        if (Math.round(settingSize * 2) === 1) {\r\n            if (x === null) {\r\n                bezierLine.addFinal(4, null, controlCallback);\r\n            } else {\r\n                bezierLine.add(x, y, 4, null, controlCallback);\r\n            }\r\n\r\n        } else {\r\n            let localSpacing = size * settingSpacing;\r\n\r\n            if (x === null) {\r\n                bezierLine.addFinal(localSpacing, dotCallback);\r\n            } else {\r\n                bezierLine.add(x, y, localSpacing, dotCallback);\r\n            }\r\n        }\r\n\r\n        context.restore();\r\n    }\r\n\r\n    //------------------ interface ---------------------------------------------------\r\n\r\n\r\n    this.startLine = function (x, y, p) {\r\n        historyEntry = {\r\n            tool: [\"brush\", \"PixelBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setIsEraser\",\r\n            params: [settingIsEraser]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setUseDither\",\r\n            params: [settingUseDither]\r\n        });\r\n\r\n        if (settingUseDither) {\r\n            updateDither();\r\n        }\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localOpacity = settingHasOpacityPressure ? (settingOpacity * p * p) : settingOpacity;\r\n        let localSize = settingHasSizePressure ? Math.max(0.5, p * settingSize) : Math.max(0.5, settingSize);\r\n\r\n        isDrawing = true;\r\n        drawDot(x, y, localSize, localOpacity);\r\n        lineToolLastDot = localSize * settingSpacing;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n        lastInput2 = BB.copyObj(lastInput);\r\n\r\n        historyEntry.actions.push({\r\n            action: \"startLine\",\r\n            params: [x, y, p]\r\n        });\r\n    };\r\n\r\n    this.goLine = function (x, y, p) {\r\n        if (!isDrawing) {\r\n            return;\r\n        }\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [x, y, p]\r\n        });\r\n\r\n        //debug\r\n        //drawDot(x, y, 1, 0.5);\r\n\r\n        let pressure = BB.clamp(p, 0, 1);\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n\r\n        continueLine(x, y, localSize, lastInput.pressure);\r\n\r\n        lastInput2 = BB.copyObj(lastInput);\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = pressure;\r\n    };\r\n\r\n    this.endLine = function (x, y) {\r\n\r\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\r\n        continueLine(null, null, localSize, lastInput.pressure);\r\n\r\n        //debug\r\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\r\n        //drawDot(x, y, 10, 0.1);\r\n\r\n        isDrawing = false;\r\n\r\n        bezierLine = null;\r\n\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: [x, y]\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (settingUseDither) {\r\n            updateDither();\r\n        }\r\n\r\n        if (Math.round(settingSize * 2) === 1) {\r\n            plotLine(x1, y1, x2, y2, true);\r\n        } else {\r\n            let angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\r\n            let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n            let eX = (x2 - x1) / mouseDist;\r\n            let eY = (y2 - y1) / mouseDist;\r\n            let loopDist;\r\n            let bdist = settingSize * settingSpacing;\r\n            lineToolLastDot = settingSize * settingSpacing;\r\n            for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n                drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\r\n            }\r\n        }\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"PixelBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [settingHasSizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [settingSize]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSpacing\",\r\n            params: [settingSpacing]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [settingOpacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setColor\",\r\n            params: [settingColor]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setLockAlpha\",\r\n            params: [settingLockLayerAlpha]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setIsEraser\",\r\n            params: [settingIsEraser]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setUseDither\",\r\n            params: [settingUseDither]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    //IS\r\n    this.isDrawing = function () {\r\n        return isDrawing;\r\n    };\r\n    //SET\r\n    this.setColor = function (c) {\r\n        if (settingColor === c) {\r\n            return;\r\n        }\r\n        settingColor = c;\r\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\r\n    };\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSize = function (s) {\r\n        settingSize = s;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        settingOpacity = o;\r\n    };\r\n    this.setSpacing = function (s) {\r\n        settingSpacing = s;\r\n    };\r\n    this.sizePressure = function (b) {\r\n        settingHasSizePressure = b;\r\n    };\r\n    this.opacityPressure = function (b) {\r\n        settingHasOpacityPressure = b;\r\n    };\r\n    this.setLockAlpha = function (b) {\r\n        settingLockLayerAlpha = b;\r\n    };\r\n    this.setIsEraser = function (b) {\r\n        settingIsEraser = !!b;\r\n    };\r\n    this.setUseDither = function (b) {\r\n        settingUseDither = !!b;\r\n    };\r\n    //GET\r\n    this.getSpacing = function () {\r\n        return settingSpacing;\r\n    };\r\n    this.getSize = function () {\r\n        return settingSize;\r\n    };\r\n    this.getOpacity = function () {\r\n        return settingOpacity;\r\n    };\r\n    this.getLockAlpha = function () {\r\n        return settingLockLayerAlpha;\r\n    };\r\n    this.getIsEraser = function () {\r\n        return settingIsEraser;\r\n    };\r\n    this.getUseDither = function () {\r\n        return settingUseDither;\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\n\r\nexport function EraserBrush() {\r\n    let context;\r\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    let historyEntry: IHistoryEntry;\r\n\r\n    let size = 30, spacing = 0.4, opacity = 1;\r\n    let sizePressure = true, opacityPressure = false;\r\n    let lastDot, lastInput = {x: 0, y: 0, pressure: 0};\r\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\r\n    let started = false;\r\n\r\n    let bezierLine;\r\n    let isBaseLayer = false;\r\n    let isTransparentBG = false;\r\n\r\n    function drawDot(x, y, size, opacity) {\r\n\r\n        context.save();\r\n        if (isBaseLayer) {\r\n            if (isTransparentBG) {\r\n                context.globalCompositeOperation = \"destination-out\";\r\n            } else {\r\n                context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        } else {\r\n            context.globalCompositeOperation = \"destination-out\";\r\n        }\r\n        let radgrad = context.createRadialGradient(size, size, 0, size, size, size);\r\n        let sharpness = Math.pow(opacity, 2);\r\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\r\n        let oFac = Math.max(0, Math.min(1, opacity));\r\n        let localOpacity = 2 * oFac - oFac * oFac;\r\n        radgrad.addColorStop(sharpness, \"rgba(255, 255, 255, \" + localOpacity + \")\");\r\n        radgrad.addColorStop(1, \"rgba(255, 255, 255, 0)\");\r\n        context.fillStyle = radgrad;\r\n        context.translate(x - size, y - size);\r\n        context.fillRect(0, 0, size * 2, size * 2);\r\n        context.restore();\r\n    }\r\n\r\n    function continueLine(x, y, p) {\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\r\n\r\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * localSize * spacing);\r\n\r\n        function bezierCallback(val) {\r\n            let factor = val.t;\r\n            localPressure = lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (opacityPressure) ? (opacity * localPressure * localPressure) : opacity;\r\n            localSize = (sizePressure) ? Math.max(0.1, localPressure * size) : Math.max(0.1, size);\r\n\r\n            drawDot(val.x, val.y, localSize, localOpacity);\r\n        }\r\n\r\n        if (x === null) {\r\n            bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n    }\r\n\r\n\r\n    this.startLine = function (x, y, p) {\r\n        historyEntry = {\r\n            tool: [\"brush\", \"EraserBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [opacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [sizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [size]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [opacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setTransparentBG\",\r\n            params: [isTransparentBG]\r\n        });\r\n\r\n        isBaseLayer = 0 === context.canvas.index;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localOpacity = (opacityPressure) ? (opacity * p * p) : opacity;\r\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\r\n\r\n        started = true;\r\n        if (localSize > 1) {\r\n            drawDot(x, y, localSize, localOpacity);\r\n        }\r\n        lastDot = localSize * spacing;\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n        lastInput2 = BB.copyObj(lastInput);\r\n\r\n        bezierLine = new BB.BezierLine();\r\n        bezierLine.add(x, y, 0, function () {\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"startLine\",\r\n            params: [x, y, p]\r\n        });\r\n    };\r\n    this.goLine = function (x, y, p) {\r\n        if (!started) {\r\n            return;\r\n        }\r\n        historyEntry.actions.push({\r\n            action: \"goLine\",\r\n            params: [x, y, p]\r\n        });\r\n\r\n        continueLine(x, y, lastInput.pressure);\r\n\r\n        lastInput2 = BB.copyObj(lastInput);\r\n        lastInput.x = x;\r\n        lastInput.y = y;\r\n        lastInput.pressure = p;\r\n    };\r\n    this.endLine = function () {\r\n\r\n        if (bezierLine) {\r\n            continueLine(null, null, lastInput.pressure);\r\n        }\r\n\r\n        started = false;\r\n        bezierLine = undefined;\r\n\r\n        if (historyEntry) {\r\n            historyEntry.actions.push({\r\n                action: \"endLine\",\r\n                params: []\r\n            });\r\n            history.push(historyEntry);\r\n            historyEntry = undefined;\r\n        }\r\n    };\r\n    //cheap n' ugly\r\n    this.drawLineSegment = function (x1, y1, x2, y2) {\r\n\r\n        isBaseLayer = 0 === context.canvas.index;\r\n\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n\r\n        if (started || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * size * spacing);\r\n        lastDot = 0;\r\n        for (loopDist = lastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, size, opacity);\r\n        }\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"EraserBrush\"],\r\n            actions: []\r\n        };\r\n        historyEntry.actions.push({\r\n            action: \"opacityPressure\",\r\n            params: [opacityPressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"sizePressure\",\r\n            params: [sizePressure]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setSize\",\r\n            params: [size]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setOpacity\",\r\n            params: [opacity]\r\n        });\r\n        historyEntry.actions.push({\r\n            action: \"setTransparentBG\",\r\n            params: [isTransparentBG]\r\n        });\r\n\r\n        historyEntry.actions.push({\r\n            action: \"drawLineSegment\",\r\n            params: [x1, y1, x2, y2]\r\n        });\r\n        history.push(historyEntry);\r\n    };\r\n\r\n    //IS\r\n    this.isDrawing = function () {\r\n        return started;\r\n    };\r\n    //SET\r\n    /*this.setAlpha = function(a) {\r\n        lastInput = {};\r\n        alpha = a;\r\n        updateAlphaCanvas();\r\n    };*/\r\n    this.setContext = function (c) {\r\n        context = c;\r\n    };\r\n    this.setHistory = function (l: KlHistoryInterface) {\r\n        history = l;\r\n    };\r\n    this.setSize = function (s) {\r\n        size = s;\r\n    };\r\n    this.setOpacity = function (o) {\r\n        opacity = o;\r\n    };\r\n    this.sizePressure = function (b) {\r\n        sizePressure = b;\r\n    };\r\n    this.opacityPressure = function (b) {\r\n        opacityPressure = b;\r\n    };\r\n    this.setTransparentBG = function (b) {\r\n        isTransparentBG = b == true;\r\n    };\r\n    //GET\r\n    this.getSize = function () {\r\n        return size;\r\n    };\r\n    this.getOpacity = function () {\r\n        return opacity;\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb.types';\r\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB} from '../kl.types';\r\n\r\n// let statCount = 1;\r\n// let statAcc = 0;\r\n// stats on win10, chrome, size 100, opacity 80, smudge()\r\n// unoptimized: 1 ms\r\n// minimal: 0.09 ms\r\n// minimal + circle: 0.5ms\r\n// minimal + circle + ix, iy: 0.23ms\r\n// unoptimized + ix, iy: 0.64 ms\r\n// unoptimized + ix, iy + sans rounding: 0.61 ms\r\n// ix, iy + sans rounding + sans random: 0.32ms\r\n// ix, iy + sans rounding + fast random: 0.46 ms\r\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\r\n\r\nconst CELL_SIZE = 256;\r\n\r\ninterface ISmudgeParams {\r\n    aP: IVector2D;\r\n    bP: IVector2D;\r\n    size: {\r\n        w: number;\r\n        h: number;\r\n    };\r\n    brush: {\r\n        center: IVector2D,\r\n        size: number;\r\n        opacity: number;\r\n        alphaLock: boolean;\r\n    };\r\n}\r\n\r\n\r\n/**\r\n * determine bounds of smudge\r\n * @param imWidth\r\n * @param imHeight\r\n * @param aP\r\n * @param bP\r\n * @param size\r\n */\r\nfunction prepSmudge(\r\n    imWidth: number,\r\n    imHeight: number,\r\n    aP: IVector2D, // top left of source, integers\r\n    bP: IVector2D, // top left of dest, integers\r\n    size: {w: number; h: number}, // size of both rectangles, integers\r\n): {\r\n    aP: IVector2D,\r\n    bP: IVector2D,\r\n    size: {w: number; h: number},\r\n} {\r\n\r\n    if (aP.x === bP.x && aP.y === bP.y) {\r\n        return null;\r\n    }\r\n\r\n    aP = BB.copyObj(aP);\r\n    bP = BB.copyObj(bP);\r\n    size = BB.copyObj(size);\r\n\r\n    // corner behavior\r\n    // cut down rectangles, if a or b go outside\r\n    // i.e. if user drags partially or fully outside the canvas\r\n    {\r\n        let top = 0;\r\n        let right = 0;\r\n        let bottom = 0;\r\n        let left = 0;\r\n\r\n        if (aP.x < 0) {\r\n            left = -aP.x;\r\n        }\r\n        if (aP.y < 0) {\r\n            top = -aP.y;\r\n        }\r\n        if (bP.x < 0) {\r\n            left = Math.max(left, -bP.x);\r\n        }\r\n        if (bP.y < 0) {\r\n            top = Math.max(top, -bP.y);\r\n        }\r\n        if (aP.x + size.w > imWidth) {\r\n            right = aP.x + size.w - imWidth;\r\n        }\r\n        if (aP.y + size.h > imHeight) {\r\n            bottom = aP.y + size.h - imHeight;\r\n        }\r\n        if (bP.x + size.w > imWidth) {\r\n            right = Math.max(right, bP.x + size.w - imWidth);\r\n        }\r\n        if (bP.y + size.h > imHeight) {\r\n            bottom = Math.max(bottom, bP.y + size.h - imHeight);\r\n        }\r\n\r\n        aP.x += left;\r\n        bP.x += left;\r\n        aP.y += top;\r\n        bP.y += top;\r\n\r\n        size.w = size.w - left - right;\r\n        size.h = size.h - top - bottom;\r\n        if (size.w <= 0 || size.h <= 0) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    return {\r\n        aP: {\r\n            x: aP.x,\r\n            y: aP.y,\r\n        },\r\n        bP: {\r\n            x: bP.x,\r\n            y: bP.y,\r\n        },\r\n        size: {\r\n            w: size.w,\r\n            h: size.h,\r\n        }\r\n    };\r\n}\r\n\r\n// faster than using BB.clamp somehow (in chrome)\r\nfunction clamp(num, min, max) {\r\n    return num <= min\r\n        ? min\r\n        : num >= max\r\n            ? max\r\n            : num\r\n}\r\n\r\n/**\r\n * Pixel operations that do the smudging via ImageData\r\n * @param imageData\r\n * @param p\r\n */\r\nfunction smudge(imageData: ImageData, p : ISmudgeParams): void {\r\n\r\n    p = BB.copyObj(p);\r\n\r\n    const cSize = p.brush.size;\r\n    const cX = p.brush.center.x;\r\n    const cY = p.brush.center.y;\r\n\r\n    /*if (statCount % 1000 === 0) {\r\n        console.log(statAcc / 1000);\r\n        statAcc = 0;\r\n    }\r\n    let start = performance.now();*/\r\n\r\n\r\n    // determine offset\r\n    let aIndex = p.aP.y * imageData.width + p.aP.x;\r\n    let bIndex = p.bP.y * imageData.width + p.bP.x;\r\n    const offset = (bIndex - aIndex) * 4;\r\n\r\n    // array with random numbers. faster than Math.random()\r\n    let randI = 0;\r\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n    const randArr = [];\r\n    for (let i = 0; i < randLen; i++) {\r\n        randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n    }\r\n\r\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\r\n\r\n    const pixel = (ai, bi, ix, iy) => {\r\n\r\n        const dist = BB.dist(cX, cY, ix, iy);\r\n        const fac = 1 - p.brush.opacity * (1 - clamp((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\r\n\r\n        if (fac === 1) {\r\n            return;\r\n        }\r\n\r\n        if (!imageData.data[ai + 3]) {\r\n\r\n        } else if (!imageData.data[bi + 3]) { // don't mix if target fully transparent. pixel might have a strange color.\r\n            imageData.data[bi] = imageData.data[ai + 0];\r\n            imageData.data[bi + 1] = imageData.data[ai + 1];\r\n            imageData.data[bi + 2] = imageData.data[ai + 2];\r\n        } else {\r\n\r\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\r\n            // not totally accurate. TODO same compositing as blend brush\r\n            let fac2;\r\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) {\r\n                fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\r\n            } else {\r\n                fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\r\n            }\r\n\r\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\r\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\r\n            // No +0.5, because it cancels out with rand.\r\n            imageData.data[bi] = Math.floor(BB.mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\r\n            imageData.data[bi + 1] = Math.floor(BB.mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\r\n            imageData.data[bi + 2] = Math.floor(BB.mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\r\n\r\n            randI = (randI + 1) % randLen;\r\n        }\r\n        // Always mix alpha. unless alpha lock\r\n        if (!p.brush.alphaLock) {\r\n            imageData.data[bi + 3] = Math.floor(BB.mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\r\n        }\r\n\r\n    };\r\n\r\n    const bx1 = p.bP.x * 4;\r\n    const bx2 = bx1 + (p.size.w - 1) * 4;\r\n\r\n    // transfer of pixels depends on direction of smudging if there is overlap\r\n    if (p.aP.y < p.bP.y) {\r\n        for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else if (p.aP.y > p.bP.y) {\r\n        for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else {\r\n        if (p.aP.x < p.bP.x) {\r\n            for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        } else {\r\n            for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x; x < bx2 + yStart; x += 4, x2 += 4, ix++) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //statCount++;\r\n    //statAcc += performance.now() - start;\r\n}\r\n\r\nexport class SmudgeBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IHistoryEntry;\r\n\r\n    private settingColor: IRGB = {r: 0, g: 0, b: 0};\r\n    private settingSize: number = 35;\r\n    private settingSpacing: number = 0.20446882736951905;\r\n    private settingOpacity: number = 0.8;\r\n    private settingColorStr: string;\r\n    private settingHasSizePressure: boolean = false;\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingLockLayerAlpha: boolean = false;\r\n\r\n    private lineToolLastDot: number;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastDot: IVector2D;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private bezierLine: any = null; // todo type BezierLine\r\n\r\n    private redrawBounds: IBounds;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    private copyImageData: ImageData;\r\n\r\n    private drawBuffer: ISmudgeParams[] = [];\r\n\r\n    private copiedCells: boolean[];\r\n\r\n    updateRedrawBounds(bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    updateCompleteRedrawBounds (x1, y1, x2, y2): void {\r\n        this.completeRedrawBounds = BB.updateBounds(\r\n            this.completeRedrawBounds,\r\n            { x1, y1, x2, y2 }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    copyFromCanvas(): void {\r\n\r\n        const touchedCells = this.copiedCells.map(item => false);\r\n\r\n        const bounds: IBounds[] = [];\r\n        const cellsW = Math.ceil(this.copyImageData.width / CELL_SIZE);\r\n\r\n        if (!this.redrawBounds) {\r\n            return;\r\n        }\r\n        bounds.push({\r\n            x1: Math.floor(this.redrawBounds.x1 / CELL_SIZE),\r\n            y1: Math.floor(this.redrawBounds.y1 / CELL_SIZE),\r\n            x2: Math.floor(this.redrawBounds.x2 / CELL_SIZE),\r\n            y2: Math.floor(this.redrawBounds.y2 / CELL_SIZE),\r\n        });\r\n        bounds.forEach(item => {\r\n            for (let i = item.x1; i <= item.x2; i++) {\r\n                for (let e = item.y1; e <= item.y2; e++) {\r\n                    touchedCells[e * cellsW + i] = true;\r\n                }\r\n            }\r\n        });\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.copiedCells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            this.copiedCells[i] = true;\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * CELL_SIZE + CELL_SIZE, this.copyImageData.width) - 1) % CELL_SIZE + 1;\r\n            const h = (Math.min(y * CELL_SIZE + CELL_SIZE, this.copyImageData.height) - 1) % CELL_SIZE + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = tmpCanvas.getContext('2d');\r\n            tmpCtx.drawImage(this.context.canvas, -x * CELL_SIZE, -y * CELL_SIZE);\r\n\r\n            const data = tmpCtx.getImageData(0, 0, w, h);\r\n\r\n            for (let i = 0; i < h; i++) {\r\n                for (let e = 0, e2 = i * w * 4, e3 = ((y * CELL_SIZE + i) * this.copyImageData.width + x * CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4) {\r\n                    this.copyImageData.data[e3] = data.data[e2];\r\n                    this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\r\n                    this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\r\n                    this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * fill drawBuffer with params about to be drawn\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     */\r\n    prepDot (x: number, y: number, size: number, opacity: number): void {\r\n        if (!this.lastDot) {\r\n            this.lastDot = {\r\n                x: x,\r\n                y: y,\r\n            };\r\n            return;\r\n        }\r\n\r\n        size = Math.round(size);\r\n\r\n\r\n        const w = Math.round(size * 2);\r\n        const h = Math.round(size * 2);\r\n\r\n        const bounds = prepSmudge(\r\n            this.copyImageData.width,\r\n            this.copyImageData.height,\r\n            {\r\n                x: Math.round(this.lastDot.x - size),\r\n                y: Math.round(this.lastDot.y - size),\r\n            },\r\n            {\r\n                x: Math.round(x - size),\r\n                y: Math.round(y - size),\r\n            },\r\n            {\r\n                w,\r\n                h,\r\n            },\r\n        );\r\n\r\n        if (bounds) {\r\n            const params: ISmudgeParams = {\r\n                aP: bounds.aP,\r\n                bP: bounds.bP,\r\n                size: bounds.size,\r\n                brush: {\r\n                    center: { x, y },\r\n                    size,\r\n                    opacity,\r\n                    alphaLock: this.settingLockLayerAlpha,\r\n                }\r\n            };\r\n            this.updateRedrawBounds({\r\n                x1: params.bP.x,\r\n                y1: params.bP.y,\r\n                x2: params.bP.x + params.brush.size * 2,\r\n                y2: params.bP.y + params.brush.size * 2,\r\n            });\r\n            this.drawBuffer.push(params);\r\n        }\r\n\r\n        this.lastDot = {\r\n            x: x,\r\n            y: y,\r\n        };\r\n    }\r\n\r\n    continueLine (x: number, y: number, size: number, pressure: number): void {\r\n        this.drawBuffer = [];\r\n\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function(){});\r\n        }\r\n\r\n        const drawArr = []; //draw instructions. will be all drawn at once\r\n\r\n        const dotCallback = (val): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        };\r\n\r\n        const localSpacing = size * this.settingSpacing / 3;\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            const item = drawArr[i];\r\n            this.prepDot(item[0], item[1], item[2], item[3]);\r\n            before = item;\r\n        }\r\n\r\n        this.copyFromCanvas();\r\n\r\n        for (let i = 0; i < this.drawBuffer.length; i++) {\r\n            smudge(this.copyImageData, this.drawBuffer[i]);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor () { }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: [\"brush\", \"SmudgeBrush\"],\r\n            actions: []\r\n        };\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.lastDot = null;\r\n        this.isDrawing = true;\r\n\r\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\r\n        const totalCells = Math.ceil(this.context.canvas.width / CELL_SIZE) * Math.ceil(this.context.canvas.height / CELL_SIZE);\r\n        this.copiedCells = '0'.repeat(totalCells).split('').map(item => false);\r\n\r\n        this.prepDot(x, y, localSize, localOpacity);\r\n\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2.pressure = p;\r\n\r\n        this.completeRedrawBounds = null;\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        this.redrawBounds = null;\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput2.pressure = this.lastInput.pressure;\r\n        this.lastInput.pressure = pressure;\r\n    }\r\n\r\n    endLine (): void {\r\n        this.redrawBounds = null;\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.context.save();\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n        this.context.restore();\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        if (this.historyEntry && this.completeRedrawBounds) {\r\n            let historyIm: ImageData | HTMLCanvasElement = this.copyImageData;\r\n            if (!(\r\n                this.completeRedrawBounds.x1 === 0 &&\r\n                this.completeRedrawBounds.y1 === 0 &&\r\n                this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 &&\r\n                this.completeRedrawBounds.y2 >= this.context.canvas.height - 1\r\n            )) {\r\n\r\n                // temp canvas to prevent main canvas from getting slowed down in chrome\r\n                const tmpCanvas = BB.canvas(\r\n                    this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                    this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n                );\r\n                const tmpCtx = tmpCanvas.getContext('2d');\r\n                tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n                historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\r\n            }\r\n            this.historyEntry.actions.push({\r\n                action: \"drawImage\",\r\n                params: [\r\n                    historyIm,\r\n                    this.completeRedrawBounds.x1,\r\n                    this.completeRedrawBounds.y1,\r\n                ],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n        this.copyImageData = null;\r\n    }\r\n\r\n    drawImage (im: ImageData | HTMLCanvasElement, x: number, y: number): void {\r\n        if (im instanceof ImageData) {\r\n            this.context.putImageData(im, x, y);\r\n        } else {\r\n            this.context.clearRect(x, y, im.width, im.height);\r\n            this.context.drawImage(im, x, y);\r\n        }\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        return;\r\n        /*\r\n        // todo\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = settingSize * settingSpacing;\r\n        lineToolLastDot = settingSize * settingSpacing;\r\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\r\n        }\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"SmudgeBrush\"],\r\n            actions: []\r\n        };\r\n        // todo\r\n        history.add(historyEntry);*/\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) {\r\n            return;\r\n        }\r\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\r\n        this.settingColorStr = BB.ColorConverter.toRgbStr(this.settingColor);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = !!b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = !!b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl.types';\r\nimport {IBounds} from '../../bb/bb.types';\r\nimport {KlHistoryInterface} from '../history/kl-history';\r\n\r\ntype TChemyMode = 'fill' | 'stroke';\r\n\r\nexport class ChemyBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private settingColor: IRGB;\r\n    private settingSize: number = 0.25; // radius - 0.5 - 99999\r\n    private settingOpacity: number = 1; // 0-1\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingIsEraser: boolean = false;\r\n    private settingMode: TChemyMode = 'fill';\r\n    private settingDistort: number = 0; // 0 - 1\r\n    private settingXSymmetry: boolean = false;\r\n    private settingYSymmetry: boolean = false;\r\n    private settingGradient: boolean = false;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private history: KlHistoryInterface;\r\n\r\n    private copyCanvas: HTMLCanvasElement;\r\n    private path: {x: number, y: number}[];\r\n    private minY: number;\r\n    private maxY: number;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    updateCompleteRedrawBounds (x, y): void {\r\n        let bounds = { x1: x, y1: y, x2: x, y2: y};\r\n        if (this.settingXSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: -x + this.copyCanvas.width,\r\n                    y1: y,\r\n                    x2: -x + this.copyCanvas.width,\r\n                    y2: y,\r\n                }\r\n                );\r\n        }\r\n        if (this.settingYSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: x,\r\n                    y1: -y + this.copyCanvas.height,\r\n                    x2: x,\r\n                    y2: -y + this.copyCanvas.height,\r\n                }\r\n            );\r\n        }\r\n        const buffer = this.settingMode === 'stroke' ? this.settingSize + 1 : 1;\r\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\r\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\r\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\r\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\r\n\r\n        this.completeRedrawBounds = BB.updateBounds(this.completeRedrawBounds, bounds);\r\n    }\r\n\r\n    private drawShape (): void {\r\n        this.context.save();\r\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\r\n        this.context.drawImage(this.copyCanvas, 0, 0);\r\n\r\n        let color = {...this.settingColor};\r\n        if (this.settingIsEraser) {\r\n            color.r = 255;\r\n            color.g = 255;\r\n            color.b = 255;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = \"source-atop\";\r\n            } else {\r\n                this.context.globalCompositeOperation = \"destination-out\";\r\n            }\r\n        } else {\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = \"source-atop\";\r\n            }\r\n        }\r\n\r\n        if (this.path) {\r\n\r\n            // path\r\n            const path = new Path2D();\r\n            this.path.forEach((item, index) => {\r\n                if (index === 0) {\r\n                    path.moveTo(item.x, item.y);\r\n                } else {\r\n                    path.lineTo(item.x, item.y);\r\n                }\r\n            });\r\n\r\n            let style: string | CanvasGradient = BB.ColorConverter.toRgbaStr({\r\n                r: color.r,\r\n                g: color.g,\r\n                b: color.b,\r\n                a: this.settingOpacity,\r\n            });\r\n            if (this.settingGradient) {\r\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\r\n                const gradient = this.context.createLinearGradient(\r\n                    0, startAtTop ? this.minY : this.maxY,\r\n                    0, startAtTop ? this.maxY : this.minY,\r\n                );\r\n                gradient.addColorStop(\r\n                    0,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: this.settingOpacity,\r\n                    })\r\n                );\r\n                gradient.addColorStop(\r\n                    1,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: 0,\r\n                    })\r\n                );\r\n                style = gradient;\r\n            }\r\n\r\n            // setup params\r\n            if (this.settingMode === 'fill') {\r\n                this.context.fillStyle = style;\r\n\r\n            } else {\r\n                this.context.lineWidth = this.settingSize * 2;\r\n                this.context.lineJoin = 'bevel';\r\n                this.context.strokeStyle = style;\r\n            }\r\n\r\n            // draw\r\n            const draw = () => {\r\n                if (this.settingMode === 'fill') {\r\n                    this.context.fill(path);\r\n                } else {\r\n                    this.context.stroke(path);\r\n                }\r\n            };\r\n\r\n            draw();\r\n            if (this.settingXSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(this.context.canvas.width / 2, 0);\r\n                this.context.scale(-1, 1);\r\n                this.context.translate(-this.context.canvas.width / 2, 0);\r\n                draw();\r\n                this.context.restore();\r\n            }\r\n            if (this.settingYSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(0, this.context.canvas.height / 2);\r\n                this.context.scale(1, -1);\r\n                this.context.translate(0, -this.context.canvas.height / 2);\r\n                draw();\r\n                this.context.restore();\r\n                if (this.settingXSymmetry) {\r\n                    this.context.save();\r\n                    this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\r\n                    this.context.scale(-1, -1);\r\n                    this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\r\n                    draw();\r\n                    this.context.restore();\r\n                }\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingMode === 'stroke' ? this.settingSize : 0;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.settingColor = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setMode (mode: TChemyMode): void {\r\n        this.settingMode = mode;\r\n    }\r\n\r\n    getMode (): TChemyMode {\r\n        return this.settingMode;\r\n    }\r\n\r\n    setDistort (distort: number): void {\r\n        this.settingDistort = BB.clamp(distort, 0, 1);\r\n    }\r\n\r\n    getDistort (): number {\r\n        return this.settingDistort;\r\n    }\r\n\r\n    setXSymmetry (b: boolean): void {\r\n        this.settingXSymmetry = !!b;\r\n    }\r\n\r\n    getXSymmetry (): boolean {\r\n        return this.settingXSymmetry;\r\n    }\r\n\r\n    setYSymmetry (b: boolean): void {\r\n        this.settingYSymmetry = !!b;\r\n    }\r\n\r\n    getYSymmetry (): boolean {\r\n        return this.settingYSymmetry;\r\n    }\r\n\r\n    setGradient (b: boolean): void {\r\n        this.settingGradient = !!b;\r\n    }\r\n\r\n    getGradient (): boolean {\r\n        return this.settingGradient;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.settingIsEraser;\r\n    }\r\n\r\n    setIsEraser (b: boolean): void {\r\n        this.settingIsEraser = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    startLine (x: number, y: number): void {\r\n        this.isDrawing = true;\r\n        this.path = [{x, y}];\r\n        this.minY = y;\r\n        this.maxY = y;\r\n        this.copyCanvas = BB.canvas(this.context.canvas.width, this.context.canvas.height);\r\n        this.copyCanvas.getContext('2d').drawImage(this.context.canvas, 0, 0);\r\n        this.completeRedrawBounds = null;\r\n        this.updateCompleteRedrawBounds(x, y);\r\n    }\r\n\r\n    goLine (x: number, y: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        let pos = { x, y };\r\n        if (this.settingDistort > 0) {\r\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\r\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\r\n        }\r\n\r\n        this.minY = Math.min(this.minY, pos.y);\r\n        this.maxY = Math.max(this.maxY, pos.y);\r\n        this.path.push(pos);\r\n        this.updateCompleteRedrawBounds(x, y);\r\n        this.drawShape();\r\n    }\r\n\r\n    endLine (): void {\r\n        this.isDrawing = false;\r\n        this.completeRedrawBounds = BB.boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\r\n        if (this.path.length > 1 && this.completeRedrawBounds) {\r\n            const historyCanvas = BB.canvas(\r\n                this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n            );\r\n            const historyCtx = historyCanvas.getContext('2d');\r\n            historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n            this.history.push({\r\n                tool: [\"brush\", \"ChemyBrush\"],\r\n                actions: [\r\n                    {\r\n                        action: \"drawImage\",\r\n                        params: [\r\n                            historyCanvas, // faster than getting image data (measured on 2018 lenovo chromebook)\r\n                            this.completeRedrawBounds.x1,\r\n                            this.completeRedrawBounds.y1,\r\n                        ],\r\n                    }\r\n                ]\r\n            });\r\n        }\r\n        this.path = null;\r\n        this.copyCanvas = null;\r\n    }\r\n\r\n    drawImage (im: HTMLCanvasElement, x: number, y: number): void {\r\n        this.context.save();\r\n        this.context.clearRect(x, y, im.width, im.height);\r\n        this.context.drawImage(im, x, y);\r\n        this.context.restore();\r\n    }\r\n\r\n    drawLineSegment (x1, y1, x2, y2): void {\r\n        // might make sense for stroke\r\n    }\r\n}\r\n","import {penBrushUi} from './pen-brush-ui';\r\nimport {blendBrushUi} from './blend-brush-ui';\r\nimport {sketchyBrushUi} from './sketchy-brush-ui';\r\nimport {pixelBrushUi} from './pixel-brush-ui';\r\nimport {eraserBrushUi} from './eraser-brush-ui';\r\nimport {smudgeBrushUi} from './smudge-brush-ui';\r\nimport {chemyBrushUi} from './chemy-brush-ui';\r\nimport {IBrushUi} from '../kl.types';\r\n\r\n/**\r\n * UI for brushes.\r\n * Each brush ui carries the brush with it.\r\n * So if you want to draw, you do it through the UI. should be changed sometime.\r\n */\r\n\r\nexport const brushesUI: {\r\n    [key: string]: IBrushUi;\r\n} = {\r\n    penBrush: penBrushUi,\r\n    blendBrush: blendBrushUi,\r\n    sketchyBrush: sketchyBrushUi,\r\n    pixelBrush: pixelBrushUi,\r\n    chemyBrush: chemyBrushUi,\r\n    smudgeBrush: smudgeBrushUi,\r\n    eraserBrush: eraserBrushUi,\r\n};\r\n","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pen.svg';\r\nimport {genBrushAlpha01, genBrushAlpha02} from '../brushes/alphas/brush-alphas';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const penBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pen'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 0,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    let alphaNames = [\r\n        LANG('brush-pen-circle'),\r\n        LANG('brush-pen-chalk'),\r\n        LANG('brush-pen-calligraphy'),\r\n        LANG('brush-pen-square'),\r\n    ];\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pen');\r\n        alphaNames = [\r\n            LANG('brush-pen-circle'),\r\n            LANG('brush-pen-chalk'),\r\n            LANG('brush-pen-calligraphy'),\r\n            LANG('brush-pen-square'),\r\n        ];\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.PenBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        let alphas = [];\r\n        let currentAlpha = 0;\r\n        for (let i = 0; i < 4; i++) {\r\n            (function (i) {\r\n                let alpha = BB.el({\r\n                    title: alphaNames[i],\r\n                    onClick: () => {\r\n                        alphaClick(i);\r\n                    }\r\n                });\r\n                let canvas = BB.canvas(70, 70);\r\n                let ctx = canvas.getContext('2d');\r\n                if (i === 0 || i === 3) {\r\n                    if (i === 0) {\r\n                        ctx.beginPath();\r\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\r\n                        ctx.closePath();\r\n                        ctx.fill();\r\n                    } else {\r\n                        ctx.fillRect(5, 5, 60, 60);\r\n                    }\r\n                } else if (i === 1) {\r\n                    ctx.drawImage(genBrushAlpha01(60), 5, 5);\r\n                } else if (i === 2) {\r\n                    ctx.drawImage(genBrushAlpha02(60), 5, 5);\r\n                }\r\n                alpha.style.backgroundImage = 'url(' + canvas.toDataURL('image/png') + ')';\r\n\r\n                alphas.push(alpha);\r\n            }(i));\r\n        }\r\n\r\n        function updateAlphas() {\r\n            for (let i = 0; i < alphas.length; i++) {\r\n                if (i === currentAlpha) {\r\n                    alphas[i].className = 'brush-alpha-selected';\r\n                } else {\r\n                    alphas[i].className = 'brush-alpha';\r\n                }\r\n            }\r\n        }\r\n\r\n        updateAlphas();\r\n\r\n        function alphaClick(id) {\r\n            currentAlpha = id;\r\n            brush.setAlpha(id);\r\n            updateAlphas();\r\n        }\r\n\r\n        let lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('brush-lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('brush-lock-alpha-title'),\r\n            css: {\r\n                cssFloat: 'right',\r\n                textAlign: 'right',\r\n            }\r\n        });\r\n\r\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                initValue: brush.getSize(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                curve: brushInterface.sizeSlider.curve,\r\n                formatFunc: function (v) {\r\n                    v *= 2;\r\n                    if (v < 10) {\r\n                        return Math.round(v * 10) / 10;\r\n                    } else {\r\n                        return Math.round(v);\r\n                    }\r\n                }\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                initValue: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n                curve: brushInterface.opacitySlider.curve,\r\n                formatFunc: function(v) {\r\n                    return Math.round(v * 100);\r\n                }\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                })\r\n            );\r\n\r\n            let alphaWrapper = document.createElement(\"div\");\r\n            for (let i = 0; i < alphas.length; i++) {\r\n                alphaWrapper.appendChild(alphas[i]);\r\n            }\r\n            alphaWrapper.style.marginTop = \"10px\";\r\n            div.appendChild(alphaWrapper);\r\n            alphaWrapper.appendChild(lockAlphaToggle.getElement());\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.increaseValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.decreaseValue(f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","\r\nexport const eventResMs = 20;","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iiCd6\");","import {BB} from '../../bb/bb';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-blend.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const blendBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-blend'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-blend');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.BlendBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                initValue: 58 / 2,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                curve: brushInterface.sizeSlider.curve,\r\n                formatFunc: function (v) {\r\n                    v *= 2;\r\n                    return Math.round(v);\r\n                }\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                initValue: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n                formatFunc: function(v) {\r\n                    return Math.round(v * 100);\r\n                }\r\n            });\r\n            let blendingSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 225,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                initValue: brush.getBlending() * 100,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val / 100);\r\n                }\r\n            });\r\n            blendingSlider.getElement().style.marginTop = \"10px\";\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.setSizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.setOpacityPressure(b);\r\n            });\r\n\r\n            let lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('brush-lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('brush-lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                    display: 'inline-block',\r\n                }\r\n            });\r\n\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                }),\r\n                blendingSlider.getElement(),\r\n                lockAlphaToggle.getElement()\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.increaseValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.decreaseValue(f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y, p, isCoalesced);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6fRlX\");","import {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-sketchy.png';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const sketchyBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-sketchy'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 10\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-sketchy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.SketchyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                initValue: brush.getSize(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setSize(val);\r\n                    p.onSizeChange(brush.getSize());\r\n                },\r\n                formatFunc: function (v) {\r\n                    v *= 2;\r\n                    if (v < 10) {\r\n                        return Math.round(v * 10) / 10;\r\n                    } else {\r\n                        return Math.round(v);\r\n                    }\r\n                }\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                initValue: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n                formatFunc: function(v) {\r\n                    return Math.round(v * 100);\r\n                }\r\n            });\r\n            let blendSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                initValue: brush.getBlending() * 100,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val / 100);\r\n                }\r\n            });\r\n            let scaleSlider = new KlSlider({\r\n                label: LANG('brush-sketchy-scale'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 1,\r\n                max: 20,\r\n                initValue: brush.getScale(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setScale(val);\r\n                }\r\n            });\r\n            opacitySlider.getElement().style.marginTop = \"10px\";\r\n            blendSlider.getElement().style.marginTop = \"10px\";\r\n            scaleSlider.getElement().style.marginTop = \"10px\";\r\n            div.appendChild(sizeSlider.getElement());\r\n            div.appendChild(opacitySlider.getElement());\r\n            div.appendChild(blendSlider.getElement());\r\n            div.appendChild(scaleSlider.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.increaseValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.decreaseValue(f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, pressure) {\r\n            brush.startLine(x, y, pressure);\r\n        };\r\n        this.goLine = function (x, y, pressure) {\r\n            brush.goLine(x, y, pressure, null);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getSeed = function () {\r\n            return parseInt(brush.getSeed());\r\n        };\r\n        this.setSeed = function (s) {\r\n            brush.setSeed(parseInt(s));\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hC7PC\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pixel.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const pixelBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pixel'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 0,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pixel');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.PixelBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        let lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('brush-lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('brush-lock-alpha-title'),\r\n            css: {\r\n                marginRight: '10px',\r\n            }\r\n        });\r\n\r\n        let eraserToggle = new Checkbox({\r\n            init: brush.getIsEraser(),\r\n            label: LANG('eraser'),\r\n            callback: function (b) {\r\n                brush.setIsEraser(b);\r\n            },\r\n            css: {\r\n                marginRight: '10px',\r\n            }\r\n        });\r\n\r\n        let ditherToggle = new Checkbox({\r\n            init: brush.getUseDither(),\r\n            label: LANG('brush-pixel-dither'),\r\n            callback: function (b) {\r\n                brush.setUseDither(b);\r\n            }\r\n        });\r\n\r\n        let spacingSpline = new BB.SplineInterpolator([[0.5, 0.45], [100, 4]]);\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                initValue: brush.getSize(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    val = Math.round(val * 2) / 2;\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                curve: brushInterface.sizeSlider.curve,\r\n                formatFunc: function (v) {\r\n                    v *= 2;\r\n                    return Math.round(v);\r\n                }\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                initValue: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n                curve: brushInterface.opacitySlider.curve,\r\n                formatFunc: function(v) {\r\n                    return Math.round(v * 100);\r\n                }\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                opacitySlider.getElement()\r\n            );\r\n\r\n            let toggleRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px'\r\n                }\r\n            });\r\n\r\n            toggleRow.appendChild(lockAlphaToggle.getElement());\r\n            toggleRow.appendChild(eraserToggle.getElement());\r\n            toggleRow.appendChild(ditherToggle.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.increaseValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.decreaseValue(f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eZgVv\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-eraser.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const eraserBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('eraser') + ' [E]',\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 200,\r\n            curve: BB.quadraticSplineInput(0.5, 200, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('eraser') + ' [E]';\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.EraserBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n        let isTransparentBg = false;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                initValue: 30,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                curve: brushInterface.sizeSlider.curve,\r\n                formatFunc: function (v) {\r\n                    v *= 2;\r\n                    if (v < 10) {\r\n                        return Math.round(v * 10) / 10;\r\n                    } else {\r\n                        return Math.round(v);\r\n                    }\r\n                }\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                initValue: 1,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n                formatFunc: function(v) {\r\n                    return Math.round(v * 100);\r\n                }\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                })\r\n            );\r\n\r\n            let transparencyToggle = new Checkbox({\r\n                init: false,\r\n                label: LANG('brush-eraser-transparent-bg'),\r\n                callback: function (b) {\r\n                    isTransparentBg = b;\r\n                    brush.setTransparentBG(b);\r\n                },\r\n                css: {\r\n                    marginTop: \"10px\",\r\n                }\r\n            });\r\n            div.appendChild(transparencyToggle.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        function drawDot(x, y) {\r\n            brush.drawDot(x, y);\r\n        }\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.increaseValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.decreaseValue(f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            //brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.getIsTransparentBg = function () {\r\n            return isTransparentBg;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        }\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fPZin\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-smudge.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const smudgeBrushUi = (function () {\r\n    let brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-smudge'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\r\n        },\r\n        opacitySlider: {\r\n            min: 0,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-smudge');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        let div = document.createElement(\"div\"); // the gui\r\n        let brush = new brushes.SmudgeBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        let lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('brush-lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('brush-lock-alpha-title'),\r\n        });\r\n\r\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                initValue: brush.getSize(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                curve: brushInterface.sizeSlider.curve,\r\n                formatFunc: function (v) {\r\n                    v *= 2;\r\n                    if (v < 10) {\r\n                        return Math.round(v * 10) / 10;\r\n                    } else {\r\n                        return Math.round(v);\r\n                    }\r\n                }\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                initValue: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n                curve: brushInterface.opacitySlider.curve,\r\n                formatFunc: function(v) {\r\n                    return Math.round(v * 100);\r\n                }\r\n            });\r\n\r\n            let pressureSizeToggle = penPressureToggle(false, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    }\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    }\r\n                })\r\n            );\r\n\r\n            let bottomRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            bottomRow.append(lockAlphaToggle.getElement());\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.increaseValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.decreaseValue(f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fp7H1\");","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\n// @ts-ignore\r\nimport brushIconImg from 'url:~/src/app/img/ui/brush-chemy.svg';\r\nimport {IBrushUi} from '../kl.types';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {BoxToggle} from '../ui/base-components/box-toggle';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const chemyBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-chemy'),\r\n        sizeSlider: {\r\n            min: 0.25,\r\n            max: 25,\r\n            curve: BB.quadraticSplineInput(0.25, 25, 0.1),\r\n            isDisabled: true,\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-chemy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement(\"div\"); // the gui\r\n        const brush = new brushes.ChemyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize(size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init() {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                initValue: brush.getSize(),\r\n                eventResMs: eventResMs,\r\n                isEnabled: brush.getMode() === 'stroke',\r\n                onChange: function (val) {\r\n                    setSize(val);\r\n                    p.onSizeChange(brush.getSize());\r\n                },\r\n                curve: brushInterface.sizeSlider.curve,\r\n                formatFunc: function (v) {\r\n                    v *= 2;\r\n                    return v < 5 ? (Math.round(v * 10) / 10) : Math.round(v);\r\n                }\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                initValue: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n                formatFunc: function(v) {\r\n                    return Math.round(v * 100);\r\n                }\r\n            });\r\n\r\n            BB.css(opacitySlider.getElement(), {\r\n                marginTop: '10px',\r\n            });\r\n\r\n            let eraserToggle = new Checkbox({\r\n                init: brush.getIsEraser(),\r\n                label: LANG('eraser'),\r\n                callback: function (b) {\r\n                    brush.setIsEraser(b);\r\n                },\r\n                css: {\r\n                    marginTop: '10px',\r\n                    marginLeft: '10px',\r\n                }\r\n            });\r\n\r\n            const lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('brush-lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('brush-lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n\r\n            const toggleRow = BB.el({\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n\r\n            const iconSize = 35;\r\n            const padding = 8;\r\n            const actualIconSize = iconSize - padding * 2;\r\n            const halfSize = actualIconSize / 2;\r\n\r\n            const modeOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'fill',\r\n                        label: BB.createSvg({\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: '#000',\r\n                                    style: `transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-fill'),\r\n                    },\r\n                    {\r\n                        id: 'stroke',\r\n                        label: BB.createSvg({\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: 'none',\r\n                                    stroke: '#000',\r\n                                    style: `stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-stroke'),\r\n                    }\r\n                ],\r\n                initId: brush.getMode(),\r\n                onChange: (id: string): void => {\r\n                    brush.setMode(id as 'stroke' | 'fill');\r\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === 'fill';\r\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\r\n                    sizeSlider.setValue(brush.getSize());\r\n                    p.onSizeChange(brush.getSize());\r\n                    p.onConfigChange();\r\n                }\r\n            });\r\n\r\n            const mirrorXToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`,\r\n                        },\r\n                    ]\r\n                }),\r\n                title: LANG('brush-chemy-mirror-x'),\r\n                init: brush.getXSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setXSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const mirrorYToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`,\r\n                        },\r\n                    ]\r\n                }),\r\n                title: LANG('brush-chemy-mirror-y'),\r\n                init: brush.getYSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setYSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const gradientToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'defs',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'linearGradient',\r\n                                    id: 'gradient',\r\n                                    x1: '0',\r\n                                    y1: '0',\r\n                                    x2: '0',\r\n                                    y2: '1',\r\n                                    childrenArr: [\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '0%',\r\n                                            'stop-color': 'rgba(0,0,0,0)',\r\n                                        },\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '100%',\r\n                                            'stop-color': 'rgba(0,0,0,1)',\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            elementType: 'rect',\r\n                            fill: \"url('#gradient')\",\r\n                            x: '' + padding,\r\n                            y: '' + padding,\r\n                            width: '' + actualIconSize,\r\n                            height: '' + actualIconSize,\r\n                        },\r\n                    ]\r\n                }),\r\n                title: LANG('brush-chemy-gradient'),\r\n                init: brush.getGradient(),\r\n                onChange: (b) => {\r\n                    brush.setGradient(b);\r\n                },\r\n            });\r\n\r\n            BB.css(mirrorXToggle.getElement(), {\r\n                marginLeft: '10px',\r\n            });\r\n            {\r\n                const margin = {\r\n                    marginLeft: '4px',\r\n                };\r\n                BB.css(mirrorYToggle.getElement(), margin);\r\n                BB.css(gradientToggle.getElement(), margin);\r\n            }\r\n\r\n            toggleRow.append(\r\n                modeOptions.getElement(),\r\n                mirrorXToggle.getElement(),\r\n                mirrorYToggle.getElement(),\r\n                gradientToggle.getElement(),\r\n            );\r\n\r\n            div.append(\r\n                sizeSlider.getElement(),\r\n                opacitySlider.getElement(),\r\n                toggleRow,\r\n                BB.el({\r\n                    content: [\r\n                        lockAlphaToggle.getElement(),\r\n                        eraserToggle.getElement(),\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                    }\r\n                })\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.increaseValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.decreaseValue(f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function(size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function(opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eX098\");","import {BB} from '../../../bb/bb';\r\n\r\nexport class BoxToggle {\r\n    el: HTMLElement;\r\n    value: boolean;\r\n\r\n    update (): void {\r\n        this.el.classList.toggle('kl-box-toggle--active', this.value);\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            label: string | HTMLElement | SVGElement;\r\n            title?: string;\r\n            init?: boolean;\r\n            onChange: (b: boolean) => void;\r\n        }\r\n    ) {\r\n        this.value = !!p.init;\r\n        this.el = BB.el({\r\n            content: p.label,\r\n            title: p.title,\r\n            className: (typeof p.label === 'string') ? 'kl-box-toggle' : 'kl-box-toggle kl-box-toggle--custom-el',\r\n            onClick: () => {\r\n                this.value = !this.value;\r\n                this.update();\r\n                p.onChange(this.value);\r\n            },\r\n            css: {\r\n                cursor: 'pointer',\r\n            }\r\n        });\r\n        if (typeof p.label !== 'string') {\r\n            BB.css(p.label, {\r\n                display: 'block',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n        this.update();\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.value;\r\n    }\r\n\r\n    setValue (b: boolean): void {\r\n        this.value = !!b;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.el);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {Popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showIframePopup(url, isEmbed) {\r\n    if (!isEmbed && (window.innerHeight < 500 || window.innerWidth < 700)) {\r\n        window.open(url);\r\n        return;\r\n    }\r\n\r\n    let iframe = BB.el({\r\n        tagName: 'iframe',\r\n        custom: {\r\n            src: url,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            height: '100%'\r\n        }\r\n    }) as HTMLIFrameElement;\r\n    let titleEl = BB.el({});\r\n\r\n    let linkEl;\r\n    if (!isEmbed) {\r\n        linkEl = BB.el({\r\n            tagName: 'a',\r\n            parent: titleEl,\r\n            content: LANG('modal-new-tab'),\r\n            custom: {\r\n                href: 'help',\r\n                target: '_blank',\r\n            },\r\n            onClick: function() {\r\n                popup.close();\r\n            }\r\n        }) as HTMLAnchorElement;\r\n        iframe.onload = function() {\r\n            BB.setAttributes(linkEl, {\r\n                href: '' + iframe.contentWindow.location,\r\n            });\r\n        };\r\n    }\r\n\r\n\r\n    let popup = new Popup({\r\n        title: titleEl,\r\n        content: iframe,\r\n        width: 880,\r\n        isMaxHeight: true,\r\n        onClose: () => {\r\n            if (linkEl) {\r\n                BB.destroyEl(linkEl);\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nexport class RadioList {\r\n\r\n    el: HTMLDivElement;\r\n    inputs: HTMLInputElement[] = [];\r\n\r\n    constructor({name, init, items, ignoreFocus}: {\r\n        name: string;\r\n        init?: string;\r\n        items: {\r\n            label: string;\r\n            value: string;\r\n        }[],\r\n        ignoreFocus?: boolean; // default false\r\n    }) {\r\n        this.el = BB.el({\r\n            className: 'kl-radio'\r\n        }) as HTMLDivElement;\r\n\r\n        items.forEach(item => {\r\n            let label = BB.el({\r\n                tagName: 'label'\r\n            });\r\n            let input = BB.el({\r\n                tagName: 'input',\r\n                parent: label,\r\n                custom: {\r\n                    name: name,\r\n                    value: item.value,\r\n                    type: 'radio',\r\n                }\r\n            }) as HTMLInputElement;\r\n            if (ignoreFocus) {\r\n                input.setAttribute('data-ignore-focus', 'true');\r\n            }\r\n            if (init === item.value) {\r\n                input.checked = true;\r\n            }\r\n            label.append(item.label);\r\n            this.el.append(label);\r\n            this.inputs.push(input);\r\n        });\r\n    }\r\n\r\n\r\n    getValue(): string {\r\n        for (let i = 0; i < this.inputs.length; i++) {\r\n            if (this.inputs[i].checked) {\r\n                return this.inputs[i].value;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getElement() {\r\n        return this.el;\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n// @ts-ignore\r\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\r\nimport {IKlProject} from '../../kl.types';\r\nimport {showIframePopup} from '../modals/show-iframe-popup';\r\nimport {SaveReminder} from './save-reminder';\r\nimport {IProjectStoreListener, ProjectStore} from '../../storage/project-store';\r\nimport {KL} from '../../kl';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport class BrowserStorageUi {\r\n\r\n    private previewEl: HTMLDivElement;\r\n    private infoEl: HTMLDivElement;\r\n    private ageEl: HTMLDivElement;\r\n    private storeEl: HTMLButtonElement;\r\n    private clearEl: HTMLButtonElement;\r\n    private storeListener: IProjectStoreListener;\r\n\r\n    private timestamp: number;\r\n\r\n    private updateAge() {\r\n        if (!this.timestamp) {\r\n            return;\r\n        }\r\n        let age = new Date().getTime() - this.timestamp;\r\n        let ageStr;\r\n        age = Math.floor(age / 1000 / 60);\r\n        ageStr = LANG('file-storage-min-ago').replace('{x}', '' + age);\r\n        if (age > 60) {\r\n            age = Math.floor(age / 60);\r\n            ageStr = LANG('file-storage-hours-ago').replace('{x}', '' + age);\r\n            if (age > 24) {\r\n                age = Math.floor(age / 24);\r\n                ageStr = LANG('file-storage-days-ago').replace('{x}', '' + age);\r\n                if (age > 31) {\r\n                    ageStr = LANG('file-storage-month-ago');\r\n                }\r\n            }\r\n        }\r\n        this.ageEl.textContent = ageStr;\r\n    }\r\n\r\n    private resetButtons() {\r\n        if (this.timestamp) {\r\n            this.storeEl.textContent = LANG('file-storage-overwrite');\r\n            this.storeEl.disabled = false;\r\n            this.clearEl.disabled = false;\r\n        } else {\r\n            this.storeEl.textContent = LANG('file-storage-store');\r\n            this.storeEl.disabled = false;\r\n            this.clearEl.disabled = true;\r\n        }\r\n    }\r\n\r\n    private updateThumb(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.timestamp = timestamp;\r\n        if (this.timestamp) {\r\n            BB.css(thumbnail, {\r\n                display: 'block',\r\n                maxWidth: 'calc(100% - 2px)',\r\n                maxHeight: 'calc(100% - 2px)',\r\n                margin: '0 auto',\r\n                background: \"url('\" + BB.createCheckerCanvas(4).toDataURL('image/png') + \"')\",\r\n                boxShadow: '0 0 0 1px #aaa',\r\n                pointerEvents: 'none',\r\n            });\r\n            this.previewEl.innerHTML = '';\r\n            this.updateAge();\r\n            this.previewEl.append(thumbnail, this.ageEl);\r\n        } else {\r\n            this.previewEl.innerHTML = LANG('file-storage-empty');\r\n        }\r\n        this.resetButtons();\r\n    }\r\n\r\n    private async store() {\r\n        this.storeEl.textContent = LANG('file-storage-storing');\r\n        this.storeEl.disabled = true;\r\n        this.clearEl.disabled = true;\r\n        await new Promise((resolve) => {\r\n            setTimeout(() => resolve(null), 20);\r\n        });\r\n        try {\r\n            await this.projectStore.store(this.getProject());\r\n            this.saveReminder.reset();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: [\r\n                    `${LANG('file-storage-failed-1')}<ul>`,\r\n                    `<li>${LANG('file-storage-failed-2')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-3')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-4')}</li>`,\r\n                    `</ul>`,\r\n                ].join(''),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to store browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    private async clear() {\r\n        this.storeEl.disabled = true;\r\n        this.clearEl.disabled = true;\r\n        try {\r\n            await this.projectStore.clear();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: LANG('file-storage-failed-clear'),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to clear browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    element: HTMLDivElement;\r\n\r\n    constructor (\r\n        private projectStore: ProjectStore,\r\n        private getProject: () => IKlProject,\r\n        private saveReminder: SaveReminder,\r\n        private klRootEl: HTMLDivElement,\r\n        private options?: { hideClearButton?: boolean },\r\n    ) {\r\n        this.element = BB.el({\r\n            css: {\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 0fr',\r\n                gridTemplateRows: '0fr 0fr 0fr',\r\n                gap: '0 0',\r\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"',\r\n            }\r\n        }) as HTMLDivElement;\r\n\r\n\r\n        const title = BB.el({\r\n            parent: this.element,\r\n            content: LANG('file-storage'),\r\n            css: {\r\n                gridArea: 'title',\r\n                display: 'flex',\r\n                margin: '-5px 0',\r\n                //background: '#f00',\r\n            }\r\n        });\r\n\r\n        this.infoEl = BB.el({\r\n            parent: title,\r\n            content: '?',\r\n            title: LANG('file-storage-about'),\r\n            css: {\r\n                cursor: 'pointer',\r\n                marginLeft: '5px',\r\n                width: '19px',\r\n                height: '19px',\r\n                borderRadius: '100%',\r\n                textAlign: 'center',\r\n                lineHeight: '19px',\r\n                fontWeight: 'bold',\r\n                boxShadow: 'inset 0 0 0 1px #000',\r\n            },\r\n            onClick: () => {\r\n                showIframePopup('./help/#help-browser-storage', false);\r\n            }\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.projectStore.isBroken()) {\r\n            BB.el({\r\n                parent: this.element,\r\n                content: \" \" + LANG('file-storage-cant-access'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            return;\r\n        }\r\n\r\n        this.previewEl = BB.el({\r\n            parent: this.element,\r\n            title: LANG('file-storage-thumb-title'),\r\n            css: {\r\n                gridArea: 'preview',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                marginTop: '10px',\r\n                position: 'relative',\r\n                boxShadow: 'inset 0 0 0 1px #aaa',\r\n                background: '#cdcdcd',\r\n                color: '#545454',\r\n                colorScheme: 'only light',\r\n                minHeight: '67px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        this.ageEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                right: '0',\r\n                bottom: '0',\r\n                width: '100%',\r\n                textAlign: 'center',\r\n                background: 'rgba(0,0,0,0.7)',\r\n                color: '#fff',\r\n                textSize: '13px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        this.storeEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'gridButton',\r\n            content: LANG('file-storage-store'),\r\n            css: {\r\n                gridArea: 'store',\r\n                //background: '#00f',\r\n            },\r\n            custom: {\r\n                tabIndex: -1,\r\n            },\r\n            onClick: () => this.store(),\r\n        }) as HTMLButtonElement;\r\n        this.storeEl.tabIndex = -1;\r\n        this.clearEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'gridButton',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/> ' + LANG('file-storage-clear'),\r\n            css: {\r\n                gridArea: 'clear',\r\n                //background: '#ff0',\r\n            },\r\n            custom: {\r\n                tabIndex: -1,\r\n            },\r\n            onClick: () => this.clear(),\r\n        }) as HTMLButtonElement;\r\n\r\n        if (this.options?.hideClearButton) {\r\n            this.clearEl.style.display = 'none';\r\n        }\r\n\r\n        this.storeListener = {\r\n            onUpdate: (timestamp, thumbnail) => {\r\n                this.updateThumb(timestamp, thumbnail);\r\n            },\r\n        };\r\n        this.projectStore.subscribe(this.storeListener);\r\n\r\n        setInterval(() => this.updateAge(), 1000 * 60);\r\n\r\n        (async () => {\r\n            try {\r\n                const readResult = await this.projectStore.read();\r\n                if (readResult) {\r\n                    this.updateThumb(readResult.timestamp, readResult.thumbnail);\r\n                } else {\r\n                    this.updateThumb();\r\n                }\r\n            } catch (e) {\r\n                setTimeout(() => {\r\n                    throw new Error('storage-ui: failed initial read browser storage, ' + e);\r\n                }, 0);\r\n            }\r\n        })();\r\n    }\r\n\r\n\r\n    getElement() {\r\n        return this.element;\r\n    }\r\n\r\n    show () {\r\n        // todo\r\n    }\r\n\r\n    hide () {\r\n        // todo\r\n    }\r\n\r\n    destroy() {\r\n        BB.destroyEl(this.infoEl);\r\n        BB.destroyEl(this.storeEl);\r\n        BB.destroyEl(this.clearEl);\r\n        this.projectStore.unsubscribe(this.storeListener);\r\n    }\r\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\r\nimport {ProjectConverter} from './project-converter';\r\nimport {clear, getKlProjectObj, storeKlProjectObj} from './indexed-db';\r\nimport {LocalStorage} from '../../bb/base/local-storage';\r\n\r\n\r\nexport interface IProjectStoreListener {\r\n    onUpdate: (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) => void,\r\n}\r\n\r\nfunction makeAsync(func): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n        func(resolve, reject);\r\n    });\r\n}\r\n\r\n/**\r\n * simplified interface for storing projects into browser storage\r\n */\r\nexport class ProjectStore {\r\n\r\n    private listeners: IProjectStoreListener[] = [];\r\n    private accessHasFailed: boolean = false;\r\n\r\n    async lowLevelStore (project: IKlStorageProject): Promise<any> {\r\n        await new Promise((resolve, reject) => {\r\n            storeKlProjectObj(project, resolve, reject);\r\n        });\r\n    }\r\n\r\n    async lowLevelRead (): Promise<IKlStorageProject> {\r\n        return await makeAsync(getKlProjectObj) as IKlStorageProject;\r\n    }\r\n\r\n    async lowLevelClear (): Promise<any> {\r\n        await makeAsync(clear);\r\n    }\r\n\r\n\r\n\r\n    private emit(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.listeners.forEach(item => {\r\n            item.onUpdate(timestamp, thumbnail);\r\n        });\r\n    }\r\n\r\n    private updateTimestamp() {\r\n        LocalStorage.setItem('indexedDbUpdatedAt', '' + new Date().getTime());\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== 'indexedDbUpdatedAt' || this.listeners.length === 0) {\r\n                return;\r\n            }\r\n            try {\r\n                ( async () => {\r\n                    const readResult = await this.read();\r\n                    if (readResult) {\r\n                        this.emit(readResult.timestamp, readResult.thumbnail);\r\n                    } else {\r\n                        this.emit();\r\n                    }\r\n                })();\r\n            } catch (e) {\r\n                if (e.message.indexOf('db-error') === 0) {\r\n                    this.accessHasFailed = true;\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    async read(): Promise<{\r\n        project: IKlProject,\r\n        timestamp: number,\r\n        thumbnail: HTMLImageElement | HTMLCanvasElement\r\n    } | null> {\r\n        let storageProject;\r\n        try {\r\n            storageProject = await this.lowLevelRead();\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        if (!storageProject) {\r\n            return null;\r\n        }\r\n        let result;\r\n        try {\r\n            result = await ProjectConverter.readStorageProject(storageProject);\r\n        } catch (e) {\r\n            throw new Error('format-error: ' + e);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    async store(project: IKlProject): Promise<void> {\r\n        try {\r\n            const storageProject = ProjectConverter.createStorageProject(project);\r\n            await this.lowLevelStore(storageProject);\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        {\r\n            // immediately test if it can be read\r\n            const storageProject = await this.lowLevelRead();\r\n            let readResult = null;\r\n            try {\r\n                readResult = await ProjectConverter.readStorageProject(storageProject);\r\n            } catch (e) {\r\n                await this.lowLevelClear();\r\n                this.updateTimestamp();\r\n                setTimeout(() => this.emit(), 0);\r\n                throw new Error('format-error: ' + e);\r\n            }\r\n            this.updateTimestamp();\r\n            setTimeout(() => this.emit(readResult.timestamp, readResult.thumbnail), 0);\r\n        }\r\n    }\r\n\r\n    async clear(): Promise<void> {\r\n        await this.lowLevelClear();\r\n        this.updateTimestamp();\r\n        setTimeout(() => this.emit(), 0);\r\n    }\r\n\r\n    subscribe(listener: IProjectStoreListener) {\r\n        if (this.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        this.listeners.push(listener);\r\n    }\r\n\r\n    unsubscribe(listener: IProjectStoreListener) {\r\n        for (let i = 0; i < this.listeners.length; i++) {\r\n            if (listener === this.listeners[i]) {\r\n                this.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    isBroken() {\r\n        return this.accessHasFailed;\r\n    }\r\n\r\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\r\nimport {BB} from '../../bb/bb';\r\nimport {drawProject} from '../canvas/draw-project';\r\nimport {base64ToBlob} from './base-64-to-blob';\r\n\r\n\r\nconst thumbSize = 240;\r\n\r\nfunction loadImage(blob: Blob): Promise<HTMLImageElement> {\r\n    return new Promise<HTMLImageElement>((resolve, reject) => {\r\n        const im = new Image();\r\n        try {\r\n            im.src = BB.imageBlobToUrl(blob);\r\n        } catch (e) {\r\n            reject('imageBlobToUrl, ' + e.message);\r\n            return;\r\n        }\r\n        im.onload = () => {\r\n            URL.revokeObjectURL(im.src);\r\n            resolve(im);\r\n        }\r\n        im.onabort = function () {\r\n            reject('layer image failed loading');\r\n        };\r\n        im.onerror = function () {\r\n            reject('layer image failed loading');\r\n        };\r\n    });\r\n}\r\n\r\n/**\r\n * for:\r\n * - preparing project to be stored in ProjectStore\r\n * - reading a project that came out of the ProjectStore\r\n */\r\nexport class ProjectConverter {\r\n\r\n    private static createThumbnail(project): HTMLCanvasElement {\r\n        const size = BB.fitInto(project.width, project.height, thumbSize, thumbSize);\r\n        const factor = size.width / project.width;\r\n        return drawProject(project, factor);\r\n    }\r\n\r\n    static createStorageProject(project: IKlProject): IKlStorageProject {\r\n        return {\r\n            id: 1,\r\n            timestamp: new Date().getTime(),\r\n            thumbnail: base64ToBlob(ProjectConverter.createThumbnail(project).toDataURL('image/png')),\r\n            width: project.width,\r\n            height: project.height,\r\n            layers: project.layers.map(item => {\r\n                let blob;\r\n                if (item.image instanceof HTMLCanvasElement) {\r\n                    blob = base64ToBlob((item.image as HTMLCanvasElement).toDataURL('image/png'));\r\n                } else {\r\n                    // todo image\r\n                    throw new Error('Not implemented');\r\n                }\r\n                return {\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                    blob,\r\n                }\r\n            }),\r\n        };\r\n    }\r\n\r\n    static async readStorageProject(storageProject: IKlStorageProject): Promise<{\r\n        project: IKlProject,\r\n        timestamp: number,\r\n        thumbnail: HTMLImageElement | HTMLCanvasElement\r\n    }> {\r\n        if (\r\n            !storageProject.width || !storageProject.height ||\r\n            isNaN(storageProject.width) || isNaN(storageProject.height) ||\r\n            storageProject.width < 1 || storageProject.height < 1\r\n        ) {\r\n            throw new Error('readStorageProject invalid canvas size: ' + storageProject.width + ', ' + storageProject.height);\r\n        }\r\n        const project: IKlProject = {\r\n            width: storageProject.width,\r\n            height: storageProject.height,\r\n            layers: (await Promise.all(storageProject.layers.map(layer => loadImage(layer.blob))))\r\n                .map((image, i) => {\r\n                    return {\r\n                        name: storageProject.layers[i].name,\r\n                        opacity: storageProject.layers[i].opacity,\r\n                        mixModeStr: storageProject.layers[i].mixModeStr,\r\n                        image,\r\n                    };\r\n                }),\r\n        };\r\n\r\n        let thumbnail;\r\n        if (storageProject.thumbnail) {\r\n            thumbnail = await loadImage(storageProject.thumbnail);\r\n        } else {\r\n            thumbnail = ProjectConverter.createThumbnail(project);\r\n        }\r\n\r\n        return {\r\n            project: project,\r\n            timestamp: storageProject.timestamp,\r\n            thumbnail: thumbnail,\r\n        };\r\n    }\r\n\r\n}","\r\nexport function base64ToBlob(base64Str: string): Blob {\r\n    let parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n    let binStr = atob(parts[3]);\r\n    let buf = new ArrayBuffer(binStr.length);\r\n    let view = new Uint8Array(buf);\r\n    for (let i = 0; i < view.length; i++) {\r\n        view[i] = binStr.charCodeAt(i);\r\n    }\r\n    return new Blob([view], {'type': parts[1]});\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\n// @ts-ignore\r\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\r\nimport {BrowserStorageUi} from '../components/browser-storage-ui';\r\nimport {IKlProject} from '../../kl.types';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport type exportType = 'png' | 'layers' | 'psd';\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport class FileTab {\r\n\r\n    private readonly div: HTMLDivElement;\r\n    private importButton: HTMLInputElement;\r\n    private fileBrowserStorage: BrowserStorageUi;\r\n\r\n    constructor(\r\n        klRootEl,\r\n        projectStore: ProjectStore,\r\n        getProject: () => IKlProject,\r\n        private exportType,\r\n        onExportTypeChange,\r\n        onFileSelect,\r\n        onSaveImageToComputer,\r\n        onNewImage,\r\n        onShareImage,\r\n        onUpload,\r\n        onCopyToClipboard,\r\n        saveReminder: SaveReminder,\r\n    ) {\r\n        const _this = this;\r\n        this.div = document.createElement(\"div\");\r\n\r\n        const asyncCreation = () => {\r\n            let filemenu = document.createElement(\"div\");\r\n            let newButton = document.createElement(\"button\");\r\n            let saveButton = document.createElement(\"button\");\r\n            let shareButton = document.createElement(\"button\");\r\n            let uploadImgurButton = document.createElement(\"button\");\r\n            let clipboardButton = document.createElement(\"button\");\r\n\r\n            newButton.style.cssFloat = 'left';\r\n            BB.css(saveButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n            });\r\n            BB.css(clipboardButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n            });\r\n\r\n            newButton.tabIndex = -1;\r\n            saveButton.tabIndex = -1;\r\n            shareButton.tabIndex = -1;\r\n            uploadImgurButton.tabIndex = -1;\r\n            clipboardButton.tabIndex = -1;\r\n\r\n            newButton.innerHTML = `<img src='${newImageImg}' alt='icon' height='20'/>${LANG('file-new')}`;\r\n            saveButton.innerHTML = `<img src='${exportImg}' alt='icon' height='20'/>${LANG('file-save')}`;\r\n            shareButton.innerHTML = `<img src='${shareImg}' alt='icon' height='20'/>${LANG('file-share')}`;\r\n            uploadImgurButton.innerHTML = `<img style='float:left' src='${uploadImg}' height='20' alt='icon'/>${LANG('file-upload')}`;\r\n            clipboardButton.innerHTML = `<img src='${copyImg}' alt='icon' height='20'/>${LANG('file-copy')}`;\r\n            clipboardButton.title = LANG('file-copy-title');\r\n            newButton.className = \"gridButton\";\r\n            saveButton.className = \"gridButton\";\r\n            shareButton.className = \"gridButton\";\r\n            uploadImgurButton.className = \"gridButton\";\r\n            clipboardButton.className = \"gridButton\";\r\n\r\n\r\n            this.importButton = document.createElement(\"input\");\r\n            this.importButton.tabIndex = -1;\r\n            this.importButton.type = \"file\";\r\n            this.importButton.multiple = true;\r\n            this.importButton.accept = \"image\";\r\n            (this.importButton as any).size = \"71\";\r\n            this.importButton.textContent = \"Import\";\r\n            let importWrapper: any = this.importButton;\r\n\r\n            function createImportButton() {\r\n                importWrapper = document.createElement(\"div\");\r\n                importWrapper.className = \"gridButton\";\r\n                importWrapper.style.position = \"relative\";\r\n                importWrapper.style.cursor = \"pointer\";\r\n                importWrapper.style.cssFloat = \"left\";\r\n\r\n                let innerMask = document.createElement(\"div\");\r\n                innerMask.style.width = \"120px\";\r\n                innerMask.style.height = \"28px\";\r\n                innerMask.style.overflow = \"hidden\";\r\n                innerMask.style.cursor = \"pointer\";\r\n                innerMask.style.position = \"relative\";\r\n\r\n                importWrapper.appendChild(innerMask);\r\n                innerMask.appendChild(_this.importButton);\r\n\r\n                let importFakeButton = document.createElement(\"button\");\r\n                importFakeButton.innerHTML = \"<img style='float:left' height='20' src='\" + importImg + \"' alt='icon'/>\" + LANG('file-import');\r\n                importFakeButton.tabIndex = -1;\r\n\r\n                BB.css(importFakeButton, {\r\n                    width: \"120px\",\r\n                    display: \"box\",\r\n                    position: \"absolute\",\r\n                    left: '0',\r\n                    top: '0',\r\n                    cursor: \"pointer\"\r\n                });\r\n                BB.css(_this.importButton, {\r\n                    display: 'none'\r\n                });\r\n                importWrapper.appendChild(importFakeButton);\r\n\r\n                importFakeButton.onclick = function() {\r\n                    _this.importButton.click();\r\n                }\r\n            }\r\n\r\n            createImportButton();\r\n\r\n            this.importButton.onchange = function (e) {\r\n                onFileSelect(_this.importButton.files, 'default');\r\n                _this.importButton.value = \"\";\r\n\r\n            };\r\n\r\n\r\n            // --- export filetype dropdown ---\r\n            let exportTypeWrapper;\r\n            let exportTypeSelect;\r\n            {\r\n                exportTypeWrapper = BB.el({\r\n                    css: {\r\n                        fontSize: '15px',\r\n                        marginLeft: '10px',\r\n                        marginTop: '10px',\r\n                        cssFloat: 'left',\r\n                        width: 'calc(50% - 15px)',\r\n                        height: '30px'\r\n                    }\r\n                });\r\n                exportTypeSelect = new KL.Select({\r\n                    optionArr: [\r\n                        ['png', LANG('file-save-png')],\r\n                        ['psd', LANG('file-save-psd')],\r\n                        ['layers', LANG('file-save-layers')],\r\n                    ],\r\n                    initValue: exportType,\r\n                    onChange: function(val) {\r\n                        exportType = val;\r\n                        onExportTypeChange(exportType);\r\n                        onSaveImageToComputer();\r\n                    }\r\n                });\r\n                BB.css(exportTypeSelect.getElement(), {\r\n                    width: '120px',\r\n                    height: '30px'\r\n                });\r\n                exportTypeWrapper.appendChild(exportTypeSelect.getElement());\r\n\r\n            }\r\n\r\n\r\n\r\n            newButton.onclick = onNewImage;\r\n            saveButton.onclick = function () {\r\n                onSaveImageToComputer();\r\n            };\r\n            shareButton.onclick = function() {\r\n                shareButton.disabled = true;\r\n                onShareImage(() => {\r\n                    shareButton.disabled = false;\r\n                });\r\n            };\r\n            uploadImgurButton.onclick = function () {\r\n                onUpload();\r\n            };\r\n\r\n            clipboardButton.onclick = function() {\r\n                clipboardButton.blur();\r\n                onCopyToClipboard();\r\n            };\r\n\r\n            let saveNote = document.createElement(\"div\");\r\n            saveNote.textContent = \" \" + LANG('file-no-autosave');\r\n            BB.css(saveNote, {\r\n                textAlign: \"center\",\r\n                marginTop: \"10px\",\r\n                background: \"rgb(243, 243, 161)\",\r\n                padding: \"5px 0px\",\r\n                color: 'rgba(0,0,0,0.65)',\r\n                fontSize: '15px',\r\n            });\r\n\r\n            function createSpacer() {\r\n                let el = document.createElement(\"div\");\r\n                let clearer = document.createElement(\"div\");\r\n                let line = document.createElement(\"div\");\r\n                el.appendChild(clearer);\r\n                el.appendChild(line);\r\n                BB.css(clearer, {\r\n                    clear: 'both'\r\n                });\r\n                BB.css(line, {\r\n                    marginLeft: \"10px\",\r\n                    marginRight: \"10px\",\r\n                    marginTop: \"10px\",\r\n                    borderBottom: \"1px solid rgba(0,0,0,0.2)\",\r\n                    clear: 'both'\r\n                });\r\n                return el;\r\n            }\r\n\r\n            _this.fileBrowserStorage = new BrowserStorageUi(projectStore, getProject, saveReminder, klRootEl);\r\n            BB.css(_this.fileBrowserStorage.getElement(), {\r\n                //background: 'red',\r\n                margin: '10px',\r\n            });\r\n\r\n\r\n            //actual structure\r\n            BB.append(filemenu, [\r\n                saveNote,\r\n                newButton,\r\n                importWrapper,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                saveButton,\r\n                exportTypeWrapper,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                clipboardButton,\r\n                BB.canShareFiles() ? shareButton : null,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                createSpacer(),\r\n                _this.fileBrowserStorage.getElement(),\r\n                createSpacer(),\r\n                uploadImgurButton,\r\n            ]);\r\n\r\n            this.div.appendChild(filemenu);\r\n        };\r\n\r\n        setTimeout(asyncCreation, 1);\r\n    }\r\n\r\n    refresh() {\r\n    }\r\n\r\n    getElement() {\r\n        return this.div;\r\n    }\r\n\r\n    setIsVisible(isVisible: boolean) {\r\n        if (isVisible) {\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    triggerImport() {\r\n        this.importButton.click();\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2oHM2\");","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\nimport {StatusOverlay} from '../components/status-overlay';\r\nimport {KlCanvasWorkspace} from '../../canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\nexport class FilterTab {\r\n\r\n    private readonly div: HTMLDivElement;\r\n    private isInit = false;\r\n\r\n    constructor (\r\n        private klRootEl,\r\n        private klColorSlider,\r\n        private layerManager,\r\n        private setCurrentLayer,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private handUi,\r\n        private getCurrentColor,\r\n        private getKlMaxCanvasSize,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx,\r\n        private isEmbed: boolean,\r\n        private statusOverlay: StatusOverlay,\r\n    ) {\r\n        this.div = document.createElement(\"div\");\r\n    }\r\n\r\n    private init() {\r\n        const _this = this;\r\n        let hasWebGl = BB.hasWebGl();\r\n        let filters = KL.filterLib;\r\n        let buttons = [];\r\n\r\n        BB.BbLog.emit({\r\n            type: 'init-filters',\r\n        });\r\n\r\n        if (!KL.filterLibStatus.isLoaded) {\r\n            throw new Error('filters not loaded');\r\n        }\r\n\r\n        function createButton(filterKey, filterArr) {\r\n            let button = document.createElement(\"button\");\r\n            let buttonLabel = filterArr[filterKey].buttonLabel ? filterArr[filterKey].buttonLabel : filterArr[filterKey].name;\r\n            let im = '<img height=\"20\" width=\"18\" src=\"' + filterArr[filterKey].icon + '\" alt=\"icon\" />';\r\n            button.innerHTML = im + buttonLabel;\r\n            button.className = \"gridButton\";\r\n            BB.css(button, {\r\n                lineHeight: '20px',\r\n                fontSize: '12px',\r\n            });\r\n            button.tabIndex = -1;\r\n            button.onclick = function () {\r\n\r\n                function finishedDialog(result, filterDialog) {\r\n                    if (result == \"Cancel\") {\r\n                        if (filterDialog.destroy) {\r\n                            filterDialog.destroy();\r\n                        }\r\n                        return;\r\n                    }\r\n                    let input;\r\n                    try {\r\n                        input = filterDialog.getInput(); // also destroys\r\n                    } catch (e) {\r\n                        if (e.message.indexOf('.getInput is not a function') !== -1) {\r\n                            throw 'filterDialog.getInput is not a function, filter: ' + filterArr[filterKey].name;\r\n                        } else {\r\n                            throw e;\r\n                        }\r\n                    }\r\n                    applyFilter(input);\r\n                }\r\n\r\n                if (!('apply' in filterArr[filterKey])) {\r\n                    alert('Application not fully loaded');\r\n                    return;\r\n                }\r\n\r\n                function applyFilter(input) {\r\n                    let filterResult = filterArr[filterKey].apply({\r\n                        context: _this.getCurrentLayerCtx(),\r\n                        canvas: _this.getKlCanvas(),\r\n                        history: klHistory,\r\n                        input: input\r\n                    });\r\n                    if (filterResult === false) {\r\n                        alert(\"Couldn't apply the edit action\");\r\n                    }\r\n                    if (filterArr[filterKey].updateContext === true) {\r\n                        _this.setCurrentLayer(_this.getKlCanvas().getLayer(_this.layerManager.getSelected()));\r\n                    }\r\n                    if (filterArr[filterKey].updatePos === true) {\r\n                        _this.klCanvasWorkspace.resetView();\r\n                        _this.handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                    _this.layerManager.update();\r\n                }\r\n\r\n                if (filterArr[filterKey].isInstant){\r\n                    button.blur();\r\n                    applyFilter(null);\r\n                    _this.statusOverlay.out('\"' + filterArr[filterKey].name + '\" ' + LANG('filter-applied'), true);\r\n                } else {\r\n                    let secondaryColorRGB = _this.klColorSlider.getSecondaryRGB();\r\n                    let filterDialog = filterArr[filterKey].getDialog({\r\n                        context: _this.getCurrentLayerCtx(),\r\n                        canvas: _this.getKlCanvas(),\r\n                        maxWidth: _this.getKlMaxCanvasSize(),\r\n                        maxHeight: _this.getKlMaxCanvasSize(),\r\n                        currentColorRgb: {r: _this.getCurrentColor().r, g: _this.getCurrentColor().g, b: _this.getCurrentColor().b},\r\n                        secondaryColorRgb: {r: secondaryColorRGB.r, g: secondaryColorRGB.g, b: secondaryColorRGB.b}\r\n                    });\r\n\r\n                    if (!filterDialog) {\r\n                        return;\r\n                        //alert('Error: could not perform action');\r\n                        //throw('filter['+filterKey+'].getDialog returned '+filterDialog+'. ctx:' + currentLayerCtx + ' klCanvas:' + klCanvas);\r\n                    }\r\n\r\n                    let closefunc;\r\n                    filterDialog.errorCallback = function(e) {\r\n                        setTimeout(function() {\r\n                            alert('Error: could not perform action');\r\n                            throw e;\r\n                        }, 0);\r\n                        closefunc();\r\n                    };\r\n\r\n\r\n                    let style: IKeyString = {};\r\n                    if ('width' in filterDialog) {\r\n                        style.width = filterDialog.width + 'px'\r\n                    }\r\n\r\n                    KL.popup({\r\n                        target: _this.klRootEl,\r\n                        message: \"<b>\" + filterArr[filterKey].name + \"</b>\",\r\n                        div: filterDialog.element,\r\n                        style: style,\r\n                        buttons: [\"Ok\", \"Cancel\"],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: function(result) {\r\n                            finishedDialog(result, filterDialog);\r\n                        },\r\n                        closefunc: function (func) {\r\n                            closefunc = func;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            buttons[buttons.length] = button;\r\n            return button;\r\n        }\r\n\r\n        function createDisabledButton(filterKey, filterArr) {\r\n            if (!filterArr[filterKey].webgl && !filterArr[filterKey].ieFails) {\r\n                return;\r\n            }\r\n            if (filterArr[filterKey].ieFails && navigator.appName !== 'Microsoft Internet Explorer') {\r\n                return;\r\n            }\r\n            let buttonLabel = filterArr[filterKey].buttonLabel ? filterArr[filterKey].buttonLabel : filterArr[filterKey].name;\r\n            let button = document.createElement(\"button\");\r\n            let im = '<img style=\"opacity: 0.5\" src=\"img/' + filterArr[filterKey].icon + '\" />';\r\n            let name = filterArr[filterKey].name;\r\n            if (name.length > 11) {\r\n                name = \"<span style='font-size: 12px'>\" + buttonLabel + \"</span>\";\r\n            }\r\n            button.innerHTML = im + name;\r\n            button.className = \"gridButton\";\r\n            button.disabled = true;\r\n            return button;\r\n        }\r\n\r\n        function addGroup(groupArr, filterArr, targetEl) {\r\n            for (let filterKey in filterArr) {\r\n                if (filterArr.hasOwnProperty[filterKey] || !groupArr.includes(filterKey)) {\r\n                    continue;\r\n                }\r\n                if (_this.isEmbed && !filterArr[filterKey].inEmbed) {\r\n                    continue;\r\n                }\r\n                if ((filterArr[filterKey].webgl && hasWebGl)\r\n                    || (filterArr[filterKey].neededWithWebGL)\r\n                    || (!filterArr[filterKey].webgl && !hasWebGl)\r\n                    && !(filterArr[filterKey].ieFails && navigator.appName == 'Microsoft Internet Explorer')) {\r\n\r\n                    targetEl.appendChild(createButton(filterKey, filterArr));\r\n\r\n                } else {\r\n                    targetEl.appendChild(createDisabledButton(filterKey, filterArr));\r\n                    filterArr[filterKey] = undefined;\r\n                }\r\n            }\r\n        }\r\n\r\n        const groupA = [\r\n            'cropExtend',\r\n            'flip',\r\n            'glPerspective',\r\n            'resize',\r\n            'rotate',\r\n            'transform',\r\n        ];\r\n        const groupB = [\r\n            'glBrightnessContrast',\r\n            'glCurves',\r\n            'glHueSaturation',\r\n            'invert',\r\n            'glTiltShift',\r\n            'toAlpha',\r\n            'glBlur',\r\n            'glUnsharpMask',\r\n        ];\r\n        const groupC = [\r\n            'grid',\r\n        ];\r\n\r\n        addGroup(groupA, filters, _this.div);\r\n\r\n        _this.div.appendChild(BB.el({className: 'gridHr'}));\r\n        addGroup(groupB, filters, _this.div);\r\n        _this.div.appendChild(BB.el({className: 'gridHr'}));\r\n        addGroup(groupC, filters, _this.div);\r\n\r\n\r\n        if (!hasWebGl) {\r\n            let webglnote = BB.appendTextDiv(_this.div, \"Some actions are disabled because WebGL isn't working.\");\r\n            webglnote.style.margin = \"10px\";\r\n            BB.css(webglnote, {\r\n                fontSize: \"11px\",\r\n                color: \"#555\",\r\n                background: \"#ffe\",\r\n                padding: \"10px\",\r\n                borderRadius: \"10px\",\r\n                textAlign: \"center\"\r\n            });\r\n        }\r\n\r\n        this.isInit = true;\r\n    }\r\n\r\n    getElement() {\r\n        return this.div;\r\n    }\r\n\r\n    show() {\r\n        if (!this.isInit) {\r\n            this.init();\r\n        }\r\n        this.div.style.display = 'block';\r\n    }\r\n\r\n    hide() {\r\n        this.div.style.display = 'none';\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\n// @ts-ignore\r\nimport loadingImg from 'url:~/src/app/img/ui/loading.gif';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {base64ToBlob} from '../../storage/base-64-to-blob';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\nasync function upload(canvas, title, description, type: 'png' | 'jpeg', imgurKey: string): Promise<{deletehash: string}> {\r\n    let img = base64ToBlob(canvas.toDataURL(\"image/\" + type));\r\n\r\n    let w = window.open();\r\n    let label = w.document.createElement(\"div\");\r\n    let gif = w.document.createElement(\"img\");\r\n    gif.src = loadingImg;\r\n    label.appendChild(gif);\r\n    BB.css(gif, {\r\n        filter: \"invert(1)\"\r\n    });\r\n    w.document.body.style.backgroundColor = \"#121211\";\r\n    w.document.body.style.backgroundImage = \"linear-gradient(#2b2b2b 0%, #121211 50%)\";\r\n    w.document.body.style.backgroundRepeat = \"no-repeat\";\r\n    let labelText = w.document.createElement(\"div\");\r\n    labelText.style.marginTop = \"10px\";\r\n    label.appendChild(labelText);\r\n    labelText.textContent = LANG('upload-uploading');\r\n\r\n    w.document.body.appendChild(label);\r\n    BB.css(label, {\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n        marginTop: \"100px\",\r\n        fontFamily: \"Arial, sans-serif\",\r\n        fontSize: \"20px\",\r\n        textAlign: \"center\",\r\n        transition: \"opacity 0.3s ease-in-out\",\r\n        opacity: '0',\r\n        color: \"#ccc\"\r\n    });\r\n    setTimeout(function () {\r\n        label.style.opacity = '1';\r\n    }, 20);\r\n\r\n    let response;\r\n    try {\r\n        const formData = new FormData();\r\n        formData.append('title', title);\r\n        formData.append('description', description);\r\n        formData.append('image', img);\r\n        response = await fetch('https://api.imgur.com/3/image',  {\r\n            method: 'POST',\r\n            headers: {\r\n                Authorization: 'Client-ID ' + imgurKey,\r\n            },\r\n            body: formData\r\n        });\r\n\r\n    } catch (e) {\r\n        w.close();\r\n        throw new Error(e);\r\n    }\r\n    if (!response.ok) {\r\n        w.close();\r\n        throw new Error();\r\n    }\r\n    let data = (await response.json()).data;\r\n\r\n    w.location.href = (data as any).link.replace(/\\.(jpg|png)/, '');\r\n\r\n    return data;\r\n}\r\n\r\n\r\nexport function imgurUpload(klCanvas: KlCanvas, klRootEl, saveReminder: SaveReminder, imgurKey: string) {\r\n    if (!imgurKey) {\r\n        throw new Error('imgur key missing');\r\n    }\r\n\r\n    let inputTitle = document.createElement(\"input\");\r\n    inputTitle.type = \"text\";\r\n    inputTitle.value = LANG('upload-title-untitled');\r\n    let inputDescription = BB.el({\r\n        tagName: 'textarea',\r\n        custom: {\r\n            rows: 2,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            maxWidth: '100%',\r\n        },\r\n    }) as HTMLTextAreaElement;\r\n\r\n    let labelTitle = document.createElement(\"div\");\r\n    labelTitle.textContent = LANG('upload-name') + \":\";\r\n    let labelDescription = BB.el({\r\n        content: LANG('upload-caption') + ':',\r\n        css: {\r\n            marginTop: '10px',\r\n        }\r\n    });\r\n\r\n    let tos = document.createElement(\"div\");\r\n    tos.innerHTML = `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${LANG('upload-tos')}</a> ${LANG('upload-tos-2')}`;\r\n\r\n    const typeRadio = new KL.RadioList({\r\n        name: 'filetype',\r\n        init: 'jpeg',\r\n        items: [\r\n            { label: 'JPG', value: 'jpeg' },\r\n            { label: 'PNG', value: 'png' },\r\n        ],\r\n        ignoreFocus: true,\r\n    });\r\n    BB.css(typeRadio.getElement(), {\r\n        marginBottom: '10px',\r\n    });\r\n\r\n\r\n    let outDiv = document.createElement(\"div\");\r\n    let infoHint = document.createElement(\"div\");\r\n    infoHint.className = \"info-hint\";\r\n    infoHint.textContent = LANG('upload-link-notice');\r\n    outDiv.append(\r\n        infoHint,\r\n        typeRadio.getElement(),\r\n        labelTitle,\r\n        inputTitle,\r\n        labelDescription,\r\n        inputDescription,\r\n        tos\r\n    );\r\n    KL.popup({\r\n        target: klRootEl,\r\n        message: `<b>${LANG('upload-title')}</b>`,\r\n        type: \"upload\",\r\n        div: outDiv,\r\n        buttons: [LANG('upload-submit'), \"Cancel\"],\r\n        clickOnEnter: LANG('upload-submit'),\r\n        primaries: [LANG('upload-submit')],\r\n        autoFocus: LANG('upload-submit'),\r\n        callback: async function (val) {\r\n            if (val === LANG('upload-submit') || val === \"Yes\" || val === \"Ok\") {\r\n                try {\r\n                    const result = await upload(\r\n                        klCanvas.getCompleteCanvas(1),\r\n                        inputTitle.value,\r\n                        inputDescription.value,\r\n                        typeRadio.getValue() as 'png' | 'jpeg',\r\n                        imgurKey,\r\n                    );\r\n\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: \"ok\",\r\n                        message: `<h3>${LANG('upload-success')}</h3><br>${LANG('upload-delete')}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/<b>delete</b>/${result.deletehash}</a><br><br>`,\r\n                        buttons: [\"Ok\"]\r\n                    });\r\n                    saveReminder.reset();\r\n\r\n                } catch(e) {\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: \"error\",\r\n                        message: LANG('upload-failed'),\r\n                        buttons: [\"Ok\"]\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iGeXe\");","import {BB} from '../../bb/bb';\r\n\r\nlet agPsdLazy;\r\nexport async function loadAgPsd() {\r\n    if (!agPsdLazy) {\r\n        agPsdLazy = await import('ag-psd');\r\n        BB.BbLog.emit({\r\n            type: 'loaded-agpsd',\r\n        });\r\n    }\r\n    return agPsdLazy;\r\n}","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kNYzr\"))).then(() => parcelRequire('2m2jt'));","import {KL} from '../../kl';\r\nimport {BB} from '../../../bb/bb';\r\nimport {KlHistoryInterface} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\nimport {BrowserStorageUi} from './browser-storage-ui';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {IKlProject} from '../../kl.types';\r\n\r\n\r\nconst reminderTimelimitMs = 1000 * 60 * 20; // 20 minutes\r\nconst unsavedActionsLimit = 100; // number of actions user did since last save\r\n\r\n\r\n/**\r\n * remind user of saving, keep user aware of save state\r\n */\r\nexport class SaveReminder {\r\n    private lastSavedActionNumber: number = null;\r\n    private lastSavedAt: number;\r\n\r\n    private lastReminderShownAt: number;\r\n    private unsavedInterval;\r\n    private closeFunc: () => void;\r\n\r\n    showPopup (): void {\r\n        if (!this.projectStore || !this.getProject) {\r\n            throw new Error('projectStore and getProject need to be set');\r\n        }\r\n\r\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\r\n\r\n        const contentEl = BB.el({});\r\n\r\n        contentEl.append(\r\n            BB.el({\r\n                content: LANG(\r\n                    'save-reminder-text',\r\n                    {\r\n                        a: '<strong>' + min,\r\n                        b: '</strong>',\r\n                    }\r\n                ),\r\n                css: {\r\n                    marginBottom: '20px',\r\n                }\r\n            }),\r\n        );\r\n\r\n        const psdWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n            }\r\n        });\r\n        const storageWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n                paddingBottom: '0',\r\n            }\r\n        });\r\n        contentEl.append(psdWrapper, storageWrapper);\r\n\r\n\r\n        const psdBtn = BB.el({\r\n            tagName: 'button',\r\n            className: 'kl-button',\r\n            content: LANG('save-reminder-save-psd'),\r\n            onClick: () => this.onSaveAsPsd(),\r\n        });\r\n        psdWrapper.append(\r\n            psdBtn,\r\n            BB.el({\r\n                content: LANG('save-reminder-psd-layers'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            }),\r\n        );\r\n\r\n\r\n        const storageUi = new BrowserStorageUi(\r\n            this.projectStore,\r\n            this.getProject,\r\n            this,\r\n            document.body as any,\r\n            {\r\n                hideClearButton: true,\r\n            }\r\n        );\r\n        storageWrapper.append(storageUi.getElement());\r\n\r\n\r\n        KL.popup({\r\n            target: document.body,\r\n            message: `<b>${LANG('save-reminder-title')}</b>`,\r\n            div: contentEl,\r\n            ignoreBackground: true,\r\n            callback: () => {\r\n                storageUi.destroy();\r\n                BB.destroyEl(psdBtn);\r\n                this.closeFunc = null;\r\n                this.lastReminderShownAt = performance.now();\r\n            },\r\n            closefunc: (f) => {\r\n                this.closeFunc = f;\r\n            }\r\n        });\r\n        setTimeout(() => {\r\n            psdBtn.focus();\r\n        }, 40);\r\n    }\r\n\r\n    constructor (\r\n        private history: KlHistoryInterface,\r\n        private showReminder: boolean,\r\n        private changeTitle: boolean,\r\n        private onSaveAsPsd: () => void,\r\n        private isDrawing: () => boolean,\r\n        private projectStore: ProjectStore | null, // needed if showReminder\r\n        private getProject: (() => IKlProject) | null, // needed if showReminder\r\n        private title: string = 'Klecks',\r\n    ) { }\r\n\r\n    init (): void {\r\n        if (this.lastSavedActionNumber !== null) { // already initialized\r\n            return;\r\n        }\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n\r\n        if (this.showReminder) {\r\n            setInterval(() => {\r\n                if (document.visibilityState !== 'visible') {\r\n                    return;\r\n                }\r\n\r\n                let unsavedActions = Math.abs(this.history.getActionNumber() - this.lastSavedActionNumber);\r\n\r\n                if (\r\n                    KL.dialogCounter.get() === 0 &&\r\n                    !this.isDrawing() &&\r\n                    this.lastReminderShownAt + reminderTimelimitMs < performance.now() &&\r\n                    unsavedActions >= unsavedActionsLimit\r\n                ) {\r\n                    this.showPopup();\r\n                }\r\n            }, 1000 * 5);\r\n        }\r\n\r\n        // confirmation dialog when closing tab\r\n        function onBeforeUnload(e) {\r\n            e.preventDefault();\r\n            e.returnValue = '';\r\n        }\r\n\r\n        this.history.addListener(() => {\r\n            let actionNumber = this.history.getActionNumber();\r\n            if (this.lastSavedActionNumber !== actionNumber) {\r\n                BB.setEventListener(window, 'onbeforeunload', onBeforeUnload);\r\n            } else {\r\n                BB.setEventListener(window, 'onbeforeunload', null);\r\n            }\r\n        });\r\n\r\n        if (this.changeTitle) {\r\n            document.addEventListener(\"visibilitychange\", () => {\r\n                if (document.visibilityState === 'visible') {\r\n                    document.title = this.title;\r\n                    clearInterval(this.unsavedInterval);\r\n                } else {\r\n                    let actionNumber = this.history.getActionNumber();\r\n                    if (this.lastSavedActionNumber !== actionNumber) {\r\n                        document.title = LANG('unsaved') + ' - ' + this.title;\r\n                        let state = 0;\r\n                        this.unsavedInterval = setInterval(() => {\r\n                            state = (state + 1) % 2;\r\n                            if (state === 1) {\r\n                                document.title = LANG('unsaved') + '  ' + this.title;\r\n                            } else {\r\n                                document.title = LANG('unsaved') + ' - ' + this.title;\r\n                            }\r\n                        }, 1000 * 60 * 3);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    reset (): void {\r\n        if (this.lastSavedActionNumber === null) { // not initialized\r\n            return;\r\n        }\r\n\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n        BB.setEventListener(window, 'onbeforeunload', null);\r\n\r\n        if (this.closeFunc) {\r\n            this.closeFunc();\r\n        }\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {KL} from '../kl';\r\nimport {saveAs} from 'file-saver';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\n\r\nexport class SaveToComputer {\r\n\r\n    constructor(\r\n        private saveReminder,\r\n        private klRootEl,\r\n        private getExportType,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private filenameBase: string,\r\n    ) {}\r\n\r\n    save(format?: 'psd' | 'layers' | 'png') {\r\n        const _this = this;\r\n\r\n        _this.saveReminder.reset();\r\n\r\n\r\n        function saveImage(canvas, filename, mimeType) {\r\n            let parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n            //assume base64 encoding\r\n            let binStr = atob(parts[3]);\r\n            //convert to binary in ArrayBuffer\r\n            let buf = new ArrayBuffer(binStr.length);\r\n            let view = new Uint8Array(buf);\r\n            for (let i = 0; i < view.length; i++) {\r\n                view[i] = binStr.charCodeAt(i);\r\n            }\r\n            let blob = new Blob([view], {'type': parts[1]});\r\n            saveAs(blob, filename);\r\n        }\r\n\r\n        if (!format) {\r\n            format = _this.getExportType();\r\n        }\r\n\r\n        if (format === 'png') {\r\n            let extension = 'png';\r\n            let mimeType = 'image/png';\r\n            let filename = BB.getDate() + this.filenameBase + \".\" + extension;\r\n            let fullCanvas = _this.getKlCanvas().getCompleteCanvas(1);\r\n\r\n            /*fullCanvas.toBlob(function(blob) {\r\n                if (blob === null) {\r\n                    throw 'save image error, blob is null';\r\n                }\r\n                saveAs(blob, filename);\r\n            }, mimetype);*/\r\n\r\n            //using old code, because saving somehow doesn't work for ipad before ios 13\r\n            //and it doesn't even throw an exception\r\n            try {\r\n                saveImage(fullCanvas, filename, mimeType);\r\n            } catch (error) { //fallback for old browsers\r\n                let im = new Image();\r\n                im.width = _this.getKlCanvas().getWidth();\r\n                im.height = _this.getKlCanvas().getHeight();\r\n                im.src = fullCanvas.toDataURL(mimeType);\r\n                KL.exportDialog(_this.klRootEl, im);\r\n            }\r\n        } else if (format === 'layers') {\r\n            let extension = 'png';\r\n            let mimeType = 'image/png';\r\n            let fileBase = BB.getDate() + this.filenameBase;\r\n            let layerArr = _this.getKlCanvas().getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                let item = layerArr[i];\r\n                let fnameArr = [\r\n                    fileBase,\r\n                    '_',\r\n                    ('' + (i + 1)).padStart(2, '0'),\r\n                    '_',\r\n                    item.name,\r\n                    '.',\r\n                    extension\r\n                ];\r\n                saveImage(item.canvas, fnameArr.join(''), mimeType);\r\n            }\r\n        } else if (format === 'psd') {\r\n\r\n            let layerArr = _this.getKlCanvas().getLayersFast();\r\n\r\n            let psdConfig = {\r\n                width: _this.getKlCanvas().getWidth(),\r\n                height: _this.getKlCanvas().getHeight(),\r\n                children: [],\r\n                canvas: _this.getKlCanvas().getCompleteCanvas(1)\r\n            };\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                let item = layerArr[i];\r\n                psdConfig.children.push({\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    canvas: item.canvas,\r\n                    blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n                    left: 0,\r\n                    top: 0\r\n                });\r\n            }\r\n\r\n            KL.loadAgPsd().then((agPsdLazy) => {\r\n                let buffer = agPsdLazy.writePsdBuffer(psdConfig);\r\n                let blob = new Blob([buffer], { type: 'application/octet-stream' });\r\n                saveAs(blob, BB.getDate() + this.filenameBase + '.psd');\r\n            }).catch(() => {\r\n                alert('Error: failed to load PSD library');\r\n            });\r\n\r\n        }\r\n\r\n    }\r\n\r\n}","/*\n* FileSaver.js\n* A saveAs() FileSaver implementation.\n*\n* By Eli Grey, http://eligrey.com\n*\n* License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)\n* source  : http://purl.eligrey.com/github/FileSaver.js\n*/\n\n// The one and only way of getting global scope in all environments\n// https://stackoverflow.com/q/3277182/1008999\nvar _global = typeof window === 'object' && window.window === window\n  ? window : typeof self === 'object' && self.self === self\n  ? self : typeof global === 'object' && global.global === global\n  ? global\n  : this\n\nfunction bom (blob, opts) {\n  if (typeof opts === 'undefined') opts = { autoBom: false }\n  else if (typeof opts !== 'object') {\n    console.warn('Deprecated: Expected third argument to be a object')\n    opts = { autoBom: !opts }\n  }\n\n  // prepend BOM for UTF-8 XML and text/* types (including HTML)\n  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n  if (opts.autoBom && /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n    return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type })\n  }\n  return blob\n}\n\nfunction download (url, name, opts) {\n  var xhr = new XMLHttpRequest()\n  xhr.open('GET', url)\n  xhr.responseType = 'blob'\n  xhr.onload = function () {\n    saveAs(xhr.response, name, opts)\n  }\n  xhr.onerror = function () {\n    console.error('could not download file')\n  }\n  xhr.send()\n}\n\nfunction corsEnabled (url) {\n  var xhr = new XMLHttpRequest()\n  // use sync to avoid popup blocker\n  xhr.open('HEAD', url, false)\n  try {\n    xhr.send()\n  } catch (e) {}\n  return xhr.status >= 200 && xhr.status <= 299\n}\n\n// `a.click()` doesn't work for all browsers (#465)\nfunction click (node) {\n  try {\n    node.dispatchEvent(new MouseEvent('click'))\n  } catch (e) {\n    var evt = document.createEvent('MouseEvents')\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,\n                          20, false, false, false, false, 0, null)\n    node.dispatchEvent(evt)\n  }\n}\n\n// Detect WebView inside a native macOS app by ruling out all browsers\n// We just need to check for 'Safari' because all other browsers (besides Firefox) include that too\n// https://www.whatismybrowser.com/guides/the-latest-user-agent/macos\nvar isMacOSWebView = _global.navigator && /Macintosh/.test(navigator.userAgent) && /AppleWebKit/.test(navigator.userAgent) && !/Safari/.test(navigator.userAgent)\n\nvar saveAs = _global.saveAs || (\n  // probably in some web worker\n  (typeof window !== 'object' || window !== _global)\n    ? function saveAs () { /* noop */ }\n\n  // Use download attribute first if possible (#193 Lumia mobile) unless this is a macOS WebView\n  : ('download' in HTMLAnchorElement.prototype && !isMacOSWebView)\n  ? function saveAs (blob, name, opts) {\n    var URL = _global.URL || _global.webkitURL\n    var a = document.createElement('a')\n    name = name || blob.name || 'download'\n\n    a.download = name\n    a.rel = 'noopener' // tabnabbing\n\n    // TODO: detect chrome extensions & packaged apps\n    // a.target = '_blank'\n\n    if (typeof blob === 'string') {\n      // Support regular links\n      a.href = blob\n      if (a.origin !== location.origin) {\n        corsEnabled(a.href)\n          ? download(blob, name, opts)\n          : click(a, a.target = '_blank')\n      } else {\n        click(a)\n      }\n    } else {\n      // Support blobs\n      a.href = URL.createObjectURL(blob)\n      setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s\n      setTimeout(function () { click(a) }, 0)\n    }\n  }\n\n  // Use msSaveOrOpenBlob as a second approach\n  : 'msSaveOrOpenBlob' in navigator\n  ? function saveAs (blob, name, opts) {\n    name = name || blob.name || 'download'\n\n    if (typeof blob === 'string') {\n      if (corsEnabled(blob)) {\n        download(blob, name, opts)\n      } else {\n        var a = document.createElement('a')\n        a.href = blob\n        a.target = '_blank'\n        setTimeout(function () { click(a) })\n      }\n    } else {\n      navigator.msSaveOrOpenBlob(bom(blob, opts), name)\n    }\n  }\n\n  // Fallback to using FileReader and a popup\n  : function saveAs (blob, name, opts, popup) {\n    // Open a popup immediately do go around popup blocker\n    // Mostly only available on user interaction and the fileReader is async so...\n    popup = popup || open('', '_blank')\n    if (popup) {\n      popup.document.title =\n      popup.document.body.innerText = 'downloading...'\n    }\n\n    if (typeof blob === 'string') return download(blob, name, opts)\n\n    var force = blob.type === 'application/octet-stream'\n    var isSafari = /constructor/i.test(_global.HTMLElement) || _global.safari\n    var isChromeIOS = /CriOS\\/[\\d]+/.test(navigator.userAgent)\n\n    if ((isChromeIOS || (force && isSafari) || isMacOSWebView) && typeof FileReader !== 'undefined') {\n      // Safari doesn't allow downloading of blob URLs\n      var reader = new FileReader()\n      reader.onloadend = function () {\n        var url = reader.result\n        url = isChromeIOS ? url : url.replace(/^data:[^;]*;/, 'data:attachment/file;')\n        if (popup) popup.location.href = url\n        else location = url\n        popup = null // reverse-tabnabbing #460\n      }\n      reader.readAsDataURL(blob)\n    } else {\n      var URL = _global.URL || _global.webkitURL\n      var url = URL.createObjectURL(blob)\n      if (popup) popup.location = url\n      else location.href = url\n      popup = null // reverse-tabnabbing #460\n      setTimeout(function () { URL.revokeObjectURL(url) }, 4E4) // 40s\n    }\n  }\n)\n\n_global.saveAs = saveAs.saveAs = saveAs\n\nif (typeof module !== 'undefined') {\n  module.exports = saveAs;\n}\n","import {KL} from '../kl';\r\nimport {IHistoryBroadcast, IHistoryEntry, klHistory} from './kl-history';\r\nimport {KlCanvasWorkspace} from '../canvas-ui/kl-canvas-workspace';\r\nimport {IFilterApply, IInitState} from '../kl.types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\n\r\nexport class UndoRedoCatchup {\r\n\r\n    private doIgnore = false;\r\n\r\n    /**\r\n     * Prevent multiple undo / redo getting triggered at once.\r\n     * Might be confusing if main thread is choking.\r\n     */\r\n    private ignoreTest (): boolean {\r\n        if (this.doIgnore) {\r\n            return false;\r\n        }\r\n        this.doIgnore = true;\r\n        setTimeout(() => {\r\n            this.doIgnore = false;\r\n        }, 0);\r\n        return true;\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        private brushUiObj,\r\n        private layerPreview,\r\n        private layerManager,\r\n        private handUi,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private getInitState: () => IInitState,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx,\r\n        private setCurrentLayerCtx,\r\n        private getCurrentBrush,\r\n    ) { }\r\n\r\n    undo (): boolean {\r\n        if (!this.ignoreTest()) {\r\n            return false;\r\n        }\r\n\r\n        if (!klHistory.canUndo()) { // || workspace.isPainting()) {\r\n            return false;\r\n        }\r\n        const actions: IHistoryEntry[] = klHistory.undo();\r\n        klHistory.pause(true);\r\n        const initState: IInitState = this.getInitState();\r\n        const oldSize = {w: this.getKlCanvas().getWidth(), h: this.getKlCanvas().getHeight()};\r\n        this.getKlCanvas().copy(initState.canvas);\r\n        let layerIndex = initState.focus;\r\n        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\r\n        const brushes: any = {};\r\n        for (let b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\r\n        for (let i = 0; i < actions.length; i++) {\r\n            ((i) => {\r\n                if (actions[i].tool[0] === \"brush\") {\r\n                    const b = brushes[actions[i].tool[1]];\r\n                    if (actions[i].actions) {\r\n                        for (let e = 0; e < actions[i].actions.length; e++) {\r\n                            const p = actions[i].actions[e].params;\r\n                            b[actions[i].actions[e].action].apply(b, p);\r\n                        }\r\n                    } else {\r\n                        const p = actions[i].params;\r\n                        b[actions[i].action].apply(b, p);\r\n                    }\r\n                } else if (actions[i].tool[0] === \"canvas\") {\r\n                    const p = actions[i].params;\r\n                    const id = this.getKlCanvas()[actions[i].action].apply(this.getKlCanvas(), p);\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"filter\") {\r\n                    const p = [{\r\n                        context: this.getCurrentLayerCtx(),\r\n                        canvas: this.getKlCanvas(),\r\n                        input: actions[i].params[0].input,\r\n                        history: new KL.DecoyKlHistory(),\r\n                    } as IFilterApply];\r\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\r\n\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\r\n                    layerIndex = actions[i].params[0];\r\n                    this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(actions[i].params[0]));\r\n                    for (let b in brushes) {\r\n                        if (brushes.hasOwnProperty(b)) {\r\n                            brushes[b].setContext(this.getCurrentLayerCtx());\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\r\n                    const id = this.getKlCanvas().addLayer();\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        if (actions[i].params[1]) {\r\n                            this.getKlCanvas().renameLayer(layerIndex, actions[i].params[1]);\r\n                        }\r\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\r\n                }\r\n            })(i);\r\n        }\r\n        if (oldSize.w !== this.getKlCanvas().getWidth() || oldSize.h !== this.getKlCanvas().getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        this.layerManager.update(layerIndex);\r\n        this.layerPreview.setLayer(this.getKlCanvas().getLayer(layerIndex));\r\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n\r\n        klHistory.pause(false);\r\n        return true;\r\n    }\r\n\r\n    redo (): boolean {\r\n        if (!this.ignoreTest()) {\r\n            return false;\r\n        }\r\n\r\n        if (!klHistory.canRedo()) {\r\n            return false;\r\n        }\r\n        const actions = klHistory.redo();\r\n        klHistory.pause(true);\r\n        const oldSize = {w: this.getKlCanvas().getWidth(), h: this.getKlCanvas().getHeight()};\r\n        let layerIndex;\r\n        const brushes: any = {};\r\n        for (let b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(this.brushUiObj.sketchyBrush.getSeed());\r\n        for (let i = 0; i < actions.length; i++) {\r\n            ((i) => {\r\n                if (actions[i].tool[0] === \"brush\") {\r\n                    const b = brushes[actions[i].tool[1]];\r\n                    if (actions[i].actions) {\r\n                        for (let e = 0; e < actions[i].actions.length; e++) {\r\n                            const p = actions[i].actions[e].params;\r\n                            b[actions[i].actions[e].action].apply(b, p);\r\n                        }\r\n                    } else {\r\n                        const p = actions[i].params;\r\n                        b[actions[i].action].apply(b, p);\r\n                    }\r\n                } else if (actions[i].tool[0] === \"canvas\") {\r\n                    const p = actions[i].params;\r\n                    const id = this.getKlCanvas()[actions[i].action].apply(this.getKlCanvas(), p);\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"filter\") {\r\n                    const p = [{\r\n                        context: this.getCurrentLayerCtx(),\r\n                        canvas: this.getKlCanvas(),\r\n                        input: actions[i].params[0].input,\r\n                        history: new KL.DecoyKlHistory(),\r\n                    } as IFilterApply];\r\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\r\n\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\r\n                    layerIndex = actions[i].params[0];\r\n                    this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(actions[i].params[0]));\r\n                    for (let b in brushes) {\r\n                        if (brushes.hasOwnProperty(b)) {\r\n                            brushes[b].setContext(this.getCurrentLayerCtx());\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\r\n                    const id = this.getKlCanvas().addLayer();\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        if (actions[i].params[1]) {\r\n                            this.getKlCanvas().renameLayer(layerIndex, actions[i].params[1]);\r\n                        }\r\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(this.getCurrentLayerCtx());\r\n                            }\r\n                        }\r\n                    }\r\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\r\n                }\r\n            })(i);\r\n        }\r\n\r\n        if (oldSize.w !== this.getKlCanvas().getWidth() || oldSize.h !== this.getKlCanvas().getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        const currentLayerIndex = this.getKlCanvas().getLayerIndex(this.getCurrentLayerCtx().canvas);\r\n        this.layerManager.update(currentLayerIndex);\r\n        this.layerPreview.setLayer(this.getKlCanvas().getLayer(currentLayerIndex));\r\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n        klHistory.pause(false);\r\n\r\n        return true;\r\n    }\r\n\r\n    catchup (logParam: IHistoryBroadcast | null): void {\r\n        // const start = performance.now();\r\n        //play catch up (the version that is a few steps behind)\r\n        if (logParam && logParam.bufferUpdate) {\r\n            const initState: IInitState = this.getInitState();\r\n\r\n            const brushes = initState.brushes;\r\n            const actions = [logParam.bufferUpdate];\r\n            let localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\r\n            const canvas = initState.canvas;\r\n            let layerIndex = initState.focus;\r\n            ((i) => {\r\n                if (actions[i].tool[0] === \"brush\") {\r\n                    let b = brushes[actions[i].tool[1]];\r\n                    if (actions[i].actions) {\r\n                        for (let e = 0; e < actions[i].actions.length; e++) {\r\n                            const p = actions[i].actions[e].params;\r\n                            b[actions[i].actions[e].action].apply(b, p);\r\n                        }\r\n                    } else {\r\n                        const p = actions[i].params;\r\n                        b[actions[i].action].apply(b, p);\r\n                    }\r\n                } else if (actions[i].tool[0] === \"canvas\") {\r\n                    const p = actions[i].params;\r\n                    const id = canvas[actions[i].action].apply(canvas, p);\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        localCurrentLayerCtx = canvas.getLayerContext(layerIndex);\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(localCurrentLayerCtx);\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"filter\") {\r\n                    const p = [{\r\n                        context: localCurrentLayerCtx,\r\n                        canvas: canvas,\r\n                        input: actions[i].params[0].input,\r\n                        history: new KL.DecoyKlHistory(),\r\n                    } as IFilterApply];\r\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\r\n\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\r\n                    layerIndex = actions[i].params[0];\r\n                    localCurrentLayerCtx = canvas.getLayerContext(actions[i].params[0]);\r\n                    for (let b in brushes) {\r\n                        if (brushes.hasOwnProperty(b)) {\r\n                            brushes[b].setContext(localCurrentLayerCtx);\r\n                        }\r\n                    }\r\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\r\n                    const id = canvas.addLayer();\r\n                    if (typeof id === 'number') {\r\n                        layerIndex = id;\r\n                        if (actions[i].params[1]) {\r\n                            this.getKlCanvas().renameLayer(layerIndex, actions[i].params[1]);\r\n                        }\r\n                        localCurrentLayerCtx = canvas.getLayerContext(layerIndex);\r\n                        for (let b in brushes) {\r\n                            if (brushes.hasOwnProperty(b)) {\r\n                                brushes[b].setContext(localCurrentLayerCtx);\r\n                            }\r\n                        }\r\n                    }\r\n                    localCurrentLayerCtx.drawImage(actions[i].params[0], 0, 0);\r\n                }\r\n            })(0);\r\n            initState.focus = layerIndex;\r\n        }\r\n        // console.log('catchup', performance.now() - start);\r\n    }\r\n\r\n\r\n}","import {IRGB, ISliderConfig} from '../kl.types';\r\n\r\nexport type TBrushSettingEmit = { type: 'color'; value: IRGB } |\r\n    { type: 'opacity'; value: number } |\r\n    { type: 'size'; value: number } |\r\n    { type: 'sliderConfig'; value: ISliderConfig };\r\n\r\nexport type TBrushSettingSubscriber = (p : TBrushSettingEmit) => void;\r\n\r\n/**\r\n * Central place to update brush settings, and to subscribe to changes.\r\n */\r\nexport class BrushSettingService {\r\n\r\n    private static instance: BrushSettingService;\r\n    subscriberArr: TBrushSettingSubscriber[] = [];\r\n\r\n    private emit (obj: TBrushSettingEmit, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (this.subscriberArr[i] === skipSubscriber) {\r\n                continue;\r\n            }\r\n            this.subscriberArr[i](obj);\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        private onSetColor: (rgb: IRGB) => void,\r\n        private onSetSize: (size: number) => void,\r\n        private onSetOpacity: (opacity: number) => void,\r\n        private onGetColor: () => IRGB,\r\n        private onGetSize: () => number,\r\n        private onGetOpacity: () => number,\r\n        private onGetSliderConfig: () => ISliderConfig,\r\n    ) {\r\n        if (BrushSettingService.instance) {\r\n            throw new Error('BrushSettingService already instantiated');\r\n        }\r\n        BrushSettingService.instance = this;\r\n    }\r\n\r\n    emitColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'color',\r\n                value: color\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSize (size: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'size',\r\n                value: size\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'opacity',\r\n                value: opacity\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSliderConfig (sliderConfig: ISliderConfig, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.emit(\r\n            {\r\n                type: 'sliderConfig',\r\n                value: sliderConfig\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    /**\r\n     * set current brush color\r\n     * @param color\r\n     * @param skipSubscriber\r\n     */\r\n    setColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetColor(color);\r\n        this.emitColor(color, skipSubscriber);\r\n    }\r\n\r\n    /**\r\n     * set current brush size\r\n     * @param size\r\n     * @param skipSubscriber\r\n     */\r\n    setSize (size: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetSize(size);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * set current opacity\r\n     * @param opacity\r\n     * @param skipSubscriber\r\n     */\r\n    setOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetOpacity(opacity);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * get current brush color\r\n     */\r\n    getColor (): IRGB {\r\n        return this.onGetColor();\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.onGetSize();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.onGetOpacity();\r\n    }\r\n\r\n    getSliderConfig (): ISliderConfig {\r\n        return this.onGetSliderConfig();\r\n    }\r\n\r\n    /**\r\n     * subscribe to changes\r\n     * @param func\r\n     */\r\n    subscribe (func: TBrushSettingSubscriber): void {\r\n        if (this.subscriberArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.subscriberArr.push(func);\r\n    }\r\n\r\n    unsubscribe (func: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (func === this.subscriberArr[i]) {\r\n                this.subscriberArr.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG, languageStrings, LS_LANGUAGE_KEY} from '../../../language/language';\r\nimport {KL} from '../../kl';\r\nimport {languages} from '../../../../languages/languages';\r\nimport {Popup} from '../modals/popup';\r\n// @ts-ignore\r\nimport bitbofLogoImg from 'url:~/src/app/img/bitbof-logo.svg';\r\n// @ts-ignore\r\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\r\n// @ts-ignore\r\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\r\nimport {LocalStorage} from '../../../bb/base/local-storage';\r\n\r\nexport class SettingsTab {\r\n\r\n    private el: HTMLElement;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        onLeftRight: () => void,\r\n        customAbout?: HTMLElement,\r\n    ) {\r\n\r\n\r\n\r\n\r\n        // ---- language ----\r\n        const language = languageStrings.getLanguage();\r\n\r\n        this.el = BB.el({\r\n            content: `\r\n${LANG('settings-language')}: ${language.name} (${language.code})\r\n            `,\r\n            css: {\r\n                margin: '10px',\r\n            }\r\n        });\r\n\r\n        const preferredLanguageRow = BB.el({\r\n            content: LANG('settings-preferred-language') + ':<br>',\r\n            css: {\r\n                marginTop: '10px',\r\n            }\r\n        });\r\n        const options: [string, string][] = [\r\n            ['auto', LANG('auto')] as [string, string]\r\n        ].concat(\r\n            languages.map(item => {\r\n                return [item.code, item.name + ` (${item.code})`];\r\n            })\r\n        );\r\n        const languageSelect = new KL.Select({\r\n            initValue: LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto',\r\n            optionArr: options,\r\n            onChange: (val) => {\r\n                if (val === 'auto') {\r\n                    LocalStorage.removeItem(LS_LANGUAGE_KEY);\r\n                } else {\r\n                    LocalStorage.setItem(LS_LANGUAGE_KEY, val);\r\n                }\r\n                languageHint.style.display = 'block';\r\n            },\r\n        });\r\n        const languageHint = BB.el({\r\n            content: LANG('settings-language-reload'),\r\n            css: {\r\n                display: 'none',\r\n                marginTop: '5px',\r\n            }\r\n        });\r\n\r\n        preferredLanguageRow.append(\r\n            languageSelect.getElement(),\r\n            languageHint,\r\n        );\r\n\r\n        this.el.append(preferredLanguageRow);\r\n\r\n        // ---- flip ui ----\r\n        BB.el({\r\n            tagName: 'button',\r\n            parent: this.el,\r\n            content: '<img height=\"20\" width=\"18\" src=\"' + uiSwapImg + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + LANG('switch-ui-left-right'),\r\n            onClick: () => onLeftRight(),\r\n            css: {\r\n                marginTop: '20px',\r\n            },\r\n            custom: {\r\n                tabIndex: '-1',\r\n            }\r\n        });\r\n\r\n\r\n        // ---- about ----\r\n        this.el.append(BB.el({className: 'gridHr', css: {margin: '10px 0'}}));\r\n\r\n        function makeLicenses() {\r\n            return BB.el({\r\n                tagName: 'a',\r\n                content: LANG('licenses'),\r\n                onClick: () => {\r\n                    import('./licenses').then(result => {\r\n                        new Popup({\r\n                            title: BB.el({\r\n                                content: LANG('licenses'),\r\n                            }),\r\n                            content: BB.el({\r\n                                content: BB.el({\r\n                                    content: result.licenses.replace(/\\n/g, '<br>'),\r\n                                    css: {\r\n                                        padding: '20px',\r\n                                    }\r\n                                }),\r\n                                css: {\r\n                                    height: '100%',\r\n                                    overflowY: 'scroll',\r\n                                }\r\n                            }),\r\n                            width: 800,\r\n                            isMaxHeight: true,\r\n                        });\r\n                    });\r\n                },\r\n            });\r\n        }\r\n\r\n        if (customAbout) {\r\n            this.el.append(customAbout);\r\n            if (!customAbout.innerHTML) {\r\n                const minimalAbout = BB.el({\r\n                    parent: customAbout,\r\n                    css: {\r\n                       textAlign: 'center',\r\n                   }\r\n                });\r\n                minimalAbout.append(\r\n                    BB.el({\r\n                        content: `<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2022<br>`,\r\n                    }),\r\n                    makeLicenses(),\r\n                );\r\n            }\r\n        } else {\r\n            const versionEl = BB.el({\r\n                parent: this.el,\r\n                css: {\r\n                    textAlign: 'center',\r\n                },\r\n                content: `\r\n<img alt=\"Klecks\" height=\"25\" src=\"${klecksLogoImg}\"><br>\r\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2022<br>`\r\n            });\r\n\r\n            versionEl.append(\r\n                makeLicenses(),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('donate'),\r\n                    custom: {\r\n                        href: 'https://kleki.com/donate/',\r\n                        target: '_blank',\r\n                    }\r\n                }),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('source-code'),\r\n                    custom: {\r\n                        href: 'https://klecks.org',\r\n                        target: '_blank',\r\n                    }\r\n                }),\r\n            );\r\n\r\n\r\n        }\r\n\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== LS_LANGUAGE_KEY) {\r\n                return;\r\n            }\r\n            languageSelect.setValue(\r\n                LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'\r\n            );\r\n        });\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kSWIa\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"4FMUg\");","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"79hnx\"))).then(() => parcelRequire('jNQF2'));","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport caretImg from 'url:~/src/app/img/ui/caret-down.svg';\r\nimport {IKeyString} from '../../../bb/bb.types';\r\nimport {LANG} from '../../../language/language';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n\r\n/**\r\n * Scroll buttons at the top and bottom of toolspace\r\n * Show up when window is very small.\r\n * Allow user to scroll up and down toolspace.\r\n */\r\nexport class ToolspaceScroller {\r\n\r\n    private toolspace: HTMLElement;\r\n    private upBtn: HTMLElement;\r\n    private downBtn: HTMLElement;\r\n    private downInterval: any;\r\n    private upInterval: any;\r\n\r\n    private update(): void {\r\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) { // small buffer where it's not worth it\r\n            if (!this.upInterval) {\r\n                this.upBtn.style.display = this.toolspace.scrollTop === 0 ? 'none' : 'block';\r\n            }\r\n            if (!this.downInterval) {\r\n                this.downBtn.style.display = (\r\n                    this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ?\r\n                        'none' : 'block'\r\n                );\r\n            }\r\n        } else {\r\n            this.upBtn.style.display = 'none';\r\n            this.downBtn.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n    constructor(p: {toolspace: HTMLElement, uiState: 'left' | 'right'}) {\r\n        this.toolspace = p.toolspace;\r\n        this.upBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                top: '0',\r\n                transform: 'rotate(180deg)',\r\n            }\r\n        });\r\n        this.downBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                bottom: '0',\r\n            }\r\n        });\r\n        this.updateUiState(p.uiState);\r\n\r\n        const upListener = new BB.PointerListener({\r\n            target: this.upBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.upInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, -13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.upInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.upInterval = null;\r\n                        this.update()\r\n                    }, 50);\r\n                }\r\n            },\r\n        });\r\n        const downListener = new BB.PointerListener({\r\n            target: this.downBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.downInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, 13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.downInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.downInterval = null;\r\n                        this.update()\r\n                    }, 50);\r\n                }\r\n            }\r\n        });\r\n\r\n        const wheelListener = (e: WheelEvent) => {\r\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\r\n            this.update();\r\n        };\r\n        this.upBtn.addEventListener('wheel', wheelListener);\r\n        this.downBtn.addEventListener('wheel', wheelListener);\r\n\r\n        this.update();\r\n\r\n        const observer = new MutationObserver(() => this.update());\r\n        observer.observe(\r\n            this.toolspace,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n        window.addEventListener('resize', () => this.update());\r\n\r\n        // hide if in dialog because that can have its own scrollbar\r\n        dialogCounter.subscribe((v) => {\r\n            // ignores the 0.5 by tool dropdown\r\n            this.upBtn.style.opacity = v >= 1 ? '0' : '';\r\n            this.downBtn.style.opacity = v >= 1 ? '0' : '';\r\n        });\r\n    }\r\n\r\n    updateUiState (uiState: 'left' | 'right'): void {\r\n        BB.css(this.upBtn, {\r\n            left: uiState === 'left' ? '0' : null,\r\n            right: uiState === 'right' ? '0' : null,\r\n        });\r\n        BB.css(this.downBtn, {\r\n            left: uiState === 'left' ? '0' : null,\r\n            right: uiState === 'right' ? '0' : null,\r\n        });\r\n    }\r\n}","/**\r\n * Topmost row of buttons in toolspace\r\n *\r\n * p = { // button click callbacks\r\n *     onSubmit: function(),\r\n *     onLeftRight: function(),\r\n *     onHelp: function()\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nimport {BB} from \"../bb/bb\";\r\n// @ts-ignore\r\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\r\n// @ts-ignore\r\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\r\nimport {LANG} from '../language/language';\r\n\r\nexport class ToolspaceTopRow {\r\n    el: HTMLDivElement;\r\n\r\n    constructor(p: {onSubmit: () => void, onLeftRight: () => void, onHelp: () => void}) {\r\n        let div = document.createElement('div');\r\n        this.el = div;\r\n        BB.css(div, {\r\n            height: '36px',\r\n            //background: '#f00',\r\n            display: 'flex',\r\n            backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n        });\r\n\r\n        function createButton(p) {\r\n            let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n            let result = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.content ? '' : (p.contain ? padding + 'px 0' : ''),\r\n                }\r\n            });\r\n            if (p.content) {\r\n                result.appendChild(p.content);\r\n            } else {\r\n                let im = BB.el({\r\n                    css: {\r\n                        backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                        backgroundRepeat: 'no-repeat',\r\n                        backgroundPosition: 'center',\r\n                        backgroundSize: p.contain ? 'contain' : '',\r\n                        //filter: 'grayscale(1)',\r\n                        height: '100%'\r\n                    }\r\n                });\r\n                im.style.pointerEvents = 'none';\r\n                result.appendChild(im);\r\n            }\r\n            (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: result,\r\n                onEnterLeave: function(isOver) {\r\n                    result.classList.toggle('toolspace-row-button-hover', isOver);\r\n                }\r\n            });\r\n            return result;\r\n        }\r\n\r\n        let submitButton = createButton({\r\n            onClick: p.onSubmit,\r\n            title: LANG('submit-title'),\r\n            content: BB.el({\r\n                content: LANG('submit'),\r\n                className: 'toolspace-row-button__submit',\r\n                css: {\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    width: '100%',\r\n                    height: '100%'\r\n                }\r\n            }),\r\n            contain: true\r\n        });\r\n        submitButton.style.width = '45px';\r\n\r\n        let helpButton = createButton({\r\n            onClick: p.onHelp,\r\n            title: LANG('help'),\r\n            image: helpImg,\r\n            contain: true\r\n        });\r\n\r\n        let leftRightButton = createButton({\r\n            onClick: p.onLeftRight,\r\n            title: LANG('switch-ui-left-right'),\r\n            image: uiSwapImg,\r\n            contain: true\r\n        });\r\n\r\n        div.appendChild(submitButton);\r\n        div.appendChild(leftRightButton);\r\n        div.appendChild(helpButton);\r\n    }\r\n\r\n    getElement() {\r\n        return this.el;\r\n    }\r\n}\r\n","import {filterLib, filterLibStatus} from './filters';\r\nimport {glBrightnessContrast} from './gl-brightness-contrast';\r\nimport {cropExtend} from './crop-extend';\r\nimport {glCurves} from './gl-curves';\r\nimport {flip} from './flip';\r\nimport {glHueSaturation} from './gl-hue-saturation';\r\nimport {invert} from './invert';\r\nimport {glPerspective} from './gl-perspective';\r\nimport {resize} from './resize';\r\nimport {rotate} from './rotate';\r\nimport {glTiltShift} from './gl-tilt-shift';\r\nimport {transform} from './transform';\r\nimport {glBlur} from './gl-blur';\r\nimport {glUnsharpMask} from './gl-unsharp-mask';\r\nimport {toAlpha} from './to-alpha';\r\nimport {grid} from './grid';\r\n\r\nlet embed: boolean;\r\nfunction importFilter(libObj, moduleObj): void {\r\n    if (moduleObj.getDialog) {\r\n        libObj.getDialog = moduleObj.getDialog;\r\n    }\r\n    libObj.apply = moduleObj.apply;\r\n}\r\n\r\n\r\nexport function importFilters(isEmbed?: boolean) {\r\n    if (filterLibStatus.isLoaded) {\r\n        return;\r\n    }\r\n    embed = isEmbed\r\n\r\n    importFilter(filterLib.glBrightnessContrast, glBrightnessContrast);\r\n    importFilter(filterLib.cropExtend, cropExtend);\r\n    importFilter(filterLib.glCurves, glCurves);\r\n    importFilter(filterLib.flip, flip);\r\n    importFilter(filterLib.glHueSaturation, glHueSaturation);\r\n    importFilter(filterLib.invert, invert);\r\n    importFilter(filterLib.glPerspective, glPerspective);\r\n    importFilter(filterLib.resize, resize);\r\n    importFilter(filterLib.rotate, rotate);\r\n    importFilter(filterLib.glTiltShift, glTiltShift);\r\n    importFilter(filterLib.transform, transform);\r\n    importFilter(filterLib.glBlur, glBlur);\r\n    importFilter(filterLib.glUnsharpMask, glUnsharpMask);\r\n    importFilter(filterLib.toAlpha, toAlpha);\r\n    importFilter(filterLib.grid, grid);\r\n\r\n    filterLibStatus.isLoaded = true;\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const glBrightnessContrast = {\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n\r\n        let context = params.context; //2d context of canvas\r\n        let canvas = params.canvas; //the klCanvas and dom element\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n\r\n        function finishInit() {\r\n\r\n            let brightness = 0, contrast = 0;\r\n            div.innerHTML = LANG('filter-bright-contrast-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let brightnessSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-brightness'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                initValue: (brightness + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brightness = val / 50 - 1;\r\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                }\r\n            });\r\n            let contrastSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-contrast'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                initValue: (contrast + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    contrast = val / 50 - 1;\r\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                }\r\n            });\r\n            brightnessSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(brightnessSlider.getElement());\r\n            div.appendChild(contrastSlider.getElement());\r\n\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                brightnessSlider.destroy();\r\n                contrastSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    brightness: brightness,\r\n                    contrast: contrast\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let brightness = params.input.brightness;\r\n        let contrast = params.input.contrast;\r\n        let history = params.history;\r\n        if (!context || brightness === null || contrast === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glBrightnessContrast\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n\r\n        return true;\r\n    }\r\n}","\r\nexport const eventResMs = 60;","import {fx} from '../../../script-vendor/glfx';\r\n\r\nlet fxCanvas = null\r\ntry {\r\n    fxCanvas = fx.canvas();\r\n} catch (e) {\r\n}\r\n\r\nexport function getSharedFx() {\r\n    if (!fxCanvas || fxCanvas._.gl.isContextLost()) {\r\n        try {\r\n            fxCanvas = fx.canvas();\r\n        } catch (e) {\r\n        }\r\n    }\r\n    return fxCanvas;\r\n}","/*\r\n * glfx.script\r\n * http://evanw.github.com/glfx.js/\r\n *\r\n * Copyright 2011 Evan Wallace\r\n * Released under the MIT license\r\n *\r\n * modifications by bitbof\r\n */\r\nexport const fx = (function() {\r\nlet exports: any = {};\r\n\r\n// src/OES_texture_float_linear-polyfill.script\r\n// From: https://github.com/evanw/OES_texture_float_linear-polyfill\r\n(function() {\r\n  // Uploads a 2x2 floating-point texture where one pixel is 2 and the other\r\n  // three pixels are 0. Linear filtering is only supported if a sample taken\r\n  // from the center of that texture is (2 + 0 + 0 + 0) / 4 = 0.5.\r\n  function supportsOESTextureFloatLinear(gl) {\r\n    // Need floating point textures in the first place\r\n    if (!gl.getExtension('OES_texture_float')) {\r\n      return false;\r\n    }\r\n\r\n    // Create a render target\r\n    let framebuffer = gl.createFramebuffer();\r\n    let byteTexture = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, byteTexture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, byteTexture, 0);\r\n\r\n    // Create a simple floating-point texture with value of 0.5 in the center\r\n    let rgba = [\r\n      2, 0, 0, 0,\r\n      0, 0, 0, 0,\r\n      0, 0, 0, 0,\r\n      0, 0, 0, 0\r\n    ];\r\n    let floatTexture = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, floatTexture);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, gl.FLOAT, new Float32Array(rgba));\r\n\r\n    // Create the test shader\r\n    let program = gl.createProgram();\r\n    let vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n    let fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n    gl.shaderSource(vertexShader, '\\\r\n      attribute vec2 vertex;\\\r\n      void main() {\\\r\n        gl_Position = vec4(vertex, 0.0, 1.0);\\\r\n      }\\\r\n    ');\r\n    gl.shaderSource(fragmentShader, '\\\r\n      uniform sampler2D texture;\\\r\n      void main() {\\\r\n        gl_FragColor = texture2D(texture, vec2(0.5));\\\r\n      }\\\r\n    ');\r\n    gl.compileShader(vertexShader);\r\n    gl.compileShader(fragmentShader);\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n    gl.linkProgram(program);\r\n\r\n    // Create a buffer containing a single point\r\n    let buffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0]), gl.STREAM_DRAW);\r\n    gl.enableVertexAttribArray(0);\r\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\r\n\r\n    // Render the point and read back the rendered pixel\r\n    let pixel = new Uint8Array(4);\r\n    gl.useProgram(program);\r\n    gl.viewport(0, 0, 1, 1);\r\n    gl.bindTexture(gl.TEXTURE_2D, floatTexture);\r\n    gl.drawArrays(gl.POINTS, 0, 1);\r\n    gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixel);\r\n\r\n    // The center sample will only have a value of 0.5 if linear filtering works\r\n    return pixel[0] === 127 || pixel[0] === 128;\r\n  }\r\n\r\n  // The constructor for the returned extension object\r\n  function OESTextureFloatLinear() {\r\n  }\r\n\r\n  // Cache the extension so it's specific to each context like extensions should be\r\n  function getOESTextureFloatLinear(gl) {\r\n    if (gl.$OES_texture_float_linear$ === void 0) {\r\n      Object.defineProperty(gl, '$OES_texture_float_linear$', {\r\n        enumerable: false,\r\n        configurable: false,\r\n        writable: false,\r\n        value: new OESTextureFloatLinear()\r\n      });\r\n    }\r\n    return gl.$OES_texture_float_linear$;\r\n  }\r\n\r\n  // This replaces the real getExtension()\r\n  function getExtension(name) {\r\n    return name === 'OES_texture_float_linear'\r\n      ? getOESTextureFloatLinear(this)\r\n      : oldGetExtension.call(this, name);\r\n  }\r\n\r\n  // This replaces the real getSupportedExtensions()\r\n  function getSupportedExtensions() {\r\n    let extensions = oldGetSupportedExtensions.call(this);\r\n    if (extensions.indexOf('OES_texture_float_linear') === -1) {\r\n      extensions.push('OES_texture_float_linear');\r\n    }\r\n    return extensions;\r\n  }\r\n\r\n  // Get a WebGL context\r\n  try {\r\n    let gl = document.createElement('canvas').getContext('experimental-webgl');\r\n  } catch (e) {\r\n  }\r\n\r\n  // Don't install the polyfill if the browser already supports it or doesn't have WebGL\r\n  if (!gl || (gl as any).getSupportedExtensions().indexOf('OES_texture_float_linear') !== -1) {\r\n    return;\r\n  }\r\n\r\n  // Install the polyfill if linear filtering works with floating-point textures\r\n  let oldGetExtension;\r\n  let oldGetSupportedExtensions;\r\n  if (supportsOESTextureFloatLinear(gl)) {\r\n    oldGetExtension = WebGLRenderingContext.prototype.getExtension;\r\n    oldGetSupportedExtensions = WebGLRenderingContext.prototype.getSupportedExtensions;\r\n    WebGLRenderingContext.prototype.getExtension = getExtension;\r\n    WebGLRenderingContext.prototype.getSupportedExtensions = getSupportedExtensions;\r\n  }\r\n}());\r\n\r\n// src/core\\canvas.script\r\nvar gl;\r\n\r\nfunction clamp(lo, value, hi) {\r\n    return Math.max(lo, Math.min(value, hi));\r\n}\r\n\r\nfunction wrapTexture(texture) {\r\n    return {\r\n        _: texture,\r\n        loadContentsOf: function(element) {\r\n            // Make sure that we're using the correct global WebGL context\r\n            gl = this._.gl;\r\n            this._.loadContentsOf(element);\r\n        },\r\n        destroy: function() {\r\n            // Make sure that we're using the correct global WebGL context\r\n            gl = this._.gl;\r\n            this._.destroy();\r\n        }\r\n    };\r\n}\r\n\r\nfunction texture(element) {\r\n    return wrapTexture(Texture.fromElement(element));\r\n}\r\n\r\nfunction initialize(width, height) {\r\n    let type = gl.UNSIGNED_BYTE;\r\n\r\n    // Go for floating point buffer textures if we can, it'll make the bokeh\r\n    // filter look a lot better. Note that on Windows, ANGLE does not let you\r\n    // render to a floating-point texture when linear filtering is enabled.\r\n    // See http://crbug.com/172278 for more information.\r\n    if (gl.getExtension('OES_texture_float') && gl.getExtension('OES_texture_float_linear')) {\r\n        let testTexture = new Texture(100, 100, gl.RGBA, gl.FLOAT);\r\n        try {\r\n            // Only use gl.FLOAT if we can render to it\r\n            testTexture.drawTo(function() { type = gl.FLOAT; });\r\n        } catch (e) {\r\n        }\r\n        testTexture.destroy();\r\n    }\r\n\r\n    if (this._.texture) this._.texture.destroy();\r\n    if (this._.spareTexture) this._.spareTexture.destroy();\r\n    this.width = width;\r\n    this.height = height;\r\n    this._.texture = new Texture(width, height, gl.RGBA, type);\r\n    this._.spareTexture = new Texture(width, height, gl.RGBA, type);\r\n    this._.extraTexture = this._.extraTexture || new Texture(0, 0, gl.RGBA, type);\r\n    this._.flippedShader = this._.flippedShader || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\\\r\n        }\\\r\n    ', 'flippedShader');\r\n    this._.isInitialized = true;\r\n}\r\n\r\n/*\r\n   Draw a texture to the canvas, with an optional width and height to scale to.\r\n   If no width and height are given then the original texture width and height\r\n   are used.\r\n*/\r\nfunction draw(texture, width, height) {\r\n    if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\r\n        initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\r\n    }\r\n\r\n    texture._.use();\r\n    this._.texture.drawTo(function() {\r\n        Shader.getDefaultShader().drawRect();\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\nfunction update() {\r\n    this._.texture.use();\r\n    this._.flippedShader.drawRect();\r\n    return this;\r\n}\r\n\r\nfunction simpleShader(shader, uniforms, textureIn, textureOut) {\r\n    (textureIn || this._.texture).use();\r\n    this._.spareTexture.drawTo(function() {\r\n        shader.uniforms(uniforms).drawRect();\r\n    });\r\n    this._.spareTexture.swapWith(textureOut || this._.texture);\r\n}\r\n\r\nfunction replace(node) {\r\n    node.parentNode.insertBefore(this, node);\r\n    node.parentNode.removeChild(node);\r\n    return this;\r\n}\r\n\r\nfunction contents() {\r\n    let texture = new Texture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\r\n    this._.texture.use();\r\n    texture.drawTo(function() {\r\n        Shader.getDefaultShader().drawRect();\r\n    });\r\n    return wrapTexture(texture);\r\n}\r\n\r\n/*\r\n   Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\r\n   Length of the array will be width * height * 4.\r\n*/\r\nfunction getPixelArray() {\r\n    let w = this._.texture.width;\r\n    let h = this._.texture.height;\r\n    let array = new Uint8Array(w * h * 4);\r\n    this._.texture.drawTo(function() {\r\n        gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\r\n    });\r\n    return array;\r\n}\r\n\r\nfunction wrap(func) {\r\n    return function() {\r\n        // Make sure that we're using the correct global WebGL context\r\n        gl = this._.gl;\r\n\r\n        // Now that the context has been switched, we can call the wrapped function\r\n        return func.apply(this, arguments);\r\n    };\r\n}\r\n\r\nexports.canvas = function() {\r\n    let canvas: any = document.createElement('canvas');\r\n    try {\r\n        gl = canvas.getContext('experimental-webgl', { premultipliedAlpha: false });\r\n    } catch (e) {\r\n        gl = null;\r\n    }\r\n    if (!gl) {\r\n        throw 'This browser does not support WebGL';\r\n    }\r\n    canvas._ = {\r\n        gl: gl,\r\n        isInitialized: false,\r\n        texture: null,\r\n        spareTexture: null,\r\n        flippedShader: null\r\n    };\r\n\r\n    // Core methods\r\n    canvas.texture = wrap(texture);\r\n    canvas.draw = wrap(draw);\r\n    canvas.update = wrap(update);\r\n    canvas.replace = wrap(replace);\r\n    canvas.contents = wrap(contents);\r\n    canvas.getPixelArray = wrap(getPixelArray);\r\n\r\n    // Filter methods\r\n    canvas.brightnessContrast = wrap(brightnessContrast);\r\n    canvas.hexagonalPixelate = wrap(hexagonalPixelate);\r\n    canvas.hueSaturation = wrap(hueSaturation);\r\n    canvas.colorHalftone = wrap(colorHalftone);\r\n    canvas.triangleBlur = wrap(triangleBlur);\r\n    canvas.unsharpMask = wrap(unsharpMask);\r\n    canvas.perspective = wrap(perspective);\r\n    canvas.matrixWarp = wrap(matrixWarp);\r\n    canvas.bulgePinch = wrap(bulgePinch);\r\n    canvas.tiltShift = wrap(tiltShift);\r\n    canvas.dotScreen = wrap(dotScreen);\r\n    canvas.edgeWork = wrap(edgeWork);\r\n    canvas.lensBlur = wrap(lensBlur);\r\n    canvas.zoomBlur = wrap(zoomBlur);\r\n    canvas.noise = wrap(noise);\r\n    canvas.denoise = wrap(denoise);\r\n    canvas.curves = wrap(curves);\r\n    canvas.swirl = wrap(swirl);\r\n    canvas.ink = wrap(ink);\r\n    canvas.vignette = wrap(vignette);\r\n    canvas.vibrance = wrap(vibrance);\r\n    canvas.sepia = wrap(sepia);\r\n    canvas.invert = wrap(invert);\r\n    canvas.toAlpha = wrap(toAlpha);\r\n\r\n    return canvas;\r\n};\r\nexports.splineInterpolate = splineInterpolate;\r\n\r\n// src/core\\matrix.script\r\n// from javax.media.jai.PerspectiveTransform\r\n\r\nfunction getSquareToQuad(x0, y0, x1, y1, x2, y2, x3, y3) {\r\n    let dx1 = x1 - x2;\r\n    let dy1 = y1 - y2;\r\n    let dx2 = x3 - x2;\r\n    let dy2 = y3 - y2;\r\n    let dx3 = x0 - x1 + x2 - x3;\r\n    let dy3 = y0 - y1 + y2 - y3;\r\n    let det = dx1*dy2 - dx2*dy1;\r\n    let a = (dx3*dy2 - dx2*dy3) / det;\r\n    let b = (dx1*dy3 - dx3*dy1) / det;\r\n    return [\r\n        x1 - x0 + a*x1, y1 - y0 + a*y1, a,\r\n        x3 - x0 + b*x3, y3 - y0 + b*y3, b,\r\n        x0, y0, 1\r\n    ];\r\n}\r\n\r\nfunction getInverse(m) {\r\n    let a = m[0], b = m[1], c = m[2];\r\n    let d = m[3], e = m[4], f = m[5];\r\n    let g = m[6], h = m[7], i = m[8];\r\n    let det = a*e*i - a*f*h - b*d*i + b*f*g + c*d*h - c*e*g;\r\n    return [\r\n        (e*i - f*h) / det, (c*h - b*i) / det, (b*f - c*e) / det,\r\n        (f*g - d*i) / det, (a*i - c*g) / det, (c*d - a*f) / det,\r\n        (d*h - e*g) / det, (b*g - a*h) / det, (a*e - b*d) / det\r\n    ];\r\n}\r\n\r\nfunction multiply(a, b) {\r\n    return [\r\n        a[0]*b[0] + a[1]*b[3] + a[2]*b[6],\r\n        a[0]*b[1] + a[1]*b[4] + a[2]*b[7],\r\n        a[0]*b[2] + a[1]*b[5] + a[2]*b[8],\r\n        a[3]*b[0] + a[4]*b[3] + a[5]*b[6],\r\n        a[3]*b[1] + a[4]*b[4] + a[5]*b[7],\r\n        a[3]*b[2] + a[4]*b[5] + a[5]*b[8],\r\n        a[6]*b[0] + a[7]*b[3] + a[8]*b[6],\r\n        a[6]*b[1] + a[7]*b[4] + a[8]*b[7],\r\n        a[6]*b[2] + a[7]*b[5] + a[8]*b[8]\r\n    ];\r\n}\r\n\r\n// src/core\\shader.script\r\nvar Shader = (function() {\r\n    function isArray(obj) {\r\n        return Object.prototype.toString.call(obj) == '[object Array]';\r\n    }\r\n\r\n    function isNumber(obj) {\r\n        return Object.prototype.toString.call(obj) == '[object Number]';\r\n    }\r\n\r\n    function compileSource(type, source, nameStr) {\r\n        let shader = gl.createShader(type);\r\n        gl.shaderSource(shader, source);\r\n        gl.compileShader(shader);\r\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n            throw 'compile error: ' + nameStr + ' - ' + gl.getShaderInfoLog(shader);\r\n        }\r\n        return shader;\r\n    }\r\n\r\n    let defaultVertexSource = '\\\r\n    attribute vec2 vertex;\\\r\n    attribute vec2 _texCoord;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        texCoord = _texCoord;\\\r\n        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\r\n    }';\r\n\r\n    let defaultFragmentSource = '\\\r\n    uniform sampler2D texture;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        gl_FragColor = texture2D(texture, texCoord);\\\r\n    }';\r\n\r\n    // added test 2020-04-27 bitbof\r\n    let floatPrecision = null;\r\n    function testPrecisionSupport(precisionType) {\r\n        let format = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, precisionType);\r\n        return format !== null && format.precision !== 0;\r\n    }\r\n\r\n    function Shader(vertexSource?, fragmentSource?, nameStr?) {\r\n        this.vertexAttribute = null;\r\n        this.texCoordAttribute = null;\r\n        this.program = gl.createProgram();\r\n        vertexSource = vertexSource || defaultVertexSource;\r\n        fragmentSource = fragmentSource || defaultFragmentSource;\r\n        if (floatPrecision === null) {\r\n            floatPrecision = testPrecisionSupport(gl.HIGH_FLOAT) ? 'highp' : (testPrecisionSupport(gl.MEDIUM_FLOAT) ? 'mediump' : 'lowp');\r\n        }\r\n        fragmentSource = 'precision ' + floatPrecision + ' float;' + fragmentSource; // annoying requirement is annoying\r\n        gl.attachShader(this.program, compileSource(gl.VERTEX_SHADER, vertexSource, nameStr + '(vertex)'));\r\n        gl.attachShader(this.program, compileSource(gl.FRAGMENT_SHADER, fragmentSource, nameStr + '(fragment)'));\r\n        gl.linkProgram(this.program);\r\n        if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\r\n            throw 'link error: ' + gl.getProgramInfoLog(this.program);\r\n        }\r\n    }\r\n\r\n    Shader.prototype.destroy = function() {\r\n        gl.deleteProgram(this.program);\r\n        this.program = null;\r\n    };\r\n\r\n    Shader.prototype.uniforms = function(uniforms) {\r\n        gl.useProgram(this.program);\r\n        for (var name in uniforms) {\r\n            if (!uniforms.hasOwnProperty(name)) continue;\r\n            let location = gl.getUniformLocation(this.program, name);\r\n            if (location === null) continue; // will be null if the uniform isn't used in the shader\r\n            let value = uniforms[name];\r\n            if (isArray(value)) {\r\n                switch (value.length) {\r\n                    case 1: gl.uniform1fv(location, new Float32Array(value)); break;\r\n                    case 2: gl.uniform2fv(location, new Float32Array(value)); break;\r\n                    case 3: gl.uniform3fv(location, new Float32Array(value)); break;\r\n                    case 4: gl.uniform4fv(location, new Float32Array(value)); break;\r\n                    case 9: gl.uniformMatrix3fv(location, false, new Float32Array(value)); break;\r\n                    case 16: gl.uniformMatrix4fv(location, false, new Float32Array(value)); break;\r\n                    default: throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\r\n                }\r\n            } else if (isNumber(value)) {\r\n                gl.uniform1f(location, value);\r\n            } else {\r\n                throw 'attempted to set uniform \"' + name + '\" to invalid value ' + (value || 'undefined').toString();\r\n            }\r\n        }\r\n        // allow chaining\r\n        return this;\r\n    };\r\n\r\n    // textures are uniforms too but for some reason can't be specified by gl.uniform1f,\r\n    // even though floating point numbers represent the integers 0 through 7 exactly\r\n    Shader.prototype.textures = function(textures) {\r\n        gl.useProgram(this.program);\r\n        for (var name in textures) {\r\n            if (!textures.hasOwnProperty(name)) continue;\r\n            gl.uniform1i(gl.getUniformLocation(this.program, name), textures[name]);\r\n        }\r\n        // allow chaining\r\n        return this;\r\n    };\r\n\r\n    Shader.prototype.drawRect = function(left, top, right, bottom) {\r\n        let undefined;\r\n        let viewport = gl.getParameter(gl.VIEWPORT);\r\n        top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\r\n        left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\r\n        right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\r\n        bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\r\n        if (gl.vertexBuffer == null) {\r\n            gl.vertexBuffer = gl.createBuffer();\r\n        }\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([ left, top, left, bottom, right, top, right, bottom ]), gl.STATIC_DRAW);\r\n        if (gl.texCoordBuffer == null) {\r\n            gl.texCoordBuffer = gl.createBuffer();\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([ 0, 0, 0, 1, 1, 0, 1, 1 ]), gl.STATIC_DRAW);\r\n        }\r\n        if (this.vertexAttribute == null) {\r\n            this.vertexAttribute = gl.getAttribLocation(this.program, 'vertex');\r\n            gl.enableVertexAttribArray(this.vertexAttribute);\r\n        }\r\n        if (this.texCoordAttribute == null) {\r\n            this.texCoordAttribute = gl.getAttribLocation(this.program, '_texCoord');\r\n            gl.enableVertexAttribArray(this.texCoordAttribute);\r\n        }\r\n        gl.useProgram(this.program);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n        gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n        gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    };\r\n\r\n    Shader.getDefaultShader = function() {\r\n        gl.defaultShader = gl.defaultShader || new Shader();\r\n        return gl.defaultShader;\r\n    };\r\n\r\n    return Shader;\r\n})();\r\n\r\n// src/core\\spline.script\r\n// from SplineInterpolator.cs in the Paint.NET source code\r\n\r\nfunction SplineInterpolator(points) {\r\n    let n = points.length;\r\n    this.xa = [];\r\n    this.ya = [];\r\n    this.u = [];\r\n    this.y2 = [];\r\n\r\n    points.sort(function(a, b) {\r\n        return a[0] - b[0];\r\n    });\r\n    for (var i = 0; i < n; i++) {\r\n        this.xa.push(points[i][0]);\r\n        this.ya.push(points[i][1]);\r\n    }\r\n\r\n    this.u[0] = 0;\r\n    this.y2[0] = 0;\r\n\r\n    for (var i = 1; i < n - 1; ++i) {\r\n        // This is the decomposition loop of the tridiagonal algorithm. \r\n        // y2 and u are used for temporary storage of the decomposed factors.\r\n        let wx = this.xa[i + 1] - this.xa[i - 1];\r\n        let sig = (this.xa[i] - this.xa[i - 1]) / wx;\r\n        let p = sig * this.y2[i - 1] + 2.0;\r\n\r\n        this.y2[i] = (sig - 1.0) / p;\r\n\r\n        let ddydx = \r\n            (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) - \r\n            (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\r\n\r\n        this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\r\n    }\r\n\r\n    this.y2[n - 1] = 0;\r\n\r\n    // This is the backsubstitution loop of the tridiagonal algorithm\r\n    for (var i = n - 2; i >= 0; --i) {\r\n        this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\r\n    }\r\n}\r\n\r\nSplineInterpolator.prototype.interpolate = function(x) {\r\n    let n = this.ya.length;\r\n    let klo = 0;\r\n    let khi = n - 1;\r\n\r\n    // We will find the right place in the table by means of\r\n    // bisection. This is optimal if sequential calls to this\r\n    // routine are at random values of x. If sequential calls\r\n    // are in order, and closely spaced, one would do better\r\n    // to store previous values of klo and khi.\r\n    while (khi - klo > 1) {\r\n        let k = (khi + klo) >> 1;\r\n\r\n        if (this.xa[k] > x) {\r\n            khi = k; \r\n        } else {\r\n            klo = k;\r\n        }\r\n    }\r\n\r\n    let h = this.xa[khi] - this.xa[klo];\r\n    let a = (this.xa[khi] - x) / h;\r\n    let b = (x - this.xa[klo]) / h;\r\n\r\n    // Cubic spline polynomial is now evaluated.\r\n    return a * this.ya[klo] + b * this.ya[khi] + \r\n        ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\r\n};\r\n\r\n// src/core\\texture.script\r\nvar Texture = (function() {\r\n    Texture.fromElement = function(element) {\r\n        let texture = new Texture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\r\n        texture.loadContentsOf(element);\r\n        return texture;\r\n    };\r\n\r\n    function Texture(width, height, format, type) {\r\n        this.gl = gl;\r\n        this.id = gl.createTexture();\r\n        this.width = width;\r\n        this.height = height;\r\n        this.format = format;\r\n        this.type = type;\r\n\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        if (width && height) gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n    }\r\n\r\n    Texture.prototype.loadContentsOf = function(element) {\r\n        this.width = element.width || element.videoWidth;\r\n        this.height = element.height || element.videoHeight;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\r\n    };\r\n\r\n    Texture.prototype.initFromBytes = function(width, height, data) {\r\n        this.width = width;\r\n        this.height = height;\r\n        this.format = gl.RGBA;\r\n        this.type = gl.UNSIGNED_BYTE;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\r\n    };\r\n\r\n    Texture.prototype.destroy = function() {\r\n        gl.deleteTexture(this.id);\r\n        this.id = null;\r\n    };\r\n\r\n    Texture.prototype.use = function(unit) {\r\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n    };\r\n\r\n    Texture.prototype.unuse = function(unit) {\r\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n        gl.bindTexture(gl.TEXTURE_2D, null);\r\n    };\r\n\r\n    Texture.prototype.ensureFormat = function(width, height, format, type) {\r\n        // allow passing an existing texture instead of individual arguments\r\n        if (arguments.length == 1) {\r\n            let texture = arguments[0];\r\n            width = texture.width;\r\n            height = texture.height;\r\n            format = texture.format;\r\n            type = texture.type;\r\n        }\r\n\r\n        // change the format only if required\r\n        if (width != this.width || height != this.height || format != this.format || type != this.type) {\r\n            this.width = width;\r\n            this.height = height;\r\n            this.format = format;\r\n            this.type = type;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n        }\r\n    };\r\n\r\n    Texture.prototype.drawTo = function(callback) {\r\n        // start rendering to this texture\r\n        gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\r\n        if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\r\n            throw new Error('incomplete framebuffer');\r\n        }\r\n        gl.viewport(0, 0, this.width, this.height);\r\n\r\n        // do the drawing\r\n        callback();\r\n\r\n        // stop rendering to this texture\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    };\r\n\r\n    let canvas = null;\r\n\r\n    function getCanvas(texture) {\r\n        if (canvas == null) canvas = document.createElement('canvas');\r\n        canvas.width = texture.width;\r\n        canvas.height = texture.height;\r\n        let c = canvas.getContext('2d');\r\n        c.clearRect(0, 0, canvas.width, canvas.height);\r\n        return c;\r\n    }\r\n\r\n    Texture.prototype.fillUsingCanvas = function(callback) {\r\n        callback(getCanvas(this));\r\n        this.format = gl.RGBA;\r\n        this.type = gl.UNSIGNED_BYTE;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, canvas);\r\n        return this;\r\n    };\r\n\r\n    Texture.prototype.toImage = function(image) {\r\n        this.use();\r\n        Shader.getDefaultShader().drawRect();\r\n        let size = this.width * this.height * 4;\r\n        let pixels = new Uint8Array(size);\r\n        let c = getCanvas(this);\r\n        let data = c.createImageData(this.width, this.height);\r\n        gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n        for (var i = 0; i < size; i++) {\r\n            data.data[i] = pixels[i];\r\n        }\r\n        c.putImageData(data, 0, 0);\r\n        image.src = canvas.toDataURL();\r\n    };\r\n\r\n    Texture.prototype.swapWith = function(other) {\r\n        let temp;\r\n        temp = other.id; other.id = this.id; this.id = temp;\r\n        temp = other.width; other.width = this.width; this.width = temp;\r\n        temp = other.height; other.height = this.height; this.height = temp;\r\n        temp = other.format; other.format = this.format; this.format = temp;\r\n    };\r\n\r\n    return Texture;\r\n})();\r\n\r\n// src/filters\\common.script\r\nfunction warpShader(uniforms, warp) {\r\n    return new Shader(null, uniforms + '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        vec2 coord = texCoord * texSize;\\\r\n        ' + warp + '\\\r\n        gl_FragColor = texture2D(texture, coord / texSize);\\\r\n        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\r\n        if (coord != clampedCoord) {\\\r\n            /* fade to transparent if we are outside the image */\\\r\n            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\r\n        }\\\r\n    }', 'warp');\r\n}\r\n\r\n// returns a random number between 0 and 1\r\nvar randomShaderFunc = '\\\r\n    float random(vec3 scale, float seed) {\\\r\n        /* use the fragment position for a different seed per-pixel */\\\r\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\r\n    }\\\r\n';\r\n\r\n// src/filters\\adjust\\brightnesscontrast.script\r\n/**\r\n * @filter           Brightness / Contrast\r\n * @description      Provides additive brightness and multiplicative contrast control.\r\n * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\r\n * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n */\r\nfunction brightnessContrast(brightness, contrast) {\r\n    gl.brightnessContrast = gl.brightnessContrast || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float brightness;\\\r\n        uniform float contrast;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.rgb += brightness;\\\r\n            if (contrast > 0.0) {\\\r\n                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\r\n            } else {\\\r\n                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\r\n            }\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'brightnessContrast');\r\n\r\n    simpleShader.call(this, gl.brightnessContrast, {\r\n        brightness: clamp(-1, brightness, 1),\r\n        contrast: clamp(-1, contrast, 1)\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\curves.script\r\nfunction splineInterpolate(points) {\r\n    let interpolator = new SplineInterpolator(points);\r\n    let array = [];\r\n    for (var i = 0; i < 256; i++) {\r\n        array.push(clamp(0, Math.floor(interpolator.interpolate(i / 255) * 256), 255));\r\n    }\r\n    return array;\r\n}\r\n\r\n/**\r\n * @filter      Curves\r\n * @description A powerful mapping tool that transforms the colors in the image\r\n *              by an arbitrary function. The function is interpolated between\r\n *              a set of 2D points using splines. The curves filter can take\r\n *              either one or three arguments which will apply the mapping to\r\n *              either luminance or RGB values, respectively.\r\n * @param red   A list of points that define the function for the red channel.\r\n *              Each point is a list of two values: the value before the mapping\r\n *              and the value after the mapping, both in the range 0 to 1. For\r\n *              example, [[0,1], [1,0]] would invert the red channel while\r\n *              [[0,0], [1,1]] would leave the red channel unchanged. If green\r\n *              and blue are omitted then this argument also applies to the\r\n *              green and blue channels.\r\n * @param green (optional) A list of points that define the function for the green\r\n *              channel (just like for red).\r\n * @param blue  (optional) A list of points that define the function for the blue\r\n *              channel (just like for red).\r\n */\r\nfunction curves(red, green, blue) {\r\n    // Create the ramp texture\r\n    red = splineInterpolate(red);\r\n    if (arguments.length == 1) {\r\n        green = blue = red;\r\n    } else {\r\n        green = splineInterpolate(green);\r\n        blue = splineInterpolate(blue);\r\n    }\r\n    let array = [];\r\n    for (var i = 0; i < 256; i++) {\r\n        array.splice(array.length, 0, red[i], green[i], blue[i], 255);\r\n    }\r\n    this._.extraTexture.initFromBytes(256, 1, array);\r\n    this._.extraTexture.use(1);\r\n\r\n    gl.curves = gl.curves || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform sampler2D map;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.r = texture2D(map, vec2(color.r)).r;\\\r\n            color.g = texture2D(map, vec2(color.g)).g;\\\r\n            color.b = texture2D(map, vec2(color.b)).b;\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'curves');\r\n\r\n    gl.curves.textures({\r\n        map: 1\r\n    });\r\n    simpleShader.call(this, gl.curves, {});\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\denoise.script\r\n/**\r\n * @filter         Denoise\r\n * @description    Smooths over grainy noise in dark images using an 9x9 box filter\r\n *                 weighted by color intensity, similar to a bilateral filter.\r\n * @param exponent The exponent of the color intensity difference, should be greater\r\n *                 than zero. A value of zero just gives an 9x9 box blur and high values\r\n *                 give the original image, but ideal values are usually around 10-20.\r\n */\r\nfunction denoise(exponent) {\r\n    // Do a 9x9 bilateral box filter\r\n    gl.denoise = gl.denoise || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float exponent;\\\r\n        uniform float strength;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 center = texture2D(texture, texCoord);\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            for (float x = -4.0; x <= 4.0; x += 1.0) {\\\r\n                for (float y = -4.0; y <= 4.0; y += 1.0) {\\\r\n                    vec4 sample = texture2D(texture, texCoord + vec2(x, y) / texSize);\\\r\n                    float weight = 1.0 - abs(dot(sample.rgb - center.rgb, vec3(0.25)));\\\r\n                    weight = pow(weight, exponent);\\\r\n                    color += sample * weight;\\\r\n                    total += weight;\\\r\n                }\\\r\n            }\\\r\n            gl_FragColor = color / total;\\\r\n        }\\\r\n    ', 'denoise');\r\n\r\n    // Perform two iterations for stronger results\r\n    for (var i = 0; i < 2; i++) {\r\n        simpleShader.call(this, gl.denoise, {\r\n            exponent: Math.max(0, exponent),\r\n            texSize: [this.width, this.height]\r\n        });\r\n    }\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\huesaturation.script\r\n/**\r\n * @filter           Hue / Saturation\r\n * @description      Provides rotational hue and multiplicative saturation control. RGB color space\r\n *                   can be imagined as a cube where the axes are the red, green, and blue color\r\n *                   values. Hue changing works by rotating the color vector around the grayscale\r\n *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\r\n *                   Saturation is implemented by scaling all color channel values either toward\r\n *                   or away from the average color channel value.\r\n * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\r\n *                   and 1 is 180 degree rotation in the positive direction)\r\n * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n */\r\nfunction hueSaturation(hue, saturation) {\r\n    gl.hueSaturation = gl.hueSaturation || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float hue;\\\r\n        uniform float saturation;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\r\n            float angle = hue * 3.14159265;\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\r\n            float len = length(color.rgb);\\\r\n            color.rgb = vec3(\\\r\n                dot(color.rgb, weights.xyz),\\\r\n                dot(color.rgb, weights.zxy),\\\r\n                dot(color.rgb, weights.yzx)\\\r\n            );\\\r\n            \\\r\n            /* saturation adjustment */\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            if (saturation > 0.0) {\\\r\n                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\r\n            } else {\\\r\n                color.rgb += (average - color.rgb) * (-saturation);\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'hueSaturation');\r\n\r\n    simpleShader.call(this, gl.hueSaturation, {\r\n        hue: clamp(-1, hue, 1),\r\n        saturation: clamp(-1, saturation, 1)\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\noise.script\r\n/**\r\n * @filter         Noise\r\n * @description    Adds black and white noise to the image.\r\n * @param amount   0 to 1 (0 for no effect, 1 for maximum noise)\r\n */\r\nfunction noise(amount) {\r\n    gl.noise = gl.noise || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        float rand(vec2 co) {\\\r\n            return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\\\r\n        }\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            float diff = (rand(texCoord) - 0.5) * amount;\\\r\n            color.r += diff;\\\r\n            color.g += diff;\\\r\n            color.b += diff;\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'noise');\r\n\r\n    simpleShader.call(this, gl.noise, {\r\n        amount: clamp(0, amount, 1)\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\sepia.script\r\n/**\r\n * @filter         Sepia\r\n * @description    Gives the image a reddish-brown monochrome tint that imitates an old photograph.\r\n * @param amount   0 to 1 (0 for no effect, 1 for full sepia coloring)\r\n */\r\nfunction sepia(amount) {\r\n    gl.sepia = gl.sepia || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float r = color.r;\\\r\n            float g = color.g;\\\r\n            float b = color.b;\\\r\n            \\\r\n            color.r = min(1.0, (r * (1.0 - (0.607 * amount))) + (g * (0.769 * amount)) + (b * (0.189 * amount)));\\\r\n            color.g = min(1.0, (r * 0.349 * amount) + (g * (1.0 - (0.314 * amount))) + (b * 0.168 * amount));\\\r\n            color.b = min(1.0, (r * 0.272 * amount) + (g * 0.534 * amount) + (b * (1.0 - (0.869 * amount))));\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'sepia');\r\n\r\n    simpleShader.call(this, gl.sepia, {\r\n        amount: clamp(0, amount, 1)\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\unsharpmask.script\r\n/**\r\n * @filter         Unsharp Mask\r\n * @description    A form of image sharpening that amplifies high-frequencies in the image. It\r\n *                 is implemented by scaling pixels away from the average of their neighbors.\r\n * @param radius   The blur radius that calculates the average of the neighboring pixels.\r\n * @param strength A scale factor where 0 is no effect and higher values cause a stronger effect.\r\n */\r\nfunction unsharpMask(radius, strength) {\r\n    gl.unsharpMask = gl.unsharpMask || new Shader(null, '\\\r\n        uniform sampler2D blurredTexture;\\\r\n        uniform sampler2D originalTexture;\\\r\n        uniform float strength;\\\r\n        uniform float threshold;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 blurred = texture2D(blurredTexture, texCoord);\\\r\n            vec4 original = texture2D(originalTexture, texCoord);\\\r\n            gl_FragColor = mix(blurred, original, 1.0 + strength);\\\r\n        }\\\r\n    ', 'unsharpMask');\r\n\r\n    // Store a copy of the current texture in the second texture unit\r\n    this._.extraTexture.ensureFormat(this._.texture);\r\n    this._.texture.use();\r\n    this._.extraTexture.drawTo(function() {\r\n        Shader.getDefaultShader().drawRect();\r\n    });\r\n\r\n    // Blur the current texture, then use the stored texture to detect edges\r\n    this._.extraTexture.use(1);\r\n    this.triangleBlur(radius);\r\n    gl.unsharpMask.textures({\r\n        originalTexture: 1\r\n    });\r\n    simpleShader.call(this, gl.unsharpMask, {\r\n        strength: strength\r\n    });\r\n    this._.extraTexture.unuse(1);\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\vibrance.script\r\n/**\r\n * @filter       Vibrance\r\n * @description  Modifies the saturation of desaturated colors, leaving saturated colors unmodified.\r\n * @param amount -1 to 1 (-1 is minimum vibrance, 0 is no change, and 1 is maximum vibrance)\r\n */\r\nfunction vibrance(amount) {\r\n    gl.vibrance = gl.vibrance || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            float mx = max(color.r, max(color.g, color.b));\\\r\n            float amt = (mx - average) * (-amount * 3.0);\\\r\n            color.rgb = mix(color.rgb, vec3(mx), amt);\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'vibrance');\r\n\r\n    simpleShader.call(this, gl.vibrance, {\r\n        amount: clamp(-1, amount, 1)\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\adjust\\vignette.script\r\n/**\r\n * @filter         Vignette\r\n * @description    Adds a simulated lens edge darkening effect.\r\n * @param size     0 to 1 (0 for center of frame, 1 for edge of frame)\r\n * @param amount   0 to 1 (0 for no effect, 1 for maximum lens darkening)\r\n */\r\nfunction vignette(size, amount) {\r\n    gl.vignette = gl.vignette || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float size;\\\r\n        uniform float amount;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            float dist = distance(texCoord, vec2(0.5, 0.5));\\\r\n            color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount + size));\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'vignette');\r\n\r\n    simpleShader.call(this, gl.vignette, {\r\n        size: clamp(0, size, 1),\r\n        amount: clamp(0, amount, 1)\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\blur\\lensblur.script\r\n/**\r\n * @filter           Lens Blur\r\n * @description      Imitates a camera capturing the image out of focus by using a blur that generates\r\n *                   the large shapes known as bokeh. The polygonal shape of real bokeh is due to the\r\n *                   blades of the aperture diaphragm when it isn't fully open. This blur renders\r\n *                   bokeh from a 6-bladed diaphragm because the computation is more efficient. It\r\n *                   can be separated into three rhombi, each of which is just a skewed box blur.\r\n *                   This filter makes use of the floating point texture WebGL extension to implement\r\n *                   the brightness parameter, so there will be severe visual artifacts if brightness\r\n *                   is non-zero and the floating point texture extension is not available. The\r\n *                   idea was from John White's SIGGRAPH 2011 talk but this effect has an additional\r\n *                   brightness parameter that fakes what would otherwise come from a HDR source.\r\n * @param radius     the radius of the hexagonal disk convolved with the image\r\n * @param brightness -1 to 1 (the brightness of the bokeh, negative values will create dark bokeh)\r\n * @param angle      the rotation of the bokeh in radians\r\n */\r\nfunction lensBlur(radius, brightness, angle) {\r\n    // All averaging is done on values raised to a power to make more obvious bokeh\r\n    // (we will raise the average to the inverse power at the end to compensate).\r\n    // Without this the image looks almost like a normal blurred image. This hack is\r\n    // obviously not realistic, but to accurately simulate this we would need a high\r\n    // dynamic range source photograph which we don't have.\r\n    gl.lensBlurPrePass = gl.lensBlurPrePass || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float power;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color = pow(color, vec4(power));\\\r\n            gl_FragColor = vec4(color);\\\r\n        }\\\r\n    ', 'lensBlurPrePass');\r\n\r\n    let common = '\\\r\n        uniform sampler2D texture0;\\\r\n        uniform sampler2D texture1;\\\r\n        uniform vec2 delta0;\\\r\n        uniform vec2 delta1;\\\r\n        uniform float power;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        vec4 sample(vec2 delta) {\\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(delta, 151.7182), 0.0);\\\r\n            \\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            for (float t = 0.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset) / 30.0;\\\r\n                color += texture2D(texture0, texCoord + delta * percent);\\\r\n                total += 1.0;\\\r\n            }\\\r\n            return color / total;\\\r\n        }\\\r\n    ';\r\n\r\n    gl.lensBlur0 = gl.lensBlur0 || new Shader(null, common + '\\\r\n        void main() {\\\r\n            gl_FragColor = sample(delta0);\\\r\n        }\\\r\n    ', 'lensBlur0');\r\n    gl.lensBlur1 = gl.lensBlur1 || new Shader(null, common + '\\\r\n        void main() {\\\r\n            gl_FragColor = (sample(delta0) + sample(delta1)) * 0.5;\\\r\n        }\\\r\n    ', 'lensBlur1');\r\n    gl.lensBlur2 = gl.lensBlur2 || new Shader(null, common + '\\\r\n        void main() {\\\r\n            vec4 color = (sample(delta0) + 2.0 * texture2D(texture1, texCoord)) / 3.0;\\\r\n            gl_FragColor = pow(color, vec4(power));\\\r\n        }\\\r\n    ', 'lensBlur2').textures({ texture1: 1 });\r\n\r\n    // Generate\r\n    let dir = [];\r\n    for (var i = 0; i < 3; i++) {\r\n        let a = angle + i * Math.PI * 2 / 3;\r\n        dir.push([radius * Math.sin(a) / this.width, radius * Math.cos(a) / this.height]);\r\n    }\r\n    let power = Math.pow(10, clamp(-1, brightness, 1));\r\n\r\n    // Remap the texture values, which will help make the bokeh effect\r\n    simpleShader.call(this, gl.lensBlurPrePass, {\r\n        power: power\r\n    });\r\n\r\n    // Blur two rhombi in parallel into extraTexture\r\n    this._.extraTexture.ensureFormat(this._.texture);\r\n    simpleShader.call(this, gl.lensBlur0, {\r\n        delta0: dir[0]\r\n    }, this._.texture, this._.extraTexture);\r\n    simpleShader.call(this, gl.lensBlur1, {\r\n        delta0: dir[1],\r\n        delta1: dir[2]\r\n    }, this._.extraTexture, this._.extraTexture);\r\n\r\n    // Blur the last rhombus and combine with extraTexture\r\n    simpleShader.call(this, gl.lensBlur0, {\r\n        delta0: dir[1]\r\n    });\r\n    this._.extraTexture.use(1);\r\n    simpleShader.call(this, gl.lensBlur2, {\r\n        power: 1 / power,\r\n        delta0: dir[2]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\blur\\tiltshift.script\r\n/**\r\n * @filter               Tilt Shift\r\n * @description          Simulates the shallow depth of field normally encountered in close-up\r\n *                       photography, which makes the scene seem much smaller than it actually\r\n *                       is. This filter assumes the scene is relatively planar, in which case\r\n *                       the part of the scene that is completely in focus can be described by\r\n *                       a line (the intersection of the focal plane and the scene). An example\r\n *                       of a planar scene might be looking at a road from above at a downward\r\n *                       angle. The image is then blurred with a blur radius that starts at zero\r\n *                       on the line and increases further from the line.\r\n * @param startX         The x coordinate of the start of the line segment.\r\n * @param startY         The y coordinate of the start of the line segment.\r\n * @param endX           The x coordinate of the end of the line segment.\r\n * @param endY           The y coordinate of the end of the line segment.\r\n * @param blurRadius     The maximum radius of the pyramid blur.\r\n * @param gradientRadius The distance from the line at which the maximum blur radius is reached.\r\n */\r\nfunction tiltShift(startX, startY, endX, endY, blurRadius, gradientRadius) {\r\n    gl.tiltShift = gl.tiltShift || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float blurRadius;\\\r\n        uniform float gradientRadius;\\\r\n        uniform vec2 start;\\\r\n        uniform vec2 end;\\\r\n        uniform vec2 delta;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\\\r\n            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'tiltShift');\r\n\r\n    let dx = endX - startX;\r\n    let dy = endY - startY;\r\n    let d = Math.sqrt(dx * dx + dy * dy);\r\n    simpleShader.call(this, gl.tiltShift, {\r\n        blurRadius: blurRadius,\r\n        gradientRadius: gradientRadius,\r\n        start: [startX, startY],\r\n        end: [endX, endY],\r\n        delta: [dx / d, dy / d],\r\n        texSize: [this.width, this.height]\r\n    });\r\n    simpleShader.call(this, gl.tiltShift, {\r\n        blurRadius: blurRadius,\r\n        gradientRadius: gradientRadius,\r\n        start: [startX, startY],\r\n        end: [endX, endY],\r\n        delta: [-dy / d, dx / d],\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\blur\\triangleblur.script\r\n/**\r\n * @filter       Triangle Blur\r\n * @description  This is the most basic blur filter, which convolves the image with a\r\n *               pyramid filter. The pyramid filter is separable and is applied as two\r\n *               perpendicular triangle filters.\r\n * @param radius The radius of the pyramid convolved with the image.\r\n */\r\nfunction triangleBlur(radius) {\r\n    gl.triangleBlur = gl.triangleBlur || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta * percent);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'triangleBlur');\r\n\r\n    simpleShader.call(this, gl.triangleBlur, {\r\n        delta: [radius / this.width, 0]\r\n    });\r\n    simpleShader.call(this, gl.triangleBlur, {\r\n        delta: [0, radius / this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\blur\\zoomblur.script\r\n/**\r\n * @filter         Zoom Blur\r\n * @description    Blurs the image away from a certain point, which looks like radial motion blur.\r\n * @param centerX  The x coordinate of the blur origin.\r\n * @param centerY  The y coordinate of the blur origin.\r\n * @param strength The strength of the blur. Values in the range 0 to 1 are usually sufficient,\r\n *                 where 0 doesn't change the image and 1 creates a highly blurred image.\r\n */\r\nfunction zoomBlur(centerX, centerY, strength) {\r\n    gl.zoomBlur = gl.zoomBlur || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float strength;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            vec2 toCenter = center - texCoord * texSize;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = 0.0; t <= 40.0; t++) {\\\r\n                float percent = (t + offset) / 40.0;\\\r\n                float weight = 4.0 * (percent - percent * percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + toCenter * percent * strength / texSize);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'zoomBlur');\r\n\r\n    simpleShader.call(this, gl.zoomBlur, {\r\n        center: [centerX, centerY],\r\n        strength: strength,\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\fun\\colorhalftone.script\r\n/**\r\n * @filter        Color Halftone\r\n * @description   Simulates a CMYK halftone rendering of the image by multiplying pixel values\r\n *                with a four rotated 2D sine wave patterns, one each for cyan, magenta, yellow,\r\n *                and black.\r\n * @param centerX The x coordinate of the pattern origin.\r\n * @param centerY The y coordinate of the pattern origin.\r\n * @param angle   The rotation of the pattern in radians.\r\n * @param size    The diameter of a dot in pixels.\r\n */\r\nfunction colorHalftone(centerX, centerY, angle, size) {\r\n    gl.colorHalftone = gl.colorHalftone || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float angle;\\\r\n        uniform float scale;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        \\\r\n        float pattern(float angle) {\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec2 tex = texCoord * texSize - center;\\\r\n            vec2 point = vec2(\\\r\n                c * tex.x - s * tex.y,\\\r\n                s * tex.x + c * tex.y\\\r\n            ) * scale;\\\r\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\r\n        }\\\r\n        \\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            vec3 cmy = 1.0 - color.rgb;\\\r\n            float k = min(cmy.x, min(cmy.y, cmy.z));\\\r\n            cmy = (cmy - k) / (1.0 - k);\\\r\n            cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(angle + 0.26179), pattern(angle + 1.30899), pattern(angle)), 0.0, 1.0);\\\r\n            k = clamp(k * 10.0 - 5.0 + pattern(angle + 0.78539), 0.0, 1.0);\\\r\n            gl_FragColor = vec4(1.0 - cmy - k, color.a);\\\r\n        }\\\r\n    ', 'colorHalftone');\r\n\r\n    simpleShader.call(this, gl.colorHalftone, {\r\n        center: [centerX, centerY],\r\n        angle: angle,\r\n        scale: Math.PI / size,\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\fun\\dotscreen.script\r\n/**\r\n * @filter        Dot Screen\r\n * @description   Simulates a black and white halftone rendering of the image by multiplying\r\n *                pixel values with a rotated 2D sine wave pattern.\r\n * @param centerX The x coordinate of the pattern origin.\r\n * @param centerY The y coordinate of the pattern origin.\r\n * @param angle   The rotation of the pattern in radians.\r\n * @param size    The diameter of a dot in pixels.\r\n */\r\nfunction dotScreen(centerX, centerY, angle, size) {\r\n    gl.dotScreen = gl.dotScreen || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float angle;\\\r\n        uniform float scale;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        \\\r\n        float pattern() {\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec2 tex = texCoord * texSize - center;\\\r\n            vec2 point = vec2(\\\r\n                c * tex.x - s * tex.y,\\\r\n                s * tex.x + c * tex.y\\\r\n            ) * scale;\\\r\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\r\n        }\\\r\n        \\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\\\r\n        }\\\r\n    ', 'dotScreen');\r\n\r\n    simpleShader.call(this, gl.dotScreen, {\r\n        center: [centerX, centerY],\r\n        angle: angle,\r\n        scale: Math.PI / size,\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\fun\\edgework.script\r\n/**\r\n * @filter       Edge Work\r\n * @description  Picks out different frequencies in the image by subtracting two\r\n *               copies of the image blurred with different radii.\r\n * @param radius The radius of the effect in pixels.\r\n */\r\nfunction edgeWork(radius) {\r\n    gl.edgeWork1 = gl.edgeWork1 || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec2 color = vec2(0.0);\\\r\n            vec2 total = vec2(0.0);\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec3 sample = texture2D(texture, texCoord + delta * percent).rgb;\\\r\n                float average = (sample.r + sample.g + sample.b) / 3.0;\\\r\n                color.x += average * weight;\\\r\n                total.x += weight;\\\r\n                if (abs(t) < 15.0) {\\\r\n                    weight = weight * 2.0 - 1.0;\\\r\n                    color.y += average * weight;\\\r\n                    total.y += weight;\\\r\n                }\\\r\n            }\\\r\n            gl_FragColor = vec4(color / total, 0.0, 1.0);\\\r\n        }\\\r\n    ', 'edgeWork1');\r\n    gl.edgeWork2 = gl.edgeWork2 || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec2 color = vec2(0.0);\\\r\n            vec2 total = vec2(0.0);\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec2 sample = texture2D(texture, texCoord + delta * percent).xy;\\\r\n                color.x += sample.x * weight;\\\r\n                total.x += weight;\\\r\n                if (abs(t) < 15.0) {\\\r\n                    weight = weight * 2.0 - 1.0;\\\r\n                    color.y += sample.y * weight;\\\r\n                    total.y += weight;\\\r\n                }\\\r\n            }\\\r\n            float c = clamp(10000.0 * (color.y / total.y - color.x / total.x) + 0.5, 0.0, 1.0);\\\r\n            gl_FragColor = vec4(c, c, c, 1.0);\\\r\n        }\\\r\n    ', 'edgeWork2');\r\n\r\n    simpleShader.call(this, gl.edgeWork1, {\r\n        delta: [radius / this.width, 0]\r\n    });\r\n    simpleShader.call(this, gl.edgeWork2, {\r\n        delta: [0, radius / this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\fun\\hexagonalpixelate.script\r\n/**\r\n * @filter        Hexagonal Pixelate\r\n * @description   Renders the image using a pattern of hexagonal tiles. Tile colors\r\n *                are nearest-neighbor sampled from the centers of the tiles.\r\n * @param centerX The x coordinate of the pattern center.\r\n * @param centerY The y coordinate of the pattern center.\r\n * @param scale   The width of an individual tile, in pixels.\r\n */\r\nfunction hexagonalPixelate(centerX, centerY, scale) {\r\n    gl.hexagonalPixelate = gl.hexagonalPixelate || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 center;\\\r\n        uniform float scale;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec2 tex = (texCoord * texSize - center) / scale;\\\r\n            tex.y /= 0.866025404;\\\r\n            tex.x -= tex.y * 0.5;\\\r\n            \\\r\n            vec2 a;\\\r\n            if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) a = vec2(floor(tex.x), floor(tex.y));\\\r\n            else a = vec2(ceil(tex.x), ceil(tex.y));\\\r\n            vec2 b = vec2(ceil(tex.x), floor(tex.y));\\\r\n            vec2 c = vec2(floor(tex.x), ceil(tex.y));\\\r\n            \\\r\n            vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\\\r\n            vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\\\r\n            vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\\\r\n            vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\\\r\n            \\\r\n            float alen = length(TEX - A);\\\r\n            float blen = length(TEX - B);\\\r\n            float clen = length(TEX - C);\\\r\n            \\\r\n            vec2 choice;\\\r\n            if (alen < blen) {\\\r\n                if (alen < clen) choice = a;\\\r\n                else choice = c;\\\r\n            } else {\\\r\n                if (blen < clen) choice = b;\\\r\n                else choice = c;\\\r\n            }\\\r\n            \\\r\n            choice.x += choice.y * 0.5;\\\r\n            choice.y *= 0.866025404;\\\r\n            choice *= scale / texSize;\\\r\n            gl_FragColor = texture2D(texture, choice + center / texSize);\\\r\n        }\\\r\n    ', 'hexagonalPixelate');\r\n\r\n    simpleShader.call(this, gl.hexagonalPixelate, {\r\n        center: [centerX, centerY],\r\n        scale: scale,\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\fun\\ink.script\r\n/**\r\n * @filter         Ink\r\n * @description    Simulates outlining the image in ink by darkening edges stronger than a\r\n *                 certain threshold. The edge detection value is the difference of two\r\n *                 copies of the image, each blurred using a blur of a different radius.\r\n * @param strength The multiplicative scale of the ink edges. Values in the range 0 to 1\r\n *                 are usually sufficient, where 0 doesn't change the image and 1 adds lots\r\n *                 of black edges. Negative strength values will create white ink edges\r\n *                 instead of black ones.\r\n */\r\nfunction ink(strength) {\r\n    gl.ink = gl.ink || new Shader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float strength;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec2 dx = vec2(1.0 / texSize.x, 0.0);\\\r\n            vec2 dy = vec2(0.0, 1.0 / texSize.y);\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            float bigTotal = 0.0;\\\r\n            float smallTotal = 0.0;\\\r\n            vec3 bigAverage = vec3(0.0);\\\r\n            vec3 smallAverage = vec3(0.0);\\\r\n            for (float x = -2.0; x <= 2.0; x += 1.0) {\\\r\n                for (float y = -2.0; y <= 2.0; y += 1.0) {\\\r\n                    vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\\\r\n                    bigAverage += sample;\\\r\n                    bigTotal += 1.0;\\\r\n                    if (abs(x) + abs(y) < 2.0) {\\\r\n                        smallAverage += sample;\\\r\n                        smallTotal += 1.0;\\\r\n                    }\\\r\n                }\\\r\n            }\\\r\n            vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\\\r\n            gl_FragColor = vec4(color.rgb - dot(edge, edge) * strength * 100000.0, color.a);\\\r\n        }\\\r\n    ', 'ink');\r\n\r\n    simpleShader.call(this, gl.ink, {\r\n        strength: strength * strength * strength * strength * strength,\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\warp\\bulgepinch.script\r\n/**\r\n * @filter         Bulge / Pinch\r\n * @description    Bulges or pinches the image in a circle.\r\n * @param centerX  The x coordinate of the center of the circle of effect.\r\n * @param centerY  The y coordinate of the center of the circle of effect.\r\n * @param radius   The radius of the circle of effect.\r\n * @param strength -1 to 1 (-1 is strong pinch, 0 is no effect, 1 is strong bulge)\r\n */\r\nfunction bulgePinch(centerX, centerY, radius, strength) {\r\n    gl.bulgePinch = gl.bulgePinch || warpShader('\\\r\n        uniform float radius;\\\r\n        uniform float strength;\\\r\n        uniform vec2 center;\\\r\n    ', '\\\r\n        coord -= center;\\\r\n        float distance = length(coord);\\\r\n        if (distance < radius) {\\\r\n            float percent = distance / radius;\\\r\n            if (strength > 0.0) {\\\r\n                coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);\\\r\n            } else {\\\r\n                coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);\\\r\n            }\\\r\n        }\\\r\n        coord += center;\\\r\n    ');\r\n\r\n    simpleShader.call(this, gl.bulgePinch, {\r\n        radius: radius,\r\n        strength: clamp(-1, strength, 1),\r\n        center: [centerX, centerY],\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\warp\\matrixwarp.script\r\n/**\r\n * @filter                Matrix Warp\r\n * @description           Transforms an image by a 2x2 or 3x3 matrix. The coordinates used in\r\n *                        the transformation are (x, y) for a 2x2 matrix or (x, y, 1) for a\r\n *                        3x3 matrix, where x and y are in units of pixels.\r\n * @param matrix          A 2x2 or 3x3 matrix represented as either a list or a list of lists.\r\n *                        For example, the 3x3 matrix [[2,0,0],[0,3,0],[0,0,1]] can also be\r\n *                        represented as [2,0,0,0,3,0,0,0,1] or just [2,0,0,3].\r\n * @param inverse         A boolean value that, when true, applies the inverse transformation\r\n *                        instead. (optional, defaults to false)\r\n * @param useTextureSpace A boolean value that, when true, uses texture-space coordinates\r\n *                        instead of screen-space coordinates. Texture-space coordinates range\r\n *                        from -1 to 1 instead of 0 to width - 1 or height - 1, and are easier\r\n *                        to use for simple operations like flipping and rotating.\r\n */\r\nfunction matrixWarp(matrix, inverse, useTextureSpace) {\r\n    gl.matrixWarp = gl.matrixWarp || warpShader('\\\r\n        uniform mat3 matrix;\\\r\n        uniform bool useTextureSpace;\\\r\n    ', '\\\r\n        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;\\\r\n        vec3 warp = matrix * vec3(coord, 1.0);\\\r\n        coord = warp.xy / warp.z;\\\r\n        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;\\\r\n    ');\r\n\r\n    // Flatten all members of matrix into one big list\r\n    matrix = Array.prototype.concat.apply([], matrix);\r\n\r\n    // Extract a 3x3 matrix out of the arguments\r\n    if (matrix.length == 4) {\r\n        matrix = [\r\n            matrix[0], matrix[1], 0,\r\n            matrix[2], matrix[3], 0,\r\n            0, 0, 1\r\n        ];\r\n    } else if (matrix.length != 9) {\r\n        throw 'can only warp with 2x2 or 3x3 matrix';\r\n    }\r\n\r\n    simpleShader.call(this, gl.matrixWarp, {\r\n        matrix: inverse ? getInverse(matrix) : matrix,\r\n        texSize: [this.width, this.height],\r\n        useTextureSpace: useTextureSpace | 0\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n// src/filters\\warp\\perspective.script\r\n/**\r\n * @filter       Perspective\r\n * @description  Warps one quadrangle to another with a perspective transform. This can be used to\r\n *               make a 2D image look 3D or to recover a 2D image captured in a 3D environment.\r\n * @param before The x and y coordinates of four points before the transform in a flat list. This\r\n *               would look like [ax, ay, bx, by, cx, cy, dx, dy] for four points (ax, ay), (bx, by),\r\n *               (cx, cy), and (dx, dy).\r\n * @param after  The x and y coordinates of four points after the transform in a flat list, just\r\n *               like the other argument.\r\n */\r\nfunction perspective(before, after) {\r\n    let a = getSquareToQuad.apply(null, after);\r\n    let b = getSquareToQuad.apply(null, before);\r\n    let c = multiply(getInverse(a), b);\r\n    return this.matrixWarp(c);\r\n}\r\n\r\n// src/filters\\warp\\swirl.script\r\n/**\r\n * @filter        Swirl\r\n * @description   Warps a circular region of the image in a swirl.\r\n * @param centerX The x coordinate of the center of the circular region.\r\n * @param centerY The y coordinate of the center of the circular region.\r\n * @param radius  The radius of the circular region.\r\n * @param angle   The angle in radians that the pixels in the center of\r\n *                the circular region will be rotated by.\r\n */\r\nfunction swirl(centerX, centerY, radius, angle) {\r\n    gl.swirl = gl.swirl || warpShader('\\\r\n        uniform float radius;\\\r\n        uniform float angle;\\\r\n        uniform vec2 center;\\\r\n    ', '\\\r\n        coord -= center;\\\r\n        float distance = length(coord);\\\r\n        if (distance < radius) {\\\r\n            float percent = (radius - distance) / radius;\\\r\n            float theta = percent * percent * angle;\\\r\n            float s = sin(theta);\\\r\n            float c = cos(theta);\\\r\n            coord = vec2(\\\r\n                coord.x * c - coord.y * s,\\\r\n                coord.x * s + coord.y * c\\\r\n            );\\\r\n        }\\\r\n        coord += center;\\\r\n    ');\r\n\r\n    simpleShader.call(this, gl.swirl, {\r\n        radius: radius,\r\n        center: [centerX, centerY],\r\n        angle: angle,\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n/**\r\n * @filter        Invert\r\n * @description   Inverts color of each pixel\r\n */\r\nfunction invert() {\r\n    gl.invert = gl.invert || new Shader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        gl_FragColor = vec4(1.0 - color.r, 1.0 - color.g, 1.0 - color.b, color.a);\\\r\n    }\\\r\n', 'invert');\r\n\r\n    simpleShader.call(this, gl.invert, {\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n/**\r\n * @filter        To Alpha\r\n * @description   Generates alpha channel from luminance (r+g+b)\r\n * @param isInverted    boolean - invert luminance\r\n * @param replaceRGBA    rgba - color to replace rgb with. if a = 0 -> keep orig color\r\n */\r\nfunction toAlpha(isInverted, replaceRGBA) {\r\n    gl.toAlpha = gl.toAlpha || new Shader(null, '\\\r\n    uniform bool isInverted;\\\r\n    uniform vec4 replace;\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        float alpha = (color.r + color.g + color.b) / 3.0;\\\r\n        if (isInverted) alpha = 1.0 - alpha;\\\r\n        alpha = min(color.a, alpha);\\\r\n        if (replace.a > 0.0) color = replace;\\\r\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha);\\\r\n    }\\\r\n', 'toAlpha');\r\n\r\n    simpleShader.call(this, gl.toAlpha, {\r\n        isInverted: isInverted ? 1 : 0,\r\n        replace: replaceRGBA ? [replaceRGBA.r / 255, replaceRGBA.g / 255, replaceRGBA.b / 255, replaceRGBA.a] : [0,0,0,0],\r\n        texSize: [this.width, this.height]\r\n    });\r\n\r\n    return this;\r\n}\r\n\r\n\r\nreturn exports;\r\n})();\r\n","import {BB} from '../../bb/bb';\r\nimport {input} from '../ui/base-components/input';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {Cropper} from '../ui/components/cropper';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const cropExtend = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        const canvas = params.canvas;\r\n        if (!canvas)\r\n            return false;\r\n        const tempCanvas = BB.canvas();\r\n        {\r\n            let fit = BB.fitInto(canvas.getWidth(), canvas.getHeight(), 560, 400, 1);\r\n            let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n            let previewFactor = w / canvas.getWidth();\r\n            tempCanvas.width = w;\r\n            tempCanvas.height = h;\r\n            tempCanvas.style.display = 'block';\r\n            tempCanvas.getContext(\"2d\").drawImage(canvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n        }\r\n\r\n        const div = document.createElement(\"div\");\r\n        const result: any = {\r\n            element: div\r\n        };\r\n        div.innerHTML = LANG('filter-crop-description') + \"<br/><br/>\";\r\n        let left = 0, right = 0, top = 0, bottom = 0;\r\n        let leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\r\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n        let scale;\r\n\r\n\r\n\r\n        // --- input elements ---\r\n\r\n        const lrWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'}\r\n        });\r\n        const tbWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'}\r\n        });\r\n        div.appendChild(lrWrapper);\r\n        div.appendChild(tbWrapper);\r\n\r\n        const leftInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -canvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                leftChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n        const rightInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -canvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px'},\r\n            callback: function(v) {\r\n                rightChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n        const topInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -canvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                topChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n        const bottomInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -canvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px'},\r\n            callback: function(v) {\r\n                bottomChanged = true;\r\n                updateInput();\r\n            }\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            width: '60px'\r\n        };\r\n        lrWrapper.append(\r\n            BB.el({content: LANG('filter-crop-left') + ':', css: labelStyle}),\r\n            leftInput,\r\n            BB.el({content: LANG('filter-crop-right') + ':', css: labelStyle}),\r\n            rightInput\r\n        );\r\n        tbWrapper.append(\r\n            BB.el({content: LANG('filter-crop-top') + ':', css: labelStyle}),\r\n            topInput,\r\n            BB.el({content: LANG('filter-crop-bottom') + ':', css: labelStyle}),\r\n            bottomInput\r\n        );\r\n\r\n        function updateInput() {\r\n            left = parseInt(leftInput.value);\r\n            right = parseInt(rightInput.value);\r\n            top = parseInt(topInput.value);\r\n            bottom = parseInt(bottomInput.value);\r\n            let newWidth = canvas.getWidth() + left + right;\r\n            let newHeight = canvas.getHeight() + top + bottom;\r\n\r\n            if (newWidth <= 0) {\r\n                if (leftChanged) {\r\n                    left = -canvas.getWidth() - right + 1;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -canvas.getWidth() - left + 1;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = 1;\r\n            }\r\n            if (newWidth > maxWidth) {\r\n                if (leftChanged) {\r\n                    left = -canvas.getWidth() - right + maxWidth;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -canvas.getWidth() - left + maxWidth;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = maxWidth;\r\n            }\r\n            if (newHeight <= 0) {\r\n                if (topChanged) {\r\n                    top = -canvas.getHeight() - bottom + 1;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -canvas.getHeight() - top + 1;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = 1;\r\n            }\r\n            if (newHeight > maxHeight) {\r\n                if (topChanged) {\r\n                    top = -canvas.getHeight() - bottom + maxHeight;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -canvas.getHeight() - top + maxHeight;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = maxHeight;\r\n            }\r\n            cropper.setTransform({\r\n                x: -left,\r\n                y: -top,\r\n                width: newWidth,\r\n                height: newHeight\r\n            });\r\n\r\n\r\n            leftChanged = false;\r\n            rightChanged = false;\r\n            topChanged = false;\r\n            bottomChanged = false;\r\n        }\r\n\r\n        let useRuleOfThirds = true;\r\n        let ruleOThirdsCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-crop-rule-thirds'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                useRuleOfThirds = b;\r\n                cropper.showThirds(useRuleOfThirds);\r\n            }\r\n        });\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both'\r\n            }\r\n        }));\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 0};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 0},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n            {r: 0, g: 0, b: 0, a: 1}\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('filter-crop-fill'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function(rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                updateBg(rgbaObj);\r\n            }\r\n        });\r\n\r\n\r\n        const flexRow = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between'\r\n            }\r\n        });\r\n        div.appendChild(flexRow);\r\n        flexRow.appendChild(ruleOThirdsCheckbox.getElement());\r\n        flexRow.appendChild(colorOptions.getElement());\r\n\r\n\r\n        // when input field changed, or dragging in preview finished\r\n        // adjusts the zoom\r\n        function update(transform) {\r\n            const fit = BB.fitInto(transform.width, transform.height, 260, 180, 1);\r\n            scale = fit.width / transform.width;\r\n\r\n            const offset = BB.centerWithin(340, 220, fit.width, fit.height);\r\n\r\n            tempCanvas.style.width = canvas.getWidth() * scale + \"px\";\r\n            tempCanvas.style.height = canvas.getHeight() * scale + \"px\";\r\n\r\n            offsetWrapper.style.left = (offset.x - transform.x * scale) + \"px\";\r\n            offsetWrapper.style.top = (offset.y - transform.y * scale) + \"px\";\r\n\r\n            left = parseInt('' + -transform.x);\r\n            top = parseInt('' + -transform.y);\r\n            right = parseInt('' + (transform.x + transform.width - canvas.getWidth()));\r\n            bottom = parseInt('' + (transform.y + transform.height - canvas.getHeight()));\r\n            leftInput.value = '' + left;\r\n            topInput.value = '' + top;\r\n            rightInput.value = '' + right;\r\n            bottomInput.value = '' + bottom;\r\n\r\n            BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                previewWrapper.style.background = \"url(\" + url + \")\";\r\n                if (selectedRgbaObj.a !== 0) {\r\n                    tempCanvas.style.background = \"url(\" + url + \")\";\r\n                }\r\n            });\r\n            previewWrapper.style.backgroundPosition = (offset.x) + \"px \" + (offset.y) + \"px\";\r\n\r\n            cropper.setScale(scale);\r\n        }\r\n\r\n        const previewWrapper = BB.el({\r\n            css: {\r\n                width: \"340px\",\r\n                marginTop: '10px',\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                position: \"relative\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                userSelect: 'none',\r\n                colorScheme: 'only light',\r\n                touchAction: 'none',\r\n            }\r\n        });\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        const bgColorOverlay = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0'\r\n            }\r\n        });\r\n        previewWrapper.appendChild(bgColorOverlay);\r\n\r\n        const offsetWrapper = document.createElement(\"div\");\r\n        offsetWrapper.style.position = \"absolute\";\r\n        offsetWrapper.style.left = \"0px\";\r\n        offsetWrapper.style.top = \"0px\";\r\n        previewWrapper.appendChild(offsetWrapper);\r\n\r\n\r\n        const canvasWrapper = BB.appendTextDiv(offsetWrapper, \"\");\r\n        canvasWrapper.appendChild(tempCanvas);\r\n        //tempCanvas.style.width = w + \"px\";\r\n        //tempCanvas.style.height = h + \"px\";\r\n        tempCanvas.style.boxShadow = \"0 0 3px 1px rgba(0,0,0,0.5)\";\r\n        tempCanvas.style.position = \"absolute\";\r\n        tempCanvas.style.left = \"0px\";\r\n        tempCanvas.style.top = \"0px\";\r\n\r\n        div.appendChild(previewWrapper);\r\n        const cropper = new Cropper({\r\n            x: 0,\r\n            y: 0,\r\n            width: canvas.getWidth(),\r\n            height: canvas.getHeight(),\r\n            scale: scale,\r\n            callback: update,\r\n            maxW: maxWidth,\r\n            maxH: maxHeight\r\n        });\r\n        update(cropper.getTransform());\r\n        offsetWrapper.appendChild(cropper.getElement());\r\n\r\n        function updateBg(rgbaObj) {\r\n\r\n            let borderColor;\r\n            if (rgbaObj.a === 0) {\r\n                borderColor = 'rgba(0,0,0,0.5)';\r\n                bgColorOverlay.style.background = '';\r\n                tempCanvas.style.background = '';\r\n            } else {\r\n                borderColor = (rgbaObj.r + rgbaObj.g + rgbaObj.b < 255 * 3 / 2) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\r\n                bgColorOverlay.style.background = BB.ColorConverter.toRgbStr(rgbaObj);\r\n\r\n                BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                    tempCanvas.style.background = \"url(\" + url + \")\";\r\n                });\r\n            }\r\n            tempCanvas.style.boxShadow = \"0 0 3px 1px \" + borderColor;\r\n        }\r\n\r\n        result.destroy = () => {\r\n            cropper.destroy();\r\n            ruleOThirdsCheckbox.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return {\r\n                left: left,\r\n                right: right,\r\n                top: top,\r\n                bottom: bottom,\r\n                fillColor: selectedRgbaObj.a === 0 ? null : selectedRgbaObj\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const canvas = params.canvas;\r\n        const history = params.history;\r\n        if (!canvas || !history || isNaN(params.input.left) || isNaN(params.input.right) || isNaN(params.input.top) || isNaN(params.input.bottom)) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        canvas.resizeCanvas(params.input);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"cropExtend\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: JSON.parse(JSON.stringify(params.input))\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const glCurves = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div,\r\n        };\r\n        let klCanvasPreview;\r\n\r\n        function finishInit() {\r\n\r\n            let previewFactor = w / context.canvas.width;\r\n            let brightness = 0, contrast = 0;\r\n\r\n            div.innerHTML = LANG('filter-curves-description') + \"<br/><br/>\";\r\n\r\n            let curves = {\r\n                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n            };\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n                    if (klCanvasPreview) {\r\n                        klCanvasPreview.render();\r\n                    }\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            let modeButtons;\r\n\r\n            function CurvesInput(p) {\r\n                let div = document.createElement(\"div\");\r\n                div.oncontextmenu = function () {\r\n                    return false;\r\n                };\r\n                div.style.position = \"relative\";\r\n                div.style.marginBottom = \"10px\";\r\n                let mode = \"All\";\r\n                let curves = p.curves;\r\n                modeButtons = new Options( {\r\n                    optionArr: [\r\n                        {\r\n                            id: 'All',\r\n                            label: LANG('filter-curves-all')\r\n                        },\r\n                        {\r\n                            id: 'Red',\r\n                            label: LANG('red')\r\n                        },\r\n                        {\r\n                            id: 'Green',\r\n                            label: LANG('green')\r\n                        },\r\n                        {\r\n                            id: 'Blue',\r\n                            label: LANG('blue')\r\n                        },\r\n                    ],\r\n                    initialId: 'All',\r\n                    onChange: function(id) {\r\n                        mode = id;\r\n                        if (mode === \"All\") {\r\n                            curves = {\r\n                                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n                            };\r\n                        }\r\n                        let curve = curves.r;\r\n                        if (mode === \"Green\") {\r\n                            curve = curves.g;\r\n                        }\r\n                        if (mode === \"Blue\") {\r\n                            curve = curves.b;\r\n                        }\r\n                        (p0 as any).setPos(0, areah - curve[0][1] * areah);\r\n                        (p1 as any).setPos(curve[1][0] * areaw, areah - curve[1][1] * areah);\r\n                        (p2 as any).setPos(curve[2][0] * areaw, areah - curve[2][1] * areah);\r\n                        (p3 as any).setPos(areaw, areah - curve[3][1] * areah);\r\n\r\n                        update();\r\n                    }\r\n                });\r\n                div.appendChild(modeButtons.getElement());\r\n\r\n                let curveArea = document.createElement(\"div\");\r\n                BB.css(curveArea, {\r\n                    position: 'relative',\r\n                    marginTop: '10px',\r\n                    colorScheme: 'only light',\r\n                })\r\n                div.appendChild(curveArea);\r\n\r\n                let areaw = 300, areah = 100;\r\n                let canvas = BB.canvas(areaw, areah);\r\n                BB.css(canvas, {\r\n                    background: \"#c6c6c6\",\r\n                    boxShadow: \"0 0 0 1px rgba(0,0,0,0.3)\"\r\n                });\r\n                let ctx = canvas.getContext(\"2d\");\r\n                curveArea.appendChild(canvas);\r\n\r\n                let points = {\r\n                    r: [],\r\n                    g: [],\r\n                    b: []\r\n                };\r\n\r\n                function fit(v) {\r\n                    return Math.max(0, Math.min(1, v));\r\n                }\r\n\r\n                function createPoint(x, y, callback, lock?) {\r\n                    let gripSize = 14;\r\n                    let internalY = y, internalX = x;\r\n                    let point = document.createElement(\"div\");\r\n                    BB.css(point, {\r\n                        position: \"absolute\",\r\n                        left: (x - gripSize / 2) + \"px\",\r\n                        top: (y - gripSize / 2) + \"px\",\r\n                        width: gripSize + \"px\",\r\n                        height: gripSize + \"px\",\r\n                        background: \"#fff\",\r\n                        cursor: \"move\",\r\n                        borderRadius: gripSize + \"px\",\r\n                        boxShadow: \"inset 0 0 0 2px #000\",\r\n                        userSelect: 'none',\r\n                        touchAction: 'none',\r\n                    });\r\n\r\n                    function update() {\r\n                        BB.css(point, {\r\n                            left: (x - gripSize / 2) + \"px\",\r\n                            top: (y - gripSize / 2) + \"px\"\r\n                        });\r\n                    }\r\n\r\n                    (point as any).pointerListener = new BB.PointerListener({\r\n                        target: point,\r\n                        maxPointers: 1,\r\n                        onPointer: function(event) {\r\n                            event.eventPreventDefault();\r\n                            if (event.type === 'pointerdown') {\r\n                                internalX = x;\r\n                                internalY = y;\r\n                            }\r\n                            if (event.button === 'left' && event.type === 'pointermove') {\r\n                                if (!lock) {\r\n                                    internalX += event.dX;\r\n                                }\r\n                                x = Math.max(0, Math.min(areaw, internalX));\r\n                                internalY += event.dY;\r\n                                y = Math.max(0, Math.min(areah, internalY));\r\n                                update();\r\n                                callback({\r\n                                    x: x,\r\n                                    y: y\r\n                                });\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    curveArea.appendChild(point);\r\n\r\n                    (point as any).setPos = function (newX, newY) {\r\n                        x = newX;\r\n                        y = newY;\r\n                        internalY = y;\r\n                        internalX = x;\r\n                        BB.css(point, {\r\n                            left: (x - gripSize / 2) + \"px\",\r\n                            top: (y - gripSize / 2) + \"px\"\r\n                        });\r\n                    };\r\n\r\n                    return point;\r\n                }\r\n\r\n                function updateControl(i, x, y) {\r\n                    if (mode === \"All\") {\r\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                    if (mode === \"Red\") {\r\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                    if (mode === \"Green\") {\r\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                    if (mode === \"Blue\") {\r\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\r\n                    }\r\n                }\r\n\r\n                let p0 = createPoint(0, areah, function (val) {\r\n                    updateControl(0, val.x, val.y);\r\n                    update();\r\n                }, true);\r\n                let p1 = createPoint(areaw / 3, areah / 3 * 2, function (val) {\r\n                    updateControl(1, val.x, val.y);\r\n                    update();\r\n                });\r\n                let p2 = createPoint(areaw / 3 * 2, areah / 3, function (val) {\r\n                    updateControl(2, val.x, val.y);\r\n                    update();\r\n                });\r\n                let p3 = createPoint(areaw, 0, function (val) {\r\n                    updateControl(3, val.x, val.y);\r\n                    update();\r\n                }, true);\r\n\r\n\r\n                function update() {\r\n                    canvas.width = canvas.width;\r\n                    ctx = canvas.getContext(\"2d\");\r\n\r\n                    let outCurves = {\r\n                        r: [],\r\n                        g: [],\r\n                        b: []\r\n                    };\r\n                    for (let i = 0; i < curves.r.length; i++) {\r\n                        outCurves.r.push(curves.r[i]);\r\n                        outCurves.g.push(curves.g[i]);\r\n                        outCurves.b.push(curves.b[i]);\r\n                    }\r\n\r\n                    function drawCurve(curve) {\r\n                        ctx.beginPath();\r\n                        let spline = new BB.SplineInterpolator(curve);\r\n                        for (let i = 0; i < 100; i++) {\r\n                            let y = spline.interpolate(i / 100);\r\n                            y = Math.max(0, Math.min(1, y));\r\n\r\n                            if (i === 0) {\r\n                                ctx.moveTo(i / 100 * areaw, areah - y * areah);\r\n                            } else {\r\n                                ctx.lineTo(i / 100 * areaw, areah - y * areah);\r\n                            }\r\n                        }\r\n                        ctx.stroke();\r\n                    }\r\n\r\n                    ctx.save();\r\n                    if (mode === \"All\") {\r\n                        ctx.strokeStyle = \"black\";\r\n                        drawCurve(outCurves.r);\r\n                    } else {\r\n                        ctx.globalAlpha = 0.5;\r\n                        ctx.strokeStyle = \"red\";\r\n                        drawCurve(outCurves.r);\r\n                        ctx.strokeStyle = \"green\";\r\n                        drawCurve(outCurves.g);\r\n                        ctx.strokeStyle = \"blue\";\r\n                        drawCurve(outCurves.b);\r\n                    }\r\n                    ctx.restore();\r\n                    p.callback(outCurves);\r\n                }\r\n\r\n                update();\r\n\r\n\r\n                this.getDiv = function () {\r\n                    return div;\r\n                };\r\n                this.destroy = function() {\r\n                    (p0 as any).pointerListener.destroy();\r\n                    (p1 as any).pointerListener.destroy();\r\n                    (p2 as any).pointerListener.destroy();\r\n                    (p3 as any).pointerListener.destroy();\r\n                };\r\n            }\r\n\r\n            let input = new CurvesInput({\r\n                curves: curves,\r\n                callback: function (val) {\r\n                    curves = val;\r\n                    update();\r\n                }\r\n            });\r\n\r\n\r\n            div.appendChild(input.getDiv());\r\n\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            result.destroy = () => {\r\n                input.destroy();\r\n                texture.destroy();\r\n                modeButtons.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    curves: curves\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let curves = params.input.curves;\r\n        let history = params.history;\r\n        if (!context || curves === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glCurves\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const flip = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        let isHorizontal = true;\r\n        let isVertical = false;\r\n        let doFlipCanvas = true;\r\n        div.innerHTML = LANG('filter-flip-description') + \"<br/><br/>\";\r\n\r\n\r\n        let horizontalCheckbox = new Checkbox({\r\n            init: isHorizontal,\r\n            label: LANG('filter-flip-horizontal') + ' ',\r\n            allowTab: true,\r\n            callback: function(v) {\r\n                isHorizontal = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n        let verticalCheckbox = new Checkbox({\r\n            init: isVertical,\r\n            label: LANG('filter-flip-vertical') + ' ',\r\n            allowTab: true,\r\n            callback: function(v) {\r\n                isVertical = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n        div.appendChild(horizontalCheckbox.getElement());\r\n        div.appendChild(verticalCheckbox.getElement());\r\n\r\n\r\n\r\n\r\n\r\n        let fcOption = document.createElement(\"div\");\r\n        BB.setEventListener(fcOption, 'onpointerdown', function () {\r\n            return false;\r\n        });\r\n        fcOption.textContent = LANG('filter-flip-image');\r\n        fcOption.style.width = \"150px\";\r\n        fcOption.style.height = \"30px\";\r\n        fcOption.style.paddingTop = \"10px\";\r\n        fcOption.style.textAlign = \"center\";\r\n        fcOption.style.cssFloat = \"left\";\r\n        fcOption.style.paddingBottom = \"0px\";\r\n        fcOption.style.borderTopLeftRadius = \"10px\";\r\n        fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n        fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n        fcOption.style.backgroundSize = '8%';\r\n        fcOption.style.backgroundColor = \"#9e9e9e\";\r\n\r\n        let flOption = document.createElement(\"div\");\r\n        BB.setEventListener(flOption, 'onpointerdown', function () {\r\n            return false;\r\n        });\r\n        flOption.textContent = LANG('filter-flip-layer');\r\n        flOption.style.width = \"150px\";\r\n        flOption.style.height = \"30px\";\r\n        flOption.style.paddingTop = \"10px\";\r\n        flOption.style.textAlign = \"center\";\r\n        flOption.style.cssFloat = \"left\";\r\n        flOption.style.paddingBottom = \"0px\";\r\n        flOption.style.borderTopRightRadius = \"10px\";\r\n        flOption.style.cursor = \"pointer\";\r\n        flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n        flOption.style.backgroundSize = '8%';\r\n\r\n        BB.setEventListener(fcOption, 'onpointerover', function () {\r\n            if (doFlipCanvas === false)\r\n                fcOption.style.backgroundColor = \"#ccc\";\r\n        });\r\n        BB.setEventListener(fcOption, 'onpointerout', function () {\r\n            if (doFlipCanvas === false)\r\n                fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n        });\r\n        BB.setEventListener(flOption, 'onpointerover', function () {\r\n            if (doFlipCanvas === true)\r\n                flOption.style.backgroundColor = \"#ccc\";\r\n        });\r\n        BB.setEventListener(flOption, 'onpointerout', function () {\r\n            if (doFlipCanvas === true)\r\n                flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n        });\r\n\r\n        fcOption.onclick = function () {\r\n            doFlipCanvas = true;\r\n\r\n            flOption.style.background = \"\";\r\n            flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            flOption.style.boxShadow = \"\";\r\n            flOption.style.cursor = \"pointer\";\r\n\r\n            fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n            fcOption.style.backgroundSize = '8%';\r\n            fcOption.style.backgroundColor = \"#9e9e9e\";\r\n            fcOption.style.cursor = \"default\";\r\n            fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n\r\n            updatePreview();\r\n        };\r\n        flOption.onclick = function () {\r\n            doFlipCanvas = false;\r\n\r\n            fcOption.style.background = \"\";\r\n            fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            fcOption.style.boxShadow = \"\";\r\n            fcOption.style.cursor = \"pointer\";\r\n\r\n            flOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n            flOption.style.backgroundSize = '8%';\r\n            flOption.style.backgroundColor = \"#9e9e9e\";\r\n            flOption.style.cursor = \"default\";\r\n            flOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n\r\n            updatePreview();\r\n        };\r\n\r\n        let optionWrapper = document.createElement(\"div\");\r\n        optionWrapper.appendChild(fcOption);\r\n        optionWrapper.appendChild(flOption);\r\n        div.appendChild(optionWrapper);\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(Math.round(w), Math.round(h)),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over' as IMixMode,\r\n        };\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: [previewLayer]\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        function updatePreview() {\r\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\r\n\r\n            if (doFlipCanvas) {\r\n                if (isHorizontal) {\r\n                    ctx.translate(previewLayer.image.width, 0);\r\n                    ctx.scale(-1, 1);\r\n                }\r\n                if (isVertical) {\r\n                    ctx.translate(0, previewLayer.image.height);\r\n                    ctx.scale(1, -1);\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < layers.length; i++) {\r\n                ctx.save();\r\n                if (!doFlipCanvas && selectedLayerIndex === i) {\r\n                    if (isHorizontal) {\r\n                        ctx.translate(previewLayer.image.width, 0);\r\n                        ctx.scale(-1, 1);\r\n                    }\r\n                    if (isVertical) {\r\n                        ctx.translate(0, previewLayer.image.height);\r\n                        ctx.scale(1, -1);\r\n                    }\r\n                }\r\n                if (ctx.canvas.width > layers[i].context.canvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.globalAlpha = layers[i].opacity;\r\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\r\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\r\n                ctx.restore();\r\n            }\r\n            klCanvasPreview.render();\r\n            ctx.restore();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            horizontalCheckbox.destroy();\r\n            verticalCheckbox.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return {\r\n                horizontal: isHorizontal,\r\n                vertical: isVertical,\r\n                flipCanvas: doFlipCanvas\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        let history = params.history;\r\n        let horizontal = params.input.horizontal;\r\n        let vertical = params.input.vertical;\r\n        let flipCanvas = params.input.flipCanvas;\r\n        if (!context || !canvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        canvas.flip(horizontal, vertical, flipCanvas ? null : canvas.getLayerIndex(context.canvas));\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: [\"filter\", \"flip\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    },\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eFiVD\");","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const glHueSaturation = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height,280, 200,  1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        function finishInit() {\r\n            let hue = 0, Saturation = 0;\r\n            div.innerHTML = LANG('filter-hue-sat-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let hueSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-hue'),\r\n                width: 300,\r\n                height: 30,\r\n                min: -100,\r\n                max: 100,\r\n                initValue: hue * 100,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    hue = val / 100;\r\n                    glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\r\n                    klCanvasPreview.render();\r\n                }\r\n            });\r\n            let saturationSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-saturation'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                initValue: (Saturation + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    Saturation = val / 50 - 1;\r\n                    glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\r\n                    klCanvasPreview.render();\r\n                }\r\n            });\r\n            hueSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(hueSlider.getElement());\r\n            div.appendChild(saturationSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                hueSlider.destroy();\r\n                saturationSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    hue: hue,\r\n                    Saturation: Saturation\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let hue = params.input.hue;\r\n        let history = params.history;\r\n        let Saturation = params.input.Saturation;\r\n        if (!context || hue === null || Saturation === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glHueSaturation\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply} from '../kl.types';\r\n\r\nexport const invert = {\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false;\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).invert().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"invert\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const glPerspective = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let isSmall = window.innerWidth < 550;\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n\r\n        let pointerListenerArr = [];\r\n\r\n        function finishInit() {\r\n            div.innerHTML = LANG('filter-perspective-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n            let ba, bb, bc, bd; //before\r\n            let aa, ab, ac, ad; //after\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).perspective(\r\n                        [ba.x, ba.y, bb.x, bb.y, bc.x, bc.y, bd.x, bd.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        }),\r\n                        [aa.x, aa.y, ab.x, ab.y, ac.x, ac.y, ad.x, ad.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        })\r\n                    ).update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob(x, y, callback?) {\r\n                let nobSize = 14;\r\n                let div = document.createElement(\"div\");\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                BB.css(div, {\r\n                    width: nobSize + \"px\",\r\n                    height: nobSize + \"px\",\r\n                    backgroundColor: \"#fff\",\r\n                    boxShadow: \"inset 0 0 0 2px #000\",\r\n                    borderRadius: nobSize + \"px\",\r\n                    position: \"absolute\",\r\n                    cursor: \"move\",\r\n                    left: ((div as any).x - nobSize / 2) + \"px\",\r\n                    top: ((div as any).y - nobSize / 2) + \"px\",\r\n                    userSelect: 'none',\r\n                    touchAction: 'none',\r\n                });\r\n\r\n                let pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    maxPointers: 1,\r\n                    onPointer: function(event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                            if (callback) {\r\n                                callback();\r\n                            }\r\n                            update();\r\n                        }\r\n                    }\r\n                });\r\n                (div as any).copy = function (p) {\r\n                    (div as any).x = p.x;\r\n                    (div as any).y = p.y;\r\n                    div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                    div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                };\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            function updateAfter() {\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            }\r\n\r\n            ba = nob(0, 0, updateAfter);\r\n            bb = nob(displayW, 0, updateAfter);\r\n            bc = nob(displayW, displayH, updateAfter);\r\n            bd = nob(0, displayH, updateAfter);\r\n            aa = nob(0, 0);\r\n            ab = nob(displayW, 0);\r\n            ac = nob(displayW, displayH);\r\n            ad = nob(0, displayH);\r\n\r\n            let before = false;\r\n            let beforeOption = document.createElement(\"div\");\r\n            BB.setEventListener(beforeOption, 'onpointerdown', function () {\r\n                return false;\r\n            });\r\n            beforeOption.textContent = LANG('filter-perspective-before');\r\n            beforeOption.style.width = \"150px\";\r\n            beforeOption.style.height = \"30px\";\r\n            beforeOption.style.marginLeft = isSmall ? '0' : \"100px\";\r\n            beforeOption.style.paddingTop = \"10px\";\r\n            beforeOption.style.textAlign = \"center\";\r\n            beforeOption.style.cssFloat = \"left\";\r\n            beforeOption.style.paddingBottom = \"0px\";\r\n            beforeOption.style.borderTopLeftRadius = \"10px\";\r\n            beforeOption.style.cursor = \"pointer\";\r\n            beforeOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            beforeOption.style.backgroundSize = '8%';\r\n\r\n            let afterOption = document.createElement(\"div\");\r\n            BB.setEventListener(afterOption, 'onpointerdown', function () {\r\n                return false;\r\n            });\r\n            afterOption.textContent = LANG('filter-perspective-after');\r\n            afterOption.style.width = \"150px\";\r\n            afterOption.style.height = \"30px\";\r\n            afterOption.style.paddingTop = \"10px\";\r\n            afterOption.style.textAlign = \"center\";\r\n            afterOption.style.cssFloat = \"left\";\r\n            afterOption.style.paddingBottom = \"0px\";\r\n            afterOption.style.borderTopRightRadius = \"10px\";\r\n            afterOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n            afterOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n            afterOption.style.backgroundSize = '8%';\r\n            afterOption.style.backgroundColor = \"#9e9e9e\";\r\n\r\n\r\n            BB.setEventListener(beforeOption, 'onpointerover', function () {\r\n                if (before === false)\r\n                    beforeOption.style.backgroundColor = \"#ccc\";\r\n            });\r\n            BB.setEventListener(beforeOption, 'onpointerout', function () {\r\n                if (before === false)\r\n                    beforeOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            });\r\n            BB.setEventListener(afterOption, 'onpointerover', function () {\r\n                if (before === true)\r\n                    afterOption.style.backgroundColor = \"#ccc\";\r\n            });\r\n            BB.setEventListener(afterOption, 'onpointerout', function () {\r\n                if (before === true)\r\n                    afterOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            });\r\n\r\n            beforeOption.onclick = function () {\r\n\r\n                beforeOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n                beforeOption.style.backgroundSize = '8%';\r\n                beforeOption.style.backgroundColor = \"#9e9e9e\";\r\n                beforeOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n                beforeOption.style.cursor = \"default\";\r\n\r\n                afterOption.style.background = \"\";\r\n                afterOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n                afterOption.style.boxShadow = \"\";\r\n                afterOption.style.cursor = \"pointer\";\r\n\r\n                aa.style.display = \"none\";\r\n                ab.style.display = \"none\";\r\n                ac.style.display = \"none\";\r\n                ad.style.display = \"none\";\r\n\r\n                ba.style.display = \"block\";\r\n                bb.style.display = \"block\";\r\n                bc.style.display = \"block\";\r\n                bd.style.display = \"block\";\r\n                ba.copy(aa);\r\n                bb.copy(ab);\r\n                bc.copy(ac);\r\n                bd.copy(ad);\r\n                before = true;\r\n                update();\r\n            };\r\n            afterOption.onclick = function () {\r\n                before = false;\r\n\r\n                afterOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n                afterOption.style.backgroundSize = '8%';\r\n                afterOption.style.backgroundColor = \"#9e9e9e\";\r\n                afterOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n                afterOption.style.cursor = \"default\";\r\n\r\n                beforeOption.style.background = \"\";\r\n                beforeOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n                beforeOption.style.boxShadow = \"\";\r\n                beforeOption.style.cursor = \"pointer\";\r\n\r\n                ba.style.display = \"none\";\r\n                bb.style.display = \"none\";\r\n                bc.style.display = \"none\";\r\n                bd.style.display = \"none\";\r\n\r\n                aa.style.display = \"block\";\r\n                ab.style.display = \"block\";\r\n                ac.style.display = \"block\";\r\n                ad.style.display = \"block\";\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            };\r\n\r\n            let optionWrapper = document.createElement(\"div\");\r\n            optionWrapper.appendChild(beforeOption);\r\n            optionWrapper.appendChild(afterOption);\r\n            div.appendChild(optionWrapper);\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n            BB.css(previewWrapper, {\r\n                width: isSmall ? '340px' : '540px',\r\n                marginLeft: \"-20px\",\r\n                height: isSmall ? '260px' : '300px',\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    let canvas = i === selectedLayerIndex ? glCanvas : layers[i].context.canvas;\r\n                    previewLayerArr.push({\r\n                        image: canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.appendChild(aa);\r\n            previewInnerWrapper.appendChild(ab);\r\n            previewInnerWrapper.appendChild(ac);\r\n            previewInnerWrapper.appendChild(ad);\r\n\r\n            ba.style.display = \"none\";\r\n            bb.style.display = \"none\";\r\n            bc.style.display = \"none\";\r\n            bd.style.display = \"none\";\r\n            previewInnerWrapper.appendChild(ba);\r\n            previewInnerWrapper.appendChild(bb);\r\n            previewInnerWrapper.appendChild(bc);\r\n            previewInnerWrapper.appendChild(bd);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n            update();\r\n            result.destroy = () => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    before: [\r\n                        ba.x / displayPreviewFactor,\r\n                        ba.y / displayPreviewFactor,\r\n\r\n                        bb.x / displayPreviewFactor,\r\n                        bb.y / displayPreviewFactor,\r\n\r\n                        bc.x / displayPreviewFactor,\r\n                        bc.y / displayPreviewFactor,\r\n\r\n                        bd.x / displayPreviewFactor,\r\n                        bd.y / displayPreviewFactor,\r\n                    ],\r\n                    after: [\r\n                        aa.x / displayPreviewFactor,\r\n                        aa.y / displayPreviewFactor,\r\n\r\n                        ab.x / displayPreviewFactor,\r\n                        ab.y / displayPreviewFactor,\r\n\r\n                        ac.x / displayPreviewFactor,\r\n                        ac.y / displayPreviewFactor,\r\n\r\n                        ad.x / displayPreviewFactor,\r\n                        ad.y / displayPreviewFactor,\r\n                    ]\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let before = params.input.before;\r\n        let after = params.input.after;\r\n        if (!context || !before || !after || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        let w = context.canvas.width;\r\n        let h = context.canvas.height;\r\n        glCanvas.draw(texture).perspective(before, after).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glPerspective\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {Select} from '../ui/base-components/select';\r\n// @ts-ignore\r\nimport constrainImg from 'url:~/src/app/img/ui/constrain.svg';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const resize = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        //BB.centerWithin\r\n        let canvas = params.canvas;\r\n        if (!canvas)\r\n            return false;\r\n\r\n        let fit = BB.fitInto( canvas.getWidth(), canvas.getHeight(), 280, 200,1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let previewFactor = w / canvas.getWidth();\r\n        let tempCanvas = canvas.getCompleteCanvas(1);\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        let newWidth = canvas.getWidth(), newHeight = canvas.getHeight();\r\n\r\n        div.innerHTML = LANG('filter-resize-description') + \"<br/><br/>\";\r\n\r\n\r\n        let maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n\r\n        let widthWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            }\r\n        });\r\n        let heightWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            }\r\n        });\r\n        let widthInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxWidth,\r\n                value: '' + canvas.getWidth(),\r\n            }\r\n        }) as HTMLInputElement;\r\n        let heightInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxHeight,\r\n                value: '' + canvas.getHeight(),\r\n            }\r\n        }) as HTMLInputElement;\r\n        widthInput.onclick = function () {\r\n            (this as any).focus();\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onclick = function () {\r\n            (this as any).focus();\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthInput.onchange = function () {\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onchange = function () {\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthWrapper.append(LANG('width') + \": \", widthInput);\r\n        heightWrapper.append(LANG('height') + \": \", heightInput);\r\n        let inputWrapper = BB.el({\r\n            css: {\r\n                background: \"url(\" + constrainImg + \") no-repeat 140px 5px\",\r\n                backgroundSize: '50px 52px',\r\n            }\r\n        });\r\n        inputWrapper.append(widthWrapper, heightWrapper);\r\n        div.appendChild(inputWrapper);\r\n\r\n        //contrain checkbox\r\n        let heightChanged = false, widthChanged = false;\r\n        let ratio = canvas.getWidth() / canvas.getHeight();\r\n\r\n        function updateConstrain() {\r\n            if (isConstrained) {\r\n                widthInput.value = '' + canvas.getWidth();\r\n                heightInput.value = '' + canvas.getHeight();\r\n                inputWrapper.style.background = \"url(\" + constrainImg + \") no-repeat 140px 5px\";\r\n                inputWrapper.style.backgroundSize = '50px 52px';\r\n                update();\r\n            } else {\r\n                inputWrapper.style.background = \"\";\r\n            }\r\n        }\r\n\r\n        let isConstrained = true;\r\n        let constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isConstrained = b;\r\n                updateConstrain();\r\n            }\r\n        });\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both'\r\n            }\r\n        }));\r\n\r\n\r\n        let algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')]\r\n            ],\r\n            title: LANG('scaling-algorithm'),\r\n            initValue: 'smooth',\r\n            onChange: function() {\r\n                update();\r\n            },\r\n        });\r\n\r\n        let secondRowElement = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between'\r\n            }\r\n        });\r\n        secondRowElement.appendChild(constrainCheckbox.getElement());\r\n        secondRowElement.appendChild(algorithmSelect.getElement());\r\n\r\n        let previewCanvas = BB.canvas(w, h);\r\n        previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n\r\n        let previewCtx = previewCanvas.getContext('2d');\r\n\r\n\r\n        function draw() {\r\n            if (algorithmSelect.getValue() === 'smooth') {\r\n                previewCanvas.style.imageRendering = previewFactor > 1 ? 'pixelated' : '';\r\n\r\n                previewCanvas.width = canvas.getWidth();\r\n                previewCanvas.height = canvas.getHeight();\r\n\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingQuality = 'high';\r\n                previewCtx.drawImage(tempCanvas, 0, 0);\r\n                BB.resizeCanvas(previewCanvas, newWidth, newHeight);\r\n                previewCtx.restore();\r\n\r\n            } else {\r\n                previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n                previewCanvas.width = newWidth;\r\n                previewCanvas.height = newHeight;\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingEnabled = false;\r\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\r\n                previewCtx.restore();\r\n            }\r\n\r\n        }\r\n\r\n        function update() {\r\n            if ((widthInput.value.length === 0 && widthChanged) || (heightInput.value.length === 0 && heightChanged)) {\r\n                heightChanged = false;\r\n                widthChanged = false;\r\n                return;\r\n            }\r\n            widthInput.value = '' + Math.max(1, parseInt(widthInput.value));\r\n            heightInput.value = '' + Math.max(1, parseInt(heightInput.value));\r\n            if (isConstrained) {\r\n                if (heightChanged) {\r\n                    widthInput.value = '' + parseInt('' + (parseInt(heightInput.value) * ratio));\r\n                }\r\n                if (widthChanged) {\r\n                    heightInput.value = '' + parseInt('' + (parseInt(widthInput.value) / ratio));\r\n                }\r\n\r\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\r\n                    let fit = BB.fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\r\n                    widthInput.value = '' + parseInt('' + fit.width);\r\n                    heightInput.value = '' + parseInt('' + fit.height);\r\n                }\r\n            }\r\n\r\n            if (parseInt(widthInput.value) > maxWidth) {\r\n                widthInput.value = '' + maxWidth;\r\n            }\r\n            if (parseInt(heightInput.value) > maxHeight) {\r\n                heightInput.value = '' + maxHeight;\r\n            }\r\n\r\n            heightChanged = false;\r\n            widthChanged = false;\r\n\r\n            newWidth = parseInt(widthInput.value);\r\n            newHeight = parseInt(heightInput.value);\r\n\r\n            let preview = BB.fitInto(newWidth, newHeight, 280, 200, 1);\r\n            let previewW = parseInt('' + preview.width), previewH = parseInt('' + preview.height);\r\n            previewFactor = previewW / newWidth;\r\n\r\n            let offset = BB.centerWithin(340, 220, previewW, previewH);\r\n\r\n            draw();\r\n\r\n            previewCanvas.style.width = Math.max(1, previewW) + \"px\";\r\n            previewCanvas.style.height = Math.max(1, previewH) + \"px\";\r\n            canvasWrapper.style.left = offset.x + \"px\";\r\n            canvasWrapper.style.top = offset.y + \"px\";\r\n            canvasWrapper.style.width = Math.max(1, previewW) + \"px\";\r\n            canvasWrapper.style.height = Math.max(1, previewH) + \"px\";\r\n        }\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            display: \"table\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n\r\n        let canvasWrapper = BB.appendTextDiv(previewWrapper, \"\");\r\n        canvasWrapper.appendChild(previewCanvas);\r\n        canvasWrapper.style.width = w + \"px\";\r\n        canvasWrapper.style.height = h + \"px\";\r\n        canvasWrapper.style.position = \"absolute\";\r\n        canvasWrapper.style.overflow = \"hidden\";\r\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\r\n        canvasWrapper.style.overflow = \"hidden\";\r\n        BB.createCheckerDataUrl(8, function (url) {\r\n            previewWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n\r\n        div.appendChild(previewWrapper);\r\n        update();\r\n\r\n        result.destroy = () => {\r\n            constrainCheckbox.destroy();\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return {\r\n                width: newWidth,\r\n                height: newHeight,\r\n                algorithm: algorithmSelect.getValue()\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let canvas = params.canvas;\r\n        let history = params.history;\r\n        let width = params.input.width;\r\n        let height = params.input.height;\r\n        let algorithm = params.input.algorithm;\r\n        if (!canvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        canvas.resize(width, height, algorithm);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"resize\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2BZYe\");","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const rotate = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let canvas = params.canvas;\r\n        if (!canvas)\r\n            return false;\r\n\r\n        let fit = BB.fitInto(canvas.getWidth(), canvas.getHeight(), 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let previewFactor = w / canvas.getWidth();\r\n        let tempCanvas = BB.canvas(w, h);\r\n        tempCanvas.style.display = 'block';\r\n        tempCanvas.getContext(\"2d\").drawImage(canvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        let deg = 0;\r\n        div.innerHTML = LANG('filter-rotate-description') + \"<br/><br/>\";\r\n\r\n        let first = true;\r\n\r\n        function update() {\r\n            (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg)\";\r\n            (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg)\";\r\n            (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg)\";\r\n            (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg)\";\r\n            if (Math.abs(deg % 180) === 90) {\r\n                //height has to fit width because of rotation\r\n                let fit = BB.fitInto(h, w, 280, 200, 1);\r\n                let scale = parseInt('' + fit.height) / w;\r\n                (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n                (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n                (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n                (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\r\n            }\r\n        }\r\n\r\n        let btnPlus = document.createElement(\"button\");\r\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        let btnMinus = document.createElement(\"button\");\r\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        btnMinus.style.marginRight = '5px';\r\n\r\n\r\n        btnPlus.onclick = function () {\r\n            deg += 90;\r\n            update();\r\n        };\r\n        btnMinus.onclick = function () {\r\n            deg -= 90;\r\n            update();\r\n        };\r\n\r\n        div.appendChild(btnMinus);\r\n        div.appendChild(btnPlus);\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            display: \"table\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewcell = document.createElement(\"div\");\r\n        previewcell.style.display = \"table-cell\";\r\n        previewcell.style.verticalAlign = \"middle\";\r\n        let canvasWrapper = BB.appendTextDiv(previewcell, \"\");\r\n        canvasWrapper.appendChild(tempCanvas);\r\n        previewWrapper.appendChild(previewcell);\r\n        canvasWrapper.style.width = w + \"px\";\r\n        canvasWrapper.style.height = h + \"px\";\r\n        canvasWrapper.style.marginLeft = \"auto\";\r\n        canvasWrapper.style.marginRight = \"auto\";\r\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\r\n        canvasWrapper.style.overflow = \"hidden\";\r\n        BB.createCheckerDataUrl(4, function (url) {\r\n            canvasWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n        canvasWrapper.style.transition = \"all 0.2s ease-out\";\r\n\r\n        div.appendChild(previewWrapper);\r\n        update();\r\n\r\n        result.getInput = function () {\r\n            return {\r\n                deg: deg\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let canvas = params.canvas;\r\n        let history = params.history;\r\n        let deg = params.input.deg;\r\n        if (!canvas || !history)\r\n            return false;\r\n        history.pause(true);\r\n        canvas.rotate(deg);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"rotate\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const glTiltShift = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let previewFactor = w / context.canvas.width;\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        let pointerListenerArr = [];\r\n\r\n        function finishInit() {\r\n            let blur = 20, gradient = 200;\r\n            div.innerHTML = LANG('filter-tilt-shift-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n            let fa, fb; // focus line\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).tiltShift(\r\n                        fa.x / displayPreviewFactor * previewFactor,\r\n                        fa.y / displayPreviewFactor * previewFactor,\r\n                        fb.x / displayPreviewFactor * previewFactor,\r\n                        fb.y / displayPreviewFactor * previewFactor,\r\n                        blur * previewFactor,\r\n                        gradient * previewFactor\r\n                    ).update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob(x, y) {\r\n                let nobSize = 14;\r\n                let div = BB.el({\r\n                    css: {\r\n                        width: nobSize + \"px\",\r\n                        height: nobSize + \"px\",\r\n                        backgroundColor: '#fff',\r\n                        boxShadow: \"inset 0 0 0 2px #000\",\r\n                        borderRadius: nobSize + \"px\",\r\n                        position: \"absolute\",\r\n                        cursor: 'move',\r\n                        left: (x - nobSize / 2) + \"px\",\r\n                        top: (y - nobSize / 2) + \"px\",\r\n                        userSelect: 'none',\r\n                        touchAction: 'none',\r\n                    }\r\n                });\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                let pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    maxPointers: 1,\r\n                    onPointer: function(event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                            update();\r\n                        }\r\n                    }\r\n                });\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            fa = nob(parseInt('' + (displayW / 6)), parseInt('' + (displayH / 2)));\r\n            fb = nob(parseInt('' + (displayW - displayW / 6)), parseInt('' + (displayH - displayH / 3)));\r\n\r\n            let blurSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-blur'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                initValue: blur,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    blur = val;\r\n                    update();\r\n                }\r\n            });\r\n            blurSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(blurSlider.getElement());\r\n            let gradientSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-gradient'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1000,\r\n                initValue: gradient,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    gradient = val;\r\n                    update();\r\n                }\r\n            });\r\n            div.appendChild(gradientSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.appendChild(fa);\r\n            previewInnerWrapper.appendChild(fb);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n            update();\r\n            result.destroy = () => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                blurSlider.destroy();\r\n                gradientSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    a: {x: fa.x / displayPreviewFactor, y: fa.y / displayPreviewFactor},\r\n                    b: {x: fb.x / displayPreviewFactor, y: fb.y / displayPreviewFactor},\r\n                    blur: blur,\r\n                    gradient: gradient\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let a = params.input.a;\r\n        let b = params.input.b;\r\n        let blur = params.input.blur;\r\n        let gradient = params.input.gradient;\r\n        if (!context || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).tiltShift(a.x, a.y, b.x, b.y, blur, gradient).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glTiltShift\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {FreeTransform, ITransform} from '../ui/components/free-transform';\r\nimport {Select} from '../ui/base-components/select';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\ninterface IFilterTransformInput {\r\n    bounds: {x: number, y: number, width: number, height: number};\r\n    transform: ITransform;\r\n    isPixelated: boolean;\r\n}\r\n\r\nexport const transform = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let i;\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let isSmall = window.innerWidth < 550;\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n        let freeTransform: FreeTransform;\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        // determine bounds and initial transformation\r\n        let boundsObj: {\r\n            x: number;\r\n            y: number;\r\n            width: number;\r\n            height: number;\r\n        } = { x: 0, y: 0, width: 0, height: 0 };\r\n        {\r\n            let tempBounds: any = {\r\n                x1: null,\r\n                y1: null,\r\n                x2: null,\r\n                y2: null\r\n            };\r\n            let imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\r\n\r\n            if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\r\n                tempBounds.x1 = 0;\r\n                tempBounds.y1 = 0;\r\n                tempBounds.x2 = context.canvas.width - 1;\r\n                tempBounds.y2 = context.canvas.height - 1;\r\n            } else {\r\n                for (i = 3; i < imdat.data.length; i += 4) {\r\n                    if (imdat.data[i] > 0 ) {\r\n                        let x = ((i - 3) / 4) %  context.canvas.width;\r\n                        let y = Math.floor((i - 3) / 4 / context.canvas.width);\r\n                        if (tempBounds.x1 > x || tempBounds.x1 === null) {\r\n                            tempBounds.x1 = x;\r\n                        }\r\n                        if (tempBounds.y1 === null) {\r\n                            tempBounds.y1 = y;\r\n                        }\r\n                        if (tempBounds.x2 < x || tempBounds.x2 === null) {\r\n                            tempBounds.x2 = x;\r\n                        }\r\n                        if (tempBounds.y2 < y || tempBounds.y2 === null) {\r\n                            tempBounds.y2 = y;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if (tempBounds.x1 === null || tempBounds.y1 === null) {\r\n                alert(LANG('filter-transform-empty'));\r\n                return false;\r\n            }\r\n            boundsObj.x = tempBounds.x1;\r\n            boundsObj.y = tempBounds.y1;\r\n            boundsObj.width = tempBounds.x2 - tempBounds.x1 + 1;\r\n            boundsObj.height = tempBounds.y2 - tempBounds.y1 + 1;\r\n        }\r\n\r\n        const initTransform = {\r\n            x: boundsObj.x + boundsObj.width / 2,\r\n            y: boundsObj.y + boundsObj.height / 2,\r\n            width: boundsObj.width,\r\n            height: boundsObj.height,\r\n            angleDeg: 0,\r\n        };\r\n\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        div.innerHTML = LANG('filter-transform-description');\r\n\r\n        let keyListener = new BB.KeyListener({\r\n            onDown: function(keyStr) {\r\n                if (BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n\r\n                if (keyStr === 'left') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'right') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'up') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'down') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n            }\r\n\r\n        });\r\n\r\n        let leftWrapper = document.createElement(\"div\");\r\n        let rightWrapper = document.createElement(\"div\");\r\n        let rotWrapper = document.createElement(\"div\");\r\n        let inputY = document.createElement(\"input\");\r\n        let inputX = document.createElement(\"input\");\r\n        let inputR = document.createElement(\"input\");\r\n        leftWrapper.style.width = \"100px\";\r\n        leftWrapper.style.height = \"30px\";\r\n        rightWrapper.style.width = \"100px\";\r\n        rightWrapper.style.height = \"30px\";\r\n        rightWrapper.style.display = \"inline-block\";\r\n        leftWrapper.style.display = \"inline-block\";\r\n        rotWrapper.style.display = \"inline-block\";\r\n        rotWrapper.style.width = \"150px\";\r\n        rotWrapper.style.height = \"30px\";\r\n        inputY.type = \"number\";\r\n        inputX.type = \"number\";\r\n        inputR.type = \"number\";\r\n        inputX.style.width = 70 + \"px\";\r\n        inputY.style.width = 70 + \"px\";\r\n        inputR.style.width = 70 + \"px\";\r\n        inputY.value = '0';\r\n        inputX.value = '0';\r\n        inputR.value = '0';\r\n        inputY.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputX.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputR.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputY.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputY.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        leftWrapper.append(\"X: \", inputX);\r\n        rightWrapper.append(\"Y: \", inputY);\r\n        rotWrapper.append(LANG('filter-transform-rotation') + ': ', inputR);\r\n        if (!isSmall) {\r\n            const inputRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\r\n        }\r\n\r\n        // buttons\r\n        const actionBtnCss = {\r\n            marginLeft: '10px',\r\n            marginTop: '10px',\r\n        };\r\n        const buttonRow = BB.el ({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginLeft: '-10px',\r\n            }\r\n        });\r\n        const flipXBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' X',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(-t.width, t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const flipYBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' Y',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(t.width, -t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotLeftBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '-90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg -= 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotRightBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '+90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg += 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleDoubleBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                if (constrainCheckbox.getValue()) {\r\n                    freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\r\n                } else {\r\n                    freeTransform.setSize(t.width * 2, t.height * 2);\r\n                }\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleHalfBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '1/2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const centerBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('center'),\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setPos({ x: context.canvas.width / 2, y: context.canvas.height / 2 });\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n\r\n\r\n\r\n\r\n\r\n        let isConstrained = true;\r\n        let constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-constrain'),\r\n            title: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isConstrained = b;\r\n                freeTransform.setConstrained(isConstrained);\r\n            },\r\n            css: {\r\n                display: 'inline-block'\r\n            }\r\n        });\r\n        let isSnapping = false;\r\n        let snappingCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-snap'),\r\n            title: LANG('filter-transform-snap-title'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isSnapping = b;\r\n                freeTransform.setSnapping(isSnapping);\r\n            },\r\n            css: {\r\n                display: 'inline-block',\r\n                marginLeft: '10px',\r\n            }\r\n        });\r\n        const checkboxWrapper = BB.el({});\r\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\r\n\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n                height: '10px'\r\n            }\r\n        }));\r\n\r\n        const bottomRow = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n            }\r\n        });\r\n\r\n        let algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')]\r\n            ],\r\n            initValue: 'smooth',\r\n            title: LANG('scaling-algorithm'),\r\n            onChange: function() {\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        BB.css(previewWrapper, {\r\n            width: isSmall ? '340px' : '540px',\r\n            marginLeft: \"-20px\",\r\n            height: isSmall ? '260px' : '300px',\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayerArr: IKlBasicLayer[] = [];\r\n        {\r\n            for (let i = 0; i < layers.length; i++) {\r\n                let canvas;\r\n                if (i === selectedLayerIndex) {\r\n                    canvas = BB.canvas(parseInt('' + w), parseInt('' + h));\r\n                    let ctx = canvas.getContext('2d');\r\n                    ctx.drawImage(layers[i].context.canvas, 0, 0, canvas.width, canvas.height);\r\n                } else {\r\n                    canvas = layers[i].context.canvas;\r\n                }\r\n                previewLayerArr.push({\r\n                    image: canvas,\r\n                    opacity: layers[i].opacity,\r\n                    mixModeStr: layers[i].mixModeStr\r\n                });\r\n            }\r\n        }\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: parseInt('' + displayW),\r\n            height: parseInt('' + displayH),\r\n            layers: previewLayerArr\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + displayW) + 'px',\r\n                height: parseInt('' + displayH) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        let lastDrawnTransformStr;\r\n        function updatePreview(doForce: boolean = false) {\r\n            if (!freeTransform) {\r\n                return;\r\n            }\r\n            let transform = freeTransform.getTransform();\r\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) {\r\n                return;\r\n            }\r\n            lastDrawnTransformStr = JSON.stringify(transform);\r\n            if (displayPreviewFactor < 1) {\r\n                transform.x *= displayPreviewFactor;\r\n                transform.y *= displayPreviewFactor;\r\n                transform.width *= displayPreviewFactor;\r\n                transform.height *= displayPreviewFactor;\r\n            }\r\n            let transformLayerCanvas = previewLayerArr[selectedLayerIndex].image as HTMLCanvasElement;\r\n            let ctx = transformLayerCanvas.getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, transformLayerCanvas.width, transformLayerCanvas.height);\r\n            BB.drawTransformedImageWithBounds(\r\n                ctx,\r\n                layers[selectedLayerIndex].context.canvas,\r\n                transform,\r\n                boundsObj,\r\n                algorithmSelect.getValue() === 'pixelated' ||\r\n                BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            );\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: initTransform.angleDeg,\r\n            isConstrained: true,\r\n            snapX: [0, context.canvas.width],\r\n            snapY: [0, context.canvas.height],\r\n            callback: function (t) {\r\n                inputX.value = '' + Math.round(t.x - initTransform.x);\r\n                inputY.value = '' + Math.round(t.y - initTransform.y);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            scale: displayPreviewFactor\r\n        });\r\n        BB.css(freeTransform.getElement(), {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0'\r\n        });\r\n        previewInnerWrapper.appendChild(freeTransform.getElement());\r\n\r\n        function onInputsChanged() {\r\n            freeTransform.setPos({\r\n                x: parseInt(inputX.value) + initTransform.x,\r\n                y: parseInt(inputY.value) + initTransform.y}\r\n            );\r\n            freeTransform.setAngleDeg(parseInt(inputR.value));\r\n            updatePreview();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            keyListener.destroy();\r\n            freeTransform.destroy();\r\n            constrainCheckbox.destroy();\r\n            snappingCheckbox.destroy();\r\n            BB.destroyEl(flipXBtn);\r\n            BB.destroyEl(flipYBtn);\r\n            BB.destroyEl(scaleRotLeftBtn);\r\n            BB.destroyEl(scaleRotRightBtn);\r\n            BB.destroyEl(scaleDoubleBtn);\r\n            BB.destroyEl(scaleHalfBtn);\r\n            BB.destroyEl(centerBtn);\r\n        };\r\n        result.getInput = function () {\r\n            const transform = freeTransform.getTransform();\r\n            let input = {\r\n                transform,\r\n                bounds: boundsObj,\r\n                isPixelated: algorithmSelect.getValue() === 'pixelated' ||\r\n                    BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            } as IFilterTransformInput;\r\n            result.destroy();\r\n            return JSON.parse(JSON.stringify(input));\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const input: IFilterTransformInput = params.input;\r\n\r\n        let copyCanvas = BB.copyCanvas(context.canvas);\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            context,\r\n            copyCanvas,\r\n            input.transform,\r\n            input.bounds,\r\n            input.isPixelated,\r\n        );\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"transform\"],\r\n            action: \"apply\",\r\n            params: [{input}],\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const glBlur = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let canvas = params.canvas;\r\n        let context = params.context;\r\n        if (!canvas || !context) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let previewFactor = w / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n\r\n        function finishInit() {\r\n            let radius = 10;\r\n            div.innerHTML = LANG('filter-triangle-blur-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 1,\r\n                max: 200,\r\n                initValue: radius,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    radius = val;\r\n                    glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                    klCanvasPreview.render();\r\n                }\r\n            });\r\n            div.appendChild(radiusSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                texture.destroy();\r\n                radiusSlider.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let radius = params.input.radius;\r\n        if (!context || !radius || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).triangleBlur(radius).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glBlur\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/base-components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const glUnsharpMask = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let previewFactor = w / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        function finishInit() {\r\n            let radius = 2, strength = 5.1 / 10;\r\n            div.innerHTML = LANG('filter-unsharp-mask-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            let radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                initValue: 2,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    radius = val;\r\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 50], [1, 200]]\r\n            });\r\n            let strengthSlider = new KlSlider({\r\n                label: LANG('filter-unsharp-mask-strength'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 50,\r\n                initValue: 5.1,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    strength = val / 10;\r\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 10], [1, 50]]\r\n            });\r\n            radiusSlider.getElement().style.marginBottom = \"10px\";\r\n            div.appendChild(radiusSlider.getElement());\r\n            div.appendChild(strengthSlider.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            try {\r\n                glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                radiusSlider.destroy();\r\n                strengthSlider.destroy();\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius,\r\n                    strength: strength\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let radius = params.input.radius;\r\n        let strength = params.input.strength;\r\n        if (!context || radius === null || strength === null || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).unsharpMask(radius, strength).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glUnsharpMask\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Options} from '../ui/base-components/options';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from './shared-gl-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\nexport const toAlpha = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n\r\n        function finishInit() {\r\n            let radius = 2, strength = 5.1 / 10;\r\n            div.appendChild(BB.el({\r\n                content: LANG('filter-to-alpha-description'),\r\n                css: {\r\n                    marginBottom: '5px'\r\n                }\r\n            }));\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n\r\n            function updatePreview() {\r\n                glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n                klCanvasPreview.render();\r\n            }\r\n\r\n            // source\r\n            let sourceId = 'inverted-luminance';\r\n            let sourceOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'inverted-luminance',\r\n                        label: LANG('filter-to-alpha-inverted-lum')\r\n                    },\r\n                    {\r\n                        id: 'luminance',\r\n                        label: LANG('filter-to-alpha-lum')\r\n                    }\r\n                ],\r\n                initialId: sourceId,\r\n                onChange: function(id) {\r\n                    sourceId = id;\r\n                    updatePreview();\r\n                }\r\n            });\r\n            div.appendChild(sourceOptions.getElement());\r\n\r\n            // color\r\n            let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n            let colorOptionsArr = [\r\n                null,\r\n                {r: 0, g: 0, b: 0, a: 1},\r\n                {r: 255, g: 255, b: 255, a: 1}\r\n            ];\r\n            colorOptionsArr.push({\r\n                r: params.currentColorRgb.r,\r\n                g: params.currentColorRgb.g,\r\n                b: params.currentColorRgb.b,\r\n                a: 1,\r\n            });\r\n            colorOptionsArr.push({\r\n                r: params.secondaryColorRgb.r,\r\n                g: params.secondaryColorRgb.g,\r\n                b: params.secondaryColorRgb.b,\r\n                a: 1,\r\n            });\r\n\r\n            let colorOptions = new ColorOptions({\r\n                label: LANG('filter-to-alpha-replace'),\r\n                colorArr: colorOptionsArr,\r\n                initialIndex: 1,\r\n                onChange: function(rgbaObj) {\r\n                    selectedRgbaObj = rgbaObj;\r\n                    updatePreview();\r\n                }\r\n            });\r\n            colorOptions.getElement().style.marginTop = '10px';\r\n            div.appendChild(colorOptions.getElement());\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            BB.css(previewWrapper, {\r\n                width: \"340px\",\r\n                marginLeft: \"-20px\",\r\n                height: \"220px\",\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n\r\n            setTimeout(function() { //ie has a problem otherwise...\r\n                try {\r\n                    updatePreview();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }, 1);\r\n\r\n            result.destroy = () => {\r\n                texture.destroy();\r\n                sourceOptions.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    sourceId: sourceId,\r\n                    selectedRgbaObj: selectedRgbaObj\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let sourceId = params.input.sourceId;\r\n        let selectedRgbaObj = params.input.selectedRgbaObj;\r\n        if (!context || !sourceId || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"toAlpha\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\nimport {input} from '../ui/base-components/input';\r\nimport {ColorOptions} from '../ui/base-components/color-options';\r\nimport {drawGrid} from '../image-operations/draw-grid';\r\n\r\n\r\n\r\nexport const grid = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        div.innerHTML = LANG('filter-grid-description') + \"<br/><br/>\";\r\n\r\n        const settingsObj = {\r\n            x: 2,\r\n            y: 2,\r\n            thickness: 2,\r\n            color: '#000',\r\n            opacity: 1,\r\n        };\r\n\r\n        let line1 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            }\r\n        });\r\n        let line2 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px'\r\n            }\r\n        });\r\n        const xInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.x = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const yInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.y = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n        const thicknessInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function(v) {\r\n                settingsObj.thickness = parseFloat(v);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n        settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('shape-stroke'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function(rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n                updatePreview();\r\n            }\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            marginRight: '5px',\r\n        };\r\n        line1.append(\r\n            BB.el({content: 'X:', css: labelStyle}),\r\n            xInput,\r\n            BB.el({content: 'Y:', css: labelStyle}),\r\n            yInput,\r\n        );\r\n        line2.append(\r\n            BB.el({content: LANG('brush-size') + ':', css: labelStyle}),\r\n            thicknessInput,\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorOptions.getElement(),\r\n        );\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        BB.css(previewWrapper, {\r\n            width: \"340px\",\r\n            marginLeft: \"-20px\",\r\n            height: \"220px\",\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over' as IMixMode,\r\n        };\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            })\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        function updatePreview() {\r\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n            drawGrid(ctx, settingsObj.x, settingsObj.y, Math.max(settingsObj.thickness * renderFactor, 1), settingsObj.color, settingsObj.opacity);\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n        };\r\n        result.getInput = function () {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        let history = params.history;\r\n        if (!context || !canvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        drawGrid(context, params.input.x, params.input.y, params.input.thickness, params.input.color, params.input.opacity);\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: [\"filter\", \"grid\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    },\r\n\r\n};","\r\n// ideas: padding, gutter, other shapes\r\n\r\nexport function drawGrid(\r\n    ctx: CanvasRenderingContext2D,\r\n    cellsX: number,\r\n    cellsY: number,\r\n    thickness: number, // px\r\n    color: string,\r\n    opacity: number, // 0 - 1\r\n) {\r\n    ctx.save();\r\n    const w = ctx.canvas.width;\r\n    const h = ctx.canvas.height;\r\n    thickness = Math.round(thickness);\r\n    const thickIsRound = thickness % 2 === 0;\r\n\r\n    ctx.beginPath();\r\n    ctx.lineWidth = thickness;\r\n    ctx.strokeStyle = color;\r\n    ctx.globalAlpha = opacity;\r\n\r\n    for(let i = 0; i < cellsX - 1; i++) {\r\n        const cw = w / (cellsX);\r\n        let pos = cw * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n        ctx.moveTo(pos, 0);\r\n        ctx.lineTo(pos, h);\r\n\r\n    }\r\n    for(let i = 0; i < cellsY - 1; i++) {\r\n        const ch = h / (cellsY);\r\n        let pos = ch * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n\r\n        ctx.moveTo(0, pos);\r\n        ctx.lineTo(w, pos);\r\n    }\r\n\r\n    ctx.stroke();\r\n    ctx.restore();\r\n}","import {KL} from '../kl';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\n\r\nexport async function klCanvasToPsdBlob(klCanvas: KlCanvas): Promise<Blob> {\r\n    let layerArr = klCanvas.getLayersFast();\r\n\r\n    let psdConfig = {\r\n        width: klCanvas.getWidth(),\r\n        height: klCanvas.getHeight(),\r\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\r\n        children: []\r\n    };\r\n    for (let i = 0; i < layerArr.length; i++) {\r\n        // todo - can be optimized if layer mostly empty\r\n        let item = layerArr[i];\r\n        psdConfig.children.push({\r\n            name: item.name,\r\n            opacity: item.opacity,\r\n            canvas: item.canvas,\r\n            blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n            left: 0,\r\n            top: 0\r\n        });\r\n    }\r\n\r\n    let agPsd = await import('ag-psd');\r\n    let buffer = agPsd.writePsdBuffer(psdConfig);\r\n    return new Blob([buffer], { type: 'application/octet-stream' });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"k9Nks\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"bBxqy\");"],"names":["$3kC7t","parcelRequire","$d2fa9a947070c225$export$a84540bc8b694b2d","p","klApp","agPsd","onProjectReady","project","isInitialized","Error","saveReminder","$5ngYX","SaveReminder","$gWfkn","klHistory","isDrawing","$3C7jC","KlApp","bottomBar","aboutEl","embed","url","embedUrl","onSubmit","init","loadingScreenEl","parentNode","removeChild","loadingScreenTextEl","document","body","appendChild","getEl","e","textContent","className","console","error","psdQueue","getElementById","$1mH1z","LANG","this","openProject","initError","getPNG","getPSD","default","$parcel$interopDefault","$cijLd","mark","_callee","readPSDs","psds","length","readItem","item","psd","readPsd","blob","$941rU","klPsdToKlProject","callback","forEach","_ctx","sent","shift","push","Element","prototype","Object","defineProperty","value","x","y","scrollLeft","scrollTop","window","getItem","setItem","removeItem","t1","e1","Array","slice","call","arguments","n","createDocumentFragment","t","Node","createTextNode","String","Document","DocumentFragment","hasOwnProperty","configurable","enumerable","writable","insertBefore","firstChild","padStart","repeat","$cf5d938ee512ebca$export$96f6458b62e4c2c","pProject","pOptions","ref","translateSmoothing","s","sizeWatcher","val","brushSettingService","emitSize","klCanvasWorkspace","setCursorSize","importFinishedLoading","importedImage","filename","optionStr","getResizedDimensions","width","height","w","parseInt","h","klMaxCanvasSize","importAsImage","canvas","resizedDimensions","tempCanvas","$eWjiX","BB","getContext","drawImage","resizeCanvas","reset","image","layerName","layerManager","update","setCurrentLayer","klCanvas","getLayer","resetView","handUi","getScale","getAngleDeg","importAsImagePsd","convertedPsdObj","cropObj1","crop","targetCanvas","cropCanvas","cropObj","cropCanvas1","layers","i","layerIndex","i1","item1","KL","showImportAsLayerDialog","klRootEl","transformObj","isPixelated","pause","addLayer","getLayers","renameLayer","activeLayerIndex","activeLayerContext","getLayerContext","drawTransformedImageWithBounds","tool","action","params","copyCanvas","isNaN","popup","type","message","buttons","$hrnUX","showImportImageDialog","target","maxSize","res","importAsLayer","files","showWarningPsdFlattened","file","name","split","extension","toLowerCase","f1","size","loaderIsOpen","result","closeLoader","f","FileReader","readerResult","loadAgPsd","then","agPsdLazy","doShowLoader","maxResolution","replace","convertedPsd","PSD","skipLayerImageData","skipThumbnail","catch","alert","match","URL","webkitURL","createObjectURL","im","Image","src","loadImage","hasUnsupportedFile","collapseThreshold","getElement","style","display","setDirection","uiState","isOpen","css","toolspaceCollapser","left","right","setSize","Math","max","uiWidth","toolWidth","uiHeight","setWide","statusOverlay","toolspace","borderLeft","borderRight","setUiState","updateCollapse","toolspaceScroller","updateUiState","layer","currentLayerCtx","context","currentBrush","setContext","layerPreview","setLayer","newImageDialog","currentColor","klColorSlider","getSecondaryRGB","getWidth","getHeight","innerWidth","color","a","onCancel","shareImage","shareCanvas","getCompleteCanvas","fileName","getDate","filenameBase","title","updateMainTabVisibility","mainTabRow","activeStr","toolspaceToolRow","getActive","oldTabId","getOpenedTabId","keysArr","keys","draw","fill","text","shape","setIsVisible","open","showCrop","clipboardDialog","inputObj","top","bottom","input","history","filterLib","cropExtend","apply","updateBottomBar","isVisible","innerHeight","toolspaceInner","scrollHeight","bottomBarWrapper","min","screen","$6l0gQ","LocalStorage","app","projectStore","createElement","exportType1","KlCanvas","projectObj","setHistory","layerFill","b","initState","copy","focus","getLayerCount","brushes","e3","destroy","currentBrushId","RGB","lastNonEraserBrushId","BrushSettingService","setColor","copyObj","opacity","setOpacity","getColor","brushUiObj","getSize","getOpacity","sizeSlider","brushesUI","opacitySlider","lineSmoothing","EventChain","LineSmoothing","smoothing","LineSanitizer","lineSanitizer","setChainOut","event","pointerEvents","startLine","pressure","requestFrame","goLine","isCoalesced","setLastDrawEvent","endLine","getBrush","drawLineSegment","x0","y0","x1","y1","textToolSettings","align","isBold","isItalic","KlCanvasWorkspace","drawEventChain","chainIn","rgbObj","isDragDone","pickingDone","setMode","canvasX","canvasY","getLayerIndex","floodFill","fillUi","getTolerance","getSample","getGrow","getContiguous","angleRad","dialogCounter","get","textToolDialog","font","colorRGBA","textStr","ColorConverter","toRgbaStr","typeStr","shapeTool","onDown","onMove","onUp","viewChangeObj","changed","includes","out","scale","angleDeg","angle","PI","setEnableZoomIn","getMaxScale","setEnableZoomOut","getMinScale","canUndo","undoRedoCatchup","undo","canRedo","redo","KeyListener","keyStr","comboStr","isInputFocused","getIsDrawing","zoomByStep","keyListener","isPressed","fitView","preventDefault","sameKeys","prev","next","store","getProject","t0","stop","copyToClipboard","comboOnlyContains","translateView","setAngle","decreaseSize","increaseSize","eraserBrush","getIsTransparentBg","clearLayer","r","g","setActive","brushTabRow","swapColors","KlImageDropper","onDrop","handleFileSelect","enabledTest","addEventListener","pasteEvent","clipboardData","undefined","items","indexOf","getAsFile","retrieveImageFromClipboardAsBlob","imageBlob","img","onload","revokeObjectURL","URLObj","getAsString","pasteStr","trim","onerror","log","crossOrigin","hexToRGB","b1","Ui","onOpacityChange","emitOpacity","onConfigChange","emitSliderConfig","ui","padding","position","StatusOverlay","el","oncontextmenu","onclick","handleClick","overlayToolspace","ToolspaceCollapser","setTimeout","OverlayToolspace","append","toolspaceTopRow","$85H3x","ToolspaceTopRow","showIframePopup","wrap","abrupt","parent","overlay","_ref","updateUi","logoImg","onLogo","$5ebUJ","onNew","showNewImageDialog","onImport","fileTab","triggerImport","onSave","saveToComputer","save","onShare","classList","add","marginBottom","ToolspaceToolRow","onZoomIn","onZoomOut","onUndo","onRedo","setIsSmall","addListener","setEnableUndo","setEnableRedo","KlColorSlider","onPick","p_color","emitColor","setHeight","setPickCallback","doPick","brushDiv","colorDiv","flexWrap","justifyContent","alignItems","toolspaceStabilizerRow","ToolspaceStabilizerRow","onSelect","v","setSmoothing","getOutputElement","TabRow","tooltip","brushId","enable","onClose","keyArr","createTab","b2","HandUi","onFit","onAngleChange","isRelative","FillUi","colorSlider","TextUi","ShapeUi","ShapeTool","isDone","x2","y2","shapeObj","shapeUi","getShape","isOutwards","getIsOutwards","getIsEraser","strokeRgb","lineWidth","getLineWidth","isAngleSnap","getIsSnap","isFixedRatio","getIsFixed","getMode","fillRgb","setComposite","drawShape","ctx","klLayerManager","LayerPreview","onClick","filterTab","FilterTab","UndoRedoCatchup","clctx","catchup","SaveToComputer","FileTab","imgurUpload","imgurKey","SettingsTab","$fxAg2","onOpen","minWidth","$2dTGs","$fuF9j","$adBnR","textUi","$cafM1","$23J3k","show","hide","id","$eIlXd","settingsTab","MutationObserver","observe","attributes","childList","subtree","ToolspaceScroller","resize","scrollY","scrollTo","$3WOmu","klCanvasToPsdBlob","swapUiLeftRight","saveAsPsd","_this","zIndex","userSelect","_this1","ResizeObserver","windowResizeWatcher","e2","$iUR3L","importFilters","$9cbe98d1fb398012$export$6e4a713ddcda1e5e","$dAXbp","$3P46L","$7pyBK","$705qg","drawProject","$aSJRf","WorkspaceSvgOverlay","$7bo3M","$lV6Vy","KlCanvasPreview","$i5nyl","filterLibStatus","$kyVjY","$6rdi0","renderText","$h20yl","floodFillBits","$30Cml","$3ujzu","setDbName","$9BlwZ","indexedDb","ProjectStore","$6mTnI","$lkluh","$eyygR","calcSliderFalloffFactor","$l4PqG","Checkbox","$lXqiv","$c4LUw","Select","$21VAD","ImageToggle","$jKOQl","ImageRadioList","$gmlbk","RadioList","$bHZQg","penPressureToggle","$fCJWy","KlSlider","$llzZ0","HexColorDialog","$lfHl9","$h7i9r","KlSmallColorSlider","$kzhsD","PointSlider","$bd9hB","ColorOptions","$9A7OD","Options","$iskOY","BoxToggle","$iDHln","$bmB93","CropCopy","$hRdOL","FreeTransform","$cNhNm","FreeTransformCanvas","$kEeSq","Cropper","$32CBv","$kqmpc","FittedImage","$j1kEL","$13r5y","$9p4Zp","$8jqzp","ToolDropdown","$84zxV","$9Kxky","$1Ax5m","$e4sAN","$1uc3b","BrowserStorageUi","$9pcu9","$iVHpg","$i8UFO","$ekHRj","Popup","exportDialog","$auloj","$isYih","$8ebuX","$76Qvv","$keKW3","$kDGzx","$5ENro","$khi8I","$dJXmR","$iS9xS","$9J17G","$eK8ID","$2umOB","$bIgqE","$5rdL4","DecoyKlHistory","$gFgFC","$b60fce38973759d6$var$historyInstance","$b60fce38973759d6$export$2a772a91f059c0f9","key","l","KlHistory","$7U0Ew","state","dataArr","listeners","pauseStack","maxState","actionNumber","pop","maxBefore","broadcast","bufferUpdate","$9fd01211d0fde0a8$export$63b4813c5280c707","close","isClosed","clearSelection","focusEl","tagName","select","rootRootEl","decrease","destroyEl","xButton","bgEl","removeEventListener","rootEl","wheelPrevent","btnElArr","splice","increase","overflow","minHeight","flexDirection","scrollContent","ignoreBackground","concat","$fh18w","titleHeight","lineHeight","background","boxShadow","content","div","marginRight","boxClasses","join","flex","boxEl","clickOnEnterBtn","stopPropagation","click","autoFocus","marginTop","marginLeft","buttonName","iconUrl","btnClasses","primaries","label","$c0kqC","iconImg","custom","btn","buttonRowEl","clickOnEnter","closefunc","onscroll","clearInterval","updatePos","elW","popupEl","offsetWidth","elH","offsetHeight","animationName","animationDuration","animationTimingFunction","isCssMinMaxSupported","borderRadius","paddingLeft","titleEl","tabindex","contentEl","$dd0d395ff14a3e11$export$17eb8275e0c4cab8","DialogCounter","count","emit","listener","$h4olN","$05ec456c8871d48f$export$921068d8846a1559","eventUsesHighResTimeStamp","$6J2My","mouseEventHasMovement","hasPointerEvents","hasWebGl","getVisitor","canShareFiles","insertAfter","$7jh4K","setAttributes","fitInto","centerWithin","gcd","reduce","decToFraction","imageBlobToUrl","dateDayDifference","createSvg","BbLog","$i0uIf","mix","$eg83P","dist","distSquared","lenSquared","pointsToAngleRad","pointsToAngleDeg","clamp","rotate","rotateAround","Matrix","$kVHNC","Vec2","$4toIY","intDxy","roundEven","roundUneven","updateBounds","boundsInArea","projectPointOnLine","$af1iA","PointLine","BezierLine","SplineInterpolator","quadraticSplineInput","$eelgW","createCanvas","$eIcQa","testShouldPixelate","drawTransformedImageOnCanvas","createCheckerCanvas","createCheckerDataUrl","convertToAlphaChannelCanvas","freeCanvas","HSV","$dJ1E2","CMYK","testIsWhiteBestContrast","appendTextDiv","$72Jv0","makeUnfocusable","setEventListener","$idV3L","PointerListener","$04lDo","$exufe","$cdd5ef6b176accd6$export$d031894fc27e45","DomEl","$cdd5ef6b176accd6$export$3f65cefe8380dbea","options","$cdd5ef6b176accd6$export$8ff9f68337b520c0","eventUsesHighResTimeStamp1","hasWebgl","visitor","test","$878b1f179a521546$export$b7d78993b74f766d","navigator","userAgent","$878b1f179a521546$export$4ec3bfbae69fbb50","Event","timeStamp","$878b1f179a521546$export$ebcc19037a7ab076","mouseEvent","MouseEvent","$878b1f179a521546$export$b7b64c480b083ae0","PointerEvent","$878b1f179a521546$export$9cbe517943afd6db","premultipliedAlpha","$878b1f179a521546$export$96cd70eaafd80100","chrome","gl","JSON","parse","stringify","$878b1f179a521546$export$fe0a7220ab4eecad","offsetLeft","$878b1f179a521546$export$558f5e20caee48c2","$44dda2e48e48a872$export$cd3d1f114b139967","$2bd9b7b9bc92046d$export$c4f94c8b3850a5a9","referenceNode","newNode","nextSibling","$2bd9b7b9bc92046d$export$fe58198efe02b173","counter","check","complete","$2bd9b7b9bc92046d$export$dbf350e5966cf602","styleObj","alignContent","webkitUserSelect","$2bd9b7b9bc92046d$export$74da2cba014bdc09","attrObj","setAttribute","$2bd9b7b9bc92046d$export$10d8903dec122b9d","els","fragment","$2bd9b7b9bc92046d$export$fa55905620c22535","aw","ah","bw","bh","$2bd9b7b9bc92046d$export$76d0c1a172b67a61","$2bd9b7b9bc92046d$export$aa350b96d91cd94","date","Date","getFullYear","getMonth","toString","getHours","getMinutes","$2bd9b7b9bc92046d$export$f81847884871263e","$2bd9b7b9bc92046d$export$533b26079ad0b4b","numerator","denominator","$2bd9b7b9bc92046d$export$8215e6b900906daa","decimalNumber","len","pow","$2bd9b7b9bc92046d$export$5063ec57a23c4f2e","blobObj","Blob","constructor","fauxBlob","encoding","data","$2bd9b7b9bc92046d$export$1093707c159148e8","dateA","dateB","setHours","getTime","$2bd9b7b9bc92046d$export$af0d87255f3cfd7e","obj","$2bd9b7b9bc92046d$export$331c30fd60da0115","mimetype","err","toBlob","filesArray","File","share","$2bd9b7b9bc92046d$export$b981489921ee18cd","clickEvent","allowClick","$2bd9b7b9bc92046d$export$c54fe3b9ecaa84cf","createElementNS","elementType","childrenArr","$74d1f29ad2137b2c$var$globalKey","emitDown","c","d","listenerArr","emitUp","keyDown","code","keyCode","keyToKeyStrObj","isDownObj","comboArr","codeIsDownObj","keyUp","oldComboStr","blur","eventArr","keyToKeyStrArr","i2","keyStrToKeyObj","space","alt","ctrl","cmd","enter","esc","backspace","delete","sqbr_open","sqbr_close","u","z","plus","minus","up","down","home","end","code1","first","remove","last","getIsDown","getCombo","$74d1f29ad2137b2c$export$f17908c5de22d32e","onBlur","keyStrArr","$74d1f29ad2137b2c$export$e9f65b0175de4c03","comboAStr","comboBStr","sort","pointerArr","pressureNormalizeAvgCount","pressureNormalizeAvgPressure","pressureNormalizeIsComplete","pressureNormalizeFactor","$893e90c2dcf687ac$var$WheelCleaner","endSequenceTimeout","delta","deltaY","round","sequenceUnit","pageX","pageY","clientX","clientY","endSequence","toEmitDelta","knownUnitArr","sequenceLength","process","clearTimeout","deltaMode","absDelta","abs","$893e90c2dcf687ac$export$9371bd96776f4e82","getDragObj","pointerId","dragObjArr","removeDragObj","removedDragObj","dragPointerIdArr","normalizePressure","correctPointerEvent","corrected","correctedObj","pointerType","movementX","movementY","timeStampOffset","button","eventStopPropagation","customPressure","isFirefox","coalescedEventArr","getCoalescedEvents","getPointer","pointerObj","lastPageX","lastPageY","addPointer","totalLastY","eventItem","coalescedArr","totalLastX","correctedEvent","targetElement","getBoundingClientRect","bounds","eventPreventDefault","coalescedItem","relX","relY","dX","dY","time","createTouchOutEvent","touchListItem","touchEvent","identifier","destroyDocumentListeners","onGlobalPointerMove","onGlobalPointerUp","onGlobalPointerLeave","onPointerEnter","isOverCounter","onEnterLeaveCallback","onPointerLeave","onPointermove","tempLastPointerType","lastPointerType","maxPointers","didSkip","outEvent","createPointerOutEvent","dragObj","downPageX","downPageY","buttonsToStr","clearTouchTimeout","setTouchTimeout","lastTimeStamp","outEvent1","onPointerCallback","touchTimeout","fakeEvent","performance","now","onTouchTimeout","onPointer","onWheelCallback","onWheel","onEnterLeave","wheelEvent","timing","navigationStart","onPointerdown","wheelCleaner","touchArr","changedTouches","touchObj","onTouchmove","onTouchend","$9a5bdb07e7a7c42f$export$2c9e8a9632a706b2","$9a5bdb07e7a7c42f$export$6c4a311cc157c764","ax","ay","bx","by","sqrt","$9a5bdb07e7a7c42f$export$499eb56409f6cbc2","$9a5bdb07e7a7c42f$export$a4f99f99d3e99cfa","$9a5bdb07e7a7c42f$export$627023b405ba5028","p1","p2","atan2","$9a5bdb07e7a7c42f$export$c03a8450eabc2532","$9a5bdb07e7a7c42f$export$7d15b64cf5a3a4c4","num","$9a5bdb07e7a7c42f$export$bb628a54ab399bc9","deg","theta","cs","cos","sn","sin","$9a5bdb07e7a7c42f$export$95ec0760d3d00713","center","point","rot","$9a5bdb07e7a7c42f$export$bbf9af158036c5e9","remainder","fDx","fDy","$9a5bdb07e7a7c42f$export$94cce7adf2ec2d08","above","ceil","below","floor","$9a5bdb07e7a7c42f$export$f373b6a7b0c159a","$9a5bdb07e7a7c42f$export$f4467a4f41373bc7","$9a5bdb07e7a7c42f$export$bbb91bbc54e7d9ac","$12950380ec51f25d$export$649a211db9812745","continueChain","chainArr","chainOut","func","$12950380ec51f25d$export$db3963a21c01d803","fail","sequenceArr","timeoutObj","maxUntilSecondDown","success","eventQueueArr","lastSequenceItem","onDoubleTap","setupTimeout","timeoutStr","targetFunc","timeMS","diff","nowTime","minSilenceBeforeDurationMs","maxPressedDurationMs","maxPressedDistancePx","maxInbetweenDistancePx","maxUpToUpDurationMs","maxUntilSecondDownDurationMs","minSilenceAfterMs","allowedPointerTypeArr","allowedButtonArr","pointersDownIdArr","lastUpTime","isDown","isUp","processEvent","setAllowedPointerTypeArr","arr","setAllowedButtonArr","firstDownTime","firstLastDownTimeout","tapTimeout","fingerArr","lastEventTime","fingers","maxFirstLastFingerDownMs","downTime","tempLastEventTime","maxTapMs","fingerObj","fingerObj1","i3","allAreUp","i4","onTap","gestureObj1","doSwallow","secondFingerTimeout","touchPointerArr","isInProgress","continuePinch","index","otherPointerIdArr","downRelX","downRelY","untilSecondFingerDurationMs","i6","i7","endPinch","i5","touchPointerObj","firstFingerMaxDistancePx","gestureObj","pincherArr","actionObj","startDist","distance","startAngle","onPinch","beginPinch","$12950380ec51f25d$export$fe11e0afe623a677","eventCopy","pointers","downPointerId","ignorePointerIdArr","pressure0","pressure1","eventQueue","shiftIsPressed","direction","downEvent","onDraw","i8","$12950380ec51f25d$export$91dcf4209534d21f","lastMixedInput","inputX","inputY","inputPressure","$3f0e2f35371c9852$export$dd0873c0fb3ccff6","resultCanvas","$3f0e2f35371c9852$export$1555f643cc9a976","transform","scaleX","scaleY","whSwapped","$3f0e2f35371c9852$export$ded2b43392504635","destCtx","transformImage","pixelated","imageSmoothingEnabled","imageSmoothingQuality","translate","restore","$3f0e2f35371c9852$export$425a419ef9fc761f","baseCanvas","angleDegree","cache","$3f0e2f35371c9852$export$754559b36e94ea2f","fillStyle","fillRect","$3f0e2f35371c9852$export$42af33c76b681867","size1","create","toDataURL","$3f0e2f35371c9852$export$59b33278b5b2fc8a","tmp1","tmp2","oldW","oldH","newW","newH","ew","eh","base2","oldWidthEx","log2","oldHeightEx","newWidthEx","newHeightEx","buffer1","buffer2","bufferCtx","globalCompositeOperation","currentWidth","currentHeight","newWidth","newHeight","tmp","canvasCtx","tmp1Ctx","$3f0e2f35371c9852$export$5a7576952c826b4f","imdat","getImageData","putImageData","$3f0e2f35371c9852$export$2384aff49c9b73c2","clearRect","multiplyMatrixAndPoint","$e4df33b4b16105d5$export$5b12bf1653c0dd85","getIdentity","matrix","multiplyMatrices","matrixA","matrixB","row0","row1","row2","row3","result0","result1","result2","result3","createTranslationMatrix","createRotationMatrix","createScaleMatrix","$531c9f41f98b7ec0$export$ac4bca90992eed1","sub","nor","mul","dot","aArr","bArr","map","m","$77ae015f37ebe4f1$export$b4c5b177db876445","lineStart","lineEnd","$77ae015f37ebe4f1$export$8b36a4a83269a640","segmentArr","points","getAtDist","dist1","getLength","fac","pointArr","lastSpacing","spacing","controlsCallback","lastPoint","dir","lastDot","pointM1","pointM2","pointM3","curvePoints","p3","p4","resolution","getBezierPoints","pointLine","tempSpacing","lastCallbackPoint","dAngle","lastAngle","addFinal","newP","xa","ya","wx","sig","ddydx","getFirstX","getLastX","interpolate","klo","khi","k","$77ae015f37ebe4f1$export$80967b1eb9fd6eb4","findX","$5e7aac2fa49b6b1f$export$d2edaecd208aed43","$5e7aac2fa49b6b1f$export$8f9ece5a47764b93","$5e7aac2fa49b6b1f$export$89d3f85304bf0767","$5e7aac2fa49b6b1f$export$fb7efcd2e153af6e","_RGBtoHSV","minVal","maxVal","del_R","del_G","del_B","_HSVtoRGB","var_h","var_i","var_1","var_2","var_3","var_r","var_g","var_b","_CMYKtoRGB","_RGBtoCMYK","toRGB","o","toHSV","toCMYK","toHexString","ha","hb","hc","toRgbStr","rgbaObj","hexStr","exec","$5e7aac2fa49b6b1f$export$5cf396345d1238ae","$cfe3aa45a75894cc$export$7868464f598ba79d","innerHTML","$cfe3aa45a75894cc$export$906dfdb7df31ccfc","getAll","activeElement","getAttribute","$cfe3aa45a75894cc$export$a3d02541b0ebf605","getSelection","sel","empty","removeAllRanges","selection","preventFocus","$cfe3aa45a75894cc$export$6bd63bfceaafae0c","didFocusRelated","relatedTarget","currentTarget","el1","$cfe3aa45a75894cc$var$els","$cfe3aa45a75894cc$export$c3da0dad1b44eea9","isArray","onChange","customKeyArr","$cfe3aa45a75894cc$export$b1da1db524e22115","el2","$0d0e99c175410ac4$export$9860cd9e09e6f8ba","msg","$9e5fd8359d8b22f2$export$19fffca37ef3e106","localStorage","module","exports","getBundleURL","resolve","$d82e0c66c1aaca81$export$48513f6b9f8ce62d","element","innerEl","checked","doHighlight","allowTab","tabIndex","onchange","toggle","$aa0ec58519fa7d10$export$b7e3ae3d7c15e42e","$eb01976a4bab51ce$export$ef9b1a59e592288f","selectEl","changeListener","cursor","fontSize","colorScheme","isFocusable","optionArr","option","initValue","$5cde84e643fb89d6$export$b6d053cded550773","isActive","backgroundImage","isRadio","setValue","getValue","$459eb3dcb08ae3f8$export$7cc1012a658e6ad8","activeIndex","createOption","initId","radioEl","$12a3b74a8702bb1f$export$77219f67585650fa","isChecked","changeCallback","redraw","toggleDiv","backgroundColor","border","cssFloat","$e1Rnq","backgroundSize","backgroundRepeat","boxSizing","$cf8be10874d1afb1$export$a1855b925e534de7","splineInterpolator","toLinearValue","useSpline","updateEnable","isEnabled","getOutsideVal","linearValue","updateLabel","pLinearValue","outVal","formatFunc","toLocaleString","languageStrings","getCode","labelCaption","control","elementWidth","isFinal","isChangeOnFinal","eventResMs","lastCallbackTime","virtualVal","deltaX","curve","elementHeight","curveArr","controlInner","labelFontSize","pointerListener","pointerListenerTimeout","fixScribble","increaseValue","decreaseValue","config","setIsEnabled","isDisabled","$0c2dd884393cffca$export$f8e41e222e32615d","isRightButton","$dada52d673c8c4ac$export$cc42e119007cb939","createRgbInputRow","labelStr","attributeStr","rowEl","labelEl","inputEl","lastValidRgb","parseFloat","previewEl","hexInput","hexRowEl","hexLabel","rgbArr","copyButton","$fcsnL","execCommand","resultStr","$9eeb6c00ea2d3242$export$4e5102252876c5d7","updatePrimaryHSV","hsv","primaryColorHSV","updateSVCanvas","rgb","hueStop","updateSVPointer","svHeight","pointerSV","setColPreview","divPreview","primaryColorRGB","pickerButton","filter","hexButton","updateSecondaryColor","secondaryColorBtn","secondaryColorRGB","secondaryColorHSV","controlH","pickCallback","outputDiv","startValue","svWrapper","svSvg","DOMParser","parseFromString","documentElement","divH","SVContainer","virtualHSV","$1nsGS","backgroundPosition","isPicking","isOver","targetEl","cv","gradH","createLinearGradient","col","addColorStop","createHueBg","factor","$3ac3f56275b45315$export$dcd33f7653c95f09","updateSV","canvasSV","gradient1","colleft","colright","heightSV","updateHPointer","pointerH","canvasH","heightH","svPointerId","svPointerListener","hPointerId","hPointerListener","cleardiv","clear","$0b17443c34517974$export$ac00cea56cec3037","param","redrawPoint","sliderPoint","sliderPos","isDragging","pointSize","sliderLine","isFirst","imaginaryPos","margin","transition","$a19b2655062f09b7$export$24ba9b81662d4366","buttonArr","setIsSelected","selectedIndex","colorArr","checkerUrl","found","sItem","initialIndex","colorButton","buttonSize","textAlign","$c8511e371b1e3768$export$c019608e5b5bb4cb","optionObj","classArr","isSmall","wrapperEl","selectedId","getIndex","initialId","changeOnInit","previous","$c1a93a3cd82636c9$export$5ee0af1d5c87e856","removeProperty","isWide","angleIm","$bv5Zj","verticalAlign","innerInnerEl","doPulse","animation","timeout3","timeout","timeout2","_this2","$81ac8fccf3fa43c3$export$8e17099f54853f0e","aboutDiv","closed","aniToggle","imageContainer","coverImage","coverSize","aniTimeout","boxSize","ontouchstart","ontouchmove","ontouchend","$01fcd0ed15aa4018$export$40175a5948a88a57","resetCrop","updateCroppedCanvas","croppedCanvas","croppedImage","updateSelectionRect","selectionRect","thumbX","scaleW","thumbY","scaleH","toOriginalSpace","genCrop","topLeftP","bottomRightP","origTopLeftP","origBottomRightP","isReset","eventTarget","isNotCopy","previewWrapper","thumbSize","thumbCanvas","imageRendering","thumbCtx","startP","updateCropTimeout","startCrop","didMove","rect","doUpdate","stepSize","getRect","getCroppedImage","$ffd40240385bb9f9$export$32b89bc9bb92706a","fullCanvas","cropCallback","output","toClipboard","imgURL","cropCopy","fetch","clipboard","write","ClipboardItem","clipboardItemIsSupported","topWrapper","borderTop","borderBottom","KeyEvent","rectObj","$aacd8170d7ccb1c6$export$56cc6eb0b4c43d97","p_canvas","p_func","p_rootDiv","oldHistoryState","row","clearBtn","$8yL1I","suggestions","suggestionBtns","createLayerList","updatefunc","createLayerEntry","klCanvasLayerArr","layercanvas","layerElArr","posY","innerLayer","container1","container2","spot","oldOpacity","thumbDimensions","thumb","thc","lname","whiteSpace","ondblclick","opacityLabel","sliderValue","isLast","layerOpacity","largeThumbCanvas","largeThumbDiv","largeThumbInDocument","largeThumbInTimeout","largeThumbTimeout","dragstart","freshSelection","lastpos","isSelected","div1","activateLayer","updateLayersVerticalPosition","posToSpot","newSpot","oldSpot","move","selectedSpotIndex","layerListEl","getState","child","updateHeight","layerHeight","layerSpacing","newspot","posy","oldSpotIndex","newSpotIndex","moveLayer","mergeBtn","disabled","listdiv","disableButtons","enableButtons","div2","modeWrapper","modeSelect","addnewBtn","duplicateBtn","removeBtn","renameBtn","paddingRight","$d42vI","$dKwR8","$3VpTB","$g91IK","clearboth","MAX_LAYERS","duplicateLayer","removeLayer","mixModeStr","$bBcC4","translateBlending","topCanvas","preview","spacer","alphaCanvas","bottomCanvas","globalAlpha","topOpacity","mergeDialog","mode","mergeLayers","setMixMode","setInterval","historyState","activeLayerSpotIndex","getSelected","spotIndex","stateStr","$0621fc8724f6bfac$var$allowedMixModes","$0621fc8724f6bfac$export$9f4f73b1bd7c2f26","$0621fc8724f6bfac$export$4a819bde91671014","layerNrOffset","layerCanvasArr","pickCanvas","changeListenerArr","origLayers","updateIndices","toCopyCanvas","algorithm","layerCanvas","layerContext","offX","offY","ctemp","layerCtx","fillColor","selected","isLayerLimitReached","doReturnNull","emitChange","temp","targetIndex","layerBottomIndex","layerTopIndex","isHorizontal","isVertical","tempCtx","colorObj","compositeOperation","tolerance","sampleStr","grow","isContiguous","targetCtx","targetImageData","srcCanvas","srcData","srcCtx","srcIndex","srcImageData","targetData","imageData","canvasObj","$7069db2f5e23d00f$var$fillRect","$7069db2f5e23d00f$var$mx","$7069db2f5e23d00f$var$my","$7069db2f5e23d00f$var$moveIndex","$7069db2f5e23d00f$var$testAndFill","srcArr","targetArr","initRgba","px","py","q","tl","tr","br","bl","$01d7180c5d1d0fdf$export$27550cc14d7ae85a","downX","downY","downAngleRad","onShape","$01d7180c5d1d0fdf$export$71b514a25c47df50","isEraser","strokeStyle","r1","r2","pAngleDeg","pAngleDegSnapped","rotated","r11","r21","rx","ry","rdX","rdY","x1r","y1r","x2r","y2r","x1f","y1f","x2f","y2f","beginPath","moveTo","lineTo","stroke","x1f1","y1f1","x2f1","y2f1","strokeRect","ellipse","$fdc12d72a3df9be9$export$482c90f94eb9717c","outer","fontFamily","fontWeight","fontStyle","spanStr","children","offsetTop","fillText","innerText","isDebug","$089586a542a12f27$export$5f63a7b18dc4503a","$2f1281ced73ab1dc$export$6e1bedb2a6cdff30","blendMode","codes","darken","multiply","lighten","difference","exclusion","hue","saturation","luminosity","$d256278b259ca979$export$6b9252711ea5997f","rootElement","brushCircleOuter","brushCircleInner","pickerPreviewBorder","pickerPreviewCol","compassSize","compass","compassInner","compassBaseCircle","cx","cy","compassLineCircle","compassUpperTriangle","compassLowerTriangle","radius","borderColor","$d492af58f4721011$var$TMode","TMode1","$d492af58f4721011$var$MIN_SCALE","$d492af58f4721011$export$6eaf6f7c0cc177fc","onViewChange","renderTargetCanvas","renderTargetCtx","renderWidth","renderHeight","compositeCanvas","compositeCtx","doResizeCanvas","oldTransformObj","targetTransformObj","highResTransformObj","renderedTransformObj","cursorPos","usesCssCursor","bgVisible","transformIsDirty","doAnimateTranslate","svgOverlay","emptyCanvas","isRepeat","currentInputProcessor","onKeyDown","Draw","Pick","Fill","Text","Shape","globalMode","inputProcessorObj","spaceHand","Hand","altPicker","zoom","onKeyUp","updateChangeListener","currentMode","renderTime","lastDrawEvent","linetoolProcessor","LinetoolProcessor","getMatrix","art","getRenderedTransform","matrix2","coords","matrix1","coords1","coords2","pointer","reqFrame","updateCursor","getComboStr","resetInputProcessor","coord","workspaceToCanvasCoord","onFill","onText","hand","HandGrabbing","Zoom","offsetX","offsetY","internalZoomByStep","lastRenderedState","picker","pickedColor","getColorAt","updateColorPreview","Rotating","Rotate","centerObj","startAngleRad","dAngleRad","minimizeAngleRad","origin","angleIsExtraSticky","pinchZoomer","PinchZoomer","snapAngleRad","oldTransform","mainDoubleTapper","DoubleTapper","middleDoubleTapper","twoFingerTap","NFingerTapper","threeFingerTap","pointerEventChain","OnePointerLimiter","CoalescedExploder","_this3","brushRadius","animationFrameRequested","requestAnimationFrame","updateLoop","addChangeListener","modeInt","doForce","oldMode","$hNEwm","$iOLNv","$3zTyb","$kFdtJ","oldIsHand","currentIsHand","stepNum","centerX","centerY","newStep","newScale","effectiveFactor","transformA","transformB","blendFactor","centerPosA","canvasToWorkspaceCoord","centerPosB","mixedPos","workspacePointArr","borderSize","layerArr","getLayersFast","compositeObj","updateCompass","snapDegIncrement","maxDistDeg","modDeg","doRedrawCanvas","newState","elapsedFrames","lastRenderTime","doRender","checkChange","testBgVisible","start","klC","oldWidth","oldHeight","modeStr","diameter","hideBrushCursorTimeout","doAnimate","canvasPointsArr","boundsObj","boundsWidth","boundsHeight","oldAngleRad","tx","ty","$6faa9d948ec87f40$export$e258ade1648009b7","render","$0370167ee97a20d9$var$snapToPixel","$0370167ee97a20d9$var$copyTransform","$0370167ee97a20d9$var$toTransformSpace","$0370167ee97a20d9$var$toImageSpace","corners","isConstrained","snapX","snapY","snappingEnabled","ratio","transEl","boundsEl","boundsStartP","iP","minSnapDist","snap","distX","distY","j","projected","updateCornerPositions","updateDOM","gripSize","offsetArr","scaled","tinyOffset","cornerCursors","virtualPos","constrainCorner","snapCorner","tP","indexes","updateTransformViaCorners","edgeSize","edges","angleOffset","isInverted","pointerRemainder","tfD","ti","dimension","restoreRatio","angleGrip","$lQMok","anglePointerListener","offset","snapDeg","iX","iY","_x","_y","cornerIndex","flip","widthChanged","heightChanged","angle90","newHeight1","skipCallback","transformOrigin","$48f5d87739d28bf9$export$205c2dd29f8a66b5","updatePreview","freeTransform","getTransform","destCanvas","previewLayerArr","transformIndex","initTransform","klCanvasPreview","imageWidth","imageHeight","previewFit","innerWrapper","transformSize","setPos","setAngleDeg","fit","setTransformCenter","getTransformation","getIsPixelated","$de496a1759b04ed9$export$71ed2b85d4ca43d3","transformTop","grips","maxH","transformRight","maxW","transformBottom","transformLeft","commit","cornerElArr","outline","thirdsHorizontal","thirdsVertical","gripCursors","outlinePointerListener","gripOverlay","edge0PointerListener","edge1PointerListener","edge2PointerListener","edge3PointerListener","corner0PointerListener","corner1PointerListener","corner2PointerListener","corner3PointerListener","setTransform","setScale","showThirds","$18e69c7d4cb991e8$export$d25420b53e16716f","layerObj","largeCanvasAnimationTimeout","isInstant","nameLabelEl","opacityEl","lastDrawnSize","canvasDimensions","canvasSize","animationCanvas","animationCanvasCtx","animationCanvasCheckerPattern","animationCount","animationLength","animate","drawLargeCanvas","lastDrawnState","largeCanvasIsVisible","largeCanvasSize","largeCanvas","largeCanvasCtx","largeCanvasCheckerPattern","largeCanvasWrapper","removeLargeCanvas","largeCanvasAnimationDurationMs","contentWrapperEl","canvasWrapperEl","nameWrapper","flexGrow","nameFadeEl","clickableEl","webkitTouchCallout","createPattern","showLargeCanvas","currentState","klCanvasLayerObj","$a29ff52bf33e0691$export$83ae33786c7b4ee5","$e3dfa43019bc3f08$export$962af7e240721d88","freeTransformCanvas","noteEl","originalSizeBtn","fitSizeBtn","setTransformFit","centerBtn","importImage","buttonStr","$01cb8095758db224$export$e789742143ba5b1","rootCounter","optionLayerCounter","optionImageCounter","testAcceptType","dataTransfer","types","updateOptions","optionLayerEl","optionImageEl","paddingTop","textShadow","optionStyle","$d6fe881e8fc421ac$export$9f0da9b942594e99","updateColor","selectedColorEl","updateUI","mousePos","sizeObj","hHeight","sliderHeight","queuedObj","subscriptionFunc","initialColor","subscribe","sliderConfig","getSliderConfig","$6003e73b8cbb69e2$export$665d2c76b1eb8459","createButton","extraPadding","contain","logoButton","$8oUiM","newButton","$1gUFn","importButton","$gswMe","saveButton","$lLh5u","shareButton","$5xpQb","helpButton","onHelp","$kS5uZ","$18c597dee53260ff$export$a0a40f8a0b8fee15","createDropdownButton","wrapper","dropdownWrapper","smallMargin","onClickDropdownBtn","closeDropdown","currentActiveIndex","updateButton","showDropdown","dropdownBtnArr","arrowButton","activeButton","titleArr","activeButtonIm","imArr","openTimeout","startX","startY","elementFromPoint","$gzZrf","borderBottomLeftRadius","borderBottomRightRadius","$a372d78c806cd0cc$export$c744a22bef9e0b97","doEmit","currentActiveStr","toolDropdown","handButton","onActivate","doLighten","doMirror","createTriangleButton","svg","viewBox","preserveAspectRatio","defs","in","stdDeviation","dx","dy","in2","operator","k2","k3","svgTriangleLeft","class","onLeft","svgTriangleRight","onRight","leftPointerListener","rightPointerListener","leftIm","leftImage","rightIm","rightImage","setIsEnabledLeft","setIsEnabledRight","zoomInNOutButton","$3KoFh","$eWf2I","zoomInButton","zoomOutButton","undoNRedoButton","$fc34V","undoButton","redoButton","$90c04b5ac185bf3d$export$8162a66cd18867a7","strengthSelect","setDeltaValue","$d04d72b97d637d65$export$3c6d17ed0106bfb9","pTabObj","useAccent","openedTabObj","tabDiv","openedTabObj1","roundRight","roundLeft","tabArr","roundSize","$4m0AU","tabId","$9934467c988b088a$export$cf20160367bae46c","scaleEl","angleEl","resetButton","onReset","fitButton","leftRotateButton","$2n4Fs","resetAngleButton","rightRotateButton","pIsVisible","pScale","$51d47356d698ffec$export$1e63e3b0645421a2","toleranceSlider","selectRow","growWrapper","growSelect","contiguousToggle","$d06987f550ff485e$export$32a22540e4b2f123","$45c003c723de07b5$export$a9387b1d4260d39c","updatePreviews","strokeWidth","lineWidthSlider","squish","rectStrokeSvgRect","rectFilledSvgRect","ellipseStrokeSvgEllipse","ellipseFilledSvgEllipse","lineSvgLine","fixedToggle","previewPadding","previewSize","snapToggle","rectStrokeSvg","rectFilledSvg","ellipseStrokeSvg","ellipseFilledSvg","lineSvg","shapeOptions","eraserToggle","outwardsToggle","$4fb68589de8a8c9a$export$f77a89101d7d6586","createRatioSize","ratioX","ratioY","maxCanvasSize","updateRatio","widthInput","heightInput","commonRatios","reducedArr","closestRatio","closestDistance","ratioWrapper","realw","T","U","V","HCF","secondaryColor","canvasWidth","canvasHeight","workspaceWidth","workspaceHeight","onConfirm","newImDiv","widthWrapper","heightWrapper","widthUnit","heightUnit","templateWrapper","presetFitBtn","presetCurrentBtn","presetSquareBtn","presetLandscapeBtn","presetPortraitBtn","presetOversizeBtn","sizeObj1","backgroundRGBA","colorOptionsArr","colorOptions","previewcell","cell","onkeyup","secondRow","secondRowLeft","$3f73fb4b1b574d52$export$5b91f641162972fc","icon","directionStr","$jiQkU","dirStr","$3Rl3W","$cd9e7df6e228ea45$export$e263e067d6140649","textCtx","textCanvas","$a7ch7","textInput","alignRadioList","italicToggle","boldToggle","sizeInput","fontSelect","rotatedXY","rotatedWH","fitBounds","zoomFac","previewCanvas","layersCtx","previewCtx","checkerPattern","layersCanvas","changeZoomFac","zoomInBtn","canZoom","zoomOutBtn","onScroll","isSmallWidth","isSmallHeight","touchAction","previewPointerListener","row2n3Wrapper","unshift","fontPointerListener","zoomWrapper","sizePointerListener","$2dqOY","$rk4vM","$hucjG","$cZa2s","$03Zd8","placeholder","$c8d2eb7d799b314c$export$1bf16d9bd59fd8f9","resolutionEl","updateResolution","flattenCheckbox","doFlatten","noteStyle","warningArr","psdWarningArr","contentArr","warningMap","mask","clipping","group","adjustment","showWarnings","noteEl1","cropRect","$4c230b0de5e1a470$var$kl2PsdMap","$4c230b0de5e1a470$var$psd2KlMap","$4c230b0de5e1a470$var$init","$4c230b0de5e1a470$export$6df36f0c42d2440f","str","$4c230b0de5e1a470$export$4e3b1f7d3ad623b4","$4c230b0de5e1a470$export$3d649861c4b13fa2","psdObj","addWarning","warningStr","getMixModeStr","prepareMask","maskCanvas","defaultColor","groupMaskCtx","imData","bitsPerChannel","maxLayers","layerCount","countWithinGroup","groupObj","convertGroup","psdGroupObj","groupCanvas","groupCtx","resultArr","groupOpacity","hidden","groupMixModeStr","hasClipping","innerArr","innerItem","innerCtx","clippingCanvas","clippingCtx","clippingItem","effects","clippingCanvas1","clippingCtx1","clippingItem1","$4c230b0de5e1a470$export$56493bf279c387b3","klPsd","$41164c8aeaf53227$var$indexedDbIsSupported","indexedDB","$41164c8aeaf53227$var$dbNameStr","$41164c8aeaf53227$var$storageNameStr","$41164c8aeaf53227$export$1347f8be1f25c479","$41164c8aeaf53227$var$execIndexedDBTransaction","actionFunction","successCallback","errorCallback","onError","errorStr","hasFinished","requestObj","createObjectStore","keyPath","createIndex","unique","objectStoreNames","contains","deleteDatabase","storeObj","transactionObj","databaseObj","transaction","objectStore","oncomplete","$41164c8aeaf53227$export$1448a0dd0d3fde8e","query","$41164c8aeaf53227$export$21ade4eb935254aa","storageProject","put","$41164c8aeaf53227$export$42ffd38884aecdac","$8k5kH","$805be15a1e91c0ee$export$7a4e0b62a5d854bc","isLoaded","$805be15a1e91c0ee$export$395d33c8e06b92c9","glBrightnessContrast","lang","buttonLabel","webgl","updateContext","getDialog","inEmbed","$4UkHZ","neededWithWebGL","glCurves","$e7LnL","$iI5sC","glHueSaturation","$eySuj","invert","$iPRwU","glPerspective","$krmR4","$92iBR","glTiltShift","$bFASM","toAlpha","$9m6gZ","$4fkq2","ieFails","glBlur","$dPWA8","glUnsharpMask","$cQHFd","grid","$9vOYE","$805be15a1e91c0ee$var$updateNames","$68QTJ","$42ac5b30ad65dabb$export$7d68cd8857639377","PenBrush","BlendBrush","$5PSXS","SketchyBrush","$ewgr9","PixelBrush","$kic4a","ChemyBrush","$6Nq1H","SmudgeBrush","$ltaBP","EraserBrush","$7cUpm","$3f0923cd3c55ea92$export$6f96c8f9e6ae7341","historyEntry1","settingColor","settingColorStr","lineToolLastDot","calcOpacity","settingOpacity","settingHasOpacityPressure","updateAlphaCanvas","settingAlphaId","ALPHA_CIRCLE","ALPHA_SQUARE","instructionArr","alphaCanvas128","alphaCanvas64","alphaCanvas32","alphaOpacityArr","$5CF7D","alphaImArr","drawDot","before","settingLockLayerAlpha","arc","twoPI","closePath","hasDrawnDot","targetMipmap","ALPHA_CHALK","bezierLine","lastInput","dotCallback","localPressure","lastInput2","localOpacity","localSize","settingSize","settingHasSizePressure","drawArr","localSpacing","settingSpacing","actions","inputArr","maxInput","loopDist","mouseDist","bdist","eX","eY","historyEntry","setAlpha","setSpacing","sizePressure","opacityPressure","setLockAlpha","getSpacing","$74D3O","$ff6c1f784f50f5d5$export$d116ae91f77f1f19","genBrushAlpha01","genBrushAlpha02","$f875015ce1aeb4d3$export$74a44bbc21d06a28","scaleFac","createImageData","sFac2","$gZSR2","noise","simplex2","noisePattern","centerDist","$f875015ce1aeb4d3$var$udSegment","ba","pa","$f875015ce1aeb4d3$export$eaa218d5d17c8f1c","pDist","centerSize","transitionSize","$dfc47a34ad9bc378$var$myModule","$dfc47a34ad9bc378$var$Grad","dot2","$dfc47a34ad9bc378$var$grad3","$dfc47a34ad9bc378$var$p","$dfc47a34ad9bc378$var$perm","$dfc47a34ad9bc378$var$gradP","seed","$dfc47a34ad9bc378$var$G2","xin","yin","j1","$dfc47a34ad9bc378$var$F2","gi0","gi1","gi2","$02d77b8dd5755328$var$cellSize","$02d77b8dd5755328$var$clamp","$02d77b8dd5755328$export$9659db8d01dd5313","redrawBounds","cells","getTouchedCells","isTouched","touchedCells","cellsW","getCellsWidth","cellOffsetX","cellOffsetY","cellWidth","cellHeight","inCellBounds","tmpCtx","alpha","ar","ag","ab","aa","sliceBounds","randI","randLen","randArr","random","samples","samplesSquared","sampleOffsets","sharpness","invSharpness","sharpnessSubtrahend","sizeSquared","distDivisor","alphaMinuend","slicedBounds","ri","re","alphaO","underR","invAlphaO","underG","underB","alphaU","underR1","underG1","underB1","newAlpha","drawBuffer","settingSizePressure","calcSpacing","avgX","avgY","blending","mixr","mixg","mixb","average","localColOld","avgParams","prepDot","copyFromCanvas","getAverage","blendCol","localColNew","blendMix","settingOpacityPressure","updateRedrawBounds","totalCells","isTesting","drawChangedCells","continueLine","find","$c214fbe9e4fc15b0$var$sampleCanvas","$c214fbe9e4fc15b0$var$sampleCtx","$c214fbe9e4fc15b0$export$566f9061f0f5ba33","lastX","lastY","settingBlending","settingScale","sketchySeed","setSeed","getSeed","mixmode","c1","c2","getBlending","setBlending","p_x","p_y","preMixedColor","mixx","mixy","mixw","mixh","countmix","mixed","$58b45953679baa4a$export$4de5ef8eecde6f12","ditherPattern","updateDither","ditherCtx","settingIsEraser","ditherArr","ditherCanvas","skipFirst","settingUseDither","sX","sY","plotCubicBezierLine","isOverThreshold","d2","d3","cubicCurveOverThreshold","plotLine","controlCallback","controlObj","setIsEraser","setUseDither","getLockAlpha","$fc1a683099fb2d61$export$fe52c90afd1cf5ba","isBaseLayer","isTransparentBG","radgrad","createRadialGradient","oFac","opacity1","bezierCallback","started","setTransparentBG","$78ad817c60f81b7c$var$CELL_SIZE","$78ad817c60f81b7c$var$smudge","cSize","brush","cX","cY","aP","bP","aIndex","ai","bi","ix","iy","softnessPx","fac2","alphaLock","bx1","iy4","yStart","bx2","ix4","pixel","iy1","yStart1","x21","ix1","yStart2","x3","x22","ix2","iy2","y3","iy3","yStart3","x4","x23","ix3","completeRedrawBounds","copiedCells","copyImageData","_$i","imWidth","imHeight","$78ad817c60f81b7c$var$prepSmudge","ImageData","updateCompleteRedrawBounds","historyIm","tmpCanvas","$348fcce123898af9$export$38b08aa4ea8f61c6","settingXSymmetry","settingYSymmetry","buffer","settingMode","path","Path2D","settingGradient","startAtTop","gradient","minY","maxY","lineJoin","distort","settingDistort","pos","historyCanvas","$cVFne","$7de2f0eab7a9ead7$export$f1561c72be54c6a7","penBrush","penBrushUi","blendBrush","$9mjXI","blendBrushUi","sketchyBrush","$iYbUv","sketchyBrushUi","pixelBrush","$brjBD","pixelBrushUi","chemyBrush","$vCnsd","chemyBrushUi","smudgeBrush","$dS2qM","smudgeBrushUi","$9rc5F","eraserBrushUi","brushInterface","alphaNames","$8b6ca25eb0830594$export$a0d4983f3b0b5c8e","$7gVvp","updateAlphas","alphas","currentAlpha","spacingSpline","onSizeChange","lockAlphaToggle","$7NTKy","pressureSizeToggle","pressureOpacityToggle","alphaWrapper","$e8a5c017c49bb311$export$5ec472fd0ce20d84","$2e3c50106ba150d5$export$156bb4fe8f4bcb4b","$cQSIC","blendingSlider","setSizePressure","setOpacityPressure","$94537af75923b9e3$export$ffae56164d1bde68","$bteky","blendSlider","scaleSlider","$9519e739bc9666ee$export$d001f3406562d07","$4PDnu","ditherToggle","getUseDither","toggleRow","$d6fc2ded7d9d56db$export$cf481ecf227135a8","$984eq","isTransparentBg","transparencyToggle","$1045b9bae2ffbbb4$export$84831662ba707e7a","$3QgTy","$18456e8104a5a825$export$80819a93636ebb04","$18kre","actualIconSize","iconSize","modeOptions","mirrorXToggle","halfSize","getXSymmetry","setXSymmetry","mirrorYToggle","getYSymmetry","setYSymmetry","gradientToggle","getGradient","setGradient","$14dc4cf18966a4f4$export$2358c75ad3c15b2d","$6f92981a32875bca$export$5334e08b3589fc5c","isEmbed","linkEl","iframe","href","contentWindow","location","isMaxHeight","$142eacf53b1eb43d$export$3dff5655255b5729","ignoreFocus","inputs","$0e681e75eb3cab30$export$9c72cf485ef46673","gridTemplateColumns","gridTemplateRows","gap","gridTemplateAreas","gridArea","infoEl","isBroken","ageEl","textSize","storeEl","clearEl","hideClearButton","storeListener","onUpdate","timestamp","thumbnail","updateThumb","updateAge","readResult","read","ageStr","age","maxWidth","maxHeight","resetButtons","Promise","unsubscribe","$14b343f2c12ca9c5$var$makeAsync","reject","$14b343f2c12ca9c5$export$93d91060b9af7e2a","accessHasFailed","storeKlProjectObj","getKlProjectObj","lowLevelRead","$3hwQ7","ProjectConverter","readStorageProject","storageProject1","createStorageProject","lowLevelStore","lowLevelClear","updateTimestamp","$3ee249752703e788$var$loadImage","onabort","$3ee249752703e788$export$f3c1ac6650038646","$2wCWz","base64ToBlob","createThumbnail","HTMLCanvasElement","all","t2","$e3587a28373f51f9$export$b3fb17ae4345ac8f","base64Str","parts","binStr","atob","buf","ArrayBuffer","view","Uint8Array","charCodeAt","$01ce2e23a2667e77$export$a2647fbf5f056b0a","exportType","onExportTypeChange","onFileSelect","onSaveImageToComputer","onNewImage","onShareImage","onUpload","onCopyToClipboard","createSpacer","clearer","line","filemenu","uploadImgurButton","clipboardButton","$4xKQD","multiple","accept","exportTypeWrapper","exportTypeSelect","importWrapper","innerMask","importFakeButton","createImportButton","saveNote","fileBrowserStorage","refresh","$0d10046ca7f6fbd0$export$3f17d740ad471e50","getCurrentColor","getKlMaxCanvasSize","getKlCanvas","getCurrentLayerCtx","isInit","filterKey","filterArr","applyFilter","filterDialog1","currentColorRgb","secondaryColorRgb","filterDialog","getInput","finishedDialog","createDisabledButton","appName","addGroup","groupArr","filters","webglnote","$6349b006a6604e1b$var$upload","description","$6349b006a6604e1b$var$_upload","gif","labelText","response","formData","$j8sUl","FormData","method","headers","Authorization","ok","json","link","$6349b006a6604e1b$export$b1dd62fa0b5f32f5","inputTitle","inputDescription","rows","labelTitle","labelDescription","tos","typeRadio","outDiv","infoHint","deletehash","$ae23cd0c3e53f398$var$agPsdLazy","$ae23cd0c3e53f398$export$ab3d838b1d336b38","$ae23cd0c3e53f398$var$_loadAgPsd","$06e8423858d08972$export$befc6437ad34b28a","showReminder","changeTitle","onSaveAsPsd","lastSavedActionNumber","lastSavedAt","psdWrapper","storageWrapper","paddingBottom","psdBtn","storageUi","closeFunc","lastReminderShownAt","onBeforeUnload","returnValue","getActionNumber","visibilityState","unsavedActions","showPopup","unsavedInterval","$956d06d740fc5053$export$75e7b60500bb415b","getExportType","format","saveImage","mimeType","$98ax7","saveAs","mimeType2","filename1","fnameArr","fileBase","layerArr1","psdConfig","blendKlToPsd","writePsdBuffer","XMLHttpRequest","responseType","g1","send","d1","a2","status","dispatchEvent","createEvent","initMouseEvent","self","$parcel$global","global","a1","HTMLAnchorElement","download","rel","msSaveOrOpenBlob","autoBom","warn","HTMLElement","safari","onloadend","readAsDataURL","define","amd","$48534f13b7192dff$export$5cebd3bb2d68229a","getInitState","setCurrentLayerCtx","getCurrentBrush","doIgnore","ignoreTest","oldSize","b4","id1","b3","b8","p5","b5","p6","b6","id2","b7","currentLayerIndex","logParam","localCurrentLayerCtx","p7","p8","b9","p9","b10","id3","b11","$53cc60fd413705d6$export$272bfd3ef9ef2f48","onSetColor","onSetSize","onSetOpacity","onGetColor","onGetSize","onGetOpacity","onGetSliderConfig","subscriberArr","instance","skipSubscriber","$5562b5b6c391a7ca$export$5d396b237bd33221","onLeftRight","customAbout","makeLicenses","licenses","overflowY","language","getLanguage","preferredLanguageRow","$fgfvl","languages","languageSelect","LS_LANGUAGE_KEY","languageHint","$7OLuX","$6qSiv","$951e508110f8a437$export$42a534af7eb650e8","upBtn","downBtn","upInterval","scrollBy","downInterval","_this4","wheelListener","$b37f5cd553722692$export$665d2c76b1eb8459","submitButton","leftRightButton","$4bb0d03ef02dc0c0$var$importFilter","libObj","moduleObj","$4bb0d03ef02dc0c0$export$4283b00eae4a6956","$99EgS","$5deND","$4d8c6","$5Ta9b","$gMKRz","$7z464","$diAhN","$c1rJJ","$2elec","$gACTl","$dIv7c","$1NZ3i","$cJB4E","$gTwOE","$cKnYu","$1e763c481ba6cf00$export$80884bc1ac80aa1d","selectedLayerIndex","brightness","contrast","glCanvas","$5RaQo","getSharedFx","texture","brightnessSlider","$cH2YE","brightnessContrast","contrastSlider","previewInnerWrapper","$fca35583bfaa35b6$export$5ec472fd0ce20d84","$TEtAx","$0e6e34a2063e157d$var$fxCanvas","fx","$0e6e34a2063e157d$export$8c4423af32b21158","_","isContextLost","$5eb53faa48338ac6$export$68ae324f2f6c6252","gl1","lo","hi","wrapTexture","loadContentsOf","texture1","Texture1","fromElement","initialize","UNSIGNED_BYTE","getExtension","testTexture","RGBA","FLOAT","drawTo","spareTexture","extraTexture","flippedShader","Shader1","use","getDefaultShader","drawRect","shader","uniforms","textureIn","textureOut","swapWith","node","getPixelArray","array","readPixels","getSquareToQuad","dx1","dy1","dx2","dy2","dx3","dy3","det","warpShader","warp","simpleShader","interpolator","curves","red","green","blue","splineInterpolate","initFromBytes","textures","denoise","exponent","texSize","hueSaturation","amount","sepia","strength","unsharpMask","ensureFormat","triangleBlur","originalTexture","unuse","vibrance","vignette","lensBlurPrePass","common","randomShaderFunc","lensBlur0","lensBlur1","lensBlur2","power","delta0","delta1","endX","endY","blurRadius","gradientRadius","tiltShift","zoomBlur","colorHalftone","dotScreen","edgeWork1","edgeWork2","hexagonalPixelate","ink","bulgePinch","inverse","useTextureSpace","matrixWarp","getInverse","perspective","after","swirl","replaceRGBA","oldGetExtension","oldGetSupportedExtensions","getSupportedExtensions","framebuffer","createFramebuffer","byteTexture","createTexture","TEXTURE_2D","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","FRAMEBUFFER","COLOR_ATTACHMENT0","bindTexture","floatTexture","texParameteri","LINEAR","texImage2D","Float32Array","program","createProgram","vertexShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","shaderSource","compileShader","attachShader","linkProgram","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STREAM_DRAW","enableVertexAttribArray","POINTS","supportsOESTextureFloatLinear","WebGLRenderingContext","$OES_texture_float_linear$","OESTextureFloatLinear","extensions","contents","edgeWork","lensBlur","isNumber","compileSource","testPrecisionSupport","floatPrecision","source","nameStr","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","precisionType","getShaderPrecisionFormat","precision","vertexSource","fragmentSource","vertexAttribute","texCoordAttribute","defaultVertexSource","defaultFragmentSource","HIGH_FLOAT","MEDIUM_FLOAT","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","useProgram","getUniformLocation","uniform1fv","uniform2fv","uniform3fv","uniform4fv","uniformMatrix3fv","uniformMatrix4fv","uniform1f","uniform1i","Shader","viewport","getParameter","VIEWPORT","$21fb62da4f6e89f8$export$4630dcf80f8ceb88","updateInput","leftInput","rightInput","topInput","bottomInput","leftChanged","rightChanged","topChanged","bottomChanged","cropper","offsetWrapper","selectedRgbaObj","fit1","previewFactor","lrWrapper","tbWrapper","labelStyle","useRuleOfThirds","ruleOThirdsCheckbox","bgColorOverlay","updateBg","flexRow","$e250f451a2faf8b3$export$2e9081b953703a77","canvas1","ctx1","curves1","modeButtons","p0","areah","areaw","update2","curveArea","createPoint","lock","internalY","internalX","newX","newY","updateControl","outCurves","drawCurve","spline","getDiv","update1","$ae0fd60a73f3b8a4$export$8a83211c878a3f1f","previewLayer","doFlipCanvas","horizontalCheckbox","verticalCheckbox","fcOption","borderTopLeftRadius","$1RI49","flOption","borderTopRightRadius","optionWrapper","horizontal","vertical","flipCanvas","$b5e471d752989800$export$88005259b9a70e15","Saturation","hueSlider","saturationSlider","$d23471d9289cfec2$export$6897c284b6f9f4dc","$ed63f0c6c7ca7574$export$358acb0cd681f612","displayW","displayH","displayPreviewFactor","pointerListenerArr","bb","bc","bd","ac","ad","nob","updateAfter","beforeOption","afterOption","nobSize","$2405b4796fda9858$export$4380c87abf28fdf","previewW","previewH","algorithmSelect","canvasWrapper","inputWrapper","$jfTWC","constrainCheckbox","secondRowElement","$5b99ea702a5304d2$export$bb628a54ab399bc9","WebkitTransform","MozTransform","OTransform","msTransform","btnPlus","btnMinus","$e3bfa9cf59911118$export$83a0900d4b9a8022","fa","fb","blurSlider","gradientSlider","$dc2850290325f029$export$51186ad6e864892a","transform1","lastDrawnTransformStr","transformLayerCanvas","onInputsChanged","inputR","tempBounds","leftWrapper","rightWrapper","rotWrapper","actionBtnCss","buttonRow","flipXBtn","flipYBtn","scaleRotLeftBtn","scaleRotRightBtn","scaleDoubleBtn","getRatio","scaleHalfBtn","setConstrained","isSnapping","snappingCheckbox","setSnapping","checkboxWrapper","bottomRow","transform2","$6f2c67b7999657bb$export$5a82a801f025d40a","radiusSlider","$f7bb3cad91091576$export$a959f91352b242e2","strengthSlider","$e96a6eb511826b00$export$be1ee5ea42904fdc","sourceId","sourceOptions","$9324ab73e882cd51$export$85fc379452d91af0","renderW","renderH","$1xi6g","drawGrid","settingsObj","thickness","renderFactor","line1","line2","xInput","yInput","thicknessInput","$74df8e8cd35bce4e$export$20d2db9c68afeac","cellsX","cellsY","thickIsRound","pos1","$40b8cea12adf584e$export$92433b641be3f7a","$40b8cea12adf584e$var$_klCanvasToPsdBlob"],"version":3,"file":"main-embed.5f4d0d36.js.map"}